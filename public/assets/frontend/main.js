(self.webpackChunkopenproject_frontend=self.webpackChunkopenproject_frontend||[]).push([["main"],{98255:X=>{function I(t){return Promise.resolve().then(()=>{var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i})}I.keys=()=>[],I.resolve=I,I.id=98255,X.exports=I},32091:function(X,I,t){var i,e;e=this,void 0!==(i=function(){return function(e){"use strict";var d=e&&e.I18n||{},h=Array.prototype.slice,r=function(M){return("0"+M.toString()).substr(-2)},n=function(M,S){return C("round",M,-S).toFixed(S)},l=function(M){var S=typeof M;return"function"===S||"object"===S},a=function(M){return"function"==typeof M},m=function(M){return null!=M},v=function(M){return Array.isArray?Array.isArray(M):"[object Array]"===Object.prototype.toString.call(M)},c=function(M){return"string"==typeof value||"[object String]"===Object.prototype.toString.call(M)},p=function(M){return"number"==typeof M||"[object Number]"===Object.prototype.toString.call(M)},f=function(M){return!0===M||!1===M},C=function(M,S,R){return void 0===R||0==+R?Math[M](S):(S=+S,R=+R,isNaN(S)||"number"!=typeof R||R%1!=0?NaN:(S=S.toString().split("e"),+((S=(S=Math[M](+(S[0]+"e"+(S[1]?+S[1]-R:-R)))).toString().split("e"))[0]+"e"+(S[1]?+S[1]+R:R))))},u=function(M,S){return a(M)?M(S):M},k=function(M,S){var R,F;for(R in S)S.hasOwnProperty(R)&&(F=S[R],c(F)||p(F)||f(F)||v(F)?M[R]=F:(null==M[R]&&(M[R]={}),k(M[R],F)));return M},O={day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridian:["AM","PM"]},y={precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1},b={unit:"$",precision:2,format:"%u%n",sign_first:!0,delimiter:",",separator:"."},P={unit:"%",precision:3,format:"%n%u",separator:".",delimiter:""},E=[null,"kb","mb","gb","tb"],T={defaultLocale:"en",locale:"en",defaultSeparator:".",placeholder:/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,fallbacks:!1,translations:{},missingBehaviour:"message",missingTranslationPrefix:""};return d.reset=function(){var M;for(M in T)this[M]=T[M]},d.initializeOptions=function(){var M;for(M in T)m(this[M])||(this[M]=T[M])},d.initializeOptions(),d.locales={},d.locales.get=function(M){var S=this[M]||this[d.locale]||this.default;return a(S)&&(S=S(M)),!1===v(S)&&(S=[S]),S},d.locales.default=function(M){var S=[],R=[];return M&&S.push(M),!M&&d.locale&&S.push(d.locale),d.fallbacks&&d.defaultLocale&&S.push(d.defaultLocale),S.forEach(function(F){var L=F.split("-"),D=null,G=null;3===L.length?(D=[L[0],L[1]].join("-"),G=L[0]):2===L.length&&(D=L[0]),-1===R.indexOf(F)&&R.push(F),d.fallbacks&&[D,G].forEach(function(Q){null!=Q&&Q!==F&&-1===R.indexOf(Q)&&R.push(Q)})}),S.length||S.push("en"),R},d.pluralization={},d.pluralization.get=function(M){return this[M]||this[d.locale]||this.default},d.pluralization.default=function(M){switch(M){case 0:return["zero","other"];case 1:return["one"];default:return["other"]}},d.currentLocale=function(){return this.locale||this.defaultLocale},d.isSet=m,d.lookup=function(M,S){S=S||{};var L,D,G,Q,R=this.locales.get(S.locale).slice();for(R[0],G=this.getFullScope(M,S);R.length;)if(L=R.shift(),D=G.split(this.defaultSeparator),Q=this.translations[L]){for(;D.length&&null!=(Q=Q[D.shift()]););if(null!=Q)return Q}if(m(S.defaultValue))return u(S.defaultValue,M)},d.pluralizationLookupWithoutFallback=function(M,S,R){var D,G,L=this.pluralization.get(S)(M);if(l(R))for(;L.length;)if(D=L.shift(),m(R[D])){G=R[D];break}return G},d.pluralizationLookup=function(M,S,R){R=R||{};var D,G,Q,V,F=this.locales.get(R.locale).slice();for(F[0],S=this.getFullScope(S,R);F.length;)if(D=F.shift(),G=S.split(this.defaultSeparator),Q=this.translations[D]){for(;G.length&&(Q=Q[G.shift()],l(Q));)0==G.length&&(V=this.pluralizationLookupWithoutFallback(M,D,Q));if(null!=V&&null!=V)break}return(null==V||null==V)&&m(R.defaultValue)&&(V=l(R.defaultValue)?this.pluralizationLookupWithoutFallback(M,R.locale,R.defaultValue):R.defaultValue,Q=R.defaultValue),{message:V,translations:Q}},d.meridian=function(){var M=this.lookup("time"),S=this.lookup("date");return M&&M.am&&M.pm?[M.am,M.pm]:S&&S.meridian?S.meridian:O.meridian},d.prepareOptions=function(){for(var R,M=h.call(arguments),S={};M.length;)if("object"==typeof(R=M.shift()))for(var F in R)!R.hasOwnProperty(F)||m(S[F])||(S[F]=R[F]);return S},d.createTranslationOptions=function(M,S){var R=[{scope:M}];return m(S.defaults)&&(R=R.concat(S.defaults)),m(S.defaultValue)&&R.push({message:S.defaultValue}),R},d.translate=function(M,S){S=S||{};var F,R=this.createTranslationOptions(M,S),L=this.prepareOptions(S);return delete L.defaultValue,R.some(function(G){if(m(G.scope)?F=this.lookup(G.scope,L):m(G.message)&&(F=u(G.message,M)),null!=F)return!0},this)?("string"==typeof F?F=this.interpolate(F,S):l(F)&&m(S.count)&&(F=this.pluralize(S.count,M,S)),F):this.missingTranslation(M,S)},d.interpolate=function(M,S){S=S||{};var F,D,G,L,R=M.match(this.placeholder);if(!R)return M;for(;R.length;)D=(F=R.shift()).replace(this.placeholder,"$1"),L=m(S[D])?S[D].toString().replace(/\$/gm,"_#$#_"):D in S?this.nullPlaceholder(F,M,S):this.missingPlaceholder(F,M,S),G=new RegExp(F.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),M=M.replace(G,L);return M.replace(/_#\$#_/g,"$")},d.pluralize=function(M,S,R){var F,D;return R=this.prepareOptions({count:String(M)},R),null==(D=this.pluralizationLookup(M,S,R)).translations||null==D.translations?this.missingTranslation(S,R):null!=D.message&&null!=D.message?this.interpolate(D.message,R):(F=this.pluralization.get(R.locale),this.missingTranslation(S+"."+F(M)[0],R))},d.missingTranslation=function(M,S){if("guess"==this.missingBehaviour){var R=M.split(".").slice(-1)[0];return(this.missingTranslationPrefix.length>0?this.missingTranslationPrefix:"")+R.replace("_"," ").replace(/([a-z])([A-Z])/g,function(G,Q,V){return Q+" "+V.toLowerCase()})}return'[missing "'+[null!=S&&null!=S.locale?S.locale:this.currentLocale(),this.getFullScope(M,S)].join(this.defaultSeparator)+'" translation]'},d.missingPlaceholder=function(M,S,R){return"[missing "+M+" value]"},d.nullPlaceholder=function(){return d.missingPlaceholder.apply(d,arguments)},d.toNumber=function(M,S){S=this.prepareOptions(S,this.lookup("number.format"),y);var D,Q,R=M<0,L=n(Math.abs(M),S.precision).toString().split("."),G=[],V=S.format||"%n",K=R?"-":"";for(M=L[0],D=L[1];M.length>0;)G.unshift(M.substr(Math.max(0,M.length-3),3)),M=M.substr(0,M.length-3);return Q=G.join(S.delimiter),S.strip_insignificant_zeros&&D&&(D=D.replace(/0+$/,"")),S.precision>0&&D&&(Q+=S.separator+D),Q=(V=S.sign_first?"%s"+V:V.replace("%n","%s%n")).replace("%u",S.unit).replace("%n",Q).replace("%s",K)},d.toCurrency=function(M,S){return S=this.prepareOptions(S,this.lookup("number.currency.format"),this.lookup("number.format"),b),this.toNumber(M,S)},d.localize=function(M,S,R){switch(R||(R={}),M){case"currency":return this.toCurrency(S);case"number":return M=this.lookup("number.format"),this.toNumber(S,M);case"percentage":return this.toPercentage(S);default:var F;return F=M.match(/^(date|time)/)?this.toTime(M,S):S.toString(),this.interpolate(F,R)}},d.parseDate=function(M){var S,R,F;if("object"==typeof M)return M;if(S=M.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2})([\.,]\d{1,3})?)?(Z|\+00:?00)?/)){for(var L=1;L<=6;L++)S[L]=parseInt(S[L],10)||0;S[2]-=1,F=S[7]?1e3*("0"+S[7]):null,R=S[8]?new Date(Date.UTC(S[1],S[2],S[3],S[4],S[5],S[6],F)):new Date(S[1],S[2],S[3],S[4],S[5],S[6],F)}else"number"==typeof M?(R=new Date).setTime(M):M.match(/([A-Z][a-z]{2}) ([A-Z][a-z]{2}) (\d+) (\d+:\d+:\d+) ([+-]\d+) (\d+)/)?(R=new Date).setTime(Date.parse([RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$6,RegExp.$4,RegExp.$5].join(" "))):(M.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/),(R=new Date).setTime(Date.parse(M)));return R},d.strftime=function(M,S){var R=this.lookup("date"),F=d.meridian();if(R||(R={}),R=this.prepareOptions(R,O),isNaN(M.getTime()))throw new Error("I18n.strftime() requires a valid date object, but received an invalid date.");var L=M.getDay(),D=M.getDate(),G=M.getFullYear(),Q=M.getMonth()+1,V=M.getHours(),K=V,q=V>11?1:0,se=M.getSeconds(),te=M.getMinutes(),ie=M.getTimezoneOffset(),le=Math.floor(Math.abs(ie/60)),oe=Math.abs(ie)-60*le,ne=(ie>0?"-":"+")+(le.toString().length<2?"0"+le:le)+(oe.toString().length<2?"0"+oe:oe);return K>12?K-=12:0===K&&(K=12),S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=(S=S.replace("%a",R.abbr_day_names[L])).replace("%A",R.day_names[L])).replace("%b",R.abbr_month_names[Q])).replace("%B",R.month_names[Q])).replace("%d",r(D))).replace("%e",D)).replace("%-d",D)).replace("%H",r(V))).replace("%-H",V)).replace("%I",r(K))).replace("%-I",K)).replace("%m",r(Q))).replace("%-m",Q)).replace("%M",r(te))).replace("%-M",te)).replace("%p",F[q])).replace("%S",r(se))).replace("%-S",se)).replace("%w",L)).replace("%y",r(G))).replace("%-y",r(G).replace(/^0+/,""))).replace("%Y",G)).replace("%z",ne)},d.toTime=function(M,S){var R=this.parseDate(S),F=this.lookup(M);return R.toString().match(/invalid/i)||!F?R.toString():this.strftime(R,F)},d.toPercentage=function(M,S){return S=this.prepareOptions(S,this.lookup("number.percentage.format"),this.lookup("number.format"),P),this.toNumber(M,S)},d.toHumanSize=function(M,S){for(var D,G,R=1024,F=M,L=0;F>=R&&L<4;)F/=R,L+=1;return 0===L?(D=this.t("number.human.storage_units.units.byte",{count:F}),G=0):(D=this.t("number.human.storage_units.units."+E[L]),G=F-Math.floor(F)==0?0:1),S=this.prepareOptions(S,{unit:D,precision:G,format:"%n%u",delimiter:""}),this.toNumber(F,S)},d.getFullScope=function(M,S){return S=S||{},v(M)&&(M=M.join(this.defaultSeparator)),S.scope&&(M=[S.scope,M].join(this.defaultSeparator)),M},d.extend=function(M,S){return void 0===M&&void 0===S?{}:k(M,S)},d.t=d.translate,d.l=d.localize,d.p=d.pluralize,d}(e)}.call(I,t,I,X))&&(X.exports=i)},86664:(X,I,t)=>{"use strict";t.d(I,{u:()=>r});var i=t(54364),e=t(76491),d=t(3352),h=t(2316);class r{constructor(l){this.activeState$=new e.X(!0),l.addEventListener("visibilitychange",()=>{l.visibilityState&&((0,d.qu)(`Browser window has visibility state changed to ${l.visibilityState}`),this.activeState$.next("visible"===l.visibilityState))})}get isActive(){return this.activeState$.value}get active$(){return this.activeState$.asObservable()}}r.\u0275fac=function(l){return new(l||r)(h.LFG(i.K0))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})},61908:(X,I,t)=>{"use strict";t.d(I,{T:()=>Wt});var i=t(6976),e=t(70233),d=t(71909);class h extends i.f2{constructor(){super(...arguments),this.form=this.subResource("form",d.E)}patch(de,ae=null){const pe=this.form.extractPayload(de,ae);return this.halResourceService.patch(this.path,pe)}delete(){return this.halResourceService.delete(this.path)}}var r=t(73726);class n extends i.ZQ{constructor(de,ae){super(de,ae,"grids",h),this.apiRoot=de,this.basePath=ae,this.form=this.subResource("form",d.E)}list(de){return this.halResourceService.get(this.path+(0,r.g)(de))}post(de,ae=null){return this.halResourceService.post(this.path,this.form.extractPayload(de,ae))}}var l=t(3786),a=t(29161),m=t(87853),v=t(83972),c=t(81134),p=t(53466),f=t(92597),C=t(79902),u=t(67202),k=t(98636),O=t(44022);class y extends i.f2{constructor(){super(...arguments),this.cache=this.createCache()}requireAndStream(de=!1){const ae=this.id.toString();if(this.cache.stale(ae)||de){const pe=this.load().pipe((0,p.q)(1),(0,f.d)(1));return this.cache.clearAndLoad(ae,pe),(0,v.z)(pe,this.cache.state(ae).values$())}return this.cache.state(ae).values$()}observe(){return this.cache.observe(this.id.toString())}get(){return this.requireAndStream(!1).pipe((0,p.q)(1))}refresh(){return this.requireAndStream(!0).pipe((0,p.q)(1)).toPromise()}load(){return this.halResourceService.get(this.path).pipe((0,C.w)(de=>de.$links.schema?this.schemaCache.requireAndStream(de.$links.schema.href).pipe((0,p.q)(1),(0,u.h)(de)):(0,c.of)(de)))}touch(de){this.cache.updateFor(de)}cacheResponse(){return de=>de.pipe((0,k.b)(ae=>this.touch(ae)))}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",m.G)],y.prototype,"states",void 0),(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",O.y)],y.prototype,"schemaCache",void 0);var b=t(83498),P=t(26784),E=t(80044);class T extends y{constructor(){super(...arguments),this.form=this.subResource("form",b.f)}patch(de,ae=null){return this.halResourceService.patch(this.path,this.extractPayload(de,ae)).pipe((0,k.b)(pe=>this.touch(pe)))}delete(){return this.halResourceService.delete(this.path).pipe((0,k.b)(()=>this.cache.clearSome(this.id.toString())))}createCache(){return this.parent.cache}extractPayload(de,ae=null){return de instanceof E.X&&ae?P.u.extractPayloadFromSchema(de,ae):de instanceof E.X?{}:de}}var M=t(20501);class S extends i.ZQ{constructor(){super(...arguments),this.cache=this.createCache()}observeAll(){return this.cache.observeAll()}cacheResponse(){return de=>de.pipe((0,k.b)(ae=>{var pe;ae instanceof M.Y?null===(pe=ae.elements)||void 0===pe||pe.forEach(this.touch.bind(this)):ae instanceof E.X&&this.touch(ae)}))}touch(de){this.cache.updateFor(de)}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",m.G)],S.prototype,"states",void 0);var R=t(79175);class F extends R.r{constructor(de,ae){super(ae),this.injector=de}updateValue(de,ae){return this.schemaCache.ensureLoaded(ae).then(()=>(this.putValue(de,ae),ae))}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",m.G)],F.prototype,"states",void 0),(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",O.y)],F.prototype,"schemaCache",void 0);class L extends S{constructor(de,ae){super(de,ae,"time_entries",T),this.apiRoot=de,this.basePath=ae,this.form=this.subResource("form",b.f),this.schema=this.subResource("schema")}list(de){return this.halResourceService.get(this.path+(0,r.g)(de)).pipe(this.cacheResponse())}post(de){return this.halResourceService.post(this.path,de).pipe(this.cacheResponse())}createCache(){return new F(this.injector,this.states.timeEntries)}}class D extends i.f2{}class G extends i.ZQ{constructor(de,ae){super(de,ae,"capabilities",D),this.apiRoot=de,this.basePath=ae}}var Q=t(33927),V=t(26269);class K extends i.f2{list(de){return this.halResourceService.get(this.path+(0,r.g)(de))}exists(de){return this.halResourceService.get(this.path,{filters:(0,V.PQ)("id","=",[de]).toJson()}).pipe((0,Q.U)(ae=>ae.count>0))}}class q extends b.f{static extractPayload(de){return{_links:{project:{href:de.project.href},principal:{href:de.principal.href},roles:de.roles.map(ae=>({href:ae.href}))},_meta:{notificationMessage:{raw:de.notificationMessage.raw}}}}extractPayload(de){return q.extractPayload(de)}}class se extends i.ZQ{constructor(de,ae){super(de,ae,"memberships"),this.apiRoot=de,this.basePath=ae,this.form=this.subResource("form",q),this.available_projects=this.subResource("available_projects",K)}list(de){return this.halResourceService.get(this.path+(0,r.g)(de))}post(de){const ae=this.form.extractPayload(de);return this.halResourceService.post(this.path,ae)}}var te=t(53882);class ie extends i.G7{get(){return this.http.get(this.path)}patch(de){return this.http.patch(this.path,de,{withCredentials:!0,responseType:"json"})}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",te.eN)],ie.prototype,"http",void 0);class le extends y{constructor(){super(...arguments),this.avatar=this.subResource("avatar"),this.preferences=this.subResource("preferences",ie)}createCache(){return new R.r(this.states.users)}}class oe extends i.ZQ{constructor(de,ae){super(de,ae,"users",le),this.apiRoot=de,this.basePath=ae,this.me=this.subResource("me",le),this.form=this.subResource("form",b.f)}post(de){return this.halResourceService.post(this.path,de)}}class ne extends y{createCache(){return this.parent.cache}}class fe extends S{constructor(de,ae){super(de,ae,"types",ne),this.apiRoot=de,this.basePath=ae}createCache(){return new R.r(this.states.types)}}var ve=t(17577),Se=t(49152);class Oe extends Se.J{constructor(de,ae,pe){super(ae,pe),this.injector=de,this.basePath=ae,this.id=pe}get(){return this.http.get(this.path).toPromise().then(de=>de||{})}update(de){return this.http.patch(this.path,{delta:de},{withCredentials:!0}).toPromise().then(ae=>ae.t)}delete(de,...ae){const pe={};return ae.forEach(H=>pe[H]=-1),this.update(pe)}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",te.eN)],Oe.prototype,"http",void 0);var je=t(97973),tt=t(19866);class He extends b.f{load(de){const ae={name:de.name||"!!!__O__o__O__!!!"};de.project&&(ae._links={project:{href:de.project.href}});const{path:pe}=this.apiRoot.queries.withOptionalId(de.id).form;return this.halResourceService.post(pe,ae).pipe((0,k.b)(H=>this.queryFilters.setSchemas(H.$embedded.schema.$embedded.filtersSchemas)),(0,Q.U)(H=>[H,this.buildQueryResource(H)]))}loadWithParams(de,ae,pe,H={}){!ae&&!H.name&&(H.name="!!!__O__o__O__!!!"),pe&&(H._links=H._links||{},H._links.project={href:this.apiRoot.projects.id(pe).toString()});const{path:he}=this.apiRoot.queries.withOptionalId(ae).form,ue=je(he).search(de).toString();return this.halResourceService.post(ue,H).pipe((0,k.b)(Le=>this.queryFilters.setSchemas(Le.$embedded.schema.$embedded.filtersSchemas)),(0,Q.U)(Le=>[Le,this.buildQueryResource(Le)]))}buildQueryResource(de){return this.halResourceService.createHalResourceOfType("Query",de.payload)}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",tt.r)],He.prototype,"queryFilters",void 0);class st extends i.f2{constructor(){super(...arguments),this.form=this.subResource("form",He),this.order=new Oe(this.injector,this.path,"order")}parameterised(de){return this.halResourceService.get(this.path,de)}patch(de,ae){return de instanceof ve.P&&ae&&(this.queryFilters.mapSchemasIntoFilters(de,ae),de=P.u.extractPayloadFromSchema(de,ae.schema)),this.halResourceService.patch(this.path,de)}delete(){return this.halResourceService.delete(this.path)}paginated(de){return this.parameterised(de)}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",tt.r)],st.prototype,"queryFilters",void 0);class Me extends i.ZQ{constructor(de,ae){super(de,ae,"queries",st),this.apiRoot=de,this.basePath=ae,this.form=this.subResource("form",He),this.default=this.subResource("default"),this.filter_instance_schemas=new i.ZQ(this.apiRoot,this.path,"filter_instance_schemas")}list(de){return this.halResourceService.get(this.path+(0,r.g)(de))}find(de,ae,pe){let H;return H=ae?this.apiRoot.queries.id(ae).toString():this.apiRoot.withOptionalProject(pe).queries.default.toString(),this.halResourceService.get(H,de)}parameterised(de){return this.halResourceService.get(this.default.path,de)}post(de,ae){return de instanceof ve.P&&ae&&(this.queryFilters.mapSchemasIntoFilters(de,ae),de=P.u.extractPayloadFromSchema(de,ae.schema)),this.halResourceService.post(this.apiRoot.queries.path,de)}toggleStarred(de){return de.starred?de.unstar():de.star()}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",tt.r)],Me.prototype,"queryFilters",void 0);var ce=t(30400);class J extends i.ZQ{constructor(de,ae){super(de,ae,"relations"),this.apiRoot=de,this.basePath=ae}get(){return this.halResourceService.get(this.path)}loadInvolved(de){const ae=_.filter(de,pe=>/\d+/.test(pe));return 0===ae.length?(0,ce.D)([]):this.filtered((0,V.PQ)("involved","=",ae)).getPaginatedResults()}}class W extends b.f{forTypePayload(de){de._links.type&&de._links.type;return this.post(de)}forPayload(de){return this.post(de)}}class Y extends y{constructor(){super(...arguments),this.relations=this.subResource("relations",J),this.revisions=this.subResource("revisions"),this.activities=this.subResource("activities"),this.available_watchers=this.subResource("available_watchers"),this.available_projects=this.subResource("available_projects"),this.github_pull_requests=this.subResource("github_pull_requests"),this.form=this.subResource("form",W)}createCache(){return this.parent.cache}}var $=t(14808),be=t(3352),N=t(84699),Ue=t(2316);class et extends R.r{constructor(de,ae){super(ae),this.injector=de}updateValue(de,ae){return this.schemaCacheService.ensureLoaded(ae).then(()=>(this.putValue(de,ae),ae))}updateWorkPackage(de,ae=!1){return ae||(0,N.Z)(de)?super.updateValue(de.id,de):this.updateValue(de.id,de)}updateWorkPackageList(de,ae=!0){de.forEach(pe=>{const H=pe,he=H.id,ue=this.multiState.get(he);(0,N.Z)(H)?ue.putValue(H):this.schemaCacheService.ensureLoaded(H).then(()=>{ae&&ue.hasValue()&&_.isEqual(ue.value.$source,H.$source)?(0,be.qu)("Skipping identical work package from updating"):ue.putValue(H)})})}}et.\u0275fac=function(de){return new(de||et)(Ue.LFG(Ue.zs3),Ue.LFG($.J$))},et.\u0275prov=Ue.Yz7({token:et,factory:et.\u0275fac}),(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",O.y)],et.prototype,"schemaCacheService",void 0);class Ke extends i.f2{get(){return this.halResourceService.get(this.path).pipe((0,k.b)(de=>de.schemas&&this.updateSchemas(de.schemas)),(0,k.b)(de=>this.cache.updateWorkPackageList(de.elements)),(0,p.q)(1))}get cache(){return this.parent.cache}updateSchemas(de){de.elements.forEach(ae=>{this.states.schemas.get(ae.href).putValue(ae)})}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",m.G)],Ke.prototype,"states",void 0);class _e extends S{constructor(de,ae){super(de,ae,"work_packages",Y),this.apiRoot=de,this.basePath=ae,this.form=this.subResource("form",W),this.available_projects=this.subResource("available_projects")}requireAll(de){return 0===de.length?Promise.resolve():new Promise((ae,pe)=>{this.loadCollectionsFor(_.uniq(de)).then(H=>{_.each(H,he=>{he.schemas&&_.each(he.schemas.elements,ue=>{this.states.schemas.get(ue.href).putValue(ue)}),he.elements&&this.cache.updateWorkPackageList(he.elements)}),ae(void 0)},pe)})}post(de){return this.halResourceService.post(this.path,de).pipe(this.cacheResponse())}filtered(de,ae={}){return super.filtered(de,ae,Ke)}filterByTypeaheadOrId(de,ae=!1,pe={}){const H=new V.qM;ae?H.add("id","=",[de]):H.add("typeahead","**",[de]);const he=Object.assign({sortBy:'[["updatedAt","desc"]]',offset:"1",pageSize:"10"},pe);return this.filtered(H,he)}filterUpdatedSince(de,ae){const pe=(new V.qM).add("id","=",de.filter(he=>he)).add("updatedAt","<>d",[ae,""]);return this.filtered(pe,{offset:"1",pageSize:"10"})}loadCollectionsFor(de){return this.halResourceService.getAllPaginated(this.path,{filters:(0,V.PQ)("id","=",de).toJson()}).toPromise()}createCache(){return new et(this.injector,this.states.workPackages)}}class ye extends y{patch(de){return this.halResourceService.patch(this.path,de).pipe((0,k.b)(ae=>this.touch(ae)))}createCache(){return new R.r(this.states.versions)}}class Pe extends i.ZQ{constructor(de,ae){super(de,ae,"versions",ye),this.apiRoot=de,this.basePath=ae,this.form=this.subResource("form",b.f),this.available_projects=this.subResource("available_projects",K)}get(){return this.halResourceService.get(this.path)}post(de){return this.halResourceService.post(this.path,de)}}class Ee extends Se.J{constructor(de,ae){super(ae,"copy"),this.apiRoot=de,this.basePath=ae,this.form=new b.f(this.apiRoot,this.path,"form")}}class Qe extends y{constructor(){super(...arguments),this.available_assignees=this.subResource("available_assignees"),this.queries=new Me(this.apiRoot,this.path),this.types=new fe(this.apiRoot,this.path),this.work_packages=new _e(this.apiRoot,this.path),this.versions=new Pe(this.apiRoot,this.path),this.copy=new Ee(this.apiRoot,this.path)}createCache(){return this.parent.cache}}class nt extends R.r{constructor(de,ae){super(ae),this.injector=de}updateValue(de,ae){return this.schemaCacheService.ensureLoaded(ae).then(()=>(this.putValue(de,ae),ae))}}nt.\u0275fac=function(de){return new(de||nt)(Ue.LFG(Ue.zs3),Ue.LFG($.J$))},nt.\u0275prov=Ue.Yz7({token:nt,factory:nt.\u0275fac}),(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",O.y)],nt.prototype,"schemaCacheService",void 0);class ct extends S{constructor(de,ae){super(de,ae,"projects",Qe),this.apiRoot=de,this.basePath=ae,this.schema=this.subResource("schema")}list(de){return this.halResourceService.get(this.path+(0,r.g)(de)).pipe(this.cacheResponse())}createCache(){return new nt(this.injector,this.states.projects)}}class lt extends y{createCache(){return new R.r(this.states.statuses)}}class Ne extends i.ZQ{constructor(de,ae){super(de,ae,"statuses",lt),this.apiRoot=de,this.basePath=ae}get(){return this.halResourceService.get(this.path).pipe((0,k.b)(de=>{de.elements.forEach((ae,pe)=>{this.id(ae.id).cache.updateValue(ae.id,ae)})}))}}class Ae extends y{createCache(){return new R.r(this.states.roles)}}class xe extends i.ZQ{constructor(de,ae){super(de,ae,"roles",Ae),this.apiRoot=de,this.basePath=ae}get(){return this.halResourceService.get(this.path).pipe((0,k.b)(de=>{de.elements.forEach((ae,pe)=>{this.id(ae.id).cache.updateValue(ae.id,ae)})}))}}class Ye extends i.ZQ{constructor(de,ae){super(de,ae,"news"),this.apiRoot=de,this.basePath=ae}list(de){return this.halResourceService.get(this.path+(0,r.g)(de))}}class mt extends i.ZQ{constructor(de,ae){super(de,ae,"help_texts"),this.apiRoot=de,this.basePath=ae}get(){return this.halResourceService.get(this.path)}}class Ot extends i.f2{constructor(de,ae){super(de,ae,"configuration"),this.apiRoot=de,this.basePath=ae}get(){return this.$configuration?this.$configuration:this.$configuration=this.halResourceService.get(this.path).pipe((0,f.d)())}}class Pt{constructor(de){this.grid=de}get id(){return this.grid.id}get name(){return this.grid.name}get editable(){return!!this.grid.updateImmediately}get isFree(){return!this.isAction}get isAction(){return"action"===this.grid.options.type}get actionAttribute(){if(!this.isFree)return this.grid.options.attribute}set highlightingMode(de){this.grid.options.highlightingMode=de}get highlightingMode(){return this.grid.options.highlightingMode||"none"}set name(de){this.grid.name=de}addQuery(de){de.isNewWidget=!0,this.grid.widgets.push(de)}removeQuery(de){this.grid.widgets=this.grid.widgets.filter(ae=>ae.options.queryId!==de.options.queryId)}get queries(){return this.grid.widgets}get createdAt(){return this.grid.createdAt}get filters(){return this.grid.options.filters||[]}set filters(de){this.grid.options.filters=de}sortWidgets(){this.grid.widgets=this.grid.widgets.sort((de,ae)=>de.startColumn-ae.startColumn)}showStatusButton(){return"status"!==this.actionAttribute}}var Mt=t(7493);class yt extends y{load(){return this.apiRoot.grids.id(this.id).get().pipe((0,Q.U)(de=>{const ae=new Pt(de);return ae.sortWidgets(),ae}))}save(de){return this.fetchSchema(de).pipe((0,C.w)(ae=>this.apiRoot.grids.id(de.grid).patch(de.grid,ae)),(0,Q.U)(ae=>(de.grid=ae,de.sortWidgets(),de)),this.cacheResponse())}delete(){return this.apiRoot.grids.id(this.id).delete().pipe((0,k.b)(()=>this.cache.clearSome(this.id.toString())))}fetchSchema(de){return this.apiRoot.grids.id(de.grid).form.post({}).pipe((0,Q.U)(ae=>ae.schema))}createCache(){return this.parent.cache}}class jt extends S{constructor(de,ae){super(de,ae,"grids",yt),this.apiRoot=de,this.basePath=ae}list(de){return this.halResourceService.get(this.path+(0,r.g)(de)).pipe((0,k.b)(ae=>this.authorisationService.initModelAuth("boards",ae.$links)),(0,Q.U)(ae=>ae.elements.map(pe=>{const H=new Pt(pe);return H.sortWidgets(),this.touch(H),H})))}allInScope(de){const ae=this.boardPath(de);return this.list({filters:[["scope","=",[ae]]]})}create(de,ae,pe,H){const he=this.boardPath(pe);return this.createGrid(de,ae,he,H).pipe((0,Q.U)(ue=>new Pt(ue)))}boardPath(de){return this.PathHelper.projectBoardsPath(de)}createCache(){const de=this.states.forType("boards");return new R.r(de)}createGrid(de,ae,pe,H){const he=_.set({name:ae},"_links.scope.href",pe);return he.options={type:de},H&&(he.options.attribute=H),this.apiRoot.grids.form.post(he).pipe((0,C.w)(ue=>this.apiRoot.grids.post(ue.payload.$source)))}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",Mt.g)],jt.prototype,"authorisationService",void 0),(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",e.j)],jt.prototype,"PathHelper",void 0);class Jt extends i.f2{patch(de){return this.halResourceService.patch(this.path,{name:de.name})}delete(){return this.halResourceService.delete(this.path)}}class Ft extends i.ZQ{constructor(de,ae){super(de,ae,"placeholder_users",Jt),this.apiRoot=de,this.basePath=ae}list(de){return this.halResourceService.get(this.path+(0,r.g)(de))}post(de){return this.halResourceService.post(this.path,de)}}class It extends i.f2{patch(de){return this.halResourceService.patch(this.path,{name:de.name})}delete(){return this.halResourceService.delete(this.path)}}class gt extends i.ZQ{constructor(de,ae){super(de,ae,"groups",It),this.apiRoot=de,this.basePath=ae}list(de){return this.halResourceService.get(this.path+(0,r.g)(de))}post(de){return this.halResourceService.post(this.path,de)}}class kt extends i.f2{markRead(){return this.http.post(`${this.path}/read_ian`,{},{withCredentials:!0,responseType:"json"})}markUnread(){return this.http.post(`${this.path}/unread_ian`,{},{withCredentials:!0,responseType:"json"})}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",te.eN)],kt.prototype,"http",void 0);class ti extends i.ZQ{constructor(de,ae){super(de,ae,"notifications",kt),this.apiRoot=de,this.basePath=ae}facet(de,ae){return"unread"===de?this.unread(ae):this.list(ae)}list(de){return this.http.get(this.path+(0,r.g)(de))}listPath(de){return this.path+(0,r.g)(de)}unread(de){const pe=[...(null==de?void 0:de.filters)?de.filters:[],["readIAN","=",!1]],H=Object.assign(Object.assign({},de),{filters:pe});return this.list(H)}markRead(de){return this.http.post(`${this.path}/read_ian${(0,r.g)({filters:[["id","=",de.map(ae=>ae.toString())]]})}`,{},{withCredentials:!0,responseType:"json"})}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",te.eN)],ti.prototype,"http",void 0);class ii extends i.ZQ{constructor(de,ae){super(de,ae,"views"),this.apiRoot=de,this.basePath=ae}post(de,ae){return this.http.post(`${this.path}/${ae}`,de,{withCredentials:!0,responseType:"json"}).pipe((0,Q.U)(pe=>pe))}}(0,l.gn)([(0,a.W)(),(0,l.w6)("design:type",te.eN)],ii.prototype,"http",void 0);class $t extends i.f2{constructor(de,ae){super(de,ae,"backups"),this.apiRoot=de,this.basePath=ae}post(de,ae){return this.halResourceService.post(this.path,{backupToken:de,attachments:ae})}}class vt extends i.f2{}class Ht extends i.ZQ{constructor(de,ae){super(de,ae,"days",vt),this.apiRoot=de,this.basePath=ae,this.week=new i.f2(this.apiRoot,this.path,"week",this)}}class Wt{constructor(de,ae){this.injector=de,this.pathHelper=ae,this.attachments=this.apiV3CollectionEndpoint("attachments"),this.backups=this.apiV3CustomEndpoint($t),this.configuration=this.apiV3CustomEndpoint(Ot),this.days=this.apiV3CustomEndpoint(Ht),this.documents=this.apiV3CollectionEndpoint("documents"),this.notifications=this.apiV3CustomEndpoint(ti),this.grids=this.apiV3CustomEndpoint(n),this.principals=this.apiV3CollectionEndpoint("principals"),this.root=this.apiV3SingularEndpoint(""),this.statuses=this.apiV3CustomEndpoint(Ne),this.relations=this.apiV3CustomEndpoint(J),this.priorities=this.apiV3CollectionEndpoint("priorities"),this.time_entries=this.apiV3CustomEndpoint(L),this.actions=this.apiV3CollectionEndpoint("actions"),this.capabilities=this.apiV3CustomEndpoint(G),this.memberships=this.apiV3CustomEndpoint(se),this.news=this.apiV3CustomEndpoint(Ye),this.types=this.apiV3CustomEndpoint(fe),this.versions=this.apiV3CustomEndpoint(Pe),this.work_packages=this.apiV3CustomEndpoint(_e),this.queries=this.apiV3CustomEndpoint(Me),this.projects=this.apiV3CustomEndpoint(ct),this.users=this.apiV3CustomEndpoint(oe),this.placeholder_users=this.apiV3CustomEndpoint(Ft),this.groups=this.apiV3CustomEndpoint(gt),this.roles=this.apiV3CustomEndpoint(xe),this.help_texts=this.apiV3CustomEndpoint(mt),this.job_statuses=this.apiV3CollectionEndpoint("job_statuses"),this.views=this.apiV3CustomEndpoint(ii),this.boards=this.apiV3CustomEndpoint(jt)}withOptionalProject(de){return _.isNil(de)?this:this.projects.id(de)}collectionFromString(de){const ae=de.replace(`${this.pathHelper.api.v3.apiV3Base}/`,"");return this.apiV3CollectionEndpoint(ae)}apiV3CollectionEndpoint(de,ae){return new i.ZQ(this,this.pathHelper.api.v3.apiV3Base,de,ae)}apiV3CustomEndpoint(de){return new de(this,this.pathHelper.api.v3.apiV3Base)}apiV3SingularEndpoint(de){return new i.f2(this,this.pathHelper.api.v3.apiV3Base,de)}}Wt.\u0275fac=function(de){return new(de||Wt)(Ue.LFG(Ue.zs3),Ue.LFG(e.j))},Wt.\u0275prov=Ue.Yz7({token:Wt,factory:Wt.\u0275fac,providedIn:"root"})},79175:(X,I,t)=>{"use strict";t.d(I,{r:()=>n});var i=t(53466),e=t(91992),d=t(1143),h=t(77763),r=t(33927);class n{constructor(a,m=3600){this.multiState=a,this.cacheDurationInMs=1e3*m}state(a){return this.multiState.get(a)}touch(a){const m=this.multiState.get(a);m.putValue(m.value,"Touching the state")}current(a,m){return this.state(a).getValueOr(m)}clearAndLoad(a,m){const v=m.pipe((0,i.q)(1),(0,e.B)());return this.multiState.get(a).clearAndPutFromPromise(v.toPromise()),v}updateValue(a,m){return this.putValue(a,m),Promise.resolve(m)}updateFor(a){return this.updateValue(a.id,a)}observe(a){return this.state(a).values$()}changes$(a){return this.state(a).changes$()}observeAll(){return this.multiState.observeChange().pipe((0,d.O)([]),(0,h.e)(250),(0,r.U)(()=>{const a=[];return _.each(this.multiState.getValueOr({}),m=>{m.value&&a.push(m.value)}),a}))}clearSome(...a){a.forEach(m=>this.multiState.get(m).clear())}stale(a){const m=this.multiState.get(a);return!m.hasActivePromiseRequest()&&(m.isPristine()||m.isValueOlderThan(this.cacheDurationInMs))}putValue(a,m){this.multiState.get(a).putValue(m)}}},71909:(X,I,t)=>{"use strict";t.d(I,{E:()=>h});var i=t(83498),e=t(26784),d=t(80044);class h extends i.f{static extractPayload(n,l=null){if(n instanceof d.X&&l){const a=n,m=e.u.extractPayloadFromSchema(a,l);return m.widgets&&(m.widgets=a.widgets.map(v=>({id:v.id,startRow:v.startRow,endRow:v.endRow,startColumn:v.startColumn,endColumn:v.endColumn,identifier:v.identifier,options:v.options}))),m}return n||{}}extractPayload(n,l=null){return h.extractPayload(n,l)}}},83498:(X,I,t)=>{"use strict";t.d(I,{f:()=>d});var i=t(6976),e=t(26784);class d extends i.G7{post(r={},n=null){return this.halResourceService.post(this.path,this.extractPayload(r,n))}extractPayload(r,n=null){return e.u.extractPayload(r,n)}}},90044:(X,I,t)=>{"use strict";function i(e,d,h={}){const r=new URL(e,window.location.origin);if(r.searchParams.has("filters")){const n=JSON.parse(r.searchParams.get("filters"));r.searchParams.set("filters",JSON.stringify(n.concat(d.filters)))}else r.searchParams.set("filters",d.toJson());return Object.keys(h).forEach(n=>{r.searchParams.set(n,h[n])}),r}t.d(I,{d:()=>i})},23237:(X,I,t)=>{"use strict";t.d(I,{JQ:()=>a,rP:()=>m});var i=t(85816),e=t(33927),d=t(42720),h=t(81134),r=t(80044);function a(v,c=-1){return v({pageSize:c,offset:1}).pipe((0,i.zg)(p=>{const f=p.pageSize;if(p.total>p.count){const C=p.total-p.count,u=Math.ceil(C/f),k=new Array(u).fill(null).map((O,y)=>v({pageSize:f,offset:y+2}));return(0,d.D)(...k).pipe((0,e.U)(O=>[p,...O]))}return(0,h.of)([p])}))}function m(v,c=-1){return a(v,c).pipe((0,e.U)(p=>p.reduce((f,C)=>f.concat(function(v){var c;return v instanceof r.X?v.elements||[]:(null===(c=v._embedded)||void 0===c?void 0:c.elements)||[]}(C)),[])))}},73726:(X,I,t)=>{"use strict";t.d(I,{g:()=>e});var i=t(26269);function e(d){const h=[];if(d&&d.sortBy&&h.push(`sortBy=${JSON.stringify(d.sortBy)}`),d&&d.groupBy&&h.push(`groupBy=${d.groupBy}`),d&&void 0!==d.pageSize&&h.push(`pageSize=${d.pageSize}`),d&&void 0!==d.offset&&h.push(`offset=${d.offset}`),d&&void 0!==d.select&&h.push(`select=${d.select.join(",")}`),d&&d.filters){const n=new i.qM;d.filters.forEach(l=>{n.add(...l)}),h.push(n.toParams())}let r="";return h.length&&(r=`?${h.join("&")}`),r}},6976:(X,I,t)=>{"use strict";t.d(I,{G7:()=>a,f2:()=>m,ZQ:()=>c});var i=t(3786),e=t(49152),d=t(29161),h=t(91923),r=t(23237),n=t(53882),l=t(90044);class a extends e.J{constructor(f,C,u,k){super(C,u),this.apiRoot=f,this.basePath=C,this.id=u,this.parent=k,this.injector=this.apiRoot.injector}subResource(f,C=m){return new C(this.apiRoot,this.path,f,this)}}(0,i.gn)([(0,d.W)(),(0,i.w6)("design:type",h.u)],a.prototype,"halResourceService",void 0);class m extends a{get(){return this.halResourceService.get(this.path)}}class v extends m{getPaginatedResults(){return(0,r.rP)(f=>this.halResourceService.request("get",this.path,f),-1)}}class c extends e.D{constructor(f,C,u,k){super(C,u,k),this.apiRoot=f,this.basePath=C,this.resource=k,this.injector=this.apiRoot.injector}id(f){let C;return C="string"==typeof f||"number"==typeof f?f.toString():f.id,new(this.resource||m)(this.apiRoot,this.path,C,this)}withOptionalId(f){return _.isNil(f)?this:this.id(f)}toString(){return this.path}toPath(){return this.path}filtered(f,C={},u){const k=(0,l.d)(this.path,f,C);return new(u||v)(this.apiRoot,k.pathname,k.search,this)}signalled(f,C,u={}){const k=(0,l.d)(this.path,f,Object.assign(Object.assign({},u),{select:C.join(",")}));return this.http.get(k.toString())}subResource(f,C=m){return new C(this.apiRoot,this.path,f,this)}}(0,i.gn)([(0,d.W)(),(0,i.w6)("design:type",n.eN)],c.prototype,"http",void 0),(0,i.gn)([(0,d.W)(),(0,i.w6)("design:type",h.u)],c.prototype,"halResourceService",void 0)},49152:(X,I,t)=>{"use strict";t.d(I,{D:()=>i,J:()=>e});class i{constructor(h,r,n){this.basePath=h,this.segment=r,this.resource=n,this.path=`${this.basePath}/${r}`}id(h){return new(this.resource||e)(this.path,h)}withOptionalId(h){return _.isNil(h)?this:this.id(h)}toString(){return this.path}toPath(){return this.path}}class e{constructor(h,r){this.basePath=h,this.segment=r;const n=r.toString().startsWith("?")?"":"/";this.path=`${this.basePath}${n}${r}`}toString(){return this.path}toPath(){return this.path}}},1056:(X,I,t)=>{"use strict";t.d(I,{o:()=>d});var i=t(54364),e=t(2316);class d{constructor(r){this.documentElement=r}get isMobile(){return this.hasBodyClass("-browser-mobile")}get isEdge(){return this.hasBodyClass("-browser-edge")}hasBodyClass(r){return this.documentElement.body.classList.contains(r)}}d.\u0275fac=function(r){return new(r||d)(e.LFG(i.K0))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})},53916:(X,I,t)=>{"use strict";t.d(I,{U:()=>e});var i=t(2316);class e{constructor(){this.mobileWidthTreshold=680}get isMobile(){return window.innerWidth<this.mobileWidthTreshold}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},12877:(X,I,t)=>{"use strict";t.d(I,{e:()=>l});var i=t(96617),e=t(2281),h=t(61908),r=t(52377),n=t(2316);class l{constructor(m,v,c){this.I18n=m,this.apiV3Service=v,this.weekdayService=c,this.initialized=Promise.all([this.loadConfiguration(),this.weekdayService.loadWeekdays().toPromise()]).then(()=>!0).catch(()=>!1)}commentsSortedInDescendingOrder(){return this.userPreference("commentSortDescending")}warnOnLeavingUnsaved(){return this.userPreference("warnOnLeavingUnsaved")}autoHidePopups(){return this.userPreference("autoHidePopups")}isTimezoneSet(){return!!this.timezone()}timezone(){return this.userPreference("timeZone")}isDirectUploads(){return!!this.prepareAttachmentURL}get prepareAttachmentURL(){return _.get(this.configuration,["prepareAttachment","href"])}get maximumAttachmentFileSize(){return this.systemPreference("maximumAttachmentFileSize")}get perPageOptions(){return this.systemPreference("perPageOptions")}dateFormatPresent(){return!!this.systemPreference("dateFormat")}dateFormat(){return this.systemPreference("dateFormat")}timeFormatPresent(){return!!this.systemPreference("timeFormat")}timeFormat(){return this.systemPreference("timeFormat")}startOfWeekPresent(){return!!this.systemPreference("startOfWeek")}startOfWeek(){return this.startOfWeekPresent()?this.systemPreference("startOfWeek"):e.localeData(I18n.locale).firstDayOfWeek()}get hostName(){return this.systemPreference("hostName")}loadConfiguration(){return this.apiV3Service.configuration.get().toPromise().then(m=>{this.configuration=m})}userPreference(m){return _.get(this.configuration,["userPreferences",m])}systemPreference(m){return _.get(this.configuration,m)}}l.\u0275fac=function(m){return new(m||l)(n.LFG(i.D),n.LFG(h.T),n.LFG(r.u))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})},65146:(X,I,t)=>{"use strict";t.d(I,{R:()=>h});var i=t(70233),e=t(61908),d=t(2316);class h{constructor(n,l){this.PathHelper=n,this.apiV3Service=l,this.detect()}get inProjectContext(){return void 0!==this.current}get path(){return this.current?this.PathHelper.projectPath(this.current.identifier):null}get apiv3Path(){return this.current?this.apiV3Service.projects.id(this.current.id).toString():null}get id(){return this.getCurrent("id")}get name(){return this.getCurrent("name")}get identifier(){return this.getCurrent("identifier")}getCurrent(n){return this.current&&this.current[n]?this.current[n].toString():null}detect(){const n=document.querySelector("meta[name=current_project]");n&&(this.current={id:n.dataset.projectId,name:n.dataset.projectName,identifier:n.dataset.projectIdentifier})}}h.\u0275fac=function(n){return new(n||h)(d.LFG(i.j),d.LFG(e.T))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},37991:(X,I,t)=>{"use strict";t.d(I,{H:()=>l});var i=t(96905),e=t(52657),d=t(4678),h=t(53466),r=t(2316);class l{constructor(m){!function(a){const m=a.get(i.S);window.ErrorReporter.addHook(()=>m.user$.pipe((0,h.q)(1)).toPromise().then(({id:c})=>({user:c||"anon"})));const v=document.querySelectorAll("meta[name=current_user]")[0];m.setUser({id:(null==v?void 0:v.dataset.id)||null,name:(null==v?void 0:v.dataset.name)||null,mail:(null==v?void 0:v.dataset.mail)||null})}(m)}}l.\u0275fac=function(m){return new(m||l)(r.LFG(r.zs3))},l.\u0275mod=r.oAB({type:l}),l.\u0275inj=r.cJS({providers:[i.S,e.D,d.b]})},4678:(X,I,t)=>{"use strict";t.d(I,{b:()=>h});var i=t(19100),e=t(52657),d=t(2316);class h extends i.AE{constructor(n){super(n),this.store=n,this.isLoggedIn$=this.select(l=>!!l.id),this.user$=this.select(({id:l,name:a,mail:m})=>({id:l,name:a,mail:m}))}}h.\u0275fac=function(n){return new(n||h)(d.LFG(e.D))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},96905:(X,I,t)=>{"use strict";t.d(I,{S:()=>c});var i=t(61908),e=t(52657),d=t(4678),h=t(41599),r=t(33927),n=t(79902),l=t(83720),a=t(9170),m=t(53466),v=t(2316);class c{constructor(f,C,u,k){this.apiV3Service=f,this.currentUserStore=C,this.currentUserQuery=u,this.capabilitiesService=k,this.isLoggedIn$=this.currentUserQuery.isLoggedIn$,this.user$=this.currentUserQuery.user$,this._isLoggedIn=!1,this._user={id:null,name:null,mail:null},this.setupLegacyDataListeners()}setUser(f){this.currentUserStore.update(C=>Object.assign(Object.assign({},C),f))}capabilities$(f=[],C=null){return this.principalFilter$().pipe((0,r.U)(u=>{const k=[u];return C&&k.push(["context","=",["global"===C?"g":`p${C}`]]),f.length>0&&k.push(["action","=",f]),{filters:k,pageSize:-1}}),(0,n.w)(u=>this.capabilitiesService.require$(u)))}hasCapabilities$(f,C="global"){const u=_.castArray(f);return this.capabilities$(u,C).pipe((0,r.U)(k=>u.reduce((O,y)=>O&&!!k.find(b=>b._links.action.href.endsWith(`/api/v3/actions/${y}`)),k.length>0)),(0,l.x)())}hasAnyCapabilityOf$(f,C="global"){const u=_.castArray(f);return this.capabilities$(u,C).pipe((0,r.U)(k=>k.reduce((O,y)=>O||!!u.find(b=>y._links.action.href.endsWith(`/api/v3/actions/${b}`)),!1)),(0,l.x)())}principalFilter$(){return this.user$.pipe((0,a.h)(f=>!!f.id),(0,m.q)(1),(0,r.U)(f=>["principal","=",[f.id]]))}setupLegacyDataListeners(){this.currentUserQuery.user$.subscribe(f=>this._user=f),this.currentUserQuery.isLoggedIn$.subscribe(f=>this._isLoggedIn=f)}get isLoggedIn(){return this._isLoggedIn}get userId(){return this._user.id||""}get name(){return this._user.name||""}get mail(){return this._user.mail||""}get href(){return`/api/v3/users/${this.userId}`}get language(){return I18n.locale||"en"}}c.\u0275fac=function(f){return new(f||c)(v.LFG(i.T),v.LFG(e.D),v.LFG(d.b),v.LFG(h.a))},c.\u0275prov=v.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"})},52657:(X,I,t)=>{"use strict";t.d(I,{D:()=>r});var i=t(3786),e=t(19100),d=t(2316);let r=class extends e.yh{constructor(){super({id:null,name:null,mail:null})}};r.\u0275fac=function(l){return new(l||r)},r.\u0275prov=d.Yz7({token:r,factory:r.\u0275fac}),r=(0,i.gn)([(0,e.yC)({name:"current-user"}),(0,i.w6)("design:paramtypes",[])],r)},70692:(X,I,t)=>{"use strict";t.d(I,{B:()=>n});var i=t(12877),e=t(96617),d=t(86035),r=t(2316);class n{constructor(a,m){this.configurationService=a,this.I18n=m,this.setupLocale()}setupLocale(){d.locale(I18n.locale)}parseDatetime(a,m){const v=d.utc(a,m);return this.configurationService.isTimezoneSet()&&(v.local(),v.tz(this.configurationService.timezone())),v}parseDate(a,m){return d(a,m)}parseISODatetime(a){return this.parseDatetime(a,"YYYY-MM-DDTHH:mm:ssZ")}parseISODate(a){return this.parseDate(a,"YYYY-MM-DD")}formattedDate(a){return this.parseDate(a).format(this.getDateFormat())}daysFromToday(a){const m=this.parseDate(a),v=d().startOf("day");return m.diff(v,"days")}formattedTime(a){return this.parseDatetime(a).format(this.getTimeFormat())}formattedDatetime(a){const m=this.formattedDatetimeComponents(a);return`${m[0]} ${m[1]}`}formattedRelativeDateTime(a){return this.parseDatetime(a).fromNow()}formattedDatetimeComponents(a){const m=this.parseDatetime(a);return[m.format(this.getDateFormat()),m.format(this.getTimeFormat())]}toHours(a){return Number(d.duration(a).asHours().toFixed(2))}toDays(a){return Number(d.duration(a).asDays().toFixed(2))}toISODuration(a,m){return d.duration(a,m).toIsoString()}formattedDuration(a,m="hour"){switch(m){case"hour":return this.I18n.t("js.units.hour",{count:this.toHours(a)});case"days":return this.I18n.t("js.units.day",{count:this.toDays(a)});default:return""}}formattedISODate(a){return this.parseDate(a).format("YYYY-MM-DD")}formattedISODateTime(a){return a.format()}isValidISODate(a){return this.isValid(a,"YYYY-MM-DD")}isValidISODateTime(a){return this.isValid(a,"YYYY-MM-DDTHH:mm:ssZ")}isValid(a,m){const v=m||this.getDateFormat();return d(a,[v],!0).isValid()}getDateFormat(){return this.configurationService.dateFormatPresent()?this.configurationService.dateFormat():"L"}getTimeFormat(){return this.configurationService.timeFormatPresent()?this.configurationService.timeFormat():"LT"}}n.\u0275fac=function(a){return new(a||n)(r.LFG(i.e),r.LFG(e.D))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})},52377:(X,I,t)=>{"use strict";t.d(I,{u:()=>v});var i=t(3786),e=t(2281),h=t(53466),r=t(98636),n=t(29161),l=t(46934),a=t(81134),m=t(2316);class v{constructor(p){this.injector=p}isNonWorkingDay(p){const f="number"==typeof p?p:e(p).isoWeekday();return!!this.weekdays.find(C=>C.day===f&&!C.working)}loadWeekdays(){return this.weekdays?(0,a.of)(this.weekdays):this.weekdaysService.require().pipe((0,h.q)(1),(0,r.b)(p=>{this.weekdays=p}))}}v.\u0275fac=function(p){return new(p||v)(m.LFG(m.zs3))},v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),(0,i.gn)([(0,n.W)(),(0,i.w6)("design:type",l.s)],v.prototype,"weekdaysService",void 0)},73881:(X,I,t)=>{"use strict";t.d(I,{j:()=>h});var i=t(54364),e=t(27779),d=t(2316);class h{constructor(n){this.documentElement=n,this._banners=!0,this._banners=n.body.classList.contains("ee-banners-visible")}get eeShowBanners(){return this._banners}getEnterPriseEditionUrl({referrer:n,hash:l}={}){const a=new URL(e.Mg);return n&&a.searchParams.set("op_referrer",n),l&&(a.hash=l),a.toString()}conditional(n,l){this._banners?this.callMaybe(n):this.callMaybe(l)}callMaybe(n){n&&n()}}h.\u0275fac=function(n){return new(n||h)(d.LFG(i.K0))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},48249:(X,I,t)=>{"use strict";t.d(I,{c:()=>p});var i=t(3786),e=t(53882),d=t(30400),h=t(81134),r=t(79902),n=t(91992),l=t(22464),m=t(76825),v=t(18869),c=t(2316);class p extends m.r{uploadSingle(C,u,k="post",O="text"){return[u,(0,d.D)(this.getDirectUploadFormFrom(C,u)).pipe((0,r.w)(this.uploadToExternal(u,k,O)),(0,n.B)())]}uploadToExternal(C,u,k){return O=>(O.form.append("file",C,C.customName||C.name),this.http.request(u,O.url,{body:O.form,observe:"events",headers:{[v.i]:"true"},responseType:k,reportProgress:!0}).pipe((0,r.w)(this.finishUpload(O))))}finishUpload(C){return u=>{var k,O,y;return u instanceof e.Zn?this.http.get(null===(y=null===(O=null===(k=C.response)||void 0===k?void 0:k._links)||void 0===O?void 0:O.completeUpload)||void 0===y?void 0:y.href,{observe:"response"}):(0,h.of)(u)}}getDirectUploadFormFrom(C,u){return(0,i.mG)(this,void 0,void 0,function*(){const k=u.customName||u.name,O=u.type||k&&(0,l.getType)(k)||"",y=new FormData,b={fileName:k,contentType:O,description:u.description,fileSize:u.size};y.append("metadata",JSON.stringify(b));const P=yield this.http.request("post",C,{body:y,withCredentials:!0,responseType:"json"}).toPromise(),E=new FormData;return _.each(P._links.addAttachment.form_fields,(T,M)=>{E.append(M,T)}),{form:E,url:P._links.addAttachment.href,response:P}})}}p.\u0275fac=function(){let f;return function(u){return(f||(f=c.n5z(p)))(u||p)}}(),p.\u0275prov=c.Yz7({token:p,factory:p.\u0275fac})},76825:(X,I,t)=>{"use strict";t.d(I,{r:()=>l});var i=t(53882),e=t(91992),d=t(9170),h=t(33927),r=t(91923),n=t(2316);class l{constructor(m,v){this.http=m,this.halResource=v}uploadAndMapResponse(m,v,c="post"){const{uploads:p,finished:f}=this.upload(m,v);return{uploads:p,finished:f.then(u=>u.map(k=>({response:k,uploadUrl:k.staticDownloadLocation.href})))}}upload(m,v,c="post"){v=_.filter(v,C=>"directory"!==C.type);const p=_.map(v,C=>this.uploadSingle(m,C,c));return{uploads:p,finished:this.whenFinished(p)}}uploadSingle(m,v,c="post",p="json"){const f=new FormData,C={description:v.description,fileName:v.customName||v.name};f.append("metadata",JSON.stringify(C)),f.append("file",v,C.fileName);return[v,this.http.request(c,m,{body:f,observe:"events",withCredentials:!0,responseType:p,reportProgress:!0}).pipe((0,e.B)())]}whenFinished(m){const v=m.map(([c,p])=>p.pipe((0,d.h)(f=>f.type===i.dt.Response),(0,h.U)(f=>this.halResource.createHalResource(f.body))).toPromise());return Promise.all(v)}}l.\u0275fac=function(m){return new(m||l)(n.LFG(i.eN),n.LFG(r.u))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac})},84032:(X,I,t)=>{"use strict";t.d(I,{U:()=>e});var i=t(2316);class e{get(...h){return _.get(window.gon,h,null)}get gon(){return window.gon}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},57810:(X,I,t)=>{"use strict";t.d(I,{V:()=>h});var i=t(2316),e=t(71570);const d=" | ";class h{constructor(n){this.titleService=n}get current(){return this.titleService.getTitle()}get titleParts(){return this.current.split(d)}setFirstPart(n){const l=this.titleParts;l[0]=n,this.titleService.setTitle(l.join(d))}prependFirstPart(n){const l=this.titleParts;l.unshift(n),this.titleService.setTitle(l.join(d))}}h.\u0275fac=function(n){return new(n||h)(i.LFG(e.Dx))},h.\u0275prov=i.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},96617:(X,I,t)=>{"use strict";t.d(I,{D:()=>e});var i=t(2316);class e{constructor(){this.i18n=window.I18n,this.t=this.i18n.t.bind(this.i18n),this.lookup=this.i18n.lookup.bind(this.i18n),this.toTime=this.i18n.toTime.bind(this.i18n),this.toNumber=this.i18n.toNumber.bind(this.i18n),this.toPercentage=this.i18n.toPercentage.bind(this.i18n),this.toCurrency=this.i18n.toCurrency.bind(this.i18n),this.strftime=this.i18n.strftime.bind(this.i18n),this.toHumanSize=this.i18n.toHumanSize.bind(this.i18n)}get locale(){return this.i18n.locale}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},86469:(X,I,t)=>{"use strict";t.d(I,{xc:()=>r,RA:()=>n,vt:()=>a});var i=t(98636),e=t(2316);function r(m,v){return c=>(m.start(),c.pipe((0,i.b)(()=>m.delayedStop(v),()=>m.stop(),()=>m.stop())))}function n(m){return v=>(setTimeout(()=>m().start()),v.pipe((0,i.b)(()=>{},()=>m().stop(),()=>m().stop())))}class l{constructor(v){this.indicator=v,this.indicatorTemplate='<div class="loading-indicator--background">\n      <div class="loading-indicator">\n        <div class="block-1"></div>\n        <div class="block-2"></div>\n        <div class="block-3"></div>\n        <div class="block-4"></div>\n        <div class="block-5"></div>\n      </div>\n    </div>\n   '}set promise(v){this.start();const c=()=>this.delayedStop();v.then(c).catch(c)}start(){this.stop(),this.indicator.prepend(this.indicatorTemplate)}delayedStop(v=25){setTimeout(()=>this.stop(),v)}stop(){this.indicator.find(".loading-indicator--background").remove()}}class a{get table(){return this.indicator("table")}get wpDetails(){return this.indicator("wpDetails")}get modal(){return this.indicator("modal")}getter(v){return this.indicator.bind(this,v)}indicator(v){return"string"==typeof v&&(v=this.getIndicatorAt(v)),new l(v)}getIndicatorAt(v){return jQuery(".loading-indicator--location").filter(`[data-indicator-name="${v}"]`)}}a.\u0275fac=function(v){return new(v||a)},a.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})},83835:(X,I,t)=>{"use strict";t.d(I,{J:()=>a});var i=t(3786),e=t(76491),d=t(96617),h=t(65146),r=t(53916),n=t(29161),l=t(2316);class a{constructor(v,c,p){this.I18n=v,this.injector=c,this.deviceService=p,this.elementMinWidth=11,this.defaultWidth=230,this.localStorageKey="openProject-mainMenuWidth",this.localStorageStateKey="openProject-mainMenuCollapsed",this.global=window,this.htmlNode=document.getElementsByTagName("html")[0],this.mainMenu=jQuery("#main-menu")[0],this.hideElements=jQuery(".can-hide-navigation"),this.titleData=new e.X(""),this.titleData$=this.titleData.asObservable(),this.changeData=new e.X({}),this.changeData$=this.changeData.asObservable()}initializeMenu(){if(!this.mainMenu)return;this.elementWidth=parseInt(window.OpenProject.guardedLocalStorage(this.localStorageKey));const v=window.OpenProject.guardedLocalStorage(this.localStorageStateKey);this.elementWidth?v&&JSON.parse(v)?this.closeMenu():this.setWidth():this.saveWidth(this.mainMenu.offsetWidth);const c=this.injector.get(h.R);(jQuery(document.body).hasClass("controller-my")&&0===this.elementWidth||null===c.id)&&this.saveWidth(this.defaultWidth),this.closeWhenOnMobile()}toggleNavigation(v){if(v&&(v.stopPropagation(),v.preventDefault()),this.showNavigation)this.closeMenu();else if(this.deviceService.isMobile)this.setWidth(window.innerWidth);else{const c=parseInt(window.OpenProject.guardedLocalStorage(this.localStorageKey)),p=c>=this.elementMinWidth?c:this.defaultWidth;this.saveWidth(p)}setTimeout(()=>{jQuery('#main-menu [class*="-menu-item"]:visible').first().focus()},500)}closeMenu(){this.setWidth(0),window.OpenProject.guardedLocalStorage(this.localStorageStateKey,"true"),jQuery(".searchable-menu--search-input").blur()}closeWhenOnMobile(){this.deviceService.isMobile&&(this.closeMenu(),window.OpenProject.guardedLocalStorage(this.localStorageStateKey,"false"))}saveWidth(v){this.setWidth(v),window.OpenProject.guardedLocalStorage(this.localStorageKey,String(this.elementWidth)),window.OpenProject.guardedLocalStorage(this.localStorageStateKey,String(0===this.elementWidth))}setWidth(v){if(void 0!==v){const p=this.deviceService.isMobile?window.innerWidth-120:window.innerWidth-520;this.elementWidth=v>p?p:v}this.snapBack(),this.setToggleTitle(),this.toggleClassHidden(),this.global.showNavigation=this.showNavigation,this.htmlNode.style.setProperty("--main-menu-width",`${this.elementWidth}px`);const c=jQuery.Event("change");this.changeData.next(c)}get showNavigation(){return this.elementWidth>=this.elementMinWidth}snapBack(){this.elementWidth<this.elementMinWidth&&(this.elementWidth=0)}setToggleTitle(){this.showNavigation?this.toggleTitle=this.I18n.t("js.label_hide_project_menu"):this.toggleTitle=this.I18n.t("js.label_expand_project_menu"),this.titleData.next(this.toggleTitle)}toggleClassHidden(){this.hideElements.toggleClass("hidden-navigation",!this.showNavigation)}}a.\u0275fac=function(v){return new(v||a)(l.LFG(d.D),l.LFG(l.zs3),l.LFG(r.U))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),(0,i.gn)([(0,n.W)(),(0,i.w6)("design:type",h.R)],a.prototype,"currentProject",void 0)},7493:(X,I,t)=>{"use strict";t.d(I,{g:()=>h});var i=t(14808),e=t(22663),d=t(2316);class h{constructor(){this.links=(0,i.qH)({})}initModelAuth(n,l){this.links.doModify(a=>{const m=Object.assign({},a);return m[n]=l,m})}observeUntil(n){return this.links.values$().pipe((0,e.R)(n))}can(n,l){const a=this.links.getValueOr({});return a[n]&&l in a[n]}cannot(n,l){return!this.can(n,l)}}h.\u0275fac=function(n){return new(n||h)},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},70233:(X,I,t)=>{"use strict";t.d(I,{j:()=>h});var i=t(26269);class e{constructor(n){this.apiV3Base=`${n}/api/v3`}get openApiSpecPath(){return`${this.apiV3Base}/spec.json`}previewMarkup(n){const l=`${this.apiV3Base}/render/markdown`;return n?`${l}?context=${n}`:l}principals(n,l){const a=new i.qM;return a.add("status","!",["3"]),a.add("member","=",[n.toString()]),a.add("type","=",["User","Group"]),a.add("id","!",["me"]),l&&l.length>0&&a.add("name","~",[l]),`${this.apiV3Base}/principals?${a.toParams({sortBy:'[["name","asc"]]',offset:"1",pageSize:"10"})}`}}var d=t(2316);class h{constructor(){this.appBasePath=window.appBasePath||"",this.api={v3:new e(this.appBasePath)}}get staticBase(){return this.appBasePath}attachmentDownloadPath(n,l){const a=`${this.staticBase}/attachments/${n}`;return l?`${a}/${l}`:a}attachmentContentPath(n){return`${this.staticBase}/attachments/${n}/content`}ifcModelsPath(n){return`${this.staticBase}/projects/${n}/ifc_models`}ifcModelsNewPath(n){return`${this.ifcModelsPath(n)}/new`}ifcModelsEditPath(n,l){return`${this.ifcModelsPath(n)}/${l}/edit`}ifcModelsDeletePath(n,l){return`${this.ifcModelsPath(n)}/${l}`}bimDetailsPath(n,l,a=null){let m=`${this.projectPath(n)}/bcf/details/${l}`;return null!==a&&(m+=`?query_props=%7B"t"%3A"id%3Adesc"%2C"dr"%3A"splitCards"%7D&viewpoint=${a}`),m}highlightingCssPath(){return`${this.staticBase}/highlighting/styles`}forumPath(n,l){return`${this.projectForumPath(n)}/${l}`}keyboardShortcutsHelpPath(){return`${this.staticBase}/help/keyboard_shortcuts`}messagePath(n){return`${this.staticBase}/topics/${n}`}myPagePath(){return`${this.staticBase}/my/page`}myNotificationsSettingsPath(){return`${this.staticBase}/my/notifications`}newsPath(n){return`${this.staticBase}/news/${n}`}notificationsPath(){return`${this.staticBase}/notifications`}loginPath(){return`${this.staticBase}/login`}projectsPath(){return`${this.staticBase}/projects`}projectsNewPath(){return`${this.staticBase}/projects/new`}projectPath(n){return`${this.projectsPath()}/${n}`}projectActivityPath(n){return`${this.projectPath(n)}/activity`}projectForumPath(n){return`${this.projectPath(n)}/forums`}projectCalendarPath(n){return`${this.projectPath(n)}/calendar`}projectMembershipsPath(n){return`${this.projectPath(n)}/members`}projectNewsPath(n){return`${this.projectPath(n)}/news`}projectTimeEntriesPath(n){return`${this.projectPath(n)}/cost_reports`}projectWikiPath(n){return`${this.projectPath(n)}/wiki`}projectWorkPackagePath(n,l){return`${this.projectWorkPackagesPath(n)}/${l}`}projectWorkPackagesPath(n){return`${this.projectPath(n)}/work_packages`}projectWorkPackageNewPath(n){return`${this.projectWorkPackagesPath(n)}/new`}projectBoardsPath(n){return n?`${this.projectPath(n)}/boards`:`${this.staticBase}/boards`}projectDashboardsPath(n){return`${this.projectPath(n)}/dashboards`}timeEntriesPath(n){const l="/time_entries";return n?this.workPackagePath(n)+l:this.staticBase+l}usersPath(){return`${this.staticBase}/users`}groupsPath(){return`${this.staticBase}/groups`}placeholderUsersPath(){return`${this.staticBase}/placeholder_users`}userPath(n){return`${this.usersPath()}/${n}`}placeholderUserPath(n){return`${this.placeholderUsersPath()}/${n}`}groupPath(n){return`${this.groupsPath()}/${n}`}rolesPath(){return`${this.staticBase}/roles`}rolePath(n){return`${this.rolesPath()}/${n}`}versionsPath(){return`${this.staticBase}/versions`}versionEditPath(n){return`${this.staticBase}/versions/${n}/edit`}versionShowPath(n){return`${this.staticBase}/versions/${n}`}workPackagesPath(){return`${this.staticBase}/work_packages`}workPackagePath(n){return`${this.staticBase}/work_packages/${n}`}workPackageCopyPath(n){return`${this.workPackagePath(n)}/copy`}workPackageDetailsCopyPath(n,l){return`${this.projectWorkPackagesPath(n)}/details/${l}/copy`}workPackagesBulkDeletePath(){return`${this.workPackagesPath()}/bulk`}textFormattingHelp(){return`${this.staticBase}/help/text_formatting`}}h.\u0275fac=function(n){return new(n||h)},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},84732:(X,I,t)=>{"use strict";t.d(I,{p:()=>e});var i=t(2316);class e{constructor(){}get isEmpty(){return!this.name}setIfFirst(h,r){!this.isEmpty||!h||(this.name=h,this.params=r)}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac})},44022:(X,I,t)=>{"use strict";t.d(I,{y:()=>m});var i=t(79175),e=t(53466),d=t(87853),h=t(81531),r=t(91923),n=t(81923),l=t(80044),a=t(2316);class m extends i.r{constructor(c,p){super(c.schemas),this.states=c,this.halResourceService=p}state(c){return super.state(this.stateKey(c))}of(c){const p=this.state(c).value;if(!p)throw new Error(`Schema for resource ${c} was expected to be loaded but isn't.`);return"WorkPackage"===c._type?n.X.create(p,c):h.V.create(p,c)}getSchemaHref(c){var p;const f=null===(p=c.$links.schema)||void 0===p?void 0:p.href;if(!f)throw new Error(`Resource ${c} has no schema to load.`);return f}ensureLoaded(c){const p=c instanceof l.X?this.getSchemaHref(c):c;return this.requireAndStream(p).pipe((0,e.q)(1)).toPromise()}requireAndStream(c,p=!1){return(this.stale(c)||p)&&this.clearAndLoad(c,this.load(c)),this.state(c).values$()}load(c){return this.halResourceService.get(c).pipe((0,e.q)(1))}loadAll(c){return Promise.all(c.map(p=>this.load(p)))}update(c,p){this.multiState.get(this.stateKey(c)).putValue(p)}stateKey(c){return c instanceof l.X?this.getSchemaHref(c):c}}m.\u0275fac=function(c){return new(c||m)(a.LFG(d.G),a.LFG(r.u))},m.\u0275prov=a.Yz7({token:m,factory:m.\u0275fac})},27779:(X,I,t)=>{"use strict";t.d(I,{Mg:()=>i,wp:()=>d,rj:()=>h});const i="https://www.openproject.org/enterprise-edition/?op_edition=community-edition",d="https://www.openproject.org/pricing",h={website:"https://www.openproject.org/enterprise-edition/",boards:"https://www.openproject.org/docs/user-guide/agile-boards/#action-boards-premium-feature",tableHighlighting:"https://www.openproject.org/docs/user-guide/work-packages/work-package-table-configuration/#attribute-highlighting-premium-feature",graphWidgets:"https://www.openproject.org/docs/user-guide/project-overview/#work-package-graph-widgets-premium-feature"}},80261:(X,I,t)=>{"use strict";t.d(I,{Z:()=>e});var i=t(3352);class e{static register(...h){this.optionalBoostrapComponents.push(...h)}static bootstrapOptionalDocument(h,r,n=this.optionalBoostrapComponents){this.performBootstrap(h,r,!1,n)}static bootstrapOptionalEmbeddable(h,r,n=this.optionalBoostrapComponents){Promise.resolve().then(()=>this.performBootstrap(h,r,!0,n))}static getEmbeddable(){return this.optionalBoostrapComponents.filter(h=>h.embeddable)}static performBootstrap(h,r,n,l){l.forEach(a=>{if(n&&!a.embeddable)return;const m=r.querySelectorAll(a.selector);for(let v=0;v<m.length;v++){const c=m[v];if(!n&&c.closest("[op-dynamic-bootstrap]"))return void(0,i.qu)(`Skipping nested bootstrap ${a.selector} in %O`,c);h.bootstrap(a.cls,c),c.setAttribute("op-dynamic-bootstrap","true")}})}}e.optionalBoostrapComponents=[]},57597:(X,I,t)=>{"use strict";t.d(I,{o:()=>h});var i=t(93993);function e(r){const n=jQuery(r.data.menu);r.target!==n.find(" > li.drop-down.open > ul").get(0)&&(n.find(" > li.drop-down.open").removeClass("open").find("> ul").slideUp(i.f),jQuery("html").off("click",e))}function h(r){r.find(" > li.drop-down").on("click",n=>{!function(r){const n=r.find(" > li.drop-down");n.hasClass("open")||(n.find("> ul").slideDown(i.f,()=>{n.find("li > a:first").focus(),jQuery("html").on("click",{menu:r.get(0)},e)}),n.addClass("open"))}(r);const l=jQuery(n.target);(l.is(".drop-down")||l.closest("li, ul").is(".drop-down"))&&n.preventDefault()})}},93993:(X,I,t)=>{"use strict";t.d(I,{f:()=>e,F:()=>d});var i=t(87286);const e=100;class d{constructor(r){this.menuContainer=r,this.hover=!1,this.menuIsOpen=!1,this.withHeadingFoldOutAtBorder(),this.setupDropdownClick(),this.registerEventHandlers(),this.closeOnBodyClick(),this.accessibility(),this.skipContentClickListener()}skipContentClickListener(){jQuery("#skip-navigation--content").on("click",()=>{const n=jQuery(".first-breadcrumb-element a, .toolbar-container a:first-of-type, #content a:first-of-type").not(":hidden").first();n.length&&n.trigger("focus")})}accessibility(){jQuery(".op-app-menu--dropdown").attr("aria-expanded","false")}toggleClick(r){this.menuIsOpen?this.isOpen(r)?this.closing():this.open(r):(this.opening(),this.open(r))}opening(){this.startHover(),this.menuIsOpen=!0,this.menuContainer.trigger("openedMenu",this.menuContainer)}closing(){this.stopHover(),this.closeAllItems(),this.menuIsOpen=!1,this.menuContainer.trigger("closedMenu",this.menuContainer)}stopHover(){this.hover=!1,this.menuContainer.removeClass("hover")}startHover(){this.hover=!0,this.menuContainer.addClass("hover")}closeAllItems(){this.openDropdowns().each((r,n)=>{this.close(jQuery(n))})}closeOnBodyClick(){const r=document.getElementById("wrapper");!r||r.addEventListener("click",n=>{this.menuIsOpen&&!this.openDropdowns()[0].contains(n.target)&&this.closing()},!0)}openDropdowns(){return this.menuContainer.find(".op-app-menu--item_dropdown-open")}dropdowns(){return this.menuContainer.find(".op-app-menu--item_has-dropdown")}withHeadingFoldOutAtBorder(){var r,n;let l;const a=this.menuContainer.next(),m=this.menuContainer.next().children().next().first();"H2"===(null===(r=a.get(0))||void 0===r?void 0:r.tagName)?(l=this.menuContainer.next().innerHeight()+this.menuContainer.next().position().top,this.menuContainer.find(".op-app-menu--body").css({top:l})):this.menuContainer.next().hasClass("wiki-content")&&"H1"===(null===(n=m.get(0))||void 0===n?void 0:n.tagName)&&(l=m.innerHeight()+m.position().top,this.menuContainer.find(".op-app-menu--body").css({top:l}))}setupDropdownClick(){this.dropdowns().each((r,n)=>{jQuery(n).find(".op-app-menu--item-action").click(l=>{this.toggleClick(jQuery(n)),l.preventDefault()})})}isOpen(r){return 1===r.filter(".op-app-menu--item_dropdown-open").length}isClosed(r){return!this.isOpen(r)}open(r){this.dontCloseWhenUsing(r),this.closeOtherItems(r),this.slideAndFocus(r,()=>{r.trigger("opened",r)})}close(r,n){this.slideUp(r,!!n),r.trigger("closed",r),this.removeStoppingOfEventPropagation(r)}closeOtherItems(r){this.openDropdowns().each((n,l)=>{jQuery(l)!==jQuery(r)&&this.close(jQuery(l),!0)})}dontCloseWhenUsing(r){setTimeout(()=>{jQuery(r).find("li").click(n=>{n.stopPropagation()}),jQuery(r).bind("mousedown mouseup click",n=>{n.stopPropagation()})},0)}removeStoppingOfEventPropagation(r){jQuery(r).find("li").unbind("click"),jQuery(r).unbind("mousedown mouseup click")}slideAndFocus(r,n){this.slideDown(r,n),setTimeout(()=>this.focusFirstInputOrLink(r),e)}slideDown(r,n){const l=r.find(".op-app-menu--dropdown");r.addClass("op-app-menu--item_dropdown-open"),l.slideDown(e,n).attr("aria-expanded","true")}slideUp(r,n){const l=jQuery(r).find(".op-app-menu--dropdown");r.removeClass("op-app-menu--item_dropdown-open"),n?l.hide():l.slideUp(e),l.attr("aria-expanded","false")}focusFirstInputOrLink(r){const l=(0,i.p)(r.find(".op-app-menu--dropdown")[0])[0];!l||(l.blur(),setTimeout(()=>{l.focus()},10))}registerEventHandlers(){const r=jQuery("#main-menu-toggle");this.menuContainer.on("closeDropDown",n=>{this.close(jQuery(n.target))}).on("openDropDown",n=>{this.open(jQuery(n.target))}).on("closeMenu",()=>{this.closing()}).on("openMenu",()=>{this.open(this.dropdowns().first()),this.opening()}),r.on("click",()=>{this.closing()})}}},12630:(X,I,t)=>{"use strict";t.d(I,{RO:()=>i,wh:()=>e,PI:()=>d,vV:()=>h,br:()=>r,Lt:()=>n,vx:()=>l});const i="Demo project",e="Scrum project",d="openProject-onboardingTour";var h,a;function r(a,m,v){new MutationObserver((p,f)=>{jQuery(a).length&&(f.disconnect(),v())}).observe(jQuery(m)[0],{childList:!0,subtree:!0})}function n(){const a=[],m=jQuery(`.widget-box.welcome a:contains(${i})`),v=jQuery(`.widget-box.welcome a:contains(${e})`);return m.length&&a.push(m),v.length&&a.push(v),a}function l(a){a.preventDefault(),a.stopPropagation()}(a=h||(h={})).demo="demo",a.scrum="scrum"},83531:()=>{var X;(X=jQuery)(()=>{X("[data-selected-page]").closest(".tree-menu--container").each((t,i)=>{const e=X(i).data("selected-page");if(e){const d=X(`[slug="${e}"]`,i);d.toggleClass("-selected",!0),d.length>0&&d[0].scrollIntoView()}}),X(".pages-hierarchy.-with-hierarchy .tree-menu--hierarchy-span").on("click keypress",function(t){return"keypress"===t.type&&13!==t.which||X(t.target).closest("ul.-with-hierarchy > li").toggleClass("-hierarchy-collapsed -hierarchy-expanded"),!1})})},47281:(X,I,t)=>{"use strict";t.r(I);t(58256),t(80261);function r(fe){window.OpenProject.getPluginContext().then(ve=>{const{opModalService:Se}=ve.services,Oe=ve.classes.modals.passwordConfirmation;fe(document).on("submit","form[data-request-for-confirmation]",function(je){const tt=jQuery(this);return!!tt.find('input[name="_password_confirmation"]').length||function(fe,ve,Se,Oe){return fe.find("_password_confirmation").length>0||(ve.preventDefault(),Se.show(Oe,"global").closingEvent.subscribe(He=>{He.confirmed&&(jQuery("<input>").attr({type:"hidden",name:"_password_confirmation",value:He.password_confirmation}).appendTo(fe),fe.trigger("submit"))}),!1)}(tt,je,Se,Oe)})}).catch(()=>{})}var n=t(53916);function a(fe,ve){const Se="fieldset-toggle-state-label";let Oe=fe.find(`a span.${Se}`);const je=fe.children("a");0===Oe.length&&(Oe=jQuery("<span />").addClass(Se).addClass("hidden-for-sighted"),je.append(Oe)),Oe.text(` ${ve}`)}function m(fe){const ve=fe.children("legend");fe.hasClass("collapsed")?a(ve,I18n.t("js.label_collapsed")):a(ve,I18n.t("js.label_expanded"))}function v(fe){const ve=jQuery(fe);if(ve.is("legend"))return jQuery(fe).parent();if(ve.is("fieldset"))return ve;throw new Error("Cannot derive fieldset from element!")}function p(){const fe=jQuery("fieldset.form--fieldset.-collapsible");fe.on("click",".form--fieldset-legend",function(ve){return function(fe){const ve=v(fe);ve.attr("data-touched","true");const Se=ve.find("> div").not(".form--toolbar");ve.toggleClass("collapsed"),Se.slideToggle("fast"),m(ve)}(this),ve.preventDefault(),ve.stopPropagation(),!1}),fe.each(function(){const ve=v(this),Se=ve.find("> div");ve.hasClass("collapsed")&&Se.hide(),m(ve)})}var f=t(93993),C=t(57597);function O(){(function(){const fe=jQuery("#wrapper"),ve=jQuery("ul.menu_root.closed li.open a.arrow-left-to-project");1===ve.length&&fe.hasClass("hidden-navigation")&&ve.trigger("click")})(),jQuery("span.errorSpan").first().find("*").filter(":input").trigger("focus"),M(),S(),setTimeout(()=>{jQuery(".flash.autohide-toaster").remove()},5e3),jQuery("body").on("click keydown touchend",".close-handler,.op-toast--close",function(fe){("click"===fe.type||13===fe.which)&&jQuery(this).parent(".flash, .errorExplanation, .op-toast").not(".persistent-toggle--notification").remove()}),jQuery(document).ajaxComplete(M),jQuery(document).ajaxComplete(S),jQuery(document).ajaxSend((Oe,je)=>{jQuery(Oe.target.activeElement).closest("[ajax-indicated]").length&&jQuery("ajax-indicator")&&jQuery("#ajax-indicator").show();const tt=jQuery("meta[name=csrf-token]");if(tt){const He="X-CSRF-Token",st=tt.attr("content");je.setRequestHeader(He,st)}je.setRequestHeader("X-Authentication-Scheme","Session")}),jQuery(document).ajaxStop(()=>{jQuery("#ajax-indicator")&&jQuery("#ajax-indicator").hide(),P()}),jQuery(".attachments h4").click(function(){jQuery(this).toggleClass("closed").next().slideToggle(100)});let fe=null;jQuery(window).on("resize",()=>{fe&&clearTimeout(fe),fe=setTimeout(()=>{jQuery(window).trigger("resizeEnd")},200)}),jQuery("#nav-login-content").click(Oe=>{Oe.stopPropagation()});const ve=jQuery("a.afocus").first(),Se=jQuery(".autofocus").first();void 0!==ve?ve.focus():void 0!==Se&&(Se.focus(),"INPUT"===Se[0].tagName&&Se.select()),P(),jQuery(document.body).on("click",".formatting-help-link-button",()=>(window.open(`${window.appBasePath}/help/wiki_syntax`,"","resizable=yes, location=no, width=600, height=640, menubar=no, status=no, scrollbars=yes"),!1))}function P(){jQuery("a.afocus").each(function(){const fe=jQuery(this);fe.click(ve=>{let Se=jQuery(`#${fe.attr("href").substr(1)}`);return null===Se&&(Se=jQuery(`#${fe.attr("href").substr(1).concat("_id")}`)),fe.unbind(ve),!1})})}function T(fe){jQuery(fe).each((Se,Oe)=>{jQuery(Oe).show()})}function M(){T(".flash")}function S(){T('.errorExplanation[role="alert"]')}var L=t(3786),D=t(12630),G=t(3352);function Q(fe,ve){return(0,L.mG)(this,void 0,void 0,function*(){(0,G.qu)(`Loading and triggering onboarding tour ${fe}`),yield t.e("src_app_core_setup_globals_onboarding_onboarding_tour_ts").then(t.bind(t,36243)).then(Se=>{Se.start(fe,ve)})})}var fe,K=t(14882);(fe=jQuery)(()=>{fe(document.documentElement).on("click",Oe=>{const je=jQuery(Oe.target);return function(fe,ve){ve.hasClass("-augmented-datepicker")&&(ve.attr("autocomplete","off"),window.OpenProject.getPluginContext().then(Se=>{new K.M(Se.injector,".-augmented-datepicker",ve.val(),{weekNumbers:!0,allowInput:!0},ve[0]).show()}).catch(()=>{}))}(0,je),function(fe,ve){document.contains(fe.target)||fe.preventDefault();const Se=ve.closest("a");if(0===Se.length)return;const Oe=Se.attr("href")||"",je=Oe.indexOf("#");""!==Oe&&0!==je||(-1!==je&&"#"!==Oe&&(window.location.hash=Oe),fe.preventDefault())}(Oe,je),!0});const{hash:ve}=window.location;if(ve&&ve.startsWith("#"))try{const Oe=document.querySelector(ve);Oe&&Oe.scrollIntoView()}catch(Oe){console.log(`Could not scroll to given location hash: ${ve} ( ${Oe.message})`)}if(fe(document).on("submit","form",()=>{window.OpenProject.pageIsSubmitted=!0}),document.querySelector(".warning-bar--item")){const Oe=document.querySelector("#content");Oe&&(Oe.style.marginBottom="100px")}fe(window).on("beforeunload",Oe=>{const je=Oe.originalEvent;window.OpenProject.pageWasEdited&&!window.OpenProject.pageIsSubmitted&&(je.preventDefault(),je.returnValue=I18n.t("js.work_packages.confirm_edit_cancel"))}),fe(document.documentElement).on("dragover drop",Oe=>(Oe.preventDefault(),!1)),function(){const fe=document.querySelectorAll(".augment--refresh-on-form-changes");for(let ve=0;ve<fe.length;ve++){const Se=fe[ve],Oe=jQuery(Se),je=Oe.data("refreshUrl"),tt=Oe.data("inputSelector");setTimeout(()=>{Oe.find(tt).on("change",He=>{const st=He.currentTarget;"new_project_id"===st.name&&""===st.value||(window.location.href=`${je}?${Oe.serialize()}`)})},100)}}(),r(fe),(new n.U).isMobile&&function(){let ve=window.scrollY;window.addEventListener("scroll",()=>{const Se=window.scrollY<0?0:window.scrollY;!jQuery("#main").hasClass("hidden-navigation")||jQuery(".op-app-header").hasClass("op-app-header_search-open")||Math.abs(Se-ve)<=55||(void 0!==ve&&void 0!==Se&&ve>Se?jQuery("#wrapper").removeClass("_header-scrolled"):jQuery("#wrapper").addClass("_header-scrolled"),ve=Se)})}(),function(){const fe=new URL(window.location.href),ve=document.body.classList.contains("-browser-mobile"),Se="true"===jQuery("meta[name=demo_projects_available]").attr("content");let Oe=sessionStorage.getItem(D.PI),je=!1;!ve&&Se&&(fe.searchParams.get("first_time_user")&&2===(0,D.Lt)().length&&(Oe="",sessionStorage.setItem(D.PI,"readyToStart"),(0,D.br)(".spot-modal-overlay_active","body",()=>{const tt=document.getElementsByClassName("spot-modal-overlay_active");Array.from(tt).forEach(He=>{He.addEventListener("click",()=>{je=!0,Q("homescreen")})})}),document.addEventListener("keydown",tt=>{"Escape"===tt.key&&!je&&(je=!0,Q("homescreen"))},{once:!0})),"readyToStart"===Oe&&Q("homescreen"),("startMainTourFromBacklogs"===Oe||fe.searchParams.get("start_onboarding_tour"))&&Q("main","startMainTourFromBacklogs"===Oe?D.vV.scrum:D.vV.demo),fe.searchParams.get("start_scrum_onboarding_tour")&&(jQuery(".backlogs-menu-item").length>0?Q("prepareBacklogs",D.vV.scrum):Q("taskboard",D.vV.scrum)),"prepareTaskBoardTour"===Oe&&Q("backlogs",D.vV.scrum),"startTaskBoardTour"===Oe&&Q("taskboard",D.vV.scrum))}(),p(),new f.F(jQuery(".op-app-header")),jQuery(".project-actions, .toolbar-items").each((Oe,je)=>{(0,C.o)(jQuery(je))}),function(){jQuery("#settings_session_ttl_enabled").on("change",function(){jQuery("#settings_session_ttl_container").toggle(jQuery(this).is(":checked"))}).trigger("change"),jQuery('[name="settings[enabled_scm][]"]').change(function(){const ve=!this.checked,Se=this.value,Oe=jQuery("#settings_repositories_automatic_managed_vendor"),je=Oe.find(`option[value="${Se}"]`);0!==je.length&&(je.prop("disabled",ve),ve&&je.prop("selected")&&Oe.val(""))});const fe=function(ve){const Se=jQuery(ve),Oe=Se.attr("id")||"",je=Oe.replace("lang-for-",""),tt=Se.val(),He=jQuery(`#settings-${je}`),st=He.siblings("ckeditor-augmented-textarea").data("editor");return{id:Oe,settingName:je,newLang:tt,textArea:He,editor:st}};jQuery(".lang-select-switch").focus(function(){const ve=fe(this);jQuery(`#${ve.id}-${ve.newLang}`).val(ve.editor.getData())}).change(function(){const ve=fe(this),Se=jQuery(`#${ve.id}-${ve.newLang}`).val();ve.editor.setData(Se),ve.textArea.attr("name",`settings[${ve.settingName}][${ve.newLang}]`)}),jQuery(".admin-settings--form").submit(()=>(jQuery("#settings_consent_required").is(":checked")&&jQuery("#toggle_consent_time").is(":checked")&&jQuery("#settings_consent_time").val((new Date).toISOString()).prop("disabled",!1),!0)),jQuery("#email_delivery_method_switch").on("change",function(){const ve=jQuery(this).val();jQuery(".email_delivery_method_settings").hide(),jQuery(`#email_delivery_method_${ve}`).show()}).trigger("change"),jQuery("#settings_smtp_authentication").on("change",function(){const ve="none"===jQuery(this).val();jQuery("#settings_smtp_user_name,#settings_smtp_password").closest(".form--field").toggle(!ve)}),jQuery(".settings-repositories--checkout-toggle").change(function(){const ve=this.checked;jQuery(this).closest("fieldset").find("input,select").filter(":not([type=checkbox])").filter(":not([type=hidden])").removeAttr("required").prop("required",ve)}),jQuery(".settings--highlighting-mode select").change(function(){const ve=jQuery(this).val();jQuery(".settings--highlighted-attributes").toggle("inline"===ve)}),0===jQuery(".settings--highlighted-attributes input[type='checkbox']:checked").length&&jQuery(".settings--highlighted-attributes input[type='checkbox']").prop("checked",!0),jQuery("#tab-content-work_packages form").submit(()=>{const ve=jQuery(".settings--highlighted-attributes input[type='checkbox']");jQuery(".settings--highlighted-attributes input[type='checkbox']:checked").length===ve.length&&ve.prop("checked",!1)})}(),jQuery(".color--preview").each(function(){const fe=jQuery(this);let ve;const Se=fe.data("target");if(ve=Se?jQuery(Se):fe.next("input"),0===ve.length)return;const Oe=function(){let je="";ve.val()&&ve.val().length>0?je=ve.val():ve.attr("placeholder")&&ve.attr("placeholder").length>0&&(je=ve.attr("placeholder")),fe.css("background-color",je)};ve.keyup(Oe).change(Oe).focus(Oe),Oe()}),function(){const fe=jQuery(".danger-zone--verification"),ve=jQuery(".danger-zone--expected-value").text();fe.find("input").on("input",()=>{const Se=fe.find("input").val();ve.toLowerCase()===Se.toLowerCase()?fe.find("button").prop("disabled",!1):fe.find("button").prop("disabled",!0)})}(),O()});var te=t(14808),ie=t(53466);class le{checkAll(ve,Se){document.querySelectorAll(`#${ve} input[type="checkbox"]:not([disabled])`).forEach(Oe=>Oe.checked=Se)}toggleCheckboxesBySelector(ve){const Se=jQuery(ve);let Oe=!0;for(let je=0;je<Se.length;je++)!1===Se[je].checked&&(Oe=!1);for(let je=0;je<Se.length;je++)Se[je].checked=!Oe}}window.OpenProject=new class{constructor(){this.pluginContext=(0,te.qH)(),this.helpers=new le,this.pageWasEdited=!1,this.pageIsSubmitted=!1}getPluginContext(){return this.pluginContext.values$().pipe((0,ie.q)(1)).toPromise()}get urlRoot(){return jQuery("meta[name=app_base_path]").attr("content")||""}get environment(){return jQuery("meta[name=openproject_initializer]").data("environment")}get edition(){return jQuery("meta[name=openproject_initializer]").data("edition")}get isStandardEdition(){return"standard"===this.edition}get isBimEdition(){return"bim"===this.edition}guardedLocalStorage(ve,Se){try{if(void 0===Se){const Oe=window.localStorage.getItem(ve);return null===Oe?void 0:Oe}window.localStorage.setItem(ve,Se)}catch(Oe){console.error("Failed to access your browsers local storage. Is your local database corrupted?")}}};t(83531)},50725:(X,I,t)=>{t(30121),t(67285),t(5222),t(47939),t(20302),t(84906),t(84236),t(76213),t(89265),t(80146),t(78915),t(96024),t(84818),t(83305),t(14540),t(66732),t(56192),t(77729),t(39541),t(41250),t(12305),t(32198),t(95321)},60419:(X,I,t)=>{"use strict";t.d(I,{b:()=>h});var i=t(79441),e=t(43155),d=t(2316);class h{constructor(){this.actions=new i.xQ,this.actions$=this.actions.asObservable()}ofType(n){return this.actions$.pipe((0,e.l)(n))}dispatch(n){this.actions.next(n)}}h.\u0275fac=function(n){return new(n||h)},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},88826:(X,I,t)=>{"use strict";t.d(I,{v:()=>b});var i=t(53882),e=t(19100),d=t(30400),h=t(98636),r=t(18293),n=t(33927),l=t(3786),a=t(96725);let m=class extends e.cf{constructor(){super((0,a.cq)())}};m=(0,l.gn)([(0,e.yC)({name:"attachments"}),(0,l.w6)("design:paramtypes",[])],m);var v=t(36293),c=t(76825),p=t(48249),f=t(96617),C=t(61908),u=t(84699),k=t(12877),O=t(17954),y=t(2316);class b extends O.o{constructor(E,T,M,S,R,F,L){super(),this.I18n=E,this.http=T,this.apiV3Service=M,this.fileUploadService=S,this.directFileUploadService=R,this.configurationService=F,this.toastService=L}requireCollection(E){this.store.getValue().collections[E]||this.fetchAttachments(E).subscribe()}fetchAttachments(E){return this.http.get(E).pipe((0,h.b)(T=>(0,a.V7)(this.store,T,E)),(0,r.K)(T=>{throw this.toastService.addError(T),T}))}removeAttachment(E,T){const M=new i.WM({"Content-Type":"application/json"});return this.http.delete(T._links.delete.href,{withCredentials:!0,headers:M}).pipe((0,h.b)(()=>(0,a.sS)(this.store,T.id,E)),(0,r.K)(S=>{throw this.toastService.addError(S),S}))}attachFiles(E,T){const M=b.getAttachmentsSelfLink(E)||u.m,S=this.getUploadTarget(E),R=!!this.getDirectUploadLink(E);return this.addAttachments(M,S,T,R)}addAttachments(E,T,M,S=!1){return this.uploadAttachments(T,M,S).pipe((0,h.b)(R=>{(0,e.Y0)(()=>{this.store.add(R),this.store.update(({collections:F})=>{var L;return{collections:Object.assign(Object.assign({},F),{[E]:Object.assign(Object.assign({},F[E]),{ids:((null===(L=F[E])||void 0===L?void 0:L.ids)||[]).concat(R.map(D=>D.id))})})}})})}))}uploadAttachments(E,T,M){const{uploads:S,finished:R}=M?this.directFileUploadService.uploadAndMapResponse(E,T):this.fileUploadService.uploadAndMapResponse(E,T),F=this.I18n.t("js.label_upload_notification"),L=this.toastService.addAttachmentUpload(F,S);return(0,d.D)(R).pipe((0,h.b)(()=>{setTimeout(()=>this.toastService.remove(L),700)}),(0,n.U)(D=>D.map(({response:G})=>G.$source)),(0,r.K)(D=>{throw this.toastService.addError(D),D}))}getUploadTarget(E){return this.getDirectUploadLink(E)||b.getAttachmentsSelfLink(E)||this.apiV3Service.attachments.path}getDirectUploadLink(E){const T=E.$links;return T.prepareAttachment?T.prepareAttachment.href:(0,u.Z)(E)?this.configurationService.prepareAttachmentURL:null}static getAttachmentsSelfLink(E){const T=E.attachments;return(null==T?void 0:T.href)||null}createStore(){return new m}}b.\u0275fac=function(E){return new(E||b)(y.LFG(f.D),y.LFG(i.eN),y.LFG(C.T),y.LFG(c.r),y.LFG(p.c),y.LFG(k.e),y.LFG(v.kl))},b.\u0275prov=y.Yz7({token:b,factory:b.\u0275fac})},41599:(X,I,t)=>{"use strict";t.d(I,{a:()=>f});var i=t(79902),e=t(33927),d=t(18293),h=t(61908),r=t(36293),n=t(96725),l=t(3786),a=t(19100);let m=class extends a.cf{constructor(){super((0,n.cq)())}};m=(0,l.gn)([(0,a.yC)({name:"capabilities"}),(0,l.w6)("design:paramtypes",[])],m);var v=t(17954),c=t(2316),p=t(53882);class f extends v.o{constructor(u,k,O){super(),this.http=u,this.apiV3Service=k,this.toastService=O}get capabilitiesPath(){return this.apiV3Service.capabilities.path}require$(u){const k=(0,n.ZU)(u);return this.collectionExists(k)||this.collectionLoading(k)?this.loadedCollection(k):this.fetchCapabilities(u).pipe((0,i.w)(()=>this.loadedCollection(k)))}loadedCapabilities$(u){return this.query.selectAll().pipe((0,e.U)(k=>k.filter(O=>O._links.context.href.endsWith(`/${u}`))))}fetchCapabilities(u){return this.fetchCollection(this.http,this.capabilitiesPath,u).pipe((0,d.K)(k=>{throw this.toastService.addError(k),k}))}createStore(){return new m}}f.\u0275fac=function(u){return new(u||f)(c.LFG(p.eN),c.LFG(h.T),c.LFG(r.kl))},f.\u0275prov=c.Yz7({token:f,factory:f.\u0275fac})},96725:(X,I,t)=>{"use strict";t.d(I,{n:()=>h,cq:()=>r,ZU:()=>n,wY:()=>l,V7:()=>a,sS:()=>m,zv:()=>c});var i=t(19100),e=t(73726),d=t(10190);function h(p){return{ids:p._embedded.elements.map(f=>f.id)}}function r(){return{collections:{},loadingCollections:{}}}function n(p){return(0,e.g)(p)}function l(p,f,C){p.update(({loadingCollections:u})=>({loadingCollections:Object.assign(Object.assign({},u),{[f]:C})}))}function a(p,f,C){const{elements:u}=f._embedded,k=(null==u?void 0:u.map(O=>O.id))||[];(0,i.Y0)(()=>{u&&u.length>0&&p.upsertMany(u),p.update(({collections:O})=>({collections:Object.assign(Object.assign({},O),{[C]:{ids:k}})}))})}function m(p,f,C){(0,i.Y0)(()=>{p.remove(f),p.update(({collections:u})=>{var k;return{collections:Object.assign(Object.assign({},u),{[C]:Object.assign(Object.assign({},u[C]),{ids:((null===(k=u[C])||void 0===k?void 0:k.ids)||[]).filter(O=>O!==f)})})}})})}function c(p){const f=p._embedded.elements.map(C=>Object.assign(Object.assign({},C),{id:(0,d.Z)(C._links.self.href)}));return Object.assign(Object.assign({},p),{_embedded:Object.assign(Object.assign({},p._embedded),{elements:f})})}},46934:(X,I,t)=>{"use strict";t.d(I,{s:()=>f});var i=t(79902),e=t(33927),d=t(98636),h=t(8117),r=t(61908),n=t(96725),l=t(3786),a=t(19100);let m=class extends a.cf{constructor(){super((0,n.cq)())}};m=(0,l.gn)([(0,a.yC)({name:"weekdays"}),(0,l.w6)("design:paramtypes",[])],m);var v=t(17954),c=t(2316),p=t(53882);class f extends v.o{constructor(u,k){super(),this.http=u,this.apiV3Service=k}get weekdaysPath(){return this.apiV3Service.days.week.path}require(){return this.query.selectHasCache().pipe((0,i.w)(u=>u?h.E:this.fetchWeekdays()),(0,i.w)(()=>this.query.selectAll()))}fetchWeekdays(){return this.http.get(this.weekdaysPath).pipe((0,e.U)(k=>(0,n.zv)(k)),(0,d.b)(k=>(0,n.V7)(this.store,k,"all")))}createStore(){return new m}}f.\u0275fac=function(u){return new(u||f)(c.LFG(p.eN),c.LFG(r.T))},f.\u0275prov=c.Yz7({token:f,factory:f.\u0275fac})},44838:(X,I,t)=>{"use strict";t.d(I,{b:()=>n,B:()=>l});t(43887);var d=t(3352),h=t(18511);const r=Symbol("EffectHandlers");function n(a){return class extends a{constructor(...m){super(...m),this.serviceDestroyed=!1;const v=a.prototype[r];v&&v.forEach((c,p)=>{(0,d.qu)(`[${a.name}] Subscribing to effect ${p}`),this.actions$.ofType(c.action).pipe((0,h.o)(()=>!this.serviceDestroyed)).subscribe(f=>{try{c.callback.call(this,f)}catch(C){console.error(`Error thrown in effect callback ${p}: ${C}`)}})})}ngOnDestroy(){this.serviceDestroyed=!0,super.ngOnDestroy&&super.ngOnDestroy()}}}function l(a){return(m,v,c)=>{const p=m;p[r]||(p[r]=new Map),p[r].set(v,{action:a,callback:c.value})}}},92144:(X,I,t)=>{"use strict";t.d(I,{s:()=>O});var i=t(53882),e=t(30400),d=t(98636),h=t(79902),r=t(43084),n=t(85816),l=t(11045),a=t(18293),m=t(36293),v=t(3786),c=t(96725),p=t(19100);let f=class extends p.cf{constructor(){super((0,c.cq)())}};f=(0,v.gn)([(0,p.yC)({name:"file_links"}),(0,v.w6)("design:paramtypes",[])],f);var C=t(10190),u=t(17954),k=t(2316);class O extends u.o{constructor(b,P){super(),this.http=b,this.toastService=P}updateCollectionsForWorkPackage(b){this.http.get(b).pipe((0,d.b)(P=>(0,c.V7)(this.store,P,b)),(0,h.w)(P=>(0,e.D)(P._embedded.elements)),(0,r.v)(P=>P._links.storage.href,P=>P),(0,n.zg)(P=>{const E={storage:P.key,fileLinks:[]};return P.pipe((0,l.u)((T,M)=>(T.fileLinks=[...T.fileLinks,M],T),E))}),(0,a.K)(P=>{throw this.toastService.addError(P),P})).subscribe(P=>{const E=(0,C.Z)(P.storage),T=`${b}?filters=[{"storage":{"operator":"=","values":["${E}"]}}]`,M={_embedded:{elements:P.fileLinks}};(0,c.V7)(this.store,M,T)})}createStore(){return new f}remove(b,P){if(!P._links.delete)return;const E=new i.WM({"Content-Type":"application/json"});this.http.delete(P._links.delete.href,{withCredentials:!0,headers:E}).pipe((0,a.K)(T=>{throw this.toastService.addError(T),T})).subscribe(()=>(0,c.sS)(this.store,P.id,b))}}O.\u0275fac=function(b){return new(b||O)(k.LFG(i.eN),k.LFG(m.kl))},O.\u0275prov=k.Yz7({token:O,factory:O.\u0275fac})},24782:(X,I,t)=>{"use strict";t.d(I,{Z:()=>i});const i=100},78509:(X,I,t)=>{"use strict";t.d(I,{L5:()=>e,A6:()=>d,vw:()=>h,$v:()=>r});var i=t(87916);const e=(0,i.aD)("[IAN] Mark notifications as read",(0,i.NQ)()),d=(0,i.aD)("[IAN] Notifications were marked as read",(0,i.NQ)()),h=(0,i.aD)("[IAN] The backend sent a notification count that was higher than the last known",(0,i.NQ)()),r=(0,i.aD)("[IAN] The notification center updated the notification list without a full page refresh",(0,i.NQ)())},31909:(X,I,t)=>{"use strict";t.d(I,{W:()=>C});var i=t(3786),e=t(98636),d=t(61908),h=t(36293),r=t(53882),n=t(96725),l=t(78509),a=t(44838),m=t(60419),v=t(19100);let c=class extends v.cf{constructor(){super((0,n.cq)())}};c=(0,i.gn)([(0,v.yC)({name:"in-app-notifications"}),(0,i.w6)("design:paramtypes",[])],c);var p=t(17954),f=t(2316);let C=class extends p.o{constructor(k,O,y,b){super(),this.actions$=k,this.http=O,this.apiV3Service=y,this.toastService=b}get notificationsPath(){return this.apiV3Service.notifications.path}fetchNotifications(k){const O=(0,n.ZU)(k);return this.http.get(this.notificationsPath+O).pipe((0,e.b)(y=>(0,n.V7)(this.store,y,O)))}update(k,O){this.store.update(k,O)}markAsRead(k){return this.apiV3Service.notifications.markRead(k).pipe((0,e.b)(()=>{this.store.update(k,{readIAN:!0})}))}markNotificationsAsRead(k){this.markAsRead(k.notifications).subscribe(()=>this.actions$.dispatch((0,l.A6)(k)))}createStore(){return new c}};C.\u0275fac=function(k){return new(k||C)(f.LFG(m.b),f.LFG(r.eN),f.LFG(d.T),f.LFG(h.kl))},C.\u0275prov=f.Yz7({token:C,factory:C.\u0275fac}),(0,i.gn)([(0,a.B)(l.L5),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0]),(0,i.w6)("design:returntype",void 0)],C.prototype,"markNotificationsAsRead",null),C=(0,i.gn)([a.b,(0,i.w6)("design:paramtypes",[m.b,r.eN,d.T,h.kl])],C)},96457:(X,I,t)=>{"use strict";t.d(I,{P:()=>C});var i=t(3786),e=t(98636),d=t(18293),h=t(19100),r=t(61908),n=t(36293),l=t(53882),a=t(96725),m=t(44838),v=t(60419);let c=class extends h.cf{constructor(){super((0,a.cq)())}};c=(0,i.gn)([(0,h.yC)({name:"principals"}),(0,i.w6)("design:paramtypes",[])],c);var p=t(17954),f=t(2316);let C=class extends p.o{constructor(k,O,y,b){super(),this.actions$=k,this.http=O,this.apiV3Service=y,this.toastService=b}get principalsPath(){return this.apiV3Service.principals.path}fetchUser(k){return this.http.get(this.apiV3Service.users.id(k).path).pipe((0,e.b)(O=>{(0,h.Y0)(()=>{this.store.upsertMany([O])})}),(0,d.K)(O=>{throw this.toastService.addError(O),O}))}fetchPrincipals(k){const O=(0,a.ZU)(k);return this.http.get(this.principalsPath+O).pipe((0,e.b)(y=>(0,a.V7)(this.store,y,O)),(0,d.K)(y=>{throw this.toastService.addError(y),y}))}createStore(){return new c}};C.\u0275fac=function(k){return new(k||C)(f.LFG(v.b),f.LFG(l.eN),f.LFG(r.T),f.LFG(n.kl))},C.\u0275prov=f.Yz7({token:C,factory:C.\u0275fac}),C=(0,i.gn)([m.b,(0,i.w6)("design:paramtypes",[v.b,l.eN,r.T,n.kl])],C)},44040:(X,I,t)=>{"use strict";t.d(I,{D:()=>p});var i=t(98636),e=t(18293),d=t(61908),h=t(36293),r=t(96725),n=t(17954),l=t(3786),a=t(19100);let m=class extends a.cf{constructor(){super((0,r.cq)())}};m=(0,l.gn)([(0,a.yC)({name:"projects"}),(0,l.w6)("design:paramtypes",[])],m);var v=t(2316),c=t(53882);class p extends n.o{constructor(C,u,k){super(),this.http=C,this.apiV3Service=u,this.toastService=k}get projectsPath(){return this.apiV3Service.projects.path}fetchProjects(C){const u=(0,r.ZU)(C);return this.http.get(this.projectsPath+u).pipe((0,i.b)(k=>(0,r.V7)(this.store,k,u)),(0,e.K)(k=>{throw this.toastService.addError(k),k}))}update(C){return this.http.get(C).pipe((0,i.b)(u=>{this.store.upsertMany([u])}))}createStore(){return new m}}p.\u0275fac=function(C){return new(C||p)(v.LFG(c.eN),v.LFG(d.T),v.LFG(h.kl))},p.\u0275prov=v.Yz7({token:p,factory:p.\u0275fac})},17954:(X,I,t)=>{"use strict";t.d(I,{o:()=>v});var i=t(19100),e=t(79902),d=t(9170),h=t(33927),r=t(98636),n=t(71435),l=t(96725),a=t(202);function m(c){return void 0!==c}class v{constructor(){this.store=this.createStore(),this.query=new i.Gv(this.store)}collection(p){return this.collectionState(p).pipe((0,e.w)(f=>this.query.selectMany((null==f?void 0:f.ids)||[])))}loadedCollection(p){return this.collectionState(p).pipe((0,d.h)(f=>!!f),(0,e.w)(f=>this.query.selectMany(f.ids)))}collectionState(p){return this.query.select().pipe((0,h.U)(f=>f.collections[p]))}lookup(p){return this.query.selectEntity(p).pipe((0,d.h)(m))}lookupMany(p){return this.query.selectMany(p)}exists(p){return this.query.hasEntity(p)}collectionExists(p){const f="string"==typeof p?p:(0,l.ZU)(p);return!!this.query.getValue().collections[f]}collectionLoading(p){const f="string"==typeof p?p:(0,l.ZU)(p);return!0===this.query.getValue().loadingCollections[f]}clear(p){this.store.update(({collections:f})=>({collections:(0,a.omit)(f,p)}))}update(p,f){this.store.update(p,f)}fetchCollection(p,f,C){const u=(0,l.ZU)(C);return(0,l.wY)(this.store,u,!0),p.get(f+u).pipe((0,r.b)(k=>(0,l.V7)(this.store,k,u)),(0,n.x)(()=>(0,l.wY)(this.store,u,!1)))}}},4018:(X,I,t)=>{"use strict";t.d(I,{l:()=>m});var i=t(42720),e=t(3786),d=t(19100),h=t(96725);let r=class extends d.cf{constructor(){super((0,h.cq)())}};r=(0,e.gn)([(0,d.yC)({name:"storages"}),(0,e.w6)("design:paramtypes",[])],r);var n=t(17954),l=t(2316),a=t(53882);class m extends n.o{constructor(c){super(),this.http=c}updateCollection(c,p){(0,i.D)(p.map(f=>this.http.get(f.href))).subscribe(f=>{const C={_embedded:{elements:f}};(0,h.V7)(this.store,C,c)})}createStore(){return new r}}m.\u0275fac=function(c){return new(c||m)(l.LFG(a.eN))},m.\u0275prov=l.Yz7({token:m,factory:m.\u0275fac})},51705:(X,I,t)=>{"use strict";t.d(I,{s:()=>u});var i=t(3786),e=t(98636),d=t(18293),h=t(36293),r=t(53882),n=t(96725),l=t(44838),a=t(60419),m=t(19100);let v=class extends m.cf{constructor(){super((0,n.cq)())}};v=(0,i.gn)([(0,m.yC)({name:"views"}),(0,i.w6)("design:paramtypes",[])],v);var c=t(61908),p=t(18217),f=t(17954),C=t(2316);let u=class extends f.o{constructor(O,y,b,P){super(),this.actions$=O,this.http=y,this.apiV3Service=b,this.toastService=P}get viewsPath(){return this.apiV3Service.views.path}fetchViews(O){const y=(0,n.ZU)(O);return this.http.get((0,p.Y)(this.viewsPath+y,{pageSize:"-1"})).pipe((0,e.b)(b=>(0,n.V7)(this.store,b,y)),(0,d.K)(b=>{throw this.toastService.addError(b),b}))}createStore(){return new v}};u.\u0275fac=function(O){return new(O||u)(C.LFG(a.b),C.LFG(r.eN),C.LFG(c.T),C.LFG(h.kl))},u.\u0275prov=C.Yz7({token:u,factory:u.\u0275fac}),u=(0,i.gn)([l.b,(0,i.w6)("design:paramtypes",[a.b,r.eN,c.T,h.kl])],u)},87853:(X,I,t)=>{"use strict";t.d(I,{G:()=>d});var i=t(14808),e=t(79441);class d extends i.Ui{constructor(){super(...arguments),this.name="MainStore",this.projects=(0,i.r9)(),this.workPackages=(0,i.r9)(),this.posts=(0,i.r9)(),this.schemas=(0,i.r9)(),this.types=(0,i.r9)(),this.statuses=(0,i.r9)(),this.timeEntries=(0,i.r9)(),this.versions=(0,i.r9)(),this.users=(0,i.r9)(),this.placeholderUsers=(0,i.r9)(),this.roles=(0,i.r9)(),this.changes={queries:new e.xQ},this.additional={}}forType(r){let n=this[r]||this.additional[r];return n||(n=this.additional[r]=(0,i.r9)()),n}forResource(r){const n=`${_.camelCase(r._type)}s`,l=this.forType(n);return l&&l.get(r.id)}add(r,n){this.additional[r]=n}}},67731:(X,I,t)=>{"use strict";t.d(I,{m:()=>e,V:()=>d});var i=t(2316);const e="op-backlogs-page";class d{ngOnInit(){document.getElementById("projected-content").hidden=!1}}d.\u0275fac=function(r){return new(r||d)},d.\u0275cmp=i.Xpm({type:d,selectors:[["op-backlogs-page"]],decls:0,vars:0,template:function(r,n){},styles:['@charset "UTF-8";#rb .meta{display:none}#rb #helpers{display:none}#rb .editors{display:none}#rb .ui-dialog .editor{display:block}.ui-dialog .ui-dialog-title{float:left;margin-right:0}.ui-dialog.ui-widget-content{border:none}.ui-dialog .ui-dialog-buttonpane.ui-widget-content{border:none}.subject-input{width:99%}th{font-weight:bold}#toolbar .links{display:none!important}.jqplot-target{position:relative;color:#666;font-family:"Trebuchet MS",Arial,Helvetica,sans-serif;font-size:1em}.jqplot-axis{font-size:.75em}.jqplot-xaxis{margin-top:10px}.jqplot-x2axis{margin-bottom:10px}.jqplot-yaxis{margin-right:10px}.jqplot-y2axis,.jqplot-y3axis,.jqplot-y4axis,.jqplot-y5axis,.jqplot-y6axis,.jqplot-y7axis,.jqplot-y8axis,.jqplot-y9axis{margin-left:10px;margin-right:10px}.jqplot-axis-tick,.jqplot-xaxis-tick,.jqplot-yaxis-tick,.jqplot-x2axis-tick,.jqplot-y2axis-tick,.jqplot-y3axis-tick,.jqplot-y4axis-tick,.jqplot-y5axis-tick,.jqplot-y6axis-tick,.jqplot-y7axis-tick,.jqplot-y8axis-tick,.jqplot-y9axis-tick{position:absolute}.jqplot-xaxis-tick{top:0;left:15px;vertical-align:top}.jqplot-x2axis-tick{bottom:0;left:15px;vertical-align:bottom}.jqplot-yaxis-tick{right:0;top:15px;text-align:right}.jqplot-y2axis-tick,.jqplot-y3axis-tick,.jqplot-y4axis-tick,.jqplot-y5axis-tick,.jqplot-y6axis-tick,.jqplot-y7axis-tick,.jqplot-y8axis-tick,.jqplot-y9axis-tick{left:0;top:15px;text-align:left}.jqplot-xaxis-label{margin-top:10px;font-size:11pt;position:absolute}.jqplot-x2axis-label{margin-bottom:10px;font-size:11pt;position:absolute}.jqplot-yaxis-label{margin-right:10px;font-size:11pt;position:absolute}.jqplot-y2axis-label,.jqplot-y3axis-label,.jqplot-y4axis-label,.jqplot-y5axis-label,.jqplot-y6axis-label,.jqplot-y7axis-label,.jqplot-y8axis-label,.jqplot-y9axis-label{font-size:11pt;position:absolute}table.jqplot-table-legend,table.jqplot-cursor-legend{background-color:#fff9;border:1px solid #ccc;position:absolute;font-size:.75em}td.jqplot-table-legend{vertical-align:middle}td.jqplot-table-legend>div{border:1px solid #ccc;padding:.2em}div.jqplot-table-legend-swatch{width:0;height:0;border-top-width:.35em;border-bottom-width:.35em;border-left-width:.6em;border-right-width:.6em;border-top-style:solid;border-bottom-style:solid;border-left-style:solid;border-right-style:solid}.jqplot-title{top:0;left:0;padding-bottom:.5em;font-size:1.2em}table.jqplot-cursor-tooltip{border:1px solid #ccc;font-size:.75em}.jqplot-cursor-tooltip{border:1px solid #ccc;font-size:.75em;white-space:nowrap;background:rgba(208,208,208,.5);padding:1px}.jqplot-highlighter-tooltip{border:1px solid #ccc;font-size:.75em;white-space:nowrap;background:rgba(208,208,208,.5);padding:1px}.jqplot-point-label{font-size:.75em}td.jqplot-cursor-legend-swatch{vertical-align:middle;text-align:center}div.jqplot-cursor-legend-swatch{width:1.2em;height:.7em}.score{text-align:center;width:1.5em;font-size:large;display:inline-block}.score_0{background-color:red}.score_1{background-color:#ff5300}.score_2{background-color:#ff8100}.score_3{background-color:#ffa100}.score_4{background-color:#fb0}.score_5{background-color:#ffd300}.score_6{background-color:#ffec00}.score_7{background-color:#e9fb00}.score_8{background-color:#b1f100}.score_9{background-color:#74e600}.score_10{background-color:#0c0}#rb #backlogs_container{width:100%;display:flex;flex-wrap:wrap;justify-content:space-between}#rb #owner_backlogs_container{min-width:420px;order:2;width:49%;flex:0 0 49%}#rb #sprint_backlogs_container{min-width:420px;width:49%;flex:0 0 49%;min-height:230px}#rb #owner_backlogs_container .backlog .header>.add_new_story{height:28px;line-height:31px;padding:0;position:absolute;right:10px;text-align:right;top:1px;width:100px}#rb #backlogs_container .backlog{border:1px solid #E4E4E4;display:block;margin:0 0 10px;width:100%}.controller-rb_master_backlogs .action-index #content{padding-bottom:180px}#rb #backlogs_container .backlog .header{background-color:#eee;height:30px;position:relative;width:100%}#rb .backlog .header .menu{border-right:1px solid #E4E4E4;cursor:pointer;height:30px;overflow:visible;position:absolute;top:0;right:0;width:30px}#rb .backlog .header .menu .icon-context{position:absolute;top:7px;left:12px}#rb .backlog .header .menu .icon-context:before{padding:0}#rb .backlog .header .menu .icon-context.open+.items{display:block}#rb .backlog .header .menu .items{display:none;background-color:#eee;border:1px solid #E4E4E4;position:absolute;top:30px;right:-2px;list-style:none;margin:0;padding:0;z-index:1000}#rb .backlog .header .menu .item{display:block;width:160px;height:2rem;font-size:.9rem;text-align:left;text-decoration:none;vertical-align:middle;overflow:hidden;white-space:nowrap}#rb .backlog .header .menu .item.hover,#rb .backlog .header .menu .item:hover{background-color:#999}#rb .backlog .header .menu .item a{display:block;height:100%;padding:6px;width:100%}#rb .backlog .header .menu .item.hover a,#rb .backlog .header .menu .item:hover a{color:#fff;text-decoration:none}#rb #backlogs_container .backlog .header .velocity{height:28px;line-height:31px;padding:0 3px 0 9px;position:absolute;right:25px;text-align:right;top:0px;width:32px}#rb #backlogs_container .backlog .header .toggler{font-family:"openproject-icon-font";height:30px;line-height:31px;padding:0;position:absolute;left:0;top:0;width:23px;cursor:pointer}#rb #backlogs_container .backlog .header .toggler:before{position:absolute;left:6px;top:10px}#rb #backlogs_container .backlog .header .toggler.closed:before{position:absolute;left:6px;top:10px}#rb #backlogs_container .backlog .header .toggler:hover{cursor:pointer;background-color:#d8d8d8}#rb #backlogs_container .backlog .sprint{background-color:transparent;cursor:pointer;display:block;height:29px;width:auto;margin-left:30px;margin-right:50px}#rb #backlogs_container .backlog .sprint.error.icon-bug{background:none;text-align:center}#rb #backlogs_container .backlog .sprint.error.icon-bug:before{position:absolute;color:red}#rb #backlogs_container .backlog .sprint .id,#rb #backlogs_container .backlog .sprint .status{display:none}#rb #backlogs_container .backlog .sprint .name{line-height:2rem;font-weight:bold;overflow:hidden;white-space:nowrap;margin-left:.5em}#rb #backlogs_container .backlog .sprint .start_date,#rb #backlogs_container .backlog .sprint .effective_date{float:right;height:28px;line-height:2rem;width:6.5em;margin-left:.5em}#rb #backlogs_container .backlog .stories{list-style:none;min-height:2rem;margin:0;padding:0;z-index:500;overflow-y:auto;overflow-x:hidden}#rb #backlogs_container .backlog .stories.closed{display:none}#rb #backlogs_container .backlog .stories .error.icon.icon-bug{text-align:left}#rb #backlogs_container .stories .story{cursor:move;display:block;font-size:.9rem;margin:0;overflow:hidden;position:relative;width:100%}#rb #backlogs_container .stories .story.odd{background-color:#f6f7f8}#rb #backlogs_container .stories .story.even{background-color:#fff}#rb #backlogs_container .stories .story.error.icon-bug{background:none;text-align:center}#rb #backlogs_container .stories .story.error.icon-bug:before{position:absolute;color:red;pointer-events:none}#rb #backlogs_container .stories .story.hover,#rb #backlogs_container .stories .story:hover{background-color:#fef8a8}#rb #backlogs_container .stories .story.closed{text-decoration:line-through}#rb #backlogs_container .stories .story .id{float:left;margin-left:1em;margin-right:1em;padding:5px 2px 4px;width:4em;text-align:right;white-space:nowrap}#rb #backlogs_container .stories .story .type_id .t{float:left;padding:5px 2px 4px;text-align:right;white-space:nowrap}#rb #backlogs_container .stories .story .subject{overflow:hidden;margin-left:4em;padding:5px 2px 4px;white-space:nowrap;min-height:1em}#rb #backlogs_container .stories .story .status_id{float:right;padding:5px 2px 4px;margin-left:1em;width:68px}#rb #backlogs_container .stories .story .story_points{float:right;padding:5px 1rem 4px 2px;width:3.5rem;min-height:14px;height:2rem;text-align:center}#rb #backlogs_container .stories .story .type_id .v,#rb #backlogs_container .stories .story .id .v,#rb #backlogs_container .stories .story .status_id .v,#rb #backlogs_container .stories .story .version_id,#rb #backlogs_container .stories .story .higher_item_id{display:none}.rb_dialog .burndown_chart{margin-top:20px;margin-bottom:20px;margin-left:20px}.rb_dialog #charts{overflow:hidden}.rb_dialog #charts h3{border:0px}.rb_dialog #charts fieldset.burndown_control{padding-left:10px;border:none}.rb_dialog #charts .axislabel{font-weight:bold}#rb #backlogs_container .sprint.editing .editors,#rb #backlogs_container .sprint.editing>.editor{display:block}#rb #backlogs_container .sprint.editing label,#rb #backlogs_container .sprint.editing>*{display:none}#rb #backlogs_container .sprint.editing+.velocity,#rb #backlogs_container .sprint.editing+.add_new_story{display:none}#rb #backlogs_container .backlog .sprint.editing .editor{font-size:.9rem;line-height:1.5rem;height:30px;margin:0;padding:0}#rb #backlogs_container .backlog .sprint.editing .editor.name{min-width:15em;width:calc(100% - 2 * 85px - 10px)}#rb #backlogs_container .backlog .sprint.editing .editor.start_date,#rb #backlogs_container .backlog .sprint.editing .editor.effective_date{width:85px}#rb #backlogs_container .stories .story.editing>*,#rb #backlogs_container .stories .story.editing>.editors label{display:none}#rb #backlogs_container .stories .story.editing .editors{display:block}#rb #backlogs_container .stories .story.editing select,#rb #backlogs_container .stories .story.editing input{display:inline-block;float:none;margin:5px 3px 4px 2px;font-size:.8rem;line-height:inherit}#rb #backlogs_container .stories .story.editing .type_id.editor{width:15%;max-width:140px}#rb #backlogs_container .stories .story.editing .subject.editor{width:55%}#rb #backlogs_container .stories .story.editing .status_id.editor{width:15%;float:right}#rb #backlogs_container .stories .story.editing .story_points.editor{float:right;width:10%}.controller-rb_master_backlogs.action-show #main,.controller-rb_master_backlogs.action-show #content,.controller-rb_master_backlogs.action-show #rb #backlogs_container .backlog .stories{overflow:visible}.controller-rb_master_backlogs.action-show div.calendar{z-index:10000}.backlog{font-size:.9rem}.controller-rb_taskboards.action-show #main{overflow:visible}#rb .task{color:#484848;line-height:inherit;white-space:inherit}#rb #taskboard{overflow-x:auto}#rb #taskboard #assigned_to_id_options{display:none}#rb #taskboard .swimlane{min-width:107px;padding:5px;width:107px}#rb #taskboard #board_header{background-color:#ebebeb;border:1px solid #CCCCCC;margin-bottom:0;margin-right:10px}#rb #taskboard #board_header td{background-color:#ebebeb;border-right:1px dotted #CFCFCF;color:#000;font-weight:bold;text-align:center;vertical-align:middle;padding-top:0;padding-bottom:0;line-height:30px}#rb #taskboard #board_header td:first-child{min-width:241px;width:241px}#rb #taskboard .board{background-color:#fcfcfc;border:1px solid #CCCCCC;border-top:none;margin-right:10px;table-layout:fixed;border-collapse:collapse;empty-cells:show}#rb #taskboard .board tr:hover{background-color:#fff}#rb #taskboard .board td{border-right:1px dotted #CFCFCF;border-bottom:1px dotted #CFCFCF;vertical-align:top}#rb #taskboard .board td:first-child{min-width:210px;padding:5px;width:210px}#rb #taskboard .board tr:last-child td{border-bottom:none}#rb #taskboard .board .add_new{margin:0;min-width:30px;padding:0;text-align:center;vertical-align:middle;width:30px}#rb #taskboard .board .add_new.clickable:hover{cursor:pointer;background-color:#ffc}#rb #taskboard .story,#rb #taskboard .label_sprint_impediments{background-color:#f8f6a5;border:none;display:block;float:left;min-height:84px;margin:5px;padding:5px;position:relative;width:190px}#rb #taskboard .story .subject{height:42px;line-height:13px;margin-top:0;overflow:hidden;padding:2px;width:180px}#rb #taskboard .story.closed .subject{text-decoration:line-through}#rb #taskboard .work_package,#rb #taskboard .placeholder{background-color:#afafaf;border:none;cursor:move;display:block;float:left;font-size:10px;height:80px;padding:5px;margin:5px 0;position:relative;width:85px}#rb #taskboard .work_package.prevent_edit{cursor:default}#rb #taskboard .placeholder{background-color:#ff0;border:1px dashed #333300;height:78px;width:83px}#rb #taskboard .work_package.closed .subject.editable{text-decoration:line-through}#rb #taskboard .work_package .v{display:none}#rb #taskboard .work_package .remaining_hours.editable{border:2px solid #FFFFFF;background-color:#e00;bottom:-5px;color:#fff;font-size:9px;height:13px;padding-left:5px;padding-right:5px;position:absolute;right:-5px}#rb #taskboard .work_package .blocks,#rb #taskboard .work_package .remaining_hours.editable.empty{display:none}#rb #taskboard .work_package .indicator{display:none}#rb #taskboard .work_package.error .indicator{background:none;border:none}#rb #taskboard .work_package.error.icon-bug:before{position:absolute;top:30px;left:28px;color:red}#rb #taskboard .work_package .editors{display:none}.task_editor_dialog.ui-dialog .ui-widget-header{background:none;background-color:#fff;opacity:.5;filter:alpha(opacity=50)}.task_editor_dialog.ui-dialog .ui-dialog-title{float:right;margin-right:0;color:var(--body-font-color)}.task_editor_dialog.ui-dialog.ui-widget-content{background:none;border:none}.task_editor_dialog.ui-dialog.ui-widget-content .editor{color:var(--body-font-color)}.task_editor_dialog.ui-dialog .ui-dialog-buttonpane.ui-widget-content{background:none;background-color:none;border:none}.ui-dialog-titlebar-close{overflow:hidden}.dark #task_editor label{color:#fff}.light #task_editor label{color:#000}.dark div{color:#fff}.light div{color:#000}#task_editor label{display:block;font-size:11px;text-transform:capitalize;width:100%}#task_editor .editor{font-size:11px;margin-bottom:10px;width:100%}#task_editor .subject{height:65px;width:272px}#task_editor .remaining_hours,#task_editor .blocks{width:268px}#rb .compact .story,#rb .compact .label_sprint_impediments{height:15px}#rb .compact .story .subject{display:none}#rb .compact .work_package{height:21px;padding:0;width:21px}#rb .compact .work_package *{display:none}#rb .compact .placeholder{background-color:#ff0;border:1px dashed #333300;height:19px;width:19px}#rb #impediment_template,#rb #task_template{display:none}.story .story-bar{background-color:#fff;font-size:1rem-rem-calc(5px);opacity:.8;filter:alpha(opacity=80);overflow:hidden;padding-bottom:1px;padding-right:3px;text-align:right;width:180px;clear:both}.story .story-bar .id{float:right}.story .story-bar .status{float:left}.story,.label_sprint_impediments{font-size:1rem-rem-calc(3px)}.work_package .id{background-color:#fff;font-size:1rem-rem-calc(5px);opacity:.8;filter:alpha(opacity=80);overflow:hidden;padding-bottom:1px;padding-right:3px;text-align:right;width:75px}.work_package .id a{opacity:1;filter:alpha(opacity=100)}.work_package .editable:hover{background-color:transparent}.work_package .subject.editable{font-size:1rem-rem-calc(3px);height:42px;line-height:13px;margin-top:0;overflow:hidden;padding:2px;width:81px}.story .story-footer .assigned_to_id{float:left;font-size:1rem-rem-calc(5px);width:85%;margin-top:4px;padding:0 2px 2px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.story .story-footer .story-points{margin-top:2px;float:right}.work_package .assigned_to_id.editable{float:left;font-size:1rem-rem-calc(5px);width:85%;margin-top:4px;padding:0 2px 2px}.work_package .assigned_to_id.editable .t{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#toolbar label[for=col_width_input]{padding-top:rem-calc(20px)}#toolbar #col_width_input{max-width:60px}.controller-rb_master_backlogs .ui-dialog-titlebar-close,.controller-rb_taskboards .ui-dialog-titlebar-close{display:none}.controller-rb_master_backlogs .ui-dialog,.controller-rb_taskboards .ui-dialog{background:#FFFFFF;border:1px solid #E4E4E4}\n'],encapsulation:2})},12084:(X,I,t)=>{"use strict";t.d(I,{y:()=>Q});var i=t(49152);class e extends i.J{constructor(K,q,se){super(q,se),this.injector=K,this.id=se}}class d extends i.D{constructor(K,q,se,te){super(q,se,te),this.injector=K,this.basePath=q,this.resource=te}id(K){return new(this.resource||e)(this.injector,this.path,K)}}var h=t(3786),r=t(53882),n=t(88361),l=t(45871),a=t(33927),m=t(18293),v=t(29161),c=t(51784);class p{constructor(K,q){this.injector=K,this.resourceClass=q}get(K,q,se={}){const te={headers:se,params:new r.LE({encoder:new c.c,fromObject:q}),withCredentials:!0,responseType:"json"};return this._request("get",K,te)}request(K,q,se={},te={}){if("get"===K)return this.get(q,se,te);const ie={body:se||{},headers:te,withCredentials:!0,responseType:"json"};return this._request(K,q,ie)}_request(K,q,se){return this.http.request(K,q,se).pipe((0,a.U)(te=>this.deserialize(te)),(0,m.K)(te=>(console.error(`Failed to ${K} ${q}: ${te.name}`),(0,l._)(te))))}deserialize(K){return this.resourceClass?new n.r5(this.resourceClass).parse(K):K}}(0,h.gn)([(0,v.W)(),(0,h.w6)("design:type",r.eN)],p.prototype,"http",void 0);var f=t(63628),C=t(95571);let u=class{};(0,h.gn)([f.R,(0,h.w6)("design:type",Number)],u.prototype,"project_id",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",String)],u.prototype,"name",void 0),u=(0,h.gn)([C.O],u);var k=t(68118),O=t(2281);let y=class{};(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],y.prototype,"topic_actions",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],y.prototype,"topic_status",void 0),y=(0,h.gn)([C.O],y);let b=class{};(0,h.gn)([f.R,(0,h.w6)("design:type",String)],b.prototype,"guid",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",String)],b.prototype,"topic_type",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",String)],b.prototype,"topic_status",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",String)],b.prototype,"priority",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],b.prototype,"reference_links",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",String)],b.prototype,"title",void 0),(0,h.gn)([(0,f.R)({preserveNull:!0}),(0,h.w6)("design:type",Object)],b.prototype,"index",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],b.prototype,"labels",void 0),(0,h.gn)([(0,f.R)({deserializer:V=>O(V),serializer:V=>V.toISOString()}),(0,h.w6)("design:type",Object)],b.prototype,"creation_date",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",String)],b.prototype,"creation_author",void 0),(0,h.gn)([(0,f.R)({deserializer:V=>O(V),serializer:V=>V.toISOString()}),(0,h.w6)("design:type",Object)],b.prototype,"modified_date",void 0),(0,h.gn)([(0,f.R)({preserveNull:!0}),(0,h.w6)("design:type",Object)],b.prototype,"modified_author",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",String)],b.prototype,"assigned_to",void 0),(0,h.gn)([(0,f.R)({preserveNull:!0}),(0,h.w6)("design:type",Object)],b.prototype,"stage",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",String)],b.prototype,"description",void 0),(0,h.gn)([(0,f.R)({deserializer:V=>O(V),serializer:V=>V.format("YYYY-MM-DD")}),(0,h.w6)("design:type",Object)],b.prototype,"due_date",void 0),(0,h.gn)([f.R,(0,h.w6)("design:type",y)],b.prototype,"authorization",void 0),b=(0,h.gn)([C.O],b);class P extends e{constructor(){super(...arguments),this.bcfViewpointsService=new p(this.injector)}get(K={},q={}){return this.bcfViewpointsService.get(this.toPath(),K,q)}}class E extends e{constructor(){super(...arguments),this.bcfViewpointsService=new p(this.injector)}get(K={},q={}){return this.bcfViewpointsService.get(this.toPath(),K,q)}}class T extends e{constructor(){super(...arguments),this.bcfViewpointsService=new p(this.injector),this.selection=new P(this.injector,this.path,"selection"),this.visibility=new E(this.injector,this.path,"visibility")}get(K={},q={}){return this.bcfViewpointsService.get(this.toPath(),K,q)}delete(K={}){return this.bcfViewpointsService.request("delete",this.toPath(),{},K).pipe((0,a.U)(()=>{}))}}class M extends d{constructor(){super(...arguments),this.bcfViewpointService=new p(this.injector)}post(K){return this.bcfViewpointService.request("post",this.toPath(),K)}}class S extends e{constructor(){super(...arguments),this.bcfTopicService=new p(this.injector,b),this.comments=new d(this.injector,this.path,"comments"),this.viewpoints=new M(this.injector,this.path,"viewpoints",T)}get(K={},q={}){return this.bcfTopicService.get(this.toPath(),K,q)}}class R extends d{constructor(K,q,se){super(K,q,se,S),this.injector=K,this.basePath=q,this.bcfTopicService=new p(this.injector,b)}get(K={},q={}){throw new Error("Not implemented")}post(K){return this.bcfTopicService.request("post",this.toPath(),K)}}let F=class{};(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],F.prototype,"topic_actions",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],F.prototype,"project_actions",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],F.prototype,"comment_actions",void 0),F=(0,h.gn)([C.O],F);class L extends e{constructor(){super(...arguments),this.bcfExtensionService=new p(this.injector,F)}get(K={},q={}){return this.bcfExtensionService.get(this.toPath(),K,q)}}class D extends e{constructor(){super(...arguments),this.bcfProjectService=new p(this.injector,u),this.topics=new R(this.injector,this.path,"topics"),this.extensions=new L(this.injector,this.path,"extensions")}get(K={},q={}){return this.bcfProjectService.get(this.toPath(),K,q)}}var G=t(2316);class Q{constructor(K){this.injector=K,this.bcfApiVersion="2.1",this.appBasePath=window.appBasePath||"",this.bcfApiBase=`${this.appBasePath}/api/bcf/${this.bcfApiVersion}`,this.projects=new d(this.injector,this.bcfApiBase,"projects",D)}parse(K){if(!K.startsWith(this.bcfApiBase))throw new Error(`Cannot parse ${K} into BCF resource.`);const q=K.replace(`${this.bcfApiBase}/`,"").split("/");let se=this;for(let te=0;te<q.length;te++){const ie=q[te];if(ie in se)se=se[ie];else{if(!(se instanceof d))break;se=se.id(ie)}}return se===this?void 0:se}}Q.\u0275fac=function(K){return new(K||Q)(G.LFG(G.zs3))},Q.\u0275prov=G.Yz7({token:Q,factory:Q.\u0275fac,providedIn:"root"})},38998:(X,I,t)=>{"use strict";t.d(I,{L:()=>r});var i=t(3786),e=t(29161),d=t(47775),h=t(2316);class r{constructor(l){this.injector=l}}r.\u0275fac=function(l){return new(l||r)(h.LFG(h.zs3))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac}),(0,i.gn)([(0,e.W)(),(0,i.w6)("design:type",d.StateService)],r.prototype,"state",void 0)},51566:(X,I,t)=>{"use strict";t.d(I,{b:()=>d});var i=t(70233),e=t(2316);class d{constructor(r){this.pathHelper=r}projectImportIssuePath(r){return`${this.pathHelper.projectPath(r)}/issues/upload`}projectExportIssuesPath(r,n){return n?`${this.pathHelper.projectPath(r)}/work_packages.bcf?filters=${n}`:`${this.pathHelper.projectPath(r)}/work_packages.bcf`}snapshotPath(r){return`${r.href}/snapshot`}}d.\u0275fac=function(r){return new(r||d)(e.LFG(i.j))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac})},3412:(X,I,t)=>{"use strict";t.d(I,{V:()=>f});var i=t(3786),e=t(29161),d=t(12084),h=t(38998),r=t(33927),n=t(98636),l=t(79902),a=t(42720),m=t(81134),v=t(61908),c=t(10190),p=t(2316);class f{constructor(u){this.injector=u}getViewPointResource(u,k){const O=u.bcfViewpoints[k].href;return this.bcfApi.parse(O)}getViewPoint$(u,k){const O=this.getViewPointResource(u,k);return(0,a.D)({viewpoint:O.get(),selection:O.selection.get(),visibility:O.visibility.get()}).pipe((0,r.U)(({viewpoint:y,selection:b,visibility:P})=>{const E=y;return E.components={selection:b.selection,visibility:P.visibility},E}))}deleteViewPoint$(u,k){return this.getViewPointResource(u,k).delete().pipe((0,n.b)(()=>this.apiV3Service.work_packages.id(u).requireAndStream(!0)))}saveViewpoint$(u,k){const O=u.project.href,y=(0,c.Z)(O),b=this.setBcfTopic$(u),P=k?(0,m.of)(k):this.viewerBridge.getViewpoint$();return(0,a.D)({topicUUID:b,viewpoint:P}).pipe((0,l.w)(E=>this.bcfApi.projects.id(y).topics.id(E.topicUUID).viewpoints.post(E.viewpoint)),(0,n.b)(()=>this.apiV3Service.work_packages.id(u).requireAndStream(!0)))}setBcfTopic$(u){var k;if(this.topicUUID)return(0,m.of)(this.topicUUID);const O=null===(k=u.bcfTopic)||void 0===k?void 0:k.href;return(O?(0,m.of)(this.bcfApi.parse(O).id):this.createBcfTopic$(u)).pipe((0,r.U)(b=>(this.topicUUID=b,this.topicUUID)))}createBcfTopic$(u){const k=(0,c.Z)(u.project.href),O=u.convertBCF.payload;return this.bcfApi.projects.id(k).topics.post(O).pipe((0,r.U)(y=>(this.topicUUID=y.guid,this.topicUUID)))}}f.\u0275fac=function(u){return new(u||f)(p.LFG(p.zs3))},f.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac}),(0,i.gn)([(0,e.W)(),(0,i.w6)("design:type",d.y)],f.prototype,"bcfApi",void 0),(0,i.gn)([(0,e.W)(),(0,i.w6)("design:type",h.L)],f.prototype,"viewerBridge",void 0),(0,i.gn)([(0,e.W)(),(0,i.w6)("design:type",v.T)],f.prototype,"apiV3Service",void 0)},70795:(X,I,t)=>{"use strict";t.d(I,{w:()=>ce});var i=t(2316),e=t(21757),d=t(60169),h=t(60874),r=t(3786),n=t(55741),l=t(29161),a=t(51566);class m extends n.C{render(W,Y){const $=this.resource.bcfViewpoints;if($&&$.length>0){const be=$[0];W.innerHTML=`\n        <img src="${this.bcfPathHelper.snapshotPath(be)}" class="thumbnail">\n      `}else W.innerHTML=""}}(0,r.gn)([(0,l.W)(),(0,r.w6)("design:type",a.b)],m.prototype,"bcfPathHelper",void 0);var v=t(54364);class c{constructor(W){this.documentElement=W}get isBcfActivated(){return this.hasBodyClass("bcf-activated")}hasBodyClass(W){return this.documentElement.body.classList.contains(W)}}c.\u0275fac=function(W){return new(W||c)(i.LFG(v.K0))},c.\u0275prov=i.Yz7({token:c,factory:c.\u0275fac});var p=t(3412),f=t(64533),C=t(38998),u=t(53448),k=t(47775),y=(t(24897),t(10190)),b=t(96617),P=t(26942),E=t(36293),T=t(63829),M=t(14808),S=t(12084),R=t(33927),F=t(53466);class L{constructor(W){this.bcfApi=W,this.authorizationMap=(0,M.r9)()}authorized$(W,Y,$){const be=this.authorizationMap.get(W);return be.putFromPromiseIfPristine(()=>this.bcfApi.projects.id(W).extensions.get().toPromise()),be.values$().pipe((0,R.U)(N=>N[Y]&&N[Y].includes($)))}isAllowedTo(W,Y,$){return this.authorized$(W,Y,$).pipe((0,F.q)(1)).toPromise().catch(()=>!1)}}L.\u0275fac=function(W){return new(W||L)(i.LFG(S.y))},L.\u0275prov=i.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"});var D=t(61908),G=t(8368),Q=t(9170),V=t(2775);function K(J,W){if(1&J){const Y=i.EpF();i.TgZ(0,"div",7),i.TgZ(1,"ngx-gallery",8),i.NdJ("change",function(be){return i.CHM(Y),i.oxw(2).onGalleryChanged(be)})("imagesReady",function(){return i.CHM(Y),i.oxw(2).selectViewpointInGallery()})("previewOpen",function(){return i.CHM(Y),i.oxw(2).galleryPreviewOpen()})("previewClose",function(){return i.CHM(Y),i.oxw(2).galleryPreviewClose()}),i.qZA(),i.qZA()}if(2&J){const Y=i.oxw(2);i.xp6(1),i.Q6J("options",Y.galleryOptions)("images",Y.galleryImages)}}function q(J,W){if(1&J){const Y=i.EpF();i.TgZ(0,"a",9),i.NdJ("click",function(){i.CHM(Y);const be=i.oxw(2);return be.saveViewpoint(be.workPackage)}),i._UZ(1,"op-icon",10),i.TgZ(2,"span",11),i._uU(3),i.qZA(),i.qZA()}if(2&J){const Y=i.oxw(2);i.Q6J("title",Y.text.add_viewpoint),i.xp6(3),i.hij(" ",Y.text.viewpoint," ")}}function se(J,W){if(1&J&&(i.ynx(0),i.TgZ(1,"div",1),i.TgZ(2,"div",2),i.TgZ(3,"div",3),i._UZ(4,"h3",4),i.qZA(),i.qZA(),i.YNc(5,K,2,2,"div",5),i.YNc(6,q,4,2,"a",6),i.qZA(),i.BQk()),2&J){const Y=i.oxw();i.xp6(4),i.Q6J("textContent",Y.text.bcf),i.xp6(1),i.Q6J("ngIf",Y.galleryImages.length>0),i.xp6(1),i.Q6J("ngIf",Y.viewerVisible&&Y.createAllowed)}}class te extends P.N{constructor(W,Y,$,be,N,Ue,et,Ke,_e,ye){super(),this.state=W,this.bcfAuthorization=Y,this.viewerBridge=$,this.apiV3Service=be,this.wpCreate=N,this.toastService=Ue,this.bcfViewer=et,this.cdRef=Ke,this.I18n=_e,this.viewpointsService=ye,this.text={bcf:this.I18n.t("js.bcf.label_bcf"),viewpoint:this.I18n.t("js.bcf.viewpoint"),add_viewpoint:this.I18n.t("js.bcf.add_viewpoint"),show_viewpoint:this.I18n.t("js.bcf.show_viewpoint"),delete_viewpoint:this.I18n.t("js.bcf.delete_viewpoint"),text_are_you_sure:this.I18n.t("js.text_are_you_sure"),notice_successful_create:this.I18n.t("js.notice_successful_create"),notice_successful_delete:this.I18n.t("js.notice_successful_delete")},this.galleryOptions=[{width:"100%",height:"400px",startIndex:0,image:!1,thumbnailsColumns:1,thumbnailsAutoHide:!1,thumbnailSize:"contain",imageAnimation:"",previewAnimation:!1,previewCloseOnEsc:!0,previewKeyboardNavigation:!0,imageSize:"contain",imageArrowsAutoHide:!0,thumbnailsMargin:5,thumbnailMargin:5,previewDownload:!0,previewCloseOnClick:!0,arrowPrevIcon:"icon-arrow-left2",arrowNextIcon:"icon-arrow-right2",closeIcon:"icon-close",downloadIcon:"icon-download",thumbnailActions:this.actions(),actions:this.actions()},{breakpoint:800,width:"100%",height:"400px",imagePercent:80,thumbnailsPercent:20,thumbnailsMargin:5,thumbnailMargin:5},{breakpoint:680,height:"200px",thumbnailsColumns:3,thumbnailsMargin:5,thumbnailMargin:5}],this.viewpoints=[],this.galleryImages=[],this.viewAllowed=!1,this.createAllowed=!1,this.viewerVisible=!1}ngAfterViewInit(){this.observeChanges()}ngOnInit(){this.viewerBridge.viewerVisible$.subscribe(W=>{this.viewerVisible=!!W,this.cdRef.detectChanges()})}observeChanges(){this.apiV3Service.work_packages.id(this.workPackage).requireAndStream().pipe(this.untilDestroyed()).subscribe(W=>(0,r.mG)(this,void 0,void 0,function*(){this.workPackage=W,this.projectId||(yield this.initialize(this.workPackage)),W.bcfViewpoints&&this.refreshViewpoints(W.bcfViewpoints)}))}initialize(W){return(0,r.mG)(this,void 0,void 0,function*(){this.projectId=(0,y.Z)(W.project.href),this.viewAllowed=yield this.bcfAuthorization.isAllowedTo(this.projectId,"project_actions","viewTopic"),this.createAllowed=yield this.bcfAuthorization.isAllowedTo(this.projectId,"topic_actions","createViewpoint"),this.loadViewpointFromRoute(W),this.cdRef.detectChanges()})}refreshViewpoints(W){this.viewpoints=W.map(Y=>({href:Y.href,snapshotURL:`${Y.href}/snapshot`})),this.setViewpointsOnGallery(this.viewpoints)}showViewpoint(W,Y){if(this.bcfViewer&&this.viewerBridge.shouldShowViewer){switch(this.bcfViewer.currentViewerState()){case"table":this.bcfViewer.update("splitTable");break;case"cards":this.bcfViewer.update("splitCards")}this.viewerBridge.viewerVisible$.pipe((0,Q.h)($=>$),(0,F.q)(1)).subscribe(()=>this.viewerBridge.showViewpoint(W,Y))}else this.viewerBridge.showViewpoint(W,Y)}deleteViewpoint(W,Y){!window.confirm(this.text.text_are_you_sure)||this.viewpointsService.deleteViewPoint$(W,Y).subscribe(()=>{this.toastService.addSuccess(this.text.notice_successful_delete),this.gallery.preview.close()})}saveViewpoint(W){this.viewpointsService.saveViewpoint$(W).subscribe(()=>{this.toastService.addSuccess(this.text.notice_successful_create),this.showIndex=this.viewpoints.length})}loadViewpointFromRoute(W){if("number"==typeof this.state.params.viewpoint){const Y=this.state.params.viewpoint;this.showViewpoint(W,Y),this.showIndex=Y,this.selectViewpointInGallery(),this.state.go(".",Object.assign(Object.assign({},this.state.params),{viewpoint:void 0}),{reload:!1})}}shouldShowGroup(){return this.viewAllowed&&(this.viewpoints.length>0||this.createAllowed&&this.viewerVisible)}actions(){return[{icon:"icon-view-model",onClick:(W,Y)=>{this.showViewpoint(this.workPackage,Y),this.gallery.preview.close()},titleText:this.text.show_viewpoint},{icon:"icon-delete",onClick:(W,Y)=>this.deleteViewpoint(this.workPackage,Y),titleText:this.text.delete_viewpoint}]}galleryPreviewOpen(){jQuery(".op-app-header").addClass("-no-z-index")}galleryPreviewClose(){jQuery(".op-app-header").removeClass("-no-z-index")}selectViewpointInGallery(){setTimeout(()=>{var W;return null===(W=this.gallery)||void 0===W?void 0:W.show(this.showIndex)},250)}onGalleryChanged(W){this.showIndex=W.index}set showIndex(W){const Y=[...this.galleryOptions];Y[0].startIndex=W,this.galleryOptions=Y}get showIndex(){return this.galleryOptions[0].startIndex}setViewpointsOnGallery(W){const{length:Y}=W;this.setThumbnailProperties(Y),this.showIndex<0||Y<1?this.showIndex=0:this.showIndex>=Y&&(this.showIndex=Y-1),this.galleryImages=W.map($=>({small:$.snapshotURL,medium:$.snapshotURL,big:$.snapshotURL})),this.cdRef.detectChanges()}setThumbnailProperties(W){const Y=[...this.galleryOptions];Y[0].thumbnailsColumns=W<5?W:4,Y[1].thumbnailsColumns=W<5?W:4,Y[2].thumbnailsColumns=W<4?W:3,Y[0].height=`${this.dynamicThumbnailHeight(W)}px`,Y[1].height=`${this.dynamicThumbnailHeight(W)}px`,Y[2].height=`${this.dynamicThumbnailHeight(W)}px`,this.galleryOptions=Y}dynamicThumbnailHeight(W){return Math.max(Math.round(300/W),120)}}te.\u0275fac=function(W){return new(W||te)(i.Y36(k.StateService),i.Y36(L),i.Y36(C.L),i.Y36(D.T),i.Y36(T.P),i.Y36(E.kl),i.Y36(G.zJ,8),i.Y36(i.sBO),i.Y36(b.D),i.Y36(p.V))},te.\u0275cmp=i.Xpm({type:te,selectors:[["ng-component"]],viewQuery:function(W,Y){if(1&W&&i.Gf(d.g$,5),2&W){let $;i.iGM($=i.CRH())&&(Y.gallery=$.first)}},inputs:{workPackage:"workPackage"},features:[i._Bn([p.V]),i.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"attributes-group","description-group"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],["class","bcf--viewpoints",4,"ngIf"],["class","button",3,"title","click",4,"ngIf"],[1,"bcf--viewpoints"],[3,"options","images","change","imagesReady","previewOpen","previewClose"],[1,"button",3,"title","click"],["icon-classes","button--icon icon-add"],[1,"button--text"]],template:function(W,Y){1&W&&i.YNc(0,se,7,3,"ng-container",0),2&W&&i.Q6J("ngIf",Y.shouldShowGroup())},directives:[v.O5,d.g$,V.o],styles:[".bcf--viewpoints[_ngcontent-%COMP%]{clear:both}ngx-gallery[_ngcontent-%COMP%]{display:inline-block}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-thumbnails .ngx-gallery-arrow{color:var(--content-link-color)}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-arrow.ngx-gallery-disabled{display:none}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper{background:rgba(255,255,255,.5);padding:5px}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper .ngx-gallery-icon{margin-top:0}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper ngx-gallery-action:last-of-type .ngx-gallery-icon{margin-right:0}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail{background-color:#fff}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail.ngx-gallery-clickable .ngx-gallery-icon{font-size:1.25rem;color:var(--content-link-color)}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-active, ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail{border:1px solid #E7E7E7!important}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-preview-img{background-color:#fff}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-preview{background:rgba(0,0,0,.8)!important}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-preview a:hover{color:#fff}"],changeDetection:0});var ie=t(79902),le=t(42720),oe=t(84699);function ne(J,W){if(1&J){const Y=i.EpF();i.TgZ(0,"div",7),i.TgZ(1,"ngx-gallery",8),i.NdJ("change",function(be){return i.CHM(Y),i.oxw(2).onGalleryChanged(be)})("imagesReady",function(){return i.CHM(Y),i.oxw(2).selectViewpointInGallery()})("previewOpen",function(){return i.CHM(Y),i.oxw(2).galleryPreviewOpen()})("previewClose",function(){return i.CHM(Y),i.oxw(2).galleryPreviewClose()}),i.qZA(),i.qZA()}if(2&J){const Y=i.oxw(2);i.xp6(1),i.Q6J("options",Y.galleryOptions)("images",Y.galleryImages)}}function fe(J,W){if(1&J){const Y=i.EpF();i.TgZ(0,"a",9),i.NdJ("click",function(){i.CHM(Y);const be=i.oxw(2);return be.saveViewpoint(be.workPackage)}),i._UZ(1,"op-icon",10),i.TgZ(2,"span",11),i._uU(3),i.qZA(),i.qZA()}if(2&J){const Y=i.oxw(2);i.Q6J("title",Y.text.add_viewpoint),i.xp6(3),i.hij(" ",Y.text.viewpoint," ")}}function ve(J,W){if(1&J&&(i.ynx(0),i.TgZ(1,"div",1),i.TgZ(2,"div",2),i.TgZ(3,"div",3),i._UZ(4,"h3",4),i.qZA(),i.qZA(),i.YNc(5,ne,2,2,"div",5),i.YNc(6,fe,4,2,"a",6),i.qZA(),i.BQk()),2&J){const Y=i.oxw();i.xp6(4),i.Q6J("textContent",Y.text.bcf),i.xp6(1),i.Q6J("ngIf",Y.galleryImages.length>0),i.xp6(1),i.Q6J("ngIf",Y.viewerVisible&&Y.createAllowed)}}class Se extends te{constructor(){super(...arguments),this.galleryViewpoints=[]}ngAfterViewInit(){this.viewerVisible&&(super.ngAfterViewInit(),(0,oe.Z)(this.workPackage)&&this.observeCreation())}observeCreation(){this.wpCreate.onNewWorkPackage().pipe(this.untilDestroyed(),(0,F.q)(1),(0,ie.w)(W=>this.viewpointsService.setBcfTopic$(W),W=>W),(0,ie.w)(W=>{this.workPackage=W;const Y=this.galleryViewpoints.filter($=>!$.href&&$.viewpoint).map($=>this.viewpointsService.saveViewpoint$(this.workPackage,$.viewpoint));return(0,le.D)(Y)})).subscribe(()=>{this.showIndex=this.galleryViewpoints.length-1})}showViewpoint(W,Y){}deleteViewpoint(W,Y){this.galleryViewpoints=this.galleryViewpoints.filter(($,be)=>be!==Y),this.setViewpointsOnGallery(this.galleryViewpoints)}saveViewpoint(){this.viewerBridge.getViewpoint$().subscribe(W=>{const Y={snapshotURL:W.snapshot.snapshot_data,viewpoint:W};this.galleryViewpoints=[...this.galleryViewpoints,Y],this.setViewpointsOnGallery(this.galleryViewpoints),this.showIndex=this.galleryViewpoints.length-1,this.selectViewpointInGallery()})}shouldShowGroup(){return this.createAllowed&&this.viewerVisible}actions(){return super.actions().filter(W=>"icon-delete"===W.icon)}}Se.\u0275fac=function(){let J;return function(Y){return(J||(J=i.n5z(Se)))(Y||Se)}}(),Se.\u0275cmp=i.Xpm({type:Se,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"attributes-group","description-group"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],["class","bcf--viewpoints",4,"ngIf"],["class","button",3,"title","click",4,"ngIf"],[1,"bcf--viewpoints"],[3,"options","images","change","imagesReady","previewOpen","previewClose"],[1,"button",3,"title","click"],["icon-classes","button--icon icon-add"],[1,"button--text"]],template:function(W,Y){1&W&&i.YNc(0,ve,7,3,"ng-container",0),2&W&&i.Q6J("ngIf",Y.shouldShowGroup())},directives:[v.O5,d.g$,V.o],styles:[".bcf--viewpoints[_ngcontent-%COMP%]{clear:both}ngx-gallery[_ngcontent-%COMP%]{display:inline-block}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-thumbnails .ngx-gallery-arrow{color:var(--content-link-color)}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-arrow.ngx-gallery-disabled{display:none}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper{background:rgba(255,255,255,.5);padding:5px}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper .ngx-gallery-icon{margin-top:0}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper ngx-gallery-action:last-of-type .ngx-gallery-icon{margin-right:0}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail{background-color:#fff}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail.ngx-gallery-clickable .ngx-gallery-icon{font-size:1.25rem;color:var(--content-link-color)}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-active, ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail{border:1px solid #E7E7E7!important}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-preview-img{background-color:#fff}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-preview{background:rgba(0,0,0,.8)!important}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-preview a:hover{color:#fff}"],changeDetection:0});var Oe=t(76491),je=t(79441),tt=t(83720),He=t(20088);class st extends C.L{constructor(W){super(W),this.injector=W,this.shouldShowViewer=!1,this.viewerVisible$=new Oe.X(!1),this.revitMessageReceivedSource=new je.xQ,this.trackingIdNumber=0,this.revitMessageReceived$=this.revitMessageReceivedSource.asObservable(),window.RevitBridge?this.hookUpRevitListener():window.addEventListener("revit.plugin.ready",()=>{this.hookUpRevitListener()},{once:!0})}viewerVisible(){return this.viewerVisible$.getValue()}getViewpoint$(){const W=this.newTrackingId();return this.sendMessageToRevit("ViewpointGenerationRequest",W,""),this.revitMessageReceived$.pipe((0,tt.x)(),(0,Q.h)(Y=>"ViewpointData"===Y.messageType&&Y.trackingId===W),(0,He.P)(),(0,R.U)(Y=>{const $=Y.messagePayload;return $.snapshot.hasOwnProperty("snapshot_type")&&$.snapshot.hasOwnProperty("snapshot_data")||($.snapshot={snapshot_type:"png",snapshot_data:$.snapshot}),$}))}showViewpoint(W,Y){this.viewpointsService.getViewPoint$(W,Y).subscribe($=>this.sendMessageToRevit("ShowViewpoint",this.newTrackingId(),JSON.stringify($)))}sendMessageToRevit(W,Y,$){!this.viewerVisible()||window.RevitBridge.sendMessageToRevit(W,Y,$)}hookUpRevitListener(){window.RevitBridge.sendMessageToOpenProject=W=>{const{messageType:Y,trackingId:$,messagePayload:be}=JSON.parse(W);this.revitMessageReceivedSource.next({messageType:Y,trackingId:$,messagePayload:JSON.parse(be)})},this.viewerVisible$.next(!0)}newTrackingId(){return this.trackingIdNumber+=1,String(this.trackingIdNumber)}}st.\u0275fac=function(W){return new(W||st)(i.LFG(i.zs3))},st.\u0275prov=i.Yz7({token:st,factory:st.\u0275fac}),(0,r.gn)([(0,l.W)(),(0,r.w6)("design:type",p.V)],st.prototype,"viewpointsService",void 0);class ce{constructor(W){ce.bootstrap(W)}static bootstrap(W){this.bootstrapCalled||(this.bootstrapCalled=!0,W.get(h.i).addFieldType(m,"bcfThumbnail",["BCF Thumbnail"]),W.get(u.$).register("prependedAttributeGroups",be=>{if(window.OpenProject.isBimEdition)return(0,oe.Z)(be)?Se:te}))}}ce.bootstrapCalled=!1,ce.\u0275fac=function(W){return new(W||ce)(i.LFG(i.zs3))},ce.\u0275mod=i.oAB({type:ce}),ce.\u0275inj=i.cJS({providers:[{provide:C.L,useFactory:J=>window.navigator.userAgent.search("Revit")>-1?new st(J):J.get(f.T,new f.T(J)),deps:[i.zs3]},c,a.b,p.V],imports:[[e.H,d.ji]]})},64533:(X,I,t)=>{"use strict";t.d(I,{T:()=>k});var i=t(3786),e=t(62967);class d{constructor(y){this.pathHelper=y,this.ifcModels=window.gon.ifc_models}getProjects(y,b){y({projects:this.ifcModels.projects})}getProject(y,b,P){b({id:y[0].id,name:y[0].name,models:this.ifcModels.models,viewerContent:{modelsLoaded:this.ifcModels.shown_models},viewerConfigs:{}})}getGeometry(y,b,P,E){const T=this.ifcModels.xkt_attachment_ids[b];console.log(`Loading model geometry for: ${T}`),e.P6.loadArraybuffer(this.pathHelper.attachmentContentPath(T),P,E)}}var h=t(38998),r=t(76491),n=t(81134),l=t(70233),a=t(12084),m=t(29161),v=t(3412),c=t(65146),p=t(53882),f=t(34364),C=t(10190),u=t(2316);class k extends h.L{constructor(y){super(y),this.injector=y,this.shouldShowViewer=!0,this.viewerVisible$=new r.X(!1),this.inspectorVisible$=new r.X(!1)}newViewer(y,b){const P=new d(this.pathHelper),E=new f.po(P,y);E.on("modelLoaded",()=>this.viewerVisible$.next(!0)),E.loadProject(b[0].id),E.on("addModel",()=>{window.location.href=this.pathHelper.ifcModelsNewPath(this.currentProjectService.identifier)}),E.on("openInspector",()=>{this.inspectorVisible$.next(!0)}),E.on("editModel",T=>{window.location.href=this.pathHelper.ifcModelsEditPath(this.currentProjectService.identifier,T.modelId)}),E.on("deleteModel",T=>{const M=new FormData;M.append("authenticity_token",jQuery("meta[name=csrf-token]").attr("content")),M.append("_method","delete"),this.httpClient.post(this.pathHelper.ifcModelsDeletePath(this.currentProjectService.identifier,T.modelId),M).subscribe().add(()=>{window.location.reload()})}),this.viewer=E}destroy(){this.viewerVisible$.next(!1),this.viewer&&(this.viewer.destroy(),this.viewer=void 0)}get viewer(){return this.xeokitViewer}set viewer(y){this.xeokitViewer=y}setKeyboardEnabled(y){var b;null===(b=this.viewer)||void 0===b||b.setKeyboardEnabled(y)}getViewpoint$(){if(!this.viewer)return(0,n.of)();const b=this.viewer.saveBCFViewpoint({spacesVisible:!0,reverseClippingPlanes:!0});return b.bitmaps=null,(0,n.of)(b)}showViewpoint(y,b){if(this.viewerVisible()){const P={updateCompositeObjects:!0,reverseClippingPlanes:!0};this.viewpointsService.getViewPoint$(y,b).subscribe(E=>{var T;null===(T=this.viewer)||void 0===T||T.loadBCFViewpoint(E,P)})}else window.location.href=this.pathHelper.bimDetailsPath((0,C.Z)(y.project.href),y.id||"",b)}viewerVisible(){return!!this.viewer}}k.\u0275fac=function(y){return new(y||k)(u.LFG(u.zs3))},k.\u0275prov=u.Yz7({token:k,factory:k.\u0275fac}),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",l.j)],k.prototype,"pathHelper",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",a.y)],k.prototype,"bcfApi",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",v.V)],k.prototype,"viewpointsService",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",c.R)],k.prototype,"currentProjectService",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",p.eN)],k.prototype,"httpClient",void 0)},8368:(X,I,t)=>{"use strict";t.d(I,{jN:()=>n,iV:()=>l,IY:()=>a,JY:()=>m,sw:()=>v,zJ:()=>c});var i=t(96617),e=t(54592),d=t(43440),h=t(38998),r=t(2316);const n="cards",l="viewer",a="splitTable",m="splitCards",v="table";class c extends e.q{constructor(f,C,u){super(u),this.I18n=f,this.viewerBridgeService=C,this.querySpace=u,this.text={cards:this.I18n.t("js.views.card"),viewer:this.I18n.t("js.ifc_models.views.viewer"),splitTable:this.I18n.t("js.ifc_models.views.split"),splitCards:this.I18n.t("js.ifc_models.views.split_cards"),table:this.I18n.t("js.views.list")},this.icon={cards:"icon-view-card",viewer:"icon-view-model",splitTable:"icon-view-split-viewer-table",splitCards:"icon-view-split2",table:"icon-view-list"}}hasChanged(f){return this.current!==f.displayRepresentation}applyToQuery(f){return f.displayRepresentation=this.current,!0}valueFromQuery(f){const C=f.displayRepresentation;switch(C){case"splitCards":case"splitTable":case"cards":case"table":case"viewer":return C;default:return this.viewerBridgeService.shouldShowViewer?"splitCards":"cards"}}currentViewerState(){return this.current}}c.\u0275fac=function(f){return new(f||c)(r.LFG(i.D),r.LFG(h.L),r.LFG(d.q))},c.\u0275prov=r.Yz7({token:c,factory:c.\u0275fac})},84308:(X,I,t)=>{"use strict";t.d(I,{X:()=>d});var i=t(73881),e=t(2316);class d{constructor(r){this.bannersService=r,this.mapping={}}add(r,n){this.mapping[r]=n}available(){return _.map(this.mapping,(r,n)=>({attribute:n,text:r.localizedName,icon:"",description:"",image:"",disabled:this.bannersService.eeShowBanners}))}get(r){if(this.mapping[r])return this.mapping[r];throw new Error(`No action service exists for ${r}`)}}d.\u0275fac=function(r){return new(r||d)(e.LFG(i.j))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})},24335:(X,I,t)=>{"use strict";t.d(I,{s:()=>v});var i=t(3786),e=t(65146),d=t(70233),h=t(91923),r=t(96617),n=t(36293),l=t(61908),a=t(75421),m=t(2316);class v{constructor(p,f,C,u,k,O){this.CurrentProject=p,this.pathHelper=f,this.apiV3Service=C,this.halResourceService=u,this.toastService=k,this.I18n=O,this.v3=this.pathHelper.api.v3}create(p,f){const C=JSON.stringify(f);return this.apiV3Service.queries.form.loadWithParams({pageSize:0,filters:C},void 0,this.CurrentProject.identifier,this.buildQueryRequest(p)).toPromise().then(([u,k])=>{if(u.schema.public.writable)return this.apiV3Service.queries.post(k,u).toPromise();throw new Error(this.I18n.t("js.boards.error_permission_missing"))})}addFreeQuery(p,f){const C=this.freeBoardQueryFilter();return this.addQuery(p,f,[C])}addQuery(p,f,C){return(0,i.mG)(this,void 0,void 0,function*(){const u=p.queries.length;try{const O={_type:"GridWidget",identifier:"work_package_query",startRow:1,endRow:2,startColumn:u+1,endColumn:u+2,options:{queryId:(yield this.create(f,C)).id,filters:C}},y=this.halResourceService.createHalResourceOfClass(a.z,O);p.addQuery(y)}catch(k){this.toastService.addError(k),console.error(k)}return p})}buildQueryRequest(p){return Object.assign({public:!0,_links:{sortBy:[{href:`${this.v3.apiV3Base}/queries/sort_bys/manualSorting-asc`},{href:`${this.v3.apiV3Base}/queries/sort_bys/id-asc`}]}},p)}freeBoardQueryFilter(){return{manualSort:{operator:"ow",values:[]}}}}v.\u0275fac=function(p){return new(p||v)(m.LFG(e.R),m.LFG(d.j),m.LFG(l.T),m.LFG(h.u),m.LFG(n.kl),m.LFG(r.D))},v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"})},3216:(X,I,t)=>{"use strict";t.d(I,{$:()=>c});var i=t(3786),e=t(24335),d=t(91923),h=t(70233),r=t(65146),n=t(96617),l=t(84308),a=t(76491),m=t(61908),v=t(2316);class c{constructor(f,C,u,k,O,y,b){this.apiV3Service=f,this.PathHelper=C,this.CurrentProject=u,this.halResourceService=k,this.boardActions=O,this.I18n=y,this.boardsList=b,this.currentBoard$=new a.X(null),this.text={unnamed_board:this.I18n.t("js.boards.label_unnamed_board"),action_board:P=>this.I18n.t("js.boards.board_type.action_by_attribute",{attribute:this.I18n.t(`js.boards.board_type.action_type.${P}`)}),unnamed_list:this.I18n.t("js.boards.label_unnamed_list")}}loadAllBoards(f=this.CurrentProject.identifier,C=!1){return C||void 0===this.loadAllPromise?this.loadAllPromise=this.apiV3Service.boards.allInScope(f).toPromise():this.loadAllPromise}canManage(f){return!!f.grid.$links.delete}save(f){return this.reorderWidgets(f),this.apiV3Service.boards.id(f).save(f)}create(f){return(0,i.mG)(this,void 0,void 0,function*(){const C=yield this.apiV3Service.boards.create(f.type,this.boardName(f),this.CurrentProject.identifier,f.attribute).toPromise();return"free"===f.type?yield this.boardsList.addFreeQuery(C,{name:this.text.unnamed_list}):yield this.boardActions.get(f.attribute).addInitialColumnsForAction(C),yield this.save(C).toPromise(),C})}delete(f){return this.apiV3Service.boards.id(f).delete().toPromise()}boardName(f){return f.boardName?f.boardName:"action"===f.type?this.text.action_board(f.attribute):this.text.unnamed_board}reorderWidgets(f){f.grid.columnCount=Math.max(f.grid.widgets.length,1),f.grid.widgets.map((C,u)=>(C.startColumn=u+1,C.endColumn=u+2,C))}}c.\u0275fac=function(f){return new(f||c)(v.LFG(m.T),v.LFG(h.j),v.LFG(r.R),v.LFG(d.u),v.LFG(l.X),v.LFG(n.D),v.LFG(e.s))},c.\u0275prov=v.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"})},64538:(X,I,t)=>{"use strict";t.d(I,{h:()=>e});var i=t(2316);class e{constructor(){this.causedUpdates=[]}includes(h){return this.causedUpdates.includes(this.cacheValue(h))}add(h){this.causedUpdates.length>100&&this.causedUpdates.splice(0,90),this.causedUpdates.push(this.cacheValue(h))}cacheValue(h){return h.updatedAt+h.href}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac})},56945:(X,I,t)=>{"use strict";t.d(I,{r:()=>E});var i=t(60312),e=t(77355),d=t(96617),h=t(47775),r=t(3216),n=t(84308),l=t(86469),a=t(67727),m=t(97656),v=t(73881),c=t(36293),p=t(27779),f=t(2316),C=t(54364);function u(T,M){if(1&T){const S=f.EpF();f.TgZ(0,"button",2),f.NdJ("click",function(){const L=f.CHM(S).$implicit;return f.oxw().created(L.attribute)}),f._UZ(1,"img",3),f.TgZ(2,"div"),f.TgZ(3,"span",4),f._uU(4),f.qZA(),f._UZ(5,"p",5),f.qZA(),f.qZA()}if(2&T){const S=M.$implicit,R=f.oxw();f.Q6J("disabled",S.disabled||R.disable),f.xp6(1),f.Q6J("src",S.image,f.LSH),f.xp6(3),f.Oqu(S.text),f.xp6(1),f.Q6J("textContent",S.description)}}class k{constructor(){this.disable=!1,this.create=new f.vpe}created(M){this.create.emit(M)}}k.\u0275fac=function(M){return new(M||k)},k.\u0275cmp=f.Xpm({type:k,selectors:[["tile-view"]],inputs:{tiles:"tiles",disable:"disable"},outputs:{create:"create"},decls:2,vars:1,consts:[[1,"op-tile-block"],["class","op-tile-block--tile button","data-qa-selector","op-tile-block","type","button",3,"disabled","click",4,"ngFor","ngForOf"],["data-qa-selector","op-tile-block","type","button",1,"op-tile-block--tile","button",3,"disabled","click"],[1,"op-tile-block--image",3,"src"],["data-qa-selector","op-tile-block-title",1,"op-tile-block--title"],[1,"op-tile-block--description",3,"textContent"]],template:function(M,S){1&M&&(f.TgZ(0,"div",0),f.YNc(1,u,6,4,"button",1),f.qZA()),2&M&&(f.xp6(1),f.Q6J("ngForOf",S.tiles))},directives:[C.sg],styles:[".op-tile-block[_ngcontent-%COMP%]{display:grid;grid-template-rows:repeat(minmax(200px,auto));grid-template-columns:auto auto;grid-column-gap:10px;grid-row-gap:10px}.op-tile-block--tile[_ngcontent-%COMP%]{border-radius:10px;display:grid;grid-template:95px 1fr/1fr;grid-template-columns:auto 1fr auto;grid-template-rows:auto;grid-row-gap:5px;justify-items:left;background:#f7fafc;min-height:150px;margin:auto}.op-tile-block--tile[_ngcontent-%COMP%]:disabled{background:#fafafa}.op-tile-block--tile[_ngcontent-%COMP%]:hover{text-decoration:none;border:1px solid grey;border-radius:10px!important;cursor:pointer}.op-tile-block--image[_ngcontent-%COMP%]{display:block;margin-top:auto;margin-bottom:auto}.op-tile-block--title[_ngcontent-%COMP%]{padding-top:30px;padding-bottom:5px;color:var(--primary-color-dark);display:block;text-align:left;font-weight:bolder;font-size:large}.op-tile-block--description[_ngcontent-%COMP%]{text-align:left;width:90%}"],changeDetection:0});var O=t(8158);const y=["actionAttributeSelect"];function b(T,M){if(1&T&&(f.TgZ(0,"p"),f._UZ(1,"op-enterprise-banner",11),f.qZA()),2&T){const S=f.oxw();f.xp6(1),f.Q6J("linkMessage",S.text.upgrade_to_ee_text)("textMessage",S.text.teaser_text)("moreInfoLink",S.text.more_info_ee_link)}}function P(T,M){if(1&T&&f._UZ(0,"p",12),2&T){const S=f.oxw();f.Q6J("textContent",S.text.select_board_type)}}class E extends i.T{constructor(M,S,R,F,L,D,G,Q,V,K,q,se){super(M,R,S),this.locals=M,this.elementRef=S,this.cdRef=R,this.state=F,this.boardService=L,this.boardActions=D,this.halNotification=G,this.loadingIndicatorService=Q,this.I18n=V,this.boardActionRegistry=K,this.bannersService=q,this.toastService=se,this.showClose=!0,this.confirmed=!1,this.available=this.boardActions.available(),this.inFlight=!1,this.eeShowBanners=!1,this.text={close_popup:this.I18n.t("js.close_popup_title"),free_board:this.I18n.t("js.boards.board_type.free"),free_board_text:this.I18n.t("js.boards.board_type.free_text"),free_board_title:this.I18n.t("js.boards.board_type.board_type_title.basic"),board_type:this.I18n.t("js.boards.board_type.text"),action_board:this.I18n.t("js.boards.board_type.action"),action_board_text:this.I18n.t("js.boards.board_type.action_text"),select_attribute:this.I18n.t("js.boards.board_type.select_attribute"),select_board_type:this.I18n.t("js.boards.board_type.select_board_type"),placeholder:this.I18n.t("js.placeholders.selection"),teaser_text:this.I18n.t("js.boards.upsale.teaser_text"),upgrade_to_ee_text:this.I18n.t("js.boards.upsale.upgrade"),more_info_ee_link:p.rj.boards,cancel_button:this.I18n.t("js.button_cancel")},this.initiateTiles()}ngOnInit(){super.ngOnInit(),this.eeShowBanners=this.bannersService.eeShowBanners}createBoard(M){"basic"===M?this.createFree():this.createAction(M)}initiateTiles(){this.available.unshift({attribute:"basic",text:this.text.free_board_title,icon:"icon-boards",description:this.text.free_board_text,image:(0,m.h)("board_creation_modal/lists.svg")}),this.addIcon(this.available),this.addDescription(this.available),this.addText(this.available),this.addImage(this.available)}createFree(){this.create({type:"free"})}createAction(M){this.eeShowBanners?this.toastService.addError(this.I18n.t("js.upsale.ee_only")):this.create({type:"action",attribute:M})}create(M){this.inFlight=!0,this.loadingIndicatorService.modal.promise=this.boardService.create(M).then(S=>{this.inFlight=!1,this.closeMe(),this.state.go("boards.partitioned.show",{board_id:S.id,isNew:!0})}).catch(S=>{this.inFlight=!1,this.halNotification.handleRawError(S)})}addDescription(M){M.forEach(S=>{if("basic"!==S.attribute){const R=this.boardActionRegistry.get(S.attribute);S.description=R.description}})}addIcon(M){M.forEach(S=>{if("basic"!==S.attribute){const R=this.boardActionRegistry.get(S.attribute);S.icon=R.icon}})}addText(M){M.forEach(S=>{if("basic"!==S.attribute){const R=this.boardActionRegistry.get(S.attribute);S.text=R.text}})}addImage(M){M.forEach(S=>{if("basic"!==S.attribute){const R=this.boardActionRegistry.get(S.attribute);S.image=R.image}})}}E.\u0275fac=function(M){return new(M||E)(f.Y36(e.E),f.Y36(f.SBq),f.Y36(f.sBO),f.Y36(h.StateService),f.Y36(r.$),f.Y36(n.X),f.Y36(a.W),f.Y36(l.vt),f.Y36(d.D),f.Y36(n.X),f.Y36(v.j),f.Y36(c.kl))},E.\u0275cmp=f.Xpm({type:E,selectors:[["ng-component"]],viewQuery:function(M,S){if(1&M&&f.Gf(y,7),2&M){let R;f.iGM(R=f.CRH())&&(S.actionAttributeSelect=R.first)}},features:[f.qOj],decls:13,vars:6,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_wide","confirm-form-submit--modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[4,"ngIf"],[3,"textContent",4,"ngIf"],[1,"new-board--section"],[3,"tiles","disable","create"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],["opReferrer","boards",3,"linkMessage","textMessage","moreInfoLink"],[3,"textContent"]],template:function(M,S){1&M&&(f.TgZ(0,"div",0),f.TgZ(1,"div",1),f._uU(2),f.qZA(),f._UZ(3,"div",2),f.TgZ(4,"div",3),f.YNc(5,b,2,3,"p",4),f.YNc(6,P,1,1,"p",5),f.TgZ(7,"section",6),f.TgZ(8,"tile-view",7),f.NdJ("create",function(F){return S.createBoard(F)}),f.qZA(),f.qZA(),f.qZA(),f.TgZ(9,"div",8),f.TgZ(10,"div",9),f.TgZ(11,"button",10),f.NdJ("click",function(){return S.closeMe()}),f._uU(12),f.qZA(),f.qZA(),f.qZA(),f.qZA()),2&M&&(f.xp6(2),f.Oqu(S.text.board_type),f.xp6(3),f.Q6J("ngIf",S.eeShowBanners),f.xp6(1),f.Q6J("ngIf",!S.eeShowBanners),f.xp6(2),f.Q6J("tiles",S.available)("disable",S.inFlight),f.xp6(4),f.hij(" ",S.text.cancel_button," "))},directives:[C.O5,k,O.P],encapsulation:2})},18640:(X,I,t)=>{"use strict";t.d(I,{j:()=>r});var i=t(79441),e=t(26942),d=t(52377),h=t(2316);class r extends e.N{constructor(l){super(),this.weekdayService=l,this.resize$=new i.xQ}resizeObserver(l){!l||(this.resizeObs||(this.resizeObs=new ResizeObserver(()=>this.resize$.next())),this.resizeObs.observe(l.nativeElement))}applyNonWorkingDay({date:l}){return l&&this.weekdayService.isNonWorkingDay(l)?["fc-non-working-day"]:[]}}r.\u0275fac=function(l){return new(l||r)(h.LFG(d.u))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac})},89118:(X,I,t)=>{"use strict";t.d(I,{W:()=>Q});var i=t(3786),e=t(96617),d=t(12877),h=t(44022),r=t(70482),n=t(36293),l=t(74647),a=t(61043),m=t(43440),v=t(26942),c=t(53466),p=t(91923),f=t(55977),C=t(61908),u=t(47775),k=t(70692),O=t(81539),y=t(12703),b=t(2281),E=t(60914),T=t(67325),M=t(20506),S=t(3352),R=t(99794),F=t(20342),L=t(18640),D=t(2316),G=t(71570);class Q extends v.N{constructor(K,q,se,te,ie,le,oe,ne,fe,ve,Se,Oe,je,tt,He,st,Me,ce,J,W){super(),this.I18n=K,this.configuration=q,this.sanitizer=se,this.$state=te,this.injector=ie,this.schemaCache=le,this.toastService=oe,this.wpTableFilters=ne,this.wpListService=fe,this.wpListChecksumService=ve,this.urlParamsHelper=Se,this.querySpace=Oe,this.apiV3Service=je,this.halResourceService=tt,this.uiRouterGlobals=He,this.timezoneService=st,this.halEditing=Me,this.wpTableSelection=ce,this.contextMenuService=J,this.calendarService=W,this.currentWorkPackages$=this.querySpace.results.values$().pipe((0,c.q)(1))}workPackagesListener$(K){this.querySpace.results.values$().pipe(this.untilDestroyed()).subscribe(()=>{K()})}calendarOptions(K){return Object.assign(Object.assign({},this.defaultOptions()),K)}eventDate(K,q){return this.isMilestone(K)?K.date:K[`${q}Date`]}isMilestone(K){return this.schemaCache.of(K).isMilestone}warnOnTooManyResults(K,q=!1){K.count<K.total?this.tooManyResultsText=this.I18n.t("js.calendar.too_many",{count:K.total,max:Q.MAX_DISPLAYED}):this.tooManyResultsText=null,this.tooManyResultsText&&!q&&this.toastService.addNotice(this.tooManyResultsText)}updateTimeframe(K,q){return(0,i.mG)(this,void 0,void 0,function*(){if(this.areFiltersEmpty&&this.querySpace.query.value)return Promise.resolve();const se=b(K.start).format("YYYY-MM-DD"),te=b(K.end).format("YYYY-MM-DD");let le,ie=null;if(this.urlParams.query_id&&(ie=this.urlParams.query_id),this.initializingWithQuery){const oe=yield this.apiV3Service.queries.find({pageSize:0},ie).toPromise();le=this.generateQueryProps(oe,se,te)}else if(this.initializingWithQueryProps)if(this.urlParams.query_props){const oe=JSON.parse(this.urlParams.query_props),ne=Object.assign(Object.assign({},oe),{f:[...oe.f.filter(fe=>"datesInterval"!==fe.n),Q.dateFilter(se,te)]});le=JSON.stringify(ne)}else le=Q.defaultQueryProps(se,te);else le=this.generateQueryProps(this.querySpace.query.value,se,te),this.wpListChecksumService.set(ie,le);return this.wpListService.fromQueryParams({query_id:ie,query_props:le},q||void 0).toPromise()})}generateQueryProps(K,q,se){return this.urlParamsHelper.encodeQueryJsonParams(K,te=>Object.assign(Object.assign({},te),{pp:Q.MAX_DISPLAYED,pa:1,f:[...te.f.filter(ie=>"datesInterval"!==ie.n),Q.dateFilter(q,se)]}))}get initialView(){return this.urlParams.cview}dateEditable(K){const q=this.schemaCache.of(K),se=q.isAttributeEditable("startDate")&&q.isAttributeEditable("dueDate");return(K.isLeaf||K.scheduleManually)&&se}eventDurationEditable(K){return this.dateEditable(K)&&!this.isMilestone(K)}getEndDateFromTimestamp(K){return b(K).subtract(1,"d").format("YYYY-MM-DD")}openSplitView(K,q=!1){this.wpTableSelection.setSelection(K,-1),(!q||this.$state.includes("**.details.*"))&&this.$state.go(`${(0,r.W)(this.$state)}.tabs`,{workPackageId:K,tabIdentifier:"overview"})}openFullView(K){this.wpTableSelection.setSelection(K,-1),this.$state.go("work-packages.show",{workPackageId:K})}onCardClicked({workPackageId:K,event:q}){(0,T.F)(q)||this.openSplitView(K,!0)}onCardDblClicked({workPackageId:K,event:q}){(0,T.F)(q)||this.openFullView(K)}showEventContextMenu({workPackageId:K,event:q}){if((0,T.F)(q))return;if(q.target.closest(`.${M.yF}`))return void(0,S.qu)("Allowing original context menu on state link");this.wpTableSelection.setSelection(K,-1),q.preventDefault();const se=new R.X(this.injector,K,jQuery(q.target));this.contextMenuService.show(se,q)}defaultOptions(){return{editable:!1,locale:this.I18n.locale,fixedWeekCount:!1,firstDay:this.configuration.startOfWeek(),timeZone:this.configuration.isTimezoneSet()?this.configuration.timezone():"local",height:"auto",headerToolbar:{left:"prev,next today",center:"title",right:""},initialDate:this.initialDate,initialView:this.initialView,datesSet:K=>this.updateDateParam(K),dayHeaderClassNames:K=>this.calendarService.applyNonWorkingDay(K),dayCellClassNames:K=>this.calendarService.applyNonWorkingDay(K),dayGridClassNames:K=>this.calendarService.applyNonWorkingDay(K),slotLaneClassNames:K=>this.calendarService.applyNonWorkingDay(K),slotLabelClassNames:K=>this.calendarService.applyNonWorkingDay(K)}}static defaultQueryProps(K,q){const se={c:["id"],t:"id:asc",f:[{n:"status",o:"*",v:[]},this.dateFilter(K,q)],dr:"cards",hi:!1,pp:Q.MAX_DISPLAYED,pa:1};return JSON.stringify(se)}static dateFilter(K,q){return{n:"datesInterval",o:"<>d",v:[K,q]}}get initializingWithQueryProps(){return this.areFiltersEmpty||this.urlParams.query_props}get initializingWithQuery(){return this.areFiltersEmpty&&!!this.urlParams.query_id&&!this.urlParams.query_props}get urlParams(){return this.uiRouterGlobals.params}get areFiltersEmpty(){return this.wpTableFilters.isEmpty}get initialDate(){const K=this.urlParams.cdate;if(K)return this.timezoneService.formattedISODate(K)}updateDateParam(K){this.$state.go(".",{cdate:this.timezoneService.formattedISODate(K.view.currentStart),cview:K.view.type},{custom:{notify:!1}})}updateDates(K){const q=K.event.extendedProps.workPackage,se=this.halEditing.edit(q);se.setValue("startDate",K.event.startStr);const te=b(K.event.endStr).subtract(1,"day").format("YYYY-MM-DD");return se.setValue("dueDate",te),se}}Q.MAX_DISPLAYED=100,Q.\u0275fac=function(K){return new(K||Q)(D.LFG(e.D),D.LFG(d.e),D.LFG(G.H7),D.LFG(u.StateService),D.LFG(D.zs3),D.LFG(h.y),D.LFG(n.kl),D.LFG(l.Z),D.LFG(a.Z),D.LFG(O.Y),D.LFG(f.Z),D.LFG(m.q),D.LFG(C.T),D.LFG(p.u),D.LFG(u.UIRouterGlobals),D.LFG(k.B),D.LFG(y.l),D.LFG(E.J),D.LFG(F.$),D.LFG(L.j))},Q.\u0275prov=D.Yz7({token:Q,factory:Q.\u0275fac})},51303:(X,I,t)=>{"use strict";t.r(I),t.d(I,{OpenprojectCalendarModule:()=>Q});var i=t(21757),e=t(91594),d=t(7794),h=t(84906),r=t(2246),n=t(54349),l=t(46430),a=t(85603),m=t(1813),v=t(15334),c=t(57973),p=t(77434),f=t(22956),C=t(11266),u=t(52025),k=t(91654),O=t(43882),y=t(2316),b=t(54364),P=t(77616),E=t(81628),T=t(32853);function M(V,K){if(1&V&&y._UZ(0,"op-back-button",11),2&V){const q=y.oxw();y.Q6J("customBackMethod",q.backButtonCallback)}}function S(V,K){if(1&V&&(y.TgZ(0,"li",15),y._UZ(1,"ndc-dynamic",16),y.qZA()),2&V){const q=y.oxw().$implicit,se=y.oxw(2);y.Q6J("ngClass",q.containerClasses),y.xp6(1),y.Q6J("ndcDynamicComponent",q.component)("ndcDynamicInputs",q.inputs)("ndcDynamicInjector",se.injector)("ndcDynamicOutputs",q.outputs)}}function R(V,K){if(1&V&&(y.ynx(0),y.YNc(1,S,2,5,"li",14),y.BQk()),2&V){const q=K.$implicit;y.xp6(1),y.Q6J("ngIf",!q.show||q.show())}}function F(V,K){if(1&V&&(y.TgZ(0,"ul",12),y.YNc(1,R,2,1,"ng-container",13),y.qZA()),2&V){const q=y.oxw();y.xp6(1),y.Q6J("ngForOf",q.toolbarButtonComponents)}}function L(V,K){if(1&V&&y._UZ(0,"ndc-dynamic",17),2&V){const q=y.oxw();y.Q6J("ndcDynamicComponent",q.filterContainerDefinition.component)("ndcDynamicInputs",q.filterContainerDefinition.inputs)("ndcDynamicOutputs",q.filterContainerDefinition.outputs)("ndcDynamicInjector",q.injector)}}class D extends c.r{constructor(){super(...arguments),this.text={title:this.I18n.t("js.calendar.title"),unsaved_title:this.I18n.t("js.calendar.unsaved_title")},this.selectedTitle=this.text.unsaved_title,this.filterContainerDefinition={component:p.J},this.currentPartition="-split",this.showToolbar=!0,this.titleEditingEnabled=!1,this.showToolbarSaveButton=!0,this.toolbarDisabled=!1,this.toolbarButtonComponents=[{component:O.P},{component:f.U},{component:C.a},{component:u.b,containerClasses:"hidden-for-mobile",show:()=>this.authorisationService.can("query","updateImmediately"),inputs:{hideTableOptions:!0}}]}setPartition(K){var q;this.currentPartition=(null===(q=K.data)||void 0===q?void 0:q.partition)||"-split"}staticQueryName(K){return this.text.unsaved_title}loadInitialQuery(){}}D.\u0275fac=function(){let V;return function(q){return(V||(V=y.n5z(D)))(q||D)}}(),D.\u0275cmp=y.Xpm({type:D,selectors:[["ng-component"]],viewQuery:function(K,q){if(1&K&&y.Gf(v.X,7),2&K){let se;y.iGM(se=y.CRH())&&(q.calendarElement=se.first)}},features:[y._Bn([k.E]),y.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(K,q){1&K&&(y.TgZ(0,"div",0),y.TgZ(1,"div",1),y.TgZ(2,"div",2),y.YNc(3,M,1,1,"op-back-button",3),y.TgZ(4,"editable-toolbar-title",4),y.NdJ("onSave",function(te){return q.changeChangesFromTitle(te)})("onEmptySubmit",function(){return q.updateTitleName("")}),y.qZA(),y.YNc(5,F,2,1,"ul",5),y.qZA(),y.qZA(),y.TgZ(6,"div",6),y.YNc(7,L,1,4,"ndc-dynamic",7),y.qZA(),y.TgZ(8,"div",8),y._UZ(9,"div",9),y._UZ(10,"div",10),y.qZA(),y.qZA()),2&K&&(y.Q6J("ngClass",q.currentPartition),y.xp6(3),y.Q6J("ngIf",q.backButtonCallback),y.xp6(1),y.Q6J("title",q.selectedTitle)("inFlight",q.toolbarDisabled)("showSaveCondition",q.showToolbarSaveButton)("editable",q.titleEditingEnabled),y.xp6(1),y.Q6J("ngIf",q.showToolbar),y.xp6(2),y.Q6J("ngIf",q.filterContainerDefinition))},directives:[b.mk,b.O5,P.s5,h.UIView,E.W,b.sg,T.B5,T.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}"],changeDetection:0});const G=[{name:"calendar",parent:"optional_project",url:"/calendars/:query_id?&query_props&cdate&cview",redirectTo:"calendar.page",views:{"!$default":{component:m.p}},params:{query_id:{type:"opQueryId",dynamic:!0},cdate:{type:"string",dynamic:!0},cview:{type:"string",dynamic:!0},query_props:{type:"opQueryString"}}},{name:"calendar.page",component:D,redirectTo:"calendar.page.show",data:{bodyClasses:"router--calendar"}},{name:"calendar.page.show",data:{baseRoute:"calendar.page.show"},views:{"content-left":{component:v.X}}},...(0,l.Z)("calendar.page.show",void 0,a.o)];class Q{}Q.\u0275fac=function(K){return new(K||Q)},Q.\u0275mod=y.oAB({type:Q}),Q.\u0275inj=y.cJS({imports:[[i.H,h.UIRouterModule.forChild({states:G}),d.H,n.I,r.E,e.z1U]]})},15334:(X,I,t)=>{"use strict";t.d(I,{X:()=>q});var i=t(3786),e=t(2316),d=t(91594),h=t(44437),r=t(2281),l=t(79441),a=t(80639),m=t(87853),v=t(43440),c=t(74647),p=t(61043),f=t(47775),C=t(96617),u=t(36293),k=t(12877),O=t(26942),y=t(44022),b=t(65146),P=t(79474),E=t(12703),T=t(67727),M=t(70482),S=t(89118),R=t(18640),F=t(52377),L=t(71570),D=t(54364);const G=["ucCalendar"];function Q(se,te){if(1&se&&e._UZ(0,"full-calendar",4,5),2&se){const ie=e.oxw().ngIf;e.Q6J("options",ie)}}function V(se,te){if(1&se&&(e.ynx(0),e.YNc(1,Q,2,1,"full-calendar",3),e.BQk()),2&se){const ie=te.ngIf;e.xp6(1),e.Q6J("ngIf",ie)}}function K(se,te){if(1&se&&e._UZ(0,"div",6),2&se){const ie=e.oxw();e.Q6J("textContent",ie.workPackagesCalendar.tooManyResultsText)}}class q extends O.N{constructor(te,ie,le,oe,ne,fe,ve,Se,Oe,je,tt,He,st,Me,ce,J,W){super(),this.states=te,this.$state=ie,this.wpTableFilters=le,this.wpListService=oe,this.querySpace=ne,this.schemaCache=fe,this.element=ve,this.i18n=Se,this.toastService=Oe,this.sanitizer=je,this.configuration=tt,this.calendar=He,this.workPackagesCalendar=st,this.currentProject=Me,this.halEditing=ce,this.halNotification=J,this.weekdayService=W,this.static=!1,this.calendarOptions$=new l.xQ,this.alreadyLoaded=!1}set ucCalendarElement(te){this.calendar.resizeObserver(te)}ngOnInit(){this.wpTableFilters.hidden.push("project"),this.calendar.resize$.pipe(this.untilDestroyed(),(0,a.b)(50)).subscribe(()=>{this.ucCalendar.getApi().updateSize()}),this.querySpace.stopAllSubscriptions.next(),this.setupWorkPackagesListener(),this.initializeCalendar()}calendarEventsFunction(te,ie){if(this.alreadyLoaded){this.alreadyLoaded=!1;const le=this.updateResults(this.querySpace.results.value);ie(le)}else this.workPackagesCalendar.currentWorkPackages$.subscribe(le=>{const oe=this.updateResults(le);ie(oe)});this.workPackagesCalendar.updateTimeframe(te,this.currentProject.identifier||void 0)}ngOnDestroy(){var te;super.ngOnDestroy(),null===(te=this.calendar.resizeObs)||void 0===te||te.disconnect()}initializeCalendar(){const te={height:"100%",headerToolbar:this.buildHeader(),eventSources:[{id:"work_packages",events:this.calendarEventsFunction.bind(this)},{events:[],id:"background",color:"red",background:"red",textColor:"white",display:"background",editable:!1}],plugins:[h.ZP,P.ZP],selectable:!0,select:this.handleDateClicked.bind(this),eventResizableFromStart:!0,editable:!0,eventDidMount:ie=>{var le;const{el:oe,event:ne}=ie;if("background"===(null===(le=ne.source)||void 0===le?void 0:le.id))return;const fe=ne.extendedProps.workPackage;oe.dataset.workPackageId=fe.id},eventResize:ie=>this.updateEvent(ie),eventDrop:ie=>this.updateEvent(ie),eventResizeStart:ie=>{ie.event.extendedProps.workPackage.ignoreNonWorkingDays||this.addBackgroundEventsForNonWorkingDays()},eventResizeStop:()=>this.removeBackGroundEvents(),eventDragStart:ie=>{ie.event.extendedProps.workPackage.ignoreNonWorkingDays||this.addBackgroundEventsForNonWorkingDays()},eventDragStop:ie=>{const{el:le}=ie;le.style.removeProperty("pointer-events"),this.removeBackGroundEvents()},eventClick:ie=>{const le=ie.event.extendedProps.workPackage.id;this.$state.includes("calendar")?this.workPackagesCalendar.openSplitView(le):this.$state.go("work-packages.show",{workPackageId:le})}};this.static&&(te.initialView="dayGridWeek"),this.configuration.initialized.then(()=>{this.calendarOptions$.next(this.workPackagesCalendar.calendarOptions(te))})}buildHeader(){return!this.static&&{right:"dayGridMonth,dayGridWeek",center:"title",left:"prev,next today"}}openContextMenu(te){const ie=te.target.closest(".fc-event");if(!ie)return;const le=ie.dataset.workPackageId;this.workPackagesCalendar.showEventContextMenu({workPackageId:le,event:te})}setupWorkPackagesListener(){this.workPackagesCalendar.workPackagesListener$(()=>{this.alreadyLoaded=!0,this.ucCalendar.getApi().refetchEvents()})}updateResults(te){return this.workPackagesCalendar.warnOnTooManyResults(te,this.static),this.mapToCalendarEvents(te.elements)}mapToCalendarEvents(te){return te.map(ie=>{const le=this.workPackagesCalendar.eventDate(ie,"start"),oe=this.workPackagesCalendar.eventDate(ie,"due"),ne=r(oe).add(1,"days").format("YYYY-MM-DD");return{title:ie.subject,start:le,editable:this.workPackagesCalendar.eventDurationEditable(ie),end:ne,allDay:!0,className:`__hl_background_type_${ie.type.id||""}`,workPackage:ie}})}updateEvent(te){return(0,i.mG)(this,void 0,void 0,function*(){const ie=this.workPackagesCalendar.updateDates(te);try{const le=yield this.halEditing.save(ie);this.halNotification.showSave(le.resource,le.wasNew)}catch(le){this.halNotification.handleRawError(le,ie.projectedResource),te.revert()}})}handleDateClicked(te){const ie=new Date(te.start).getDate(),ne=new Date(te.end).getDate()-ie==1&&this.weekdayService.isNonWorkingDay(te.start),fe={startDate:te.startStr,dueDate:this.workPackagesCalendar.getEndDateFromTimestamp(te.endStr),ignoreNonWorkingDays:ne};this.$state.go((0,M.W)(this.$state,"new"),{defaults:fe,tabIdentifier:"overview"})}removeBackGroundEvents(){this.ucCalendar.getApi().getEvents().filter(te=>{var ie;return"background"===(null===(ie=te.source)||void 0===ie?void 0:ie.id)}).forEach(te=>te.remove())}addBackgroundEventsForNonWorkingDays(){const te=this.ucCalendar.getApi();let ie=this.ucCalendar.getApi().view.activeStart;const le=this.ucCalendar.getApi().view.activeEnd,oe=new Array;for(;ie.toString()!==le.toString();)this.weekdayService.isNonWorkingDay(ie)&&oe.push({start:r(ie).format("YYYY-MM-DD"),end:r(ie).add("1","day").format("YYYY-MM-DD")}),ie=r(ie).add("1","day").toDate();oe.forEach(ne=>{te.addEvent(Object.assign({},ne),"background")})}}q.\u0275fac=function(te){return new(te||q)(e.Y36(m.G),e.Y36(f.StateService),e.Y36(c.Z),e.Y36(p.Z),e.Y36(v.q),e.Y36(y.y),e.Y36(e.SBq),e.Y36(C.D),e.Y36(u.kl),e.Y36(L.H7),e.Y36(k.e),e.Y36(R.j),e.Y36(S.W),e.Y36(b.R),e.Y36(E.l),e.Y36(T.W),e.Y36(F.u))},q.\u0275cmp=e.Xpm({type:q,selectors:[["op-wp-calendar"]],viewQuery:function(te,ie){if(1&te&&(e.Gf(d.woE,5),e.Gf(G,5,e.SBq)),2&te){let le;e.iGM(le=e.CRH())&&(ie.ucCalendar=le.first),e.iGM(le=e.CRH())&&(ie.ucCalendarElement=le.first)}},inputs:{static:"static"},features:[e._Bn([S.W,R.j]),e.qOj],decls:4,vars:5,consts:[["data-qa-selector","op-wp-calendar",1,"op-wp-calendar",3,"contextmenu"],[4,"ngIf"],["class","op-wp-calendar--notification",3,"textContent",4,"ngIf"],[3,"options",4,"ngIf"],[3,"options"],["ucCalendar",""],[1,"op-wp-calendar--notification",3,"textContent"]],template:function(te,ie){1&te&&(e.TgZ(0,"div",0),e.NdJ("contextmenu",function(oe){return ie.openContextMenu(oe)}),e.YNc(1,V,2,1,"ng-container",1),e.ALo(2,"async"),e.YNc(3,K,1,1,"div",2),e.qZA()),2&te&&(e.uIk("data-indicator-name","table"),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,3,ie.calendarOptions$)),e.xp6(2),e.Q6J("ngIf",ie.static))},directives:[D.O5,d.woE],pipes:[D.Ov],styles:[".op-wp-calendar[_ngcontent-%COMP%]{--fc-border-color: #cccccc;min-height:200px;height:100%}.op-wp-calendar--notification[_ngcontent-%COMP%]{font-style:italic;margin-top:.5rem}"],changeDetection:0})},95060:(X,I,t)=>{"use strict";t.d(I,{d:()=>i});class i{constructor(d,h=null,r="",n="get",l=!1,a,m="application/json",v){this.requestMethod=d,this.href=h,this.title=r,this.method=n,this.templated=l,this.payload=a,this.type=m,this.identifier=v}static fromObject(d,h){return new i((r,n,l,a)=>d.request(r,n,l,a).toPromise(),h.href,h.title,h.method,h.templated,h.payload,h.type,h.identifier)}$fetch(...d){const[h,r]=d;return this.requestMethod(this.method,this.href,h,r)}$prepare(d){if(!this.templated)throw new Error(`The link ${this.href} is not templated.`);let h=_.clone(this.href)||"";return _.each(d,(r,n)=>{const l=new RegExp(`{${n}}`);h=h.replace(l,r)}),new i(this.requestMethod,h,this.title,this.method,!1,this.payload,this.type,this.identifier).$callable()}$callable(){const d=(...h)=>this.$fetch(...h);return _.extend(d,{$link:this,href:this.href,title:this.title,method:this.method,templated:this.templated,payload:this.payload,type:this.type,identifier:this.identifier}),d}}},91720:(X,I,t)=>{"use strict";t.d(I,{fK:()=>r,FQ:()=>h,EZ:()=>n});var d,i=t(43348),e=t(95060);function h(l){return _.isNil(l)?[]:l.map(a=>a.$copy())}function r(l){return _.isNil(l)?l:l.$copy()}function n(l,a){function v(y,b=!0){return _.isNil(y)?y:y._links||y._embedded||y._type?l.createHalResource(y,b):y}function C(y,b){const P=`$${y}`,E=`_${y}`,T=a.$source[E];_.isObject(T)&&Object.keys(T).forEach(M=>{d.lazy(a[P],M,()=>b(T[M]))})}function O(y,b){const P=Array.isArray(y);if(y)if(P)a.$source._links[b]=y.map(E=>({href:E.href}));else if(y.hasOwnProperty("$link")){const E=y.$link;E.href&&(a.$source._links[b]=E)}else"href"in y&&(a.$source._links[b]={href:y.href});else a.$source._links[b]={href:null};return a.$embedded&&a.$embedded[b]&&(a.$embedded[b]=y,a.$source._embedded[b]=P?y.map(E=>E.$source):_.get(y,"$source",y)),y}a.$source._links||(a.$source._links={}),a.$source._links.self||(a.$source._links.self={href:null}),C("links",y=>Array.isArray(y)?y.map(b=>e.d.fromObject(l,b).$callable()):e.d.fromObject(l,y).$callable()),C("embedded",y=>Array.isArray(y)?y.map(b=>v(b,!0)):(_.isObject(y)&&_.each(y,(b,P)=>{b&&(b._embedded||b._links)&&d.lazy(y,P,()=>v(b,!0))}),v(y,!0))),a.$embeddableKeys().forEach(y=>{Object.defineProperty(a,y,{get:()=>v(a.$source[y],!0),set(b){a.$source[y]=b},enumerable:!0,configurable:!0})}),a.$linkableKeys().forEach(y=>{d.lazy(a,y,()=>{const b=a.$links[y].$link||a.$links[y];if(Array.isArray(b)){const E=b.map(T=>l.createLinkedResource(a,y,T.$link));var P=new i(...E).on("change",()=>{P.forEach(T=>{T.$link||P.splice(P.indexOf(T),1)}),a.$source._links[y]=P.map(T=>T.$link)});return P}return b.href?"get"!==b.method?e.d.fromObject(l,b).$callable():l.createLinkedResource(a,y,b):null},b=>O(b,y))}),!a.$source._embedded||Object.keys(a.$source._embedded).forEach(y=>{d.lazy(a,y,()=>a.$embedded[y],b=>O(b,y))})}(d||(d={})).lazy=function(m,v,c,p){if(_.isObject(m)){let C,f=!1;const u={get:()=>(f||(C=c(),f=!0),C),set:()=>{},configurable:!0,enumerable:!0};p&&(u.set=k=>{C=p(k),f=!0}),Object.defineProperty(m,v,u)}}},10190:(X,I,t)=>{"use strict";function i(e){const d=(e||"").split("/").pop();return decodeURIComponent(d)}t.d(I,{Z:()=>i})},84699:(X,I,t)=>{"use strict";t.d(I,{m:()=>i,Z:()=>e});const i="new";function e(d){return!d.id||d.id===i}},48934:(X,I,t)=>{"use strict";function i(e){return!(!e.id||"new"===e.id)}t.d(I,{Z:()=>i})},18869:(X,I,t)=>{"use strict";t.d(I,{i:()=>e,s:()=>d});var i=t(2316);const e="X-External-Request";class d{intercept(r,n){return"true"!==r.headers.get(e)?this.handleAuthenticatedRequest(r,n):this.handleExternalRequest(r,n)}handleExternalRequest(r,n){const l=r.clone({withCredentials:!1,headers:r.headers.delete(e)});return n.handle(l)}handleAuthenticatedRequest(r,n){const l=jQuery("meta[name=csrf-token]").attr("content");let a=r.headers.set("X-Authentication-Scheme","Session").set("X-Requested-With","XMLHttpRequest");l&&(a=a.set("X-CSRF-TOKEN",l));const m=r.clone({withCredentials:!0,headers:a});return n.handle(m)}}d.\u0275fac=function(r){return new(r||d)},d.\u0275prov=i.Yz7({token:d,factory:d.\u0275fac})},6496:(X,I,t)=>{"use strict";t.d(I,{f:()=>W});var i=t(2316),e=t(53882),d=t(54364),h=t(96617),r=t(80044),n=t(85758),l=t(8849);class a extends i.qLn{constructor($){super(),this.I18n=$,this.text={internal_error:this.I18n.t("js.error.internal")}}handleError($){var be,N;let Ue=this.text.internal_error;(null===(be=$)||void 0===be?void 0:be.rejection)instanceof l.o?this.handleError($.rejection):($ instanceof l.o?(console.error("Returned HTTP HAL error resource %O",$.message),Ue=(null===(N=$.httpError)||void 0===N?void 0:N.status)>=500?`${Ue} ${$.message}`:$.message,a.captureError($.httpError)):$ instanceof n.Xf?(console.error("Returned error resource %O",$),Ue+=` ${$.errorMessages.join("\n")}`):$ instanceof r.X?(console.error("Returned hal resource %O",$),Ue+=`Resource returned ${$.name}`):$ instanceof Error?window.ErrorReporter.captureException($):$ instanceof e.UA?(a.captureError($),Ue=$.message):"string"==typeof $&&(window.ErrorReporter.captureMessage($),Ue=$),super.handleError(Ue))}static captureError($){window.ErrorReporter.captureException($)}}a.\u0275fac=function($){return new($||a)(i.LFG(h.D))},a.\u0275prov=i.Yz7({token:a,factory:a.\u0275fac});var m=t(24897),v=t(84481),c=t(20501),p=t(17577),f=t(53407),C=t(67248);class u extends r.X{constructor(){super(...arguments),this.attachmentsBackend=!1}}const k=(0,C.n)(u);class O extends r.X{constructor(){super(...arguments),this.attachmentsBackend=!1}}const y=(0,C.n)(O);class b extends r.X{constructor(){super(...arguments),this.attachmentsBackend=!1}}const P=(0,C.n)(b);var E=t(34863),T=t(54475),M=t(75421),S=t(46384);class R extends r.X{get state(){return this.states.timeEntries.get(this.id)}$linkableKeys(){return _.without(super.$linkableKeys(),"schema")}}class F extends r.X{}var L=t(92814);class D extends r.X{}var G=t(4816),Q=t(9214);class V extends r.X{}class K extends r.X{}class q extends r.X{get state(){return this.states.types.get(this.href)}}var se=t(10190);class te extends r.X{get id(){return this.$source.id||(0,se.Z)(this.href)}set id($){this.$source.id=$}}var ie=t(63085);class le extends r.X{getErrors(){const $=_.values(this.validationErrors),be=$.length;if(0===be)return null;let N;return 1===be?N=new n.Xf(this.injector,$[0],!0,this.halInitializer,"Error"):(N=new n.Xf(this.injector,{},!0,this.halInitializer,"Error"),N.errorIdentifier=n.$5,N.errors=$),N.isValidationError=!0,N}}class oe extends r.X{}const ne=(0,C.n)(oe);class fe extends r.X{get state(){return this.states.schemas.get(this.href)}get availableAttributes(){return _.keys(this.$source).filter($=>0!==$.indexOf("_"))}attributeFromLocalizedName($){let be=null;for(const N of this.availableAttributes){const Ue=this[N];if((null==Ue?void 0:Ue.name)===$){be=N;break}}return be}}class Se extends r.X{forValue($){return this.dependencies[$]}}class Oe extends fe{constructor(){super(...arguments),this.type="QueryFilterInstanceSchema"}get availableOperators(){return this.operator.allowedValues}get allowedFilterValue(){return this.filter.allowedValues instanceof c.Y?this.filter.allowedValues.elements[0]:this.filter.allowedValues[0]}$initialize($){super.$initialize($),$._dependencies&&(this.dependency=new Se(this.injector,$._dependencies[0],!0,this.halInitializer,"SchemaDependency"))}getFilter(){const $=this.operator.allowedValues[0],be=this.filter.allowedValues[0],N={name:be.name,_links:{filter:be.$source._links.self,schema:this.$source._links.self,operator:$.$source._links.self}};return this.definesAllowedValues()?N._links.values=[]:N.values=[],new ie.L(this.injector,N,!0,this.halInitializer,"QueryFilterInstance")}isValueRequired(){return!!this.values}isResourceValue(){return!(!this.values||!this.values.allowedValues)}loadedAllowedValues(){var $;return Array.isArray(null===($=this.values)||void 0===$?void 0:$.allowedValues)}resultingSchema($){const be=this.$source,N=this.dependency.forValue($.href.toString()),Ue={};return _.merge(Ue,be,N),new Oe(this.injector,Ue,!0,this.halInitializer,"QueryFilterInstanceSchema")}definesAllowedValues(){return _.some(this._dependencies[0].dependencies,$=>$.values&&$.values._links&&$.values._links.allowedValues)}}class je extends c.Y{}var tt=t(69057),He=t(63588);const st={WorkPackage:{cls:m.X,attrTypes:{parent:"WorkPackage",ancestors:"WorkPackage",children:"WorkPackage",relations:"Relation",schema:"Schema",status:"Status",type:"Type"}},Activity:{cls:r.X,attrTypes:{user:"User"}},"Activity::Comment":{cls:r.X,attrTypes:{user:"User"}},"Activity::Revision":{cls:r.X,attrTypes:{user:"User"}},Relation:{cls:tt.d,attrTypes:{from:"WorkPackage",to:"WorkPackage"}},Schema:{cls:fe},Type:{cls:q},Status:{cls:E.F},SchemaDependency:{cls:Se},Error:{cls:n.Xf},User:{cls:v.q},Group:{cls:V},Collection:{cls:c.Y},WorkPackageCollection:{cls:je},AttachmentCollection:{cls:T.e},Query:{cls:p.P,attrTypes:{filters:"QueryFilterInstance"}},Form:{cls:le,attrTypes:{payload:"FormPayload"}},FormPayload:{cls:r.X,attrTypes:{attachments:"AttachmentsCollection"}},QueryFilterInstance:{cls:ie.L,attrTypes:{schema:"QueryFilterInstanceSchema",filter:"QueryFilter",operator:"QueryOperator"}},QueryFilterInstanceSchema:{cls:Oe},QueryFilter:{cls:He.e},Root:{cls:K},QueryOperator:{cls:te},HelpText:{cls:ne},CustomAction:{cls:f.M},WikiPage:{cls:k},MeetingContent:{cls:y},Post:{cls:P},Project:{cls:Q.c},Role:{cls:G.q},Grid:{cls:S.H},GridWidget:{cls:M.z},TimeEntry:{cls:R},Membership:{cls:D},News:{cls:F},Version:{cls:L.g}};var ce=t(91923),J=t(67727);class W{}W.\u0275fac=function($){return new($||W)},W.\u0275mod=i.oAB({type:W}),W.\u0275inj=i.cJS({providers:[{provide:i.qLn,useClass:a},{provide:i.ip1,useFactory:function(Y){return()=>{_.each(st,($,be)=>Y.registerResource(be,$))}},deps:[ce.u],multi:!0},J.W],imports:[[d.ez,e.JF]]})},54475:(X,I,t)=>{"use strict";t.d(I,{e:()=>e});var i=t(20501);class e extends i.Y{$initialize(h){super.$initialize(h),this.elements=this.elements||[]}}},20501:(X,I,t)=>{"use strict";t.d(I,{Y:()=>e});var i=t(80044);class e extends i.X{updateElements(){return this.href?this.$load().then(h=>this.elements=h.elements):Promise.resolve()}}},53407:(X,I,t)=>{"use strict";t.d(I,{M:()=>e});var i=t(80044);class e extends i.X{}},85758:(X,I,t)=>{"use strict";t.d(I,{$5:()=>d,G$:()=>h,Xf:()=>r});var i=t(80044);const d="urn:openproject-org:api:v3:errors:MultipleErrors";function h(n){return"_type"in n&&"message"in n&&"errorIdentifier"in n}class r extends i.X{constructor(){super(...arguments),this.isValidationError=!1}toString(){return`[ErrorResource ${this.message}]`}get errorMessages(){return this.isMultiErrorMessage()?this.errors.map(l=>l.message):[this.message]}isMultiErrorMessage(){return this.errorIdentifier===d}getInvolvedAttributes(){let l=[];return this.details?l=[{details:this.details}]:this.errors&&(l=this.errors),_.flatten(l.map(a=>a.errorIdentifier===d?this.extractMultiError(a)[0]:a.details.attribute))}getMessagesPerAttribute(){const l={};return this.details?l[this.details.attribute]=[this.message]:_.forEach(this.errors,a=>{if(a.errorIdentifier===d){const[m,v]=this.extractMultiError(a),c=l[m]||[];l[m]=c.concat(v)}else l[a.details.attribute]?l[a.details.attribute].push(a.message):l[a.details.attribute]=[a.message]}),l}extractMultiError(l){const{attribute:a}=l.errors[0].details;return[a,l.errors.map(v=>v.message)]}}},46384:(X,I,t)=>{"use strict";t.d(I,{H:()=>n});var i=t(3786),e=t(80044),d=t(75421),h=t(67248);class r extends e.X{constructor(){super(...arguments),this.attachmentsBackend=!0}$initialize(a){super.$initialize(a),this.widgets=this.widgets.map(m=>{const v=new d.z(this.injector,m,!0,this.halInitializer,"GridWidget");return v.grid=this,v})}updateAttachments(){return(0,i.mG)(this,void 0,void 0,function*(){return this.attachments.$update().then(()=>(this.states.forResource(this).putValue(this),this.attachments))})}}const n=(0,h.n)(r)},75421:(X,I,t)=>{"use strict";t.d(I,{z:()=>r});var i=t(3786),e=t(80044),d=t(29161),h=t(91923);class r extends e.X{get height(){return this.endRow-this.startRow}get width(){return this.endColumn-this.startColumn}get schema(){return this.halResource.createHalResource({_type:"Schema"},!0)}}(0,i.gn)([(0,d.W)(),(0,i.w6)("design:type",h.u)],r.prototype,"halResource",void 0)},80044:(X,I,t)=>{"use strict";t.d(I,{X:()=>l});var i=t(3786),e=t(87853),d=t(96617),h=t(29161),r=t(10190),n=t(84699);class l{constructor(m,v,c,p,f){this.injector=m,this.$source=v,this.$loaded=c,this.halInitializer=p,this.$links={},this.$embedded={},this.$halType=f,this.$initialize(v)}static getEmptyResource(m={href:null}){return{_links:{self:m}}}static matchFromLink(m,v){const c=new RegExp(`/api/v3/${v}/(\\d+)`).exec(m);return c&&c[1]}$initialize(m){this.$source=m.$source||m,this.halInitializer(this)}toString(){return this.href?`[HalResource href=${this.href}]`:`[HalResource id=${this.id}]`}get id(){if(this.$source.id)return this.$source.id.toString();const m=(0,r.Z)(this.href);return/^\d+$/.exec(m)?m:null}set id(m){this.$source.id=m}retainFrom(m){this.__initialized_at=m.__initialized_at}$copy(m={}){return new(0,this.constructor)(this.injector,_.merge(this.$plain(),m),this.$loaded,this.halInitializer,this.$halType)}$plain(){return _.cloneDeep(this.$source)}get $isHal(){return!0}get $link(){return this.$links.self.$link}get name(){return this._name||this.$link.title||""}set name(m){this._name=m}get href(){return this.$link.href}get state(){return null}push(m){return this.state&&this.state.putValue(m),Promise.resolve()}previewPath(){if((0,n.Z)(this)&&this.project)return this.project.href}getEditorContext(m){return{type:"constrained"}}$load(m=!1){if(!this.state)return this.$loadResource(m);const{state:v}=this;return m&&v.clear(),v.putFromPromiseIfPristine(()=>this.$loadResource(m)),v.valuesPromise().then(c=>(this.$initialize(c),this.$loaded=!0,this))}$loadResource(m=!1){if(!m){if(this.$loaded)return Promise.resolve(this);if(!this.$loaded&&this.$self)return this.$self}return this.$loaded=!1,this.$self=this.$links.self({}).then(v=>(this.$loaded=!0,this.$initialize(v.$source),this)),this.$self}$update(){return this.$load(!0)}$embeddableKeys(){const m=Object.keys(this.$source);return _.without(m,"_links","_embedded","id")}$linkableKeys(){const m=Object.keys(this.$links);return _.without(m,"self")}}(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",e.G)],l.prototype,"states",void 0),(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",d.D)],l.prototype,"I18n",void 0)},67248:(X,I,t)=>{"use strict";t.d(I,{n:()=>v});var i=t(67727),e=t(70233),d=t(36293),h=t(12877),r=t(61908),n=t(48249),l=t(76825),a=t(54475),m=t(84699);function v(c){return class extends c{get canAddAttachments(){return!!this.$links.addAttachment||(0,m.Z)(this)}get hasAttachments(){return _.get(this.attachments,"elements.length",0)>0}lookupDownloadLocationByName(p){if(!this.attachments||!this.attachments.elements)return null;const f=_.find(this.attachments.elements,C=>C.name===p);return _.get(f,"staticDownloadLocation.href",null)}removeAttachment(p){return _.pull(this.attachments.elements,p),p.$isHal?p.delete().then(()=>{this.attachmentsBackend?this.updateAttachments():this.attachments.count=Math.max(this.attachments.count-1,0)}).catch(f=>{this.halNotification.handleRawError(f,this),this.attachments.elements.push(p)}):Promise.resolve()}updateAttachments(){return this.attachments.updateElements().then(()=>(this.updateState(),this.attachments))}uploadAttachments(p){const{uploads:f,finished:C}=this.performUpload(p),u=I18n.t("js.label_upload_notification"),k=this.ToastService.addAttachmentUpload(u,f);return C.then(O=>(setTimeout(()=>this.ToastService.remove(k),700),this.attachments.count+=O.length,O.forEach(y=>{this.attachments.elements.push(y.response)}),this.updateState(),O)).catch(O=>{let y;return console.error("Error while uploading: %O",O),y=O.error instanceof ErrorEvent?this.I18n.t("js.error_attachment_upload",{error:O}):"Error"===_.get(O,"error._type")?O.error.message:O.error,this.halNotification.handleRawError(y),y||I18n.t("js.error.internal")})}performUpload(p){let f=this.directUploadURL||"";return f?this.opDirectFileUpload.uploadAndMapResponse(f,p):(f=!(0,m.Z)(this)&&this.id&&this.attachmentsBackend?this.addAttachment.$link.href:this.apiV3Service.attachments.path,this.opFileUpload.uploadAndMapResponse(f,p))}get directUploadURL(){return this.$links.prepareAttachment?this.$links.prepareAttachment.href:(0,m.Z)(this)?this.config.prepareAttachmentURL:null}updateState(){this.state&&this.state.putValue(this)}$initialize(p){this.ToastService||(this.ToastService=this.injector.get(d.kl)),this.halNotification||(this.halNotification=this.injector.get(i.W)),this.opFileUpload||(this.opFileUpload=this.injector.get(l.r)),this.opDirectFileUpload||(this.opDirectFileUpload=this.injector.get(n.c)),this.config||(this.config=this.injector.get(h.e)),this.pathHelper||(this.pathHelper=this.injector.get(e.j)),this.apiV3Service||(this.apiV3Service=this.injector.get(r.T)),super.$initialize(p);const f=this.attachments||{$source:{},elements:[]};this.attachments=new a.e(this.injector,f,!1,this.halInitializer,"HalResource")}}}},9214:(X,I,t)=>{"use strict";t.d(I,{c:()=>e});var i=t(80044);class e extends i.X{get state(){return this.states.projects.get(this.id)}getEditorContext(h){return-1!==["statusExplanation","description"].indexOf(h)?{type:"full",macros:"resource"}:{type:"constrained"}}$linkableKeys(){return _.without(super.$linkableKeys(),"schema")}}},63085:(X,I,t)=>{"use strict";t.d(I,{L:()=>l});var i=t(3786),e=t(29161),d=t(44022),h=t(70233),r=t(80044),n=t(10190);class l extends r.X{constructor(){super(...arguments),this.memoizedCurrentSchemas={}}$initialize(m){super.$initialize(m),this.$links.schema={href:`${this.pathHelper.api.v3.apiV3Base}/queries/filter_instance_schemas/${(0,n.Z)(this.filter.href)}`}}get id(){return this.filter.id}get name(){return this.filter.name}get currentSchema(){if(!this.operator)return null;const m=this.operator.href.toString();if(void 0===this.memoizedCurrentSchemas[m])try{this.memoizedCurrentSchemas[m]=this.schemaCache.of(this).resultingSchema(this.operator)}catch(v){console.error(`Failed to access filter schema${v}`)}return this.memoizedCurrentSchemas[m]}isCompletelyDefined(){return this.values.length||this.currentSchema&&!this.currentSchema.isValueRequired()}findOperator(m){return _.find(this.schemaCache.of(this).availableOperators,v=>v.id===m)}isTemplated(){let m=!1;return this.values.find(v=>{m=((null==v?void 0:v.href)||v.toString()||"").includes("{id}")}),m}}(0,i.gn)([(0,e.W)(d.y),(0,i.w6)("design:type",d.y)],l.prototype,"schemaCache",void 0),(0,i.gn)([(0,e.W)(h.j),(0,i.w6)("design:type",h.j)],l.prototype,"pathHelper",void 0)},63588:(X,I,t)=>{"use strict";t.d(I,{e:()=>d});var i=t(80044),e=t(10190);class d extends i.X{get id(){return this.$source.id||(0,e.Z)(this.href)}set id(r){this.$source.id=r}}},17577:(X,I,t)=>{"use strict";t.d(I,{P:()=>d});var i=t(80044),e=t(63085);class d extends i.X{setSortBy(r){this.sortBy=r}$initialize(r){super.$initialize(r),this.filters=this.filters.map(n=>new e.L(this.injector,n,!0,this.halInitializer,"QueryFilterInstance"))}}},15893:(X,I,t)=>{"use strict";t.d(I,{S9:()=>e,iV:()=>d});t(80044);const e="urn:openproject-org:api:v3:queries:directions:asc",d="urn:openproject-org:api:v3:queries:directions:desc"},69057:(X,I,t)=>{"use strict";t.d(I,{d:()=>d});var i=t(80044),e=t(10190);class d extends i.X{static RELATION_TYPES(r=!0){const n=["relates","duplicates","duplicated","blocks","blocked","precedes","follows","includes","partof","requires","required"];return r&&n.push("parent","children"),n}static LOCALIZED_RELATION_TYPES(r=!0){return d.RELATION_TYPES(r).map(l=>({name:l,label:I18n.t(`js.relation_labels.${l}`)}))}static DEFAULT(){return"relates"}normalizedType(r){return this.denormalized(r).relationType}denormalized(r){const n=this.to.href===r.href?"from":"to";return{target:this[n],targetId:this[n].id,relationType:"from"===n?this.reverseType:this.type,reverseRelationType:"from"===n?this.type:this.reverseType}}isInvolved(r){return _.values(this.ids).indexOf(r.toString())>=0}get ids(){return{from:(0,e.Z)(this.from.href),to:(0,e.Z)(this.to.href)}}updateDescription(r){return this.$links.updateImmediately({description:r})}updateType(r){return this.$links.updateImmediately({type:r})}}},4816:(X,I,t)=>{"use strict";t.d(I,{q:()=>e});var i=t(80044);class e extends i.X{}},34863:(X,I,t)=>{"use strict";t.d(I,{F:()=>e});var i=t(80044);class e extends i.X{get state(){return this.states.statuses.get(this.href)}}},84481:(X,I,t)=>{"use strict";t.d(I,{q:()=>e});var i=t(80044);class e extends i.X{static get active_user_statuses(){return["active","registered"]}get state(){return this.states.users.get(this.href)}get showUserPath(){return this.showUser?this.showUser.$link.href:null}get isActive(){return e.active_user_statuses.indexOf(this.status)>=0}}},92814:(X,I,t)=>{"use strict";t.d(I,{g:()=>e});var i=t(80044);class e extends i.X{isLocked(){return"locked"===this.status}isOpen(){return"open"===this.status}isClosed(){return"closed"===this.status}}},24897:(X,I,t)=>{"use strict";t.d(I,{X:()=>k});var i=t(3786),e=t(96617),d=t(87853),h=t(70233),r=t(36293),n=t(54892),l=t(62964),a=t(29161),m=t(61908),v=t(76825),c=t(54475),p=t(80044),f=t(67248),C=t(84699);class u extends p.X{constructor(){super(...arguments),this.attachmentsBackend=!0}get ancestorIds(){const{ancestors:y}=this;return y.map(b=>b.id)}subjectWithType(y=40){return`${this.type?`${this.type.name}: `:""}${this.subjectWithId(y)}`}subjectWithId(y=40){const b=(0,C.Z)(this)?"":` (#${this.id})`;return`${_.truncate(this.subject,{length:y})}${b}`}get isLeaf(){const{children:y}=this.$links;return!(y&&y.length>0)}previewPath(){return(0,C.Z)(this)?super.previewPath():this.apiV3Service.work_packages.id(this.id).path}getEditorContext(y){return Object.assign({type:"description"===y?"full":"constrained",macros:!1},y.startsWith("customField")&&{disabledMentions:["user"]})}isParentOf(y){var b;return(null===(b=y.parent)||void 0===b?void 0:b.$links.self.$link.href)===this.$links.self.$link.href}updateLinkedResources(...y){const b={};y.forEach(E=>{const T=this[E];b[E]=T?T.$update():Promise.reject(void 0)});const P=Promise.all(_.values(b));return P.then(()=>{this.wpCacheService.touch(this.id)}),P}$initialize(y){super.$initialize(y);const b=this.attachments||{$source:{},elements:[]};this.attachments=new c.e(this.injector,_.get(b,"$source",b),!1,this.halInitializer,"HalResource")}$linkableKeys(){return _.without(super.$linkableKeys(),"schema")}get state(){return this.states.workPackages.get(this.id)}push(y){return this.wpActivity.clear(y.id),y.parent&&this.apiV3Service.work_packages.id(y.parent).refresh(),this.apiV3Service.work_packages.cache.updateWorkPackage(y)}}(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",e.D)],u.prototype,"I18n",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",d.G)],u.prototype,"states",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",n.a)],u.prototype,"wpActivity",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",m.T)],u.prototype,"apiV3Service",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",r.kl)],u.prototype,"ToastService",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",l.q)],u.prototype,"workPackageNotificationService",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",h.j)],u.prototype,"pathHelper",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",v.r)],u.prototype,"opFileUpload",void 0);const k=(0,f.n)(u)},26784:(X,I,t)=>{"use strict";t.d(I,{u:()=>e});var i=t(80044);class e{static extractPayload(h,r=null){return h instanceof i.X&&r?this.extractPayloadFromSchema(h,r):!h||h instanceof i.X?{}:h}static extractPayloadFromSchema(h,r){const n={_links:{}},l=[];for(const a in r)r.hasOwnProperty(a)&&r[a]&&r[a].writable&&(h.$links[a]?Array.isArray(h[a])?n._links[a]=_.map(h[a],m=>({href:m.href})):n._links[a]={href:h[a]&&h[a].href}:l.push(a));return _.each(l,a=>{(h.hasOwnProperty(a)||h[a])&&(Array.isArray(h[a])?n[a]=_.map(h[a],m=>m instanceof i.X?this.extractPayloadFromSchema(m,m.currentSchema||m.schema):m):n[a]=h[a])}),n}}},81531:(X,I,t)=>{"use strict";t.d(I,{V:()=>e});var i=t(84699);class e{constructor(h,r){this.schema=h,this.resource=r}static create(h,r){return new Proxy(h,new this(h,r))}get(h,r,n){switch(r){case"ofProperty":return this.proxyMethod(this.ofProperty);case"isAttributeEditable":return this.proxyMethod(this.isAttributeEditable);case"mappedName":return this.proxyMethod(this.mappedName);case"isEditable":return this.isEditable;default:return Reflect.get(h,r,n)}}ofProperty(h){const r=this.schema[this.mappedName(h)];return r?Object.assign(Object.assign({},r),{writable:this.isEditable&&r&&r.writable}):null}isAttributeEditable(h){const r=this.ofProperty(h);return!!r&&r.writable}get isEditable(){return(0,i.Z)(this.resource)||!!this.resource.$links.update}mappedName(h){return h}proxyMethod(h){const r=this;return new Proxy(h,{apply:(n,l,a)=>h.apply(r,[a[0]])})}}},81923:(X,I,t)=>{"use strict";t.d(I,{X:()=>e});var i=t(81531);class e extends i.V{get(h,r,n){switch(r){case"isMilestone":return this.isMilestone;case"isReadonly":return this.isReadonly;default:return super.get(h,r,n)}}ofProperty(h){if("combinedDate"===h){const r=super.ofProperty("startDate");return r?(r.writable=r.writable||this.isAttributeEditable("dueDate")||this.isAttributeEditable("scheduleManually"),r):null}return super.ofProperty(h)}get isReadonly(){var h;return this.resource.readonly||!!(null===(h=this.resource.status)||void 0===h?void 0:h.isReadonly)}isAttributeEditable(h){return(!this.isReadonly||"status"===h)&&(["startDate","dueDate","date"].includes(h)&&this.resource.scheduleManually?super.isAttributeEditable("scheduleManually"):super.isAttributeEditable(h))}get isMilestone(){return this.schema.hasOwnProperty("date")}mappedName(h){return!this.isMilestone||"startDate"!==h&&"dueDate"!==h?h:"date"}}},8849:(X,I,t)=>{"use strict";t.d(I,{o:()=>i});class i extends Error{constructor(d,h){super(),this.httpError=d,this.resource=h,this.name="HALError",Object.setPrototypeOf(this,i.prototype)}get message(){var d,h;return(null===(d=this.resource)||void 0===d?void 0:d.message)||(null===(h=this.httpError)||void 0===h?void 0:h.message)||"Unknown error"}get errorIdentifier(){var d;return(null===(d=this.resource)||void 0===d?void 0:d.errorIdentifier)||"unknown"}}},1403:(X,I,t)=>{"use strict";t.d(I,{J:()=>n});var i=t(79441),e=t(9170),d=t(96330),h=t(80639),r=t(2316);class n{constructor(){this._events=new i.xQ,this.events$=this._events.asObservable()}aggregated$(a,m=500){return this.events$.pipe((0,e.h)(v=>v.resourceType===a),(0,d.f)(this.events$.pipe((0,h.b)(m))))}push(a,m){m.id=a.id,m.resourceType=a._type,this._events.next(m)}}n.\u0275fac=function(a){return new(a||n)},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})},67727:(X,I,t)=>{"use strict";t.d(I,{W:()=>C});var i=t(3786),e=t(47775),d=t(91923),h=t(86469),r=t(36293),n=t(96617),l=t(53882),a=t(80044),m=t(29161),v=t(44022),c=t(85758),p=t(8849),f=t(2316);class C{constructor(k){this.injector=k}showSave(k,O=!1){const y={message:this.I18n.t("js.notice_successful_"+(O?"create":"update"))};this.ToastService.addSuccess(y)}handleRawError(k,O){if(console.error("Handling error message %O for work package %O",k,O),k instanceof p.o&&O)return this.handleErrorResponse(k.resource,O);const y=this.retrieveError(k);if(y instanceof a.X)return this.handleErrorResponse(y,O);"string"!=typeof k?k instanceof Error?this.ToastService.addError(k.message):this.showGeneralError(y||k):this.ToastService.addError(k)}retrieveErrorMessage(k){const O=this.retrieveError(k);return O instanceof c.Xf||O instanceof p.o?O.message:"string"==typeof O?O:this.I18n.t("js.error.internal")}retrieveError(k){let O=k;return k instanceof l.UA&&(O=k.message||k.error),"Error"===_.get(k,"data._type")&&(O=k.data),O&&"Error"===O._type?this.halResourceService.createHalResourceOfClass(c.Xf,O):O}handleErrorResponse(k,O){return k instanceof p.o&&O?this.showError(k.resource,O):k instanceof c.Xf?O?this.showError(k,O):this.showApiErrorMessages(k):this.showGeneralError(k)}showError(k,O){this.showCustomError(k,O)||this.showApiErrorMessages(k)}showGeneralError(k){let O=this.I18n.t("js.error.internal");("string"==typeof k||_.has(k,"toString"))&&(O+=` ${k.toString()}`),this.ToastService.addError(O)}showEditingBlockedError(k){this.ToastService.addError(this.I18n.t("js.hal.error.edit_prohibited",{attribute:k}))}showCustomError(k,O){if("urn:openproject-org:api:v3:errors:PropertyFormatError"===k.errorIdentifier){const y=this.schemaCache.of(O).ofProperty(k.details.attribute),b=y.name,E=`js.hal.error.format.${y.type.toLowerCase()}`;return void 0!==this.I18n.lookup(E)&&(this.ToastService.addError(this.I18n.t(E,{attribute:b})),!0)}return!1}showApiErrorMessages(k){const O=k.errorMessages;return O.length>1?this.ToastService.addError("",O):this.ToastService.addError(O[0]),!0}}C.\u0275fac=function(k){return new(k||C)(f.LFG(f.zs3))},C.\u0275prov=f.Yz7({token:C,factory:C.\u0275fac}),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",n.D)],C.prototype,"I18n",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",e.StateService)],C.prototype,"$state",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",d.u)],C.prototype,"halResourceService",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",r.kl)],C.prototype,"ToastService",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",h.vt)],C.prototype,"loadingIndicator",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",v.y)],C.prototype,"schemaCache",void 0)},29092:(X,I,t)=>{"use strict";t.d(I,{h:()=>e});var i=t(2316);class e{constructor(){this.config={user:"name",project:"name"}}sort(h,r){if(0===h.length)return h;const n=r||h[0]._type;if(!n)return h;const l=this.sortingProperty(n);return l?_.sortBy(h,a=>a[l].toLowerCase()):h}sortingProperty(h){return h=h.toLowerCase().replace(/^\[\]/,""),this.config[h]}hasSortingProperty(h){return void 0!==this.sortingProperty(h)}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},91923:(X,I,t)=>{"use strict";t.d(I,{u:()=>u});var i=t(53882),e=t(33927),d=t(18293),h=t(45871),r=t(23376),n=t(47174),l=t(3352),a=t(95060),m=t(51784),v=t(80044),c=t(91720),p=t(8849),f=t(23237),C=t(2316);class u{constructor(O,y){this.injector=O,this.http=y,this.config={}}request(O,y,b,P={}){if("get"===O)return this.get(y,b,P);const E={body:b||{},headers:P,withCredentials:!0,responseType:"json"};return this.performRequest(O,y,E)}performRequest(O,y,b){return this.http.request(O,y,b).pipe((0,e.U)(P=>this.createHalResource(P)),(0,d.K)(P=>((0,l.SC)(()=>console.error(`Failed to ${O} ${y}: ${P.name}`)),this.createErrorObservable(P))))}get(O,y,b){const P={headers:b,params:new i.LE({encoder:new m.c,fromObject:y}),withCredentials:!0,responseType:"json"};return this.performRequest("get",O,P)}getAllPaginated(O,y={},b={}){return(0,f.JQ)(P=>{const E=Object.assign(Object.assign({},y),P);return this.request("get",O,this.toEprops(E),b)},y.pageSize||-1)}put(O,y,b){return this.request("put",O,y,b)}post(O,y,b){return this.request("post",O,y,b)}patch(O,y,b){return this.request("patch",O,y,b)}delete(O,y,b){return this.request("delete",O,y,b)}registerResource(O,y){this.config[O]=y}get defaultClass(){return v.X}createHalResource(O,y=!0){_.isNil(O)&&(O=v.X.getEmptyResource());const b=O._type||"HalResource";return this.createHalResourceOfType(b,O,y)}createHalResourceOfType(O,y,b=!1){return new(this.getResourceClassOfType(O))(this.injector,y,b,M=>(0,c.EZ)(this,M),O)}createHalResourceOfClass(O,y,b=!1){const E=y._type||"HalResource";return new O(this.injector,y,b,M=>(0,c.EZ)(this,M),E)}fromLink(O){const y=v.X.getEmptyResource(a.d.fromObject(this,O));return this.createHalResource(y,!1)}fromSelfLink(O){const y={_links:{self:{href:O}}};return this.createHalResource(y)}createLinkedResource(O,y,b){const P=v.X.getEmptyResource(),E=O.$halType,T=this.getResourceClassOfAttribute(E,y)||"HalResource";return P._links.self=b,this.createHalResourceOfType(T,P,!1)}getResourceClassOfType(O){const y=this.config[O];return y&&y.cls?y.cls:this.defaultClass}getResourceClassOfAttribute(O,y){const b=this.config[O];return(b&&b.attrTypes||{})[y]}toEprops(O){const y=r.Wt(JSON.stringify(O));return{eprops:n.J2(y)}}createErrorObservable(O){var y;let b=null;const P=O.error;return"object"==typeof P&&(null===(y=P)||void 0===y?void 0:y._type)&&(b=this.createHalResource(O.error)),(0,h._)(new p.o(O,b))}}u.\u0275fac=function(O){return new(O||u)(C.LFG(C.zs3),C.LFG(i.eN))},u.\u0275prov=C.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})},51784:(X,I,t)=>{"use strict";t.d(I,{c:()=>i});class i{encodeKey(d){return encodeURIComponent(d)}encodeValue(d){return encodeURIComponent(d)}decodeKey(d){return decodeURIComponent(d)}decodeValue(d){return decodeURIComponent(d)}}},13623:(X,I,t)=>{"use strict";t.d(I,{L:()=>b});var i=t(3786),e=t(19100);let h=class extends e.yh{constructor(){super({totalUnread:0})}};h=(0,i.gn)([(0,e.yC)({name:"ian-bell"}),(0,i.w6)("design:paramtypes",[])],h);var r=t(31909),n=t(33905),l=t(84515),a=t(33927),m=t(98636),v=t(18293),c=t(8117),p=t(15347),f=t(9170);class C extends e.AE{constructor(E){super(E),this.store=E,this.unread$=this.select("totalUnread"),this.unreadCountIncreased$=this.unread$.pipe((0,p.G)(),(0,f.h)(([T,M])=>M>T),(0,a.U)(([,T])=>T))}}var u=t(44838),k=t(78509),O=t(60419),y=t(2316);let b=class{constructor(E,T){this.actions$=E,this.resourceService=T,this.id="ian-bell",this.store=new h,this.query=new C(this.store),this.unread$=this.query.unread$,this.query.unreadCountIncreased$.pipe((0,l.T)(1)).subscribe(M=>{this.actions$.dispatch((0,k.vw)({origin:this.id,count:M}))})}fetchUnread(){return this.resourceService.fetchNotifications({filters:n.yz.unread,pageSize:0}).pipe((0,a.U)(E=>E.total),(0,m.b)(E=>{this.store.update({totalUnread:E})},E=>{console.error("Failed to load notifications: %O",E),this.store.update({totalUnread:-1})}),(0,v.K)(()=>c.E))}reloadOnNotificationRead(E){this.store.update(({totalUnread:T})=>({totalUnread:T-E.notifications.length}))}};b.\u0275fac=function(E){return new(E||b)(y.LFG(O.b),y.LFG(r.W))},b.\u0275prov=y.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),(0,i.gn)([(0,u.B)(k.A6),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[void 0]),(0,i.w6)("design:returntype",void 0)],b.prototype,"reloadOnNotificationRead",null),b=(0,i.gn)([u.b,(0,i.w6)("design:paramtypes",[O.b,r.W])],b)},33905:(X,I,t)=>{"use strict";t.d(I,{yz:()=>h,m8:()=>n});var i=t(3786),e=t(19100),d=t(24782);const h={unread:[["readIAN","=",!1]],all:[]};let n=class extends e.yh{constructor(){super({params:{pageSize:d.Z,page:1},filters:{},activeCollection:{ids:[]},activeFacet:"unread",notLoaded:0})}};n=(0,i.gn)([(0,e.yC)({name:"ian-center"}),(0,i.w6)("design:paramtypes",[])],n)},27835:(X,I,t)=>{"use strict";t.r(I),t.d(I,{OpenProjectInAppNotificationsModule:()=>pe});var i=t(21757),e=t(54364),d=t(53875),h=t(12702),r=t(61908),n=t(10190),l=t(96617),a=t(70692),m=t(33927),v=t(83720),c=t(70233),p=t(23896),f=t(80044),C=t(3786),u=t(2316),k=t(79902),O=t(53466),y=t(51253),b=t(80639),P=t(98636),E=t(67202),T=t(94236),M=t(92597),S=t(42720),R=t(79441),F=t(30400),L=t(19100),D=t(36293),G=t(78509),Q=t(44838),V=t(60419),K=t(31909),q=t(96725),se=t(33905),te=t(26942),ie=t(47775),le=t(53916);let oe=class extends te.N{constructor(he,ue,Le,ht,pt,Zt,Ct,ni,_i){var ri;super(),this.I18n=he,this.injector=ue,this.resourceService=Le,this.actions$=ht,this.apiV3Service=pt,this.toastService=Zt,this.uiRouterGlobals=Ct,this.state=ni,this.deviceService=_i,this.id="ian-center",this.store=new se.m8,this.query=new L.AE(this.store),this.activeFacet$=this.query.select("activeFacet"),this.notLoaded$=this.query.select("notLoaded"),this.paramsChanges$=this.query.select(["params","activeFacet"]),this.activeCollection$=this.query.select("activeCollection"),this.loading$=this.query.selectLoading(),this.selectNotifications$=this.activeCollection$.pipe((0,k.w)(ut=>(0,S.D)(ut.ids.map(ke=>this.resourceService.lookup(ke).pipe((0,O.q)(1)))).pipe((0,y.d)([])))),this.aggregatedCenterNotifications$=this.selectNotifications$.pipe((0,m.U)(ut=>_.groupBy(ut,ze=>{var ke;return(null===(ke=ze._links.resource)||void 0===ke?void 0:ke.href)||"none"})),(0,v.x)()),this.notifications$=this.aggregatedCenterNotifications$.pipe((0,m.U)(ut=>Object.values(ut)),(0,v.x)()),this.hasNotifications$=this.notifications$.pipe((0,v.x)(),(0,m.U)(ut=>ut.length>0),(0,v.x)()),this.hasMoreThanPageSize$=this.notLoaded$.pipe((0,m.U)(ut=>ut>0),(0,v.x)()),this.activeReloadToast=null,this.reload=new R.xQ,this.onReload=this.reload.pipe((0,b.b)(0),(0,P.b)(ut=>{ut&&this.store.setLoading(!0)}),(0,k.w)(()=>this.resourceService.fetchNotifications(this.params).pipe((0,k.w)(ut=>(0,F.D)(this.sideLoadInvolvedWorkPackages(ut._embedded.elements)).pipe((0,E.h)((0,q.n)(ut)))))),(0,P.b)(()=>setTimeout(()=>this.store.setLoading(!1)))),this.selectedNotificationIndex=0,this.stateChanged$=null===(ri=this.uiRouterGlobals.params$)||void 0===ri?void 0:ri.pipe(this.untilDestroyed(),(0,T.j)("workPackageId"),(0,v.x)(),(0,m.U)(ut=>ut?this.apiV3Service.work_packages.id(ut).path:void 0),(0,M.d)()),this.reload.subscribe(),this.stateChanged$&&this.stateChanged$.subscribe(()=>{this.updateSelectedNotification()})}get params(){const he=this.store.getValue(),ue=he.filters.name&&he.filters.filter;return Object.assign(Object.assign({},he.params),{filters:[...se.yz[he.activeFacet],...ue?[[he.filters.filter,"=",[he.filters.name]]]:[]]})}setFilters(he){this.store.update({filters:he}),this.onReload.pipe((0,O.q)(1)).subscribe(ue=>{this.store.update({activeCollection:ue})}),this.reload.next(!0)}setFacet(he){var ue;this.store.update({activeFacet:he}),this.onReload.pipe((0,O.q)(1)).subscribe(Le=>{this.store.update({activeCollection:Le})}),"unread"===he&&(null===(ue=this.selectedNotification)||void 0===ue?void 0:ue.readIAN)&&this.goToCenter(),this.reload.next(!0)}markAsRead(he){this.actions$.dispatch((0,G.L5)({origin:this.id,notifications:he}))}markAllAsRead(){const he=(0,q.ZU)(this.params);this.resourceService.collection(he).pipe((0,O.q)(1)).subscribe(ue=>{const Le=ue.filter(ht=>!1===ht.readIAN).map(ht=>ht.id);Le.length>0&&this.markAsRead(Le)})}openSplitScreen(he){this.state.go(`${this.state.current.data.baseRoute}.details.tabs`,{workPackageId:he,tabIdentifier:"activity"})}goToCenter(){this.state.go(this.state.current.data.baseRoute)}showNextNotification(){this.notifications$.pipe((0,O.q)(1)).subscribe(he=>{if(he.length<=0)this.state.go(`${this.state.current.data.baseRoute}`);else if(he[0][0]._links.resource||he[this.selectedNotificationIndex][0]._links.resource){const ue=(0,n.Z)(he[this.selectedNotificationIndex>=he.length?0:this.selectedNotificationIndex][0]._links.resource.href);this.openSplitScreen(ue)}})}checkForNewNotifications(){this.onReload.pipe((0,O.q)(1)).subscribe(he=>{const{activeCollection:ue}=this.query.getValue();he.ids.reduce((ht,pt)=>ht&&ue.ids.includes(pt),!0)||(this.activeReloadToast&&(this.toastService.remove(this.activeReloadToast),this.activeReloadToast=null),this.activeReloadToast=this.toastService.add({type:"info",message:this.I18n.t("js.notifications.center.new_notifications.message"),link:{text:this.I18n.t("js.notifications.center.new_notifications.link_text"),target:()=>{this.store.update({activeCollection:he}),this.actions$.dispatch((0,G.$v)({origin:this.id})),this.activeReloadToast=null}}}))}),this.reload.next(!1)}reloadOnNotificationRead(he){const{activeCollection:ue}=this.query.getValue();this.store.update({activeCollection:{ids:ue.ids.filter(Le=>!he.notifications.includes(Le))}}),!this.deviceService.isMobile&&this.state.includes("**.details.*")&&this.showNextNotification()}sideLoadInvolvedWorkPackages(he){const{cache:ue}=this.apiV3Service.work_packages,Le=he.map(pt=>{var Zt;const Ct=null===(Zt=pt._links.resource)||void 0===Zt?void 0:Zt.href;return Ct&&f.X.matchFromLink(Ct,"work_packages")}).filter(pt=>pt&&ue.stale(pt)),ht=this.apiV3Service.work_packages.requireAll(_.compact(Le));return Le.forEach(pt=>{ue.clearAndLoad(pt,(0,F.D)(ht).pipe((0,m.U)(()=>ue.current(pt))))}),ht}updateSelectedNotification(){this.notifications$.pipe((0,O.q)(1)).subscribe(he=>{for(let ue=0;ue<he.length;++ue)if(he[ue][0]._links.resource&&(0,n.Z)(he[ue][0]._links.resource.href)===this.uiRouterGlobals.params.workPackageId)return this.selectedNotificationIndex=ue,void([this.selectedNotification]=he[ue])})}};oe.\u0275fac=function(he){return new(he||oe)(u.LFG(l.D),u.LFG(u.zs3),u.LFG(K.W),u.LFG(V.b),u.LFG(r.T),u.LFG(D.kl),u.LFG(ie.UIRouterGlobals),u.LFG(ie.StateService),u.LFG(le.U))},oe.\u0275prov=u.Yz7({token:oe,factory:oe.\u0275fac}),(0,C.gn)([(0,Q.B)(G.vw),(0,C.w6)("design:type",Function),(0,C.w6)("design:paramtypes",[]),(0,C.w6)("design:returntype",void 0)],oe.prototype,"checkForNewNotifications",null),(0,C.gn)([(0,Q.B)(G.A6),(0,C.w6)("design:type",Function),(0,C.w6)("design:paramtypes",[void 0]),(0,C.w6)("design:returntype",void 0)],oe.prototype,"reloadOnNotificationRead",null),oe=(0,C.gn)([Q.b,(0,C.w6)("design:paramtypes",[l.D,u.zs3,K.W,V.b,r.T,D.kl,ie.UIRouterGlobals,ie.StateService,le.U])],oe);var ne=t(84906),fe=t(50076);t(34863);class Se{ngOnChanges(he){if(he.status){const ue=he.status;this.highlightClass=fe.Z.backgroundClass("status",ue.currentValue.id||"")}}}Se.\u0275fac=function(he){return new(he||Se)},Se.\u0275cmp=u.Xpm({type:Se,selectors:[["op-in-app-notification-status"]],inputs:{status:"status"},features:[u.TTD],decls:2,vars:2,consts:[[1,"op-ian-wp-status",3,"ngClass"],[1,"op-ian-wp-status--text",3,"textContent"]],template:function(he,ue){1&he&&(u.TgZ(0,"span",0),u._UZ(1,"span",1),u.qZA()),2&he&&(u.Q6J("ngClass",ue.highlightClass),u.xp6(1),u.Q6J("textContent",ue.status.name))},directives:[e.mk],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-wp-status[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;background-color:var(--status-selector-bg-color);color:#fff;margin-bottom:0;padding:1px 8px;border:none;border-radius:2px;max-width:100%;font-size:12px;display:inline-block;min-height:16px;line-height:16px}.op-ian-wp-status--text[_ngcontent-%COMP%]{margin:0 5px}"],changeDetection:0});var Oe=t(3742),je=t(70099);function tt(H,he){if(1&H){const ue=u.EpF();u.TgZ(0,"div",21),u._uU(1," - "),u.TgZ(2,"a",22),u.NdJ("click",function(ht){return u.CHM(ue),u.oxw(2).projectClicked(ht)}),u.qZA(),u._uU(3," - "),u.qZA()}if(2&H){const ue=u.oxw(2);u.xp6(2),u.ekj("spot-link_inactive",ue.isMobile()),u.Q6J("href",ue.project.showUrl,u.LSH)("textContent",ue.project.title)}}function He(H,he){1&H&&(u.ynx(0),u._uU(1,", "),u.BQk())}function st(H,he){if(1&H&&(u.TgZ(0,"span",23),u._uU(1),u.YNc(2,He,2,0,"ng-container",20),u.qZA()),2&H){const ue=he.$implicit,Le=he.first,ht=he.last;u.xp6(1),u.hij(" ",ue.key,""),u.xp6(1),u.Q6J("ngIf",!ht&&Le!==ht)}}function Me(H,he){if(1&H&&u._UZ(0,"span",24),2&H){const ue=u.oxw(2);u.Q6J("textContent",ue.aggregatedNotifications.length)}}function ce(H,he){if(1&H){const ue=u.EpF();u.TgZ(0,"i",25),u.NdJ("click",function(ht){u.CHM(ue);const pt=u.oxw(2);return pt.markAsRead(ht,pt.aggregatedNotifications)}),u.qZA()}if(2&H){const ue=u.oxw(2);u.Q6J("title",ue.text.mark_as_read)}}function J(H,he){if(1&H&&(u.TgZ(0,"span"),u._uU(1),u.qZA()),2&H){const ue=u.oxw(2);u.xp6(1),u.hij(" ",ue.text_for_additional_authors(ue.actors.length-1)," ")}}const W=function(H){return{workPackageId:H}};function Y(H,he){if(1&H){const ue=u.EpF();u.ynx(0),u.TgZ(1,"div",3),u.TgZ(2,"div",4),u._UZ(3,"op-in-app-notification-status",5),u.qZA(),u._UZ(4,"a",6),u.YNc(5,tt,4,4,"div",7),u.TgZ(6,"div",8),u.YNc(7,st,3,2,"span",9),u.ALo(8,"keyvalue"),u.qZA(),u.YNc(9,Me,1,1,"span",10),u.TgZ(10,"div",11),u.YNc(11,ce,1,1,"i",12),u.TgZ(12,"i",13),u.NdJ("keydown.enter",function(){return u.CHM(ue),u.oxw().showDetails()}),u.qZA(),u.qZA(),u.qZA(),u.TgZ(13,"div",14),u._UZ(14,"span",15),u._UZ(15,"span",16),u.qZA(),u.TgZ(16,"div",17),u._UZ(17,"div",18),u.ALo(18,"async"),u.TgZ(19,"div"),u._UZ(20,"op-principal",19),u.YNc(21,J,2,1,"span",20),u.qZA(),u.qZA(),u.BQk()}if(2&H){const ue=he.ngIf,Le=u.oxw();u.xp6(3),u.Q6J("status",ue.status),u.xp6(1),u.ekj("spot-link_inactive",Le.isMobile()),u.Q6J("uiParams",u.VKq(26,W,ue.id))("textContent","#"+ue.id),u.uIk("title",ue.subject),u.xp6(1),u.Q6J("ngIf",Le.project),u.xp6(2),u.Q6J("ngForOf",u.lcZ(8,22,Le.translatedReasons)),u.xp6(2),u.Q6J("ngIf",!Le.notification.readIAN),u.xp6(2),u.Q6J("ngIf",!Le.notification.readIAN),u.xp6(3),u.Q6J("ngClass","op-ian-item--work-package-type __hl_inline_type_"+ue.type.id)("textContent",ue.type.name),u.xp6(1),u.ekj("-read",Le.notification.readIAN),u.Q6J("textContent",ue.subject),u.xp6(2),u.Q6J("title",Le.fixedTime)("textContent",u.lcZ(18,24,Le.relativeTime$)),u.xp6(3),u.Q6J("principal",Le.actors[0])("hideName",!1)("hideAvatar",!0)("link",!Le.isMobile()),u.xp6(1),u.Q6J("ngIf",Le.actors.length>1)}}function $(H,he){1&H&&(u.TgZ(0,"op-content-loader",30),u.O4$(),u._UZ(1,"rect",31),u._UZ(2,"rect",32),u._UZ(3,"rect",33),u.qZA())}function be(H,he){if(1&H&&(u.TgZ(0,"div",26),u.YNc(1,$,4,0,"op-content-loader",27),u._UZ(2,"span",28),u.TgZ(3,"div",11),u._UZ(4,"i",29),u.qZA(),u.qZA()),2&H){const ue=u.oxw();u.xp6(1),u.Q6J("ngIf",ue.workPackage$)}}class N{constructor(he,ue,Le,ht,pt,Zt,Ct){this.apiV3Service=he,this.I18n=ue,this.storeService=Le,this.timezoneService=ht,this.pathHelper=pt,this.state=Zt,this.deviceService=Ct,this.className=!0,this.workPackage$=null,this.loading$=this.storeService.query.selectLoading(),this.stateChanged$=this.storeService.stateChanged$,this.actors=[],this.text={and_other_singular:this.I18n.t("js.notifications.center.and_more_users.one"),and_other_plural:ni=>this.I18n.t("js.notifications.center.and_more_users.other",{count:ni}),loading:this.I18n.t("js.ajax.loading"),placeholder:this.I18n.t("js.placeholders.default"),mark_as_read:this.I18n.t("js.notifications.center.mark_as_read"),updated_by_at:ni=>this.I18n.t("js.notifications.center.text_update_date",{date:ni})}}ngOnInit(){this.buildTranslatedReason(),this.buildActors(),this.buildTime(),this.buildProject(),this.loadWorkPackage()}loadWorkPackage(){var he;const ue=null===(he=this.notification._links.resource)||void 0===he?void 0:he.href,Le=ue&&f.X.matchFromLink(ue,"work_packages");Le&&(this.workPackage$=this.apiV3Service.work_packages.id(Le).requireAndStream())}buildTime(){this.fixedTime=this.timezoneService.formattedDatetime(this.notification.createdAt),this.relativeTime$=(0,h.H)(0,1e4).pipe((0,m.U)(()=>this.text.updated_by_at(this.timezoneService.formattedRelativeDateTime(this.notification.createdAt))),(0,v.x)())}showDetails(){!this.workPackage$||this.workPackage$.pipe((0,p.take)(1)).subscribe(he=>{this.storeService.openSplitScreen(he.id)})}projectClicked(he){he.stopPropagation()}markAsRead(he,ue){he.stopPropagation(),this.storeService.markAsRead(ue.map(Le=>Le.id))}text_for_additional_authors(he){let ue;return ue=1===he?this.text.and_other_singular:this.text.and_other_plural(he),ue}isMobile(){return this.deviceService.isMobile}buildActors(){const he=this.aggregatedNotifications.map(ue=>{const{actor:Le}=ue._links;return Le?{href:Le.href,name:Le.title}:null}).filter(ue=>null!==ue);this.actors=_.uniqBy(he,ue=>ue.href)}buildTranslatedReason(){const he={};this.aggregatedNotifications.forEach(ue=>{const Le=this.I18n.t(`js.notifications.reasons.${ue.reason}`,{defaultValue:ue.reason||this.text.placeholder});he[Le]=he[Le]||0,he[Le]+=1}),this.translatedReasons=he}buildProject(){const{project:he}=this.notification._links;he&&(this.project=Object.assign(Object.assign({},he),{showUrl:this.pathHelper.projectPath((0,n.Z)(he.href))}))}}N.\u0275fac=function(he){return new(he||N)(u.Y36(r.T),u.Y36(l.D),u.Y36(oe),u.Y36(a.B),u.Y36(c.j),u.Y36(ie.StateService),u.Y36(le.U))},N.\u0275cmp=u.Xpm({type:N,selectors:[["op-in-app-notification-entry"]],hostVars:2,hostBindings:function(he,ue){2&he&&u.ekj("op-ian-item",ue.className)},inputs:{notification:"notification",aggregatedNotifications:"aggregatedNotifications"},decls:5,vars:4,consts:[[1,"op-ian-item--row",3,"click"],[4,"ngIf","ngIfElse"],["workPackageLoading",""],[1,"op-ian-item--top-line"],[1,"op-ian-item--status"],[3,"status"],["uiSref","work-packages.show",1,"op-ian-item--work-package-id-link","spot-link",3,"uiParams","textContent"],["class","op-ian-item--project",4,"ngIf"],[1,"op-ian-item--reason-wrapper"],["class","op-ian-item--reason",4,"ngFor","ngForOf"],["class","op-ian-item--reason-count",3,"textContent",4,"ngIf"],[1,"op-ian-item--buttons"],["data-qa-selector","mark-as-read-button","class","op-ian-item--button icon-mark-read","tabindex","0",3,"title","click",4,"ngIf"],["tabindex","0",1,"op-ian-item--button","op-ian-item--button_shown-on-focus","icon-info1",3,"keydown.enter"],[1,"op-ian-item--middle-line"],[3,"ngClass","textContent"],[1,"op-ian-item--work-package-subject",3,"textContent"],[1,"op-ian-item--bottom-line"],[1,"op-ian-item--date",3,"title","textContent"],[1,"op-ian-item--actors",3,"principal","hideName","hideAvatar","link"],[4,"ngIf"],[1,"op-ian-item--project"],["target","_blank",1,"op-ian-item--project-link",3,"href","textContent","click"],[1,"op-ian-item--reason"],[1,"op-ian-item--reason-count",3,"textContent"],["data-qa-selector","mark-as-read-button","tabindex","0",1,"op-ian-item--button","icon-mark-read",3,"title","click"],[1,"op-ian-item--loading"],["class","op-ian-item--loading-indicator","viewBox","0 0 200 20",4,"ngIf"],[1,"op-ian-item--reason-count"],[1,"op-ian-item--button","icon-mark-read"],["viewBox","0 0 200 20",1,"op-ian-item--loading-indicator"],["x","0","y","0","width","100%","height","5","rx","1"],["x","0","y","7","width","100%","height","5","rx","1"],["x","0","y","14","width","80%","height","5","rx","1"]],template:function(he,ue){if(1&he&&(u.TgZ(0,"div",0),u.NdJ("click",function(){return ue.showDetails()}),u.YNc(1,Y,22,28,"ng-container",1),u.ALo(2,"async"),u.YNc(3,be,5,1,"ng-template",null,2,u.W1O),u.qZA()),2&he){const Le=u.MAs(4);u.xp6(1),u.Q6J("ngIf",ue.workPackage$&&u.lcZ(2,2,ue.workPackage$))("ngIfElse",Le)}},directives:[e.O5,Se,ne.AnchorUISref,ne.UISref,e.sg,e.mk,Oe.N,je.V],pipes:[e.Ov,e.Nd],styles:['.cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-item{display:block;background:#FFFFFF;margin:0;padding:15px 10px;font-size:.9rem;border-top:1px solid var(--content-default-border-color);border-radius:2px;height:100px}.op-ian-item:hover{background:var(--gray-light)}.op-ian-item:last-of-type{border-bottom:1px solid var(--content-default-border-color)}.op-ian-item_selected{background:#D1E5F5}.op-ian-item_selected:hover{background:#c9e0f3}.op-ian-item_read{background:#F3F3F3}.op-ian-item_read:hover{background:#eeeeee}.op-ian-item--row{padding:0;margin:0;background:transparent;border:0;font:inherit;text-align:inherit;width:100%;height:100%;display:grid;grid-template-rows:auto 14px auto;grid-template-areas:"header" "body" "footer";grid-gap:10px;align-items:center;cursor:pointer}.op-ian-item--top-line{grid-area:header;display:grid;grid-template-columns:max-content max-content minmax(0,max-content) max-content auto minmax(20px,max-content);grid-template-areas:"status wpIdLink project reason count buttons";grid-column-gap:5px;font-size:14px;align-items:center}.op-ian-item--middle-line{grid-area:body;display:grid;grid-template-columns:auto 1fr;grid-column-gap:5px;line-height:normal}.op-ian-item--bottom-line{grid-area:footer;display:grid;grid-template-columns:auto 1fr;grid-column-gap:5px;align-items:center;color:var(--gray-dark)}.op-ian-item--work-package-subject{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap;font-weight:bold}.op-ian-item--work-package-subject.-read{font-weight:normal}.op-ian-item--work-package-id-link{grid-area:wpIdLink}.op-ian-item--project{grid-area:project;color:var(--gray-dark);overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-ian-item--project-link,.op-ian-item--work-package-id-link{color:var(--gray-dark);font-weight:bold}.op-ian-item--reason-count{grid-area:count;display:inline-flex;justify-content:center;align-items:center;box-sizing:content-box;height:16px;line-height:16px;width:16px;border-radius:.5rem;padding:0 .15rem;font-size:.7rem;font-weight:bold;background:#00A3FF;color:#fff;flex-shrink:0;justify-self:flex-end;margin-right:5px}.op-ian-item--reason{grid-area:reason;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap;color:var(--gray-dark);max-width:100%}.op-ian-item--date{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap;max-width:100%;line-height:16px}.op-ian-item--status{grid-area:status;margin-right:5px}.op-ian-item--buttons{grid-area:buttons;font-size:16px}.op-ian-item--button:hover{color:var(--content-link-hover-active-color)}.op-ian-item--button_shown-on-focus{position:absolute;right:-10000px}.op-ian-item--button_shown-on-focus:focus{right:0}.op-ian-item--loading-indicator{height:100%;display:block;grid-area:loadingIndicator}.op-ian-item--loading-indicator svg{height:calc(100px - 30px)}.op-ian-item--loading{display:grid;grid-template-columns:max-content auto minmax(20px,max-content);grid-template-areas:"loadingIndicator count buttons";grid-column-gap:5px}.op-ian-item--actors{vertical-align:baseline}\n'],encapsulation:2,changeDetection:0});var Ue=t(32824),et=t(90922),Ke=t(46430),_e=t(85603),ye=t(9170),Pe=t(24782),Ee=t(13623),Qe=t(97656);function nt(H,he){if(1&H&&(u._UZ(0,"op-in-app-notification-entry",9),u.ALo(1,"async"),u.ALo(2,"async")),2&H){const ue=he.$implicit,Le=u.oxw(3);u.ekj("op-ian-item_expanded",ue[0].expanded)("op-ian-item_read",!0===ue[0].readIAN)("op-ian-item_selected",u.lcZ(1,11,Le.stateChanged$)===ue[0]._links.resource.href),u.Q2q("data-qa-selector","op-ian-notification-item-",ue[0].id,""),u.Q6J("notification",ue[0])("aggregatedNotifications",ue),u.uIk("data-qa-ian-read",!0===ue[0].readIAN||void 0)("data-qa-ian-selected",u.lcZ(2,13,Le.stateChanged$)===ue[0]._links.resource.href)}}function ct(H,he){if(1&H&&(u.ynx(0),u.TgZ(1,"cdk-virtual-scroll-viewport",7),u.YNc(2,nt,3,15,"op-in-app-notification-entry",8),u.ALo(3,"async"),u.qZA(),u.BQk()),2&H){const ue=u.oxw(2);u.xp6(2),u.Q6J("cdkVirtualForOf",u.lcZ(3,3,ue.notifications$))("cdkVirtualForTrackBy",ue.trackNotificationGroups)("cdkVirtualForTemplateCacheSize",0)}}function lt(H,he){if(1&H&&(u.TgZ(0,"div",10),u._UZ(1,"img",11),u.TgZ(2,"p",12),u._UZ(3,"span",13),u.ALo(4,"async"),u.qZA(),u._UZ(5,"span",13),u.ALo(6,"async"),u.qZA()),2&H){const ue=u.oxw(2);u.xp6(1),u.Q6J("src",ue.image.no_notification,u.LSH),u.xp6(2),u.Q6J("textContent",ue.noNotificationText(ue.hasNotifications,u.lcZ(4,3,ue.totalCount$))),u.xp6(2),u.Q6J("textContent",u.lcZ(6,5,ue.noResultText$))}}function Ne(H,he){if(1&H&&(u.ynx(0),u.YNc(1,ct,4,5,"ng-container",2),u.ALo(2,"async"),u.YNc(3,lt,7,7,"ng-template",null,6,u.W1O),u.BQk()),2&H){const ue=u.MAs(4),Le=u.oxw();u.xp6(1),u.Q6J("ngIf",u.lcZ(2,2,Le.hasNotifications$))("ngIfElse",ue)}}function Ae(H,he){if(1&H&&u._UZ(0,"img",14),2&H){const ue=u.oxw();u.Q6J("src",ue.image.loading,u.LSH)}}function xe(H,he){if(1&H&&(u._UZ(0,"p",15),u.ALo(1,"async")),2&H){const ue=u.oxw();u.Q6J("textContent",u.lcZ(1,1,ue.totalCountWarning$))}}class Ye{constructor(he,ue,Le,ht,pt,Zt,Ct,ni,_i){var ri;this.cdRef=he,this.elementRef=ue,this.I18n=Le,this.storeService=ht,this.bellService=pt,this.uiRouterGlobals=Zt,this.state=Ct,this.apiV3=ni,this.pathService=_i,this.maxSize=Pe.Z,this.hasMoreThanPageSize$=this.storeService.hasMoreThanPageSize$,this.hasNotifications$=this.storeService.hasNotifications$,this.notifications$=this.storeService.notifications$,this.loading$=this.storeService.loading$,this.totalCount$=this.bellService.unread$,this.noResultText$=this.totalCount$.pipe((0,m.U)(ut=>ut>0?this.text.no_results.with_current_filter:this.text.no_results.at_all)),this.totalCountWarning$=this.storeService.notLoaded$.pipe((0,ye.h)(ut=>ut>0),(0,m.U)(ut=>this.I18n.t("js.notifications.center.total_count_warning",{newest_count:this.maxSize,more_count:ut}))),this.stateChanged$=this.storeService.stateChanged$,this.originalOrder=()=>0,this.reasonMenuItems=[{key:"mentioned",title:this.I18n.t("js.notifications.menu.mentioned")},{key:"assigned",title:this.I18n.t("js.label_assignee")},{key:"responsible",title:this.I18n.t("js.notifications.menu.accountable")},{key:"watched",title:this.I18n.t("js.notifications.menu.watching")}],this.selectedFilter=null===(ri=this.reasonMenuItems.find(ut=>ut.key===this.uiRouterGlobals.params.name))||void 0===ri?void 0:ri.title,this.image={no_notification:(0,Qe.h)("notification-center/empty-state-no-notification.svg"),no_selection:(0,Qe.h)("notification-center/empty-state-no-selection.svg"),loading:(0,Qe.h)("notification-center/notification_loading.gif")},this.trackNotificationGroups=(ut,ze)=>ze.map(ke=>`${ke.id}@${ke.updatedAt}`).join(","),this.text={no_notification:this.I18n.t("js.notifications.center.empty_state.no_notification"),no_notification_with_current_filter_project:this.I18n.t("js.notifications.center.empty_state.no_notification_with_current_project_filter"),no_notification_with_current_filter:this.I18n.t("js.notifications.center.empty_state.no_notification_with_current_filter",{filter:this.selectedFilter}),no_selection:this.I18n.t("js.notifications.center.empty_state.no_selection"),change_notification_settings:this.I18n.t("js.notifications.settings.change_notification_settings",{url:this.pathService.myNotificationsSettingsPath()}),title:this.I18n.t("js.notifications.title"),button_close:this.I18n.t("js.button_close"),no_results:{at_all:this.I18n.t("js.notifications.center.no_results.at_all"),with_current_filter:this.I18n.t("js.notifications.center.no_results.with_current_filter")}}}ngOnInit(){this.storeService.setFacet("unread"),this.storeService.setFilters({filter:this.uiRouterGlobals.params.filter,name:this.uiRouterGlobals.params.name})}noNotificationText(he,ue){return!he&&ue>0?"project"===this.uiRouterGlobals.params.filter?this.text.no_notification_with_current_filter_project:this.text.no_notification_with_current_filter:this.text.no_notification}}Ye.\u0275fac=function(he){return new(he||Ye)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(l.D),u.Y36(oe),u.Y36(Ee.L),u.Y36(ie.UIRouterGlobals),u.Y36(ie.StateService),u.Y36(r.T),u.Y36(c.j))},Ye.\u0275cmp=u.Xpm({type:Ye,selectors:[["op-in-app-notification-center"]],decls:9,vars:7,consts:[[1,"op-ian-center"],[1,"op-ian-center--content"],[4,"ngIf","ngIfElse"],["loading",""],[1,"op-ian-center--footer"],["class","op-ian-center--max-warning",3,"textContent",4,"ngIf"],["noResults",""],["itemSize","100",1,"op-ian-center--viewport"],["class","op-ian-item",3,"op-ian-item_expanded","op-ian-item_read","op-ian-item_selected","notification","aggregatedNotifications",4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy","cdkVirtualForTemplateCacheSize"],[1,"op-ian-item",3,"notification","aggregatedNotifications"],[1,"op-ian-center--loading-indicator"],[1,"op-ian-center-loading-image",3,"src"],[1,"op-ian-center-loading-text"],[3,"textContent"],["data-qa-selector","op-ian-center--loading-indicator",1,"op-ian-center--loading-indicator","op-ian-center-loading-image",3,"src"],[1,"op-ian-center--max-warning",3,"textContent"]],template:function(he,ue){if(1&he&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.YNc(2,Ne,5,4,"ng-container",2),u.ALo(3,"async"),u.YNc(4,Ae,1,1,"ng-template",null,3,u.W1O),u.qZA(),u.TgZ(6,"div",4),u.YNc(7,xe,2,3,"p",5),u.ALo(8,"async"),u.qZA(),u.qZA()),2&he){const Le=u.MAs(5);u.xp6(2),u.Q6J("ngIf",!1===u.lcZ(3,3,ue.loading$))("ngIfElse",Le),u.xp6(5),u.Q6J("ngIf",u.lcZ(8,5,ue.hasMoreThanPageSize$))}},styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-center[_ngcontent-%COMP%]{display:grid;grid-template-rows:1fr auto;height:100%}.op-ian-center--content[_ngcontent-%COMP%]{height:100%}.op-ian-center--viewport[_ngcontent-%COMP%]{height:100%;overflow-x:hidden;scrollbar-color:transparent transparent;scrollbar-width:thin}.op-ian-center--viewport[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.op-ian-center--viewport[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.op-ian-center--viewport[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.op-ian-center--viewport[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.op-ian-center--viewport[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.op-ian-center--max-warning[_ngcontent-%COMP%]{margin-bottom:0;text-align:center;font-style:italic}.op-ian-center--loading-indicator[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;max-width:600px}@media screen and (max-width: 679px){.op-ian-center--loading-indicator[_ngcontent-%COMP%]{left:0;top:2rem;transform:none}}.-browser-safari   .op-ian-center   [_nghost-%COMP%]{height:100%}.op-ian-center-loading-text[_ngcontent-%COMP%]{color:var(--gray-dark);font-size:18px}.op-ian-center-loading-image[_ngcontent-%COMP%]{max-height:130px;min-height:130px;margin-bottom:15px}"],changeDetection:0});var mt=t(2775);class Ot{constructor(he,ue){this.I18n=he,this.pathHelper=ue,this.myNotificationSettingsLink=this.pathHelper.myNotificationsSettingsPath(),this.text={mySettings:this.I18n.t("js.notifications.settings.title")}}}function Pt(H,he){if(1&H){const ue=u.EpF();u.ynx(0),u.TgZ(1,"button",1),u.NdJ("click",function(){const pt=u.CHM(ue).$implicit;return u.oxw().activateFacet(pt)}),u.ALo(2,"async"),u._UZ(3,"span",2),u.qZA(),u.BQk()}if(2&H){const ue=he.$implicit,Le=u.oxw();u.xp6(1),u.ekj("-active",ue===u.lcZ(2,4,Le.activeFacet$)),u.Q6J("title",Le.text.facet_titles[ue]),u.xp6(2),u.Q6J("textContent",Le.text.facets[ue])}}Ot.\u0275fac=function(he){return new(he||Ot)(u.Y36(l.D),u.Y36(c.j))},Ot.\u0275cmp=u.Xpm({type:Ot,selectors:[["op-notification-settings-button"]],decls:3,vars:2,consts:[["target","_blank",1,"button",3,"href"],["icon-classes","button--icon icon-settings"],[1,"button--text",3,"textContent"]],template:function(he,ue){1&he&&(u.TgZ(0,"a",0),u._UZ(1,"op-icon",1),u._UZ(2,"span",2),u.qZA()),2&he&&(u.Q6J("href",ue.myNotificationSettingsLink,u.LSH),u.xp6(2),u.Q6J("textContent",ue.text.mySettings))},directives:[mt.o],encapsulation:2,changeDetection:0});class Mt{constructor(he,ue){this.I18n=he,this.storeService=ue,this.text={facets:{unread:this.I18n.t("js.notifications.facets.unread"),all:this.I18n.t("js.notifications.facets.all")},facet_titles:{unread:this.I18n.t("js.notifications.facets.unread_title"),all:this.I18n.t("js.notifications.facets.all_title")}},this.availableFacets=Object.keys(se.yz),this.activeFacet$=this.storeService.activeFacet$}activateFacet(he){this.storeService.setFacet(he)}}Mt.\u0275fac=function(he){return new(he||Mt)(u.Y36(l.D),u.Y36(oe))},Mt.\u0275cmp=u.Xpm({type:Mt,selectors:[["op-activate-facet"]],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["type","button",1,"button","form--field-inline-button",3,"title","click"],[1,"button--text","button--text_without_icon",3,"textContent"]],template:function(he,ue){1&he&&u.YNc(0,Pt,4,6,"ng-container",0),2&he&&u.Q6J("ngForOf",ue.availableFacets)},directives:[e.sg],pipes:[e.Ov],encapsulation:2,changeDetection:0});class yt{constructor(he,ue){this.I18n=he,this.storeService=ue,this.text={mark_all_read:this.I18n.t("js.notifications.center.mark_all_read")}}markAllRead(){this.storeService.markAllAsRead()}}yt.\u0275fac=function(he){return new(he||yt)(u.Y36(l.D),u.Y36(oe))},yt.\u0275cmp=u.Xpm({type:yt,selectors:[["op-mark-all-as-read-button"]],decls:3,vars:1,consts:[["type","button",1,"button",3,"click"],["icon-classes","button--icon icon-mark-all-read"],[1,"button--text",3,"textContent"]],template:function(he,ue){1&he&&(u.TgZ(0,"button",0),u.NdJ("click",function(){return ue.markAllRead()}),u._UZ(1,"op-icon",1),u._UZ(2,"span",2),u.qZA()),2&he&&(u.xp6(2),u.Q6J("textContent",ue.text.mark_all_read))},directives:[mt.o],encapsulation:2,changeDetection:0});var jt=t(57014),Jt=t(57810),Ft=t(77616),It=t(81628),gt=t(32853);function kt(H,he){if(1&H&&u._UZ(0,"op-back-button",11),2&H){const ue=u.oxw();u.Q6J("customBackMethod",ue.backButtonCallback)}}function ti(H,he){if(1&H&&(u.TgZ(0,"li",15),u._UZ(1,"ndc-dynamic",16),u.qZA()),2&H){const ue=u.oxw().$implicit,Le=u.oxw(2);u.Q6J("ngClass",ue.containerClasses),u.xp6(1),u.Q6J("ndcDynamicComponent",ue.component)("ndcDynamicInputs",ue.inputs)("ndcDynamicInjector",Le.injector)("ndcDynamicOutputs",ue.outputs)}}function ii(H,he){if(1&H&&(u.ynx(0),u.YNc(1,ti,2,5,"li",14),u.BQk()),2&H){const ue=he.$implicit;u.xp6(1),u.Q6J("ngIf",!ue.show||ue.show())}}function $t(H,he){if(1&H&&(u.TgZ(0,"ul",12),u.YNc(1,ii,2,1,"ng-container",13),u.qZA()),2&H){const ue=u.oxw();u.xp6(1),u.Q6J("ngForOf",ue.toolbarButtonComponents)}}function vt(H,he){if(1&H&&u._UZ(0,"ndc-dynamic",17),2&H){const ue=u.oxw();u.Q6J("ndcDynamicComponent",ue.filterContainerDefinition.component)("ndcDynamicInputs",ue.filterContainerDefinition.inputs)("ndcDynamicOutputs",ue.filterContainerDefinition.outputs)("ndcDynamicInjector",ue.injector)}}class Ht extends te.N{constructor(he,ue,Le,ht,pt,Zt,Ct,ni){super(),this.I18n=he,this.cdRef=ue,this.$transitions=Le,this.state=ht,this.injector=pt,this.apiV3Service=Zt,this.backRoutingService=Ct,this.titleService=ni,this.text={title:this.I18n.t("js.notifications.title")},this.backButtonCallback=void 0,this.selectedTitle=this.text.title,this.filterContainerDefinition=null,this.currentPartition="-split",this.showToolbar=!0,this.titleEditingEnabled=!1,this.showToolbarSaveButton=!1,this.toolbarDisabled=!1,this.toolbarButtonComponents=[{component:Mt,containerClasses:"form--field-inline-buttons-container"},{component:yt},{component:Ot,containerClasses:"hidden-for-mobile"}]}ngOnInit(){this.documentReferer=document.referrer,this.setInitialHtmlTitle(),this.removeTransitionSubscription=this.$transitions.onSuccess({},()=>{this.titleService.setFirstPart(this.text.title)})}ngOnDestroy(){super.ngOnDestroy(),this.removeTransitionSubscription()}setPartition(he){var ue;this.currentPartition=(null===(ue=he.data)||void 0===ue?void 0:ue.partition)||"-split"}updateTitleName(he){}changeChangesFromTitle(he){}setInitialHtmlTitle(){const he=this.titleService.titleParts;1===he.length&&this.titleService.prependFirstPart(this.text.title),he[0]!==this.text.title&&this.titleService.setFirstPart(this.text.title)}}Ht.\u0275fac=function(he){return new(he||Ht)(u.Y36(l.D),u.Y36(u.sBO),u.Y36(ie.TransitionService),u.Y36(ie.StateService),u.Y36(u.zs3),u.Y36(r.T),u.Y36(jt.Y),u.Y36(Jt.V))},Ht.\u0275cmp=u.Xpm({type:Ht,selectors:[["ng-component"]],features:[u._Bn([oe]),u.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(he,ue){1&he&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.TgZ(2,"div",2),u.YNc(3,kt,1,1,"op-back-button",3),u.TgZ(4,"editable-toolbar-title",4),u.NdJ("onSave",function(ht){return ue.changeChangesFromTitle(ht)})("onEmptySubmit",function(){return ue.updateTitleName("")}),u.qZA(),u.YNc(5,$t,2,1,"ul",5),u.qZA(),u.qZA(),u.TgZ(6,"div",6),u.YNc(7,vt,1,4,"ndc-dynamic",7),u.qZA(),u.TgZ(8,"div",8),u._UZ(9,"div",9),u._UZ(10,"div",10),u.qZA(),u.qZA()),2&he&&(u.Q6J("ngClass",ue.currentPartition),u.xp6(3),u.Q6J("ngIf",ue.backButtonCallback),u.xp6(1),u.Q6J("title",ue.selectedTitle)("inFlight",ue.toolbarDisabled)("showSaveCondition",ue.showToolbarSaveButton)("editable",ue.titleEditingEnabled),u.xp6(1),u.Q6J("ngIf",ue.showToolbar),u.xp6(2),u.Q6J("ngIf",ue.filterContainerDefinition))},directives:[e.mk,e.O5,Ft.s5,ne.UIView,It.W,e.sg,gt.B5,gt.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}"],changeDetection:0});const it=[{name:"notifications",parent:"root",url:"/notifications?{filter:string}&{name:string}",data:{bodyClasses:"router--work-packages-base"},redirectTo:"notifications.center.show",views:{"!$default":{component:t(1813).p}}},{name:"notifications.center",component:Ht,redirectTo:"notifications.center.show"},{name:"notifications.center.show",data:{baseRoute:"notifications.center.show"},views:{"content-left":{component:Ye}}},...(0,Ke.Z)("notifications.center.show",void 0,_e.o)];var de=t(7794),ae=t(87523);class pe{}pe.\u0275fac=function(he){return new(he||pe)},pe.\u0275mod=u.oAB({type:pe}),pe.\u0275inj=u.cJS({providers:[Ee.L],imports:[[i.H,ne.UIRouterModule.forChild({states:it}),gt.wA,e.ez,d.Q,Ue.j,de.H,ae.a,et.Cl]]}),u.B6R(Ye,[e.O5,et.N7,et.xd,et.x0,N],[e.Ov])},6894:(X,I,t)=>{"use strict";t.d(I,{Y:()=>h});var i=t(54364),e=t(53875),d=t(2316);class h{}h.\u0275fac=function(n){return new(n||h)},h.\u0275mod=d.oAB({type:h}),h.\u0275inj=d.cJS({imports:[[i.ez,e.Q]]})},2308:(X,I,t)=>{"use strict";t.d(I,{j:()=>r});var i=t(2316),e=t(65146),d=t(77355),h=t(83635);class r{constructor(l,a){this.opModalService=l,this.currentProjectService=a,this.close=new i.vpe}open(l=this.currentProjectService.id){this.opModalService.show(h.E,"global",{projectId:l}).closingEvent.subscribe(m=>{this.close.emit(m.data)})}}r.\u0275fac=function(l){return new(l||r)(i.LFG(d.S),i.LFG(e.R))},r.\u0275prov=i.Yz7({token:r,factory:r.\u0275fac})},83635:(X,I,t)=>{"use strict";t.d(I,{e:()=>c,E:()=>p});var v,f,c,i=t(60312),e=t(77355),d=t(61908),h=t(2316);function r(f,C){1&f&&h._UZ(0,"div",5)}function n(f,C){if(1&f){const u=h.EpF();h.TgZ(0,"op-ium-project-selection",6),h.NdJ("save",function(O){return h.CHM(u),h.oxw().onProjectSelectionSave(O)})("close",function(){return h.CHM(u),h.oxw().closeMe()}),h.qZA()}if(2&f){const u=h.oxw();h.Q6J("project",u.project)("type",u.type)("cdkTrapFocusAutoCapture",!0)}}function l(f,C){if(1&f){const u=h.EpF();h.TgZ(0,"op-ium-principal",7),h.NdJ("save",function(O){return h.CHM(u),h.oxw().onPrincipalSave(O)})("back",function(){h.CHM(u);const O=h.oxw();return O.goTo(O.Steps.ProjectSelection)})("close",function(){return h.CHM(u),h.oxw().closeMe()}),h.qZA()}if(2&f){const u=h.oxw();h.Q6J("project",u.project)("roleData",u.role)("messageData",u.message)("principalData",u.principalData)("type",u.type)("cdkTrapFocusAutoCapture",!0)}}function a(f,C){if(1&f){const u=h.EpF();h.TgZ(0,"op-ium-summary",8),h.NdJ("save",function(O){return h.CHM(u),h.oxw().onSuccessfulSubmission(O)})("back",function(){h.CHM(u);const O=h.oxw();return O.goTo(O.Steps.Principal)})("close",function(){return h.CHM(u),h.oxw().closeMe()}),h.qZA()}if(2&f){const u=h.oxw();h.Q6J("project",u.project)("principalData",u.principalData)("type",u.type)("role",u.role)("message",u.message)("cdkTrapFocusAutoCapture",!0)}}function m(f,C){if(1&f){const u=h.EpF();h.TgZ(0,"op-ium-success",9),h.NdJ("close",function(){return h.CHM(u),h.oxw().closeWithPrincipal()}),h.qZA()}if(2&f){const u=h.oxw();h.Q6J("principal",u.principalData.principal)("project",u.project)("type",u.type)("createdNewPrincipal",u.createdNewPrincipal)("cdkTrapFocusAutoCapture",!0)}}(f=v||(v={}))[f.ProjectSelection=0]="ProjectSelection",f[f.Principal=1]="Principal",f[f.Summary=2]="Summary",f[f.Success=3]="Success",function(f){f.User="User",f.Placeholder="PlaceholderUser",f.Group="Group"}(c||(c={}));class p extends i.T{constructor(C,u,k,O){super(C,u,k),this.locals=C,this.cdRef=u,this.elementRef=k,this.apiV3Service=O,this.Steps=v,this.step=v.ProjectSelection,this.closeOnOutsideClick=!0,this.data=null,this.type=null,this.project=null,this.principalData={principal:null,customFields:{}},this.role=null,this.message="",this.createdNewPrincipal=!1}get loading(){return this.locals.projectId&&!this.project}ngOnInit(){super.ngOnInit(),this.locals.projectId&&this.apiV3Service.projects.id(this.locals.projectId).get().subscribe(C=>{this.project=C,this.cdRef.markForCheck()},()=>{this.locals.projectId=null,this.cdRef.markForCheck()})}onProjectSelectionSave({type:C,project:u}){this.type=C,this.project=u,this.goTo(v.Principal)}onPrincipalSave({principalData:C,isAlreadyMember:u,role:k,message:O}){return this.principalData=C,this.role=k,this.message=O,u?this.closeWithPrincipal():this.goTo(v.Summary)}onSuccessfulSubmission(C){this.principalData.principal!==C.principal&&this.type===c.User&&(this.createdNewPrincipal=!0),this.principalData.principal=C.principal,this.goTo(v.Success)}goTo(C){this.step=C}closeWithPrincipal(){this.data=this.principalData.principal,this.closeMe()}}p.\u0275fac=function(C){return new(C||p)(h.Y36(e.E),h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(d.T))},p.\u0275cmp=h.Xpm({type:p,selectors:[["ng-component"]],features:[h.qOj],decls:5,vars:5,consts:[["class","spot-modal",4,"ngIf"],["class","spot-modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",3,"project","type","cdkTrapFocusAutoCapture","save","close",4,"ngIf"],["class","spot-modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",3,"project","roleData","messageData","principalData","type","cdkTrapFocusAutoCapture","save","back","close",4,"ngIf"],["class","spot-modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",3,"project","principalData","type","role","message","cdkTrapFocusAutoCapture","save","back","close",4,"ngIf"],["class","spot-modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",3,"principal","project","type","createdNewPrincipal","cdkTrapFocusAutoCapture","close",4,"ngIf"],[1,"spot-modal"],["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal",3,"project","type","cdkTrapFocusAutoCapture","save","close"],["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal",3,"project","roleData","messageData","principalData","type","cdkTrapFocusAutoCapture","save","back","close"],["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal",3,"project","principalData","type","role","message","cdkTrapFocusAutoCapture","save","back","close"],["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal",3,"principal","project","type","createdNewPrincipal","cdkTrapFocusAutoCapture","close"]],template:function(C,u){1&C&&(h.YNc(0,r,1,0,"div",0),h.YNc(1,n,1,3,"op-ium-project-selection",1),h.YNc(2,l,1,6,"op-ium-principal",2),h.YNc(3,a,1,6,"op-ium-summary",3),h.YNc(4,m,1,5,"op-ium-success",4)),2&C&&(h.Q6J("ngIf",u.loading),h.xp6(1),h.Q6J("ngIf",!u.loading&&u.step===u.Steps.ProjectSelection),h.xp6(1),h.Q6J("ngIf",!u.loading&&u.step===u.Steps.Principal),h.xp6(1),h.Q6J("ngIf",!u.loading&&u.step===u.Steps.Summary),h.xp6(1),h.Q6J("ngIf",!u.loading&&u.step===u.Steps.Success))},styles:[".op-modal form{display:flex;flex-direction:column;height:100%;flex-grow:1}.op-modal .op-form-field+.op-form-field{margin-top:1rem}\n"],encapsulation:2,changeDetection:0})},18137:(X,I,t)=>{"use strict";t.d(I,{L:()=>P});var i=t(60312),e=t(77355),d=t(96617),h=t(12702),r=t(79902),n=t(18511),l=t(86469),a=t(70233),m=t(36293),v=t(61908),c=t(18869),p=t(2316),f=t(53882),C=t(54364);const u=["downloadLink"];function k(E,T){if(1&E&&(p.TgZ(0,"div",11),p._UZ(1,"span",12),p.qZA()),2&E){const M=p.oxw();p.xp6(1),p.Q6J("ngClass",M.statusIcon)}}function O(E,T){if(1&E&&(p.TgZ(0,"ul"),p._UZ(1,"li",15),p.qZA()),2&E){const M=T.$implicit;p.xp6(1),p.Q6J("textContent",M)}}function y(E,T){if(1&E&&(p.TgZ(0,"p"),p._UZ(1,"span",15),p._UZ(2,"a",15),p.qZA()),2&E){const M=p.oxw(2);p.xp6(1),p.Q6J("textContent",M.text.redirect_errors),p.xp6(1),p.Q6J("textContent",M.text.redirect_link),p.uIk("href",M.payload.redirect,p.LSH)}}function b(E,T){if(1&E&&(p.ynx(0),p._UZ(1,"h3",13),p.YNc(2,O,2,1,"ul",14),p.YNc(3,y,3,3,"p",10),p.BQk()),2&E){const M=p.oxw();p.xp6(1),p.Q6J("textContent",M.text.errors),p.xp6(1),p.Q6J("ngForOf",M.payload.errors),p.xp6(1),p.Q6J("ngIf",null==M.payload?null:M.payload.redirect)}}class P extends i.T{constructor(T,M,S,R,F,L,D,G,Q){super(T,M,R),this.locals=T,this.cdRef=M,this.I18n=S,this.elementRef=R,this.pathHelper=F,this.apiV3Service=L,this.loadingIndicator=D,this.toastService=G,this.httpClient=Q,this.closeOnEscape=!1,this.closeOnOutsideClick=!1,this.text={title:this.I18n.t("js.job_status.title"),closePopup:this.I18n.t("js.close_popup_title"),redirect:this.I18n.t("js.job_status.redirect"),redirect_errors:`${this.I18n.t("js.job_status.redirect_errors")} `,redirect_link:this.I18n.t("js.job_status.redirect_link"),errors:this.I18n.t("js.job_status.errors"),download_starts:this.I18n.t("js.job_status.download_starts"),click_to_download:this.I18n.t("js.job_status.click_to_download")},this.isLoading=!1,this.title=this.text.title,this.downloadHref=null,this.jobId=T.jobId}ngOnInit(){super.ngOnInit(),this.listenOnJobStatus()}listenOnJobStatus(){(0,h.H)(0,2e3).pipe((0,r.w)(()=>this.performRequest()),(0,n.o)(T=>!!T.body&&this.continuedStatus(T.body),!0),this.untilDestroyed(),(0,l.RA)(this.loadingIndicator.getter("modal"))).subscribe(T=>this.onResponse(T),T=>this.handleError(T),()=>{this.isLoading=!1})}iconForStatus(){switch(this.status){case"cancelled":case"failure":case"error":return"icon-error";case"success":return"icon-checkmark";default:return null}}continuedStatus(T){return["in_queue","in_process"].includes(T.status)}onResponse(T){var M;const{body:S}=T;if(!S)throw new Error(T);const R=this.status=S.status;this.message=S.message||this.I18n.t(`js.job_status.generic_messages.${R}`,{defaultValue:R}),this.payload=S.payload,S.payload&&(this.title=S.payload.title||this.text.title,this.handleRedirect(S.payload),this.handleDownload(null===(M=S.payload)||void 0===M?void 0:M.download)),this.statusIcon=this.iconForStatus(),this.cdRef.detectChanges()}handleRedirect(T){(null==T?void 0:T.redirect)&&!(null==T?void 0:T.errors)&&(setTimeout(()=>{window.location.href=T.redirect},2e3),this.message+=`. ${this.text.redirect}`)}handleDownload(T){void 0!==T&&this.httpClient.get(T,{observe:"response",responseType:"text",headers:{[c.i]:"true"}}).subscribe(M=>{this.downloadHref=M.url,this.cdRef.detectChanges(),this.downloadLink.nativeElement.click()},M=>{0===M.status&&(this.downloadHref=T,this.cdRef.detectChanges())})}performRequest(){return this.httpClient.get(this.jobUrl,{observe:"response",responseType:"json"})}handleError(T){if(404===(null==T?void 0:T.status))return this.statusIcon="icon-help",void(this.message=this.I18n.t("js.job_status.generic_messages.not_found"));this.statusIcon="icon-error",this.message=(null==T?void 0:T.message)||this.I18n.t("js.error.internal"),this.toastService.addError(this.message)}get jobUrl(){return this.apiV3Service.job_statuses.id(this.jobId).toString()}}P.\u0275fac=function(T){return new(T||P)(p.Y36(e.E),p.Y36(p.sBO),p.Y36(d.D),p.Y36(p.SBq),p.Y36(a.j),p.Y36(v.T),p.Y36(l.vt),p.Y36(m.kl),p.Y36(f.eN))},P.\u0275cmp=p.Xpm({type:P,selectors:[["ng-component"]],viewQuery:function(T,M){if(1&T&&p.Gf(u,5),2&T){let S;p.iGM(S=p.CRH())&&(M.downloadLink=S.first)}},features:[p.qOj],decls:14,vars:8,consts:[[1,"spot-modal","job-status--modal"],["data-qa-selector","job-status--header",1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["data-indicator-name","modal",1,"loading-indicator--location"],["class","status-icon-wrapper",4,"ngIf"],[1,"job-status--modal-main-message",3,"textContent"],[3,"hidden"],["download","","target","_blank",3,"textContent"],["downloadLink",""],[4,"ngIf"],[1,"status-icon-wrapper"],[1,"icon-big",3,"ngClass"],[1,"job-status--modal-additional-errors",3,"textContent"],[4,"ngFor","ngForOf"],[3,"textContent"]],template:function(T,M){1&T&&(p.TgZ(0,"div",0),p.TgZ(1,"div",1),p._uU(2),p.qZA(),p._UZ(3,"div",2),p.TgZ(4,"div",3),p.TgZ(5,"div",4),p.YNc(6,k,2,1,"div",5),p.qZA(),p.TgZ(7,"div"),p._UZ(8,"span",6),p.TgZ(9,"span",7),p._uU(10),p._UZ(11,"a",8,9),p.qZA(),p.YNc(13,b,4,3,"ng-container",10),p.qZA(),p.qZA(),p.qZA()),2&T&&(p.xp6(2),p.Oqu(M.title),p.xp6(4),p.Q6J("ngIf",!M.isLoading&&M.statusIcon),p.xp6(2),p.Q6J("textContent",M.message),p.xp6(1),p.Q6J("hidden",!M.downloadHref),p.xp6(1),p.hij(" ",M.text.download_starts," "),p.xp6(1),p.Q6J("textContent",M.text.click_to_download),p.uIk("href",M.downloadHref,p.LSH),p.xp6(2),p.Q6J("ngIf",null==M.payload?null:M.payload.errors))},directives:[C.O5,C.mk,C.sg],styles:[".job-status--modal[_ngcontent-%COMP%]{min-height:350px;min-width:450px;overflow-y:scroll}@media screen and (max-width: 679px){.job-status--modal[_ngcontent-%COMP%]{min-width:200px}}.loading-indicator--location[_ngcontent-%COMP%]{height:220px}.status-icon-wrapper[_ngcontent-%COMP%]{display:flex;height:100%;align-items:center;justify-content:center}.job-status--modal-main-message[_ngcontent-%COMP%]{font-weight:bold;display:flex;justify-content:center}.job-status--modal-additional-errors[_ngcontent-%COMP%]{margin-top:2rem}"]})},53448:(X,I,t)=>{"use strict";t.d(I,{$:()=>e});var i=t(2316);class e{constructor(){this.hooks={}}register(h,r){!r||(this.hooks[h]||(this.hooks[h]=[]),this.hooks[h].push(r))}call(h,...r){const n=[];if(this.hooks[h])for(let l=0;l<this.hooks[h].length;l++){const a=this.hooks[h][l](...r);a&&n.push(a)}return n}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},71718:(X,I,t)=>{"use strict";t.r(I),t.d(I,{OpenprojectProjectsModule:()=>D});var i=t(6496),e=t(84906),d=t(2246),h=t(47775),r=t(26942),n=t(65146),l=t(70233),a=t(2316),m=t(57958);class v extends r.N{constructor(Q,V,K){super(),this._pathHelperService=Q,this._$state=V,this._currentProjectService=K,this.formMethod="patch",this.hiddenFields=["identifier","active"]}ngOnInit(){this.projectsPath=this._currentProjectService.apiv3Path,this.dynamicFieldsSettingsPipe=Q=>Q.reduce((V,K)=>(this.isFieldHidden(K.key)&&(K=Object.assign(Object.assign({},K),{hide:!0})),[...V,K]),[])}isFieldHidden(Q){return this.hiddenFields.includes(Q||"")}}v.\u0275fac=function(Q){return new(Q||v)(a.Y36(l.j),a.Y36(h.StateService),a.Y36(n.R))},v.\u0275cmp=a.Xpm({type:v,selectors:[["app-projects"]],features:[a.qOj],decls:1,vars:3,consts:[["helpTextAttributeScope","Project",3,"resourcePath","formHttpMethod","fieldsSettingsPipe"]],template:function(Q,V){1&Q&&a._UZ(0,"op-dynamic-form",0),2&Q&&a.Q6J("resourcePath",V.projectsPath)("formHttpMethod",V.formMethod)("fieldsSettingsPipe",V.dynamicFieldsSettingsPipe)},directives:[m.r],styles:[""]});var c=t(96617),p=t(1707),f=t(61908),C=t(33927),u=t(18137),k=t(77355),O=t(26269),y=t(54364),b=t(18252),P=t(36868);const E=function(G){return{"op-highlighted-input":!0,"op-highlighted-input_active":G}};class T extends r.N{constructor(Q,V,K,q,se,te){super(),this.apiV3Service=Q,this.uIRouterGlobals=V,this.pathHelperService=K,this.modalService=q,this.$state=se,this.I18n=te,this.dynamicFieldsSettingsPipe=this.fieldSettingsPipe.bind(this),this.initialPayload={},this.text={use_template:this.I18n.t("js.project.use_template"),no_template_selected:this.I18n.t("js.project.no_template_selected"),advancedSettingsLabel:this.I18n.t("js.forms.advanced_settings"),copySettingsLabel:this.I18n.t("js.project.copy.copy_options")},this.hiddenFields=["identifier","active"],this.copyableTemplateFilter=(new O.qM).add("user_action","=",["projects/copy"]).add("templated","=",!0),this.templateOptions$=this.apiV3Service.projects.filtered(this.copyableTemplateFilter,{pageSize:"-1"}).get().pipe((0,C.U)(ie=>ie.elements.map(le=>({href:le.href,name:le.name})))),this.templateForm=new p.cw({template:new p.NI})}get templateControl(){return this.templateForm.get("template")}ngOnInit(){this.resourcePath=this.apiV3Service.projects.path,this.fieldGroups=[{name:this.text.advancedSettingsLabel,fieldsFilter:Q=>{var V,K,q;return!(["name","parent"].includes(null===(V=Q.templateOptions)||void 0===V?void 0:V.property)||this.isMeta(null===(K=Q.templateOptions)||void 0===K?void 0:K.property)||(null===(q=Q.templateOptions)||void 0===q?void 0:q.required)&&!Q.templateOptions.hasDefault&&null==Q.templateOptions.payloadValue)}},{name:this.text.copySettingsLabel,fieldsFilter:Q=>{var V;return this.isMeta(null===(V=Q.templateOptions)||void 0===V?void 0:V.property)}}],this.uIRouterGlobals.params.parent_id&&this.setParentAsPayload(this.uIRouterGlobals.params.parent_id)}onSubmitted(Q){"JobStatus"===Q._type?this.modalService.show(u.L,"global",{jobId:Q.jobId}):window.location.href=this.pathHelperService.projectPath(Q.identifier)}onTemplateSelected(Q){var V;this.initialPayload=Object.assign(Object.assign({},this.initialPayload),{name:this.dynamicForm.model.name,_meta:Object.assign(Object.assign({},null===(V=this.initialPayload)||void 0===V?void 0:V._meta),{sendNotifications:!1})}),this.formUrl=(null==Q?void 0:Q.href)?`${Q.href}/copy`:null}isHiddenField(Q){return"_meta.sendNotifications"!==Q&&(!!Q&&(this.hiddenFields.includes(Q)||this.isMeta(Q)))}isMeta(Q){return!!Q&&(Q.startsWith("copy")||"sendNotifications"===Q)}setParentAsPayload(Q){const V=this.apiV3Service.projects.id(Q).path;this.initialPayload={_links:{parent:{href:V}}}}fieldSettingsPipe(Q){return Q.map(V=>Object.assign(Object.assign({},V),{hide:this.isHiddenField(V.key)}))}}T.\u0275fac=function(Q){return new(Q||T)(a.Y36(f.T),a.Y36(h.UIRouterGlobals),a.Y36(l.j),a.Y36(k.S),a.Y36(h.StateService),a.Y36(c.D))},T.\u0275cmp=a.Xpm({type:T,selectors:[["op-new-project"]],viewQuery:function(Q,V){if(1&Q&&a.Gf(m.r,5),2&Q){let K;a.iGM(K=a.CRH())&&(V.dynamicForm=K.first)}},features:[a.qOj],decls:6,vars:15,consts:[[1,"op-form",3,"formGroup"],[3,"ngClass"],["data-qa-field-name","use_template",3,"label"],["bindLabel","name","slot","input",3,"formControl","items","placeholder","ngModelChange"],["helpTextAttributeScope","Project",3,"formUrl","resourcePath","initialPayload","fieldsSettingsPipe","fieldGroups","submitted"]],template:function(Q,V){1&Q&&(a.TgZ(0,"form",0),a.TgZ(1,"div",1),a.TgZ(2,"op-form-field",2),a.TgZ(3,"ng-select",3),a.NdJ("ngModelChange",function(q){return V.onTemplateSelected(q)}),a.ALo(4,"async"),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(5,"op-dynamic-form",4),a.NdJ("submitted",function(q){return V.onSubmitted(q)}),a.qZA()),2&Q&&(a.Q6J("formGroup",V.templateForm),a.xp6(1),a.Q6J("ngClass",a.VKq(13,E,!(null==V.templateControl||!V.templateControl.value))),a.xp6(1),a.Q6J("label",V.text.use_template),a.xp6(1),a.Q6J("formControl",V.templateControl)("items",a.lcZ(4,11,V.templateOptions$))("placeholder",V.text.no_template_selected),a.xp6(2),a.Q6J("formUrl",V.formUrl)("resourcePath",V.resourcePath)("initialPayload",V.initialPayload)("fieldsSettingsPipe",V.dynamicFieldsSettingsPipe)("fieldGroups",V.fieldGroups))},directives:[p._Y,p.JL,p.sg,y.mk,b.V,P.w9,p.JJ,p.oH,m.r],pipes:[y.Ov],styles:[".op-form[_ngcontent-%COMP%]{margin-bottom:1rem}"]});class M extends r.N{constructor(Q,V,K,q,se,te){super(),this.apiV3Service=Q,this.currentProjectService=V,this.pathHelperService=K,this.modalService=q,this.$state=se,this.I18n=te,this.dynamicFieldsSettingsPipe=this.fieldSettingsPipe.bind(this),this.hiddenFields=["identifier","active"],this.text={advancedSettingsLabel:this.I18n.t("js.forms.advanced_settings"),copySettingsLabel:this.I18n.t("js.project.copy.copy_options")}}ngOnInit(){this.formUrl=this.apiV3Service.projects.id(this.currentProjectService.id).copy.form.path,this.fieldGroups=[{name:this.text.advancedSettingsLabel,fieldsFilter:Q=>{var V;return!this.isMeta(null===(V=Q.templateOptions)||void 0===V?void 0:V.property)&&!this.isPrimaryAttribute(Q.templateOptions)}},{name:this.text.copySettingsLabel,fieldsFilter:Q=>{var V;return this.isMeta(null===(V=Q.templateOptions)||void 0===V?void 0:V.property)}}]}onSubmitted(Q){this.modalService.show(u.L,"global",{jobId:Q.jobId})}isHiddenField(Q){return!!Q&&this.hiddenFields.includes(Q)}fieldSettingsPipe(Q){return Q.map(V=>Object.assign(Object.assign({},V),{hide:this.isHiddenField(V.key)}))}isPrimaryAttribute(Q){return!!Q&&(Q.required&&!Q.hasDefault&&null==Q.payloadValue||"name"===Q.property||"parent"===Q.property)}isMeta(Q){return!!Q&&(Q.startsWith("copy")||"sendNotifications"===Q)}}M.\u0275fac=function(Q){return new(Q||M)(a.Y36(f.T),a.Y36(n.R),a.Y36(l.j),a.Y36(k.S),a.Y36(h.StateService),a.Y36(c.D))},M.\u0275cmp=a.Xpm({type:M,selectors:[["op-copy-project"]],features:[a.qOj],decls:1,vars:3,consts:[["helpTextAttributeScope","Project",3,"formUrl","fieldsSettingsPipe","fieldGroups","submitted"]],template:function(Q,V){1&Q&&(a.TgZ(0,"op-dynamic-form",0),a.NdJ("submitted",function(q){return V.onSubmitted(q)}),a.qZA()),2&Q&&a.Q6J("formUrl",V.formUrl)("fieldsSettingsPipe",V.dynamicFieldsSettingsPipe)("fieldGroups",V.fieldGroups)},directives:[m.r],encapsulation:2});const S=[{name:"project_settings",parent:"optional_project",url:"/settings/general/",component:v},{name:"project_copy",parent:"optional_project",url:"/copy",component:M},{name:"new_project",url:"/projects/new?parent_id",component:T}];var F=t(64775),L=t(21757);class D{}D.\u0275fac=function(Q){return new(Q||D)},D.\u0275mod=a.oAB({type:D}),D.\u0275inj=a.cJS({imports:[[L.H,p.UX,i.f,d.E,e.UIRouterModule.forChild({states:S,config:function(G){G.urlService.rules.when(new RegExp("^/projects/(.*)/settings/general$"),Q=>`/projects/${Q[1]}/settings/general/`)}}),F.r]]})},81628:(X,I,t)=>{"use strict";t.d(I,{W:()=>n});var i=t(57014),e=t(96617),d=t(2316),h=t(54364),r=t(2775);class n{constructor(a,m){this.backRoutingService=a,this.I18n=m,this.text={goBack:this.I18n.t("js.button_back")}}goBack(){this.customBackMethod?this.customBackMethod():this.backRoutingService.goBack()}}n.\u0275fac=function(a){return new(a||n)(d.Y36(i.Y),d.Y36(e.D))},n.\u0275cmp=d.Xpm({type:n,selectors:[["op-back-button"]],inputs:{linkClass:"linkClass",customBackMethod:"customBackMethod"},decls:2,vars:2,consts:[["data-qa-selector","op-back-button",1,"op-back-button","button","hide-when-print",3,"ngClass","title","click"],["icon-classes","op-back-button--icon button--icon icon-back-up"]],template:function(a,m){1&a&&(d.TgZ(0,"button",0),d.NdJ("click",function(){return m.goBack()}),d._UZ(1,"op-icon",1),d.qZA()),2&a&&d.Q6J("ngClass",m.linkClass)("title",m.text.goBack)},directives:[h.mk,r.o],styles:[".op-back-button[_ngcontent-%COMP%]{padding:0;line-height:32px;margin:0 1rem 0 0;width:75px;height:34px}.op-back-button--icon[_ngcontent-%COMP%]{font-size:1rem;line-height:22px}@media only screen and (max-width: 679px){.op-back-button_mobile-limited-width[_ngcontent-%COMP%]{width:64px}}"],changeDetection:0})},57014:(X,I,t)=>{"use strict";t.d(I,{Y:()=>n});var i=t(3786),e=t(47775),d=t(84109),h=t(29161),r=t(2316);class n{constructor(a){this.injector=a}goToOtherState(a,m){return this.$state.go(a,m)}goBackToDetailsState(a,m){if(a)this.goToOtherState(m,this.backRoute.params);else{const v=`${m}.details.tabs`,c=Object.assign(Object.assign({},this.backRoute.params),{tabIdentifier:this.keepTab.currentDetailsTab});this.goToOtherState(v,c)}}goBackNotToDetailsState(){this.backRoute.parent?this.goToOtherState(this.backRoute.name,this.backRoute.params).then(()=>{this.$state.reload()}):this.goToOtherState(this.backRoute.name,this.backRoute.params)}goBackToPreviousState(a,m){this.keepTab.isDetailsState(this.backRoute.parent)?this.goBackToDetailsState(a,m):this.goBackNotToDetailsState()}goBack(a=!1){var m;const v=(null===(m=this.backRoute)||void 0===m?void 0:m.baseRoute)||this.$state.current.data.baseRoute||"work-packages.partitioned.list";!this.backRoute&&v.includes("show")?this.$state.reload():!this.backRoute||this.backRoute.name.includes("new")?this.$state.go(v,this.$state.params):this.goBackToPreviousState(a,v)}goToBaseState(){const a=this.$state.current.data.baseRoute||"work-packages.partitioned.list";this.$state.go(a,this.$state.params)}sync(a){const m=a.from(),v=a.to();if(m.name&&m.data&&v.data&&m.data.parent!==v.data.parent){const c=Object.assign({},a.params("from"));this.backRoute={name:m.name,params:c,parent:m.data.parent,baseRoute:m.data.baseRoute}}}set backRoute(a){this._backRoute=a}get backRoute(){return this._backRoute}}n.\u0275fac=function(a){return new(a||n)(r.LFG(r.zs3))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",e.StateService)],n.prototype,"$state",void 0),(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",d.p)],n.prototype,"keepTab",void 0)},66979:(X,I,t)=>{"use strict";t.d(I,{Y:()=>r});var i=t(2316),e=t(96617),d=t(61342),h=t(2775);class r{constructor(l,a,m){this.I18n=l,this.editForm=a,this.cdRef=m,this.onSave=new i.vpe,this.onCancel=new i.vpe,this._saving=!1,this.text={save:this.I18n.t("js.button_save"),cancel:this.I18n.t("js.button_cancel")}}set saving(l){this._saving=l,this.cdRef.detectChanges()}get saving(){return this._saving}save(){this.saving||(this.saving=!0,this.editForm.submit().then(()=>{this.saving=!1,this.onSave.emit()}).catch(()=>{this.saving=!1}))}cancel(){this.editForm.cancel(),this.onCancel.emit()}}r.\u0275fac=function(l){return new(l||r)(i.Y36(e.D),i.Y36(d.n),i.Y36(i.sBO))},r.\u0275cmp=i.Xpm({type:r,selectors:[["wp-edit-actions-bar"]],outputs:{onSave:"onSave",onCancel:"onCancel"},decls:7,vars:3,consts:[[1,"work-packages--edit-actions"],["id","work-packages--edit-actions-save","accesskey","3",1,"button","-highlight",3,"disabled","click"],["icon-classes","button--icon icon-checkmark"],[1,"button--text",3,"textContent"],["id","work-packages--edit-actions-cancel","accesskey","7",1,"button",3,"click"],["icon-classes","button--icon icon-close"]],template:function(l,a){1&l&&(i.TgZ(0,"div",0),i.TgZ(1,"button",1),i.NdJ("click",function(){return a.save()}),i._UZ(2,"op-icon",2),i._UZ(3,"span",3),i.qZA(),i.TgZ(4,"button",4),i.NdJ("click",function(){return a.cancel()}),i._UZ(5,"op-icon",5),i._UZ(6,"span",3),i.qZA(),i.qZA()),2&l&&(i.xp6(1),i.Q6J("disabled",a.saving),i.xp6(2),i.Q6J("textContent",a.text.save),i.xp6(3),i.Q6J("textContent",a.text.cancel))},directives:[h.o],encapsulation:2,changeDetection:0})},77434:(X,I,t)=>{"use strict";t.d(I,{J:()=>f});var i=t(74647),e=t(93175),d=t(26942),h=t(38519),r=t(78434),n=t(2316),l=t(54364),a=t(32557);function m(C,u){if(1&C){const k=n.EpF();n.TgZ(0,"button",3),n.NdJ("click",function(){return n.CHM(k),n.oxw().wpFiltersService.toggleVisibility()}),n.ALo(1,"async"),n._UZ(2,"i",4),n._UZ(3,"span",5),n.qZA()}if(2&C){const k=n.oxw();n.ekj("-active",n.lcZ(1,3,k.visible$)),n.xp6(3),n.Q6J("textContent",k.filterButtonText)}}function v(C,u){if(1&C){const k=n.EpF();n.TgZ(0,"op-query-filters",8),n.NdJ("filtersChanged",function(y){return n.CHM(k),n.oxw(2).replaceIfComplete(y)}),n.qZA()}if(2&C){const k=n.oxw(2);n.Q6J("filters",k.filters)("showCloseFilter",!0)}}function c(C,u){if(1&C&&(n.TgZ(0,"div",6),n.YNc(1,v,1,2,"op-query-filters",7),n.qZA()),2&C){const k=n.oxw();n.xp6(1),n.Q6J("ngIf",!!k.filters)}}const p=function(C){return{"-loaded":C}};class f extends d.N{constructor(u,k,O){super(),this.wpTableFilters=u,this.cdRef=k,this.wpFiltersService=O,this.showFilterButton=!1,this.filterButtonText=I18n.t("js.button_filter"),this.filtersChanged=new e.R((0,h.J6)(this)),this.filters=this.wpTableFilters.current,this.loaded=!1,this.visible$=this.wpFiltersService.observeUntil((0,h.J6)(this))}ngOnInit(){this.wpTableFilters.pristine$().pipe(this.untilDestroyed()).subscribe(()=>{this.filters=this.wpTableFilters.current,this.loaded=!0,this.cdRef.detectChanges()})}replaceIfComplete(u){const k=u.filter(O=>this.wpTableFilters.isAvailable(O));this.wpTableFilters.replaceIfComplete(k),this.filtersChanged.emit(k)}}f.\u0275fac=function(u){return new(u||f)(n.Y36(i.Z),n.Y36(n.sBO),n.Y36(r.U))},f.\u0275cmp=n.Xpm({type:f,selectors:[["op-filter-container"]],inputs:{showFilterButton:"showFilterButton",filterButtonText:"filterButtonText"},outputs:{filtersChanged:"filtersChanged"},features:[n.qOj],decls:4,vars:7,consts:[["class","button -small advanced-filters--toggle",3,"-active","click",4,"ngIf"],[1,"work-packages--filters-optional-container",3,"ngClass"],["id","query_form_content","class","hide-when-print",4,"ngIf"],[1,"button","-small","advanced-filters--toggle",3,"click"],[1,"button--icon","icon-filter"],[1,"button--text",3,"textContent"],["id","query_form_content",1,"hide-when-print"],[3,"filters","showCloseFilter","filtersChanged",4,"ngIf"],[3,"filters","showCloseFilter","filtersChanged"]],template:function(u,k){1&u&&(n.YNc(0,m,4,5,"button",0),n.TgZ(1,"div",1),n.YNc(2,c,2,1,"div",2),n.ALo(3,"async"),n.qZA()),2&u&&(n.Q6J("ngIf",k.showFilterButton),n.xp6(1),n.Q6J("ngClass",n.VKq(5,p,k.loaded)),n.xp6(1),n.Q6J("ngIf",n.lcZ(3,3,k.visible$)))},directives:[l.O5,l.mk,a.H],pipes:[l.Ov],encapsulation:2,changeDetection:0})},32557:(X,I,t)=>{"use strict";t.d(I,{H:()=>de});var i=t(96617),e=t(93175),d=t(43682),h=t(73881),r=t(36868),n=t(74647),l=t(78434),a=t(26942),m=t(38519),v=t(27779),c=t(2316),p=t(54364),f=t(79441),C=t(33927),u=t(83720),k=t(98636),O=t(80639),y=t(43440),b=t(14808),P=t(1707);class E extends a.N{constructor(pe,H,he){super(),this.I18n=pe,this.querySpace=H,this.wpTableFilters=he,this.deactivateFilter=new c.vpe,this.text={createWithDropdown:this.I18n.t("js.work_packages.create.button"),createButton:this.I18n.t("js.label_work_package"),explanation:this.I18n.t("js.label_create_work_package"),placeholder:this.I18n.t("js.work_packages.placeholder_filter_by_text")},this.searchTerm=(0,b.qH)(""),this.searchTermChanged=new f.xQ,this.wpTableFilters.pristine$().pipe(this.untilDestroyed(),(0,C.U)(()=>{const ue=this.wpTableFilters.find("search");return ue?ue.values[0]:""})).subscribe(ue=>{console.log(`upstream ${ue} ${this.searchTerm.timestampOfLastValue}`),(!this.searchTerm.value||this.searchTerm.isValueOlderThan(500))&&(console.log(`Upstream value setting to ${ue}`),this.searchTerm.putValue(ue))}),this.searchTermChanged.pipe(this.untilDestroyed(),(0,u.x)(),(0,k.b)(ue=>this.searchTerm.putValue(ue)),(0,O.b)(500)).subscribe(ue=>{if(ue.length>0)this.wpTableFilters.replace("search",Le=>{Le.operator=Le.findOperator("**"),Le.values=[ue]});else{const Le=this.wpTableFilters.find("search");this.wpTableFilters.remove(Le),this.deactivateFilter.emit(Le)}})}}E.\u0275fac=function(pe){return new(pe||E)(c.Y36(i.D),c.Y36(y.q),c.Y36(n.Z))},E.\u0275cmp=c.Xpm({type:E,selectors:[["wp-filter-by-text-input"]],outputs:{deactivateFilter:"deactivateFilter"},features:[c.qOj],decls:2,vars:4,consts:[["id","filter-by-text-input","type","text",3,"placeholder","ngModel","ngModelChange"]],template:function(pe,H){1&pe&&(c.TgZ(0,"input",0),c.NdJ("ngModelChange",function(ue){return H.searchTermChanged.next(ue)}),c.ALo(1,"async"),c.qZA()),2&pe&&(c.s9C("placeholder",H.text.placeholder),c.Q6J("ngModel",c.lcZ(1,2,H.searchTerm.values$())))},directives:[P.Fj,P.JJ,P.On],pipes:[p.Ov],encapsulation:2});var T=t(2775),M=t(44022),S=t(65146),F=(t(63085),t(96091));class L{constructor(pe){this.I18n=pe,this.shouldFocus=!1,this.filterChanged=new c.vpe}get value(){return this.filter.values[0]}onFilterUpdated(pe){this.filter.values[0]=pe,this.filterChanged.emit(this.filter)}}L.\u0275fac=function(pe){return new(pe||L)(c.Y36(i.D))},L.\u0275cmp=c.Xpm({type:L,selectors:[["op-filter-boolean-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},decls:2,vars:3,consts:[[3,"id"],[3,"name","ngModel","ngModelChange"]],template:function(pe,H){1&pe&&(c.TgZ(0,"label",0),c.TgZ(1,"spot-switch",1),c.NdJ("ngModelChange",function(ue){return H.onFilterUpdated(ue)}),c.qZA(),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.MGl("name","v[",H.filter.name,"]"),c.Q6J("ngModel",H.value))},directives:[F.G,P.JJ,P.On],encapsulation:2});var D=t(84312);class G extends a.N{constructor(pe,H){super(),this.I18n=pe,this.schemaCache=H,this.shouldFocus=!1,this.filterChanged=new e.R((0,m.J6)(this))}get value(){return parseInt(this.filter.values[0])}set value(pe){this.filter.values="number"==typeof pe?[pe.toString()]:[],this.filterChanged.emit(this.filter)}get unit(){switch(this.schema.filter.allowedValues[0].id){case"startDate":case"dueDate":case"updatedAt":case"createdAt":return this.I18n.t("js.work_packages.time_relative.days");default:return""}}get schema(){return this.schemaCache.of(this.filter)}}G.\u0275fac=function(pe){return new(pe||G)(c.Y36(i.D),c.Y36(M.y))},G.\u0275cmp=c.Xpm({type:G,selectors:[["op-filter-integer-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[c.qOj],decls:3,vars:7,consts:[[1,"inline-label",3,"id"],["required","","type","number",1,"advanced-filters--number-field",3,"ngModel","opAutofocus","id","name","ngModelChange"],[1,"advanced-filters--affix",3,"for","textContent"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"input",1),c.NdJ("ngModelChange",function(ue){return H.value=ue}),c.qZA(),c._UZ(2,"label",2),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.MGl("id","values-",H.filter.id,""),c.MGl("name","v[",H.filter.id,"]"),c.Q6J("ngModel",H.value)("opAutofocus",H.shouldFocus),c.xp6(1),c.MGl("for","values-",H.filter.id,""),c.Q6J("textContent",H.unit))},directives:[P.wV,P.Fj,P.Q7,P.JJ,P.On,D.U],encapsulation:2});var Q=t(70692),V=t(90547);class K extends a.N{constructor(pe,H){super(),this.timezoneService=pe,this.I18n=H,this.shouldFocus=!1,this.filterChanged=new e.R((0,m.J6)(this))}get value(){return this.filter.values[0]}set value(pe){this.filter.values=[pe],this.filterChanged.emit(this.filter)}parser(pe){return moment(pe,"YYYY-MM-DD",!0).isValid()?pe:null}formatter(pe){if(moment(pe,"YYYY-MM-DD",!0).isValid()){const H=this.timezoneService.parseDate(pe);return this.timezoneService.formattedISODate(H)}return null}}K.\u0275fac=function(pe){return new(pe||K)(c.Y36(Q.B),c.Y36(i.D))},K.\u0275cmp=c.Xpm({type:K,selectors:[["op-filter-date-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[c.qOj],decls:2,vars:5,consts:[[3,"id"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","opAutofocus","id","name","changed"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"op-single-date-picker",1),c.NdJ("changed",function(ue){return H.value=H.parser(ue)}),c.qZA(),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.Q6J("initialDate",H.formatter(H.value))("opAutofocus",H.shouldFocus)("id","values-"+H.filter.id)("name","v["+H.filter.id+"]"))},directives:[V.S,D.U],encapsulation:2});var q=t(2281);class se extends a.N{constructor(pe,H){super(),this.timezoneService=pe,this.I18n=H,this.shouldFocus=!1,this.filterChanged=new e.R((0,m.J6)(this)),this.text={spacer:this.I18n.t("js.filter.value_spacer")}}get begin(){return this.filter.values[0]}set begin(pe){this.filter.values[0]=pe||"",this.filterChanged.emit(this.filter)}get end(){return this.filter.values[1]}set end(pe){this.filter.values[1]=pe||"",this.filterChanged.emit(this.filter)}parser(pe){return q(pe,"YYYY-MM-DD",!0).isValid()?pe:null}formatter(pe){if(q(pe,"YYYY-MM-DD",!0).isValid()){const H=this.timezoneService.parseDate(pe);return this.timezoneService.formattedISODate(H)}return null}}se.\u0275fac=function(pe){return new(pe||se)(c.Y36(Q.B),c.Y36(i.D))},se.\u0275cmp=c.Xpm({type:se,selectors:[["op-filter-dates-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[c.qOj],decls:4,vars:9,consts:[[1,"inline-label",3,"id"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","opAutofocus","id","name","changed"],[1,"advanced-filters--affix",3,"textContent"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","id","name","changed"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"op-single-date-picker",1),c.NdJ("changed",function(ue){return H.begin=H.parser(ue)}),c.qZA(),c._UZ(2,"span",2),c.TgZ(3,"op-single-date-picker",3),c.NdJ("changed",function(ue){return H.end=H.parser(ue)}),c.qZA(),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.Q6J("initialDate",H.formatter(H.begin))("opAutofocus",H.shouldFocus)("id","values-"+H.filter.id+"-begin")("name","v["+H.filter.id+"]-begin"),c.xp6(1),c.Q6J("textContent",H.text.spacer),c.xp6(1),c.Q6J("initialDate",H.formatter(H.end))("id","values-"+H.filter.id+"-end")("name","v["+H.filter.id+"]-end"))},directives:[V.S,D.U],encapsulation:2});class te extends a.N{constructor(pe,H){super(),this.I18n=pe,this.timezoneService=H}ngOnInit(){_.remove(this.filter.values,pe=>!this.timezoneService.isValidISODateTime(pe))}isoDateParser(pe){if(!this.timezoneService.isValidISODate(pe))return"";const H=this.timezoneService.parseISODatetime(pe);return this.timezoneService.formattedISODateTime(H)}isoDateFormatter(pe){if(!this.timezoneService.isValidISODateTime(pe))return"";const H=this.timezoneService.parseISODatetime(pe);return this.timezoneService.formattedISODate(H)}get isTimeZoneDifferent(){const pe=this.lowerBoundary||this.upperBoundary;return!!pe&&(0!==pe.hours()||0!==pe.minutes())}get timeZoneText(){return this.lowerBoundary&&this.upperBoundary?this.I18n.t("js.filter.time_zone_converted.two_values",{from:this.lowerBoundary.format("YYYY-MM-DD HH:mm"),to:this.upperBoundary.format("YYYY-MM-DD HH:mm")}):this.upperBoundary?this.I18n.t("js.filter.time_zone_converted.only_end",{to:this.upperBoundary.format("YYYY-MM-DD HH:mm")}):this.lowerBoundary?this.I18n.t("js.filter.time_zone_converted.only_start",{from:this.lowerBoundary.format("YYYY-MM-DD HH:mm")}):""}}function ie(ae,pe){if(1&ae&&(c.TgZ(0,"span",3),c._UZ(1,"op-icon",4),c.qZA()),2&ae){const H=c.oxw();c.uIk("data-tooltip",H.timeZoneText)}}te.\u0275fac=function(pe){return new(pe||te)(c.Y36(i.D),c.Y36(Q.B))},te.\u0275dir=c.lG2({type:te,features:[c.qOj]});class le extends te{constructor(pe,H){super(pe,H),this.I18n=pe,this.timezoneService=H,this.shouldFocus=!1,this.filterChanged=new e.R((0,m.J6)(this))}get value(){return this.filter.values[0]}get valueString(){return this.filter.values[0].toString()}set value(pe){this.filter.values=[pe],this.filterChanged.emit(this.filter)}get lowerBoundary(){return this.value&&this.timezoneService.isValidISODateTime(this.valueString)?this.timezoneService.parseDatetime(this.valueString):null}get upperBoundary(){return this.value&&this.timezoneService.isValidISODateTime(this.valueString)?this.timezoneService.parseDatetime(this.valueString).add(24,"hours"):null}}function oe(ae,pe){if(1&ae&&(c.TgZ(0,"span",5),c._UZ(1,"op-icon",6),c.qZA()),2&ae){const H=c.oxw();c.uIk("data-tooltip",H.timeZoneText)}}le.\u0275fac=function(pe){return new(pe||le)(c.Y36(i.D),c.Y36(Q.B))},le.\u0275cmp=c.Xpm({type:le,selectors:[["op-filter-date-time-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[c.qOj],decls:3,vars:6,consts:[[1,"inline-label",3,"id"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","opAutofocus","id","name","changed"],["class","advanced-filters--tooltip-trigger -multiline",4,"ngIf"],[1,"advanced-filters--tooltip-trigger","-multiline"],["icon-classes","icon icon-warning"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"op-single-date-picker",1),c.NdJ("changed",function(ue){return H.value=H.isoDateParser(ue)}),c.qZA(),c.YNc(2,ie,2,1,"span",2),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.Q6J("initialDate",H.isoDateFormatter(H.value))("opAutofocus",H.shouldFocus)("id","values-"+H.filter.id)("name","v["+H.filter.id+"]"),c.xp6(1),c.Q6J("ngIf",H.isTimeZoneDifferent))},directives:[V.S,D.U,p.O5,T.o],encapsulation:2});class ne extends te{constructor(pe,H){super(pe,H),this.I18n=pe,this.timezoneService=H,this.shouldFocus=!1,this.filterChanged=new e.R((0,m.J6)(this)),this.text={spacer:this.I18n.t("js.filter.value_spacer")}}get begin(){return this.filter.values[0]}set begin(pe){this.filter.values[0]=pe||"",this.filterChanged.emit(this.filter)}get end(){return this.filter.values[1]}set end(pe){this.filter.values[1]=pe||"",this.filterChanged.emit(this.filter)}get lowerBoundary(){return this.begin&&this.timezoneService.isValidISODateTime(this.begin.toString())?this.timezoneService.parseDatetime(this.begin.toString()):null}get upperBoundary(){return this.end&&this.timezoneService.isValidISODateTime(this.end.toString())?this.timezoneService.parseDatetime(this.end.toString()):null}}ne.\u0275fac=function(pe){return new(pe||ne)(c.Y36(i.D),c.Y36(Q.B))},ne.\u0275cmp=c.Xpm({type:ne,selectors:[["op-filter-date-times-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[c.qOj],decls:5,vars:10,consts:[[1,"inline-label",3,"id"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","opAutofocus","id","name","changed"],[1,"advanced-filters--affix",3,"textContent"],["classes","advanced-filters--date-field","size","10",3,"initialDate","id","name","changed"],["class","advanced-filters--tooltip-trigger -multiline",4,"ngIf"],[1,"advanced-filters--tooltip-trigger","-multiline"],["icon-classes","icon icon-warning"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"op-single-date-picker",1),c.NdJ("changed",function(ue){return H.begin=H.isoDateParser(ue)}),c.qZA(),c._UZ(2,"span",2),c.TgZ(3,"op-single-date-picker",3),c.NdJ("changed",function(ue){return H.end=H.isoDateParser(ue)}),c.qZA(),c.YNc(4,oe,2,1,"span",4),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.Q6J("initialDate",H.isoDateFormatter(H.begin))("opAutofocus",H.shouldFocus)("id","values-"+H.filter.id+"-begin")("name","v["+H.filter.id+"]-begin"),c.xp6(1),c.Q6J("textContent",H.text.spacer),c.xp6(1),c.Q6J("initialDate",H.isoDateFormatter(H.end))("id","values-"+H.filter.id+"-end")("name","v["+H.filter.id+"]-end"),c.xp6(1),c.Q6J("ngIf",H.isTimeZoneDifferent))},directives:[V.S,D.U,p.O5,T.o],encapsulation:2});class fe extends a.N{constructor(pe){super(),this.I18n=pe,this.shouldFocus=!1,this.filterChanged=new e.R((0,m.J6)(this)),this.text={enter_text:this.I18n.t("js.work_packages.description_enter_text")}}get value(){return this.filter.values[0]}set value(pe){pe.length?this.filter.values[0]=pe:this.filter.values.length=0,this.filterChanged.emit(this.filter)}}fe.\u0275fac=function(pe){return new(pe||fe)(c.Y36(i.D))},fe.\u0275cmp=c.Xpm({type:fe,selectors:[["op-filter-string-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[c.qOj],decls:3,vars:7,consts:[[3,"id"],["required","true","type","text",1,"advanced-filters--text-field",3,"ngModel","opAutofocus","id","name","ngModelChange"],[1,"hidden-for-sighted",3,"for","textContent"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"input",1),c.NdJ("ngModelChange",function(ue){return H.value=ue}),c.qZA(),c._UZ(2,"label",2),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.name,""),c.xp6(1),c.MGl("id","values-",H.filter.name,""),c.MGl("name","v[",H.filter.name,"]"),c.Q6J("ngModel",H.value)("opAutofocus",H.shouldFocus),c.xp6(1),c.MGl("for","values-",H.filter.name,""),c.Q6J("textContent",H.text.enter_text))},directives:[P.Fj,P.Q7,P.JJ,P.On,D.U],encapsulation:2});var ve=t(3786),Se=t(61908),Oe=t(5443);class je extends a.N{constructor(pe,H,he){super(),this.I18n=pe,this.apiV3Service=H,this.currentProjectService=he,this.shouldFocus=!1,this.filterChanged=new e.R((0,m.J6)(this)),this.additionalProjectApiFilters=[]}ngOnInit(){const pe=this.currentProjectService.id;pe&&("subprojectId"===this.filter.id||"onlySubproject"===this.filter.id)&&this.additionalProjectApiFilters.push(["ancestor","=",[pe]])}onChange(pe){return(0,ve.mG)(this,void 0,void 0,function*(){if(pe===this.filter.values||void 0===pe)return;if(!pe)return this.filter.values.length=0,void this.filterChanged.emit(this.filter);const H=yield this.apiV3Service.projects.list({filters:[["id","=",pe.map(he=>String(he.id)||"")]]}).toPromise();this.filter.values=H.elements,this.filterChanged.emit(this.filter)})}}je.\u0275fac=function(pe){return new(pe||je)(c.Y36(i.D),c.Y36(Se.T),c.Y36(S.R))},je.\u0275cmp=c.Xpm({type:je,selectors:[["op-filter-project"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[c.qOj],decls:2,vars:6,consts:[[1,"inline-label","ng-select-container",3,"id"],[1,"advanced-filters--ng-select","-multi-select",3,"value","focusDirectly","multiple","id","apiFilters","valueChange"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"op-project-autocompleter",1),c.NdJ("valueChange",function(ue){return H.onChange(ue)}),c.qZA(),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.Q6J("value",H.filter.values)("focusDirectly",H.shouldFocus)("multiple",!0)("id","values-"+H.filter.id)("apiFilters",H.additionalProjectApiFilters))},directives:[Oe.F],encapsulation:2,changeDetection:0});var tt=t(29092),He=t(70233),st=t(96905),Me=t(91923),ce=t(91593);const J=["ngSelectInstance"],W=function(ae){return{"-required-highlighting":ae}};class Y{constructor(pe,H,he,ue,Le,ht,pt){this.halResourceService=pe,this.halSorting=H,this.PathHelper=he,this.apiV3Service=ue,this.currentUser=Le,this.cdRef=ht,this.I18n=pt,this.shouldFocus=!1,this.filterChanged=new c.vpe,this.availableOptions=[],this.text={placeholder:this.I18n.t("js.placeholders.selection")}}ngOnInit(){this.options=[];const pe=this.filter.currentSchema.values.allowedValues,he=this.filter.values.map(ue=>ue.id);this.halSorting.sort(pe).forEach(ue=>{he.includes(ue.id)||this.options.push(ue)})}ngAfterViewInit(){this.ngSelectInstance&&this.shouldFocus&&this.ngSelectInstance.focus()}get value(){return this.filter.values}setValues(pe){this.options=[];const H=this.filter.currentSchema.values.allowedValues;this.filter.values=_.castArray(pe);const he=this.filter.values.map(ue=>ue.id);this.halSorting.sort(H).forEach(ue=>{he.includes(ue.id)||this.options.push(ue)}),this.filterChanged.emit(this.filter),this.cdRef.detectChanges()}}Y.\u0275fac=function(pe){return new(pe||Y)(c.Y36(Me.u),c.Y36(tt.h),c.Y36(He.j),c.Y36(Se.T),c.Y36(st.S),c.Y36(c.sBO),c.Y36(i.D))},Y.\u0275cmp=c.Xpm({type:Y,selectors:[["op-filter-toggled-multiselect-value"]],viewQuery:function(pe,H){if(1&pe&&c.Gf(J,7),2&pe){let he;c.iGM(he=c.CRH())&&(H.ngSelectInstance=he.first)}},inputs:{shouldFocus:"shouldFocus",options:"options",filter:"filter"},outputs:{filterChanged:"filterChanged"},decls:2,vars:11,consts:[[1,"inline-label","ng-select-container",3,"id"],["appendTo","body","bindLabel","name",1,"advanced-filters--ng-select","-multi-select",3,"id","items","classes","virtualScroll","closeOnSelect","placeholder","hideSelected","multiple","model","change"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"op-autocompleter",1),c.NdJ("change",function(ue){return H.setValues(ue)}),c.qZA(),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.Q6J("id","values-"+H.filter.id)("items",H.options)("classes",c.VKq(9,W,0===H.value.length))("closeOnSelect",!1)("placeholder",H.text.placeholder)("hideSelected",!0)("multiple",!0)("model",H.value))},directives:[ce.s],encapsulation:2,changeDetection:0});var $=t(81134),be=t(26269),N=t(92597),Ue=t(79902),et=t(17163),Ke=t(67727),_e=t(23896);const ye=["ngSelectInstance"],Pe=function(ae){return{"-required-highlighting":ae}};class Ee extends a.N{constructor(pe,H,he,ue,Le,ht,pt,Zt){super(),this.halResourceService=pe,this.apiV3Service=H,this.cdRef=he,this.I18n=ue,this.currentProject=Le,this.currentUser=ht,this.halNotification=pt,this.ngZone=Zt,this.shouldFocus=!1,this.filterChanged=new c.vpe,this.meValue=this.halResourceService.createHalResource({_links:{self:{href:this.apiV3Service.users.me.path,title:this.I18n.t("js.label_me")}}},!0),this.autocompleterFn=Ct=>this.autocomplete(Ct),this.itemTracker=Ct=>Ct.href||Ct.id||Ct.name,this.compareByHref=d.U5,this.resourceType=null,this.text={placeholder:this.I18n.t("js.placeholders.selection")}}get value(){return this.filter.values}ngOnInit(){"id"===this.filter.id&&(this.resourceType="work_packages"),this.initialRequest$=this.loadCollection("").pipe((0,N.d)(1))}autocomplete(pe){return this.initialRequest$.pipe((0,Ue.w)(H=>H.count===H.total?this.matchingItems(H.elements,pe):this.loadCollection(pe).pipe((0,Ue.w)(he=>this.withMeValue(pe,he.elements)))))}matchingItems(pe,H){let he;if(""!==H&&H){const ue=H.toLowerCase();he=pe.filter(Le=>Le.id.includes(ue)||Le.name.toLowerCase().includes(ue))}else he=pe;return this.withMeValue(H,he)}loadCollection(pe){const H=this.createFilters(pe);return this.apiV3Service.collectionFromString(this.allowedValuesLink).filtered(H,{pageSize:"-1"}).get()}createFilters(pe){const H=new be.qM;return pe&&H.add("typeahead","**",[pe]),H}setValues(pe){this.filter.values=pe.length>0?Array.isArray(pe)?pe:[pe]:[],this.filterChanged.emit(this.filter),this.cdRef.detectChanges()}get allowedValuesLink(){const{href:pe}=this.filter.currentSchema.values.allowedValues;return pe}withMeValue(pe,H){return!this.isUserResource||pe&&"me"!==pe?(0,$.of)(H):this.currentUser.isLoggedIn$.pipe((0,_e.take)(1),(0,et.M)(this.currentUser.user$),(0,C.U)(([he,ue])=>he&&ue?[this.meValue].concat(H):H))}get isUserResource(){const pe=_.get(this.filter.currentSchema,"values.type",null);return pe&&pe.indexOf("User")>0}}Ee.\u0275fac=function(pe){return new(pe||Ee)(c.Y36(Me.u),c.Y36(Se.T),c.Y36(c.sBO),c.Y36(i.D),c.Y36(S.R),c.Y36(st.S),c.Y36(Ke.W),c.Y36(c.R0b))},Ee.\u0275cmp=c.Xpm({type:Ee,selectors:[["op-filter-searchable-multiselect-value"]],viewQuery:function(pe,H){if(1&pe&&c.Gf(ye,7),2&pe){let he;c.iGM(he=c.CRH())&&(H.ngSelectInstance=he.first)}},inputs:{filter:"filter",shouldFocus:"shouldFocus"},outputs:{filterChanged:"filterChanged"},features:[c.qOj],decls:2,vars:16,consts:[[1,"inline-label","ng-select-container",3,"id"],["appendTo","body",1,"advanced-filters--ng-select","-multi-select",3,"id","getOptionsFn","classes","virtualScroll","closeOnSelect","placeholder","hideSelected","multiple","fetchDataDirectly","focusDirectly","model","resource","compareWith","trackByFn","change"]],template:function(pe,H){1&pe&&(c.TgZ(0,"div",0),c.TgZ(1,"op-autocompleter",1),c.NdJ("change",function(ue){return H.setValues(ue)}),c.qZA(),c.qZA()),2&pe&&(c.MGl("id","div-values-",H.filter.id,""),c.xp6(1),c.Q6J("id","values-"+H.filter.id)("getOptionsFn",H.autocompleterFn)("classes",c.VKq(14,Pe,0===H.value.length))("closeOnSelect",!1)("placeholder",H.text.placeholder)("hideSelected",!0)("multiple",!0)("fetchDataDirectly",!0)("focusDirectly",H.shouldFocus)("model",H.value)("resource",H.resourceType)("compareWith",H.compareByHref)("trackByFn",H.itemTracker))},directives:[ce.s],encapsulation:2,changeDetection:0});function nt(ae,pe){if(1&ae&&c._UZ(0,"option",12),2&ae){const H=pe.$implicit;c.Q6J("textContent",H.name)("ngValue",H)}}function ct(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"select",10),c.NdJ("ngModelChange",function(ue){c.CHM(H);return c.oxw().filter.operator=ue})("ngModelChange",function(){c.CHM(H);const ue=c.oxw();return ue.onFilterUpdated(ue.filter)}),c.YNc(1,nt,1,2,"option",11),c.qZA()}if(2&ae){const H=c.oxw();c.MGl("id","operators-",H.filter.id,""),c.MGl("name","op[",H.filter.id,"]"),c.Q6J("ngModel",H.filter.operator)("compareWith",H.compareByHref),c.xp6(1),c.Q6J("ngForOf",H.availableOperators)}}function lt(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-boolean-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw().onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw();c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function Ne(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-integer-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(2).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(2);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function Ae(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-date-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(2).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(2);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function xe(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-dates-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(2).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(2);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function Ye(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-date-time-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(2).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(2);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function mt(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-date-times-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(2).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(2);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function Ot(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-string-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(2).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(2);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function Pt(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-string-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(2).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(2);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function Mt(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-project",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(2).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(2);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function yt(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-toggled-multiselect-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(3).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(3);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function jt(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"op-filter-searchable-multiselect-value",13),c.NdJ("filterChanged",function(ue){return c.CHM(H),c.oxw(3).onFilterUpdated(ue)}),c.qZA()}if(2&ae){const H=c.oxw(3);c.Q6J("shouldFocus",H.shouldFocus)("filter",H.filter)}}function Jt(ae,pe){if(1&ae&&(c.ynx(0),c.YNc(1,yt,1,2,"op-filter-toggled-multiselect-value",4),c.YNc(2,jt,1,2,"op-filter-searchable-multiselect-value",4),c.BQk()),2&ae){const H=c.oxw(2);c.xp6(1),c.Q6J("ngIf",H.filter.currentSchema.loadedAllowedValues()),c.xp6(1),c.Q6J("ngIf",!H.filter.currentSchema.loadedAllowedValues())}}function Ft(ae,pe){if(1&ae&&(c.ynx(0),c.TgZ(1,"div",14),c.YNc(2,Ne,1,2,"op-filter-integer-value",15),c.YNc(3,Ae,1,2,"op-filter-date-value",15),c.YNc(4,xe,1,2,"op-filter-dates-value",15),c.YNc(5,Ye,1,2,"op-filter-date-time-value",15),c.YNc(6,mt,1,2,"op-filter-date-times-value",15),c.YNc(7,Ot,1,2,"op-filter-string-value",15),c.YNc(8,Pt,1,2,"op-filter-string-value",15),c.YNc(9,Mt,1,2,"op-filter-project",15),c.YNc(10,Jt,3,2,"ng-container",16),c.qZA(),c.BQk()),2&ae){const H=c.oxw();c.xp6(1),c.Q6J("ngSwitch",H.valueType),c.xp6(1),c.Q6J("ngSwitchCase","[1]Integer"),c.xp6(1),c.Q6J("ngSwitchCase","[1]Date"),c.xp6(1),c.Q6J("ngSwitchCase","[2]Date"),c.xp6(1),c.Q6J("ngSwitchCase","[1]DateTime"),c.xp6(1),c.Q6J("ngSwitchCase","[2]DateTime"),c.xp6(1),c.Q6J("ngSwitchCase","[1]String"),c.xp6(1),c.Q6J("ngSwitchCase","[1]Float"),c.xp6(1),c.Q6J("ngSwitchCase","[]Project")}}function It(ae,pe){1&ae&&c._UZ(0,"div",17)}class gt{constructor(pe,H,he,ue,Le){this.wpTableFilters=pe,this.schemaCache=H,this.I18n=he,this.currentProject=ue,this.bannerService=Le,this.shouldFocus=!1,this.filterChanged=new c.vpe,this.deactivateFilter=new c.vpe,this.showValuesInput=!1,this.eeShowBanners=!1,this.trackByHref=d.tL,this.compareByHref=d.U5,this.text={open_filter:this.I18n.t("js.filter.description.text_open_filter"),close_filter:this.I18n.t("js.filter.description.text_close_filter"),label_filter_add:this.I18n.t("js.work_packages.label_filter_add"),upsale_for_more:this.I18n.t("js.filter.upsale_for_more"),upsale_link:this.I18n.t("js.filter.upsale_link"),button_delete:this.I18n.t("js.button_delete")}}onFilterUpdated(pe){this.filter=pe,this.showValuesInput=this.showValues(),this.filterChanged.emit()}removeThisFilter(){this.deactivateFilter.emit(this.filter)}get valueType(){if(this.filter.currentSchema&&this.filter.currentSchema.values)return this.filter.currentSchema.values.type}ngOnInit(){this.eeShowBanners=this.bannerService.eeShowBanners,this.availableOperators=this.schemaCache.of(this.filter).availableOperators,this.showValuesInput=this.showValues()}showValues(){return this.filter.currentSchema.isValueRequired()&&"[1]Boolean"!==this.filter.currentSchema.values.type}}gt.\u0275fac=function(pe){return new(pe||gt)(c.Y36(n.Z),c.Y36(M.y),c.Y36(i.D),c.Y36(S.R),c.Y36(h.j))},gt.\u0275cmp=c.Xpm({type:gt,selectors:[["","query-filter",""]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged",deactivateFilter:"deactivateFilter"},attrs:["query-filter",""],decls:12,vars:11,consts:[[1,"advanced-filters--filter-name",3,"for","textContent"],[1,"advanced-filters--filter-operator"],[1,"hidden-for-sighted",3,"for"],["required","","class","advanced-filters--select","style","vertical-align: top;",3,"id","name","ngModel","compareWith","ngModelChange",4,"ngIf"],[3,"shouldFocus","filter","filterChanged",4,"ngIf"],[4,"ngIf"],["class","advanced-filters--filter-value",4,"ngIf"],[1,"advanced-filters--remove-filter"],["type","button",1,"spot-link",3,"title","click"],["icon-classes","icon-close advanced-filters--remove-filter-icon"],["required","",1,"advanced-filters--select",2,"vertical-align","top",3,"id","name","ngModel","compareWith","ngModelChange"],[3,"textContent","ngValue",4,"ngFor","ngForOf"],[3,"textContent","ngValue"],[3,"shouldFocus","filter","filterChanged"],[1,"advanced-filters--filter-value",3,"ngSwitch"],[3,"shouldFocus","filter","filterChanged",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"advanced-filters--filter-value"]],template:function(pe,H){1&pe&&(c.ynx(0),c._UZ(1,"label",0),c.TgZ(2,"div",1),c.TgZ(3,"label",2),c._uU(4),c.qZA(),c.YNc(5,ct,2,5,"select",3),c.YNc(6,lt,1,2,"op-filter-boolean-value",4),c.qZA(),c.YNc(7,Ft,11,9,"ng-container",5),c.YNc(8,It,1,0,"div",6),c.TgZ(9,"div",7),c.TgZ(10,"button",8),c.NdJ("click",function(){return H.removeThisFilter()}),c._UZ(11,"op-icon",9),c.qZA(),c.qZA(),c.BQk()),2&pe&&(c.xp6(1),c.MGl("for","operators-",H.filter.id,""),c.Q6J("textContent",H.filter.name),c.uIk("title",H.filter.name),c.xp6(2),c.MGl("for","operators-",H.filter.id,""),c.xp6(1),c.AsE(" ",H.filter.name," ",H.text.open_filter," "),c.xp6(1),c.Q6J("ngIf","[1]Boolean"!==H.valueType),c.xp6(1),c.Q6J("ngIf","[1]Boolean"==H.valueType),c.xp6(1),c.Q6J("ngIf",H.showValuesInput&&H.valueType),c.xp6(1),c.Q6J("ngIf",!H.showValuesInput),c.xp6(2),c.Q6J("title",H.text.button_delete))},directives:[p.O5,T.o,P.EJ,P.Q7,P.JJ,P.On,p.sg,P.YN,P.Kr,L,p.RF,p.n9,p.ED,G,K,se,le,ne,fe,je,Y,Ee],encapsulation:2});var kt=t(8158);function ti(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"a",20),c.NdJ("click",function(){return c.CHM(H),c.oxw(2).closeFilter()}),c.qZA()}if(2&ae){const H=c.oxw(2);c.uIk("title",H.text.close_form)}}function ii(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"li",22),c.NdJ("deactivateFilter",function(ue){return c.CHM(H),c.oxw(3).deactivateFilter(ue)})("filterChanged",function(){c.CHM(H);const ue=c.oxw(3);return ue.filtersChanged.emit(ue.filters)}),c.qZA()}if(2&ae){const H=c.oxw(),he=H.$implicit,ue=H.index,Le=c.oxw(2);c.MGl("id","filter_",he.id,""),c.Q6J("shouldFocus",ue==Le.focusElementIndex)("filter",he)}}function $t(ae,pe){if(1&ae&&(c.ynx(0),c.YNc(1,ii,1,3,"li",21),c.BQk()),2&ae){const H=pe.$implicit,he=c.oxw(2);c.xp6(1),c.Q6J("ngIf",he.isFilterAvailable(H))}}function vt(ae,pe){1&ae&&c._UZ(0,"li",9)}function Ht(ae,pe){if(1&ae&&c._UZ(0,"op-enterprise-banner",23),2&ae){const H=c.oxw(2);c.Q6J("linkMessage",H.text.upsale_link)("textMessage",H.text.upsale_for_more)("moreInfoLink",H.text.more_info_link)}}function Wt(ae,pe){if(1&ae){const H=c.EpF();c.TgZ(0,"fieldset",1),c._UZ(1,"legend",2),c.YNc(2,ti,1,1,"a",3),c.TgZ(3,"ul",4),c.TgZ(4,"li",5),c._UZ(5,"label",6),c.TgZ(6,"div",7),c.TgZ(7,"wp-filter-by-text-input",8),c.NdJ("deactivateFilter",function(ue){return c.CHM(H),c.oxw().deactivateFilter(ue)}),c.qZA(),c.qZA(),c.qZA(),c._UZ(8,"li",9),c.YNc(9,$t,2,1,"ng-container",10),c.YNc(10,vt,1,0,"li",11),c.TgZ(11,"li",12),c.TgZ(12,"label",13),c._UZ(13,"op-icon",14),c._uU(14),c.qZA(),c.TgZ(15,"label",15),c._uU(16),c.qZA(),c.TgZ(17,"div",16),c.TgZ(18,"ng-select",17,18),c.NdJ("open",function(){return c.CHM(H),c.oxw().onOpen()})("change",function(ue){return c.CHM(H),c.oxw().onFilterAdded(ue)}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.YNc(20,Ht,1,3,"op-enterprise-banner",19),c.qZA()}if(2&ae){const H=c.oxw();c.xp6(1),c.Q6J("textContent",H.text.selected_filter_list),c.xp6(1),c.Q6J("ngIf",H.showCloseFilter),c.xp6(3),c.Q6J("textContent",H.text.filter_by_text),c.uIk("title",H.text.filter_by_text),c.xp6(4),c.Q6J("ngForOf",H.filters)("ngForTrackBy",H.trackByName),c.xp6(1),c.Q6J("ngIf",H.isSecondSpacerVisible),c.xp6(4),c.hij(" ",H.text.label_filter_add,": "),c.xp6(2),c.lnq(" ",H.text.label_filter_add," ",H.text.open_filter," ",H.text.close_filter," "),c.xp6(2),c.Q6J("items",H.remainingFilters)("clearSearchOnAdd",!0)("multiple",!1)("clearable",!0)("clearOnBackspace",!0)("closeOnSelect",!0)("virtualScroll",!0)("placeholder",H.text.please_select),c.xp6(2),c.Q6J("ngIf",H.eeShowBanners)}}class de extends a.N{constructor(pe,H,he,ue){super(),this.wpTableFilters=pe,this.wpFiltersService=H,this.I18n=he,this.bannerService=ue,this.showCloseFilter=!1,this.filtersChanged=new e.R((0,m.J6)(this),500),this.remainingFilters=[],this.eeShowBanners=!1,this.focusElementIndex=0,this.trackByName=d.As,this.text={open_filter:this.I18n.t("js.filter.description.text_open_filter"),label_filter_add:this.I18n.t("js.work_packages.label_filter_add"),close_filter:this.I18n.t("js.filter.description.text_close_filter"),upsale_for_more:this.I18n.t("js.filter.upsale_for_more"),upsale_link:this.I18n.t("js.filter.upsale_link"),more_info_link:v.rj.website,close_form:this.I18n.t("js.close_form_title"),selected_filter_list:this.I18n.t("js.label_selected_filter_list"),button_delete:this.I18n.t("js.button_delete"),please_select:this.I18n.t("js.placeholders.selection"),filter_by_text:this.I18n.t("js.work_packages.label_filter_by_text")}}ngOnInit(){this.eeShowBanners=this.bannerService.eeShowBanners}ngOnChanges(){this.updateRemainingFilters()}onFilterAdded(pe){if(pe){const H=this.wpTableFilters.instantiate(pe);this.filters.push(H);const he=this.currentFilterLength();this.updateFilterFocus(he),this.updateRemainingFilters(),this.filtersChanged.emit(this.filters),this.ngSelectComponent.clearItem(pe)}}closeFilter(){this.wpFiltersService.toggleVisibility()}deactivateFilter(pe){const H=this.filters.indexOf(pe);_.remove(this.filters,he=>he.id===pe.id),this.filtersChanged.emit(this.filters),this.updateFilterFocus(H),this.updateRemainingFilters()}get isSecondSpacerVisible(){const pe=!!_.find(this.filters,he=>"search"===he.id),H=!!this.filters.find(he=>"search"!==he.id&&this.isFilterAvailable(he));return pe&&H}updateRemainingFilters(){this.remainingFilters=_.sortBy(this.wpTableFilters.remainingVisibleFilters(this.filters),"name")}updateFilterFocus(pe){const H=this.currentFilterLength();if(0===H)this.focusElementIndex=-1;else{const he=pe<H?pe:H-1,ue=this.currentFilterAt(he);this.focusElementIndex=this.filters.indexOf(ue)}}currentFilterLength(){return this.filters.length}currentFilterAt(pe){return this.filters[pe]}isFilterAvailable(pe){return this.wpTableFilters.availableFilters.some(H=>H.id===pe.id)&&!(this.wpTableFilters.hidden.includes(pe.id)||pe.isTemplated())}onOpen(){setTimeout(()=>{const pe=this.ngSelectComponent;pe&&pe.dropdownPanel&&pe.dropdownPanel._updatePosition()},25)}}de.\u0275fac=function(pe){return new(pe||de)(c.Y36(n.Z),c.Y36(l.U),c.Y36(i.D),c.Y36(h.j))},de.\u0275cmp=c.Xpm({type:de,selectors:[["op-query-filters"]],viewQuery:function(pe,H){if(1&pe&&c.Gf(r.w9,5),2&pe){let he;c.iGM(he=c.CRH())&&(H.ngSelectComponent=he.first)}},inputs:{filters:"filters",showCloseFilter:"showCloseFilter"},outputs:{filtersChanged:"filtersChanged"},features:[c.qOj,c.TTD],decls:1,vars:1,consts:[["id","filters","class","advanced-filters--container",4,"ngIf"],["id","filters",1,"advanced-filters--container"],[3,"textContent"],["class","advanced-filters--close icon-context icon-close",3,"click",4,"ngIf"],[1,"advanced-filters--filters"],["id","filter_search",1,"advanced-filters--filter","--without-operator"],["for","filter-by-text-input",1,"advanced-filters--filter-name",3,"textContent"],[1,"advanced-filters--filter-value"],[3,"deactivateFilter"],[1,"advanced-filters--spacer"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","advanced-filters--spacer",4,"ngIf"],[1,"advanced-filters--add-filter"],["for","add_filter_select","aria-hidden","true",1,"advanced-filters--add-filter-label"],["icon-classes","icon-add icon4"],["for","add_filter_select",1,"hidden-for-sighted"],[1,"advanced-filters--add-filter-value"],["id","add_filter_select","bindLabel","name","appendTo","body",3,"items","clearSearchOnAdd","multiple","clearable","clearOnBackspace","closeOnSelect","virtualScroll","placeholder","open","change"],["ngSelectComponent",""],["class","advanced-filters--add-filter-info","opReferrer","wp-filter#filters",3,"linkMessage","textMessage","moreInfoLink",4,"ngIf"],[1,"advanced-filters--close","icon-context","icon-close",3,"click"],["query-filter","","class","advanced-filters--filter",3,"id","shouldFocus","filter","deactivateFilter","filterChanged",4,"ngIf"],["query-filter","",1,"advanced-filters--filter",3,"id","shouldFocus","filter","deactivateFilter","filterChanged"],["opReferrer","wp-filter#filters",1,"advanced-filters--add-filter-info",3,"linkMessage","textMessage","moreInfoLink"]],template:function(pe,H){1&pe&&c.YNc(0,Wt,21,20,"fieldset",0),2&pe&&c.Q6J("ngIf",H.filters)},directives:[p.O5,E,p.sg,T.o,r.w9,gt,kt.P],encapsulation:2,changeDetection:0})},78434:(X,I,t)=>{"use strict";t.d(I,{U:()=>h});var i=t(14808),e=t(22663),d=t(2316);class h{constructor(){this.state=(0,i.qH)(!1)}get visible(){return this.state.getValueOr(!1)}set visible(n){this.state.putValue(n)}observeUntil(n){return this.state.values$().pipe((0,e.R)(n))}toggleVisibility(){this.state.doModify(n=>!n)}}h.\u0275fac=function(n){return new(n||h)},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},82267:(X,I,t)=>{"use strict";t.d(I,{O:()=>n});var i=t(96617),e=t(36293),d=t(79441),h=t(62964),r=t(2316);class n{constructor(a,m,v){this.I18n=a,this.workPackageNotificationService=m,this.toastService=v,this.quoteEvents=new d.xQ}createComment(a,m){return a.addComment({comment:m},{"Content-Type":"application/json; charset=UTF-8"}).catch(v=>this.errorAndReject(v,a))}updateComment(a,m){JSON.stringify({comment:m});return a.update({comment:m},{"Content-Type":"application/json; charset=UTF-8"}).then(c=>(this.toastService.addSuccess(this.I18n.t("js.work_packages.comment_updated")),c)).catch(c=>this.errorAndReject(c))}errorAndReject(a,m){return this.workPackageNotificationService.handleRawError(a,m),Promise.reject(a)}}n.\u0275fac=function(a){return new(a||n)(r.LFG(i.D),r.LFG(h.q),r.LFG(e.kl))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})},5262:(X,I,t)=>{"use strict";t.d(I,{f:()=>R});var i=t(96617),d=(t(24897),t(2316)),h=t(54364),r=t(41945),n=t(62964),l=t(84906),a=t(2775),m=t(11950);const v=function(F){return{workPackageId:F}};function c(F,L){if(1&F&&(d.TgZ(0,"a",5),d._UZ(1,"span",6),d.qZA()),2&F){const D=d.oxw(2);d.Q6J("uiParams",d.VKq(3,v,D.parent.id)),d.uIk("title",D.parent.name),d.xp6(1),d.Q6J("textContent",D.parent.name)}}function p(F,L){if(1&F&&d._UZ(0,"span",6),2&F){const D=d.oxw(3);d.Q6J("textContent",D.text.set_parent)}}function f(F,L){if(1&F){const D=d.EpF();d.TgZ(0,"button",7),d.NdJ("click",function(){return d.CHM(D),d.oxw(2).open()}),d.YNc(1,p,1,1,"span",8),d._UZ(2,"op-icon",9),d.qZA()}if(2&F){const D=d.oxw(2);d.Q6J("title",D.parent?D.text.edit_parent:D.text.set_parent),d.xp6(1),d.Q6J("ngIf",!D.parent),d.xp6(1),d.MGl("icon-classes","icon-small ",D.parent?"icon-edit icon5 icon-no-color":"icon-add icon4","")}}function C(F,L){if(1&F){const D=d.EpF();d.TgZ(0,"button",10),d.NdJ("click",function(){return d.CHM(D),d.oxw(2).updateParent(null)}),d._UZ(1,"op-icon",11),d.qZA()}if(2&F){const D=d.oxw(2);d.Q6J("title",D.text.remove_parent)}}function u(F,L){if(1&F&&(d.ynx(0),d.YNc(1,c,2,5,"a",2),d.YNc(2,f,3,3,"button",3),d.YNc(3,C,2,1,"button",4),d.BQk()),2&F){const D=d.oxw();d.xp6(1),d.Q6J("ngIf",D.parent),d.xp6(1),d.Q6J("ngIf",D.canModifyParent()),d.xp6(1),d.Q6J("ngIf",D.canModifyParent()&&D.parent)}}function k(F,L){if(1&F){const D=d.EpF();d.TgZ(0,"wp-relations-autocomplete",12),d.NdJ("onCancel",function(){return d.CHM(D),d.oxw().close()})("onSelected",function(Q){return d.CHM(D),d.oxw().updateParent(Q)}),d.qZA()}if(2&F){const D=d.oxw();d.Q6J("inputPlaceholder",D.text.set_or_remove_parent)("workPackage",D.workPackage)}}class O{constructor(L,D,G){this.I18n=L,this.wpRelationsHierarchy=D,this.notificationService=G,this.onSwitch=new d.vpe,this.isSaving=!1,this.text={edit_parent:this.I18n.t("js.relation_buttons.change_parent"),set_or_remove_parent:this.I18n.t("js.relations_autocomplete.parent_placeholder"),remove_parent:this.I18n.t("js.relation_buttons.remove_parent"),set_parent:this.I18n.t("js.relation_buttons.set_parent")}}canModifyParent(){return!!this.workPackage.changeParent}get parent(){return this.workPackage&&this.workPackage.parent}get active(){return this.editing}close(){this.toggle(!1)}open(){this.toggle(!0)}updateParent(L){this.close();const D=L?L.id:null;_.get(this.parent,"id",null)!==D&&(this.isSaving=!0,this.wpRelationsHierarchy.changeParent(this.workPackage,D).catch(G=>{this.notificationService.handleRawError(G,this.workPackage)}).then(()=>this.isSaving=!1))}toggle(L){this.editing!==L&&(this.editing=L,this.onSwitch.emit(this.editing))}}O.\u0275fac=function(L){return new(L||O)(d.Y36(i.D),d.Y36(r.O),d.Y36(n.q))},O.\u0275cmp=d.Xpm({type:O,selectors:[["wp-breadcrumb-parent"]],inputs:{workPackage:"workPackage"},outputs:{onSwitch:"onSwitch"},decls:2,vars:2,consts:[[4,"ngIf"],["filterCandidatesFor","parent",3,"inputPlaceholder","workPackage","onCancel","onSelected",4,"ngIf"],["uiSref","work-packages.show","class","op-wp-breadcrumb-parent nocut","data-qa-selector","op-wp-breadcrumb-parent",3,"uiParams",4,"ngIf"],["type","button","class","spot-link wp-relation--parent-change -no-decoration hide-when-print",3,"title","click",4,"ngIf"],["type","button","class","spot-link wp-relation--parent-remove hide-when-print -no-decoration",3,"title","click",4,"ngIf"],["uiSref","work-packages.show","data-qa-selector","op-wp-breadcrumb-parent",1,"op-wp-breadcrumb-parent","nocut",3,"uiParams"],[3,"textContent"],["type","button",1,"spot-link","wp-relation--parent-change","-no-decoration","hide-when-print",3,"title","click"],[3,"textContent",4,"ngIf"],[3,"icon-classes"],["type","button",1,"spot-link","wp-relation--parent-remove","hide-when-print","-no-decoration",3,"title","click"],["icon-classes","icon-small icon-no-color icon-remove icon4"],["filterCandidatesFor","parent",3,"inputPlaceholder","workPackage","onCancel","onSelected"]],template:function(L,D){1&L&&(d.YNc(0,u,4,3,"ng-container",0),d.YNc(1,k,1,2,"wp-relations-autocomplete",1)),2&L&&(d.Q6J("ngIf",!D.active),d.xp6(1),d.Q6J("ngIf",D.active))},directives:[h.O5,l.AnchorUISref,l.UISref,a.o,m.t],encapsulation:2});const y=function(F){return{"icon4 icon-small icon-arrow-right5":F}},b=function(F){return{workPackageId:F}};function P(F,L){if(1&F&&(d.TgZ(0,"li",8),d._UZ(1,"a",9),d.qZA()),2&F){const D=d.oxw(),G=D.first,Q=D.$implicit;d.Q6J("ngClass",d.VKq(4,y,!G)),d.xp6(1),d.Q6J("textContent",Q.name)("uiParams",d.VKq(6,b,Q.id)),d.uIk("title",Q.name)}}function E(F,L){if(1&F&&(d.ynx(0),d.YNc(1,P,2,8,"li",7),d.BQk()),2&F){const D=L.last;d.xp6(1),d.Q6J("ngIf",!D)}}function T(F,L){if(1&F&&(d.ynx(0),d.TgZ(1,"li"),d.TgZ(2,"span"),d._uU(3),d.qZA(),d.qZA(),d.YNc(4,E,2,1,"ng-container",6),d.BQk()),2&F){const D=d.oxw(2);d.xp6(3),d.hij("",D.hierarchyLabel,": "),d.xp6(1),d.Q6J("ngForOf",D.workPackage.ancestors)}}const M=function(F,L){return{"op-wp-breadcrumb--active-parent-select":F,"icon4 icon-small icon-arrow-right5":L}};function S(F,L){if(1&F){const D=d.EpF();d.TgZ(0,"div",1),d.TgZ(1,"ul",2),d.YNc(2,T,5,2,"ng-container",3),d.TgZ(3,"li",4),d.TgZ(4,"wp-breadcrumb-parent",5),d.NdJ("onSwitch",function(Q){return d.CHM(D),d.oxw().updateActiveInput(Q)}),d.qZA(),d.qZA(),d.qZA(),d.qZA()}if(2&F){const D=d.oxw();d.xp6(2),d.Q6J("ngIf",!D.inputActive&&D.hierarchyCount>0),d.xp6(1),d.Q6J("ngClass",d.WLB(3,M,D.inputActive,!D.inputActive&&D.hierarchyCount>1)),d.xp6(1),d.Q6J("workPackage",D.workPackage)}}class R{constructor(L){this.I18n=L,this.text={parent:this.I18n.t("js.relations_hierarchy.parent_headline"),hierarchy:this.I18n.t("js.relations_hierarchy.hierarchy_headline")},this.inputActive=!1}get hierarchyCount(){return this.workPackage.ancestors.length}get hierarchyLabel(){return 1===this.hierarchyCount?this.text.parent:this.text.hierarchy}updateActiveInput(L){this.inputActive=L}}R.\u0275fac=function(L){return new(L||R)(d.Y36(i.D))},R.\u0275cmp=d.Xpm({type:R,selectors:[["wp-breadcrumb"]],inputs:{workPackage:"workPackage"},decls:1,vars:1,consts:[["class","op-wp-breadcrumb -show","data-qa-selector","op-wp-breadcrumb",4,"ngIf"],["data-qa-selector","op-wp-breadcrumb",1,"op-wp-breadcrumb","-show"],["data-qa-selector","op-breadcrumb",1,"op-breadcrumb"],[4,"ngIf"],[3,"ngClass"],[3,"workPackage","onSwitch"],[4,"ngFor","ngForOf"],["class","op-wp-breadcrumb--ellipsed",3,"ngClass",4,"ngIf"],[1,"op-wp-breadcrumb--ellipsed",3,"ngClass"],["uiSref","work-packages.show",1,"nocut",3,"textContent","uiParams"]],template:function(L,D){1&L&&d.YNc(0,S,5,6,"div",0),2&L&&d.Q6J("ngIf",D.workPackage)},directives:[h.O5,h.mk,O,h.sg,l.AnchorUISref,l.UISref],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-breadcrumb[_ngcontent-%COMP%]{margin-top:10px;display:none;transition:all .1s ease-in-out 0s;overflow:hidden;width:auto;height:initial}.op-wp-breadcrumb[_ngcontent-%COMP%]   ul.op-breadcrumb[_ngcontent-%COMP%]{height:initial;margin:0;padding:0}.op-wp-breadcrumb[_ngcontent-%COMP%]   ul.op-breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:var(--breadcrumb-font-color);font-family:var(--body-font-family);font-size:var(--breadcrumb-font-size);font-weight:normal;list-style-type:none;float:left;margin:0 5px 0 0;padding:0;line-height:20px;max-width:100%;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-wp-breadcrumb.-show[_ngcontent-%COMP%]{display:block}.op-wp-breadcrumb--ellipsed[_ngcontent-%COMP%]{max-width:600px;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-wp-breadcrumb--active-parent-select[_ngcontent-%COMP%]{width:500px}@media screen and (max-width: 1248px){.op-wp-breadcrumb[_ngcontent-%COMP%]{margin-top:0}}.op-wp-breadcrumb[_ngcontent-%COMP%]   ul.op-breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   wp-breadcrumb-parent[_ngcontent-%COMP%]{white-space:initial}.op-wp-breadcrumb[_ngcontent-%COMP%]   .ng-placeholder[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}"]})},44210:(X,I,t)=>{"use strict";t.d(I,{S:()=>e});var i=t(26942);class e extends i.N{constructor(h){super(),this.I18n=h,this.isActive=!1,this.text={activate:this.I18n.t("js.label_activate"),deactivate:this.I18n.t("js.label_deactivate"),label:this.labelKey?this.I18n.t(this.labelKey):"",buttonText:this.textKey?this.I18n.t(this.textKey):""}}get label(){return this.text.label}get buttonText(){return this.text.buttonText}get labelKey(){return""}get textKey(){return""}get activationPrefix(){return this.isActive?"":`${this.text.activate} `}get deactivationPrefix(){return this.isActive?`${this.text.deactivate} `:""}get prefix(){return this.activationPrefix||this.deactivationPrefix}isToggle(){return!1}}},25351:(X,I,t)=>{"use strict";t.d(I,{z:()=>O});var i=t(47775),e=t(96617),d=t(7493),h=t(26942),r=t(38519),n=t(65146),l=t(2316),a=t(20342),m=t(67325),v=t(55548),c=t(1056),p=t(63829),f=t(50076);class C extends v.n{constructor(b,P,E,T,M){super(b,P),this.elementRef=b,this.opContextMenu=P,this.browserDetector=E,this.wpCreate=T,this.$state=M}ngAfterViewInit(){super.ngAfterViewInit(),this.active&&this.browserDetector.isMobile&&(this.stateName="work-packages.new")}open(b){this.wpCreate.getEmptyForm(this.projectIdentifier).then(P=>{this.buildItems(P.schema.type.allowedValues),this.opContextMenu.show(this,b)})}get locals(){return{items:this.items,contextMenuId:"types-context-menu"}}buildItems(b){this.items=b.map(P=>({disabled:!1,linkText:P.name,href:this.$state.href(this.stateName,{type:P.id}),ariaLabel:P.name,class:f.Z.inlineClass("type",P.id),onClick:E=>!(0,m.F)(E)&&(this.$state.go(this.stateName,{type:P.id}),!0)}))}}C.\u0275fac=function(b){return new(b||C)(l.Y36(l.SBq),l.Y36(a.$),l.Y36(c.o),l.Y36(p.P),l.Y36(i.StateService))},C.\u0275dir=l.lG2({type:C,selectors:[["","opTypesCreateDropdown",""]],inputs:{projectIdentifier:"projectIdentifier",stateName:"stateName",active:["dropdownActive","active"]},features:[l.qOj]});var u=t(2775),k=t(54364);class O extends h.N{constructor(b,P,E,T,M,S){super(),this.$state=b,this.currentProject=P,this.authorisationService=E,this.transition=T,this.I18n=M,this.cdRef=S,this.text={title:this.I18n.t("js.work_packages.create.title"),createWithDropdown:this.I18n.t("js.work_packages.create.button"),createButton:this.I18n.t("js.label_work_package"),explanation:this.I18n.t("js.label_create_work_package")}}ngOnInit(){this.projectIdentifier=this.currentProject.identifier,this.authorisationService.observeUntil((0,r.J6)(this)).subscribe(()=>{this.allowed=!!this.allowedWhen.find(b=>{const[P,E]=b.split(".");return this.authorisationService.can(P,E)}),this.updateDisabledState()}),this.transitionUnregisterFn=this.transition.onSuccess({},this.updateDisabledState.bind(this))}ngOnDestroy(){super.ngOnDestroy(),this.transitionUnregisterFn()}updateDisabledState(){this.disabled=!this.allowed||this.$state.includes("**.new"),this.cdRef.detectChanges()}}O.\u0275fac=function(b){return new(b||O)(l.Y36(i.StateService),l.Y36(n.R),l.Y36(d.g),l.Y36(i.TransitionService),l.Y36(e.D),l.Y36(l.sBO))},O.\u0275cmp=l.Xpm({type:O,selectors:[["wp-create-button"]],inputs:{allowedWhen:["allowed","allowedWhen"],stateName$:"stateName$"},features:[l.qOj],decls:6,vars:9,consts:[[1,"wp-create-button"],["opTypesCreateDropdown","",1,"button","-alt-highlight","add-work-package",3,"disabled","projectIdentifier","stateName","dropdownActive","title"],["icon-classes","button--icon icon-add"],["aria-hidden","true",1,"button--text",3,"textContent"],["icon-classes","button--icon icon-small icon-pulldown hidden-for-mobile"]],template:function(b,P){1&b&&(l.TgZ(0,"div",0),l.TgZ(1,"button",1),l.ALo(2,"async"),l._UZ(3,"op-icon",2),l._UZ(4,"span",3),l._UZ(5,"op-icon",4),l.qZA(),l.qZA()),2&b&&(l.xp6(1),l.Q6J("disabled",P.disabled)("projectIdentifier",P.projectIdentifier)("stateName",l.lcZ(2,7,P.stateName$))("dropdownActive",P.allowed)("title",P.text.title),l.uIk("aria-label",P.text.explanation),l.xp6(3),l.Q6J("textContent",P.text.createWithDropdown))},directives:[C,u.o],pipes:[k.Ov],encapsulation:2,changeDetection:0})},22956:(X,I,t)=>{"use strict";t.d(I,{U:()=>c});var i=t(44210),e=t(96617),d=t(74647),h=t(38519),r=t(78434),n=t(2316),l=t(54364),a=t(2775);function m(p,f){if(1&p&&n._UZ(0,"span",4),2&p){const C=n.oxw();n.Q6J("textContent",C.filterCount)}}const v=function(p){return{"-active":p}};class c extends i.S{constructor(f,C,u,k){super(f),this.I18n=f,this.cdRef=C,this.wpFiltersService=u,this.wpTableFilters=k,this.initialized=!1,this.buttonId="work-packages-filter-toggle-button",this.iconClass="icon-filter",this.title=this.I18n.t("js.work_packages.filters.title")}ngOnInit(){this.setupObserver()}get labelKey(){return"js.button_filter"}get textKey(){return"js.toolbar.filter"}get label(){return this.prefix+this.text.label}get filterCount(){return this.count}performAction(f){this.toggleVisibility()}toggleVisibility(){this.wpFiltersService.toggleVisibility()}setupObserver(){this.wpTableFilters.live$().pipe(this.untilDestroyed()).subscribe(()=>{this.count=this.wpTableFilters.currentlyVisibleFilters.length,this.initialized=!0,this.cdRef.detectChanges()}),this.wpFiltersService.observeUntil((0,h.J6)(this)).subscribe(()=>{this.isActive=this.wpFiltersService.visible,this.cdRef.detectChanges()})}}c.\u0275fac=function(f){return new(f||c)(n.Y36(e.D),n.Y36(n.sBO),n.Y36(r.U),n.Y36(d.Z))},c.\u0275cmp=n.Xpm({type:c,selectors:[["wp-filter-button"]],features:[n.qOj],decls:5,vars:11,consts:[["data-qa-selector","wp-filter-button",1,"button",3,"disabled","ngClass","click"],[3,"icon-classes"],[1,"button--text"],["class","badge -secondary",3,"textContent",4,"ngIf"],[1,"badge","-secondary",3,"textContent"]],template:function(f,C){1&f&&(n.TgZ(0,"button",0),n.NdJ("click",function(k){return C.performAction(k)}),n._UZ(1,"op-icon",1),n.TgZ(2,"span",2),n._uU(3),n.YNc(4,m,1,1,"span",3),n.qZA(),n.qZA()),2&f&&(n.Q6J("disabled",C.disabled)("ngClass",n.VKq(9,v,C.isActive)),n.uIk("id",C.buttonId)("accesskey",C.accessKey)("title",C.title)("aria-label",C.label),n.xp6(1),n.MGl("icon-classes","",C.iconClass," button--icon"),n.xp6(2),n.hij(" ",C.buttonText," "),n.xp6(1),n.Q6J("ngIf",C.initialized))},directives:[l.mk,a.o,l.O5],encapsulation:2,changeDetection:0})},31021:(X,I,t)=>{"use strict";t.d(I,{q:()=>a});var i=t(96617),d=(t(24897),t(82123)),h=t(2316),r=t(2775),n=t(54364);function l(m,v){if(1&m&&h._UZ(0,"span",3),2&m){const c=h.oxw();h.Q6J("textContent",c.text.mark_as_read)}}class a{constructor(v,c){this.I18n=v,this.storeService=c,this.text={mark_as_read:this.I18n.t("js.notifications.center.mark_as_read")}}markAllBelongingNotificationsAsRead(){this.storeService.markAllAsRead()}}a.\u0275fac=function(v){return new(v||a)(h.Y36(i.D),h.Y36(d.O))},a.\u0275cmp=h.Xpm({type:a,selectors:[["op-work-package-mark-notification-button"]],inputs:{workPackage:"workPackage",showWithText:"showWithText"},decls:3,vars:2,consts:[[1,"button",3,"click"],["icon-classes","button--icon icon-mark-read"],["class","button--text",3,"textContent",4,"ngIf"],[1,"button--text",3,"textContent"]],template:function(v,c){1&v&&(h.TgZ(0,"button",0),h.NdJ("click",function(){return c.markAllBelongingNotificationsAsRead()}),h._UZ(1,"op-icon",1),h.YNc(2,l,1,1,"span",2),h.qZA()),2&v&&(h.uIk("title",c.text.mark_as_read),h.xp6(2),h.Q6J("ngIf",c.showWithText))},directives:[r.o,n.O5],encapsulation:2,changeDetection:0})},52025:(X,I,t)=>{"use strict";t.d(I,{b:()=>R});var i=t(96617),e=t(2316),d=t(7493),h=t(55548),r=t(20342),n=t(87853),l=t(61043),m=(t(17577),t(77355)),v=t(57119),c=t(43440),p=t(77616),f=t(67727),C=t(36293),u=t(60312),k=t(1707);class O{constructor(L,D,G,Q){this.states=L,this.querySpace=D,this.authorisationService=G,this.I18n=Q,this.onChange=new e.vpe,this.text={showInMenu:this.I18n.t("js.label_star_query"),visibleForOthers:this.I18n.t("js.label_public_query"),showInMenuText:this.I18n.t("js.work_packages.query.star_text"),visibleForOthersText:this.I18n.t("js.work_packages.query.public_text")}}get canStar(){return this.isSave||this.authorisationService.can("query","star")||this.authorisationService.can("query","unstar")}get canPublish(){const L=this.querySpace.queryForm.value;return this.authorisationService.can("query","updateImmediately")&&L.schema.public.writable}updateStarred(L){this.isStarred=L,this.changed()}updatePublic(L){this.isPublic=L,this.changed()}changed(){this.onChange.emit({isStarred:!!this.isStarred,isPublic:!!this.isPublic})}}O.\u0275fac=function(L){return new(L||O)(e.Y36(n.G),e.Y36(c.q),e.Y36(d.g),e.Y36(i.D))},O.\u0275cmp=e.Xpm({type:O,selectors:[["query-sharing-form"]],inputs:{isSave:"isSave",isStarred:"isStarred",isPublic:"isPublic"},outputs:{onChange:"onChange"},decls:14,vars:8,consts:[[1,"form--field"],[1,"form--field-container","-vertical"],[1,"form--label-with-check-box"],[1,"form--check-box-container"],["type","checkbox","name","is_public","id","show-public",1,"form--check-box",3,"ngModel","disabled","ngModelChange"],[1,"form--field-instructions","-no-margin",3,"textContent"],["type","checkbox","name","show_in_menu","id","show-in-menu",1,"form--check-box",3,"ngModel","disabled","ngModelChange"]],template:function(L,D){1&L&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"label",2),e.TgZ(3,"div",3),e.TgZ(4,"input",4),e.NdJ("ngModelChange",function(Q){return D.updatePublic(Q)}),e.qZA(),e.qZA(),e._uU(5),e.qZA(),e._UZ(6,"div",5),e.qZA(),e.qZA(),e.TgZ(7,"div",0),e.TgZ(8,"div",1),e.TgZ(9,"label",2),e.TgZ(10,"div",3),e.TgZ(11,"input",6),e.NdJ("ngModelChange",function(Q){return D.updateStarred(Q)}),e.qZA(),e.qZA(),e._uU(12),e.qZA(),e._UZ(13,"div",5),e.qZA(),e.qZA()),2&L&&(e.xp6(4),e.Q6J("ngModel",D.isPublic)("disabled",!D.canPublish),e.xp6(1),e.hij(" ",D.text.visibleForOthers," "),e.xp6(1),e.Q6J("textContent",D.text.visibleForOthersText),e.xp6(5),e.Q6J("ngModel",D.isStarred)("disabled",!D.canStar),e.xp6(1),e.hij(" ",D.text.showInMenu," "),e.xp6(1),e.Q6J("textContent",D.text.showInMenuText))},directives:[k.Wl,k.JJ,k.On],encapsulation:2});class y extends u.T{constructor(L,D,G,Q,V,K,q,se,te){super(D,K,L),this.elementRef=L,this.locals=D,this.I18n=G,this.states=Q,this.querySpace=V,this.cdRef=K,this.wpListService=q,this.halNotification=se,this.toastService=te,this.isStarred=!1,this.isPublic=!1,this.isBusy=!1,this.text={title:this.I18n.t("js.modals.form_submit.title"),text:this.I18n.t("js.modals.form_submit.text"),save_as:this.I18n.t("js.label_save_as"),label_name:this.I18n.t("js.modals.label_name"),label_visibility_settings:this.I18n.t("js.label_visibility_settings"),button_save:this.I18n.t("js.modals.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")}}ngOnInit(){super.ngOnInit(),this.query=this.querySpace.query.value,this.isStarred=this.query.starred,this.isPublic=this.query.public}setValues(L){this.isStarred=L.isStarred,this.isPublic=L.isPublic}get afterFocusOn(){return jQuery("#work-packages-settings-button")}saveQuery(L){if(this.isBusy)return;this.isBusy=!0;const D=[];this.query.public!==this.isPublic&&(this.query.public=this.isPublic,D.push(this.wpListService.save(this.query))),this.query.starred!==this.isStarred&&D.push(this.wpListService.toggleStarred(this.query)),Promise.all(D).then(()=>{this.closeMe(L),this.isBusy=!1}).catch(()=>{this.toastService.addError(this.I18n.t("js.error.query_saving")),this.isBusy=!1})}}y.\u0275fac=function(L){return new(L||y)(e.Y36(e.SBq),e.Y36(m.E),e.Y36(i.D),e.Y36(n.G),e.Y36(c.q),e.Y36(e.sBO),e.Y36(l.Z),e.Y36(f.W),e.Y36(C.kl))},y.\u0275cmp=e.Xpm({type:y,selectors:[["ng-component"]],features:[e.qOj],decls:9,vars:7,consts:[["data-indicator-name","modal",1,"spot-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container",3,"isSave","isStarred","isPublic","onChange"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-action-bar--action",3,"textContent","disabled","click"],[1,"button","button_no-margin","-highlight","-with-icon","icon-save","spot-action-bar--action",3,"textContent","click"]],template:function(L,D){1&L&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"query-sharing-form",3),e.NdJ("onChange",function(Q){return D.setValues(Q)}),e.qZA(),e.TgZ(5,"div",4),e.TgZ(6,"div",5),e.TgZ(7,"button",6),e.NdJ("click",function(Q){return D.closeMe(Q)}),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(Q){return D.saveQuery(Q)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&L&&(e.xp6(2),e.Oqu(D.text.label_visibility_settings),e.xp6(2),e.Q6J("isSave",!1)("isStarred",D.isStarred)("isPublic",D.isPublic),e.xp6(3),e.Q6J("textContent",D.text.button_cancel)("disabled",D.isBusy),e.xp6(1),e.Q6J("textContent",D.text.button_save))},directives:[O],encapsulation:2});var b=t(39656);const P=["queryNameField"];class E extends u.T{constructor(L,D,G,Q,V,K,q,se,te){super(D,se,L),this.elementRef=L,this.locals=D,this.I18n=G,this.states=Q,this.querySpace=V,this.wpListService=K,this.halNotification=q,this.cdRef=se,this.toastService=te,this.queryName="",this.isStarred=!1,this.isPublic=!1,this.isBusy=!1,this.text={title:this.I18n.t("js.modals.form_submit.title"),text:this.I18n.t("js.modals.form_submit.text"),save_as:this.I18n.t("js.label_save_as"),label_name:this.I18n.t("js.modals.label_name"),label_visibility_settings:this.I18n.t("js.label_visibility_settings"),button_save:this.I18n.t("js.modals.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")}}setValues(L){this.isStarred=L.isStarred,this.isPublic=L.isPublic}onOpen(){this.queryNameField.nativeElement.focus()}get afterFocusOn(){return jQuery("#work-packages-settings-button")}saveQueryAs(L){if(L.preventDefault(),this.isBusy||!this.queryName)return;this.isBusy=!0;const D=this.querySpace.query.value;D.public=this.isPublic,this.wpListService.create(D,this.queryName).then(G=>this.isStarred&&!G.starred?this.wpListService.toggleStarred(G).then(()=>this.closeMe(L)):(this.closeMe(L),Promise.resolve(!0))).catch(G=>this.halNotification.handleRawError(G)).then(()=>this.isBusy=!1)}}E.\u0275fac=function(L){return new(L||E)(e.Y36(e.SBq),e.Y36(m.E),e.Y36(i.D),e.Y36(n.G),e.Y36(c.q),e.Y36(l.Z),e.Y36(f.W),e.Y36(e.sBO),e.Y36(C.kl))},E.\u0275cmp=e.Xpm({type:E,selectors:[["ng-component"]],viewQuery:function(L,D){if(1&L&&e.Gf(P,7),2&L){let G;e.iGM(G=e.CRH())&&(D.queryNameField=G.first)}},features:[e.qOj],decls:19,vars:10,consts:[["data-indicator-name","modal","name","modalSaveForm",1,"spot-modal","loading-indicator--location",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],["name","modalSaveForm",1,"spot-modal--body","spot-container"],[1,"form--field","-required"],["for","save-query-name",1,"form--label",3,"textContent"],[1,"form--field-container"],[1,"form--text-field-container"],["type","text","name","save-query-name","id","save-query-name","required","",1,"form--text-field",3,"ngModel","ngModelChange"],["queryNameField",""],[1,"spot-subheader-extra-small"],[3,"isSave","isStarred","isPublic","onChange"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","-highlight","-with-icon","icon-save","spot-action-bar--action",3,"textContent","disabled"]],template:function(L,D){1&L&&(e.TgZ(0,"form",0),e.NdJ("submit",function(Q){return D.saveQueryAs(Q)}),e.TgZ(1,"h1",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e._UZ(6,"label",5),e.TgZ(7,"div",6),e.TgZ(8,"div",7),e.TgZ(9,"input",8,9),e.NdJ("ngModelChange",function(Q){return D.queryName=Q}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e._UZ(11,"div",2),e.TgZ(12,"h2",10),e._uU(13),e.qZA(),e.TgZ(14,"query-sharing-form",11),e.NdJ("onChange",function(Q){return D.setValues(Q)}),e.qZA(),e.qZA(),e.TgZ(15,"div",12),e.TgZ(16,"div",13),e.TgZ(17,"button",14),e.NdJ("click",function(Q){return D.closeMe(Q)}),e.qZA(),e._UZ(18,"button",15),e.qZA(),e.qZA(),e.qZA()),2&L&&(e.xp6(2),e.Oqu(D.text.save_as),e.xp6(4),e.Q6J("textContent",D.text.label_name),e.xp6(3),e.Q6J("ngModel",D.queryName),e.xp6(4),e.Oqu(D.text.label_visibility_settings),e.xp6(1),e.Q6J("isSave",!0)("isStarred",D.isStarred)("isPublic",D.isPublic),e.xp6(3),e.Q6J("textContent",D.text.button_cancel),e.xp6(1),e.Q6J("textContent",D.text.button_save)("disabled",D.isBusy||!D.queryName))},directives:[k._Y,k.JL,k.F,k.Fj,k.Q7,k.JJ,k.On,O],encapsulation:2});var T=t(48934);class M extends h.n{constructor(L,D,G,Q,V,K,q,se,te){super(L,D),this.elementRef=L,this.opContextMenu=D,this.opModalService=G,this.wpListService=Q,this.authorisationService=V,this.states=K,this.injector=q,this.querySpace=se,this.I18n=te,this.focusAfterClose=!0}ngAfterViewInit(){super.ngAfterViewInit(),this.querySpace.query.values$().pipe(this.untilDestroyed()).subscribe(L=>{this.query=L}),this.loadingPromise=this.querySpace.queryForm.valuesPromise(),this.querySpace.queryForm.values$().pipe(this.untilDestroyed()).subscribe(L=>{this.form=L})}open(L){this.loadingPromise.then(()=>{this.buildItems(),this.opContextMenu.show(this,L)})}get locals(){return{contextMenuId:"settingsDropdown",items:this.items}}positionArgs(L){const G=super.positionArgs(L);return _.assign(G,{my:"right top",at:"right bottom"}),G}onClose(){this.focusAfterClose&&this.afterFocusOn.focus()}allowQueryAction(L,D){return this.allowAction(L,"query",D)}allowWorkPackageAction(L,D){return this.allowAction(L,"work_packages",D)}allowFormAction(L,D){return!!this.form.$links[D]||(L.stopPropagation(),!1)}allowAction(L,D,G){return!!this.authorisationService.can(D,G)||(L.stopPropagation(),!1)}buildItems(){this.items=[{disabled:!1,linkText:this.I18n.t("js.toolbar.settings.configure_view"),hidden:this.hideTableOptions,icon:"icon-settings",onClick:L=>(this.opContextMenu.close(),this.opModalService.show(v.Q,this.injector),!0)},{linkText:this.I18n.t("js.work_packages.query.insert_columns"),hidden:this.hideTableOptions,icon:"icon-columns",class:"hidden-for-mobile",onClick:()=>(this.opModalService.show(v.Q,this.injector,{initialTab:"columns"}),!0)},{linkText:this.I18n.t("js.toolbar.settings.sort_by"),hidden:this.hideTableOptions,icon:"icon-sort-by",onClick:()=>(this.opModalService.show(v.Q,this.injector,{initialTab:"sort-by"}),!0)},{linkText:this.I18n.t("js.toolbar.settings.group_by"),hidden:this.hideTableOptions,icon:"icon-group-by",class:"hidden-for-mobile",onClick:()=>(this.opModalService.show(v.Q,this.injector,{initialTab:"display-settings"}),!0)},{disabled:!this.query.id||this.authorisationService.cannot("query","updateImmediately"),linkText:this.I18n.t("js.toolbar.settings.page_settings"),icon:"icon-edit",onClick:L=>(this.allowQueryAction(L,"update")&&(this.focusAfterClose=!1,jQuery(`${p.U$}`).trigger(p.mE)),!0)},{disabled:this.authorisationService.cannot("query","updateImmediately"),linkText:this.I18n.t("js.toolbar.settings.save"),icon:"icon-save",onClick:L=>{const{query:D}=this;return!(0,T.Z)(D)&&this.allowQueryAction(L,"updateImmediately")?this.opModalService.show(E,this.injector):D.id&&this.allowQueryAction(L,"updateImmediately")&&this.wpListService.save(D),!0}},{disabled:this.form?!this.form.$links.create_new:this.authorisationService.cannot("query","updateImmediately"),linkText:this.I18n.t("js.toolbar.settings.save_as"),icon:"icon-save",onClick:L=>(this.allowFormAction(L,"create_new")&&this.opModalService.show(E,this.injector),!0)},{disabled:this.authorisationService.cannot("query","delete"),linkText:this.I18n.t("js.toolbar.settings.delete"),icon:"icon-delete",onClick:L=>(this.allowQueryAction(L,"delete")&&window.confirm(this.I18n.t("js.text_query_destroy_confirmation"))&&this.wpListService.delete(),!0)},{disabled:this.authorisationService.cannot("work_packages","representations"),linkText:this.I18n.t("js.toolbar.settings.export"),hidden:this.hideTableOptions,icon:"icon-export",onClick:L=>(this.allowWorkPackageAction(L,"representations")&&this.opModalService.show(b.x,this.injector),!0)},{disabled:this.authorisationService.cannot("query","unstar")&&this.authorisationService.cannot("query","star"),linkText:this.I18n.t("js.toolbar.settings.visibility_settings"),icon:"icon-watched",onClick:L=>((this.allowQueryAction(L,"unstar")||this.allowQueryAction(L,"star"))&&this.opModalService.show(y,this.injector),!0)},{divider:!0,hidden:!(this.query.results.customFields&&this.form.configureForm)},{hidden:!this.query.results.customFields||this.hideTableOptions,href:this.query.results.customFields&&this.query.results.customFields.href,linkText:this.query.results.customFields&&this.query.results.customFields.name,icon:"icon-custom-fields",onClick:()=>!1}]}}M.\u0275fac=function(L){return new(L||M)(e.Y36(e.SBq),e.Y36(r.$),e.Y36(m.S),e.Y36(l.Z),e.Y36(d.g),e.Y36(n.G),e.Y36(e.zs3),e.Y36(c.q),e.Y36(i.D))},M.\u0275dir=e.lG2({type:M,selectors:[["","opSettingsContextMenu",""]],inputs:{query:["opSettingsContextMenu-query","query"],hideTableOptions:"hideTableOptions"},features:[e.qOj]});var S=t(2775);class R{constructor(L){this.I18n=L,this.hideTableOptions=!1,this.text={more_actions:this.I18n.t("js.button_more_actions")}}}R.\u0275fac=function(L){return new(L||R)(e.Y36(i.D))},R.\u0275cmp=e.Xpm({type:R,selectors:[["ng-component"]],inputs:{hideTableOptions:"hideTableOptions"},decls:2,vars:2,consts:[["id","work-packages-settings-button","opSettingsContextMenu","","opSettingsContextMenu-query","query",1,"button","last","work-packages-settings-button","toolbar-icon",3,"title","hideTableOptions"],["icon-classes","button--icon icon-show-more"]],template:function(L,D){1&L&&(e.TgZ(0,"button",0),e._UZ(1,"op-icon",1),e.qZA()),2&L&&e.Q6J("title",D.text.more_actions)("hideTableOptions",D.hideTableOptions)},directives:[M,S.o],encapsulation:2,changeDetection:0})},96418:(X,I,t)=>{"use strict";t.d(I,{f:()=>E});t(24897);var e=t(12703),d=t(96617),h=t(50076),r=t(26942),n=t(44022),l=t(2316),a=t(54364),m=t(47775),v=t(20342),c=t(55548),p=t(36293),f=t(1403),C=t(62964),u=t(84699);class k extends c.n{constructor(M,S,R,F,L,D,G,Q){super(M,S),this.elementRef=M,this.opContextMenu=S,this.$state=R,this.workPackageNotificationService=F,this.halEditing=L,this.toastService=D,this.I18n=G,this.halEvents=Q}open(M){const S=this.halEditing.changeFor(this.workPackage);S.getForm().then(R=>{const F=R.schema.status.allowedValues;this.buildItems(F);const{writable:L}=S.schema.status;L?this.opContextMenu.show(this,M):this.toastService.addError(this.I18n.t("js.work_packages.message_work_package_status_blocked"))})}get locals(){return{items:this.items,contextMenuId:"wp-status-context-menu"}}updateStatus(M){const S=this.halEditing.changeFor(this.workPackage);S.projectedResource.status=M,(0,u.Z)(this.workPackage)||this.halEditing.save(S).then(()=>{this.workPackageNotificationService.showSave(this.workPackage)})}buildItems(M){this.items=M.map(S=>({disabled:!1,linkText:S.name,postIcon:S.isReadonly?"icon-locked":null,postIconTitle:this.I18n.t("js.work_packages.message_work_package_read_only"),class:h.Z.inlineClass("status",S.id),onClick:()=>(this.updateStatus(S),!0)}))}}k.\u0275fac=function(M){return new(M||k)(l.Y36(l.SBq),l.Y36(v.$),l.Y36(m.StateService),l.Y36(C.q),l.Y36(e.l),l.Y36(p.kl),l.Y36(d.D),l.Y36(f.J))},k.\u0275dir=l.lG2({type:k,selectors:[["","wpStatusDropdown",""]],inputs:{workPackage:["wpStatusDropdown-workPackage","workPackage"]},features:[l.qOj]});var O=t(2775);function y(T,M){1&T&&(l.TgZ(0,"span",6),l._UZ(1,"op-icon",7),l.qZA())}const b=function(T){return{"op-wp-status-button_small":T}};function P(T,M){if(1&T&&(l.TgZ(0,"div",1),l.TgZ(1,"button",2),l.YNc(2,y,2,0,"span",3),l._UZ(3,"span",4),l._UZ(4,"op-icon",5),l.qZA(),l.qZA()),2&T){const S=l.oxw();l.Q6J("ngClass",l.VKq(9,b,S.small)),l.uIk("title",S.buttonTitle),l.xp6(1),l.Q6J("ngClass",S.statusHighlightClass)("disabled",!S.allowed)("title",S.status.name)("wpStatusDropdown-workPackage",S.workPackage),l.uIk("aria-label",S.text.explanation),l.xp6(1),l.Q6J("ngIf",S.isReadonly),l.xp6(1),l.Q6J("textContent",S.status.name)}}class E extends r.N{constructor(M,S,R,F){super(),this.I18n=M,this.cdRef=S,this.schemaCache=R,this.halEditing=F,this.small=!1,this.text={explanation:this.I18n.t("js.label_edit_status"),workPackageReadOnly:this.I18n.t("js.work_packages.message_work_package_read_only"),workPackageStatusBlocked:this.I18n.t("js.work_packages.message_work_package_status_blocked")}}ngOnInit(){this.halEditing.temporaryEditResource(this.workPackage).values$().pipe(this.untilDestroyed()).subscribe(M=>{this.workPackage=M,this.workPackage.status&&this.workPackage.status.$load(),this.cdRef.detectChanges()})}get buttonTitle(){return this.schema.isReadonly?this.text.workPackageReadOnly:this.schema.isEditable&&!this.allowed?this.text.workPackageStatusBlocked:""}get statusHighlightClass(){const{status:M}=this;if(M)return h.Z.backgroundClass("status",M.id)}get status(){return this.workPackage.status}get isReadonly(){return this.schema.isReadonly}get allowed(){return this.schema.isAttributeEditable("status")}get schema(){return this.halEditing.typedState(this.workPackage).hasValue()?this.halEditing.typedState(this.workPackage).value.schema:this.schemaCache.of(this.workPackage)}}E.\u0275fac=function(M){return new(M||E)(l.Y36(d.D),l.Y36(l.sBO),l.Y36(n.y),l.Y36(e.l))},E.\u0275cmp=l.Xpm({type:E,selectors:[["wp-status-button"]],inputs:{workPackage:"workPackage",small:"small"},features:[l.qOj],decls:1,vars:1,consts:[["class","op-wp-status-button","data-qa-selector","op-wp-status-button",3,"ngClass",4,"ngIf"],["data-qa-selector","op-wp-status-button",1,"op-wp-status-button",3,"ngClass"],["wpStatusDropdown","",1,"op-wp-status-button--button","button",3,"ngClass","disabled","title","wpStatusDropdown-workPackage"],["class","op-wp-status-button--text button--text",4,"ngIf"],["aria-hidden","true",1,"op-wp-status-button--text","button--text",3,"textContent"],["icon-classes","button--icon icon-small icon-pulldown"],[1,"op-wp-status-button--text","button--text"],["icon-classes","button--icon icon-locked"]],template:function(M,S){1&M&&l.YNc(0,P,5,11,"div",0),2&M&&l.Q6J("ngIf",S.status)},directives:[a.O5,a.mk,k,O.o],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-status-button--button[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;padding:5px;margin-bottom:0;background-color:var(--status-selector-bg-color);border:none;color:#fff;max-width:100%;display:flex}.op-wp-status-button--text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-wp-status-button_small[_ngcontent-%COMP%]   .op-wp-status-button--button[_ngcontent-%COMP%]{line-height:16px;font-size:12px;height:16px;padding:0 5px;margin-right:0}"]})},11266:(X,I,t)=>{"use strict";t.d(I,{h:()=>a,a:()=>m});var i=t(96617),e=t(15950),h=t(44210),r=t(2316),n=t(2775);const l=e,a="zen-mode-toggle-button";class m extends h.S{constructor(c,p){super(c),this.I18n=c,this.cdRef=p,this.buttonId="work-packages-zen-mode-toggle-button",this.buttonClass="toolbar-icon",this.iconClass="icon-zen-mode",this.activateLabel=c.t("js.zen_mode.button_activate"),this.deactivateLabel=c.t("js.zen_mode.button_deactivate");const f=this;l.enabled&&l.onchange(()=>{l.isFullscreen||f.deactivateZenMode()})}get label(){return this.isActive?this.deactivateLabel:this.activateLabel}isToggle(){return!0}deactivateZenMode(){this.isActive=m.inZenMode=!1,jQuery("body").removeClass("zen-mode"),this.disabled=!1,l.enabled&&l.isFullscreen&&l.exit(),this.cdRef.detectChanges()}activateZenMode(){this.isActive=m.inZenMode=!0,jQuery("body").addClass("zen-mode"),l.enabled&&l.request(),this.cdRef.detectChanges()}performAction(c){return m.inZenMode?this.deactivateZenMode():this.activateZenMode(),c.preventDefault(),!1}}m.inZenMode=!1,m.\u0275fac=function(c){return new(c||m)(r.Y36(i.D),r.Y36(r.sBO))},m.\u0275cmp=r.Xpm({type:m,selectors:[["zen-mode-toggle-button"]],features:[r.qOj],decls:2,vars:10,consts:[["type","button",3,"disabled","click"],[3,"icon-classes"]],template:function(c,p){1&c&&(r.TgZ(0,"button",0),r.NdJ("click",function(C){return p.performAction(C)}),r._UZ(1,"op-icon",1),r.qZA()),2&c&&(r.Gre("button ",p.buttonClass,""),r.ekj("-active",p.isActive),r.Q6J("disabled",p.disabled||!p.isToggle()&&p.isActive),r.uIk("id",p.buttonId)("title",p.label)("accesskey",p.accessKey),r.xp6(1),r.MGl("icon-classes","",p.iconClass," button--icon"))},directives:[n.o],encapsulation:2,changeDetection:0})},31744:(X,I,t)=>{"use strict";t.d(I,{T:()=>k});var i=t(3786),e=t(60914),d=t(48451),h=t(11337),r=t(47775),n=t(53916),l=t(29161);class a{constructor(y,b){this.injector=y}get EVENT(){return"click.cardView.card"}get SELECTOR(){return'[data-qa-selector="op-wp-single-card"]'}eventScope(y){return jQuery(y.container.nativeElement)}handleEvent(y,b){const P=jQuery(b.target);if(P.is("a")||P.parent().is("a"))return!0;const E=P.closest("wp-single-card"),T=E.data("workPackageId");return!T||(this.handleWorkPackage(y,T,E,b),!1)}handleWorkPackage(y,b,P,E){this.setSelection(y,b,P,E),y.itemClicked.emit({workPackageId:b,double:!1})}setSelection(y,b,P,E){const T=P.data("classIdentifier"),M=this.wpCardView.findRenderedCard(T);E.ctrlKey||E.metaKey||E.shiftKey||this.wpTableSelection.setSelection(b,M),E.shiftKey&&this.wpTableSelection.setMultiSelectionFrom(this.wpCardView.renderedCards,b,M),(E.ctrlKey||E.metaKey)&&this.wpTableSelection.toggleRow(b),y.selectionChanged.emit(this.wpTableSelection.getSelectedWorkPackageIds()),this.wpTableFocus.updateFocus(b)}}(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",n.U)],a.prototype,"deviceService",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",r.StateService)],a.prototype,"$state",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",e.J)],a.prototype,"wpTableSelection",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",d.o)],a.prototype,"wpTableFocus",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",h.c)],a.prototype,"wpCardView",void 0);class m{constructor(y,b){this.injector=y}get EVENT(){return"dblclick.cardView.card"}get SELECTOR(){return'[data-qa-selector="op-wp-single-card"]'}eventScope(y){return jQuery(y.container.nativeElement)}handleEvent(y,b){const P=jQuery(b.target);if(P.is("a")||P.parent().is("a"))return!0;const T=P.closest("wp-single-card").data("workPackageId");return!T||(y.itemClicked.emit({workPackageId:T,double:!0}),!1)}}(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",r.StateService)],m.prototype,"$state",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",e.J)],m.prototype,"wpTableSelection",void 0);var v=t(20506),c=t(3352),p=t(20342),f=t(99794);class C{constructor(y,b){this.injector=y}get EVENT(){return"contextmenu.cardView.rightclick"}get SELECTOR(){return'[data-qa-selector="op-wp-single-card"]'}eventScope(y){return jQuery(y.container.nativeElement)}handleEvent(y,b){const P=jQuery(b.target);if(P.closest(`.${v.yF}`).length)return(0,c.qu)("Allowing original context menu on state link"),!0;b.preventDefault(),b.stopPropagation();const E=P.closest("wp-single-card"),T=E.data("workPackageId");if(!T)return!0;const M=E.data("classIdentifier"),S=this.wpCardView.findRenderedCard(M);this.wpTableSelection.isSelected(T)||this.wpTableSelection.setSelection(T,S);const R=new f.X(this.injector,T,jQuery(b.target),{},y.showInfoButton);return this.opContextMenu.show(R,b),!1}}(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",e.J)],C.prototype,"wpTableSelection",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",h.c)],C.prototype,"wpCardView",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",p.$)],C.prototype,"opContextMenu",void 0);var u=t(55236);class k extends u.A{constructor(){super(...arguments),this.eventHandlers=[y=>new a(this.injector,y),y=>new m(this.injector,y),y=>new C(this.injector,y)]}}},79460:(X,I,t)=>{"use strict";t.d(I,{q:()=>f});var i=t(3786),e=t(95846),d=t(87853),h=t(63829),r=t(8403),n=t(45237),l=t(68354),a=t(61908),m=t(65146),v=t(62964),c=t(84699),p=t(2316);class f{constructor(u,k,O,y,b,P,E,T,M){this.states=u,this.injector=k,this.reorderService=O,this.wpCreate=y,this.notificationService=b,this.apiV3Service=P,this.currentProject=E,this.dragService=T,this.wpInlineCreate=M}init(u){this.cardView=u}destroy(){null!==this.dragService&&this.dragService.remove(this.cardView.container.nativeElement)}registerDragAndDrop(){null!==this.dragService&&this.dragService.register({dragContainer:this.cardView.container.nativeElement,scrollContainers:[this.cardView.container.nativeElement],moves:u=>{const k=u.dataset.workPackageId,O=this.states.workPackages.get(k).value;return!!O&&this.cardView.canDragOutOf(O)&&!u.dataset.isNew},accepts:()=>this.cardView.dragInto,onMoved:u=>(0,i.mG)(this,void 0,void 0,function*(){const k=u.dataset.workPackageId,O=(0,l.c)(u),y=yield this.reorderService.move(this.currentOrder,k,O);this.updateOrder(y),this.cardView.onMoved.emit()}),onRemoved:u=>{const k=u.dataset.workPackageId,O=this.reorderService.remove(this.currentOrder,k);this.updateOrder(O)},onAdded:u=>(0,i.mG)(this,void 0,void 0,function*(){const k=u.dataset.workPackageId,O=(0,l.c)(u),y=yield this.apiV3Service.work_packages.id(k).get().toPromise(),b=yield this.addWorkPackageToQuery(y,O);return u.parentElement&&u.parentElement.removeChild(u),b})})}get workPackages(){return this._workPackages}set workPackages(u){if(this.activeInlineCreateWp){const k=this._workPackages.find(O=>(0,c.Z)(O));if(k){const O=this._workPackages.indexOf(k);this._workPackages[O]=this.activeInlineCreateWp}else this._workPackages=[this.activeInlineCreateWp,...u]}else this._workPackages=[...u]}get currentOrder(){return this.workPackages.filter(u=>u&&!(0,c.Z)(u)).map(u=>u.id)}updateOrder(u){u=_.uniq(u),Promise.all(u.map(k=>this.apiV3Service.work_packages.id(k).get().toPromise())).then(k=>{this.workPackages=k,this.cardView.cdRef.detectChanges()})}addNewCard(){this.wpCreate.createOrContinueWorkPackage(this.currentProject.identifier).then(u=>{this.activeInlineCreateWp=u.projectedResource,this.workPackages=this.workPackages,this.cardView.cdRef.detectChanges()})}addWorkPackageToQuery(u,k=-1){return(0,i.mG)(this,void 0,void 0,function*(){try{yield this.cardView.workPackageAddedHandler(u);const O=yield this.reorderService.add(this.currentOrder,u.id,k);return this.updateOrder(O),!0}catch(O){this.notificationService.handleRawError(O,u)}return!1})}removeReferenceWorkPackageForm(){this.activeInlineCreateWp&&this.removeCard(this.activeInlineCreateWp)}removeCard(u){const k=this.workPackages.indexOf(u);if(this.workPackages.splice(k,1),this.activeInlineCreateWp=void 0,!(0,c.Z)(u)){const O=this.reorderService.remove(this.currentOrder,u.id);this.updateOrder(O)}}onCardSaved(u){return(0,i.mG)(this,void 0,void 0,function*(){const k=this.workPackages.findIndex(O=>"new"===O.id);if(-1!==k){this.activeInlineCreateWp=void 0;const O=yield this.reorderService.add(this.currentOrder,u.id,k);this.updateOrder(O),this.wpInlineCreate.newInlineWorkPackageCreated.next(u.id)}})}}f.\u0275fac=function(u){return new(u||f)(p.LFG(d.G),p.LFG(p.zs3),p.LFG(e.M),p.LFG(h.P),p.LFG(v.q),p.LFG(a.T),p.LFG(m.R),p.LFG(n.j,8),p.LFG(r.m))},f.\u0275prov=p.Yz7({token:f,factory:f.\u0275fac})},11337:(X,I,t)=>{"use strict";t.d(I,{c:()=>d});var i=t(43440),e=t(2316);class d{constructor(r){this.querySpace=r}classIdentifier(r){return`wp-row-${r.id}`}get renderedCards(){return this.querySpace.tableRendered.getValueOr([])}findRenderedCard(r){return _.findIndex(this.renderedCards,l=>l.classIdentifier===r)}updateRenderedCardsValues(r){this.querySpace.tableRendered.putValue(r.map(n=>({classIdentifier:this.classIdentifier(n),workPackageId:n.id,hidden:!1})))}}d.\u0275fac=function(r){return new(r||d)(e.LFG(i.q))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac})},91488:(X,I,t)=>{"use strict";t.d(I,{x:()=>q});var i=t(3786),e=t(2316),d=t(43440),h=t(96617),r=t(8403),n=t(63829),l=t(43682),a=t(7493),m=t(47775),v=t(87853),c=t(95846),p=t(70233),f=t(33927),C=t(9170),u=t(17163),k=t(64538),O=t(60914),y=t(31744),b=t(11337),P=t(79460),E=t(62964),T=t(53916),M=t(55236),S=t(26942),R=t(38519),F=t(1403),L=t(84699);const D=["container"];function G(se,te){if(1&se&&(e.TgZ(0,"div",5),e._UZ(1,"ndc-dynamic",6),e.qZA()),2&se){const ie=e.oxw();e.xp6(1),e.Q6J("ndcDynamicComponent",ie.referenceClass)("ndcDynamicInjector",ie.injector)("ndcDynamicOutputs",ie.referenceOutputs)}}function Q(se,te){1&se&&e._UZ(0,"hr",9)}function V(se,te){if(1&se){const ie=e.EpF();e.ynx(0),e.TgZ(1,"wp-single-card",7),e.NdJ("onRemove",function(){const ne=e.CHM(ie).$implicit;return e.oxw().removeCard(ne)})("stateLinkClicked",function(oe){return e.CHM(ie),e.oxw().stateLinkClicked.emit(oe)}),e.qZA(),e.YNc(2,Q,1,0,"hr",8),e.BQk()}if(2&se){const ie=te.$implicit,le=e.oxw();e.xp6(1),e.Q6J("workPackage",ie)("showInfoButton",le.showInfoButton)("showStatusButton",le.showStatusButton)("showRemoveButton",le.cardsRemovable)("highlightingMode",le.highlightingMode)("draggable",le.canDragOutOf(ie))("orientation",le.orientation)("shrinkOnMobile",le.shrinkOnMobile),e.uIk("data-is-new",le.isNewResource(ie)||void 0)("data-work-package-id",ie.id)("data-class-identifier",le.cardView.classIdentifier(ie)),e.xp6(1),e.Q6J("ngIf",le.shrinkOnMobile)}}function K(se,te){if(1&se&&(e.TgZ(0,"div"),e._UZ(1,"op-no-results",10),e.qZA()),2&se){const ie=e.oxw();e.xp6(1),e.Q6J("title",ie.text.noResults.title)("description",ie.text.noResults.description)}}class q extends S.N{constructor(te,ie,le,oe,ne,fe,ve,Se,Oe,je,tt,He,st,Me,ce,J,W,Y){super(),this.querySpace=te,this.states=ie,this.injector=le,this.$state=oe,this.I18n=ne,this.wpCreate=fe,this.wpInlineCreate=ve,this.notificationService=Se,this.halEvents=Oe,this.authorisationService=je,this.causedUpdates=tt,this.cdRef=He,this.pathHelper=st,this.wpTableSelection=Me,this.wpViewOrder=ce,this.cardView=J,this.cardDragDrop=W,this.deviceService=Y,this.showStatusButton=!0,this.showInfoButton=!1,this.orientation="vertical",this.cardsRemovable=!1,this.showEmptyResultsBox=!1,this.shrinkOnMobile=!1,this.onMoved=new e.vpe,this.selectionChanged=new e.vpe,this.itemClicked=new e.vpe,this.stateLinkClicked=new e.vpe,this.trackByHref=(0,l.WJ)("lockVersion"),this.isResultEmpty=!1,this.text={removeCard:this.I18n.t("js.card.remove_from_list"),addNewCard:this.I18n.t("js.card.add_new"),noResults:{title:this.I18n.t("js.work_packages.no_results.title"),description:this.I18n.t("js.work_packages.no_results.description")}},this.canAdd=!1,this.canReference=!1,this.inReference=!1,this.referenceClass=this.wpInlineCreate.referenceComponentClass,this.referenceOutputs={onCancel:()=>this.setReferenceMode(!1),onReferenced:$=>this.cardDragDrop.addWorkPackageToQuery($,0)},this.isNewResource=L.Z}ngOnInit(){this.registerCreationCallback(),this.authorisationService.observeUntil((0,R.J6)(this)).subscribe(()=>{this.canAdd=this.wpInlineCreate.canAdd,this.canReference=this.wpInlineCreate.canReference,this.cdRef.detectChanges()}),this.halEvents.aggregated$("WorkPackage").pipe((0,f.U)(te=>te.filter(ie=>"updated"===ie.eventType)),(0,C.h)(te=>{const ie=this.workPackages.map(le=>le.id.toString());return!!te.find(le=>-1!==ie.indexOf(le.id))})).subscribe(()=>{this.workPackages=this.workPackages.map(te=>this.states.workPackages.get(te.id).getValueOr(te)),this.cdRef.detectChanges()}),this.querySpace.results.values$().pipe((0,u.M)(this.querySpace.query.values$()),this.untilDestroyed()).subscribe(([te,ie])=>{this.query=ie,this.workPackages=this.wpViewOrder.orderedWorkPackages(),this.cardView.updateRenderedCardsValues(this.workPackages),this.isResultEmpty=0===this.workPackages.length,this.cdRef.detectChanges()})}ngAfterViewInit(){this.cardDragDrop.init(this),this.deviceService.isMobile||this.cardDragDrop.registerDragAndDrop();const te=this.injector.get(M.m,y.T);te instanceof y.T?te.attachTo(this):new te(this.injector).attachTo(this),this.wpTableSelection.registerSelectAllListener(()=>this.cardView.renderedCards),this.wpTableSelection.registerDeselectAllListener()}ngOnDestroy(){super.ngOnDestroy(),this.cardDragDrop.destroy()}get workPackages(){return this.cardDragDrop.workPackages}set workPackages(te){this.cardDragDrop.workPackages=te}setReferenceMode(te){this.inReference=te,this.cdRef.detectChanges()}addNewCard(){this.cardDragDrop.addNewCard()}removeCard(te){this.cardDragDrop.removeCard(te)}onCardSaved(te){return(0,i.mG)(this,void 0,void 0,function*(){yield this.cardDragDrop.onCardSaved(te)})}classes(){let te="wp-cards-container ";return te+=`-${this.orientation}`,te+=this.shrinkOnMobile?" -shrink":"",te}registerCreationCallback(){this.wpCreate.onNewWorkPackage().pipe(this.untilDestroyed()).subscribe(te=>(0,i.mG)(this,void 0,void 0,function*(){this.onCardSaved(te)}))}}q.\u0275fac=function(te){return new(te||q)(e.Y36(d.q),e.Y36(v.G),e.Y36(e.zs3),e.Y36(m.StateService),e.Y36(h.D),e.Y36(n.P),e.Y36(r.m),e.Y36(E.q),e.Y36(F.J),e.Y36(a.g),e.Y36(k.h),e.Y36(e.sBO),e.Y36(p.j),e.Y36(O.J),e.Y36(c.M),e.Y36(b.c),e.Y36(P.q),e.Y36(T.U))},q.\u0275cmp=e.Xpm({type:q,selectors:[["wp-card-view"]],viewQuery:function(te,ie){if(1&te&&e.Gf(D,7),2&te){let le;e.iGM(le=e.CRH())&&(ie.container=le.first)}},inputs:{canDragOutOf:["dragOutOfHandler","canDragOutOf"],dragInto:"dragInto",highlightingMode:"highlightingMode",workPackageAddedHandler:"workPackageAddedHandler",showStatusButton:"showStatusButton",showInfoButton:"showInfoButton",orientation:"orientation",cardsRemovable:"cardsRemovable",showEmptyResultsBox:"showEmptyResultsBox",shrinkOnMobile:"shrinkOnMobile"},outputs:{onMoved:"onMoved",selectionChanged:"selectionChanged",itemClicked:"itemClicked",stateLinkClicked:"stateLinkClicked"},features:[e.qOj],decls:5,vars:5,consts:[["data-qa-selector","op-wp-card-view",3,"ngClass"],["container",""],["class","wp-inline-create--reference-container",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"wp-inline-create--reference-container"],[3,"ndcDynamicComponent","ndcDynamicInjector","ndcDynamicOutputs"],[3,"workPackage","showInfoButton","showStatusButton","showRemoveButton","highlightingMode","draggable","orientation","shrinkOnMobile","onRemove","stateLinkClicked"],["class","form--separator hidden-for-desktop",4,"ngIf"],[1,"form--separator","hidden-for-desktop"],[3,"title","description"]],template:function(te,ie){1&te&&(e.TgZ(0,"div",0,1),e.YNc(2,G,2,3,"div",2),e.YNc(3,V,3,12,"ng-container",3),e.qZA(),e.YNc(4,K,2,2,"div",4)),2&te&&(e.Q6J("ngClass",ie.classes()),e.xp6(2),e.Q6J("ngIf",ie.inReference),e.xp6(1),e.Q6J("ngForOf",ie.workPackages)("ngForTrackBy",ie.trackByHref),e.xp6(1),e.Q6J("ngIf",ie.showEmptyResultsBox&&ie.isResultEmpty))},styles:[".wp-inline-create-button[_ngcontent-%COMP%]{font-size:.9rem;padding-top:1rem;text-align:center}.wp-inline-create--reference-container[_ngcontent-%COMP%]{margin-bottom:3rem;margin-top:10px}",".wp-cards-container.-horizontal[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));grid-column-gap:10px;grid-row-gap:10px;margin-right:5px}@media only screen and (max-width: 679px){.wp-cards-container.-horizontal.-shrink[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-row-gap:0;margin-right:0}.wp-cards-container.-horizontal.-shrink[_ngcontent-%COMP%]   .form--separator[_ngcontent-%COMP%]{margin-bottom:0}}",".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.wp-cards-container.-vertical[_ngcontent-%COMP%]{height:100%;padding:0 15px;border-radius:2px;overflow-y:scroll;scrollbar-color:transparent transparent;scrollbar-width:thin}.wp-cards-container.-vertical[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.wp-cards-container.-vertical[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.wp-cards-container.-vertical[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.wp-cards-container.-vertical[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.wp-cards-container.-vertical[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}"],changeDetection:0})},37409:(X,I,t)=>{"use strict";t.d(I,{P:()=>ie});var i=t(2316),e=t(20506),d=t(70233),h=t(50076),r=t(47775),n=t(60914),l=t(11337),a=t(96617),m=t(26942),v=t(48451),p=(t(24897),t(67325)),f=t(84699),C=t(70692),u=t(61486),k=t(33927),O=t(54364),y=t(2775),b=t(61342),P=t(54262),E=t(96418),T=t(3742);function M(le,oe){if(1&le){const ne=i.EpF();i.TgZ(0,"button",9),i.NdJ("click",function(ve){i.CHM(ne);const Se=i.oxw();return Se.emitStateLinkClicked(ve,Se.workPackage,!0)}),i._UZ(1,"op-icon",10),i.qZA()}if(2&le){const ne=i.oxw();i.Q6J("title",ne.text.detailsView)}}function S(le,oe){if(1&le){const ne=i.EpF();i.TgZ(0,"button",11),i.NdJ("click",function(){i.CHM(ne);const ve=i.oxw();return ve.onRemoved(ve.workPackage)}),i._UZ(1,"op-icon",12),i.qZA()}if(2&le){const ne=i.oxw();i.ekj("-show",ne.isNewResource(ne.workPackage)),i.Q6J("title",ne.text.removeCard)}}function R(le,oe){if(1&le&&i._UZ(0,"op-icon",13),2&le){const ne=i.oxw();i.Q6J("ngClass","tooltip--"+ne.disabledInfo.orientation),i.uIk("data-tooltip",ne.disabledInfo.text)}}function F(le,oe){if(1&le&&(i.TgZ(0,"edit-form",14),i.TgZ(1,"div",15),i._UZ(2,"op-editable-attribute-field",16),i._UZ(3,"op-editable-attribute-field",17),i.qZA(),i.qZA()),2&le){const ne=i.oxw();i.Q6J("resource",ne.workPackage)("inEditMode",ne.isNewResource(ne.workPackage)),i.xp6(2),i.Q6J("resource",ne.workPackage)("wrapperClasses","work-packages--type-selector")("fieldName","type"),i.xp6(1),i.Q6J("resource",ne.workPackage)}}function L(le,oe){if(1&le&&(i.TgZ(0,"span",29),i._uU(1),i.qZA()),2&le){const ne=i.oxw(2);i.xp6(1),i.hij(" ",ne.startDate(ne.workPackage)," - ")}}function D(le,oe){if(1&le&&i._UZ(0,"span",30),2&le){const ne=i.oxw(2);i.Q6J("textContent",ne.wpTypeAttribute(ne.workPackage))("ngClass",ne.typeHighlightingClass(ne.workPackage))}}function G(le,oe){if(1&le&&(i.TgZ(0,"span",29),i._uU(1),i.qZA()),2&le){const ne=i.oxw(2);i.xp6(1),i.hij(" - ",ne.endDate(ne.workPackage)," ")}}function Q(le,oe){if(1&le&&i._UZ(0,"img",31),2&le){const ne=i.oxw(2);i.Q6J("src",ne.bcfSnapshotPath(ne.workPackage),i.LSH)}}function V(le,oe){if(1&le&&i._UZ(0,"wp-status-button",32),2&le){const ne=i.oxw(2);i.Q6J("workPackage",ne.workPackage)("small",!0)}}function K(le,oe){if(1&le&&i._UZ(0,"op-principal",33),2&le){const ne=i.oxw(2);i.Q6J("principal",ne.workPackage.assignee)("hideName",!0)("link",!1)}}function q(le,oe){if(1&le&&i._UZ(0,"span",34),2&le){const ne=i.oxw(2);i.Q6J("textContent",ne.wpDates(ne.workPackage))("ngClass",ne.wpOverDueHighlighting(ne.workPackage))}}const se=function(le){return{"op-wp-single-card--content-project-name_hideable":le}};function te(le,oe){if(1&le){const ne=i.EpF();i.TgZ(0,"div",18),i.TgZ(1,"span",19),i._uU(2),i.qZA(),i.TgZ(3,"a",20),i.NdJ("click",function(ve){i.CHM(ne);const Se=i.oxw();return Se.emitStateLinkClicked(ve,Se.workPackage)}),i._uU(4),i.qZA(),i.TgZ(5,"span",21),i.YNc(6,L,2,1,"span",22),i.YNc(7,D,1,2,"span",23),i._UZ(8,"span",24),i.YNc(9,G,2,1,"span",22),i.qZA(),i.YNc(10,Q,1,1,"img",25),i.YNc(11,V,1,2,"wp-status-button",26),i.YNc(12,K,1,3,"op-principal",27),i.YNc(13,q,1,2,"span",28),i.qZA()}if(2&le){const ne=i.oxw();i.xp6(1),i.Q6J("ngClass",i.VKq(13,se,ne.showInfoButton||ne.showRemoveButton)),i.xp6(1),i.hij(" - ",ne.wpProjectName(ne.workPackage)," "),i.xp6(1),i.Q6J("href",ne.fullWorkPackageLink(ne.workPackage),i.LSH)("ngClass",ne.uiStateLinkClass),i.xp6(1),i.hij(" #",ne.workPackage.id," "),i.xp6(2),i.Q6J("ngIf",ne.showAsInlineCard&&ne.showStartDate),i.xp6(1),i.Q6J("ngIf",!ne.showAsInlineCard&&"type"!==ne.highlightingMode),i.xp6(1),i.Q6J("textContent",ne.wpSubject(ne.workPackage)),i.xp6(1),i.Q6J("ngIf",ne.showAsInlineCard&&ne.showEndDate),i.xp6(1),i.Q6J("ngIf",ne.cardCoverImageShown(ne.workPackage)&&!ne.showAsInlineCard),i.xp6(1),i.Q6J("ngIf",ne.showStatusButton),i.xp6(1),i.Q6J("ngIf",ne.workPackage.assignee),i.xp6(1),i.Q6J("ngIf",!ne.showAsInlineCard)}}class ie extends m.N{constructor(oe,ne,fe,ve,Se,Oe,je,tt,He){super(),this.pathHelper=oe,this.I18n=ne,this.$state=fe,this.uiRouterGlobals=ve,this.wpTableSelection=Se,this.wpTableFocus=Oe,this.cardView=je,this.cdRef=tt,this.timezoneService=He,this.selectedWhenOpen=!1,this.showInfoButton=!1,this.showStatusButton=!0,this.showRemoveButton=!1,this.highlightingMode="inline",this.draggable=!1,this.orientation="vertical",this.shrinkOnMobile=!1,this.showAsInlineCard=!1,this.showStartDate=!0,this.showEndDate=!0,this.isClosed=!1,this.showAsGhost=!1,this.onRemove=new i.vpe,this.stateLinkClicked=new i.vpe,this.cardClicked=new i.vpe,this.cardDblClicked=new i.vpe,this.cardContextMenu=new i.vpe,this.uiStateLinkClass=e.yF,this.selected=!1,this.text={removeCard:this.I18n.t("js.card.remove_from_list"),detailsView:this.I18n.t("js.button_open_details")},this.isNewResource=f.Z,this.dateTimeFormatYear=new Intl.DateTimeFormat(this.I18n.locale,{year:"numeric",month:"short",day:"numeric"}),this.dateTimeFormat=new Intl.DateTimeFormat(this.I18n.locale,{month:"short",day:"numeric"})}ngOnInit(){(0,u.aj)([this.wpTableSelection.live$(),this.uiRouterGlobals.params$]).pipe(this.untilDestroyed(),(0,k.U)(()=>this.selectedWhenOpen?this.uiRouterGlobals.params.workPackageId===this.workPackage.id:this.wpTableSelection.isSelected(this.workPackage.id))).subscribe(oe=>{this.selected=oe,this.cdRef.detectChanges()})}classIdentifier(oe){return this.cardView.classIdentifier(oe)}emitStateLinkClicked(oe,ne,fe){if((0,p.F)(oe))return;const ve=this.classIdentifier(ne),Se=fe?"split":"show";this.wpTableSelection.setSelection(ne.id,this.cardView.findRenderedCard(ve)),this.wpTableFocus.updateFocus(ne.id),this.stateLinkClicked.emit({workPackageId:ne.id,requestedState:Se}),oe.preventDefault()}cardClasses(){const oe="op-wp-single-card";return{[`${oe}_selected`]:this.selected,[`${oe}_draggable`]:this.draggable,[`${oe}_new`]:(0,f.Z)(this.workPackage),[`${oe}_shrink`]:this.shrinkOnMobile,[`${oe}_inline`]:this.showAsInlineCard,[`${oe}_closed`]:this.isClosed,[`${oe}_ghosted`]:this.showAsGhost,[`${oe}-${this.workPackage.id}`]:!!this.workPackage.id,[`${oe}_${this.orientation}`]:!0}}cardTitle(){return`${this.workPackage.subject} (${this.workPackage.status.name})`}wpTypeAttribute(oe){return oe.type.name}wpSubject(oe){return oe.subject}wpProjectName(oe){var ne;return null===(ne=oe.project)||void 0===ne?void 0:ne.name}wpDates(oe){const{startDate:ne,dueDate:fe}=oe;return ne&&fe?String(this.dateTimeFormatYear.formatRange(new Date(ne),new Date(fe))):!ne&&fe?`\u2013 ${this.dateTimeFormatYear.format(new Date(fe))}`:ne&&!fe?`${this.dateTimeFormatYear.format(new Date(ne))} \u2013`:""}startDate(oe){const{startDate:ne}=oe;return ne?this.dateTimeFormat.format(new Date(ne)):""}endDate(oe){const{dueDate:ne}=oe;return ne?this.dateTimeFormat.format(new Date(ne)):""}wpOverDueHighlighting(oe){const ne=this.timezoneService.daysFromToday(oe.dueDate);return h.Z.overdueDate(ne)}fullWorkPackageLink(oe){return this.$state.href("work-packages.show",{workPackageId:oe.id})}cardHighlightingClass(oe){return this.cardHighlighting(oe)}typeHighlightingClass(oe){return this.attributeHighlighting("type",oe)}onRemoved(oe){this.onRemove.emit(oe)}cardCoverImageShown(oe){return null!==this.bcfSnapshotPath(oe)}bcfSnapshotPath(oe){return oe.bcfViewpoints&&oe.bcfViewpoints.length>0?`${oe.bcfViewpoints[0].href}/snapshot`:null}cardHighlighting(oe){return["status","priority","type"].includes(this.highlightingMode)?h.Z.backgroundClass(this.highlightingMode,oe[this.highlightingMode].id):""}attributeHighlighting(oe,ne){return h.Z.inlineClass(oe,ne.type.id)}}ie.\u0275fac=function(oe){return new(oe||ie)(i.Y36(d.j),i.Y36(a.D),i.Y36(r.StateService),i.Y36(r.UIRouterGlobals),i.Y36(n.J),i.Y36(v.o),i.Y36(l.c),i.Y36(i.sBO),i.Y36(C.B))},ie.\u0275cmp=i.Xpm({type:ie,selectors:[["wp-single-card"]],inputs:{workPackage:"workPackage",selectedWhenOpen:"selectedWhenOpen",showInfoButton:"showInfoButton",showStatusButton:"showStatusButton",showRemoveButton:"showRemoveButton",highlightingMode:"highlightingMode",draggable:"draggable",orientation:"orientation",shrinkOnMobile:"shrinkOnMobile",disabledInfo:"disabledInfo",showAsInlineCard:"showAsInlineCard",showStartDate:"showStartDate",showEndDate:"showEndDate",isClosed:"isClosed",showAsGhost:"showAsGhost"},outputs:{onRemove:"onRemove",stateLinkClicked:"stateLinkClicked",cardClicked:"cardClicked",cardDblClicked:"cardDblClicked",cardContextMenu:"cardContextMenu"},features:[i.qOj],decls:9,vars:10,consts:[["data-qa-selector","op-wp-single-card",1,"op-wp-single-card",3,"ngClass","title","click","dblclick","contextmenu"],[1,"op-wp-single-card--highlighting",3,"ngClass"],[1,"op-wp-single-card--card-actions"],["data-qa-selector","op-wp-single-card--inline-buttons",1,"op-wp-single-card--inline-buttons","hidden-for-mobile"],["type","button","class","spot-link op-wp-single-card--details-button op-wp-single-card--card-action","data-qa-selector","op-wp-single-card--details-button",3,"title","click",4,"ngIf"],["class","spot-link op-wp-single-card--inline-cancel-button op-wp-single-card--card-action","data-qa-selector","op-wp-single-card--inline-cancel-button",3,"-show","title","click",4,"ngIf"],["class","-multiline op-wp-single-card--card-action op-wp-single-card--card-action_closed","icon-classes","icon-context icon-not-supported",3,"ngClass",4,"ngIf"],[3,"resource","inEditMode",4,"ngIf"],["class","op-wp-single-card--content",4,"ngIf"],["type","button","data-qa-selector","op-wp-single-card--details-button",1,"spot-link","op-wp-single-card--details-button","op-wp-single-card--card-action",3,"title","click"],["icon-classes","icon3 icon-info2"],["data-qa-selector","op-wp-single-card--inline-cancel-button",1,"spot-link","op-wp-single-card--inline-cancel-button","op-wp-single-card--card-action",3,"title","click"],["icon-classes","icon-context icon-close"],["icon-classes","icon-context icon-not-supported",1,"-multiline","op-wp-single-card--card-action","op-wp-single-card--card-action_closed",3,"ngClass"],[3,"resource","inEditMode"],[1,"op-wp-single-card-content","-new"],[1,"op-wp-single-card-content--type",3,"resource","wrapperClasses","fieldName"],["fieldName","subject",1,"op-wp-single-card-content--subject","-bold",3,"resource"],[1,"op-wp-single-card--content"],[1,"op-wp-single-card--content-project-name",3,"ngClass"],[1,"op-wp-single-card--content-id",3,"href","ngClass","click"],[1,"op-wp-single-card--content-subject-line"],["class","op-wp-single-card--content-inline-date",4,"ngIf"],["class","op-wp-single-card--content-type","data-qa-selector","op-wp-single-card--content-type",3,"textContent","ngClass",4,"ngIf"],["data-qa-selector","op-wp-single-card--content-subject",1,"op-wp-single-card--content-subject",3,"textContent"],["class","op-wp-single-card--content-cover-image",3,"src",4,"ngIf"],["class","op-wp-single-card--content-status",3,"workPackage","small",4,"ngIf"],["size","mini","class","op-wp-single-card--content-assignee","data-qa-selector","op-wp-single-card--content-assignee",3,"principal","hideName","link",4,"ngIf"],["class","op-wp-single-card--content-dates",3,"textContent","ngClass",4,"ngIf"],[1,"op-wp-single-card--content-inline-date"],["data-qa-selector","op-wp-single-card--content-type",1,"op-wp-single-card--content-type",3,"textContent","ngClass"],[1,"op-wp-single-card--content-cover-image",3,"src"],[1,"op-wp-single-card--content-status",3,"workPackage","small"],["size","mini","data-qa-selector","op-wp-single-card--content-assignee",1,"op-wp-single-card--content-assignee",3,"principal","hideName","link"],[1,"op-wp-single-card--content-dates",3,"textContent","ngClass"]],template:function(oe,ne){1&oe&&(i.TgZ(0,"div",0),i.NdJ("click",function(ve){return ne.cardClicked.emit({workPackageId:ne.workPackage.id,event:ve})})("dblclick",function(ve){return ne.cardDblClicked.emit({workPackageId:ne.workPackage.id,event:ve})})("contextmenu",function(ve){return ne.cardContextMenu.emit({workPackageId:ne.workPackage.id,event:ve})}),i._UZ(1,"div",1),i.TgZ(2,"div",2),i.TgZ(3,"div",3),i.YNc(4,M,2,1,"button",4),i.YNc(5,S,2,3,"button",5),i.YNc(6,R,1,2,"op-icon",6),i.qZA(),i.qZA(),i.YNc(7,F,4,6,"edit-form",7),i.YNc(8,te,14,15,"div",8),i.qZA()),2&oe&&(i.Q6J("ngClass",ne.cardClasses())("title",ne.cardTitle()),i.uIk("data-qa-draggable",ne.draggable||void 0)("data-qa-selected",ne.selected||void 0),i.xp6(1),i.Q6J("ngClass",ne.cardHighlightingClass(ne.workPackage)),i.xp6(3),i.Q6J("ngIf",!ne.isNewResource(ne.workPackage)&&ne.showInfoButton),i.xp6(1),i.Q6J("ngIf",ne.isNewResource(ne.workPackage)||ne.showRemoveButton),i.xp6(1),i.Q6J("ngIf",ne.disabledInfo&&ne.disabledInfo.text.length>0),i.xp6(1),i.Q6J("ngIf",ne.isNewResource(ne.workPackage)),i.xp6(1),i.Q6J("ngIf",!ne.isNewResource(ne.workPackage)))},directives:[O.mk,O.O5,y.o,b.n,P.k,E.f,T.N],styles:['.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-single-card[_ngcontent-%COMP%]{display:flex;-webkit-user-select:none;user-select:none;width:calc(100% - 2px);border:1px solid var(--widget-box-block-border-color);border-radius:2px;padding:10px;position:relative;box-shadow:1px 1px 3px #d3d3d3;background:var(--body-background);font-size:var(--card-font-size)}.op-wp-single-card[_ngcontent-%COMP%]:hover   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{opacity:1;z-index:2;background-image:linear-gradient(to left,white,rgba(255,255,255,0))}.op-wp-single-card_new[_ngcontent-%COMP%]{padding-right:25px}.op-wp-single-card_ghosted[_ngcontent-%COMP%]{opacity:.5}.op-wp-single-card_selected[_ngcontent-%COMP%]{background-color:#d1e5f5}.op-wp-single-card_selected[_ngcontent-%COMP%]   .op-icon--wrapper[_ngcontent-%COMP%]{background:#d1e5f5}.op-wp-single-card_selected[_ngcontent-%COMP%]:hover   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{background-image:linear-gradient(to left,#d1e5f5,rgba(209,229,245,0))}.op-wp-single-card_closed[_ngcontent-%COMP%]:not(.op-wp-single-card_selected){background-color:#f3f3f3}.op-wp-single-card_closed[_ngcontent-%COMP%]:not(.op-wp-single-card_selected)   .op-icon--wrapper[_ngcontent-%COMP%]{background:#f3f3f3}.op-wp-single-card_closed[_ngcontent-%COMP%]:not(.op-wp-single-card_selected):hover   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{background-image:linear-gradient(to left,#f3f3f3,rgba(243,243,243,0))}.op-wp-single-card_horizontal[_ngcontent-%COMP%]{height:100%}.op-wp-single-card_vertical[_ngcontent-%COMP%]{margin-top:10px}.op-wp-single-card_vertical[_ngcontent-%COMP%]:last-of-type{margin-bottom:5px}.op-wp-single-card_inline[_ngcontent-%COMP%]   .op-wp-single-card--content[_ngcontent-%COMP%]{grid-template-columns:max-content max-content auto auto 1fr;grid-template-rows:auto max-content;grid-template-areas:"status id project project project" "subject subject subject subject subject"}.op-wp-single-card_inline[_ngcontent-%COMP%]   .op-wp-single-card--content-assignee[_ngcontent-%COMP%]{display:none}.op-wp-single-card_inline[_ngcontent-%COMP%]   .op-wp-single-card--content-subject-line[_ngcontent-%COMP%]{display:flex}.op-wp-single-card_inline[_ngcontent-%COMP%]   .op-wp-single-card--content-subject[_ngcontent-%COMP%]{flex-grow:1;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}wp-single-card.gu-transit[_nghost-%COMP%]   .op-wp-single-card[_ngcontent-%COMP%]{border:1px dashed var(--primary-color);pointer-events:none}wp-single-card.gu-transit[_nghost-%COMP%]   .op-wp-single-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:hidden}.op-wp-single-card--content[_ngcontent-%COMP%]:not(.-new){display:grid;grid-template-columns:max-content max-content auto auto 1fr;grid-template-rows:auto max-content max-content 1fr;grid-row-gap:5px;grid-column-gap:5px;grid-template-areas:"status id project project project" "subject subject subject subject subject" "image image image image image" "avatar avatar avatar dates dates";overflow:hidden;flex-grow:1;font-size:14px;line-height:16px}.op-wp-single-card--content-project-name[_ngcontent-%COMP%]{grid-area:project;font-style:italic;color:#878787;font-size:12px;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-wp-single-card--content-type[_ngcontent-%COMP%]{grid-area:type;margin-right:4px}.op-wp-single-card--content-subject-line[_ngcontent-%COMP%]{grid-area:subject;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis}.op-wp-single-card--content-assignee[_ngcontent-%COMP%]{grid-area:avatar;max-width:140px;color:#878787;font-size:12px}.op-wp-single-card--content-id[_ngcontent-%COMP%]{grid-area:id;color:#878787;font-size:12px}.op-wp-single-card--content-status[_ngcontent-%COMP%]{grid-area:status;margin-right:5px;max-width:92px;overflow:hidden}.op-wp-single-card--content-cover-image[_ngcontent-%COMP%]{grid-area:image;max-height:350px}@media screen and (max-width: 679px){.op-wp-single-card--content-cover-image[_ngcontent-%COMP%]{max-height:250px}}.op-wp-single-card--content-dates[_ngcontent-%COMP%]{grid-area:dates;place-self:center end;white-space:nowrap;color:#878787;font-size:12px}.op-wp-single-card--content-inline-date[_ngcontent-%COMP%]{font-size:12px;color:#878787;margin:0 8px;white-space:nowrap}.op-wp-single-card--highlighting[_ngcontent-%COMP%]{width:100%;height:2px;position:absolute;top:0;left:0;border-radius:2px 2px 0 0}.op-wp-single-card--card-actions[_ngcontent-%COMP%]{display:flex;position:absolute;top:9px;right:0}.op-wp-single-card--card-action[_ngcontent-%COMP%]{z-index:2}.op-wp-single-card--card-action_closed[_ngcontent-%COMP%]{color:#555}.op-wp-single-card_selected[_ngcontent-%COMP%]   .op-wp-single-card--card-action[_ngcontent-%COMP%]{background-color:#d1e5f5}.op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{opacity:0;padding-left:30px;padding-right:4px;white-space:nowrap}.op-wp-single-card_selected[_ngcontent-%COMP%]   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{padding-left:15px}.op-icon--wrapper[_ngcontent-%COMP%]:not(.op-wp-single-card--inline-buttons_selected){background:white}.op-wp-single-card--inline-buttons.-show[_ngcontent-%COMP%]{opacity:1}.op-wp-single-card_selected[_ngcontent-%COMP%]   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{background-color:#d1e5f5}.op-wp-single-card--inline-cancel-button[_ngcontent-%COMP%]{color:var(--warn)}@media only screen and (max-width: 679px){.op-wp-single-card_shrink[_ngcontent-%COMP%]{border:none;box-shadow:none;padding:15px}}'],changeDetection:0})},98722:(X,I,t)=>{"use strict";t.d(I,{H:()=>a});var i=t(3786),e=t(53466),d=t(39410),h=t(53457),r=t(12703),n=t(29161),l=t(2316);class a extends d.I{constructor(){super(...arguments),this.copying=!0}ngOnInit(){super.ngOnInit(),this.wpCreate.onNewWorkPackage().pipe(this.untilDestroyed()).subscribe(v=>{v.__initialized_at===this.__initialized_at&&this.wpRelations.addCommonRelation(v.id,"relates",this.copiedWorkPackageId)})}createdWorkPackage(){return this.copiedWorkPackageId=this.stateParams.copiedFromWorkPackageId,new Promise((v,c)=>{this.apiV3Service.work_packages.id(this.copiedWorkPackageId).get().pipe((0,e.q)(1)).subscribe(p=>{this.createCopyFrom(p).then(v,c)})})}setTitle(){this.titleService.setFirstPart(this.I18n.t("js.work_packages.copy.title"))}createCopyFrom(v){const c=this.halEditing.changeFor(v);return this.wpCreate.copyWorkPackage(c).then(p=>(this.__initialized_at=p.pristineResource.__initialized_at,this.apiV3Service.work_packages.cache.updateWorkPackage(p.pristineResource,!0),this.halEditing.updateValue("new",p),p))}}a.\u0275fac=function(){let m;return function(c){return(m||(m=l.n5z(a)))(c||a)}}(),a.\u0275dir=l.lG2({type:a,features:[l.qOj]}),(0,i.gn)([(0,n.W)(),(0,i.w6)("design:type",h.V)],a.prototype,"wpRelations",void 0),(0,i.gn)([(0,n.W)(),(0,i.w6)("design:type",r.l)],a.prototype,"halEditing",void 0)},97979:(X,I,t)=>{"use strict";t.d(I,{R:()=>m});var i=t(3786),e=t(80044),d=t(96905),h=t(91923),r=t(43682),n=t(55749),l=t(29161),a=t(65146);class m{constructor(c,p,f=[]){this.injector=c,this.filters=p,this.excluded=f,this.handlers={"=":this.applyFirstValue.bind(this),"!*":this.setToNull.bind(this)}}applyDefaultsFromFilters(c){_.each(this.filters,p=>{if(-1!==this.excluded.indexOf(p.id))return;if("project"===p.id){const u=_.find(p.values,k=>(k instanceof e.X?k.href:k)===this.currentProject.apiv3Path);return void this.setValue(c,"project",u||p.values[0])}if("id"===p.id)return;const f=p.operator.id,C=this.handlers[f];null==C||C.call(this,c,p)})}applyFirstValue(c,p){if(this.filterAlreadyApplied(c,p))return;const f=p.values[0];if(f){const C=this.mapFilterToAttribute(p);this.setValueFor(c,C,f)}}setToNull(c,p){const f=this.mapFilterToAttribute(p);this.setValue(c,f,{href:null})}setValueFor(c,p,f){const C=this.findSpecialValue(f,p)||f;C&&this.setValue(c,p,C)}setValue(c,p,f){c instanceof n.G?c.setValue(p,f):c[p]=f}findSpecialValue(c,p){return"parent"===p?c:c instanceof e.X&&"/api/v3/users/me"===c.href&&this.currentUser.isLoggedIn?this.halResourceService.fromSelfLink(`/api/v3/users/${this.currentUser.userId}`):void 0}filterAlreadyApplied(c,p){let f=c instanceof n.G?c.projectedResource[p.id]:c[p.id];f=_.castArray(f);for(let C=0;C<p.values.length;C++)for(let u=0;u<f.length;u++)if((0,r.q9)(f[u],p.values[C]))return!0;return!1}mapFilterToAttribute(c){return"onlySubproject"===c.id?"project":c.id}}(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",d.S)],m.prototype,"currentUser",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",h.u)],m.prototype,"halResourceService",void 0),(0,i.gn)([(0,l.W)(),(0,i.w6)("design:type",a.R)],m.prototype,"currentProject",void 0)},55749:(X,I,t)=>{"use strict";t.d(I,{G:()=>h});var i=t(94232),e=t(81923),d=t(84699);class h extends i.W{setValue(n,l){super.setValue(n,l),("project"===n||"type"===n)&&this.updateForm()}applyChanges(n){return delete n.description,super.applyChanges(n)}setNewDefaultFor(n,l){"description"===n&&(0,d.Z)(this.pristineResource)?this.pristineResource.description=l:super.setNewDefaultFor(n,l)}get schema(){return this.form$.hasValue()?e.X.create(super.schema,this.projectedResource):super.schema}}},35403:(X,I,t)=>{"use strict";t.d(I,{L:()=>h});var i=t(61342),e=t(2316);class h{constructor(n,l){this.wpeditForm=n,this.elementRef=l}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement)}activate(n){if(jQuery(n.target).closest(".help-text--entry").length)return!0;const a=this.wpeditForm.fields[this.fieldName];return a&&a.handleUserActivate(null),!1}}h.\u0275fac=function(n){return new(n||h)(e.Y36(i.n),e.Y36(e.SBq))},h.\u0275cmp=e.Xpm({type:h,selectors:[["wp-replacement-label"]],inputs:{fieldName:"fieldName"},ngContentSelectors:["*"],decls:2,vars:0,consts:[["tabindex","-1",1,"wp-replacement-label",3,"click"]],template:function(n,l){1&n&&(e.F$t(),e.TgZ(0,"span",0),e.NdJ("click",function(m){return l.activate(m)}),e.Hsn(1),e.qZA())},encapsulation:2})},88156:(X,I,t)=>{"use strict";t.d(I,{Nm:()=>r,ag:()=>n,r1:()=>l});var i=t(3786),e=t(7812),d=t(44022),h=t(29161);const r="wp-table--cell-td",n="wp-table--cell-container";class l{constructor(m){this.injector=m,this.fieldRenderer=new e.uA(this.injector,"table")}build(m,v){const c=document.createElement("td"),p=v.id;c.classList.add(r,p),"subject"===p&&c.classList.add("-max");const f=this.schemaCache.of(m).ofProperty(p);f&&"User"===f.type&&c.classList.add("-contains-avatar");const C=document.createElement("span");C.classList.add(n,e.zZ,p);const u=this.fieldRenderer.render(m,p,null);return C.appendChild(u),c.appendChild(C),c}refresh(m,v,c){const p=this.fieldRenderer.render(v,c,null);m.innerHTML="",m.appendChild(p)}}(0,i.gn)([(0,h.W)(d.y),(0,i.w6)("design:type",d.y)],l.prototype,"schemaCache",void 0)},50076:(X,I,t)=>{"use strict";var i,e;t.d(I,{Z:()=>i}),(e=i||(i={})).backgroundClass=function(a,m){return`__hl_background_${a}_${m}`},e.inlineClass=function(a,m){return`__hl_inline_${a}_${m}`},e.colorClass=function(a,m){return a?`__hl_inline_color_${m}_text`:`__hl_inline_color_${m}_dot`},e.overdueDate=function(a){return 0===a?"__hl_date_due_today":a<=-1?"__hl_date_overdue":"__hl_date_not_overdue"},e.isBright=function(a,m,v){const c=`--hl-${m}-${v}-dark`;return""!==a.getPropertyValue(c)}},72875:(X,I,t)=>{"use strict";t.d(I,{t:()=>i,X:()=>e});const i={id:"__internal-sorthandle"},e={id:"__internal-contextMenu"}},72184:(X,I,t)=>{"use strict";t.d(I,{L:()=>a});var i=t(3786),e=t(29161),d=t(21680),h=t(43440),r=t(44022),n=t(60874),l=t(67749);class a extends d.i9{constructor(){super(...arguments),this.text={sum:this.I18n.t("js.label_sum")}}buildSumsRow(v){const c=document.createElement("tr");return c.classList.add("wp-table--sums-row","wp-table--row",(0,l.yZ)(v.index)),this.renderColumns(v.sums,c),c}renderColumns(v,c){this.augmentedColumns.forEach((p,f)=>{const C=document.createElement("td"),u=this.renderContent(v,p.id,this.sumsSchema[p.id]);0===f&&this.appendFirstLabel(u),C.appendChild(u),c.append(C)})}appendFirstLabel(v){const c=document.createElement("span");c.textContent=`${this.text.sum}`,c.title=`${this.text.sum}`,v.prepend(c)}get sumsSchema(){const c=this.querySpace.results.value.sumsSchema.href;return this.schemaCache.state(c).value}renderContent(v,c,p){const f=document.createElement("div");if(f.classList.add("wp-table--sum-container",c),!p)return f;const C=this.displayFieldService.getField(v,c,p,{injector:this.injector,container:"table",options:{}});return C.isEmpty()||C.render(f,C.valueString),f}}(0,i.gn)([(0,e.W)(),(0,i.w6)("design:type",h.q)],a.prototype,"querySpace",void 0),(0,i.gn)([(0,e.W)(),(0,i.w6)("design:type",r.y)],a.prototype,"schemaCache",void 0),(0,i.gn)([(0,e.W)(),(0,i.w6)("design:type",n.i)],a.prototype,"displayFieldService",void 0)},68130:(X,I,t)=>{"use strict";t.d(I,{u:()=>i,k:()=>e});const i="wp-table--group-header",e="-collapsed"},67749:(X,I,t)=>{"use strict";function i(l){let a=l.value||"nullValue";if(l.href)try{a+=l.href.map(m=>m.href).join("-")}catch(m){console.error(`Failed to extract group identifier for ${l.value}`)}return a=a.toLowerCase().replace(/[^a-z0-9]+/g,"-"),`${d(l)}-${a}`}function e(l){const{value:a}=l;return null===a?"-":a}function d(l){return l._links.groupBy.href.split("/").pop()}function h(l){return`__row-group-${l}`}function r(l){return l.split("-")[0]}function n(l){return l.split("-").pop()}t.d(I,{M4:()=>i,_n:()=>e,Ph:()=>d,yZ:()=>h,dF:()=>r,yD:()=>n})},67362:(X,I,t)=>{"use strict";t.d(I,{YZ:()=>l,On:()=>m,UT:()=>p});var i=t(3786),e=t(21680),d=t(87853),h=t(32030),r=t(99676),n=t(29161);const l="-hierarchy-collapsed",m="wp-table--hierarchy-aditional-row";class p extends e.i9{constructor(C,u){super(C,u),this.injector=C,this.workPackageTable=u,this.text={leaf:k=>this.I18n.t("js.work_packages.hierarchy.leaf",{level:k}),expanded:k=>this.I18n.t("js.work_packages.hierarchy.children_expanded",{level:k}),collapsed:k=>this.I18n.t("js.work_packages.hierarchy.children_collapsed",{level:k})}}refreshRow(C,u){const k=super.refreshRow(C,u);return k.find(".wp-table--hierarchy-span").remove(),this.appendHierarchyIndicator(C,k),k}buildEmpty(C){const[u,k]=super.buildEmpty(C),[O,y]=this.ancestorRowData(C);return u.classList.add(...O),this.appendHierarchyIndicator(C,jQuery(u)),[u,y]}ancestorRowData(C){const u=this.wpTableHierarchies.current,k=[];let O=!1;return this.parentsWithVisibleChildren[C.id]&&k.push((0,h.MO)(C.id)),_.isArray(C.ancestors)&&C.ancestors.forEach(y=>{k.push((0,h.oQ)(y.id)),u.collapsed[y.id]&&(O=!0,k.push((0,h.xU)(y.id)))}),[k,O]}buildAncestorRow(C,u,k){const O=this.states.workPackages.get(C.id).value,[y,b]=this.buildEmpty(O);return y.classList.add(m),[y,b]}appendHierarchyIndicator(C,u,k){const O=void 0===k?C.ancestors.length:k,y=this.buildHierarchyIndicator(C,u,O);u.find("td.subject").addClass("-with-hierarchy").prepend(y),u.find("td.subject").css("minWidth",125+20*O+"px"),u.find("td.subject .wp-table--cell-container").css("width",`calc(100% - 25px - ${20*O}px)`)}buildHierarchyIndicator(C,u,k){const O=document.createElement("span"),y=this.wpTableHierarchies.collapsed(C.id),b=25+20*k+"px";if(O.classList.add("wp-table--hierarchy-span"),O.style.width=b,O.dataset.indentation=b,this.parentsWithVisibleChildren[C.id]){const P=y?l:"";O.innerHTML=`\n            <a href tabindex="0" role="button" class="wp-table--hierarchy-indicator ${P}">\n              <span class="wp-table--hierarchy-indicator-icon" aria-hidden="true"></span>\n              <span class="wp-table--hierarchy-indicator-expanded hidden-for-sighted">${this.text.expanded(k)}</span>\n              <span class="wp-table--hierarchy-indicator-collapsed hidden-for-sighted">${this.text.collapsed(k)}</span>\n            </a>\n        `}else O.innerHTML=`\n            <span tabindex="0" class="wp-table--leaf-indicator">\n              <span class="hidden-for-sighted">${this.text.leaf(k)}</span>\n            </span>\n        `;return O}}(0,i.gn)([(0,n.W)(),(0,i.w6)("design:type",r.Y)],p.prototype,"wpTableHierarchies",void 0),(0,i.gn)([(0,n.W)(),(0,i.w6)("design:type",d.G)],p.prototype,"states",void 0)},33791:(X,I,t)=>{"use strict";t.d(I,{OR:()=>l,_M:()=>a,Lp:()=>m});var i=t(3786),e=t(41195),d=t(29161),h=t(87853),r=t(53457),n=t(88156);const l="wp-table--relation-cell-td",a="wp-table--relation-indicator";class m{constructor(c){this.injector=c}build(c,p){const f=document.createElement("td");f.classList.add(n.Nm,l,p.id),f.dataset.columnId=p.id;const C=this.wpTableRelationColumns.getExpandFor(c.id)===p.id,u=this.wpRelations.state(c.id).value,k=this.wpTableRelationColumns.relationsForColumn(c,u,p),O=this.renderIndicator(),y=this.renderBadge(k);return C&&f.classList.add("-expanded"),k.length>0&&(f.appendChild(y),f.appendChild(O)),f}renderIndicator(){const c=document.createElement("span");return c.classList.add(a),c.setAttribute("aria-hidden","true"),c.setAttribute("tabindex","0"),c}renderBadge(c){const p=document.createElement("span");return p.classList.add("wp-table--relation-count"),p.textContent=`${c.length}`,p.classList.add("badge","-border-only"),p}}(0,i.gn)([(0,d.W)(),(0,i.w6)("design:type",h.G)],m.prototype,"states",void 0),(0,i.gn)([(0,d.W)(),(0,i.w6)("design:type",r.V)],m.prototype,"wpRelations",void 0),(0,i.gn)([(0,d.W)(),(0,i.w6)("design:type",e.a)],m.prototype,"wpTableRelationColumns",void 0)},21680:(X,I,t)=>{"use strict";t.d(I,{i9:()=>y,HE:()=>O,S:()=>k});var i=t(3786),e=t(96617),d=t(99919),h=t(71562),r=t(93903),n=t(85003),l=t(72875),a=t(29161),m=t(88156);class v{constructor(P){this.injector=P}build(P){const E=document.createElement("td");E.classList.add(m.Nm,n.oE,l.X.id,"hide-when-print");const T=document.createElement("span");return T.classList.add(n.K$),this.tableActionsService.render(P).forEach(M=>{T.appendChild(M)}),E.appendChild(T),E}}(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",r.j)],v.prototype,"tableActionsService",void 0);var c=t(60914),p=t(3352),f=t(20506),C=t(33791),u=t(70319);const k="wp-table--row",O="wp--row";class y{constructor(P,E){this.injector=P,this.workPackageTable=E,this.cellBuilder=new m.r1(this.injector),this.relationCellBuilder=new C.Lp(this.injector),this.contextLinkBuilder=new v(this.injector),this.augmentedColumns=this.buildAugmentedColumns()}get columns(){return this.wpTableColumns.getColumns()}buildAugmentedColumns(){const P=[...this.columns,l.X];return this.workPackageTable.configuration.dragAndDropEnabled&&P.unshift(l.t),P}buildCell(P,E){if((0,u.q)(E))return this.relationCellBuilder.build(P,E);switch(E.id){case l.X.id:if(this.workPackageTable.configuration.actionsColumnEnabled)return this.contextLinkBuilder.build(P);if(this.workPackageTable.configuration.columnMenuEnabled){const T=document.createElement("td");return T.classList.add("hide-when-print"),T}return null;default:return this.cellBuilder.build(P,E)}}buildEmpty(P){const E=this.createEmptyRow(P);return this.buildEmptyRow(P,E)}createEmptyRow(P){const E=this.classIdentifier(P),T=document.createElement("tr");return T.setAttribute("tabindex","0"),T.dataset.workPackageId=P.id,T.dataset.classIdentifier=E,T.classList.add(k,O,E,`${E}-table`,"issue"),T}get placeholderRow(){const P=document.createElement("tr"),E=document.createElement("td");return P.classList.add("wp--placeholder-row"),E.colSpan=this.augmentedColumns.length,P.appendChild(E),P}classIdentifier(P){return`wp-row-${P.id}`}refreshRow(P,E){const T=E.find(`.${m.Nm}`).detach(),M=[];return this.augmentedColumns.forEach(S=>{const R=T.filter(`td.${S.id}`);if((S.id.startsWith("__internal")||this.isColumnBeingEdited(P,S))&&R.length)return void M.push(R[0]);const F=this.buildCell(P,S);F&&M.push(F)}),E.prepend(M),E}isColumnBeingEdited(P,E){const T=this.workPackageTable.editing.forms[P.id];return T&&T.activeFields[E.id]}buildEmptyRow(P,E){const T=this.workPackageTable.editing.change(P),M={};if(T&&!T.isEmpty()){const S=(0,d.ay)(this.classIdentifier(P));T.changedAttributes.forEach(R=>{M[R]=S.find(`.${m.Nm}.${R}`)})}return this.augmentedColumns.forEach(S=>{let R;const F=M[S.id];F&&F.length?((0,p.qu)(`Rendering previous open column ${S.id} on ${P.id}`),jQuery(E).append(F)):(R=this.buildCell(P,S),R&&E.appendChild(R))}),this.wpTableSelection.isSelected(P.id)&&E.classList.add(f.HZ),[E,!1]}}(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",c.J)],y.prototype,"wpTableSelection",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",h.i)],y.prototype,"wpTableColumns",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",e.D)],y.prototype,"I18n",void 0)},77850:(X,I,t)=>{"use strict";t.d(I,{j:()=>n,v:()=>l});var i=t(3786),e=t(87853),d=t(73165),h=t(29161),r=t(21680);const n="wp-timeline-cell";class l{constructor(m,v){this.injector=m,this.workPackageTable=v}build(m){const v=document.createElement("div");return v.classList.add(n,r.HE),m&&(v.dataset.workPackageId=m),v}insert(m,v,c=[]){const p=this.build(m);p.classList.add(...c),v.appendChild(p)}}(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",e.G)],l.prototype,"states",void 0),(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",d.W)],l.prototype,"wpTableTimeline",void 0)},20506:(X,I,t)=>{"use strict";t.d(I,{yF:()=>i,HZ:()=>e,mE:()=>d});const i="__ui-state-link",e="-checked";class d{constructor(r,n){this.$state=r,this.keepTab=n}linkToDetails(r,n,l){return this.build(r,"split",n,l)}linkToShow(r,n,l){return this.build(r,"show",n,l)}build(r,n,l,a){const m=document.createElement("a");let v,c;return"show"===n?(v="work-packages.show.tabs",c=this.keepTab.currentShowTab):(v="work-packages.partitioned.list.details.tabs",c=this.keepTab.currentDetailsTab),m.href=this.$state.href(v,{workPackageId:r,tabIdentifier:c}),m.classList.add(i),m.dataset.workPackageId=r,m.dataset.wpState=n,m.setAttribute("title",l),m.textContent=a,m}}},52787:(X,I,t)=>{"use strict";t.d(I,{S:()=>e,X:()=>d});var i=t(33406);function e(h,r){return"click"!==h.type&&("keydown"!==h.type||h.which!==i.m.ENTER)||(r(),!1)}class d{handleEvent(r,n){e(n,()=>this.processEvent(r.workPackageTable,n))}}},32030:(X,I,t)=>{"use strict";function i(r=""){return`__collapsed-group-${r}`}function e(r){return`__hierarchy-group-${r}`}function d(r){return`__hierarchy-root-${r}`}function h(r){return`wp-ancestor-row-${r}`}t.d(I,{xU:()=>i,oQ:()=>e,MO:()=>d,Mh:()=>h})},99919:(X,I,t)=>{"use strict";t.d(I,{is:()=>e,gx:()=>d,Fb:()=>h,ay:()=>r,_D:()=>n,hK:()=>l,Ui:()=>a});var i=t(32030);function e(m){return`wp-row-${m}-table`}function d(){return"wp-table--relations-aditional-row"}function h(m){return jQuery(`.${e(m)}`)}function r(m){return jQuery(`.${m}-table`)}function n(m){return!!m&&null!=Array.from(m.classList).find(v=>v.includes((0,i.xU)()))}function l(m,v){let c=m.previousElementSibling;for(;c;){if(c.matches(v))return c;c=c.previousElementSibling}return null}function a(m){try{const v=h(m),c=v.scrollParent(),p=c.scrollTop(),f=p+c.height(),C=v[0].offsetTop,u=C+v.height();C<p?c[0].scrollTop=C:u>f&&(c[0].scrollTop=u-c.height())}catch(v){console.warn(`Can't scroll row element into view: ${v}`)}}},55054:(X,I,t)=>{"use strict";t.d(I,{t:()=>et});var i=t(3786),e=t(96617),d=t(43440),h=t(87853),r=t(29161),n=t(61908),l=t(79174),a=t(3352),m=t(68130),v=t(71562),c=t(21680);class p{constructor(_e,ye){this.injector=_e,this.workPackageTable=ye}isApplicable(_e){return!0}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.G)],p.prototype,"states",void 0);var f=t(67749);function C(Ke){return`group-${Ke.identifier}`}class u{constructor(_e){this.injector=_e,this.text={collapse:this.I18n.t("js.label_collapse"),expand:this.I18n.t("js.label_expand")}}buildGroupRow(_e,ye){const Pe=document.createElement("tr");let Ee,Qe;return _e.collapsed?(Qe=this.text.expand,Ee="icon-plus"):(Qe=this.text.collapse,Ee="icon-minus2"),Pe.classList.add(m.u,C(_e)),Pe.id=`wp-table-rowgroup-${_e.index}`,Pe.dataset.groupIndex=_e.index.toString(),Pe.dataset.groupIdentifier=_e.identifier,Pe.innerHTML=`\n      <td colspan="${ye}" class="-no-highlighting">\n        <div class="expander icon-context ${Ee}">\n          <span class="hidden-for-sighted">${_.escape(Qe)}</span>\n        </div>\n        <div class="group--value" data-qa-selector="op-group--value">\n          ${_.escape((0,f._n)(_e))}\n          <span class="count">\n            (${_e.count})\n          </span>\n        </div>\n      </td>\n    `,Pe}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",e.D)],u.prototype,"I18n",void 0);var k=t(72184),O=t(12703),y=t(84897),b=t(50076);class P{constructor(_e,ye,Pe){this.injector=_e,this.table=ye,this.tablePass=Pe}render(){if(!this.isApplicable)return;const _e=this.wpTableHighlighting.current.mode;window.getComputedStyle(document.body);this.tablePass.renderedOrder.forEach((Pe,Ee)=>{if(!Pe.workPackage)return;const Qe=Pe.workPackage[_e];if(!Qe)return;const nt=Qe.id;this.tablePass.tableBody.children[Ee].classList.add(b.Z.backgroundClass(_e,nt))})}get isApplicable(){return!(this.wpTableHighlighting.isInline||this.wpTableHighlighting.isDisabled)}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",y.B)],P.prototype,"wpTableHighlighting",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",d.q)],P.prototype,"querySpace",void 0);var E=t(88156),T=t(16451),M=t(72875);class R{constructor(_e){this.injector=_e;const ye=this.injector.get(T.B);this.actionService=ye.get(_e)}build(_e,ye){const Pe=document.createElement("td");if(Pe.classList.add(E.Nm,M.t.id),!this.actionService.canPickup(_e))return Pe;Pe.classList.add("wp-table--sort-td",M.t.id,"hide-when-print");const Ee=document.createElement("span");return Ee.classList.add("wp-table--drag-and-drop-handle","icon-drag-handle"),Pe.appendChild(Ee),Pe}}var F=t(95846);class L{constructor(_e,ye,Pe){this.injector=_e,this.table=ye,this.tablePass=Pe,this.dragDropHandleBuilder=new R(this.injector)}render(){!this.table.configuration.dragAndDropEnabled||this.wpTableOrder.withLoadedPositions().then(_e=>{this.tablePass.renderedOrder.forEach((ye,Pe)=>{if(!ye.workPackage||"relations"===ye.renderType)return;const Ee=this.dragDropHandleBuilder.build(ye.workPackage,_e[ye.workPackage.id]);Ee&&ye.element.replaceChild(Ee,ye.element.firstElementChild)})})}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",v.i)],L.prototype,"wpTableColumns",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",F.M)],L.prototype,"wpTableOrder",void 0);var D=t(77850);class G{constructor(_e,ye,Pe){this.injector=_e,this.table=ye,this.tablePass=Pe}render(){this.timelineBody=document.createDocumentFragment(),this.timelineBuilder=new D.v(this.injector,this.table),this.tablePass.renderedOrder.forEach(_e=>{const ye=_e.workPackage?_e.workPackage.id:null,Pe=this.timelineBuilder.build(ye);Pe.classList.add(_e.classIdentifier,`${_e.classIdentifier}-timeline`,..._e.additionalClasses),this.timelineBody.appendChild(Pe)})}}var Q=t(53457),V=t(41195),K=t(70319);function q(Ke){return`__relations-expanded-from-${Ke}`}const te="wp-table--relation-cell-td";class ie extends c.i9{constructor(_e,ye){super(_e,ye),this.injector=_e,this.workPackageTable=ye}buildCell(_e,ye){return(0,K.q)(ye)?this.emptyRelationCell(ye):super.buildCell(_e,ye)}buildEmptyRelationRow(_e,ye,Pe){const Ee=ye.denormalized(_e),Qe=this.states.workPackages.get(Ee.targetId).value,nt=this.createEmptyRelationRow(_e,Qe),[ct,lt]=super.buildEmptyRow(Qe,nt);return[ct,Qe]}createEmptyRelationRow(_e,ye){const Pe=this.relationClassIdentifier(_e,ye),Ee=document.createElement("tr");return Ee.dataset.workPackageId=ye.id,Ee.dataset.classIdentifier=Pe,Ee.classList.add(c.HE,c.S,"issue","wp-table--relations-aditional-row",Pe,`${Pe}-table`,q(_e.id)),Ee}relationClassIdentifier(_e,ye){return function(Ke,_e){return`wp-relation-row-${_e}-to-${Ke}`}(ye.id,_e.id)}appendRelationLabel(_e,ye,Pe,Ee,Qe){const nt=Pe.denormalized(ye);let ct="";"toType"===Qe&&(ct=this.I18n.t(`js.relation_labels.${nt.reverseRelationType}`)),"ofType"===Qe&&(ct=this.states.workPackages.get(nt.target.id).value.type.name);const lt=document.createElement("span");lt.classList.add("relation-row--type-label"),lt.textContent=ct;document.createTextNode(nt.target.name);_e.find(`.${te}`).empty(),_e.find(`.${te}.${Ee}`).append(lt)}emptyRelationCell(_e){const ye=document.createElement("td");return ye.classList.add(te,E.Nm,_e.id),ye}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.G)],ie.prototype,"states",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",e.D)],ie.prototype,"I18n",void 0);class le{constructor(_e,ye,Pe){this.injector=_e,this.table=ye,this.tablePass=Pe,this.relationRowBuilder=new ie(_e,ye)}render(){this.isApplicable&&_.clone(this.tablePass.renderedOrder).forEach((ye,Pe)=>{if(!ye.workPackage)return;const{workPackage:Ee}=ye,Qe=Ee.id,nt=this.wpRelations.state(Qe);!nt.hasValue()||0===_.size(nt.value)||this.wpTableRelationColumns.relationsToExtendFor(Ee,nt.value,(ct,lt,Ne)=>{const[Ae,xe]=this.relationRowBuilder.buildEmptyRelationRow(Ee,ct,Ne);Ae.classList.add(...ye.additionalClasses),this.relationRowBuilder.appendRelationLabel(jQuery(Ae),Ee,ct,lt.id,Ne),this.tablePass.spliceRow(Ae,`.${this.relationRowBuilder.classIdentifier(Ee)},.${q(Qe)}`,{classIdentifier:this.relationRowBuilder.relationClassIdentifier(Ee,xe),additionalClasses:ye.additionalClasses.concat(["wp-table--relations-aditional-row"]),workPackage:xe,belongsTo:Ee,renderType:"relations",hidden:ye.hidden,data:{relation:ct,columnId:lt.id,relationType:Ne}})})})}refreshRelationRow(_e,ye,Pe){const Ee=this.relationRowBuilder.refreshRow(ye,Pe);return this.relationRowBuilder.appendRelationLabel(Ee,_e.belongsTo,_e.data.relation,_e.data.columnId,_e.data.relationType),Ee}get isApplicable(){return this.wpTableColumns.hasRelationColumns()}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",Q.V)],le.prototype,"wpRelations",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",v.i)],le.prototype,"wpTableColumns",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",V.a)],le.prototype,"wpTableRelationColumns",void 0);class oe{constructor(_e,ye,Pe){this.injector=_e,this.workPackageTable=ye,this.rowBuilder=Pe}render(){return(0,a.IN)("Primary render pass",()=>{this.prepare(),this.doRender(),this.postRender()}),this.highlighting.render(),(0,a.IN)("Relations render pass",()=>{this.relations.render()}),(0,a.IN)("Drag handle render pass",()=>{this.dragDropHandle.render()}),(0,a.IN)("Timelines render pass",()=>{this.timeline.render()}),this}refresh(_e,ye,Pe){const Ee=jQuery(Pe).find(`.${_e.classIdentifier}`);let Qe=null;switch(_e.renderType){case"primary":Qe=this.rowBuilder.refreshRow(ye,Ee);break;case"relations":Qe=this.relations.refreshRelationRow(_e,ye,Ee)}null!==Qe&&Ee.length&&Ee.replaceWith(Qe)}get result(){return this.renderedOrder.map(_e=>({classIdentifier:_e.classIdentifier,workPackageId:_e.workPackage?_e.workPackage.id:null,hidden:_e.hidden}))}spliceRow(_e,ye,Pe){const Ee=jQuery(this.tableBody).find(ye).last();Ee.after(_e);const Qe=Ee.index();this.renderedOrder.splice(Qe+1,0,Pe)}prepare(){this.timeline=new G(this.injector,this.workPackageTable,this),this.relations=new le(this.injector,this.workPackageTable,this),this.dragDropHandle=new L(this.injector,this.workPackageTable,this),this.highlighting=new P(this.injector,this.workPackageTable,this),this.tableBody=document.createDocumentFragment(),this.renderedOrder=[]}postRender(){0===this.renderedOrder.length&&this.workPackageTable.renderPlaceholderRow&&this.tableBody.appendChild(this.rowBuilder.placeholderRow)}appendRow(_e,ye,Pe=[],Ee=!1){this.tableBody.appendChild(ye),this.renderedOrder.push({classIdentifier:this.rowBuilder.classIdentifier(_e),additionalClasses:Pe,workPackage:_e,renderType:"primary",element:ye,hidden:Ee})}appendNonWorkPackageRow(_e,ye,Pe=[],Ee=!1){_e.classList.add(ye),this.tableBody.appendChild(_e),this.renderedOrder.push({element:_e,classIdentifier:ye,additionalClasses:Pe,workPackage:null,renderType:"primary",hidden:Ee})}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",O.l)],oe.prototype,"halEditing",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.G)],oe.prototype,"states",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",e.D)],oe.prototype,"I18n",void 0);class ne extends oe{constructor(_e,ye,Pe){super(_e,ye,Pe),this.injector=_e,this.workPackageTable=ye,this.rowBuilder=Pe}doRender(){this.workPackageTable.originalRows.forEach(_e=>{const ye=this.workPackageTable.originalRowIndex[_e],[Pe]=this.rowBuilder.buildEmpty(ye.object);ye.element=Pe,this.appendRow(ye.object,Pe),this.tableBody.appendChild(Pe)})}}class ve extends ne{constructor(_e,ye,Pe,Ee,Qe){super(_e,ye,new c.i9(_e,ye)),this.injector=_e,this.workPackageTable=ye,this.groups=Pe,this.headerBuilder=Ee,this.colspan=Qe,this.sumsBuilder=new k.L(this.injector,this.workPackageTable)}doRender(){let _e=null;const{length:ye}=this.workPackageTable.originalRows;this.workPackageTable.originalRows.forEach((Pe,Ee)=>{const Qe=this.workPackageTable.originalRowIndex[Pe],nt=this.matchingGroup(Qe.object),ct=_e!==nt;if(_e&&ct&&this.renderSumsRow(_e),nt&&ct){const lt=C(nt),Ne=this.headerBuilder.buildGroupRow(nt,this.colspan);this.appendNonWorkPackageRow(Ne,lt,["-group-row"]),_e=nt}Qe.group=_e,this.buildSingleRow(Qe)}),_e&&this.renderSumsRow(_e)}matchingGroup(_e){return _.find(this.groups,ye=>{let Pe=_e[(0,f.Ph)(ye)];if(void 0===Pe&&(Pe=null),_.isArray(Pe))return this.matchesMultiValue(Pe,ye);if(Pe&&Pe.href)return!!_.find(ye._links.valueLink,Qe=>Pe.href===Qe.href);let Ee=""===ye.value?null:ye.value;return Ee&&"string"==typeof Ee&&(Ee=Ee.replace("%","")),Ee==Pe})}matchesMultiValue(_e,ye){if(_e.length!==ye.href.length)return!1;const Pe=Ee=>_.map(Ee,Qe=>Qe.href).sort().join(", ");return _.isEqualWith(_e,ye.href,(Ee,Qe)=>Pe(Ee)===Pe(Qe))}buildSingleRow(_e){const{group:ye}=_e;ye||console.warn("All rows should have a group, but this one doesn't %O",_e);let Pe=!1;const Ee=[],[Qe,nt]=this.rowBuilder.buildEmpty(_e.object);ye&&(Ee.push((0,f.yZ)(ye.index)),Pe=!!ye.collapsed,Pe&&Ee.push(m.k)),_e.element=Qe,Qe.classList.add(...Ee),this.appendRow(_e.object,Qe,Ee,Pe)}renderSumsRow(_e){if(!_e.sums)return;const ye=C(_e),Pe=this.sumsBuilder.buildSumsRow(_e);this.appendNonWorkPackageRow(Pe,ye)}}class Se extends p{constructor(_e,ye){super(_e,ye),this.injector=_e}isApplicable(_e){return!_.isEmpty(this.groups)}get groups(){return this.querySpace.groups.value||[]}get collapsedGroups(){return this.querySpace.collapsedGroups.value||{}}get colspan(){return this.wpTableColumns.columnCount+2}buildRows(){const _e=new u(this.injector);return new ve(this.injector,this.workPackageTable,this.getGroupData(),_e,this.colspan).render()}refreshExpansionState(){const _e=this.getGroupData(),ye=this.querySpace.tableRendered.value,Pe=new u(this.injector);jQuery(this.workPackageTable.tableAndTimelineContainer).find(`.${m.u}`).each((Ee,Qe)=>{const nt=jQuery(Qe).data("groupIndex"),ct=_e[nt],lt=Pe.buildGroupRow(ct,this.colspan);Qe.parentNode&&Qe.parentNode.replaceChild(lt,Qe);const Ne=jQuery(this.workPackageTable.tableAndTimelineContainer).find(`.${(0,f.yZ)(nt)}`);Ne.toggleClass(m.k,!!ct.collapsed),Ne.filter(`.${c.S}`).each((Ae,xe)=>{const Ye=jQuery(xe).index();ye[Ye].hidden=!!ct.collapsed})}),this.querySpace.tableRendered.putValue(ye,"Updated hidden state of rows after group change.")}getGroupData(){return this.groups.map((_e,ye)=>(_e.index=ye,_e._links&&_e._links.valueLink&&(_e.href=_e._links.valueLink),_e.identifier=(0,f.M4)(_e),_e.collapsed=this.collapsedGroups[_e.identifier],_e))}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",d.q)],Se.prototype,"querySpace",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.G)],Se.prototype,"states",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",v.i)],Se.prototype,"wpTableColumns",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",e.D)],Se.prototype,"I18n",void 0);var Oe=t(99676),je=t(32030),tt=t(67362);class He extends oe{constructor(_e,ye,Pe){super(_e,ye,Pe),this.injector=_e,this.workPackageTable=ye,this.rowBuilder=Pe,this.rendered={},this.additionalParents={},this.deferred={},this.parentsWithVisibleChildren={}}prepare(){super.prepare(),this.hierarchies=this.wpTableHierarchies.current,_.each(this.workPackageTable.originalRowIndex,_e=>{_e.object.ancestors.forEach(ye=>{this.parentsWithVisibleChildren[ye.id]=!0})}),this.rowBuilder.parentsWithVisibleChildren=this.parentsWithVisibleChildren}doRender(){this.workPackageTable.originalRows.forEach(_e=>{const ye=this.workPackageTable.originalRowIndex[_e],Pe=ye.object;if(!this.deferInsertion(Pe)){if(Pe.ancestors.length)this.buildWithHierarchy(ye);else{const[Ee,Qe]=this.rowBuilder.buildEmpty(Pe);ye.element=Ee,this.tableBody.appendChild(Ee),this.markRendered(Ee,Pe,Qe)}this.renderAllDeferredChildren(Pe)}})}deferInsertion(_e){const{ancestors:ye}=_e;if(0===ye.length)return!1;const Pe=ye.concat([_e]);for(let Ee=Pe.length-2;Ee>=0;--Ee){const Qe=Pe[Ee],nt=this.workPackageTable.originalRowIndex[Qe.id];if(this.rendered[Qe.id])return!1;if(nt){let lt=this.deferred[Qe.id]||[],Ne=Pe.slice(Ee+1,Pe.length);return Ne=Ne.map(Ae=>this.apiV3Service.work_packages.cache.state(Ae.id).value),lt=lt.concat(Ne),this.deferred[Qe.id]=_.uniqBy(lt,Ae=>Ae.id),!0}}return!1}renderAllDeferredChildren(_e){const ye=_e.id;(this.deferred[ye]||[]).forEach(Ee=>{this.insertUnderParent(this.getOrBuildRow(Ee),Ee.parent||_e),this.renderAllDeferredChildren(Ee)})}getOrBuildRow(_e){let ye=this.workPackageTable.originalRowIndex[_e.id];return ye||(ye={object:_e}),ye}buildWithHierarchy(_e){const{ancestors:ye}=_e.object,Pe=[];ye.forEach((Qe,nt)=>{const ct=this.states.workPackages.get(Qe.id).getValueOr(Qe);if(!this.rendered[ct.id]){const[lt,Ne]=this.rowBuilder.buildAncestorRow(ct,Pe,nt);if(0===nt)this.tableBody.appendChild(lt),this.markRendered(lt,ct,Ne,!0);else{const Ae=ye[nt-1];this.insertAtExistingHierarchy(ct,lt,Ae,Ne,!0)}this.additionalParents[ct.id]=ct}Pe.push((0,je.oQ)(ct.id)),ye.slice(0,nt).forEach(lt=>{Pe.push((0,je.oQ)(lt.id))})});const Ee=_.last(ye);this.insertUnderParent(_e,Ee)}insertUnderParent(_e,ye){const[Pe,Ee]=this.rowBuilder.buildEmpty(_e.object);_e.element=Pe,this.insertAtExistingHierarchy(_e.object,Pe,ye,Ee,!1)}markRendered(_e,ye,Pe=!1,Ee=!1){this.rendered[ye.id]=!0,this.renderedOrder.push(this.buildRenderInfo(_e,ye,Pe,Ee))}insertAtExistingHierarchy(_e,ye,Pe,Ee,Qe){const nt=`.__hierarchy-root-${Pe.id}`,ct=`.__hierarchy-group-${Pe.id}`;this.spliceRow(ye,`${nt},${ct}`,this.buildRenderInfo(ye,_e,Ee,Qe)),this.rendered[_e.id]=!0}buildRenderInfo(_e,ye,Pe,Ee){const Qe={element:_e,classIdentifier:"",additionalClasses:[],workPackage:ye,renderType:"primary",hidden:Pe},[nt,ct]=this.rowBuilder.ancestorRowData(ye);return Ee?(Qe.additionalClasses=[tt.On].concat(nt),Qe.classIdentifier=(0,je.Mh)(ye.id)):(Qe.additionalClasses=nt,Qe.classIdentifier=this.rowBuilder.classIdentifier(ye)),Qe}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",d.q)],He.prototype,"querySpace",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.G)],He.prototype,"states",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",n.T)],He.prototype,"apiV3Service",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",Oe.Y)],He.prototype,"wpTableHierarchies",void 0);class st extends p{constructor(_e,ye){super(_e,ye),this.injector=_e,this.workPackageTable=ye}isApplicable(_e){return this.wpTableHierarchies.isEnabled}buildRows(){const _e=new tt.UT(this.injector,this.workPackageTable);return new He(this.injector,this.workPackageTable,_e).render()}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.G)],st.prototype,"states",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",v.i)],st.prototype,"wpTableColumns",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",Oe.Y)],st.prototype,"wpTableHierarchies",void 0);class Me extends p{constructor(_e,ye){super(_e,ye),this.injector=_e}buildRows(){const _e=new c.i9(this.injector,this.workPackageTable);return new ne(this.injector,this.workPackageTable,_e).render()}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",e.D)],Me.prototype,"I18n",void 0);var ce=t(7101),J=t(37048),W=t(91260),Y=t(18322);class N extends W.Py{constructor(_e,ye,Pe,Ee){super(_e),this.injector=_e,this.table=ye,this.workPackageId=Pe,this.classIdentifier=Ee,this.cellBuilder=new E.r1(this.injector),this.resourceSubscription=this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().subscribe(Qe=>this.resource=Qe)}destroy(){this.resourceSubscription.unsubscribe()}findContainer(_e){return this.rowContainer.find(`.${E.Nm}.${_e} .${E.ag}`).first()}findCell(_e){return this.rowContainer.find(`.${E.Nm}.${_e}`).first()}activateField(_e,ye,Pe,Ee){return this.waitForContainer(Pe).then(Qe=>{const nt=this.findCell(Pe);nt.addClass(Y.sS);let ct=parseInt(nt.css("width"));return ct=ct>150?ct-10:150,nt.css("max-width",`${ct}px`),nt.css("width",`${ct}px`),this.editingPortalService.create(Qe,this.injector,_e,ye,Pe,Ee)})}reset(_e,ye){const Pe=this.findContainer(_e),Ee=this.findCell(_e);Pe.length&&(this.findCell(_e).css("width",""),this.findCell(_e).css("max-width",""),this.cellBuilder.refresh(Pe[0],this.resource,_e),Ee.removeClass(Y.sS),ye&&this.FocusHelper.focus(Pe[0]))}requireVisible(_e){return this.wpTableColumns.addColumn(_e),this.waitForContainer(_e)}focusOnFirstError(){jQuery(this.table.tableAndTimelineContainer).find(".inline-edit--active-field.-error .inline-edit--field").first().trigger("focus")}loadFieldSchema(_e,ye=!1){return["startDate","dueDate","date"].includes(_e)&&(_e="combinedDate"),super.loadFieldSchema(_e,ye)}waitForContainer(_e){return new Promise((ye,Pe)=>{const Ee=setInterval(()=>{const Qe=this.findContainer(_e);Qe.length>0&&(clearInterval(Ee),ye(Qe[0]))},100)})}get rowContainer(){return jQuery(this.table.tableAndTimelineContainer).find(`.${this.classIdentifier}-table`)}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",v.i)],N.prototype,"wpTableColumns",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",n.T)],N.prototype,"apiV3Service",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.G)],N.prototype,"states",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",ce.i)],N.prototype,"FocusHelper",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",J.b)],N.prototype,"editingPortalService",void 0);class Ue{constructor(_e,ye){this.table=_e,this.injector=ye,this.forms={}}reset(){_.each(this.forms,_e=>_e.destroy()),this.forms={}}change(_e){return this.halEditing.typedState(_e).value}stopEditing(_e){this.halEditing.stopEditing(_e);const ye=this.forms[_e.id];ye&&(ye.destroy(),delete this.forms[_e.id])}startEditing(_e,ye){const Pe=_e.id;return this.forms[Pe]||(this.forms[Pe]=new N(this.injector,this.table,Pe,ye))}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",O.l)],Ue.prototype,"halEditing",void 0);class et{constructor(_e,ye,Pe,Ee,Qe,nt,ct){this.injector=_e,this.tableAndTimelineContainer=ye,this.scrollContainer=Pe,this.tbody=Ee,this.timelineBody=Qe,this.timelineController=nt,this.configuration=ct,this.originalRows=[],this.originalRowIndex={},this.hierarchyRowsBuilder=new st(this.injector,this),this.groupedRowsBuilder=new Se(this.injector,this),this.plainRowsBuilder=new Me(this.injector,this),this.builders=[this.hierarchyRowsBuilder,this.groupedRowsBuilder,this.plainRowsBuilder],this.lastRenderPass=null,this.editing=new Ue(this,this.injector)}get renderedRows(){return this.querySpace.tableRendered.getValueOr([])}findRenderedRow(_e){const ye=_.findIndex(this.renderedRows,Pe=>Pe.classIdentifier===_e);return[ye,this.renderedRows[ye]]}get rowBuilder(){return _.find(this.builders,_e=>_e.isApplicable(this))}buildIndex(_e){this.originalRowIndex={},this.originalRows=_e.map((ye,Pe)=>{const Ee=ye.id;return ye=this.apiV3Service.work_packages.cache.current(Ee,ye),this.originalRowIndex[Ee]={object:ye,workPackageId:Ee,position:Pe},Ee})}initialSetup(_e){this.buildIndex(_e),this.redrawTableAndTimeline()}redrawTableAndTimeline(){const _e=this.performRenderPass(!1);requestAnimationFrame(()=>{this.tbody.innerHTML="",this.timelineBody.innerHTML="",this.tbody.appendChild(_e.tableBody),this.timelineBody.appendChild(_e.timeline.timelineBody),setTimeout(()=>this.querySpace.tableRendered.putValue(_e.result))})}redrawTable(){const _e=this.performRenderPass();this.querySpace.tableRendered.putValue(_e.result)}refreshRows(_e){const ye=this.lastRenderPass;ye?_.each(ye.renderedOrder,Pe=>{Pe.workPackage&&Pe.workPackage.id===_e.id&&((0,a.qu)(`Refreshing rendered row ${Pe.classIdentifier}`),Pe.workPackage=_e,ye.refresh(Pe,_e,this.tbody))}):(0,a.qu)("Trying to refresh a singular row without a previous render pass.")}get renderPlaceholderRow(){return this.configuration.dragAndDropEnabled}performRenderPass(_e=!0){this.editing.reset();const ye=this.lastRenderPass=this.rowBuilder.buildRows();return _e&&requestAnimationFrame(()=>{this.tbody.innerHTML="",this.tbody.appendChild(ye.tableBody)}),ye}setGroupsCollapseState(_e){this.querySpace.collapsedGroups.putValue(_e);const ye=performance.now();this.groupedRowsBuilder.refreshExpansionState();const Pe=performance.now();(0,a.qu)(`Group redraw took ${Pe-ye} milliseconds.`)}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",d.q)],et.prototype,"querySpace",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",n.T)],et.prototype,"apiV3Service",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.G)],et.prototype,"states",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",e.D)],et.prototype,"I18n",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",l.q)],et.prototype,"workPackageViewCollapsedGroupsService",void 0)},88923:(X,I,t)=>{"use strict";t.d(I,{b:()=>C});var i=t(2316),e=t(84897),d=t(82763),h=t(22663),r=t(83720),n=t(43440),l=t(45237),a=t(79460),m=t(61043),v=t(91488),c=t(54364),p=t(87947);function f(u,k){if(1&u&&(i.TgZ(0,"div",2),i._UZ(1,"wp-resizer",3),i.qZA()),2&u){const O=i.oxw();i.xp6(1),i.Q6J("elementClass",O.resizerClass)("localStorageKey",O.resizerStorageKey)}}class C{constructor(k,O,y,b,P){this.wpTableHighlight=k,this.wpTableSortBy=O,this.wpList=y,this.querySpace=b,this.cdRef=P,this.showResizer=!1,this.resizerClass="",this.resizerStorageKey="",this.selectionChanged=new i.vpe,this.itemClicked=new i.vpe,this.stateLinkClicked=new i.vpe,this.gridOrientation="horizontal",this.highlightingMode="none"}ngOnInit(){this.dragInto=this.configuration.dragAndDropEnabled,this.canDragOutOf=()=>this.configuration.dragAndDropEnabled,this.wpTableHighlight.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,r.x)()).subscribe(()=>{this.highlightingMode=this.wpTableHighlight.current.mode,this.cdRef.detectChanges()})}switchToManualSorting(){const k=this.querySpace.query.value;k&&this.wpTableSortBy.switchToManualSorting(k)&&this.wpList.createOrSave(k)}}C.\u0275fac=function(k){return new(k||C)(i.Y36(e.B),i.Y36(d.q),i.Y36(m.Z),i.Y36(n.q),i.Y36(i.sBO))},C.\u0275cmp=i.Xpm({type:C,selectors:[["wp-grid"]],inputs:{configuration:"configuration",showResizer:"showResizer",resizerClass:"resizerClass",resizerStorageKey:"resizerStorageKey"},outputs:{selectionChanged:"selectionChanged",itemClicked:"itemClicked",stateLinkClicked:"stateLinkClicked"},features:[i._Bn([l.j,a.q])],decls:2,vars:10,consts:[[3,"dragOutOfHandler","dragInto","cardsRemovable","highlightingMode","showStatusButton","orientation","showEmptyResultsBox","showInfoButton","shrinkOnMobile","onMoved","selectionChanged","itemClicked","stateLinkClicked"],["class","hidden-for-mobile hide-when-print",4,"ngIf"],[1,"hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"]],template:function(k,O){1&k&&(i.TgZ(0,"wp-card-view",0),i.NdJ("onMoved",function(){return O.switchToManualSorting()})("selectionChanged",function(b){return O.selectionChanged.emit(b)})("itemClicked",function(b){return O.itemClicked.emit(b)})("stateLinkClicked",function(b){return O.stateLinkClicked.emit(b)}),i.qZA(),i.YNc(1,f,2,2,"div",1)),2&k&&(i.Q6J("dragOutOfHandler",O.canDragOutOf)("dragInto",O.dragInto)("cardsRemovable",!1)("highlightingMode",O.highlightingMode)("showStatusButton",!0)("orientation",O.gridOrientation)("showEmptyResultsBox",!0)("showInfoButton",!0)("shrinkOnMobile",!0),i.xp6(1),i.Q6J("ngIf",O.showResizer))},directives:[v.x,c.O5,p.H],encapsulation:2,changeDetection:0})},84366:(X,I,t)=>{"use strict";t.d(I,{I:()=>ie});var i=t(2316),e=t(7493),d=t(48451),h=t(9170),r=t(43440),n=t(96617),l=t(8403),a=t(71562),m=t(26942),v=t(38519),c=t(44022),p=t(3786),f=t(87853),C=t(60914),u=t(88156),k=t(72875),O=t(29161),y=t(99919),b=t(21680);const P="wp-inline-create-row",E="wp-table--cancel-create-link";class T extends b.i9{constructor(oe,ne){super(oe,ne),this.injector=oe,this.text={cancelButton:this.I18n.t("js.button_cancel")}}buildCell(oe,ne){switch(ne.id){case k.X.id:return this.buildCancelButton();default:return super.buildCell(oe,ne)}}buildNew(oe,ne){const[fe,ve]=this.buildEmpty(oe);return[fe,ve]}createEmptyRow(oe){const ne=this.classIdentifier(oe),fe=document.createElement("tr");return fe.id=(0,y.is)(oe.id),fe.dataset.workPackageId=oe.id,fe.dataset.classIdentifier=ne,fe.classList.add(P,b.HE,b.S,"issue",ne,`${ne}-table`),fe}buildCancelButton(){const oe=document.createElement("td");return oe.classList.add(u.Nm,"wp-table--cancel-create-td"),oe.innerHTML=`\n    <a\n       href="#"\n       class="${E} icon icon-cancel"\n       aria-label="${this.text.cancelButton}">\n    </a>\n   `,oe}}(0,p.gn)([(0,O.W)(),(0,p.w6)("design:type",f.G)],T.prototype,"states",void 0),(0,p.gn)([(0,O.W)(),(0,p.w6)("design:type",C.J)],T.prototype,"wpTableSelection",void 0),(0,p.gn)([(0,O.W)(),(0,p.w6)("design:type",a.i)],T.prototype,"wpTableColumns",void 0),(0,p.gn)([(0,O.W)(),(0,p.w6)("design:type",n.D)],T.prototype,"I18n",void 0);var M=t(63829),R=(t(55054),t(52787)),F=t(54364),L=t(84312),D=t(32853);function Q(le,oe){if(1&le){const ne=i.EpF();i.TgZ(0,"button",6),i.NdJ("click",function(){return i.CHM(ne),i.oxw(3).handleAddRowClick()}),i._UZ(1,"span",7),i._UZ(2,"span",8),i.qZA()}if(2&le){const ne=i.oxw(3);i.ekj("wp-inline-create--split-link",ne.hasReferenceClass),i.Q6J("opAutofocus",ne.focus),i.uIk("aria-label",ne.text.create),i.xp6(2),i.Q6J("textContent",ne.text.create)}}function V(le,oe){if(1&le){const ne=i.EpF();i.TgZ(0,"button",9),i.NdJ("click",function(){return i.CHM(ne),i.oxw(3).handleReferenceClick()}),i._UZ(1,"span",10),i._UZ(2,"span",8),i.qZA()}if(2&le){const ne=i.oxw(3);i.uIk("aria-label",ne.text.create),i.xp6(2),i.Q6J("textContent",ne.text.reference)}}function K(le,oe){if(1&le&&(i.TgZ(0,"tr",2),i.TgZ(1,"td",3),i.YNc(2,Q,3,5,"button",4),i.YNc(3,V,3,2,"button",5),i.qZA(),i.qZA()),2&le){const ne=i.oxw(2);i.xp6(1),i.uIk("colspan",ne.colspan),i.xp6(1),i.Q6J("ngIf",ne.canAdd),i.xp6(1),i.Q6J("ngIf",ne.canReference)}}function q(le,oe){1&le&&i.GkF(0)}function se(le,oe){if(1&le&&(i.TgZ(0,"tr",2),i.TgZ(1,"td",11),i.YNc(2,q,1,0,"ng-container",12),i.qZA(),i.qZA()),2&le){const ne=i.oxw(2);i.xp6(1),i.uIk("colspan",ne.colspan),i.xp6(1),i.Q6J("ngComponentOutlet",ne.referenceClass)("ngComponentOutletInjector",ne.injector)}}function te(le,oe){if(1&le&&(i.ynx(0),i.YNc(1,K,4,3,"tr",1),i.YNc(2,se,3,3,"tr",1),i.BQk()),2&le){const ne=i.oxw();i.xp6(1),i.Q6J("ngIf","inactive"===ne.mode),i.xp6(1),i.Q6J("ngIf",ne.hasReferenceClass&&"reference"===ne.mode)}}class ie extends m.N{constructor(oe,ne,fe,ve,Se,Oe,je,tt,He,st,Me){super(),this.injector=oe,this.elementRef=ne,this.schemaCache=fe,this.I18n=ve,this.querySpace=Se,this.cdRef=Oe,this.wpCreate=je,this.wpInlineCreate=tt,this.wpTableColumns=He,this.wpTableFocus=st,this.authorisationService=Me,this.showing=new i.vpe,this.canAdd=!1,this.canReference=!1,this.mode="inactive",this.focus=!1,this.text=this.wpInlineCreate.buttonTexts}get isActive(){return"inactive"!==this.mode}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement)}ngAfterViewInit(){this.authorisationService.observeUntil((0,v.J6)(this)).subscribe(()=>{this.canReference=this.hasReferenceClass&&this.wpInlineCreate.canReference,this.canAdd=this.wpInlineCreate.canAdd,this.cdRef.detectChanges(),this.showing.emit(this.canAdd||this.canReference)}),this.registerCreationCallback(),this.refreshOnColumnChanges(),this.registerCancelHandler()}registerCancelHandler(){this.$element.on("click keydown",`.${E}`,oe=>((0,R.S)(oe,()=>{this.resetRow()}),oe.stopImmediatePropagation(),!1))}refreshOnColumnChanges(){this.wpTableColumns.updates$().pipe((0,h.h)(()=>this.isActive),this.untilDestroyed()).subscribe(()=>this.refreshRow())}registerCreationCallback(){this.wpCreate.onNewWorkPackage().pipe(this.untilDestroyed()).subscribe(oe=>{this.currentWorkPackage&&this.currentWorkPackage.__initialized_at===oe.__initialized_at?(this.resetRow(),this.table.configuration.isEmbedded||this.wpTableFocus.updateFocus(oe.id),this.wpInlineCreate.newInlineWorkPackageCreated.next(oe.id)):(this.wpCreate.cancelCreation(),this.removeWorkPackageRow(),this.showRow()),this.cdRef.detectChanges()})}handleAddRowClick(){return this.addWorkPackageRow(),!1}handleReferenceClick(){return this.mode="reference",!1}get referenceClass(){return this.wpInlineCreate.referenceComponentClass}get hasReferenceClass(){return!!this.referenceClass}addWorkPackageRow(){this.wpCreate.createOrContinueWorkPackage(this.projectIdentifier).then(oe=>{const ne=this.currentWorkPackage=oe.projectedResource;this.editingSubscription=this.wpCreate.changesetUpdates$().pipe((0,h.h)(()=>!!this.currentWorkPackage)).subscribe(fe=>{this.isActive?(this.schemaCache.update(this.currentWorkPackage,fe.schema),this.refreshRow()):this.insertRow(ne)})})}insertRow(oe){const ne=this.workPackageEditForm=this.renderInlineCreateRow(oe);setTimeout(()=>{ne.activateMissingFields(),this.hideRow()})}refreshRow(){const oe=new T(this.injector,this.table),ne=this.$element.find(`.${P}`);ne.length&&this.currentWorkPackage&&oe.refreshRow(this.currentWorkPackage,ne)}renderInlineCreateRow(oe){const ne=new T(this.injector,this.table),fe=this.table.editing.startEditing(oe,ne.classIdentifier(oe)),[ve]=ne.buildNew(oe,fe);return this.$element.append(ve),fe}resetRow(){this.focus=!0,this.removeWorkPackageRow(),setTimeout(()=>{this.showRow(),this.cdRef.detectChanges()},50)}removeWorkPackageRow(){this.wpCreate.cancelCreation(),this.currentWorkPackage=null,this.$element.find(".wp-row-new").remove(),this.editingSubscription&&this.editingSubscription.unsubscribe()}showRow(){this.mode="inactive",this.cdRef.detectChanges()}hideRow(){this.mode="create",this.cdRef.detectChanges()}get colspan(){return this.wpTableColumns.columnCount+1}}ie.\u0275fac=function(oe){return new(oe||ie)(i.Y36(i.zs3),i.Y36(i.SBq),i.Y36(c.y),i.Y36(n.D),i.Y36(r.q),i.Y36(i.sBO),i.Y36(M.P),i.Y36(l.m),i.Y36(a.i),i.Y36(d.o),i.Y36(e.g))},ie.\u0275cmp=i.Xpm({type:ie,selectors:[["","wpInlineCreate",""]],hostBindings:function(oe,ne){1&oe&&i.NdJ("keydown.escape",function(){return ne.resetRow()})},inputs:{table:["wp-inline-create--table","table"],projectIdentifier:["wp-inline-create--project-identifier","projectIdentifier"]},outputs:{showing:"wp-inline-create--showing"},features:[i.qOj],attrs:["wpInlineCreate",""],decls:1,vars:1,consts:[[4,"ngIf"],["class","wp-inline-create-button-row hide-when-print",4,"ngIf"],[1,"wp-inline-create-button-row","hide-when-print"],[1,"wp-inline-create-button-td"],["type","button","class","spot-link","aria-haspopup","true","data-qa-selector","op-wp-inline-create",3,"wp-inline-create--split-link","opAutofocus","click",4,"ngIf"],["type","button","class","spot-link wp-inline-create--split-link","aria-haspopup","true","data-qa-selector","op-wp-inline-create-reference",3,"click",4,"ngIf"],["type","button","aria-haspopup","true","data-qa-selector","op-wp-inline-create",1,"spot-link",3,"opAutofocus","click"],[1,"spot-icon","spot-icon_add"],[3,"textContent"],["type","button","aria-haspopup","true","data-qa-selector","op-wp-inline-create-reference",1,"spot-link","wp-inline-create--split-link",3,"click"],[1,"spot-icon","spot-icon_link"],[1,"wp-inline-reference-row-td","-no-highlighting"],[4,"ngComponentOutlet","ngComponentOutletInjector"]],template:function(oe,ne){1&oe&&i.YNc(0,te,3,2,"ng-container",0),2&oe&&i.Q6J("ngIf",ne.canAdd||ne.canReference)},directives:[F.O5,L.U,F.$G,D.dw],encapsulation:2})},8403:(X,I,t)=>{"use strict";t.d(I,{m:()=>l});var i=t(3786),e=t(79441),d=t(96617),h=t(7493),r=t(29161),n=t(2316);class l{constructor(m){this.injector=m,this.referenceComponentClass=null,this.referenceTarget=null,this.buttonTexts={reference:"",create:this.I18n.t("js.label_create_work_package")},this.newInlineWorkPackageCreated=new e.xQ,this.newInlineWorkPackageReferenced=new e.xQ}get canAdd(){return this.canCreateWorkPackages||this.authorisationService.can("work_package","addChild")}get canReference(){return!1}get canCreateWorkPackages(){return this.authorisationService.can("work_packages","createWorkPackage")&&this.authorisationService.can("work_packages","editWorkPackage")}ngOnDestroy(){this.newInlineWorkPackageCreated.complete(),this.newInlineWorkPackageReferenced.complete()}}l.\u0275fac=function(m){return new(m||l)(n.LFG(n.zs3))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac}),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",d.D)],l.prototype,"I18n",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.g)],l.prototype,"authorisationService",void 0)},81539:(X,I,t)=>{"use strict";t.d(I,{Y:()=>h});var i=t(47775),e=t(55977),d=t(2316);class h{constructor(n,l){this.UrlParamsHelper=n,this.$state=l}updateIfDifferent(n,l){const a=this.getNewChecksum(n,l);let m=Promise.resolve();return this.isUninitialized()||(this.isIdDifferent(n.id)?(m=this.maintainUrlQueryState(n.id,null),this.clear()):this.isChecksumDifferent(a)&&(m=this.maintainUrlQueryState(n.id,a))),this.set(n.id,a),m}update(n,l){const a=this.getNewChecksum(n,l);this.set(n.id,a),this.maintainUrlQueryState(n.id,a)}setToQuery(n,l){const a=this.getNewChecksum(n,l);return this.set(n.id,a),this.maintainUrlQueryState(n.id,null)}isQueryOutdated(n,l){const a=this.getNewChecksum(n,l);return this.isOutdated(n.id,a)}executeIfOutdated(n,l,a){(this.isUninitialized()||this.isOutdated(n,l))&&(this.set(n,l),a())}set(n,l){this.id=n,this.checksum=l}clear(){this.id=null,this.checksum=null,this.visibleChecksum=null}isUninitialized(){return!this.id&&!this.checksum}isIdDifferent(n){return this.id!==n}isChecksumDifferent(n){return this.checksum&&n!==this.checksum}isOutdated(n,l){const a=!!this.id,m=!!this.checksum,v=this.id!==n,c=l!==this.checksum,p=this.checksum&&!l&&this.visibleChecksum;return(a||m)&&(v||!v&&c&&(l||this.visibleChecksum)||!a&&p)}getNewChecksum(n,l){return this.UrlParamsHelper.encodeQueryJsonParams(n,{pp:l.perPage,pa:l.page})}maintainUrlQueryState(n,l){return this.visibleChecksum=l,this.$state.go(".",{query_props:l,query_id:n},{custom:{notify:!1}})}}h.\u0275fac=function(n){return new(n||h)(d.LFG(e.Z),d.LFG(i.StateService))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},97354:(X,I,t)=>{"use strict";t.d(I,{R:()=>d});var i=t(91923),e=t(2316);class d{constructor(r){this.halResourceService=r}restoreQuery(r,n){this.restoreFilters(r,n.payload,n.schema),this.restoreColumns(r,n.payload,n.schema),this.restoreSortBy(r,n.payload,n.schema),this.restoreGroupBy(r,n.payload,n.schema),this.restoreOtherProperties(r,n.payload)}restoreFilters(r,n,l){let a=_.map(n.filters,m=>{const v=_.find(l.filtersSchemas.elements,f=>f.filter.allowedValues[0].href===m.filter.href);if(!v)return null;const c=v.getFilter(),p=_.find(v.operator.allowedValues,f=>f.href===m.operator.href);return p&&(c.operator=p),c.values.length=0,_.each(m.values,f=>c.values.push(f)),c});a=_.compact(a),r.filters.length=0,_.each(a,m=>r.filters.push(m))}restoreColumns(r,n,l){let a=_.map(n.columns,m=>_.find(l.columns.allowedValues,v=>v.href===m.href));a=_.compact(a),r.columns.length=0,_.each(a,m=>r.columns.push(m))}restoreSortBy(r,n,l){let a=_.map(n.sortBy,m=>_.find(l.sortBy.allowedValues,v=>v.href===m.href));a=_.compact(a),r.sortBy.length=0,_.each(a,m=>r.sortBy.push(m))}restoreGroupBy(r,n,l){const a=_.find(l.groupBy.allowedValues,m=>n.groupBy&&n.groupBy.href===m.href);r.groupBy=a}restoreOtherProperties(r,n){_.without(Object.keys(n.$source),"_links","filters").forEach(l=>{r[l]=n[l]}),_.without(Object.keys(n.$source._links),"columns","groupBy","sortBy").forEach(l=>{r[l]=n[l]})}}d.\u0275fac=function(r){return new(r||d)(e.LFG(i.u))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac})},61043:(X,I,t)=>{"use strict";t.d(I,{Z:()=>L});var i=t(3786),e=t(87853),d=t(7493),h=t(47775),r=t(43440),n=t(48934),l=t(55977),a=t(36293),m=t(96617),v=t(30400),c=t(81134),p=t(14808),f=t(79902),C=t(85816),u=t(91992),k=t(18293),O=t(53466),y=t(67202),b=t(40533),P=t(12877),E=t(61908),T=t(68853),M=t(74478),S=t(97354),R=t(76869),F=t(2316);class L{constructor(G,Q,V,K,q,se,te,ie,le,oe,ne,fe,ve,Se){this.toastService=G,this.I18n=Q,this.UrlParamsHelper=V,this.authorisationService=K,this.$state=q,this.apiV3Service=se,this.states=te,this.querySpace=ie,this.pagination=le,this.configuration=oe,this.wpTablePagination=ne,this.wpStatesInitialization=fe,this.wpListInvalidQueryService=ve,this.wpQueryView=Se,this.queryRequests=(0,p.qH)(),this.queryLoading=this.queryRequests.values$().pipe((0,f.w)(Oe=>(0,v.D)(this.ensurePerPageKnown().then(()=>Oe))),(0,f.w)(Oe=>this.streamQueryRequest(Oe.queryParams,Oe.projectIdentifier)),(0,C.zg)(Oe=>(this.conditionallyLoadForm(Oe),this.wpStatesInitialization.initialize(Oe,Oe.results),(0,c.of)(Oe))),(0,u.B)())}streamQueryRequest(G,Q){const V=this.getCurrentQueryProps(G),K=this.UrlParamsHelper.buildV3GetQueryFromJsonParams(V);return this.apiV3Service.queries.find(K,G.query_id,Q).pipe((0,k.K)(se=>{const te=this.UrlParamsHelper.buildV3GetQueryFromJsonParams(V);return(0,v.D)(this.handleQueryLoadingError(se,te,G.query_id,Q))}))}fromQueryParams(G,Q){return this.queryRequests.clear(),this.queryRequests.putValue({queryParams:G,projectIdentifier:Q}),this.queryLoading.pipe((0,O.q)(1))}getCurrentQueryProps(G){return G.query_props?decodeURIComponent(G.query_props):null}loadDefaultQuery(G){return this.fromQueryParams({},G).toPromise()}reloadQuery(G,Q){const V=this.extractParamsFromQuery(G,{pa:1});return this.queryRequests.clear(),this.queryRequests.putValue({queryParams:{query_id:G.id||void 0,query_props:V},projectIdentifier:Q}),this.queryLoading.pipe((0,O.q)(1))}extractParamsFromQuery(G,Q={}){return this.UrlParamsHelper.encodeQueryJsonParams(G,Object.assign({pa:this.wpTablePagination.current.page,pp:this.wpTablePagination.current.perPage},Q))}loadQueryFromExisting(G,Q,V){const K=this.UrlParamsHelper.buildV3GetQueryFromQueryResource(G,Q);let q;return q=G.id?this.apiV3Service.queries.id(G.id):this.apiV3Service.withOptionalProject(V).queries,q.parameterised(K)}loadCurrentQueryFromParams(G){return this.fromQueryParams(this.$state.params,G).toPromise()}loadForm(G){return this.apiV3Service.queries.form.load(G).toPromise().then(([Q,V])=>(this.wpStatesInitialization.updateStatesFromForm(G,Q),Q))}create(G,Q){const V=this.querySpace.queryForm.value;return G.name=Q,this.createQueryAndView(G,V).toPromise().then(q=>(this.toastService.addSuccess(this.I18n.t("js.notice_successful_create")),this.reloadQuery(q).subscribe(()=>{this.states.changes.queries.next(q.id)}),q))}delete(){const G=this.currentQuery,Q=this.apiV3Service.queries.id(G).delete().toPromise();return Q.then(()=>{let V;this.toastService.addSuccess(this.I18n.t("js.notice_successful_delete")),G.project&&(V=G.project.href.split("/").pop()),this.loadDefaultQuery(V),this.states.changes.queries.next(G.id)}),Q}save(G){return(0,i.mG)(this,void 0,void 0,function*(){const Q=G||this.currentQuery,V=yield this.querySpace.queryForm.valuesPromise(),K=this.apiV3Service.queries.id(Q).patch(Q,V).toPromise();return K.then(()=>{this.toastService.addSuccess(this.I18n.t("js.notice_successful_update")),this.$state.go(".",{query_id:Q.id,query_props:null},{reload:!0}),this.states.changes.queries.next(Q.id)}).catch(q=>{this.toastService.addError(q.message)}),K})}createOrSave(G){return(0,i.mG)(this,void 0,void 0,function*(){return(0,n.Z)(G)?this.save(G):this.create(G,"New manually sorted query")})}toggleStarred(G){const Q=this.apiV3Service.queries.toggleStarred(G);return Q.then(V=>{this.querySpace.query.putValue(V),this.toastService.addSuccess(this.I18n.t("js.notice_successful_update")),this.states.changes.queries.next(V.id)}),Q}getPaginationInfo(){return this.wpTablePagination.paginationObject}conditionallyLoadForm(G){const Q=this.querySpace.queryForm.value;(!Q||G.$links.update.href!==Q.href)&&setTimeout(()=>this.loadForm(G),0)}get currentQuery(){return this.querySpace.query.value}handleQueryLoadingError(G,Q,V,K){return this.toastService.addError(this.I18n.t("js.work_packages.faulty_query.description"),G.message),new Promise((q,se)=>{this.apiV3Service.queries.form.loadWithParams(Q,V,K).toPromise().then(([te,ie])=>{this.apiV3Service.queries.find({pageSize:0},void 0,K).toPromise().then(le=>{this.wpListInvalidQueryService.restoreQuery(le,te),le.results.pageSize=Q.pageSize,le.results.total=0,V&&(le.id=V),this.wpStatesInitialization.initialize(le,le.results),this.wpStatesInitialization.updateStatesFromForm(le,te),q(le)}).catch(se)}).catch(se)})}ensurePerPageKnown(){return(0,i.mG)(this,void 0,void 0,function*(){return!!this.pagination.isPerPageKnown||this.configuration.initialized})}createQueryAndView(G,Q){return this.apiV3Service.queries.post(G,Q).pipe((0,f.w)(V=>this.wpQueryView.create(V).pipe((0,y.h)(V))))}}L.\u0275fac=function(G){return new(G||L)(F.LFG(a.kl),F.LFG(m.D),F.LFG(l.Z),F.LFG(d.g),F.LFG(h.StateService),F.LFG(E.T),F.LFG(e.G),F.LFG(r.q),F.LFG(T.N),F.LFG(P.e),F.LFG(b.S),F.LFG(M.f),F.LFG(S.R),F.LFG(R.$))},L.\u0275prov=F.Yz7({token:L,factory:L.\u0275fac})},76869:(X,I,t)=>{"use strict";t.d(I,{$:()=>h});var i=t(47775),e=t(61908),d=t(2316);class h{constructor(n,l){this.$state=n,this.apiV3Service=l}create(n){if(!n.href)throw new Error("Expected only queries that are created since an href is required");return this.apiV3Service.views.post({_links:{query:{href:n.href}}},this.viewType)}get viewType(){if(this.$state.includes("work-packages"))return"work_packages_table";if(this.$state.includes("team_planner"))return"team_planner";if(this.$state.includes("bim"))return"bim";if(this.$state.includes("calendar"))return"work_packages_calendar";throw new Error("Not on a path defined for query views")}}h.\u0275fac=function(n){return new(n||h)(d.LFG(i.StateService),d.LFG(e.T))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},74478:(X,I,t)=>{"use strict";t.d(I,{f:()=>M});var i=t(87853),e=t(7493),d=t(43440),h=t(84897),r=t(53466),n=t(95846),l=t(2888),a=t(20066),m=t(82271),v=t(71562),c=t(82763),p=t(81691),f=t(99676),C=t(40533),u=t(73165),k=t(61083),O=t(74647),y=t(41195),b=t(61908),P=t(79174),E=t(81539),T=t(2316);class M{constructor(R,F,L,D,G,Q,V,K,q,se,te,ie,le,oe,ne,fe,ve,Se,Oe,je){this.states=R,this.querySpace=F,this.wpTableColumns=L,this.wpTableGroupBy=D,this.wpTableGroupFold=G,this.wpTableSortBy=Q,this.wpTableFilters=V,this.wpTableSum=K,this.wpTableTimeline=q,this.wpTableHierarchies=se,this.wpTableHighlighting=te,this.wpTableRelationColumns=ie,this.wpTablePagination=le,this.wpTableOrder=oe,this.wpTableAdditionalElements=ne,this.apiV3Service=fe,this.wpListChecksumService=ve,this.authorisationService=Se,this.wpDisplayRepresentation=Oe,this.wpIncludeSubprojects=je}initialize(R,F){this.clearStates(),this.querySpace.query.putValue(R),this.initializeFromQuery(R,F);const L=this.querySpace.queryForm.value;L&&this.updateStatesFromForm(R,L),this.updateQuerySpace(R,F),this.updateChecksum(R,F)}updateStatesFromForm(R,F){const L=F.schema;_.each(L.filtersSchemas.elements,D=>{this.states.schemas.get(D.href).putValue(D)}),this.wpTableFilters.initializeFilters(R,L),this.querySpace.queryForm.putValue(F),this.querySpace.available.columns.putValue(L.columns.allowedValues),this.querySpace.available.sortBy.putValue(L.sortBy.allowedValues),this.querySpace.available.groupBy.putValue(L.groupBy.allowedValues),this.querySpace.available.displayRepresentation.putValue(L.displayRepresentation.allowedValues)}updateQuerySpace(R,F){this.querySpace.additionalRequiredWorkPackages.clear("Clearing additional WPs before updating rows"),this.querySpace.tableRendered.clear("Clearing rendered data before upgrading query space"),F.schemas&&_.each(F.schemas.elements,L=>{this.states.schemas.get(L.href).putValue(L)}),this.querySpace.query.putValue(R),this.authorisationService.initModelAuth("work_packages",F.$links),F.elements.forEach(L=>this.apiV3Service.work_packages.cache.updateWorkPackage(L,!0)),this.querySpace.results.putValue(F),this.querySpace.groups.putValue(F.groups),this.wpTablePagination.initialize(R,F),this.wpTableRelationColumns.initialize(R,F),this.wpTableAdditionalElements.initialize(R,F),this.wpTableOrder.initialize(R,F),this.wpDisplayRepresentation.initialize(R,F),this.wpIncludeSubprojects.initialize(R,F),this.querySpace.additionalRequiredWorkPackages.values$().pipe((0,r.q)(1)).subscribe(()=>this.querySpace.initialized.putValue(null))}updateChecksum(R,F){this.wpListChecksumService.updateIfDifferent(this.querySpace.query.value,this.wpTablePagination.current),this.authorisationService.initModelAuth("work_packages",F.$links)}initializeFromQuery(R,F){this.querySpace.query.putValue(R),this.wpTableSum.initialize(R),this.wpTableColumns.initialize(R,F),this.wpTableSortBy.initialize(R,F),this.wpTableGroupBy.initialize(R,F),this.wpTableGroupFold.initialize(R,F),this.wpTableTimeline.initialize(R,F),this.wpTableHierarchies.initialize(R,F),this.wpTableHighlighting.initialize(R,F),this.wpDisplayRepresentation.initialize(R,F),this.wpIncludeSubprojects.initialize(R,F),this.authorisationService.initModelAuth("query",R.$links),this.authorisationService.initModelAuth("work_packages",F.$links)}applyToQuery(R){this.wpTableFilters.applyToQuery(R),this.wpTableSum.applyToQuery(R),this.wpTableColumns.applyToQuery(R),this.wpTableSortBy.applyToQuery(R),this.wpTableGroupBy.applyToQuery(R),this.wpTableGroupFold.applyToQuery(R),this.wpTableTimeline.applyToQuery(R),this.wpTableHighlighting.applyToQuery(R),this.wpTableHierarchies.applyToQuery(R),this.wpTableOrder.applyToQuery(R),this.wpDisplayRepresentation.applyToQuery(R),this.wpIncludeSubprojects.applyToQuery(R)}clearStates(){const R="Clearing states before re-initialization.";this.querySpace.initialized.clear(R),this.querySpace.query.clear(R),this.querySpace.results.clear(R),this.querySpace.groups.clear(R),this.querySpace.additionalRequiredWorkPackages.clear(R),this.wpTableFilters.clear(R),this.wpTableColumns.clear(R),this.wpTableSortBy.clear(R),this.wpTableGroupBy.clear(R),this.wpTableGroupFold.clear(R),this.wpDisplayRepresentation.clear(R),this.wpIncludeSubprojects.clear(R),this.wpTableSum.clear(R),this.querySpace.tableRendered.clear(R)}}M.\u0275fac=function(R){return new(R||M)(T.LFG(i.G),T.LFG(d.q),T.LFG(v.i),T.LFG(k.w),T.LFG(P.q),T.LFG(c.q),T.LFG(O.Z),T.LFG(m.X),T.LFG(u.W),T.LFG(f.Y),T.LFG(h.B),T.LFG(y.a),T.LFG(C.S),T.LFG(n.M),T.LFG(p.G),T.LFG(b.T),T.LFG(E.Y),T.LFG(e.g),T.LFG(l.ld),T.LFG(a.F))},M.\u0275prov=T.Yz7({token:M,factory:M.\u0275fac})},39410:(X,I,t)=>{"use strict";t.d(I,{I:()=>b});var i=t(47775),e=t(70233),d=t(87853),h=t(18511),r=t(96617),n=t(74647),l=t(48451),a=t(61342),m=t(62964),v=t(97973),p=t(26942),f=t(70482),C=t(61908),u=t(57810),k=t(63829),O=t(8849),y=t(2316);class b extends p.N{constructor(E,T,M,S,R,F,L,D,G,Q,V,K,q){super(),this.injector=E,this.$transition=T,this.$state=M,this.I18n=S,this.titleService=R,this.notificationService=F,this.states=L,this.wpCreate=D,this.wpViewFocus=G,this.wpTableFilters=Q,this.pathHelper=V,this.apiV3Service=K,this.cdRef=q,this.successState=(0,f.W)(this.$state),this.cancelState=this.$state.current.data.baseRoute,this.copying=!1,this.stateParams=this.$transition.params("to"),this.text={button_settings:this.I18n.t("js.button_settings")},this.destroyed=!1}ngOnInit(){this.closeEditFormWhenNewWorkPackageSaved(),this.showForm()}ngOnDestroy(){super.ngOnDestroy()}switchToFullscreen(){this.$state.go("work-packages.new",this.$state.params)}onSaved(E){var T;const{savedResource:M,isInitial:S}=E;null===(T=this.editForm)||void 0===T||T.cancel(!1),this.successState&&this.$state.go(this.successState,{workPackageId:M.id}).then(()=>{this.wpViewFocus.updateFocus(M.id),this.notificationService.showSave(M,S)})}showForm(){this.createdWorkPackage().then(E=>{this.change=E,this.newWorkPackage=E.pristineResource,this.cdRef.detectChanges(),this.setTitle(),this.stateParams.parent_id&&E.setValue("parent",{href:this.apiV3Service.work_packages.id(this.stateParams.parent_id).path}),this.stateParams.parent_id&&this.apiV3Service.work_packages.id(this.stateParams.parent_id).get().pipe(this.untilDestroyed()).subscribe(T=>{this.parentWorkPackage=T,this.cdRef.detectChanges()})}).catch(E=>{E instanceof O.o&&"urn:openproject-org:api:v3:errors:MissingPermission"===E.errorIdentifier&&(this.apiV3Service.root.get().subscribe(T=>{if(!T.user){const M=v(this.pathHelper.loginPath());M.search({back_url:M}),window.location.href=M.toString()}}),this.notificationService.handleRawError(E))})}setTitle(){this.titleService.setFirstPart(this.I18n.t("js.work_packages.create.title"))}cancelAndBackToList(){this.wpCreate.cancelCreation(),this.$state.go(this.cancelState,this.$state.params)}createdWorkPackage(){const E=this.stateParams.defaults||{};E._links=E._links||{};const T=this.stateParams.type?parseInt(this.stateParams.type):void 0,M=this.stateParams.parent_id?parseInt(this.stateParams.parent_id):void 0,S=this.stateParams.projectPath;return T&&(E._links.type={href:this.apiV3Service.types.id(T).path}),M&&(E._links.parent={href:this.apiV3Service.work_packages.id(M).path}),this.wpCreate.createOrContinueWorkPackage(S,T,E)}closeEditFormWhenNewWorkPackageSaved(){this.wpCreate.onNewWorkPackage().pipe((0,h.o)(()=>!this.componentDestroyed)).subscribe(E=>{this.onSaved({savedResource:E,isInitial:!0})})}}b.\u0275fac=function(E){return new(E||b)(y.Y36(y.zs3),y.Y36(i.Transition),y.Y36(i.StateService),y.Y36(r.D),y.Y36(u.V),y.Y36(m.q),y.Y36(d.G),y.Y36(k.P),y.Y36(l.o),y.Y36(n.Z),y.Y36(e.j),y.Y36(C.T),y.Y36(y.sBO))},b.\u0275dir=y.lG2({type:b,viewQuery:function(E,T){if(1&E&&y.Gf(a.n,5),2&E){let M;y.iGM(M=y.CRH())&&(T.editForm=M.first)}},features:[y.qOj]})},63829:(X,I,t)=>{"use strict";t.d(I,{P:()=>y});var i=t(79441),e=t(53448),d=t(97979),h=t(12703),r=t(9170),n=t(43440),l=t(1403),a=t(7493),m=t(26942),v=t(61908),c=t(80044),p=t(10190),f=t(44022),C=t(91923),u=t(88826),k=t(2316);const O="/api/v3/work_packages/new";class y extends m.N{constructor(P,E,T,M,S,R,F,L,D,G){super(),this.injector=P,this.hooks=E,this.apiV3Service=T,this.halResourceService=M,this.querySpace=S,this.authorisationService=R,this.halEditing=F,this.schemaCache=L,this.halEvents=D,this.attachmentsService=G,this.newWorkPackageCreatedSubject=new i.xQ,this.halEditing.committedChanges.pipe(this.untilDestroyed(),(0,r.h)(Q=>"WorkPackage"===Q.resource._type&&Q.wasNew)).subscribe(Q=>{this.newWorkPackageCreated(Q.resource)}),this.halEditing.changes$(O).pipe(this.untilDestroyed(),(0,r.h)(Q=>!Q)).subscribe(()=>{this.reset()})}newWorkPackageCreated(P){this.reset(),this.newWorkPackageCreatedSubject.next(P)}onNewWorkPackage(){return this.newWorkPackageCreatedSubject.asObservable()}createNewWorkPackage(P,E){return this.apiV3Service.withOptionalProject(P).work_packages.form.forPayload(E).toPromise().then(T=>this.fromCreateForm(T))}fromCreateForm(P){const E=this.initializeNewResource(P),T=this.halEditing.edit(E,P);return this.hooks.call("workPackageNewInitialization",T),T}copyWorkPackage(P){const E=P.pristineResource.$source;return this.apiV3Service.work_packages.form.post(E).toPromise().then(T=>this.fromCreateForm(T))}copyFrom(P){const E=this.initializeNewResource(P);return this.halEditing.edit(E,P)}getEmptyForm(P){return this.form||(this.form=this.apiV3Service.withOptionalProject(P).work_packages.form.post({}).toPromise()),this.form}cancelCreation(){this.halEditing.stopEditing({href:O}),this.reset()}changesetUpdates$(){return this.halEditing.state(O).values$()}createOrContinueWorkPackage(P,E,T){let M=this.continueExistingEdit(E);return M||(M=this.createNewWithDefaults(P,T)),M.then(S=>(this.authorisationService.initModelAuth("work_package",S.pristineResource),this.halEditing.updateValue(O,S),this.apiV3Service.work_packages.cache.updateWorkPackage(S.pristineResource,!0),S))}reset(){this.apiV3Service.work_packages.cache.clearSome("new"),this.attachmentsService.clear("new"),this.form=void 0}continueExistingEdit(P){const E=this.halEditing.state(O).value;if(void 0!==E){const T=E.projectedResource.type,M=!E.isEmpty(),S=!T&&!P,R=P&&T&&(0,p.Z)(T.href)===P.toString();if(M&&(S||R))return Promise.resolve(E)}return null}createNewWithDefaults(P,E){return this.withFiltersPayload(P,E).then(T=>{const M=_.merge({_links:{}},T,E);return this.createNewWorkPackage(P,M).then(S=>{if(!S)throw new Error("No new work package was created");return this.defaultsFromFilters(S,E),S})})}defaultsFromFilters(P,E){const T=this.querySpace.query.value;if(T){const M=(null==E?void 0:E._links)?Object.keys(E._links):[];new d.R(this.injector,T.filters,M).applyDefaultsFromFilters(P)}}withFiltersPayload(P,E){const T={_links:{}};return this.defaultsFromFilters(T,E),Object.keys(T).length>1||Object.keys(T._links).length>0?this.apiV3Service.withOptionalProject(P).work_packages.form.forTypePayload(E||{_links:{}}).toPromise().then(S=>(this.toApiPayload(T,S.schema),T)):Promise.resolve(T)}toApiPayload(P,E){const T=[];Object.keys(E.$source).forEach(M=>{["Integer","Float","Date","DateTime","Duration","Formattable","Boolean","String","Text",void 0].includes(E.$source[M].type)||T.push(M)}),T.forEach(M=>{const S=P[M];void 0===S||(S instanceof c.X?P._links[M]={href:S.$links.self.href}:P._links[M]=S||{href:null}),delete P[M]})}initializeNewResource(P){const E=P.payload.$plain();E._links.schema={href:"new"};const T=this.halResourceService.createHalResourceOfType("WorkPackage",E);return T.$source.id="new",T._type="WorkPackage",T.__initialized_at=Date.now(),T.update=T.$links.update=P.$links.self,T.updateImmediately=T.$links.updateImmediately=M=>this.apiV3Service.work_packages.post(M).toPromise(),this.schemaCache.update(T,P.schema),T}}y.\u0275fac=function(P){return new(P||y)(k.LFG(k.zs3),k.LFG(e.$),k.LFG(v.T),k.LFG(C.u),k.LFG(n.q),k.LFG(a.g),k.LFG(h.l),k.LFG(f.y),k.LFG(l.J),k.LFG(u.v))},y.\u0275prov=k.Yz7({token:y,factory:y.\u0275fac})},19496:(X,I,t)=>{"use strict";t.d(I,{v:()=>p});var i=t(39410),e=t(2316),d=t(54364),h=t(61342),r=t(92092),n=t(11266),l=t(8643),a=t(77180),m=t(66979);const v=function(){return["status","type"]};function c(f,C){if(1&f){const u=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"edit-form",2),e.NdJ("onSaved",function(O){return e.CHM(u),e.oxw().onSaved(O)}),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e._UZ(4,"wp-type-status",5),e.qZA(),e.TgZ(5,"ul",6),e.TgZ(6,"li",7),e._UZ(7,"zen-mode-toggle-button"),e.qZA(),e.TgZ(8,"li",7),e.TgZ(9,"button",8),e._UZ(10,"i",9),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e._UZ(11,"wp-single-view",10),e.TgZ(12,"wp-edit-actions-bar",11),e.NdJ("onCancel",function(){return e.CHM(u),e.oxw().cancelAndBackToList()}),e.qZA(),e.qZA(),e.qZA()}if(2&f){const u=e.oxw();e.xp6(1),e.Q6J("resource",u.newWorkPackage)("skippedFields",e.DdM(7,v))("inEditMode",!0),e.xp6(3),e.Q6J("workPackage",u.newWorkPackage),e.xp6(5),e.uIk("title",u.text.button_settings),e.xp6(2),e.Q6J("workPackage",u.newWorkPackage)("showProject",u.copying)}}class p extends i.I{constructor(){super(...arguments),this.successState=this.$state.current.data.successState}}p.\u0275fac=function(){let f;return function(u){return(f||(f=e.n5z(p)))(u||p)}}(),p.\u0275cmp=e.Xpm({type:p,selectors:[["wp-new-full-view"]],hostAttrs:[1,"work-packages-page--ui-view"],features:[e.qOj],decls:1,vars:1,consts:[["class","work-package--new-state work-packages--new work-packages--show-view toolbar-container",4,"ngIf"],[1,"work-package--new-state","work-packages--new","work-packages--show-view","toolbar-container"],[3,"resource","skippedFields","inEditMode","onSaved"],[1,"toolbar"],[1,"title-container"],[3,"workPackage"],[1,"toolbar-items","hide-when-print"],[1,"toolbar-item","hidden-for-mobile"],["id","create-wp-menu-button","wpCreateSettingsMenu","",1,"button","last","work-packages-settings-button","toolbar-icon"],[1,"button--icon","icon-show-more"],[3,"workPackage","showProject"],[3,"onCancel"]],template:function(C,u){1&C&&e.YNc(0,c,13,8,"div",0),2&C&&e.Q6J("ngIf",u.newWorkPackage)},directives:[d.O5,h.n,r.E,n.a,l.Y,a.G,m.Y],encapsulation:2,changeDetection:0})},70319:(X,I,t)=>{"use strict";t.d(I,{L:()=>i,q:()=>e});const i={PROPERTY:"QueryColumn::Property",RELATION_OF_TYPE:"QueryColumn::RelationOfType",RELATION_TO_TYPE:"QueryColumn::RelationToType"};function e(d){return[i.RELATION_TO_TYPE,i.RELATION_OF_TYPE].indexOf(d._type)>=0}},19866:(X,I,t)=>{"use strict";t.d(I,{r:()=>d});var i=t(44022),e=t(2316);class d{constructor(r){this.schemaCache=r}getFilterSchema(r,n){const l=n.$embedded.schema.filtersSchemas.elements;return _.find(l,a=>a.allowedFilterValue.href===r.filter.href)}mapSchemasIntoFilters(r,n){r.filters.forEach(l=>{const a=this.getFilterSchema(l,n);l.$links.schema=a.$links.self,this.schemaCache.update(l,a)})}setSchemas(r){r.elements.forEach(n=>{this.schemaCache.updateValue(n.$links.self.href,n)})}}d.\u0275fac=function(r){return new(r||d)(e.LFG(i.y))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac})},91654:(X,I,t)=>{"use strict";t.d(I,{E:()=>n});var i=t(81539),e=t(61043),d=t(47775),h=t(79441),r=t(2316);class n{constructor(a){this.injector=a,this.wpListChecksumService=this.injector.get(i.Y),this.wpListService=this.injector.get(e.Z),this.$transitions=this.injector.get(d.TransitionService),this.observe$=new h.xQ,this.listenForQueryParamsChanged()}listenForQueryParamsChanged(){return this.queryChangeListener=this.$transitions.onSuccess({},a=>{const m=a.options(),v=a.params("to"),c=this.wpListService.getCurrentQueryProps(v),p=v.query_id?v.query_id.toString():null;return!!(m.reload||m.custom&&!1===m.custom.notify)||this.wpListChecksumService.executeIfOutdated(p,c,()=>{this.observe$.next(c)})})}removeQueryChangeListener(){this.queryChangeListener()}}n.\u0275fac=function(a){return new(a||n)(r.LFG(r.zs3))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})},55977:(X,I,t)=>{"use strict";t.d(I,{Z:()=>n});var i=t(10190),e=t(48934),d=t(26269),h=t(68853),r=t(2316);class n{constructor(a){this.paginationService=a}buildQueryString(a){if(!a)return;const m=[];return _.each(a,(v,c)=>{!v||(Array.isArray(v)||(v=[v]),_.each(v,p=>{null!==p&&"object"==typeof p&&(p=JSON.stringify(p)),m.push(`${encodeURIComponent(c)}=${encodeURIComponent(p)}`)}))}),m.join("&")}encodeQueryJsonParams(a,m){const v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({c:a.columns.map(c=>c.id),hi:!!a.showHierarchies,g:_.get(a.groupBy,"id",""),dr:a.displayRepresentation,is:a.includeSubprojects},this.encodeSums(a)),this.encodeTimelineVisible(a)),this.encodeHighlightingMode(a)),this.encodeHighlightedAttributes(a)),this.encodeSortBy(a)),this.encodeFilters(a.filters));return"function"==typeof m?JSON.stringify(m(v)):"object"==typeof m?JSON.stringify(_.merge(v,m)):JSON.stringify(v)}encodeSums(a){return a.sums?{s:a.sums}:{}}encodeHighlightingMode(a){return a.highlightingMode&&((0,e.Z)(a)||"inline"!==a.highlightingMode)?{hl:a.highlightingMode}:{}}encodeHighlightedAttributes(a){return"inline"===a.highlightingMode&&Array.isArray(a.highlightedAttributes)&&a.highlightedAttributes.length>0?{hla:a.highlightedAttributes.map(m=>m.id)}:{}}encodeSortBy(a){return a.sortBy?{t:a.sortBy.map(m=>m.id.replace("-",":")).join()}:{}}encodeFilters(a){return a&&a.length>0?{f:a.map(v=>({n:v.id,o:v.operator.id,v:v.values.map(c=>this.queryFilterValueToParam(c))}))}:{f:[]}}encodeTimelineVisible(a){const m={};return a.timelineVisible?(m.tv=a.timelineVisible,_.isEmpty(a.timelineLabels)||(m.tll=JSON.stringify(a.timelineLabels)),m.tzl=a.timelineZoomLevel):m.tv=!1,m}buildV3GetQueryFromJsonParams(a){const m={pageSize:this.paginationService.getPerPage()};if(!a)return m;const v=JSON.parse(a);if(v.c&&(m["columns[]"]=v.c.map(c=>c)),v.s&&(m.showSums=v.s),m.timelineVisible=v.tv,v.tv&&(v.tll&&(m.timelineLabels=v.tll),v.tzl&&(m.timelineZoomLevel=v.tzl)),v.dr&&(m.displayRepresentation=v.dr),void 0!==v.is&&(m.includeSubprojects=v.is),v.hl&&(m.highlightingMode=v.hl),v.hla&&(m["highlightedAttributes[]"]=v.hla.map(c=>c)),void 0!==v.hi&&(m.showHierarchies=v.hi),m.groupBy=_.get(v,"g",""),v.f){const c=v.f.map(p=>{const f={operator:decodeURIComponent(p.o)};if(p.v){const u=Array.isArray(p.v)?p.v:[p.v];_.extend(f,{values:u})}const C={};return C[p.n]=f,C});m.filters=JSON.stringify(c)}return v.t&&(m.sortBy=JSON.stringify(v.t.split(",").map(c=>c.split(":")))),v.pa&&(m.offset=v.pa),v.pp&&(m.pageSize=v.pp),m}buildV3GetQueryFromQueryResource(a,m={},v={}){const c={};return c["columns[]"]=this.buildV3GetColumnsFromQueryResource(a),c.showSums=a.sums,c.timelineVisible=!!a.timelineVisible,a.timelineVisible&&(c.timelineZoomLevel=a.timelineZoomLevel,c.timelineLabels=JSON.stringify(a.timelineLabels)),a.highlightingMode&&(c.highlightingMode=a.highlightingMode),a.highlightedAttributes&&"inline"===a.highlightingMode&&(c["highlightedAttributes[]"]=a.highlightedAttributes.map(p=>p.href)),a.displayRepresentation&&(c.displayRepresentation=a.displayRepresentation),c.includeSubprojects=!!a.includeSubprojects,c.showHierarchies=!!a.showHierarchies,c.groupBy=_.get(a.groupBy,"id",""),c.filters=this.buildV3GetFiltersAsJson(a.filters,v),c.sortBy=this.buildV3GetSortByFromQuery(a),_.extend(m,c)}queryFilterValueToParam(a){if("boolean"==typeof a)return a?"t":"f";if(!a)return"";const m=a;return m.id?m.id.toString():m.href?m.href.split("/").pop():a.toString()}buildV3GetColumnsFromQueryResource(a){return a.columns?a.columns.map(m=>m.id||(0,i.Z)(m.href)):a._links.columns?a._links.columns.map(m=>{const v=m.href;return this.idFromHref(v)}):void 0}buildV3GetFilters(a,m={}){return a.map(c=>{const p=this.buildV3GetFilterIdFromFilter(c),f=this.buildV3GetOperatorIdFromFilter(c),C=this.buildV3GetValuesFromFilter(c).map(k=>(_.each(m,(O,y)=>{k=k.replace(`{${y}}`,O)}),k)),u={};return u[p]={operator:f,values:C},u})}filterBuilderFrom(a){const m=new d.qM;return a.forEach(v=>{const c=this.buildV3GetFilterIdFromFilter(v),p=this.buildV3GetOperatorIdFromFilter(v),f=this.buildV3GetValuesFromFilter(v);m.add(c,p,f)}),m}buildV3GetFiltersAsJson(a,m={}){return JSON.stringify(this.buildV3GetFilters(a,m))}buildV3GetFilterIdFromFilter(a){const m=a.filter?a.filter.href:a._links.filter.href;return this.idFromHref(m)}buildV3GetValuesFromFilter(a){return a.values?_.map(a.values,m=>this.queryFilterValueToParam(m)):_.map(a._links.values,m=>this.idFromHref(m.href))}buildV3GetOperatorIdFromFilter(a){if(a.operator)return a.operator.id||(0,i.Z)(a.operator.href);const{href:m}=a._links.operator;return this.idFromHref(m)}buildV3GetSortByFromQuery(a){const v=(a.sortBy?a.sortBy:a._links.sortBy).map(c=>{if(c.id)return c.id;const p=c.href;return this.idFromHref(p)});return JSON.stringify(v.map(c=>c.split("-")))}idFromHref(a){const m=a.substring(a.lastIndexOf("/")+1,a.length);return decodeURIComponent(m)}}n.\u0275fac=function(a){return new(a||n)(r.LFG(h.N))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})},85388:(X,I,t)=>{"use strict";t.d(I,{j:()=>n});var i=t(41945),e=t(8403),d=t(5602),h=t(44022),r=t(2316);class n extends e.m{constructor(a,m,v){super(a),this.injector=a,this.wpRelationsHierarchyService=m,this.schemaCache=v,this.referenceComponentClass=d.A,this.relationType="children",this.referenceTarget=null,this.buttonTexts={reference:this.I18n.t("js.relation_buttons.add_existing_child"),create:this.I18n.t("js.relation_buttons.add_new_child")}}add(a,m){return this.wpRelationsHierarchyService.addExistingChildWp(a,m)}remove(a,m){return this.wpRelationsHierarchyService.removeChild(m)}get canAdd(){return!!(this.referenceTarget&&this.canCreateWorkPackages&&this.canAddChild)}get canReference(){return!(!this.referenceTarget||!this.canAddChild)}get canAddChild(){return this.schema&&!this.schema.isMilestone&&this.referenceTarget.changeParent}get schema(){return this.referenceTarget&&this.schemaCache.of(this.referenceTarget)}}n.\u0275fac=function(a){return new(a||n)(r.LFG(r.zs3),r.LFG(i.O),r.LFG(h.y))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})},74012:(X,I,t)=>{"use strict";t.d(I,{u:()=>E});var i=t(96617),e=t(70233),h=(t(24897),t(55977)),r=t(41945),n=t(23893),l=t(8403),a=t(97248),m=t(85388),v=t(9170),p=(t(17577),t(1403)),f=t(61908),C=t(10190),u=t(2316),k=t(54364),O=t(166);function y(T,M){if(1&T&&(u.TgZ(0,"div",4),u.TgZ(1,"div",5),u._UZ(2,"h3",6),u.qZA(),u.qZA()),2&T){const S=u.oxw(2);u.xp6(2),u.Q6J("textContent",S.group.name)}}const b=function(T){return{actionsColumnEnabled:!0,hierarchyToggleEnabled:!1,inlineCreateEnabled:!0,compactTableStyle:!0,columnMenuEnabled:!1,contextMenuEnabled:!1,projectIdentifier:T,projectContext:!1}};function P(T,M){if(1&T){const S=u.EpF();u.ynx(0),u.YNc(1,y,3,1,"div",1),u.TgZ(2,"wp-embedded-table",2,3),u.NdJ("onQueryLoaded",function(F){return u.CHM(S),u.oxw().handleQueryLoaded(F)}),u.qZA(),u.BQk()}if(2&T){const S=u.oxw();u.xp6(1),u.Q6J("ngIf",S.group),u.xp6(1),u.Q6J("initialLoadingIndicator",!1)("queryProps",S.queryProps)("tableActions",S.tableActions)("configuration",u.VKq(5,b,S.idFromLink(S.workPackage.project.href)))}}class E extends a.y{constructor(M,S,R,F,L,D,G){super(D),this.wpRelationsHierarchyService=M,this.PathHelper=S,this.wpInlineCreate=R,this.halEvents=F,this.apiV3Service=L,this.queryUrlParamsHelper=D,this.I18n=G,this.addExistingChildEnabled=!1,this.idFromLink=C.Z,this.tableActions=[n.g.factoryFor("remove-child-action",this.I18n.t("js.relation_buttons.remove_child"),Q=>{this.embeddedTable&&(this.embeddedTable.loadingIndicator=this.wpRelationsHierarchyService.removeChild(Q))},Q=>!!Q.changeParent)]}ngOnInit(){this.wpInlineCreate.referenceTarget=this.workPackage,this.queryProps=this.buildQueryProps(),this.wpInlineCreate.newInlineWorkPackageCreated.pipe(this.untilDestroyed()).subscribe(M=>{this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:M,relationType:"child"})}),this.apiV3Service.work_packages.id(this.workPackage).observe().pipe((0,v.h)(()=>{var M;return!!(null===(M=this.embeddedTable)||void 0===M?void 0:M.isInitialized)}),this.untilDestroyed()).subscribe(()=>this.refreshTable())}}E.\u0275fac=function(M){return new(M||E)(u.Y36(r.O),u.Y36(e.j),u.Y36(l.m),u.Y36(p.J),u.Y36(f.T),u.Y36(h.Z),u.Y36(i.D))},E.\u0275cmp=u.Xpm({type:E,selectors:[["wp-children-query"]],inputs:{workPackage:"workPackage",query:"query",group:"group",addExistingChildEnabled:"addExistingChildEnabled"},features:[u._Bn([{provide:l.m,useClass:m.j}]),u.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","attributes-group--header",4,"ngIf"],[3,"initialLoadingIndicator","queryProps","tableActions","configuration","onQueryLoaded"],["embeddedTable",""],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"]],template:function(M,S){1&M&&u.YNc(0,P,4,7,"ng-container",0),2&M&&u.Q6J("ngIf",!S.hidden)},directives:[k.O5,O.Z],encapsulation:2})},5602:(X,I,t)=>{"use strict";t.d(I,{A:()=>C});var i=t(96617),e=t(8403),d=t(84366),h=t(53457),r=t(55977),n=t(69057),l=t(1403),a=t(61908),m=t(62964),v=t(43440),c=t(2316),p=t(11950),f=t(2775);class C{constructor(k,O,y,b,P,E,T,M,S){this.parent=k,this.wpInlineCreate=O,this.apiV3Service=y,this.wpRelations=b,this.notificationService=P,this.halEvents=E,this.urlParamsHelper=T,this.querySpace=M,this.I18n=S,this.isDisabled=!1,this.queryFilters=this.buildQueryFilters(),this.text={abort:this.I18n.t("js.relation_buttons.abort")}}addExisting(){if(_.isNil(this.selectedWpId))return;const k=this.selectedWpId;this.isDisabled=!0,this.wpInlineCreate.add(this.workPackage,k).then(()=>{this.apiV3Service.work_packages.id(this.workPackage).refresh(),this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:k,relationType:this.relationType}),this.isDisabled=!1,this.wpInlineCreate.newInlineWorkPackageReferenced.next(k),this.cancel()}).catch(O=>{this.notificationService.handleRawError(O,this.workPackage),this.isDisabled=!1,this.cancel()})}onSelected(k){k&&(this.selectedWpId=k.id,this.addExisting())}get relationType(){return this.wpInlineCreate.relationType}get workPackage(){return this.wpInlineCreate.referenceTarget}cancel(){this.parent.resetRow()}buildQueryFilters(){const k=this.querySpace.query.value;if(!k)return[];const O=n.d.RELATION_TYPES(!0),y=k.filters.filter(b=>{const P=this.urlParamsHelper.buildV3GetFilterIdFromFilter(b);return-1===O.indexOf(P)});return this.urlParamsHelper.buildV3GetFilters(y)}}C.\u0275fac=function(k){return new(k||C)(c.Y36(d.I),c.Y36(e.m),c.Y36(a.T),c.Y36(h.V),c.Y36(m.q),c.Y36(l.J),c.Y36(r.Z),c.Y36(v.q),c.Y36(i.D))},C.\u0275cmp=c.Xpm({type:C,selectors:[["ng-component"]],decls:7,vars:4,consts:[["data-indicator-name","relationAddChild",1,"loading-indicator--location"],[1,"wp-relations-create--form","wp-relations--add-form"],[1,"wp-relations-input-section"],["hiddenOverflowContainer",".work-packages-full-view--split-left",3,"workPackage","additionalFilters","filterCandidatesFor","onSelected"],[1,"wp-relations-controls-section","relation-row"],["type","button",1,"spot-link","wp-create-relation--cancel",3,"click"],["icon-classes","icon-remove icon-no-color",3,"icon-title"]],template:function(k,O){1&k&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.TgZ(3,"wp-relations-autocomplete",3),c.NdJ("onSelected",function(b){return O.onSelected(b)}),c.qZA(),c.qZA(),c.TgZ(4,"div",4),c.TgZ(5,"button",5),c.NdJ("click",function(){return O.cancel()}),c._UZ(6,"op-icon",6),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&k&&(c.xp6(3),c.Q6J("workPackage",O.workPackage)("additionalFilters",O.queryFilters)("filterCandidatesFor",O.relationType),c.xp6(3),c.Q6J("icon-title",O.text.abort))},directives:[p.t,f.o],encapsulation:2})},32869:(X,I,t)=>{"use strict";t.d(I,{x:()=>l});var i=t(3786),e=t(8403),d=t(5602),h=t(53457),r=t(29161),n=t(2316);class l extends e.m{constructor(m){super(m),this.injector=m,this.referenceComponentClass=d.A,this.relationType="",this.referenceTarget=null,this.buttonTexts={reference:this.I18n.t("js.relation_buttons.add_existing"),create:this.I18n.t("js.relation_buttons.create_new")}}add(m,v){return this.wpRelations.addCommonRelation(v,this.relationType,m.id)}remove(m,v){const c=this.wpRelations.find(v,m,this.relationType);return void 0!==c?this.wpRelations.removeRelation(c):Promise.reject()}get canAdd(){return!!(this.referenceTarget&&this.canCreateWorkPackages&&this.referenceTarget.addRelation)}get canReference(){return!!this.canAdd}}l.\u0275fac=function(m){return new(m||l)(n.LFG(n.zs3))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac}),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.V)],l.prototype,"wpRelations",void 0)},97248:(X,I,t)=>{"use strict";t.d(I,{y:()=>l});t(166);var e=t(17577),d=t(55977),h=t(26942),r=t(2316);const n=["embeddedTable"];class l extends h.N{constructor(m){super(),this.queryUrlParamsHelper=m,this.hidden=!1}refreshTable(){var m;(null===(m=this.embeddedTable)||void 0===m?void 0:m.isInitialized)&&this.embeddedTable.loadQuery(!0,!1)}handleQueryLoaded(m){if(!(this.query instanceof e.P))return;const v=this.projectValuesCount(this.query),c=this.projectValuesCount(m);null!==v&&null===c&&(this.hidden=!0),v&&c&&v>0&&0===c&&(this.hidden=!0)}projectValuesCount(m){const v=m.filters.find(c=>"project"===c.id);return v?v.values.length:null}buildQueryProps(){return this.query instanceof e.P?this.queryUrlParamsHelper.buildV3GetQueryFromQueryResource(this.query,{valid_subset:!0},{id:this.workPackage.id}):this.query}}l.\u0275fac=function(m){return new(m||l)(r.Y36(d.Z))},l.\u0275dir=r.lG2({type:l,viewQuery:function(m,v){if(1&m&&r.Gf(n,5),2&m){let c;r.iGM(c=r.CRH())&&(v.embeddedTable=c.first)}},features:[r.qOj]})},11950:(X,I,t)=>{"use strict";t.d(I,{t:()=>u});var i=t(2316),e=t(96617),h=(t(24897),t(81134)),r=t(30400),n=t(33927),l=t(18293),a=t(43440),m=t(70233),v=t(65146),c=t(91923),p=t(44022),f=t(62964),C=t(91593);class u{constructor(O,y,b,P,E,T,M,S,R){this.querySpace=O,this.pathHelper=y,this.notificationService=b,this.CurrentProject=P,this.halResourceService=E,this.schemaCacheService=T,this.cdRef=M,this.ngZone=S,this.I18n=R,this.text={placeholder:this.I18n.t("js.relations_autocomplete.placeholder")},this.inputPlaceholder=this.text.placeholder,this.additionalFilters=[],this.hiddenOverflowContainer="body",this.onCancel=new i.vpe,this.onSelected=new i.vpe,this.onEmptySelected=new i.vpe,this.getAutocompleterData=F=>null===F||0===F.length?(0,h.of)([]):(0,r.D)(this.workPackage.availableRelationCandidates.$link.$fetch({query:F,filters:JSON.stringify(this.additionalFilters),type:this.filterCandidatesFor||this.selectedRelationType})).pipe((0,n.U)(L=>L.elements),(0,l.K)(L=>(this.notificationService.handleRawError(L),(0,h.of)([])))),this.autocompleterOptions={resource:"work_packages",getOptionsFn:this.getAutocompleterData},this.appendToContainer="body"}reset(){this.cancel()}cancel(){this.onCancel.emit()}onWorkPackageSelected(O){O&&this.schemaCacheService.ensureLoaded(O).then(()=>{this.onSelected.emit(O),this.ngSelectComponent.ngSelectInstance.close()})}onOpen(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.ngSelectComponent.repositionDropdown(),jQuery(this.hiddenOverflowContainer).one("scroll",()=>{this.ngSelectComponent.closeSelect()})},25)})}}u.\u0275fac=function(O){return new(O||u)(i.Y36(a.q),i.Y36(m.j),i.Y36(f.q),i.Y36(v.R),i.Y36(c.u),i.Y36(p.y),i.Y36(i.sBO),i.Y36(i.R0b),i.Y36(e.D))},u.\u0275cmp=i.Xpm({type:u,selectors:[["wp-relations-autocomplete"]],viewQuery:function(O,y){if(1&O&&i.Gf(C.s,7),2&O){let b;i.iGM(b=i.CRH())&&(y.ngSelectComponent=b.first)}},hostBindings:function(O,y){1&O&&i.NdJ("keydown.escape",function(){return y.reset()})},inputs:{inputPlaceholder:"inputPlaceholder",workPackage:"workPackage",selectedRelationType:"selectedRelationType",filterCandidatesFor:"filterCandidatesFor",additionalFilters:"additionalFilters",hiddenOverflowContainer:"hiddenOverflowContainer"},outputs:{onCancel:"onCancel",onSelected:"onSelected",onEmptySelected:"onEmptySelected"},decls:1,vars:6,consts:[["classes","wp-relations-autocomplete","data-qa-selector","wp-relations-autocomplete",3,"appendTo","placeholder","typeToSearchText","resource","defaultData","getOptionsFn","open","change"]],template:function(O,y){1&O&&(i.TgZ(0,"op-autocompleter",0),i.NdJ("open",function(){return y.onOpen()})("change",function(P){return y.onWorkPackageSelected(P)}),i.qZA()),2&O&&i.Q6J("appendTo",y.appendToContainer)("placeholder",y.inputPlaceholder)("typeToSearchText",y.inputPlaceholder)("resource",y.autocompleterOptions.resource)("defaultData",!1)("getOptionsFn",y.autocompleterOptions.getOptionsFn)},directives:[C.s],styles:[".wp-relations-autocomplete{border:none}.wp-relations-autocomplete .ng-clear-wrapper{display:none}\n"],encapsulation:2})},41945:(X,I,t)=>{"use strict";t.d(I,{O:()=>a});var i=t(87853),e=t(47775),d=t(70233),h=t(62964),r=t(61908),n=t(1403),l=t(2316);class a{constructor(v,c,p,f,C,u){this.$state=v,this.states=c,this.halEvents=p,this.notificationService=f,this.pathHelper=C,this.apiV3Service=u}changeParent(v,c){const p={lockVersion:v.lockVersion};return p._links=c?{parent:{href:this.apiV3Service.work_packages.id(c).path}}:{parent:{href:null}},v.changeParent(p).then(f=>(this.apiV3Service.work_packages.cache.updateWorkPackage(f),this.notificationService.showSave(f),this.halEvents.push(v,{eventType:"association",relatedWorkPackage:c,relationType:"parent"}),f)).catch(f=>(this.notificationService.handleRawError(f,v),Promise.reject(f)))}removeParent(v){return this.changeParent(v,null)}addExistingChildWp(v,c){return this.apiV3Service.work_packages.id(c).get().toPromise().then(p=>this.changeParent(p,v.id).then(f=>(this.apiV3Service.work_packages.id(v).refresh(),this.halEvents.push(v,{eventType:"association",relatedWorkPackage:p.id,relationType:"child"}),f)))}addNewChildWp(v,c){c.project.$load().then(()=>{const p=[`${v}.new`,{parent_id:c.id}];this.$state.includes("work-packages.show")&&(p[0]="work-packages.new"),this.$state.go(...p)})}removeChild(v){return v.$load().then(()=>{const c=v.parent;return v.changeParent({_links:{parent:{href:null}},lockVersion:v.lockVersion}).then(p=>{c&&this.apiV3Service.work_packages.id(c).refresh().then(f=>{this.halEvents.push(f,{eventType:"association",relatedWorkPackage:null,relationType:"child"})}),this.apiV3Service.work_packages.cache.updateWorkPackage(p)}).catch(p=>(this.notificationService.handleRawError(p,v),Promise.reject(p)))})}}a.\u0275fac=function(v){return new(v||a)(l.LFG(e.StateService),l.LFG(i.G),l.LFG(n.J),l.LFG(h.q),l.LFG(d.j),l.LFG(r.T))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac})},53457:(X,I,t)=>{"use strict";t.d(I,{V:()=>v});var i=t(70233),e=t(14808),d=t(91923),h=t(61908),r=t(79175),n=t(53466),l=t(33927),a=t(2316);class m extends e.Ui{constructor(){super(),this.name="WP-Relations",this.relations=(0,e.r9)(),this.initializeMembers()}}class v extends r.r{constructor(p,f,C){super((new m).relations),this.PathHelper=p,this.apiV3Service=f,this.halResource=C}require(p,f=!1){return this.requireAndStream(p,f).pipe((0,n.q)(1)).toPromise()}requireAndStream(p,f=!1){return(this.stale(p)||f)&&this.clearAndLoad(p,this.load(p)),this.state(p).values$()}load(p){return this.apiV3Service.work_packages.id(p).relations.get().pipe((0,l.U)(f=>this.relationsStateValue(p,f.elements)))}requireAll(p){return new Promise((f,C)=>{this.apiV3Service.relations.loadInvolved(p).toPromise().then(u=>{this.clearSome(...p),this.accumulateRelationsFromInvolved(p,u),f(void 0)}).catch(C)})}find(p,f,C){const u=this.state(p.id).value;if(u)return _.find(u,k=>{const O=k.denormalized(p);return O.target.id===f.id&&O.relationType===C})}removeRelation(p){return p.delete().then(()=>{this.removeFromStates(p)})}updateRelationType(p,f,C,u){const k={_links:{from:{href:p.href},to:{href:f.href}},type:u};return this.updateRelation(C,k)}updateRelation(p,f){return p.updateImmediately(f).then(C=>(this.insertIntoStates(C),C))}addCommonRelation(p,f,C){const u={_links:{from:{href:this.apiV3Service.work_packages.id(p).toString()},to:{href:this.apiV3Service.work_packages.id(C).toString()}},type:f},k=this.apiV3Service.work_packages.id(p).relations.toString();return this.halResource.post(k,u).toPromise().then(O=>(this.insertIntoStates(O),O))}insertIntoStates(p){_.values(p.ids).forEach(f=>{this.multiState.get(f).doModify(C=>(C[p.id]=p,C),()=>{const C={};return C[p.id]=p,C})})}removeFromStates(p){_.values(p.ids).forEach(f=>{this.multiState.get(f).doModify(C=>(delete C[p.id],C),()=>({}))})}relationsStateValue(p,f){return _.keyBy(f,C=>C.id)}accumulateRelationsFromInvolved(p,f){p.forEach(C=>{const u=f.filter(O=>O.isInvolved(C)),k=this.relationsStateValue(C,u);this.updateValue(C,k)})}}v.\u0275fac=function(p){return new(p||v)(a.LFG(i.j),a.LFG(h.T),a.LFG(d.u))},v.\u0275prov=a.Yz7({token:v,factory:v.\u0275fac})},54892:(X,I,t)=>{"use strict";t.d(I,{a:()=>n});var i=t(12877),e=t(61289),d=t(70692);class h{constructor(a,m,v,c,p){this.timezoneService=a,this.isReversed=m,this.activities=v,this.activity=c,this.index=p,this.date=this.activityDate(this.activity),this.dateOfPrevious=this.index>0?this.activityDate(this.activities[this.index-1]):void 0,this.isNextDate=this.date!==this.dateOfPrevious}number(a=!1){return this.orderedIndex(this.index,a)}get href(){return this.activity.href}get identifier(){return`${this.href}-${this.version}-${this.updatedAt}`}get version(){return this.activity.version}get updatedAt(){return this.activity.updatedAt}isInitial(a=!1){let m=this.number(a);if(0!==this.activity._type.indexOf("Activity"))return!1;if(1===m)return!0;for(;--m>0;){const v=this.orderedIndex(m,a)-1,c=this.activities[v];if(!_.isNil(c)&&0===c._type.indexOf("Activity"))return!1}return!0}activityDate(a){return moment(a.createdAt).format("LL")}orderedIndex(a,m=!1){return m||this.isReversed?this.activities.length-a:a+1}}var r=t(2316);class n extends e.N{constructor(a,m){super(),this.ConfigurationService=a,this.timezoneService=m}get order(){return this.isReversed?"desc":"asc"}get isReversed(){return!!this.ConfigurationService.commentsSortedInDescendingOrder()}load(a){const m=[],v=[],c=function(p){m.push(p.elements)};return v.push(a.activities.$update().then(c)),a.revisions&&v.push(a.revisions.$update().then(c)),Promise.all(v).then(()=>this.sortedActivityList(m))}sortedActivityList(a,m="createdAt"){const v=_.sortBy(_.flatten(a),m);return this.isReversed?v.reverse():v}info(a,m,v){return new h(this.timezoneService,this.isReversed,a,m,v)}}n.\u0275fac=function(a){return new(a||n)(r.LFG(i.e),r.LFG(d.B))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})},84109:(X,I,t)=>{"use strict";t.d(I,{p:()=>r});var i=t(47775),e=t(84224),d=t(70482),h=t(2316);class r{constructor(l,a,m){this.$state=l,this.uiRouterGlobals=a,this.$transitions=m,this.currentTab="overview",this.subject=new e.t(1),this.updateTabs(),m.onSuccess({},v=>{this.updateTabs(v.params("to").tabIdentifier)})}get observable(){return this.subject}get lastActiveTab(){return this.isCurrentState("show")?this.currentShowTab:this.currentDetailsTab}goCurrentShowState(l={}){this.$state.go("work-packages.show.tabs",Object.assign(Object.assign(Object.assign({},this.uiRouterGlobals.params),l),{tabIdentifier:this.currentShowTab}))}goCurrentDetailsState(l={}){const a=(0,d.W)(this.$state);this.$state.go(`${a}.tabs`,Object.assign(Object.assign(Object.assign({},this.uiRouterGlobals.params),l),{tabIdentifier:this.currentDetailsTab}))}isDetailsState(l){return!!l&&l.includes(".details")}get currentShowTab(){return"overview"===this.currentTab?"activity":this.currentTab}get currentDetailsTab(){return this.currentTab}get currentTabIdentifier(){return this.uiRouterGlobals.params.tabIdentifier}notify(){this.subject.next({active:this.lastActiveTab,show:this.currentShowTab,details:this.currentDetailsTab})}updateTab(l){this.isCurrentState(l)&&(this.currentTab=this.uiRouterGlobals.params.tabIdentifier,this.notify())}isCurrentState(l){return"show"===l?this.$state.includes("work-packages.show.*"):"details"===l&&this.$state.includes("**.details.*")}updateTabs(l){if(this.isCurrentState("show")&&"activity"===l)return this.currentTab="overview",this.notify();this.updateTab("show"),this.updateTab("details")}}r.\u0275fac=function(l){return new(l||r)(h.LFG(i.StateService),h.LFG(i.UIRouterGlobals),h.LFG(i.TransitionService))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})},18236:(X,I,t)=>{"use strict";t.d(I,{h:()=>C});var i=t(47775),e=t(86469),d=t(96617),h=t(84939),r=t(70233),n=t(43682),l=t(62964),a=t(26942),m=t(61908),v=t(2316);function c(u,k){if(1&u&&(v.TgZ(0,"div",8),v.TgZ(1,"div",9),v._UZ(2,"p",10),v.qZA(),v.qZA()),2&u){const O=v.oxw();v.xp6(2),v.Q6J("textContent",O.text.loadingError)}}function p(u,k){if(1&u&&v._UZ(0,"op-wp-watcher-entry",11),2&u){const O=k.$implicit;v.Q6J("watcher",O)}}const f=function(u){return{"-read-only":u}};class C extends a.N{constructor(k,O,y,b,P,E,T,M,S){super(),this.I18n=k,this.elementRef=O,this.wpWatchersService=y,this.$transition=b,this.notificationService=P,this.loadingIndicator=E,this.cdRef=T,this.pathHelper=M,this.apiV3Service=S,this.trackByHref=n.u9,this.error=!1,this.noResults=!1,this.allowedToView=!1,this.allowedToAdd=!1,this.allowedToRemove=!1,this.watching=[],this.text={loading:this.I18n.t("js.watchers.label_loading"),loadingError:this.I18n.t("js.watchers.label_error_loading"),autocomplete:{placeholder:this.I18n.t("js.watchers.typeahead_placeholder")}}}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.workPackageId=this.$transition.params("to").workPackageId,this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(k=>{this.workPackage=k,this.loadCurrentWatchers()}),this.availableWatchersPath=this.apiV3Service.work_packages.id(this.workPackageId).available_watchers.path}loadCurrentWatchers(){this.error=!1,this.allowedToView=!!this.workPackage.watchers,this.allowedToAdd=!!this.workPackage.addWatcher,this.allowedToRemove=!!this.workPackage.removeWatcher,this.allowedToView?this.wpWatchersService.require(this.workPackage).then(k=>{this.watching=k,this.cdRef.detectChanges()}).catch(k=>{this.notificationService.showError(k,this.workPackage)}):this.error=!0}set loadingPromise(k){this.loadingIndicator.wpDetails.promise=k}addWatcher(k){this.loadingPromise=this.workPackage.addWatcher.$link.$fetch({user:{href:k.href}}).then(()=>{this.wpWatchersService.require(this.workPackage,!0),this.apiV3Service.work_packages.id(this.workPackage).refresh(),this.cdRef.detectChanges()}).catch(O=>this.notificationService.showError(O,this.workPackage))}removeWatcher(k){this.workPackage.removeWatcher.$link.$prepare({user_id:k.id})().then(()=>{_.remove(this.watching,O=>O.href===k.href),this.wpWatchersService.require(this.workPackage,!0),this.apiV3Service.work_packages.id(this.workPackage).refresh(),this.cdRef.detectChanges()}).catch(O=>this.notificationService.showError(O,this.workPackage))}}C.\u0275fac=function(k){return new(k||C)(v.Y36(d.D),v.Y36(v.SBq),v.Y36(h.W),v.Y36(i.Transition),v.Y36(l.q),v.Y36(e.vt),v.Y36(v.sBO),v.Y36(r.j),v.Y36(m.T))},C.\u0275cmp=v.Xpm({type:C,selectors:[["wp-watchers-tab"]],features:[v.qOj],decls:8,vars:10,consts:[["id","detail-panel-watchers"],["class","op-toast -error",4,"ngIf"],[3,"hidden"],[1,"work-package--watchers","form--selected-value--list",3,"ngClass"],[3,"watcher",4,"ngFor","ngForOf","ngForTrackBy"],[1,"work-package--watchers-lookup","hide-when-print",3,"hidden"],["name","watcherForm","novalidate",""],["appendTo","body",1,"wp-watcher--autocomplete",3,"clearAfterSelection","url","valueChange"],[1,"op-toast","-error"],[1,"op-toast--content"],[3,"textContent"],[3,"watcher"]],template:function(k,O){1&k&&(v.TgZ(0,"div",0),v.YNc(1,c,3,1,"div",1),v.TgZ(2,"div",2),v.TgZ(3,"div",3),v.YNc(4,p,1,1,"op-wp-watcher-entry",4),v.qZA(),v.TgZ(5,"div",5),v.TgZ(6,"form",6),v.TgZ(7,"op-user-autocompleter",7),v.NdJ("valueChange",function(b){return O.addWatcher(b)}),v.qZA(),v.qZA(),v.qZA(),v.qZA(),v.qZA()),2&k&&(v.xp6(1),v.Q6J("ngIf",O.error),v.xp6(1),v.Q6J("hidden",O.error),v.xp6(1),v.Q6J("ngClass",v.VKq(8,f,!O.allowedToRemove)),v.xp6(1),v.Q6J("ngForOf",O.watching)("ngForTrackBy",O.trackByHref),v.xp6(1),v.Q6J("hidden",!O.allowedToAdd),v.xp6(2),v.Q6J("clearAfterSelection",!0)("url",O.availableWatchersPath))},encapsulation:2,changeDetection:0})},84939:(X,I,t)=>{"use strict";t.d(I,{W:()=>d});var i=t(61289),e=t(2316);class d extends i.N{load(r){return r.watchers.$update().then(n=>n.elements)}}d.\u0275fac=function(){let h;return function(n){return(h||(h=e.n5z(d)))(n||d)}}(),d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac})},61289:(X,I,t)=>{"use strict";t.d(I,{N:()=>r});var i=t(14808),e=t(53466),d=t(81134);t(19100).hi;class r{constructor(){this.cacheDurationInSeconds=120,this.cache={id:null,state:(0,i.qH)()}}requireAndStream(l,a=!1){const m=l.id,{state:v}=this.cache;return(a||this.cache.id!==m)&&v.clear(),this.isCached(m)?(0,d.of)(v.value):(this.cache.id=m,this.cache.state.putFromPromiseIfPristine(()=>this.load(l)),this.cache.state.values$())}require(l,a=!1){return this.requireAndStream(l,a).pipe((0,e.q)(1)).toPromise()}clear(l){this.cache.id===l&&this.cache.state.clear()}isCached(l){const{state:a}=this.cache;return this.cache.id===l&&a.hasValue()&&!a.isValueOlderThan(1e3*this.cacheDurationInSeconds)}}},77180:(X,I,t)=>{"use strict";t.d(I,{G:()=>lt});var i=t(47775),e=t(96617),d=t(70233),h=t(83720),r=t(33927),l=(t(24897),t(12703)),a=t(60874),m=t(17577),v=t(53448),c=t(79441),p=t(68197),f=t(1056),C=t(91923),u=t(10190),k=t(84699),O=t(26942),y=t(65146),b=t(87853),P=t(44022),E=t(3352),T=t(2316),M=t(54364),S=t(61908),F=(t(53407),t(1403)),L=t(62964),D=t(54892);class G{constructor(Ae,xe,Ye,mt,Ot,Pt,Mt){this.halResourceService=Ae,this.apiV3Service=xe,this.wpSchemaCacheService=Ye,this.wpActivity=mt,this.notificationService=Ot,this.halEditing=Pt,this.halEvents=Mt}fetchAction(){null!==this.action.href&&this.halResourceService.get(this.action.href).toPromise().then(Ae=>{this.action=Ae})}get change(){return this.halEditing.changeFor(this.workPackage)}update(){if(null===this.action.href)return;const Ae={lockVersion:this.workPackage.lockVersion,_links:{workPackage:{href:this.workPackage.href}}};this.change.inFlight=!0,this.halResourceService.post(`${this.action.href}/execute`,Ae).subscribe(xe=>{this.notificationService.showSave(xe,!1),this.workPackage=xe,this.wpActivity.clear(this.workPackage.id),this.apiV3Service.work_packages.cache.updateWorkPackage(xe).then(()=>{this.halEditing.stopEditing(xe),this.halEvents.push(xe,{eventType:"updated"}),this.change.inFlight=!1})},xe=>{this.notificationService.handleRawError(xe,this.workPackage),this.change.inFlight=!1})}onMouseEnter(){this.fetchAction()}}function Q(Ne,Ae){if(1&Ne&&T._UZ(0,"wp-custom-action",1),2&Ne){const xe=Ae.$implicit,Ye=T.oxw();T.Q6J("workPackage",Ye.workPackage)("action",xe)}}G.\u0275fac=function(Ae){return new(Ae||G)(T.Y36(C.u),T.Y36(S.T),T.Y36(P.y),T.Y36(D.a),T.Y36(L.q),T.Y36(l.l),T.Y36(F.J))},G.\u0275cmp=T.Xpm({type:G,selectors:[["wp-custom-action"]],hostBindings:function(Ae,xe){1&Ae&&T.NdJ("mouseenter",function(){return xe.onMouseEnter()})},inputs:{workPackage:"workPackage",action:"action"},decls:2,vars:3,consts:[[1,"custom-action--button","button","-narrow","hide-when-print",3,"title","disabled","click"]],template:function(Ae,xe){1&Ae&&(T.TgZ(0,"button",0),T.NdJ("click",function(){return xe.update()}),T._uU(1),T.qZA()),2&Ae&&(T.s9C("title",xe.action.description?xe.action.description:xe.action.name),T.Q6J("disabled",xe.change.inFlight),T.xp6(1),T.hij(" ",xe.action.name,"\n"))},encapsulation:2,changeDetection:0});class V extends O.N{constructor(Ae,xe){super(),this.apiV3Service=Ae,this.cdRef=xe,this.actions=[]}ngOnInit(){this.apiV3Service.work_packages.id(this.workPackage.id).requireAndStream().pipe(this.untilDestroyed()).subscribe(Ae=>{this.actions=Ae.customActions?[...Ae.customActions]:[],this.cdRef.detectChanges()})}}V.\u0275fac=function(Ae){return new(Ae||V)(T.Y36(S.T),T.Y36(T.sBO))},V.\u0275cmp=T.Xpm({type:V,selectors:[["wp-custom-actions"]],inputs:{workPackage:"workPackage"},features:[T.qOj],decls:1,vars:1,consts:[["class","custom-action",3,"workPackage","action",4,"ngFor","ngForOf"],[1,"custom-action",3,"workPackage","action"]],template:function(Ae,xe){1&Ae&&T.YNc(0,Q,1,2,"wp-custom-action",0),2&Ae&&T.Q6J("ngForOf",xe.actions)},directives:[M.sg,G],encapsulation:2,changeDetection:0});var K=t(54262),q=t(96418),se=t(83845),te=t(65532),ie=t(21501),le=t(35403),oe=t(32853),ne=t(97047),fe=t(2775),ve=t(84906);function Se(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",17),T._UZ(1,"op-editable-attribute-field",18),T.qZA()),2&Ne){const xe=T.oxw(2);T.xp6(1),T.Q6J("resource",xe.workPackage)("wrapperClasses","-no-label")("fieldName","subject")}}function Oe(Ne,Ae){if(1&Ne&&T._UZ(0,"wp-status-button",19),2&Ne){const xe=T.oxw(2);T.Q6J("workPackage",xe.workPackage)}}function je(Ne,Ae){1&Ne&&T._UZ(0,"attribute-help-text",20),2&Ne&&T.Q6J("attribute","status")("attributeScope","WorkPackage")}function tt(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",21),T._UZ(1,"span",22),T._uU(2,": "),T._UZ(3,"span",22),T.TgZ(4,"span"),T._uU(5,"\xa0"),T.qZA(),T._UZ(6,"op-user-link",23),T.TgZ(7,"span"),T._uU(8,".\xa0"),T.qZA(),T._UZ(9,"span",22),T.TgZ(10,"span"),T._uU(11,"\xa0"),T.qZA(),T._UZ(12,"op-date-time",24),T.TgZ(13,"span"),T._uU(14,"."),T.qZA(),T.qZA()),2&Ne){const xe=T.oxw(2);T.xp6(1),T.Q6J("textContent",xe.idLabel),T.xp6(2),T.Q6J("textContent",xe.text.infoRow.createdBy),T.xp6(3),T.Q6J("user",xe.workPackage.author),T.xp6(3),T.Q6J("textContent",xe.text.infoRow.lastUpdatedOn),T.xp6(3),T.Q6J("dateTimeValue",xe.workPackage.updatedAt)}}function He(Ne,Ae){1&Ne&&(T.TgZ(0,"span",34),T._uU(1,"*"),T.qZA())}const st=function(Ne){return{"-span-all-columns":Ne}};function Me(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",28),T.TgZ(1,"div",29),T.TgZ(2,"wp-replacement-label",30),T._uU(3),T.YNc(4,He,2,0,"span",31),T.qZA(),T._UZ(5,"attribute-help-text",20),T.qZA(),T.TgZ(6,"div",32),T._UZ(7,"op-editable-attribute-field",33),T.qZA(),T.qZA()),2&Ne){const xe=Ae.$implicit,Ye=T.oxw(3);T.Q6J("ngClass",T.VKq(8,st,xe.spanAll)),T.xp6(2),T.Q6J("fieldName",xe.name),T.xp6(1),T.hij(" ",xe.label," "),T.xp6(1),T.Q6J("ngIf",xe.field.required&&xe.field.writable),T.xp6(1),T.Q6J("attribute",xe.name)("attributeScope","WorkPackage"),T.xp6(2),T.Q6J("resource",Ye.workPackage)("fieldName",xe.name)}}function ce(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",25),T.TgZ(1,"div"),T._UZ(2,"p",26),T.YNc(3,Me,8,10,"div",27),T.qZA(),T.qZA()),2&Ne){const xe=T.oxw(2);T.xp6(2),T.Q6J("textContent",xe.text.project.required),T.xp6(1),T.Q6J("ngForOf",xe.projectContext.field)("ngForTrackBy",xe.trackByName)}}function J(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",35),T.TgZ(1,"div"),T.TgZ(2,"p"),T._UZ(3,"span",36),T._UZ(4,"br"),T._UZ(5,"a",37),T.qZA(),T.qZA(),T.qZA()),2&Ne){const xe=T.oxw(2);T.xp6(3),T.Q6J("innerHTML",xe.projectContextText,T.oJD),T.xp6(2),T.Q6J("textContent",xe.text.project.switchTo),T.uIk("href",xe.projectContext.href,T.LSH)}}const W=function(Ne){return{workPackage:Ne}};function Y(Ne,Ae){if(1&Ne&&(T.ynx(0),T._UZ(1,"ndc-dynamic",38),T.BQk()),2&Ne){const xe=Ae.$implicit,Ye=T.oxw(2);T.xp6(1),T.Q6J("ndcDynamicComponent",xe)("ndcDynamicInputs",T.VKq(2,W,Ye.workPackage))}}const $=function(Ne,Ae,xe){return{workPackage:Ne,group:Ae,query:xe}};function be(Ne,Ae){if(1&Ne&&(T.ynx(0,42),T._UZ(1,"ndc-dynamic",38),T.BQk()),2&Ne){const xe=T.oxw().$implicit,Ye=T.oxw(2);T.xp6(1),T.Q6J("ndcDynamicComponent",Ye.attributeGroupComponent(xe))("ndcDynamicInputs",T.kEZ(2,$,Ye.workPackage,xe,xe.query))}}const N=function(Ne,Ae){return{workPackage:Ne,group:Ae}};function Ue(Ne,Ae){if(1&Ne&&(T.ynx(0),T.TgZ(1,"div",43),T.TgZ(2,"div",44),T._UZ(3,"h3",45),T.qZA(),T.qZA(),T._UZ(4,"ndc-dynamic",46),T.BQk()),2&Ne){const xe=T.oxw().$implicit,Ye=T.oxw(2);T.xp6(3),T.Q6J("textContent",xe.name),T.xp6(1),T.Q6J("ndcDynamicComponent",Ye.attributeGroupComponent(xe))("ndcDynamicInjector",Ye.injector)("ndcDynamicInputs",T.WLB(4,N,Ye.workPackage,xe))}}function et(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",39),T.YNc(1,be,2,6,"ng-container",40),T.YNc(2,Ue,5,7,"ng-container",41),T.qZA()),2&Ne){const xe=Ae.$implicit,Ye=T.oxw(2);T.Q6J("hidden",Ye.shouldHideGroup(xe))("ngClass","__overflowing_"+xe.id),T.uIk("data-group-name",xe.name)("data-overflowing-identifier",".__overflowing_"+xe.id),T.xp6(1),T.Q6J("ngIf",xe.isolated),T.xp6(1),T.Q6J("ngIf",!xe.isolated)}}const Ke=function(Ne){return{"work-package--single-view_with-columns":Ne}};function _e(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",3),T.YNc(1,Se,2,3,"div",4),T.TgZ(2,"div",5),T.YNc(3,Oe,1,1,"wp-status-button",6),T.YNc(4,je,1,2,"attribute-help-text",7),T.YNc(5,tt,15,5,"div",8),T._UZ(6,"wp-custom-actions",9),T.qZA(),T.YNc(7,ce,4,3,"div",10),T.YNc(8,J,6,3,"div",11),T.YNc(9,Y,2,4,"ng-container",12),T.TgZ(10,"div",13),T.TgZ(11,"div",14),T._UZ(12,"op-editable-attribute-field",15),T.qZA(),T.qZA(),T.YNc(13,et,3,6,"div",16),T.qZA()),2&Ne){const xe=T.oxw();T.Q6J("ngClass",T.VKq(15,Ke,xe.showTwoColumnLayout())),T.xp6(1),T.Q6J("ngIf",xe.isNewResource),T.xp6(2),T.Q6J("ngIf",!xe.isNewResource),T.xp6(1),T.Q6J("ngIf",!xe.isNewResource),T.xp6(1),T.Q6J("ngIf",!xe.isNewResource),T.xp6(1),T.Q6J("workPackage",xe.workPackage),T.xp6(1),T.Q6J("ngIf",xe.projectContext&&xe.projectContext.field),T.xp6(1),T.Q6J("ngIf",!xe.isNewResource&&xe.projectContext&&!xe.projectContext.matches),T.xp6(1),T.Q6J("ngForOf",xe.prependedAttributeGroupComponents()),T.xp6(3),T.Q6J("fieldName","description")("resource",xe.workPackage)("isDropTarget",!0)("wrapperClasses","-no-label"),T.xp6(1),T.Q6J("ngForOf",xe.groupedFields)("ngForTrackBy",xe.trackByName)}}const ye=function(Ne){return{resource:Ne}};function Pe(Ne,Ae){if(1&Ne&&T._UZ(0,"ndc-dynamic",38),2&Ne){const xe=T.oxw(2);T.Q6J("ndcDynamicComponent",xe.attachmentUploadComponent())("ndcDynamicInputs",T.VKq(2,ye,xe.workPackage))}}function Ee(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",47),T.TgZ(1,"div",48),T.TgZ(2,"div",43),T.TgZ(3,"div",44),T._UZ(4,"h3",45),T.qZA(),T.qZA(),T._UZ(5,"ndc-dynamic",38),T.YNc(6,Pe,1,4,"ndc-dynamic",49),T.qZA(),T.qZA()),2&Ne){const xe=T.oxw();T.xp6(4),T.Q6J("textContent",xe.text.attachments.label),T.xp6(1),T.Q6J("ndcDynamicComponent",xe.attachmentListComponent())("ndcDynamicInputs",T.VKq(4,ye,xe.workPackage)),T.xp6(1),T.Q6J("ngIf",xe.workPackage.canAddAttachments)}}const Qe=function(Ne){return{workPackageId:Ne,tabIdentifier:"files"}};function nt(Ne,Ae){if(1&Ne&&(T.TgZ(0,"div",50),T.TgZ(1,"div",51),T.TgZ(2,"div",43),T.TgZ(3,"div",44),T._UZ(4,"h3",45),T.qZA(),T.qZA(),T.TgZ(5,"div",52),T._UZ(6,"op-icon",53),T._UZ(7,"span",22),T._UZ(8,"a",54),T.qZA(),T.qZA(),T.qZA()),2&Ne){const xe=T.oxw();T.xp6(4),T.Q6J("textContent",xe.text.files.label),T.xp6(3),T.Q6J("textContent",xe.text.files.migration_help),T.xp6(1),T.Q6J("textContent",xe.text.files.label)("uiSref",xe.uiSelfRef)("uiParams",T.VKq(5,Qe,xe.workPackage.id))}}class lt extends O.N{constructor(Ae,xe,Ye,mt,Ot,Pt,Mt,yt,jt,Jt,Ft,It,gt,kt){super(),this.I18n=Ae,this.currentProject=xe,this.PathHelper=Ye,this.$state=mt,this.states=Ot,this.halEditing=Pt,this.halResourceService=Mt,this.displayFieldService=yt,this.schemaCache=jt,this.hook=Jt,this.injector=Ft,this.cdRef=It,this.elementRef=gt,this.browserDetector=kt,this.showProject=!1,this.groupedFields=[],this.resourceContextChange=new c.xQ,this.text={attachments:{label:this.I18n.t("js.label_attachments")},files:{label:this.I18n.t("js.work_packages.tabs.files"),migration_help:this.I18n.t("js.work_packages.tabs.files_tab_migration_help")},project:{required:this.I18n.t("js.project.required_outside_context"),context:this.I18n.t("js.project.context"),switchTo:this.I18n.t("js.project.click_to_switch_context")},fields:{description:this.I18n.t("js.work_packages.properties.description")},infoRow:{createdBy:this.I18n.t("js.label_created_by"),lastUpdatedOn:this.I18n.t("js.label_last_updated_on")}},this.firstTimeFocused=!1}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.isNewResource=(0,k.Z)(this.workPackage),this.uiSelfRef=this.$state.$current.name;const Ae=this.halEditing.changeFor(this.workPackage);this.resourceContextChange.next(this.contextFrom(Ae.projectedResource)),this.refresh(Ae),this.resourceContextChange.pipe(this.untilDestroyed(),(0,h.x)((xe,Ye)=>_.isEqual(xe,Ye)),(0,r.U)(()=>this.halEditing.changeFor(this.workPackage))).subscribe(xe=>this.refresh(xe)),this.halEditing.temporaryEditResource(this.workPackage).values$().pipe(this.untilDestroyed()).subscribe(xe=>{this.resourceContextChange.next(this.contextFrom(xe))})}refresh(Ae){const xe=(0,k.Z)(this.workPackage),Ye=Ae.projectedResource;Ye.project?this.projectContext={href:this.PathHelper.projectWorkPackagePath((0,u.Z)(Ye.project.href),this.workPackage.id),matches:Ye.project.href===this.currentProject.apiv3Path}:this.projectContext={matches:!1,href:null},xe&&!this.currentProject.inProjectContext&&(this.projectContext.field=this.getFields(Ae,["project"]));const mt=this.schema(Ye)._attributeGroups;this.groupedFields=this.rebuildGroupedFields(Ae,mt),this.cdRef.detectChanges()}shouldHideGroup(Ae){const xe=0===Ae.members.length,Ye=(0,k.Z)(this.workPackage)&&!!Ae.query;return xe||Ye}trackByName(Ae,xe){return xe.name}prependedAttributeGroupComponents(){return this.hook.call("prependedAttributeGroups",this.workPackage)}attributeGroupComponent(Ae){return this.hook.call("attributeGroupComponent",Ae,this.workPackage).pop()||null}attachmentListComponent(){return this.hook.call("workPackageAttachmentListComponent",this.workPackage).pop()||null}attachmentUploadComponent(){return this.hook.call("workPackageAttachmentUploadComponent",this.workPackage).pop()||null}get idLabel(){return`#${this.workPackage.id||""}`}get projectContextText(){const Ae=(0,u.Z)(this.workPackage.project.href),Ye=`<a href="${this.PathHelper.projectPath(Ae)}">${this.workPackage.project.name}<a>`;return this.I18n.t("js.project.work_package_belongs_to",{projectname:Ye})}showTwoColumnLayout(){return this.$element[0].getBoundingClientRect().width>750}rebuildGroupedFields(Ae,xe){return xe?xe.map(Ye=>{const mt=this.getAttributesGroupId(Ye);return"WorkPackageFormAttributeGroup"===Ye._type?{name:Ye.name,id:mt||(0,p.O)(16),members:this.getFields(Ae,Ye.attributes),type:Ye._type,isolated:!1}:{name:Ye.name,id:mt||(0,p.O)(16),query:this.halResourceService.createHalResourceOfClass(m.P,Ye._embedded.query),relationType:Ye.relationType,members:[Ye._embedded.query],type:Ye._type,isolated:!0}}):[]}getFields(Ae,xe){const Ye=[];return xe.forEach(mt=>{if("date"===mt)return void Ye.push(this.getDateField(Ae));if(!Ae.schema.ofProperty(mt))return void(0,E.qu)("Unknown field for current schema",mt);const Ot=this.displayField(Ae,mt);Ye.push({name:mt,label:Ot.label,multiple:!1,spanAll:Ot.isFormattable,field:Ot})}),Ye}getDateField(Ae){const xe={name:"",label:this.I18n.t("js.work_packages.properties.date"),spanAll:!1,multiple:!1};return Ae.schema.ofProperty("date")?(xe.field=this.displayField(Ae,"date"),xe.name="date"):(xe.field=this.displayField(Ae,"combinedDate"),xe.name="combinedDate"),xe}contextFrom(Ae){const xe=this.schema(Ae);let Ye;const mt=Ae.project&&Ae.project.href;return Ye=xe.baseSchema?xe.baseSchema.href:xe.href,{isNew:Ae.isNew,schema:Ye,project:mt}}displayField(Ae,xe){return this.displayFieldService.getField(Ae.projectedResource,xe,Ae.schema.ofProperty(xe),{container:"single-view",injector:this.injector,options:{}})}getAttributesGroupId(Ae){const xe=this.$element.find(`[data-group-name='${Ae.name}']`).data("overflowingIdentifier");return xe?xe.replace(".__overflowing_",""):""}schema(Ae){return this.halEditing.typedState(Ae).hasValue()?this.halEditing.typedState(this.workPackage).value.schema:this.schemaCache.of(Ae)}}lt.\u0275fac=function(Ae){return new(Ae||lt)(T.Y36(e.D),T.Y36(y.R),T.Y36(d.j),T.Y36(i.StateService),T.Y36(b.G),T.Y36(l.l),T.Y36(C.u),T.Y36(a.i),T.Y36(P.y),T.Y36(v.$),T.Y36(T.zs3),T.Y36(T.sBO),T.Y36(T.SBq),T.Y36(f.o))},lt.\u0275cmp=T.Xpm({type:lt,selectors:[["wp-single-view"]],inputs:{workPackage:"workPackage",showProject:"showProject"},features:[T.qOj],decls:3,vars:3,consts:[["class","work-package--single-view","data-selector","wp-single-view",3,"ngClass",4,"ngIf"],["class","work-packages--attachments attributes-group",4,"ngIf"],["class","work-packages--files attributes-group",4,"ngIf"],["data-selector","wp-single-view",1,"work-package--single-view",3,"ngClass"],["class","wp-new--subject-wrapper",4,"ngIf"],[1,"wp-info-wrapper"],[3,"workPackage",4,"ngIf"],[3,"attribute","attributeScope",4,"ngIf"],["class","work-packages--info-row",4,"ngIf"],[1,"custom-actions",3,"workPackage"],["class","attributes-group -project-context __overflowing_element_container __overflowing_project_context","data-overflowing-identifier",".__overflowing_project_context",4,"ngIf"],["class","attributes-group -project-context hide-when-print",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"attributes-group","description-group"],[1,"single-attribute","work-packages--details--description"],[3,"fieldName","resource","isDropTarget","wrapperClasses"],["class","attributes-group __overflowing_element_container",3,"hidden","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"wp-new--subject-wrapper"],[3,"resource","wrapperClasses","fieldName"],[3,"workPackage"],[3,"attribute","attributeScope"],[1,"work-packages--info-row"],[3,"textContent"],[1,"user-link",3,"user"],[3,"dateTimeValue"],["data-overflowing-identifier",".__overflowing_project_context",1,"attributes-group","-project-context","__overflowing_element_container","__overflowing_project_context"],[1,"wp-project-context--warning",3,"textContent"],["class","attributes-key-value",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"attributes-key-value",3,"ngClass"],[1,"attributes-key-value--key"],[3,"fieldName"],["class","required",4,"ngIf"],[1,"attributes-key-value--value-container"],[3,"resource","fieldName"],[1,"required"],[1,"attributes-group","-project-context","hide-when-print"],[3,"innerHTML"],[1,"project-context--switch-link",3,"textContent"],[3,"ndcDynamicComponent","ndcDynamicInputs"],[1,"attributes-group","__overflowing_element_container",3,"hidden","ngClass"],["wp-isolated-query-space","",4,"ngIf"],[4,"ngIf"],["wp-isolated-query-space",""],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],[3,"ndcDynamicComponent","ndcDynamicInjector","ndcDynamicInputs"],[1,"work-packages--attachments","attributes-group"],[1,"work-packages--attachments-container"],[3,"ndcDynamicComponent","ndcDynamicInputs",4,"ngIf"],[1,"work-packages--files","attributes-group"],[1,"work-packages--files-container"],[1,"attributes-group--icon-indented-text"],["icon-classes","icon-info1"],[3,"textContent","uiSref","uiParams"]],template:function(Ae,xe){1&Ae&&(T.YNc(0,_e,14,17,"div",0),T.YNc(1,Ee,7,6,"div",1),T.YNc(2,nt,9,7,"div",2)),2&Ae&&(T.Q6J("ngIf",xe.workPackage),T.xp6(1),T.Q6J("ngIf",xe.isNewResource),T.xp6(1),T.Q6J("ngIf",!xe.isNewResource))},directives:[M.O5,M.mk,V,M.sg,K.k,q.f,se.y,te.F,ie.F,le.L,oe.B5,oe.oc,ne.A,fe.o,ve.AnchorUISref,ve.UISref],encapsulation:2,changeDetection:0})},46669:(X,I,t)=>{"use strict";t.d(I,{x:()=>v});var i=t(47775),d=(t(24897),t(68197)),h=t(26942),r=t(61908),n=t(2316),l=t(54364),a=t(54262);function m(c,p){if(1&c&&(n.TgZ(0,"div",1),n.TgZ(1,"div",2),n._UZ(2,"op-editable-attribute-field",3),n.qZA(),n.TgZ(3,"div",4),n._UZ(4,"op-editable-attribute-field",3),n.qZA(),n.qZA()),2&c){const f=n.oxw();n.Q6J("ngClass","__overflowing_"+f.uniqueElementIdentifier),n.uIk("data-overflowing-identifier",".__overflowing_"+f.uniqueElementIdentifier),n.xp6(2),n.Q6J("resource",f.workPackage)("wrapperClasses","work-packages--type-selector work-packages--subject-element -no-label")("fieldName","type"),n.xp6(2),n.Q6J("resource",f.workPackage)("wrapperClasses","work-packages--details--subject work-packages--subject-element -no-label")("fieldName","subject")}}class v extends h.N{constructor(p,f){super(),this.uiRouterGlobals=p,this.apiV3Service=f,this.uniqueElementIdentifier=`work-packages--subject-type-row-${(0,d.O)(16)}`}ngOnInit(){this.workPackage||this.apiV3Service.work_packages.id(this.uiRouterGlobals.params.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(p=>{this.workPackage=p})}}v.\u0275fac=function(p){return new(p||v)(n.Y36(i.UIRouterGlobals),n.Y36(r.T))},v.\u0275cmp=n.Xpm({type:v,selectors:[["wp-subject"]],inputs:{workPackage:"workPackage"},features:[n.qOj],decls:1,vars:1,consts:[["class","work-packages--subject-type-row __overflowing_element_container",3,"ngClass",4,"ngIf"],[1,"work-packages--subject-type-row","__overflowing_element_container",3,"ngClass"],[1,"work-packages--type-selector","work-packages--subject-element"],[3,"resource","wrapperClasses","fieldName"],[1,"work-packages--details--subject","work-packages--subject-element"]],template:function(p,f){1&p&&n.YNc(0,m,5,8,"div",0),2&p&&n.Q6J("ngIf",f.workPackage)},directives:[l.O5,l.mk,a.k],encapsulation:2})},61736:(X,I,t)=>{"use strict";t.d(I,{M:()=>e});var i=t(40912);class e{constructor(h,r,n,l,a){this.availableTabs=h,this.outletElement=r,this.componentFactoryResolver=n,this.appRef=l,this.injector=a,this.activeTabs={},this.currentTab=null}get activeComponents(){return _.values(this.activeTabs).map(r=>r.componentRef.instance)}switchTo(h){if(void 0!==h.disable)return;this.detach();const r=this.activateInstance(h);this.outletElement.innerHTML="",this.outletElement.appendChild(this._getComponentRootNode(r.componentRef)),this.outletElement.dataset.tabName=h.name,this.currentTab=r}detach(){const h=this.currentTab;null!==h&&(h.portal.setAttachedHost(null),this.currentTab=null)}dispose(){_.each(this.activeTabs,h=>h.dispose()),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}activateInstance(h){return this.activeTabs[h.name]||(this.activeTabs[h.name]=this.createComponent(h)),this.activeTabs[h.name]||null}createComponent(h){const n=this.componentFactoryResolver.resolveComponentFactory(h.componentClass).create(this.injector),l=new i.C5(h.componentClass,null,this.injector);return this.appRef.attachView(n.hostView),Object.assign(Object.assign({},h),{portal:l,componentRef:n,dispose:()=>{this.appRef.detachView(n.hostView),n.destroy()}})}_getComponentRootNode(h){return h.hostView.rootNodes[0]}}},57119:(X,I,t)=>{"use strict";t.d(I,{c:()=>E,Q:()=>T});var i=t(2316),e=t(12877),d=t(71562),h=t(71444),r=t(61736),n=t(74478),l=t(43440),a=t(86469),m=t(96617),v=t(77355),c=t(60312),p=t(62964),f=t(61908),C=t(54364),u=t(32853),k=t(90590);const O=["tabContentOutlet"];function y(M,S){1&M&&i.GkF(0)}function b(M,S){if(1&M&&(i.ynx(0),i.YNc(1,y,1,0,"ng-container",12),i.BQk()),2&M){const R=i.oxw();i.xp6(1),i.Q6J("ngComponentOutlet",R.prependModalComponent)("ngComponentOutletInjector",R.injector)}}function P(M,S){if(1&M){const R=i.EpF();i.TgZ(0,"op-scrollable-tabs",13),i.NdJ("tabSelected",function(L){return i.CHM(R),i.oxw().switchTo(L)}),i.qZA()}if(2&M){const R=i.oxw();i.Q6J("tabs",R.availableTabs)("currentTabId",null==R.tabPortalHost.currentTab?null:R.tabPortalHost.currentTab.id)}}const E=new i.OlP("WpTableConfigurationModalPrependComponent");class T extends c.T{constructor(S,R,F,L,D,G,Q,V,K,q,se,te,ie,le,oe){super(S,ie,oe),this.locals=S,this.prependModalComponent=R,this.I18n=F,this.injector=L,this.appRef=D,this.componentFactoryResolver=G,this.loadingIndicator=Q,this.querySpace=V,this.wpStatesInitialization=K,this.apiV3Service=q,this.notificationService=se,this.wpTableColumns=te,this.cdRef=ie,this.ConfigurationService=le,this.elementRef=oe,this.closeOnEscape=!1,this.closeOnOutsideClick=!1,this.text={title:this.I18n.t("js.work_packages.table_configuration.modal_title"),closePopup:this.I18n.t("js.close_popup_title"),columnsLabel:this.I18n.t("js.label_columns"),selectedColumns:this.I18n.t("js.description_selected_columns"),multiSelectLabel:this.I18n.t("js.work_packages.label_column_multiselect"),applyButton:this.I18n.t("js.modals.button_apply"),cancelButton:this.I18n.t("js.modals.button_cancel"),upsaleRelationColumns:this.I18n.t("js.modals.upsale_relation_columns"),upsaleRelationColumnsLink:this.I18n.t("js.modals.upsale_relation_columns_link")},this.onDataUpdated=new i.vpe,this.selectedColumnMap={},this.wpTableConfigurationService=this.injector.get(h.p,new h.p(this.I18n))}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.tabPortalHost=new r.M(this.wpTableConfigurationService.tabs,this.tabContentOutlet.nativeElement,this.componentFactoryResolver,this.appRef,this.injector),this.loadingIndicator.indicator("modal").promise=this.loadForm().then(()=>{const S=this.locals.initialTab,R=this.availableTabs.find(F=>F.id===S);this.switchTo(R||this.availableTabs[0])})}ngOnDestroy(){this.onDataUpdated.complete(),this.tabPortalHost.dispose()}get availableTabs(){return this.tabPortalHost.availableTabs}get currentTab(){return this.tabPortalHost.currentTab}switchTo(S){this.tabPortalHost.switchTo(S)}saveChanges(){this.tabPortalHost.activeComponents.forEach(S=>{S.onSave()}),this.onDataUpdated.emit(),this.service.close()}onClose(){return this.afterFocusOn.focus(),!0}get afterFocusOn(){return this.$element}loadForm(){const S=this.querySpace.query.value;return this.apiV3Service.queries.form.load(S).toPromise().then(([R,F])=>(this.wpStatesInitialization.updateStatesFromForm(S,R),R)).catch(R=>this.notificationService.handleRawError(R))}}T.\u0275fac=function(S){return new(S||T)(i.Y36(v.E),i.Y36(E,8),i.Y36(m.D),i.Y36(i.zs3),i.Y36(i.z2F),i.Y36(i._Vd),i.Y36(a.vt),i.Y36(l.q),i.Y36(n.f),i.Y36(f.T),i.Y36(p.q),i.Y36(d.i),i.Y36(i.sBO),i.Y36(e.e),i.Y36(i.SBq))},T.\u0275cmp=i.Xpm({type:T,selectors:[["ng-component"]],viewQuery:function(S,R){if(1&S&&i.Gf(O,7),2&S){let F;i.iGM(F=i.CRH())&&(R.tabContentOutlet=F.first)}},features:[i.qOj],decls:13,vars:5,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_wide","wp-table--configuration-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[4,"ngIf"],[3,"tabs","currentTabId","tabSelected",4,"ngIf"],[1,"tab-content"],["tabContentOutlet",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","spot-modal-wp-table-configuration-save-button",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"tabs","currentTabId","tabSelected"]],template:function(S,R){1&S&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i._uU(2),i.qZA(),i._UZ(3,"div",2),i.TgZ(4,"div",3),i.YNc(5,b,2,2,"ng-container",4),i.YNc(6,P,1,2,"op-scrollable-tabs",5),i._UZ(7,"div",6,7),i.qZA(),i.TgZ(9,"div",8),i.TgZ(10,"div",9),i.TgZ(11,"button",10),i.NdJ("click",function(L){return R.closeMe(L)}),i.qZA(),i.TgZ(12,"button",11),i.NdJ("click",function(){return R.saveChanges()}),i.qZA(),i.qZA(),i.qZA(),i.qZA()),2&S&&(i.xp6(2),i.Oqu(R.text.title),i.xp6(3),i.Q6J("ngIf",!!R.prependModalComponent),i.xp6(1),i.Q6J("ngIf",R.tabPortalHost),i.xp6(5),i.Q6J("textContent",R.text.cancelButton),i.xp6(1),i.Q6J("textContent",R.text.applyButton))},directives:[C.O5,C.$G,u.dw,k.P],encapsulation:2})},71444:(X,I,t)=>{"use strict";t.d(I,{p:()=>J});var i=t(96617),e=t(61083),d=t(99676),h=t(82271),r=t(2316),n=t(1707),l=t(2775),a=t(54364);function m(W,Y){if(1&W&&r._UZ(0,"span",6),2&W){const $=r.oxw();r.Q6J("textContent",$.text.display_mode.hierarchy_hint)}}function v(W,Y){if(1&W&&r._UZ(0,"option",15),2&W){const $=Y.$implicit,be=r.oxw();r.Q6J("textContent",$.name)("selected",be.currentGroup&&be.currentGroup.href===$.href)("value",$.href)}}class c{constructor(Y,$,be,N,Ue){this.injector=Y,this.I18n=$,this.wpTableGroupBy=be,this.wpTableHierarchies=N,this.wpTableSums=Ue,this.displayMode="default",this.availableGroups=[],this.displaySums=!1,this.text={choose_mode:this.I18n.t("js.work_packages.table_configuration.choose_display_mode"),label_group_by:this.I18n.t("js.label_group_by"),title:this.I18n.t("js.label_group_by"),placeholder:this.I18n.t("js.placeholders.default"),please_select:this.I18n.t("js.placeholders.selection"),default:`\u2014 ${this.I18n.t("js.work_packages.table_configuration.default")}`,display_sums:this.I18n.t("js.work_packages.query.display_sums"),display_sums_hint:`\u2014 ${this.I18n.t("js.work_packages.table_configuration.display_sums_hint")}`,display_mode:{default:this.I18n.t("js.work_packages.table_configuration.default_mode"),grouped:this.I18n.t("js.work_packages.table_configuration.grouped_mode"),hierarchy:this.I18n.t("js.work_packages.table_configuration.hierarchy_mode"),hierarchy_hint:`\u2014 ${this.I18n.t("js.work_packages.table_configuration.hierarchy_hint")}`}}}onSave(){this.wpTableHierarchies.setEnabled("hierarchy"===this.displayMode);const Y="grouped"===this.displayMode?this.currentGroup:null;this.wpTableGroupBy.update(Y),this.wpTableSums.setEnabled(this.displaySums)}updateGroup(Y){this.displayMode="grouped",this.currentGroup=_.find(this.availableGroups,$=>$.href===Y)||null}ngOnInit(){this.wpTableHierarchies.isEnabled?this.displayMode="hierarchy":this.wpTableGroupBy.current&&(this.displayMode="grouped"),this.displaySums=this.wpTableSums.current,this.wpTableGroupBy.onReady().then(()=>{this.availableGroups=_.sortBy(this.wpTableGroupBy.available,"name"),this.currentGroup=this.wpTableGroupBy.current})}}c.\u0275fac=function(Y){return new(Y||c)(r.Y36(r.zs3),r.Y36(i.D),r.Y36(e.w),r.Y36(d.Y),r.Y36(h.X))},c.\u0275cmp=r.Xpm({type:c,selectors:[["ng-component"]],decls:39,vars:16,consts:[[3,"textContent"],[1,"form--field","-full-width"],[1,"form--field-container"],[1,"option-label"],["type","radio","value","default","name","display_mode_switch",3,"ngModel","ngModelChange"],["icon-classes","icon-no-hierarchy"],[1,"form--inline-instructions",3,"textContent"],["type","radio","value","hierarchy","name","display_mode_switch",3,"ngModel","ngModelChange"],["icon-classes","icon-hierarchy"],["class","form--inline-instructions",3,"textContent",4,"ngIf"],["type","radio","value","grouped","name","display_mode_switch",3,"ngModel","ngModelChange"],["icon-classes","icon-group-by"],["id","selected_grouping","name","selected_grouping",1,"form--select","form--inline-select",3,"change"],[3,"textContent","selected","value",4,"ngFor","ngForOf"],["type","checkbox","name","display_sums_switch",3,"checked","change"],[3,"textContent","selected","value"]],template:function(Y,$){1&Y&&(r.TgZ(0,"div"),r.TgZ(1,"form"),r._UZ(2,"p",0),r.TgZ(3,"div",1),r.TgZ(4,"div",2),r.TgZ(5,"label",3),r.TgZ(6,"input",4),r.NdJ("ngModelChange",function(N){return $.displayMode=N}),r.qZA(),r._UZ(7,"op-icon",5),r._uU(8," "),r._UZ(9,"span",0),r._uU(10," "),r._UZ(11,"span",6),r.qZA(),r.qZA(),r.qZA(),r.TgZ(12,"div",1),r.TgZ(13,"div",2),r.TgZ(14,"label",3),r.TgZ(15,"input",7),r.NdJ("ngModelChange",function(N){return $.displayMode=N}),r.qZA(),r._UZ(16,"op-icon",8),r._uU(17," "),r._UZ(18,"span",0),r._uU(19," "),r.YNc(20,m,1,1,"span",9),r.qZA(),r.qZA(),r.qZA(),r.TgZ(21,"div",1),r.TgZ(22,"div",2),r.TgZ(23,"label",3),r.TgZ(24,"input",10),r.NdJ("ngModelChange",function(N){return $.displayMode=N}),r.qZA(),r._UZ(25,"op-icon",11),r._uU(26," "),r._UZ(27,"span",0),r._uU(28," "),r.TgZ(29,"select",12),r.NdJ("change",function(N){return $.updateGroup(N.target.value)}),r.YNc(30,v,1,3,"option",13),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r._UZ(31,"hr"),r.TgZ(32,"div"),r.TgZ(33,"div",1),r.TgZ(34,"div",2),r.TgZ(35,"label",3),r.TgZ(36,"input",14),r.NdJ("change",function(){return $.displaySums=!$.displaySums}),r.qZA(),r._uU(37),r._UZ(38,"span",6),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&Y&&(r.xp6(2),r.Q6J("textContent",$.text.choose_mode),r.xp6(4),r.Q6J("ngModel",$.displayMode),r.xp6(1),r.uIk("icon-title",$.text.display_mode.default),r.xp6(2),r.Q6J("textContent",$.text.display_mode.default),r.xp6(2),r.Q6J("textContent",$.text.default),r.xp6(4),r.Q6J("ngModel",$.displayMode),r.xp6(1),r.uIk("icon-title",$.text.display_mode.hierarchy),r.xp6(2),r.Q6J("textContent",$.text.display_mode.hierarchy),r.xp6(2),r.Q6J("ngIf","hierarchy"===$.displayMode),r.xp6(4),r.Q6J("ngModel",$.displayMode),r.xp6(1),r.uIk("icon-title",$.text.label_group_by),r.xp6(2),r.Q6J("textContent",$.text.label_group_by),r.xp6(3),r.Q6J("ngForOf",$.availableGroups),r.xp6(6),r.Q6J("checked",$.displaySums),r.xp6(1),r.hij(" ",$.text.display_sums," "),r.xp6(1),r.Q6J("textContent",$.text.display_sums_hint))},directives:[n._Y,n.JL,n.F,n._,n.Fj,n.JJ,n.On,l.o,a.O5,a.sg,n.YN,n.Kr],encapsulation:2});var p=t(12877),f=t(71562),C=t(73881),u=t(27779),k=t(29212),O=t(8158);function y(W,Y){if(1&W&&r._UZ(0,"op-enterprise-banner",5),2&W){const $=r.oxw();r.Q6J("linkMessage",$.text.upsaleCheckOutLink)("textMessage",$.text.upsaleRelationColumns)("moreInfoLink",$.text.moreInfoLink)}}class b{constructor(Y,$,be,N,Ue){this.injector=Y,this.I18n=$,this.wpTableColumns=be,this.ConfigurationService=N,this.bannerService=Ue,this.availableColumnsOptions=this.wpTableColumns.all.map(et=>this.column2Like(et)),this.availableColumns=this.wpTableColumns.all,this.availableColumnsMap=_.keyBy(this.availableColumns,et=>et.id),this.selectedColumns=this.wpTableColumns.getColumns().map(et=>this.column2Like(et)),this.selectedColumnMap={},this.eeShowBanners=!1,this.text={columnsHelp:this.I18n.t("js.work_packages.table_configuration.columns_help_text"),columnsLabel:this.I18n.t("js.label_columns"),selectedColumns:this.I18n.t("js.description_selected_columns"),multiSelectLabel:this.I18n.t("js.work_packages.label_column_multiselect"),upsaleRelationColumns:this.I18n.t("js.work_packages.table_configuration.upsale.relation_columns"),upsaleCheckOutLink:this.I18n.t("js.work_packages.table_configuration.upsale.check_out_link"),moreInfoLink:u.rj.website}}onSave(){this.wpTableColumns.setColumnsById(this.selectedColumns.map(Y=>Y.id))}ngOnInit(){this.eeShowBanners=this.bannerService.eeShowBanners,this.selectedColumns.forEach(Y=>{this.selectedColumnMap[Y.id]=!0})}column2Like(Y){return{id:Y.id,name:Y.name}}updateSelected(Y){this.selectedColumns=Y}}b.\u0275fac=function(Y){return new(Y||b)(r.Y36(r.zs3),r.Y36(i.D),r.Y36(f.i),r.Y36(p.e),r.Y36(C.j))},b.\u0275cmp=r.Xpm({type:b,selectors:[["ng-component"]],decls:5,vars:5,consts:[[1,"columns-modal--content"],[1,"hidden-for-sighted",3,"textContent"],[3,"options","selected","onChange"],[1,"form--inline-instructions",3,"textContent"],["class","ee-relation-columns-upsale","opReferrer","wp-list-columns#relations",3,"linkMessage","textMessage","moreInfoLink",4,"ngIf"],["opReferrer","wp-list-columns#relations",1,"ee-relation-columns-upsale",3,"linkMessage","textMessage","moreInfoLink"]],template:function(Y,$){1&Y&&(r.TgZ(0,"div",0),r._UZ(1,"label",1),r.TgZ(2,"draggable-autocompleter",2),r.NdJ("onChange",function(N){return $.updateSelected(N)}),r.qZA(),r._UZ(3,"p",3),r.qZA(),r.YNc(4,y,1,3,"op-enterprise-banner",4)),2&Y&&(r.xp6(1),r.Q6J("textContent",$.text.selectedColumns),r.xp6(1),r.Q6J("options",$.availableColumnsOptions)("selected",$.selectedColumns),r.xp6(1),r.Q6J("textContent",$.text.columnsHelp),r.xp6(1),r.Q6J("ngIf",$.eeShowBanners))},directives:[k.i,a.O5,O.P],encapsulation:2});var P=t(78434),E=t(74647),T=t(32557);function M(W,Y){if(1&W){const $=r.EpF();r.TgZ(0,"op-query-filters",1),r.NdJ("filtersChanged",function(N){r.CHM($);return r.oxw().filters=N}),r.qZA()}if(2&W){const $=r.oxw();r.Q6J("filters",$.filters)}}class S{constructor(Y,$,be,N,Ue){this.injector=Y,this.I18n=$,this.wpTableFilters=be,this.wpFiltersService=N,this.bannerService=Ue,this.filters=[],this.eeShowBanners=!1,this.text={columnsLabel:this.I18n.t("js.label_columns"),selectedColumns:this.I18n.t("js.description_selected_columns"),multiSelectLabel:this.I18n.t("js.work_packages.label_column_multiselect"),upsaleRelationColumns:this.I18n.t("js.modals.upsale_relation_columns"),upsaleRelationColumnsLink:this.I18n.t("js.modals.upsale_relation_columns_link")}}ngOnInit(){this.eeShowBanners=this.bannerService.eeShowBanners,this.wpTableFilters.onReady().then(()=>this.filters=this.wpTableFilters.current),this.wpTableFilters.changes$().subscribe(Y=>{this.filters=this.wpTableFilters.current})}onSave(){this.filters&&this.wpTableFilters.replaceIfComplete(this.filters)}}S.\u0275fac=function(Y){return new(Y||S)(r.Y36(r.zs3),r.Y36(i.D),r.Y36(E.Z),r.Y36(P.U),r.Y36(C.j))},S.\u0275cmp=r.Xpm({type:S,selectors:[["wp-table-config-filters-tab"]],decls:1,vars:1,consts:[[3,"filters","filtersChanged",4,"ngIf"],[3,"filters","filtersChanged"]],template:function(Y,$){1&Y&&r.YNc(0,M,1,1,"op-query-filters",0),2&Y&&r.Q6J("ngIf",!!$.filters)},directives:[a.O5,T.H],encapsulation:2});var R=t(82763),F=t(15893);function L(W,Y){if(1&W&&r._UZ(0,"option",18),2&W){const $=r.oxw().$implicit;r.Q6J("textContent",$.column.name)("value",$.column.href)}}function D(W,Y){if(1&W&&r._UZ(0,"option",19),2&W){const $=Y.$implicit;r.Q6J("textContent",$.name)("value",$.href)}}function G(W,Y){if(1&W){const $=r.EpF();r.TgZ(0,"label",5),r.TgZ(1,"input",20),r.NdJ("ngModelChange",function(N){r.CHM($);return r.oxw().$implicit.direction=N}),r.qZA(),r._uU(2),r.qZA()}if(2&W){const $=Y.$implicit,be=r.oxw(),N=be.index,Ue=be.$implicit;r.xp6(1),r.MGl("name","modal-sorting-attribute-",N,"--sort-direction"),r.Q6J("ngModel",Ue.direction)("value",$.href)("textContent",$.name),r.xp6(1),r.hij(" ",$.name," ")}}function Q(W,Y){if(1&W){const $=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"div",3),r._UZ(2,"label",11),r.TgZ(3,"div",4),r.TgZ(4,"div",12),r.TgZ(5,"select",13),r.NdJ("change",function(N){const et=r.CHM($).$implicit;return r.oxw(2).updateSelection(et,N.target.value)}),r.YNc(6,L,1,2,"option",14),r._UZ(7,"option",15),r.YNc(8,D,1,2,"option",16),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"div",3),r.TgZ(10,"div",4),r.YNc(11,G,3,5,"label",17),r.qZA(),r.qZA(),r.qZA()}if(2&W){const $=Y.$implicit,be=Y.index,N=r.oxw(2);r.Gre("form--row modal-sorting-row-",be,""),r.xp6(2),r.MGl("for","modal-sorting-attribute-",be,""),r.Q6J("textContent",N.text["sort_criteria_"+be]),r.xp6(3),r.MGl("id","modal-sorting-attribute-",be,""),r.MGl("name","modal-sorting-attribute-",be,""),r.xp6(1),r.Q6J("ngIf",!!$.column.href),r.xp6(1),r.Q6J("textContent",N.emptyColumn.name)("value",N.emptyColumn.href)("selected",!$.column.href),r.xp6(1),r.Q6J("ngForOf",N.availableColumns),r.xp6(3),r.Q6J("ngForOf",N.availableDirections)}}function V(W,Y){if(1&W&&(r.ynx(0),r.YNc(1,Q,12,13,"div",10),r.BQk()),2&W){const $=r.oxw();r.xp6(1),r.Q6J("ngForOf",$.sortationObjects)}}class K{constructor(Y,$){this.column=Y,this.direction=$}}class q{constructor(Y,$,be){this.injector=Y,this.I18n=$,this.wpTableSortBy=be,this.text={title:this.I18n.t("js.label_sort_by"),placeholder:this.I18n.t("js.placeholders.default"),sort_criteria_1:this.I18n.t("js.filter.sorting.criteria.one"),sort_criteria_2:this.I18n.t("js.filter.sorting.criteria.two"),sort_criteria_3:this.I18n.t("js.filter.sorting.criteria.three"),sorting_mode:{description:this.I18n.t("js.work_packages.table_configuration.sorting_mode.description"),automatic:this.I18n.t("js.work_packages.table_configuration.sorting_mode.automatic"),manually:this.I18n.t("js.work_packages.table_configuration.sorting_mode.manually"),warning:this.I18n.t("js.work_packages.table_configuration.sorting_mode.warning")}},this.availableDirections=[{href:F.S9,name:this.I18n.t("js.label_ascending")},{href:F.iV,name:this.I18n.t("js.label_descending")}],this.availableColumns=[],this.allColumns=[],this.sortationObjects=[],this.emptyColumn={name:this.text.placeholder,href:null},this.sortingMode="automatic"}onSave(){let Y;Y="automatic"===this.sortingMode?this.sortationObjects.filter($=>null!==$.column):[new K(this.manualSortColumn,F.S9)],Y=Y.map($=>this.getMatchingSort($.column.href,$.direction)),this.wpTableSortBy.update(_.compact(Y))}ngOnInit(){this.wpTableSortBy.onReadyWithAvailable().subscribe(()=>{const Y=this.wpTableSortBy.available.filter($=>!$.column.href.endsWith("/parent")).map($=>({name:$.column.name,href:$.column.href}));this.allColumns=_.uniqBy(Y,"href"),this.getManualSortingOption(),_.each(this.wpTableSortBy.current,$=>{$.column.href.endsWith("/parent")||(this.sortationObjects.push(new K({name:$.column.name,href:$.column.href},$.direction.href)),$.column.href===this.manualSortColumn.href&&this.updateSortingMode("manual"))}),this.updateUsedColumns(),this.fillUpSortElements()})}updateSelection(Y,$){Y.column=_.find(this.allColumns,be=>be.href===$)||this.emptyColumn,this.updateUsedColumns()}updateUsedColumns(){const Y=this.sortationObjects.filter($=>null!==$.column).map($=>$.column);this.availableColumns=_.sortBy(_.differenceBy(this.allColumns,Y,"href"),"name")}updateSortingMode(Y){this.sortingMode=Y}getMatchingSort(Y,$){return _.find(this.wpTableSortBy.available,be=>be.column.href===Y&&be.direction.href===$)}fillUpSortElements(){for(;this.sortationObjects.length<3;)this.sortationObjects.push(new K(this.emptyColumn,F.S9))}getManualSortingOption(){this.manualSortColumn=this.allColumns.find(Y=>Y.href.endsWith("/manualSorting")),this.allColumns.splice(this.allColumns.indexOf(this.manualSortColumn),1)}}q.\u0275fac=function(Y){return new(Y||q)(r.Y36(r.zs3),r.Y36(i.D),r.Y36(R.q))},q.\u0275cmp=r.Xpm({type:q,selectors:[["ng-component"]],decls:16,vars:7,consts:[["name","modalSortingForm"],["id","modal-sorting","data-indicator-name","sorting-modal",1,"modal-content-container","loading-indicator--location"],[3,"textContent"],[1,"form--field","-full-width"],[1,"form--field-container"],[1,"option-label"],["type","radio","name","sorting_mode_switch","value","manual",3,"ngModel","ngModelChange","change"],["type","radio","name","sorting_mode_switch","value","automatic",3,"ngModel","ngModelChange","change"],[1,"form--field-instructions"],[4,"ngIf"],[3,"class",4,"ngFor","ngForOf"],[1,"form--label","hidden-for-sighted",3,"for","textContent"],[1,"form--select-container"],[1,"form--select",3,"id","name","change"],["selected","",3,"textContent","value",4,"ngIf"],[3,"textContent","value","selected"],[3,"textContent","value",4,"ngFor","ngForOf"],["class","option-label",4,"ngFor","ngForOf"],["selected","",3,"textContent","value"],[3,"textContent","value"],["type","radio",3,"ngModel","value","textContent","name","ngModelChange"]],template:function(Y,$){1&Y&&(r.TgZ(0,"form",0),r.TgZ(1,"div",1),r._UZ(2,"p",2),r.TgZ(3,"div",3),r.TgZ(4,"div",4),r.TgZ(5,"label",5),r.TgZ(6,"input",6),r.NdJ("ngModelChange",function(N){return $.sortingMode=N})("change",function(N){return $.updateSortingMode(N.target.value)}),r.qZA(),r._uU(7),r.qZA(),r.qZA(),r.qZA(),r.TgZ(8,"div",3),r.TgZ(9,"div",4),r.TgZ(10,"label",5),r.TgZ(11,"input",7),r.NdJ("ngModelChange",function(N){return $.sortingMode=N})("change",function(N){return $.updateSortingMode(N.target.value)}),r.qZA(),r._uU(12),r.qZA(),r.qZA(),r.TgZ(13,"div",8),r._uU(14),r.qZA(),r.qZA(),r.YNc(15,V,2,1,"ng-container",9),r.qZA(),r.qZA()),2&Y&&(r.xp6(2),r.Q6J("textContent",$.text.sorting_mode.description),r.xp6(4),r.Q6J("ngModel",$.sortingMode),r.xp6(1),r.hij(" ",$.text.sorting_mode.manually," "),r.xp6(4),r.Q6J("ngModel",$.sortingMode),r.xp6(1),r.hij(" ",$.text.sorting_mode.automatic," "),r.xp6(2),r.hij(" ",$.text.sorting_mode.warning," "),r.xp6(1),r.Q6J("ngIf","automatic"===$.sortingMode))},directives:[n._Y,n.JL,n.F,n._,n.Fj,n.JJ,n.On,a.O5,a.sg,n.YN,n.Kr],encapsulation:2});var se=t(73165),te=t(42529);function ie(W,Y){if(1&W&&r._UZ(0,"option",15),2&W){const $=Y.$implicit,be=r.oxw(2);r.Q6J("textContent",be.text.zoom[$])("value",$)("selected",be.zoomLevel===$)}}function le(W,Y){if(1&W&&r._UZ(0,"option",15),2&W){const $=Y.$implicit,be=r.oxw().$implicit,N=r.oxw(2);r.Q6J("textContent",$.name)("value",$.id)("selected",N.labels[be]===$.id)}}function oe(W,Y){if(1&W){const $=r.EpF();r.TgZ(0,"div",16),r.TgZ(1,"div",1),r.TgZ(2,"label",17),r._uU(3),r.qZA(),r.TgZ(4,"div",3),r.TgZ(5,"div",18),r.TgZ(6,"select",19),r.NdJ("change",function(N){const et=r.CHM($).$implicit;return r.oxw(2).updateLabels(et,N.target.value)}),r.YNc(7,le,1,3,"option",13),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&W){const $=Y.$implicit,be=r.oxw(2);r.xp6(2),r.MGl("for","modal-timelines-label-",$,""),r.xp6(1),r.hij(" ",be.text.labels[$]," "),r.xp6(3),r.MGl("id","modal-timelines-label-",$,""),r.xp6(1),r.Q6J("ngForOf",be.availableAttributes)}}function ne(W,Y){if(1&W){const $=r.EpF();r.ynx(0),r.TgZ(1,"fieldset",8),r._UZ(2,"legend",9),r._UZ(3,"p",10),r.TgZ(4,"div",1),r.TgZ(5,"div",3),r.TgZ(6,"div",11),r.TgZ(7,"select",12),r.NdJ("change",function(N){r.CHM($);return r.oxw().zoomLevel=N.target.value}),r.YNc(8,ie,1,3,"option",13),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(9,"fieldset",8),r._UZ(10,"legend",9),r._UZ(11,"p",10),r.YNc(12,oe,8,4,"div",14),r.qZA(),r.BQk()}if(2&W){const $=r.oxw();r.xp6(2),r.Q6J("textContent",$.text.zoom.level),r.xp6(1),r.Q6J("textContent",$.text.zoom.description),r.xp6(4),r.uIk("disabled",!0===$.autoZoom?"disabled":void 0),r.xp6(1),r.Q6J("ngForOf",$.availableZoomLevels),r.xp6(2),r.Q6J("textContent",$.text.labels.title),r.xp6(1),r.Q6J("textContent",$.text.labels.description),r.xp6(1),r.Q6J("ngForOf",$.availableLabels)}}class fe{constructor(Y,$,be,N){this.injector=Y,this.I18n=$,this.wpTableTimeline=be,this.wpTableColumns=N,this.timelineVisible=!1,this.availableZoomLevels=["auto",...te.$r],this.text={title:this.I18n.t("js.timelines.gantt_chart"),display_timelines:this.I18n.t("js.timelines.button_activate"),display_timelines_hint:this.I18n.t("js.work_packages.table_configuration.show_timeline_hint"),zoom:{level:this.I18n.t("js.tl_toolbar.zooms"),description:this.I18n.t("js.timelines.zoom.description"),days:this.I18n.t("js.timelines.zoom.days"),weeks:this.I18n.t("js.timelines.zoom.weeks"),months:this.I18n.t("js.timelines.zoom.months"),quarters:this.I18n.t("js.timelines.zoom.quarters"),years:this.I18n.t("js.timelines.zoom.years"),auto:this.I18n.t("js.timelines.zoom.auto")},labels:{title:this.I18n.t("js.timelines.labels.title"),description:this.I18n.t("js.timelines.labels.description"),bar:this.I18n.t("js.timelines.labels.bar"),none:this.I18n.t("js.timelines.filter.noneSelection"),left:this.I18n.t("js.timelines.labels.left"),right:this.I18n.t("js.timelines.labels.right"),farRight:this.I18n.t("js.timelines.labels.farRight")}}}onSave(){this.wpTableTimeline.update(Object.assign(Object.assign({},this.wpTableTimeline.current),{visible:this.timelineVisible,labels:this.labels,zoomLevel:this.zoomLevel}))}updateLabels(Y,$){""===$&&($=null),this.labels[Y]=$}ngOnInit(){this.timelineVisible=this.wpTableTimeline.isVisible,this.zoomLevel=this.wpTableTimeline.zoomLevel;const{labels:Y}=this.wpTableTimeline;this.labels=_.clone(Y),this.availableLabels=Object.keys(this.labels);const $=this.wpTableColumns.allPropertyColumns.sort((be,N)=>be.name.localeCompare(N.name));this.availableAttributes=[{id:"",name:this.text.labels.none}].concat($)}}fe.\u0275fac=function(Y){return new(Y||fe)(r.Y36(r.zs3),r.Y36(i.D),r.Y36(se.W),r.Y36(f.i))},fe.\u0275cmp=r.Xpm({type:fe,selectors:[["ng-component"]],decls:9,vars:4,consts:[[1,"form"],[1,"form--field"],["for","display_timelines_switch",1,"form--label",3,"textContent"],[1,"form--field-container"],[1,"form--check-box-container"],["type","checkbox","id","display_timelines_switch","name","display_timelines_switch",3,"checked","change"],[1,"form--field-instructions",3,"textContent"],[4,"ngIf"],[1,"form--fieldset"],[1,"form--fieldset-legend",3,"textContent"],[3,"textContent"],[1,"form--text-select-container","-slim"],["id","modal-timelines-zoomlevel",1,"form--select",3,"change"],[3,"textContent","value","selected",4,"ngFor","ngForOf"],["class","form--row",4,"ngFor","ngForOf"],[3,"textContent","value","selected"],[1,"form--row"],[1,"form--label",3,"for"],[1,"form--select-container"],[1,"form--select",3,"id","change"]],template:function(Y,$){1&Y&&(r.TgZ(0,"div"),r.TgZ(1,"form",0),r.TgZ(2,"div",1),r._UZ(3,"label",2),r.TgZ(4,"div",3),r.TgZ(5,"div",4),r.TgZ(6,"input",5),r.NdJ("change",function(){return $.timelineVisible=!$.timelineVisible}),r.qZA(),r.qZA(),r.qZA(),r._UZ(7,"p",6),r.qZA(),r.YNc(8,ne,13,7,"ng-container",7),r.qZA(),r.qZA()),2&Y&&(r.xp6(3),r.Q6J("textContent",$.text.display_timelines),r.xp6(3),r.Q6J("checked",$.timelineVisible),r.xp6(1),r.Q6J("textContent",$.text.display_timelines_hint),r.xp6(1),r.Q6J("ngIf",$.timelineVisible))},directives:[n._Y,n.JL,n.F,a.O5,a.sg,n.YN,n.Kr],encapsulation:2});var ve=t(84897),Se=t(43440),Oe=t(87853),je=t(36868);const tt=["highlightedAttributesNgSelect"],He=["rowHighlightNgSelect"];function st(W,Y){if(1&W&&r._UZ(0,"op-enterprise-banner",2),2&W){const $=r.oxw();r.Q6J("linkMessage",$.text.upsaleCheckOutLink)("textMessage",$.text.upsaleAttributeHighlighting)("moreInfoLink",$.text.more_info_link)}}function Me(W,Y){if(1&W){const $=r.EpF();r.TgZ(0,"form"),r._UZ(1,"p",3),r.TgZ(2,"div",4),r.TgZ(3,"label",5),r.TgZ(4,"input",6),r.NdJ("ngModelChange",function(N){r.CHM($);return r.oxw().highlightingMode=N})("change",function(N){return r.CHM($),r.oxw().updateMode(N.target.value)}),r.qZA(),r._UZ(5,"span",3),r._uU(6,"\xa0 "),r.qZA(),r.TgZ(7,"div",7),r.TgZ(8,"div",8),r.TgZ(9,"ng-select",9,10),r.NdJ("ngModelChange",function(N){r.CHM($);return r.oxw().selectedAttributes=N})("open",function(){r.CHM($);const N=r.MAs(10);return r.oxw().onOpen(N)})("change",function(N){return r.CHM($),r.oxw().updateHighlightingAttributes(N)}),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(11,"div",4),r.TgZ(12,"label",5),r.TgZ(13,"input",11),r.NdJ("ngModelChange",function(N){r.CHM($);return r.oxw().entireRowMode=N})("change",function(){return r.CHM($),r.oxw().updateMode("entire-row")}),r.qZA(),r._UZ(14,"span",3),r.qZA(),r.TgZ(15,"div",7),r.TgZ(16,"div",8),r.TgZ(17,"ng-select",12,13),r.NdJ("ngModelChange",function(N){r.CHM($);return r.oxw().lastEntireRowAttribute=N})("open",function(){r.CHM($);const N=r.MAs(18);return r.oxw().onOpen(N)})("change",function(N){return r.CHM($),r.oxw().updateMode(N.value)}),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(19,"div",4),r.TgZ(20,"label",5),r.TgZ(21,"input",14),r.NdJ("ngModelChange",function(N){r.CHM($);return r.oxw().highlightingMode=N})("change",function(N){return r.CHM($),r.oxw().updateMode(N.target.value)}),r.qZA(),r._UZ(22,"span",3),r.qZA(),r.qZA(),r.qZA()}if(2&W){const $=r.oxw();r.xp6(1),r.Q6J("textContent",$.text.highlighting_mode.description),r.xp6(3),r.Q6J("ngModel",$.highlightingMode),r.uIk("disabled",$.disabledValue($.eeShowBanners)),r.xp6(1),r.Q6J("textContent",$.text.highlighting_mode.inline),r.xp6(4),r.Q6J("items",$.availableInlineHighlightedAttributes)("ngModel",$.selectedAttributes)("multiple",!0)("disabled","inline"!==$.highlightingMode)("clearable",!1)("closeOnSelect",!1),r.xp6(4),r.Q6J("ngModel",$.entireRowMode)("value",!0),r.uIk("disabled",$.disabledValue($.eeShowBanners)),r.xp6(1),r.Q6J("textContent",$.text.highlighting_mode.entire_row_by),r.xp6(3),r.Q6J("items",$.availableRowHighlightedAttributes)("ngModel",$.lastEntireRowAttribute)("disabled",$.disabledValue($.eeShowBanners))("clearable",!1),r.xp6(4),r.Q6J("ngModel",$.highlightingMode),r.uIk("disabled",$.disabledValue($.eeShowBanners)),r.xp6(1),r.Q6J("textContent",$.text.highlighting_mode.none)}}class ce{constructor(Y,$,be,N,Ue,et){this.injector=Y,this.I18n=$,this.states=be,this.querySpace=N,this.Banners=Ue,this.wpTableHighlight=et,this.highlightingMode="inline",this.entireRowMode=!1,this.lastEntireRowAttribute="status",this.eeShowBanners=!1,this.availableInlineHighlightedAttributes=[],this.selectedAttributes=[],this.availableRowHighlightedAttributes=[],this.text={title:this.I18n.t("js.work_packages.table_configuration.highlighting"),highlighting_mode:{description:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.description"),none:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.none"),inline:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.inline"),inline_all_attributes:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.inline_all"),status:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.status"),type:this.I18n.t("js.work_packages.properties.type"),priority:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.priority"),entire_row_by:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.entire_row_by")},upsaleAttributeHighlighting:this.I18n.t("js.work_packages.table_configuration.upsale.attribute_highlighting"),upsaleCheckOutLink:this.I18n.t("js.work_packages.table_configuration.upsale.check_out_link"),more_info_link:u.rj.tableHighlighting}}ngOnInit(){this.availableInlineHighlightedAttributes=this.availableHighlightedAttributes,this.availableRowHighlightedAttributes=[{name:this.text.highlighting_mode.status,value:"status"},{name:this.text.highlighting_mode.priority,value:"priority"}],this.setSelectedValues(),this.eeShowBanners=this.Banners.eeShowBanners,this.updateMode(this.wpTableHighlight.current.mode),this.eeShowBanners&&this.updateMode("none")}onSave(){const Y=this.highlightingMode;this.wpTableHighlight.update({mode:Y,selectedAttributes:this.selectedAttributes})}updateMode(Y){this.highlightingMode="entire-row"===Y?this.lastEntireRowAttribute:Y,-1!==["status","priority"].indexOf(this.highlightingMode)?(this.lastEntireRowAttribute=this.highlightingMode,this.entireRowMode=!0):this.entireRowMode=!1}updateHighlightingAttributes(Y){this.selectedAttributes=Y}disabledValue(Y){return Y?"disabled":null}get availableHighlightedAttributes(){const{schema:Y}=this.querySpace.queryForm.value;return Y.highlightedAttributes.allowedValues}onOpen(Y){setTimeout(()=>{Y.dropdownPanel&&Y.dropdownPanel._updatePosition()},25)}setSelectedValues(){const Y=this.wpTableHighlight.current.selectedAttributes;Y&&(this.selectedAttributes=Y)}}ce.\u0275fac=function(Y){return new(Y||ce)(r.Y36(r.zs3),r.Y36(i.D),r.Y36(Oe.G),r.Y36(Se.q),r.Y36(C.j),r.Y36(ve.B))},ce.\u0275cmp=r.Xpm({type:ce,selectors:[["ng-component"]],viewQuery:function(Y,$){if(1&Y&&(r.Gf(tt,5),r.Gf(He,5)),2&Y){let be;r.iGM(be=r.CRH())&&($.highlightedAttributesNgSelect=be.first),r.iGM(be=r.CRH())&&($.rowHighlightNgSelect=be.first)}},decls:3,vars:2,consts:[["class","ee-attribute-highlighting-upsale","opReferrer","wp-attribute-highlighting#attribute-highlighting",3,"linkMessage","textMessage","moreInfoLink",4,"ngIf"],[4,"ngIf"],["opReferrer","wp-attribute-highlighting#attribute-highlighting",1,"ee-attribute-highlighting-upsale",3,"linkMessage","textMessage","moreInfoLink"],[3,"textContent"],[1,"form--field"],[1,"form--label"],["type","radio","value","inline","name","highlighting_mode_switch",3,"ngModel","ngModelChange","change"],[1,"form--field-container"],[1,"form--select-container"],["bindLabel","name","name","highlighting_attributes","appendTo","body",1,"form--select-field","-multi-select",3,"items","ngModel","multiple","disabled","clearable","closeOnSelect","ngModelChange","open","change"],["highlightedAttributesNgSelect",""],["type","radio","name","entire_row_switch",3,"ngModel","value","ngModelChange","change"],["bindLabel","name","bindValue","value","name","selected_attribute","appendTo","body","id","selected_attribute",1,"form--select-field",3,"items","ngModel","disabled","clearable","ngModelChange","open","change"],["rowHighlightNgSelect",""],["type","radio","value","none","name","highlighting_mode_switch",3,"ngModel","ngModelChange","change"]],template:function(Y,$){1&Y&&(r.TgZ(0,"div"),r.YNc(1,st,1,3,"op-enterprise-banner",0),r.YNc(2,Me,23,21,"form",1),r.qZA()),2&Y&&(r.xp6(1),r.Q6J("ngIf",$.eeShowBanners),r.xp6(1),r.Q6J("ngIf",!$.eeShowBanners))},directives:[a.O5,O.P,n._Y,n.JL,n.F,n._,n.Fj,n.JJ,n.On,je.w9],encapsulation:2,changeDetection:0});class J{constructor(Y){this.I18n=Y,this._tabs=[{id:"columns",name:this.I18n.t("js.label_columns"),componentClass:b},{id:"filters",name:this.I18n.t("js.work_packages.query.filters"),componentClass:S},{id:"sort-by",name:this.I18n.t("js.label_sort_by"),componentClass:q},{id:"display-settings",name:this.I18n.t("js.work_packages.table_configuration.display_settings"),componentClass:c},{id:"highlighting",name:this.I18n.t("js.work_packages.table_configuration.highlighting"),componentClass:ce},{id:"timelines",name:this.I18n.t("js.timelines.gantt_chart"),componentClass:fe}]}get tabs(){return this._tabs}}J.\u0275fac=function(Y){return new(Y||J)(r.LFG(i.D))},J.\u0275prov=r.Yz7({token:J,factory:J.\u0275fac})},77591:(X,I,t)=>{"use strict";t.d(I,{j:()=>a});var i=t(70233),e=t(55977),d=t(53448),h=t(73165),r=t(16793),n=t(2888),l=t(2316);class a{constructor(v,c,p,f,C,u){this.HookService=v,this.UrlParamsHelper=c,this.wpViewRepresentation=p,this.wpViewTimeline=f,this.wpViewIndent=C,this.PathHelper=u,this.BULK_ACTIONS=[{text:I18n.t("js.work_packages.bulk_actions.edit"),key:"edit",link:"update",href:`${this.PathHelper.staticBase}/work_packages/bulk/edit`},{text:I18n.t("js.work_packages.bulk_actions.move"),key:"move",link:"move",href:`${this.PathHelper.staticBase}/work_packages/move/new`},{text:I18n.t("js.work_packages.bulk_actions.copy"),key:"copy",link:"copy",href:`${this.PathHelper.staticBase}/work_packages/move/new?copy=true`},{text:I18n.t("js.work_packages.bulk_actions.delete"),key:"delete",link:"delete",href:`${this.PathHelper.staticBase}/work_packages/bulk?_method=delete`}]}getPermittedActionLinks(v,c,p){const f=[];let C=this.getAllowedActions(v,c);return C=C.concat(this.getAllowedParentActions(v)),C=C.concat(this.getAllowedRelationActions(v,p)),_.each(C,u=>{f.push({key:u.key,text:u.text,icon:u.icon,link:u.link?v[u.link].href:void 0})}),f}getIntersectOfPermittedActions(v){const c=[],p=this.BULK_ACTIONS.concat(this.HookService.call("workPackageBulkContextMenu")),f=_.filter(p,C=>_.every(v,u=>this.isActionAllowed(u,C)));return _.each(f,C=>{c.push({key:C.key,text:C.text,icon:C.icon,link:this.getBulkActionLink(C,v)})}),c}getBulkActionLink(v,c){const p={"ids[]":c.map(O=>O.id)},f=this.UrlParamsHelper.buildQueryString(p),C=v.href.split("?");return`${C.shift()}?${C.concat(new Array(f)).join("&")}`}isActionAllowed(v,c){return _.filter(this.getAllowedActions(v,[c]),p=>p===c).length>=1}getAllowedActions(v,c){const p=[];return _.each(c,f=>{f.link&&v.hasOwnProperty(f.link)&&(f.text=f.text||I18n.t(`js.button_${f.key}`),p.push(f))}),_.each(this.HookService.call("workPackageTableContextMenu"),f=>{if(v.hasOwnProperty(f.link)){const C=f.indexBy?f.indexBy(p):p.length;p.splice(C,0,f)}}),p}getAllowedParentActions(v){const c=[];return this.wpViewRepresentation.isList?(this.wpViewIndent.canOutdent(v)&&c.push({key:"hierarchy-outdent",icon:"icon-paragraph-left",text:I18n.t("js.relation_buttons.hierarchy_outdent")}),this.wpViewIndent.canIndent(v)&&c.push({key:"hierarchy-indent",icon:"icon-paragraph-right",text:I18n.t("js.relation_buttons.hierarchy_indent")}),c):[]}getAllowedRelationActions(v,c){const p=[];return!!v.addRelation&&this.wpViewTimeline.isVisible&&(p.push({key:"relation-precedes",text:I18n.t("js.relation_buttons.add_predecessor"),link:"addRelation"}),p.push({key:"relation-follows",text:I18n.t("js.relation_buttons.add_follower"),link:"addRelation"})),!!v.addChild&&c&&p.push({key:"relation-new-child",text:I18n.t("js.relation_buttons.add_new_child"),link:"addChild"}),p}getPermittedActions(v,c,p){return 1===v.length?this.getPermittedActionLinks(v[0],c,p):this.getIntersectOfPermittedActions(v)}}a.\u0275fac=function(v){return new(v||a)(l.LFG(d.$),l.LFG(e.Z),l.LFG(n.ld),l.LFG(h.W),l.LFG(r.f),l.LFG(i.j))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac})},16451:(X,I,t)=>{"use strict";t.d(I,{B:()=>P});var i=t(43440);class e{constructor(T,M){this.querySpace=T,this.injector=M}get applies(){return!0}onNewOrder(T){}canPickup(T){return!0}handleDrop(T,M){return Promise.resolve(void 0)}changeShadowElement(T,M=!1){return M?T.classList.remove("-dragged"):T.classList.add("-dragged"),!0}}var d=t(3786),h=t(99676),r=t(41945),n=t(32030),l=t(99919),a=t(29161),m=t(61908);class v extends e{get applies(){return this.wpTableHierarchies.isEnabled}canPickup(T){return!!T.changeParent}handleDrop(T,M){return this.determineParent(M).then(S=>this.relationHierarchyService.changeParent(T,S))}determineParent(T){let M=T.previousElementSibling;const S=T.nextElementSibling;let R=null;if(null!==M&&this.droppedIntoGroup(T,M,S)){if(M.className.indexOf((0,l.gx)())>=0){const D=this.findRelationRowRoot(M);if(null==D)return Promise.resolve(null);M=D}const L=M.dataset.workPackageId;if(this.isHiearchyRoot(M,L)){if((0,l._D)(S))return this.determineParent(M);R=L}else R=this.loadParentOfWP(L)}return Promise.resolve(R)}findRelationRowRoot(T){let M=T.previousElementSibling;for(;null!==M;){if(M.className.indexOf((0,l.gx)())<0)return M;M=M.previousElementSibling}return null}droppedIntoGroup(T,M,S){const R=M.className.indexOf((0,n.oQ)(""))>=0,F=M.className.indexOf((0,n.MO)(""))>=0;let L;if(R||F){const D=Array.from(T.classList).filter(se=>se.includes("__hierarchy-group-"))||[],G=Array.from(M.classList).filter(se=>se.includes("__hierarchy-group-"))||[],Q=S&&Array.from(S.classList).filter(se=>se.includes("__hierarchy-group-"))||[],V=M.dataset.workPackageId,K=!Q.some(se=>G.includes(se))&&!Q.includes((0,n.oQ)(V)),q=D.some(se=>G.includes(se))||D.includes((0,n.oQ)(V));L=K&&!q}return!L&&R||F}isHiearchyRoot(T,M){return T.classList.contains((0,n.MO)(M))}loadParentOfWP(T){return this.apiV3Service.work_packages.id(T).get().toPromise().then(M=>{var S;return Promise.resolve((null===(S=M.parent)||void 0===S?void 0:S.id)||null)})}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",h.Y)],v.prototype,"wpTableHierarchies",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",r.O)],v.prototype,"relationHierarchyService",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",m.T)],v.prototype,"apiV3Service",void 0);var c=t(61083),p=t(12703),f=t(68130),C=t(67749),u=t(67727),k=t(1403),O=t(44022);class y extends e{get applies(){return this.wpTableGroupBy.isEnabled}canPickup(T){const M=this.groupedAttribute;return null!==M&&this.schemaCache.of(T).isAttributeEditable(M)}handleDrop(T,M){const S=this.halEditing.changeFor(T),R=this.getValueForGroup(M);return S.projectedResource[this.groupedAttribute]=R,this.halEditing.save(S).then(F=>this.halEvents.push(F.resource,{eventType:"updated"})).catch(F=>this.halNotification.handleRawError(F,T))}getValueForGroup(T){const M=(0,l.hK)(T,`.${f.u}`),S=this.groups.find(R=>(0,C.M4)(R)===M.dataset.groupIdentifier);if(!S)return null;if(S._links&&S._links.valueLink){const R=S._links.valueLink;return 1===R.length?R[0]:R}return S.value}get groupedAttribute(){const{current:T}=this.wpTableGroupBy;return T?T.id:null}get groups(){return this.querySpace.groups.value||[]}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",c.w)],y.prototype,"wpTableGroupBy",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",p.l)],y.prototype,"halEditing",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",k.J)],y.prototype,"halEvents",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",u.W)],y.prototype,"halNotification",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",O.y)],y.prototype,"schemaCache",void 0);var b=t(2316);class P{constructor(){this.register=[v,y]}add(T){this.register.push(T)}get(T){const M=T.get(i.q);return this.register.map(R=>new R(M,T)).find(R=>R.applies)||new e(M,T)}}P.\u0275fac=function(T){return new(T||P)},P.\u0275prov=b.Yz7({token:P,factory:P.\u0275fac})},166:(X,I,t)=>{"use strict";t.d(I,{Z:()=>ie});var i=t(3786),e=t(2316),d=t(73165),h=t(40533),r=t(93903),n=t(57119),l=t(77355),a=t(45338),m=t(86469),v=t(55977),c=t(96617),p=t(43440),f=t(34520),C=t(29161),u=t(61908),k=t(65146),O=t(74478);class y extends f._{constructor(){super(...arguments),this.uniqueEmbeddedTableName=`embedded-table-${Date.now()}`,this.initialLoadingIndicator=!0,this.renderTable=!1,this.showTablePagination=!1,this.error=null,this.initialized=!1}ngOnInit(){this.configuration=new a.O(this.providedConfiguration),this.configuration.isEmbedded=!0,this.initialized=!0,super.ngOnInit()}ngAfterViewInit(){this.loadQuery(!0,!1)}ngOnChanges(oe){this.initialized&&(oe.queryId||oe.queryProps)&&this.loadQuery(this.initialLoadingIndicator,!1)}get projectIdentifier(){return this.configuration.projectContext?this.currentProject.identifier||void 0:this.configuration.projectIdentifier||void 0}buildQueryProps(){const oe=this.querySpace.query.value;return this.wpStatesInitialization.applyToQuery(oe),this.urlParamsHelper.buildV3GetQueryFromQueryResource(oe)}buildUrlParams(){const oe=this.querySpace.query.value;return this.wpStatesInitialization.applyToQuery(oe),this.urlParamsHelper.encodeQueryJsonParams(oe)}setLoaded(){this.renderTable=this.configuration.tableVisible,this.cdRef.detectChanges()}refresh(oe=!0,ne=!1){const fe=this.querySpace.query.value,ve=this.wpTablePagination.paginationObject;ne&&(ve.offset=1);const Se=this.urlParamsHelper.buildV3GetQueryFromQueryResource(fe,ve),Oe=this.wpListService.loadQueryFromExisting(fe,Se,this.queryProjectScope).toPromise().then(je=>this.wpStatesInitialization.updateQuerySpace(je,je.results));return oe&&(this.loadingIndicator=Oe),Oe}get isInitialized(){return!!this.configuration}set loadingIndicator(oe){this.configuration.tableVisible&&(this.loadingIndicatorService.indicator(this.uniqueEmbeddedTableName).promise=oe)}get queryProjectScope(){if(this.configuration.projectContext)return this.projectIdentifier}initializeStates(oe){this.wpStatesInitialization.clearStates(),this.wpStatesInitialization.initializeFromQuery(oe,oe.results),this.wpStatesInitialization.updateQuerySpace(oe,oe.results)}}y.\u0275fac=function(){let le;return function(ne){return(le||(le=e.n5z(y)))(ne||y)}}(),y.\u0275dir=e.lG2({type:y,inputs:{providedConfiguration:["configuration","providedConfiguration"],uniqueEmbeddedTableName:"uniqueEmbeddedTableName",initialLoadingIndicator:"initialLoadingIndicator"},features:[e.qOj,e.TTD]}),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",u.T)],y.prototype,"apiV3Service",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",p.q)],y.prototype,"querySpace",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",c.D)],y.prototype,"I18n",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",v.Z)],y.prototype,"urlParamsHelper",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",m.vt)],y.prototype,"loadingIndicatorService",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",O.f)],y.prototype,"wpStatesInitialization",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",k.R)],y.prototype,"currentProject",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",e.sBO)],y.prototype,"cdRef",void 0);var b=t(33927),P=t(83720),E=t(17163),T=t(53466),M=t(84109),S=t(54364),R=t(2770),F=t(77434),L=t(18942),D=t(88923);function G(le,oe){if(1&le&&e._UZ(0,"op-filter-container",10),2&le){const ne=e.oxw(3);e.Q6J("showFilterButton",ne.configuration.showFilterButton)("filterButtonText",ne.configuration.filterButtonText)}}function Q(le,oe){if(1&le){const ne=e.EpF();e.TgZ(0,"wp-table",11),e.NdJ("itemClicked",function(ve){return e.CHM(ne),e.oxw(3).handleWorkPackageClicked(ve)})("stateLinkClicked",function(ve){return e.CHM(ne),e.oxw(3).openStateLink(ve)}),e.qZA()}if(2&le){const ne=e.oxw(3);e.Q6J("projectIdentifier",ne.projectIdentifier)("configuration",ne.configuration)}}function V(le,oe){if(1&le){const ne=e.EpF();e.TgZ(0,"wp-grid",12),e.NdJ("itemClicked",function(ve){return e.CHM(ne),e.oxw(3).handleWorkPackageClicked(ve)})("stateLinkClicked",function(ve){return e.CHM(ne),e.oxw(3).openStateLink(ve)}),e.qZA()}if(2&le){const ne=e.oxw(3);e.Q6J("configuration",ne.configuration)}}function K(le,oe){if(1&le&&(e.ynx(0),e.YNc(1,G,1,2,"op-filter-container",4),e.YNc(2,Q,1,2,"wp-table",5),e.TgZ(3,"div",6),e.YNc(4,V,1,1,"wp-grid",7),e.qZA(),e.TgZ(5,"div",8),e._UZ(6,"wp-table-pagination",9),e.qZA(),e.BQk()),2&le){const ne=e.oxw(2);e.xp6(1),e.Q6J("ngIf",ne.configuration.withFilters),e.xp6(1),e.Q6J("ngIf",!ne.configuration.isCardView),e.xp6(2),e.Q6J("ngIf",ne.configuration.isCardView),e.xp6(2),e.Q6J("hideForSinglePageResults",!0)}}function q(le,oe){if(1&le&&(e.TgZ(0,"div",13),e._UZ(1,"span",14),e.qZA()),2&le){const ne=e.oxw(2);e.xp6(1),e.Q6J("textContent",ne.error.message||ne.error)}}const se=function(le,oe,ne){return{"-hierarchy-disabled":le,"-compact-tables":oe,"-external-height":ne}};function te(le,oe){if(1&le&&(e.TgZ(0,"div",1),e.YNc(1,K,7,4,"ng-container",2),e.YNc(2,q,2,1,"div",3),e.qZA()),2&le){const ne=e.oxw();e.Q6J("ngClass",e.kEZ(4,se,!ne.configuration.hierarchyToggleEnabled,ne.configuration.compactTableStyle,ne.externalHeight)),e.uIk("data-indicator-name",ne.uniqueEmbeddedTableName),e.xp6(1),e.Q6J("ngIf",ne.renderTable),e.xp6(1),e.Q6J("ngIf",ne.error)}}class ie extends y{constructor(){super(...arguments),this.queryProps={},this.tableActions=[],this.externalHeight=!1,this.onError=new e.vpe,this.onQueryLoaded=new e.vpe}ngOnInit(){super.ngOnInit(),this.loadedQuery=this.querySpace.query.value}ngAfterViewInit(){super.ngAfterViewInit(),this.tableActions&&this.tableActionsService.setActions(...this.tableActions),this.wpTablePagination.updates$().pipe((0,b.U)(oe=>[oe.page,oe.perPage]),(0,P.x)(),this.untilDestroyed(),(0,E.M)(this.querySpace.query.values$())).subscribe(([oe,ne])=>{const fe=this.wpTablePagination.paginationObject,ve=this.urlParamsHelper.buildV3GetQueryFromQueryResource(ne,fe);this.loadingIndicator=this.wpListService.loadQueryFromExisting(ne,ve,this.queryProjectScope).toPromise().then(Se=>this.initializeStates(Se))})}openConfigurationModal(oe){this.querySpace.query.valuesPromise().then(()=>{this.opModalService.show(n.Q,this.injector).onDataUpdated.subscribe(oe)})}initializeStates(oe){this.loadForm(oe),super.initializeStates(oe),this.querySpace.initialized.values$().pipe((0,T.q)(1)).subscribe(()=>{this.showTablePagination=oe.results.total>oe.results.count,this.setLoaded(),this.wpTableTimeline.isVisible&&(this.configuration=Object.assign(Object.assign({},this.configuration),{compactTableStyle:!1}))})}loadForm(oe){return this.formPromise?this.formPromise:this.formPromise=this.apiv3Service.withOptionalProject(this.projectIdentifier).queries.form.load(oe).toPromise().then(([ne,fe])=>(this.wpStatesInitialization.updateStatesFromForm(oe,ne),ne)).catch(()=>this.formPromise=void 0)}loadQuery(oe=!0,ne=!1){if(this.formPromise=void 0,this.loadedQuery){const ve=this.loadedQuery;return this.loadedQuery=void 0,this.initializeStates(ve),Promise.resolve(this.loadedQuery)}this.configuration.tableVisible||(this.queryProps.pageSize=1),ne&&(this.queryProps.page=1),this.error=null;const fe=this.apiv3Service.queries.find(this.queryProps,this.queryId,this.queryProjectScope).toPromise().then(ve=>(this.initializeStates(ve),this.onQueryLoaded.emit(ve),ve)).catch(ve=>{this.error=this.I18n.t("js.error.embedded_table_loading",{message:_.get(ve,"message",ve)}),this.onError.emit(ve)});return oe&&(this.loadingIndicator=fe),fe}handleWorkPackageClicked(oe){oe.double&&this.$state.go("work-packages.show",{workPackageId:oe.workPackageId})}openStateLink(oe){const ne={workPackageId:oe.workPackageId,focus:!0};"split"===oe.requestedState?this.keepTab.goCurrentDetailsState(ne):this.keepTab.goCurrentShowState(ne)}}ie.\u0275fac=function(){let le;return function(ne){return(le||(le=e.n5z(ie)))(ne||ie)}}(),ie.\u0275cmp=e.Xpm({type:ie,selectors:[["wp-embedded-table"]],inputs:{queryId:"queryId",queryProps:"queryProps",tableActions:"tableActions",externalHeight:"externalHeight"},outputs:{onError:"onError",onQueryLoaded:"onQueryLoaded"},features:[e.qOj],decls:1,vars:1,consts:[["class","work-packages-embedded-view--container loading-indicator--location",3,"ngClass",4,"ngIf"],[1,"work-packages-embedded-view--container","loading-indicator--location",3,"ngClass"],[4,"ngIf"],["class","op-toast -error",4,"ngIf"],[3,"showFilterButton","filterButtonText",4,"ngIf"],["class","work-packages-split-view--tabletimeline-content",3,"projectIdentifier","configuration","itemClicked","stateLinkClicked",4,"ngIf"],[1,"work-packages-embedded-view--grid-view"],[3,"configuration","itemClicked","stateLinkClicked",4,"ngIf"],[1,"work-packages-split-view--tabletimeline-footer","hide-when-print"],[3,"hideForSinglePageResults"],[3,"showFilterButton","filterButtonText"],[1,"work-packages-split-view--tabletimeline-content",3,"projectIdentifier","configuration","itemClicked","stateLinkClicked"],[3,"configuration","itemClicked","stateLinkClicked"],[1,"op-toast","-error"],[3,"textContent"]],template:function(oe,ne){1&oe&&e.YNc(0,te,3,8,"div",0),2&oe&&e.Q6J("ngIf",ne.configuration)},directives:[S.O5,S.mk,R.v,F.J,L.c,D.b],encapsulation:2}),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",u.T)],ie.prototype,"apiv3Service",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",l.S)],ie.prototype,"opModalService",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",r.j)],ie.prototype,"tableActionsService",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",d.W)],ie.prototype,"wpTableTimeline",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",h.S)],ie.prototype,"wpTablePagination",void 0),(0,i.gn)([(0,C.W)(),(0,i.w6)("design:type",M.p)],ie.prototype,"keepTab",void 0)},62016:(X,I,t)=>{"use strict";t.d(I,{O:()=>v});var i=t(166),e=t(71444),d=t(628),h=t(37605),r=t(55977),n=t(2316),l=t(97047);const a=["embeddedTableForConfiguration"],m=function(){return{tableVisible:!1}};class v{constructor(p,f,C){this.locals=p,this.urlParamsHelper=f,this.cdRef=C}ngOnInit(){this.locals.urlParams?this.queryProps=this.urlParamsHelper.buildV3GetQueryFromJsonParams(this.locals.currentQuery):this.queryProps=this.locals.currentQuery}ngAfterViewInit(){setTimeout(()=>{this.embeddedTable.openConfigurationModal(()=>{this.service.detach(),this.locals.urlParams?this.locals.callback(this.embeddedTable.buildUrlParams()):this.locals.callback(this.embeddedTable.buildQueryProps())}),this.cdRef.detectChanges()})}get service(){return this.locals.service}}v.\u0275fac=function(p){return new(p||v)(n.Y36(h.J),n.Y36(r.Z),n.Y36(n.sBO))},v.\u0275cmp=n.Xpm({type:v,selectors:[["ng-component"]],viewQuery:function(p,f){if(1&p&&n.Gf(a,7),2&p){let C;n.iGM(C=n.CRH())&&(f.embeddedTable=C.first)}},features:[n._Bn([[{provide:e.p,useClass:d.P}]])],decls:3,vars:3,consts:[["wp-isolated-query-space",""],[3,"queryProps","configuration"],["embeddedTableForConfiguration",""]],template:function(p,f){1&p&&(n.ynx(0,0),n._UZ(1,"wp-embedded-table",1,2),n.BQk()),2&p&&(n.xp6(1),n.Q6J("queryProps",f.queryProps)("configuration",n.DdM(2,m)))},directives:[l.A,i.Z],encapsulation:2})},37605:(X,I,t)=>{"use strict";t.d(I,{J:()=>e});const e=new(t(2316).OlP)("OpQueryConfigurationLocalsToken")},5275:(X,I,t)=>{"use strict";t.d(I,{W:()=>l});var i=t(40912),e=t(47775),d=t(7101),h=t(62016),r=t(37605),n=t(2316);class l{constructor(m,v,c,p,f){this.componentFactoryResolver=m,this.FocusHelper=v,this.appRef=c,this.$transitions=p,this.injector=f}get bodyPortalHost(){if(!this._portalHostElement){const m=this._portalHostElement=document.createElement("div");m.classList.add("op-external-query-configuration--container"),document.body.appendChild(m),this._bodyPortalHost=new i.u0(m,this.componentFactoryResolver,this.appRef,this.injector)}return this._bodyPortalHost}show(m){this.detach();const v=new i.C5(this.externalQueryConfigurationComponent(),null,this.injectorFor(m));this.bodyPortalHost.attach(v),this._portalHostElement.style.display="block"}detach(){this.bodyPortalHost.hasAttached()&&(this.bodyPortalHost.detach(),this._portalHostElement.style.display="none")}injectorFor(m){const v=new WeakMap;return m.service=this,v.set(r.J,m),new i.nK(this.injector,v)}externalQueryConfigurationComponent(){return h.O}}l.\u0275fac=function(m){return new(m||l)(n.LFG(n._Vd),n.LFG(d.i),n.LFG(n.z2F),n.LFG(e.TransitionService),n.LFG(n.zs3))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac})},74961:(X,I,t)=>{"use strict";t.d(I,{Q:()=>b});var i=t(5275),e=t(71444),d=t(628),h=t(12877),r=t(96617),n=t(74647),l=t(44022),a=t(2316),m=t(1707),v=t(54364);function c(P,E){if(1&P&&a._UZ(0,"option",4),2&P){const T=E.$implicit,M=a.oxw();a.Q6J("textContent",M.text[T.id])("ngValue",T)}}class p{constructor(E,T,M,S,R){this.injector=E,this.I18n=T,this.wpTableFilters=M,this.ConfigurationService=S,this.schemaCache=R,this.relationFilterIds=["parent","precedes","follows","relates","duplicates","duplicated","blocks","blocked","partof","includes","requires","required"],this.availableRelationFilters=[],this.selectedRelationFilter=void 0,this.text={filter_work_packages_by_relation_type:this.I18n.t("js.work_packages.table_configuration.relation_filters.filter_work_packages_by_relation_type"),please_select:this.I18n.t("js.placeholders.selection"),parent:this.I18n.t("js.relation_labels.children"),precedes:this.I18n.t("js.relation_labels.follows"),follows:this.I18n.t("js.relation_labels.precedes"),relates:this.I18n.t("js.relation_labels.relates"),duplicates:this.I18n.t("js.relation_labels.duplicated"),duplicated:this.I18n.t("js.relation_labels.duplicates"),blocks:this.I18n.t("js.relation_labels.blocked"),blocked:this.I18n.t("js.relation_labels.blocks"),requires:this.I18n.t("js.relation_labels.required"),required:this.I18n.t("js.relation_labels.requires"),partof:this.I18n.t("js.relation_labels.includes"),includes:this.I18n.t("js.relation_labels.partof")}}ngOnInit(){const E=this;this.wpTableFilters.onReady().then(()=>{E.availableRelationFilters=E.relationFiltersOf(E.wpTableFilters.availableFilters),E.setSelectedRelationFilter()})}setSelectedRelationFilter(){const E=this.relationFiltersOf(this.wpTableFilters.current);E.length>0?this.selectedRelationFilter=_.find(this.availableRelationFilters,{id:E[0].id}):this.selectedRelationFilter=this.availableRelationFilters[0],this.onRelationFilterSelected()}onRelationFilterSelected(){this.selectedRelationFilter&&(this.removeRelationFiltersFromCurrentState(),this.addFilterToCurrentState(this.selectedRelationFilter))}removeRelationFiltersFromCurrentState(){const E=this.relationFiltersOf(this.wpTableFilters.current);this.wpTableFilters.remove(...E)}relationFiltersOf(E){return _.filter(E,T=>_.includes(this.relationFilterIds,T.id))}addFilterToCurrentState(E){const T=this.wpTableFilters.instantiate(E),M=this.getOperatorForId(T,"=");T.operator=M,T.values=[{href:"/api/v3/work_packages/{id}"}],this.wpTableFilters.add(T)}getOperatorForId(E,T){return _.find(this.schemaCache.of(E).availableOperators,{id:T})}compareRelationFilters(E,T){return E&&T?E.id===T.id:E===T}}p.\u0275fac=function(E){return new(E||p)(a.Y36(a.zs3),a.Y36(r.D),a.Y36(n.Z),a.Y36(h.e),a.Y36(l.y))},p.\u0275cmp=a.Xpm({type:p,selectors:[["wp-table-configuration-relation-selector"]],decls:6,vars:4,consts:[[1,"relation-filter-selector"],[3,"textContent"],["id","",1,"form--select","form--inline-select",3,"ngModel","compareWith","ngModelChange"],[3,"textContent","ngValue",4,"ngFor","ngForOf"],[3,"textContent","ngValue"]],template:function(E,T){1&E&&(a.TgZ(0,"div",0),a.TgZ(1,"h5"),a._UZ(2,"span",1),a._uU(3," "),a.TgZ(4,"select",2),a.NdJ("ngModelChange",function(S){return T.selectedRelationFilter=S})("ngModelChange",function(){return T.onRelationFilterSelected()}),a.YNc(5,c,1,2,"option",3),a.qZA(),a.qZA(),a.qZA()),2&E&&(a.xp6(2),a.Q6J("textContent",T.text.filter_work_packages_by_relation_type),a.xp6(2),a.Q6J("ngModel",T.selectedRelationFilter)("compareWith",T.compareRelationFilters),a.xp6(1),a.Q6J("ngForOf",T.availableRelationFilters))},directives:[m.EJ,m.JJ,m.On,v.sg,m.YN,m.Kr],encapsulation:2});var f=t(57119),C=t(62016),u=t(97047),k=t(166);const O=function(){return{tableVisible:!1}};class y extends C.O{}y.\u0275fac=function(){let P;return function(T){return(P||(P=a.n5z(y)))(T||y)}}(),y.\u0275cmp=a.Xpm({type:y,selectors:[["ng-component"]],features:[a._Bn([[{provide:e.p,useClass:d.P}],{provide:f.c,useValue:p}]),a.qOj],decls:3,vars:3,consts:[["wp-isolated-query-space",""],[3,"queryProps","configuration"],["embeddedTableForConfiguration",""]],template:function(E,T){1&E&&(a.ynx(0,0),a._UZ(1,"wp-embedded-table",1,2),a.BQk()),2&E&&(a.xp6(1),a.Q6J("queryProps",T.queryProps)("configuration",a.DdM(2,O)))},directives:[u.A,k.Z],encapsulation:2});class b extends i.W{externalQueryConfigurationComponent(){return y}}b.\u0275fac=function(){let P;return function(T){return(P||(P=a.n5z(b)))(T||b)}}(),b.\u0275prov=a.Yz7({token:b,factory:b.\u0275fac})},628:(X,I,t)=>{"use strict";t.d(I,{P:()=>r});var i=t(96617),e=t(71444),d=t(37605),h=t(2316);class r extends e.p{constructor(l,a){super(a),this.locals=l,this.I18n=a}get tabs(){const l=this.locals.disabledTabs||{};return this._tabs.map(a=>{const m=l[a.id];return null!=m&&(a.disable=m),a})}}r.\u0275fac=function(l){return new(l||r)(h.LFG(d.J),h.LFG(i.D))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac})},23893:(X,I,t)=>{"use strict";t.d(I,{g:()=>d});var i=t(85003),e=t(65978);class d extends i.z9{constructor(r,n,l,a,m,v){super(r,n),this.injector=r,this.workPackage=n,this.identifier=l,this.title=a,this.applicable=m,this.onClick=v}static factoryFor(r,n,l,a=(()=>!0)){return(m,v)=>new d(m,v,r,n,a,l)}buildElement(){if(!this.applicable(this.workPackage))return null;const r=document.createElement("a");return r.title=this.title,r.href="#",r.classList.add(i.gK,"wp-table-action--unlink"),r.dataset.workPackageId=this.workPackage.id,r.appendChild((0,e.c)("icon","icon-close")),jQuery(r).click(n=>{n.preventDefault(),this.onClick(this.workPackage)}),r}}},85003:(X,I,t)=>{"use strict";t.d(I,{oE:()=>h,K$:()=>r,E4:()=>n,gK:()=>l,z9:()=>a});var i=t(3786),e=t(96617),d=t(29161);const h="wp-table--context-menu-td",r="wp-table--context-menu-span",n="wp-table-context-menu-link",l="wp-table-context-menu-icon";class a{constructor(v,c){this.injector=v,this.workPackage=c}}(0,i.gn)([(0,d.W)(),(0,i.w6)("design:type",e.D)],a.prototype,"I18n",void 0)},93903:(X,I,t)=>{"use strict";t.d(I,{j:()=>v});var i=t(85003),e=t(65978),d=t(84109),h=t(20506),r=t(47775);class l extends i.z9{constructor(){super(...arguments),this.identifier="open-details-action",this.uiStatebuilder=new h.mE(this.injector.get(r.StateService),this.injector.get(d.p)),this.text={button:this.I18n.t("js.button_open_details")}}buildElement(){const p=this.uiStatebuilder.linkToDetails(this.workPackage.id,this.text.button,"");return p.classList.add("wp-table--details-link",i.gK,"hidden-for-mobile"),p.appendChild((0,e.c)("icon","icon-info2")),p}}class a extends i.z9{constructor(){super(...arguments),this.identifier="open-context-menu-action",this.text={linkTitle:this.I18n.t("js.label_open_context_menu")}}buildElement(){const p=document.createElement("a");return p.href="#",p.classList.add(i.E4,i.gK),p.title=this.text.linkTitle,p.appendChild((0,e.c)("icon","icon-show-more-horizontal")),p}}var m=t(2316);class v{constructor(p){this.injector=p,this.actions=[(f,C)=>new l(f,C),(f,C)=>new a(f,C)]}setActions(...p){this.actions=p}render(p){const f=this.actions.map(C=>C(this.injector,p).buildElement());return _.compact(f)}}v.\u0275fac=function(p){return new(p||v)(m.LFG(m.zs3))},v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac})},2770:(X,I,t)=>{"use strict";t.d(I,{v:()=>Me});var i=t(96617),e=t(40533),d=t(82763),h=t(43440),r=t(61486),n=t(2316),l=t(26942),a=t(14359),m=t(68853),v=t(54364),c=t(2775);function f(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"li",15),n.TgZ(1,"button",16),n.NdJ("click",function(){const be=n.CHM(W).$implicit;return n.oxw(3).showPage(be)}),n.qZA(),n.qZA()}if(2&ce){const W=J.$implicit;n.xp6(1),n.Q6J("textContent",W)}}function C(ce,J){if(1&ce&&(n.ynx(0),n.YNc(1,f,2,1,"li",13),n.TgZ(2,"li",14),n._uU(3,"\u2026"),n.qZA(),n.BQk()),2&ce){const W=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",W.prePageNumbers)}}function u(ce,J){if(1&ce&&(n.TgZ(0,"em"),n._uU(1),n.qZA()),2&ce){const W=n.oxw().$implicit;n.xp6(1),n.Oqu(W)}}function k(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"button",16),n.NdJ("click",function(){n.CHM(W);const $=n.oxw().$implicit;return n.oxw(3).showPage($)}),n.qZA()}if(2&ce){const W=n.oxw().$implicit;n.Q6J("textContent",W)}}const O=function(ce){return{"op-pagination--item_current":ce}};function y(ce,J){if(1&ce&&(n.TgZ(0,"li",19),n.YNc(1,u,2,1,"em",6),n.YNc(2,k,1,1,"button",20),n.qZA()),2&ce){const W=J.$implicit,Y=n.oxw(3);n.Q6J("ngClass",n.VKq(3,O,W==Y.pagination.page)),n.xp6(1),n.Q6J("ngIf",W==Y.pagination.page),n.xp6(1),n.Q6J("ngIf",W!=Y.pagination.page)}}function b(ce,J){1&ce&&(n.TgZ(0,"li",14),n._uU(1,"\u2026"),n.qZA())}function P(ce,J){if(1&ce&&(n.ynx(0),n.YNc(1,y,3,5,"li",17),n.YNc(2,b,2,0,"li",18),n.BQk()),2&ce){const W=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",W.pageNumbers),n.xp6(1),n.Q6J("ngIf",W.postPageNumbers.length)}}function E(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"li",15),n.TgZ(1,"button",16),n.NdJ("click",function(){const be=n.CHM(W).$implicit;return n.oxw(3).showPage(be)}),n.qZA(),n.qZA()}if(2&ce){const W=J.$implicit;n.xp6(1),n.Q6J("textContent",W)}}function T(ce,J){if(1&ce&&(n.ynx(0),n.YNc(1,E,2,1,"li",13),n.BQk()),2&ce){const W=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",W.postPageNumbers)}}function M(ce,J){if(1&ce&&n._UZ(0,"span",21),2&ce){const W=n.oxw(2);n.Q6J("textContent",W.text.no_other_page)}}function S(ce,J){if(1&ce&&(n.TgZ(0,"li",22),n._UZ(1,"op-icon",23),n._UZ(2,"span",9),n.qZA()),2&ce){const W=n.oxw(2);n.xp6(2),n.Q6J("textContent",W.infoText)}}function R(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"span"),n.TgZ(1,"button",27),n.NdJ("click",function(){n.CHM(W);const $=n.oxw().$implicit;return n.oxw(3).selectPerPage($)}),n.qZA(),n.qZA()}if(2&ce){const W=n.oxw().$implicit;n.xp6(1),n.Q6J("textContent",W)}}function F(ce,J){if(1&ce&&(n.TgZ(0,"span"),n._uU(1),n.qZA()),2&ce){const W=n.oxw().$implicit;n.xp6(1),n.Oqu(W)}}function L(ce,J){if(1&ce&&(n.TgZ(0,"li",19),n.YNc(1,R,2,1,"span",6),n.YNc(2,F,2,1,"span",6),n.qZA()),2&ce){const W=J.$implicit,Y=n.oxw(3);n.Q6J("ngClass",n.VKq(3,O,W==Y.pagination.perPage)),n.xp6(1),n.Q6J("ngIf",W!=Y.pagination.perPage),n.xp6(1),n.Q6J("ngIf",W==Y.pagination.perPage)}}function D(ce,J){if(1&ce&&(n.TgZ(0,"div",24),n.TgZ(1,"ul",25),n._UZ(2,"li",26),n.YNc(3,L,3,5,"li",17),n.qZA(),n.qZA()),2&ce){const W=n.oxw(2);n.xp6(2),n.s9C("title",W.text.per_page),n.Q6J("textContent",W.text.per_page),n.xp6(1),n.Q6J("ngForOf",W.perPageOptions)}}function G(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"div",1),n.TgZ(1,"nav",2),n.TgZ(2,"ul",3),n.TgZ(3,"li",4),n.TgZ(4,"button",5),n.NdJ("click",function(){n.CHM(W);const $=n.oxw();return $.showPage($.pagination.page-1)}),n._uU(5," < "),n.qZA(),n.qZA(),n.YNc(6,C,4,1,"ng-container",6),n.YNc(7,P,3,2,"ng-container",6),n.YNc(8,T,2,1,"ng-container",6),n.TgZ(9,"li",4),n.TgZ(10,"button",7),n.NdJ("click",function(){n.CHM(W);const $=n.oxw();return $.showPage($.pagination.page+1)}),n._uU(11," > "),n.qZA(),n.qZA(),n.TgZ(12,"li",8),n._UZ(13,"span",9),n.YNc(14,M,1,1,"span",10),n.qZA(),n.YNc(15,S,3,1,"li",11),n.qZA(),n.qZA(),n.YNc(16,D,4,3,"div",12),n.qZA()}if(2&ce){const W=n.oxw();n.xp6(3),n.Q6J("hidden",1==W.pagination.page||!W.showPageSelections),n.xp6(1),n.uIk("aria-label",W.text.label_previous),n.xp6(2),n.Q6J("ngIf",W.prePageNumbers.length>0),n.xp6(1),n.Q6J("ngIf",W.pageNumbers.length>1),n.xp6(1),n.Q6J("ngIf",W.postPageNumbers.length),n.xp6(1),n.Q6J("hidden",!(W.pagination.total&&W.pagination.page<W.pageNumbers[W.pageNumbers.length-1])),n.xp6(1),n.uIk("aria-label",W.text.label_next),n.xp6(3),n.Q6J("textContent",W.currentRange),n.xp6(1),n.Q6J("ngIf",1===W.pageNumbers.length),n.xp6(1),n.Q6J("ngIf",W.infoText),n.xp6(1),n.Q6J("ngIf",W.showPerPageOptions())}}class Q extends l.N{constructor(J,W,Y){super(),this.paginationService=J,this.cdRef=W,this.I18n=Y,this.hideForSinglePageResults=!1,this.showPerPage=!0,this.showPageSelections=!0,this.updateResults=new n.vpe,this.text={label_previous:this.I18n.t("js.pagination.pages.previous"),label_next:this.I18n.t("js.pagination.pages.next"),per_page:this.I18n.t("js.label_per_page"),no_other_page:this.I18n.t("js.pagination.no_other_page")},this.currentRange="",this.pageNumbers=[],this.postPageNumbers=[],this.prePageNumbers=[],this.perPageOptions=[]}ngOnInit(){this.paginationService.loadPaginationOptions().then(J=>{this.perPageOptions=J.perPageOptions,this.pagination=new a.M(1,parseInt(this.totalEntries),J.perPage),this.cdRef.detectChanges()})}update(){this.updateCurrentRangeLabel(),this.updatePageNumbers(),this.cdRef.detectChanges()}selectPerPage(J){this.pagination.perPage=J,this.paginationService.setPerPage(J),this.showPage(1)}showPage(J){this.pagination.page=J,this.updateCurrentRangeLabel(),this.updatePageNumbers(),this.onUpdatedPage(),this.cdRef.detectChanges()}onUpdatedPage(){this.updateResults.emit(this.pagination)}get isVisible(){return!this.hideForSinglePageResults||this.pagination.total>this.pagination.perPage}updateCurrentRangeLabel(){if(this.pagination.total){const J=this.pagination.total,W=this.pagination.getLowerPageBound(),Y=this.pagination.getUpperPageBound(this.pagination.total);this.currentRange=`(${W}\xa0-\xa0${Y}/${J})`}else this.currentRange="(0 - 0/0)"}updatePageNumbers(){if(!this.showPageSelections)return this.pageNumbers=[],void(this.postPageNumbers=[]);const J=this.paginationService.getMaxVisiblePageOptions(),W=this.paginationService.getOptionsTruncationSize(),Y=[],{perPage:$}=this.pagination,be=this.pagination.page;if($){for(let Ue=1;Ue<=Math.ceil(this.pagination.total/$);Ue++)Y.push(Ue);const N=be-2*W;N>=0&&N<=1?this.postPageNumbers=this.truncatePageNums(Y,Y.length>=J+2*W,J+W,Y.length,0):(this.prePageNumbers=this.truncatePageNums(Y,be>=J,0,Math.min(be-Math.ceil(J/2),Y.length-J),W),this.postPageNumbers=this.truncatePageNums(Y,Y.length>=J+2*W,J,Y.length,0))}this.pageNumbers=Y}showPerPageOptions(){return this.showPerPage&&this.perPageOptions.length>0&&this.pagination.total>this.perPageOptions[0]}truncatePageNums(J,W,Y,$,be){if(W){const N=this.paginationService.getOptionsTruncationSize(),Ue=J.splice(Y,$);return Ue.length>=2*N&&Ue.splice(be,Ue.length-N),Ue}return[]}}function V(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"li",15),n.TgZ(1,"button",16),n.NdJ("click",function(){const be=n.CHM(W).$implicit;return n.oxw(3).showPage(be)}),n.qZA(),n.qZA()}if(2&ce){const W=J.$implicit;n.xp6(1),n.Q6J("textContent",W)}}function K(ce,J){if(1&ce&&(n.ynx(0),n.YNc(1,V,2,1,"li",13),n.TgZ(2,"li",14),n._uU(3,"\u2026"),n.qZA(),n.BQk()),2&ce){const W=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",W.prePageNumbers)}}function q(ce,J){if(1&ce&&(n.TgZ(0,"em"),n._uU(1),n.qZA()),2&ce){const W=n.oxw().$implicit;n.xp6(1),n.Oqu(W)}}function se(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"button",16),n.NdJ("click",function(){n.CHM(W);const $=n.oxw().$implicit;return n.oxw(3).showPage($)}),n.qZA()}if(2&ce){const W=n.oxw().$implicit;n.Q6J("textContent",W)}}Q.\u0275fac=function(J){return new(J||Q)(n.Y36(m.N),n.Y36(n.sBO),n.Y36(i.D))},Q.\u0275cmp=n.Xpm({type:Q,selectors:[["","tablePagination",""]],inputs:{totalEntries:"totalEntries",hideForSinglePageResults:"hideForSinglePageResults",showPerPage:"showPerPage",showPageSelections:"showPageSelections",infoText:"infoText"},outputs:{updateResults:"updateResults"},features:[n.qOj],attrs:["tablePagination",""],decls:1,vars:1,consts:[["class","op-pagination",4,"ngIf"],[1,"op-pagination"],[1,"op-pagination--pages"],[1,"op-pagination--items","op-pagination--items_start"],[1,"op-pagination--item",3,"hidden"],["type","button","rel","prev start",1,"op-pagination--item-link","op-pagination--item-link_prev",3,"click"],[4,"ngIf"],["type","button","rel","next",1,"op-pagination--item-link","op-pagination--item-link_next",3,"click"],[1,"op-pagination--range"],[3,"textContent"],["id","op-pagination-empty-text","tabindex","0","class","hidden-for-sighted",3,"textContent",4,"ngIf"],["class","op-pagination--info",4,"ngIf"],["class","op-pagination--options",4,"ngIf"],["class","op-pagination--item",4,"ngFor","ngForOf"],[1,"op-pagination--space"],[1,"op-pagination--item"],["type","button","rel","next",1,"op-pagination--item-link",3,"textContent","click"],["class","op-pagination--item",3,"ngClass",4,"ngFor","ngForOf"],["class","op-pagination--space",4,"ngIf"],[1,"op-pagination--item",3,"ngClass"],["class","op-pagination--item-link","type","button","rel","next",3,"textContent","click",4,"ngIf"],["id","op-pagination-empty-text","tabindex","0",1,"hidden-for-sighted",3,"textContent"],[1,"op-pagination--info"],["icon-classes","icon-info1 icon-context"],[1,"op-pagination--options"],[1,"op-pagination--items","op-pagination--items_end"],[1,"op-pagination--label",3,"textContent","title"],["type","button",1,"op-pagination--item-link",3,"textContent","click"]],template:function(J,W){1&J&&n.YNc(0,G,17,11,"div",0),2&J&&n.Q6J("ngIf",W.pagination&&W.isVisible&&W.pagination.total)},directives:[v.O5,v.sg,v.mk,c.o],encapsulation:2,changeDetection:0});const te=function(ce){return{"op-pagination--item_current":ce}};function ie(ce,J){if(1&ce&&(n.TgZ(0,"li",19),n.YNc(1,q,2,1,"em",6),n.YNc(2,se,1,1,"button",20),n.qZA()),2&ce){const W=J.$implicit,Y=n.oxw(3);n.Q6J("ngClass",n.VKq(3,te,W==Y.pagination.page)),n.xp6(1),n.Q6J("ngIf",W==Y.pagination.page),n.xp6(1),n.Q6J("ngIf",W!=Y.pagination.page)}}function le(ce,J){1&ce&&(n.TgZ(0,"li",14),n._uU(1,"\u2026"),n.qZA())}function oe(ce,J){if(1&ce&&(n.ynx(0),n.YNc(1,ie,3,5,"li",17),n.YNc(2,le,2,0,"li",18),n.BQk()),2&ce){const W=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",W.pageNumbers),n.xp6(1),n.Q6J("ngIf",W.postPageNumbers.length)}}function ne(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"li",15),n.TgZ(1,"button",16),n.NdJ("click",function(){const be=n.CHM(W).$implicit;return n.oxw(3).showPage(be)}),n.qZA(),n.qZA()}if(2&ce){const W=J.$implicit;n.xp6(1),n.Q6J("textContent",W)}}function fe(ce,J){if(1&ce&&(n.ynx(0),n.YNc(1,ne,2,1,"li",13),n.BQk()),2&ce){const W=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",W.postPageNumbers)}}function ve(ce,J){if(1&ce&&n._UZ(0,"span",21),2&ce){const W=n.oxw(2);n.Q6J("textContent",W.text.no_other_page)}}function Se(ce,J){if(1&ce&&(n.TgZ(0,"li",22),n._UZ(1,"op-icon",23),n._UZ(2,"span",9),n.qZA()),2&ce){const W=n.oxw(2);n.xp6(2),n.Q6J("textContent",W.infoText)}}function Oe(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"span"),n.TgZ(1,"button",27),n.NdJ("click",function(){n.CHM(W);const $=n.oxw().$implicit;return n.oxw(3).selectPerPage($)}),n.qZA(),n.qZA()}if(2&ce){const W=n.oxw().$implicit;n.xp6(1),n.Q6J("textContent",W)}}function je(ce,J){if(1&ce&&(n.TgZ(0,"span"),n._uU(1),n.qZA()),2&ce){const W=n.oxw().$implicit;n.xp6(1),n.Oqu(W)}}function tt(ce,J){if(1&ce&&(n.TgZ(0,"li",19),n.YNc(1,Oe,2,1,"span",6),n.YNc(2,je,2,1,"span",6),n.qZA()),2&ce){const W=J.$implicit,Y=n.oxw(3);n.Q6J("ngClass",n.VKq(3,te,W==Y.pagination.perPage)),n.xp6(1),n.Q6J("ngIf",W!=Y.pagination.perPage),n.xp6(1),n.Q6J("ngIf",W==Y.pagination.perPage)}}function He(ce,J){if(1&ce&&(n.TgZ(0,"div",24),n.TgZ(1,"ul",25),n._UZ(2,"li",26),n.YNc(3,tt,3,5,"li",17),n.qZA(),n.qZA()),2&ce){const W=n.oxw(2);n.xp6(2),n.s9C("title",W.text.per_page),n.Q6J("textContent",W.text.per_page),n.xp6(1),n.Q6J("ngForOf",W.perPageOptions)}}function st(ce,J){if(1&ce){const W=n.EpF();n.TgZ(0,"div",1),n.TgZ(1,"nav",2),n.TgZ(2,"ul",3),n.TgZ(3,"li",4),n.TgZ(4,"button",5),n.NdJ("click",function(){n.CHM(W);const $=n.oxw();return $.showPage($.pagination.page-1)}),n._uU(5," < "),n.qZA(),n.qZA(),n.YNc(6,K,4,1,"ng-container",6),n.YNc(7,oe,3,2,"ng-container",6),n.YNc(8,fe,2,1,"ng-container",6),n.TgZ(9,"li",4),n.TgZ(10,"button",7),n.NdJ("click",function(){n.CHM(W);const $=n.oxw();return $.showPage($.pagination.page+1)}),n._uU(11," > "),n.qZA(),n.qZA(),n.TgZ(12,"li",8),n._UZ(13,"span",9),n.YNc(14,ve,1,1,"span",10),n.qZA(),n.YNc(15,Se,3,1,"li",11),n.qZA(),n.qZA(),n.YNc(16,He,4,3,"div",12),n.qZA()}if(2&ce){const W=n.oxw();n.xp6(3),n.Q6J("hidden",1==W.pagination.page||!W.showPageSelections),n.xp6(1),n.uIk("aria-label",W.text.label_previous),n.xp6(2),n.Q6J("ngIf",W.prePageNumbers.length>0),n.xp6(1),n.Q6J("ngIf",W.pageNumbers.length>1),n.xp6(1),n.Q6J("ngIf",W.postPageNumbers.length),n.xp6(1),n.Q6J("hidden",!(W.pagination.total&&W.pagination.page<W.pageNumbers[W.pageNumbers.length-1])),n.xp6(1),n.uIk("aria-label",W.text.label_next),n.xp6(3),n.Q6J("textContent",W.currentRange),n.xp6(1),n.Q6J("ngIf",1===W.pageNumbers.length),n.xp6(1),n.Q6J("ngIf",W.infoText),n.xp6(1),n.Q6J("ngIf",W.showPerPageOptions())}}class Me extends Q{constructor(J,W,Y,$,be,N){super(J,W,N),this.paginationService=J,this.cdRef=W,this.wpTablePagination=Y,this.querySpace=$,this.wpTableSortBy=be,this.I18n=N}ngOnInit(){this.paginationService.loadPaginationOptions().then(J=>{this.perPageOptions=J.perPageOptions,this.cdRef.detectChanges()}),this.wpTablePagination.live$().pipe(this.untilDestroyed()).subscribe(J=>{this.pagination=J.current,this.update()}),(0,r.aj)([this.querySpace.query.values$(),this.wpTableSortBy.live$()]).pipe(this.untilDestroyed()).subscribe(([J,W])=>{this.showPerPage=this.showPageSelections=!this.isManualSortingMode,this.infoText=this.paginationInfoText(J.results),this.update()})}selectPerPage(J){this.paginationService.setPerPage(J),this.wpTablePagination.updateFromObject({page:1,perPage:J})}showPage(J){this.wpTablePagination.updateFromObject({page:J})}get isManualSortingMode(){return this.wpTableSortBy.isManualSortingMode}paginationInfoText(J){if(this.isManualSortingMode&&J.count<J.total)return I18n.t("js.work_packages.limited_results",{count:J.count})}}Me.\u0275fac=function(J){return new(J||Me)(n.Y36(m.N),n.Y36(n.sBO),n.Y36(e.S),n.Y36(h.q),n.Y36(d.q),n.Y36(i.D))},Me.\u0275cmp=n.Xpm({type:Me,selectors:[["wp-table-pagination"]],features:[n.qOj],decls:1,vars:1,consts:[["class","op-pagination",4,"ngIf"],[1,"op-pagination"],[1,"op-pagination--pages"],[1,"op-pagination--items","op-pagination--items_start"],[1,"op-pagination--item",3,"hidden"],["type","button","rel","prev start",1,"op-pagination--item-link","op-pagination--item-link_prev",3,"click"],[4,"ngIf"],["type","button","rel","next",1,"op-pagination--item-link","op-pagination--item-link_next",3,"click"],[1,"op-pagination--range"],[3,"textContent"],["id","op-pagination-empty-text","tabindex","0","class","hidden-for-sighted",3,"textContent",4,"ngIf"],["class","op-pagination--info",4,"ngIf"],["class","op-pagination--options",4,"ngIf"],["class","op-pagination--item",4,"ngFor","ngForOf"],[1,"op-pagination--space"],[1,"op-pagination--item"],["type","button","rel","next",1,"op-pagination--item-link",3,"textContent","click"],["class","op-pagination--item",3,"ngClass",4,"ngFor","ngForOf"],["class","op-pagination--space",4,"ngIf"],[1,"op-pagination--item",3,"ngClass"],["class","op-pagination--item-link","type","button","rel","next",3,"textContent","click",4,"ngIf"],["id","op-pagination-empty-text","tabindex","0",1,"hidden-for-sighted",3,"textContent"],[1,"op-pagination--info"],["icon-classes","icon-info1 icon-context"],[1,"op-pagination--options"],[1,"op-pagination--items","op-pagination--items_end"],[1,"op-pagination--label",3,"textContent","title"],["type","button",1,"op-pagination--item-link",3,"textContent","click"]],template:function(J,W){1&J&&n.YNc(0,st,17,11,"div",0),2&J&&n.Q6J("ngIf",W.pagination&&W.isVisible&&W.pagination.total)},directives:[v.O5,v.sg,v.mk,c.o],encapsulation:2,changeDetection:0})},42529:(X,I,t)=>{"use strict";t.d(I,{mN:()=>d,PY:()=>h,oo:()=>r,LT:()=>n,bz:()=>l,eY:()=>a,$r:()=>v,GC:()=>c,g5:()=>p,O6:()=>f,lW:()=>C,jr:()=>u,kv:()=>k,Nm:()=>O});var i=t(2281);const d="timeline-element",h="timeline-element--bg",r="wp-timeline--grid-element",n="selection-start",l="wp-timeline--header-element",a="wp-timeline-header";class m{constructor(){this.zoomLevel="days"}}const v=["days","weeks","months","quarters","years"];function c(y){switch(y){case"days":return 30;case"weeks":return 15;case"months":return 6;case"quarters":return 2;case"years":return.5}throw new Error(`invalid zoom level: ${y}`)}const p=120;class f{constructor(){this.now=i({hour:0,minute:0,seconds:0}),this.dateDisplayStart=i({hour:0,minute:0,seconds:0}),this.dateDisplayEnd=this.dateDisplayStart.clone().add(1,"day"),this.settings=new m,this.activeSelectionMode=null,this.selectionModeStart=null}get pixelPerDay(){return c(this.settings.zoomLevel)}get maxWidthInPx(){return this.maxSteps*this.pixelPerDay}get maxSteps(){return this.dateDisplayEnd.diff(this.dateDisplayStart,"days")}get dayCountForMarginLeft(){return Math.ceil(p/this.pixelPerDay)}}function C(y,b){return b*y.pixelPerDay}function u(y,b){return`${C(y,b)}px`}function k(y,b,P,E){const T=[],M=[],S=P.clone().startOf(b),R=E.clone().endOf(b);for(;S.isBefore(R);){const G=i.max(S,P).clone(),Q=i.min(S.clone().endOf(b),E).clone();S.add(1,b);const V=y.visibleViewportAtCalculationTime;G.isSameOrAfter(V[0])&&G.isSameOrBefore(V[1])||Q.isSameOrAfter(V[0])&&Q.isSameOrBefore(V[1])?T.push([G,Q]):M.push([G,Q])}const F=M.splice(0,1)[0],L=M.pop();return{inViewportAndBoundaries:_.concat([F].filter(G=>!_.isNil(G)),T,[L].filter(G=>!_.isNil(G))),rest:M}}function O(y,b,P){let E=i(),T=i();return y.forEach(S=>{const R=S.workPackageId;if(!R)return;const L=b.get(R).value;if(!L)return;const D=L.startDate?L.startDate:L.date;D&&i(D).isBefore(E)&&(E=i(D));const G=L.dueDate?L.dueDate:L.date;G&&i(G).isAfter(T)&&(T=i(G))}),T.diff(E,"days")+1}},45338:(X,I,t)=>{"use strict";t.d(I,{O:()=>i});class i{constructor(d){this.tableVisible=!0,this.compactTableStyle=!1,this.actionsColumnEnabled=!0,this.contextMenuEnabled=!0,this.columnMenuEnabled=!0,this.projectContext=!0,this.projectIdentifier=null,this.inlineCreateEnabled=!0,this.hierarchyToggleEnabled=!0,this.dragAndDropEnabled=!1,this.isEmbedded=!1,this.isCardView=!1,this.withFilters=!1,this.filtersExpanded=!1,this.showFilterButton=!1,this.filterButtonText=I18n.t("js.button_filter"),_.each(d,(h,r)=>{this[r]=h})}}},9822:(X,I,t)=>{"use strict";t.d(I,{UX:()=>e,e9:()=>a});const e=".work-packages-tabletimeline--timeline-side",d=".scroll-sync";function n(m){if(0===m)return m;let v=15;return m<0&&(v*=-1),v}function l(m,v,c){const p=m.target,f=m.originalEvent;let[C,u]=function(m){let v=m.deltaX,c=m.deltaY;return m.shiftKey&&(v=c,c=0),[v,c]}(f);0!==u&&(C=n(C),u=n(u),window.requestAnimationFrame(()=>{v[0].scrollTop=v[0].scrollTop+u,c[0].scrollTop=v[0].scrollTop+u,p.scrollLeft+=C}))}function a(m){const v=jQuery(m).find(".work-packages-tabletimeline--table-side"),c=jQuery(m).find(e);return p=>{let f=!1,C=!1;p?(v.on(`wheel${d}`,u=>{l(u,v,c)}),v.on(`scroll${d}`,u=>{f=!0,C||(c[0].scrollTop=u.target.scrollTop),f&&C&&(f=!1,C=!1)}),c.on(`wheel${d}`,u=>{l(u,v,c)}),c.on(`scroll${d}`,u=>{C=!0,f||(v[0].scrollTop=u.target.scrollTop),f&&C&&(f=!1,C=!1)})):v.off(d)}}},18942:(X,I,t)=>{"use strict";t.d(I,{c:()=>ut});var i=t(2316),e=t(96617),d=t(3786),h=t(22663),r=t(83720),n=t(43440),l=t(84897),a=t(29161);class m{constructor(ke,Te){this.injector=ke,this.wpTableHighlighting.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,r.x)()).subscribe(()=>Te.redrawTable())}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",l.B)],m.prototype,"wpTableHighlighting",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],m.prototype,"querySpace",void 0);var v=t(53466),c=t(8403),p=t(67727),f=t(82763),C=t(16451),u=t(87853),k=t(21680),O=t(45237),y=t(68354),b=t(95846),P=t(1056),E=t(61043),T=t(61908),M=t(99919),S=t(32030);class R{constructor(ke,Te){this.injector=ke,this.table=Te,null!==this.dragService&&(this.inlineCreateService.newInlineWorkPackageCreated.pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(Re=>(0,d.mG)(this,void 0,void 0,function*(){const $e=yield this.wpTableOrder.add(this.currentOrder,Re);this.updateRenderedOrder($e)})),this.querySpace.stopAllSubscriptions.pipe((0,v.q)(1)).subscribe(()=>{this.dragService.remove(this.table.tbody)}),this.dragService.register({dragContainer:this.table.tbody,scrollContainers:[this.table.scrollContainer],accepts:()=>!0,moves:(Re,$e,ot)=>{if(!ot.classList.contains("wp-table--drag-and-drop-handle"))return!1;const dt=Re.dataset.workPackageId,_t=this.states.workPackages.get(dt).value;return!!_t&&this.actionService.canPickup(_t)},onMoved:(Re,$e,ot,dt)=>(0,d.mG)(this,void 0,void 0,function*(){const _t=Re.dataset.workPackageId;let Ut;try{const Lt=yield this.apiV3Service.work_packages.id(_t).get().toPromise();if((0,M._D)(dt)){const mi=Array.from(dt.classList).find(Kt=>Kt.includes((0,S.xU)())).replace((0,S.xU)(),""),Ci=ot.getElementsByClassName((0,S.xU)(mi)),Zi=Ci[Ci.length-1];Ut=this.findRowIndex(Zi)}else Ut=this.findRowIndex(Re);const Xt=yield this.wpTableOrder.move(this.currentOrder,_t,Ut);yield this.actionService.handleDrop(Lt,Re),this.updateRenderedOrder(Xt),this.actionService.onNewOrder(Xt);const zt=this.querySpace.query.value;zt&&this.wpTableSortBy.switchToManualSorting(zt)&&(yield this.wpListService.createOrSave(zt))}catch(Lt){this.halNotification.handleRawError(Lt),this.actionService.changeShadowElement(Re,!0),(0,y.d)(Re,Re.dataset.sourceIndex||-1,ot)}}),onRemoved:Re=>{const $e=Re.dataset.workPackageId,ot=this.wpTableOrder.remove(this.currentOrder,$e);this.updateRenderedOrder(ot)},onAdded:Re=>(0,d.mG)(this,void 0,void 0,function*(){const $e=Re.dataset.workPackageId,ot=yield this.apiV3Service.work_packages.id($e).get().toPromise(),dt=this.findRowIndex(Re);return this.actionService.handleDrop(ot,Re).then(()=>(0,d.mG)(this,void 0,void 0,function*(){const _t=yield this.wpTableOrder.add(this.currentOrder,$e,dt);return this.updateRenderedOrder(_t),this.actionService.onNewOrder(_t),!0})).catch(()=>!1)}),onCloned:(Re,$e)=>(0,d.mG)(this,void 0,void 0,function*(){const ot=$e.dataset.workPackageId,dt=yield this.apiV3Service.work_packages.id(ot).get().toPromise(),_t=Re.children.length,Ut=document.createElement("td");Ut.textContent=dt.subjectWithId(),Ut.colSpan=_t,Ut.classList.add("wp-table--cell-td","subject"),Re.style.maxWidth="500px",Re.innerHTML=Ut.outerHTML}),onShadowInserted:Re=>{this.browserDetector.isEdge||this.actionService.changeShadowElement(Re)},onCancel:Re=>{this.browserDetector.isEdge||this.actionService.changeShadowElement(Re,!0)}}))}updateRenderedOrder(ke){return(0,d.mG)(this,void 0,void 0,function*(){ke=_.uniq(ke);const Te=yield Promise.all(ke.map(Re=>this.apiV3Service.work_packages.id(Re).get().toPromise()));this.table.initialSetup(Te)})}get actionService(){return this.dragActionRegistry.get(this.injector)}get currentOrder(){return this.currentRenderedOrder.map(ke=>ke.workPackageId)}get currentRenderedOrder(){return this.querySpace.renderedWorkPackages.getValueOr([])}findRowIndex(ke){return Array.from(this.table.tbody.getElementsByClassName(k.S)).indexOf(ke)||0}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",u.G)],R.prototype,"states",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],R.prototype,"querySpace",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",c.m)],R.prototype,"inlineCreateService",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",p.W)],R.prototype,"halNotification",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",f.q)],R.prototype,"wpTableSortBy",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",b.M)],R.prototype,"wpTableOrder",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",P.o)],R.prototype,"browserDetector",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",T.T)],R.prototype,"apiV3Service",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",E.Z)],R.prototype,"wpListService",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",C.B)],R.prototype,"dragActionRegistry",void 0),(0,d.gn)([(0,a.W)(O.j,null),(0,d.w6)("design:type",Object)],R.prototype,"dragService",void 0);var F=t(55236),L=t(79174);class D{constructor(ke,Te){this.injector=ke,this.workPackageViewCollapsedGroupsService.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,r.x)()).subscribe(Re=>Te.setGroupsCollapseState(Re.state))}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",L.q)],D.prototype,"workPackageViewCollapsedGroupsService",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],D.prototype,"querySpace",void 0);var G=t(7812),Q=t(12703),V=t(88837),K=t(3352),q=t(52787);class se extends q.X{constructor(ke){super(),this.injector=ke}get EVENT(){return"click.table.cell, keydown.table.cell"}get SELECTOR(){return`.${G.OZ}.${G.c0}`}eventScope(ke){return jQuery(ke.workPackageTable.tableAndTimelineContainer)}processEvent(ke,Te){(0,K.qu)("Starting editing on cell: ",Te.target),Te.preventDefault();const Re=jQuery(Te.target).closest(`.${G.OZ}`),$e=Re.data("fieldName");if(!$e)return(0,K.qu)("Click handled by cell not a field? ",Te.target),!0;const ot=Re.closest(`.${k.S}`),dt=ot.data("workPackageId"),_t=this.states.workPackages.get(dt).value,Ut=ot.data("classIdentifier"),Lt=ke.editing.startEditing(_t,Ut),Xt=(0,V.b)(Te);return Lt.activate($e).then(zt=>{zt.$onUserActivate.next(),zt.focus(Xt)}).catch(()=>Re.addClass(G.n5)),!1}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",u.G)],se.prototype,"states",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Q.l)],se.prototype,"halEditing",void 0);var te=t(41195),ie=t(33791);class le extends q.X{constructor(ke){super(),this.injector=ke}get EVENT(){return"click.table.relationsCell, keydown.table.relationsCell"}get SELECTOR(){return`.${ie._M}`}eventScope(ke){return jQuery(ke.workPackageTable.tableAndTimelineContainer)}processEvent(ke,Te){(0,K.qu)("Handled click on relation cell %o",Te.target),Te.preventDefault();const $e=jQuery(Te.target).closest(`.${ie.OR}`).data("columnId"),dt=jQuery(Te.target).closest(`.${k.S}`).data("workPackageId");return this.wpTableRelationColumns.getExpandFor(dt)===$e?this.wpTableRelationColumns.collapse(dt):this.wpTableRelationColumns.setExpandFor(dt,$e),!1}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",te.a)],le.prototype,"wpTableRelationColumns",void 0);var oe=t(85003),ne=t(20506),fe=t(20342),ve=t(99794),Se=t(16793);class Oe extends ve.X{constructor(ke,Te,Re,$e={},ot){super(ke,Te,Re,$e,!0),this.injector=ke,this.workPackageId=Te,this.$element=Re,this.additionalPositionArgs=$e,this.table=ot}triggerContextMenuAction(ke){switch(ke.key){case"relation-precedes":this.table.timelineController.startAddRelationPredecessor(this.workPackage);break;case"relation-follows":this.table.timelineController.startAddRelationFollower(this.workPackage);break;case"hierarchy-indent":this.wpViewIndentation.indent(this.workPackage);break;case"hierarchy-outdent":this.wpViewIndentation.outdent(this.workPackage);break;default:super.triggerContextMenuAction(ke)}}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Se.f)],Oe.prototype,"wpViewIndentation",void 0);class je{constructor(ke){this.injector=ke}get rowSelector(){return`.${k.S}`}eventScope(ke){return jQuery(ke.workPackageTable.tableAndTimelineContainer)}openContextMenu(ke,Te,Re,$e){const ot=new Oe(this.injector,Re,jQuery(Te.target),$e,ke);this.opContextMenu.show(ot,Te)}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",fe.$)],je.prototype,"opContextMenu",void 0);class tt extends je{constructor(ke){super(ke),this.injector=ke}get EVENT(){return"click.table.contextmenu"}get SELECTOR(){return`.${oe.E4}`}handleEvent(ke,Te){const Re=jQuery(Te.target);if(Re.closest(`.${ne.yF}`).length)return(0,K.qu)("Allowing original context menu on state link"),!0;Te.preventDefault(),Te.stopPropagation();const ot=Re.closest(this.rowSelector).data("workPackageId");return ot&&this.openContextMenu(ke.workPackageTable,Te,ot),!1}}var He=t(33406);class st extends je{constructor(ke){super(ke),this.injector=ke}get EVENT(){return"keydown.table.contextmenu"}get SELECTOR(){return this.rowSelector}handleEvent(ke,Te){if(!ke.workPackageTable.configuration.contextMenuEnabled)return!1;const Re=jQuery(Te.target);if(Te.keyCode!==He.m.F10||!Te.shiftKey||!Te.altKey)return!0;Te.preventDefault(),Te.stopPropagation();const ot=Re.closest(this.SELECTOR).data("workPackageId"),dt={my:"left top",at:"left bottom",of:Re};return super.openContextMenu(ke.workPackageTable,Te,ot,dt),!1}}var Me=t(60914),ce=t(77850);class J extends je{constructor(ke){super(ke),this.injector=ke}get EVENT(){return"contextmenu.table.rightclick"}get SELECTOR(){return`.${k.S},.${ce.j}`}eventScope(ke){return jQuery(ke.workPackageTable.tableAndTimelineContainer)}handleEvent(ke,Te){if(!ke.workPackageTable.configuration.contextMenuEnabled)return!1;const Re=jQuery(Te.target);if(Re.closest(`.${ne.yF}`).length)return(0,K.qu)("Allowing original context menu on state link"),!0;Te.preventDefault(),Te.stopPropagation();const ot=Re.closest(this.SELECTOR).data("workPackageId");if(ot){const[dt]=ke.workPackageTable.findRenderedRow(ot);this.wpTableSelection.isSelected(ot)||this.wpTableSelection.setSelection(ot,dt),this.openContextMenu(ke.workPackageTable,Te,ot)}return!1}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Me.J)],J.prototype,"wpTableSelection",void 0);var W=t(47775),Y=t(48451),$=t(91260),be=t(84109);class N{constructor(ke){this.injector=ke}get EVENT(){return"click.table.row"}get SELECTOR(){return`.${k.S}`}eventScope(ke){return jQuery(ke.workPackageTable.tbody)}handleEvent(ke,Te){const Re=jQuery(Te.target);if(Re.is("a")||Re.parent().is("a"))return!0;if(Re.hasClass(`${G.OZ}`)||Re.hasClass(`${$.as}`))return(0,K.qu)("Skipping click on inner cell"),!0;const $e=Re.closest(this.SELECTOR),ot=$e.data("workPackageId"),dt=$e.data("classIdentifier");if(!ot)return!0;const[_t,Ut]=ke.workPackageTable.findRenderedRow(dt);return Te.ctrlKey||Te.metaKey||Te.shiftKey||(this.wpTableSelection.setSelection(ot,_t),ke.itemClicked.emit({workPackageId:ot,double:!1})),Te.shiftKey&&this.wpTableSelection.setMultiSelectionFrom(ke.workPackageTable.renderedRows,ot,_t),(Te.ctrlKey||Te.metaKey)&&this.wpTableSelection.toggleRow(ot),ke.selectionChanged.emit(this.wpTableSelection.getSelectedWorkPackageIds()),this.wpTableFocus.updateFocus(ot),!1}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",W.StateService)],N.prototype,"$state",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",u.G)],N.prototype,"states",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",be.p)],N.prototype,"keepTab",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Me.J)],N.prototype,"wpTableSelection",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Y.o)],N.prototype,"wpTableFocus",void 0);var Ue=t(67325),et=t(88156);class Ke{constructor(ke){this.injector=ke}get EVENT(){return"dblclick.table.row"}get SELECTOR(){return`.${et.Nm}`}eventScope(ke){return jQuery(ke.workPackageTable.tbody)}handleEvent(ke,Te){const Re=jQuery(Te.target);if((0,Ue.F)(Te))return!0;if(Re.hasClass(`${G.OZ}`)||Re.hasClass(`${$.as}`))return(0,K.qu)("Skipping click on inner cell"),!0;const ot=Re.closest(this.SELECTOR).closest(`.${k.S}`).data("workPackageId");return!(!Re.is("a")&&!Re.parent().is("a"))||(this.wpTableFocus.updateFocus(ot),ke.itemClicked.emit({workPackageId:ot,double:!0}),!1)}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",W.StateService)],Ke.prototype,"$state",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",u.G)],Ke.prototype,"states",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Me.J)],Ke.prototype,"wpTableSelection",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Y.o)],Ke.prototype,"wpTableFocus",void 0);var _e=t(68130);class ye{constructor(ke){this.injector=ke}get EVENT(){return"click.table.groupheader"}get SELECTOR(){return`.${_e.u} .expander`}eventScope(ke){return jQuery(ke.workPackageTable.tbody)}handleEvent(ke,Te){Te.preventDefault(),Te.stopPropagation();const $e=jQuery(Te.target).parents(`.${_e.u}`).data("groupIdentifier");this.workPackageViewCollapsedGroupsService.toggleGroupCollapseState($e)}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],ye.prototype,"querySpace",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",L.q)],ye.prototype,"workPackageViewCollapsedGroupsService",void 0);var Pe=t(99676);class Ee extends q.X{constructor(ke){super(),this.injector=ke}get EVENT(){return"click.table.hierarchy"}get SELECTOR(){return".wp-table--hierarchy-indicator"}eventScope(ke){return jQuery(ke.workPackageTable.tbody)}processEvent(ke,Te){const ot=jQuery(Te.target).closest(`.${k.S}`).data("workPackageId");return this.wpTableHierarchies.toggle(ot),Te.stopImmediatePropagation(),Te.preventDefault(),!1}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",u.G)],Ee.prototype,"states",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Pe.Y)],Ee.prototype,"wpTableHierarchies",void 0);class Qe{constructor(ke){this.injector=ke}get EVENT(){return"click.table.wpLink"}get SELECTOR(){return`.${ne.yF}`}eventScope(ke){return jQuery(ke.workPackageTable.tableAndTimelineContainer)}handleEvent(ke,Te){if(Te.shiftKey||Te.ctrlKey||Te.metaKey||Te.altKey)return!0;const Re=jQuery(Te.target),$e=Re.closest(this.SELECTOR),ot=$e.data("wpState"),dt=$e.data("workPackageId");Re.closest("a").blur();const Ut=Re.closest(`.${k.S}`).data("classIdentifier"),[Lt,Xt]=ke.workPackageTable.findRenderedRow(Ut);return this.wpTableSelection.setSelection(dt,Lt),ke.stateLinkClicked.emit({workPackageId:dt,requestedState:ot}),Te.preventDefault(),Te.stopPropagation(),!1}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",W.StateService)],Qe.prototype,"$state",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",be.p)],Qe.prototype,"keepTab",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",u.G)],Qe.prototype,"states",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Me.J)],Qe.prototype,"wpTableSelection",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Y.o)],Qe.prototype,"wpTableFocus",void 0);var nt=t(71562);class ct{constructor(ke,Te){this.injector=ke,this.table=Te,this.wpTableColumns.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(()=>{if(Te.originalRows.length>0){const Re=performance.now();Te.redrawTable();const $e=performance.now();(0,K.qu)(`column redraw took ${$e-Re} milliseconds.`)}})}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],ct.prototype,"querySpace",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",nt.i)],ct.prototype,"wpTableColumns",void 0);var lt=t(33927),Ne=t(9170),Ae=t(67362);class xe{constructor(ke,Te){this.injector=ke,this.wpTableHierarchies.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,lt.U)($e=>$e.isVisible),(0,r.x)()).subscribe(()=>{this.wpTableHierarchies.isEnabled||Te.redrawTableAndTimeline()});let Re=this.wpTableHierarchies.isEnabled;this.wpTableHierarchies.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,Ne.h)(()=>this.querySpace.tableRendered.hasValue())).subscribe($e=>{$e.isVisible===Re&&this.renderHierarchyState($e),Re=$e.isVisible})}renderHierarchyState(ke){const Te=this.querySpace.tableRendered.value;jQuery('[class^="__hierarchy-group-"]').removeClass(($e,ot)=>(ot.match(/__collapsed-group-\d+/g)||[]).join(" "));const Re={};_.each(ke.collapsed,($e,ot)=>{jQuery(`.${(0,S.MO)(ot)} .wp-table--hierarchy-indicator`).toggleClass(Ae.YZ,$e);const dt=document.querySelector(`.wp-timeline-cell.__hierarchy-root-${ot}`);dt&&($e?dt.classList.add("__hierarchy-root-collapsed"):dt.classList.remove("__hierarchy-root-collapsed"));const _t=jQuery(`.${(0,S.oQ)(ot)}`);_t.toggleClass((0,S.xU)(ot),$e),_t.filter(`.${k.S}`).each((Ut,Lt)=>{const Xt=jQuery(Lt).index();Re[Xt]||(Te[Xt].hidden=$e,Re[Xt]=$e)})}),ke.last&&(0,M.Ui)(ke.last),this.querySpace.tableRendered.putValue(Te,"Updated hidden state of rows after hierarchy change.")}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Pe.Y)],xe.prototype,"wpTableHierarchies",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],xe.prototype,"querySpace",void 0);class Ye{constructor(ke,Te){this.injector=ke,this.wpTableRelationColumns.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(()=>{Te.redrawTableAndTimeline()})}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",te.a)],Ye.prototype,"wpTableRelationColumns",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],Ye.prototype,"querySpace",void 0);class mt{constructor(ke,Te){this.injector=ke,this.table=Te,this.querySpace.initialized.values$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(()=>{let Re;Re=this.wpTableSortBy.isManualSortingMode?this.wpTableOrder.orderedWorkPackages():this.querySpace.results.value.elements,Te.initialSetup(Re)}),this.states.workPackages.observeChange().pipe((0,h.R)(this.querySpace.stopAllSubscriptions.asObservable()),(0,Ne.h)(()=>{const Re=this.querySpace.tableRendered.getValueOr([]);return Re&&Re.length>0})).subscribe(([Re,$e])=>{void 0!==$e&&this.table.refreshRows($e)})}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],mt.prototype,"querySpace",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",f.q)],mt.prototype,"wpTableSortBy",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",b.M)],mt.prototype,"wpTableOrder",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",u.G)],mt.prototype,"states",void 0);var Ot=t(7101);class Pt{constructor(ke,Te){this.injector=ke,this.table=Te,this.querySpace.tableRendered.values$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(()=>{this.wpTableFocus.ifShouldFocus(Re=>{const $e=(0,M.Fb)(Re);$e.length&&((0,M.Ui)(Re),this.FocusHelper.focus($e[0]))})}),this.wpTableSelection.live$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(Re=>{this.renderSelectionState(Re)}),this.wpTableSelection.registerSelectAllListener(()=>Te.renderedRows),this.wpTableSelection.registerDeselectAllListener()}renderSelectionState(ke){const Te=jQuery(this.table.tableAndTimelineContainer);Te.find(`.${k.S}.${ne.HZ}`).removeClass(ne.HZ),_.each(ke.selected,(Re,$e)=>{Te.find(`.${k.S}[data-work-package-id="${$e}"]`).toggleClass(ne.HZ,Re)})}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Me.J)],Pt.prototype,"wpTableSelection",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Y.o)],Pt.prototype,"wpTableFocus",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],Pt.prototype,"querySpace",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Ot.i)],Pt.prototype,"FocusHelper",void 0);var Mt=t(73165);class yt{constructor(ke,Te){this.injector=ke,this.table=Te,this.wpTableTimeline.live$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(Re=>{this.renderVisibility(Re.visible)})}renderVisibility(ke){const Te=jQuery(this.table.tableAndTimelineContainer).parent();Te.find(".work-packages-tabletimeline--timeline-side").toggle(ke),Te.find(".work-packages-tabletimeline--table-side").toggleClass("-timeline-visible",ke)}}(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",n.q)],yt.prototype,"querySpace",void 0),(0,d.gn)([(0,a.W)(),(0,d.w6)("design:type",Mt.W)],yt.prototype,"wpTableTimeline",void 0);class jt extends F.A{constructor(){super(...arguments),this.eventHandlers=[()=>new Ee(this.injector),()=>new se(this.injector),()=>new Qe(this.injector),()=>new N(this.injector),()=>new Ke(this.injector),()=>new ye(this.injector),()=>new J(this.injector),()=>new tt(this.injector),()=>new st(this.injector),()=>new le(this.injector)],this.stateTransformers=[Pt,mt,ct,D,yt,xe,Ye,m,R]}attachTo(ke){this.stateTransformers.map(Te=>new Te(this.injector,ke.workPackageTable)),super.attachTo(ke)}}var Jt=t(61486),Ft=t(43682),It=t(61083),gt=t(9822);const kt="row-hovered";class ti{constructor(ke){this.tableAndTimeline=ke,this.lastHoveredElement=null,this.eventListener=Te=>{const Re=Te.target;Re&&Re!==this.lastHoveredElement&&this.handleHover(Re),this.lastHoveredElement=Re}}activate(){window.addEventListener("mousemove",this.eventListener,{passive:!0})}deactivate(){window.removeEventListener("mousemove",this.eventListener),this.removeAllHoverClasses()}locateHoveredTableRow(ke){const Te=ke.closest("tr");return 0===Te.length?null:Te[0]}locateHoveredTimelineRow(ke){const Te=ke.closest("div.wp-timeline-cell");return 0===Te.length?null:Te[0]}handleHover(ke){const Te=jQuery(ke),Re=this.locateHoveredTableRow(Te),$e=this.locateHoveredTimelineRow(Te);null!==Re||null!==$e?this.removeOldAndAddNewHoverClass(Re,$e):this.removeAllHoverClasses()}extractWorkPackageId(ke){return parseInt(ke.getAttribute("data-work-package-id"))}removeOldAndAddNewHoverClass(ke,Te){const Re=null!==ke?ke:Te,$e=this.extractWorkPackageId(Re),ot=this.tableAndTimeline.find(`tr.wp-row-${$e}`).first(),dt=this.tableAndTimeline.find(`div.wp-row-${$e}`).length?this.tableAndTimeline.find(`div.wp-row-${$e}`).first():this.tableAndTimeline.find(`div.wp-ancestor-row-${$e}`).first();requestAnimationFrame(()=>{this.removeAllHoverClasses(),dt.addClass(kt),ot.addClass(kt)})}removeAllHoverClasses(){this.tableAndTimeline.find(`.${kt}`).removeClass(kt)}}var ii=t(55054),$t=t(26942),vt=t(82271),Ht=t(45338);function Wt(ze,ke){1&ze&&i._UZ(0,"col")}function it(ze,ke){1&ze&&i._UZ(0,"col",19)}function de(ze,ke){1&ze&&i._UZ(0,"col",19)}function ae(ze,ke){1&ze&&i._UZ(0,"col")}function pe(ze,ke){1&ze&&i._UZ(0,"op-icon",23)}function H(ze,ke){if(1&ze&&(i.TgZ(0,"th",20),i.TgZ(1,"div",21),i.YNc(2,pe,1,0,"op-icon",22),i.qZA(),i.qZA()),2&ze){const Te=i.oxw(2);i.xp6(2),i.Q6J("ngIf",Te.manualSortEnabled)}}const he=function(ze){return{"-max":ze}};function ue(ze,ke){if(1&ze&&(i.TgZ(0,"th",24),i._UZ(1,"sortHeader",25),i.qZA()),2&ze){const Te=ke.$implicit,Re=i.oxw(2);i.Q6J("ngClass",i.VKq(6,he,"subject"===Te.id)),i.xp6(1),i.Q6J("headerColumn",Te)("locale",Te.custom_field&&Te.custom_field.name_locale||Re.locale)("table",Re.workPackageTable)("opColumnsContextMenu-column",Te)("opColumnsContextMenu-table",Re.workPackageTable)}}function Le(ze,ke){1&ze&&(i.TgZ(0,"div",28),i._UZ(1,"wp-table-config-menu"),i.qZA())}function ht(ze,ke){if(1&ze&&(i.TgZ(0,"th",26),i.YNc(1,Le,2,0,"div",27),i.qZA()),2&ze){const Te=i.oxw(2);i.xp6(1),i.Q6J("ngIf",Te.configuration.columnMenuEnabled)}}function pt(ze,ke){if(1&ze&&(i.TgZ(0,"tbody",29),i.TgZ(1,"tr",30),i.TgZ(2,"td"),i.TgZ(3,"span"),i._UZ(4,"op-icon",31),i.TgZ(5,"span"),i.TgZ(6,"strong"),i._uU(7),i.qZA(),i._uU(8),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.qZA()),2&ze){const Te=i.oxw(2);i.xp6(2),i.uIk("colspan",Te.columns.length+2),i.xp6(5),i.Oqu(Te.text.noResults.title),i.xp6(1),i.hij(" ",Te.text.noResults.description," ")}}function Zt(ze,ke){if(1&ze){const Te=i.EpF();i.TgZ(0,"tbody",32),i.NdJ("wp-inline-create--showing",function($e){i.CHM(Te);return i.oxw(2).inlineCreateVisible=$e}),i.qZA()}if(2&ze){const Te=i.oxw(2);i.Q6J("wp-inline-create--table",Te.workPackageTable)("wp-inline-create--project-identifier",Te.projectIdentifier)}}function Ct(ze,ke){1&ze&&(i.TgZ(0,"div",33),i._UZ(1,"wp-resizer",34),i.qZA()),2&ze&&(i.xp6(1),i.Q6J("elementClass","work-packages-tabletimeline--timeline-side")("resizeEvent","wp-resize.timeline")("localStorageKey","openProject-timelineFlexBasis"))}const ni=function(){return[]},_i=function(ze,ke){return{"-single-margin":ze,"-double-margin":ke}};function ri(ze,ke){if(1&ze&&(i.TgZ(0,"div",1),i.TgZ(1,"div",2),i.TgZ(2,"table",3),i.TgZ(3,"colgroup"),i.YNc(4,Wt,1,0,"col",4),i.YNc(5,it,1,0,"col",5),i.YNc(6,de,1,0,"col",6),i.YNc(7,ae,1,0,"col",4),i.qZA(),i.TgZ(8,"caption",7),i.TgZ(9,"span"),i._uU(10),i.qZA(),i._UZ(11,"span",8),i.TgZ(12,"span"),i._uU(13),i.qZA(),i.qZA(),i.TgZ(14,"thead",9),i.TgZ(15,"tr"),i.YNc(16,H,3,1,"th",10),i.YNc(17,ue,2,8,"th",11),i.YNc(18,ht,2,1,"th",12),i.qZA(),i.qZA(),i.YNc(19,pt,9,3,"tbody",13),i._UZ(20,"tbody",14),i.TgZ(21,"tbody"),i._UZ(22,"tr",15),i.qZA(),i.YNc(23,Zt,1,2,"tbody",16),i.qZA(),i.qZA(),i.YNc(24,Ct,2,3,"div",17),i.TgZ(25,"div",18),i._UZ(26,"wp-timeline-container"),i.qZA(),i.qZA()),2&ze){const Te=i.oxw();i.xp6(4),i.Q6J("ngIf",Te.configuration.dragAndDropEnabled),i.xp6(1),i.Q6J("ngForOf",i.DdM(15,ni).constructor(Te.columns.length)),i.xp6(1),i.Q6J("ngIf",Te.configuration.columnMenuEnabled),i.xp6(1),i.Q6J("ngIf",!Te.configuration.columnMenuEnabled),i.xp6(3),i.Oqu(Te.text.tableSummary),i.xp6(3),i.Oqu(Te.text.tableSummaryHints),i.xp6(3),i.Q6J("ngIf",Te.configuration.dragAndDropEnabled),i.xp6(1),i.Q6J("ngForOf",Te.columns)("ngForTrackBy",Te.trackByHref),i.xp6(1),i.Q6J("ngIf",Te.configuration.columnMenuEnabled||Te.configuration.actionsColumnEnabled),i.xp6(1),i.Q6J("ngIf",!Te.isEmbedded&&Te.query&&0===Te.results.count),i.xp6(3),i.Q6J("wpTableSumsRow-table",Te.workPackageTable),i.xp6(1),i.Q6J("ngIf",Te.tableElement&&Te.configuration.inlineCreateEnabled),i.xp6(1),i.Q6J("ngIf",!Te.configuration.isEmbedded),i.xp6(1),i.Q6J("ngClass",i.WLB(16,_i,(Te.sumVisible||Te.inlineCreateVisible)&&!(Te.sumVisible&&Te.inlineCreateVisible),Te.sumVisible&&Te.inlineCreateVisible))}}class ut extends $t.N{constructor(ke,Te,Re,$e,ot,dt,_t,Ut,Lt,Xt,zt,li){super(),this.elementRef=ke,this.injector=Te,this.states=Re,this.querySpace=$e,this.I18n=ot,this.cdRef=dt,this.zone=_t,this.wpTableGroupBy=Ut,this.wpTableTimeline=Lt,this.wpTableColumns=Xt,this.wpTableSortBy=zt,this.wpTableSums=li,this.selectionChanged=new i.vpe,this.itemClicked=new i.vpe,this.stateLinkClicked=new i.vpe,this.trackByHref=Ft.u9,this.limitedResults=!1,this.inlineCreateVisible=!1,this.sumVisible=!1}ngOnInit(){this.configuration=new Ht.O(this.configurationObject),this.$element=jQuery(this.elementRef.nativeElement),this.querySpace.stopAllSubscriptions.next(),this.locale=I18n.locale,this.text={cancel:I18n.t("js.button_cancel"),noResults:{title:I18n.t("js.work_packages.no_results.title"),description:I18n.t("js.work_packages.no_results.description")},limitedResults:(Te,Re)=>I18n.t("js.work_packages.limited_results",{count:Te,total:Re}),tableSummary:I18n.t("js.work_packages.table.summary"),tableSummaryHints:[I18n.t("js.work_packages.table.text_inline_edit"),I18n.t("js.work_packages.table.text_select_hint"),I18n.t("js.work_packages.table.text_sort_hint")].join(" ")},(0,Jt.aj)([this.querySpace.results.values$(),this.wpTableGroupBy.live$(),this.wpTableColumns.live$(),this.wpTableTimeline.live$(),this.wpTableSortBy.live$(),this.wpTableSums.live$()]).pipe(this.untilDestroyed()).subscribe(([Te,Re,$e,ot,dt,_t])=>{this.query=this.querySpace.query.value,this.results=Te,this.sumVisible=_t,this.groupBy=Re,this.columns=$e,this.numTableColumns=this.columns.length+2,this.scrollSyncUpdate&&this.timelineVisible!==ot.visible&&this.scrollSyncUpdate(ot.visible),this.timelineVisible=ot.visible,this.manualSortEnabled=this.wpTableSortBy.isManualSortingMode,this.limitedResults=this.manualSortEnabled&&Te.total>Te.count,this.cdRef.detectChanges()}),this.cdRef.detectChanges()}ngOnDestroy(){super.ngOnDestroy(),this.wpTableHoverSync.deactivate()}registerTimeline(ke,Te){const Re=this.$element.find(".work-package--results-tbody"),$e=this.$element.find(".work-package-table--container")[0];this.workPackageTable=new ii.t(this.injector,this.$element[0],$e,Re[0],Te,ke,this.configuration),this.tbody=Re,ke.workPackageTable=this.workPackageTable,new jt(this.injector).attachTo(this);const ot=this.getTableAndTimelineElement();this.tableElement=ot[0],this.timeline=ot[1],this.wpTableHoverSync=new ti(this.$element),this.wpTableHoverSync.activate(),this.scrollSyncUpdate=(0,gt.e9)(this.$element),this.scrollSyncUpdate(this.timelineVisible),this.cdRef.detectChanges()}get isEmbedded(){return this.configuration.isEmbedded}getTableAndTimelineElement(){const ke=this.$element.find(".work-packages-tabletimeline--table-side"),Te=this.$element.find(".work-packages-tabletimeline--timeline-side");if(0===Te.length||0===ke.length)throw new Error("invalid state");return[ke[0],Te[0]]}}ut.\u0275fac=function(ke){return new(ke||ut)(i.Y36(i.SBq),i.Y36(i.zs3),i.Y36(u.G),i.Y36(n.q),i.Y36(e.D),i.Y36(i.sBO),i.Y36(i.R0b),i.Y36(It.w),i.Y36(Mt.W),i.Y36(nt.i),i.Y36(f.q),i.Y36(vt.X))},ut.\u0275cmp=i.Xpm({type:ut,selectors:[["wp-table"]],inputs:{projectIdentifier:"projectIdentifier",configurationObject:["configuration","configurationObject"]},outputs:{selectionChanged:"selectionChanged",itemClicked:"itemClicked",stateLinkClicked:"stateLinkClicked"},features:[i.qOj],decls:1,vars:1,consts:[["class","work-packages-split-view--tabletimeline-content",4,"ngIf"],[1,"work-packages-split-view--tabletimeline-content"],[1,"work-packages-tabletimeline--table-side","work-package-table--container","__hidden_overflow_container"],[1,"keyboard-accessible-list","generic-table","work-package-table"],[4,"ngIf"],["opHighlightCol","",4,"ngFor","ngForOf"],["opHighlightCol","",4,"ngIf"],[1,"hidden-for-sighted"],["id","wp-table-sort-summary"],[1,"-sticky"],["class","wp-table--manual-sort-th -short hide-when-print",4,"ngIf"],["class","wp-table--table-header",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["class","wp-table--configuration-modal--trigger wp-table--context-menu-th -short hide-when-print",4,"ngIf"],["class","work-package--empty-tbody",4,"ngIf"],[1,"results-tbody","work-package--results-tbody"],["wpTableSumsRow","",1,"wp-table--sums-row","wp-table--row",3,"wpTableSumsRow-table"],["wpInlineCreate","",3,"wp-inline-create--table","wp-inline-create--project-identifier","wp-inline-create--showing",4,"ngIf"],["class","work-packages--tabletimeline--timeline--resizer hidden-for-mobile hide-when-print",4,"ngIf"],[1,"work-packages-tabletimeline--timeline-side",3,"ngClass"],["opHighlightCol",""],[1,"wp-table--manual-sort-th","-short","hide-when-print"],[1,"generic-table--empty-header"],["icon-classes","icon-sort-by",4,"ngIf"],["icon-classes","icon-sort-by"],[1,"wp-table--table-header",3,"ngClass"],["opColumnsContextMenu","",3,"headerColumn","locale","table","opColumnsContextMenu-column","opColumnsContextMenu-table"],[1,"wp-table--configuration-modal--trigger","wp-table--context-menu-th","-short","hide-when-print"],["class","generic-table--sort-header-outer",4,"ngIf"],[1,"generic-table--sort-header-outer"],[1,"work-package--empty-tbody"],["id","empty-row-notification"],["icon-classes","icon-info1 icon-context"],["wpInlineCreate","",3,"wp-inline-create--table","wp-inline-create--project-identifier","wp-inline-create--showing"],[1,"work-packages--tabletimeline--timeline--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","resizeEvent","localStorageKey"]],template:function(ke,Te){1&ke&&i.YNc(0,ri,27,19,"div",0),2&ke&&i.Q6J("ngIf",Te.query)},styles:[".wp-table--drag-and-drop-handle:hover{cursor:move}\n"],encapsulation:2,changeDetection:0})},38421:(X,I,t)=>{"use strict";t.d(I,{t:()=>c});var i=t(47775),e=t(96617),d=t(61908),h=t(33927),r=t(39154),n=t(2316),l=t(54364),a=t(32853);function m(p,f){if(1&p&&n._UZ(0,"ndc-dynamic",2),2&p){const C=n.oxw().ngIf;n.Q6J("ndcDynamicComponent",null==C||null==C.tab?null:C.tab.component)("ndcDynamicInputs",C)}}function v(p,f){if(1&p&&(n.ynx(0),n.YNc(1,m,1,2,"ndc-dynamic",1),n.BQk()),2&p){const C=f.ngIf;n.xp6(1),n.Q6J("ngIf",C.workPackage&&C.tab)}}class c{constructor(f,C,u,k){this.I18n=f,this.uiRouterGlobals=C,this.apiV3Service=u,this.wpTabsService=k}get workPackageId(){const{workPackageId:f}=this.uiRouterGlobals.params;return f}ngOnInit(){this.ndcDynamicInputs$=this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe((0,h.U)(f=>({workPackage:f,tab:this.findTab(f)})))}findTab(f){const{tabIdentifier:C}=this.uiRouterGlobals.params;return this.wpTabsService.getTab(C,f)}}c.\u0275fac=function(f){return new(f||c)(n.Y36(e.D),n.Y36(i.UIRouterGlobals),n.Y36(d.T),n.Y36(r.o))},c.\u0275cmp=n.Xpm({type:c,selectors:[["op-wp-tab"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ndcDynamicComponent","ndcDynamicInputs",4,"ngIf"],[3,"ndcDynamicComponent","ndcDynamicInputs"]],template:function(f,C){1&f&&(n.YNc(0,v,2,1,"ng-container",0),n.ALo(1,"async")),2&f&&n.Q6J("ngIf",n.lcZ(1,1,C.ndcDynamicInputs$))},directives:[l.O5,a.B5,a.oc],pipes:[l.Ov],encapsulation:2})},70971:(X,I,t)=>{"use strict";t.d(I,{e:()=>c});var i=t(84109),e=t(47775),d=t(96617),h=t(39154),n=(t(24897),t(2316)),l=t(90590),a=t(54364),m=t(2775);function v(p,f){if(1&p){const C=n.EpF();n.ynx(0,2),n.TgZ(1,"li",3),n.TgZ(2,"button",4),n.NdJ("click",function(){return n.CHM(C),n.oxw().switchToFullscreen()}),n._UZ(3,"op-icon",5),n.qZA(),n.qZA(),n.TgZ(4,"li",3),n.TgZ(5,"button",6),n.NdJ("click",function(){return n.CHM(C),n.oxw().close()}),n._UZ(6,"op-icon",7),n.qZA(),n.qZA(),n.BQk()}if(2&p){const C=n.oxw();n.xp6(2),n.Q6J("title",C.text.details.goToFullScreen),n.xp6(3),n.Q6J("title",C.text.details.close)}}class c{constructor(f,C,u,k,O,y){this.wpTabsService=f,this.I18n=C,this.injector=u,this.$state=k,this.uiRouterGlobals=O,this.keepTab=y,this.canViewWatchers=!1,this.text={details:{close:this.I18n.t("js.button_close_details"),goToFullScreen:this.I18n.t("js.button_show_fullscreen")}}}ngOnInit(){this.uiSrefBase="split"===this.view?"":"work-packages.show",this.canViewWatchers=!(!this.workPackage||!this.workPackage.watchers),this.tabs=this.getDisplayableTabs()}getDisplayableTabs(){return this.wpTabsService.getDisplayableTabs(this.workPackage).map(f=>Object.assign(Object.assign({},f),{route:`${this.uiSrefBase}.tabs`,routeParams:{workPackageId:this.workPackage.id,tabIdentifier:f.id}}))}switchToFullscreen(){this.keepTab.goCurrentShowState()}close(){this.$state.go(this.uiRouterGlobals.current.data.baseRoute,this.uiRouterGlobals.params)}}c.\u0275fac=function(f){return new(f||c)(n.Y36(h.o),n.Y36(d.D),n.Y36(n.zs3),n.Y36(e.StateService),n.Y36(e.UIRouterGlobals),n.Y36(i.p))},c.\u0275cmp=n.Xpm({type:c,selectors:[["op-wp-tabs"]],inputs:{workPackage:"workPackage",view:"view"},decls:2,vars:2,consts:[[1,"op-work-package-tabs",3,"tabs"],["slot","actions",4,"ngIf"],["slot","actions"],[1,"tab-icon"],["type","button",1,"spot-link","work-packages--details-fullscreen-icon",3,"title","click"],["icon-classes","icon-context icon-no-color icon-to-fullscreen"],["type","button",1,"spot-link","work-packages--details-close-icon",3,"title","click"],["icon-classes","icon-context icon-no-color icon-close"]],template:function(f,C){1&f&&(n.TgZ(0,"op-scrollable-tabs",0),n.YNc(1,v,7,2,"ng-container",1),n.qZA()),2&f&&(n.Q6J("tabs",C.tabs),n.xp6(1),n.Q6J("ngIf","split"===C.view))},directives:[l.P,a.O5,m.o],styles:["[_nghost-%COMP%]{width:100%;max-width:100%;overflow:hidden}"],changeDetection:0})},39154:(X,I,t)=>{"use strict";t.d(I,{o:()=>B});var i=t(30400),e=t(47775),d=t(96617),h=t(26942),r=t(61908),n=t(2316),l=t(54364),m=(t(24897),t(90490)),v=t(22663),c=t(53466),p=t(38519),f=t(53457),C=t(70233),u=t(41945),k=t(97047),O=t(74012);class y extends h.N{constructor(A,Z,Ce,Ie){super(),this.wpRelationsHierarchyService=A,this.apiV3Service=Z,this.PathHelper=Ce,this.I18n=Ie,this.showEditForm=!1,this.text={parentHeadline:this.I18n.t("js.relations_hierarchy.parent_headline"),childrenHeadline:this.I18n.t("js.relations_hierarchy.children_headline")}}ngOnInit(){this.workPackagePath=this.PathHelper.workPackagePath(this.workPackage.id),this.canModifyHierarchy=!!this.workPackage.changeParent,this.canAddRelation=!!this.workPackage.addRelation,this.childrenQueryProps={filters:JSON.stringify([{parent:{operator:"=",values:[this.workPackage.id]}}]),"columns[]":["id","type","subject","status"],showHierarchies:!1},this.apiV3Service.work_packages.id(this.workPackage).requireAndStream().pipe(this.untilDestroyed()).subscribe(A=>{var Z,Ce;this.workPackage=A;const Ie=null===(Ce=null===(Z=this.workPackage.parent)||void 0===Z?void 0:Z.id)||void 0===Ce?void 0:Ce.toString();Ie&&this.apiV3Service.work_packages.id(Ie).get().pipe((0,c.q)(1)).subscribe(Be=>{this.workPackage.parent=Be})})}}y.\u0275fac=function(A){return new(A||y)(n.Y36(u.O),n.Y36(r.T),n.Y36(C.j),n.Y36(d.D))},y.\u0275cmp=n.Xpm({type:y,selectors:[["wp-relations-hierarchy"]],inputs:{workPackage:"workPackage",relationType:"relationType"},features:[n.qOj],decls:6,vars:4,consts:[[1,"wp-relations-hierarchy-section","wp-relations--children"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],["wp-isolated-query-space",""],[3,"workPackage","addExistingChildEnabled","query"]],template:function(A,Z){1&A&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.TgZ(2,"div",2),n._UZ(3,"h3",3),n.qZA(),n.qZA(),n.ynx(4,4),n._UZ(5,"wp-children-query",5),n.BQk(),n.qZA()),2&A&&(n.xp6(3),n.Q6J("textContent",Z.text.childrenHeadline),n.xp6(2),n.Q6J("workPackage",Z.workPackage)("addExistingChildEnabled",!0)("query",Z.childrenQueryProps))},directives:[k.A,O.u],encapsulation:2});var b=t(1403),P=t(62964),E=t(69057),T=t(50076),M=t(51017),S=t(2775),R=t(1707),F=t(84312),L=t(84906),D=t(61342),G=t(54262),Q=t(82140);const V=["relationDescriptionTextarea"];function K(x,A){if(1&x&&n._UZ(0,"span",18),2&x){const Z=n.oxw(3);n.Q6J("textContent",Z.normalizedRelationType)}}function q(x,A){if(1&x&&n._UZ(0,"span",19),2&x){const Z=n.oxw(3);n.Q6J("ngClass",Z.highlightingClassForWpType())("textContent",Z.relatedWorkPackage.type.name)}}function se(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"button",14),n.NdJ("click",function(){return n.CHM(Z),n.oxw(2).activateRelationTypeEdit()}),n.YNc(1,K,1,1,"span",15),n.YNc(2,q,1,2,"span",16),n._UZ(3,"span",17),n.qZA()}if(2&x){const Z=n.oxw(2);n.xp6(1),n.Q6J("ngIf",Z.groupByWorkPackageType),n.xp6(1),n.Q6J("ngIf",!Z.groupByWorkPackageType),n.xp6(1),n.Q6J("textContent",Z.text.updateRelation)}}function te(x,A){if(1&x&&n._UZ(0,"option",23),2&x){const Z=A.$implicit;n.Q6J("textContent",Z.label)("ngValue",Z)}}function ie(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"div",20),n.TgZ(1,"select",21),n.NdJ("ngModelChange",function(Ie){n.CHM(Z);return n.oxw(2).selectedRelationType=Ie})("change",function(){return n.CHM(Z),n.oxw(2).saveRelationType()})("keydown.escape",function(Ie){return n.CHM(Z),n.oxw(2).cancelRelationTypeEditOnEscape(Ie)}),n.YNc(2,te,1,2,"option",22),n.qZA(),n.qZA()}if(2&x){const Z=n.oxw(2);n.xp6(1),n.Q6J("ngModel",Z.selectedRelationType),n.xp6(1),n.Q6J("ngForOf",Z.availableRelationTypes)}}const le=function(x){return{workPackageId:x,tabIdentifier:"relations"}};function oe(x,A){if(1&x&&(n.TgZ(0,"div",24),n._UZ(1,"a",25),n.qZA()),2&x){const Z=n.oxw(2);n.xp6(1),n.Q6J("uiParams",n.VKq(3,le,Z.relatedWorkPackage.id))("textContent",Z.relatedWorkPackage.subjectWithId()),n.uIk("aria-label",Z.normalizedRelationType+" "+Z.relatedWorkPackage.subjectWithId())}}function ne(x,A){if(1&x&&(n.TgZ(0,"edit-form",26),n._UZ(1,"op-editable-attribute-field",27),n.qZA()),2&x){const Z=n.oxw(2);n.Q6J("resource",Z.relatedWorkPackage),n.xp6(1),n.Q6J("resource",Z.relatedWorkPackage)}}const fe=function(x){return{"-visible":x}};function ve(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"button",28),n.NdJ("click",function(){return n.CHM(Z),n.oxw(2).removeRelation()}),n._UZ(1,"op-icon",29),n.qZA()}if(2&x){const Z=n.oxw(2);n.Q6J("ngClass",n.VKq(3,fe,Z.showDescriptionInfo))("title",Z.text.removeButton),n.xp6(1),n.Q6J("icon-title",Z.text.removeButton)}}function Se(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"button",33),n.NdJ("click",function(){return n.CHM(Z),n.oxw(3).startDescriptionEdit()}),n.qZA()}if(2&x){const Z=n.oxw(3);n.ekj("-placeholder",!Z.relation.description),n.Q6J("textContent",Z.relation.description||Z.text.placeholder.description)}}function Oe(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"div",34),n.TgZ(1,"textarea",35,36),n.NdJ("keyup",function(Ie){return n.CHM(Z),n.oxw(3).handleDescriptionKey(Ie)})("ngModelChange",function(Ie){n.CHM(Z);return n.oxw(3).userInputs.newRelationText=Ie}),n.qZA(),n.TgZ(3,"edit-field-controls",37),n.NdJ("onSave",function(){return n.CHM(Z),n.oxw(3).saveDescription()})("onCancel",function(){return n.CHM(Z),n.oxw(3).cancelDescriptionEdit()}),n.qZA(),n.qZA()}if(2&x){const Z=n.oxw(3);n.xp6(1),n.Q6J("ngModel",Z.userInputs.newRelationText),n.xp6(2),n.Q6J("fieldController",Z.fieldController)("saveTitle",Z.text.save)("cancelTitle",Z.text.cancel)}}function je(x,A){if(1&x&&(n.TgZ(0,"div",30),n.YNc(1,Se,1,3,"button",31),n.YNc(2,Oe,4,4,"div",32),n.qZA()),2&x){const Z=n.oxw(2);n.xp6(1),n.Q6J("ngIf",!Z.userInputs.showDescriptionEditForm),n.xp6(1),n.Q6J("ngIf",Z.userInputs.showDescriptionEditForm)}}function tt(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"div",1),n.TgZ(1,"div",2),n.TgZ(2,"div",3),n.YNc(3,se,4,3,"button",4),n.YNc(4,ie,3,2,"div",5),n.qZA(),n.YNc(5,oe,2,5,"div",6),n.TgZ(6,"div",7),n.YNc(7,ne,2,2,"edit-form",8),n.qZA(),n.TgZ(8,"div",9),n.TgZ(9,"button",10),n.NdJ("click",function(){n.CHM(Z);const Ie=n.oxw();return Ie.userInputs.showRelationInfo=!Ie.userInputs.showRelationInfo}),n._UZ(10,"op-icon",11),n.qZA(),n.YNc(11,ve,2,5,"button",12),n.qZA(),n.qZA(),n.YNc(12,je,3,2,"div",13),n.qZA()}if(2&x){const Z=n.oxw();n.Gre("relation-row relation-row-",Z.relatedWorkPackage.id,""),n.xp6(3),n.Q6J("ngIf",!Z.userInputs.showRelationTypesForm),n.xp6(1),n.Q6J("ngIf",Z.userInputs.showRelationTypesForm),n.xp6(1),n.Q6J("ngIf",Z.relatedWorkPackage),n.xp6(2),n.Q6J("ngIf",Z.relatedWorkPackage),n.xp6(2),n.Q6J("ngClass",n.VKq(12,fe,Z.showDescriptionInfo))("title",Z.text.description_label),n.xp6(1),n.Q6J("icon-title",Z.text.toggleDescription),n.xp6(1),n.Q6J("ngIf",!!Z.relation.delete),n.xp6(1),n.Q6J("ngIf",Z.userInputs.showRelationInfo)}}class He extends h.N{constructor(A,Z,Ce,Ie,Be,Tt,Qt){super(),this.apiV3Service=A,this.notificationService=Z,this.wpRelations=Ce,this.halEvents=Ie,this.I18n=Be,this.cdRef=Tt,this.PathHelper=Qt,this.showRelationInfo=!1,this.showEditForm=!1,this.userInputs={newRelationText:"",showDescriptionEditForm:!1,showRelationTypesForm:!1,showRelationInfo:!1},this.fieldController={handler:{active:!0},required:!1},this.text={cancel:this.I18n.t("js.button_cancel"),save:this.I18n.t("js.button_save"),removeButton:this.I18n.t("js.relation_buttons.remove"),description_label:this.I18n.t("js.relation_buttons.update_description"),toggleDescription:this.I18n.t("js.relation_buttons.toggle_description"),updateRelation:this.I18n.t("js.relation_buttons.update_relation"),placeholder:{description:this.I18n.t("js.placeholders.relation_description")}}}ngOnInit(){this.relation=this.relatedWorkPackage.relatedBy,this.userInputs.newRelationText=this.relation.description||"",this.availableRelationTypes=E.d.LOCALIZED_RELATION_TYPES(!1),this.selectedRelationType=_.find(this.availableRelationTypes,{name:this.relation.normalizedType(this.workPackage)}),this.apiV3Service.work_packages.id(this.relatedWorkPackage).requireAndStream().pipe(this.untilDestroyed()).subscribe(A=>{this.relatedWorkPackage=A})}get normalizedRelationType(){const A=this.relation.normalizedType(this.workPackage);return this.I18n.t(`js.relation_labels.${A}`)}get relationReady(){return this.relatedWorkPackage&&this.relatedWorkPackage.$loaded}startDescriptionEdit(){this.userInputs.showDescriptionEditForm=!0,setTimeout(()=>{const A=jQuery(this.relationDescriptionTextarea.nativeElement),Z=A.val().length;A.focus(),A.prop("selectionStart",Z),A.prop("selectionEnd",Z)})}handleDescriptionKey(A){27===A.which&&this.cancelDescriptionEdit()}cancelDescriptionEdit(){this.userInputs.showDescriptionEditForm=!1,this.userInputs.newRelationText=this.relation.description||""}saveDescription(){this.wpRelations.updateRelation(this.relation,{description:this.userInputs.newRelationText}).then(A=>{this.relation=A,this.relatedWorkPackage.relatedBy=A,this.userInputs.showDescriptionEditForm=!1,this.notificationService.showSave(this.relatedWorkPackage),this.cdRef.detectChanges()})}get showDescriptionInfo(){return this.userInputs.showRelationInfo||this.relation.description}activateRelationTypeEdit(){this.groupByWorkPackageType&&(this.userInputs.showRelationTypesForm=!0)}cancelRelationTypeEditOnEscape(A){this.userInputs.showRelationTypesForm=!1}saveRelationType(){this.wpRelations.updateRelationType(this.workPackage,this.relatedWorkPackage,this.relation,this.selectedRelationType.name).then(A=>{this.notificationService.showSave(this.relatedWorkPackage),this.relatedWorkPackage.relatedBy=A,this.relation=A,this.userInputs.showRelationTypesForm=!1,this.cdRef.detectChanges()}).catch(A=>this.notificationService.handleRawError(A,this.workPackage))}toggleUserDescriptionForm(){this.userInputs.showDescriptionEditForm=!this.userInputs.showDescriptionEditForm}removeRelation(){this.wpRelations.removeRelation(this.relation).then(()=>{this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:null,relationType:this.relation.normalizedType(this.workPackage)}),this.apiV3Service.work_packages.cache.updateWorkPackage(this.relatedWorkPackage),this.notificationService.showSave(this.relatedWorkPackage)}).catch(A=>this.notificationService.handleRawError(A,this.relatedWorkPackage))}highlightingClassForWpType(){return T.Z.inlineClass("type",this.relatedWorkPackage.type.id)}}He.\u0275fac=function(A){return new(A||He)(n.Y36(r.T),n.Y36(P.q),n.Y36(f.V),n.Y36(b.J),n.Y36(d.D),n.Y36(n.sBO),n.Y36(C.j))},He.\u0275cmp=n.Xpm({type:He,selectors:[["wp-relation-row"]],viewQuery:function(A,Z){if(1&A&&n.Gf(V,5),2&A){let Ce;n.iGM(Ce=n.CRH())&&(Z.relationDescriptionTextarea=Ce.first)}},inputs:{workPackage:"workPackage",relatedWorkPackage:"relatedWorkPackage",groupByWorkPackageType:"groupByWorkPackageType"},features:[n.qOj],decls:1,vars:1,consts:[["opFocusWithin",".wp-relations-controls-section button",3,"class",4,"ngIf"],["opFocusWithin",".wp-relations-controls-section button"],[1,"grid-block","hierarchy-item"],[1,"grid-content","medium-2","collapse"],["type","button","class","relation-row--type",3,"click",4,"ngIf"],["class","inline-edit--container inplace-edit",4,"ngIf"],["class","grid-content medium-5 collapse",4,"ngIf"],[1,"grid-content","medium-3","collapse","wp-relations-status-field"],[3,"resource",4,"ngIf"],["ng-class","{'-expanded': userInputs.showRelationInfo }",1,"grid-content","medium-2","collapse","wp-relations-controls-section"],["type","button",1,"spot-link","wp-relations--description-btn",3,"ngClass","title","click"],["icon-classes","icon-info1 icon-no-color -padded wp-relations--icon wp-relations--description-icon",3,"icon-title"],["type","button","class","spot-link relation-row--remove-btn",3,"ngClass","title","click",4,"ngIf"],["class","grid-block hierarchy-item description-container",4,"ngIf"],["type","button",1,"relation-row--type",3,"click"],[3,"textContent",4,"ngIf"],[3,"ngClass","textContent",4,"ngIf"],[1,"hidden-for-sighted",3,"textContent"],[3,"textContent"],[3,"ngClass","textContent"],[1,"inline-edit--container","inplace-edit"],["role","listbox","opAutofocus","",1,"inline-edit--field","form--select",3,"ngModel","ngModelChange","change","keydown.escape"],[3,"textContent","ngValue",4,"ngFor","ngForOf"],[3,"textContent","ngValue"],[1,"grid-content","medium-5","collapse"],["uiSref","work-packages.show.tabs",1,"wp-relations--subject-field",3,"uiParams","textContent"],[3,"resource"],["fieldName","status",3,"resource"],["type","button",1,"spot-link","relation-row--remove-btn",3,"ngClass","title","click"],["icon-classes","icon-remove icon-no-color -padded wp-relations--icon",3,"icon-title"],[1,"grid-block","hierarchy-item","description-container"],["type","button","class","wp-relation--description-read-value",3,"-placeholder","textContent","click",4,"ngIf"],["class","wp-relation--description-wrapper textarea-wrapper",4,"ngIf"],["type","button",1,"wp-relation--description-read-value",3,"textContent","click"],[1,"wp-relation--description-wrapper","textarea-wrapper"],["autofocus","","name","description",1,"wp-relation--description-textarea",3,"ngModel","keyup","ngModelChange"],["relationDescriptionTextarea",""],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel"]],template:function(A,Z){1&A&&n.YNc(0,tt,13,14,"div",0),2&A&&n.Q6J("ngIf",Z.workPackage&&Z.relatedWorkPackage)},directives:[l.O5,M.N,l.mk,S.o,R.EJ,F.U,R.JJ,R.On,l.sg,R.YN,R.Kr,L.AnchorUISref,L.UISref,D.n,G.k,R.Fj,Q.e],encapsulation:2});const st=["wpRelationGroupByToggler"];function Me(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"div",5),n.TgZ(1,"button",6,7),n.NdJ("click",function(){return n.CHM(Z),n.oxw().toggleButton()}),n._UZ(3,"span",8),n.qZA(),n.qZA()}if(2&x){const Z=n.oxw();n.xp6(3),n.Q6J("textContent",Z.togglerText)}}function ce(x,A){if(1&x&&n._UZ(0,"wp-relation-row",11),2&x){const Z=A.$implicit,Ce=n.oxw(2);n.Q6J("workPackage",Ce.workPackage)("groupByWorkPackageType",Ce.groupByWorkPackageType)("relatedWorkPackage",Z)}}function J(x,A){if(1&x&&(n.TgZ(0,"div",9),n.YNc(1,ce,1,3,"wp-relation-row",10),n.qZA()),2&x){const Z=n.oxw();n.xp6(1),n.Q6J("ngForOf",Z.relatedWorkPackages)}}class W{constructor(A){this.I18n=A,this.className=!0,this.onToggleGroupBy=new n.vpe,this.text={groupByType:this.I18n.t("js.relation_buttons.group_by_wp_type"),groupByRelation:this.I18n.t("js.relation_buttons.group_by_relation_type")}}get togglerText(){return this.groupByWorkPackageType?this.text.groupByRelation:this.text.groupByType}toggleButton(){this.onToggleGroupBy.emit(),setTimeout(()=>{this.toggleElement.nativeElement.focus()},20)}}W.\u0275fac=function(A){return new(A||W)(n.Y36(d.D))},W.\u0275cmp=n.Xpm({type:W,selectors:[["wp-relations-group"]],viewQuery:function(A,Z){if(1&A&&n.Gf(st,5),2&A){let Ce;n.iGM(Ce=n.CRH())&&(Z.toggleElement=Ce.first)}},hostVars:2,hostBindings:function(A,Z){2&A&&n.ekj("attributes-group",Z.className)},inputs:{relatedWorkPackages:"relatedWorkPackages",workPackage:"workPackage",header:"header",firstGroup:"firstGroup",groupByWorkPackageType:"groupByWorkPackageType"},outputs:{onToggleGroupBy:"onToggleGroupBy"},decls:5,vars:3,consts:[[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text","relation-group--header",3,"textContent"],["class","attributes-group--header-toggle",4,"ngIf"],["class","content",4,"ngIf"],[1,"attributes-group--header-toggle"],["id","wp-relation-group-by-toggle","type","button",1,"button","-small","-transparent","-with-icon","icon-group-by","icon-small","hide-when-print",3,"click"],["wpRelationGroupByToggler",""],[3,"textContent"],[1,"content"],[3,"workPackage","groupByWorkPackageType","relatedWorkPackage",4,"ngFor","ngForOf"],[3,"workPackage","groupByWorkPackageType","relatedWorkPackage"]],template:function(A,Z){1&A&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n._UZ(2,"h3",2),n.qZA(),n.YNc(3,Me,4,1,"div",3),n.qZA(),n.YNc(4,J,2,1,"div",4)),2&A&&(n.xp6(2),n.Q6J("textContent",Z.header),n.xp6(1),n.Q6J("ngIf",Z.firstGroup),n.xp6(1),n.Q6J("ngIf",Z.relatedWorkPackages))},directives:[l.O5,l.sg,He],encapsulation:2});var Y=t(11950);function $(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"div",4),n.TgZ(1,"div",5),n.TgZ(2,"div",6),n.TgZ(3,"button",7),n.NdJ("click",function(){return n.CHM(Z),n.oxw().toggleRelationsCreateForm()}),n._UZ(4,"span",8),n._UZ(5,"span",9),n.qZA(),n.qZA(),n.qZA(),n.qZA()}if(2&x){const Z=n.oxw();n.xp6(5),n.Q6J("textContent",Z.text.addNewRelation)}}function be(x,A){if(1&x&&n._UZ(0,"option",20),2&x){const Z=A.$implicit;n.Q6J("textContent",Z.label)("value",Z.name)}}function N(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"div",10),n.TgZ(1,"div",11),n._UZ(2,"label",12),n.TgZ(3,"select",13),n.NdJ("ngModelChange",function(Ie){n.CHM(Z);return n.oxw().selectedRelationType=Ie}),n.YNc(4,be,1,2,"option",14),n.qZA(),n.qZA(),n.TgZ(5,"div",15),n.TgZ(6,"wp-relations-autocomplete",16),n.NdJ("onSelected",function(Ie){return n.CHM(Z),n.oxw().onSelected(Ie)})("onCancel",function(){return n.CHM(Z),n.oxw().toggleRelationsCreateForm()}),n.qZA(),n.qZA(),n.TgZ(7,"div",17),n.TgZ(8,"button",18),n.NdJ("click",function(){return n.CHM(Z),n.oxw().toggleRelationsCreateForm()}),n._UZ(9,"op-icon",19),n.qZA(),n.qZA(),n.qZA()}if(2&x){const Z=n.oxw();n.xp6(2),n.Q6J("textContent",Z.text.relationType),n.xp6(1),n.Q6J("ngModel",Z.selectedRelationType),n.xp6(1),n.Q6J("ngForOf",Z.relationTypes),n.xp6(2),n.Q6J("workPackage",Z.workPackage)("hiddenOverflowContainer",".work-packages-tab-view--overflow")("selectedRelationType",Z.selectedRelationType),n.xp6(3),n.Q6J("icon-title",Z.text.abort)}}class Ue{constructor(A,Z,Ce,Ie){this.I18n=A,this.wpRelations=Z,this.notificationService=Ce,this.halEvents=Ie,this.showRelationsCreateForm=!1,this.selectedRelationType=E.d.DEFAULT(),this.relationTypes=E.d.LOCALIZED_RELATION_TYPES(!1),this.isDisabled=!1,this.text={abort:this.I18n.t("js.relation_buttons.abort"),relationType:this.I18n.t("js.relation_buttons.relation_type"),addNewRelation:this.I18n.t("js.relation_buttons.add_new_relation")}}createRelation(){!this.selectedRelationType||!this.selectedWpId||(this.isDisabled=!0,this.createCommonRelation().catch(()=>this.isDisabled=!1).then(()=>this.isDisabled=!1))}onSelected(A){A&&(this.selectedWpId=A.id,this.createCommonRelation())}createCommonRelation(){return this.wpRelations.addCommonRelation(this.workPackage.id,this.selectedRelationType,this.selectedWpId).then(A=>{this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:A.id,relationType:this.selectedRelationType}),this.notificationService.showSave(this.workPackage),this.toggleRelationsCreateForm()}).catch(A=>{this.notificationService.handleRawError(A,this.workPackage),this.toggleRelationsCreateForm()})}toggleRelationsCreateForm(){this.showRelationsCreateForm=!this.showRelationsCreateForm,this.selectedWpId=""}}function et(x,A){if(1&x&&(n.TgZ(0,"div",5),n.TgZ(1,"div",6),n._UZ(2,"h3",7),n.qZA(),n.qZA()),2&x){const Z=n.oxw();n.xp6(2),n.Q6J("textContent",Z.text.relations_header)}}function Ke(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"wp-relations-group",8),n.NdJ("onToggleGroupBy",function(){return n.CHM(Z),n.oxw().toggleGroupBy()}),n.qZA()}if(2&x){const Z=A.$implicit,Ce=A.first,Ie=n.oxw();n.Q6J("header",Z)("groupByWorkPackageType",Ie.groupByWorkPackageType)("firstGroup",Ce)("relatedWorkPackages",Ie.relationGroups[Z])("workPackage",Ie.workPackage)}}function _e(x,A){if(1&x&&n._UZ(0,"wp-relations-create",4),2&x){const Z=n.oxw();n.Q6J("workPackage",Z.workPackage)}}Ue.\u0275fac=function(A){return new(A||Ue)(n.Y36(d.D),n.Y36(f.V),n.Y36(P.q),n.Y36(b.J))},Ue.\u0275cmp=n.Xpm({type:Ue,selectors:[["wp-relations-create"]],inputs:{workPackage:"workPackage"},decls:4,vars:2,consts:[[1,"wp-relations-create"],["class","wp-relations-create-button hide-when-print",4,"ngIf"],["data-indicator-name","relationAddDynamic",1,"loading-indicator--location"],["class","v-align wp-relations-create--form",4,"ngIf"],[1,"wp-relations-create-button","hide-when-print"],[1,"grid-block"],[1,"grid-content","collapse"],["type","button","opAutofocus","","id","relation--add-relation",1,"spot-link","wp-inline-create--add-link",3,"click"],[1,"spot-icon","spot-icon_add"],[3,"textContent"],[1,"v-align","wp-relations-create--form"],[1,"grid-content","collapse","medium-3"],["for","relation-type--select",1,"hidden-for-sighted",3,"textContent"],["id","relation-type--select","role","listbox","opAutoFocus","",1,"form--select","relationTypeSelect",3,"ngModel","ngModelChange"],[3,"textContent","value",4,"ngFor","ngForOf"],[1,"grid-content","medium-8"],[3,"workPackage","hiddenOverflowContainer","selectedRelationType","onSelected","onCancel"],[1,"grid-content","medium-1","collapse","wp-relations-controls-section","relation-row"],["type","button",1,"spot-link","wp-create-relation--cancel",3,"click"],["icon-classes","icon-remove icon-no-color -padded",3,"icon-title"],[3,"textContent","value"]],template:function(A,Z){1&A&&(n.TgZ(0,"div",0),n.YNc(1,$,6,1,"div",1),n.TgZ(2,"div",2),n.YNc(3,N,10,7,"div",3),n.qZA(),n.qZA()),2&A&&(n.xp6(1),n.Q6J("ngIf",!Z.showRelationsCreateForm),n.xp6(2),n.Q6J("ngIf",Z.showRelationsCreateForm))},directives:[l.O5,F.U,R.EJ,R.JJ,R.On,l.sg,Y.t,S.o,R.YN,R.Kr],encapsulation:2});class ye extends h.N{constructor(A,Z,Ce,Ie){super(),this.I18n=A,this.wpRelations=Z,this.cdRef=Ce,this.apiV3Service=Ie,this.relationGroups={},this.relationGroupKeys=[],this.relationsPresent=!1,this.groupByWorkPackageType=!1,this.text={relations_header:this.I18n.t("js.work_packages.tabs.relations")},this.currentRelations=[]}ngOnInit(){this.canAddRelation=!!this.workPackage.addRelation,this.wpRelations.state(this.workPackage.id).values$().pipe((0,v.R)((0,p.J6)(this))).subscribe(A=>{this.loadedRelations(A)}),this.wpRelations.require(this.workPackage.id),this.apiV3Service.work_packages.id(this.workPackage).requireAndStream().pipe((0,v.R)((0,p.J6)(this))).subscribe(A=>{this.workPackage=A})}getRelatedWorkPackages(A){const Z=A.map(Ce=>this.apiV3Service.work_packages.id(Ce).get());return(0,m.$R)(...Z)}getRelatedWorkPackageId(A){const Z=A.ids;return A.to.href===this.workPackage.href?Z.from:Z.to}toggleGroupBy(){this.groupByWorkPackageType=!this.groupByWorkPackageType,this.buildRelationGroups()}buildRelationGroups(){_.isNil(this.currentRelations)||(this.relationGroups=_.groupBy(this.currentRelations,A=>{if(this.groupByWorkPackageType)return A.type.name;const Z=A.relatedBy.normalizedType(this.workPackage);return this.I18n.t(`js.relation_labels.${Z}`)}),this.relationGroupKeys=_.keys(this.relationGroups),this.relationsPresent=_.size(this.relationGroups)>0,this.cdRef.detectChanges())}loadedRelations(A){const Z=[],Ce=[];if(0===_.size(A))return this.currentRelations=[],this.buildRelationGroups();_.each(A,Ie=>{const Be=this.getRelatedWorkPackageId(Ie);Z.push(Be),Ce[Be]=Ie}),this.getRelatedWorkPackages(Z).pipe((0,c.q)(1)).subscribe(Ie=>{this.currentRelations=Ie.map(Be=>(Be.relatedBy=Ce[Be.id],Be)),this.buildRelationGroups()})}}function Pe(x,A){if(1&x&&(n.TgZ(0,"div",1),n.TgZ(1,"div",2),n._UZ(2,"wp-relations",3),n.qZA(),n.qZA()),2&x){const Z=n.oxw();n.xp6(2),n.Q6J("workPackage",Z.workPackage)}}ye.\u0275fac=function(A){return new(A||ye)(n.Y36(d.D),n.Y36(f.V),n.Y36(n.sBO),n.Y36(r.T))},ye.\u0275cmp=n.Xpm({type:ye,selectors:[["wp-relations"]],inputs:{workPackage:"workPackage"},features:[n.qOj],decls:5,vars:4,consts:[["data-indicator-name","relation-groups",1,"loading-indicator--location"],["class","attributes-group--header",4,"ngIf"],[3,"header","groupByWorkPackageType","firstGroup","relatedWorkPackages","workPackage","onToggleGroupBy",4,"ngFor","ngForOf"],[3,"workPackage",4,"ngIf"],[3,"workPackage"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],[3,"header","groupByWorkPackageType","firstGroup","relatedWorkPackages","workPackage","onToggleGroupBy"]],template:function(A,Z){1&A&&(n.TgZ(0,"div",0),n.YNc(1,et,3,1,"div",1),n.YNc(2,Ke,1,5,"wp-relations-group",2),n.YNc(3,_e,1,1,"wp-relations-create",3),n._UZ(4,"wp-relations-hierarchy",4),n.qZA()),2&A&&(n.xp6(1),n.Q6J("ngIf",!Z.relationsPresent),n.xp6(1),n.Q6J("ngForOf",Z.relationGroupKeys),n.xp6(1),n.Q6J("ngIf",Z.canAddRelation),n.xp6(1),n.Q6J("workPackage",Z.workPackage))},directives:[l.O5,l.sg,y,W,Ue],encapsulation:2,changeDetection:0});class Ee extends h.N{constructor(A,Z,Ce){super(),this.I18n=A,this.$transition=Z,this.apiV3Service=Ce}ngOnInit(){const A=this.workPackageId||this.$transition.params("to").workPackageId;this.apiV3Service.work_packages.id(A).requireAndStream().pipe(this.untilDestroyed()).subscribe(Z=>{this.workPackageId=Z.id,this.workPackage=Z})}}Ee.\u0275fac=function(A){return new(A||Ee)(n.Y36(d.D),n.Y36(e.Transition),n.Y36(r.T))},Ee.\u0275cmp=n.Xpm({type:Ee,selectors:[["wp-relations-tab"]],inputs:{workPackageId:"workPackageId"},features:[n.qOj],decls:1,vars:1,consts:[["class","detail-panel-description detail-panel--relations detail-panel--autocomplete-target",4,"ngIf"],[1,"detail-panel-description","detail-panel--relations","detail-panel--autocomplete-target"],[1,"detail-panel-description-content"],[3,"workPackage"]],template:function(A,Z){1&A&&n.YNc(0,Pe,3,1,"div",0),2&A&&n.Q6J("ngIf",Z.workPackage)},directives:[l.O5,ye],encapsulation:2});var Qe=t(77180),nt=t(83720),ct=t(33927),lt=t(23896),Ne=t(54892),Ae=t(82123),xe=t(1056);class Ye extends h.N{constructor(A,Z,Ce,Ie,Be,Tt,Qt,bt){super(),this.apiV3Service=A,this.I18n=Z,this.cdRef=Ce,this.uiRouterGlobals=Ie,this.wpActivity=Be,this.storeService=Tt,this.browserDetector=Qt,this.wpSingleViewService=bt,this.unfilteredActivities=[],this.visibleActivities=[],this.onlyComments=!1,this.text={commentsOnly:this.I18n.t("js.label_activity_show_only_comments"),showAll:this.I18n.t("js.label_activity_show_all")},this.additionalScrollMargin=200,this.initialized=!1,this.comingFromNotifications=!1,this.reverse=Be.isReversed,this.togglerText=this.text.commentsOnly;const xt=Ie.successfulTransitions.peekTail().from().name,Nt=/^notifications/.test(xt),Rt=""===xt&&this.browserDetector.isMobile;(Nt||Rt)&&(this.comingFromNotifications=!0)}ngOnInit(){this.initialized=!1,this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(A=>{this.workPackage=A,this.reloadActivities()}),this.wpSingleViewService.selectNotificationsCount$.pipe(this.untilDestroyed(),(0,nt.x)()).subscribe(()=>{this.reloadActivities()})}scrollIfNotificationPresent(){this.storeService.hasNotifications$.pipe((0,lt.take)(1)).subscribe(A=>{A&&this.scrollToUnreadNotification()})}reloadActivities(){this.wpActivity.require(this.workPackage,!0).then(A=>{this.updateActivities(A),this.cdRef.detectChanges(),this.initialized||(this.initialized=!0,this.scrollIfNotificationPresent())})}updateActivities(A){this.unfilteredActivities=A;const Z=this.getVisibleActivities();this.visibleActivities=Z.map((Ce,Ie)=>this.info(Ce,Ie)),this.showToggler=this.shouldShowToggler()}shouldShowToggler(){const A=this.unfilteredActivities.length,Z=this.getActivitiesWithComments().length;return A>1&&Z>0&&Z<this.unfilteredActivities.length}getVisibleActivities(){return this.onlyComments?this.getActivitiesWithComments():this.unfilteredActivities}getActivitiesWithComments(){return this.unfilteredActivities.filter(A=>!!_.get(A,"comment.html"))}hasUnreadNotification(A){return this.storeService.selectNotifications$.pipe((0,ct.U)(Z=>!!Z.find(Ce=>{var Ie;return(null===(Ie=Ce._links.activity)||void 0===Ie?void 0:Ie.href)===A})))}scrollToUnreadNotification(){const A=document.querySelectorAll("[data-notification-selector='notification-activity']");if(window.location.href.indexOf("activity#")>-1||0===A.length)return;const Z=A[this.reverse?A.length-1:0],Ce=document.querySelectorAll("[data-notification-selector='notification-scroll-container']")[0],Ie=Z.offsetTop-Ce.offsetTop-this.additionalScrollMargin;Ce.scrollTop=Ie,this.comingFromNotifications&&Ce.scrollIntoView(!0)}toggleComments(){this.onlyComments=!this.onlyComments,this.updateActivities(this.unfilteredActivities),this.onlyComments?this.togglerText=this.text.showAll:this.togglerText=this.text.commentsOnly}info(A,Z){return this.wpActivity.info(this.unfilteredActivities,A,Z)}}Ye.\u0275fac=function(A){return new(A||Ye)(n.Y36(r.T),n.Y36(d.D),n.Y36(n.sBO),n.Y36(e.UIRouterGlobals),n.Y36(Ne.a),n.Y36(Ae.O),n.Y36(xe.o),n.Y36(Ae.O))},Ye.\u0275dir=n.lG2({type:Ye,features:[n.qOj]});var mt=t(43682),Ot=t(3786),Pt=t(86469),Mt=t(12877),yt=t(36293),jt=t(86029),Jt=t(79441),Ft=t(55749);class It extends jt.k{constructor(A,Z){super(),this.elementRef=A,this.injector=Z,this.fieldName="comment",this.handler=this,this.active=!1,this.inEditMode=!1,this.inFlight=!1,this.onDestroy=new Jt.xQ}ngOnInit(){this.change=new Ft.G(this.workPackage)}reset(A=""){A.length>0&&(A+="\n"),this.change.setValue("comment",{raw:A})}get schema(){return{name:I18n.t("js.label_comment"),writable:!0,required:!1,type:"_comment",hasDefault:!1}}get rawComment(){return _.get(this.commentValue,"raw","")}get commentValue(){return this.change.value("comment")}handleUserCancel(){this.deactivate(!0)}activate(A){this.active=!0,this.reset(A)}deactivate(A){this.active=!1,this.onDestroy.next(),this.onDestroy.complete()}focus(){const A=this.elementRef.nativeElement.querySelector(".inplace-editing--trigger-container");A&&A.focus()}onFocusOut(){}handleUserKeydown(A,Z){}isChanged(){return!1}stopPropagation(A){return!1}}It.\u0275fac=function(A){return new(A||It)(n.Y36(n.SBq),n.Y36(n.zs3))},It.\u0275dir=n.lG2({type:It,features:[n.qOj]});var gt=t(82267),kt=t(8849),ti=t(92058);const ii=["commentContainer"];function $t(x,A){if(1&x&&n.GkF(0,4),2&x){const Z=n.oxw();n.Q6J("ngTemplateOutlet",Z.template)}}function vt(x,A){if(1&x&&n._UZ(0,"edit-form-portal",10),2&x){const Z=n.oxw(2);n.Q6J("schemaInput",Z.schema)("changeInput",Z.change)("editFieldHandler",Z.handler)}}function Ht(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"div",11),n.NdJ("dragover",function(Ie){return n.CHM(Z),n.oxw(2).startDragOverActivation(Ie)})("dragenter",function(Ie){return n.CHM(Z),n.oxw(2).startDragOverActivation(Ie)}),n.TgZ(1,"button",12),n.NdJ("click",function(){return n.CHM(Z),n.oxw(2).activate()}),n._UZ(2,"span",13),n._UZ(3,"op-icon",14),n.qZA(),n.qZA()}if(2&x){const Z=n.oxw(2);n.xp6(1),n.Q6J("title",Z.text.editTitle),n.xp6(1),n.Q6J("textContent",Z.text.placeholder),n.xp6(1),n.Q6J("icon-title",Z.text.editTitle)}}const Wt=function(x){return{"work-packages--activity--add-comment_top":x}};function it(x,A){if(1&x&&(n.TgZ(0,"div",5,6),n.TgZ(2,"div",7),n.YNc(3,vt,1,3,"edit-form-portal",8),n.YNc(4,Ht,4,3,"div",9),n.qZA(),n.qZA()),2&x){const Z=n.oxw();n.Q6J("ngClass",n.VKq(3,Wt,Z.showAbove)),n.xp6(3),n.Q6J("ngIf",Z.active),n.xp6(1),n.Q6J("ngIf",!Z.active)}}function de(x,A){if(1&x&&n.GkF(0,4),2&x){const Z=n.oxw();n.Q6J("ngTemplateOutlet",Z.template)}}class ae extends It{constructor(A,Z,Ce,Ie,Be,Tt,Qt,bt,xt,Nt,Rt){super(A,Z),this.elementRef=A,this.injector=Z,this.commentService=Ce,this.wpLinkedActivities=Ie,this.ConfigurationService=Be,this.loadingIndicator=Tt,this.apiV3Service=Qt,this.workPackageNotificationService=bt,this.toastService=xt,this.cdRef=Nt,this.I18n=Rt,this.text={editTitle:this.I18n.t("js.label_add_comment_title"),addComment:this.I18n.t("js.label_add_comment"),cancelTitle:this.I18n.t("js.label_cancel_comment"),placeholder:this.I18n.t("js.label_add_comment_title")},this.fieldLabel=this.text.editTitle,this.inFlight=!1,this.htmlId="wp-comment-field"}ngOnInit(){super.ngOnInit(),this.canAddComment=!!this.workPackage.addComment,this.showAbove=this.ConfigurationService.commentsSortedInDescendingOrder(),this.commentService.quoteEvents.pipe(this.untilDestroyed()).subscribe(A=>{this.activate(A),this.commentContainer.nativeElement.scrollIntoView()})}startDragOverActivation(A){return!!this.active||(this.activate(),A.preventDefault(),!1)}activate(A){super.activate(A),this.showAbove||this.scrollToBottom(),this.cdRef.detectChanges()}deactivate(A){A&&this.focus(),this.active=!1,this.cdRef.detectChanges()}handleUserSubmit(){return(0,Ot.mG)(this,void 0,void 0,function*(){if(this.inFlight||!this.rawComment)return Promise.resolve();this.inFlight=!0,yield this.onSubmit();const A=this.loadingIndicator.wpDetails;return A.promise=this.commentService.createComment(this.workPackage,this.commentValue).then(()=>{this.active=!1,this.toastService.addSuccess(this.I18n.t("js.work_packages.comment_added")),this.wpLinkedActivities.require(this.workPackage,!0),this.apiV3Service.work_packages.id(this.workPackage.id).refresh(),this.inFlight=!1,this.deactivate(!0)}).catch(Z=>{this.inFlight=!1,Z instanceof kt.o?this.workPackageNotificationService.showError(Z.resource,this.workPackage):this.toastService.addError(this.I18n.t("js.work_packages.comment_send_failed"))}),A.promise})}scrollToBottom(){const A=jQuery(this.elementRef.nativeElement).scrollParent()[0];A&&setTimeout(()=>{A.scrollTop=A.scrollHeight},400)}setErrors(A){}}ae.\u0275fac=function(A){return new(A||ae)(n.Y36(n.SBq),n.Y36(n.zs3),n.Y36(gt.O),n.Y36(Ne.a),n.Y36(Mt.e),n.Y36(Pt.vt),n.Y36(r.T),n.Y36(P.q),n.Y36(yt.kl),n.Y36(n.sBO),n.Y36(d.D))},ae.\u0275cmp=n.Xpm({type:ae,selectors:[["work-package-comment"]],contentQueries:function(A,Z,Ce){if(1&A&&n.Suo(Ce,n.Rgc,5),2&A){let Ie;n.iGM(Ie=n.CRH())&&(Z.template=Ie.first)}},viewQuery:function(A,Z){if(1&A&&n.Gf(ii,5),2&A){let Ce;n.iGM(Ce=n.CRH())&&(Z.commentContainer=Ce.first)}},inputs:{workPackage:"workPackage"},features:[n.qOj],decls:5,vars:3,consts:[["id","work-package-activites-container"],["id","work-package-comment-container"],[3,"ngTemplateOutlet",4,"ngIf"],["class","work-package--details--long-field work-packages--activity--add-comment hide-when-print",3,"ngClass",4,"ngIf"],[3,"ngTemplateOutlet"],[1,"work-package--details--long-field","work-packages--activity--add-comment","hide-when-print",3,"ngClass"],["commentContainer",""],[1,"inline-edit--container","inplace-edit"],[3,"schemaInput","changeInput","editFieldHandler",4,"ngIf"],[3,"dragover","dragenter",4,"ngIf"],[3,"schemaInput","changeInput","editFieldHandler"],[3,"dragover","dragenter"],[1,"work-package-comment","inline-edit--display-field",3,"title","click"],[1,"work-package-comment--text",3,"textContent"],["icon-classes","icon-edit",1,"work-package-comment--icon",3,"icon-title"]],template:function(A,Z){1&A&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.YNc(2,$t,1,1,"ng-container",2),n.YNc(3,it,5,5,"div",3),n.YNc(4,de,1,1,"ng-container",2),n.qZA(),n.qZA()),2&A&&(n.xp6(2),n.Q6J("ngIf",!Z.showAbove),n.xp6(1),n.Q6J("ngIf",Z.canAddComment),n.xp6(1),n.Q6J("ngIf",Z.showAbove))},directives:[l.O5,l.tP,l.mk,ti.m,S.o],encapsulation:2,changeDetection:0});var pe=t(10190),H=t(70692);const he=function(x,A){return{workPackageId:x,"#":A}};class ue{ngOnInit(){this.activityHtmlId=`activity-${this.activityNo}`,this.activityLabel=`#${this.activityNo}`}}ue.\u0275fac=function(A){return new(A||ue)},ue.\u0275cmp=n.Xpm({type:ue,selectors:[["activity-link"]],inputs:{workPackage:"workPackage",activityNo:"activityNo"},decls:1,vars:6,consts:[["uiSref","work-packages.show",3,"id","textContent","uiParams"]],template:function(A,Z){1&A&&n._UZ(0,"a",0),2&A&&(n.MGl("id","",Z.activityHtmlId,"-link"),n.Q6J("textContent",Z.activityLabel)("uiParams",n.WLB(3,he,Z.workPackage.id,Z.activityHtmlId)))},directives:[L.AnchorUISref,L.UISref],encapsulation:2});var ht=t(3742);function pt(x,A){1&x&&n._UZ(0,"span",11)}function Zt(x,A){if(1&x&&n._UZ(0,"op-principal",12),2&x){const Z=n.oxw(2);n.Q6J("principal",Z.activity.author)("hideName",!0)}}const Ct=function(x){return{name:x}};function ni(x,A){if(1&x&&n._UZ(0,"op-principal",12),2&x){const Z=n.oxw(2);n.Q6J("principal",n.VKq(2,Ct,Z.userName))("hideName",!0)}}function _i(x,A){if(1&x&&(n.TgZ(0,"span",13),n._UZ(1,"a",14),n.qZA()),2&x){const Z=n.oxw(2);n.xp6(1),n.Q6J("textContent",Z.userName),n.uIk("href",Z.userPath,n.LSH)("aria-label",Z.userLabel)}}function ri(x,A){if(1&x&&n._UZ(0,"span",15),2&x){const Z=n.oxw(2);n.Q6J("textContent",Z.userName)}}function ut(x,A){if(1&x&&(n.TgZ(0,"div",1),n.TgZ(1,"div",2),n.YNc(2,pt,1,0,"span",3),n._UZ(3,"activity-link",4),n.qZA(),n.YNc(4,Zt,1,2,"op-principal",5),n.YNc(5,ni,1,4,"op-principal",5),n.YNc(6,_i,2,3,"span",6),n.YNc(7,ri,1,1,"span",7),n._uU(8,"\xa0 "),n._UZ(9,"span",8),n.TgZ(10,"span",9),n._UZ(11,"span",10),n.qZA(),n.qZA()),2&x){const Z=n.oxw();n.uIk("data-notification-selector",Z.hasUnreadNotification?"notification-activity":null),n.xp6(2),n.Q6J("ngIf",Z.hasUnreadNotification),n.xp6(1),n.Q6J("workPackage",Z.workPackage)("activityNo",Z.activityNo),n.xp6(1),n.Q6J("ngIf",Z.activity.author),n.xp6(1),n.Q6J("ngIf",!Z.activity.author&&Z.userName),n.xp6(1),n.Q6J("ngIf",Z.userActive),n.xp6(1),n.Q6J("ngIf",!Z.userActive),n.xp6(2),n.Q6J("innerHtml",Z.revisionLink,n.oJD),n.xp6(2),n.Q6J("innerHtml",Z.message,n.oJD)}}class ze{constructor(A,Z,Ce,Ie){this.I18n=A,this.timezoneService=Z,this.cdRef=Ce,this.apiV3Service=Ie}ngOnInit(){this.loadAuthor(),this.project=this.workPackage.project,this.revision=this.activity.identifier,this.message=this.activity.message.html;const A=this.activity.showRevision.$link.href,Z=this.activity.formattedIdentifier,Ce=document.createElement("a");Ce.href=A,Ce.title=this.revision,Ce.textContent=this.I18n.t("js.label_committed_link",{revision_identifier:Z}),this.revisionLink=this.I18n.t("js.label_committed_at",{committed_revision_link:Ce.outerHTML,date:this.timezoneService.formattedDatetime(this.activity.createdAt)})}loadAuthor(){void 0===this.activity.author?this.userName=this.activity.authorName:this.apiV3Service.users.id((0,pe.Z)(this.activity.author.href)).get().subscribe(A=>{this.userId=A.id,this.userName=A.name,this.userActive=A.isActive,this.userAvatar=A.avatar,this.userPath=A.showUser.href,this.userLabel=this.I18n.t("js.label_author",{user:this.userName}),this.cdRef.detectChanges()})}}ze.\u0275fac=function(A){return new(A||ze)(n.Y36(d.D),n.Y36(H.B),n.Y36(n.sBO),n.Y36(r.T))},ze.\u0275cmp=n.Xpm({type:ze,selectors:[["revision-activity"]],inputs:{workPackage:"workPackage",activity:"activity",activityNo:"activityNo",hasUnreadNotification:"hasUnreadNotification"},decls:1,vars:1,consts:[["class","work-package-details-activities-activity-contents",4,"ngIf"],[1,"work-package-details-activities-activity-contents"],[1,"comments-number"],["class","comments-number--bubble op-bubble op-bubble_mini","data-qa-selector","revision-activity-bubble",4,"ngIf"],[1,"comments-number--link",3,"workPackage","activityNo"],[3,"principal","hideName",4,"ngIf"],["class","user",4,"ngIf"],["class","user",3,"textContent",4,"ngIf"],[1,"revision-activity--revision-link","date",3,"innerHtml"],[1,"user-comment","wiki"],[1,"message",3,"innerHtml"],["data-qa-selector","revision-activity-bubble",1,"comments-number--bubble","op-bubble","op-bubble_mini"],[3,"principal","hideName"],[1,"user"],[3,"textContent"],[1,"user",3,"textContent"]],template:function(A,Z){1&A&&n.YNc(0,ut,12,10,"div",0),2&A&&n.Q6J("ngIf",Z.workPackage)},directives:[l.O5,ue,ht.N],encapsulation:2,changeDetection:0});t(80044);var Te=t(71570),Re=t(65532),$e=t(21501),ot=t(80261);class dt{constructor(A,Z,Ce){this.domSanitizer=A,this.elementRef=Z,this.appRef=Ce,this.dynamicBootstrapper=ot.Z}set HTML(A){this.innerHtml=this.domSanitizer.bypassSecurityTrustHtml(A),this.dynamicBootstrapper.bootstrapOptionalEmbeddable(this.appRef,this.elementRef.nativeElement)}}function _t(x,A){if(1&x&&n._UZ(0,"op-principal",18),2&x){const Z=n.oxw(2);n.Q6J("principal",Z.user)("hideName",!0)}}function Ut(x,A){1&x&&n._UZ(0,"span",19)}function Lt(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"button",20),n.NdJ("click",function(){return n.CHM(Z),n.oxw(2).quoteComment()}),n._UZ(1,"op-icon",21),n.qZA()}if(2&x){const Z=n.oxw(2);n.Q6J("title",Z.text.quote_comment)}}function Xt(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"button",22),n.NdJ("click",function(){return n.CHM(Z),n.oxw(2).activate()}),n._UZ(1,"op-icon",23),n.qZA()}if(2&x){const Z=n.oxw(2);n.Q6J("ngClass","edit-activity--"+Z.activityNo)("title",Z.text.edit_comment)}}function zt(x,A){if(1&x&&n._UZ(0,"img",24),2&x){const Z=n.oxw(2);n.Q6J("src",Z.bcfSnapshotUrl,n.LSH)}}function li(x,A){if(1&x&&(n.TgZ(0,"div",25),n.TgZ(1,"div",26),n._UZ(2,"edit-form-portal",27),n.qZA(),n.qZA()),2&x){const Z=n.oxw(2);n.xp6(2),n.Q6J("changeInput",Z.change)("schemaInput",Z.schema)("editFieldHandler",Z.handler)}}function mi(x,A){if(1&x&&n._UZ(0,"op-dynamic-bootstrap",28),2&x){const Z=n.oxw(2);n.Q6J("HTML",Z.postedComment)}}function Ci(x,A){if(1&x&&(n.TgZ(0,"li"),n._UZ(1,"span",31),n.qZA()),2&x){const Z=A.$implicit;n.xp6(1),n.Q6J("innerHtml",Z,n.oJD)}}function Zi(x,A){if(1&x&&(n.TgZ(0,"ul",29),n.YNc(1,Ci,2,1,"li",30),n.qZA()),2&x){const Z=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",Z.details)}}function Kt(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"div",1),n.NdJ("mouseenter",function(){return n.CHM(Z),n.oxw().focus()})("mouseleave",function(){return n.CHM(Z),n.oxw().blur()}),n.TgZ(1,"div",2),n.YNc(2,_t,1,2,"op-principal",3),n.TgZ(3,"div"),n._UZ(4,"op-user-link",4),n.TgZ(5,"span",5),n._uU(6),n._UZ(7,"op-date-time",6),n.qZA(),n.qZA(),n.qZA(),n.TgZ(8,"div",7),n.YNc(9,Ut,1,0,"span",8),n._UZ(10,"activity-link",9),n.TgZ(11,"div",10),n.YNc(12,Lt,2,1,"button",11),n.YNc(13,Xt,2,2,"button",12),n.qZA(),n.qZA(),n.YNc(14,zt,1,1,"img",13),n.TgZ(15,"div",14),n.YNc(16,li,3,3,"div",15),n.YNc(17,mi,1,1,"op-dynamic-bootstrap",16),n.YNc(18,Zi,2,1,"ul",17),n.qZA(),n.qZA()}if(2&x){const Z=n.oxw();n.uIk("data-notification-selector",Z.hasUnreadNotification?"notification-activity":null),n.xp6(2),n.Q6J("ngIf",Z.userName),n.xp6(2),n.Q6J("user",Z.user),n.xp6(2),n.hij(" ",Z.isInitial?Z.text.label_created_on:Z.text.label_updated_on," "),n.xp6(1),n.Q6J("dateTimeValue",Z.activity.createdAt),n.xp6(2),n.Q6J("ngIf",Z.hasUnreadNotification),n.xp6(1),n.Q6J("workPackage",Z.workPackage)("activityNo",Z.activityNo),n.xp6(1),n.Q6J("hidden",Z.shouldHideIcons()),n.xp6(1),n.Q6J("ngIf",Z.userCanQuote),n.xp6(1),n.Q6J("ngIf",Z.userCanEdit),n.xp6(1),n.Q6J("ngIf",Z.bcfSnapshotUrl),n.xp6(2),n.Q6J("ngIf",Z.active),n.xp6(1),n.Q6J("ngIf",!Z.active&&(Z.isComment||Z.isBcfComment)),n.xp6(1),n.Q6J("ngIf",!Z.isInitial)}}dt.\u0275fac=function(A){return new(A||dt)(n.Y36(Te.H7),n.Y36(n.SBq),n.Y36(n.z2F))},dt.\u0275cmp=n.Xpm({type:dt,selectors:[["op-dynamic-bootstrap"]],inputs:{HTML:"HTML"},decls:1,vars:1,consts:[[1,"op-uc-container",3,"innerHtml"]],template:function(A,Z){1&A&&n._UZ(0,"div",0),2&A&&n.Q6J("innerHtml",Z.innerHtml,n.oJD)},encapsulation:2});class ei extends It{constructor(A,Z,Ce,Ie,Be,Tt,Qt,bt,xt,Nt,Rt,pi){super(A,Z),this.elementRef=A,this.injector=Z,this.sanitization=Ce,this.PathHelper=Ie,this.wpLinkedActivities=Be,this.commentService=Tt,this.ConfigurationService=Qt,this.apiV3Service=bt,this.cdRef=xt,this.I18n=Nt,this.ngZone=Rt,this.appRef=pi,this.userCanEdit=!1,this.userCanQuote=!1,this.details=[],this.focused=!1,this.text={label_created_on:this.I18n.t("js.label_created_on"),label_updated_on:this.I18n.t("js.label_updated_on"),quote_comment:this.I18n.t("js.label_quote_comment"),edit_comment:this.I18n.t("js.label_edit_comment")}}ngOnInit(){super.ngOnInit(),this.htmlId=`user_activity_edit_field_${this.activityNo}`,this.updateCommentText(),this.isComment="Activity::Comment"===this.activity._type,this.isBcfComment="Activity::BcfComment"===this.activity._type,this.$element=jQuery(this.elementRef.nativeElement),this.reset(),this.userCanEdit=!!this.activity.update,this.userCanQuote=!!this.workPackage.addComment,this.$element.bind("focusin",this.focus.bind(this)),this.$element.bind("focusout",this.blur.bind(this)),_.each(this.activity.details,A=>{this.details.push(A.html)}),this.apiV3Service.users.id((0,pe.Z)(this.activity.user.href)).get().subscribe(A=>{this.user=A,this.userId=A.id,this.userName=A.name,this.userAvatar=A.avatar,this.cdRef.detectChanges()}),window.location.hash===`#activity-${this.activityNo}`&&this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.elementRef.nativeElement.scrollIntoView(!0)})})}shouldHideIcons(){return!((this.isComment||this.isBcfComment)&&this.focussing())}activate(){super.activate(this.activity.comment.raw),this.cdRef.detectChanges()}handleUserSubmit(){return this.inFlight||!this.rawComment?Promise.resolve():this.updateComment()}quoteComment(){this.commentService.quoteEvents.next(this.quotedText(this.activity.comment.raw))}get bcfSnapshotUrl(){return _.get(this.activity,"bcfViewpoints[0]")?`${_.get(this.activity,"bcfViewpoints[0]").href}/snapshot`:null}updateComment(){return(0,Ot.mG)(this,void 0,void 0,function*(){return this.inFlight=!0,yield this.onSubmit(),this.commentService.updateComment(this.activity,this.rawComment||"").then(A=>{this.activity=A,this.updateCommentText(),this.wpLinkedActivities.require(this.workPackage,!0),this.apiV3Service.work_packages.cache.updateWorkPackage(this.workPackage)}).finally(()=>{this.deactivate(!0),this.inFlight=!1})})}focusEditIcon(){jQuery(`.edit-activity--${this.activityNo} a`).focus()}focus(){this.focused=!0,this.cdRef.detectChanges()}blur(){this.focused=!1,this.cdRef.detectChanges()}focussing(){return this.focused}setErrors(A){}quotedText(A){const Z=A.split("\n").map(Ce=>`\n> ${Ce}`).join("");return`${this.userName} wrote:\n${Z}`}deactivate(A){super.deactivate(A),A&&this.focusEditIcon()}updateCommentText(){this.postedComment=this.activity.comment.html}}function ai(x,A){if(1&x&&n._UZ(0,"revision-activity",4),2&x){const Z=n.oxw();n.Q6J("workPackage",Z.workPackage)("activity",Z.activity)("activityNo",Z.activityNo)("hasUnreadNotification",Z.hasUnreadNotification)}}function Ri(x,A){if(1&x&&n._UZ(0,"user-activity",5),2&x){const Z=n.oxw();n.Q6J("workPackage",Z.workPackage)("activity",Z.activity)("activityNo",Z.activityNo)("isInitial",Z.isInitial)("hasUnreadNotification",Z.hasUnreadNotification)}}ei.\u0275fac=function(A){return new(A||ei)(n.Y36(n.SBq),n.Y36(n.zs3),n.Y36(Te.H7),n.Y36(C.j),n.Y36(Ne.a),n.Y36(gt.O),n.Y36(Mt.e),n.Y36(r.T),n.Y36(n.sBO),n.Y36(d.D),n.Y36(n.R0b),n.Y36(n.z2F))},ei.\u0275cmp=n.Xpm({type:ei,selectors:[["user-activity"]],inputs:{workPackage:"workPackage",activity:"activity",activityNo:"activityNo",isInitial:"isInitial",hasUnreadNotification:"hasUnreadNotification"},features:[n.qOj],decls:1,vars:1,consts:[["class","op-user-activity work-package-details-activities-activity-contents",3,"mouseenter","mouseleave",4,"ngIf"],[1,"op-user-activity","work-package-details-activities-activity-contents",3,"mouseenter","mouseleave"],[1,"op-user-activity--user-line"],["class","op-user-activity--avatar",3,"principal","hideName",4,"ngIf"],[1,"op-user-activity--user-name",3,"user"],[1,"op-user-activity--date"],[3,"dateTimeValue"],[1,"comments-number"],["class","comments-number--bubble op-bubble op-bubble_mini","data-qa-selector","user-activity-bubble",4,"ngIf"],[1,"comments-number--link",3,"workPackage","activityNo"],[1,"comments-icons",3,"hidden"],["type","button","class","spot-link",3,"title","click",4,"ngIf"],["type","button","class","spot-link",3,"ngClass","title","click",4,"ngIf"],["class","activity-thumbnail",3,"src",4,"ngIf"],[1,"user-comment"],["class","inplace-edit",4,"ngIf"],["class","message",3,"HTML",4,"ngIf"],["class","work-package-details-activities-messages",4,"ngIf"],[1,"op-user-activity--avatar",3,"principal","hideName"],["data-qa-selector","user-activity-bubble",1,"comments-number--bubble","op-bubble","op-bubble_mini"],["type","button",1,"spot-link",3,"title","click"],["icon-classes","action-icon icon-quote"],["type","button",1,"spot-link",3,"ngClass","title","click"],["icon-classes","action-icon icon-edit"],[1,"activity-thumbnail",3,"src"],[1,"inplace-edit"],[1,"user-comment--form","inplace-edit--write-value"],[3,"changeInput","schemaInput","editFieldHandler"],[1,"message",3,"HTML"],[1,"work-package-details-activities-messages"],[4,"ngFor","ngForOf"],[1,"message",3,"innerHtml"]],template:function(A,Z){1&A&&n.YNc(0,Kt,19,15,"div",0),2&A&&n.Q6J("ngIf",Z.workPackage)},directives:[l.O5,Re.F,$e.F,ue,ht.N,S.o,l.mk,ti.m,dt,l.sg],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-user-activity--user-line[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:50px;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis}.op-user-activity--user-name[_ngcontent-%COMP%]{display:block;font-weight:bold;line-height:16px;margin-bottom:3px}.op-user-activity--date[_ngcontent-%COMP%]{display:block;font-size:.8rem;color:#555}.op-user-activity--avatar[_ngcontent-%COMP%]{flex-shrink:0;margin-right:.5rem}"],changeDetection:0});class bi{constructor(A,Z){this.PathHelper=A,this.I18n=Z}ngOnInit(){this.projectId=(0,pe.Z)(this.workPackage.project.href),this.activityType=this.activity._type}}function Oi(x,A){if(1&x&&(n.TgZ(0,"div",3),n._UZ(1,"activity-entry",4),n.ALo(2,"async"),n.qZA()),2&x){const Z=A.$implicit,Ce=n.oxw(2);n.xp6(1),n.Q6J("workPackage",Ce.workPackage)("activity",Z.activity)("activityNo",Z.number(Z.isReversed))("hasUnreadNotification",n.lcZ(2,5,Ce.hasUnreadNotification(Z.href)))("isInitial",Z.isInitial())}}function St(x,A){if(1&x&&(n.TgZ(0,"div",1),n.YNc(1,Oi,3,7,"div",2),n.qZA()),2&x){const Z=n.oxw();n.xp6(1),n.Q6J("ngForOf",Z.latestActivityInfo)("ngForTrackBy",Z.trackByIdentifier)}}bi.\u0275fac=function(A){return new(A||bi)(n.Y36(C.j),n.Y36(d.D))},bi.\u0275cmp=n.Xpm({type:bi,selectors:[["activity-entry"]],inputs:{workPackage:"workPackage",activity:"activity",activityNo:"activityNo",isInitial:"isInitial",hasUnreadNotification:"hasUnreadNotification"},decls:4,vars:4,consts:[[3,"id"],[3,"ngSwitch"],[3,"workPackage","activity","activityNo","hasUnreadNotification",4,"ngSwitchCase"],[3,"workPackage","activity","activityNo","isInitial","hasUnreadNotification",4,"ngSwitchDefault"],[3,"workPackage","activity","activityNo","hasUnreadNotification"],[3,"workPackage","activity","activityNo","isInitial","hasUnreadNotification"]],template:function(A,Z){1&A&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.YNc(2,ai,1,4,"revision-activity",2),n.YNc(3,Ri,1,5,"user-activity",3),n.qZA(),n.qZA()),2&A&&(n.MGl("id","activity-",Z.activityNo,""),n.uIk("data-qa-activity-number",Z.activityNo),n.xp6(1),n.Q6J("ngSwitch",Z.activityType),n.xp6(1),n.Q6J("ngSwitchCase","Revision"))},directives:[l.RF,l.n9,l.ED,ze,ei],encapsulation:2});class Mi extends Ye{constructor(){super(...arguments),this.latestActivityInfo=[],this.trackByIdentifier=(0,mt.AT)("identifier")}ngOnInit(){this.workPackageId=this.workPackage.id,super.ngOnInit()}shouldShowToggler(){return!1}updateActivities(A){super.updateActivities(A),this.latestActivityInfo=this.latestActivities()}latestActivities(A=3){if(this.reverse)return this.unfilteredActivities.slice(0,A).map((Be,Tt)=>this.info(Be,Tt));const Z=this.unfilteredActivities.slice(-A),Ce=this.unfilteredActivities.length-Z.length;return Z.map((Ie,Be)=>this.info(Ie,Ce+Be))}}function kn(x,A){if(1&x&&n._UZ(0,"wp-single-view",2),2&x){const Z=n.oxw();n.Q6J("workPackage",Z.workPackage)}}function cn(x,A){if(1&x&&(n.TgZ(0,"div",3),n.TgZ(1,"div",4),n.TgZ(2,"div",5),n._UZ(3,"h3",6),n.qZA(),n.qZA(),n._UZ(4,"newest-activity-on-overview",2),n.qZA()),2&x){const Z=n.oxw();n.xp6(3),n.Q6J("textContent",Z.tabName),n.xp6(1),n.Q6J("workPackage",Z.workPackage)}}Mi.\u0275fac=function(){let x;return function(Z){return(x||(x=n.n5z(Mi)))(Z||Mi)}}(),Mi.\u0275cmp=n.Xpm({type:Mi,selectors:[["newest-activity-on-overview"]],inputs:{workPackage:"workPackage"},features:[n.qOj],decls:2,vars:1,consts:[[3,"workPackage"],[1,"work-package-details-activities-list"],["class","work-package-details-activities-activity",4,"ngFor","ngForOf","ngForTrackBy"],[1,"work-package-details-activities-activity"],[3,"workPackage","activity","activityNo","hasUnreadNotification","isInitial"]],template:function(A,Z){1&A&&(n.TgZ(0,"work-package-comment",0),n.YNc(1,St,2,2,"ng-template"),n.qZA()),2&A&&n.Q6J("workPackage",Z.workPackage)},directives:[ae,l.sg,bi],pipes:[l.Ov],encapsulation:2,changeDetection:0});class wi extends h.N{constructor(A,Z,Ce){super(),this.I18n=A,this.$state=Z,this.apiV3Service=Ce,this.tabName=this.I18n.t("js.label_latest_activity"),this.workPackageId=this.$state.params.workPackageId,this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(Ie=>this.workPackage=Ie)}}function Pn(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"button",11),n.NdJ("click",function(){return n.CHM(Z),n.oxw(5).toggleComments()}),n.qZA()}if(2&x){const Z=n.oxw(5);n.Q6J("textContent",Z.togglerText)}}wi.\u0275fac=function(A){return new(A||wi)(n.Y36(d.D),n.Y36(e.StateService),n.Y36(r.T))},wi.\u0275cmp=n.Xpm({type:wi,selectors:[["wp-overview-tab"]],features:[n.qOj],decls:2,vars:2,consts:[[3,"workPackage",4,"ngIf"],["class","attributes-group",4,"ngIf"],[3,"workPackage"],[1,"attributes-group"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"]],template:function(A,Z){1&A&&(n.YNc(0,kn,1,1,"wp-single-view",0),n.YNc(1,cn,5,2,"div",1)),2&A&&(n.Q6J("ngIf",Z.workPackage),n.xp6(1),n.Q6J("ngIf",Z.workPackage))},directives:[l.O5,Qe.G,Mi],encapsulation:2});const xn=function(x){return{"-with-toggler":x}};function Fi(x,A){if(1&x&&(n.TgZ(0,"h3",8),n._UZ(1,"span",9),n.YNc(2,Pn,1,1,"button",10),n.qZA()),2&x){const Z=n.oxw(),Ce=Z.first,Ie=Z.$implicit,Be=n.oxw(3);n.Q6J("ngClass",n.VKq(3,xn,Ce&&Be.showToggler)),n.xp6(1),n.Q6J("textContent",Ie.date),n.xp6(1),n.Q6J("ngIf",Ce&&Be.showToggler)}}function En(x,A){if(1&x&&(n.TgZ(0,"div",5),n.YNc(1,Fi,3,5,"h3",6),n._UZ(2,"activity-entry",7),n.ALo(3,"async"),n.qZA()),2&x){const Z=A.$implicit,Ce=A.first,Ie=n.oxw(3);n.xp6(1),n.Q6J("ngIf",Ce||Z.isNextDate),n.xp6(1),n.Q6J("workPackage",Ie.workPackage)("activity",Z.activity)("activityNo",Z.number(Z.isReversed))("hasUnreadNotification",n.lcZ(3,6,Ie.hasUnreadNotification(Z.href)))("isInitial",Z.isInitial())}}function Wi(x,A){if(1&x&&(n.TgZ(0,"div",2),n.TgZ(1,"div",3),n.YNc(2,En,4,8,"div",4),n.qZA(),n.qZA()),2&x){const Z=n.oxw(2);n.xp6(2),n.Q6J("ngForOf",Z.visibleActivities)("ngForTrackBy",Z.trackByIdentifier)}}function gi(x,A){if(1&x&&(n.TgZ(0,"work-package-comment",1),n.YNc(1,Wi,3,2,"ng-template"),n.qZA()),2&x){const Z=n.oxw();n.Q6J("workPackage",Z.workPackage)}}class Ti extends Ye{constructor(){super(...arguments),this.tabName=this.I18n.t("js.work_packages.tabs.activity"),this.trackByIdentifier=(0,mt.AT)("identifier")}ngOnInit(){const{workPackageId:A}=this.uiRouterGlobals.params;this.workPackageId=A,super.ngOnInit()}}Ti.\u0275fac=function(){let x;return function(Z){return(x||(x=n.n5z(Ti)))(Z||Ti)}}(),Ti.\u0275cmp=n.Xpm({type:Ti,selectors:[["wp-activity-tab"]],features:[n.qOj],decls:1,vars:1,consts:[[3,"workPackage",4,"ngIf"],[3,"workPackage"],[1,"detail-activity"],[1,"work-package-details-activities-list"],["class","work-package-details-activities-activity",4,"ngFor","ngForOf","ngForTrackBy"],[1,"work-package-details-activities-activity"],["class","activity-date",3,"ngClass",4,"ngIf"],[3,"workPackage","activity","activityNo","hasUnreadNotification","isInitial"],[1,"activity-date",3,"ngClass"],[1,"activity-date--label",3,"textContent"],["type","button","class","activity-comments--toggler button -small -transparent -with-icon icon-filter icon-small hide-when-print",3,"textContent","click",4,"ngIf"],["type","button",1,"activity-comments--toggler","button","-small","-transparent","-with-icon","icon-filter","icon-small","hide-when-print",3,"textContent","click"]],template:function(A,Z){1&A&&n.YNc(0,gi,2,1,"work-package-comment",0),2&A&&n.Q6J("ngIf",Z.workPackage)},directives:[l.O5,ae,l.sg,bi,l.mk],pipes:[l.Ov],encapsulation:2});var Ui=t(18236),ki=t(61486),yi=t(18293),Pi=t(53448),Dt=t(96905),fi=t(4018),Gi=t(44040),On=t(74603),Ii=t(14274),qi=t(76491),Mn=t(659),Xi=t(92144);const dn="urn:openproject-org:api:v3:storages:authorization:Connected";var pn=t(84699);class di{constructor(A,Z){this.label=A,this.action=Z}}class Gt{constructor(A,Z,Ce,Ie){this.iconClass=A,this.header=Z,this.content=Ce,this.buttons=Ie}}var Yi=t(25502);function Li(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"button",6),n.NdJ("click",function(){return n.CHM(Z).$implicit.action()}),n.TgZ(1,"op-icon",7),n._UZ(2,"i",8),n.qZA(),n.TgZ(3,"span",9),n._uU(4),n.qZA(),n.qZA()}if(2&x){const Z=A.$implicit;n.xp6(4),n.Oqu(Z.label)}}class Bi{}Bi.\u0275fac=function(A){return new(A||Bi)},Bi.\u0275cmp=n.Xpm({type:Bi,selectors:[["op-storage-information"]],inputs:{viewModel:"viewModel"},decls:8,vars:6,consts:[[1,"text-box"],[1,"text-box-header"],[3,"textContent"],[1,"text-box-content"],[1,"button-box"],["class","button op-files-tab--storage-info-box-button",3,"click",4,"ngFor","ngForOf"],[1,"button","op-files-tab--storage-info-box-button",3,"click"],["icon-classes","button--icon spot-icon spot-icon_external-link",1,"op-icon--wrapper"],[1,"button--icon","spot-icon","spot-icon_external-link"],[1,"button--text"]],template:function(A,Z){1&A&&(n._UZ(0,"span"),n.TgZ(1,"div",0),n.TgZ(2,"div",1),n._UZ(3,"span",2),n.qZA(),n.TgZ(4,"div",3),n._UZ(5,"span",2),n.qZA(),n.qZA(),n.TgZ(6,"div",4),n.YNc(7,Li,5,1,"button",5),n.qZA()),2&A&&(n.Gre("spot-icon spot-icon_",Z.viewModel.iconClass," op-files-tab--storage-info-box-icon"),n.xp6(3),n.Q6J("textContent",Z.viewModel.header),n.xp6(2),n.Q6J("textContent",Z.viewModel.content),n.xp6(2),n.Q6J("ngForOf",Z.viewModel.buttons))},directives:[l.sg,S.o],encapsulation:2,changeDetection:0});var Dn=t(32782),An=t(6536),un=t(1706),jn=t(84335),hn=t(48705);const _n=["avatar"];function Di(x,A){if(1&x&&(n.TgZ(0,"a",15),n._UZ(1,"span",16),n.qZA()),2&x){const Z=n.oxw(2);n.Q6J("title",Z.text.title.downloadFileLink)("href",Z.fileLink._links.staticOriginDownload.href,n.LSH)}}function $i(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"button",17),n.NdJ("click",function(){return n.CHM(Z),n.oxw(2).confirmRemoveFileLink()}),n._UZ(1,"span",18),n.qZA()}if(2&x){const Z=n.oxw(2);n.Q6J("title",Z.text.title.removeFileLink)}}function en(x,A){if(1&x&&(n.TgZ(0,"div",10),n.YNc(1,Di,2,2,"a",11),n.TgZ(2,"a",12),n._UZ(3,"span",13),n.qZA(),n.YNc(4,$i,2,1,"button",14),n.qZA()),2&x){const Z=n.oxw();n.xp6(1),n.Q6J("ngIf",Z.downloadAllowed),n.xp6(1),n.Q6J("title",Z.text.title.openFileLocation)("href",Z.fileLink._links.staticOriginOpenLocation.href,n.LSH),n.xp6(2),n.Q6J("ngIf",Z.allowEditing)}}function Zn(x,A){if(1&x&&(n.TgZ(0,"div",19),n._UZ(1,"span",20),n._UZ(2,"span",21),n.qZA()),2&x){const Z=n.oxw();n.xp6(2),n.Q6J("textContent",Z.text.floatingText.noViewPermission)}}const qt=function(x){return{"spot-list--item-floating-wrapper__disabled op-files-tab--file-list-item-floating-wrapper__disabled":x}},Fe=function(x,A){return{disabled:x,"view-not-allowed":A}};class U{constructor(A,Z,Ce,Ie){this.i18n=A,this.timezoneService=Z,this.confirmDialogService=Ce,this.principalRendererService=Ie,this.allowEditing=!1,this.disabled=!0,this.removeFileLink=new n.vpe,this.tooltipAllignment=un.Z.TopLeft,this.text={title:{openFile:this.i18n.t("js.storages.file_links.open"),openFileLocation:this.i18n.t("js.storages.file_links.open_location"),removeFileLink:this.i18n.t("js.storages.file_links.remove"),downloadFileLink:""},floatingText:{noViewPermission:this.i18n.t("js.storages.file_links.no_permission")},removalTitle:this.i18n.t("js.storages.file_links.remove"),removalButtonLabel:this.i18n.t("js.storages.file_links.remove_short"),removalConfirmation:this.i18n.t("js.storages.file_links.remove_confirmation"),notAllowdTooltipText:this.i18n.t("js.storages.file_links.not_allowed_tooltip")}}get originData(){return this.fileLink.originData}ngOnInit(){this.originData.lastModifiedAt&&(this.infoTimestampText=this.timezoneService.parseDatetime(this.originData.lastModifiedAt).fromNow()),this.fileLinkIcon=(0,An.g)(this.originData.mimeType),this.downloadAllowed="application/x-op-directory"!==this.originData.mimeType,this.text.title.downloadFileLink=this.i18n.t("js.storages.file_links.download",{fileName:this.fileLink.originData.name}),this.viewAllowed="urn:openproject-org:api:v3:file-links:permission:View"===this.fileLink._links.permission.href}ngAfterViewInit(){this.originData.lastModifiedByName?this.principalRendererService.render(this.avatar.nativeElement,{name:this.originData.lastModifiedByName,href:"/external_users/1"},{hide:!0,link:!1},{hide:!1,size:"mini"}):this.principalRendererService.render(this.avatar.nativeElement,{name:"Not Available",href:"/placeholder_users/1"},{hide:!0,link:!1},{hide:!1,size:"mini"})}confirmRemoveFileLink(){const A={text:{text:this.text.removalConfirmation,title:this.text.removalTitle,button_continue:this.text.removalButtonLabel},icon:{continue:"remove-link"}};this.confirmDialogService.confirm(A).then(()=>{this.removeFileLink.emit()}).catch(()=>{})}}function z(x,A){if(1&x&&n._UZ(0,"op-storage-information",5),2&x){const Z=A.$implicit;n.Q6J("viewModel",Z)}}function re(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"li",6),n.NdJ("removeFileLink",function(){const Be=n.CHM(Z).$implicit;return n.oxw(2).removeFileLink(Be)}),n.ALo(1,"async"),n.qZA()}if(2&x){const Z=A.$implicit,Ce=n.oxw(2);n.Q6J("fileLink",Z)("disabled",Ce.disabled)("allowEditing",n.lcZ(1,3,Ce.allowEditing$))}}function we(x,A){if(1&x){const Z=n.EpF();n.TgZ(0,"p",7),n.TgZ(1,"a",8),n.NdJ("click",function(){return n.CHM(Z),n.oxw(2).openStorageLocation()}),n._UZ(2,"span",9),n._UZ(3,"span",10),n.qZA(),n.qZA()}if(2&x){const Z=n.oxw(2);n.xp6(3),n.Q6J("textContent",Z.text.actions.linkFile(Z.storageType))}}function Ze(x,A){if(1&x&&(n.ynx(0),n.YNc(1,z,1,1,"op-storage-information",1),n.ALo(2,"async"),n.TgZ(3,"ul",2),n.YNc(4,re,2,5,"li",3),n.ALo(5,"async"),n.qZA(),n.YNc(6,we,4,1,"p",4),n.ALo(7,"async"),n.BQk()),2&x){const Z=n.oxw();n.xp6(1),n.Q6J("ngForOf",n.lcZ(2,3,Z.storageInformation)),n.xp6(3),n.Q6J("ngForOf",n.lcZ(5,5,Z.fileLinks$)),n.xp6(2),n.Q6J("ngIf",n.lcZ(7,7,Z.showLinkFilesAction))}}U.\u0275fac=function(A){return new(A||U)(n.Y36(d.D),n.Y36(H.B),n.Y36(jn.D),n.Y36(Dn.C))},U.\u0275cmp=n.Xpm({type:U,selectors:[["","op-file-link-list-item",""]],viewQuery:function(A,Z){if(1&A&&n.Gf(_n,5),2&A){let Ce;n.iGM(Ce=n.CRH())&&(Z.avatar=Ce.first)}},inputs:{fileLink:"fileLink",allowEditing:"allowEditing",disabled:"disabled"},outputs:{removeFileLink:"removeFileLink"},attrs:["op-file-link-list-item",""],decls:12,vars:21,consts:[[1,"spot-list--item-floating-wrapper","op-files-tab--file-list-item-floating-wrapper",3,"disabled","alignment","ngClass"],["slot","body",1,"spot-body-small"],["slot","trigger"],["target","_blank",1,"spot-list--item-action","spot-list--item-action_link","op-files-tab--file-list-item-action",3,"ngClass","href","title"],[1,"spot-list--item-title","op-files-tab--file-list-item-title",3,"textContent","title"],[1,"op-files-tab--file-list-item-text",3,"textContent"],[1,"op-files-tab--file-list-item-avatar"],["avatar",""],["class","spot-list--item-floating-actions op-files-tab--file-list-item-floating-actions hidden-for-mobile",4,"ngIf"],["class","spot-list--item-floating-actions op-files-tab--file-list-item-floating-text hidden-for-mobile",4,"ngIf"],[1,"spot-list--item-floating-actions","op-files-tab--file-list-item-floating-actions","hidden-for-mobile"],["class","spot-link",3,"title","href",4,"ngIf"],["target","_blank",1,"spot-link",3,"title","href"],[1,"spot-icon","spot-icon_folder-open"],["class","spot-link",3,"title","click",4,"ngIf"],[1,"spot-link",3,"title","href"],[1,"spot-icon","spot-icon_download-arrow"],[1,"spot-link",3,"title","click"],[1,"spot-icon","spot-icon_remove-link"],[1,"spot-list--item-floating-actions","op-files-tab--file-list-item-floating-text","hidden-for-mobile"],[1,"spot-icon","spot-icon_info2","op-files-tab--icon","op-files-tab--file-list-item-floating-text-icon"],[3,"textContent"]],template:function(A,Z){1&A&&(n.TgZ(0,"spot-tooltip",0),n.TgZ(1,"p",1),n._uU(2),n.qZA(),n.ynx(3,2),n.TgZ(4,"a",3),n._UZ(5,"span"),n._UZ(6,"span",4),n._UZ(7,"span",5),n._UZ(8,"div",6,7),n.qZA(),n.YNc(10,en,5,4,"div",8),n.YNc(11,Zn,3,1,"div",9),n.BQk(),n.qZA()),2&A&&(n.Q6J("disabled",!Z.disabled)("alignment",Z.tooltipAllignment)("ngClass",n.VKq(16,qt,Z.disabled)),n.xp6(2),n.Oqu(Z.text.notAllowdTooltipText),n.xp6(2),n.Q6J("ngClass",n.WLB(18,Fe,Z.disabled,!Z.viewAllowed))("href",Z.fileLink._links.staticOriginOpen.href,n.LSH)("title",Z.fileLink.originData.name),n.xp6(1),n.MT6("spot-icon spot-icon_",Z.fileLinkIcon.icon," op-files-tab--icon op-files-tab--icon_",Z.fileLinkIcon.clazz,""),n.xp6(1),n.Q6J("textContent",Z.fileLink.originData.name)("title",Z.fileLink.originData.name),n.xp6(1),n.Q6J("textContent",Z.infoTimestampText),n.xp6(3),n.Q6J("ngIf",!Z.disabled&&Z.viewAllowed),n.xp6(1),n.Q6J("ngIf",!Z.disabled&&!Z.viewAllowed))},directives:[hn.s,l.mk,l.O5],encapsulation:2,changeDetection:0});class We extends h.N{constructor(A,Z,Ce,Ie){super(),this.i18n=A,this.fileLinkResourceService=Z,this.currentUserService=Ce,this.cookieService=Ie,this.disabled=!1,this.storageInformation=new qi.X([]),this.showLinkFilesAction=new qi.X(!1),this.storageTypeMap={},this.text={infoBox:{emptyStorageHeader:Be=>this.i18n.t("js.storages.link_files_in_storage",{storageType:Be}),emptyStorageContent:Be=>this.i18n.t("js.storages.information.no_file_links",{storageType:Be}),emptyStorageButton:Be=>this.i18n.t("js.storages.open_storage",{storageType:Be}),fileLinkErrorHeader:this.i18n.t("js.storages.information.live_data_error"),fileLinkErrorContent:Be=>this.i18n.t("js.storages.information.live_data_error_description",{storageType:Be}),connectionErrorHeader:Be=>this.i18n.t("js.storages.no_connection",{storageType:Be}),connectionErrorContent:Be=>this.i18n.t("js.storages.information.connection_error",{storageType:Be}),authorizationFailureHeader:Be=>this.i18n.t("js.storages.login_to",{storageType:Be}),authorizationFailureContent:Be=>this.i18n.t("js.storages.information.not_logged_in",{storageType:Be}),loginButton:Be=>this.i18n.t("js.storages.login",{storageType:Be})},actions:{linkFile:Be=>this.i18n.t("js.storages.link_files_in_storage",{storageType:Be})}}}get storageFilesLocation(){return this.storage._links.open.href}ngOnInit(){this.initializeStorageTypes(),this.storageType=this.storageTypeMap[this.storage._links.type.href],this.disabled=this.storage._links.authorizationState.href!==dn,this.fileLinks$=this.fileLinkResourceService.collection(this.collectionKey),this.fileLinks$.pipe(this.untilDestroyed()).subscribe(A=>{(0,pn.Z)(this.resource)&&(this.resource.fileLinks={elements:A.map(Z=>{var Ce;return null===(Ce=Z._links)||void 0===Ce?void 0:Ce.self})}),this.storageInformation.next(this.instantiateStorageInformation(A)),this.showLinkFilesAction.next(!this.disabled&&A.length>0)}),this.allowEditing$=this.currentUserService.hasCapabilities$("file_links/manage",this.resource.project.id)}removeFileLink(A){this.fileLinkResourceService.remove(this.collectionKey,A)}openStorageLocation(){window.open(this.storageFilesLocation,"_blank")}instantiateStorageInformation(A){switch(this.storage._links.authorizationState.href){case"urn:openproject-org:api:v3:storages:authorization:FailedAuthorization":return[this.failedAuthorizationInformation];case"urn:openproject-org:api:v3:storages:authorization:Error":return[this.authorizationErrorInformation];case dn:return 0===A.length?[this.emptyStorageInformation]:A.filter(Z=>"urn:openproject-org:api:v3:file-links:permission:Error"===Z._links.permission.href).length>0?(this.disabled=!0,[this.fileLinkErrorInformation]):[];default:return[]}}get failedAuthorizationInformation(){return new Gt("import",this.text.infoBox.authorizationFailureHeader(this.storageType),this.text.infoBox.authorizationFailureContent(this.storageType),[new di(this.text.infoBox.loginButton(this.storageType),()=>{if(!this.storage._links.authorize)throw new Error("Authorize link is missing!");{const A=(0,Mn.Z)();this.setAuthorizationCallbackCookie(A),window.location.href=We.authorizationFailureActionUrl(this.storage._links.authorize.href,A)}})])}get authorizationErrorInformation(){return new Gt("remove-link",this.text.infoBox.connectionErrorHeader(this.storageType),this.text.infoBox.connectionErrorContent(this.storageType),[])}get emptyStorageInformation(){return new Gt("add-link",this.text.infoBox.emptyStorageHeader(this.storageType),this.text.infoBox.emptyStorageContent(this.storageType),[new di(this.text.infoBox.emptyStorageButton(this.storageType),()=>{window.open(this.storageFilesLocation,"_blank")})])}get fileLinkErrorInformation(){return new Gt("error",this.text.infoBox.fileLinkErrorHeader,this.text.infoBox.fileLinkErrorContent(this.storageType),[])}get collectionKey(){return(0,pn.Z)(this.resource)?"new":this.fileLinkSelfLink}get fileLinkSelfLink(){return`${this.resource.fileLinks.href}?filters=[{"storage":{"operator":"=","values":["${this.storage.id}"]}}]`}setAuthorizationCallbackCookie(A){this.cookieService.set(`oauth_state_${A}`,window.location.href,{path:"/"})}static authorizationFailureActionUrl(A,Z){return`${A}&state=${Z}`}initializeStorageTypes(){this.storageTypeMap["urn:openproject-org:api:v3:storages:Nextcloud"]=this.i18n.t("js.storages.types.nextcloud")}}function Ve(x,A){if(1&x&&(n.TgZ(0,"div",5),n._UZ(1,"span",6),n._UZ(2,"span",7),n.qZA()),2&x){const Z=n.oxw();n.xp6(2),n.Q6J("textContent",Z.text.attachments.label)}}function Ge(x,A){if(1&x&&(n.TgZ(0,"section",8),n.TgZ(1,"div",5),n._UZ(2,"span",9),n._UZ(3,"span",7),n.qZA(),n._UZ(4,"op-file-link-list",10),n.qZA()),2&x){const Z=A.$implicit,Ce=n.oxw();n.xp6(3),n.Q6J("textContent",Z.name),n.xp6(1),n.Q6J("resource",Ce.workPackage)("storage",Z)}}We.\u0275fac=function(A){return new(A||We)(n.Y36(d.D),n.Y36(Xi.s),n.Y36(Dt.S),n.Y36(Yi.N))},We.\u0275cmp=n.Xpm({type:We,selectors:[["op-file-link-list"]],inputs:{resource:"resource",storage:"storage"},features:[n.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","op-files-tab--storage-info-box","data-qa-selector","op-files-tab--storage-information",3,"viewModel",4,"ngFor","ngForOf"],["data-qa-selector","op-files-tab--file-list",1,"spot-list","spot-list_compact","op-files-tab--file-list"],["class","spot-list--item op-files-tab--file-list-item","data-qa-selector","op-files-tab--file-list-item","op-file-link-list-item","",3,"fileLink","disabled","allowEditing","removeFileLink",4,"ngFor","ngForOf"],["class","spot-body-small",4,"ngIf"],["data-qa-selector","op-files-tab--storage-information",1,"op-files-tab--storage-info-box",3,"viewModel"],["data-qa-selector","op-files-tab--file-list-item","op-file-link-list-item","",1,"spot-list--item","op-files-tab--file-list-item",3,"fileLink","disabled","allowEditing","removeFileLink"],[1,"spot-body-small"],[1,"spot-link","op-files-tab--file-list-action-button",3,"click"],[1,"spot-icon","spot-icon_external-link"],[3,"textContent"]],template:function(A,Z){1&A&&n.YNc(0,Ze,8,9,"ng-container",0),2&A&&n.Q6J("ngIf",Z.resource)},directives:[l.O5,l.sg,Bi,U],pipes:[l.Ov],encapsulation:2,changeDetection:0});const rt=function(x){return{"op-tab-content--tab-section_no-header":x}};class Xe{constructor(A,Z,Ce,Ie,Be,Tt,Qt){this.i18n=A,this.hook=Z,this.currentUserService=Ce,this.projectsResourceService=Ie,this.storagesResourceService=Be,this.apiV3=Tt,this.toast=Qt,this.text={attachments:{label:this.i18n.t("js.label_attachments")},file_links:{label:this.i18n.t("js.label_nextcloud")}}}ngOnInit(){const A=this.workPackage.project;if(null===A.id)return;const Z=this.currentUserService.hasCapabilities$("file_links/view",A.id);this.storages$=this.storagesResourceService.collection(A.href).pipe((0,yi.K)(Ce=>{throw this.toast.addError(Ce),Ce})),this.showAttachmentHeader$=(0,ki.aj)([this.storages$,Z]).pipe((0,ct.U)(([Ce,Ie])=>Ce.length>0&&Ie))}}Xe.\u0275fac=function(A){return new(A||Xe)(n.Y36(d.D),n.Y36(Pi.$),n.Y36(Dt.S),n.Y36(Gi.D),n.Y36(fi.l),n.Y36(r.T),n.Y36(yt.kl))},Xe.\u0275cmp=n.Xpm({type:Xe,selectors:[["op-files-tab"]],decls:9,vars:13,consts:[[1,"op-tab-content--container","op-files-tab"],["data-qa-selector","op-tab-content--tab-section",1,"op-tab-content--tab-section",3,"ngClass"],["class","op-tab-content--header",4,"ngIf"],[3,"resource"],["data-qa-selector","op-tab-content--tab-section","class","op-tab-content--tab-section",4,"ngFor","ngForOf"],[1,"op-tab-content--header"],[1,"spot-icon","spot-icon_attachment","op-files-tab--icon","op-files-tab--icon_clip"],[1,"op-tab-content--header-text",3,"textContent"],["data-qa-selector","op-tab-content--tab-section",1,"op-tab-content--tab-section"],[1,"spot-icon","spot-icon_nextcloud-circle","op-files-tab--icon","op-files-tab--icon_nextcloud"],[3,"resource","storage"]],template:function(A,Z){1&A&&(n.TgZ(0,"div",0),n.TgZ(1,"section",1),n.ALo(2,"async"),n.YNc(3,Ve,3,1,"div",2),n.ALo(4,"async"),n._UZ(5,"op-attachment-list",3),n._UZ(6,"op-attachments-upload",3),n.qZA(),n.YNc(7,Ge,5,3,"section",4),n.ALo(8,"async"),n.qZA()),2&A&&(n.xp6(1),n.Q6J("ngClass",n.VKq(11,rt,!1===n.lcZ(2,5,Z.showAttachmentHeader$))),n.xp6(2),n.Q6J("ngIf",n.lcZ(4,7,Z.showAttachmentHeader$)),n.xp6(2),n.Q6J("resource",Z.workPackage),n.xp6(1),n.Q6J("resource",Z.workPackage),n.xp6(1),n.Q6J("ngForOf",n.lcZ(8,9,Z.storages$)))},directives:[l.mk,l.O5,On.c,Ii.s,l.sg,We],pipes:[l.Ov],encapsulation:2,changeDetection:0});var at=t(84939);function Bt(x,A){return A.get(at.W).requireAndStream(x).pipe((0,ct.U)(Ce=>Ce.length))}function oi(x,A){const Z=A.get(f.V),Ce=A.get(r.T),Ie=x.id.toString();return Z.require(Ie),(0,ki.aj)([Z.state(Ie.toString()).values$(),Ce.work_packages.id(Ie).requireAndStream()]).pipe((0,ct.U)(([Be,Tt])=>_.size(Be)+_.size(Tt.children)))}function wt(x,A){return A.get(Ae.O).selectNotificationsCount$}var ft=t(88826);function ge(x,A){var Z;const Ce=A.get(ft.v),Ie=A.get(Xi.s);return(0,ki.aj)([Ce.collection(x.$links.attachments.href||""),Ie.collection((null===(Z=x.$links.fileLinks)||void 0===Z?void 0:Z.href)||"")]).pipe((0,ct.U)(([Be,Tt])=>Be.length+Tt.length))}class B{constructor(A,Z,Ce){this.$state=A,this.I18n=Z,this.injector=Ce,this.registeredTabs=this.buildDefaultTabs()}get tabs(){return[...this.registeredTabs]}register(...A){this.registeredTabs=[...this.registeredTabs,...A]}getDisplayableTabs(A){return this.tabs.filter(Z=>!Z.displayable||Z.displayable(A,this.$state)).map(Z=>Object.assign(Object.assign({},Z),{counter:Z.count?Ce=>Z.count(A,Ce||this.injector):Ce=>(0,i.D)([0])}))}getTab(A,Z){return this.getDisplayableTabs(Z).find(({id:Ce})=>Ce===A)}buildDefaultTabs(){return[{component:wi,name:this.I18n.t("js.work_packages.tabs.overview"),id:"overview",displayable:(A,Z)=>Z.includes("**.details.*")},{id:"activity",component:Ti,name:I18n.t("js.work_packages.tabs.activity"),count:wt,showCountAsBubble:!0},{id:"files",component:Xe,name:I18n.t("js.work_packages.tabs.files"),count:ge},{id:"relations",component:Ee,name:I18n.t("js.work_packages.tabs.relations"),count:oi},{id:"watchers",component:Ui.h,name:I18n.t("js.work_packages.tabs.watchers"),displayable:A=>!!A.watchers,count:Bt}]}}B.\u0275fac=function(A){return new(A||B)(n.LFG(e.StateService),n.LFG(d.D),n.LFG(n.zs3))},B.\u0275prov=n.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})},92092:(X,I,t)=>{"use strict";t.d(I,{E:()=>l});t(24897);var e=t(2316),d=t(54364),h=t(54262);const r=function(){return{colorize:!1}};function n(a,m){if(1&a&&(e.TgZ(0,"div",1),e.TgZ(1,"div",2),e._UZ(2,"op-editable-attribute-field",3),e.qZA(),e.TgZ(3,"div",4),e._UZ(4,"op-editable-attribute-field",5),e.qZA(),e.qZA()),2&a){const v=e.oxw();e.xp6(2),e.Q6J("resource",v.workPackage)("displayFieldOptions",e.DdM(7,r))("wrapperClasses","wp-new-top-row--status -no-label")("fieldName","status"),e.xp6(2),e.Q6J("resource",v.workPackage)("wrapperClasses","wp-new-top-row--type -no-label")("fieldName","type")}}class l{}l.\u0275fac=function(m){return new(m||l)},l.\u0275cmp=e.Xpm({type:l,selectors:[["wp-type-status"]],inputs:{workPackage:"workPackage"},decls:1,vars:1,consts:[["class","wp-new-top-row",4,"ngIf"],[1,"wp-new-top-row"],[1,"work-packages--status-selector","wp-new-top-row--element"],[3,"resource","displayFieldOptions","wrapperClasses","fieldName"],[1,"work-packages--type-selector","wp-new-top-row--element"],[3,"resource","wrapperClasses","fieldName"]],template:function(m,v){1&m&&e.YNc(0,n,5,8,"div",0),2&m&&e.Q6J("ngIf",v.workPackage)},directives:[d.O5,h.k],encapsulation:2})},73905:(X,I,t)=>{"use strict";t.d(I,{u:()=>c});t(24897);var e=t(96617),d=t(84939),h=t(26942),r=t(61908),n=t(2316),l=t(54364),a=t(2775);function m(p,f){if(1&p&&n._UZ(0,"span",4),2&p){const C=n.oxw(2);n.Q6J("textContent",C.buttonText)}}function v(p,f){if(1&p){const C=n.EpF();n.TgZ(0,"button",1),n.NdJ("click",function(){return n.CHM(C),n.oxw().toggleWatch()}),n._UZ(1,"op-icon",2),n.YNc(2,m,1,1,"span",3),n.qZA()}if(2&p){const C=n.oxw();n.Q6J("disabled",C.disabled)("ngClass",C.buttonClass)("id",C.buttonId),n.uIk("title",C.buttonTitle),n.xp6(1),n.MGl("icon-classes","button--icon ",C.watchIconClass,""),n.xp6(1),n.Q6J("ngIf",C.showText)}}class c extends h.N{constructor(f,C,u,k){super(),this.I18n=f,this.wpWatchersService=C,this.apiV3Service=u,this.cdRef=k,this.showText=!1,this.disabled=!1}ngOnInit(){this.apiV3Service.work_packages.id(this.workPackage).requireAndStream().pipe(this.untilDestroyed()).subscribe(f=>{this.workPackage=f,this.setWatchStatus(),this.cdRef.detectChanges()})}get isWatched(){return this.workPackage.hasOwnProperty("unwatch")}get displayWatchButton(){return this.isWatched||this.workPackage.hasOwnProperty("watch")}toggleWatch(){const f=this.nextStateLink();f(f.$link.payload).then(()=>{this.wpWatchersService.clear(this.workPackage.id),this.apiV3Service.work_packages.id(this.workPackage).refresh()})}nextStateLink(){const f=this.isWatched?"unwatch":"watch";return this.workPackage[f]}setWatchStatus(){this.isWatched?(this.buttonTitle=this.I18n.t("js.label_unwatch_work_package"),this.buttonText=this.I18n.t("js.label_unwatch"),this.buttonClass="-active",this.buttonId="unwatch-button",this.watchIconClass="icon-watched"):(this.buttonTitle=this.I18n.t("js.label_watch_work_package"),this.buttonText=this.I18n.t("js.label_watch"),this.buttonClass="",this.buttonId="watch-button",this.watchIconClass="icon-unwatched")}}c.\u0275fac=function(f){return new(f||c)(n.Y36(e.D),n.Y36(d.W),n.Y36(r.T),n.Y36(n.sBO))},c.\u0275cmp=n.Xpm({type:c,selectors:[["wp-watcher-button"]],inputs:{workPackage:"workPackage",showText:"showText",disabled:"disabled"},features:[n.qOj],decls:1,vars:1,consts:[["class","button toolbar-icon",3,"disabled","ngClass","id","click",4,"ngIf"],[1,"button","toolbar-icon",3,"disabled","ngClass","id","click"],[3,"icon-classes"],["class","button--text",3,"textContent",4,"ngIf"],[1,"button--text",3,"textContent"]],template:function(f,C){1&f&&n.YNc(0,v,3,6,"button",0),2&f&&n.Q6J("ngIf",C.displayWatchButton)},directives:[l.O5,l.mk,a.o],encapsulation:2,changeDetection:0})},43440:(X,I,t)=>{"use strict";t.d(I,{q:()=>r});var i=t(14808),e=t(79441),d=t(33927),h=t(2316);class r extends i.Ui{constructor(){super(...arguments),this.name="IsolatedQuerySpace",this.query=(0,i.qH)(),this.queryForm=(0,i.qH)(),this.results=(0,i.qH)(),this.groups=(0,i.qH)(),this.columns=(0,i.qH)(),this.collapsedGroups=(0,i.qH)(),this.tableRendered=(0,i.qH)(),this.timelineRendered=new e.xQ,this.renderedWorkPackages=(0,i.sY)(this.tableRendered,l=>l.pipe((0,d.U)(a=>a.filter(m=>!!m.workPackageId)))),this.renderedWorkPackageIds=(0,i.sY)(this.renderedWorkPackages,l=>l.pipe((0,d.U)(a=>a.map(m=>m.workPackageId.toString())))),this.stopAllSubscriptions=new e.xQ,this.additionalRequiredWorkPackages=(0,i.qH)(),this.initialized=(0,i.qH)(),this.available={columns:(0,i.qH)(),sortBy:(0,i.qH)(),groupBy:(0,i.qH)(),filters:(0,i.qH)(),displayRepresentation:(0,i.qH)()}}}r.\u0275fac=function(){let n;return function(a){return(n||(n=h.n5z(r)))(a||r)}}(),r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac})},97047:(X,I,t)=>{"use strict";t.d(I,{A:()=>ve});var i=t(43440),e=t(93903),d=t(41195),h=t(40533),r=t(61083),n=t(99676),l=t(82763),a=t(71562),m=t(74647),v=t(73165),c=t(60914),p=t(82271),f=t(81691),C=t(84897),u=t(63829),k=t(74478),O=t(48451),y=t(12703),b=t(61043),P=t(41945),E=t(78434),T=t(77591),M=t(8403),S=t(85388),R=t(32869),F=t(81539),L=t(3352),D=t(16451),G=t(95846),Q=t(64538),V=t(11337),K=t(2888),q=t(20066),se=t(16793),te=t(67727),ie=t(62964),le=t(46709),oe=t(79174),ne=t(56686),fe=t(2316);class ve{constructor(Oe,je,tt){this.elementRef=Oe,this.querySpace=je,this.injector=tt,(0,L.qu)("Opening isolated query space %O in %O",tt,Oe.nativeElement)}}ve.\u0275fac=function(Oe){return new(Oe||ve)(fe.Y36(fe.SBq),fe.Y36(i.q),fe.Y36(fe.zs3))},ve.\u0275dir=fe.lG2({type:ve,selectors:[["","wp-isolated-query-space",""]],features:[fe._Bn([{provide:te.W,useExisting:ie.q},i.q,e.j,F.Y,b.Z,d.a,h.S,r.w,oe.q,n.Y,l.q,a.i,m.Z,v.W,c.J,p.X,f.G,O.o,C.B,K.ld,q.F,G.M,se.f,Q.h,ne.h,P.O,E.U,T.j,M.m,S.j,R.x,V.c,y.l,le.f,u.P,k.f,D.B])]})},7794:(X,I,t)=>{"use strict";t.d(I,{H:()=>qt});var i=t(21757),e=t(2246),d=t(55811),h=t(53448),r=t(96617),n=t(36293),l=t(2281),a=t(22663),m=t(9170),v=t(14808),c=t(3786),p=t(87853),f=t(12703),C=t(29161),u=t(7812),k=t(50076),O=t(73165),y=t(44022),b=t(52377);class P{constructor(U,z,re,we,Ze,We,Ve){this.center=U,this.left=z,this.leftHover=re,this.right=we,this.rightHover=Ze,this.farRight=We,this.withAlternativeLabels=Ve}}var E=t(42529);const T="labelLeft",M="containerRight",S="labelRight",R="labelHoverLeft",F="labelHoverRight",L="-label-style",D="labelFarRight",G="show-on-hover",Q="hide-on-hover",V="leftHandle",K="rightHandle";class se{constructor(U,z){this.injector=U,this.workPackageTimeline=z,this.text={label_children_derived_duration:this.I18n.t("js.label_children_derived_duration")},this.fieldRenderer=new u.uA(this.injector,"timeline"),this.ganttChartRowHeight=+getComputedStyle(document.documentElement).getPropertyValue("--table-timeline--row-height").replace("px","")}get type(){return"bar"}canMoveDates(U){const z=this.schemaCache.of(U);return z.startDate.writable&&z.dueDate.writable&&z.isAttributeEditable("startDate")}isEmpty(U){const z=l(U.startDate),re=l(U.dueDate);return _.isNaN(z.valueOf())&&_.isNaN(re.valueOf())}displayPlaceholderUnderCursor(U,z){const[re,we]=this.cursorDateAndDayOffset(U,z),We=this.displayDurationForDate(z,re)*z.viewParams.pixelPerDay||30,Ve=document.createElement("div");return Ve.style.pointerEvents="none",Ve.style.position="absolute",Ve.style.height="1em",Ve.style.width=`${We}px`,Ve.style.zIndex="9999",Ve.style.left=we*z.viewParams.pixelPerDay+"px",this.applyTypeColor(z,Ve),Ve}assignDateValues(U,z,re){this.assignDate(U,"startDate",re.startDate),this.assignDate(U,"dueDate",re.dueDate),this.updateLabels(!0,z,U)}onDaysMoved(U,z,re,we){const Ze=U.pristineResource.startDate,We=U.pristineResource.dueDate,Ve=l().format("YYYY-MM-DD"),Ge=l(U.projectedResource.startDate),rt=l(U.projectedResource.dueDate),Xe={};return"left"===we?Xe.startDate=l(Ze||We).add(re,"days"):"right"===we?Xe.dueDate=l(We||Ve).add(re,"days"):"both"===we?(Ze&&(Xe.startDate=l(Ze).add(re,"days")),We&&(Xe.dueDate=l(We).add(re,"days"))):"dragright"===we&&(Xe.dueDate=Ge.clone().add(re,"days")),"both"!==we&&(void 0!==Xe.startDate&&Xe.startDate.isAfter(rt)?Xe.startDate=rt:void 0!==Xe.dueDate&&Xe.dueDate.isBefore(Ge)&&(Xe.dueDate=Ge)),Xe}onMouseDown(U,z,re,we){if(re.viewParams.activeSelectionMode)return re.viewParams.activeSelectionMode(re.workPackage),U.preventDefault(),"both";const Ze=re.change.projectedResource;let We;if(jQuery(U.target).hasClass(V)?(We="left",this.mouseDownCursorType="col-resize",null===Ze.startDate&&(Ze.startDate=Ze.dueDate)):jQuery(U.target).hasClass(K)||z?(We="right",this.mouseDownCursorType="col-resize"):(We="both",this.mouseDownCursorType="ew-resize"),this.workPackageTimeline.forceCursor(this.mouseDownCursorType),z){const Ve=this.cursorDateAndDayOffset(U,re)[0],Ge=this.displayDurationForDate(re,Ve)-1;Ze.startDate=z,Ze.dueDate=l(z).add(Ge,"days").format("YYYY-MM-DD"),We="dragright"}return this.updateLabels(!0,we,re.change),We}onMouseDownEnd(U,z){this.mouseDownCursorType="",this.workPackageTimeline.forceCursor(this.mouseDownCursorType),this.updateLabels(!1,U,z)}update(U,z,re){const{change:we}=re,Ze=U.querySelector(`.${E.PY}`);let We=l(we.projectedResource.startDate),Ve=l(we.projectedResource.dueDate);return _.isNaN(We.valueOf())&&_.isNaN(Ve.valueOf())?U.style.visibility="hidden":U.style.visibility="visible",_.isNaN(Ve.valueOf())&&!_.isNaN(We.valueOf())&&(Ve=l(),Ze.style.backgroundImage="linear-gradient(90deg, rgba(255,255,255,0) 0%, #F1F1F1 100%)"),_.isNaN(We.valueOf())&&!_.isNaN(Ve.valueOf())&&(We=Ve.clone(),Ze.style.backgroundImage="linear-gradient(90deg, #F1F1F1 0%, rgba(255,255,255,0) 80%)"),this.setElementPositionAndSize(U,re,We,Ve),z&&this.updateLabels(!1,z,we),this.checkForActiveSelectionMode(re,Ze),this.checkForSpecialDisplaySituations(re,Ze),this.applyTypeColor(re,Ze),!0}cursorDateAndDayOffset(U,z){const re=Math.floor(U.offsetX/z.viewParams.pixelPerDay);return[z.viewParams.dateDisplayStart.clone().add(re,"days"),re]}checkForActiveSelectionMode(U,z){U.viewParams.activeSelectionMode&&(z.style.backgroundImage="",U.viewParams.selectionModeStart===`${U.workPackage.id}`&&(jQuery(z).addClass(E.LT),z.style.background="none"))}displayDurationForDate(U,z){const{workPackage:re}=U;let we=Number(l.duration(re.duration||"P1D").asDays().toFixed(0));if(re.ignoreNonWorkingDays)return we;const{dateDisplayEnd:Ze}=U.viewParams;let We=0;for(;We<we;We++){const Ve=z.clone().add(We,"days");if(Ve>Ze)break;this.weekdayService.isNonWorkingDay(Ve.toDate())&&(we+=1)}return We}getMarginLeftOfLeftSide(U){const z=U.change.projectedResource;let re=l(z.startDate);const we=l(z.dueDate);re=_.isNaN(re.valueOf())?we.clone():re;const Ze=re.diff(U.viewParams.dateDisplayStart,"days");return(0,E.lW)(U.viewParams,Ze)}getMarginLeftOfRightSide(U){const z=U.change.projectedResource;let re=l(z.startDate),we=l(z.dueDate);re=_.isNaN(re.valueOf())?we.clone():re,we=_.isNaN(we.valueOf())?re.clone():we;const Ze=re.diff(U.viewParams.dateDisplayStart,"days"),We=we.diff(re,"days")+1;return(0,E.lW)(U.viewParams,Ze+We)}getPaddingLeftForIncomingRelationLines(U){return U.viewParams.pixelPerDay/8}getPaddingRightForOutgoingRelationLines(U){return 0}render(U){const z=document.createElement("div"),re=document.createElement("div"),we=document.createElement("div"),Ze=document.createElement("div");return z.className=`${E.mN} ${this.type}`,re.className=E.PY,we.className=V,Ze.className=K,z.appendChild(re),z.appendChild(we),z.appendChild(Ze),z}createAndAddLabels(U,z){const re=document.createElement("div");re.classList.add("bar-label"),this.applyTypeColor(U,re),z.appendChild(re);const we=document.createElement("div");we.classList.add(T,Q),z.appendChild(we);const Ze=document.createElement("div");Ze.classList.add(M),z.appendChild(Ze);const We=document.createElement("div");We.classList.add(S,Q),Ze.appendChild(We);const Ve=document.createElement("div");Ve.classList.add(D,Q),Ze.appendChild(Ve);const Ge=document.createElement("div");Ge.classList.add(R,G,L),z.appendChild(Ge);const rt=document.createElement("div");rt.classList.add(F,G,L),z.appendChild(rt);const Xe=new P(re,we,Ge,We,rt,Ve);return this.updateLabels(!1,Xe,U.change),Xe}applyTypeColor(U,z){const re=U.workPackage,{type:we}=re,Ze=U.viewParams.activeSelectionMode,{id:We}=we;Ze?z.classList.remove(k.Z.backgroundClass("type",We)):z.classList.add(k.Z.backgroundClass("type",We))}assignDate(U,z,re){re&&(U.projectedResource[z]=re.format("YYYY-MM-DD"))}setElementPositionAndSize(U,z,re,we){const{viewParams:Ze}=z,We=re.diff(Ze.dateDisplayStart,"days");U.style.left=(0,E.jr)(Ze,We);const Ve=we.diff(re,"days")+1;if(U.style.width=(0,E.jr)(Ze,Ve),!_.isNaN(re.valueOf())||!_.isNaN(we.valueOf())){const Ge=_.max([z.viewParams.pixelPerDay,2]);U.style.minWidth=`${Ge}px`}}cursorOrDatesAreNonWorking(U,z){return!z.workPackage.ignoreNonWorkingDays&&(U instanceof MouseEvent?[this.cursorDateAndDayOffset(U,z)[0]]:U).some(we=>this.weekdayService.isNonWorkingDay(we.toDate()))}checkForSpecialDisplaySituations(U,z){const re=U.workPackage,we=z.parentElement.parentElement,Ze=U.viewParams.activeSelectionMode;if(re.isLeaf||Ze||re.scheduleManually?z.classList.remove("-readonly"):z.classList.add("-readonly"),re.derivedStartDate&&re.derivedDueDate){const rt=l(re.derivedStartDate),Xe=l(re.derivedDueDate),at=l(U.change.projectedResource.startDate),Bt=l(U.change.projectedResource.dueDate),oi=we.querySelector(".children-duration-bar"),wt=document.createElement("div"),ft=document.createElement("div"),ge=document.querySelectorAll(`.wp-timeline-cell.__hierarchy-group-${re.id}:not([class*='__collapsed-group'])`).length||0;wt.classList.add("children-duration-bar","-clamp-style"),wt.title=this.text.label_children_derived_duration,ft.classList.add("children-duration-hover-container"),ft.style.height=this.ganttChartRowHeight*ge+10+"px",(rt.isBefore(at)||Xe.isAfter(Bt))&&wt.classList.add("-duration-overflow"),this.setElementPositionAndSize(wt,U,rt,Xe),oi&&oi.remove(),wt.appendChild(ft),we.appendChild(wt)}const{startDate:We,dueDate:Ve}=U.change.projectedResource;this.cursorOrDatesAreNonWorking([l(We),l(Ve)],U)?this.workPackageTimeline.forceCursor("not-allowed"):this.workPackageTimeline.forceCursor(this.mouseDownCursorType)}updateLabels(U,z,re){const we=this.wpTableTimeline.getNormalizedLabels(re.projectedResource);U||(this.renderLabel(re,z,"left",we.left),this.renderLabel(re,z,"right",we.right),this.renderLabel(re,z,"farRight",we.farRight)),this.renderHoverLabels(z,re)}renderHoverLabels(U,z){this.renderLabel(z,U,"leftHover","startDate"),this.renderLabel(z,U,"rightHover","dueDate")}renderLabel(U,z,re,we){const Ze=z[re];if(!Ze)return;if(Ze.innerHTML="",null===we)return void Ze.classList.remove("not-empty");const[We,Ve]=this.fieldRenderer.renderFieldValue(U.projectedResource,we,U);Ze&&We&&Ve?(Ve.classList.add("label-content"),Ze.appendChild(Ve),Ze.classList.add("not-empty")):Ze&&Ze.classList.remove("not-empty")}isParentWithVisibleChildren(U){if(!this.workPackageTimeline.inHierarchyMode)return!1;const z=this.workPackageTimeline.workPackageTable.lastRenderPass;return!!z&&!!z.parentsWithVisibleChildren[U.id]}}(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",O.W)],se.prototype,"wpTableTimeline",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",b.u)],se.prototype,"weekdayService",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",y.y)],se.prototype,"schemaCache",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",r.D)],se.prototype,"I18n",void 0);class te extends se{get type(){return"milestone"}isEmpty(U){const z=l(U.date);return _.isNaN(z.valueOf())}canMoveDates(U){const z=this.schemaCache.of(U);return z.date.writable&&z.isAttributeEditable("date")}displayPlaceholderUnderCursor(U,z){const re=Math.floor(U.offsetX/z.viewParams.pixelPerDay),we=document.createElement("div");we.className="timeline-element milestone",we.style.pointerEvents="none",we.style.height="1em",we.style.width="1em",we.style.left=re*z.viewParams.pixelPerDay+"px";const Ze=document.createElement("div");return Ze.className="diamond",Ze.style.left="0.5em",Ze.style.height="1em",Ze.style.width="1em",we.appendChild(Ze),this.applyTypeColor(z,Ze),we}assignDateValues(U,z,re){this.assignDate(U,"date",re.date),this.updateLabels(!0,z,U)}onDaysMoved(U,z,re,we){const Ze=U.pristineResource.date,We={};return Ze&&(We.date=l(Ze).add(re,"days")),We}onMouseDown(U,z,re,we){if(re.viewParams.activeSelectionMode)return re.viewParams.activeSelectionMode(re.workPackage),U.preventDefault(),"both";let Ze="both";return this.workPackageTimeline.forceCursor("ew-resize"),z?(re.change.projectedResource.date=z,Ze="create",Ze):(this.updateLabels(!0,we,re.change),Ze)}update(U,z,re){const{viewParams:we}=re,Ze=l(re.change.projectedResource.date);if(_.isNaN(Ze.valueOf()))return!1;const We=jQuery(".diamond",U)[0];We.style.width="15px",We.style.height="15px",We.style.width="15px",We.style.height="15px",We.style.marginLeft=re.viewParams.pixelPerDay/2-7.5+"px",this.applyTypeColor(re,We);const Ve=Ze.diff(we.dateDisplayStart,"days");return U.style.left=`${(0,E.lW)(we,Ve)}px`,z&&this.updateLabels(!1,z,re.change),this.checkForActiveSelectionMode(re,We),!0}getMarginLeftOfLeftSide(U){const{change:z}=U,we=l(z.projectedResource.date).diff(U.viewParams.dateDisplayStart,"days");return(0,E.lW)(U.viewParams,we)}getMarginLeftOfRightSide(U){return this.getMarginLeftOfLeftSide(U)+U.viewParams.pixelPerDay}getPaddingLeftForIncomingRelationLines(U){return U.viewParams.pixelPerDay/2-1}getPaddingRightForOutgoingRelationLines(U){return 7.5}render(U){const z=document.createElement("div");z.className=`${E.mN} ${this.type}`;const re=document.createElement("div");return re.className="diamond",z.appendChild(re),z}createAndAddLabels(U,z){const re=document.createElement("div");re.classList.add(T,Q),z.appendChild(re);const we=document.createElement("div");we.classList.add(M),z.appendChild(we);const Ze=document.createElement("div");Ze.classList.add(S,Q),we.appendChild(Ze);const We=document.createElement("div");We.classList.add(D,Q),we.appendChild(We);const Ve=document.createElement("div");Ve.classList.add(F,G,L),z.appendChild(Ve);const Ge=document.createElement("div");Ge.classList.add(R,G,L),z.appendChild(Ge);const rt=new P(null,re,Ge,Ze,Ve,We,U.withAlternativeLabels);return this.updateLabels(!1,rt,U.change),rt}renderHoverLabels(U,z){U.withAlternativeLabels?(this.renderLabel(z,U,"leftHover","date"),this.renderLabel(z,U,"rightHover","subject")):this.renderLabel(z,U,"rightHover","date")}updateLabels(U,z,re){const we=this.wpTableTimeline.getNormalizedLabels(re.projectedResource);U||(z.withAlternativeLabels?this.renderLabel(re,z,"right","subject"):"startDate"===we.left&&"dueDate"===we.right?(this.renderLabel(re,z,"left",null),this.renderLabel(re,z,"right","date")):(this.renderLabel(re,z,"left",we.left),this.renderLabel(re,z,"right",we.right)),this.renderLabel(re,z,"farRight",we.farRight)),this.renderHoverLabels(z,re)}renderLabel(U,z,re,we){("startDate"===we||"dueDate"===we)&&(we="date"),super.renderLabel(U,z,re,we)}}var ie=t(86469),le=t(1403),oe=t(62964),ne=t(43440),fe=t(33406),ve=t(53466),Se=t(61908);function Oe(Fe,U,z,re,we,Ze,We,Ve,Ge,rt,Xe,at){Fe.get(ne.q);let wt,oi=null;at.change=re.changeFor(at.workPackage);const ft=jQuery("body");function ge(bt,xt,Nt){const Rt=Xe.onDaysMoved(at.change,bt,xt,Nt);Xe.assignDateValues(at.change,rt,Rt),Xe.update(Ge,rt,at)}function B(bt,xt){const Nt=z.getAbsoluteLeftCoordinates(),Rt=xt.clientX-Nt;return Math.floor(Rt/bt.viewParams.pixelPerDay)}function Z(bt){bt.keyCode===fe.m.ESCAPE&&Be(!0)}function Ce(bt){const xt=at.workPackage;Xe.isEmpty(xt)&&(null==wt||wt.remove(),wt=Xe.displayPlaceholderUnderCursor(bt,at),(xt.isLeaf||xt.scheduleManually)&&Xe.canMoveDates(xt)&&!Xe.cursorOrDatesAreNonWorking(bt,at)?(Ve.style.cursor="",Ve.appendChild(wt),Ve.onmouseleave=()=>{wt.remove()},Ve.onmousedown=Rt=>{if(wt.remove(),Rt.preventDefault(),Xe.cursorOrDatesAreNonWorking(Rt,at))return;Ge.style.pointerEvents="none";const[pi,tn]=Xe.cursorDateAndDayOffset(Rt,at),Rn=pi.format("YYYY-MM-DD"),Kn=Xe.onMouseDown(Rt,Rn,at,rt);Xe.update(Ge,rt,at),"create"!==Kn?(ft.on("mousemove.emptytimelinecell",function(bt,xt){return Nt=>{wt.remove();const Rt=Math.abs(Ve.getBoundingClientRect().x-Nt.clientX),pi=Math.floor(Rt/at.viewParams.pixelPerDay);ge(at.viewParams.dateDisplayStart.clone().add(pi,"days"),pi-bt,xt)}}(tn,Kn)),ft.on("mouseup.emptytimelinecell",()=>Be(!1)),Ve.onmouseup=()=>{Be(!1)},ft.on("keyup.timelinecell",Z)):Be(!1)}):Ve.style.cursor="not-allowed")}function Be(bt){z.disableViewParamsCalculation=!1,Ve.onmousemove=Ce,Ve.onmousedown=_.noop,Ve.onmouseleave=_.noop,Ve.onmouseup=_.noop,Ge.style.pointerEvents="auto",ft.off(".timelinecell"),ft.off(".emptytimelinecell"),z.resetCursor(),oi=null;const{startDate:xt,dueDate:Nt}=at.change.projectedResource,Rt=Xe.cursorOrDatesAreNonWorking([l(xt),l(Nt)],at);if(bt||at.change.isEmpty()||Rt)Tt();else{const pi=()=>{at.change.clear(),Xe.onMouseDownEnd(rt,at.change)};(function(bt){const xt=Fe.get(Se.T),Nt=Fe.get(ne.q),Rt=l().toISOString();return We.table.promise=re.save(bt).then(pi=>{Ze.showSave(pi.resource);const tn=_.map(Nt.tableRendered.value,Rn=>Rn.workPackageId);return xt.work_packages.filterUpdatedSince(tn,Rt).get().toPromise().then(()=>(we.push(pi.resource,{eventType:"updated"}),Nt.timelineRendered.pipe((0,ve.q)(1)).toPromise()))})})(at.change).then(pi).catch(tn=>{Ze.handleRawError(tn,at.workPackage),Tt()})}}function Tt(){at.change.clear(),Xe.update(Ge,rt,at),Xe.onMouseDownEnd(rt,at.change),z.refreshView()}Ge.onmousedown=bt=>{1===bt.which&&function(bt,xt){xt.preventDefault();const Nt="active-drag";if(bt.classList.add(Nt),ft.on("mouseup.timelinecell",()=>bt.classList.remove(Nt)),z.disableViewParamsCalculation=!0,oi=B(at,xt),!at.workPackage.isLeaf&&!at.viewParams.activeSelectionMode&&!at.workPackage.scheduleManually)return;const Rt=Xe.onMouseDown(xt,null,at,rt);ft.on("mousemove.timelinecell",function(bt){return xt=>{const Nt=B(at,xt.originalEvent)-oi,Rt=Math.floor(xt.offsetX/at.viewParams.pixelPerDay);ge(at.viewParams.dateDisplayStart.clone().add(Rt,"days"),Nt,bt)}}(Rt)),ft.on("keyup.timelinecell",Z),ft.on("mouseup.timelinecell",()=>Be(!1))}(Ge,bt)},Ve.onmousemove=Ce}class je{constructor(U,z,re,we,Ze,We){this.injector=U,this.workPackageTimeline=z,this.renderers=re,this.latestRenderInfo=we,this.classIdentifier=Ze,this.workPackageId=We,this.wpElement=null}getMarginLeftOfLeftSide(){return this.cellRenderer(this.latestRenderInfo.workPackage).getMarginLeftOfLeftSide(this.latestRenderInfo)}getMarginLeftOfRightSide(){return this.cellRenderer(this.latestRenderInfo.workPackage).getMarginLeftOfRightSide(this.latestRenderInfo)}getPaddingLeftForIncomingRelationLines(){return this.cellRenderer(this.latestRenderInfo.workPackage).getPaddingLeftForIncomingRelationLines(this.latestRenderInfo)}getPaddingRightForOutgoingRelationLines(){return this.cellRenderer(this.latestRenderInfo.workPackage).getPaddingRightForOutgoingRelationLines(this.latestRenderInfo)}canConnectRelations(){const U=this.latestRenderInfo.workPackage;return this.schemaCache.of(U).isMilestone?!_.isNil(U.date):!_.isNil(U.startDate)||!_.isNil(U.dueDate)}clear(){this.cellElement.html(""),this.wpElement=null}get cellContainer(){return this.workPackageTimeline.timelineBody}get cellElement(){return this.cellContainer.find(`.${this.classIdentifier}`)}lazyInit(U,z){const re=this.workPackageTimeline.timelineBody[0],we=this.cellElement;return we.length?(null!==this.wpElement&&re.contains(this.wpElement)&&this.elementShape===U.type||(z.isDuplicatedCell||this.clear(),this.wpElement=U.render(z),this.labels=U.createAndAddLabels(z,this.wpElement),this.elementShape=U.type,we.append(this.wpElement),U.canMoveDates(z.workPackage)&&(this.wpElement.classList.add("-editable"),Oe(this.injector,0,this.workPackageTimeline,this.halEditing,this.halEvents,this.notificationService,this.loadingIndicator,we[0],this.wpElement,this.labels,U,z))),Promise.resolve()):Promise.reject("uninitialized")}cellRenderer(U){return this.schemaCache.of(U).isMilestone?this.renderers.milestone:this.renderers.generic}refreshView(U){this.latestRenderInfo=U;const z=this.cellRenderer(U.workPackage);this.lazyInit(z,U).then(()=>{z.update(this.wpElement,this.labels,U)||this.clear()}).catch(()=>null)}}(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",f.l)],je.prototype,"halEditing",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",le.J)],je.prototype,"halEvents",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",oe.q)],je.prototype,"notificationService",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",p.G)],je.prototype,"states",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",ie.vt)],je.prototype,"loadingIndicator",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",y.y)],je.prototype,"schemaCache",void 0);class tt{constructor(U,z){this.injector=U,this.wpTimeline=z,this.cells={},this.cellRenderers={milestone:new te(this.injector,z),generic:new se(this.injector,z)}}hasCell(U){return this.getCellsFor(U).length>0}getCellsFor(U){return _.filter(this.cells,z=>z.workPackageId===U)||[]}refreshAllCells(){this.synchronizeCells(),_.each(this.cells,U=>this.refreshSingleCell(U))}refreshCellsFor(U){_.each(this.getCellsFor(U),z=>this.refreshSingleCell(z))}refreshSingleCell(U,z,re){const we=this.renderInfoFor(U.workPackageId,z,re);we.workPackage&&U.refreshView(we)}synchronizeCells(){const U=Object.keys(this.cells),z=[];_.each(this.wpTimeline.workPackageIdOrder,re=>{const we=re.workPackageId;if(!we||this.states.workPackages.get(we).isPristine())return;const We=re.classIdentifier;this.cells[We]||(this.cells[We]=this.buildCell(We,we.toString())),z.push(We)}),_.difference(U,z).forEach(re=>{this.cells[re].clear(),delete this.cells[re]})}buildCell(U,z){return new je(this.injector,this.wpTimeline,this.cellRenderers,this.renderInfoFor(z),U,z)}renderInfoFor(U,z,re){const we=this.states.workPackages.get(U).value;return{viewParams:this.wpTimeline.viewParameters,workPackage:we,change:this.halEditing.changeFor(we),isDuplicatedCell:z,withAlternativeLabels:re}}buildCellsAndRenderOnRow(U,z,re){const we=U.map(Ze=>this.buildCell(z,Ze));return we.forEach(Ze=>this.refreshSingleCell(Ze,re,!0)),we}}(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",p.G)],tt.prototype,"states",void 0),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",f.l)],tt.prototype,"halEditing",void 0);var He=t(53457),st=t(99676),Me=t(9822),ce=t(3352),J=t(61486),W=t(26942),Y=t(18942),$=t(67749),be=t(79174),N=t(2316);class Ue extends W.N{constructor(U,z,re,we,Ze,We,Ve,Ge,rt,Xe,at,Bt,oi,wt){super(),this.injector=U,this.elementRef=z,this.states=re,this.wpTableComponent=we,this.toastService=Ze,this.wpTableTimeline=We,this.notificationService=Ve,this.wpRelations=Ge,this.wpTableHierarchies=rt,this.halEvents=Xe,this.querySpace=at,this.I18n=Bt,this.workPackageViewCollapsedGroupsService=oi,this.weekdaysService=wt,this._viewParameters=new E.O6,this.disableViewParamsCalculation=!1,this.workPackageIdOrder=[],this.renderers={},this.cellsRenderer=new tt(this.injector,this),this.selectionParams={notification:null},this.refreshRequest=(0,v.qH)(),this.collapsedGroupsCellsMap={},this.orderedRows=[]}get commonPipes(){return U=>U.pipe(this.untilDestroyed(),(0,a.R)(this.querySpace.stopAllSubscriptions),(0,m.h)(()=>this.initialized&&this.wpTableTimeline.isVisible))}get workPackagesWithGroupHeaderCell(){const z=this.querySpace.results.value.elements.filter(we=>this.shouldBeShownInCollapsedGroupHeaders(we)).map(we=>we.id);return this.orderedRows.filter(we=>z.includes(we.workPackageId)&&!this.workPackageIdOrder.includes(we))}ngAfterViewInit(){this.$element=jQuery(this.elementRef.nativeElement),this.text={selectionMode:this.I18n.t("js.timelines.selection_mode.notification")},this.outerContainer=this.$element.find(".wp-table-timeline--outer"),this.timelineBody=this.$element.find(".wp-table-timeline--body"),this.wpTableComponent.registerTimeline(this,this.timelineBody[0]),window.addEventListener("wp-resize.timeline",()=>this.refreshRequest.putValue(void 0)),(0,J.aj)([this.querySpace.tableRendered.values$(),this.refreshRequest.changes$(),this.wpTableTimeline.live$(),this.weekdaysService.loadWeekdays()]).pipe(this.commonPipes).subscribe(([U])=>{this.workPackageIdOrder=U.filter(z=>!z.hidden),this.orderedRows=U,this.refreshView()}),this.setupManageCollapsedGroupHeaderCells()}workPackageCells(U){return this.cellsRenderer.getCellsFor(U)}workPackageIndex(U){return this.workPackageIdOrder.findIndex(z=>z.classIdentifier===U)}onRefreshRequested(U,z){this.renderers[U]=z}getAbsoluteLeftCoordinates(){return this.$element.offset().left}getParentScrollContainer(){return this.outerContainer.closest(Me.UX)[0]}get viewParameters(){return this._viewParameters}get inHierarchyMode(){return this.wpTableHierarchies.isEnabled}get initialized(){return this.workPackageTable&&this.querySpace.tableRendered.hasValue()}refreshView(){this.wpTableTimeline.isVisible?(this.wpTableTimeline.isAutoZoom()?this.applyAutoZoomLevel():(this._viewParameters.settings.zoomLevel=this.wpTableTimeline.zoomLevel,this.wpTableTimeline.appliedZoomLevel=this.wpTableTimeline.zoomLevel),(0,ce.IN)("refreshView() in timeline container",()=>{this.outerContainer.css("width","auto"),this.calculateViewParams(this._viewParameters),this.cellsRenderer.refreshAllCells(),_.each(this.renderers,(z,re)=>{(0,ce.qu)(`Refreshing timeline member ${re}`),z(this._viewParameters)}),this.refreshCollapsedGroupsHeaderCells(this.collapsedGroupsCellsMap,this.cellsRenderer);const U=this.$element.find(E.eY)[0].scrollWidth;this.outerContainer.width(U),setTimeout(()=>{this.querySpace.timelineRendered.next(null)})})):(0,ce.qu)("refreshView() requested, but TL is invisible.")}startAddRelationPredecessor(U){this.activateSelectionMode(U.id,z=>{this.wpRelations.addCommonRelation(U.id,"follows",z.id).then(()=>{this.halEvents.push(U,{eventType:"association",relatedWorkPackage:z.id,relationType:"follows"})}).catch(re=>this.notificationService.handleRawError(re,z))})}startAddRelationFollower(U){this.activateSelectionMode(U.id,z=>{this.wpRelations.addCommonRelation(U.id,"precedes",z.id).then(()=>{this.halEvents.push(U,{eventType:"association",relatedWorkPackage:z.id,relationType:"precedes"})}).catch(re=>this.notificationService.handleRawError(re,z))})}getFirstDayInViewport(){const U=this.getParentScrollContainer(),{scrollLeft:z}=U,re=Math.floor(z/this.viewParameters.pixelPerDay);return this.viewParameters.dateDisplayStart.clone().add(re,"days")}getLastDayInViewport(){const U=this.getParentScrollContainer(),{scrollLeft:z}=U,we=z+U.offsetWidth,Ze=Math.ceil(we/this.viewParameters.pixelPerDay)+1;return this.viewParameters.dateDisplayStart.clone().add(Ze,"days")}forceCursor(U){jQuery(`.${E.mN}`).css("cursor",U),jQuery(".wp-timeline-cell").css("cursor",U),jQuery(".hascontextmenu").css("cursor",U),jQuery(".leftHandle").css("cursor",U),jQuery(".rightHandle").css("cursor",U)}resetCursor(){jQuery(`.${E.mN}`).css("cursor",""),jQuery(".wp-timeline-cell").css("cursor",""),jQuery(".hascontextmenu").css("cursor",""),jQuery(".leftHandle").css("cursor",""),jQuery(".rightHandle").css("cursor","")}resetSelectionMode(){this._viewParameters.activeSelectionMode=null,this._viewParameters.selectionModeStart=null,this.selectionParams.notification&&this.toastService.remove(this.selectionParams.notification),Mousetrap.unbind("esc"),this.$element.removeClass("active-selection-mode"),jQuery(`.${E.LT}`).removeClass(E.LT),this.refreshView()}activateSelectionMode(U,z){U=U.toString(),this._viewParameters.activeSelectionMode=re=>{z(re),this.resetSelectionMode()},this._viewParameters.selectionModeStart=U,Mousetrap.bind("esc",()=>this.resetSelectionMode()),this.selectionParams.notification=this.toastService.addNotice(this.text.selectionMode),this.$element.addClass("active-selection-mode"),this.refreshView()}calculateViewParams(U){if(this.disableViewParamsCalculation)return!1;const z=new E.O6;let re=!1;this.getWorkPackagesToCalculateTimelineWidthFrom().forEach(at=>{const Bt=at.workPackageId;if(!Bt)return;const wt=this.states.workPackages.get(Bt).value;if(!wt)return;const ft=wt.startDate?l(wt.startDate):U.now,ge=wt.dueDate?l(wt.dueDate):U.now,B=wt.date?l(wt.date):U.now;z.dateDisplayStart=l.min(z.dateDisplayStart,U.now,ft,B),z.dateDisplayEnd=l.max(z.dateDisplayEnd,U.now,ge,B)}),z.dateDisplayStart=z.dateDisplayStart.subtract(U.dayCountForMarginLeft,"days");const Ze=this.$element.children().width(),{pixelPerDay:We}=U,Ve=Math.ceil(Ze/We*1.5);z.dateDisplayEnd=z.dateDisplayEnd.add(Ve,"days"),z.dateDisplayStart.isSame(this._viewParameters.dateDisplayStart)||(re=!0,this._viewParameters.dateDisplayStart=z.dateDisplayStart),z.dateDisplayEnd.isSame(this._viewParameters.dateDisplayEnd)||(re=!0,this._viewParameters.dateDisplayEnd=z.dateDisplayEnd);const Xe=[this.getFirstDayInViewport(),this.getLastDayInViewport()];return this._viewParameters.visibleViewportAtCalculationTime=Xe,re}applyAutoZoomLevel(){if(0===this.workPackageIdOrder.length)return;const U=this.getWorkPackagesToCalculateTimelineWidthFrom(),z=(0,E.Nm)(U,this.states.workPackages,this._viewParameters),re=this.$element.parent().width()-2*E.g5;for(const we of E.$r){if(re/(0,E.GC)(we)>=z||we===_.last(E.$r))return this._viewParameters.settings.zoomLevel!==we&&(this._viewParameters.settings.zoomLevel=we,this.wpTableComponent.timeline.scrollLeft=0),void(this.wpTableTimeline.appliedZoomLevel=we)}}setupManageCollapsedGroupHeaderCells(){this.workPackageViewCollapsedGroupsService.updates$().pipe(this.commonPipes).subscribe(U=>{this.manageCollapsedGroupHeaderCells(U,this.querySpace.results.value.elements,this.collapsedGroupsCellsMap)})}manageCollapsedGroupHeaderCells(U,z,re){const we=U.allGroupsChanged,Ze=U.state,We=Object.keys(Ze);let Ve=[];if(We.length){if(we)Ve=We.filter(Ge=>this.shouldManageCollapsedGroupHeaderCells(Ge,U));else{const Ge=U.lastChangedGroup;this.shouldManageCollapsedGroupHeaderCells(Ge,U)&&(Ve=[Ge])}Ve.forEach(Ge=>{Ze[Ge]?this.createCollapsedGroupHeaderCells(Ge,z,re):this.removeCollapsedGroupHeaderCells(Ge,re)})}}shouldManageCollapsedGroupHeaderCells(U,z){const re=(0,$.dF)(U);return this.workPackageViewCollapsedGroupsService.groupTypesWithHeaderCellsWhenCollapsed.includes(re)&&this.workPackageViewCollapsedGroupsService.groupTypesWithHeaderCellsWhenCollapsed.includes(z.groupedBy)}createCollapsedGroupHeaderCells(U,z,re){this.removeCollapsedGroupHeaderCells(U,re);const we=(0,$.yD)(U),Ze=(0,$.dF)(U),Ge=z.filter(rt=>rt[Ze].id===we).filter(rt=>this.shouldBeShownInCollapsedGroupHeaders(rt)&&(rt.date||rt.startDate)).map(rt=>rt.id);this.collapsedGroupsCellsMap[U]=this.cellsRenderer.buildCellsAndRenderOnRow(Ge,`group-${U}-timeline`,!0)}removeCollapsedGroupHeaderCells(U,z){z[U]&&(z[U].forEach(re=>re.clear()),z[U]=[])}refreshCollapsedGroupsHeaderCells(U,z){Object.keys(U).forEach(re=>{U[re].forEach(Ze=>z.refreshSingleCell(Ze,!1,!0))})}shouldBeShownInCollapsedGroupHeaders(U){return this.workPackageViewCollapsedGroupsService.wpTypesToShowInCollapsedGroupHeaders.some(z=>z(U))}getWorkPackagesToCalculateTimelineWidthFrom(){return[...this.workPackageIdOrder,...this.workPackagesWithGroupHeaderCell]}}Ue.\u0275fac=function(U){return new(U||Ue)(N.Y36(N.zs3),N.Y36(N.SBq),N.Y36(p.G),N.Y36(Y.c),N.Y36(n.kl),N.Y36(O.W),N.Y36(oe.q),N.Y36(He.V),N.Y36(st.Y),N.Y36(le.J),N.Y36(ne.q),N.Y36(r.D),N.Y36(be.q),N.Y36(b.u))},Ue.\u0275cmp=N.Xpm({type:Ue,selectors:[["wp-timeline-container"]],features:[N.qOj],decls:7,vars:0,consts:[[1,"wp-table-timeline--outer"],[1,"wp-table-timeline--container"],[1,"wp-table-timeline--body"]],template:function(U,z){1&U&&(N.TgZ(0,"div",0),N.TgZ(1,"div",1),N._UZ(2,"wp-timeline-header"),N._UZ(3,"wp-timeline-static-elements"),N._UZ(4,"wp-timeline-grid"),N._UZ(5,"wp-timeline-relations"),N._UZ(6,"div",2),N.qZA(),N.qZA())},encapsulation:2});var et=t(84366),Ke=t(55548),_e=t(20342),ye=t(77355),Pe=t(71562),Ee=t(61083),Qe=t(82763),ct=(t(55054),t(57119)),lt=t(15893),Ne=t(84335);class Ae extends Ke.n{constructor(U,z,re,we,Ze,We,Ve,Ge,rt,Xe){super(U,z),this.elementRef=U,this.opContextMenu=z,this.wpTableColumns=re,this.wpTableSortBy=we,this.wpTableGroupBy=Ze,this.wpTableHierarchies=We,this.opModalService=Ve,this.injector=Ge,this.I18n=rt,this.confirmDialog=Xe,this.text={confirmDelete:{text:this.I18n.t("js.work_packages.table_configuration.sorting_mode.warning"),title:this.I18n.t("js.modals.form_submit.title")}}}open(U){!this.table.configuration.columnMenuEnabled||(this.buildItems(),this.opContextMenu.show(this,U))}get locals(){return{showAnchorRight:this.column&&"id"!==this.column.id,contextMenuId:"column-context-menu",items:this.items}}positionArgs(U){const z={of:this.$element.find(".generic-table--sort-header-outer")},re=super.positionArgs(U);return _.assign(re,z),re}get afterFocusOn(){return this.$element.find(`#${this.column.id}`)}buildItems(){const U=this.column;this.items=[{hidden:!this.wpTableSortBy.isSortable(U),linkText:this.I18n.t("js.work_packages.query.sort_descending"),icon:"icon-sort-descending",onClick:z=>this.wpTableSortBy.isManualSortingMode?(this.confirmDialog.confirm({text:this.text.confirmDelete}).then(()=>(this.wpTableSortBy.setAsSingleSortCriteria(U,lt.iV),!0)),!1):(this.wpTableSortBy.addSortCriteria(U,lt.iV),!0)},{hidden:!this.wpTableSortBy.isSortable(U),linkText:this.I18n.t("js.work_packages.query.sort_ascending"),icon:"icon-sort-ascending",onClick:z=>this.wpTableSortBy.isManualSortingMode?(this.confirmDialog.confirm({text:this.text.confirmDelete}).then(()=>(this.wpTableSortBy.setAsSingleSortCriteria(U,lt.S9),!0)),!1):(this.wpTableSortBy.addSortCriteria(U,lt.S9),!0)},{hidden:!this.wpTableGroupBy.isGroupable(U)||this.wpTableGroupBy.isCurrentlyGroupedBy(U),linkText:this.I18n.t("js.work_packages.query.group"),icon:"icon-group-by",onClick:()=>(this.wpTableHierarchies.isEnabled&&this.wpTableHierarchies.setEnabled(!1),this.wpTableGroupBy.setBy(U),!0)},{hidden:this.wpTableColumns.isFirst(U),linkText:this.I18n.t("js.work_packages.query.move_column_left"),icon:"icon-column-left",onClick:()=>(this.wpTableColumns.shift(U,-1),!0)},{hidden:this.wpTableColumns.isLast(U),linkText:this.I18n.t("js.work_packages.query.move_column_right"),icon:"icon-column-right",onClick:()=>(this.wpTableColumns.shift(U,1),!0)},{linkText:this.I18n.t("js.work_packages.query.hide_column"),icon:"icon-delete",onClick:()=>{const z=this.wpTableColumns.previous(U)||this.wpTableColumns.next(U);return this.wpTableColumns.removeColumn(U),setTimeout(()=>{z&&jQuery(`#${z.id}`).focus()}),!0}},{linkText:this.I18n.t("js.work_packages.query.insert_columns"),icon:"icon-columns",onClick:()=>(this.opModalService.show(ct.Q,this.injector,{initialTab:"columns"}),!0)}]}}Ae.\u0275fac=function(U){return new(U||Ae)(N.Y36(N.SBq),N.Y36(_e.$),N.Y36(Pe.i),N.Y36(Qe.q),N.Y36(Ee.w),N.Y36(st.Y),N.Y36(ye.S),N.Y36(N.zs3),N.Y36(r.D),N.Y36(Ne.D))},Ae.\u0275dir=N.lG2({type:Ae,selectors:[["","opColumnsContextMenu",""]],inputs:{column:["opColumnsContextMenu-column","column"],table:["opColumnsContextMenu-table","table"]},features:[N.qOj]});class xe{constructor(U,z,re,we){this.I18n=z,this.wpTimelineService=re,this.workPackageTimelineTableController=we,this.$element=jQuery(U.nativeElement)}ngOnInit(){this.workPackageTimelineTableController.onRefreshRequested("header",U=>this.refreshView(U))}refreshView(U){this.innerHeader=this.$element.find(".wp-table-timeline--header-inner"),this.renderLabels(U)}renderLabels(U){switch(this.innerHeader.empty(),this.innerHeader.attr("data-current-zoom-level",this.wpTimelineService.zoomLevel),U.settings.zoomLevel){case"days":this.renderLabelsDays(U);break;case"weeks":this.renderLabelsWeeks(U);break;case"months":this.renderLabelsMonths(U);break;case"quarters":this.renderLabelsQuarters(U);break;case"years":this.renderLabelsYears(U);break;default:return}this.activeZoomLevel=U.settings.zoomLevel}renderLabelsDays(U){this.renderTimeSlices(U,"month",0,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("MMM YYYY"),re.classList.add("wp-timeline--header-top-bold-element"),re.style.height="13px"}),this.renderTimeSlices(U,"week",13,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("ww"),re.classList.add("-top-border"),re.style.height="32px"}),this.renderTimeSlices(U,"day",23,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("D"),re.classList.add("-top-border"),re.style.height="22px"}),this.renderTimeSlices(U,"day",33,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("dd"),re.classList.add("wp-timeline--header-day-element")})}renderLabelsWeeks(U){this.renderTimeSlices(U,"month",0,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("MMM YYYY"),re.classList.add("wp-timeline--header-top-bold-element")}),this.renderTimeSlices(U,"week",15,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("ww"),re.classList.add("-top-border"),re.style.height="22px"}),this.renderTimeSlices(U,"day",25,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("D"),re.classList.add("wp-timeline--header-middle-element")})}renderLabelsMonths(U){this.renderTimeSlices(U,"year",0,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("YYYY"),re.classList.add("wp-timeline--header-top-bold-element")}),this.renderTimeSlices(U,"month",15,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("MMM"),re.classList.add("-top-border"),re.style.height="30px"}),this.renderTimeSlices(U,"week",25,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("ww"),re.classList.add("wp-timeline--header-middle-element")})}renderLabelsQuarters(U){this.renderTimeSlices(U,"year",0,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--header-top-bold-element"),re.innerHTML=z.format("YYYY")}),this.renderTimeSlices(U,"quarter",15,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=this.I18n.t("js.timelines.quarter_label",{quarter_number:z.format("Q")}),re.classList.add("-top-border"),re.style.height="30px"}),this.renderTimeSlices(U,"month",25,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("MMM"),re.classList.add("wp-timeline--header-middle-element")})}renderLabelsYears(U){this.renderTimeSlices(U,"year",0,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("YYYY"),re.classList.add("wp-timeline--header-top-bold-element")}),this.renderTimeSlices(U,"quarter",15,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=this.I18n.t("js.timelines.quarter_label",{quarter_number:z.format("Q")}),re.classList.add("-top-border"),re.style.height="30px"}),this.renderTimeSlices(U,"month",25,U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.innerHTML=z.format("M"),re.classList.add("wp-timeline--header-middle-element")})}renderTimeSlices(U,z,re,we,Ze,We){const{inViewportAndBoundaries:Ve,rest:Ge}=(0,E.kv)(U,z,we,Ze);for(const[rt,Xe]of Ve){const at=this.addLabelCell();at.style.top=`${re}px`,at.style.left=(0,E.jr)(U,rt.diff(we,"days")),at.style.width=(0,E.jr)(U,Xe.diff(rt,"days")+1),We(rt,at)}setTimeout(()=>{for(const[rt,Xe]of Ge){const at=this.addLabelCell();at.style.top=`${re}px`,at.style.left=(0,E.jr)(U,rt.diff(we,"days")),at.style.width=(0,E.jr)(U,Xe.diff(rt,"days")+1),We(rt,at)}},0)}addLabelCell(){const U=document.createElement("div");return U.className=E.bz,this.innerHeader.append(U),U}}xe.\u0275fac=function(U){return new(U||xe)(N.Y36(N.SBq),N.Y36(r.D),N.Y36(O.W),N.Y36(Ue))},xe.\u0275cmp=N.Xpm({type:xe,selectors:[["wp-timeline-header"]],decls:2,vars:0,consts:[[1,"wp-table-timeline--header"],[1,"wp-table-timeline--header-inner"]],template:function(U,z){1&U&&(N.TgZ(0,"div",0),N._UZ(1,"div",1),N.qZA())},encapsulation:2});var Ye=t(33927);function mt(Fe){return`__tl-relation-${Fe}`}class Ot{constructor(U,z){this.belongsToId=U,this.relation=z}get classNames(){return[mt(this.relation.ids.from),mt(this.relation.ids.to)]}}const Mt="relation-line";function yt(Fe,U,z,re,we,Ze,We,Ve){const Ge=document.createElement("div");return Ge.classList.add(E.mN,Mt,...U),Ge.style.top=`${40*z+re}px`,Ge.style.left=`${we}px`,Ge.style.width=`${Ze}px`,Ge.style.height=`${We}px`,Ge}class jt extends W.N{constructor(U,z,re,we,Ze,We){super(),this.injector=U,this.elementRef=z,this.states=re,this.workPackageTimelineTableController=we,this.wpTableTimeline=Ze,this.wpRelations=We,this.workPackagesWithRelations={}}ngOnInit(){const U=jQuery(this.elementRef.nativeElement);this.container=U.find(".wp-table-timeline--relations"),this.workPackageTimelineTableController.onRefreshRequested("relations",z=>this.refreshView()),this.setupRelationSubscription()}refreshView(){this.update()}get workPackageIdOrder(){return this.workPackageTimelineTableController.workPackageIdOrder}setupRelationSubscription(){(0,J.aj)([this.querySpace.renderedWorkPackages.values$(),this.wpTableTimeline.live$()]).pipe((0,m.h)(([U,z])=>z.visible),this.untilDestroyed(),(0,Ye.U)(([U,z])=>U)).subscribe(U=>{const z=_.compact(U.map(re=>re.workPackageId));this.wpRelations.requireAll(z),z.forEach(re=>{const we=this.wpRelations.state(re);this.workPackagesWithRelations[re]=we,we.values$().pipe((0,ve.q)(1)).subscribe(()=>{this.renderWorkPackagesRelations([re])})})}),this.states.workPackages.observeChange().pipe(this.untilDestroyed(),(0,m.h)(()=>this.wpTableTimeline.isVisible)).subscribe(([U])=>{this.renderWorkPackagesRelations([U])})}renderWorkPackagesRelations(U){U.forEach(z=>{const re=this.workPackagesWithRelations[z];if(_.isNil(re))return;this.removeRelationElementsForWorkPackage(z);const we=_.values(re.value);_.values(we).forEach(We=>{if("precedes"!==We.type&&"follows"!==We.type)return;const Ve=new Ot(We.ids.from,We);this.renderElement(this.workPackageTimelineTableController.viewParameters,Ve)})})}update(){this.removeAllVisibleElements(),this.renderElements()}removeRelationElementsForWorkPackage(U){const z=mt(U);this.container.find(`.${z}`).remove()}removeAllVisibleElements(){this.container.find(`.${Mt}`).remove()}renderElements(){const U=_.keys(this.workPackagesWithRelations);this.renderWorkPackagesRelations(U)}renderElement(U,z){const re=z.relation.ids,we=this.workPackageTimelineTableController.workPackageCells(re.to),Ze=this.workPackageTimelineTableController.workPackageCells(re.from);0===we.length||0===Ze.length||we.forEach(We=>{const Ve=this.workPackageTimelineTableController.workPackageIndex(We.classIdentifier);Ze.forEach(Ge=>{const rt=this.workPackageTimelineTableController.workPackageIndex(Ge.classIdentifier);this.renderRelation(U,z,Ve,rt,We,Ge)})})}renderRelation(U,z,re,we,Ze,We){const Ve=this.workPackageIdOrder[re],Ge=this.workPackageIdOrder[we];if(!Ve||!Ge||Ve.hidden||Ge.hidden||!Ze.canConnectRelations()||!We.canConnectRelations())return;const rt=Ze.getMarginLeftOfRightSide()-Ze.getPaddingRightForOutgoingRelationLines(),Xe=We.getMarginLeftOfLeftSide()+We.getPaddingLeftForIncomingRelationLines(),at=re<we?"toDown":"toUp",Bt=Xe>rt?"toRight":Xe<rt?"toLeft":"beneath";if(!Ze)return;const oi=Ze.getPaddingRightForOutgoingRelationLines(),wt=We.getPaddingLeftForIncomingRelationLines()+(oi>0?oi:0);this.container.append(yt(0,z.classNames,re,19,rt,wt,1));const ft=rt+wt,ge=Math.abs(we-re);"toDown"===at?"toRight"===Bt||"beneath"===Bt?this.container.append(yt(0,z.classNames,re,19,ft,1,40*ge)):"toLeft"===Bt&&this.container.append(yt(0,z.classNames,re,19,ft,1,40*ge-10)):"toUp"===at&&this.container.append(yt(0,z.classNames,we,30,ft,1,40*ge-10)),"toRight"===Bt?"toDown"===at?this.container.append(yt(0,z.classNames,we,19,ft,Xe-ft,1)):"toUp"===at&&(this.container.append(yt(0,z.classNames,we,20,ft,1,10)),this.container.append(yt(0,z.classNames,we,20,ft,Xe-ft,1))):"toLeft"===Bt&&("toDown"===at?(this.container.append(yt(0,z.classNames,we,0,ft,1,8)),this.container.append(yt(0,z.classNames,we,8,Xe,ft-Xe,1)),this.container.append(yt(0,z.classNames,we,8,Xe,1,11))):"toUp"===at&&(this.container.append(yt(0,z.classNames,we,30,Xe+1,ft-Xe,1)),this.container.append(yt(0,z.classNames,we,19,Xe+1,1,11))))}}jt.\u0275fac=function(U){return new(U||jt)(N.Y36(N.zs3),N.Y36(N.SBq),N.Y36(p.G),N.Y36(Ue),N.Y36(O.W),N.Y36(He.V))},jt.\u0275cmp=N.Xpm({type:jt,selectors:[["wp-timeline-relations"]],features:[N.qOj],decls:1,vars:0,consts:[[1,"wp-table-timeline--relations"]],template:function(U,z){1&U&&N._UZ(0,"div",0)},encapsulation:2}),(0,c.gn)([(0,C.W)(),(0,c.w6)("design:type",ne.q)],jt.prototype,"querySpace",void 0);const Jt="wp-timeline--static-element";class It extends class{constructor(){}render(U){const z=document.createElement("div");return z.id=this.identifier,z.classList.add(...this.classNames),this.finishElement(z,U)}get classNames(){return[Jt]}}{finishElement(U,z){const re=z.now.diff(z.dateDisplayStart,"days"),we=l().hour()/24;return U.style.left=(0,E.jr)(z,re+we),U}get identifier(){return"wp-timeline-static-element-today-line"}}class gt{constructor(U,z,re){this.states=z,this.workPackageTimelineTableController=re,this.$element=U.nativeElement,this.elements=[new It]}ngOnInit(){this.container=this.$element.querySelector(".wp-table-timeline--static-elements"),this.workPackageTimelineTableController.onRefreshRequested("static elements",U=>this.update(U))}update(U){this.removeAllVisibleElements(),this.renderElements(U)}removeAllVisibleElements(){this.container.querySelectorAll(`.${Jt}`).forEach(U=>U.remove())}renderElements(U){for(const z of this.elements)this.container.appendChild(z.render(U))}}gt.\u0275fac=function(U){return new(U||gt)(N.Y36(N.SBq),N.Y36(p.G),N.Y36(Ue))},gt.\u0275cmp=N.Xpm({type:gt,selectors:[["wp-timeline-static-elements"]],decls:1,vars:0,consts:[[1,"wp-table-timeline--static-elements"]],template:function(U,z){1&U&&N._UZ(0,"div",0)},encapsulation:2});class kt{constructor(U,z,re){this.elementRef=U,this.wpTimeline=z,this.weekdaysService=re}ngAfterViewInit(){const U=jQuery(this.elementRef.nativeElement);this.gridContainer=U.find(".wp-table-timeline--grid"),this.wpTimeline.onRefreshRequested("grid",z=>this.refreshView(z))}refreshView(U){this.renderLabels(U)}renderLabels(U){switch(this.gridContainer.empty(),U.settings.zoomLevel){case"days":this.renderLabelsDays(U);break;case"weeks":this.renderLabelsWeeks(U);break;case"months":this.renderLabelsMonths(U);break;case"quarters":this.renderLabelsQuarters(U);break;case"years":this.renderLabelsYears(U);break;default:return}this.activeZoomLevel=U.settings.zoomLevel}renderLabelsDays(U){this.renderTimeSlices(U,"day",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.style.paddingTop="1px",this.checkForNonWorkingDayHighlight(z,re)}),this.renderTimeSlices(U,"year",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--grid-element_highlight"),re.style.zIndex="2"})}renderLabelsWeeks(U){this.renderTimeSlices(U,"day",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{this.checkForNonWorkingDayHighlight(z,re)}),this.renderTimeSlices(U,"week",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--grid-element_highlight")}),this.renderTimeSlices(U,"year",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--grid-element_highlight"),re.style.zIndex="2"})}renderLabelsMonths(U){this.renderTimeSlices(U,"week",U.dateDisplayStart,U.dateDisplayEnd,()=>{}),this.renderTimeSlices(U,"month",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--grid-element_highlight")}),this.renderTimeSlices(U,"year",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--grid-element_highlight"),re.style.zIndex="2"})}renderLabelsQuarters(U){this.renderTimeSlices(U,"month",U.dateDisplayStart,U.dateDisplayEnd,()=>{}),this.renderTimeSlices(U,"quarter",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--grid-element_highlight")}),this.renderTimeSlices(U,"year",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--grid-element_highlight"),re.style.zIndex="2"})}renderLabelsYears(U){this.renderTimeSlices(U,"month",U.dateDisplayStart,U.dateDisplayEnd,()=>{}),this.renderTimeSlices(U,"year",U.dateDisplayStart,U.dateDisplayEnd,(z,re)=>{re.classList.add("wp-timeline--grid-element_highlight")})}renderTimeSlices(U,z,re,we,Ze){const{inViewportAndBoundaries:We,rest:Ve}=(0,E.kv)(U,z,re,we);for(const[Ge,rt]of We){const Xe=document.createElement("div");Xe.classList.add(E.mN,E.oo),Xe.style.left=(0,E.jr)(U,Ge.diff(re,"days")),Xe.style.width=(0,E.jr)(U,rt.diff(Ge,"days")+1),this.gridContainer[0].appendChild(Xe),Ze(Ge,Xe)}setTimeout(()=>{for(const[Ge,rt]of Ve){const Xe=document.createElement("div");Xe.classList.add(E.mN,E.oo),Xe.style.left=(0,E.jr)(U,Ge.diff(re,"days")),Xe.style.width=(0,E.jr)(U,rt.diff(Ge,"days")+1),this.gridContainer[0].appendChild(Xe),Ze(Ge,Xe)}},0)}checkForNonWorkingDayHighlight(U,z){const re=U.toDate();this.weekdaysService.isNonWorkingDay(re)&&(z.classList.add("wp-timeline--non-working-day"),z.dataset.qaSelector=`wp-timeline--non-working-day_${re.getDate()}-${re.getMonth()+1}-${re.getFullYear()}`)}}kt.\u0275fac=function(U){return new(U||kt)(N.Y36(N.SBq),N.Y36(Ue),N.Y36(b.u))},kt.\u0275cmp=N.Xpm({type:kt,selectors:[["wp-timeline-grid"]],decls:1,vars:0,consts:[[1,"wp-table-timeline--grid"]],template:function(U,z){1&U&&N._UZ(0,"div",0)},encapsulation:2});var ti=t(31283),ii=t(18236),vt=(t(84481),t(51017)),Ht=t(3742),Wt=t(2775);class it{constructor(U,z){this.I18n=U,this.panelCtrl=z}ngOnInit(){this.text={remove:this.I18n.t("js.label_remove_watcher",{name:this.watcher.name})}}remove(){this.panelCtrl.removeWatcher(this.watcher)}}it.\u0275fac=function(U){return new(U||it)(N.Y36(r.D),N.Y36(ii.h))},it.\u0275cmp=N.Xpm({type:it,selectors:[["op-wp-watcher-entry"]],inputs:{watcher:"watcher"},decls:5,vars:3,consts:[["opFocusWithin","button",1,"op-wp-watcher","form--selected-value--container"],[1,"op-wp-watcher--form","form--selected-value"],["size","mini","data-qa-selector","op-wp-watcher-name",3,"principal","link"],["type","button",1,"spot-link","form--selected-value--remover",3,"title","click"],["icon-classes","icon-remove"]],template:function(U,z){1&U&&(N.TgZ(0,"div",0),N.TgZ(1,"span",1),N._UZ(2,"op-principal",2),N.qZA(),N.TgZ(3,"button",3),N.NdJ("click",function(){return z.remove()}),N._UZ(4,"op-icon",4),N.qZA(),N.qZA()),2&U&&(N.xp6(2),N.Q6J("principal",z.watcher)("link",!0),N.xp6(1),N.Q6J("title",z.text.remove))},directives:[vt.N,Ht.N,Wt.o],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-watcher--form[_ngcontent-%COMP%]{display:inline-block;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}"],changeDetection:0});var de=t(97779),ae=t(82271),pe=t(72184);class H{constructor(U,z,re,we,Ze,We,Ve,Ge){this.injector=U,this.elementRef=z,this.querySpace=re,this.states=we,this.schemaCache=Ze,this.wpTableColumns=We,this.wpTableSums=Ve,this.I18n=Ge,this.isHidden=!0,this.text={sum:Ge.t("js.label_total_sum")}}ngAfterViewInit(){this.element=this.elementRef.nativeElement,(0,J.aj)([this.wpTableColumns.live$(),this.wpTableSums.live$(),this.querySpace.results.values$()]).pipe((0,a.R)(this.querySpace.stopAllSubscriptions)).subscribe(([U,z,re])=>{this.isHidden=!z,z&&re.sumsSchema?this.schemaCache.ensureLoaded(re.sumsSchema.href).then(we=>{this.refresh(U,re,we)}):this.clear()})}clear(){this.element.innerHTML=""}refresh(U,z,re){this.clear(),this.render(U,z,re)}render(U,z,re){this.groupSumsBuilder=new pe.L(this.injector,this.workPackageTable),this.groupSumsBuilder.text=this.text,this.groupSumsBuilder.renderColumns(z.totalSums,this.element)}}H.\u0275fac=function(U){return new(U||H)(N.Y36(N.zs3),N.Y36(N.SBq),N.Y36(ne.q),N.Y36(p.G),N.Y36(y.y),N.Y36(Pe.i),N.Y36(ae.X),N.Y36(r.D))},H.\u0275dir=N.lG2({type:H,selectors:[["","wpTableSumsRow",""]],hostVars:2,hostBindings:function(U,z){2&U&&N.ekj("-hidden",z.isHidden)},inputs:{workPackageTable:["wpTableSumsRow-table","workPackageTable"]}});var he=t(5275),ue=t(74961),Le=t(97354),ht=t(84939),pt=t(54892),Zt=t(74012),Ct=t(70233),_i=(t(24897),t(55977)),ri=t(23893),ut=t(8403),ze=t(97248),ke=t(32869),Re=(t(17577),t(10190)),$e=t(54364),ot=t(166);function dt(Fe,U){if(1&Fe&&(N.TgZ(0,"div",4),N.TgZ(1,"div",5),N._UZ(2,"h3",6),N.qZA(),N.qZA()),2&Fe){const z=N.oxw(2);N.xp6(2),N.Q6J("textContent",z.group.name)}}const _t=function(Fe){return{actionsColumnEnabled:!0,hierarchyToggleEnabled:!1,inlineCreateEnabled:!0,compactTableStyle:!0,columnMenuEnabled:!1,contextMenuEnabled:!1,projectIdentifier:Fe,projectContext:!1}};function Ut(Fe,U){if(1&Fe){const z=N.EpF();N.ynx(0),N.YNc(1,dt,3,1,"div",1),N.TgZ(2,"wp-embedded-table",2,3),N.NdJ("onQueryLoaded",function(we){return N.CHM(z),N.oxw().handleQueryLoaded(we)}),N.qZA(),N.BQk()}if(2&Fe){const z=N.oxw();N.xp6(1),N.Q6J("ngIf",z.group),N.xp6(1),N.Q6J("initialLoadingIndicator",!1)("queryProps",z.queryProps)("tableActions",z.tableActions)("configuration",N.VKq(5,_t,z.idFromLink(z.workPackage.project.href)))}}class Lt extends ze.y{constructor(U,z,re,we,Ze,We,Ve){super(Ze),this.PathHelper=U,this.wpInlineCreate=z,this.wpRelations=re,this.halEvents=we,this.queryUrlParamsHelper=Ze,this.notificationService=We,this.I18n=Ve,this.tableActions=[ri.g.factoryFor("remove-relation-action",this.I18n.t("js.relation_buttons.remove"),Ge=>{!this.embeddedTable||(this.embeddedTable.loadingIndicator=this.wpRelations.require(Ge.id).then(()=>this.wpInlineCreate.remove(this.workPackage,Ge)).then(()=>this.refreshTable()).catch(rt=>this.notificationService.handleRawError(rt,this.workPackage)))},Ge=>!!Ge.changeParent)],this.idFromLink=Re.Z}ngOnInit(){const U=this.getRelationTypeFromQuery();this.wpInlineCreate.referenceTarget=this.workPackage,this.wpInlineCreate.relationType=U,this.queryProps=this.buildQueryProps(),this.wpInlineCreate.newInlineWorkPackageCreated.pipe(this.untilDestroyed()).subscribe(z=>this.addRelation(z)),this.wpRelations.observe(this.workPackage.id).pipe((0,m.h)(z=>!_.isEmpty(z)),this.untilDestroyed()).subscribe(()=>this.refreshTable())}addRelation(U){this.wpInlineCreate.add(this.workPackage,U).then(()=>{this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:U,relationType:this.getRelationTypeFromQuery()})}).catch(z=>this.notificationService.handleRawError(z,this.workPackage))}getRelationTypeFromQuery(){return this.group.relationType}}Lt.\u0275fac=function(U){return new(U||Lt)(N.Y36(Ct.j),N.Y36(ut.m),N.Y36(He.V),N.Y36(le.J),N.Y36(_i.Z),N.Y36(oe.q),N.Y36(r.D))},Lt.\u0275cmp=N.Xpm({type:Lt,selectors:[["wp-relation-query"]],inputs:{workPackage:"workPackage",query:"query",group:"group"},features:[N._Bn([{provide:ut.m,useClass:ke.x}]),N.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","attributes-group--header",4,"ngIf"],[3,"initialLoadingIndicator","queryProps","tableActions","configuration","onQueryLoaded"],["embeddedTable",""],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"]],template:function(U,z){1&U&&N.YNc(0,Ut,4,7,"ng-container",0),2&U&&N.Q6J("ngIf",!z.hidden)},directives:[$e.O5,ot.Z],encapsulation:2});var Xt=t(19866),zt=t(91488),li=t(70795);class mi{constructor(U,z,re,we){this.I18n=U,this.injector=z,this.opModalService=re,this.opContextMenu=we}ngOnInit(){this.text={configureTable:I18n.t("js.toolbar.settings.configure_view")}}openTableConfigurationModal(){this.opContextMenu.close(),this.opModalService.show(ct.Q,this.injector)}}mi.\u0275fac=function(U){return new(U||mi)(N.Y36(r.D),N.Y36(N.zs3),N.Y36(ye.S),N.Y36(_e.$))},mi.\u0275cmp=N.Xpm({type:mi,selectors:[["wp-table-config-menu"]],decls:2,vars:1,consts:[["type","button",1,"spot-link","wp-table--columns-selection",3,"title","click"],["icon-classes","icon-button icon-small icon-no-color icon-settings"]],template:function(U,z){1&U&&(N.TgZ(0,"button",0),N.NdJ("click",function(){return z.openTableConfigurationModal()}),N._UZ(1,"op-icon",1),N.qZA()),2&U&&N.Q6J("title",z.text.configureTable)},directives:[Wt.o],encapsulation:2});var Ci=t(71718),Zi=t(55749),Kt=t(37409),ei=t(74990),ai=t(84906),Ri=t(32853),bi=t(5282),Oi=t(53875);class St{}St.\u0275fac=function(U){return new(U||St)},St.\u0275mod=N.oAB({type:St}),St.\u0275inj=N.cJS({imports:[[$e.ez,ai.UIRouterModule,Ri.wA,bi.l,Oi.Q]]});var Mi=t(45755),kn=t(87947),wi=(t(77180),t(61342)),Pn=t(82516),xn=t(80639),Fi=t(35403),En=t(83845),Wi=t(54262);function gi(Fe,U){1&Fe&&(N.TgZ(0,"span",10),N._uU(1," *"),N.qZA())}function Ti(Fe,U){if(1&Fe&&(N.TgZ(0,"div",6),N.TgZ(1,"wp-replacement-label",7),N._uU(2),N.YNc(3,gi,2,0,"span",8),N.qZA(),N._UZ(4,"attribute-help-text",9),N.qZA()),2&Fe){const z=N.oxw(2).$implicit;N.xp6(1),N.Q6J("fieldName",z.name),N.xp6(1),N.hij(" ",z.label," "),N.xp6(1),N.Q6J("ngIf",z.field.required&&z.field.writable),N.xp6(1),N.Q6J("attribute",z.name)("attributeScope","WorkPackage")}}const Ui=function(Fe){return{"wp-edit-formattable-field":Fe}};function ki(Fe,U){if(1&Fe&&(N.TgZ(0,"div",11),N._UZ(1,"op-editable-attribute-field",12),N.qZA()),2&Fe){const z=N.oxw(2).$implicit,re=N.oxw();N.xp6(1),N.Q6J("ngClass",N.VKq(4,Ui,z.field.isFormattable))("resource",re.workPackage)("isDropTarget",z.field.isFormattable)("fieldName",re.fieldName(z.name))}}function yi(Fe,U){if(1&Fe&&(N.YNc(0,Ti,5,5,"div",4),N.YNc(1,ki,2,6,"div",5)),2&Fe){const z=N.oxw().$implicit;N.Q6J("ngIf",!z.multiple&&z.field),N.xp6(1),N.Q6J("ngIf",!z.multiple&&z.field)}}const Pi=function(Fe){return{"-span-all-columns":Fe}};function Dt(Fe,U){if(1&Fe&&(N.TgZ(0,"div",2),N.YNc(1,yi,2,2,"ng-template",3),N.qZA()),2&Fe){const z=U.$implicit,re=N.oxw();N.Q6J("ngClass",N.VKq(2,Pi,z.spanAll)),N.xp6(1),N.Q6J("ngIf",!re.shouldHideField(z))}}class fi extends W.N{constructor(U,z,re){super(),this.I18n=U,this.wpEditForm=z,this.injector=re}ngAfterViewInit(){setTimeout(()=>this.fixColumns()),(0,Pn.R)(window,"resize",{passive:!0}).pipe(this.untilDestroyed(),(0,xn.b)(250)).subscribe(()=>{this.fixColumns()})}trackByName(U,z){return z.name}shouldHideField(U){const z=U.field||U.fields[0];return this.wpEditForm.editMode&&!z.writable}fieldName(U){return"startDate"===U?"combinedDate":U}fixColumns(){let U=0;jQuery(`div.attributes-group:contains(${this.group.name})`).find(".attributes-key-value").each(function(){const re=jQuery(this).position().top;re<U&&jQuery(this).addClass("-column-start"),U=re})}}fi.\u0275fac=function(U){return new(U||fi)(N.Y36(r.D),N.Y36(wi.n),N.Y36(N.zs3))},fi.\u0275cmp=N.Xpm({type:fi,selectors:[["wp-attribute-group"]],inputs:{workPackage:"workPackage",group:"group"},features:[N.qOj],decls:2,vars:2,consts:[[1,"-columns-2"],["class","attributes-key-value",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"attributes-key-value",3,"ngClass"],[3,"ngIf"],["class","attributes-key-value--key",4,"ngIf"],["class","attributes-key-value--value-container",4,"ngIf"],[1,"attributes-key-value--key"],[3,"fieldName"],["class","required",4,"ngIf"],[3,"attribute","attributeScope"],[1,"required"],[1,"attributes-key-value--value-container"],[3,"ngClass","resource","isDropTarget","fieldName"]],template:function(U,z){1&U&&(N.TgZ(0,"div",0),N.YNc(1,Dt,2,4,"div",1),N.qZA()),2&U&&(N.xp6(1),N.Q6J("ngForOf",z.group.members)("ngForTrackBy",z.trackByName))},directives:[$e.sg,$e.mk,$e.O5,Fi.L,En.y,Wi.k],encapsulation:2});var Gi=t(94232);class On extends Gi.W{setValue(U,z){super.setValue(U,z),"workPackage"===U&&this.updateForm()}buildPayloadFromChanges(){const U=super.buildPayloadFromChanges();return delete U._links.project,U}}var Ii=t(14274),qi=t(74603),Mn=t(76869),Xi=t(84699),ln=t(25502),dn=t(45921);class xi{}xi.\u0275fac=function(U){return new(U||xi)},xi.\u0275mod=N.oAB({type:xi}),xi.\u0275inj=N.cJS({providers:[ln.N],imports:[[$e.ez,Oi.Q,dn.s]]});var In=t(92144),Si=t(4018),Ei=t(81979),Sn=t(41195);function pn(Fe,U){if(1&Fe){const z=N.EpF();N.TgZ(0,"span",9),N.NdJ("click",function(we){return N.CHM(z),N.oxw(2).toggleHierarchy(we)}),N._UZ(1,"op-icon",10),N.qZA()}if(2&Fe){const z=N.oxw(2);N.uIk("title",z.text.toggleHierarchy),N.xp6(1),N.MGl("icon-classes","icon ",z.hierarchyIcon,"")}}const di=function(Fe,U){return[Fe,U]};function Gt(Fe,U){if(1&Fe&&(N.TgZ(0,"a",11),N._uU(1),N.qZA()),2&Fe){const z=N.oxw(2);N.s9C("lang",z.locale),N.s9C("id",z.headerColumn.id),N.Q6J("ngClass",N.WLB(4,di,z.directionClass&&"sort",z.directionClass)),N.xp6(1),N.Oqu(z.headerColumn.name)}}function Yi(Fe,U){if(1&Fe&&(N.TgZ(0,"a"),N._uU(1),N.qZA()),2&Fe){const z=N.oxw(2);N.xp6(1),N.Oqu(z.headerColumn.name)}}function Li(Fe,U){if(1&Fe&&N._UZ(0,"op-icon",12),2&Fe){const z=N.oxw(2);N.s9C("icon-title",z.text.openMenu)}}function Bi(Fe,U){if(1&Fe&&(N.TgZ(0,"span",4),N.YNc(1,pn,2,2,"span",5),N.YNc(2,Gt,2,7,"a",6),N.YNc(3,Yi,2,1,"a",7),N.YNc(4,Li,1,1,"op-icon",8),N.qZA()),2&Fe){const z=N.oxw();N.xp6(1),N.Q6J("ngIf",z.displayHierarchyIcon),N.xp6(1),N.Q6J("ngIf",z.sortable),N.xp6(1),N.Q6J("ngIf",!z.sortable),N.xp6(1),N.Q6J("ngIf",z.displayDropdownIcon)}}function Dn(Fe,U){if(1&Fe&&N._UZ(0,"op-icon",12),2&Fe){const z=N.oxw(2);N.s9C("icon-title",z.text.openMenu)}}function An(Fe,U){if(1&Fe&&(N.TgZ(0,"span",4),N.TgZ(1,"a"),N._UZ(2,"op-icon",13),N._uU(3),N.qZA(),N.YNc(4,Dn,1,1,"op-icon",8),N.qZA()),2&Fe){const z=N.oxw();N.xp6(1),N.uIk("title",z.headerColumn.name),N.xp6(2),N.hij(" ",z.columnName," "),N.xp6(1),N.Q6J("ngIf",z.displayDropdownIcon)}}function un(Fe,U){if(1&Fe&&N._UZ(0,"span",14),2&Fe){const z=N.oxw();N.uIk("title",z.text.sortColumn)}}function jn(Fe,U){if(1&Fe&&(N.TgZ(0,"a",11),N._uU(1),N.qZA()),2&Fe){const z=N.oxw(2);N.s9C("lang",z.locale),N.s9C("id",z.headerColumn.id),N.Q6J("ngClass",N.WLB(4,di,z.directionClass&&"sort",z.directionClass)),N.xp6(1),N.Oqu(z.headerColumn.name)}}function hn(Fe,U){if(1&Fe&&(N.TgZ(0,"a"),N._uU(1),N.qZA()),2&Fe){const z=N.oxw(2);N.xp6(1),N.Oqu(z.headerColumn.name)}}function _n(Fe,U){if(1&Fe&&N._UZ(0,"op-icon",12),2&Fe){const z=N.oxw(2);N.s9C("icon-title",z.text.openMenu)}}function mn(Fe,U){if(1&Fe&&(N.TgZ(0,"span",4),N.YNc(1,jn,2,7,"a",6),N.YNc(2,hn,2,1,"a",7),N.YNc(3,_n,1,1,"op-icon",8),N.qZA()),2&Fe){const z=N.oxw();N.xp6(1),N.Q6J("ngIf",z.sortable),N.xp6(1),N.Q6J("ngIf",!z.sortable),N.xp6(1),N.Q6J("ngIf",z.displayDropdownIcon)}}class Di extends W.N{constructor(U,z,re,we,Ze,We,Ve){super(),this.wpTableHierarchies=U,this.wpTableSortBy=z,this.wpTableGroupBy=re,this.wpTableRelationColumns=we,this.elementRef=Ze,this.cdRef=We,this.I18n=Ve,this.text={toggleHierarchy:this.I18n.t("js.work_packages.hierarchy.show"),openMenu:this.I18n.t("js.label_open_menu"),sortColumn:"Sorting column"}}ngAfterViewInit(){setTimeout(()=>this.initialize())}initialize(){this.element=jQuery(this.elementRef.nativeElement),(0,J.aj)([this.wpTableSortBy.onReadyWithAvailable(),this.wpTableSortBy.live$()]).pipe(this.untilDestroyed()).subscribe(()=>{const U=this.wpTableSortBy.current[0];U&&this.headerColumn.href===U.column.href?this.currentSortDirection=U.direction:this.currentSortDirection=null,this.setActiveColumnClass(),this.sortable=this.wpTableSortBy.isSortable(this.headerColumn),this.directionClass=this.getDirectionClass(),this.cdRef.detectChanges()}),this.isHierarchyColumn="subject"===this.headerColumn.id,"sortHandle"===this.headerColumn.id&&(this.columnType="sort"),this.isHierarchyColumn?this.columnType="hierarchy":"toType"===this.wpTableRelationColumns.relationColumnType(this.headerColumn)?(this.columnType="relation",this.columnName=this.headerColumn.type.name):"ofType"===this.wpTableRelationColumns.relationColumnType(this.headerColumn)&&(this.columnType="relation",this.columnName=I18n.t(`js.relation_labels.${this.headerColumn.relationType}`)),this.isHierarchyColumn&&(this.hierarchyIcon="icon-hierarchy",this.isHierarchyDisabled=this.wpTableGroupBy.isEnabled,this.wpTableGroupBy.live$().pipe(this.untilDestroyed()).subscribe(()=>{this.isHierarchyDisabled=this.wpTableGroupBy.isEnabled,this.cdRef.detectChanges()}),this.wpTableHierarchies.live$().pipe(this.untilDestroyed()).subscribe(()=>{this.setHierarchyIcon(),this.cdRef.detectChanges()}),this.setHierarchyIcon()),this.cdRef.detectChanges()}get displayDropdownIcon(){return this.table&&this.table.configuration.columnMenuEnabled}get displayHierarchyIcon(){return this.table&&this.table.configuration.hierarchyToggleEnabled}toggleHierarchy(U){return this.wpTableHierarchies.toggleState()&&this.wpTableGroupBy.disable(),this.setHierarchyIcon(),U.stopPropagation(),!1}setHierarchyIcon(){this.wpTableHierarchies.isEnabled?(this.text.toggleHierarchy=I18n.t("js.work_packages.hierarchy.hide"),this.hierarchyIcon="icon-hierarchy"):(this.text.toggleHierarchy=I18n.t("js.work_packages.hierarchy.show"),this.hierarchyIcon="icon-no-hierarchy")}getDirectionClass(){if(!this.currentSortDirection)return"";switch(this.currentSortDirection.href){case lt.S9:return"asc";case lt.iV:return"desc";default:return""}}setActiveColumnClass(){this.element.toggleClass("active-column",!!this.currentSortDirection)}}Di.\u0275fac=function(U){return new(U||Di)(N.Y36(st.Y),N.Y36(Qe.q),N.Y36(Ee.w),N.Y36(Sn.a),N.Y36(N.SBq),N.Y36(N.sBO),N.Y36(r.D))},Di.\u0275cmp=N.Xpm({type:Di,selectors:[["sortHeader"]],inputs:{headerColumn:"headerColumn",locale:"locale",table:"table"},features:[N.qOj],decls:5,vars:4,consts:[[1,"generic-table--sort-header-outer",3,"ngSwitch"],["class","generic-table--sort-header",4,"ngSwitchCase"],["class","draggable-table--sort-header",4,"ngSwitchCase"],["class","generic-table--sort-header",4,"ngSwitchDefault"],[1,"generic-table--sort-header"],["class","hierarchy-header--icon","tabindex","-1","aria-hidden","true",3,"click",4,"ngIf"],["href","#","lang-attribute","",3,"ngClass","lang","id",4,"ngIf"],[4,"ngIf"],["icon-classes","dropdown-indicator icon-small icon-pulldown",3,"icon-title",4,"ngIf"],["tabindex","-1","aria-hidden","true",1,"hierarchy-header--icon",3,"click"],[3,"icon-classes"],["href","#","lang-attribute","",3,"ngClass","lang","id"],["icon-classes","dropdown-indicator icon-small icon-pulldown",3,"icon-title"],["icon-classes","icon-context icon-relations relations-header--icon"],[1,"draggable-table--sort-header"]],template:function(U,z){1&U&&(N.TgZ(0,"div",0),N.YNc(1,Bi,5,4,"span",1),N.YNc(2,An,5,3,"span",1),N.YNc(3,un,1,1,"span",2),N.YNc(4,mn,4,3,"span",3),N.qZA()),2&U&&(N.Q6J("ngSwitch",z.columnType),N.xp6(1),N.Q6J("ngSwitchCase","hierarchy"),N.xp6(1),N.Q6J("ngSwitchCase","relation"),N.xp6(1),N.Q6J("ngSwitchCase","sort"))},directives:[$e.RF,$e.n9,$e.ED,$e.O5,Wt.o,$e.mk],encapsulation:2});var $i=t(1707),en=t(90127),Zn=t(55216);class qt{constructor(U){qt.bootstrapAttributeGroups(U)}static bootstrapAttributeGroups(U){if(this.bootstrapAttributeGroupsCalled)return;this.bootstrapAttributeGroupsCalled=!0;const z=U.get(h.$);z.register("attributeGroupComponent",(re,we)=>"WorkPackageFormAttributeGroup"===re.type?fi:(0,Xi.Z)(we)||"WorkPackageFormChildrenQueryGroup"!==re.type?(0,Xi.Z)(we)||"WorkPackageFormRelationQueryGroup"!==re.type?null:Lt:Zt.u),z.register("workPackageAttachmentUploadComponent",()=>Ii.s),z.register("workPackageAttachmentListComponent",()=>qi.c),z.register("halResourceChangesetClass",re=>{switch(re._type){case"WorkPackage":return Zi.G;case"TimeEntry":return On;default:return null}})}}qt.bootstrapAttributeGroupsCalled=!1,qt.\u0275fac=function(U){return new(U||qt)(N.LFG(N.zs3))},qt.\u0275mod=N.oAB({type:qt}),qt.\u0275inj=N.cJS({providers:[oe.q,he.W,ue.Q,y.y,Xt.r,Le.R,He.V,pt.a,He.V,ht.W,Mn.$,le.J,In.s,Si.l],imports:[[i.H,e.E,de.$,ti.Z,li.w,Ci.OpenprojectProjectsModule,d.K,ei.C,St,Mi.i,bi.l,xi]]}),N.B6R(Y.c,[$e.O5,$e.sg,Ei.K,Wt.o,$e.mk,Di,Ae,mi,H,et.I,kn.H,Ue],[]),N.B6R(Ue,[xe,gt,kt,jt],[]),N.B6R(ii.h,[$e.O5,$e.mk,$e.sg,it,$i._Y,$i.JL,$i.F,en.U],[]),N.B6R(zt.x,[$e.mk,$e.O5,Ri.B5,Ri.oc,$e.sg,Kt.P,Zn.S],[])},57973:(X,I,t)=>{"use strict";t.d(I,{r:()=>F});var i=t(3786),e=t(57810),d=t(34520),h=t(53466),r=t(67727),n=t(62964),l=t(91654),a=t(29161),m=t(96617),v=t(77355),c=t(83635),p=t(77434),f=t(48934),C=t(47775),u=t(2316),k=t(54364),O=t(77616),y=t(84906),b=t(81628),P=t(32853);function E(L,D){if(1&L&&u._UZ(0,"op-back-button",11),2&L){const G=u.oxw();u.Q6J("customBackMethod",G.backButtonCallback)}}function T(L,D){if(1&L&&(u.TgZ(0,"li",15),u._UZ(1,"ndc-dynamic",16),u.qZA()),2&L){const G=u.oxw().$implicit,Q=u.oxw(2);u.Q6J("ngClass",G.containerClasses),u.xp6(1),u.Q6J("ndcDynamicComponent",G.component)("ndcDynamicInputs",G.inputs)("ndcDynamicInjector",Q.injector)("ndcDynamicOutputs",G.outputs)}}function M(L,D){if(1&L&&(u.ynx(0),u.YNc(1,T,2,5,"li",14),u.BQk()),2&L){const G=D.$implicit;u.xp6(1),u.Q6J("ngIf",!G.show||G.show())}}function S(L,D){if(1&L&&(u.TgZ(0,"ul",12),u.YNc(1,M,2,1,"ng-container",13),u.qZA()),2&L){const G=u.oxw();u.xp6(1),u.Q6J("ngForOf",G.toolbarButtonComponents)}}function R(L,D){if(1&L&&u._UZ(0,"ndc-dynamic",17),2&L){const G=u.oxw();u.Q6J("ndcDynamicComponent",G.filterContainerDefinition.component)("ndcDynamicInputs",G.filterContainerDefinition.inputs)("ndcDynamicOutputs",G.filterContainerDefinition.outputs)("ndcDynamicInjector",G.injector)}}class F extends d._{constructor(){super(...arguments),this.text={jump_to_pagination:this.I18n.t("js.work_packages.jump_marks.pagination"),text_jump_to_pagination:this.I18n.t("js.work_packages.jump_marks.label_pagination")},this.showToolbar=!1,this.toolbarButtonComponents=[],this.filterAllowed=!0,this.currentPartition="-split",this.filterContainerDefinition={component:p.J},this.inviteModal=c.E}ngOnInit(){super.ngOnInit(),this.showToolbarSaveButton=!!this.$state.params.query_props,this.setPartition(this.$state.current),this.removeTransitionSubscription=this.$transitions.onSuccess({},D=>{const G=D.params("to"),Q=D.to();this.showToolbarSaveButton=!!G.query_props,this.setPartition(Q);const V=this.querySpace.query.value;V&&this.shouldUpdateHtmlTitle()&&this.titleService.setFirstPart(this.queryTitle(V)),this.cdRef.detectChanges()}),this.loadInitialQuery(),this.setupInformationLoadedListener(),this.queryParamListener.observe$.pipe(this.untilDestroyed()).subscribe(()=>{this.currentQuery=void 0,this.refresh(!0,!0)}),this.querySpace.query.values$().pipe(this.untilDestroyed()).subscribe(D=>{this.updateTitle(D),this.currentQuery=D})}setPartition(D){this.currentPartition=D.data&&D.data.partition?D.data.partition:"-split"}setupInformationLoadedListener(){this.querySpace.initialized.values$().pipe((0,h.q)(1)).subscribe(()=>{this.showToolbar=!0,this.cdRef.detectChanges()})}ngOnDestroy(){super.ngOnDestroy(),this.removeTransitionSubscription(),this.queryParamListener.removeQueryChangeListener()}changeChangesFromTitle(D){this.currentQuery&&(0,f.Z)(this.currentQuery)?this.updateTitleName(D):this.wpListService.create(this.currentQuery,D).finally(()=>{this.toolbarDisabled=!1})}updateTitleName(D){this.toolbarDisabled=!0,this.currentQuery.name=D,this.wpListService.save(this.currentQuery).finally(()=>{this.toolbarDisabled=!1})}updateTitle(D){!D||(this.selectedTitle=this.queryTitle(D),this.titleEditingEnabled=this.authorisationService.can("query","updateImmediately"),this.shouldUpdateHtmlTitle()&&this.titleService.setFirstPart(this.selectedTitle))}refresh(D=!1,G=!1){let Q=this.loadQuery(G);return D?(Q=Q.then(V=>(this.wpStatesInitialization.initialize(V,V.results),this.additionalLoadingTime().then(()=>V))),this.loadingIndicator=Q):Q=Q.then(V=>(this.wpStatesInitialization.initialize(V,V.results),V)),Q}openInviteUserModal(){this.opModalService.show(this.inviteModal,"global").closingEvent.subscribe(G=>{console.log("Modal closed!",G)})}loadQuery(D=!1){let G;const Q=this.currentQuery;if(D||!Q)G=this.loadFirstPage();else{const V=this.wpListService.getPaginationInfo();G=this.wpListService.loadQueryFromExisting(Q,V,this.projectIdentifier).toPromise()}return G}loadFirstPage(){return this.currentQuery?this.wpListService.reloadQuery(this.currentQuery,this.projectIdentifier).toPromise():this.wpListService.loadCurrentQueryFromParams(this.projectIdentifier)}additionalLoadingTime(){return Promise.resolve()}set loadingIndicator(D){this.loadingIndicatorService.table.promise=D}shouldUpdateHtmlTitle(){return!0}staticQueryName(D){return this.opStaticQueries.getStaticName(D)}loadInitialQuery(){const D=!this.querySpace.initialized.hasValue();this.loadingIndicator=this.loadQuery(D)}queryTitle(D){return(0,f.Z)(D)?D.name:this.staticQueryName(D)}}F.\u0275fac=function(){let L;return function(G){return(L||(L=u.n5z(F)))(G||F)}}(),F.\u0275cmp=u.Xpm({type:F,selectors:[["ng-component"]],features:[u._Bn([{provide:r.W,useClass:n.q},l.E]),u.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(D,G){1&D&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.TgZ(2,"div",2),u.YNc(3,E,1,1,"op-back-button",3),u.TgZ(4,"editable-toolbar-title",4),u.NdJ("onSave",function(V){return G.changeChangesFromTitle(V)})("onEmptySubmit",function(){return G.updateTitleName("")}),u.qZA(),u.YNc(5,S,2,1,"ul",5),u.qZA(),u.qZA(),u.TgZ(6,"div",6),u.YNc(7,R,1,4,"ndc-dynamic",7),u.qZA(),u.TgZ(8,"div",8),u._UZ(9,"div",9),u._UZ(10,"div",10),u.qZA(),u.qZA()),2&D&&(u.Q6J("ngClass",G.currentPartition),u.xp6(3),u.Q6J("ngIf",G.backButtonCallback),u.xp6(1),u.Q6J("title",G.selectedTitle)("inFlight",G.toolbarDisabled)("showSaveCondition",G.showToolbarSaveButton)("editable",G.titleEditingEnabled),u.xp6(1),u.Q6J("ngIf",G.showToolbar),u.xp6(2),u.Q6J("ngIf",G.filterContainerDefinition))},directives:[k.mk,k.O5,O.s5,y.UIView,b.W,k.sg,P.B5,P.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}"],changeDetection:0}),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",m.D)],F.prototype,"I18n",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",e.V)],F.prototype,"titleService",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",l.E)],F.prototype,"queryParamListener",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",v.S)],F.prototype,"opModalService",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",C.UIRouterGlobals)],F.prototype,"uiRouterGlobals",void 0)},70482:(X,I,t)=>{"use strict";function i(e,d="details"){return`${e.current.data.baseRoute||""}.${d}`}t.d(I,{W:()=>i})},46430:(X,I,t)=>{"use strict";t.d(I,{Z:()=>O});var i=t(39410),e=t(2316),d=t(54364),h=t(61342),r=t(92092),n=t(77180),l=t(66979),a=t(87947);const m=function(){return["status","type"]};function v(y,b){if(1&y){const P=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"edit-form",2),e.NdJ("onSaved",function(T){return e.CHM(P),e.oxw().onSaved(T)}),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e._UZ(4,"wp-type-status",5),e.TgZ(5,"div",6),e.TgZ(6,"a",7),e.NdJ("click",function(){return e.CHM(P),e.oxw().switchToFullscreen()}),e._UZ(7,"span",8),e.qZA(),e.qZA(),e.qZA(),e._UZ(8,"wp-single-view",9),e.qZA(),e.TgZ(9,"div",10),e.TgZ(10,"wp-edit-actions-bar",11),e.NdJ("onCancel",function(){return e.CHM(P),e.oxw().cancelAndBackToList()}),e.qZA(),e.qZA(),e.TgZ(11,"div",12),e._UZ(12,"wp-resizer",13),e.qZA(),e.qZA(),e.qZA()}if(2&y){const P=e.oxw();e.xp6(1),e.Q6J("resource",P.newWorkPackage)("skippedFields",e.DdM(8,m))("inEditMode",!0),e.xp6(3),e.Q6J("workPackage",P.newWorkPackage),e.xp6(4),e.Q6J("workPackage",P.newWorkPackage)("showProject",P.copying),e.xp6(4),e.Q6J("elementClass","work-packages-partitioned-page--content-right")("localStorageKey","openProject-splitViewFlexBasis")}}class c extends i.I{}c.\u0275fac=function(){let y;return function(P){return(y||(y=e.n5z(c)))(P||c)}}(),c.\u0275cmp=e.Xpm({type:c,selectors:[["wp-new-split-view"]],features:[e.qOj],decls:1,vars:1,consts:[["class","work-packages--details work-packages--new",4,"ngIf"],[1,"work-packages--details","work-packages--new"],[3,"resource","skippedFields","inEditMode","onSaved"],[1,"work-packages--details-content","-create-mode"],[1,"work-packages--new-details-header"],[3,"workPackage"],[1,"wp--details--switch-fullscreen-wrapper"],[1,"work-packages-show-view-button","wp--details--switch-fullscreen",3,"click"],[1,"icon-context","icon-to-fullscreen"],[3,"workPackage","showProject"],[1,"work-packages--details-toolbar-container"],[3,"onCancel"],[1,"work-packages--details--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"]],template:function(b,P){1&b&&e.YNc(0,v,13,9,"div",0),2&b&&e.Q6J("ngIf",P.newWorkPackage)},directives:[d.O5,h.n,r.E,n.G,l.Y,a.H],encapsulation:2,changeDetection:0});var p=t(38421),f=t(98722);const C=function(){return["status","type"]};function u(y,b){if(1&y){const P=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"edit-form",2),e.NdJ("onSaved",function(T){return e.CHM(P),e.oxw().onSaved(T)}),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e._UZ(4,"wp-type-status",5),e.TgZ(5,"div",6),e.TgZ(6,"a",7),e.NdJ("click",function(){return e.CHM(P),e.oxw().switchToFullscreen()}),e._UZ(7,"span",8),e.qZA(),e.qZA(),e.qZA(),e._UZ(8,"wp-single-view",9),e.qZA(),e.TgZ(9,"div",10),e.TgZ(10,"wp-edit-actions-bar",11),e.NdJ("onCancel",function(){return e.CHM(P),e.oxw().cancelAndBackToList()}),e.qZA(),e.qZA(),e.TgZ(11,"div",12),e._UZ(12,"wp-resizer",13),e.qZA(),e.qZA(),e.qZA()}if(2&y){const P=e.oxw();e.xp6(1),e.Q6J("resource",P.newWorkPackage)("skippedFields",e.DdM(8,C))("inEditMode",!0),e.xp6(3),e.Q6J("workPackage",P.newWorkPackage),e.xp6(4),e.Q6J("workPackage",P.newWorkPackage)("showProject",P.copying),e.xp6(4),e.Q6J("elementClass","work-packages-partitioned-page--content-right")("localStorageKey","openProject-splitViewFlexBasis")}}class k extends f.H{}function O(y,b,P,E=c,T,M=!0,S=y){return[{name:`${S}.details`,url:"/details/{workPackageId:[0-9]+}",redirectTo:L=>{const D=L.params("to");return{state:`${S}.details.tabs`,params:Object.assign(Object.assign({},D),{tabIdentifier:"overview"})}},reloadOnSearch:!1,data:{bodyClasses:"router--work-packages-partitioned-split-view-details",menuItem:b,baseRoute:y,newRoute:`${S}.new`,partition:T?"-left-only":"-split",mobileAlternative:M?"work-packages.show":void 0},views:T?{"content-left@^.^":{component:P}}:{"content-right@^.^":{component:P}}},{name:`${S}.details.tabs`,url:"/:tabIdentifier",component:p.t,data:{baseRoute:y,menuItem:b,parent:`${S}.details`,mobileAlternative:M?"work-packages.show":void 0}},{name:`${S}.new`,url:"/create_new?{type:[0-9]+}&{parent_id:[0-9]+}",reloadOnSearch:!1,params:{defaults:{value:null}},data:{partition:"-split",allowMovingInEditMode:!0,bodyClasses:"router--work-packages-partitioned-split-view-new",baseRoute:y,parent:y,mobileAlternative:M?"work-packages.show":void 0},views:{"content-right@^.^":{component:E}}},{name:`${S}.copy`,url:"/details/{copiedFromWorkPackageId:[0-9]+}/copy",views:{"content-right@^.^":{component:k}},reloadOnSearch:!1,data:{baseRoute:y,parent:y,allowMovingInEditMode:!0,bodyClasses:"router--work-packages-partitioned-split-view",menuItem:b,partition:"-split",mobileAlternative:M?"work-packages.show":void 0}}]}k.\u0275fac=function(){let y;return function(P){return(y||(y=e.n5z(k)))(P||k)}}(),k.\u0275cmp=e.Xpm({type:k,selectors:[["wp-copy-split-view"]],features:[e.qOj],decls:1,vars:1,consts:[["class","work-packages--details work-packages--new",4,"ngIf"],[1,"work-packages--details","work-packages--new"],[3,"resource","skippedFields","inEditMode","onSaved"],[1,"work-packages--details-content","-create-mode"],[1,"work-packages--new-details-header"],[3,"workPackage"],[1,"wp--details--switch-fullscreen-wrapper"],[1,"work-packages-show-view-button","wp--details--switch-fullscreen",3,"click"],[1,"icon-context","icon-to-fullscreen"],[3,"workPackage","showProject"],[1,"work-packages--details-toolbar-container"],[3,"onCancel"],[1,"work-packages--details--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"]],template:function(b,P){1&b&&e.YNc(0,u,13,9,"div",0),2&b&&e.Q6J("ngIf",P.newWorkPackage)},directives:[d.O5,h.n,r.E,n.G,l.Y,a.H],encapsulation:2,changeDetection:0})},1813:(X,I,t)=>{"use strict";t.d(I,{p:()=>l});var i=t(58034),e=t(2316);class d extends i.a{blockedTransition(m){const v=m.to(),c=m.from(),p=m.params("from"),f=m.params("to");return c.name&&/\.(new|copy)$/.exec(c.name)?!(v.data&&v.data.allowMovingInEditMode):void 0===f.workPackageId||f.workPackageId!==p.workPackageId}}d.\u0275fac=function(){let a;return function(v){return(a||(a=e.n5z(d)))(v||d)}}(),d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac});var h=t(97047),r=t(84906);class l{}l.\u0275fac=function(m){return new(m||l)},l.\u0275cmp=e.Xpm({type:l,selectors:[["work-packages-base"]],features:[e._Bn([{provide:i.a,useClass:d}])],decls:2,vars:0,consts:[["wp-isolated-query-space","",1,"work-packages-page--ui-view"]],template:function(m,v){1&m&&(e.TgZ(0,"div",0),e._UZ(1,"ui-view"),e.qZA())},directives:[h.A,r.UIView],encapsulation:2})},73648:(X,I,t)=>{"use strict";t.d(I,{o:()=>R});var i=t(53466),e=t(64538),d=t(45237),h=t(2888),r=t(67727),n=t(62964),l=t(96617),a=t(43440),m=t(53916),v=t(65146),c=t(74647),p=t(26942),f=t(47775),C=t(84109),u=t(2316),k=t(54364),O=t(18942),y=t(88923),b=t(2770);function P(F,L){1&F&&u._UZ(0,"div",4)}function E(F,L){if(1&F){const D=u.EpF();u.TgZ(0,"wp-table",5),u.NdJ("itemClicked",function(Q){return u.CHM(D),u.oxw().handleWorkPackageClicked(Q)})("stateLinkClicked",function(Q){return u.CHM(D),u.oxw().openStateLink(Q)}),u.qZA()}if(2&F){const D=u.oxw();u.Q6J("projectIdentifier",D.CurrentProject.identifier)("configuration",D.wpTableConfiguration)}}const T=function(F){return{"-with-resizer":F}};function M(F,L){if(1&F){const D=u.EpF();u.TgZ(0,"div",6),u.TgZ(1,"wp-grid",7),u.NdJ("itemClicked",function(Q){return u.CHM(D),u.oxw().handleWorkPackageCardClicked(Q)})("stateLinkClicked",function(Q){return u.CHM(D),u.oxw().openStateLink(Q)}),u.qZA(),u.qZA()}if(2&F){const D=u.oxw();u.Q6J("ngClass",u.VKq(3,T,D.showResizerInCardView())),u.xp6(1),u.Q6J("configuration",D.wpTableConfiguration)("showResizer",D.showResizerInCardView())}}function S(F,L){1&F&&(u.TgZ(0,"div",8),u._UZ(1,"wp-table-pagination"),u.qZA())}class R extends p.N{constructor(L,D,G,Q,V,K,q,se,te,ie,le,oe){super(),this.I18n=L,this.injector=D,this.$state=G,this.keepTab=Q,this.querySpace=V,this.wpViewFilters=K,this.deviceService=q,this.CurrentProject=se,this.wpDisplayRepresentation=te,this.cdRef=ie,this.elementRef=le,this.ngZone=oe,this.text={jump_to_pagination:this.I18n.t("js.work_packages.jump_marks.pagination"),text_jump_to_pagination:this.I18n.t("js.work_packages.jump_marks.label_pagination"),button_settings:this.I18n.t("js.button_settings")},this.showTableView=!0,this.tableInformationLoaded=!1,this.noResults=!1,this.showResultOverlay$=this.wpViewFilters.incomplete$,this.wpTableConfiguration={dragAndDropEnabled:!0}}ngOnInit(){this.setupInformationLoadedListener(),this.querySpace.query.values$().pipe(this.untilDestroyed()).subscribe(L=>{this.updateViewRepresentation(L),this.noResults=0===L.results.total,this.cdRef.detectChanges()}),this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{const L=this.elementRef.nativeElement.querySelector(".wp-table--row.-checked"),D=this.elementRef.nativeElement.querySelector('[data-qa-selector="op-wp-single-card"].-checked');L&&L.previousSibling&&L.previousSibling.scrollIntoView({block:"start"}),D&&D.scrollIntoView({block:"start"})},0)})}setupInformationLoadedListener(){this.querySpace.initialized.values$().pipe((0,i.q)(1)).subscribe(()=>{this.tableInformationLoaded=!0,this.cdRef.detectChanges()})}showResizerInCardView(){return!1}updateViewRepresentation(L){this.showTableView=!(this.deviceService.isMobile||this.wpDisplayRepresentation.valueFromQuery(L)===h.he)}handleWorkPackageClicked(L){L.double&&this.openInFullView(L.workPackageId)}openStateLink(L){const D={workPackageId:L.workPackageId,focus:!0};"split"===L.requestedState?this.keepTab.goCurrentDetailsState(D):this.keepTab.goCurrentShowState(D)}handleWorkPackageCardClicked(L){this.deviceService.isMobile?this.openInFullView(L.workPackageId):this.handleWorkPackageClicked(L)}openInFullView(L){this.$state.go("work-packages.show",{workPackageId:L})}}R.\u0275fac=function(L){return new(L||R)(u.Y36(l.D),u.Y36(u.zs3),u.Y36(f.StateService),u.Y36(C.p),u.Y36(a.q),u.Y36(c.Z),u.Y36(m.U),u.Y36(v.R),u.Y36(h.ld),u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},R.\u0275cmp=u.Xpm({type:R,selectors:[["wp-list-view"]],hostAttrs:[1,"op-wp-list-view","work-packages-split-view--tabletimeline-side"],features:[u._Bn([{provide:r.W,useClass:n.q},d.j,e.h]),u.qOj],decls:5,vars:6,consts:[["class","op-wp-list-view--result-overlay",4,"ngIf"],["class","work-packages-split-view--tabletimeline-content",3,"projectIdentifier","configuration","itemClicked","stateLinkClicked",4,"ngIf"],["class","op-wp-list-view--card-view-container",3,"ngClass",4,"ngIf"],["class","work-packages-split-view--tabletimeline-footer hide-when-print",4,"ngIf"],[1,"op-wp-list-view--result-overlay"],[1,"work-packages-split-view--tabletimeline-content",3,"projectIdentifier","configuration","itemClicked","stateLinkClicked"],[1,"op-wp-list-view--card-view-container",3,"ngClass"],["resizerClass","work-packages-partitioned-page--content-right","resizerStorageKey","openProject-splitViewFlexBasis",3,"configuration","showResizer","itemClicked","stateLinkClicked"],[1,"work-packages-split-view--tabletimeline-footer","hide-when-print"]],template:function(L,D){1&L&&(u.YNc(0,P,1,0,"div",0),u.ALo(1,"async"),u.YNc(2,E,1,2,"wp-table",1),u.YNc(3,M,2,5,"div",2),u.YNc(4,S,2,0,"div",3)),2&L&&(u.Q6J("ngIf",u.lcZ(1,4,D.showResultOverlay$)&&D.showTableView),u.xp6(2),u.Q6J("ngIf",D.tableInformationLoaded&&D.showTableView),u.xp6(1),u.Q6J("ngIf",!D.showTableView),u.xp6(1),u.Q6J("ngIf",D.tableInformationLoaded))},directives:[k.O5,O.c,k.mk,y.b,b.v],pipes:[k.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-list-view--result-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;z-index:900;background-color:#fff;opacity:.5}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]{width:100%;overflow:auto;padding-bottom:5px;scrollbar-color:transparent transparent;scrollbar-width:thin}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}@media screen and (min-width: 679px){.op-wp-list-view--card-view-container.-with-resizer[_ngcontent-%COMP%]{padding-left:10px}}@media screen and (max-width: 679px){.op-wp-list-view--card-view-container[_ngcontent-%COMP%]{min-width:calc(100vw + 10px)}}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]{display:flex;flex:1 1 100%;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}@media screen and (min-width: 679px){.work-packages-split-view--tabletimeline-container.-with-resizer[_ngcontent-%COMP%]{padding-left:10px}}@media screen and (max-width: 679px){.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]{min-width:calc(100vw + 10px)}}"],changeDetection:0})},85603:(X,I,t)=>{"use strict";t.d(I,{o:()=>te});var i=t(47775),e=t(48451),d=t(87853),h=t(84732),r=t(84109),n=t(60914),l=t(1818),a=t(67727),m=t(62964),v=t(57014),c=t(82123),p=t(2316),f=t(54364),C=t(70971),u=t(87947),k=t(84312),O=t(61342),y=t(5262),b=t(46669),P=t(84906),E=t(81628),T=t(12703),M=t(96617),R=(t(24897),t(73905)),F=t(74565),L=t(2775),D=t(31021);function G(ie,le){if(1&ie&&p._UZ(0,"op-work-package-mark-notification-button",6),2&ie){const oe=p.oxw();p.Q6J("workPackage",oe.workPackage)("showWithText",!0)}}class Q{constructor(le,oe){this.I18n=le,this.halEditing=oe,this.text={button_more:this.I18n.t("js.button_more")}}}function V(ie,le){if(1&ie&&p._UZ(0,"op-back-button",17),2&ie){const oe=p.oxw(3);p.Q6J("customBackMethod",oe.backToList.bind(oe))}}function K(ie,le){if(1&ie&&(p.TgZ(0,"div",7),p._UZ(1,"span",8),p.TgZ(2,"edit-form",9),p.TgZ(3,"div",10),p.TgZ(4,"div",11),p._UZ(5,"wp-breadcrumb",12),p.TgZ(6,"div",13),p.YNc(7,V,1,1,"op-back-button",14),p._UZ(8,"wp-subject",15),p.qZA(),p.qZA(),p.qZA(),p._UZ(9,"div",16),p.qZA(),p.qZA()),2&ie){const oe=p.oxw(2);p.xp6(1),p.Q6J("opAutofocus",oe.shouldFocus)("textContent",oe.focusAnchorLabel),p.xp6(1),p.Q6J("resource",oe.workPackage),p.xp6(3),p.Q6J("workPackage",oe.workPackage),p.xp6(2),p.Q6J("ngIf",oe.showBackButton())}}function q(ie,le){if(1&ie&&(p.TgZ(0,"div",18),p._UZ(1,"wp-details-toolbar",19),p.ALo(2,"async"),p.qZA()),2&ie){const oe=p.oxw(2);p.xp6(1),p.Q6J("workPackage",oe.workPackage)("displayNotificationsButton",p.lcZ(2,2,oe.displayNotificationsButton$))}}function se(ie,le){if(1&ie&&(p.TgZ(0,"div",1),p._UZ(1,"op-wp-tabs",2),p.YNc(2,K,10,5,"div",3),p.YNc(3,q,3,4,"div",4),p.TgZ(4,"div",5),p._UZ(5,"wp-resizer",6),p.qZA(),p.qZA()),2&ie){const oe=p.oxw();p.xp6(1),p.Q6J("workPackage",oe.workPackage)("view","split"),p.xp6(1),p.Q6J("ngIf",oe.workPackage),p.xp6(1),p.Q6J("ngIf",oe.workPackage),p.xp6(2),p.Q6J("elementClass","work-packages-partitioned-page--content-right")("localStorageKey","openProject-splitViewFlexBasis")}}Q.\u0275fac=function(le){return new(le||Q)(p.Y36(M.D),p.Y36(T.l))},Q.\u0275cmp=p.Xpm({type:Q,selectors:[["wp-details-toolbar"]],inputs:{workPackage:"workPackage",displayNotificationsButton:"displayNotificationsButton"},decls:6,vars:6,consts:[[1,"work-packages--details-toolbar"],[3,"workPackage","showText"],["data-qa-selector","mark-notification-read-button",3,"workPackage","showWithText",4,"ngIf"],["wpSingleContextMenu","",1,"button","dropdown-relative",3,"wpSingleContextMenu-workPackage"],[1,"button--text",3,"textContent"],["icon-classes","button--dropdown-indicator"],["data-qa-selector","mark-notification-read-button",3,"workPackage","showWithText"]],template:function(le,oe){1&le&&(p.TgZ(0,"div",0),p._UZ(1,"wp-watcher-button",1),p.YNc(2,G,1,2,"op-work-package-mark-notification-button",2),p.TgZ(3,"button",3),p._UZ(4,"span",4),p._UZ(5,"op-icon",5),p.qZA(),p.qZA()),2&le&&(p.xp6(1),p.Q6J("workPackage",oe.workPackage)("showText",!0),p.xp6(1),p.Q6J("ngIf",oe.displayNotificationsButton),p.xp6(1),p.Q6J("wpSingleContextMenu-workPackage",oe.workPackage),p.uIk("accesskey",7),p.xp6(1),p.Q6J("textContent",oe.text.button_more))},directives:[R.u,f.O5,F.B,L.o,D.q],encapsulation:2});class te extends l.e{constructor(le,oe,ne,fe,ve,Se,Oe,je){super(le,Oe.params.workPackageId),this.injector=le,this.states=oe,this.firstRoute=ne,this.keepTab=fe,this.wpTableSelection=ve,this.wpTableFocus=Se,this.$state=Oe,this.backRouting=je,this.baseRoute=this.$state.current.data.baseRoute}ngOnInit(){this.observeWorkPackage();const le=this.$state.params.workPackageId;if(this.wpTableFocus.focusedWorkPackage)this.wpTableFocus.updateFocus(le,!1);else{const ne=this.firstRoute.name===`${this.baseRoute}.details.overview`,fe=this.firstRoute.params&&le===this.firstRoute.params.workPackageI;this.wpTableFocus.updateFocus(le,ne&&fe)}this.wpTableSelection.isEmpty&&this.wpTableSelection.setRowState(le,!0),this.wpTableFocus.whenChanged().pipe(this.untilDestroyed()).subscribe(ne=>{le.toString()!==ne.toString()&&this.$state.includes(`${this.baseRoute}.details`)&&this.$state.go(this.$state.current.name,{workPackageId:ne,focus:!1})})}get shouldFocus(){return!0===this.$state.params.focus}showBackButton(){return this.baseRoute.includes("bim")}backToList(){this.backRouting.goToBaseState()}handleLoadingError(le){const oe=this.notificationService.retrieveErrorMessage(le);this.$state.go(this.baseRoute,{flash_message:{type:"error",message:oe}})}}te.\u0275fac=function(le){return new(le||te)(p.Y36(p.zs3),p.Y36(d.G),p.Y36(h.p),p.Y36(r.p),p.Y36(n.J),p.Y36(e.o),p.Y36(i.StateService),p.Y36(v.Y))},te.\u0275cmp=p.Xpm({type:te,selectors:[["op-wp-split-view"]],features:[p._Bn([c.O,{provide:a.W,useClass:m.q}]),p.qOj],decls:1,vars:1,consts:[["class","work-packages--details loading-indicator--location","data-indicator-name","wpDetails",4,"ngIf"],["data-indicator-name","wpDetails",1,"work-packages--details","loading-indicator--location"],[3,"workPackage","view"],["class","work-packages--details-content work-packages-tab-view--overflow",4,"ngIf"],["class","work-packages--details-toolbar-container",4,"ngIf"],[1,"work-packages--details--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"],[1,"work-packages--details-content","work-packages-tab-view--overflow"],["tabindex","-1",1,"hidden-for-sighted",3,"opAutofocus","textContent"],[1,"work-packages--details-form",3,"resource"],[1,"work-packages--details-header"],[1,"work-packages--details-header-left"],[1,"work-packages--breadcrumb",3,"workPackage"],[1,"wp-show--header-container"],["linkClass","work-packages-back-button",3,"customBackMethod",4,"ngIf"],[1,"subject-header"],["data-notification-selector","notification-scroll-container","ui-view","",1,"work-package-details-tab"],["linkClass","work-packages-back-button",3,"customBackMethod"],[1,"work-packages--details-toolbar-container"],[3,"workPackage","displayNotificationsButton"]],template:function(le,oe){1&le&&p.YNc(0,se,6,6,"div",0),2&le&&p.Q6J("ngIf",oe.workPackage)},directives:[f.O5,C.e,u.H,k.U,O.n,y.f,b.x,P.UIView,E.W,Q],pipes:[f.Ov],encapsulation:2,changeDetection:0})},55236:(X,I,t)=>{"use strict";t.d(I,{m:()=>e,A:()=>d});const e=new(t(2316).OlP)("CardEventHandler");class d{constructor(r){this.injector=r}attachTo(r){this.eventHandlers.map(n=>{const l=n(r);return l.eventScope(r).on(l.EVENT,l.SELECTOR,m=>{l.handleEvent(r,m)}),l})}}},82123:(X,I,t)=>{"use strict";t.d(I,{O:()=>k});var i=t(3786),e=t(19100);let h=class extends e.yh{constructor(){super({notifications:{filters:[]}})}};h=(0,i.gn)([(0,e.yC)({name:"wp-single-view"}),(0,i.w6)("design:paramtypes",[])],h);var r=t(9170),n=t(79902),l=t(33927),a=t(53466),m=t(31909),v=t(78509),c=t(60419),p=t(44838),f=t(96905),C=t(96725),u=t(2316);let k=class{constructor(y,b,P){this.actions$=y,this.currentUser$=b,this.resourceService=P,this.id="WorkPackage Activity Store",this.store=new h,this.query=new e.AE(this.store),this.selectNotifications$=this.query.select(E=>E.notifications.filters).pipe((0,r.h)(E=>E.length>0),(0,n.w)(E=>this.resourceService.collection((0,C.ZU)({filters:E})))),this.selectNotificationsCount$=this.selectNotifications$.pipe((0,l.U)(E=>E.length)),this.hasNotifications$=this.selectNotificationsCount$.pipe((0,l.U)(E=>E>0))}get params(){return{filters:this.query.getValue().notifications.filters}}setFilters(y){const b=[["readIAN","=",!1],["resourceId","=",[y]],["resourceType","=",["WorkPackage"]]];this.store.update(({notifications:P})=>({notifications:Object.assign(Object.assign({},P),{filters:b})})),this.reload()}markAllAsRead(){const y=(0,C.ZU)({filters:this.store.getValue().notifications.filters});this.resourceService.collection(y).pipe((0,a.q)(1)).subscribe(b=>{this.actions$.dispatch((0,v.L5)({origin:this.id,notifications:b.map(P=>P.id)}))})}reload(){this.currentUser$.isLoggedIn$.pipe((0,a.q)(1),(0,r.h)(y=>y),(0,n.w)(()=>this.resourceService.fetchNotifications(this.params))).subscribe()}reloadOnNotificationRead(){this.reload()}reloadOnCenterUpdate(){this.reload()}};k.\u0275fac=function(y){return new(y||k)(u.LFG(c.b),u.LFG(f.S),u.LFG(m.W))},k.\u0275prov=u.Yz7({token:k,factory:k.\u0275fac}),(0,i.gn)([(0,p.B)(v.A6),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],k.prototype,"reloadOnNotificationRead",null),(0,i.gn)([(0,p.B)(v.$v),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],k.prototype,"reloadOnCenterUpdate",null),k=(0,i.gn)([p.b,(0,i.w6)("design:paramtypes",[c.b,f.S,m.W])],k)},81691:(X,I,t)=>{"use strict";t.d(I,{G:()=>v});var i=t(43440),e=t(53457),d=t(62964),h=t(44022),r=t(61908),n=t(91923),l=t(99676),a=t(71562),m=t(2316);class v{constructor(p,f,C,u,k,O,y,b){this.querySpace=p,this.wpTableHierarchies=f,this.wpTableColumns=C,this.notificationService=u,this.halResourceService=k,this.apiV3Service=O,this.schemaCache=y,this.wpRelations=b}initialize(p,f){const C=f.elements;Promise.all([this.requireInvolvedRelations(C.map(u=>u.id)),this.requireHierarchyElements(C),this.requireSumsSchema(f)]).then(u=>{this.loadAdditional(_.flatten(u))})}loadAdditional(p){this.apiV3Service.work_packages.requireAll(p).then(()=>{this.querySpace.additionalRequiredWorkPackages.putValue(null,"All required work packages are loaded")}).catch(f=>{this.querySpace.additionalRequiredWorkPackages.putValue(null,"Failure loading required work packages"),this.notificationService.handleRawError(f)})}requireInvolvedRelations(p){return this.wpTableColumns.hasRelationColumns()?this.wpRelations.requireAll(p).then(()=>{const f=this.getInvolvedWorkPackages(p.map(C=>this.wpRelations.state(C).value));return _.flatten(f)}):Promise.resolve([])}requireHierarchyElements(p){if(!this.wpTableHierarchies.isEnabled)return Promise.resolve([]);const f=_.flatten(p.map(C=>C.ancestorIds));return Promise.resolve(f)}getInvolvedWorkPackages(p){const f=[];return _.each(p,C=>{_.each(C,u=>{f.push(u.ids.from,u.ids.to)})}),f}requireSumsSchema(p){return p.sumsSchema?this.schemaCache.ensureLoaded(p.sumsSchema.href).then(()=>[]):Promise.resolve([])}}v.\u0275fac=function(p){return new(p||v)(m.LFG(i.q),m.LFG(l.Y),m.LFG(a.i),m.LFG(d.q),m.LFG(n.u),m.LFG(r.T),m.LFG(h.y),m.LFG(e.V))},v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac})},54592:(X,I,t)=>{"use strict";t.d(I,{H:()=>a,q:()=>m});var i=t(43440),e=t(14808),d=t(53466),h=t(67202),r=t(33927),n=t(89919),l=t(2316);class a{constructor(c){this.querySpace=c,this.updatesState=(0,e.qH)(),this.pristineState=(0,e.qH)()}initialize(c,p,f){const C=this.valueFromQuery(c,p);this.pristineState.putValue(C)}update(c){this.updatesState.putValue(c)}clear(c){this.pristineState.clear(c),this.updatesState.clear(c)}live$(){return(0,n.T)(this.pristineState.values$(),this.updatesState.values$())}pristine$(){return this.pristineState.values$()}updates$(){return this.updatesState.values$()}changes$(){return this.updatesState.changes$()}onReady(){return this.pristineState.values$().pipe((0,d.q)(1),(0,h.h)(null)).toPromise()}get lastUpdatedState(){const c=(0,e.$e)(this.pristineState,this.updatesState);return(0,e.eS)(c,p=>p.pipe((0,r.U)(([f,C])=>void 0===C?f:C)))}set current(c){c?this.updatesState.putValue(c):this.updatesState.clear()}get current(){return this.lastUpdatedState.value}}a.\u0275fac=function(c){return new(c||a)(l.LFG(i.q))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac});class m extends a{}m.\u0275fac=function(){let v;return function(p){return(v||(v=l.n5z(m)))(p||m)}}(),m.\u0275prov=l.Yz7({token:m,factory:m.\u0275fac})},79174:(X,I,t)=>{"use strict";t.d(I,{q:()=>l});var i=t(61083),e=t(43440),d=t(53466),h=t(44022),r=t(54592),n=t(2316);class l extends r.H{constructor(m,v,c){super(m),this.querySpace=m,this.workPackageViewGroupByService=v,this.schemaCacheService=c,this.groupTypesWithHeaderCellsWhenCollapsed=["project"],this.isMilestone=p=>{var f;return null===(f=this.schemaCacheService.of(p))||void 0===f?void 0:f.isMilestone},this.wpTypesToShowInCollapsedGroupHeaders=[this.isMilestone]}get config(){return this.updatesState.getValueOr(this.getDefaultState())}get currentGroups(){return this.querySpace.groups.value}get allGroupsAreCollapsed(){return this.config.allGroupsAreCollapsed}get allGroupsAreExpanded(){return this.config.allGroupsAreExpanded}get currentGroupedBy(){return this.workPackageViewGroupByService.current}getDefaultState(){var m;return Object.assign({state:this.querySpace.collapsedGroups.value||{},allGroupsChanged:!1,lastChangedGroup:null,groupedBy:(null===(m=this.currentGroupedBy)||void 0===m?void 0:m.id)||null},this.getAllGroupsCollapsedState(this.currentGroups,this.querySpace.collapsedGroups.value))}toggleGroupCollapseState(m){const v=!this.config.state[m],c=Object.assign(Object.assign({},this.config.state),{[m]:v}),p=Object.assign(Object.assign(Object.assign({},this.config),{state:c,lastChangedGroup:m}),this.getAllGroupsCollapsedState(this.currentGroups,c));this.update(p)}setAllGroupsCollapseStateTo(m){const v=this.currentGroups.reduce((p,f)=>Object.assign(Object.assign({},p),{[f.identifier]:m}),{}),c=Object.assign(Object.assign({},this.config),{state:Object.assign(Object.assign({},this.config.state),v),lastChangedGroup:null,allGroupsAreCollapsed:m,allGroupsAreExpanded:!m,allGroupsChanged:!0});this.update(c)}getAllGroupsCollapsedState(m,v){let c=!1,p=!0;if(v&&(null==m?void 0:m.length)){const f=m[0].identifier,C=v[f],u=m.every(k=>null!=v[k.identifier]&&v[k.identifier]===v[f]);c=u&&C,p=u&&!C}return{allGroupsAreCollapsed:c,allGroupsAreExpanded:p}}initialize(m,v,c){this.querySpace.tableRendered.values$().pipe((0,d.q)(1)).subscribe(()=>this.update(Object.assign(Object.assign({},this.config),{allGroupsChanged:!0})))}valueFromQuery(m,v){return this.getDefaultState()}applyToQuery(m){}}l.\u0275fac=function(m){return new(m||l)(n.LFG(e.q),n.LFG(i.w),n.LFG(h.y))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac})},71562:(X,I,t)=>{"use strict";t.d(I,{i:()=>v});var i=t(43440),e=t(87853),d=t(70319),h=t(14808),r=t(53466),n=t(67202),l=t(91720),a=t(54592),m=t(2316);class v extends a.q{constructor(p,f){super(f),this.states=p,this.querySpace=f}initialize(p,f,C){super.initialize(p,f,C)}valueFromQuery(p){return[...p.columns]}hasChanged(p){return!this.isCurrentlyEqualTo(p.columns)}isCurrentlyEqualTo(p){const f=C=>C.map(u=>u.href);return _.isEqual(f(p),f(this.getColumns()))}applyToQuery(p){const f=this.getColumns(),C=p.columns.map(O=>O.id),u=f.map(O=>O.id);return p.columns=(0,l.FQ)(f),!(0===_.difference(u,C).length)&&this.hasRelationColumns()}hasRelationColumns(){const p=[d.L.RELATION_OF_TYPE,d.L.RELATION_TO_TYPE];return!!_.find(this.getColumns(),f=>p.indexOf(f._type)>=0)}getColumns(){return[...this.current]}index(p){return _.findIndex(this.getColumns(),f=>f.id===p)}findById(p){return _.find(this.getColumns(),f=>f.id===p)}previous(p){const f=this.index(p.id);return f<=0?null:this.getColumns()[f-1]}next(p){const f=this.index(p.id);return-1===f||this.isLast(p)?null:this.getColumns()[f+1]}isFirst(p){return 0===this.index(p.id)}isLast(p){return this.index(p.id)===this.columnCount-1}setColumns(p){this.isCurrentlyEqualTo(p)||this.update(p)}setColumnsById(p){const f=p.map(C=>_.find(this.all,u=>u.id===C));this.setColumns(_.compact(f))}moveColumn(p,f){const C=this.getColumns();f>=C.length&&(f=C.length-1),f<0&&(f=0);const u=C[p];C.splice(p,1),C.splice(f,0,u),this.setColumns(C)}shift(p,f){const C=this.index(p.id);-1!==C&&this.moveColumn(C,C+f)}addColumn(p,f){const C=this.getColumns();if(void 0===f&&(f=C.length),-1===this.index(p)){const u=_.find(this.all,k=>k.id===p);if(!u)throw new Error("Column with provided name is not found");C.splice(f,0,u),this.setColumns(C)}}removeColumn(p){const f=this.index(p.id);if(-1!==f){const C=this.getColumns();C.splice(f,1),this.setColumns(C)}}get current(){return this.lastUpdatedState.getValueOr([])}get availableState(){return this.querySpace.available.columns}get columnCount(){return this.getColumns().length}get all(){return this.availableState.getValueOr([])}get allPropertyColumns(){return this.all.filter(p=>p._type===d.L.PROPERTY)}get unused(){return _.differenceBy(this.all,this.getColumns(),"$href")}onReady(){return(0,h.$e)(this.pristineState,this.availableState).values$().pipe((0,r.q)(1),(0,n.h)(null)).toPromise()}}v.\u0275fac=function(p){return new(p||v)(m.LFG(e.G),m.LFG(i.q))},v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac})},2888:(X,I,t)=>{"use strict";t.d(I,{M5:()=>r,he:()=>n,ld:()=>l});var i=t(87853),e=t(43440),d=t(54592),h=t(2316);const r="list",n="card";class l extends d.q{constructor(m,v){super(v),this.states=m,this.querySpace=v}hasChanged(m){return this.current!==m.displayRepresentation}valueFromQuery(m){return m.displayRepresentation||null}applyToQuery(m){const{current:v}=this;return m.displayRepresentation=null===v?void 0:v,!1}get current(){return this.lastUpdatedState.getValueOr(null)}get isList(){const{current:m}=this;return!m||m===r}get isCards(){return this.current===n}setDisplayRepresentation(m){this.update(m)}}l.\u0275fac=function(m){return new(m||l)(h.LFG(i.G),h.LFG(e.q))},l.\u0275prov=h.Yz7({token:l,factory:l.\u0275fac})},74647:(X,I,t)=>{"use strict";t.d(I,{Z:()=>c});var i=t(43440),e=t(14808),d=t(87853),h=t(53466),r=t(67202),n=t(63085),l=t(91720),a=t(63588),m=t(54592),v=t(2316);class c extends m.q{constructor(f,C){super(C),this.states=f,this.querySpace=C,this.hidden=["datesInterval","precedes","follows","relates","duplicates","duplicated","blocks","blocked","partof","includes","requires","required","search","subjectOrId","subjectOr","manualSort","typeahead"],this.incomplete=(0,e.qH)(!1)}initializeFilters(f,C){const u=(0,l.FQ)(f.filters);this.availableState.putValue(C.filtersSchemas.elements),this.pristineState.putValue(u)}get isEmpty(){const{value:f}=this.lastUpdatedState;return!f||0===f.length}get availableState(){return this.querySpace.available.filters}get incomplete$(){return this.incomplete.values$()}add(f){this.updatesState.putValue([...this.rawFilters,f])}replace(f,C){const u=this.instantiate(f),k=[...this.rawFilters];C(u);const O=this.findIndex(f);-1===O?k.push(u):k.splice(O,1,u),this.update(k)}modify(f,C){const u=this.findIndex(f);if(-1===u)return!1;const k=[...this.rawFilters];return C(k[u]),this.update(k),!0}instantiate(f){const C=f instanceof a.e?f.id:f;return _.find(this.availableSchemas,k=>k.filter.allowedValues[0].id===C).getFilter()}remove(...f){const C=k=>k instanceof n.L?k.id:k,u=new Set(f.map(C));this.update(this.rawFilters.filter(k=>!u.has(C(k))))}remainingVisibleFilters(f=this.current){return this.remainingFilters(f).filter(C=>-1===this.hidden.indexOf(C.id))}get availableFilters(){return this.availableSchemas.map(f=>f.allowedFilterValue)}get availableSchemas(){return this.availableState.getValueOr([])}isComplete(f){return _.every(f,C=>C.isCompletelyDefined())}hasChanged(f){const C=u=>u.map(k=>k.$source);return!_.isEqual(C(f.filters),C(this.rawFilters))}valueFromQuery(f){}update(f){super.update(f),this.incomplete.putValue(!1)}find(f){const C=this.findIndex(f);if(-1!==C)return this.rawFilters[C]}findIndex(f){return _.findIndex(this.current,C=>C.id===f)}applyToQuery(f){return f.filters=this.cloneFilters(),!0}get current(){return[...this.rawFilters]}cloneFilters(){return(0,l.FQ)(this.rawFilters)}get rawFilters(){return this.lastUpdatedState.value||[]}get currentlyVisibleFilters(){const f=new Set(this.hidden);return f.delete("search"),_.reject(this.current,C=>f.has(C.id))}replaceIfComplete(f){this.isComplete(f)?this.update(f):this.incomplete.putValue(!0)}onReady(){return(0,e.$e)(this.pristineState,this.availableState).values$().pipe((0,h.q)(1),(0,r.h)(null)).toPromise()}remainingFilters(f=this.rawFilters){return _.differenceBy(this.availableFilters,f,C=>C.id)}isAvailable(f){return!!this.availableFilters.find(C=>C.id===f.id)}}c.\u0275fac=function(f){return new(f||c)(v.LFG(d.G),v.LFG(i.q))},c.\u0275prov=v.Yz7({token:c,factory:c.\u0275fac})},48451:(X,I,t)=>{"use strict";t.d(I,{o:()=>l});var i=t(43440),e=t(33927),d=t(83720),h=t(60914),r=t(54592),n=t(2316);class l extends r.H{constructor(m,v){super(m),this.querySpace=m,this.wpTableSelection=v}isFocused(m){return this.focusedWorkPackage===m}ifShouldFocus(m){const v=this.current;v&&v.focusAfterRender&&(m(v.workPackageId),v.focusAfterRender=!1,this.update(v))}get focusedWorkPackage(){const m=this.current;if(m)return m.workPackageId;const v=this.querySpace.results.value;return v&&v.elements.length>0?v.elements[0].id.toString():null}whenChanged(){return this.live$().pipe((0,e.U)(m=>m.workPackageId),(0,d.x)())}updateFocus(m,v=!1){this.wpTableSelection.isEmpty&&this.wpTableSelection.setRowState(m,!0),this.update({workPackageId:m,focusAfterRender:v})}valueFromQuery(m,v){}}l.\u0275fac=function(m){return new(m||l)(n.LFG(i.q),n.LFG(h.J))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac})},61083:(X,I,t)=>{"use strict";t.d(I,{w:()=>r});var i=t(87853),e=t(43440),d=t(54592),h=t(2316);class r extends d.q{constructor(l,a){super(a),this.states=l,this.querySpace=a}valueFromQuery(l){return l.groupBy||null}hasChanged(l){const a=m=>m?m.href:null;return!_.isEqual(a(l.groupBy),a(this.current))}applyToQuery(l){const{current:a}=this;return l.groupBy=null===a?void 0:a,!0}isGroupable(l){return!!_.find(this.available,a=>a.id===l.id)}disable(){this.update(null)}setBy(l){const a=_.find(this.available,m=>m.id===l.id);a&&this.update(a)}get current(){return this.lastUpdatedState.getValueOr(null)}get availableState(){return this.querySpace.available.groupBy}get isEnabled(){return!!this.current}get available(){return this.availableState.getValueOr([])}isCurrentlyGroupedBy(l){const a=this.current;return!(!a||a.id!==l.id)}}r.\u0275fac=function(l){return new(l||r)(h.LFG(i.G),h.LFG(e.q))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac})},16793:(X,I,t)=>{"use strict";t.d(I,{f:()=>m});var i=t(3786),e=t(99676),d=t(43440),h=t(41945),r=t(87853),n=t(2888),l=t(61908),a=t(2316);class m{constructor(c,p,f,C,u,k){this.wpViewHierarchies=c,this.wpDisplayRepresentation=p,this.states=f,this.wpRelationHierarchy=C,this.apiV3Service=u,this.querySpace=k}get applicable(){return this.wpViewHierarchies.isEnabled&&this.wpDisplayRepresentation.isList}canIndent(c){if(!c.changeParent||!this.applicable)return!1;const p=this.renderedWorkPackageIds,f=p.indexOf(c.id);if(0===f)return!1;const C=c.ancestorIds,u=C.length;if(0===u)return!0;const k=C[u-1];return p[f-1]!==k}canOutdent(c){return!(!c.changeParent||!this.applicable)&&!!c.parent}indent(c){return(0,i.mG)(this,void 0,void 0,function*(){if(!this.canIndent(c))return Promise.reject();const p=this.renderedWorkPackageIds,f=p.indexOf(c.id),C=p[f-1];let u=C;const k=yield this.apiV3Service.work_packages.id(C).get().toPromise(),O=_.difference(k.ancestorIds,c.ancestorIds);return O&&O.length>0&&(u=O[0]),this.wpRelationHierarchy.changeParent(c,u)})}outdent(c){if(!this.canOutdent(c))return Promise.reject();let p=null;const{ancestorIds:f}=c,C=f.length;return C>1&&(p=f[C-2]),this.wpRelationHierarchy.changeParent(c,p)}get renderedWorkPackageIds(){return this.querySpace.renderedWorkPackageIds.getValueOr([])}}m.\u0275fac=function(c){return new(c||m)(a.LFG(e.Y),a.LFG(n.ld),a.LFG(r.G),a.LFG(h.O),a.LFG(l.T),a.LFG(d.q))},m.\u0275prov=a.Yz7({token:m,factory:m.\u0275fac})},99676:(X,I,t)=>{"use strict";t.d(I,{Y:()=>h});class i{constructor(n){this.isVisible=!1,this.last=null,this.collapsed={},this.isVisible=n}}var e=t(54592),d=t(2316);class h extends e.q{valueFromQuery(n){const l=new i(n.showHierarchies),{current:a}=this;return a&&(l.collapsed=a.collapsed),l}hasChanged(n){return n.showHierarchies!==this.isEnabled}applyToQuery(n){return n.showHierarchies=this.isEnabled,this.isEnabled}get isEnabled(){return!(!this.current||!this.current.isVisible)}setEnabled(n=!0){const l=Object.assign(Object.assign({},this.current),{isVisible:n,last:null});this.update(l)}toggleState(){return this.setEnabled(!this.isEnabled),this.isEnabled}collapsed(n){return this.current.collapsed[n]}collapse(n){this.setState(n,!0)}expand(n){this.setState(n,!1)}toggle(n){this.setState(n,!this.collapsed(n))}setState(n,l){const a=Object.assign(Object.assign({},this.current),{last:n});a.collapsed[n]=l,this.update(a)}get current(){const n=this.lastUpdatedState.value;return void 0===n?this.initialState:(n.collapsed||(n.collapsed={}),n)}get initialState(){return new i(!1)}}h.\u0275fac=function(){let r;return function(l){return(r||(r=d.n5z(h)))(l||h)}}(),h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},84897:(X,I,t)=>{"use strict";t.d(I,{B:()=>n});var i=t(43440),e=t(87853),d=t(73881),h=t(54592),r=t(2316);class n extends h.q{constructor(a,m,v){super(v),this.states=a,this.Banners=m,this.querySpace=v}initialize(a,m,v){super.initialize(a,m,v)}shouldHighlightInline(a){return!(!this.isInline||this.Banners.eeShowBanners)&&(void 0===this.current.selectedAttributes||this.current.selectedAttributes===[]||!!_.find(this.current.selectedAttributes,m=>m.id===a))}get current(){const a=this.lastUpdatedState.getValueOr({mode:"inline"});return this.filteredValue(a)}get isInline(){return"inline"===this.current.mode}get isDisabled(){return"none"===this.current.mode}update(a){super.update(this.filteredValue(a))}valueFromQuery(a){const m={mode:a.highlightingMode||"inline",selectedAttributes:a.highlightedAttributes};return this.filteredValue(m)}hasChanged(a){return a.highlightingMode!==this.current.mode||!_.isEqual(a.highlightedAttributes,this.current.selectedAttributes)}applyToQuery(a){const{current:m}=this;return a.highlightingMode=m.mode,a.highlightedAttributes=m.selectedAttributes,!1}filteredValue(a){return _.isEmpty(a.selectedAttributes)&&(a.selectedAttributes=void 0),this.Banners.conditional(()=>{a.mode="none",a.selectedAttributes=void 0}),a}}n.\u0275fac=function(a){return new(a||n)(r.LFG(e.G),r.LFG(d.j),r.LFG(i.q))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})},20066:(X,I,t)=>{"use strict";t.d(I,{F:()=>r});var i=t(87853),e=t(43440),d=t(54592),h=t(2316);class r extends d.q{constructor(l,a){super(a),this.states=l,this.querySpace=a}hasChanged(l){return this.current!==l.includeSubprojects}valueFromQuery(l){return l.includeSubprojects||!1}applyToQuery(l){const{current:a}=this;return l.includeSubprojects=a,!0}get current(){return this.lastUpdatedState.getValueOr(!1)}setIncludeSubprojects(l){this.update(l)}}r.\u0275fac=function(l){return new(l||r)(h.LFG(i.G),h.LFG(e.q))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac})},95846:(X,I,t)=>{"use strict";t.d(I,{M:()=>V});var i=t(3786),e=t(53466),d=t(87853),h=t(43440),r=t(70233),n=t(48934),l=t(3352);const a=-2147483647,m=2147483647,c=16384;function p(K,q,se){return void 0===K[se]?q[se]:K[se]}function f(K,q,se,te){return p(K,se,q[te])}function P(K,q,se,te){const ie=q.length;let le=se,oe=te,ne=Math.floor((oe-le)/(ie-1));if(ne<1){if(oe+ie<=m)oe+=ie;else{if(!(le-ie>=a))throw new Error("Elements cannot be moved further and no space is left. Too many elements");le-=ie}ne=Math.floor((oe-le)/(ie-1))}const fe=Object.assign({},K);for(let ve=0;ve<ie;ve+=1){fe[q[ve]]=le+ve*ne}return fe}function E(K,q,se){const te=function(K,q,se){return p(K,se,q[0]||"")||0}(K,q,se),ie=function(K,q,se){for(let te=q.length-1;te>=0;te-=1){const le=p(K,se,q[te]);if(void 0!==le)return le}return 0}(K,q,se);return P(K,q,te,ie)}function T(K,q,se,te,ie){const le={};if(K.length<=1&&void 0===q[se])return Object.assign(Object.assign({},le),{[se]:0});const oe=function(K,q,se,te,ie,le){if(null===ie)return K;const oe=f(K,q,se,te),ne=q[ie],fe=f(K,q,se,ie);return void 0===oe||void 0===fe?K:Object.assign(Object.assign({},K),{[`${le}`]:fe,[`${ne}`]:oe})}(le,K,q,te,ie,se);if(null!==ie&&1===Math.abs(ie-te)&&le!==oe)return oe;if(0===te)return function(K,q,se,te,ie){const le=f(K,q,se,te+1);return void 0===le?Object.assign(Object.assign({},K),{[ie]:0}):Object.assign(Object.assign({},K),{[ie]:le-c/2})}(oe,K,q,te,se);const{delta:ne,predecessorPosition:fe}=function(K,q,se,te){let ie=0-c;const le=Object.assign({},K);for(let oe=0;oe<te;oe+=1){const ne=q[oe],fe=se[ne];void 0===fe?(le[ne]=ie+c,ie=le[ne]):ie=fe}return{predecessorPosition:ie,delta:le}}(oe,K,q,te);if(fe>=m)return(0,l.qu)("Predecessor position is at max order, need to reorder"),E(ne,K,q);const ve=f(ne,K,q,te+1);if(void 0===ve)return Object.assign(Object.assign({},ne),{[se]:fe+c/2});if(ve>=m)return(0,l.qu)("Successor position is at max order, need to reorder"),E(ne,K,q);const Se=Math.floor((ve-fe)/2);return Se<1?((0,l.qu)("Cannot insert at optimal position, no space left. Need to reorder"),E(ne,K,q)):Object.assign(Object.assign({},ne),{[se]:fe+Se})}function S(K,q){const se={},[te,ie]=function(K,q,se){let te=m,ie=a,le=!1;for(let oe=q.length-1;oe>=0;oe-=1){const fe=p(K,se,q[oe]);void 0!==fe&&(te=Math.min(fe,te),ie=Math.max(fe,ie),le=!0)}return le&&te!==ie?[te,ie]:[0,q.length*c]}(se,K,q);return P(se,K,te,ie)}var F=t(82763),L=t(64538),D=t(61908),G=t(54592),Q=t(2316);class V extends G.q{constructor(q,se,te,ie,le,oe){super(q),this.querySpace=q,this.apiV3Service=se,this.states=te,this.causedUpdates=ie,this.wpTableSortBy=le,this.pathHelper=oe}initialize(q,se,te){return!(0,n.Z)(q)&&this.positions.hasValue()&&this.applyToQuery(q),this.wpTableSortBy.isManualSortingMode?this.withLoadedPositions():Promise.resolve()}move(q,se,te){return(0,i.mG)(this,void 0,void 0,function*(){const ie=q.findIndex(le=>le===se);return q.splice(ie,1),q.splice(te,0,se),yield this.assignPosition(q,se,te,ie),q})}remove(q,se){return _.remove(q,te=>te===se),this.update({[se]:-1}),q}add(q,se,te=-1){return(0,i.mG)(this,void 0,void 0,function*(){return-1===te?(q.push(se),te=q.length-1):q.splice(te,0,se),yield this.assignPosition(q,se,te),q})}get applicable(){return(0,n.Z)(this.currentQuery)}get currentQuery(){return this.querySpace.query.value}assignPosition(q,se,te,ie=null){return(0,i.mG)(this,void 0,void 0,function*(){const le=yield this.withLoadedPositions(),oe=function(K,q,se,te,ie){return function(K,q,se){let te;for(let ie=0,le=K.length;ie<le;ie+=1){const ne=q[K[ie]];if(ie!==se){if(void 0===te||void 0===ne){te=ne;continue}if(ne<te)return!1}}return!0}(K,q,te)?T(K,q,se,te,ie):S(K,q)}(q,le,se,te,ie);yield this.update(oe)})}get positions(){return this.updatesState}update(q){return(0,i.mG)(this,void 0,void 0,function*(){const se=this.positions.getValueOr({});if(this.positions.putValue(Object.assign(Object.assign({},se),q)),(0,n.Z)(this.currentQuery)){const te=yield this.apiV3Service.queries.id(this.currentQuery).order.update(q);this.currentQuery.updatedAt=te,this.causedUpdates.add(this.currentQuery)}this.applyToQuery(this.currentQuery),this.querySpace.query.putValue(this.currentQuery)})}withLoadedPositions(){if((0,n.Z)(this.currentQuery)){const{value:q}=this.positions;(q==={}||this.positions.isValueOlderThan(6e4))&&this.positions.clear("Clearing old positions value"),this.positions.putFromPromiseIfPristine(()=>this.apiV3Service.queries.id(this.currentQuery).order.get())}else this.positions.isPristine()&&this.positions.putValue({});return this.positions.values$().pipe((0,e.q)(1)).toPromise()}valueFromQuery(q){}orderedWorkPackages(){const q=this.querySpace.results.value.elements.map(te=>this.states.workPackages.get(te.id).getValueOr(te));if((0,n.Z)(this.currentQuery)||this.positions.isPristine())return q;const se=this.positions.value;return _.sortBy(q,te=>{const ie=se[te.id];return void 0!==ie?ie:m})}applyToQuery(q){return q.orderedWorkPackages=this.positions.getValueOr({}),!1}hasChanged(q){return!1}}V.\u0275fac=function(q){return new(q||V)(Q.LFG(h.q),Q.LFG(D.T),Q.LFG(d.G),Q.LFG(L.h),Q.LFG(F.q),Q.LFG(r.j))},V.\u0275prov=Q.Yz7({token:V,factory:V.\u0275fac})},40533:(X,I,t)=>{"use strict";t.d(I,{S:()=>l});var i=t(43440),e=t(14359);class d{constructor(m){this.current=new e.M(m.offset,m.total,m.pageSize)}get page(){return this.current.page}set page(m){this.current.page=m}get perPage(){return this.current.perPage}set perPage(m){this.current.perPage=m}get total(){return this.current.total}set total(m){this.current.total=m}}var h=t(54592),r=t(68853),n=t(2316);class l extends h.H{constructor(m,v){super(m),this.paginationService=v}get paginationObject(){return this.current?{pageSize:this.current.perPage,offset:this.current.page}:{pageSize:this.paginationService.getCachedPerPage([]),offset:1}}valueFromQuery(m,v){return new d(v)}updateFromObject(m){const v=this.current;m.page&&(v.page=m.page),m.perPage&&(v.perPage=m.perPage),m.total&&(v.total=m.total),this.updatesState.putValue(v)}updateFromResults(m){const v={page:m.offset,perPage:m.pageSize,total:m.total,count:m.count};this.updateFromObject(v)}get current(){return this.lastUpdatedState.value}}l.\u0275fac=function(m){return new(m||l)(n.LFG(i.q),n.LFG(r.N))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac})},41195:(X,I,t)=>{"use strict";t.d(I,{a:()=>m});var i=t(43440),e=t(53457),d=t(70319),h=t(61908),r=t(91923),n=t(54592),l=t(71562),a=t(2316);class m extends n.H{constructor(c,p,f,C,u){super(c),this.querySpace=c,this.wpTableColumns=p,this.halResourceService=f,this.apiV3Service=C,this.wpRelations=u}valueFromQuery(c){return this.current}relationsToExtendFor(c,p,f){if(!this.wpTableColumns.hasRelationColumns()||!this.lastUpdatedState.hasValue()||_.isNil(p))return;const C=this.getExpandFor(c.id);if(void 0===C)return;const u=this.wpTableColumns.findById(C),k=this.relationColumnType(u);null!==k&&_.each(this.relationsForColumn(c,p,u),O=>f(O,u,k))}relationsForColumn(c,p,f){if(_.isNil(p))return[];const C=this.relationColumnType(f);if("toType"===C){const u=f.type.href;return _.filter(p,k=>{const O=k.denormalized(c),y=this.apiV3Service.work_packages.cache.state(O.targetId).value;return _.get(y,"type.href")===u})}if("ofType"===C){const{relationType:u}=f;return _.filter(p,k=>k.denormalized(c).relationType===u)}return[]}relationColumnType(c){switch(c._type){case d.L.RELATION_TO_TYPE:return"toType";case d.L.RELATION_OF_TYPE:return"ofType";default:return null}}getExpandFor(c){return this.current[c]}setExpandFor(c,p){const f=Object.assign({},this.current);f[c]=p,this.update(f)}collapse(c){const p=Object.assign({},this.current);delete p[c],this.update(p)}get current(){return this.lastUpdatedState.getValueOr({})}}m.\u0275fac=function(c){return new(c||m)(a.LFG(i.q),a.LFG(l.i),a.LFG(r.u),a.LFG(h.T),a.LFG(e.V))},m.\u0275prov=a.Yz7({token:m,factory:m.\u0275fac})},60914:(X,I,t)=>{"use strict";t.d(I,{J:()=>n});var i=t(43440),e=t(87853),d=t(20342),h=t(54592),r=t(2316);class n extends h.H{constructor(a,m,v){super(a),this.querySpace=a,this.states=m,this.opContextMenu=v,this.reset()}ngOnDestroy(){Mousetrap.unbind(["command+d","ctrl+d"]),Mousetrap.unbind(["command+a","ctrl+a"])}initializeSelection(a){const m={selected:{},activeRowIndex:null};a.forEach(v=>m.selected[v]=!0),this.updatesState.clear(),this.pristineState.putValue(m)}isSelected(a){var m;return!!(null===(m=this.current)||void 0===m?void 0:m.selected[a])}selectAll(a){const m=this._emptyState;a.forEach(v=>{v.workPackageId&&(m.selected[v.workPackageId]=!0)}),this.update(m)}getSelectedWorkPackages(){const a=this.states.workPackages;return this.getSelectedWorkPackageIds().map(m=>a.get(m).value)}getSelectedWorkPackageIds(){var a;const m=[];return _.each(null===(a=this.current)||void 0===a?void 0:a.selected,(v,c)=>{v&&m.push(c)}),m}reset(){this.update(this._emptyState)}get isEmpty(){return 0===this.selectionCount}get selectionCount(){var a;return _.size(null===(a=this.current)||void 0===a?void 0:a.selected)}toggleRow(a){var m;const v=null===(m=this.current)||void 0===m?void 0:m.selected[a];this.setRowState(a,!v)}setRowState(a,m){const v=this.current||this._emptyState;v.selected[a]=m,this.update(v)}setSelection(a,m){const v=this._emptyState;v.selected[a]=!0,v.activeRowIndex=m,this.update(v)}setMultiSelectionFrom(a,m,v){const c=this.current||this._emptyState;if(0===this.selectionCount||null===c.activeRowIndex)c.selected[m]=!0,c.activeRowIndex=v;else{const p=Math.min(v,c.activeRowIndex),f=Math.max(v,c.activeRowIndex);a.forEach((C,u)=>{C.workPackageId&&(c.selected[C.workPackageId]=u>=p&&u<=f)})}this.update(c)}registerSelectAllListener(a){Mousetrap.bind(["command+a","ctrl+a"],m=>(this.selectAll(a()),m.preventDefault(),this.opContextMenu.close(),!1))}registerDeselectAllListener(){Mousetrap.bind(["command+d","ctrl+d"],a=>(this.reset(),a.preventDefault(),this.opContextMenu.close(),!1))}get _emptyState(){return{selected:{},activeRowIndex:null}}valueFromQuery(a,m){}}n.\u0275fac=function(a){return new(a||n)(r.LFG(i.q),r.LFG(e.G),r.LFG(d.$))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})},82763:(X,I,t)=>{"use strict";t.d(I,{q:()=>a});var i=t(14808),e=t(67202),d=t(43440),h=t(87853),r=t(70233),n=t(54592),l=t(2316);class a extends n.q{constructor(v,c,p){super(c),this.states=v,this.querySpace=c,this.pathHelper=p}valueFromQuery(v){return[...v.sortBy]}onReadyWithAvailable(){return(0,i.$e)(this.pristineState,this.querySpace.available.sortBy).values$().pipe((0,e.h)(null))}hasChanged(v){const c=p=>p.map(f=>f.href);return!_.isEqual(c(v.sortBy),c(this.current))}applyToQuery(v){const c=this.isManuallySorted(v.sortBy);return v.sortBy=[...this.current],!(c&&this.isManualSortingMode)}isSortable(v){return!!_.find(this.available,c=>c.column.href===v.href)}addSortCriteria(v,c){const p=this.findAvailableDirection(v,c);p&&this.add(p)}setAsSingleSortCriteria(v,c){const p=this.findAvailableDirection(v,c);p&&this.update([p])}findAvailableDirection(v,c){return _.find(this.available,p=>p.column.href===v.href&&p.direction.href===c)}add(v){const c=_.uniqBy([v,...this.current],p=>p.column.href).slice(0,3);this.update(c)}get isManualSortingMode(){return this.isManuallySorted(this.current)}switchToManualSorting(v){const{manualSortObject:c}=this;return!(!c||this.isManualSortingMode)&&(v.setSortBy([c]),!0)}get current(){return this.lastUpdatedState.getValueOr([])}get availableState(){return this.querySpace.available.sortBy}get available(){return this.availableState.getValueOr([])}isManuallySorted(v){return!!(v&&v.length>0)&&v[0].column.href.endsWith("/manualSorting")}get manualSortObject(){return _.find(this.available,v=>v.column.href.endsWith("/manualSorting"))}}a.\u0275fac=function(v){return new(v||a)(l.LFG(h.G),l.LFG(d.q),l.LFG(r.j))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac})},82271:(X,I,t)=>{"use strict";t.d(I,{X:()=>h});var i=t(43440),e=t(54592),d=t(2316);class h extends e.q{constructor(n){super(n)}valueFromQuery(n){return!!n.sums}initialize(n){this.pristineState.putValue(!!n.sums)}hasChanged(n){return n.sums!==this.isEnabled}applyToQuery(n){return n.sums=this.isEnabled,!0}toggle(){this.updatesState.putValue(!this.current)}setEnabled(n){this.updatesState.putValue(n)}get isEnabled(){return this.current}get current(){return this.lastUpdatedState.getValueOr(!1)}}h.\u0275fac=function(n){return new(n||h)(d.LFG(i.q))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},73165:(X,I,t)=>{"use strict";t.d(I,{W:()=>n});var i=t(43440),e=t(14808),d=t(42529),h=t(54592),r=t(2316);class n extends h.q{constructor(a){super(a),this.querySpace=a,this.appliedZoomLevel$=(0,e.qH)("auto")}valueFromQuery(a){return Object.assign(Object.assign({},this.defaultState),{visible:a.timelineVisible,zoomLevel:a.timelineZoomLevel,labels:a.timelineLabels})}set appliedZoomLevel(a){this.appliedZoomLevel$.putValue(a)}get appliedZoomLevel(){return this.appliedZoomLevel$.value}hasChanged(a){const m=this.isVisible!==a.timelineVisible,v=this.zoomLevel!==a.timelineZoomLevel,c=!_.isEqual(this.current.labels,a.timelineLabels);return m||v||c}applyToQuery(a){return a.timelineVisible=this.isVisible,a.timelineZoomLevel=this.zoomLevel,a.timelineLabels=this.current.labels,!1}toggle(){const a=this.current;this.setVisible(!a.visible)}setVisible(a){this.updatesState.putValue(Object.assign(Object.assign({},this.current),{visible:a}))}get isVisible(){return this.current.visible}get zoomLevel(){return this.current.zoomLevel}get labels(){return _.isEmpty(this.current.labels)?this.defaultLabels:this.current.labels}updateLabels(a){this.modify({labels:a})}getNormalizedLabels(a){const m=this.defaultLabels;return _.each(this.current.labels,(v,c)=>{const p=c;m[p]=""===v?null:v}),m}setZoomLevel(a){this.modify({zoomLevel:a})}updateZoomWithDelta(a){const m=this.current.zoomLevel;if("auto"!==m)return this.applyZoomLevel(m,a);const v=this.appliedZoomLevel;if(v&&"auto"!==v)this.applyZoomLevel(v,a);else{const c=a<0?"days":"years";this.setZoomLevel(c)}}isAutoZoom(){return"auto"===this.current.zoomLevel}enableAutozoom(){this.modify({zoomLevel:"auto"})}get current(){return this.lastUpdatedState.getValueOr(this.defaultState)}modify(a){this.update(Object.assign(Object.assign({},this.current),a))}applyZoomLevel(a,m){let v=d.$r.indexOf(a);v+=m,v>=0&&v<d.$r.length&&this.setZoomLevel(d.$r[v])}get defaultLabels(){return{left:"",right:"",farRight:"subject"}}get defaultState(){return{zoomLevel:"auto",visible:!1,labels:this.defaultLabels}}}n.\u0275fac=function(a){return new(a||n)(r.LFG(i.q))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})},1818:(X,I,t)=>{"use strict";t.d(I,{e:()=>M});var i=t(3786),e=t(2316),d=t(96617),h=t(70233),r=t(48451),n=t(57810),l=t(7493),a=t(87853),m=t(84109),v=t(12703),c=t(62964),p=t(29161),f=t(26942),C=t(61908),u=t(53448),k=t(82123),O=t(60419),y=t(88826),b=t(4018),P=t(92144),E=t(44040),T=t(36293);class M extends f.N{constructor(R,F){super(),this.injector=R,this.workPackageId=F,this.text={},this.initializeTexts()}observeWorkPackage(){this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(R=>{this.workPackage?this.workPackage=R:(this.workPackage=R,this.init()),this.cdRef.detectChanges()},R=>{this.handleLoadingError(R)})}initializeTexts(){this.text.tabs={},["overview","activity","relations","watchers"].forEach(R=>{this.text.tabs[R]=this.I18n.t(`js.work_packages.tabs.${R}`)})}init(){this.apiV3Service.projects.id(this.workPackage.project).requireAndStream().subscribe(()=>{this.projectIdentifier=this.workPackage.project.identifier,this.cdRef.detectChanges()}),this.projectsResourceService.update(this.workPackage.$links.project.href).subscribe(()=>{},F=>{this.toastService.addError(F)}),this.displayNotificationsButton$=this.storeService.hasNotifications$,this.storeService.setFilters(this.workPackage.id),this.authorisationService.initModelAuth("work_package",this.workPackage.$links),this.titleService.setFirstPart(this.workPackage.subjectWithType(20)),this.showStaticPagePath=this.PathHelper.workPackagePath(this.workPackageId);const R=this.workPackage.attachments;this.attachmentsResourceService.fetchAttachments(R.href).subscribe(),this.workPackage.$links.fileLinks&&this.fileLinkResourceService.updateCollectionsForWorkPackage(this.workPackage.$links.fileLinks.href),this.projectsResourceService.lookup(this.workPackage.project.id).pipe(this.untilDestroyed()).subscribe(F=>{F._links.storages&&this.storages.updateCollection(F._links.self.href,F._links.storages)}),this.keepTab.observable.pipe(this.untilDestroyed()).subscribe(F=>{this.updateFocusAnchorLabel(F.active)})}handleLoadingError(R){this.notificationService.handleRawError(R)}updateFocusAnchorLabel(R){return this.focusAnchorLabel=this.I18n.t("js.label_work_package_details_you_are_here",{tab:this.I18n.t(`js.work_packages.tabs.${R}`),type:this.workPackage.type.name,subject:this.workPackage.subject}),this.focusAnchorLabel}}(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",a.G)],M.prototype,"states",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",d.D)],M.prototype,"I18n",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",m.p)],M.prototype,"keepTab",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",h.j)],M.prototype,"PathHelper",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",v.l)],M.prototype,"halEditing",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",r.o)],M.prototype,"wpTableFocus",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",c.q)],M.prototype,"notificationService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",l.g)],M.prototype,"authorisationService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",y.v)],M.prototype,"attachmentsResourceService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",P.s)],M.prototype,"fileLinkResourceService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",E.D)],M.prototype,"projectsResourceService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",b.l)],M.prototype,"storages",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",T.kl)],M.prototype,"toastService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",e.sBO)],M.prototype,"cdRef",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",n.V)],M.prototype,"titleService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",C.T)],M.prototype,"apiV3Service",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",u.$)],M.prototype,"hooks",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",O.b)],M.prototype,"actions$",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",k.O)],M.prototype,"storeService",void 0)},34520:(X,I,t)=>{"use strict";t.d(I,{_:()=>q});var i=t(3786),e=t(2316),d=t(47775),h=t(7493),r=t(43440),n=t(17163),l=t(9170),a=t(53466),m=t(86469),v=t(96617),c=t(75867),p=t(84897),f=t(87853),C=t(71562),u=t(82763),k=t(61083),O=t(74647),y=t(82271),b=t(73165),P=t(99676),E=t(40533),T=t(61043),M=t(81539),S=t(74478),R=t(95846),F=t(2888),L=t(20066),D=t(1403),G=t(53916),Q=t(29161),V=t(65146),K=t(26942);class q extends K.N{constructor(te){super(),this.injector=te,this.queryLoaded=!1,this.destroyed=!1}ngOnInit(){this.setupQueryObservers(),this.setupRefreshObserver(),this.setupQueryLoadedListener()}setupQueryObservers(){this.wpTablePagination.updates$().pipe(this.untilDestroyed(),(0,n.M)(this.querySpace.query.values$())).subscribe(([te,ie])=>{this.wpListChecksumService.isQueryOutdated(ie,te)&&(this.wpListChecksumService.update(ie,te),this.refresh(!0,!1))}),this.setupChangeObserver(this.wpTableFilters,!0),this.setupChangeObserver(this.wpTableGroupBy),this.setupChangeObserver(this.wpTableSortBy),this.setupChangeObserver(this.wpTableSum),this.setupChangeObserver(this.wpTableTimeline),this.setupChangeObserver(this.wpTableHierarchies),this.setupChangeObserver(this.wpTableColumns),this.setupChangeObserver(this.wpTableHighlighting),this.setupChangeObserver(this.wpTableOrder),this.setupChangeObserver(this.wpDisplayRepresentation),this.setupChangeObserver(this.wpIncludeSubprojects)}setupChangeObserver(te,ie=!1){const le=this.querySpace.query;te.updates$().pipe(this.untilDestroyed(),(0,l.h)(()=>le.hasValue()&&te.hasChanged(le.value))).subscribe(()=>{const oe=le.value,ne=te.applyToQuery(oe);this.querySpace.query.putValue(oe),this.wpListChecksumService.updateIfDifferent(oe,this.wpTablePagination.current).then(()=>{ne&&this.refresh(!0,ie)})})}get projectIdentifier(){return this.currentProject.identifier||void 0}setupRefreshObserver(){this.halEvents.aggregated$("WorkPackage").pipe(this.untilDestroyed(),(0,l.h)(te=>this.filterRefreshEvents(te))).subscribe(te=>{this.refresh(!1,!1)})}filterRefreshEvents(te){var ie;const le=this.querySpace.renderedWorkPackageIds.value||(null===(ie=this.querySpace.results.value)||void 0===ie?void 0:ie.elements.map(ne=>ne.id))||[],oe=new Set(le);for(let ne=0;ne<te.length;ne++){const fe=te[ne];if(oe.has(fe.id)||"created"===fe.eventType)return!0}return!1}setupQueryLoadedListener(){this.querySpace.initialized.values$().pipe((0,a.q)(1),(0,l.h)(()=>!this.componentDestroyed)).subscribe(()=>{this.queryLoaded=!0,this.cdRef.detectChanges()})}}q.\u0275fac=function(te){return new(te||q)(e.Y36(e.zs3))},q.\u0275dir=e.lG2({type:q,features:[e.qOj]}),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",d.StateService)],q.prototype,"$state",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",f.G)],q.prototype,"states",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",r.q)],q.prototype,"querySpace",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",h.g)],q.prototype,"authorisationService",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",C.i)],q.prototype,"wpTableColumns",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",p.B)],q.prototype,"wpTableHighlighting",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",u.q)],q.prototype,"wpTableSortBy",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",k.w)],q.prototype,"wpTableGroupBy",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",O.Z)],q.prototype,"wpTableFilters",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",y.X)],q.prototype,"wpTableSum",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",b.W)],q.prototype,"wpTableTimeline",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",P.Y)],q.prototype,"wpTableHierarchies",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",E.S)],q.prototype,"wpTablePagination",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",R.M)],q.prototype,"wpTableOrder",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",T.Z)],q.prototype,"wpListService",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",M.Y)],q.prototype,"wpListChecksumService",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",m.vt)],q.prototype,"loadingIndicatorService",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",d.TransitionService)],q.prototype,"$transitions",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",v.D)],q.prototype,"I18n",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",c.p)],q.prototype,"opStaticQueries",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",S.f)],q.prototype,"wpStatesInitialization",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",e.sBO)],q.prototype,"cdRef",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",F.ld)],q.prototype,"wpDisplayRepresentation",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",L.F)],q.prototype,"wpIncludeSubprojects",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",D.J)],q.prototype,"halEvents",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",G.U)],q.prototype,"deviceService",void 0),(0,i.gn)([(0,Q.W)(),(0,i.w6)("design:type",V.R)],q.prototype,"currentProject",void 0)},62964:(X,I,t)=>{"use strict";t.d(I,{q:()=>h});var i=t(67727),e=t(61908),d=t(2316);class h extends i.W{constructor(n,l){super(n),this.injector=n,this.apiV3Service=l}showSave(n,l=!1){const a={message:this.I18n.t("js.notice_successful_"+(l?"create":"update"))};this.addWorkPackageFullscreenLink(a,n),this.ToastService.addSuccess(a)}showCustomError(n,l){return"urn:openproject-org:api:v3:errors:UpdateConflict"===n.errorIdentifier?(this.ToastService.addError({message:n.message,type:"error",link:{text:this.I18n.t("js.hal.error.update_conflict_refresh"),target:()=>this.apiV3Service.work_packages.id(l).refresh()}}),!0):super.showCustomError(n,l)}addWorkPackageFullscreenLink(n,l){this.$state.includes("work-packages.show")||(n.link={target:()=>this.$state.go("work-packages.show.tabs",{tabIdentifier:"activity",workPackageId:l.id}),text:this.I18n.t("js.work_packages.message_successful_show_in_fullscreen")})}}h.\u0275fac=function(n){return new(n||h)(d.LFG(d.zs3),d.LFG(e.T))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},56686:(X,I,t)=>{"use strict";t.d(I,{h:()=>m});var i=t(47775),e=t(70233),d=t(55977),h=t(36293),r=t(96617),n=t(1403),l=t(2316),a=t(53882);class m{constructor(c,p,f,C,u,k,O){this.http=c,this.$state=p,this.PathHelper=f,this.UrlParamsHelper=C,this.toastService=u,this.I18n=k,this.halEvents=O,this.text={successful_delete:this.I18n.t("js.work_packages.message_successful_bulk_delete")}}performBulkDelete(c,p){const f={"ids[]":c},C=this.http.delete(this.PathHelper.workPackagesBulkDeletePath(),{params:f,withCredentials:!0}).toPromise();return p&&C.then(()=>{this.toastService.addSuccess(this.text.successful_delete),c.forEach(u=>this.halEvents.push({_type:"WorkPackage",id:u},{eventType:"deleted"})),this.$state.includes("**.list.details.**")&&c.indexOf(this.$state.params.workPackageId)>-1&&this.$state.go("work-packages.partitioned.list",this.$state.params)}).catch(()=>{const u=this.UrlParamsHelper.buildQueryString(f);window.location.href=`${this.PathHelper.workPackagesBulkDeletePath()}?${u}`}),C}}m.\u0275fac=function(c){return new(c||m)(l.LFG(a.eN),l.LFG(i.StateService),l.LFG(e.j),l.LFG(d.Z),l.LFG(h.kl),l.LFG(r.D),l.LFG(n.J))},m.\u0275prov=l.Yz7({token:m,factory:m.\u0275fac})},74603:(X,I,t)=>{"use strict";t.d(I,{c:()=>D});var i=t(33927),e=t(98636),h=(t(80044),t(70692)),r=t(26942),n=t(88826),l=t(84699),a=t(2316),m=t(54364),v=t(76491),c=t(61486),p=t(20088),f=t(83720),C=t(96617),u=t(70233),k=t(96457),O=t(32782),y=t(10190),b=t(6536),P=t(84335);const E=["avatar"];function M(G,Q){if(1&G){const V=a.EpF();a.TgZ(0,"div",8),a.TgZ(1,"button",9),a.NdJ("click",function(){return a.CHM(V),a.oxw().confirmRemoveAttachment()}),a._UZ(2,"span",10),a.qZA(),a.qZA()}if(2&G){const V=a.oxw();a.xp6(1),a.Q6J("title",V.deleteIconTitle)}}class S extends r.N{constructor(Q,V,K,q,se,te){super(),this.I18n=Q,this.pathHelper=V,this.timezoneService=K,this.confirmDialogService=q,this.principalsResourceService=se,this.principalRendererService=te,this.removeAttachment=new a.vpe,this.text={dragHint:this.I18n.t("js.attachments.draggable_hint"),deleteTitle:this.I18n.t("js.attachments.delete"),deleteConfirmation:this.I18n.t("js.attachments.delete_confirmation"),removeFile:ie=>this.I18n.t("js.label_remove_file",ie)},this.viewInitialized$=new v.X(!1)}get deleteIconTitle(){return this.text.removeFile({fileName:this.attachment.fileName})}ngOnInit(){this.fileIcon=(0,b.g)(this.attachment.contentType);const Q=(0,y.Z)(this.attachment._links.author.href);this.principalsResourceService.exists(Q)||this.principalsResourceService.fetchUser(Q).subscribe(),this.timestampText=this.timezoneService.parseDatetime(this.attachment.createdAt).fromNow(),this.author$=this.principalsResourceService.lookup(Q).pipe((0,p.P)()),(0,c.aj)([this.author$,this.viewInitialized$.pipe((0,f.x)())]).pipe(this.untilDestroyed()).subscribe(([V,K])=>{!K||this.principalRendererService.render(this.avatar.nativeElement,V,{hide:!0,link:!1},{hide:!1,size:"mini"})})}ngAfterViewInit(){this.viewInitialized$.next(!0)}setDragData(Q){const V=this.downloadPath,K=this.draggableHTML(V);null!=Q.dataTransfer&&(Q.dataTransfer.setData("text/plain",V),Q.dataTransfer.setData("text/html",K.outerHTML),Q.dataTransfer.setData("text/uri-list",V),Q.dataTransfer.setDragImage(K,0,0))}draggableHTML(Q){let V;return this.isImage?(V=document.createElement("img"),V.src=Q,V.textContent=this.attachment.fileName):(V=document.createElement("a"),V.href=Q,V.textContent=this.attachment.fileName),V}get downloadPath(){return this.pathHelper.attachmentDownloadPath(String(this.attachment.id),this.attachment.fileName)}get isImage(){const Q=this.attachment.fileName.split(".").pop()||"";return S.imageFileExtensions.indexOf(Q.toLowerCase())>-1}confirmRemoveAttachment(){const Q={text:{text:this.text.deleteConfirmation,title:this.text.deleteTitle,button_continue:this.text.deleteTitle},icon:{continue:"delete"},dangerHighlighting:!0};this.confirmDialogService.confirm(Q).then(()=>{this.removeAttachment.emit()}).catch(()=>{})}}function R(G,Q){if(1&G){const V=a.EpF();a.TgZ(0,"li",4),a.NdJ("removeAttachment",function(){const se=a.CHM(V).$implicit;return a.oxw(3).removeAttachment(se)}),a.qZA()}if(2&G){const V=Q.$implicit,K=Q.index;a.Q6J("attachment",V)("index",K)}}function F(G,Q){if(1&G&&(a.TgZ(0,"ul",2),a.YNc(1,R,1,2,"li",3),a.qZA()),2&G){const V=a.oxw().ngIf;a.xp6(1),a.Q6J("ngForOf",V)}}function L(G,Q){if(1&G&&(a.TgZ(0,"div"),a.YNc(1,F,2,1,"ul",1),a.qZA()),2&G){const V=Q.ngIf;a.xp6(1),a.Q6J("ngIf",V.length>0)}}S.imageFileExtensions=["jpeg","jpg","gif","bmp","png"],S.\u0275fac=function(Q){return new(Q||S)(a.Y36(C.D),a.Y36(u.j),a.Y36(h.B),a.Y36(P.D),a.Y36(k.P),a.Y36(O.C))},S.\u0275cmp=a.Xpm({type:S,selectors:[["","op-attachment-list-item",""]],viewQuery:function(Q,V){if(1&Q&&a.Gf(E,5),2&Q){let K;a.iGM(K=a.CRH())&&(V.avatar=K.first)}},inputs:{attachment:"attachment",index:"index"},outputs:{removeAttachment:"removeAttachment"},features:[a.qOj],attrs:["op-attachment-list-item",""],decls:9,vars:11,consts:[[1,"spot-list--item-floating-wrapper","op-files-tab--file-list-item-floating-wrapper"],["target","_blank",1,"spot-list--item-action","spot-list--item-action_link","op-files-tab--file-list-item-action",3,"href","dragstart"],["data-qa-selector","op-files-tab--file-list-item-title",1,"spot-list--item-title","op-files-tab--file-list-item-title",3,"textContent","title"],[1,"op-files-tab--file-list-item-text",3,"textContent"],[1,"op-files-tab--file-list-item-avatar"],["avatar",""],["class","spot-list--item-floating-actions op-files-tab--file-list-item-floating-actions hidden-for-mobile",4,"ngIf"],["type","hidden",3,"name","value"],[1,"spot-list--item-floating-actions","op-files-tab--file-list-item-floating-actions","hidden-for-mobile"],[1,"spot-link",3,"title","click"],[1,"spot-icon","spot-icon_delete"]],template:function(Q,V){1&Q&&(a.TgZ(0,"div",0),a.TgZ(1,"a",1),a.NdJ("dragstart",function(q){return V.setDragData(q)}),a._UZ(2,"span"),a._UZ(3,"span",2),a._UZ(4,"span",3),a._UZ(5,"div",4,5),a.qZA(),a.YNc(7,M,3,1,"div",6),a.qZA(),a._UZ(8,"input",7)),2&Q&&(a.xp6(1),a.Q6J("href",V.attachment._links.staticDownloadLocation.href,a.LSH),a.xp6(1),a.MT6("spot-icon spot-icon_",V.fileIcon.icon," op-files-tab--icon op-files-tab--icon_",V.fileIcon.clazz,""),a.xp6(1),a.Q6J("textContent",V.attachment.fileName)("title",V.attachment.fileName),a.xp6(1),a.Q6J("textContent",V.timestampText),a.xp6(3),a.Q6J("ngIf",!!V.attachment._links.delete),a.xp6(1),a.MGl("name","attachments[",V.index,"][id]"),a.s9C("value",V.attachment.id))},directives:[m.O5],encapsulation:2,changeDetection:0});class D extends r.N{constructor(Q,V){super(),this.timezoneService=Q,this.attachmentsResourceService=V}get attachmentsSelfLink(){return this.resource.attachments.href}get collectionKey(){return(0,l.Z)(this.resource)?"new":this.attachmentsSelfLink}ngOnInit(){(0,l.Z)(this.resource)||this.attachmentsResourceService.requireCollection(this.attachmentsSelfLink);const Q=(V,K)=>{const q=this.timezoneService.parseDatetime(K.createdAt),se=this.timezoneService.parseDatetime(V.createdAt);return q.isBefore(se)?-1:1};this.$attachments=this.attachmentsResourceService.collection(this.collectionKey).pipe(this.untilDestroyed(),(0,i.U)(V=>V.sort(Q)),(0,e.b)(V=>{(0,l.Z)(this.resource)&&(this.resource.attachments={elements:V.map(K=>K._links.self)})}))}removeAttachment(Q){this.attachmentsResourceService.removeAttachment(this.collectionKey,Q).subscribe()}}D.\u0275fac=function(Q){return new(Q||D)(a.Y36(h.B),a.Y36(n.v))},D.\u0275cmp=a.Xpm({type:D,selectors:[["op-attachment-list"]],inputs:{resource:"resource"},features:[a.qOj],decls:2,vars:3,consts:[[4,"ngIf"],["class","spot-list spot-list_compact op-files-tab--file-list",4,"ngIf"],[1,"spot-list","spot-list_compact","op-files-tab--file-list"],["op-attachment-list-item","","class","spot-list--item op-files-tab--file-list-item","data-qa-selector","op-attachment-list-item",3,"attachment","index","removeAttachment",4,"ngFor","ngForOf"],["op-attachment-list-item","","data-qa-selector","op-attachment-list-item",1,"spot-list--item","op-files-tab--file-list-item",3,"attachment","index","removeAttachment"]],template:function(Q,V){1&Q&&(a.YNc(0,L,2,1,"div",0),a.ALo(1,"async")),2&Q&&a.Q6J("ngIf",a.lcZ(1,1,V.resource&&V.$attachments))},directives:[m.O5,m.sg,S],pipes:[m.Ov],encapsulation:2,changeDetection:0})},14274:(X,I,t)=>{"use strict";t.d(I,{s:()=>p});var i=t(96617),e=t(12877),h=(t(80044),t(91923)),r=t(36293),n=t(88826),l=t(2316),a=t(54364),m=t(2775);const v=["hiddenFileInput"];function c(f,C){if(1&f){const u=l.EpF();l.TgZ(0,"div",1),l.NdJ("drop",function(O){return l.CHM(u),l.oxw().onDropFiles(O)})("dragover",function(O){return l.CHM(u),l.oxw().onDragOver(O)})("dragleave",function(O){return l.CHM(u),l.oxw().onDragLeave(O)}),l.TgZ(1,"input",2,3),l.NdJ("change",function(){return l.CHM(u),l.oxw().onFilePickerChanged()}),l.qZA(),l.TgZ(3,"button",4),l.NdJ("click",function(O){return l.CHM(u),l.oxw().triggerFileInput(O)}),l.TgZ(4,"span",5),l._UZ(5,"op-icon",6),l.TgZ(6,"label",7),l._uU(7),l._UZ(8,"br"),l._uU(9),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&f){const u=l.oxw();l.uIk("aria-label",u.text.uploadLabel),l.xp6(3),l.ekj("-dragging",u.draggingOver),l.xp6(4),l.hij(" ",u.text.dropFiles," "),l.xp6(2),l.hij(" ",u.text.dropFilesHint," ")}}class p{constructor(C,u,k,O,y,b){this.I18n=C,this.attachmentsResourceService=u,this.configurationService=k,this.toastService=O,this.elementRef=y,this.halResourceService=b,this.draggingOver=!1,this.text={uploadLabel:this.I18n.t("js.label_add_attachments"),dropFiles:this.I18n.t("js.label_drop_files"),dropFilesHint:this.I18n.t("js.label_drop_files_hint"),foldersWarning:this.I18n.t("js.label_drop_folders_hint")}}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.configurationService.initialized.then(()=>{this.maxFileSize=this.configurationService.maximumAttachmentFileSize})}triggerFileInput(C){return this.filePicker.nativeElement.click(),C.preventDefault(),C.stopPropagation(),!1}onDropFiles(C){if(null===C.dataTransfer)return;C.dataTransfer.dropEffect="copy",C.preventDefault(),C.stopPropagation();const u=C.dataTransfer.files,k=u?u.length:0,O=[];for(let y=0;y<k;y++)O.push(u[y]);this.uploadFiles(O),this.draggingOver=!1}onDragOver(C){null!==C.dataTransfer&&p.containsFiles(C.dataTransfer)&&(C.dataTransfer.dropEffect="copy",this.draggingOver=!0),C.preventDefault(),C.stopPropagation()}onDragLeave(C){this.draggingOver=!1,C.preventDefault(),C.stopPropagation()}onFilePickerChanged(){const C=this.filePicker.nativeElement.files;if(null===C)return;const u=Array.from(C);this.uploadFiles(u)}static containsFiles(C){return C.types.indexOf("Files")>=0}uploadFiles(C){let u=C||[];const k=C.length;u=this.filterFolders(u),0!==u.length?this.attachmentsResourceService.attachFiles(this.resource,u).subscribe():k>0&&this.toastService.addNotice(this.text.foldersWarning)}filterFolders(C){return C.filter(u=>""!==u.type||(0!==u.size&&4096!==u.size||(console.warn(`Skipping file because of file size (${u.size}) %O`,u),!1)))}}p.\u0275fac=function(C){return new(C||p)(l.Y36(i.D),l.Y36(n.v),l.Y36(e.e),l.Y36(r.kl),l.Y36(l.SBq),l.Y36(h.u))},p.\u0275cmp=l.Xpm({type:p,selectors:[["op-attachments-upload"]],viewQuery:function(C,u){if(1&C&&l.Gf(v,5),2&C){let k;l.iGM(k=l.CRH())&&(u.filePicker=k.first)}},inputs:{resource:"resource"},decls:1,vars:1,consts:[["class","wp-attachment-upload hide-when-print op-files-tab--file-upload",3,"drop","dragover","dragleave",4,"ngIf"],[1,"wp-attachment-upload","hide-when-print","op-files-tab--file-upload",3,"drop","dragover","dragleave"],["type","file","id","attachment_files","name","attachment_files","hidden","","multiple","",3,"change"],["hiddenFileInput",""],["type","button",1,"work-package--attachments--drop-box",3,"click"],[1,"work-package--attachments--label"],["icon-classes","icon-attachment"],["for","attachment_files"]],template:function(C,u){1&C&&l.YNc(0,c,10,5,"div",0),2&C&&l.Q6J("ngIf",u.resource.canAddAttachments)},directives:[a.O5,m.o],encapsulation:2,changeDetection:0})},41689:(X,I,t)=>{"use strict";t.d(I,{e:()=>C,t:()=>u});t(80044);var e=t(91923),d=t(96617),h=t(87853),r=t(9170),n=t(26942),l=t(2316),a=t(54364),m=t(74603),v=t(14274);function c(k,O){if(1&k&&l._UZ(0,"op-attachment-list",6),2&k){const y=l.oxw(2);l.Q6J("resource",y.resource)}}function p(k,O){if(1&k&&l._UZ(0,"op-attachments-upload",7),2&k){const y=l.oxw(2);l.Q6J("resource",y.resource)}}function f(k,O){if(1&k&&(l.TgZ(0,"fieldset",1),l.TgZ(1,"legend",2),l._uU(2),l.qZA(),l.TgZ(3,"div",3),l.YNc(4,c,1,1,"op-attachment-list",4),l.YNc(5,p,1,1,"op-attachments-upload",5),l.qZA(),l.qZA()),2&k){const y=l.oxw();l.xp6(2),l.hij(" ",y.text.attachments," "),l.xp6(2),l.Q6J("ngIf",y.resource.attachments),l.xp6(1),l.Q6J("ngIf",y.allowUploading)}}const C="attachments";class u extends n.N{constructor(O,y,b,P){super(),this.elementRef=O,this.I18n=y,this.states=b,this.halResourceService=P,this.text={attachments:this.I18n.t("js.label_attachments")}}ngOnInit(){if(this.$element=jQuery(this.elementRef.nativeElement),!this.resource){const O=this.$element.data("resource");this.resource=this.halResourceService.createHalResource(O,!0)}this.allowUploading=this.$element.data("allow-uploading"),void 0!==this.$element.data("destroy-immediately")?this.destroyImmediately=this.$element.data("destroy-immediately"):this.destroyImmediately=!0,this.setupResourceUpdateListener()}setupResourceUpdateListener(){this.states.forResource(this.resource).changes$().pipe(this.untilDestroyed(),(0,r.h)(O=>!!O)).subscribe(O=>{this.resource=O||this.resource})}showAttachments(){return this.allowUploading||_.get(this.resource,"attachments.count",0)>0}}u.\u0275fac=function(O){return new(O||u)(l.Y36(l.SBq),l.Y36(d.D),l.Y36(h.G),l.Y36(e.u))},u.\u0275cmp=l.Xpm({type:u,selectors:[["attachments"]],inputs:{resource:"resource"},features:[l.qOj],decls:1,vars:1,consts:[["class","form--fieldset",4,"ngIf"],[1,"form--fieldset"],[1,"form--fieldset-legend"],["id","attachments_fields"],[3,"resource",4,"ngIf"],["class","hide-when-print",3,"resource",4,"ngIf"],[3,"resource"],[1,"hide-when-print",3,"resource"]],template:function(O,y){1&O&&l.YNc(0,f,6,3,"fieldset",0),2&O&&l.Q6J("ngIf",y.showAttachments())},directives:[a.O5,m.c,v.s],encapsulation:2})},31283:(X,I,t)=>{"use strict";t.d(I,{Z:()=>h});var i=t(54364),e=t(53875),d=t(2316);class h{}h.\u0275fac=function(n){return new(n||h)},h.\u0275mod=d.oAB({type:h}),h.\u0275inj=d.cJS({imports:[[i.ez,e.Q]]})},83845:(X,I,t)=>{"use strict";t.d(I,{y:()=>y,w:()=>O});var i=t(96617),e=t(77355),d=t(45410),h=t(14808),r=t(61908),n=t(53466),l=t(2316);class a{constructor(P){this.apiV3Service=P,this.helpTexts=(0,h.qH)()}require(P,E){return this.load(),new Promise((T,M)=>{this.helpTexts.valuesPromise().then(()=>T(this.find(P,E)))})}requireById(P){return this.load(),this.helpTexts.values$().pipe((0,n.q)(1)).toPromise().then(()=>{const E=this.helpTexts.getValueOr([]);return _.find(E,T=>{var M;return(null===(M=T.id)||void 0===M?void 0:M.toString())===P.toString()})})}load(){this.helpTexts.putFromPromiseIfPristine(()=>this.apiV3Service.help_texts.get().toPromise().then(P=>P.elements))}find(P,E){const T=this.helpTexts.getValueOr([]);return _.find(T,M=>M.scope===E&&M.attribute===P)}}a.\u0275fac=function(P){return new(P||a)(l.LFG(r.T))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"});var m=t(60312),v=t(41689),c=t(54364),p=t(2775);function f(b,P){if(1&b&&(l.TgZ(0,"a",11),l._UZ(1,"op-icon",12),l._UZ(2,"span",13),l.qZA()),2&b){const E=l.oxw();l.uIk("href",E.helpTextLink,l.LSH)("title",E.text.edit),l.xp6(2),l.Q6J("textContent",E.text.edit)}}class C extends m.T{constructor(P,E,T,M){super(P,T,M),this.locals=P,this.I18n=E,this.cdRef=T,this.elementRef=M,this.closeOnEscape=!0,this.closeOnOutsideClick=!1,this.text={edit:this.I18n.t("js.button_edit"),close:this.I18n.t("js.button_close")},this.helpText=this.locals.helpText}ngOnInit(){super.ngOnInit(),this.helpText.attachments.$load().then(()=>this.cdRef.detectChanges())}get helpTextLink(){return this.helpText.editText?this.helpText.editText.$link.href:""}}function u(b,P){if(1&b&&l._UZ(0,"span",4),2&b){const E=l.oxw(2);l.Q6J("textContent",E.additionalLabel)}}function k(b,P){if(1&b){const E=l.EpF();l.TgZ(0,"div",1),l.NdJ("click",function(M){return l.CHM(E),l.oxw().handleClick(M)})("keydown.enter",function(M){return l.CHM(E),l.oxw().handleClick(M)})("keydown.space",function(M){return l.CHM(E),l.oxw().handleClick(M)}),l.YNc(1,u,1,1,"span",2),l._UZ(2,"op-icon",3),l.qZA()}if(2&b){const E=l.oxw();l.Q6J("title",E.text.open_dialog),l.uIk("data-qa-help-text-for",E.attribute),l.xp6(1),l.Q6J("ngIf",E.additionalLabel)}}C.\u0275fac=function(P){return new(P||C)(l.Y36(e.E),l.Y36(i.D),l.Y36(l.sBO),l.Y36(l.SBq))},C.\u0275cmp=l.Xpm({type:C,selectors:[["ng-component"]],features:[l.qOj],decls:12,vars:5,consts:[["data-indicator-name","modal",1,"spot-modal","attribute-help-text--modal","loading-indicator--location"],["data-qa-selector","attribute-help-text--header",1,"spot-modal--header"],[1,"spot-icon","spot-icon_help1"],[1,"attribute-help-text--header-text",3,"textContent"],[1,"spot-modal--body","spot-container"],[1,"op-uc-container","op-uc-container__no-permalinks",3,"innerHtml"],["data-allow-uploading","false",3,"resource"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],["class","help-text--edit-button button button_no-margin spot-action-bar--action",4,"ngIf"],[1,"help-text--edit-button","button","button_no-margin","spot-action-bar--action"],["icon-classes","button--icon icon-edit"],[1,"button--text",3,"textContent"]],template:function(P,E){1&P&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l._UZ(2,"span",2),l._UZ(3,"span",3),l.qZA(),l.TgZ(4,"div",4),l._UZ(5,"div",5),l._UZ(6,"attachments",6),l.qZA(),l.TgZ(7,"div",7),l.TgZ(8,"div",8),l.TgZ(9,"button",9),l.NdJ("click",function(){return E.closeMe()}),l._uU(10),l.qZA(),l.YNc(11,f,3,3,"a",10),l.qZA(),l.qZA(),l.qZA()),2&P&&(l.xp6(3),l.Q6J("textContent",E.helpText.attributeCaption),l.xp6(2),l.Q6J("innerHtml",E.helpText.helpText.html,l.oJD),l.xp6(1),l.Q6J("resource",E.helpText),l.xp6(4),l.hij(" ",E.text.close," "),l.xp6(1),l.Q6J("ngIf",E.helpText.editText))},directives:[v.t,c.O5,p.o],encapsulation:2,changeDetection:0});const O="attribute-help-text";class y{constructor(P,E,T,M,S,R){this.elementRef=P,this.attributeHelpTexts=E,this.opModalService=T,this.cdRef=M,this.injector=S,this.I18n=R,this.exists=!1,this.text={open_dialog:this.I18n.t("js.help_texts.show_modal"),edit:this.I18n.t("js.button_edit"),close:this.I18n.t("js.button_close")},(0,d.E)(this)}ngOnInit(){this.helpTextId?this.exists=!0:this.load().then(P=>(this.exists=!!P,this.cdRef.detectChanges(),P))}handleClick(P){this.load().then(E=>{this.opModalService.show(C,this.injector,{helpText:E})}),P.preventDefault()}load(){return this.helpTextId?this.attributeHelpTexts.requireById(this.helpTextId):this.attributeHelpTexts.require(this.attribute,this.attributeScope)}}y.\u0275fac=function(P){return new(P||y)(l.Y36(l.SBq),l.Y36(a),l.Y36(e.S),l.Y36(l.sBO),l.Y36(l.zs3),l.Y36(i.D))},y.\u0275cmp=l.Xpm({type:y,selectors:[["attribute-help-text"]],inputs:{attribute:"attribute",additionalLabel:"additionalLabel",attributeScope:"attributeScope",helpTextId:"helpTextId"},decls:1,vars:1,consts:[["class","spot-link help-text--entry","role","button","tabindex","0",3,"title","click","keydown.enter","keydown.space",4,"ngIf"],["role","button","tabindex","0",1,"spot-link","help-text--entry",3,"title","click","keydown.enter","keydown.space"],[3,"textContent",4,"ngIf"],["icon-classes","icon3 icon-help1"],[3,"textContent"]],template:function(P,E){1&P&&l.YNc(0,k,3,3,"div",0),2&P&&l.Q6J("ngIf",E.exists)},directives:[c.O5,p.o],encapsulation:2,changeDetection:0})},71858:(X,I,t)=>{"use strict";t.d(I,{a:()=>n});var i=t(54364),e=t(55811),d=t(31283),h=t(53875),r=t(2316);class n{}n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({providers:[],imports:[[i.ez,e.K,d.Z,h.Q]]})},7301:(X,I,t)=>{"use strict";t.d(I,{$:()=>v,r:()=>c});var i=t(36868),e=t(96617),d=t(2316),h=t(54364),r=t(5443),n=t(1707);function l(p,f){if(1&p){const C=d.EpF();d.TgZ(0,"op-project-autocompleter",2),d.NdJ("valueChange",function(k){return d.CHM(C),d.oxw().updateProjectSelection(k)}),d.qZA()}if(2&p){const C=d.oxw();d.Q6J("value",C.currentProjectSelection)("multiple",C.multiselect)("labelForId",C.labelForId)}}function a(p,f){if(1&p&&d._uU(0),2&p){const C=f.item;d.hij(" ",C.label," ")}}function m(p,f){if(1&p){const C=d.EpF();d.TgZ(0,"ng-select",3),d.NdJ("ngModelChange",function(k){return d.CHM(C),d.oxw().updateSelection(k)}),d.YNc(1,a,1,1,"ng-template",4),d.qZA()}if(2&p){const C=d.oxw();d.Q6J("items",C.options)("labelForId",C.labelForId)("multiple",C.multiselect)("virtualScroll",!0)("ngModel",C.selected)("placeholder",C.text.placeholder)}}const v="autocomplete-select-decoration";class c{constructor(f,C){this.elementRef=f,this.I18n=C,this.multiselect=!1,this.text={placeholder:this.I18n.t("js.placeholders.selection")}}ngOnInit(){const f=this.elementRef.nativeElement;this.multiselect="true"===f.dataset.multiselect,this.labelForId=f.dataset.inputId,this.key=f.dataset.key,this.syncInputFieldName=f.dataset.inputName,this.multiselect&&(this.syncInputFieldName+="[]");const C=JSON.parse(f.dataset.options);this.setInitialSelection(C),this.isProjectField()&&this.setInitialProjectSelection(),this.multiselect||(this.selected=this.selected[0]),this.options=C,f.parentElement.hidden=!1}setInitialSelection(f){this.updateSelection(f.filter(C=>C.selected))}updateSelection(f){this.selected=f,f=_.castArray(f),this.removeCurrentSyncedFields(),f.forEach(C=>{this.createSyncedField(C.value)})}createSyncedField(f){jQuery(this.elementRef.nativeElement).parent().append(`<input type="hidden" name="${this.syncInputFieldName||""}" value="${f}" />`)}removeCurrentSyncedFields(){jQuery(this.elementRef.nativeElement).parent().find(`input[name="${this.syncInputFieldName}"]`).remove()}updateProjectSelection(f){const C=(f=_.castArray(f)).map(u=>({label:u.name,value:u.id.toString(),selected:!0}));this.updateSelection(C)}setInitialProjectSelection(){const f=_.castArray(this.selected);0!==f.length&&(this.multiselect?this.currentProjectSelection=f.map(C=>({id:C.value,name:C.label})):this.currentProjectSelection={id:f[0].value,name:f[0].label})}isProjectField(){return"project"===this.key}}c.\u0275fac=function(f){return new(f||c)(d.Y36(d.SBq),d.Y36(e.D))},c.\u0275cmp=d.Xpm({type:c,selectors:[["autocomplete-select-decoration"]],viewQuery:function(f,C){if(1&f&&d.Gf(i.w9,5),2&f){let u;d.iGM(u=d.CRH())&&(C.ngSelectComponent=u.first)}},decls:2,vars:2,consts:[["appendTo","body",3,"value","multiple","labelForId","valueChange",4,"ngIf"],["bindLabel","label","appendTo","body",3,"items","labelForId","multiple","virtualScroll","ngModel","placeholder","ngModelChange",4,"ngIf"],["appendTo","body",3,"value","multiple","labelForId","valueChange"],["bindLabel","label","appendTo","body",3,"items","labelForId","multiple","virtualScroll","ngModel","placeholder","ngModelChange"],["ng-option-tmp",""]],template:function(f,C){1&f&&(d.YNc(0,l,1,3,"op-project-autocompleter",0),d.YNc(1,m,2,6,"ng-select",1)),2&f&&(d.Q6J("ngIf",C.isProjectField()),d.xp6(1),d.Q6J("ngIf",!C.isProjectField()))},directives:[h.O5,r.F,i.w9,n.JJ,n.On,i.Z2],encapsulation:2})},44265:(X,I,t)=>{"use strict";t.d(I,{q:()=>e});var i=t(2316);class e{}e.\u0275fac=function(h){return new(h||e)},e.\u0275dir=i.lG2({type:e,selectors:[["","op-autocompleter-footer-tmp",""]]})},66220:(X,I,t)=>{"use strict";t.d(I,{c:()=>u});var i=t(3786),e=t(2316),d=t(36868),h=t(96617),r=t(65146),n=t(70233),a=(t(80044),t(26942)),m=t(29161),v=t(43682),c=t(1707),p=t(54364);function f(k,O){if(1&k&&(e._UZ(0,"b",4),e._uU(1)),2&k){const y=O.searchTerm,b=e.oxw();e.Q6J("textContent",b.text.add_new_action),e.xp6(1),e.hij(": ",y," ")}}function C(k,O){if(1&k&&e._UZ(0,"span",5),2&k){const y=O.item,b=O.searchTerm;e.Q6J("ngOptionHighlight",b)("textContent",y.name)}}class u extends a.N{constructor(O){super(),this.injector=O,this.required=!1,this.disabled=!1,this.finishedLoading=!1,this.id="",this.classes="",this.hideSelected=!1,this.onChange=new e.vpe,this.onKeydown=new e.vpe,this.onOpen=new e.vpe,this.onClose=new e.vpe,this.onAfterViewInit=new e.vpe,this.onAddNew=new e.vpe,this.compareByHref=v.U5,this.text={},this.createAllowed=!1,this._openDirectly=!1,this.text.add_new_action=this.I18n.t("js.label_create")}ngAfterViewInit(){this.onAfterViewInit.emit(this)}openSelect(){this.ngSelectComponent&&(this.ngSelectComponent.open(),this.openDirectly=!1)}closeSelect(){this.ngSelectComponent&&this.ngSelectComponent.close()}changeModel(O){this.onChange.emit(O)}opened(){setTimeout(()=>{const O=this.ngSelectComponent;this.appendTo&&O&&O.dropdownPanel&&O.dropdownPanel._updatePosition()},25),this.onOpen.emit()}closed(){this.openDirectly=!1,this.onClose.emit()}keyPressed(O){this.onKeydown.emit(O)}get openDirectly(){return this._openDirectly}set openDirectly(O){this._openDirectly=O,O&&this.openSelect()}focusInputField(){this.ngSelectComponent&&this.ngSelectComponent.focus()}}u.\u0275fac=function(O){return new(O||u)(e.Y36(e.zs3))},u.\u0275cmp=e.Xpm({type:u,selectors:[["create-autocompleter"]],viewQuery:function(O,y){if(1&O&&e.Gf(d.w9,5),2&O){let b;e.iGM(b=e.CRH())&&(y.ngSelectComponent=b.first)}},inputs:{availableValues:"availableValues",appendTo:"appendTo",resource:"resource",model:"model",required:"required",disabled:"disabled",finishedLoading:"finishedLoading",id:"id",classes:"classes",typeahead:"typeahead",hideSelected:"hideSelected"},outputs:{onChange:"onChange",onKeydown:"onKeydown",onOpen:"onOpen",onClose:"onClose",onAfterViewInit:"onAfterViewInit",onAddNew:"onAddNew"},features:[e.qOj],decls:4,vars:15,consts:[["bindLabel","name",3,"ngModel","items","ngClass","addTag","virtualScroll","required","clearable","disabled","typeahead","clearOnBackspace","clearSearchOnAdd","appendTo","hideSelected","compareWith","id","ngModelChange","change","open","close","keydown"],["ngSelectComponent",""],["ng-tag-tmp",""],["ng-option-tmp",""],[3,"textContent"],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight","textContent"]],template:function(O,y){1&O&&(e.TgZ(0,"ng-select",0,1),e.NdJ("ngModelChange",function(P){return y.model=P})("change",function(P){return y.changeModel(P)})("open",function(){return y.opened()})("close",function(){return y.closed()})("keydown",function(P){return y.keyPressed(P)}),e.YNc(2,f,2,2,"ng-template",2),e.YNc(3,C,1,2,"ng-template",3),e.qZA()),2&O&&e.Q6J("ngModel",y.model)("items",y.availableValues)("ngClass",y.classes)("addTag",y.createAllowed)("virtualScroll",!0)("required",y.required)("clearable",!y.required)("disabled",y.disabled)("typeahead",y.typeahead)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("appendTo",y.appendTo)("hideSelected",y.hideSelected)("compareWith",y.compareByHref)("id",y.id)},directives:[d.w9,c.JJ,c.On,p.mk,c.Q7,d.N6,d.Z2],styles:[".button.-tiny[_ngcontent-%COMP%]{margin:0}"]}),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",h.D)],u.prototype,"I18n",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",e.sBO)],u.prototype,"cdRef",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",r.R)],u.prototype,"currentProject",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",n.j)],u.prototype,"pathHelper",void 0)},29212:(X,I,t)=>{"use strict";t.d(I,{i:()=>p});var i=t(2316),e=t(96617),d=t(35900),h=t(26942),r=t(89919),n=t(87873),l=t(82503),a=t(54364),m=t(36868);const v=["ngSelectComponent"];function c(f,C){if(1&f){const u=i.EpF();i.TgZ(0,"div",5),i._UZ(1,"span",6),i.TgZ(2,"a",7),i.NdJ("click",function(){const y=i.CHM(u).$implicit;return i.oxw().remove(y)}),i.qZA(),i.qZA()}if(2&f){const u=C.$implicit;i.xp6(1),i.Q6J("textContent",u.name)}}class p extends h.N{constructor(C,u){super(),this.I18n=C,this.dragula=u,this.autofocus=!0,this._selected=[],this.onChange=new i.vpe,this.availableOptions=[],this.text={placeholder:this.I18n.t("js.label_add_columns")}}ngOnInit(){this.updateAvailableOptions(),this.columnsGroup=this.dragula.createGroup("columns",{}),this.dragula.drag("columns").pipe(this.untilDestroyed()).subscribe(()=>(0,n.h)("move","important")),(0,r.T)(this.dragula.drop("columns"),this.dragula.cancel("columns")).pipe(this.untilDestroyed()).subscribe(()=>(0,n.h)("auto"));const C=this;this.autoscroll=new d.x([document.getElementById("content-wrapper")],{margin:25,maxSpeed:10,scrollWhenOutside:!0,autoScroll(){return this.down&&C.columnsGroup.drake.dragging}})}ngAfterViewInit(){this.autofocus&&this.ngSelectComponent.focus()}ngOnDestroy(){super.ngOnDestroy(),this.dragula.destroy("columns")}select(C){!C||(this.selected=[...this.selected,C],this.ngSelectComponent.clearModel())}remove(C){this.selected=this.selected.filter(u=>u.id!==C.id)}get selected(){return this._selected}set selected(C){this._selected=C,this.updateAvailableOptions(),this.onChange.emit(this.selected)}opened(){setTimeout(()=>{const C=this.ngSelectComponent;C&&C.dropdownPanel&&C.dropdownPanel._updatePosition()},25)}updateAvailableOptions(){this.availableOptions=this.options.filter(C=>!this.selected.find(u=>u.id===C.id))}}p.\u0275fac=function(C){return new(C||p)(i.Y36(e.D),i.Y36(l.pQ))},p.\u0275cmp=i.Xpm({type:p,selectors:[["draggable-autocompleter"]],viewQuery:function(C,u){if(1&C&&i.Gf(v,5),2&C){let k;i.iGM(k=i.CRH())&&(u.ngSelectComponent=k.first)}},inputs:{options:"options",autofocus:"autofocus",_selected:["selected","_selected"]},outputs:{onChange:"onChange"},features:[i.qOj],decls:5,vars:8,consts:[[1,"op-draggable-autocomplete"],["dragula","columns",1,"op-draggable-autocomplete--selected",3,"dragulaModel","dragulaModelChange"],["class","op-draggable-autocomplete--item",4,"ngFor","ngForOf"],["ngClass","op-draggable-autocomplete--input","bindLabel","name","appendTo","body",3,"items","multiple","virtualScroll","placeholder","clearSearchOnAdd","closeOnSelect","open","change"],["ngSelectComponent",""],[1,"op-draggable-autocomplete--item"],[1,"op-draggable-autocomplete--item-text",3,"textContent"],[1,"op-draggable-autocomplete--remove-item","icon-remove",3,"click"]],template:function(C,u){1&C&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.NdJ("dragulaModelChange",function(O){return u.selected=O}),i.YNc(2,c,3,1,"div",2),i.qZA(),i.TgZ(3,"ng-select",3,4),i.NdJ("open",function(){return u.opened()})("change",function(O){return u.select(O)}),i.qZA(),i.qZA()),2&C&&(i.xp6(1),i.Q6J("dragulaModel",u.selected),i.xp6(1),i.Q6J("ngForOf",u.selected),i.xp6(1),i.Q6J("items",u.availableOptions)("multiple",!1)("virtualScroll",!0)("placeholder",u.text.placeholder)("clearSearchOnAdd",!0)("closeOnSelect",!0))},directives:[l.sW,a.sg,m.w9,a.mk],styles:[".op-draggable-autocomplete--selected[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding-bottom:1rem}.op-draggable-autocomplete--item[_ngcontent-%COMP%]{padding:5px;margin-right:5px;margin-bottom:5px;min-width:50px;border:1px solid #ddd;background:#F8F8F8;cursor:move;font-size:14px;display:flex;align-items:center;justify-content:space-between}.op-draggable-autocomplete--remove-item[_ngcontent-%COMP%]{font-size:8px;color:#999;padding-left:5px}"],changeDetection:0})},17208:(X,I,t)=>{"use strict";t.d(I,{S:()=>e});var i=t(2316);class e{}e.\u0275fac=function(h){return new(h||e)},e.\u0275dir=i.lG2({type:e,selectors:[["","op-autocompleter-header-tmp",""]]})},28830:(X,I,t)=>{"use strict";t.d(I,{v:()=>e});var i=t(2316);class e{}e.\u0275fac=function(h){return new(h||e)},e.\u0275dir=i.lG2({type:e,selectors:[["","op-autocompleter-label-tmp",""]]})},80104:(X,I,t)=>{"use strict";t.d(I,{u:()=>e});var i=t(2316);class e{}e.\u0275fac=function(h){return new(h||e)},e.\u0275dir=i.lG2({type:e,selectors:[["","op-autocompleter-option-tmp",""]]})},91593:(X,I,t)=>{"use strict";t.d(I,{s:()=>Me});var i=t(2316),e=t(76491),d=t(79441),h=t(89919),r=t(81134),n=t(90425),l=t(9170),a=t(83720),m=t(80639),v=t(98636),c=t(79902),p=t(50076),f=t(26942),C=t(96617),u=t(44265),k=t(26269),O=t(33927),y=t(61908);class b extends f.N{constructor(J){super(),this.apiV3Service=J}loadAvailable(J,W,Y,$){const be=this.createFilters(null!=Y?Y:[],J,$);return this.apiV3Service[W].filtered(be).get().pipe((0,O.U)(Ue=>Ue.elements))}createFilters(J,W,Y){const $=new k.qM;for(const be of J)$.add(be.name,be.operator,be.values);return W&&$.add(null!=Y?Y:"","**",[W]),$}loadData(J,W,Y,$){return this.loadAvailable(J,W,Y,$)}}b.\u0275fac=function(J){return new(J||b)(i.LFG(y.T))},b.\u0275prov=i.Yz7({token:b,factory:b.\u0275fac});var P=t(17208),E=t(28830),T=t(80104),M=t(36868),S=t(1707),R=t(54364),F=t(3742);const L=["ngSelectInstance"],D=function(ce,J,W){return{$implicit:ce,search:J,index:W}};function G(ce,J){if(1&ce&&i.GkF(0,9),2&ce){const W=J.item,Y=J.index,$=J.searchTerm,be=i.oxw(2);i.Q6J("ngTemplateOutlet",be.headerTemplate)("ngTemplateOutletContext",i.kEZ(2,D,W,$,Y))}}function Q(ce,J){1&ce&&i.YNc(0,G,1,6,"ng-template",8)}const V=function(ce,J,W,Y){return{$implicit:ce,search:J,index:W,clear:Y}};function K(ce,J){if(1&ce&&i.GkF(0,9),2&ce){const W=J.item,Y=J.index,$=J.searchTerm,be=J.clear,N=i.oxw(2),Ue=i.MAs(12);i.Q6J("ngTemplateOutlet",N.labelTemplate||Ue)("ngTemplateOutletContext",i.l5B(2,V,W,$,Y,be))}}function q(ce,J){1&ce&&i.YNc(0,K,1,7,"ng-template",10)}function se(ce,J){if(1&ce&&i.GkF(0,9),2&ce){const W=J.item,Y=J.index,$=J.searchTerm,be=i.oxw(),N=i.MAs(10);i.Q6J("ngTemplateOutlet",be.optionTemplate||N)("ngTemplateOutletContext",i.kEZ(2,D,W,$,Y))}}function te(ce,J){if(1&ce&&i.GkF(0,9),2&ce){const W=J.item,Y=J.index,$=J.searchTerm,be=i.oxw(2);i.Q6J("ngTemplateOutlet",be.footerTemplate)("ngTemplateOutletContext",i.kEZ(2,D,W,$,Y))}}function ie(ce,J){1&ce&&i.YNc(0,te,1,6,"ng-template",11)}function le(ce,J){if(1&ce&&i._UZ(0,"op-principal",22),2&ce){const W=i.oxw(2).$implicit;i.Q6J("principal",W.author)("hideName",!0)}}function oe(ce,J){if(1&ce&&i._UZ(0,"span",23),2&ce){const W=i.oxw(2).$implicit,Y=i.oxw();i.MGl("textContent","",W.type.name," "),i.Q6J("ngClass",Y.highlighting("type",W.type.id))}}function ne(ce,J){if(1&ce&&(i.ynx(0),i.TgZ(1,"div",13),i.YNc(2,le,1,2,"op-principal",14),i.TgZ(3,"span",15),i.YNc(4,oe,1,2,"span",16),i._UZ(5,"span",17),i.qZA(),i.TgZ(6,"div",18),i._UZ(7,"span",19),i.TgZ(8,"span",20),i._uU(9),i.qZA(),i._UZ(10,"span",21),i.qZA(),i.qZA(),i.BQk()),2&ce){const W=i.oxw(),Y=W.$implicit,$=W.search,be=i.oxw();i.xp6(2),i.Q6J("ngIf",Y.author&&Y.author.href),i.xp6(2),i.Q6J("ngIf",Y.type),i.xp6(1),i.Q6J("ngOptionHighlight",$)("textContent",Y.subject),i.xp6(2),i.Q6J("ngOptionHighlight",$)("textContent",null==Y.project?null:Y.project.name),i.xp6(1),i.Q6J("ngOptionHighlight",$),i.xp6(1),i.hij("#",Y.id,""),i.xp6(1),i.Q6J("textContent",null==Y.status?null:Y.status.name)("ngClass",be.highlighting("status",null==Y.status?null:Y.status.id))}}function fe(ce,J){if(1&ce&&i._UZ(0,"op-principal",27),2&ce){const W=i.oxw(2).$implicit;i.Q6J("principal",W)("hideName",!0)}}function ve(ce,J){if(1&ce&&(i.ynx(0),i.TgZ(1,"div",24),i.YNc(2,fe,1,2,"op-principal",25),i.TgZ(3,"span",26),i._uU(4),i.qZA(),i.qZA(),i.BQk()),2&ce){const W=i.oxw(),Y=W.$implicit,$=W.search;i.xp6(2),i.Q6J("ngIf",Y&&Y.href),i.xp6(1),i.Q6J("ngOptionHighlight",$),i.xp6(1),i.Oqu(Y.name)}}function Se(ce,J){if(1&ce&&(i.ynx(0),i.TgZ(1,"span",28),i._uU(2),i.qZA(),i.BQk()),2&ce){const W=i.oxw(),Y=W.search,$=W.$implicit;i.xp6(1),i.Q6J("ngOptionHighlight",Y),i.xp6(1),i.Oqu($.name)}}function Oe(ce,J){if(1&ce&&(i.YNc(0,ne,11,10,"ng-container",12),i.YNc(1,ve,5,3,"ng-container",12),i.YNc(2,Se,3,2,"ng-container",12)),2&ce){const W=i.oxw();i.Q6J("ngSwitchCase","work_packages"===W.resource||"parent-child"===W.resource),i.xp6(1),i.Q6J("ngSwitchCase","user"===W.resource||"assignee"===W.resource),i.xp6(1),i.Q6J("ngSwitchCase","subproject"===W.resource||"version"===W.resource||"status"===W.resource||"default"===W.resource||!W.resource)}}function je(ce,J){if(1&ce&&(i.TgZ(0,"span",30),i._uU(1),i.qZA()),2&ce){const W=i.oxw(2),Y=W.search,$=W.$implicit;i.Q6J("ngOptionHighlight",Y),i.xp6(1),i.lnq(" ",null==$.type?null:$.type.name," #",$.id," ",$.subject||$.name," ")}}function tt(ce,J){if(1&ce&&(i.ynx(0),i.YNc(1,je,2,4,"span",29),i.BQk()),2&ce){const W=i.oxw().$implicit;i.xp6(1),i.Q6J("ngIf",W.id)}}function He(ce,J){if(1&ce){const W=i.EpF();i.ynx(0),i.TgZ(1,"span",31),i.NdJ("click",function(){i.CHM(W);const $=i.oxw(),be=$.$implicit;return $.clear(be)}),i._uU(2,"\xd7"),i.qZA(),i.TgZ(3,"span",30),i._uU(4),i.qZA(),i.BQk()}if(2&ce){const W=i.oxw(),Y=W.search,$=W.$implicit;i.xp6(3),i.Q6J("ngOptionHighlight",Y),i.xp6(1),i.Oqu($.name)}}function st(ce,J){if(1&ce&&(i.YNc(0,tt,2,1,"ng-container",3),i.YNc(1,He,5,2,"ng-container",3)),2&ce){const W=i.oxw();i.Q6J("ngIf","work_packages"===W.resource),i.xp6(1),i.Q6J("ngIf","work_packages"!==W.resource)}}class Me extends f.N{constructor(J,W,Y,$){super(),this.opAutocompleterService=J,this.cdRef=W,this.ngZone=Y,this.I18n=$,this.className=!0,this.filters=[],this.searchKey="",this.defaultData=!1,this.focusDirectly=!0,this.fetchDataDirectly=!1,this.labelRequired=!0,this.required=!1,this.searchable=!0,this.clearable=!0,this.addTag=!1,this.id="",this.items$=new e.X(null),this.clearSearchOnAdd=!0,this.multiple=!1,this.openDirectly=!1,this.markFirst=!0,this.placeholder=this.I18n.t("js.autocompleter.placeholder"),this.notFoundText=this.I18n.t("js.autocompleter.notFoundText"),this.typeToSearchText=this.I18n.t("js.autocompleter.typeToSearchText"),this.loadingText=this.I18n.t("js.ajax.loading"),this.dropdownPosition="auto",this.closeOnSelect=!0,this.hideSelected=!1,this.selectOnTab=!1,this.openOnEnter=!0,this.bufferAmount=4,this.selectableGroup=!1,this.selectableGroupAsModel=!0,this.trackByFn=null,this.compareWith=(be,N)=>be===N,this.clearOnBackspace=!0,this.labelForId=null,this.inputAttrs={},this.readonly=!1,this.searchWhileComposing=!0,this.minTermLength=0,this.editableSearchTerm=!1,this.keyDownFn=()=>!0,this.typeahead=null,this.open=new i.vpe,this.close=new i.vpe,this.change=new i.vpe,this.focus=new i.vpe,this.blur=new i.vpe,this.search=new i.vpe,this.keydown=new i.vpe,this.clear=new i.vpe,this.add=new i.vpe,this.remove=new i.vpe,this.scroll=new i.vpe,this.scrollToEnd=new i.vpe,this.loading$=new d.xQ}ngOnInit(){(this.getOptionsFn||this.defaultData)&&(this.typeahead=new e.X(""))}ngOnChanges(J){J.items&&this.items$.next(J.items.currentValue)}ngAfterViewInit(){!this.ngSelectInstance||this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{var J;this.results$=(0,h.T)(this.items$,this.autocompleteInputStream()),this.fetchDataDirectly&&(null===(J=this.typeahead)||void 0===J||J.next("")),this.openDirectly?(this.ngSelectInstance.open(),this.ngSelectInstance.focus()):this.focusDirectly&&this.ngSelectInstance.focus()},25)})}repositionDropdown(){this.ngSelectInstance&&setTimeout(()=>{this.cdRef.detectChanges();const J=this.ngSelectInstance;this.appendTo&&J&&J.dropdownPanel&&J.dropdownPanel._updatePosition()},25)}opened(){var J;null===(J=this.typeahead)||void 0===J||J.next(""),this.repositionDropdown(),this.open.emit()}getOptionsItems(J){var W;return(0,r.of)(null===(W=this.items)||void 0===W?void 0:W.filter(Y=>Y.name.includes(J)))}closeSelect(){var J;null===(J=this.ngSelectInstance)||void 0===J||J.close()}openSelect(){var J;null===(J=this.ngSelectInstance)||void 0===J||J.open()}focusSelect(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.ngSelectInstance.focus()},25)})}closed(){this.close.emit()}changed(J){this.change.emit(J)}searched(J){this.search.emit(J)}blured(J){this.blur.emit(J)}focused(J){this.focus.emit(J)}cleared(J){this.clear.emit(J)}keydowned(J){this.keydown.emit(J)}added(J){this.add.emit(J)}removed(J){this.remove.emit(J)}scrolled(J){this.scroll.emit(J)}scrolledToEnd(J){this.scrollToEnd.emit(J)}highlighting(J,W){return p.Z.inlineClass(J,W)}autocompleteInputStream(){return this.typeahead?this.typeahead.pipe((0,l.h)(()=>!(!this.defaultData&&!this.getOptionsFn)),(0,a.x)(),(0,m.b)(250),(0,v.b)(()=>this.loading$.next(!0)),(0,c.w)(J=>this.defaultData?this.opAutocompleterService.loadData(J,this.resource,this.filters,this.searchKey):this.getOptionsFn?this.getOptionsFn(J):n.C),(0,v.b)(()=>this.loading$.next(!1),()=>this.loading$.next(!1))):n.C}}Me.\u0275fac=function(J){return new(J||Me)(i.Y36(b),i.Y36(i.sBO),i.Y36(i.R0b),i.Y36(C.D))},Me.\u0275cmp=i.Xpm({type:Me,selectors:[["op-autocompleter"]],contentQueries:function(J,W,Y){if(1&J&&(i.Suo(Y,T.u,5,i.Rgc),i.Suo(Y,E.v,5,i.Rgc),i.Suo(Y,P.S,5,i.Rgc),i.Suo(Y,u.q,5,i.Rgc)),2&J){let $;i.iGM($=i.CRH())&&(W.optionTemplate=$.first),i.iGM($=i.CRH())&&(W.labelTemplate=$.first),i.iGM($=i.CRH())&&(W.headerTemplate=$.first),i.iGM($=i.CRH())&&(W.footerTemplate=$.first)}},viewQuery:function(J,W){if(1&J&&i.Gf(L,5),2&J){let Y;i.iGM(Y=i.CRH())&&(W.ngSelectInstance=Y.first)}},hostVars:2,hostBindings:function(J,W){2&J&&i.ekj("op-autocompleter",W.className)},inputs:{filters:"filters",resource:"resource",model:"model",searchKey:"searchKey",defaultData:"defaultData",focusDirectly:"focusDirectly",fetchDataDirectly:"fetchDataDirectly",labelRequired:"labelRequired",name:"name",required:"required",disabled:"disabled",searchable:"searchable",clearable:"clearable",addTag:"addTag",id:"id",accesskey:"accesskey",items:"items",clearSearchOnAdd:"clearSearchOnAdd",classes:"classes",multiple:"multiple",openDirectly:"openDirectly",bindLabel:"bindLabel",bindValue:"bindValue",markFirst:"markFirst",placeholder:"placeholder",notFoundText:"notFoundText",typeToSearchText:"typeToSearchText",addTagText:"addTagText",loadingText:"loadingText",clearAllText:"clearAllText",appearance:"appearance",dropdownPosition:"dropdownPosition",appendTo:"appendTo",closeOnSelect:"closeOnSelect",hideSelected:"hideSelected",selectOnTab:"selectOnTab",openOnEnter:"openOnEnter",maxSelectedItems:"maxSelectedItems",groupBy:"groupBy",groupValue:"groupValue",bufferAmount:"bufferAmount",virtualScroll:"virtualScroll",selectableGroup:"selectableGroup",selectableGroupAsModel:"selectableGroupAsModel",searchFn:"searchFn",trackByFn:"trackByFn",compareWith:"compareWith",clearOnBackspace:"clearOnBackspace",labelForId:"labelForId",inputAttrs:"inputAttrs",tabIndex:"tabIndex",readonly:"readonly",searchWhileComposing:"searchWhileComposing",minTermLength:"minTermLength",editableSearchTerm:"editableSearchTerm",keyDownFn:"keyDownFn",typeahead:"typeahead",getOptionsFn:"getOptionsFn"},outputs:{open:"open",close:"close",change:"change",focus:"focus",blur:"blur",search:"search",keydown:"keydown",clear:"clear",add:"add",remove:"remove",scroll:"scroll",scrollToEnd:"scrollToEnd"},features:[i._Bn([b]),i.qOj,i.TTD],decls:13,vars:58,consts:[[1,"inline-label"],[3,"ngModel","items","ngClass","typeahead","clearOnBackspace","clearSearchOnAdd","hideSelected","appendTo","multiple","loading","addTag","virtualScroll","required","clearable","closeOnSelect","openOnEnter","disabled","name","id","bindLabel","bindValue","markFirst","notFoundText","typeToSearchText","addTagText","loadingText","clearAllText","appearance","dropdownPosition","selectOnTab","maxSelectedItems","placeholder","groupBy","groupValue","bufferAmount","selectableGroup","searchable","selectableGroupAsModel","trackByFn","compareWith","searchFn","labelForId","inputAttrs","tabIndex","readonly","searchWhileComposing","minTermLength","editableSearchTerm","keyDownFn","ngModelChange","change","open","close","blur","focus","clear","keydown","search","scroll","scrollToEnd","add","remove"],["ngSelectInstance",""],[4,"ngIf"],["ng-option-tmp",""],[3,"ngSwitch"],["defaultOption",""],["defaultLabel",""],["ng-header-tmp",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["ng-label-tmp",""],["ng-footer-tmp",""],[4,"ngSwitchCase"],[1,"op-autocompleter--option-wrapper"],["class","op-autocompleter--option-principal",3,"principal","hideName",4,"ngIf"],["data-qa-selector","op-autocompleter-item-subject",1,"op-autocompleter--wp-subject"],[3,"ngClass","textContent",4,"ngIf"],[3,"ngOptionHighlight","textContent"],[1,"op-autocompleter--wp-content"],[1,"op-autocompleter--wp-project",3,"ngOptionHighlight","textContent"],[1,"op-autocompleter--wp-id",3,"ngOptionHighlight"],[1,"op-autocompleter--wp-status",3,"textContent","ngClass"],[1,"op-autocompleter--option-principal",3,"principal","hideName"],[3,"ngClass","textContent"],[1,"op-autocompleter--option-principal-wrapper"],["class","op-autocompleter--option-principal-avatar","size","mini",3,"principal","hideName",4,"ngIf"],[1,"ellipsis",3,"ngOptionHighlight"],["size","mini",1,"op-autocompleter--option-principal-avatar",3,"principal","hideName"],[3,"ngOptionHighlight"],["class","ng-value-label",3,"ngOptionHighlight",4,"ngIf"],[1,"ng-value-label",3,"ngOptionHighlight"],[1,"ng-value-icon","left",3,"click"]],template:function(J,W){1&J&&(i.TgZ(0,"div",0),i.TgZ(1,"ng-select",1,2),i.NdJ("ngModelChange",function($){return W.model=$})("change",function($){return W.changed($)})("open",function(){return W.opened()})("close",function(){return W.closed()})("blur",function($){return W.blured($)})("focus",function($){return W.focused($)})("clear",function($){return W.cleared($)})("keydown",function($){return W.keydowned($)})("search",function($){return W.searched($)})("scroll",function($){return W.scrolled($)})("scrollToEnd",function($){return W.scrolledToEnd($)})("add",function($){return W.added($)})("remove",function($){return W.removed($)}),i.ALo(3,"async"),i.ALo(4,"async"),i.YNc(5,Q,1,0,void 0,3),i.YNc(6,q,1,0,void 0,3),i.YNc(7,se,1,6,"ng-template",4),i.YNc(8,ie,1,0,void 0,3),i.qZA(),i.qZA(),i.YNc(9,Oe,3,3,"ng-template",5,6,i.W1O),i.YNc(11,st,2,2,"ng-template",null,7,i.W1O)),2&J&&(i.xp6(1),i.Q6J("ngModel",W.model)("items",i.lcZ(3,54,W.results$))("ngClass",W.classes)("typeahead",W.typeahead)("clearOnBackspace",W.clearOnBackspace)("clearSearchOnAdd",W.clearSearchOnAdd)("hideSelected",W.hideSelected)("appendTo",W.appendTo)("multiple",W.multiple)("loading",i.lcZ(4,56,W.loading$))("addTag",W.addTag)("virtualScroll",W.virtualScroll)("required",W.required)("clearable",W.clearable)("closeOnSelect",W.closeOnSelect)("openOnEnter",W.openOnEnter)("disabled",W.disabled)("name",W.name)("id",W.id)("bindLabel",W.bindLabel)("bindValue",W.bindValue)("markFirst",W.markFirst)("notFoundText",W.notFoundText)("typeToSearchText",W.typeToSearchText)("addTagText",W.addTagText)("loadingText",W.loadingText)("clearAllText",W.clearAllText)("appearance",W.appearance)("dropdownPosition",W.dropdownPosition)("selectOnTab",W.selectOnTab)("maxSelectedItems",W.maxSelectedItems)("placeholder",W.placeholder)("groupBy",W.groupBy)("groupValue",W.groupValue)("bufferAmount",W.bufferAmount)("selectableGroup",W.selectableGroup)("searchable",W.searchable)("selectableGroupAsModel",W.selectableGroupAsModel)("trackByFn",W.trackByFn)("compareWith",W.compareWith)("searchFn",W.searchFn)("labelForId",W.labelForId)("inputAttrs",W.inputAttrs)("tabIndex",W.tabIndex)("readonly",W.readonly)("searchWhileComposing",W.searchWhileComposing)("minTermLength",W.minTermLength)("editableSearchTerm",W.editableSearchTerm)("keyDownFn",W.keyDownFn),i.uIk("accesskey",W.accesskey||void 0),i.xp6(4),i.Q6J("ngIf",W.headerTemplate),i.xp6(1),i.Q6J("ngIf",W.labelRequired),i.xp6(2),i.Q6J("ngIf",W.footerTemplate),i.xp6(1),i.Q6J("ngSwitch",!0))},directives:[M.w9,S.JJ,S.On,R.mk,S.Q7,R.O5,M.Z2,R.RF,M.A3,R.tP,M.bb,M.x0,R.n9,F.N],pipes:[R.Ov],styles:['.op-autocompleter--option-wrapper[_ngcontent-%COMP%]{padding:5px;line-height:15px;min-height:25px;word-break:break-word;display:grid;grid-template-columns:auto 1fr;grid-template-rows:1fr 1fr}.op-autocompleter--option-principal[_ngcontent-%COMP%]{margin-right:5px;float:left;grid-column-start:1;grid-column-end:2;grid-row-start:1;grid-row-end:3}.op-autocompleter--wp-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto;grid-template-areas:"project idlink status";font-size:.8rem;padding:1px 0 5px}.op-autocompleter--wp-project[_ngcontent-%COMP%]{grid-area:project;display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.op-autocompleter--wp-id[_ngcontent-%COMP%]{grid-area:idlink;place-self:right;font-style:italic;margin:0 .5rem;text-align:center}.op-autocompleter--wp-status[_ngcontent-%COMP%]{grid-area:status;overflow:hidden;font-style:italic}.op-autocompleter--wp-subject[_ngcontent-%COMP%]{font-weight:bold;display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.op-autocompleter--option-principal-wrapper[_ngcontent-%COMP%]{display:flex;overflow:hidden}'],changeDetection:0})},74990:(X,I,t)=>{"use strict";t.d(I,{C:()=>R});var i=t(36868),e=t(1707),d=t(32853),h=t(54364),r=t(82503),n=t(6894),l=t(32824),a=t(29212),m=t(87064),v=t(61598),c=t(50166),p=t(7301),f=t(54622),C=t(90127),u=t(5443),k=t(91593),O=t(80104),y=t(28830),b=t(17208),P=t(66220),E=t(44265),T=t(93713),M=t(2316);const S=[P.c,f.y,v.e,c.R,a.i,C.U,u.F,m.O,p.r,k.s,O.u,y.v,b.S,E.q,T.U];class R{}R.\u0275fac=function(L){return new(L||R)},R.\u0275mod=M.oAB({type:R}),R.\u0275inj=M.cJS({imports:[[h.ez,i.A0,r.qE,e.u5,e.UX,d.wA.withComponents(S),l.j,n.Y]]})},5443:(X,I,t)=>{"use strict";t.d(I,{F:()=>G,B:()=>D});var i=t(2316),e=t(1707),d=t(33927),h=t(91923),r=t(70233),n=t(96617),l=t(67727),a=t(61908),m=t(73726),v=t(45410);const c=(Q,V=0)=>Q.reduce((K,q)=>[...K,Object.assign(Object.assign({},q),{numberOfAncestors:V,ancestors:[]}),...c(q.children,V+1)],[]);var p=t(23237),f=t(10190);const C=(Q,V,K)=>{if(!K.length)return[...Q,Object.assign(Object.assign({},V),{children:[]})];const q=K[0],se=Q.find(te=>te.href===q.href);return se?Q.map(te=>te===se?Object.assign(Object.assign({},te),{children:C(te.children,V,K.slice(1))}):Object.assign({},te)):[...Q,{id:(0,f.Z)(q.href),name:q.title,href:q.href,disabled:!0,children:C([],V,K.slice(1))}]},k=Q=>Q.map(V=>Object.assign(Object.assign({},V),{children:k(V.children)})).sort((V,K)=>V.name.localeCompare(K.name));var O=t(53882),y=t(91593),b=t(36868),P=t(80104),E=t(54364),T=t(93713);const M=["hiddenInput"];function S(Q,V){if(1&Q&&(i.TgZ(0,"span",5),i._uU(1),i.qZA()),2&Q){const K=V.$implicit;i.xp6(1),i.Oqu(K.name)}}const R=function(Q){return{"padding-left.px":Q}};function F(Q,V){if(1&Q&&(i.TgZ(0,"div",8),i._uU(1),i.qZA()),2&Q){const K=i.oxw().$implicit;i.Q6J("title",K.disabledReason)("ngStyle",i.VKq(3,R,16*K.numberOfAncestors)),i.xp6(1),i.Oqu(K.disabledReason)}}function L(Q,V){if(1&Q&&(i.TgZ(0,"div",6),i._uU(1),i.qZA(),i.YNc(2,F,2,5,"div",7)),2&Q){const K=V.$implicit,q=V.search;i.Q6J("title",K.name)("ngStyle",i.VKq(5,R,16*K.numberOfAncestors))("opSearchHighlight",q),i.xp6(1),i.Oqu(K.name),i.xp6(1),i.Q6J("ngIf",K.disabled&&K.disabledReason)}}const D="op-project-autocompleter";class G{constructor(V,K,q,se,te,ie,le,oe){this.elementRef=V,this.halResourceService=K,this.I18n=q,this.halNotification=se,this.http=te,this.pathHelper=ie,this.apiV3Service=le,this.injector=oe,this.className=!0,this.projectTracker=ne=>ne.href||ne.id,this.url=this.apiV3Service.projects.path,this.name="",this.focusDirectly=!1,this.openDirectly=!1,this.multiple=!1,this.dropdownPosition="auto",this.labelForId="",this.apiFilters=[],this.appendTo="",this.isInlineContext=!1,this.mapResultsFn=ne=>ne,this._value=null,this.valueChange=new i.vpe,this.cancel=new i.vpe,this.onChange=ne=>{},this.onTouched=ne=>{},(0,v.E)(this)}get inlineClass(){return this.isInlineContext}get value(){return this._value}set value(V){this._value=V,this.onChange(V),this.valueChange.emit(V),this.onTouched(V),setTimeout(()=>{var K;null===(K=this.hiddenInput.nativeElement)||void 0===K||K.dispatchEvent(new Event("change"))},100)}get plainValue(){var V,K;return(Array.isArray(this.value)?null===(V=this.value)||void 0===V?void 0:V.map(q=>q.id):null===(K=this.value)||void 0===K?void 0:K.id)||""}getAvailableProjects(V){return(0,p.rP)(K=>{const q=[...this.apiFilters];V.length&&q.push(["typeahead","**",[V]]);const se=new URL(this.url,window.location.origin),te=Object.assign({filters:q,select:["elements/id","elements/name","elements/identifier","elements/self","elements/ancestors","total","count","pageSize"]},K),ie=`${(0,m.g)(te)}&${se.searchParams.toString()}`;return se.search="",this.http.get(se.toString()+ie)}).pipe((0,d.U)(K=>K.map(q=>({id:q.id,href:q._links.self.href,name:q.name,disabled:!1,ancestors:q._links.ancestors,children:[]}))),(0,d.U)(this.mapResultsFn),(0,d.U)(K=>K.sort((q,se)=>q.ancestors.length-se.ancestors.length)),(0,d.U)(K=>K.reduce((V,K)=>C(V,K,K.ancestors),[])),(0,d.U)(K=>k(K)),(0,d.U)(K=>c(K)))}writeValue(V){this.value=V}registerOnChange(V){this.onChange=V}registerOnTouched(V){this.onTouched=V}}G.\u0275fac=function(V){return new(V||G)(i.Y36(i.SBq),i.Y36(h.u),i.Y36(n.D),i.Y36(l.W),i.Y36(O.eN),i.Y36(r.j),i.Y36(a.T),i.Y36(i.zs3))},G.\u0275cmp=i.Xpm({type:G,selectors:[["op-project-autocompleter"]],viewQuery:function(V,K){if(1&V&&i.Gf(M,5),2&V){let q;i.iGM(q=i.CRH())&&(K.hiddenInput=q.first)}},hostVars:4,hostBindings:function(V,K){2&V&&i.ekj("op-project-autocompleter",K.className)("op-project-autocompleter_inline",K.inlineClass)},inputs:{url:"url",name:"name",focusDirectly:"focusDirectly",openDirectly:"openDirectly",multiple:"multiple",dropdownPosition:"dropdownPosition",labelForId:"labelForId",apiFilters:"apiFilters",appendTo:"appendTo",isInlineContext:"isInlineContext",mapResultsFn:"mapResultsFn",_value:["value","_value"]},outputs:{valueChange:"valueChange",cancel:"cancel"},features:[i._Bn([{provide:e.JU,useExisting:(0,i.Gpc)(()=>G),multi:!0}])],decls:5,vars:11,consts:[[3,"model","getOptionsFn","trackByFn","multiple","focusDirectly","openDirectly","labelForId","dropdownPosition","appendTo","change","keydown.escape"],["ng-label-tmp",""],["op-autocompleter-option-tmp",""],["type","hidden",3,"name","value"],["hiddenInput",""],[1,"ng-value-label"],[1,"ng-option-label","ellipsis",3,"title","ngStyle","opSearchHighlight"],["class","ng-option-label ellipsis",3,"title","ngStyle",4,"ngIf"],[1,"ng-option-label","ellipsis",3,"title","ngStyle"]],template:function(V,K){1&V&&(i.TgZ(0,"op-autocompleter",0),i.NdJ("change",function(se){return K.writeValue(se)})("keydown.escape",function(){return K.cancel.emit()}),i.YNc(1,S,2,1,"ng-template",1),i.YNc(2,L,3,7,"ng-template",2),i.qZA(),i._UZ(3,"input",3,4)),2&V&&(i.Q6J("model",K.value)("getOptionsFn",K.getAvailableProjects.bind(K))("trackByFn",K.projectTracker)("multiple",K.multiple)("focusDirectly",K.focusDirectly)("openDirectly",K.openDirectly)("labelForId",K.labelForId)("dropdownPosition",K.dropdownPosition)("appendTo",K.appendTo),i.xp6(3),i.Q6J("name",K.name)("value",K.plainValue))},directives:[y.s,b.bb,P.u,E.PC,T.U,E.O5],styles:[".cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-project-autocompleter,.op-project-autocompleter>*{width:100%;display:flex}.op-project-autocompleter_inline .op-autocompleter{display:inline}.op-project-autocompleter .ng-dropdown-panel .ng-dropdown-panel-items .ng-option.ng-option-disabled{cursor:default;color:#878787}\n"],encapsulation:2,changeDetection:0})},50166:(X,I,t)=>{"use strict";t.d(I,{R:()=>l});var i=t(2316),e=t(61598),d=t(91593),h=t(54364),r=t(17208);function n(a,m){if(1&a){const v=i.EpF();i.TgZ(0,"div",2),i.TgZ(1,"div",3),i.TgZ(2,"ul",4),i.TgZ(3,"li",5),i.NdJ("click",function(){return i.CHM(v),i.oxw().setMode("all")}),i._UZ(4,"a",6),i.qZA(),i.TgZ(5,"li",5),i.NdJ("click",function(){return i.CHM(v),i.oxw().setMode("recent")}),i._UZ(6,"a",6),i.qZA(),i.qZA(),i.qZA(),i.qZA()}if(2&a){const v=i.oxw();i.xp6(4),i.ekj("op-tab-row--link_selected","all"===v.mode),i.Q6J("textContent",v.text.all),i.xp6(2),i.ekj("op-tab-row--link_selected","recent"===v.mode),i.Q6J("textContent",v.text.recent)}}class l extends e.e{constructor(m){super(m),this.injector=m,this.modeSwitch=new i.vpe,this.mode="all",this.text.all=this.I18n.t("js.label_all"),this.text.recent=this.I18n.t("js.label_recent")}setMode(m){m!==this.mode&&this.modeSwitch.emit(m),this.mode=m}}l.\u0275fac=function(m){return new(m||l)(i.Y36(i.zs3))},l.\u0275cmp=i.Xpm({type:l,selectors:[["te-work-package-autocompleter"]],outputs:{modeSwitch:"modeSwitch"},features:[i.qOj],decls:2,vars:13,consts:[["resource","work_packages",3,"model","items","ngClass","addTag","virtualScroll","required","clearable","disabled","clearOnBackspace","typeahead","appendTo","hideSelected","id","change","open","close","keydown"],["op-autocompleter-header-tmp",""],[1,"scrollable-tabs"],[1,"op-scrollable-tabs--tab-container"],[1,"op-tab-row"],[1,"op-tab-row--tab",3,"click"],["href","#",1,"op-tab-row--link",3,"textContent"]],template:function(m,v){1&m&&(i.TgZ(0,"op-autocompleter",0),i.NdJ("change",function(p){return v.changeModel(p)})("open",function(){return v.opened()})("close",function(){return v.closed()})("keydown",function(p){return v.keyPressed(p)}),i.YNc(1,n,7,6,"ng-template",1),i.qZA()),2&m&&i.Q6J("model",v.model)("items",v.availableValues)("ngClass",v.classes)("addTag",v.createAllowed)("virtualScroll",!0)("required",v.required)("clearable",!v.required)("disabled",v.disabled)("clearOnBackspace",!1)("typeahead",v.typeahead)("appendTo",v.appendTo)("hideSelected",v.hideSelected)("id",v.id)},directives:[d.s,h.mk,r.S],styles:[".ng-dropdown-panel .ng-dropdown-header{padding-bottom:0}\n"],encapsulation:2})},90127:(X,I,t)=>{"use strict";t.d(I,{U:()=>q,X:()=>K});var i=t(2316),e=t(91923),d=t(70233),h=t(96617),r=t(9170),n=t(33927),l=t(67727),a=t(36868),m=t(61908),v=t(26269),c=t(45410),p=t(1707),f=t(90044),C=t(2308),u=t(26942),k=t(91593),O=t(80104),y=t(54364),b=t(93713),P=t(3742),E=t(44265),T=t(96905),M=t(65146),S=t(2775);function R(se,te){if(1&se){const ie=i.EpF();i.TgZ(0,"button",1),i.NdJ("click",function(oe){return i.CHM(ie),i.oxw().onAddNewClick(oe)}),i.TgZ(1,"span",2),i._UZ(2,"op-icon",3),i._uU(3),i.qZA(),i.qZA()}if(2&se){const ie=i.oxw();i.xp6(3),i.hij(" ",ie.text.button," ")}}class F{constructor(te,ie,le,oe,ne){this.I18n=te,this.opInviteUserModalService=ie,this.currentProjectService=le,this.currentUserService=oe,this.autocompleter=ne,this.text={button:this.I18n.t("js.invite_user_modal.invite")}}ngOnInit(){this.projectId=this.projectId||this.currentProjectService.id,this.canInviteUsersToProject$=this.currentUserService.hasCapabilities$("memberships/create",this.projectId||void 0)}onAddNewClick(te){te.stopPropagation(),this.opInviteUserModalService.open(this.projectId),this.autocompleter.closeSelect()}}F.\u0275fac=function(te){return new(te||F)(i.Y36(h.D),i.Y36(C.j),i.Y36(M.R),i.Y36(T.S),i.Y36(k.s))},F.\u0275cmp=i.Xpm({type:F,selectors:[["op-invite-user-button"]],inputs:{projectId:"projectId"},decls:2,vars:3,consts:[["class","op-select-footer--label","type","button",3,"click",4,"ngIf"],["type","button",1,"op-select-footer--label",3,"click"],[1,"icon-context"],["icon-classes","icon-user-plus icon-context"]],template:function(te,ie){1&te&&(i.YNc(0,R,4,1,"button",0),i.ALo(1,"async")),2&te&&i.Q6J("ngIf",i.lcZ(1,1,ie.canInviteUsersToProject$))},directives:[y.O5,S.o],pipes:[y.Ov],styles:[""]});const L=["hiddenInput"];function D(se,te){if(1&se&&i._UZ(0,"op-principal",7),2&se){const ie=i.oxw().$implicit;i.Q6J("principal",ie)("hideName",!0)}}function G(se,te){if(1&se&&(i.YNc(0,D,1,2,"op-principal",5),i.TgZ(1,"span",6),i._uU(2),i.qZA()),2&se){const ie=te.$implicit,le=te.search;i.Q6J("ngIf",ie&&ie.href),i.xp6(1),i.Q6J("opSearchHighlight",le),i.xp6(1),i.hij(" ",ie.name," ")}}function Q(se,te){if(1&se&&i._UZ(0,"op-invite-user-button",9),2&se){const ie=i.oxw(2);i.Q6J("projectId",ie.inviteUserToProject)}}function V(se,te){1&se&&i.YNc(0,Q,1,1,"ng-template",8)}const K="op-user-autocompleter";class q extends u.N{constructor(te,ie,le,oe,ne,fe,ve,Se){super(),this.elementRef=te,this.halResourceService=ie,this.I18n=le,this.halNotification=oe,this.pathHelper=ne,this.apiV3Service=fe,this.injector=ve,this.opInviteUserModalService=Se,this.userTracker=Oe=>Oe.href||Oe.id,this.clearAfterSelection=!1,this.name="",this.url=this.apiV3Service.users.path,this.labelForId="",this.appendTo="",this.multiple=!1,this.openDirectly=!1,this.focusDirectly=!1,this._value=null,this.additionalFilters=[],this.inputFilters=new v.qM,this.valueChange=new i.vpe,this.cancel=new i.vpe,this.userInvited=new i.vpe,this.onChange=Oe=>{},this.onTouched=Oe=>{},(0,c.E)(this)}get value(){return this._value}set value(te){this._value=te,this.onChange(te),this.valueChange.emit(te),this.onTouched(te),setTimeout(()=>{var ie;null===(ie=this.hiddenInput.nativeElement)||void 0===ie||ie.dispatchEvent(new Event("change"))},100)}get plainValue(){var te,ie;return(Array.isArray(this.value)?null===(te=this.value)||void 0===te?void 0:te.map(le=>le.id):null===(ie=this.value)||void 0===ie?void 0:ie.id)||""}ngOnInit(){this.additionalFilters.forEach(te=>this.inputFilters.add(te.selector,te.operator,te.values)),this.opInviteUserModalService.close.pipe(this.untilDestroyed(),(0,r.h)(te=>!!te)).subscribe(te=>{this.userInvited.emit(te)})}getAvailableUsers(te){const ie=this.inputFilters.clone();(null==te?void 0:te.length)&&ie.add("name","~",[te]);const le=(0,f.d)(this.url,ie);return this.halResourceService.get(le.toString(),{pageSize:-1}).pipe((0,n.U)(oe=>oe.elements.map(ne=>({name:ne.name,id:ne.id,href:ne.href,avatar:ne.avatar}))))}writeValue(te){this.value=te}registerOnChange(te){this.onChange=te}registerOnTouched(te){this.onTouched=te}}q.\u0275fac=function(te){return new(te||q)(i.Y36(i.SBq),i.Y36(e.u),i.Y36(h.D),i.Y36(l.W),i.Y36(d.j),i.Y36(m.T),i.Y36(i.zs3),i.Y36(C.j))},q.\u0275cmp=i.Xpm({type:q,selectors:[["op-user-autocompleter"]],viewQuery:function(te,ie){if(1&te&&(i.Gf(a.w9,7),i.Gf(L,5)),2&te){let le;i.iGM(le=i.CRH())&&(ie.ngSelectComponent=le.first),i.iGM(le=i.CRH())&&(ie.hiddenInput=le.first)}},inputs:{clearAfterSelection:"clearAfterSelection",name:"name",url:"url",labelForId:"labelForId",appendTo:"appendTo",multiple:"multiple",openDirectly:"openDirectly",focusDirectly:"focusDirectly",_value:["value","_value"],inviteUserToProject:"inviteUserToProject",additionalFilters:"additionalFilters"},outputs:{valueChange:"valueChange",cancel:"cancel",userInvited:"userInvited"},features:[i._Bn([{provide:p.JU,useExisting:(0,i.Gpc)(()=>q),multi:!0},C.j]),i.qOj],decls:5,vars:12,consts:[[3,"model","openDirectly","getOptionsFn","trackByFn","multiple","labelForId","appendTo","focusDirectly","change","keydown.escape"],["op-autocompleter-option-tmp",""],[4,"ngIf"],["type","hidden",3,"name","value"],["hiddenInput",""],["size","mini",3,"principal","hideName",4,"ngIf"],[3,"opSearchHighlight"],["size","mini",3,"principal","hideName"],["op-autocompleter-footer-tmp",""],[1,"op-select-footer",3,"projectId"]],template:function(te,ie){1&te&&(i.TgZ(0,"op-autocompleter",0),i.NdJ("change",function(oe){return ie.writeValue(oe)})("keydown.escape",function(){return ie.cancel.emit()}),i.YNc(1,G,3,3,"ng-template",1),i.YNc(2,V,1,0,void 0,2),i.qZA(),i._UZ(3,"input",3,4)),2&te&&(i.Q6J("model",ie.value)("openDirectly",!0)("getOptionsFn",ie.getAvailableUsers.bind(ie))("trackByFn",ie.userTracker)("multiple",ie.multiple)("labelForId",ie.labelForId)("appendTo",ie.appendTo)("openDirectly",ie.openDirectly)("focusDirectly",ie.focusDirectly),i.xp6(2),i.Q6J("ngIf",ie.inviteUserToProject),i.xp6(1),i.Q6J("name",ie.name)("value",ie.plainValue))},directives:[k.s,O.u,y.O5,b.U,P.N,E.q,F],encapsulation:2,changeDetection:0})},54622:(X,I,t)=>{"use strict";t.d(I,{y:()=>f});var i=t(2316),e=t(65146),d=t(66220),h=t(61908),r=t(67727),n=t(96617),l=t(70233),a=t(36868),m=t(1707),v=t(54364);function c(C,u){if(1&C&&(i._UZ(0,"b",4),i._uU(1)),2&C){const k=u.searchTerm,O=i.oxw();i.Q6J("textContent",O.text.add_new_action),i.xp6(1),i.hij(": ",k," ")}}function p(C,u){if(1&C&&i._UZ(0,"span",5),2&C){const k=u.item,O=u.searchTerm;i.Q6J("ngOptionHighlight",O)("textContent",k.name)}}class f extends d.c{constructor(u,k,O,y,b,P,E){super(u),this.injector=u,this.I18n=k,this.currentProject=O,this.cdRef=y,this.pathHelper=b,this.apiV3Service=P,this.halNotification=E,this.onCreate=new i.vpe}ngAfterViewInit(){super.ngAfterViewInit(),this.canCreateNewActionElements().then(u=>{u&&(this.createAllowed=k=>this.createNewVersion(k),this.cdRef.detectChanges())})}canCreateNewActionElements(){return this.currentProject.id?this.apiV3Service.versions.available_projects.exists(this.currentProject.id).toPromise().catch(()=>!1):Promise.resolve(!1)}createNewVersion(u){this.apiV3Service.versions.post(this.getVersionPayload(u)).subscribe(k=>this.onCreate.emit(k),k=>{this.closeSelect(),this.halNotification.handleRawError(k)})}getVersionPayload(u){const k={};return k.name=u,k._links={definingProject:{href:this.apiV3Service.projects.id(this.currentProject.id).path}},k}}f.\u0275fac=function(u){return new(u||f)(i.Y36(i.zs3),i.Y36(n.D),i.Y36(e.R),i.Y36(i.sBO),i.Y36(l.j),i.Y36(h.T),i.Y36(r.W))},f.\u0275cmp=i.Xpm({type:f,selectors:[["version-autocompleter"]],outputs:{onCreate:"onCreate"},features:[i.qOj],decls:4,vars:15,consts:[["bindLabel","name",3,"ngModel","items","ngClass","addTag","virtualScroll","required","clearable","disabled","typeahead","clearOnBackspace","clearSearchOnAdd","appendTo","hideSelected","compareWith","id","ngModelChange","change","open","close","keydown"],["ngSelectComponent",""],["ng-tag-tmp",""],["ng-option-tmp",""],[3,"textContent"],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight","textContent"]],template:function(u,k){1&u&&(i.TgZ(0,"ng-select",0,1),i.NdJ("ngModelChange",function(y){return k.model=y})("change",function(y){return k.changeModel(y)})("open",function(){return k.opened()})("close",function(){return k.closed()})("keydown",function(y){return k.keyPressed(y)}),i.YNc(2,c,2,2,"ng-template",2),i.YNc(3,p,1,2,"ng-template",3),i.qZA()),2&u&&i.Q6J("ngModel",k.model)("items",k.availableValues)("ngClass",k.classes)("addTag",k.createAllowed)("virtualScroll",!0)("required",k.required)("clearable",!k.required)("disabled",k.disabled)("typeahead",k.typeahead)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("appendTo",k.appendTo)("hideSelected",k.hideSelected)("compareWith",k.compareByHref)("id",k.id)},directives:[a.w9,m.JJ,m.On,v.mk,m.Q7,a.N6,a.Z2],encapsulation:2})},61598:(X,I,t)=>{"use strict";t.d(I,{e:()=>a});var i=t(66220),e=t(2316),d=t(36868),h=t(1707),r=t(54364);function n(m,v){if(1&m&&(e._UZ(0,"b",4),e._uU(1)),2&m){const c=v.searchTerm,p=e.oxw();e.Q6J("textContent",p.text.add_new_action),e.xp6(1),e.hij(": ",c," ")}}function l(m,v){if(1&m&&e._UZ(0,"span",5),2&m){const c=v.item,p=v.searchTerm;e.Q6J("ngOptionHighlight",p)("textContent",c.name)}}class a extends i.c{}a.\u0275fac=function(){let m;return function(c){return(m||(m=e.n5z(a)))(c||a)}}(),a.\u0275cmp=e.Xpm({type:a,selectors:[["wp-autocompleter"]],features:[e.qOj],decls:4,vars:15,consts:[["bindLabel","name",3,"ngModel","items","ngClass","addTag","virtualScroll","required","clearable","disabled","typeahead","clearOnBackspace","clearSearchOnAdd","appendTo","hideSelected","compareWith","id","ngModelChange","change","open","close","keydown"],["ngSelectComponent",""],["ng-tag-tmp",""],["ng-option-tmp",""],[3,"textContent"],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight","textContent"]],template:function(v,c){1&v&&(e.TgZ(0,"ng-select",0,1),e.NdJ("ngModelChange",function(f){return c.model=f})("change",function(f){return c.changeModel(f)})("open",function(){return c.opened()})("close",function(){return c.closed()})("keydown",function(f){return c.keyPressed(f)}),e.YNc(2,n,2,2,"ng-template",2),e.YNc(3,l,1,2,"ng-template",3),e.qZA()),2&v&&e.Q6J("ngModel",c.model)("items",c.availableValues)("ngClass",c.classes)("addTag",c.createAllowed)("virtualScroll",!0)("required",c.required)("clearable",!c.required)("disabled",c.disabled)("typeahead",c.typeahead)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("appendTo",c.appendTo)("hideSelected",c.hideSelected)("compareWith",c.compareByHref)("id",c.id)},directives:[d.w9,h.JJ,h.On,r.mk,h.Q7,d.N6,d.Z2],encapsulation:2})},87064:(X,I,t)=>{"use strict";t.d(I,{w:()=>m,O:()=>v});var i=t(50076),e=t(96617),d=t(2316),h=t(36868),r=t(1707),n=t(54364);function l(c,p){if(1&c&&(d.TgZ(0,"span",3),d._uU(1),d.qZA()),2&c){const f=p.item,C=d.oxw();d.Q6J("ngClass",C.highlightColor(f)),d.xp6(1),d.Oqu(f.name)}}function a(c,p){if(1&c&&(d.TgZ(0,"span",3),d._uU(1),d.qZA()),2&c){const f=p.item,C=d.oxw();d.Q6J("ngClass",C.highlightColor(f)),d.xp6(1),d.Oqu(f.name)}}const m="colors-autocompleter";class v{constructor(p,f){this.elementRef=p,this.I18n=f,this.highlightTextInline=!1}ngOnInit(){this.setColorOptions(),this.updateInputField=document.getElementsByName(this.elementRef.nativeElement.dataset.updateInput)[0],this.highlightTextInline=JSON.parse(this.elementRef.nativeElement.dataset.highlightTextInline)}onModelChange(p){p&&this.updateInputField&&(this.updateInputField.value=p.value)}setColorOptions(){this.options=JSON.parse(this.elementRef.nativeElement.dataset.colors),this.options.unshift({name:this.I18n.t("js.label_no_color"),value:""}),this.selectedOption=this.options.find(p=>!0===p.selected),this.selectedOption?this.selectedOption=this.selectedOption.value:(this.selectedColorId=this.elementRef.nativeElement.dataset.selectedColor,this.selectedOption=this.selectedColorId?this.selectedColorId:"")}highlightColor(p){if(""===p.value)return;let f;return f=this.highlightTextInline?"__hl_inline_type_ ":"__hl_inline_ ",f+i.Z.colorClass(this.highlightTextInline,p.value)}}v.\u0275fac=function(p){return new(p||v)(d.Y36(d.SBq),d.Y36(e.D))},v.\u0275cmp=d.Xpm({type:v,selectors:[["colors-autocompleter"]],decls:3,vars:4,consts:[["bindLabel","name","bindValue","value","appendTo","body",3,"items","virtualScroll","ngModel","clearable","ngModelChange","change"],["ng-label-tmp",""],["ng-option-tmp",""],[3,"ngClass"]],template:function(p,f){1&p&&(d.TgZ(0,"ng-select",0),d.NdJ("ngModelChange",function(u){return f.selectedOption=u})("change",function(u){return f.onModelChange(u)}),d.YNc(1,l,2,2,"ng-template",1),d.YNc(2,a,2,2,"ng-template",2),d.qZA()),2&p&&d.Q6J("items",f.options)("virtualScroll",!0)("ngModel",f.selectedOption)("clearable",!1)},directives:[h.w9,r.JJ,r.On,h.bb,h.Z2,n.mk],encapsulation:2})},52167:(X,I,t)=>{"use strict";t.d(I,{c:()=>e});var i=t(2316);class e{toHsl(h){return`hsl(${this.valueHash(h)}, 50%, 50%)`}toHsla(h,r){return`hsla(${this.valueHash(h)}, 50%, 50%, ${r}%)`}valueHash(h){let r=0;for(let n=0;n<h.length;n++)r=h.charCodeAt(n)+((r<<5)-r);return r%360}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},45410:(X,I,t)=>{"use strict";t.d(I,{E:()=>d});t(43887);function d(h){const r=h.constructor,n=Object.keys(r).find(m=>"object"==typeof r[m].declaredInputs);if(!n)return void console.warn("Could not find declared inputs for component");const a=r[n].declaredInputs;Object.keys(a).forEach(m=>{const v=a[m],{dataset:c}=h.elementRef.nativeElement;if(c[m])try{h[v]=JSON.parse(c[m]||"")}catch(p){throw console.error("Couldn't parse input: ",m,h.elementRef.nativeElement.dataset),console.error("\nMake sure to make all data attributes you want to use as input JSON parseable.\nThis means that plain strings have to be wrapped in double quotes, and the attribute value is easiest to set with single quotes.\nAn example:\n\n<op-example example-input='\"myString\"'></op-example>\n"),p}})}},21501:(X,I,t)=>{"use strict";t.d(I,{F:()=>d});var i=t(70692),e=t(2316);class d{constructor(r){this.timezoneService=r}ngOnInit(){const r=this.timezoneService.formattedDatetimeComponents(this.dateTimeValue);this.date=r[0],this.time=r[1]}}d.\u0275fac=function(r){return new(r||d)(e.Y36(i.B))},d.\u0275cmp=e.Xpm({type:d,selectors:[["op-date-time"]],inputs:{dateTimeValue:"dateTimeValue"},decls:5,vars:4,consts:[[3,"title"],[3,"textContent"]],template:function(r,n){1&r&&(e.TgZ(0,"span",0),e._UZ(1,"span",1),e.TgZ(2,"span"),e._uU(3,"\xa0"),e.qZA(),e._UZ(4,"span",1),e.qZA()),2&r&&(e.hYB("title","",n.date," ",n.time,""),e.xp6(1),e.Q6J("textContent",n.date),e.xp6(3),e.Q6J("textContent",n.time))},encapsulation:2})},57958:(X,I,t)=>{"use strict";t.d(I,{r:()=>S});var i=t(2316),e=t(66586),d=t(96617),h=t(70233),r=t(71435),n=t(18293),l=t(36293),a=t(3786),m=t(81134),v=t(33927),c=t(53882);class p{constructor(F){this._httpClient=F}submit$(F,L,D,G,Q){const V=this.formatModelToSubmit(F.getRawValue(),Q),K=D?"patch":G||"post",q=D?`${L}/${D}`:L;return this._httpClient[K](q,V,{withCredentials:!0,responseType:"json"}).pipe((0,n.K)(se=>{throw 422==se.status&&this.handleBackendFormValidationErrors(se,F),se}))}validateForm$(F,L,D){const G=this.formatModelToSubmit(F.value,D);return this._httpClient.post(`${L}/form`,G,{withCredentials:!0,responseType:"json"}).pipe((0,v.U)(Q=>{var V;return this.getFormattedErrors(Object.values(null===(V=null==Q?void 0:Q._embedded)||void 0===V?void 0:V.validationErrors))}),(0,v.U)(Q=>this.setFormValidationErrors(Q,F)))}formatModelToSubmit(F,L={}){let{_links:D}=F,G=(0,a._T)(F,["_links"]);const Q=D||Object.keys(L).filter(K=>{var q,se;return!!(null===(q=L[K])||void 0===q?void 0:q.type)&&"_links"===(null===(se=L[K])||void 0===se?void 0:se.location)}).reduce((K,q)=>{const se=G,te=q;se[te];return G=(0,a._T)(se,["symbol"==typeof te?te:te+""]),Object.assign(Object.assign({},K),{[q]:F[q]})},{}),V=Object.keys(Q).reduce((K,q)=>{var se,te;const ie=Q[q],le=Array.isArray(ie)?ie.map(oe=>{var ne,fe;return{href:(null==oe?void 0:oe.href)||(null===(fe=null===(ne=null==oe?void 0:oe._links)||void 0===ne?void 0:ne.self)||void 0===fe?void 0:fe.href)||null}}):{href:(null==ie?void 0:ie.href)||(null===(te=null===(se=null==ie?void 0:ie._links)||void 0===se?void 0:se.self)||void 0===te?void 0:te.href)||null};return Object.assign(Object.assign({},K),{[q]:le})},{});return Object.assign(Object.assign({},G),{_links:V})}formatModelToEdit(F={}){const{_links:L,_meta:D}=F,G=(0,a._T)(F,["_links","_meta"]),Q=Object.keys(G).filter(K=>this.isValue(G[K])).reduce((K,q)=>Object.assign(Object.assign({},K),{[q]:G[q]}),{});return Object.assign(Object.assign(Object.assign({},Q),{_meta:D}),this.getFormattedResourcesModel(L))}handleBackendFormValidationErrors(F,L){var D,G,Q,V;const K=(null===(G=null===(D=null==F?void 0:F.error)||void 0===D?void 0:D._embedded)||void 0===G?void 0:G.errors)?null===(V=null===(Q=null==F?void 0:F.error)||void 0===Q?void 0:Q._embedded)||void 0===V?void 0:V.errors:[F.error],q=this.getFormattedErrors(K);this.setFormValidationErrors(q,L)}setFormValidationErrors(F,L){F.forEach(D=>{var G;const Q=L.get(D.key)||(null===(G=L.get("_links"))||void 0===G?void 0:G.get(D.key));null==Q||Q.setErrors({[D.key]:{message:D.message}})})}getAllFormValidationErrors(F,L){const D=Object.values(F),G=Array.isArray(L)?L:[L];return this.getFormattedErrors(D).filter(V=>!L||G.includes(V.key)).reduce((V,{key:K,message:q})=>Object.assign(Object.assign({},V),{[K]:{message:q}}),{})}getFormattedErrors(F){return F.map(D=>({key:D._embedded.details.attribute,message:D.message}))}getFormattedResourcesModel(F={}){return Object.keys(F).reduce((L,D)=>{const G=F[D],Q=Array.isArray(G)?G.map(V=>Object.assign(Object.assign({},V),{name:(null==V?void 0:V.name)||(null==V?void 0:V.title)})):Object.assign(Object.assign({},G),{name:(null==G?void 0:G.name)||(null==G?void 0:G.title)});return L=Object.assign(Object.assign({},L),this.isValue(Q)&&{[D]:Q})},{})}isValue(F){return![null,void 0,""].includes(F)}}p.\u0275fac=function(F){return new(F||p)(i.LFG(c.eN))},p.\u0275prov=i.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"});var f=t(18217);class C{constructor(F,L,D){this.httpClient=F,this.I18n=L,this.formsService=D,this.selectDefaultValue={name:"-",_links:{self:{href:null}}},this.inputsCatalogue=[{config:{type:"textInput",templateOptions:{type:"text"}},useForFields:["String"]},{config:{type:"textInput",templateOptions:{type:"password"}},useForFields:["Password"]},{config:{type:"integerInput",templateOptions:{type:"number",locale:this.I18n.locale}},useForFields:["Integer","Float"]},{config:{type:"booleanInput",templateOptions:{type:"checkbox"}},useForFields:["Boolean"]},{config:{type:"dateInput"},useForFields:["Date","DateTime"]},{config:{type:"userInput"},useForFields:["User"]},{config:{type:"formattableInput",className:"",templateOptions:{editorType:"full",noWrapLabel:!0}},useForFields:["Formattable"]},{config:{type:"selectInput",defaultValue:this.selectDefaultValue,templateOptions:{locale:this.I18n.locale,bindLabel:"name",searchable:!0,virtualScroll:!0,clearOnBackspace:!1,clearSearchOnAdd:!1,hideSelected:!1,text:{add_new_action:this.I18n.t("js.label_create")}},expressionProperties:{"templateOptions.clearable":(G,Q,V)=>{var K;return!(null===(K=V.templateOptions)||void 0===K?void 0:K.required)}}},useForFields:["Priority","Status","Type","Version","TimeEntriesActivity","Category","CustomOption"]},{config:{type:"projectInput",defaultValue:this.selectDefaultValue,templateOptions:{locale:this.I18n.locale,bindLabel:"name"},expressionProperties:{"templateOptions.clearable":(G,Q,V)=>{var K;return!(null===(K=V.templateOptions)||void 0===K?void 0:K.required)}}},useForFields:["Project"]},{config:{type:"selectProjectStatusInput",defaultValue:this.selectDefaultValue,templateOptions:{locale:this.I18n.locale,bindLabel:"name",searchable:!0},expressionProperties:{"templateOptions.clearable":(G,Q,V)=>{var K;return!(null===(K=V.templateOptions)||void 0===K?void 0:K.required)}}},useForFields:["ProjectStatus"]}]}getConfig(F,L){var D;const G=null===(D=F._attributeGroups)||void 0===D?void 0:D.map(q=>({name:q.name,fieldsFilter:se=>{var te,ie;return null===(te=q.attributes)||void 0===te?void 0:te.includes(null===(ie=se.templateOptions)||void 0===ie?void 0:ie.property)}})),V=this.getFieldsSchemasWithKey(F).map(q=>this.getFormlyFieldConfig(q,L)).filter(q=>null!==q);return this.getFormlyFormWithFieldGroups(G,V)}getModel(F){return this.formsService.formatModelToEdit(F)}getFormlyFormWithFieldGroups(F=[],L=[]){return[...(L=L.reduce((Q,V)=>V.fieldGroup?[...Q,...V.fieldGroup]:[...Q,V],[])).filter(Q=>F.every(V=>!V.fieldsFilter||!V.fieldsFilter(Q))),...this.getDynamicFormFieldGroups(F,L)]}getFieldsSchemasWithKey(F){return Object.keys(F).map(L=>Object.assign(Object.assign({},F[L]),{key:this.getAttributeKey(F[L],L)})).filter(L=>this.isFieldSchema(L)&&L.writable)}getAttributeKey(F,L){switch(F.location){case"_meta":return`${F.location}.${L}`;default:return L}}isFieldSchema(F){return!!(null==F?void 0:F.type)}getFormlyFieldConfig(F,L){var D,G;const{key:Q,name:V,required:K,hasDefault:q,minLength:se,maxLength:te}=F,ie=this.getFieldTypeConfig(F);if(!ie)return null;const{templateOptions:le}=ie,oe=(0,a._T)(ie,["templateOptions"]),ne=this.getFieldProperty(Q),fe=ne&&(L[ne]||L._links&&L._links[ne]),ve=this.getFieldOptions(F,fe);return Object.assign(Object.assign({},oe),{key:Q,wrappers:["op-dynamic-field-wrapper"],className:`op-form--field ${(null==oe?void 0:oe.className)||""}`,templateOptions:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({property:ne,required:K,label:V,hasDefault:q},null!=fe&&{payloadValue:fe}),se&&{minLength:se}),te&&{maxLength:te}),le),ve&&{options:ve}),{allowedValuesHref:null===(G=null===(D=null==F?void 0:F._links)||void 0===D?void 0:D.allowedValues)||void 0===G?void 0:G.href})})}getFieldTypeConfig(F){var L;const D=F.type.replace("[]",""),G=this.inputsCatalogue.find(K=>K.useForFields.includes(D));if(!G)return console.warn(`Could not find a input definition for a field with the following type: ${D}. The full field configuration is`,F),null;const Q=G.config;let V;return"integerInput"===Q.type||"selectInput"===Q.type||"selectProjectStatusInput"===Q.type||"userInput"===Q.type?V={className:F.name,templateOptions:Object.assign(Object.assign({},Q.templateOptions),this.isMultiSelectField(F)&&{multiple:!0})}:"formattableInput"===Q.type&&(V={templateOptions:Object.assign(Object.assign({},Q.templateOptions),{rtl:null===(L=F.options)||void 0===L?void 0:L.rtl,name:F.name})}),Object.assign(Object.assign({},Q),V)}getFieldOptions(F,L){var D,G,Q,V,K;const q=(null===(D=F._embedded)||void 0===D?void 0:D.allowedValues)||(null===(G=F._links)||void 0===G?void 0:G.allowedValues);let se;if(q){if(Array.isArray(q)){const te=(null===(K=null===(V=null===(Q=q[0])||void 0===Q?void 0:Q._links)||void 0===V?void 0:V.self)||void 0===K?void 0:K.title)?this.formatAllowedValues(q):q;se=(0,m.of)(te)}else q.href&&(se=this.httpClient.get((0,f.Y)(q.href,{pageSize:"-1"})).pipe((0,v.U)(te=>te._embedded.elements),(0,v.U)(te=>this.formatAllowedValues(te))));return null==se?void 0:se.pipe((0,v.U)(te=>this.prependCurrentValue(te,L)),(0,v.U)(te=>this.prependDefaultValue(te,F)))}}formatAllowedValues(F){return F.map(L=>{var D,G;return Object.assign(Object.assign({},L),{name:null===(G=null===(D=L._links)||void 0===D?void 0:D.self)||void 0===G?void 0:G.title})})}getFieldProperty(F){return F.split(".").pop()}getDynamicFormFieldGroups(F=[],L=[]){return F.reduce((D,G)=>{var Q;let V=this.getDefaultFieldGroupSettings(G,L);return G.settings&&(V=Object.assign(Object.assign({},V),{templateOptions:Object.assign(Object.assign({},V.templateOptions),G.settings.templateOptions&&G.settings.templateOptions),expressionProperties:Object.assign(Object.assign({},V.expressionProperties),G.settings.expressionProperties&&G.settings.expressionProperties)})),(null===(Q=null==V?void 0:V.fieldGroup)||void 0===Q?void 0:Q.length)&&(D=[...D,V]),D},[])}getDefaultFieldGroupSettings(F,L){return{wrappers:["op-dynamic-field-group-wrapper"],fieldGroupClassName:"op-form--fieldset",templateOptions:{label:F.name,isFieldGroup:!0,collapsibleFieldGroups:!0,collapsibleFieldGroupsCollapsed:!0},fieldGroup:this.getGroupFields(F,L),expressionProperties:{"templateOptions.collapsibleFieldGroupsCollapsed":this.collapsibleFieldGroupsCollapsedExpressionProperty}}}getGroupFields(F,L){return L.filter(D=>!(!D.key||!this.getFieldProperty(D.key))&&(!F.fieldsFilter||F.fieldsFilter(D)))}collapsibleFieldGroupsCollapsedExpressionProperty(F,L,D){var G,Q,V;return!("formly-group"!==D.type||!(null===(G=D.templateOptions)||void 0===G?void 0:G.collapsibleFieldGroups)||!(null===(Q=D.templateOptions)||void 0===Q?void 0:Q.collapsibleFieldGroupsCollapsed))&&!(null===(V=D.fieldGroup)||void 0===V?void 0:V.some(K=>{var q,se,te;return(null===(q=K.formControl)||void 0===q?void 0:q.errors)&&!K.hide&&(null===(te=null===(se=D.options)||void 0===se?void 0:se.parentForm)||void 0===te?void 0:te.submitted)}))}prependCurrentValue(F,L){return!(null==L?void 0:L.href)||F.some(D=>{var G,Q;return(null===(Q=null===(G=null==D?void 0:D._links)||void 0===G?void 0:G.self)||void 0===Q?void 0:Q.href)===L.href})?F:[{name:L.title,_links:{self:L}},...F]}prependDefaultValue(F,L){return L.required||this.isMultiSelectField(L)?F:[this.selectDefaultValue,...F]}isMultiSelectField(F){var L;return null===(L=null==F?void 0:F.type)||void 0===L?void 0:L.startsWith("[]")}}C.\u0275fac=function(F){return new(F||C)(i.LFG(c.eN),i.LFG(d.D),i.LFG(p))},C.\u0275prov=i.Yz7({token:C,factory:C.\u0275fac});var u=t(26942),k=t(84335),O=t(1707);class y{constructor(F,L,D){this._httpClient=F,this._dynamicFieldsService=L,this._formsService=D}registerForm(F){this.dynamicForm=F}getSettingsFromBackend$(F,L,D={}){const G=L?`/${L}`:"",Q=(null==F?void 0:F.endsWith("/form"))?"":"/form",V=`${F}${G}${Q}`;return this._httpClient.post(V,D,{withCredentials:!0,responseType:"json"}).pipe((0,v.U)(K=>this.getSettings(K)))}getSettings(F){var L,D;this.formSchema=null===(L=F._embedded)||void 0===L?void 0:L.schema;const G=null===(D=F._embedded)||void 0===D?void 0:D.payload;return{form:new O.cw({}),fields:this._dynamicFieldsService.getConfig(this.formSchema,G),model:this._dynamicFieldsService.getModel(G)}}formatModelToEdit(F){return this._formsService.formatModelToEdit(F)}validateForm$(F,L){return this._formsService.validateForm$(F,L,this.formSchema)}submit$(F,L,D,G){return this._formsService.submit$(F,L,D,G,this.formSchema)}}y.\u0275fac=function(F){return new(F||y)(i.LFG(c.eN),i.LFG(C),i.LFG(p))},y.\u0275prov=i.Yz7({token:y,factory:y.\u0275fac});var b=t(10190),P=t(54364);function E(R,F){if(1&R){const L=i.EpF();i.TgZ(0,"div",5),i.TgZ(1,"button",6),i._uU(2),i.qZA(),i.TgZ(3,"button",7),i.NdJ("click",function(){return i.CHM(L),i.oxw(2).handleCancel()}),i._uU(4),i.qZA(),i.qZA()}if(2&R){const L=i.oxw(2);i.xp6(1),i.Q6J("disabled",L.inFlight),i.xp6(1),i.hij(" ",L.text.save," "),i.xp6(2),i.hij(" ",L.text.cancel," ")}}function T(R,F){if(1&R){const L=i.EpF();i.TgZ(0,"form",2),i.NdJ("submit",function(){i.CHM(L);const G=i.oxw();return G.submitForm(G.form)}),i.TgZ(1,"formly-form",3),i.NdJ("modelChange",function(G){return i.CHM(L),i.oxw().onModelChange(G)}),i.qZA(),i.YNc(2,E,5,3,"div",4),i.qZA()}if(2&R){const L=i.oxw();i.Q6J("formGroup",L.form),i.xp6(1),i.Q6J("form",L.form)("model",L.innerModel)("fields",L.fields),i.xp6(1),i.Q6J("ngIf",L.handleSubmit)}}function M(R,F){if(1&R){const L=i.EpF();i.TgZ(0,"formly-form",8),i.NdJ("modelChange",function(G){return i.CHM(L),i.oxw().onModelChange(G)}),i.qZA()}if(2&R){const L=i.oxw();i.Q6J("form",L.form)("model",L.innerModel)("fields",L.fields)}}class S extends u.N{constructor(F,L,D,G,Q,V,K){super(),this.dynamicFormService=F,this.dynamicFieldsService=L,this.I18n=D,this.pathHelperService=G,this.toastService=Q,this.changeDetectorRef=V,this.confirmDialogService=K,this.formHttpMethod="post",this.initialPayload={},this.showNotifications=!0,this.showValidationErrorsOn="submit",this.handleSubmit=!0,this.modelChange=new i.vpe,this.submitted=new i.vpe,this.errored=new i.vpe,this.text={save:this.I18n.t("js.button_save"),cancel:this.I18n.t("js.button_cancel"),load_error_message:this.I18n.t("js.forms.load_error_message"),successful_update:this.I18n.t("js.notice_successful_update"),successful_create:this.I18n.t("js.notice_successful_create"),job_started:this.I18n.t("js.notice_job_started")},this.noSettingsSourceErrorMessage="DynamicFormComponent needs a settings, formUrl or resourcePath @Input\n  in order to fetch its setting. Please provide one.",this.noPathToSubmitToError="DynamicForm needs a resourcePath or formUrl @Input in order to be submitted \n  and validated. Please provide one."}set model(F){if(!this.innerModel&&!F)return;const L=this.dynamicFormService.formatModelToEdit(F);this.form.patchValue(L)}get model(){return this.form.getRawValue()}set dynamicForm(F){this.dynamicFormService.registerForm(F)}setDisabledState(F){F?this.form.disable():this.form.enable()}ngOnChanges(F){(F.settings||F.resourcePath||F.resourceId||F.formUrl||F.formHttpMethod||F.dynamicFormGroup||F.initialPayload||F.fieldsSettingsPipe||F.fieldGroups)&&this.initializeDynamicForm(this.settings,this.resourcePath,this.resourceId,this.formUrl,this.initialPayload)}onModelChange(F){this.modelChange.emit(F)}submitForm(F){if(this.handleSubmit){if(!this.formEndpoint)throw new Error(this.noPathToSubmitToError);this.inFlight=!0,this.dynamicFormService.submit$(F,this.formEndpoint,this.resourceId,this.formHttpMethod).pipe((0,r.x)(()=>this.inFlight=!1)).subscribe(L=>{this.submitted.emit(L),this.showNotifications&&this.showSuccessNotification(L)},L=>{var D;this.errored.emit((null==L?void 0:L.error)||L),this.showNotifications&&this.toastService.addError((null===(D=null==L?void 0:L.error)||void 0===D?void 0:D.message)||(null==L?void 0:L.message))})}}validateForm(){if(!this.formEndpoint)throw new Error(this.noPathToSubmitToError);return this.dynamicFormService.validateForm$(this.form,this.formEndpoint)}handleCancel(){this.form.dirty?this.confirmDialogService.confirm({text:{title:this.I18n.t("js.text_are_you_sure"),text:this.I18n.t("js.text_data_lost")}}).then(()=>{this.goBack()}).catch(()=>{}):this.goBack()}goBack(){window.history.back()}initializeDynamicForm(F,L,D,G,Q){const V=this.getFormEndPoint(G,L);if(!V)throw new Error(this.noSettingsSourceErrorMessage);V!==this.formEndpoint&&(this.formEndpoint=V),F?this.setupDynamicFormFromSettings(F):this.setupDynamicFormFromBackend(this.formEndpoint,D,Q)}getFormEndPoint(F,L){return F?F.endsWith("/form")?F.replace("/form",""):F:L||""}setupDynamicFormFromBackend(F,L,D){this.dynamicFormService.getSettingsFromBackend$(F,L,D).pipe((0,n.K)(G=>{throw this.toastService.addError(this.text.load_error_message),G})).subscribe(G=>this.setupDynamicForm(G))}setupDynamicFormFromSettings(F){const L={_embedded:{payload:null==F?void 0:F.payload,schema:null==F?void 0:F.schema}},D=this.dynamicFormService.getSettings(L);this.setupDynamicForm(D)}setupDynamicForm({fields:F,model:L,form:D}){this.fieldsSettingsPipe&&(F=this.fieldsSettingsPipe(F)),this.fieldGroups&&(F=this.dynamicFieldsService.getFormlyFormWithFieldGroups(this.fieldGroups,F));const G=this.resourceId||(0,b.Z)(this.resourcePath||null);L.id=G,this.fields=F,this.innerModel=L,this.form=this.dynamicFormGroup||D,this.changeDetectorRef.detectChanges()}showSuccessNotification(F){const L=(()=>{var D;return(null==F?void 0:F.jobId)?`${(null===(D=null==F?void 0:F.payload)||void 0===D?void 0:D.title)||""} ${this.text.job_started}`:"patch"===this.formHttpMethod?this.text.successful_update:this.text.successful_create})();this.toastService.addSuccess(L)}}S.\u0275fac=function(F){return new(F||S)(i.Y36(y),i.Y36(C),i.Y36(d.D),i.Y36(h.j),i.Y36(l.kl),i.Y36(i.sBO),i.Y36(k.D))},S.\u0275cmp=i.Xpm({type:S,selectors:[["op-dynamic-form"]],viewQuery:function(F,L){if(1&F&&i.Gf(e.T7,5),2&F){let D;i.iGM(D=i.CRH())&&(L.dynamicForm=D.first)}},inputs:{formUrl:"formUrl",formHttpMethod:"formHttpMethod",resourcePath:"resourcePath",resourceId:"resourceId",settings:"settings",dynamicFormGroup:"dynamicFormGroup",initialPayload:"initialPayload",model:"model",fieldsSettingsPipe:"fieldsSettingsPipe",fieldGroups:"fieldGroups",showNotifications:"showNotifications",showValidationErrorsOn:"showValidationErrorsOn",handleSubmit:"handleSubmit",helpTextAttributeScope:"helpTextAttributeScope"},outputs:{modelChange:"modelChange",submitted:"submitted",errored:"errored"},features:[i._Bn([y,C]),i.qOj,i.TTD],decls:2,vars:2,consts:[["data-qa","op-form--container","class","op-form",3,"formGroup","submit",4,"ngIf"],["data-qa","op-form--container","class","op-form--fieldset",3,"form","model","fields","modelChange",4,"ngIf"],["data-qa","op-form--container",1,"op-form",3,"formGroup","submit"],[1,"op-form--fieldset",3,"form","model","fields","modelChange"],["class","op-form--submit",4,"ngIf"],[1,"op-form--submit"],["type","submit",1,"button","-highlight",3,"disabled"],["type","button",1,"button",3,"click"],["data-qa","op-form--container",1,"op-form--fieldset",3,"form","model","fields","modelChange"]],template:function(F,L){1&F&&(i.YNc(0,T,3,5,"form",0),i.YNc(1,M,1,3,"formly-form",1)),2&F&&(i.Q6J("ngIf",L.form&&L.handleSubmit),i.xp6(1),i.Q6J("ngIf",L.form&&!L.handleSubmit))},directives:[P.O5,O._Y,O.JL,O.sg,e.T7],styles:[""]})},64775:(X,I,t)=>{"use strict";t.d(I,{r:()=>st});var i=t(54364),e=t(66586),d=t(3353),h=t(36868),r=t(53882),n=t(1707),l=t(2316);class a extends e.fS{}a.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(a)))(J||a)}}(),a.\u0275cmp=l.Xpm({type:a,selectors:[["op-text-input"]],features:[l.qOj],decls:1,vars:4,consts:[[1,"op-input",3,"type","formControl","formlyAttributes"]],template:function(ce,J){1&ce&&l._UZ(0,"input",0),2&ce&&(l.Q6J("type",J.to.type)("formControl",J.formControl)("formlyAttributes",J.field),l.uIk("aria-required",J.to.required))},directives:[n.Fj,n.JJ,n.oH,e.VQ],styles:[""]});class m extends e.fS{}function v(Me,ce){if(1&Me&&(l._UZ(0,"b",3),l._uU(1)),2&Me){const J=ce.searchTerm,W=l.oxw();l.Q6J("textContent",W.to.text.add_new_action),l.xp6(1),l.hij(": ",J," ")}}function c(Me,ce){if(1&Me&&(l.TgZ(0,"div",4),l._uU(1),l.qZA()),2&Me){const J=ce.item,W=ce.searchTerm;l.Q6J("ngOptionHighlight",W),l.xp6(1),l.Oqu(J.name)}}m.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(m)))(J||m)}}(),m.\u0275cmp=l.Xpm({type:m,selectors:[["op-integer-input"]],features:[l.qOj],decls:1,vars:5,consts:[[1,"op-input",3,"type","formControl","formlyAttributes"]],template:function(ce,J){1&ce&&l._UZ(0,"input",0),2&ce&&(l.Q6J("type",J.to.type)("formControl",J.formControl)("formlyAttributes",J.field),l.uIk("aria-required",J.to.required)("lang",J.to.locale))},directives:[n.Fj,n.JJ,n.oH,e.VQ],styles:[""]});class p extends e.fS{}p.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(p)))(J||p)}}(),p.\u0275cmp=l.Xpm({type:p,selectors:[["op-select-input"]],features:[l.qOj],decls:4,vars:16,consts:[[3,"items","formControl","formlyAttributes","multiple","bindLabel","searchable","virtualScroll","clearable","typeahead","clearOnBackspace","clearSearchOnAdd","hideSelected"],["ng-tag-tmp",""],["ng-option-tmp",""],[3,"textContent"],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight"]],template:function(ce,J){1&ce&&(l.TgZ(0,"ng-select",0),l.ALo(1,"async"),l.YNc(2,v,2,2,"ng-template",1),l.YNc(3,c,2,2,"ng-template",2),l.qZA()),2&ce&&(l.Q6J("items",l.lcZ(1,14,null==J.to?null:J.to.options))("formControl",J.formControl)("formlyAttributes",J.field)("multiple",J.to.multiple)("bindLabel",J.to.bindLabel)("searchable",J.to.searchable)("virtualScroll",J.to.virtualScroll)("clearable",J.to.clearable)("typeahead",J.to.typeahead)("clearOnBackspace",J.to.clearOnBackspace)("clearSearchOnAdd",J.to.clearSearchOnAdd)("hideSelected",J.to.hideSelected),l.uIk("aria-required",J.to.required)("required",J.to.required))},directives:[h.w9,n.JJ,n.oH,e.VQ,n.Q7,h.N6,h.Z2,d.s],pipes:[i.Ov],styles:[""]});var f=t(5443);class C extends e.fS{}C.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(C)))(J||C)}}(),C.\u0275cmp=l.Xpm({type:C,selectors:[["op-project-input"]],features:[l.qOj],decls:1,vars:5,consts:[[3,"formControl","formlyAttributes","url"]],template:function(ce,J){1&ce&&l._UZ(0,"op-project-autocompleter",0),2&ce&&(l.Q6J("formControl",J.formControl)("formlyAttributes",J.field)("url",J.to.allowedValuesHref),l.uIk("aria-required",J.to.required)("required",J.to.required))},directives:[f.F,n.JJ,n.oH,e.VQ,n.Q7],encapsulation:2,changeDetection:0});var u=t(63419);function k(Me,ce){if(1&Me&&(l._UZ(0,"span",3),l.TgZ(1,"span",4),l._uU(2),l.qZA()),2&Me){const J=ce.item,W=l.oxw();l.Q6J("ngClass",W.cssClass(J)),l.xp6(1),l.Q6J("ngClass",W.cssClass(J)),l.xp6(1),l.Oqu(J.name)}}function O(Me,ce){if(1&Me&&(l._UZ(0,"span",3),l.TgZ(1,"span",4),l._uU(2),l.qZA()),2&Me){const J=ce.item,W=l.oxw();l.Q6J("ngClass",W.cssClass(J)),l.xp6(1),l.Q6J("ngClass",W.cssClass(J)),l.xp6(1),l.Oqu(J.name)}}class y extends e.fS{cssClass(ce){return(0,u.p)(ce.id)}}y.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(y)))(J||y)}}(),y.\u0275cmp=l.Xpm({type:y,selectors:[["op-select-project-status-input"]],features:[l.qOj],decls:4,vars:11,consts:[["bindLabel","name",3,"items","formControl","formlyAttributes","searchable","virtualScroll","clearable","clearOnBackspace","clearSearchOnAdd","hideSelected"],["ng-label-tmp",""],["ng-option-tmp",""],[1,"project-status--bulb","-inline",3,"ngClass"],[1,"project-status--name",3,"ngClass"]],template:function(ce,J){1&ce&&(l.TgZ(0,"ng-select",0),l.ALo(1,"async"),l.YNc(2,k,3,3,"ng-template",1),l.YNc(3,O,3,3,"ng-template",2),l.qZA()),2&ce&&l.Q6J("items",l.lcZ(1,9,null==J.to?null:J.to.options))("formControl",J.formControl)("formlyAttributes",J.field)("searchable",!0)("virtualScroll",!0)("clearable",!1)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("hideSelected",!0)},directives:[h.w9,n.JJ,n.oH,e.VQ,h.bb,h.Z2,i.mk],pipes:[i.Ov],encapsulation:2});var b=t(81496);class P{}P.\u0275fac=function(ce){return new(ce||P)},P.\u0275mod=l.oAB({type:P}),P.\u0275inj=l.cJS({imports:[[i.ez,b.I]]});class E extends e.fS{}E.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(E)))(J||E)}}(),E.\u0275cmp=l.Xpm({type:E,selectors:[["op-boolean-input"]],features:[l.qOj],decls:1,vars:3,consts:[["type","checkbox",3,"formControl","formlyAttributes"]],template:function(ce,J){1&ce&&l._UZ(0,"input",0),2&ce&&(l.Q6J("formControl",J.formControl)("formlyAttributes",J.field),l.uIk("aria-required",J.to.required))},directives:[n.Wl,n.JJ,n.oH,e.VQ],styles:[""]});var T=t(96617),M=t(26611);class S{constructor(ce){this.I18n=ce,this.disabled=!1,this.initializationError=!1,this.onChange=()=>{},this.onTouch=()=>{}}get ckEditorContext(){var ce;return{type:this.templateOptions.editorType,macros:"none",options:{rtl:null===(ce=this.templateOptions)||void 0===ce?void 0:ce.rtl}}}ngOnInit(){var ce,J;this.text={attachmentLabel:this.I18n.t("js.label_formattable_attachment_hint"),save:this.I18n.t("js.inplace.button_save",{attribute:null===(ce=this.templateOptions)||void 0===ce?void 0:ce.name}),cancel:this.I18n.t("js.inplace.button_cancel",{attribute:null===(J=this.templateOptions)||void 0===J?void 0:J.name})}}writeValue(ce){this.value=ce}registerOnChange(ce){this.onChange=ce}registerOnTouched(ce){this.onTouch=ce}setDisabledState(ce){this.disabled=ce,this.editor.ckEditorInstance.isReadOnly=ce}onContentChange(ce){const J={raw:ce};this.onTouch(),this.onChange(J)}onCkeditorSetup(ce){this.editor.ckEditorInstance.ui.focusTracker.on("change:isFocused",(J,W,Y)=>{!Y&&!this.touched&&(this.touched=!0,this.onTouch())})}}S.\u0275fac=function(ce){return new(ce||S)(l.Y36(T.D))},S.\u0275cmp=l.Xpm({type:S,selectors:[["op-formattable-control"]],viewQuery:function(ce,J){if(1&ce&&l.Gf(M.F,7),2&ce){let W;l.iGM(W=l.CRH())&&(J.editor=W.first)}},inputs:{templateOptions:"templateOptions"},features:[l._Bn([{provide:n.JU,useExisting:(0,l.Gpc)(()=>S),multi:!0}])],decls:2,vars:2,consts:[[1,"op-ckeditor--wrapper","op-ckeditor-element"],[3,"context","content","onContentChange","onInitializationFailed","onInitialized"]],template:function(ce,J){1&ce&&(l.TgZ(0,"div",0),l.TgZ(1,"op-ckeditor",1),l.NdJ("onContentChange",function(Y){return J.onContentChange(Y)})("onInitializationFailed",function(){return J.initializationError=!0})("onInitialized",function(Y){return J.onCkeditorSetup(Y)}),l.qZA(),l.qZA()),2&ce&&(l.xp6(1),l.Q6J("context",J.ckEditorContext)("content",null==J.value?null:J.value.raw))},directives:[M.F],styles:[""]});class R extends e.fS{}R.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(R)))(J||R)}}(),R.\u0275cmp=l.Xpm({type:R,selectors:[["op-formattable-textarea-input"]],features:[l.qOj],decls:1,vars:3,consts:[[3,"templateOptions","formControl","formlyAttributes"]],template:function(ce,J){1&ce&&l._UZ(0,"op-formattable-control",0),2&ce&&l.Q6J("templateOptions",J.to)("formControl",J.formControl)("formlyAttributes",J.field)},directives:[S,n.JJ,n.oH,e.VQ],styles:[""]});var F=t(57958),L=t(18252),D=t(22784);function G(Me,ce){if(1&Me&&(l.TgZ(0,"op-form-field",2),l.GkF(1,3,4),l._UZ(3,"formly-validation-message",5),l.qZA()),2&Me){const J=l.oxw();l.Q6J("control",null==J.field?null:J.field.formControl)("label",null==J.to?null:J.to.label)("hidden",null==J.field?null:J.field.hide)("noWrapLabel",null==J.to?null:J.to.noWrapLabel)("required",null==J.to?null:J.to.required)("helpTextAttribute",null==J.to?null:J.to.property)("helpTextAttributeScope",(null==J.to?null:J.to.helpTextAttributeScope)||(null==J.dynamicFormComponent?null:J.dynamicFormComponent.helpTextAttributeScope))("showValidationErrorOn",(null==J.to?null:J.to.showValidationErrorOn)||(null==J.dynamicFormComponent?null:J.dynamicFormComponent.showValidationErrorsOn)),l.uIk("data-qa-field-name",null==J.to?null:J.to.property),l.xp6(3),l.Q6J("field",J.field)}}function Q(Me,ce){if(1&Me&&(l.TgZ(0,"op-checkbox-field",6),l.GkF(1,3,4),l._UZ(3,"formly-validation-message",5),l.qZA()),2&Me){const J=l.oxw();l.Q6J("control",null==J.field?null:J.field.formControl)("label",null==J.to?null:J.to.label)("hidden",null==J.field?null:J.field.hide)("required",null==J.to?null:J.to.required)("helpTextAttribute",null==J.to?null:J.to.property)("helpTextAttributeScope",(null==J.to?null:J.to.helpTextAttributeScope)||(null==J.dynamicFormComponent?null:J.dynamicFormComponent.helpTextAttributeScope))("showValidationErrorOn",(null==J.to?null:J.to.showValidationErrorOn)||(null==J.dynamicFormComponent?null:J.dynamicFormComponent.showValidationErrorsOn)),l.uIk("data-qa-field-name",null==J.to?null:J.to.property),l.xp6(3),l.Q6J("field",J.field)}}class V extends e.n2{constructor(ce){super(),this.dynamicFormComponent=ce}}V.\u0275fac=function(ce){return new(ce||V)(l.Y36(F.r,8))},V.\u0275cmp=l.Xpm({type:V,selectors:[["op-dynamic-field-wrapper"]],features:[l.qOj],decls:2,vars:2,consts:[[3,"control","label","hidden","noWrapLabel","required","helpTextAttribute","helpTextAttributeScope","showValidationErrorOn",4,"ngIf"],[3,"control","label","hidden","required","helpTextAttribute","helpTextAttributeScope","showValidationErrorOn",4,"ngIf"],[3,"control","label","hidden","noWrapLabel","required","helpTextAttribute","helpTextAttributeScope","showValidationErrorOn"],["slot","input"],["fieldComponent",""],["slot","errors",1,"op-form-field--error",3,"field"],[3,"control","label","hidden","required","helpTextAttribute","helpTextAttributeScope","showValidationErrorOn"]],template:function(ce,J){1&ce&&(l.YNc(0,G,4,10,"op-form-field",0),l.YNc(1,Q,4,9,"op-checkbox-field",1)),2&ce&&(l.Q6J("ngIf","booleanInput"!==J.field.type),l.xp6(1),l.Q6J("ngIf","booleanInput"===J.field.type))},directives:[i.O5,L.V,e.u_,D.X],styles:[""],changeDetection:0});var K=t(6894),q=t(2281),se=t(90547);class te extends se.S{constructor(){super(...arguments),this.onControlChange=()=>{},this.onControlTouch=()=>{}}writeValue(ce){this.initialDate=this.formatter(ce)}registerOnChange(ce){this.onControlChange=ce}registerOnTouched(ce){this.onControlTouch=ce}setDisabledState(ce){this.disabled=ce}ngAfterViewInit(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.initializeDatepicker(),this.changeDetectorRef.detectChanges()})})}onInputChange(){const ce=this.inputIsValidDate()?this.parser(this.currentValue):"";this.onControlChange(ce),this.onControlTouch()}closeOnOutsideClick(ce){super.closeOnOutsideClick(ce),this.onControlTouch()}parser(ce){return q(ce,"YYYY-MM-DD",!0).isValid()?ce:null}formatter(ce){if(q(ce,"YYYY-MM-DD",!0).isValid()){const J=this.timezoneService.parseDate(ce);return this.timezoneService.formattedISODate(J)}return""}}te.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(te)))(J||te)}}(),te.\u0275cmp=l.Xpm({type:te,selectors:[["op-date-picker-control"]],inputs:{disabled:["disable","disabled"]},features:[l._Bn([{provide:n.JU,useExisting:(0,l.Gpc)(()=>te),multi:!0}]),l.qOj],decls:2,vars:7,consts:[["type","text",3,"id","name","value","ngClass","size","required","disabled","click","keydown.escape","blur","input"],["dateInput",""]],template:function(ce,J){1&ce&&(l.TgZ(0,"input",0,1),l.NdJ("click",function(){return J.openOnClick()})("keydown.escape",function(){return J.close()})("blur",function(Y){return J.closeOnOutsideClick(Y)})("input",function(){return J.onInputChange()}),l.qZA()),2&ce&&l.Q6J("id",J.id)("name",J.name)("value",J.initialDate||"")("ngClass",J.classes+" op-input")("size",J.size)("required",J.required)("disabled",J.disabled)},directives:[i.mk],encapsulation:2});class ie extends e.fS{}ie.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(ie)))(J||ie)}}(),ie.\u0275cmp=l.Xpm({type:ie,selectors:[["op-date-input"]],features:[l.qOj],decls:1,vars:4,consts:[[3,"required","disable","formControl","formlyAttributes"]],template:function(ce,J){1&ce&&l._UZ(0,"op-date-picker-control",0),2&ce&&l.Q6J("required",J.to.required)("disable",J.to.disabled)("formControl",J.formControl)("formlyAttributes",J.field)},directives:[te,n.Q7,n.JJ,n.oH,e.VQ],styles:[""]});const le=function(Me){return{"op-fieldset_collapsed":Me}};function oe(Me,ce){if(1&Me){const J=l.EpF();l.TgZ(0,"fieldset",2),l.TgZ(1,"legend",3),l.TgZ(2,"button",4),l.NdJ("click",function(){l.CHM(J);const Y=l.oxw();return Y.to.collapsibleFieldGroupsCollapsed=!Y.to.collapsibleFieldGroupsCollapsed}),l._uU(3),l.qZA(),l.qZA(),l.TgZ(4,"div",5),l.GkF(5,null,6),l.qZA(),l.qZA()}if(2&Me){const J=l.oxw();l.Q6J("ngClass",l.VKq(2,le,J.to.collapsibleFieldGroupsCollapsed)),l.xp6(3),l.hij(" ",J.to.label," ")}}function ne(Me,ce){if(1&Me&&(l.TgZ(0,"fieldset",7),l.TgZ(1,"legend",3),l._uU(2),l.qZA(),l.TgZ(3,"div",5),l.GkF(4,null,6),l.qZA(),l.qZA()),2&Me){const J=l.oxw();l.xp6(2),l.Oqu(J.to.label)}}class fe extends e.n2{}fe.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(fe)))(J||fe)}}(),fe.\u0275cmp=l.Xpm({type:fe,selectors:[["op-dynamic-field-group-wrapper"]],features:[l.qOj],decls:2,vars:2,consts:[["class","op-fieldset op-fieldset_collapsible",3,"ngClass",4,"ngIf"],["class","op-fieldset",4,"ngIf"],[1,"op-fieldset","op-fieldset_collapsible",3,"ngClass"],[1,"op-fieldset--legend"],["title","Show/hide","type","button",1,"op-fieldset--toggle",3,"click"],[1,"op-fieldset--fields"],["fieldComponent",""],[1,"op-fieldset"]],template:function(ce,J){1&ce&&(l.YNc(0,oe,7,4,"fieldset",0),l.YNc(1,ne,6,1,"fieldset",1)),2&ce&&(l.Q6J("ngIf",null==J.to?null:J.to.collapsibleFieldGroups),l.xp6(1),l.Q6J("ngIf",!(null!=J.to&&J.to.collapsibleFieldGroups)))},directives:[i.O5,i.mk],styles:[""]});var ve=t(97779),Se=t(76315);class Oe{}Oe.\u0275fac=function(ce){return new(ce||Oe)},Oe.\u0275mod=l.oAB({type:Oe}),Oe.\u0275inj=l.cJS({imports:[[i.ez,ve.$,Se.s]]});var je=t(21757),tt=t(90127);class He extends e.fS{ngOnInit(){var ce;this.projectId=null===(ce=this.model)||void 0===ce?void 0:ce.id}}He.\u0275fac=function(){let Me;return function(J){return(Me||(Me=l.n5z(He)))(J||He)}}(),He.\u0275cmp=l.Xpm({type:He,selectors:[["op-user-input"]],features:[l.qOj],decls:1,vars:6,consts:[[3,"formControl","formlyAttributes","url","inviteUserToProject"]],template:function(ce,J){1&ce&&l._UZ(0,"op-user-autocompleter",0),2&ce&&(l.Q6J("formControl",J.formControl)("formlyAttributes",J.field)("url",J.to.allowedValuesHref)("inviteUserToProject",J.projectId),l.uIk("aria-required",J.to.required)("required",J.to.required))},directives:[tt.U,n.JJ,n.oH,e.VQ,n.Q7],encapsulation:2,changeDetection:0});class st{}st.\u0275fac=function(ce){return new(ce||st)},st.\u0275mod=l.oAB({type:st}),st.\u0275inj=l.cJS({imports:[[i.ez,n.UX,e.X0.forRoot({types:[{name:"booleanInput",component:E},{name:"integerInput",component:m},{name:"textInput",component:a},{name:"dateInput",component:ie},{name:"selectInput",component:p},{name:"projectInput",component:C},{name:"selectProjectStatusInput",component:y},{name:"formattableInput",component:R},{name:"userInput",component:He}],wrappers:[{name:"op-dynamic-field-group-wrapper",component:fe},{name:"op-dynamic-field-wrapper",component:V}]}),r.JF,je.H,h.A0,d._,K.Y,P,Oe]]})},77616:(X,I,t)=>{"use strict";t.d(I,{mE:()=>k,U$:()=>O,s5:()=>y});var i=t(3786),e=t(2316),d=t(96617),h=t(49951),r=t(29161),n=t(54364),l=t(1707),a=t(84312),m=t(2775);const v=["editableTitleInput"];function c(b,P){if(1&b){const E=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(M){return e.CHM(E),e.oxw(2).save(M,!0)}),e._UZ(1,"op-icon",8),e.qZA()}if(2&b){const E=e.oxw(2);e.uIk("title",E.text.query_has_changed_click_to_save)}}const p=function(b,P){return{"-error":b,"-changed":P}};function f(b,P){if(1&b){const E=e.EpF();e.TgZ(0,"div",2),e.NdJ("focusout",function(M){return e.CHM(E),e.oxw().saveWhenFocusOutside(M)}),e.YNc(1,c,2,1,"button",3),e.TgZ(2,"input",4,5),e.NdJ("focus",function(M){return e.CHM(E),e.oxw().onFocus(M)})("blur",function(){return e.CHM(E),e.oxw().onBlur()})("keydown.escape",function(M){return e.CHM(E),e.oxw().reset(M)})("keydown.enter",function(M){return e.CHM(E),e.oxw().save(M)})("ngModelChange",function(M){e.CHM(E);return e.oxw().selectedTitle=M}),e.qZA(),e.TgZ(4,"input-shim",6),e._uU(5),e.qZA(),e.qZA()}if(2&b){const E=e.oxw();e.xp6(1),e.Q6J("ngIf",E.showSave),e.xp6(1),e.Q6J("opAutofocus",E.initialFocus||void 0)("ngModel",E.selectedTitle)("disabled",E.inFlight)("ngClass",e.WLB(10,p,E.isEmpty,E.showSave)),e.uIk("name",E.selectableTitleIdentifier)("placeholder",E.text.input_placeholder)("title",E.text.input_title),e.xp6(3),e.AsE("",E.selectedTitle||E.text.input_placeholder,"",E.selectedTitle?"\xa0\xa0":"","")}}const C=function(b,P){return{"-disabled":b,"-small":P}};function u(b,P){if(1&b&&(e.TgZ(0,"h2",9),e._uU(1),e.qZA()),2&b){const E=e.oxw();e.Q6J("ngClass",e.WLB(3,C,E.disabled,E.smallHeader)),e.uIk("title",E.selectedTitle),e.xp6(1),e.hij("",E.selectedTitle,"\n")}}const k="op:selectableTitle:trigger",O="editable-toolbar-title";class y{constructor(P){this.injector=P,this.editable=!0,this.inFlight=!1,this.showSaveCondition=!1,this.initialFocus=!1,this.smallHeader=!1,this.onSave=new e.vpe,this.onEmptySubmit=new e.vpe,this.baseClass=!0,this.selectableTitleIdentifier=O,this.text={click_to_edit:this.I18n.t("js.work_packages.query.click_to_edit_query_name"),press_enter_to_save:this.I18n.t("js.label_press_enter_to_save"),query_has_changed_click_to_save:this.I18n.t("js.label_view_has_changed"),input_title:"",input_placeholder:this.I18n.t("js.work_packages.query.rename_query_placeholder"),confirm_edit_cancel:this.I18n.t("js.work_packages.query.confirm_edit_cancel"),duplicate_query_title:this.I18n.t("js.work_packages.query.errors.duplicate_query_title")}}get editableClass(){return this.editable}ngOnInit(){this.text.input_title=`${this.text.click_to_edit} ${this.text.press_enter_to_save}`,jQuery(this.elementRef.nativeElement).on(k,(P,E="")=>{!this.inputField||(this.selectedTitle=E,setTimeout(()=>{this.inputField.nativeElement.focus()},20),P.stopPropagation())})}ngOnChanges(P){if(P.inputTitle&&(this.selectedTitle=P.inputTitle.currentValue),P.initialFocus&&P.initialFocus.firstChange&&this.inputField){const E=this.inputField.nativeElement;this.selectInputOnInitalFocus(E)}}onFocus(P){this.toggleToolbarButtonVisibility(!0),this.selectInputOnInitalFocus(P.target)}onBlur(){this.toggleToolbarButtonVisibility(!1)}selectInputOnInitalFocus(P){this.initialFocus&&(P.select(),this.initialFocus=!1)}saveWhenFocusOutside(P){(0,h.w)(this.elementRef.nativeElement,()=>this.save(P))}reset(){this.resetInputField(),this.selectedTitle=this.inputTitle}get showSave(){return this.editable&&this.showSaveCondition}save(P,E=!1){P.preventDefault(),this.resetInputField(),this.selectedTitle=this.selectedTitle.trim(),this.isEmpty?this.onEmptyError():!E&&this.inputTitle===this.selectedTitle||(this.inputField&&this.inputField.nativeElement.blur(),!this.inFlight&&(this.inFlight=!0,this.emitSave(this.selectedTitle),setTimeout(()=>this.inFlight=!1,100)))}get isEmpty(){return""===this.selectedTitle}emitSave(P){this.onSave.emit(P)}onEmptyError(){this.onEmptySubmit.emit(),this.focusInputOnError()}focusInputOnError(){if(this.inputField){const P=this.inputField.nativeElement;P.classList.add("-error"),P.focus()}}resetInputField(){this.inputField&&this.inputField.nativeElement.classList.remove("-error")}toggleToolbarButtonVisibility(P){jQuery(".toolbar-items").toggleClass("hidden-for-mobile",P)}}y.\u0275fac=function(P){return new(P||y)(e.Y36(e.zs3))},y.\u0275cmp=e.Xpm({type:y,selectors:[["editable-toolbar-title"]],viewQuery:function(P,E){if(1&P&&e.Gf(v,5),2&P){let T;e.iGM(T=e.CRH())&&(E.inputField=T.first)}},hostVars:4,hostBindings:function(P,E){2&P&&e.ekj("title-container",E.baseClass)("title-container_editable",E.editableClass)},inputs:{inputTitle:["title","inputTitle"],editable:"editable",inFlight:"inFlight",showSaveCondition:"showSaveCondition",initialFocus:"initialFocus",smallHeader:"smallHeader"},outputs:{onSave:"onSave",onEmptySubmit:"onEmptySubmit"},features:[e.TTD],decls:2,vars:2,consts:[["class","editable-toolbar-title--container",3,"focusout",4,"ngIf"],["class","editable-toolbar-title--fixed",3,"ngClass",4,"ngIf"],[1,"editable-toolbar-title--container",3,"focusout"],["type","button","class","spot-link editable-toolbar-title--save",3,"click",4,"ngIf"],["size","1","type","text","aria-required","true",1,"editable-toolbar-title--input","-border-on-hover-only","toolbar--editable-toolbar","ellipsis",3,"opAutofocus","ngModel","disabled","ngClass","focus","blur","keydown.escape","keydown.enter","ngModelChange"],["editableTitleInput",""],[1,"editable-toolbar-title--input","editable-toolbar-title--input-shim","toolbar--editable-toolbar"],["type","button",1,"spot-link","editable-toolbar-title--save",3,"click"],["icon-classes","icon icon-save icon-no-color"],[1,"editable-toolbar-title--fixed",3,"ngClass"]],template:function(P,E){1&P&&(e.YNc(0,f,6,13,"div",0),e.YNc(1,u,2,6,"h2",1)),2&P&&(e.Q6J("ngIf",E.editable),e.xp6(1),e.Q6J("ngIf",!E.editable))},directives:[n.O5,l.Fj,a.U,l.JJ,l.On,n.mk,m.o],styles:['.editable-toolbar-title--container[_ngcontent-%COMP%]{display:grid;align-items:center;grid-template-columns:auto auto 1fr}.editable-toolbar-title--container[_ngcontent-%COMP%]:before, .editable-toolbar-title--container[_ngcontent-%COMP%]:after{display:block;content:""}.editable-toolbar-title--container[_ngcontent-%COMP%]:before{grid-area:1/1}.editable-toolbar-title--container[_ngcontent-%COMP%]:after{grid-area:1/3}.editable-toolbar-title--fixed[_ngcontent-%COMP%]{padding:0;cursor:default}.editable-toolbar-title--save[_ngcontent-%COMP%]{grid-area:1/1}.editable-toolbar-title--save[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{color:#5f5f5f}.editable-toolbar-title--save[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]:before{color:#2c2c2c}.editable-toolbar-title--input[_ngcontent-%COMP%]{color:#5f5f5f}.editable-toolbar-title--input[_ngcontent-%COMP%]:focus{border-color:#999;box-shadow:0 0 0 1px #999}.editable-toolbar-title--input.-changed[_ngcontent-%COMP%]{font-style:italic}.editable-toolbar-title--input[_ngcontent-%COMP%]{display:block;grid-area:1/2;padding-left:5px;width:auto;min-width:1em}.editable-toolbar-title--input-shim[_ngcontent-%COMP%]{visibility:hidden;white-space:pre}input-shim[_ngcontent-%COMP%]{border:1px solid transparent;padding:.375rem;margin:0}']}),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",e.SBq)],y.prototype,"elementRef",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",d.D)],y.prototype,"I18n",void 0)},17076:(X,I,t)=>{"use strict";t.d(I,{K:()=>d});var i=t(80261),e=t(2316);class d{constructor(r,n,l){this.componentFactoryResolver=r,this.appRef=n,this.injector=l}render(r,n){r.innerHTML=n;const l=[];return i.Z.getEmbeddable().forEach(a=>{const m=r.querySelectorAll(a.selector);for(let v=0,c=m.length;v<c;v++){const f=this.componentFactoryResolver.resolveComponentFactory(a.cls).create(this.injector,[],m[v]);l.push(f),this.appRef.attachView(f.hostView),f.changeDetectorRef.detectChanges()}}),()=>{l.forEach(a=>{this.appRef.detachView(a.hostView),a.destroy()}),l.length=0,r.innerHTML=""}}}d.\u0275fac=function(r){return new(r||d)(e.LFG(e._Vd),e.LFG(e.z2F),e.LFG(e.zs3))},d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac})},37130:(X,I,t)=>{"use strict";t.d(I,{j:()=>h});var i=t(3786),e=t(70233),d=t(2316);class h{constructor(n){this.PathHelper=n,this.loadedLocale="en"}create(n,l,a=null){return(0,i.mG)(this,void 0,void 0,function*(){yield this.load();const{type:m}=l,v="constrained"===m?window.OPConstrainedEditor:window.OPClassicEditor;n.classList.add(`ckeditor-type-${m}`);const c=n.querySelector(".document-editor__toolbar"),p=n.querySelector(".document-editor__editable"),f=this.loadedLocale,C=l.options&&l.options.rtl?"ar":"en",u={openProject:this.createConfig(l),initialData:a,language:{ui:f,content:C}};return this.createWatchdog(v,p,u).then(k=>{const{editor:O}=k;return c.appendChild(O.ui.view.toolbar.element),jQuery(n).on("op:ckeditor:setData",(y,b)=>O.setData(b)).on("op:ckeditor:clear",()=>O.setData(" ")).on("op:ckeditor:getData",(y,b)=>b(O.getData({trim:!1}))),k})})}createWatchdog(n,l,a){const m=new window.OPEditorWatchdog;return m.setCreator(()=>n.createCustomized(l,a)),m.setDestructor(v=>v.destroy()),m.create(l,{}).then(()=>m)}load(){return(0,i.mG)(this,void 0,void 0,function*(){yield t.e("src_vendor_ckeditor_ckeditor_js").then(t.t.bind(t,24626,23));try{yield t(87983)(`./${I18n.locale}.js`),this.loadedLocale=I18n.locale}catch(n){console.warn(`Failed to load translation for CKEditor: ${n}`)}})}createConfig(n){return"none"===n.macros?n.macros=!1:"resource"===n.macros&&(n.macros=["OPMacroToc","OPMacroEmbeddedTable","OPMacroWpButton"]),{context:n,helpURL:this.PathHelper.textFormattingHelp(),pluginContext:window.OpenProject.pluginContext.value}}}h.\u0275fac=function(n){return new(n||h)(d.LFG(e.j))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},26611:(X,I,t)=>{"use strict";t.d(I,{F:()=>c});var i=t(2316),e=t(36293),d=t(96617),h=t(12877),r=t(37130),n=t(54364);const l=["opCkeditorReplacementContainer"],a=["codeMirrorPane"];function m(p,f){if(1&p&&(i.TgZ(0,"div",6),i.TgZ(1,"div",7),i.TgZ(2,"p"),i._UZ(3,"strong",8),i._UZ(4,"br"),i._UZ(5,"span",8),i.qZA(),i.qZA(),i.qZA()),2&p){const C=i.oxw();i.xp6(3),i.Q6J("textContent",C.text.errorTitle),i.xp6(2),i.Q6J("textContent",C.error)}}class c{constructor(f,C,u,k,O){this.elementRef=f,this.Notifications=C,this.I18n=u,this.configurationService=k,this.ckEditorSetup=O,this.onInitialized=new i.vpe,this.onContentChange=new i.vpe,this.onInitializationFailed=new i.vpe,this.error=null,this.allowManualMode=!1,this.manualMode=!1,this._content="",this.text={errorTitle:this.I18n.t("js.editor.ckeditor_error")},this.debouncedEmitter=_.debounce(()=>{this.getTransformedContent(!1).then(y=>{this.onContentChange.emit(y)})},1e3,{leading:!0})}set content(f){this._content=f||"",this.initialized&&this.ckEditorInstance.setData(this._content)}getRawData(){return this.manualMode?this._content=this.codeMirrorInstance.getValue():this._content=this.ckEditorInstance.getData({trim:!1})}getTransformedContent(f=!0){if(!this.initialized)throw new Error("Tried to access CKEditor instance before initialization.");return new Promise((C,u)=>{try{C(this.getRawData())}catch(k){console.error(`Failed to save CKEditor content: ${k}.`);const O=this.I18n.t("js.editor.error_saving_failed",{error:k||this.I18n.t("js.error.internal")});f&&this.Notifications.addError(O),u(O)}})}get content(){return this._content}get initialized(){return void 0!==this.ckEditorInstance}ngOnInit(){try{this.initializeEditor()}catch(f){console.error(`Failed to setup CKEditor instance: ${f}`),this.error=f,this.onInitializationFailed.emit(f)}}ngOnDestroy(){var f;try{null===(f=this.watchdog)||void 0===f||f.destroy()}catch(C){console.error("Failed to destroy CKEditor instance:",C)}}initializeEditor(){this.$element=jQuery(this.elementRef.nativeElement);const f=this.ckEditorSetup.create(this.opCkeditorReplacementContainer.nativeElement,this.context,this.content).catch(C=>{throw C}).then(C=>(this.setupWatchdog(C),this.ckEditorInstance=C.editor,C.editor.model.document.on("change",this.debouncedEmitter),C.editor.on("op:source-code-enabled",()=>this.enableManualMode()),C.editor.on("op:source-code-disabled",()=>this.disableManualMode()),this.onInitialized.emit(C.editor),C.editor));this.$element.data("editor",f)}disableManualMode(){const f=this.getRawData();this.ckEditorInstance.setData(f),this.codeMirrorInstance=null,this.manualMode=!1}enableManualMode(){const f=this.getRawData();Promise.all([t.e("default-node_modules_codemirror_lib_codemirror_js").then(t.t.bind(t,21302,23)),t(30341)("./gfm/gfm.js")]).then(u=>{const k=u[0].default;this.codeMirrorInstance=k(this.$element.find(".ck-editor__source")[0],{lineNumbers:!0,smartIndent:!0,value:f,mode:""}),this.codeMirrorInstance.on("change",this.debouncedEmitter),setTimeout(()=>this.codeMirrorInstance.refresh(),100),this.manualMode=!0})}setupWatchdog(f){this.watchdog=f,f.on("error",(C,{error:u})=>{this.error=u.message})}}c.\u0275fac=function(f){return new(f||c)(i.Y36(i.SBq),i.Y36(e.kl),i.Y36(d.D),i.Y36(h.e),i.Y36(r.j))},c.\u0275cmp=i.Xpm({type:c,selectors:[["op-ckeditor"]],viewQuery:function(f,C){if(1&f&&(i.Gf(l,7),i.Gf(a,5)),2&f){let u;i.iGM(u=i.CRH())&&(C.opCkeditorReplacementContainer=u.first),i.iGM(u=i.CRH())&&(C.codeMirrorPane=u.first)}},inputs:{context:"context",content:"content"},outputs:{onInitialized:"onInitialized",onContentChange:"onContentChange",onInitializationFailed:"onInitializationFailed"},decls:7,vars:1,consts:[["class","op-toast -error",4,"ngIf"],[1,"op-ckeditor-source-element","document-editor"],["opCkeditorReplacementContainer",""],[1,"document-editor__toolbar"],[1,"document-editor__editable-container"],[1,"document-editor__editable"],[1,"op-toast","-error"],[1,"op-toast--content"],[3,"textContent"]],template:function(f,C){1&f&&(i.ynx(0),i.YNc(1,m,6,2,"div",0),i.TgZ(2,"div",1,2),i._UZ(4,"div",3),i.TgZ(5,"div",4),i._UZ(6,"div",5),i.qZA(),i.qZA(),i.BQk()),2&f&&(i.xp6(1),i.Q6J("ngIf",C.error))},directives:[n.O5],styles:[".op-ckeditor--mode-switch[_ngcontent-%COMP%]{text-align:right}.op-ckeditor--mode-switch[_ngcontent-%COMP%]   button.button[_ngcontent-%COMP%]{margin:0 0 5px}"]})},97779:(X,I,t)=>{"use strict";t.d(I,{$:()=>m});var i=t(1707),e=t(54364),d=t(31283),h=t(55811),r=t(37130),n=t(17076),l=t(82170),a=t(2316);class m{}m.\u0275fac=function(c){return new(c||m)},m.\u0275mod=a.oAB({type:m}),m.\u0275inj=a.cJS({providers:[l.f,r.j,n.K],imports:[[i.u5,e.ez,d.Z,h.K]]})},8158:(X,I,t)=>{"use strict";t.d(I,{z:()=>f,P:()=>C});var i=t(73881),e=t(96617),d=t(97656),h=t(77355),r=t(70233),n=t(45410),l=t(27779),a=t(2316),m=t(54364),v=t(2775);function c(u,k){if(1&u&&(a.TgZ(0,"a",13),a._UZ(1,"op-icon",14),a._uU(2),a.qZA()),2&u){const O=a.oxw();a.uIk("href",O.moreInfoLink,a.LSH),a.xp6(2),a.hij(" ",O.text.more_info_text," ")}}const p=function(u){return{"-left-margin":u}},f="op-enterprise-banner";class C{constructor(k,O,y,b,P,E){this.elementRef=k,this.I18n=O,this.bannersService=y,this.opModalService=b,this.injector=P,this.pathHelper=E,this.leftMargin=!1,this.pricingUrl=l.wp,this.text={enterpriseFeature:this.I18n.t("js.upsale.ee_only"),become_hero:this.I18n.t("js.admin.enterprise.upsale.become_hero"),you_contribute:this.I18n.t("js.admin.enterprise.upsale.you_contribute"),button_trial:this.I18n.t("js.admin.enterprise.upsale.button_start_trial"),upgrade:this.I18n.t("js.admin.enterprise.upsale.button_upgrade"),more_info_link:`${this.pathHelper.appBasePath}/admin/enterprise`,more_info_text:this.I18n.t("js.admin.enterprise.upsale.more_info")},this.image={enterprise_edition:(0,d.h)("enterprise_edition.png")},(0,n.E)(this)}ngOnInit(){this.link=this.bannersService.getEnterPriseEditionUrl({referrer:this.opReferrer})}}C.\u0275fac=function(k){return new(k||C)(a.Y36(a.SBq),a.Y36(e.D),a.Y36(i.j),a.Y36(h.S),a.Y36(a.zs3),a.Y36(r.j))},C.\u0275cmp=a.Xpm({type:C,selectors:[["op-enterprise-banner"]],inputs:{leftMargin:"leftMargin",textMessage:"textMessage",linkMessage:"linkMessage",opReferrer:"opReferrer",moreInfoLink:"moreInfoLink"},decls:20,vars:13,consts:[["data-qa-selector","op-enterprise-banner",1,"op-enterprise-banner"],[1,"op-toast","-ee-upsale",3,"ngClass"],[1,"hidden-for-mobile","op-enterprise-banner--image",3,"src"],[1,"op-toast--content"],[1,"op-enterprise-banner--title"],["icon-classes","button--icon icon-medal"],[3,"textContent"],[1,"op-enterprise-banner--description",3,"innerHtml"],[1,"op-enterprise-banner--description"],[1,"op-enterprise-banner--buttons"],["class","button--link  op-enterprise-banner--info-button","target","\u201d_blank\u201d",4,"ngIf"],["target","\u201d_blank\u201d",1,"button","-highlight",3,"href"],["target","\u201d_blank\u201d",1,"button","-alt-highlight"],["target","\u201d_blank\u201d",1,"button--link","op-enterprise-banner--info-button"],["icon-classes","icon icon-external-link"]],template:function(k,O){1&k&&(a.TgZ(0,"div",0),a.TgZ(1,"div",1),a._UZ(2,"img",2),a.TgZ(3,"div",3),a.TgZ(4,"div",4),a._UZ(5,"op-icon",5),a._uU(6," \xa0 "),a._UZ(7,"span",6),a.qZA(),a._UZ(8,"br"),a._UZ(9,"span",7),a.TgZ(10,"span",8),a._UZ(11,"strong",6),a._uU(12),a.qZA(),a.TgZ(13,"div",9),a.YNc(14,c,3,2,"a",10),a.TgZ(15,"a",11),a._UZ(16,"op-icon",5),a._uU(17),a.qZA(),a.TgZ(18,"a",12),a._uU(19),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA()),2&k&&(a.xp6(1),a.Q6J("ngClass",a.VKq(11,p,O.leftMargin)),a.xp6(1),a.Q6J("src",O.image.enterprise_edition,a.LSH),a.xp6(5),a.Q6J("textContent",O.text.enterpriseFeature),a.xp6(2),a.Q6J("innerHtml",O.textMessage,a.oJD),a.xp6(2),a.Q6J("textContent",O.text.become_hero),a.xp6(1),a.hij(" ",O.text.you_contribute," "),a.xp6(2),a.Q6J("ngIf",O.moreInfoLink),a.xp6(1),a.Q6J("href",O.pricingUrl,a.LSH),a.xp6(2),a.hij(" ",O.text.upgrade," "),a.xp6(1),a.uIk("href",O.text.more_info_link,a.LSH),a.xp6(1),a.hij(" ",O.text.button_trial," "))},directives:[m.mk,v.o,m.O5],styles:[".op-enterprise-banner--title[_ngcontent-%COMP%]{font-weight:400;font-size:20px;line-height:24px;display:flex;margin-top:10px}.op-enterprise-banner--description[_ngcontent-%COMP%]{display:block;font-family:Lato,sans-serif;font-size:.875rem;font-weight:normal;font-style:normal;line-height:1.25rem;margin-bottom:.75rem}.op-enterprise-banner--image[_ngcontent-%COMP%]{width:115px;height:75px;padding-right:20px;margin:auto}.op-enterprise-banner--buttons[_ngcontent-%COMP%]{display:flex;justify-content:end}.op-enterprise-banner--info-button[_ngcontent-%COMP%]{padding-top:1rem;padding-right:1.5rem}"],changeDetection:0})},94232:(X,I,t)=>{"use strict";t.d(I,{W:()=>m});class i{constructor(){this.changes={}}contains(c){return this.changes.hasOwnProperty(c)}get changed(){return _.keys(this.changes)}get all(){return this.changes}reset(...c){c.forEach(p=>{delete this.changes[p]})}clear(){this.changes={}}set(c,p,f){this.changes[c]={from:f,to:p}}getItem(c){return this.changes[c]}getValue(c){var p;return null===(p=this.getItem(c))||void 0===p?void 0:p.to}getPristine(c){var p;return null===(p=this.changes[c])||void 0===p?void 0:p.from}}var e=t(14808),d=t(3352),h=t(53466),r=t(44022),n=t(81531),l=t(84699);class m{constructor(c,p,f=null){this.state=p,this.changeset=new i,this.form$=(0,e.qH)(),this.cache={},this.inFlight=!1,this.updatePristineResource(c),this.schemaCache=c.injector.get(r.y),f&&this.form$.putValue(f)}push(){this.state&&this.state.putValue(this)}buildRequestPayload(){return this.getForm().then(()=>this.buildPayloadFromChanges())}updatePristineResource(c){if(c.__is_changeset_proxy)throw new Error("You're trying to pass proxy object as a pristine resource. This will cause errors");this._pristineResource=c,this.projectedResource=new Proxy(this._pristineResource,{get:(p,f)=>this.proxyGet(f),set:(p,f,C)=>(this.setValue(f,C),!0)})}get pristineResource(){return this._pristineResource}getForm(c=!1){return!this.form$.isPristine()&&!c||this.form$.hasActivePromiseRequest()?this.form$.values$().pipe((0,h.q)(1)).toPromise():this.updateForm()}updateForm(){const c=this.buildPayloadFromChanges(),p=this.pristineResource.$links.update(c).then(f=>(this.cache={},this.form$.putValue(f),this.setNewDefaults(f),this.push(),f));return this.form$.putFromPromiseIfPristine(()=>p),p}isEmpty(){return 0===this.changeset.changed.length}get id(){return this.pristineResource.id.toString()}get href(){return this.pristineResource.href}get changes(){const c={};return _.each(this.changeset.all,(p,f)=>{c[f]=p.to}),c}get changeMap(){return Object.assign({},this.changeset.all)}get changedAttributes(){return this.changeset.changed}isWritable(c){const p=this.schema.ofProperty(c);return!(!p||!p.writable)}humanName(c){return _.get(this.schema,`${c}.name`,c)}contains(c){return this.changeset.contains(c)}proxyGet(c){return"__is_proxy"===c||this.value(c)}value(c){return this.changeset.contains(c)?this.changeset.getValue(c):this.pristineResource[c]}valueExists(c){return this.changeset.contains(c)||this.pristineResource.hasOwnProperty(c)}setValue(c,p){this.changeset.set(c,p,this.pristineResource[c])}clearValue(...c){this.changeset.reset(...c)}clear(){this.state&&this.state.clear(),this.changeset.clear(),this.cache={},this.form$.clear()}reset(c){this.changeset.reset(c)}isOverridden(c){return this.changes.hasOwnProperty(c)}get schema(){return this.form$.hasValue()?n.V.create(this.form$.value.schema,this.projectedResource):this.schemaCache.of(this.pristineResource)}cacheValue(c,p){return this.cache[c]?this.cache[c]:this.cache[c]=p()}get minimalPayload(){return{lockVersion:this.pristineResource.lockVersion,_links:{}}}applyChanges(c){let p=this.pristineResource.$source;return this.form$.value&&(p=this.form$.value.payload.$source),_.each(this.changeset.all,(f,C)=>{if(!this.schema.isAttributeEditable(C))return void(0,d.qu)(`Trying to write ${C} but is not writable in schema`);const u=this.schema.ofProperty(C);u&&p._links[C]?c._links[C]=this.getLinkedValue(f.to,u):c[C]=f.to}),c}buildPayloadFromChanges(){let c;return(0,l.Z)(this.pristineResource)?(c=this.form$.value?_.cloneDeep(this.form$.value.payload.$source):_.cloneDeep(this.pristineResource.$source),this.pristineResource.attachments&&(c._links.attachments=this.pristineResource.attachments.elements.map(p=>({href:p.href})))):c=this.minimalPayload,this.applyChanges(c)}getLinkedValue(c,p){if(_.isNil(c))return{href:null};const f=(p.type||"").startsWith("[]");let C=!1;if((c.forEach||c.elements)&&(C=!0),C&&f){const u=[];return c&&(c.forEach&&c||c.elements).forEach(O=>{O.href&&u.push({href:O.href})}),u}return{href:_.get(c,"href",null)}}setNewDefaults(c){_.each(c.payload,(p,f)=>{const C=this.schema.ofProperty(f);!(null==C?void 0:C.writable)||this.setNewDefaultFor(f,p)})}setNewDefaultFor(c,p){this.valueExists(c)||((0,d.qu)(`Taking over default value from form for ${c}`),this.setValue(c,p))}}},7812:(X,I,t)=>{"use strict";t.d(I,{uA:()=>E,OZ:()=>b,zZ:()=>P,c0:()=>u,n5:()=>O});var i=t(3786),e=t(96617),d=t(60874),h=t(55741),r=t(79644);class n extends r.L{render(M,S){const R=this.value;M.setAttribute("title",S),M.textContent=S,M.innerHTML="",0===R.length?this.renderEmpty(M):this.renderValues(R,M)}renderValues(M,S){M.forEach(R=>{const F=document.createElement("div");F.classList.add(h.x,"-multiple-lines"),F.setAttribute("title",R),F.textContent=R,S.appendChild(F)})}}var l=t(39469);class a extends l.N{render(M,S){const R=this.percentLabel;M.setAttribute("title",R),M.innerHTML="",M.textContent=R}}var m=t(29161),v=t(32782);class c extends r.L{render(M,S){const R=this.attribute;M.setAttribute("title",S),M.textContent=S,M.innerHTML="",0===R.length?this.renderEmpty(M):this.renderValues(R,M)}renderValues(M,S){this.principalRenderer.renderMultiple(S,M,{hide:!1,link:!1},{hide:!1,size:"medium"},!0)}}(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",v.C)],c.prototype,"principalRenderer",void 0);var p=t(44022),f=t(12703),C=t(63733);const u="-editable",O="-read-only",b="inline-edit--display-field",P="inline-edit--container";class E{constructor(M,S,R={}){this.injector=M,this.container=S,this.options=R,this.fieldCache={}}render(M,S,R){const[F,L]=this.renderFieldValue(M,S,R);return null===F||this.setSpanAttributes(L,F,S,M,R),L}renderFieldValue(M,S,R){const F=document.createElement("span"),L=this.schema(M,R),D=this.attributeName(S,L),G=L.ofProperty(D);if(!G)return[null,F];const Q=this.getField(M,G,D,R);Q.render(F,this.getText(Q),G.options);const{title:V}=Q;return V&&F.setAttribute("title",V),F.setAttribute("aria-label",this.getAriaLabel(Q,L)),[Q,F]}getField(M,S,R,F){let L=this.fieldCache[R];return L||(L=this.fieldCache[R]=this.getFieldForCurrentContext(M,R,S)),L.apply(M,S),L.activeChange=F,L}getFieldForCurrentContext(M,S,R){const F={container:this.container,injector:this.injector,options:this.options},L=["[]CustomOption"].indexOf(R.type)>=0;if("single-view"===this.container&&L)return new n(S,F);const D=["[]User"].indexOf(R.type)>=0;return"single-view"===this.container&&D?new c(S,F):"timeline"===this.container&&"percentageDone"===S?new a(S,F):"table"===this.container&&["startDate","dueDate","date"].includes(S)?new C.C(S,F):this.displayFieldService.getField(M,S,R,F)}getText(M){return M.isEmpty()?M.placeholder:M.valueString}setSpanAttributes(M,S,R,F,L){M.classList.add(b,R),M.dataset.fieldName=R,M.setAttribute("tabindex","id"===R?"-1":"0"),S.required&&M.classList.add("-required"),S.isEmpty()&&M.classList.add("-placeholder");const D=this.schema(F,L);this.isAttributeEditable(D,R)?(M.classList.add(u),M.setAttribute("role","button")):M.classList.add(O)}isAttributeEditable(M,S){return["startDate","dueDate","date"].includes(S)&&(S="combinedDate"),M.isAttributeEditable(S)}getAriaLabel(M,S){let R;const F=this.getLabelContent(M);if(M.isFormattable&&!M.isEmpty())try{R=_.escape(jQuery(`<div>${F}</div>`).text())}catch(L){console.error("Failed to parse formattable labelContent"),R=`Label for ${M.displayName}`}else R=F;return M.writable&&S.isAttributeEditable(M.name)?this.I18n.t("js.inplace.button_edit",{attribute:`${M.displayName} ${R}`}):`${M.displayName} ${R}`}getLabelContent(M){return M.isEmpty()?this.I18n.t("js.inplace.null_value_label"):M.valueString}attributeName(M,S){return S.mappedName?S.mappedName(M):M}schema(M,S){return S?S.schema:this.halEditing.typedState(M).hasValue()?this.halEditing.typedState(M).value.schema:this.schemaCache.of(M)}}(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",d.i)],E.prototype,"displayFieldService",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",p.y)],E.prototype,"schemaCache",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",f.l)],E.prototype,"halEditing",void 0),(0,i.gn)([(0,m.W)(),(0,i.w6)("design:type",e.D)],E.prototype,"I18n",void 0)},55741:(X,I,t)=>{"use strict";t.d(I,{x:()=>r,C:()=>n});var i=t(3786),e=t(82635),d=t(96617),h=t(29161);const r="custom-option";class n extends e.g{constructor(a,m){super(),this.name=a,this.context=m,this.mode=null,this.activeChange=null,this.texts={empty:this.I18n.t("js.label_no_value"),placeholder:this.I18n.t("js.placeholders.default")}}apply(a,m){this.resource=a,this.schema=m}get isFormattable(){return!1}get injector(){return this.context.injector}get value(){return this.schema?this.activeChange?this.activeChange.projectedResource[this.name]:this.attribute:null}get attribute(){return this.resource[this.name]}get type(){return this.constructor.type}get valueString(){return this.value}get placeholder(){return"-"}get label(){return this.schema.name||this.name}get title(){return this.isFormattable?null:this.valueString}render(a,m,v={}){a.textContent=m}renderEmpty(a){const m=document.createElement("div");m.setAttribute("title",this.texts.empty),m.textContent=this.texts.placeholder,m.classList.add(r,"-empty"),a.appendChild(m)}}(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",d.D)],n.prototype,"I18n",void 0)},60874:(X,I,t)=>{"use strict";t.d(I,{i:()=>d});var i=t(39478),e=t(2316);class d extends i.h{getField(r,n,l,a){const v=new(this.getSpecificClassFor(r._type,n,l.type))(n,a);return v.apply(r,l),v}}d.\u0275fac=function(){let h;return function(n){return(h||(h=e.n5z(d)))(n||d)}}(),d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})},74215:(X,I,t)=>{"use strict";t.d(I,{Z:()=>e});var i=t(63733);class e extends i.C{constructor(){super(...arguments),this.text={placeholder:{startDate:this.I18n.t("js.label_no_start_date"),dueDate:this.I18n.t("js.label_no_due_date")}}}render(h,r){h.innerHTML="";const n=this.createDateDisplayField("startDate"),l=this.createDateDisplayField("dueDate"),a=document.createElement("span");a.textContent=" - ",h.appendChild(n),h.appendChild(a),h.appendChild(l)}createDateDisplayField(h){const r=document.createElement("span"),n=new i.C(h,this.context),l=this.resource[h]?this.timezoneService.formattedDate(this.resource[h]):this.text.placeholder[h];return n.apply(this.resource,this.schema),n.render(r,l),r}}},63733:(X,I,t)=>{"use strict";t.d(I,{C:()=>l});var i=t(3786),e=t(50076),d=t(69671),h=t(29161),r=t(61908),n=t(70692);class l extends d.z{render(m,v){if(super.render(m,v),this.showSchedulingMode()){const c=document.createElement("span");c.classList.add("icon-context"),this.resource.scheduleManually&&c.classList.add("icon-pin"),m.prepend(c)}if(this.shouldHighlight&&this.canOverdue){const c=this.timezoneService.daysFromToday(this.value);this.apiV3Service.statuses.id(this.resource.status.id).get().toPromise().then(p=>{p.isClosed||m.classList.add(e.Z.overdueDate(c))})}}get canOverdue(){return-1!==["dueDate","date"].indexOf(this.name)}get valueString(){return this.value?this.timezoneService.formattedDate(this.value):""}showSchedulingMode(){return"startDate"===this.name||"date"===this.name}}(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",n.B)],l.prototype,"timezoneService",void 0),(0,i.gn)([(0,h.W)(),(0,i.w6)("design:type",r.T)],l.prototype,"apiV3Service",void 0)},69671:(X,I,t)=>{"use strict";t.d(I,{z:()=>r});var i=t(3786),e=t(55741),d=t(84897),h=t(29161);class r extends e.C{get highlightName(){return"date"===this.name?"dueDate":this.name}get shouldHighlight(){if(!1===this.context.options.colorize)return!1;const l=!!this.viewHighlighting&&this.viewHighlighting.shouldHighlightInline(this.highlightName);return"table"!==this.context.container||l}}(0,i.gn)([(0,h.W)(d.B,null),(0,i.w6)("design:type",d.B)],r.prototype,"viewHighlighting",void 0)},39469:(X,I,t)=>{"use strict";t.d(I,{N:()=>e});var i=t(55741);class e extends i.C{get value(){return this.schema?this.resource[this.name]||0:null}get percentLabel(){return`${this.roundedProgress}%`}get roundedProgress(){return Math.round(Number(this.value))||0}render(h,r){h.setAttribute("title",r),h.innerHTML=`\n      <span>\n        <span style="width: 80px" class="progress-bar">\n          <span style="width: ${this.roundedProgress}%" class="inner-progress closed"></span>\n          <span style="width: 0%" class="inner-progress done"></span>\n        </span>\n        <span class="progress-bar-legend">${this.percentLabel}</span>\n      </span>\n    `}}},79644:(X,I,t)=>{"use strict";t.d(I,{L:()=>e});var i=t(55741);class e extends i.C{isEmpty(){return _.isEmpty(this.value)}get value(){const h=this.resource[this.name];return this.schema&&h?h.elements?h.elements.map(r=>r.name):h.map?h.map(r=>r.name):h.name?[h.name]:[`error: ${JSON.stringify(h)}`]:[]}render(h,r){const n=this.value;h.innerHTML="",h.setAttribute("title",n.join(", ")),0===n.length?this.renderEmpty(h):this.renderValues(n,h)}renderValues(h,r){const n=document.createDocumentFragment(),l=this.optionDiv(this.valueAbridged(h));if(n.appendChild(l),h.length>2){const a=this.optionDiv(h.length.toString(),"badge","-secondary");n.appendChild(a)}r.appendChild(n)}optionDiv(h,...r){const n=document.createElement("div"),l=document.createElement("span");return n.classList.add(i.x),l.classList.add(...r),l.textContent=h,n.appendChild(l),n}valueAbridged(h){const r=_.take(h,2);return h.length>2&&r.push("... "),r.join(", ")}}},18322:(X,I,t)=>{"use strict";t.d(I,{Dz:()=>n,uS:()=>l,Nm:()=>a,sS:()=>c,su:()=>p});var i=t(2316),d=(t(86029),t(96617)),h=t(82635);t(94232);const n=new i.OlP("editing-portal--schema"),l=new i.OlP("editing-portal--handler"),a=new i.OlP("editing-portal--changeset"),c="-editing";class p extends h.g{constructor(C,u,k,O,y,b,P){super(),this.I18n=C,this.elementRef=u,this.change=k,this.schema=O,this.handler=y,this.cdRef=b,this.injector=P,this.self=this,this.updateFromChangeset(k),this.change.state&&this.change.state.values$().pipe(this.untilDestroyed()).subscribe(E=>{if(!E.schema.ofProperty(this.name))return y.deactivate(!1);this.updateFromChangeset(E),this.initialize(),this.cdRef.markForCheck()})}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.initialize()}get overflowingSelector(){return this.$element?this.$element.closest(".__overflowing_element_container").data("overflowingIdentifier"):null}get inFlight(){return this.handler.inFlight}get value(){return this.resource[this.name]}set value(C){this.resource[this.name]=this.parseValue(C)}get placeholder(){return"subject"===this.name?this.I18n.t("js.placeholders.subject"):""}initialize(){}updateFromChangeset(C){this.change=C,this.resource=this.change.projectedResource,this.schema=this.change.schema.ofProperty(this.handler.fieldName)||this.schema,this.name=this.change.schema.mappedName(this.handler.fieldName)}parseValue(C){return C}}p.\u0275fac=function(C){return new(C||p)(i.Y36(d.D),i.Y36(i.SBq),i.Y36(a),i.Y36(n),i.Y36(l),i.Y36(i.sBO),i.Y36(i.zs3))},p.\u0275dir=i.lG2({type:p,features:[i.qOj]})},84568:(X,I,t)=>{"use strict";t.d(I,{h:()=>d});var i=t(39478),e=t(2316);class d extends i.h{}d.\u0275fac=function(){let h;return function(n){return(h||(h=e.n5z(d)))(n||d)}}(),d.\u0275prov=e.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})},58034:(X,I,t)=>{"use strict";t.d(I,{a:()=>e});var i=t(2316);class e{blockedTransition(h){return!0}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac})},61342:(X,I,t)=>{"use strict";t.d(I,{n:()=>k});var i=t(3786),e=t(2316),d=t(47775),h=t(12877),r=t(14808),n=t(9170),l=t(53466),a=t(33927),m=t(96617),v=t(91260),p=(t(80044),t(37048)),f=t(58034);class C{constructor(y){this.i18nService=y,this.activeForms=new Map,window.addEventListener("beforeunload",b=>{this.thereAreFormsWithUnsavedChanges&&(b.preventDefault(),b.returnValue=this.i18nService.t("js.work_packages.confirm_edit_cancel"))})}get thereAreFormsWithUnsavedChanges(){return Array.from(this.activeForms.keys()).some(y=>!y.change.isEmpty())}addToActiveForms(y){this.activeForms.set(y,!0)}removeFromActiveForms(y){this.activeForms.delete(y)}}C.\u0275fac=function(y){return new(y||C)(e.LFG(m.D))},C.\u0275prov=e.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"});class k extends v.Py{constructor(y,b,P,E,T,M,S,R,F){super(y),this.injector=y,this.elementRef=b,this.$transitions=P,this.ConfigurationService=E,this.editingPortalService=T,this.$state=M,this.I18n=S,this.editFormRouting=R,this.globalEditFormChangesTrackerService=F,this.initializeEditMode=!1,this.skippedFields=[],this.onSavedEmitter=new e.vpe,this.fields={},this.registeredFields=(0,r.qH)();const L=S.t("js.work_packages.confirm_edit_cancel"),D=E.warnOnLeavingUnsaved();this.unregisterListener=P.onBefore({},G=>{if(this.editing){if(!this.editFormRouting||this.editFormRouting.blockedTransition(G)){if(D&&!window.confirm(L))return!1;this.cancel(!1)}return!0}})}ngOnInit(){this.editMode=this.initializeEditMode,this.globalEditFormChangesTrackerService.addToActiveForms(this),this.initializeEditMode&&this.start()}ngOnDestroy(){this.unregisterListener(),this.globalEditFormChangesTrackerService.removeFromActiveForms(this)}activateField(y,b,P,E){return(0,i.mG)(this,void 0,void 0,function*(){return this.waitForField(P).then(T=>{T.setActive(!0);const M=T.editContainer.nativeElement;return this.editingPortalService.create(M,this.injector,y,b,P,E)})})}reset(y,b=!1){return(0,i.mG)(this,void 0,void 0,function*(){const P=yield this.waitForField(y);P.reset(),P.deactivate(b)})}onSaved(y){this.cancel(!1),this.onSavedEmitter.emit({savedResource:y.resource,isInitial:y.wasNew})}cancel(y=!1){this.editMode=!1,this.closeEditFields("all",y),y&&this.halEditing.reset(this.change)}requireVisible(y){return new Promise((b,P)=>{const E=setInterval(()=>{void 0!==this.fields[y]&&(clearInterval(E),b())},50)})}get editing(){return this.editMode||this.hasActiveFields()}register(y){this.fields[y.fieldName]=y,this.registeredFields.putValue(_.keys(this.fields)),(this.editMode&&!this.skipField(y)||this.activeFields[y.fieldName])&&y.activateOnForm(!0)}waitForField(y){return this.registeredFields.values$().pipe((0,n.h)(b=>b.indexOf(y)>=0),(0,l.q)(1),(0,a.U)(()=>this.fields[y])).toPromise()}start(){_.each(this.fields,y=>this.activate(y.fieldName))}focusOnFirstError(){jQuery(this.elementRef.nativeElement).find(`.${v.fA}.-error .${v.as}`).first().trigger("focus")}skipField(y){const{fieldName:b}=y;if(-1===this.skippedFields.indexOf(b))return!1;const E=this.resource[b],T=this.change.changes[b];return E&&!T}}k.\u0275fac=function(y){return new(y||k)(e.Y36(e.zs3),e.Y36(e.SBq),e.Y36(d.TransitionService),e.Y36(h.e),e.Y36(p.b),e.Y36(d.StateService),e.Y36(m.D),e.Y36(f.a,8),e.Y36(C))},k.\u0275cmp=e.Xpm({type:k,selectors:[["edit-form"],["","edit-form",""]],inputs:{resource:"resource",initializeEditMode:["inEditMode","initializeEditMode"],skippedFields:"skippedFields"},outputs:{onSavedEmitter:"onSaved"},features:[e.qOj],ngContentSelectors:["*"],decls:1,vars:0,template:function(y,b){1&y&&(e.F$t(),e.Hsn(0))},encapsulation:2})},91260:(X,I,t)=>{"use strict";t.d(I,{fA:()=>m,as:()=>v,Py:()=>c});var i=t(3786),e=t(87853),d=t(12703),h=t(1403),r=t(29161),n=t(67727),l=t(84699),a=t(8849);const m="inline-edit--active-field",v="inline-edit--field";class c{constructor(f){this.injector=f,this.activeFields={},this.errorsPerAttribute={},this.editMode=!1}onSaved(f){}hasActiveFields(){return!_.isEmpty(this.activeFields)}get change(){return this.halEditing.changeFor(this.resource)}activate(f,C=!1){return this.loadFieldSchema(f,C).then(u=>u.writable||C?this.renderField(f,u):(this.halNotification.showEditingBlockedError(u.name||f),Promise.reject()))}activateWhenNeeded(f){return this.activeFields[f]?Promise.resolve():this.requireVisible(f).then(()=>this.activate(f,!0))}activateMissingFields(){this.change.getForm().then(f=>{_.each(f.validationErrors,(C,u)=>{"id"!==u&&this.activateWhenNeeded(u)})})}submit(){return(0,i.mG)(this,void 0,void 0,function*(){if(this.change.isEmpty()&&!(0,l.Z)(this.resource))return this.closeEditFields(),Promise.resolve(this.resource);this.change.inFlight=!0,this.errorsPerAttribute={};const f=_.keys(this.activeFields);return yield Promise.all(_.map(this.activeFields,C=>C.onSubmit())),new Promise((C,u)=>{this.halEditing.save(this.change).then(k=>{this.closeEditFields(f),C(k.resource),this.halNotification.showSave(k.resource,k.wasNew),this.editMode=!1,this.onSaved(k),this.change.inFlight=!1}).catch(k=>(this.halNotification.handleRawError(k,this.resource),k instanceof a.o&&k.resource&&(this.handleSubmissionErrors(k.resource),u()),this.change.inFlight=!1,Promise.reject(k)))})})}closeEditFields(f="all",C=!0){"all"===f&&(f=_.keys(this.activeFields)),f.forEach(u=>{const k=this.activeFields[u];k&&k.deactivate(!1),C&&this.change.reset(u)})}handleSubmissionErrors(f){this.handleErroneousAttributes(f)}handleErroneousAttributes(f){const C=f.getInvolvedAttributes();this.errorsPerAttribute=f.getMessagesPerAttribute(),0!==C.length&&this.setErrorsForFields(C)}setErrorsForFields(f){const C=f.map(u=>this.requireVisible(u).then(()=>(this.activeFields[u]&&this.activeFields[u].setErrors(this.errorsPerAttribute[u]||[]),this.activateWhenNeeded(u))));Promise.all(C).then(()=>{setTimeout(()=>this.focusOnFirstError())}).catch(()=>{console.error("Failed to activate all erroneous fields.")})}loadFieldSchema(f,C=!1){return new Promise((u,k)=>{this.loadFormAndCheck(f,C);const O=this.change.schema.ofProperty(f);if(!O)throw new Error;u(O)})}loadFormAndCheck(f,C=!1){this.change.getForm().then(()=>{const u=this.change.schema.ofProperty(f);!u.writable&&!C&&(this.halNotification.showEditingBlockedError(u.name||f),this.closeEditFields([f]))}).catch(u=>{console.error("Failed to build edit field: %o",u),this.halNotification.handleRawError(u,this.resource),this.closeEditFields([f])})}renderField(f,C){return this.activateField(this,C,f,this.errorsPerAttribute[f]||[]).then(k=>(this.activeFields[f]=k,k)).catch(k=>{console.error(`Failed to render edit field:${k}`),this.halNotification.handleRawError(k)})}}(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",e.G)],c.prototype,"states",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",d.l)],c.prototype,"halEditing",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",n.W)],c.prototype,"halNotification",void 0),(0,i.gn)([(0,r.W)(),(0,i.w6)("design:type",h.J)],c.prototype,"halEvents",void 0)},86029:(X,I,t)=>{"use strict";t.d(I,{k:()=>d});var i=t(79441),e=t(26942);class d extends e.N{constructor(){super(...arguments),this.onDestroy=new i.xQ,this._onSubmitHandlers=[],this._onBeforeSubmitHandlers=[]}errorMessageOnLabel(){}onSubmit(){return Promise.all(this._onSubmitHandlers.map(r=>r()))}registerOnSubmit(r){this._onSubmitHandlers.push(r)}onBeforeSubmit(){return this._onBeforeSubmitHandlers.map(r=>r())}registerOnBeforeSubmit(r){this._onBeforeSubmitHandlers.push(r)}previewContext(r){}}},92058:(X,I,t)=>{"use strict";t.d(I,{m:()=>f});var i=t(2316),d=(t(86029),t(18322)),h=t(50945),r=t(84568),l=(t(94232),t(54364)),a=t(1707),m=t(32853);function v(C,u){1&C&&i.GkF(0)}const c=function(C){return{"-error":C}};function p(C,u){if(1&C){const k=i.EpF();i.TgZ(0,"div",1),i.TgZ(1,"form",2),i.NdJ("submit",function(){return i.CHM(k),i.oxw().handler.handleUserSubmit()}),i.TgZ(2,"label",3),i._uU(3),i.qZA(),i.YNc(4,v,1,0,"ng-container",4),i.qZA(),i.qZA()}if(2&C){const k=i.oxw();i.Gre("inline-edit--active-field inplace-edit ",k.handler.fieldName,""),i.Q6J("ngClass",i.VKq(9,c,k.handler.isErrorenous)),i.xp6(2),i.Q6J("for",k.handler.htmlId),i.xp6(1),i.AsE(" ",k.handler.fieldLabel," ",k.handler.errorMessageOnLabel()," "),i.xp6(1),i.Q6J("ngComponentOutlet",k.componentClass)("ngComponentOutletInjector",k.fieldInjector)}}class f{constructor(u,k,O){this.injector=u,this.editField=k,this.elementRef=O,this.onEditFieldReady=new i.vpe}ngOnInit(){this.editFieldHandler&&this.schemaInput?(this.handler=this.editFieldHandler,this.schema=this.schemaInput,this.change=this.changeInput):(this.handler=this.injector.get(d.uS),this.schema=this.injector.get(d.Dz),this.change=this.injector.get(d.Nm)),this.componentClass=this.editField.getSpecificClassFor(this.change.pristineResource._type,this.handler.fieldName,this.schema.type),this.fieldInjector=(0,h.E)(this.injector,this.change,this.handler,this.schema)}ngOnDestroy(){this.onEditFieldReady.complete()}ngAfterViewInit(){setTimeout(()=>{this.onEditFieldReady.emit()})}}f.\u0275fac=function(u){return new(u||f)(i.Y36(i.zs3),i.Y36(r.h),i.Y36(i.SBq))},f.\u0275cmp=i.Xpm({type:f,selectors:[["edit-form-portal"]],inputs:{schemaInput:"schemaInput",changeInput:"changeInput",editFieldHandler:"editFieldHandler"},outputs:{onEditFieldReady:"onEditFieldReady"},decls:1,vars:1,consts:[[3,"class","ngClass",4,"ngIf"],[3,"ngClass"],["role","form","tabindex","-1",3,"submit"],[1,"hidden-for-sighted",3,"for"],[4,"ngComponentOutlet","ngComponentOutletInjector"]],template:function(u,k){1&u&&i.YNc(0,p,5,11,"div",0),2&u&&i.Q6J("ngIf",k.handler)},directives:[l.O5,l.mk,a._Y,a.JL,a.F,l.$G,m.dw],encapsulation:2})},50945:(X,I,t)=>{"use strict";t.d(I,{E:()=>d});var i=t(18322),e=t(40912);function d(h,r,n,l){const a=new WeakMap;return a.set(i.Nm,r),a.set(i.uS,n),a.set(i.Dz,l),new e.nK(h,a)}},37048:(X,I,t)=>{"use strict";t.d(I,{b:()=>y});var i=t(40912),e=t(92058),d=t(50945),h=t(53466),r=t(70233),n=t(3786),l=t(33406),a=t(96617),m=t(12877),v=t(7101),c=t(86029),p=t(88837),f=t(3352),C=t(79441),u=t(29161);class k extends c.k{constructor(P,E,T,M,S,R,F){super(),this.injector=P,this.form=E,this.fieldName=T,this.schema=M,this.element=S,this.pathHelper=R,this.withErrors=F,this.$onUserActivate=new C.xQ,void 0!==F&&this.setErrors(F),this.htmlId=`wp-${this.resource.id}-inline-edit--field-${this.fieldName}`,this.fieldLabel=this.schema.name||this.fieldName}stopPropagation(P){return P.stopPropagation(),!1}get inEditMode(){return this.form.editMode}get inFlight(){return this.form.change.inFlight}focus(P){const E=this.element.querySelector(".inline-edit--field");E?(E.focus(),P&&"INPUT"===E.tagName&&(0,p.w)(E,P)):(0,f.qu)(`Tried to focus on ${this.fieldName}, but element does not (yet) exist.`)}onFocusOut(){this.resource.subject&&this.withErrors&&0===this.withErrors.length&&this.handleUserSubmit()}setErrors(P){this.errors=P,this.element.classList.toggle("-error",this.isErrorenous)}handleUserSubmit(){return this.onBeforeSubmit(),this.inFlight||this.form.editMode?Promise.resolve():this.onSubmit().then(()=>this.form.submit())}handleUserKeydown(P,E=!1){return this.inEditMode&&!E?P.which!==l.m.ENTER||(this.form.submit(),!1):P.which!==l.m.ESCAPE||(this.handleUserCancel(),!1)}handleUserCancel(){this.reset()}reset(){this.form.change.reset(this.fieldName),this.deactivate(!0)}deactivate(P=!1){delete this.form.activeFields[this.fieldName],this.onDestroy.next(),this.onDestroy.complete(),this.form.reset(this.fieldName,P)}get isErrorenous(){return this.errors.length>0}isChanged(){return this.form.change.contains(this.fieldName)}get resource(){return this.form.resource}get project(){return this.form.change.projectedResource.project}errorMessageOnLabel(){return this.isErrorenous?this.I18n.t("js.inplace.errors.messages_on_field",{messages:this.errors.join(" ")}):""}previewContext(P){return P.previewPath()}}(0,n.gn)([(0,u.W)(),(0,n.w6)("design:type",v.i)],k.prototype,"FocusHelper",void 0),(0,n.gn)([(0,u.W)(),(0,n.w6)("design:type",m.e)],k.prototype,"ConfigurationService",void 0),(0,n.gn)([(0,u.W)(),(0,n.w6)("design:type",a.D)],k.prototype,"I18n",void 0);var O=t(2316);class y{constructor(P,E,T){this.appRef=P,this.componentFactoryResolver=E,this.pathHelper=T}create(P,E,T,M,S,R){const F=this.createDomOutlet(P,E),L=new k(E,T,S,M,P,this.pathHelper,R);L.onDestroy.pipe((0,h.q)(1)).subscribe(()=>F.detach());const D=(0,d.E)(E,T.change,L,M),G=new i.C5(e.m,null,D);return P.innerHTML="",F.attachComponentPortal(G).instance.onEditFieldReady.pipe((0,h.q)(1)).toPromise().then(()=>L)}createDomOutlet(P,E){return new i.u0(P,this.componentFactoryResolver,this.appRef,E)}}y.\u0275fac=function(P){return new(P||y)(O.LFG(O.z2F),O.LFG(O._Vd),O.LFG(r.j))},y.\u0275prov=O.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"})},82140:(X,I,t)=>{"use strict";t.d(I,{e:()=>h});var i=t(2316),d=(t(18322),t(2775));class h{constructor(){this.onSave=new i.vpe,this.onCancel=new i.vpe}save(){this.onSave.emit()}cancel(){this.onCancel.emit()}}h.\u0275fac=function(n){return new(n||h)},h.\u0275cmp=i.Xpm({type:h,selectors:[["edit-field-controls"]],inputs:{cancelTitle:"cancelTitle",saveTitle:"saveTitle",field:["fieldController","field"]},outputs:{onSave:"onSave",onCancel:"onCancel"},decls:6,vars:5,consts:[[1,"inplace-edit--dashboard"],[1,"inplace-edit--controls"],["type","button",1,"inplace-edit--control","inplace-edit--control--save",3,"disabled","title","click"],["icon-classes","icon-checkmark icon-no-color",3,"icon-title"],["type","button",1,"inplace-edit--control","inplace-edit--control--cancel",3,"title","click"],["icon-classes","icon-close icon-no-color",3,"icon-title"]],template:function(n,l){1&n&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"button",2),i.NdJ("click",function(){return l.save()}),i._UZ(3,"op-icon",3),i.qZA(),i.TgZ(4,"button",4),i.NdJ("click",function(){return l.cancel()}),i._UZ(5,"op-icon",5),i.qZA(),i.qZA(),i.qZA()),2&n&&(i.xp6(2),i.Q6J("disabled",l.field.required&&l.field.isEmpty()||void 0)("title",l.saveTitle),i.xp6(1),i.Q6J("icon-title",l.saveTitle),i.xp6(1),i.Q6J("title",l.cancelTitle),i.xp6(1),i.Q6J("icon-title",l.cancelTitle))},directives:[d.o],encapsulation:2})},45755:(X,I,t)=>{"use strict";t.d(I,{i:()=>h});var i=t(54364),e=t(21757),d=t(2316);class h{}h.\u0275fac=function(n){return new(n||h)},h.\u0275mod=d.oAB({type:h}),h.\u0275inj=d.cJS({imports:[[i.ez,e.H]]})},76315:(X,I,t)=>{"use strict";t.d(I,{s:()=>r});var i=t(54364),e=t(97779),d=t(45755),h=t(2316);class r{}r.\u0275fac=function(l){return new(l||r)},r.\u0275mod=h.oAB({type:r}),r.\u0275inj=h.cJS({imports:[[i.ez,e.$,d.i]]})},54262:(X,I,t)=>{"use strict";t.d(I,{k:()=>y});var i=t(12703),e=t(20342),d=t(96617),h=t(88837),r=t(61342),l=(t(80044),t(26942)),a=t(44022),m=t(7812),v=t(87853),c=t(3352);var f=t(2316),C=t(54364);const u=["displayContainer"],k=["editContainer"],O=function(b,P,E,T){return[b,P,E,T]};class y extends l.N{constructor(P,E,T,M,S,R,F,L,D){super(),this.states=P,this.injector=E,this.elementRef=T,this.opContextMenu=M,this.halEditing=S,this.schemaCache=R,this.editForm=F,this.cdRef=L,this.I18n=D,this.displayFieldOptions={},this.isDropTarget=!1,this.editFieldContainerClass=m.zZ,this.active=!1,this.destroyed=!1}setActive(P=!0){this.active=P,this.componentDestroyed||this.cdRef.detectChanges()}ngOnInit(){var P;this.fieldRenderer=new m.uA(this.injector,"single-view",this.displayFieldOptions),this.$element=jQuery(this.elementRef.nativeElement),null===(P=this.editForm)||void 0===P||P.register(this),this.halEditing.temporaryEditResource(this.resource).values$().pipe(this.untilDestroyed()).subscribe(E=>{this.resource=E,this.render()})}startDragOverActivation(P){return!(this.isDropTarget&&this.isEditable&&!this.active)||(this.handleUserActivate(null),P.preventDefault(),!1)}render(){const P=this.fieldRenderer.render(this.resource,this.fieldName,null);this.displayContainer.nativeElement.innerHTML="",this.displayContainer.nativeElement.appendChild(P)}deactivate(P=!1){this.editContainer.nativeElement.innerHTML="",this.editContainer.nativeElement.hidden=!0,this.setActive(!1),P&&setTimeout(()=>this.$element.find(`.${m.OZ}`).focus(),20)}get isEditable(){return!(!this.editForm||!this.schema.isAttributeEditable(this.fieldName))}activateIfEditable(P){return function(b){try{const P=window.getSelection(),E=P.toString().length>0,T=b.contains(P.anchorNode);return E&&T}catch(P){return console.error("Failed to test whether in selection ",P),!1}}(P.target)?((0,c.qu)(`Not activating ${this.fieldName} because of active selection within`),!0):jQuery(P.target).closest("a,macro",this.displayContainer.nativeElement).length>0||(this.isEditable&&this.handleUserActivate(P),this.opContextMenu.close(),P.preventDefault(),P.stopImmediatePropagation(),!1)}activateOnForm(P=!1){return this.setActive(!0),this.editForm.activate(this.fieldName,P).catch(()=>this.deactivate(!0))}handleUserActivate(P){let E=0;return"click"===(null==P?void 0:P.type)&&(E=(0,h.b)(P)),this.activateOnForm().then(T=>{!T||(T.$onUserActivate.next(),T.focus(E))}),!1}reset(){this.render(),this.deactivate()}get schema(){return this.halEditing.typedState(this.resource).hasValue()?this.halEditing.typedState(this.resource).value.schema:this.schemaCache.of(this.resource)}}y.\u0275fac=function(P){return new(P||y)(f.Y36(v.G),f.Y36(f.zs3),f.Y36(f.SBq),f.Y36(e.$),f.Y36(i.l),f.Y36(a.y),f.Y36(r.n,8),f.Y36(f.sBO),f.Y36(d.D))},y.\u0275cmp=f.Xpm({type:y,selectors:[["op-editable-attribute-field"]],viewQuery:function(P,E){if(1&P&&(f.Gf(u,7),f.Gf(k,7)),2&P){let T;f.iGM(T=f.CRH())&&(E.displayContainer=T.first),f.iGM(T=f.CRH())&&(E.editContainer=T.first)}},inputs:{fieldName:"fieldName",resource:"resource",wrapperClasses:"wrapperClasses",displayFieldOptions:"displayFieldOptions",isDropTarget:"isDropTarget"},features:[f.qOj],decls:5,vars:8,consts:[[3,"ngClass","dragover"],[3,"hidden"],["editContainer",""],["tabindex","-1",3,"hidden","click","keydown.enter"],["displayContainer",""]],template:function(P,E){1&P&&(f.TgZ(0,"div",0),f.NdJ("dragover",function(M){return E.startDragOverActivation(M)}),f._UZ(1,"div",1,2),f.TgZ(3,"div",3,4),f.NdJ("click",function(M){return E.activateIfEditable(M)})("keydown.enter",function(M){return E.activateIfEditable(M)}),f.qZA(),f.qZA()),2&P&&(f.Q6J("ngClass",f.l5B(3,O,E.editFieldContainerClass,E.fieldName,E.active?"-active":"",E.wrapperClasses||"-small")),f.xp6(1),f.Q6J("hidden",!E.active),f.xp6(2),f.Q6J("hidden",E.active))},directives:[C.mk],encapsulation:2,changeDetection:0})},12703:(X,I,t)=>{"use strict";t.d(I,{l:()=>C});var i=t(3786),e=t(14808),d=t(9170),h=t(33927),r=t(79441),n=t(94232),l=t(53448),a=t(1403),m=t(79175),v=t(84699),c=t(2316);class p extends e.Ui{constructor(){super(),this.name="Changesets",this.changesets=(0,e.r9)(),this.initializeMembers()}}class f{constructor(k,O){this.wasNew=!1,this.id=O.id.toString(),this.wasNew=(0,v.Z)(k.pristineResource),this.resource=O,this.changes=k.changeMap}}class C extends m.r{constructor(k,O,y){super((new p).changesets),this.injector=k,this.halEvents=O,this.hook=y,this.committedChanges=new r.xQ}save(k){return(0,i.mG)(this,void 0,void 0,function*(){const O=yield k.buildRequestPayload(),y=yield k.pristineResource.$links.updateImmediately(O);return y.retainFrom(k.pristineResource),yield this.onSaved(y),this.complete(k,y)})}complete(k,O){const y=new f(k,O);this.committedChanges.next(y),this.reset(k);const b=y.wasNew?"created":"updated";return this.halEvents.push(y.resource,{eventType:b,commit:y}),y}reset(k){k.clear(),this.clearSome(k.href)}typedState(k){return this.multiState.get(k.href)}edit(k,O){const y=this.multiState.get(k.href),b=this.newChangeset(k,y,O);return y.putValue(b),b}newChangeset(k,O,y){return new(this.hook.call("halResourceChangesetClass",k).pop()||n.W)(k,O,y)}changeFor(k){const O=this.multiState.get(k.href);let y=k;k.state&&(y=k.state.getValueOr(k));const b=O.value;return b&&!b.isEmpty()?b:b?y.hasOwnProperty("lockVersion")&&b.pristineResource.lockVersion<y.lockVersion?this.edit(y):(b.updatePristineResource(y),b):this.edit(y)}temporaryEditResource(k){const O=(0,e.$e)(k.state,this.typedState(k));return(0,e.eS)(O,y=>y.pipe((0,d.h)(([b,P])=>!!b),(0,h.U)(([b,P])=>P?(P.updatePristineResource(b),P.projectedResource):b)))}stopEditing(k){this.multiState.get(k.href).clear()}onSaved(k){return k.state?k.push(k):Promise.resolve()}}C.\u0275fac=function(k){return new(k||C)(c.LFG(c.zs3),c.LFG(a.J),c.LFG(l.$))},C.\u0275prov=c.Yz7({token:C,factory:C.\u0275fac})},82635:(X,I,t)=>{"use strict";t.d(I,{g:()=>e});var i=t(26942);class e extends i.N{get displayName(){return this.schema.name||this.name}get value(){return this.resource[this.name]}get type(){return this.constructor.type}get required(){return!!this.schema.required}get writable(){return this.schema.writable&&!1!==this.context.options.writable}get hasDefault(){return this.schema.hasDefault}get options(){return this.schema.options}isEmpty(){return void 0===this.value||null===this.value||""===this.value}get unknownAttribute(){return this.isEmpty()&&!this.schema}}},39478:(X,I,t)=>{"use strict";t.d(I,{h:()=>i});class i{constructor(){this.fields={},this.classes={}}fieldType(d){return this.fields[d]}getClassFor(d,h="unknown"){const r=this.fieldType(d)||this.fieldType(h)||this.defaultFieldType;return this.classes[r]}getSpecificClassFor(d,h,r="unknown"){const n=this.fieldType(`${d}-${h}`)||this.fieldType(`${d}-${r}`);return n?this.classes[n]:this.getClassFor(h,r)}addFieldType(d,h,r){return d.fieldType=h,this.register(d,r),this}addSpecificFieldType(d,h,r,n){return h.fieldType=`${d}-${r}`,n=n.map(l=>`${d}-${l}`),this.register(h,n),this}extendFieldType(d,h){const r=this.classes[d]||this.getClassFor(d);return this.addFieldType(r,d,h)}register(d,h=[]){const r=d.fieldType;h.forEach(n=>this.fields[n]=r),this.classes[r]=d}}},63419:(X,I,t)=>{"use strict";function i(h){return`-${(h=d(h)).replace("_","-")}`}function e(h,r){return h=d(h),r.t(`js.grid.widgets.project_status.${h.replace("-","_")}`)}function d(h){return h||"not-set"}t.d(I,{p:()=>i,v:()=>e})},2246:(X,I,t)=>{"use strict";t.d(I,{E:()=>ft});var i=t(2316),e=t(54364),d=t(55811),h=t(97779),r=t(31283),n=t(21757),l=t(71858),a=t(84568),m=t(60874),v=t(18322),c=t(1707),p=t(84312);class f extends v.su{constructor(){super(...arguments),this.shouldFocus="subject"===this.name}}f.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(f)))(x||f)}}(),f.\u0275cmp=i.Xpm({type:f,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:6,consts:[["type","text",1,"inline-edit--field","op-input",3,"opAutofocus","disabled","ngModel","id","ngModelChange","keydown","focusout"]],template:function(B,x){1&B&&(i.TgZ(0,"input",0),i.NdJ("ngModelChange",function(Z){return x.value=Z})("keydown",function(Z){return x.handler.handleUserKeydown(Z)})("focusout",function(){return x.handler.onFocusOut()}),i.qZA()),2&B&&(i.Q6J("opAutofocus",x.shouldFocus)("disabled",x.inFlight)("ngModel",x.value)("id",x.handler.htmlId),i.uIk("aria-required",x.required)("required",x.required))},directives:[c.Fj,p.U,c.Q7,c.JJ,c.On],encapsulation:2});class C extends v.su{constructor(){super(...arguments),this.locale=I18n.locale}}C.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(C)))(x||C)}}(),C.\u0275cmp=i.Xpm({type:C,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:6,consts:[["type","number",1,"inline-edit--field","op-input",3,"disabled","ngModel","id","ngModelChange","keydown","focusout"]],template:function(B,x){1&B&&(i.TgZ(0,"input",0),i.NdJ("ngModelChange",function(Z){return x.value=Z})("keydown",function(Z){return x.handler.handleUserKeydown(Z)})("focusout",function(){return x.handler.onFocusOut()}),i.qZA()),2&B&&(i.Q6J("disabled",x.inFlight)("ngModel",x.value)("id",x.handler.htmlId),i.uIk("aria-required",x.required)("required",x.required)("lang",x.locale))},directives:[c.wV,c.Fj,c.Q7,c.JJ,c.On],encapsulation:2});var u=t(3786);class k{constructor(){this._fields=[]}register(B,x){this._fields.push({attribute:x,component:B})}getAutocompleterOfAttribute(B){const x=_.find(this._fields,A=>A.attribute===B);return x?x.component:void 0}}k.\u0275fac=function(B){return new(B||k)},k.\u0275prov=i.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"});var O=t(30400),y=t(33927),b=t(98636),P=t(29161),E=t(66220),T=t(61342),M=t(47775),S=t(67727),R=t(29092),F=t(32853);const L=function(ge,B,x,A,Z,Ce,Ie,Be){return{availableValues:ge,appendTo:B,model:x,required:A,disabled:Z,id:Ce,finishedLoading:!0,classes:Ie,resource:Be}};class D extends v.su{constructor(){super(...arguments),this.appendTo=null,this.referenceOutputs={onCreate:B=>this.onCreate(B),onChange:B=>this.onChange(B),onAddNew:B=>this.onNewValueAdded(B),onKeydown:B=>this.handler.handleUserKeydown(B,!0),onOpen:()=>this.onOpen(),onClose:()=>this.onClose(),onAfterViewInit:B=>this._autocompleterComponent=B},this.valuesLoaded=!1,this.hiddenOverflowContainer=".__hidden_overflow_container"}get selectedOption(){const B=this.value?this.value.href:null;return _.find(this.availableOptions,x=>x.href===B)}set selectedOption(B){const x=_.find(this.availableOptions,A=>A.href===B.href);x&&""===x.href&&(x.href=null),this.value=x||B}ngOnInit(){var B;super.ngOnInit(),this.appendTo=this.overflowingSelector,this.handler.$onUserActivate.pipe(this.untilDestroyed()).subscribe(()=>{this.valuesLoadingPromise.then(()=>{this._autocompleterComponent.openDirectly=!0})}),this._syncUrlParamsOnChangeIfNeeded(this.handler.fieldName,null===(B=this.editFormComponent)||void 0===B?void 0:B.editMode)}initialize(){this.text={requiredPlaceholder:this.I18n.t("js.placeholders.selection"),placeholder:this.I18n.t("js.placeholders.default")},this.valuesLoadingPromise=this.change.getForm().then(()=>this.initialValueLoading())}initialValueLoading(){return this.valuesLoaded=!1,this.loadValues().toPromise()}autocompleterComponent(){const{type:B}=this.schema;return this.selectAutocompleterRegister.getAutocompleterOfAttribute(B)||E.c}setValues(B){this.availableOptions=this.sortValues(B),this.addEmptyOption()}loadValues(B){const{allowedValues:x}=this.schema;if(Array.isArray(x))this.setValues(x),this.valuesLoaded=!0;else{if(x&&!this.valuesLoaded)return this.loadValuesFromBackend(B);this.setValues([])}return(0,O.D)(Promise.resolve(this.availableOptions))}loadValuesFromBackend(B){return(0,O.D)(this.loadAllowedValues(B)).pipe((0,y.U)(x=>void 0===x.count||void 0===x.total||!B&&x.total===x.count||!this.value?x.elements:x.elements.concat([this.value])),(0,b.b)(x=>this.setValues(x)),(0,y.U)(()=>this.availableOptions))}loadAllowedValues(B){if(!B){const x=this.schema.allowedValues.$link.href;return this.change.cacheValue(x,this.fetchAllowedValueQuery.bind(this))}return this.fetchAllowedValueQuery(B)}fetchAllowedValueQuery(B){return this.schema.allowedValues.$link.$fetch(this.allowedValuesFilter(B))}addValue(B){this.availableOptions.push(B)}get currentValueInvalid(){return!!(this.value&&!_.some(this.availableOptions,B=>B.href===this.value.href)||!this.value&&this.schema.required)}onCreate(B){this.addValue(B),this.selectedOption={name:B.name,href:B.href},this.handler.handleUserSubmit()}onOpen(){jQuery(this.hiddenOverflowContainer).one("scroll",()=>{this._autocompleterComponent.closeSelect()})}onClose(){}onChange(B){if(B)return this.selectedOption=B,void this.handler.handleUserSubmit();const x=this.getEmptyOption();x&&(this.selectedOption=x,this.handler.handleUserSubmit())}onNewValueAdded(B){return(0,u.mG)(this,void 0,void 0,function*(){!B||(yield this.change.getForm(!0),this.onChange(B))})}addEmptyOption(){this.isRequired()||void 0===this.getEmptyOption()&&this.availableOptions.unshift({name:this.text.placeholder,href:""})}isRequired(){return this.schema.required}sortValues(B){return this.halSorting.sort(B)}allowedValuesFilter(B){return{}}getEmptyOption(){return _.find(this.availableOptions,B=>B.name===this.text.placeholder)}_syncUrlParamsOnChangeIfNeeded(B,x){"type"===B&&x&&this.handler.registerOnBeforeSubmit(()=>{var A,Z;const Ce=null===(Z=null===(A=this.value)||void 0===A?void 0:A.$source)||void 0===Z?void 0:Z.id;Ce&&this.$state.go(".",{type:Ce},{notify:!1})})}}D.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(D)))(x||D)}}(),D.\u0275cmp=i.Xpm({type:D,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:12,consts:[[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs"]],template:function(B,x){1&B&&i._UZ(0,"ndc-dynamic",0),2&B&&i.Q6J("ndcDynamicComponent",x.autocompleterComponent())("ndcDynamicInputs",i.qlk(3,L,x.availableOptions,x.appendTo,x.selectedOption?x.selectedOption:"",x.required,x.inFlight,x.handler.htmlId,"inline-edit--field "+x.handler.fieldName,x.resource))("ndcDynamicOutputs",x.referenceOutputs)},directives:[F.B5,F.oc],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",k)],D.prototype,"selectAutocompleterRegister",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",S.W)],D.prototype,"halNotification",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",R.h)],D.prototype,"halSorting",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",M.StateService)],D.prototype,"$state",void 0),(0,u.gn)([(0,P.W)(T.n,null,i.XFs.Optional),(0,u.w6)("design:type",T.n)],D.prototype,"editFormComponent",void 0);var G=t(96617),Q=t(36868),V=t(82140);function K(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"op-invite-user-button",4),i.NdJ("invited",function(Z){i.CHM(x);return i.oxw(2).selectedOption=Z}),i.qZA()}if(2&ge){const x=i.oxw(2);i.Q6J("projectId",null==x.resource.project?null:x.resource.project.id)}}function q(ge,B){1&ge&&i.YNc(0,K,1,1,"ng-template",3)}function se(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"edit-field-controls",5),i.NdJ("onSave",function(){return i.CHM(x),i.oxw().handler.handleUserSubmit()})("onCancel",function(){return i.CHM(x),i.oxw().handler.handleUserCancel()}),i.qZA()}if(2&ge){const x=i.oxw();i.Q6J("fieldController",x.self)("saveTitle",x.text.save)("cancelTitle",x.text.cancel)}}class te extends v.su{constructor(){super(...arguments),this.availableOptions=[],this.text={requiredPlaceholder:this.I18n.t("js.placeholders.selection"),placeholder:this.I18n.t("js.placeholders.default"),save:this.I18n.t("js.inplace.button_save",{attribute:this.schema.name}),cancel:this.I18n.t("js.inplace.button_cancel",{attribute:this.schema.name})},this.appendTo=null,this.currentValueInvalid=!1,this.hiddenOverflowContainer=".__hidden_overflow_container",this.requestFocus=!1}ngOnInit(){this.nullOption={name:this.text.placeholder,href:null},this.showAddNewUserButton="User"===this.schema.type,this.handler.$onUserActivate.pipe(this.untilDestroyed()).subscribe(()=>{this.requestFocus=0===this.availableOptions.length,this.requestFocus||this.openAutocompleteSelectField()}),super.ngOnInit(),this.appendTo=this.overflowingSelector}get value(){const B=this.resource[this.name];return B&&B[0]}buildSelectedOption(){const B=this.resource[this.name];return B?_.castArray(B).map(x=>this.findValueOption(x)):[]}get selectedOption(){return this._selectedOption}set selectedOption(B){this._selectedOption=B;const x=A=>{const Z=_.find(this.availableOptions,Ce=>Ce.href===A.href)||this.nullOption;return Z&&""===Z.href&&(Z.href=null),Z};this.resource[this.name]=_.castArray(B).map(A=>x(A))}onOpen(){jQuery(this.hiddenOverflowContainer).one("scroll",()=>{this.ngSelectComponent.close()})}onClose(){}repositionDropdown(){this.ngSelectComponent&&this.ngSelectComponent.dropdownPanel&&setTimeout(()=>this.ngSelectComponent.dropdownPanel.adjustPosition(),0)}openAutocompleteSelectField(){const B=this;window.setTimeout(()=>{B.ngSelectComponent.open()},0)}findValueOption(B){let x;return B&&(x=_.find(this.availableOptions,A=>A.href===B.href)),x||this.nullOption}setValues(B,x=!1){x&&B.sort((A,Z)=>{const Ce=A.name.toLowerCase(),Ie=Z.name.toLowerCase();return Ce<Ie?-1:Ce>Ie?1:0}),this.availableOptions=B||[],this._selectedOption=this.buildSelectedOption(),this.checkCurrentValueValidity(),this.availableOptions.length>0&&this.requestFocus&&(this.openAutocompleteSelectField(),this.requestFocus=!1)}initialize(){super.initialize(),this.loadValues()}loadValues(){const{allowedValues:B}=this.schema;if(Array.isArray(B))this.setValues(B);else{if(this.schema.allowedValues)return this.schema.allowedValues.$load().then(x=>{x.count>0&&"Project"===x.elements[0]._type?this.setValues(x.elements,!0):this.setValues(x.elements)});this.setValues([])}return Promise.resolve()}checkCurrentValueValidity(){this.value?this.currentValueInvalid=!_.some(this.value,B=>_.some(this.availableOptions,x=>x.href===B.href)):this.currentValueInvalid=!!this.schema.required}}te.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(te)))(x||te)}}(),te.\u0275cmp=i.Xpm({type:te,selectors:[["ng-component"]],viewQuery:function(B,x){if(1&B&&i.Gf(Q.w9,7),2&B){let A;i.iGM(A=i.CRH())&&(x.ngSelectComponent=A.first)}},features:[i.qOj],decls:3,vars:16,consts:[["bindLabel","name",3,"ngModel","ngClass","required","clearable","disabled","id","items","virtualScroll","clearSearchOnAdd","multiple","closeOnSelect","appendTo","dropdownPosition","hideSelected","ngModelChange","keydown","open","close","add","remove"],[4,"ngIf"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel",4,"ngIf"],["ng-footer-tmp",""],[3,"projectId","invited"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel"]],template:function(B,x){1&B&&(i.TgZ(0,"ng-select",0),i.NdJ("ngModelChange",function(Z){return x.selectedOption=Z})("keydown",function(Z){return x.handler.handleUserKeydown(Z,!0)})("open",function(){return x.onOpen()})("close",function(){return x.onClose()})("add",function(){return x.repositionDropdown()})("remove",function(){return x.repositionDropdown()}),i.YNc(1,q,1,0,void 0,1),i.qZA(),i.YNc(2,se,1,3,"edit-field-controls",2)),2&B&&(i.Q6J("ngModel",x.selectedOption)("ngClass","inline-edit--field -multi-select")("required",x.required)("clearable",!x.required)("disabled",x.inFlight)("id",x.handler.htmlId)("items",x.availableOptions)("virtualScroll",!0)("clearSearchOnAdd",!0)("multiple",!0)("closeOnSelect",!1)("appendTo",x.appendTo)("dropdownPosition","top")("hideSelected",!0),i.xp6(1),i.Q6J("ngIf",x.showAddNewUserButton),i.xp6(1),i.Q6J("ngIf",!x.handler.inEditMode))},directives:[Q.w9,c.JJ,c.On,e.mk,c.Q7,e.O5,Q.x0,V.e],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",G.D)],te.prototype,"I18n",void 0);class ie extends v.su{constructor(){super(...arguments),this.locale=I18n.locale}}ie.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(ie)))(x||ie)}}(),ie.\u0275cmp=i.Xpm({type:ie,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:6,consts:[["type","number","step","any",1,"inline-edit--field","op-input",3,"disabled","ngModel","id","ngModelChange","keydown","focusout"]],template:function(B,x){1&B&&(i.TgZ(0,"input",0),i.NdJ("ngModelChange",function(Z){return x.value=Z})("keydown",function(Z){return x.handler.handleUserKeydown(Z)})("focusout",function(){return x.handler.onFocusOut()}),i.qZA()),2&B&&(i.Q6J("disabled",x.inFlight)("ngModel",x.value)("id",x.handler.htmlId),i.uIk("aria-required",x.required)("required",x.required)("lang",x.locale))},directives:[c.wV,c.Fj,c.Q7,c.JJ,c.On],encapsulation:2});class le extends v.su{updateValue(B){this.value=B,this.handler.handleUserSubmit()}}le.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(le)))(x||le)}}(),le.\u0275cmp=i.Xpm({type:le,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:4,consts:[["type","checkbox",1,"inline-edit--field","inline-edit--boolean-field",3,"checked","disabled","id","change","keydown"]],template:function(B,x){1&B&&(i.TgZ(0,"input",0),i.NdJ("change",function(){return x.updateValue(!x.value)})("keydown",function(Z){return x.handler.handleUserKeydown(Z)}),i.qZA()),2&B&&(i.Q6J("checked",x.value)("disabled",x.inFlight)("id",x.handler.htmlId),i.uIk("aria-required",x.required))},encapsulation:2});var oe=t(79441),ne=t(83972),fe=t(81134),ve=t(9170),Se=t(83720),Oe=t(80639),je=t(79902),tt=t(18293),He=t(92597),st=t(22663);class ce{constructor(B,x,A=!1,Z=250){this.requestHandler=B,this.errorHandler=x,this.preFilterNull=A,this.debounceMs=Z,this.input$=new oe.xQ,this.loading$=new oe.xQ,this.lastResult=[],this.output$=(0,ne.z)((0,fe.of)([]),this.input$.pipe((0,ve.h)(Ce=>!A||null!=Ce),(0,Se.x)(),(0,Oe.b)(Z),(0,b.b)(Ce=>{this.lastRequestedValue=Ce,this.lastResult=[],this.loading$.next(!0)}),(0,je.w)(Ce=>this.requestHandler(Ce).pipe((0,tt.K)(Ie=>(this.errorHandler(Ie),(0,fe.of)([]))),(0,b.b)(Ie=>{this.loading$.next(!1),this.lastResult=Ie}))),(0,He.d)(1)))}request(B){this.input$.next(B)}get hasResults(){return this.lastResult.length>0}observe(B){return this.output$.pipe((0,st.R)(B))}}var J=t(53466),W=t(26269);const Y=function(ge,B,x,A,Z,Ce,Ie,Be,Tt){return{availableValues:ge,appendTo:B,model:x,required:A,disabled:Z,id:Ce,finishedLoading:Ie,classes:Be,typeahead:Tt,hideSelected:!0}};class $ extends D{constructor(){var ge;super(...arguments),this.requests=new ce(B=>this.loadValues(B),(ge=this.halNotification,B=>ge.handleRawError(B)))}initialValueLoading(){return this.valuesLoaded=!1,new Promise(B=>{this.requests.output$.pipe((0,J.q)(1)).subscribe(x=>{B(x)}),this.requests.input$.next("")})}get typeahead(){return this.requests.input$}fetchAllowedValueQuery(B){return"parent"===this.name?this.schema.allowedValues.$link.$fetch({query:B}):super.fetchAllowedValueQuery(B)}allowedValuesFilter(B){let x=super.allowedValuesFilter(B);if(B){const A=new W.qM;A.add("subjectOrId","**",[B]),x={filters:A.toJson()}}return x}}$.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z($)))(x||$)}}(),$.\u0275cmp=i.Xpm({type:$,selectors:[["ng-component"]],features:[i.qOj],decls:2,vars:15,consts:[[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs"]],template:function(B,x){1&B&&(i._UZ(0,"ndc-dynamic",0),i.ALo(1,"async")),2&B&&i.Q6J("ndcDynamicComponent",x.autocompleterComponent())("ndcDynamicInputs",i.rFY(5,Y,[i.lcZ(1,3,x.requests.output$),x.appendTo,x.selectedOption?x.selectedOption:"",x.required,x.inFlight,x.handler.htmlId,x.requests.loading$,"inline-edit--field "+x.handler.fieldName,x.typeahead]))("ndcDynamicOutputs",x.referenceOutputs)},directives:[F.B5,F.oc],pipes:[e.Ov],encapsulation:2});var be=t(2281),N=t(77355),Ue=t(70692),et=t(90547);class Ke extends v.su{ngOnInit(){super.ngOnInit()}onValueSelected(B){this.value=this.parser(B),this.handler.handleUserSubmit()}onCancel(){this.handler.handleUserCancel()}parser(B){return be(B,"YYYY-MM-DD",!0).isValid()?B:null}formatter(B){if(be(B,"YYYY-MM-DD",!0).isValid()){const x=this.timezoneService.parseDate(B);return this.timezoneService.formattedISODate(x)}return null}}Ke.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(Ke)))(x||Ke)}}(),Ke.\u0275cmp=i.Xpm({type:Ke,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:4,consts:[["tabindex","-1","classes","inline-edit--field",3,"initialDate","required","disabled","id","changed","canceled"]],template:function(B,x){1&B&&(i.TgZ(0,"op-single-date-picker",0),i.NdJ("changed",function(Z){return x.onValueSelected(Z)})("canceled",function(){return x.onCancel()}),i.qZA()),2&B&&i.Q6J("initialDate",x.formatter(x.value))("required",x.required)("disabled",x.inFlight)("id",x.handler.htmlId)},directives:[et.S],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],Ke.prototype,"timezoneService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",N.S)],Ke.prototype,"opModalService",void 0);var _e=t(26611),ye=t(84699);function Pe(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"edit-field-controls",4),i.NdJ("onSave",function(){return i.CHM(x),i.oxw().handleUserSubmit()})("onCancel",function(){return i.CHM(x),i.oxw().handler.handleUserCancel()}),i.qZA()}if(2&ge){const x=i.oxw();i.Q6J("fieldController",x.field)("saveTitle",x.text.save)("cancelTitle",x.text.cancel)}}class Ee extends v.su{constructor(){super(...arguments),this.field=this,this.initializationError=!1,this.isPreview=!1,this.previewHtml="",this.text={},this.ckEditorContext=Object.assign({resource:this.change.pristineResource,macros:"none",previewContext:this.previewContext,options:{rtl:this.schema.options&&this.schema.options.rtl},type:"constrained"},this.resource.getEditorContext(this.field.name))}ngOnInit(){super.ngOnInit(),this.handler.registerOnSubmit(()=>this.getCurrentValue()),this.text={attachmentLabel:this.I18n.t("js.label_formattable_attachment_hint"),save:this.I18n.t("js.inplace.button_save",{attribute:this.schema.name}),cancel:this.I18n.t("js.inplace.button_cancel",{attribute:this.schema.name})}}onCkeditorSetup(B){(0,ye.Z)(this.resource)||setTimeout(()=>B.editing.view.focus())}getCurrentValue(){return this.editor.getTransformedContent().then(B=>{this.rawValue=B})}onContentChange(B){this.rawValue!==B&&(this.rawValue=B)}handleUserSubmit(){return this.getCurrentValue().then(()=>{this.handler.handleUserSubmit()}),!1}get previewContext(){return this.handler.previewContext(this.resource)}reset(){this.editor&&this.editor.initialized&&(this.editor.content=this.rawValue,this.cdRef.markForCheck())}get rawValue(){return this.value&&this.value.raw?this.value.raw:""}set rawValue(B){this.value={raw:B}}isEmpty(){return!(this.value&&this.value.raw)}initialize(){this.initialContent=this.rawValue,(0,ye.Z)(this.resource)&&this.editor&&this.reset()}}Ee.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(Ee)))(x||Ee)}}(),Ee.\u0275cmp=i.Xpm({type:Ee,selectors:[["ng-component"]],viewQuery:function(B,x){if(1&B&&i.Gf(_e.F,7),2&B){let A;i.iGM(A=i.CRH())&&(x.editor=A.first)}},features:[i.qOj],decls:4,vars:3,consts:[[1,"textarea-wrapper"],[1,"op-ckeditor--wrapper","op-ckeditor-element"],[3,"context","content","onContentChange","onInitializationFailed","onInitialized"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel",4,"ngIf"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel"]],template:function(B,x){1&B&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"op-ckeditor",2),i.NdJ("onContentChange",function(Z){return x.onContentChange(Z)})("onInitializationFailed",function(){return x.initializationError=!0})("onInitialized",function(Z){return x.onCkeditorSetup(Z)}),i.qZA(),i.qZA(),i.YNc(3,Pe,1,3,"edit-field-controls",3),i.qZA()),2&B&&(i.xp6(2),i.Q6J("context",x.ckEditorContext)("content",x.initialContent),i.xp6(1),i.Q6J("ngIf",!(x.handler.inEditMode||x.initializationError)))},directives:[_e.F,e.O5,V.e],encapsulation:2,changeDetection:0});var Qe=t(63419);function nt(ge,B){if(1&ge&&(i._UZ(0,"span",3),i.TgZ(1,"span",4),i._uU(2),i.qZA()),2&ge){const x=B.item;i.Q6J("ngClass",x.colorClass),i.xp6(1),i.Q6J("ngClass",x.colorClass),i.xp6(1),i.Oqu(x.name)}}function ct(ge,B){if(1&ge&&(i._UZ(0,"span",3),i.TgZ(1,"span",4),i._uU(2),i.qZA()),2&ge){const x=B.item;i.Q6J("ngClass",x.colorClass),i.xp6(1),i.Q6J("ngClass",x.colorClass),i.xp6(1),i.Oqu(x.name)}}class lt extends v.su{constructor(){super(...arguments),this.availableStatuses=[{href:"not_set",name:(0,Qe.v)("not_set",this.I18n),colorClass:(0,Qe.p)("not_set")}],this.hiddenOverflowContainer="#content-wrapper",this.appendToContainer="body"}ngOnInit(){this.currentStatusCode=null===this.resource.status?this.availableStatuses[0].href:this.resource.status.href,this.change.getForm().then(B=>{B.schema.status.allowedValues.forEach(A=>{this.availableStatuses=[...this.availableStatuses,{href:A.href,name:A.name,colorClass:(0,Qe.p)(A.id)}]});const x=this;window.setTimeout(()=>{x.ngSelectComponent.open()},0)})}onChange(){this.resource.status=this.currentStatusCode===this.availableStatuses[0].href?null:{href:this.currentStatusCode},this.handler.handleUserSubmit()}onOpen(){setTimeout(()=>{const B=this.ngSelectComponent;B&&B.dropdownPanel&&B.dropdownPanel._updatePosition(),jQuery(this.hiddenOverflowContainer).one("scroll.autocompleteContainer",()=>{this.ngSelectComponent.close()})},25)}onClose(){jQuery(this.hiddenOverflowContainer).off("scroll.autocompleteContainer")}}lt.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(lt)))(x||lt)}}(),lt.\u0275cmp=i.Xpm({type:lt,selectors:[["ng-component"]],viewQuery:function(B,x){if(1&B&&i.Gf(Q.w9,7),2&B){let A;i.iGM(A=i.CRH())&&(x.ngSelectComponent=A.first)}},features:[i.qOj],decls:3,vars:5,consts:[["bindLabel","name","bindValue","href",1,"project-status",3,"items","ngModel","appendTo","hideSelected","disabled","ngModelChange","open","close","change"],["ng-label-tmp",""],["ng-option-tmp",""],[1,"project-status--bulb",3,"ngClass"],[1,"project-status--name",3,"ngClass"]],template:function(B,x){1&B&&(i.TgZ(0,"ng-select",0),i.NdJ("ngModelChange",function(Z){return x.currentStatusCode=Z})("open",function(){return x.onOpen()})("close",function(){return x.onClose()})("change",function(){return x.onChange()}),i.YNc(1,nt,3,3,"ng-template",1),i.YNc(2,ct,3,3,"ng-template",2),i.qZA()),2&B&&i.Q6J("items",x.availableStatuses)("ngModel",x.currentStatusCode)("appendTo",x.appendToContainer)("hideSelected",!0)("disabled",x.inFlight)},directives:[Q.w9,c.JJ,c.On,Q.bb,Q.Z2,e.mk],styles:[""]}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",G.D)],lt.prototype,"I18n",void 0);class Ne extends v.su{constructor(){super(...arguments),this.shouldFocus=!1}get value(){if(!this.schema)return"";const B=this.resource[this.name];return B&&B.raw||""}set value(B){this.resource[this.name]={raw:B}}}Ne.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(Ne)))(x||Ne)}}(),Ne.\u0275cmp=i.Xpm({type:Ne,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:6,consts:[["type","text",1,"inline-edit--field","op-input",3,"opAutofocus","disabled","ngModel","id","ngModelChange","keydown","focusout"]],template:function(B,x){1&B&&(i.TgZ(0,"input",0),i.NdJ("ngModelChange",function(Z){return x.value=Z})("keydown",function(Z){return x.handler.handleUserKeydown(Z)})("focusout",function(){return x.handler.onFocusOut()}),i.qZA()),2&B&&(i.Q6J("opAutofocus",x.shouldFocus)("disabled",x.inFlight)("ngModel",x.value)("id",x.handler.htmlId),i.uIk("aria-required",x.required)("required",x.required))},directives:[c.Fj,p.U,c.Q7,c.JJ,c.On],encapsulation:2});var Ae=t(10190),xe=t(61908),Ye=t(50166);const mt=function(ge,B,x,A,Z,Ce,Ie,Be,Tt){return{availableValues:ge,appendTo:B,model:x,required:A,disabled:Z,id:Ce,finishedLoading:Ie,classes:Be,typeahead:Tt,hideSelected:!0}};class Pt extends ${initialize(){super.initialize(),this.referenceOutputs&&(this.referenceOutputs.modeSwitch=B=>{this.valuesLoaded=!1;const x=this.requests.lastRequestedValue;this.requests.input$.next('_/&"()____'),this.requests.input$.next(x)})}autocompleterComponent(){return Ye.R}isRequired(){return!0}loadAllowedValues(B){return this.recentWorkPackageIds?this.fetchAllowedValueQuery(B):this.apiV3Service.time_entries.list({filters:[["user_id","=",["me"]]],sortBy:[["updated_at","desc"]],pageSize:30}).toPromise().then(x=>(this.recentWorkPackageIds=x.elements.filter(A=>{var Z;return null===(Z=A.workPackage)||void 0===Z?void 0:Z.href}).map(A=>(0,Ae.Z)(A.workPackage.href)).filter((A,Z,Ce)=>Ce.indexOf(A)===Z),this.fetchAllowedValueQuery(B)))}allowedValuesFilter(B){const x=new W.qM;return"recent"===this._autocompleterComponent.mode&&this.recentWorkPackageIds.length>0&&x.add("id","=",this.recentWorkPackageIds),B&&x.add("subjectOrId","**",[B]),{filters:x.toJson()}}sortValues(B){return"recent"===this._autocompleterComponent.mode?this.sortValuesByRecentIds(B):super.sortValues(B)}sortValuesByRecentIds(B){return B.sort((x,A)=>this.recentWorkPackageIds.indexOf(x.id)-this.recentWorkPackageIds.indexOf(A.id))}}Pt.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(Pt)))(x||Pt)}}(),Pt.\u0275cmp=i.Xpm({type:Pt,selectors:[["ng-component"]],features:[i.qOj],decls:2,vars:15,consts:[[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs"]],template:function(B,x){1&B&&(i._UZ(0,"ndc-dynamic",0),i.ALo(1,"async")),2&B&&i.Q6J("ndcDynamicComponent",x.autocompleterComponent())("ndcDynamicInputs",i.rFY(5,mt,[i.lcZ(1,3,x.requests.output$),x.appendTo,x.selectedOption?x.selectedOption:"",x.required,x.inFlight,x.handler.htmlId,x.requests.loading$,"inline-edit--field "+x.handler.fieldName,x.typeahead]))("ndcDynamicOutputs",x.referenceOutputs)},directives:[F.B5,F.oc],pipes:[e.Ov],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",xe.T)],Pt.prototype,"apiV3Service",void 0);var Mt=t(60312),yt=t(14882),jt=t(12703),Jt=t(1056),Ft=t(12877),It=t(85105),gt=t(91260),kt=t(12702),ti=t(51253),ii=t(61486);function $t(ge){return""===ge?null:ge}function vt(ge){return ge instanceof Date?new Date(ge.setHours(0,0,0,0)):""===ge?"":new Date(moment(ge).toDate().setHours(0,0,0,0))}function Ht(ge){return ge instanceof Date||""===ge||!!/^\d{4}-\d{2}-\d{2}$/.exec(ge)}function Wt(ge,B){const x=vt(ge),A=vt(B);return"string"!=typeof x&&"string"!=typeof A&&x.getTime()===A.getTime()}function it(ge,B,x){ge.datepickerInstance.currentMonth=B,ge.datepickerInstance.currentYear=x}function de(ge,B,x){const{currentMonth:A}=B.datepickerInstance,{currentYear:Z}=B.datepickerInstance;if(B.setDates(ge),x){const Ce=x.getMonth(),Ie=x.getFullYear(),Be=Ce-A+12*(Ie-Z);Math.abs(Be)>1?(B.datepickerInstance.currentMonth=Ce,B.datepickerInstance.currentYear=Ie):it(B,A,Z)}else it(B,A,Z);B.datepickerInstance.redraw()}function ae(ge,B,x,A,Z){!B&&x&&ge.classList.add("flatpickr-non-working-day"),Z&&ge.classList.add("flatpickr-disabled"),ge.setAttribute("data-iso-date",ge.dateObj.toISOString())}class pe{constructor(B,x){this.locals=B,this.apiV3Service=x,this.changeset=this.locals.changeset,this.precedingWorkPackages$=(0,fe.of)(this.changeset).pipe((0,ve.h)(A=>!(0,ye.Z)(A.pristineResource)),(0,je.w)(A=>this.apiV3Service.work_packages.signalled((0,W.PQ)("precedes","=",[A.id]),["elements/id","elements/dueDate","elements/date"])),(0,y.U)(A=>A._embedded.elements||[]),(0,ti.d)([]),(0,He.d)(1)),this.followingWorkPackages$=(0,fe.of)(this.changeset).pipe((0,ve.h)(A=>!(0,ye.Z)(A.pristineResource)),(0,je.w)(A=>this.apiV3Service.work_packages.signalled((0,W.PQ)("follows","=",[A.id]),["elements/id"])),(0,y.U)(A=>A._embedded.elements||[]),(0,ti.d)([]),(0,He.d)(1)),this.hasRelations$=(0,ii.aj)([this.precedingWorkPackages$,this.followingWorkPackages$]).pipe((0,y.U)(([A,Z])=>A.length>0||Z.length>0||this.isParent||this.isChild))}getMinimalDateFromPreceeding(){return this.precedingWorkPackages$.pipe((0,J.q)(1),(0,y.U)(B=>this.minimalDateFromPrecedingRelationship(B)))}minimalDateFromPrecedingRelationship(B){if(0===B.length)return null;let x=null;return B.forEach(A=>{if(!A.dueDate&&!A.date)return;const Ce=vt(A.dueDate||A.date);(!x||x<Ce)&&(x=""===Ce?null:Ce)}),x}get isChild(){return this.ancestors.length>0}get ancestors(){return this.changeset.projectedResource.ancestors||[]}get isParent(){return this.children.length>0}get children(){return this.changeset.projectedResource.children||[]}getInvolvedWorkPackageIds(){return(0,ii.aj)([this.precedingWorkPackages$,this.followingWorkPackages$]).pipe((0,y.U)(([B,x])=>[this.changeset.pristineResource,...B,...x,...this.children,...this.ancestors].map(A=>A.id)))}}pe.\u0275fac=function(B){return new(B||pe)(i.LFG(N.E),i.LFG(xe.T))},pe.\u0275prov=i.Yz7({token:pe,factory:pe.\u0275fac});class H{constructor(B,x){this.locals=B,this.dateModalRelations=x,this.changeset=this.locals.changeset,this.scheduleManually=!!this.changeset.value("scheduleManually")}get isSchedulable(){return this.scheduleManually||!this.dateModalRelations.isParent}isDayDisabled(B,x){return!this.isSchedulable||!this.scheduleManually&&!!x&&B.dateObj<=x}}H.\u0275fac=function(B){return new(B||H)(i.LFG(N.E),i.LFG(pe))},H.\u0275prov=i.Yz7({token:H,factory:H.\u0275fac});var he=t(2775);function ue(ge,B){1&ge&&i._UZ(0,"span",7)}function Le(ge,B){1&ge&&i._UZ(0,"span",8)}function ht(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"button",9),i.NdJ("click",function(Z){return i.CHM(x),i.oxw().buttonClicked.emit(Z)}),i._UZ(1,"op-icon",10),i._UZ(2,"span",11),i.qZA()}if(2&ge){const x=i.oxw();i.xp6(1),i.MGl("icon-classes","button--icon ",x.actionButtonClasses,""),i.xp6(1),i.Q6J("textContent",x.actionButton)}}class pt{constructor(){this.type="info",this.buttonClicked=new i.vpe}}function Zt(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"op-modal-banner",3),i.NdJ("buttonClicked",function(Z){return i.CHM(x),i.oxw().openGantt(Z)}),i.qZA()}if(2&ge){const x=i.oxw();i.Q6J("title",x.text.manually_scheduled)("subtitle",x.text.click_on_show_relations_to_open_gantt)("actionButton",x.text.show_relations_button)}}function Ct(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"op-modal-banner",4),i.NdJ("buttonClicked",function(Z){return i.CHM(x),i.oxw().openGantt(Z)}),i.qZA()}if(2&ge){const x=i.oxw();i.Q6J("title",x.text.automatically_scheduled_parent)("subtitle",x.text.click_on_show_relations_to_open_gantt)("actionButton",x.text.show_relations_button)}}function ni(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"op-modal-banner",4),i.NdJ("buttonClicked",function(Z){return i.CHM(x),i.oxw(2).openGantt(Z)}),i.qZA()}if(2&ge){const x=i.oxw(2);i.Q6J("title",x.text.start_date_limited_by_relations)("subtitle",x.text.click_on_show_relations_to_open_gantt)("actionButton",x.text.show_relations_button)}}function _i(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"op-modal-banner",3),i.NdJ("buttonClicked",function(Z){return i.CHM(x),i.oxw(2).openGantt(Z)}),i.qZA()}if(2&ge){const x=i.oxw(2);i.Q6J("title",x.text.changing_dates_affects_follow_relations)("subtitle",x.text.click_on_show_relations_to_open_gantt)("actionButton",x.text.show_relations_button)}}function ri(ge,B){if(1&ge&&(i.ynx(0),i.YNc(1,ni,1,3,"op-modal-banner",1),i.ALo(2,"async"),i.ALo(3,"async"),i.YNc(4,_i,1,3,"op-modal-banner",0),i.ALo(5,"async"),i.BQk()),2&ge){const x=i.oxw();i.xp6(1),i.Q6J("ngIf",!0===i.lcZ(2,2,x.hasPrecedingRelations$)&&!1===i.lcZ(3,4,x.hasFollowingRelations$)&&!x.isChild),i.xp6(3),i.Q6J("ngIf",!0===i.lcZ(5,6,x.hasFollowingRelations$)||x.isChild)}}pt.\u0275fac=function(B){return new(B||pt)},pt.\u0275cmp=i.Xpm({type:pt,selectors:[["op-modal-banner"]],inputs:{type:"type",title:"title",subtitle:"subtitle",actionButton:"actionButton",actionButtonClasses:"actionButtonClasses"},outputs:{buttonClicked:"buttonClicked"},decls:8,vars:7,consts:[[1,"op-modal-banner",3,"ngClass"],["class","spot-icon spot-icon_info1 hidden-for-mobile",4,"ngIf"],["class","spot-icon spot-icon_warning hidden-for-mobile",4,"ngIf"],[1,"op-modal-banner--text","spot-caption"],[1,"op-modal-banner--title","spot-caption","spot-caption_bold",3,"textContent"],[1,"op-modal-banner--subtitle","hidden-for-mobile",3,"textContent"],["class","op-modal-banner--button button","type","button",3,"click",4,"ngIf"],[1,"spot-icon","spot-icon_info1","hidden-for-mobile"],[1,"spot-icon","spot-icon_warning","hidden-for-mobile"],["type","button",1,"op-modal-banner--button","button",3,"click"],[3,"icon-classes"],[1,"button--text",3,"textContent"]],template:function(B,x){1&B&&(i.TgZ(0,"div",0),i.YNc(1,ue,1,0,"span",1),i.YNc(2,Le,1,0,"span",2),i.TgZ(3,"p",3),i._UZ(4,"span",4),i._UZ(5,"br"),i._UZ(6,"span",5),i.qZA(),i.YNc(7,ht,3,2,"button",6),i.qZA()),2&B&&(i.MGl("ngClass","op-modal-banner_",x.type,""),i.Q2q("data-qa-selector","op-modal-banner-",x.type,""),i.xp6(1),i.Q6J("ngIf","info"===x.type),i.xp6(1),i.Q6J("ngIf","warning"===x.type),i.xp6(2),i.Q6J("textContent",x.title),i.xp6(2),i.Q6J("textContent",x.subtitle),i.xp6(1),i.Q6J("ngIf",!!x.actionButton))},directives:[e.mk,e.O5,he.o],styles:[".op-modal-banner[_ngcontent-%COMP%]{display:grid;grid-template-columns:20px auto max-content;grid-gap:1rem;align-items:center;padding:.75rem}@media only screen and (max-width: 679px){.op-modal-banner[_ngcontent-%COMP%]{grid-template-columns:auto max-content}}.op-modal-banner_warning[_ngcontent-%COMP%]{background:#ffe6c6}.op-modal-banner_info[_ngcontent-%COMP%]{background:#e3f5ff}.op-modal-banner--button[_ngcontent-%COMP%]{margin:0}"],changeDetection:0});class ut{constructor(B,x,A,Z){this.dateModalRelations=B,this.injector=x,this.I18n=A,this.state=Z,this.scheduleManually=!1,this.hasRelations$=this.dateModalRelations.hasRelations$,this.hasPrecedingRelations$=this.dateModalRelations.precedingWorkPackages$.pipe((0,y.U)(Ce=>(null==Ce?void 0:Ce.length)>0)),this.hasFollowingRelations$=this.dateModalRelations.followingWorkPackages$.pipe((0,y.U)(Ce=>(null==Ce?void 0:Ce.length)>0)),this.isParent=this.dateModalRelations.isParent,this.isChild=this.dateModalRelations.isChild,this.text={automatically_scheduled_parent:this.I18n.t("js.work_packages.datepicker_modal.automatically_scheduled_parent"),manually_scheduled:this.I18n.t("js.work_packages.datepicker_modal.manually_scheduled"),start_date_limited_by_relations:this.I18n.t("js.work_packages.datepicker_modal.start_date_limited_by_relations"),changing_dates_affects_follow_relations:this.I18n.t("js.work_packages.datepicker_modal.changing_dates_affects_follow_relations"),click_on_show_relations_to_open_gantt:this.I18n.t("js.work_packages.datepicker_modal.click_on_show_relations_to_open_gantt",{button_name:this.I18n.t("js.work_packages.datepicker_modal.show_relations")}),show_relations_button:this.I18n.t("js.work_packages.datepicker_modal.show_relations")}}openGantt(B){B.preventDefault(),this.dateModalRelations.getInvolvedWorkPackageIds().pipe((0,J.q)(1)).subscribe(x=>{const A={c:["id","subject","type","status","assignee","project","createdAt"],t:"id:asc",tv:!0,hi:!0,f:[{n:"id",o:"=",v:x}]},Z=this.state.href("work-packages.partitioned.list",{query_id:null,projects:null,projectPath:null,query_props:JSON.stringify(A)});window.open(Z,"_blank")})}}ut.\u0275fac=function(B){return new(B||ut)(i.Y36(pe),i.Y36(i.zs3),i.Y36(G.D),i.Y36(M.StateService))},ut.\u0275cmp=i.Xpm({type:ut,selectors:[["op-datepicker-banner"]],inputs:{scheduleManually:"scheduleManually"},decls:4,vars:5,consts:[["type","warning","actionButtonClasses","icon-view-timeline",3,"title","subtitle","actionButton","buttonClicked",4,"ngIf"],["type","info","actionButtonClasses","icon-view-timeline",3,"title","subtitle","actionButton","buttonClicked",4,"ngIf"],[4,"ngIf"],["type","warning","actionButtonClasses","icon-view-timeline",3,"title","subtitle","actionButton","buttonClicked"],["type","info","actionButtonClasses","icon-view-timeline",3,"title","subtitle","actionButton","buttonClicked"]],template:function(B,x){1&B&&(i.YNc(0,Zt,1,3,"op-modal-banner",0),i.ALo(1,"async"),i.YNc(2,Ct,1,3,"op-modal-banner",1),i.YNc(3,ri,6,8,"ng-container",2)),2&B&&(i.Q6J("ngIf",x.scheduleManually&&i.lcZ(1,3,x.hasRelations$)),i.xp6(2),i.Q6J("ngIf",!x.scheduleManually&&x.isParent),i.xp6(1),i.Q6J("ngIf",!x.scheduleManually&&!x.isParent))},directives:[e.O5,pt],pipes:[e.Ov],encapsulation:2,changeDetection:0});var ze=t(91448);class ke{constructor(B,x){this.I18n=B,this.cdRef=x,this.text={scheduling:{title:this.I18n.t("js.scheduling.title"),manual:this.I18n.t("js.scheduling.manual"),default:this.I18n.t("js.scheduling.default")}},this.schedulingOptions=[{value:!1,title:this.text.scheduling.default},{value:!0,title:this.text.scheduling.manual}],this.onChange=A=>{},this.onTouched=A=>{}}registerOnChange(B){this.onChange=B}registerOnTouched(B){this.onTouched=B}writeValue(B){this.scheduleManually=B,this.cdRef.markForCheck()}onToggle(B){this.writeValue(B),this.onChange(B),this.onTouched(B)}}ke.\u0275fac=function(B){return new(B||ke)(i.Y36(G.D),i.Y36(i.sBO))},ke.\u0275cmp=i.Xpm({type:ke,selectors:[["op-datepicker-scheduling-toggle"]],inputs:{scheduleManually:"scheduleManually"},features:[i._Bn([{provide:c.JU,useExisting:(0,i.Gpc)(()=>ke),multi:!0}])],decls:5,vars:5,consts:[[1,"op-form-field"],[1,"form--label"],[1,"form--field-container"],["data-qa-selector","op-datepicker-modal--scheduling-action",3,"options","value","name","ngModel","ngModelChange"]],template:function(B,x){1&B&&(i.TgZ(0,"div",0),i.TgZ(1,"label",1),i._uU(2),i.qZA(),i.TgZ(3,"div",2),i.TgZ(4,"spot-toggle",3),i.NdJ("ngModelChange",function(Z){return x.onToggle(Z)}),i.qZA(),i.qZA(),i.qZA()),2&B&&(i.xp6(2),i.hij(" ",x.text.scheduling.title," "),i.xp6(2),i.Q6J("options",x.schedulingOptions)("value",x.scheduleManually)("name","scheduling")("ngModel",x.scheduleManually))},directives:[ze.v,c.JJ,c.On],encapsulation:2,changeDetection:0});class Te{constructor(B,x){this.I18n=B,this.cdRef=x,this.disabled=!1,this.text={ignoreNonWorkingDays:{title:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.title"),yes:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.true"),no:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.false")}},this.ignoreNonWorkingDaysOptions=[{value:!1,title:this.text.ignoreNonWorkingDays.no},{value:!0,title:this.text.ignoreNonWorkingDays.yes}],this.onChange=A=>{},this.onTouched=A=>{}}registerOnChange(B){this.onChange=B}registerOnTouched(B){this.onTouched=B}onToggle(B){this.writeValue(B),this.onChange(B),this.onTouched(B)}writeValue(B){this.ignoreNonWorkingDays=B,this.cdRef.markForCheck()}}Te.\u0275fac=function(B){return new(B||Te)(i.Y36(G.D),i.Y36(i.sBO))},Te.\u0275cmp=i.Xpm({type:Te,selectors:[["op-datepicker-working-days-toggle"]],inputs:{ignoreNonWorkingDays:"ignoreNonWorkingDays",disabled:"disabled"},features:[i._Bn([{provide:c.JU,useExisting:(0,i.Gpc)(()=>Te),multi:!0}])],decls:5,vars:6,consts:[[1,"op-form-field"],[1,"form--label"],[1,"form--field-container"],["data-qa-selector","op-datepicker-modal--include-non-working-days",3,"disabled","options","value","name","ngModel","ngModelChange"]],template:function(B,x){1&B&&(i.TgZ(0,"div",0),i.TgZ(1,"label",1),i._uU(2),i.qZA(),i.TgZ(3,"div",2),i.TgZ(4,"spot-toggle",3),i.NdJ("ngModelChange",function(Z){return x.onToggle(Z)}),i.qZA(),i.qZA(),i.qZA()),2&B&&(i.xp6(2),i.hij(" ",x.text.ignoreNonWorkingDays.title," "),i.xp6(2),i.Q6J("disabled",x.disabled)("options",x.ignoreNonWorkingDaysOptions)("value",x.ignoreNonWorkingDays)("name","include-non-working-days")("ngModel",x.ignoreNonWorkingDays))},directives:[ze.v,c.JJ,c.On],encapsulation:2,changeDetection:0});var Re=t(87912);const $e=["modalContainer"],ot=function(ge){return{"op-datepicker-modal--date-field_current":ge}},dt=function(ge){return{"op-datepicker-modal--hidden-link":ge}};class _t extends Mt.T{constructor(B,x,A,Z,Ce,Ie){super(x,A,Z),this.injector=B,this.locals=x,this.cdRef=A,this.elementRef=Z,this.configurationService=Ce,this.apiV3Service=Ie,this.text={save:this.I18n.t("js.button_save"),cancel:this.I18n.t("js.button_cancel"),date:this.I18n.t("js.work_packages.properties.date"),placeholder:this.I18n.t("js.placeholders.default"),today:this.I18n.t("js.label_today"),scheduling:{title:this.I18n.t("js.scheduling.title"),manual:this.I18n.t("js.scheduling.manual"),default:this.I18n.t("js.scheduling.default")},ignoreNonWorkingDays:{title:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.title"),yes:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.true"),no:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.false")}},this.onDataUpdated=new i.vpe,this.scheduleManually=!1,this.schedulingOptions=[{value:!0,title:this.text.scheduling.manual},{value:!1,title:this.text.scheduling.default}],this.ignoreNonWorkingDays=!1,this.htmlId="",this.date=null,this.dateChangedManually$=new oe.xQ,this.debounceDelay=0,this.dateUpdates$=new oe.xQ,this.dateUpdateRequests$=this.dateUpdates$.pipe(this.untilDestroyed(),(0,je.w)(Be=>this.apiV3Service.work_packages.id(this.changeset.id).form.forPayload({date:Be,lockVersion:this.changeset.value("lockVersion"),ignoreNonWorkingDays:this.ignoreNonWorkingDays}))).subscribe(Be=>this.updateDatesFromForm(Be)),this.changeset=x.changeset,this.htmlId=`wp-datepicker-${x.fieldName}`,this.ignoreNonWorkingDays=!!this.changeset.value("ignoreNonWorkingDays"),this.date=this.changeset.value("date")}ngAfterViewInit(){this.dateModalRelations.getMinimalDateFromPreceeding().subscribe(B=>{this.initializeDatepicker(B),this.onDataChange()}),this.dateChangedManually$.pipe((0,It.D)(()=>(0,kt.H)(this.debounceDelay))).subscribe(()=>{this.debounceDelay=800,this.updateDate(this.date)})}changeSchedulingMode(){this.initializeDatepicker(),this.cdRef.detectChanges()}changeNonWorkingDays(){this.initializeDatepicker(),!this.ignoreNonWorkingDays&&this.date&&this.dateUpdates$.next(this.date),this.cdRef.detectChanges()}save(B){B.preventDefault(),this.changeset.setValue("scheduleManually",this.scheduleManually),this.changeset.setValue("ignoreNonWorkingDays",this.ignoreNonWorkingDays),this.dateModalScheduling.isSchedulable&&this.changeset.setValue("date",$t(this.date)),this.closeMe()}cancel(){this.closeMe()}updateDate(B){if(null!==B&&(B.length>=8||0===B.length)&&Ht(B)&&this.datePickerInstance){const x=vt(B)||void 0;this.enforceManualChangesToDatepicker(x)}}setToday(){const B=vt(new Date);this.date=this.timezoneService.formattedISODate(B),this.enforceManualChangesToDatepicker(B)}reposition(B,x){B.position({my:"left top",at:"left bottom",of:x,collision:"flipfit"})}initializeDatepicker(B){var x;null===(x=this.datePickerInstance)||void 0===x||x.destroy(),this.datePickerInstance=new yt.M(this.injector,"#flatpickr-input",this.date||"",{mode:"single",showMonths:this.browserDetector.isMobile?1:2,inline:!0,onReady:()=>{this.reposition(jQuery(this.modalContainer.nativeElement),jQuery(`.${gt.fA}`))},onChange:A=>{A.length>0&&(this.date=this.timezoneService.formattedISODate(A[0]),this.enforceManualChangesToDatepicker(A[0])),this.onDataChange(),this.cdRef.detectChanges()},onDayCreate:(A,Z,Ce,Ie)=>{var Be;ae(Ie,this.ignoreNonWorkingDays,null===(Be=this.datePickerInstance)||void 0===Be?void 0:Be.weekdaysService.isNonWorkingDay(Ie.dateObj),0,this.dateModalScheduling.isDayDisabled(Ie,B))}},null)}enforceManualChangesToDatepicker(B){de(vt(this.date||""),this.datePickerInstance,B)}onDataChange(){this.onDataUpdated.emit(this.date||"")}updateDatesFromForm(B){const x=B.payload;this.date=x.date,this.ignoreNonWorkingDays=x.ignoreNonWorkingDays;const A=vt(x.date);this.enforceManualChangesToDatepicker(A)}}_t.\u0275fac=function(B){return new(B||_t)(i.Y36(i.zs3),i.Y36(N.E),i.Y36(i.sBO),i.Y36(i.SBq),i.Y36(Ft.e),i.Y36(xe.T))},_t.\u0275cmp=i.Xpm({type:_t,selectors:[["ng-component"]],viewQuery:function(B,x){if(1&B&&i.Gf($e,5),2&B){let A;i.iGM(A=i.CRH())&&(x.modalContainer=A.first)}},features:[i._Bn([H,pe]),i.qOj],decls:20,vars:16,consts:[["data-qa-selector","op-datepicker-modal","data-indicator-name","modal",1,"spot-modal","op-datepicker-modal","loading-indicator--location",3,"submit"],["modalContainer",""],[3,"scheduleManually"],[1,"spot-modal--body","spot-container"],[1,"op-datepicker-modal--toggle-actions-container"],["name","scheduleManually",3,"ngModel","ngModelChange"],["name","ignoreNonWorkingDays",3,"ngModel","ngModelChange"],[1,"op-datepicker-modal--dates-container"],[1,"form--field","op-datepicker-modal--date-form"],[1,"form--label",3,"textContent"],[1,"form--field-container"],[1,"form--text-field-container","op-datepicker-modal--date-container"],["name","date",1,"op-datepicker-modal--date-field",3,"ngClass","ngModel","showClearButton","ngModelChange"],[1,"form--field-extra-actions"],["type","button",1,"spot-link",3,"ngClass","textContent","click"],["id","flatpickr-input","hidden",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["data-qa-selector","op-datepicker-modal--action",1,"op-datepicker-modal--action","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","op-datepicker-modal--action",1,"op-datepicker-modal--action","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(B,x){1&B&&(i.TgZ(0,"form",0,1),i.NdJ("submit",function(Z){return x.save(Z)}),i._UZ(2,"op-datepicker-banner",2),i.TgZ(3,"div",3),i.TgZ(4,"div",4),i.TgZ(5,"op-datepicker-scheduling-toggle",5),i.NdJ("ngModelChange",function(Z){return x.scheduleManually=Z})("ngModelChange",function(){return x.changeSchedulingMode()}),i.qZA(),i.TgZ(6,"op-datepicker-working-days-toggle",6),i.NdJ("ngModelChange",function(Z){return x.ignoreNonWorkingDays=Z})("ngModelChange",function(){return x.changeNonWorkingDays()}),i.qZA(),i.qZA(),i.TgZ(7,"div",7),i.TgZ(8,"div",8),i._UZ(9,"label",9),i.TgZ(10,"div",10),i.TgZ(11,"div",11),i.TgZ(12,"spot-text-field",12),i.NdJ("ngModelChange",function(Z){return x.date=Z})("ngModelChange",function(){return x.dateChangedManually$.next()}),i.qZA(),i.qZA(),i.qZA(),i.TgZ(13,"div",13),i.TgZ(14,"button",14),i.NdJ("click",function(){return x.setToday()}),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i._UZ(15,"input",15),i.qZA(),i.TgZ(16,"div",16),i.TgZ(17,"div",17),i.TgZ(18,"button",18),i.NdJ("click",function(){return x.cancel()}),i.qZA(),i._UZ(19,"button",19),i.qZA(),i.qZA(),i.qZA()),2&B&&(i.uIk("id",x.htmlId),i.xp6(2),i.Q6J("scheduleManually",x.scheduleManually),i.xp6(3),i.Q6J("ngModel",x.scheduleManually),i.xp6(1),i.Q6J("ngModel",x.ignoreNonWorkingDays),i.xp6(3),i.Q6J("textContent",x.text.date),i.xp6(3),i.Q6J("ngClass",i.VKq(12,ot,x.dateModalScheduling.isSchedulable))("ngModel",x.date)("showClearButton",!0),i.xp6(2),i.Q6J("ngClass",i.VKq(14,dt,!x.dateModalScheduling.isSchedulable))("textContent",x.text.today),i.xp6(4),i.Q6J("textContent",x.text.cancel),i.xp6(1),i.Q6J("textContent",x.text.save))},directives:[c._Y,c.JL,c.F,ut,ke,c.JJ,c.On,Te,Re.A,e.mk],styles:[".op-datepicker-modal{z-index:500;width:auto;max-width:600px;min-height:200px;box-shadow:4px 4px 10px #00000026;margin-bottom:60px}.op-datepicker-modal--toggle-actions-container{display:grid;grid-template-columns:auto 1fr;grid-column-gap:1rem}.op-datepicker-modal--dates-container{display:grid;grid-template-columns:1fr 1fr 150px;grid-column-gap:1rem}.op-datepicker-modal--date-field_current,.op-datepicker-modal--date-field_current:hover{outline:2px solid var(--primary-color);outline-offset:-2px}.op-datepicker-modal--date-container{display:inline-grid}.op-datepicker-modal--action:last-of-type{margin-right:0}.op-datepicker-modal--hidden-link{visibility:hidden}\n","@media screen and (max-width: 679px){.op-datepicker-modal{height:initial;max-width:300px}.op-datepicker-modal--dates-container{grid-template-columns:1fr 1fr}.op-datepicker-modal--date-form:only-child{grid-column:1/3}}\n"],encapsulation:2,changeDetection:0}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",G.D)],_t.prototype,"I18n",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],_t.prototype,"timezoneService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",jt.l)],_t.prototype,"halEditing",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",H)],_t.prototype,"dateModalScheduling",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",pe)],_t.prototype,"dateModalRelations",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Jt.o)],_t.prototype,"browserDetector",void 0);var Ut=t(89919),Lt=t(82516),Xt=t(52377),zt=t(7101);const li=["modalContainer"],mi=["durationField"],Ci=function(ge){return{"op-datepicker-modal--date-field_current":ge}},Zi=function(ge){return{"op-datepicker-modal--hidden-link":ge}};class Kt extends Mt.T{constructor(B,x,A,Z,Ce,Ie){super(x,A,Z),this.injector=B,this.locals=x,this.cdRef=A,this.elementRef=Z,this.configurationService=Ce,this.apiV3Service=Ie,this.text={save:this.I18n.t("js.button_save"),cancel:this.I18n.t("js.button_cancel"),startDate:this.I18n.t("js.work_packages.properties.startDate"),endDate:this.I18n.t("js.work_packages.properties.dueDate"),duration:this.I18n.t("js.work_packages.properties.duration"),placeholder:this.I18n.t("js.placeholders.default"),today:this.I18n.t("js.label_today"),days:Be=>this.I18n.t("js.units.day",{count:Be}),scheduling:{title:this.I18n.t("js.scheduling.title"),manual:this.I18n.t("js.scheduling.manual"),default:this.I18n.t("js.scheduling.default")},ignoreNonWorkingDays:{title:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.title"),yes:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.true"),no:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.false")}},this.onDataUpdated=new i.vpe,this.scheduleManually=!1,this.ignoreNonWorkingDays=!1,this.htmlId="",this.dates={start:null,end:null},this.startDateChanged$=new oe.xQ,this.startDateDebounced$=this.debouncedInput(this.startDateChanged$,"start"),this.endDateChanged$=new oe.xQ,this.endDateDebounced$=this.debouncedInput(this.endDateChanged$,"end"),this.datepickerChanged$=new oe.xQ,this.dateUpdates$=(0,Ut.T)(this.startDateDebounced$,this.endDateDebounced$,this.datepickerChanged$).pipe(this.untilDestroyed(),(0,ve.h)(()=>!!this.datePickerInstance)).subscribe(([Be,Tt])=>{null!==Tt&&this.handleSingleDateUpdate(Be,Tt),null===Tt&&"duration"!==Be&&this.clearWithDuration(Be),this.onDataChange(),this.cdRef.detectChanges()}),this.durationChanges$=new oe.xQ,this.durationDebounced$=this.durationChanges$.pipe(this.untilDestroyed(),(0,Oe.b)(500),(0,y.U)(Be=>""===Be?null:Math.abs(parseInt(Be,10))),(0,ve.h)(Be=>null===Be||!Number.isNaN(Be)),(0,ve.h)(Be=>Be!==this.duration)).subscribe(Be=>this.applyDurationChange(Be)),this.durationFocused=!1,this.ignoreNonWorkingDaysWritable=!0,this.formUpdates$=new oe.xQ,this.dateUpdateRequests$=this.formUpdates$.pipe(this.untilDestroyed(),(0,je.w)(Be=>this.apiV3Service.work_packages.withOptionalId("new"===this.changeset.id?null:this.changeset.id).form.forPayload(Object.assign(Object.assign({},Be),{lockVersion:this.changeset.value("lockVersion"),ignoreNonWorkingDays:this.ignoreNonWorkingDays,scheduleManually:this.scheduleManually})))).subscribe(Be=>this.updateDatesFromForm(Be)),this.changeset=x.changeset,this.htmlId=`wp-datepicker-${x.fieldName}`,this.scheduleManually=!!this.changeset.value("scheduleManually"),this.ignoreNonWorkingDays=!!this.changeset.value("ignoreNonWorkingDays"),this.changeset.getForm().then(Be=>{this.ignoreNonWorkingDaysWritable=!!Be.schema.ignoreNonWorkingDays.writable,this.cdRef.detectChanges()}),this.setDurationDaysFromUpstream(this.changeset.value("duration")),this.dates.start=this.changeset.value("startDate"),this.dates.end=this.changeset.value("dueDate"),this.setCurrentActivatedField(this.initialActivatedField)}ngAfterViewInit(){this.dateModalRelations.getMinimalDateFromPreceeding().subscribe(B=>{this.initializeDatepicker(B),this.onDataChange()}),"duration"===this.initialActivatedField&&this.focusHelper.focus(this.durationField.nativeElement)}changeSchedulingMode(){this.initializeDatepicker(),!1===this.scheduleManually&&!this.ignoreNonWorkingDaysWritable&&(this.ignoreNonWorkingDays=!!this.changeset.value("ignoreNonWorkingDays")),this.cdRef.detectChanges()}changeNonWorkingDays(){this.initializeDatepicker(),!!this.dates.start&&!!this.duration&&this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}),!!this.dates.start&&!this.dates.end&&this.formUpdates$.next({startDate:this.dates.start}),!!this.dates.end&&!this.dates.start&&this.formUpdates$.next({dueDate:this.dates.end}),this.cdRef.detectChanges()}save(B){B.preventDefault(),this.changeset.setValue("scheduleManually",this.scheduleManually),this.changeset.setValue("ignoreNonWorkingDays",this.ignoreNonWorkingDays),this.isSchedulable&&(this.changeset.setValue("startDate",$t(this.dates.start)),this.changeset.setValue("dueDate",$t(this.dates.end)),this.changeset.setValue("duration",this.durationAsIso8601)),this.closeMe()}cancel(){this.closeMe()}updateDate(B,x){if((null===x||Ht(x))&&this.datePickerInstance){this.dates[B]=$t(x);const A=vt(x||"")||void 0;this.enforceManualChangesToDatepicker(A),this.cdRef.detectChanges()}}setCurrentActivatedField(B){this.currentlyActivatedDateField=B}toggleCurrentActivatedField(){this.currentlyActivatedDateField="start"===this.currentlyActivatedDateField?"end":"start"}isStateOfCurrentActivatedField(B){return this.currentlyActivatedDateField===B}setToday(B){this.datepickerChanged$.next([B,new Date]);const x="start"===B?"end":"start";this.setCurrentActivatedField(x)}reposition(B,x){B.position({my:"left top",at:"left bottom",of:x,collision:"flipfit"})}showTodayLink(){return this.isSchedulable}get isSchedulable(){return this.scheduleManually||!this.dateModalRelations.isParent}showFieldAsActive(B){return this.isStateOfCurrentActivatedField(B)&&this.isSchedulable}handleDurationFocusIn(){this.durationFocused=!0,this.setCurrentActivatedField("duration")}handleDurationFocusOut(){setTimeout(()=>{this.durationFocused=!1})}get displayedDuration(){return this.duration?this.text.days(this.duration):""}applyDurationChange(B){this.duration=B,this.cdRef.detectChanges(),null!==B?this.dates.start?this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}):this.dates.end&&this.formUpdates$.next({dueDate:this.dates.end,duration:this.durationAsIso8601}):this.updateDate("end",null)}get durationAsIso8601(){return this.duration?this.timezoneService.toISODuration(this.duration,"days"):null}clearWithDuration(B){this.duration=null,this.dates[B]=null,this.enforceManualChangesToDatepicker()}initializeDatepicker(B){var x;null===(x=this.datePickerInstance)||void 0===x||x.destroy(),this.datePickerInstance=new yt.M(this.injector,"#flatpickr-input",[this.dates.start||"",this.dates.end||""],{mode:"range",showMonths:this.browserDetector.isMobile?1:2,inline:!0,onReady:(A,Z,Ce)=>{this.reposition(jQuery(this.modalContainer.nativeElement),jQuery(`.${gt.fA}`)),this.ensureHoveredSelection(Ce.calendarContainer)},onChange:(A,Z,Ce)=>{const{latestSelectedDateObj:Ie}=Ce,Be=this.currentlyActivatedDateField;this.datepickerChanged$.next([Be,Ie]),"duration"!==Be&&this.toggleCurrentActivatedField()},onDayCreate:(A,Z,Ce,Ie)=>{ae(Ie,this.ignoreNonWorkingDays,this.weekdayService.isNonWorkingDay(Ie.dateObj),0,this.isDayDisabled(Ie,B))}},null)}enforceManualChangesToDatepicker(B){let x=vt(this.dates.start||""),A=vt(this.dates.end||"");x&&A&&(x>A&&this.isStateOfCurrentActivatedField("start")?(A=x,this.dates.end=this.timezoneService.formattedISODate(A)):A<x&&this.isStateOfCurrentActivatedField("end")&&(x=A,this.dates.start=this.timezoneService.formattedISODate(x))),de([x,A],this.datePickerInstance,B),this.onDataChange()}handleSingleDateUpdate(B,x){"duration"!==B?this.dates.start&&this.dates.end?this.replaceDatesWithNewSelection(B,x):(this.moveActiveDate(B,x),this.duration?this.deriveMissingDateFromDuration(B):this.dates.start&&this.dates.end&&this.formUpdates$.next({startDate:this.dates.start,dueDate:this.dates.end}),this.enforceManualChangesToDatepicker(x)):this.durationActiveDateSelected(x)}durationActiveDateSelected(B){const x=this.timezoneService.formattedISODate(B);!this.duration&&this.dates.start?(this.setDaysInOrder(this.dates.start,x),this.setCurrentActivatedField("start")):(this.setDaysInOrder(x,this.dates.end),this.setCurrentActivatedField("end")),this.dates.start&&this.duration?this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}):this.dates.start&&this.dates.end&&this.formUpdates$.next({startDate:this.dates.start,dueDate:this.dates.end})}setDaysInOrder(B,x){const A=B?vt(B):null,Z=x?vt(x):null;A&&Z&&A>Z?(this.dates.start=x,this.dates.end=B):(this.dates.start=B,this.dates.end=x)}deriveMissingDateFromDuration(B){"start"===B&&!!this.dates.start&&this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}),"end"===B&&this.dates.end&&this.formUpdates$.next({dueDate:this.dates.end,duration:this.durationAsIso8601})}moveActiveDate(B,x){const A=this.dates.start?vt(this.dates.start):null,Z=this.dates.end?vt(this.dates.end):null;this.dates[B]=this.timezoneService.formattedISODate(x),"end"===B&&A&&A>x&&(this.duration=null,this.dates.start=null,this.enforceManualChangesToDatepicker(x)),"start"===B&&Z&&Z<x&&(this.duration=null,this.dates.end=null,this.enforceManualChangesToDatepicker(x))}replaceDatesWithNewSelection(B,x){const A=vt(this.dates.start||""),Z=vt(this.dates.end||"");if(x<A)"start"===B?this.applyNewDates([x]):(this.duration=null,this.applyNewDates(["",x]));else if(x>Z)"end"===B?this.applyNewDates([A,x]):(this.duration=null,this.applyNewDates([x]));else if(Wt(x,A)||Wt(x,Z))this.applyNewDates([x,x]);else{const Ce="start"===B?[x,Z]:[A,x];this.applyNewDates(Ce)}}applyNewDates([B,x]){this.dates.start=B?this.timezoneService.formattedISODate(B):null,this.dates.end=x?this.timezoneService.formattedISODate(x):null,de([B,x],this.datePickerInstance),this.dates.start&&this.dates.end&&this.formUpdates$.next({startDate:this.dates.start,dueDate:this.dates.end}),this.dates.start&&!this.dates.end&&!!this.duration&&this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}),this.dates.end&&!this.dates.start&&this.duration&&this.formUpdates$.next({dueDate:this.dates.end,duration:this.durationAsIso8601})}onDataChange(){const A=`${this.dates.start||""} - ${this.dates.end||""}`;this.onDataUpdated.emit(A)}get initialActivatedField(){switch(this.locals.fieldName){case"startDate":return"start";case"dueDate":return"end";case"duration":return"duration";default:return this.dates.start&&!this.dates.end?"end":"start"}}isDayDisabled(B,x){return!this.isSchedulable||!this.scheduleManually&&!!x&&B.dateObj<=x}updateDatesFromForm(B){const x=B.payload;this.dates.start=x.startDate,this.dates.end=x.dueDate,this.ignoreNonWorkingDays=x.ignoreNonWorkingDays,this.setDurationDaysFromUpstream(x.duration);const A=vt(this.dates.start);this.enforceManualChangesToDatepicker(A),this.cdRef.detectChanges()}setDurationDaysFromUpstream(B){const x=B?this.timezoneService.toDays(B):null;this.duration=x&&0!==x?x:null}debouncedInput(B,x){return B.pipe(this.untilDestroyed(),(0,ve.h)(A=>A!==this.dates[x]),(0,Oe.b)(500),(0,ve.h)(A=>Ht(A)),(0,y.U)(A=>""===A?null:vt(A)),(0,y.U)(A=>[x,A]))}ensureHoveredSelection(B){(0,Lt.R)(B,"mouseenter").pipe(this.untilDestroyed()).subscribe(()=>B.classList.remove("flatpickr-container-suppress-hover")),(0,Lt.R)(B,"mouseleave").pipe(this.untilDestroyed(),(0,ve.h)(()=>!(this.dates.start&&this.dates.end))).subscribe(()=>B.classList.add("flatpickr-container-suppress-hover"))}}Kt.\u0275fac=function(B){return new(B||Kt)(i.Y36(i.zs3),i.Y36(N.E),i.Y36(i.sBO),i.Y36(i.SBq),i.Y36(Ft.e),i.Y36(xe.T))},Kt.\u0275cmp=i.Xpm({type:Kt,selectors:[["ng-component"]],viewQuery:function(B,x){if(1&B&&(i.Gf(li,5),i.Gf(mi,5,i.SBq)),2&B){let A;i.iGM(A=i.CRH())&&(x.modalContainer=A.first),i.iGM(A=i.CRH())&&(x.durationField=A.first)}},features:[i._Bn([H,pe]),i.qOj],decls:33,vars:39,consts:[["data-qa-selector","op-datepicker-modal","data-indicator-name","modal",1,"spot-modal","op-datepicker-modal","loading-indicator--location",3,"submit"],["modalContainer",""],[3,"scheduleManually"],[1,"spot-modal--body","spot-container","form","-vertical"],[1,"op-datepicker-modal--toggle-actions-container"],["name","scheduleManually",3,"ngModel","ngModelChange"],["name","ignoreNonWorkingDays",3,"disabled","ngModel","ngModelChange"],[1,"op-datepicker-modal--dates-container"],["data-qa-selector","datepicker-start-date",1,"op-form-field","op-datepicker-modal--date-form"],[1,"form--label",3,"textContent"],[1,"form--field-container"],[1,"form--text-field-container","op-datepicker-modal--date-container"],["name","startDate","data-qa-selector","op-datepicker-modal--start-date-field",1,"op-datepicker-modal--date-field",3,"ngClass","ngModel","disabled","showClearButton","ngModelChange","focusin"],[1,"form--field-extra-actions"],["type","button",1,"spot-link",3,"ngClass","textContent","click"],["data-qa-selector","datepicker-end-date",1,"op-form-field","op-datepicker-modal--date-form"],["name","endDate","data-qa-selector","op-datepicker-modal--end-date-field",1,"op-datepicker-modal--date-field",3,"ngClass","ngModel","disabled","showClearButton","ngModelChange","focusin"],["data-qa-selector","datepicker-duration",1,"op-form-field","op-datepicker-modal--date-form"],["name","duration","data-qa-selector","op-datepicker-modal--duration-field",1,"op-datepicker-modal--date-field",3,"ngClass","ngModel","showClearButton","disabled","ngModelChange","focusin","focusout"],["durationField",""],["id","flatpickr-input","hidden",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["data-qa-selector","op-datepicker-modal--action",1,"op-datepicker-modal--action","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["type","submit","data-qa-selector","op-datepicker-modal--action",1,"op-datepicker-modal--action","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(B,x){1&B&&(i.TgZ(0,"form",0,1),i.NdJ("submit",function(Z){return x.save(Z)}),i._UZ(2,"op-datepicker-banner",2),i.TgZ(3,"div",3),i.TgZ(4,"div",4),i.TgZ(5,"op-datepicker-scheduling-toggle",5),i.NdJ("ngModelChange",function(Z){return x.scheduleManually=Z})("ngModelChange",function(){return x.changeSchedulingMode()}),i.qZA(),i.TgZ(6,"op-datepicker-working-days-toggle",6),i.NdJ("ngModelChange",function(Z){return x.ignoreNonWorkingDays=Z})("ngModelChange",function(){return x.changeNonWorkingDays()}),i.qZA(),i.qZA(),i.TgZ(7,"div",7),i.TgZ(8,"div",8),i._UZ(9,"label",9),i.TgZ(10,"div",10),i.TgZ(11,"div",11),i.TgZ(12,"spot-text-field",12),i.NdJ("ngModelChange",function(Z){return x.startDateChanged$.next(Z)})("focusin",function(){return x.setCurrentActivatedField("start")}),i.qZA(),i.qZA(),i.qZA(),i.TgZ(13,"div",13),i.TgZ(14,"button",14),i.NdJ("click",function(){return x.setToday("start")}),i.qZA(),i.qZA(),i.qZA(),i.TgZ(15,"div",15),i._UZ(16,"label",9),i.TgZ(17,"div",10),i.TgZ(18,"div",11),i.TgZ(19,"spot-text-field",16),i.NdJ("ngModelChange",function(Z){return x.endDateChanged$.next(Z)})("focusin",function(){return x.setCurrentActivatedField("end")}),i.qZA(),i.qZA(),i.qZA(),i.TgZ(20,"div",13),i.TgZ(21,"button",14),i.NdJ("click",function(){return x.setToday("end")}),i.qZA(),i.qZA(),i.qZA(),i.TgZ(22,"div",17),i._UZ(23,"label",9),i.TgZ(24,"div",10),i.TgZ(25,"div",11),i.TgZ(26,"spot-text-field",18,19),i.NdJ("ngModelChange",function(Z){return x.durationChanges$.next(Z)})("focusin",function(){return x.handleDurationFocusIn()})("focusout",function(){return x.handleDurationFocusOut()}),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i._UZ(28,"input",20),i.qZA(),i.TgZ(29,"div",21),i.TgZ(30,"div",22),i.TgZ(31,"button",23),i.NdJ("click",function(){return x.cancel()}),i.qZA(),i._UZ(32,"button",24),i.qZA(),i.qZA(),i.qZA()),2&B&&(i.uIk("id",x.htmlId),i.xp6(2),i.Q6J("scheduleManually",x.scheduleManually),i.xp6(3),i.Q6J("ngModel",x.scheduleManually),i.xp6(1),i.Q6J("disabled",!(x.scheduleManually||x.ignoreNonWorkingDaysWritable))("ngModel",x.ignoreNonWorkingDays),i.xp6(3),i.Q6J("textContent",x.text.startDate),i.xp6(3),i.Q6J("ngClass",i.VKq(29,Ci,x.showFieldAsActive("start")))("ngModel",x.dates.start)("disabled",!x.isSchedulable)("showClearButton","start"===x.currentlyActivatedDateField),i.uIk("data-qa-highlighted",x.showFieldAsActive("start")||void 0),i.xp6(2),i.Q6J("ngClass",i.VKq(31,Zi,!x.showTodayLink()))("textContent",x.text.today),i.xp6(2),i.Q6J("textContent",x.text.endDate),i.xp6(3),i.Q6J("ngClass",i.VKq(33,Ci,x.showFieldAsActive("end")))("ngModel",x.dates.end)("disabled",!x.isSchedulable)("showClearButton","end"===x.currentlyActivatedDateField),i.uIk("data-qa-highlighted",x.showFieldAsActive("end")||void 0),i.xp6(2),i.Q6J("ngClass",i.VKq(35,Zi,!x.showTodayLink()))("textContent",x.text.today),i.xp6(2),i.Q6J("textContent",x.text.duration),i.xp6(3),i.Q6J("ngClass",i.VKq(37,Ci,x.showFieldAsActive("duration")))("ngModel",x.durationFocused?x.duration:x.displayedDuration)("showClearButton",x.durationFocused)("disabled",!x.isSchedulable),i.uIk("data-qa-highlighted",x.showFieldAsActive("duration")||void 0),i.xp6(5),i.Q6J("textContent",x.text.cancel),i.xp6(1),i.Q6J("textContent",x.text.save))},directives:[c._Y,c.JL,c.F,ut,ke,c.JJ,c.On,Te,Re.A,e.mk],styles:[".op-datepicker-modal{z-index:500;width:auto;max-width:600px;min-height:200px;box-shadow:4px 4px 10px #00000026;margin-bottom:60px}.op-datepicker-modal--toggle-actions-container{display:grid;grid-template-columns:auto 1fr;grid-column-gap:1rem}.op-datepicker-modal--dates-container{display:grid;grid-template-columns:1fr 1fr 150px;grid-column-gap:1rem}.op-datepicker-modal--date-field_current,.op-datepicker-modal--date-field_current:hover{outline:2px solid var(--primary-color);outline-offset:-2px}.op-datepicker-modal--date-container{display:inline-grid}.op-datepicker-modal--action:last-of-type{margin-right:0}.op-datepicker-modal--hidden-link{visibility:hidden}\n","@media screen and (max-width: 679px){.op-datepicker-modal{height:initial;max-width:300px}.op-datepicker-modal--dates-container{grid-template-columns:1fr 1fr}.op-datepicker-modal--date-form:only-child{grid-column:1/3}}\n"],encapsulation:2,changeDetection:0}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",G.D)],Kt.prototype,"I18n",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],Kt.prototype,"timezoneService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",jt.l)],Kt.prototype,"halEditing",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",H)],Kt.prototype,"dateModalScheduling",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",pe)],Kt.prototype,"dateModalRelations",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Jt.o)],Kt.prototype,"browserDetector",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Xt.u)],Kt.prototype,"weekdayService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",zt.i)],Kt.prototype,"focusHelper",void 0);class ei extends v.su{ngOnInit(){super.ngOnInit(),this.handler.$onUserActivate.pipe(this.untilDestroyed()).subscribe(()=>{this.showDatePickerModal()})}ngOnDestroy(){var B;super.ngOnDestroy(),null===(B=this.modal)||void 0===B||B.closeMe()}showDatePickerModal(){const B=this.change.schema.isMilestone?_t:Kt;this.modal=this.opModalService.show(B,this.injector,{changeset:this.change,fieldName:this.name},!0);const{modal:x}=this;setTimeout(()=>{const A=jQuery(x.elementRef.nativeElement).find(".op-datepicker-modal"),Z=jQuery(this.elementRef.nativeElement);x.reposition(A,Z)}),x.closingEvent.pipe((0,J.q)(1)).subscribe(()=>{this.handler.handleUserSubmit()})}}ei.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(ei)))(x||ei)}}(),ei.\u0275dir=i.lG2({type:ei,features:[i.qOj]}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],ei.prototype,"timezoneService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",N.S)],ei.prototype,"opModalService",void 0);class ai extends ei{constructor(){super(...arguments),this.dates="",this.text_no_start_date=this.I18n.t("js.label_no_start_date"),this.text_no_due_date=this.I18n.t("js.label_no_due_date")}showDatePickerModal(){super.showDatePickerModal(),this.modal.onDataUpdated.subscribe(B=>{this.dates=B,this.cdRef.detectChanges()})}initialize(){super.initialize(),this.dates=`${this.currentStartDate} - ${this.currentDueDate}`}get currentStartDate(){return this.resource&&this.resource.startDate||this.text_no_start_date}get currentDueDate(){return this.resource&&this.resource.dueDate||this.text_no_due_date}}ai.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(ai)))(x||ai)}}(),ai.\u0275cmp=i.Xpm({type:ai,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:1,consts:[["type","text",1,"op-input",3,"value","click"]],template:function(B,x){1&B&&(i.TgZ(0,"input",0),i.NdJ("click",function(){return x.showDatePickerModal()}),i.qZA()),2&B&&i.Q6J("value",x.dates)},encapsulation:2,changeDetection:0});var Ri=t(54622),bi=t(61598);function Oi(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"edit-field-controls",4),i.NdJ("onSave",function(){return i.CHM(x),i.oxw().handleUserSubmit()})("onCancel",function(){return i.CHM(x),i.oxw().handler.handleUserCancel()}),i.qZA()}if(2&ge){const x=i.oxw();i.Q6J("fieldController",x.field)("saveTitle",x.text.save)("cancelTitle",x.text.cancel)}}class St extends Ee{constructor(){super(...arguments),this.isBusy=!1,this.name="comment"}get required(){return!0}ngOnInit(){super.ngOnInit()}}St.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(St)))(x||St)}}(),St.\u0275cmp=i.Xpm({type:St,selectors:[["ng-component"]],features:[i.qOj],decls:4,vars:3,consts:[[1,"textarea-wrapper"],[1,"op-ckeditor--wrapper","op-ckeditor-element"],[3,"context","content","onContentChange","onInitializationFailed","onInitialized"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel",4,"ngIf"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel"]],template:function(B,x){1&B&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"op-ckeditor",2),i.NdJ("onContentChange",function(Z){return x.onContentChange(Z)})("onInitializationFailed",function(){return x.initializationError=!0})("onInitialized",function(Z){return x.onCkeditorSetup(Z)}),i.qZA(),i.qZA(),i.YNc(3,Oi,1,3,"edit-field-controls",3),i.qZA()),2&B&&(i.xp6(2),i.Q6J("context",x.ckEditorContext)("content",x.initialContent),i.xp6(1),i.Q6J("ngIf",!(x.handler.inEditMode||x.initializationError)))},directives:[_e.F,e.O5,V.e],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ft.e)],St.prototype,"ConfigurationService",void 0);t(94232),t(86029);var cn=t(91923),wi=t(53882),Pn=t(5443),xn=t(70099);function Fi(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"op-project-autocompleter",2),i.NdJ("valueChange",function(Z){return i.CHM(x),i.oxw().onModelChange(Z)})("cancel",function(){return i.CHM(x),i.oxw().handler.handleUserCancel()}),i.qZA()}if(2&ge){const x=i.oxw();i.Q6J("ngClass","inline-edit--field "+x.handler.fieldName)("value",x.value)("url",x.url)("apiFilters",x.APIFilters)("focusDirectly",!(x.handler.inEditMode||x.isNew))("openDirectly",!x.isNew)("isInlineContext",!0)}}function En(ge,B){1&ge&&(i.TgZ(0,"op-content-loader",3),i.O4$(),i._UZ(1,"rect",4),i.qZA())}class Wi extends v.su{constructor(B,x,A,Z,Ce,Ie,Be,Tt,Qt,bt){super(B,x,A,Z,Ce,Ie,Be),this.I18n=B,this.elementRef=x,this.change=A,this.schema=Z,this.handler=Ce,this.cdRef=Ie,this.injector=Be,this.apiV3Service=Tt,this.http=Qt,this.halResourceService=bt,this.isNew=(0,ye.Z)(this.resource)}initialize(){this.schema.allowedValues?this.setUrl():this.loadFormAndSetUrl()}onModelChange(B){if(B){const x=Object.assign({},B),A=this.halResourceService.createHalResourceOfType("project",x);this.value=A}else this.value=null;return this.handler.handleUserSubmit()}get APIFilters(){const B=[["active","=",["t"]]];if((0,ye.Z)(this.resource)&&this.change.value("type")){const x=(0,Ae.Z)(this.change.value("type").href);B.push(["type_id","=",[x]])}return B}loadFormAndSetUrl(){(0,O.D)(this.change.getForm()).pipe((0,b.b)(()=>this.setUrl()),(0,J.q)(1)).subscribe()}setUrl(){this.url=this.schema.allowedValues.$link.href}}Wi.\u0275fac=function(B){return new(B||Wi)(i.Y36(G.D),i.Y36(i.SBq),i.Y36(v.Nm),i.Y36(v.Dz),i.Y36(v.uS),i.Y36(i.sBO),i.Y36(i.zs3),i.Y36(xe.T),i.Y36(wi.eN),i.Y36(cn.u))},Wi.\u0275cmp=i.Xpm({type:Wi,selectors:[["ng-component"]],features:[i.qOj],decls:3,vars:2,consts:[["appendTo",".op-wide-autocomplete-wrapper",3,"ngClass","value","url","apiFilters","focusDirectly","openDirectly","isInlineContext","valueChange","cancel",4,"ngIf","ngIfElse"],["loadingTemplate",""],["appendTo",".op-wide-autocomplete-wrapper",3,"ngClass","value","url","apiFilters","focusDirectly","openDirectly","isInlineContext","valueChange","cancel"],["viewBox","0 0 100 24",1,"project-edit-field--loading-indicator"],["x","0","y","0","width","100%","height","100%","rx","1"]],template:function(B,x){if(1&B&&(i.YNc(0,Fi,1,7,"op-project-autocompleter",0),i.YNc(1,En,2,0,"ng-template",null,1,i.W1O)),2&B){const A=i.MAs(2);i.Q6J("ngIf",x.url)("ngIfElse",A)}},directives:[e.O5,Pn.F,e.mk,xn.V],styles:[".project-edit-field--loading-indicator svg{display:block}\n"],encapsulation:2,changeDetection:0});class gi extends v.su{parser(B,x){return null==B&&!x.validity.valid&&(B=this.value||0),be.duration(B,"hours")}formatter(B){return Number(be.duration(B).asHours().toFixed(2))}parseValue(B){if(null===B)return B;let x;return x=B.isValid()?B.toISOString():null,x}}gi.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(gi)))(x||gi)}}(),gi.\u0275cmp=i.Xpm({type:gi,selectors:[["ng-component"]],features:[i.qOj],decls:2,vars:5,consts:[["type","number","step","0.01",1,"inline-edit--field","op-input",3,"ngModel","disabled","id","ngModelChange","keydown"],["input",""]],template:function(B,x){if(1&B){const A=i.EpF();i.TgZ(0,"input",0,1),i.NdJ("ngModelChange",function(Ce){i.CHM(A);const Ie=i.MAs(1);return x.value=x.parser(Ce,Ie)})("keydown",function(Ce){return x.handler.handleUserKeydown(Ce)}),i.qZA()}2&B&&(i.Q6J("ngModel",x.formatter(x.value))("disabled",x.inFlight)("id",x.handler.htmlId),i.uIk("aria-required",x.required)("required",x.required))},directives:[c.wV,c.Fj,c.JJ,c.On,c.Q7],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],gi.prototype,"TimezoneService",void 0);var Ti=t(90127);function Ui(ge,B){if(1&ge){const x=i.EpF();i.TgZ(0,"op-user-autocompleter",1),i.NdJ("valueChange",function(Z){return i.CHM(x),i.oxw().onModelChange(Z)})("cancel",function(){return i.CHM(x),i.oxw().handler.handleUserCancel()})("userInvited",function(Z){return i.CHM(x),i.oxw().onModelChange(Z)}),i.qZA()}if(2&ge){const x=i.oxw();i.Gre("inline-edit--field ",x.handler.fieldName,""),i.Q6J("clearAfterSelection",!1)("url",x.url)("inviteUserToProject",null==x.resource.project?null:x.resource.project.id)("focusDirectly",!(x.handler.inEditMode||x.isNew))("openDirectly",!(x.handler.inEditMode||x.isNew))("value",x.value)("id",x.handler.htmlId)}}class ki extends v.su{constructor(B,x,A,Z,Ce,Ie,Be,Tt,Qt,bt){super(B,x,A,Z,Ce,Ie,Be),this.I18n=B,this.elementRef=x,this.change=A,this.schema=Z,this.handler=Ce,this.cdRef=Ie,this.injector=Be,this.apiV3Service=Tt,this.http=Qt,this.halResourceService=bt,this.isNew=(0,ye.Z)(this.resource)}initialize(){const B=this.schema.allowedValues;B&&(this.url=B.$link.href)}onModelChange(B){if(B){const x=Object.assign({},B);this.value=this.halResourceService.createHalResourceOfType("user",x)}else this.value=null;return this.handler.handleUserSubmit()}}ki.\u0275fac=function(B){return new(B||ki)(i.Y36(G.D),i.Y36(i.SBq),i.Y36(v.Nm),i.Y36(v.Dz),i.Y36(v.uS),i.Y36(i.sBO),i.Y36(i.zs3),i.Y36(xe.T),i.Y36(wi.eN),i.Y36(cn.u))},ki.\u0275cmp=i.Xpm({type:ki,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:1,consts:[["appendTo","body",3,"class","clearAfterSelection","url","inviteUserToProject","focusDirectly","openDirectly","value","id","valueChange","cancel","userInvited",4,"ngIf"],["appendTo","body",3,"clearAfterSelection","url","inviteUserToProject","focusDirectly","openDirectly","value","id","valueChange","cancel","userInvited"]],template:function(B,x){1&B&&i.YNc(0,Ui,1,10,"op-user-autocompleter",0),2&B&&i.Q6J("ngIf",x.url)},directives:[e.O5,Ti.U],encapsulation:2,changeDetection:0});class yi extends ei{get formattedValue(){return Number(moment.duration(this.value).asDays().toFixed(0))}}yi.\u0275fac=function(){let ge;return function(x){return(ge||(ge=i.n5z(yi)))(x||yi)}}(),yi.\u0275cmp=i.Xpm({type:yi,selectors:[["ng-component"]],features:[i.qOj],decls:1,vars:2,consts:[["type","number","disabled","disabled",1,"inline-edit--field","op-input",3,"ngModel","id"]],template:function(B,x){1&B&&i._UZ(0,"input",0),2&B&&i.Q6J("ngModel",x.formattedValue)("id",x.handler.htmlId)},directives:[c.wV,c.Fj,c.JJ,c.On],encapsulation:2,changeDetection:0});var Dt=t(55741);class fi extends Dt.C{}class Gi extends Dt.C{get valueString(){return null==this.value?"":this.value.toLocaleString(this.I18n.locale,{useGrouping:!0,maximumFractionDigits:20})}}class On extends Dt.C{get value(){return parseInt(this.resource[this.name])}isEmpty(){return isNaN(this.value)}}class Ii extends Dt.C{get value(){return this.schema?this.attribute&&this.attribute.name:null}}var qi=t(79644),Mn=t(80261);class ln extends Dt.C{render(B,x,A={}){const Z=document.createElement("div");Z.classList.add("read-value--html","highlight","op-uc-container","op-uc-container_reduced-headings","-multiline"),A.rtl&&Z.classList.add("-rtl"),Z.innerHTML=x,B.innerHTML="",B.appendChild(Z),Mn.Z.bootstrapOptionalEmbeddable(this.appRef,Z)}get placeholder(){return"description"===this.name?this.I18n.t("js.placeholders.description"):super.placeholder}get isFormattable(){return!0}get value(){if(!this.schema)return null;const B=this.resource[this.name];return B&&B.html?this.unescape(B.html):""}unescape(B){return B?class{static get UNESCAPED_EXPRESSION(){return"{{"}static get ESCAPED_EXPRESSION(){return"{{ \\$root\\.DOUBLE_LEFT_CURLY_BRACE }}"}static escape(B){return B.replace(new RegExp(this.UNESCAPED_EXPRESSION,"g"),this.ESCAPED_EXPRESSION)}static unescape(B){return B.replace(new RegExp(this.ESCAPED_EXPRESSION,"g"),this.UNESCAPED_EXPRESSION)}}.unescape(B):""}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",i.z2F)],ln.prototype,"appRef",void 0);var dn=t(63733);class xi extends Dt.C{get valueString(){return this.value?this.timezoneService.formattedDatetime(this.value):""}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],xi.prototype,"timezoneService",void 0);class In extends Dt.C{get valueString(){return this.translatedValue()}get placeholder(){return this.translatedValue()}translatedValue(){return this.value?this.I18n.t("js.general_text_yes"):this.I18n.t("js.general_text_no")}isEmpty(){return!1}}var Si=t(39469);class Ei extends Dt.C{constructor(){super(...arguments),this.text={none:this.I18n.t("js.filter.noneElement")}}get value(){return this.resource[this.name]}get title(){return this.isEmpty()?this.text.none:this.value.name}get wpId(){return this.isEmpty()?null:this.value.$loaded?this.value.id:this.value.href.match(/(\d+)$/)[0]}get valueString(){return`#${this.wpId} ${this.title}`}isEmpty(){return!this.value}get unknownAttribute(){return!1}}var Sn=t(70233),pn=t(97973),di=t(46709);class Gt extends Dt.C{constructor(){super(...arguments),this.derivedText=this.I18n.t("js.label_value_derived_from_children")}get valueString(){return this.timezoneService.formattedDuration(this.value)}get derivedPropertyName(){return`derived${this.name.charAt(0).toUpperCase()}${this.name.slice(1)}`}get derivedValue(){return this.resource[this.derivedPropertyName]}get derivedValueString(){const B=this.derivedValue;return B?this.timezoneService.formattedDuration(B):this.placeholder}render(B,x){if(this.isEmpty())return void(B.textContent=this.placeholder);B.classList.add("split-time-field"),this.value&&this.renderActual(B,x);const A=this.derivedValue;A&&0!==this.timezoneService.toHours(A)&&this.renderDerived(B,this.derivedValueString,!!this.value)}renderActual(B,x){const A=document.createElement("span");A.textContent=x,A.title=this.valueString,A.classList.add("-actual-value"),B.appendChild(A)}renderDerived(B,x,A){const Z=document.createElement("span");Z.setAttribute("title",this.texts.empty),Z.textContent=`(${A?"+":""}${x})`,Z.title=`${this.derivedValueString} ${this.derivedText}`,Z.classList.add("-derived-value"),A&&Z.classList.add("-with-actual-value"),B.appendChild(Z)}get title(){return null}isEmpty(){const{value:B}=this,x=this.derivedValue;return!B&&!x}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],Gt.prototype,"timezoneService",void 0);class Yi extends Gt{constructor(){super(...arguments),this.text={linkTitle:this.I18n.t("js.work_packages.message_view_spent_time"),logTime:this.I18n.t("js.button_log_time")}}render(B,x){if(!this.value)return;const A=document.createElement("a");if(A.textContent=x,A.setAttribute("title",this.text.linkTitle),x===this.placeholder?A.setAttribute("class","time-logging--value time-logging--value_empty"):A.setAttribute("class","time-logging--value"),this.resource.project){const Z=this.resource.id.toString();this.apiV3Service.projects.id(this.resource.project).get().subscribe(Ce=>{const Ie=pn(this.PathHelper.projectTimeEntriesPath(Ce.identifier)).search(`fields[]=WorkPackageId&operators[WorkPackageId]=%3D&values[WorkPackageId]=${Z}&set_filter=1`).toString();A.href=Ie})}B.innerHTML="",B.appendChild(A),this.appendTimelogLink(B)}appendTimelogLink(B){if(this.timeEntryCreateService&&this.resource.logTime){const x=document.createElement("a");x.setAttribute("class","icon icon-time"),x.setAttribute("href",""),x.setAttribute("title",this.text.logTime),B.appendChild(x),x.addEventListener("click",this.showTimelogWidget.bind(this,this.resource))}}showTimelogWidget(B){this.timeEntryCreateService.create(moment(new Date),B,{showWorkPackageField:!1}).catch(()=>{})}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Sn.j)],Yi.prototype,"PathHelper",void 0),(0,u.gn)([(0,P.W)(di.f,null),(0,u.w6)("design:type",di.f)],Yi.prototype,"timeEntryCreateService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",xe.T)],Yi.prototype,"apiV3Service",void 0);class Li extends Dt.C{constructor(){super(...arguments),this.text={linkTitle:this.I18n.t("js.work_packages.message_successful_show_in_fullscreen")}}get value(){return(0,ye.Z)(this.resource)?null:this.resource[this.name]}render(B,x){!this.value||(B.textContent=x)}isEmpty(){return!1}}var Bi=t(50076),Dn=t(69671),An=t(80044);class un extends Dn.z{render(B,x){super.render(B,x),this.shouldHighlight&&this.addHighlight(B)}get value(){return this.schema?this.attribute&&this.attribute.name:null}addHighlight(B){if(this.attribute instanceof An.X){const x=Bi.Z.inlineClass(this.name,this.attribute.id);B.classList.add(x)}}}class jn extends un{get shouldHighlight(){return!0}}var hn=t(32782);class _n extends Dt.C{get value(){return this.schema?this.attribute&&this.attribute.name:null}render(B,x){this.placeholder===x?this.renderEmpty(B):this.principalRenderer.render(B,this.attribute,{hide:!1,link:!1},{hide:!1,size:"medium"})}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",hn.C)],_n.prototype,"principalRenderer",void 0);class mn extends qi.L{render(B,x){const A=this.value;B.innerHTML="",B.setAttribute("title",A.join(", ")),0===A.length?this.renderEmpty(B):this.renderValues(this.attribute,B)}renderValues(B,x){const A=document.createDocumentFragment(),Z=document.createElement("div");if(Z.classList.add(Dt.x),A.appendChild(Z),this.renderAbridgedValues(Z,B),B.length>2){const Ce=document.createElement("span");Ce.innerHTML="... ",Z.appendChild(Ce);const Ie=this.optionDiv(B.length.toString(),"badge","-secondary");A.appendChild(Ie)}x.appendChild(A)}renderAbridgedValues(B,x){const A=_.take(x,2);this.principalRenderer.renderMultiple(B,A,{hide:!1,link:!1},{hide:!1,size:"medium"},!1)}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",hn.C)],mn.prototype,"principalRenderer",void 0);var Di=t(84109),$i=t(20506);class en extends Li{constructor(){super(...arguments),this.uiStateBuilder=new $i.mE(this.$state,this.keepTab)}render(B,x){if(!this.value)return;const A=this.uiStateBuilder.linkToShow(this.value,x,this.value);B.appendChild(A)}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",M.StateService)],en.prototype,"$state",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Di.p)],en.prototype,"keepTab",void 0);class Zn extends Dt.C{render(B,x){const A=this.value&&this.value.id,Z=document.createElement("span");Z.classList.add("project-status--bulb",(0,Qe.p)(A));const Ce=document.createElement("span");if(Ce.classList.add("project-status--name",(0,Qe.p)(A)),Ce.textContent=(0,Qe.v)(A,this.I18n),B.innerHTML="",B.appendChild(Z),B.appendChild(Ce),this.writable){const Ie=document.createElement("span");Ie.classList.add("project-status--pulldown-icon","icon","icon-pulldown"),B.appendChild(Ie)}}}class qt extends Dt.C{get value(){if(!this.schema)return null;const B=this.resource[this.name];return B&&B.raw||""}}class Fe extends Ei{constructor(){super(...arguments),this.text={linkTitle:this.I18n.t("js.work_packages.message_successful_show_in_fullscreen"),none:this.I18n.t("js.filter.noneElement")},this.uiStateBuilder=new $i.mE(this.$state,this.keepTab)}render(B,x){if(this.isEmpty())return void(B.innerText=this.placeholder);const A=this.uiStateBuilder.linkToShow(this.wpId,this.text.linkTitle,this.valueString),Z=document.createElement("span");Z.textContent=` ${_.truncate(this.title,{length:40})}`,B.innerHTML="",B.appendChild(A),B.appendChild(Z)}get writable(){return!1}get valueString(){return`#${this.wpId}`}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",M.StateService)],Fe.prototype,"$state",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Di.p)],Fe.prototype,"keepTab",void 0);var U=t(74215);class z extends Dt.C{get valueString(){return this.timezoneService.formattedDuration(this.value,"days")}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],z.prototype,"timezoneService",void 0);class re extends Dt.C{get valueString(){return this.timezoneService.formattedDuration(this.value,"hour")}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ue.B)],re.prototype,"timezoneService",void 0);var Ze=t(74990);class We{}We.\u0275fac=function(B){return new(B||We)},We.\u0275mod=i.oAB({type:We}),We.\u0275inj=i.cJS({imports:[[e.ez]]});class Ve{}Ve.\u0275fac=function(B){return new(B||Ve)},Ve.\u0275mod=i.oAB({type:Ve}),Ve.\u0275inj=i.cJS({imports:[[e.ez,c.u5]]});var Ge=t(63415);class rt{}rt.\u0275fac=function(B){return new(B||rt)},rt.\u0275mod=i.oAB({type:rt}),rt.\u0275inj=i.cJS({imports:[[e.ez,c.u5,Ge.J]]});var Xe=t(81496);class at{}at.\u0275fac=function(B){return new(B||at)},at.\u0275mod=i.oAB({type:at}),at.\u0275inj=i.cJS({imports:[[e.ez,Xe.I]]});class Bt{}Bt.\u0275fac=function(B){return new(B||Bt)},Bt.\u0275mod=i.oAB({type:Bt}),Bt.\u0275inj=i.cJS({imports:[[e.ez,F.wA]]});var oi=t(76315),wt=t(45755);class ft{}ft.\u0275fac=function(B){return new(B||ft)},ft.\u0275mod=i.oAB({type:ft}),ft.\u0275inj=i.cJS({providers:[{provide:i.ip1,useFactory:function(ge,B){return()=>{ge.defaultFieldType="text",ge.addFieldType(f,"text",["String"]).addFieldType(C,"integer",["Integer"]).addFieldType(gi,"estimatedTime",["estimatedTime"]).addFieldType(Wi,"project",["Project"]).addFieldType(ki,"user",["User"]).addFieldType(D,"select",["Priority","Status","Type","Version","TimeEntriesActivity","Category","CustomOption"]).addFieldType(te,"multi-select",["[]CustomOption","[]User"]).addFieldType(ie,"float",["Float"]).addFieldType($,"workPackage",["WorkPackage"]).addFieldType(le,"boolean",["Boolean"]).addFieldType(Ke,"date",["Date"]).addFieldType(Ee,"wiki-textarea",["Formattable"]).addFieldType(St,"_comment",["comment"]),ge.addSpecificFieldType("WorkPackage",ai,"date",["combinedDate","startDate","dueDate","date"]).addSpecificFieldType("WorkPackage",yi,"duration",["duration"]).addSpecificFieldType("Project",lt,"status",["status"]).addSpecificFieldType("TimeEntry",Ne,"comment",["comment"]).addSpecificFieldType("TimeEntry",Pt,"workPackage",["WorkPackage"]).addSpecificFieldType("TimeEntry",gi,"hours",["hours"]).addSpecificFieldType("WorkPackage",gi,"remainingTime",["remainingTime"]),B.register(Ri.y,"Version"),B.register(bi.e,"WorkPackage")}},deps:[a.h,k],multi:!0},{provide:i.ip1,useFactory:function(ge){return()=>{ge.defaultFieldType="text",ge.addFieldType(fi,"text",["String"]).addFieldType(Gi,"float",["Float"]).addFieldType(On,"integer",["Integer"]).addFieldType(un,"highlight",["Status","Priority"]).addFieldType(jn,"type",["Type"]).addFieldType(Ii,"resource",["Project","TimeEntriesActivity","Version","Category","CustomOption"]).addFieldType(qi.L,"resources",["[]CustomOption"]).addFieldType(mn,"users",["[]User"]).addFieldType(ln,"formattable",["Formattable"]).addFieldType(z,"duration",["duration"]).addFieldType(re,"remainingTime",["remainingTime"]).addFieldType(Gt,"estimatedTime",["estimatedTime"]).addFieldType(dn.C,"date",["Date"]).addFieldType(xi,"datetime",["DateTime"]).addFieldType(In,"boolean",["Boolean"]).addFieldType(Si.N,"progress",["percentageDone"]).addFieldType(Fe,"work_package",["WorkPackage"]).addFieldType(Li,"id",["id"]).addFieldType(_n,"user",["User"]),ge.addSpecificFieldType("WorkPackage",en,"id",["id"]).addSpecificFieldType("WorkPackage",Yi,"spentTime",["spentTime"]).addSpecificFieldType("WorkPackage",U.Z,"combinedDate",["combinedDate"]).addSpecificFieldType("TimeEntry",qt,"comment",["comment"]).addSpecificFieldType("Project",Zn,"status",["status"]).addSpecificFieldType("TimeEntry",Ei,"work_package",["workPackage"])}},deps:[m.i],multi:!0}],imports:[[e.ez,n.H,r.Z,h.$,d.K,Ze.C,l.a,We,Ve,rt,at,Bt,oi.s,wt.i]]})},6536:(X,I,t)=>{"use strict";t.d(I,{g:()=>e});const i={"application/pdf":{icon:"export-pdf-descr",clazz:"pdf"},"image/jpeg":{icon:"image1",clazz:"img"},"image/png":{icon:"image1",clazz:"img"},"image/gif":{icon:"image1",clazz:"img"},"image/svg+xml":{icon:"image1",clazz:"img"},"image/tiff":{icon:"image1",clazz:"img"},"image/bmp":{icon:"image1",clazz:"img"},"image/webp":{icon:"image1",clazz:"img"},"image/heic":{icon:"image1",clazz:"img"},"image/heif":{icon:"image1",clazz:"img"},"image/avif":{icon:"image1",clazz:"img"},"image/cgm":{icon:"image1",clazz:"img"},"text/plain":{icon:"file-text",clazz:"txt"},"text/markdown":{icon:"file-text",clazz:"txt"},"text/html":{icon:"file-text",clazz:"txt"},"application/rtf":{icon:"file-text",clazz:"txt"},"application/xml":{icon:"file-text",clazz:"txt"},"application/xhtml+xml":{icon:"file-text",clazz:"txt"},"application/x-tex":{icon:"file-text",clazz:"txt"},"application/vnd.oasis.opendocument.text":{icon:"file-doc",clazz:"doc"},"application/vnd.oasis.opendocument.text-template":{icon:"file-doc",clazz:"doc"},"application/msword":{icon:"file-doc",clazz:"doc"},"application/vnd.apple.pages":{icon:"file-doc",clazz:"doc"},"application/vnd.stardivision.writer":{icon:"file-doc",clazz:"doc"},"application/x-abiword":{icon:"file-doc",clazz:"doc"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{icon:"file-doc",clazz:"doc"},"font/otf":{icon:"file-doc",clazz:"doc"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{icon:"file-sheet",clazz:"sheet"},"application/vnd.oasis.opendocument.spreadsheet":{icon:"file-sheet",clazz:"sheet"},"application/vnd.oasis.opendocument.spreadsheet-template":{icon:"file-sheet",clazz:"sheet"},"application/vnd.ms-excel":{icon:"file-sheet",clazz:"sheet"},"application/vnd.stardivision.calc":{icon:"file-sheet",clazz:"sheet"},"application/vnd.apple.numbers":{icon:"file-sheet",clazz:"sheet"},"application/x-starcalc":{icon:"file-sheet",clazz:"sheet"},"application/x-quattro-pro":{icon:"file-sheet",clazz:"sheet"},"application/csv":{icon:"file-sheet",clazz:"sheet"},"application/vnd.oasis.opendocument.presentation":{icon:"file-presentation",clazz:"presentation"},"application/vnd.oasis.opendocument.presentation-template":{icon:"file-presentation",clazz:"presentation"},"application/vnd.apple.keynote":{icon:"file-presentation",clazz:"presentation"},"application/vnd.ms-powerpoint":{icon:"file-presentation",clazz:"presentation"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{icon:"file-presentation",clazz:"presentation"},"application/vnd.stardivision.impress":{icon:"file-presentation",clazz:"presentation"},"application/mathematica":{icon:"file-presentation",clazz:"presentation"},"video/mp4":{icon:"movie",clazz:"mov"},"video/x-m4v":{icon:"movie",clazz:"mov"},"video/avi":{icon:"movie",clazz:"mov"},"video/quicktime":{icon:"movie",clazz:"mov"},"video/webm":{icon:"movie",clazz:"mov"},"video/mpg":{icon:"movie",clazz:"mov"},"video/x-matroska":{icon:"movie",clazz:"mov"},"video/mp1s":{icon:"movie",clazz:"mov"},"video/mp2p":{icon:"movie",clazz:"mov"},"video/3gpp":{icon:"movie",clazz:"mov"},"video/3gpp-tt":{icon:"movie",clazz:"mov"},"video/3gpp-2":{icon:"movie",clazz:"mov"},"application/x-op-directory":{icon:"folder",clazz:"dir"},default:{icon:"ticket",clazz:"default"}};function e(d){return d&&i[d]?i[d]:i.default}},22784:(X,I,t)=>{"use strict";t.d(I,{X:()=>p});var i=t(1707),e=t(2316),d=t(54364),h=t(83845);function r(f,C){1&f&&(e.TgZ(0,"span",11),e._uU(1,"Invalid"),e.qZA())}function n(f,C){1&f&&(e.TgZ(0,"span",12),e._uU(1,"*"),e.qZA())}function l(f,C){if(1&f&&(e.TgZ(0,"div",7),e.YNc(1,r,2,0,"span",8),e._uU(2),e.YNc(3,n,2,0,"span",9),e._UZ(4,"attribute-help-text",10),e.qZA()),2&f){const u=e.oxw(2);e.xp6(1),e.Q6J("ngIf",u.showErrorMessage),e.xp6(1),e.hij(" ",u.label," "),e.xp6(1),e.Q6J("ngIf",u.required),e.xp6(1),e.Q6J("attribute",u.helpTextAttribute)("attributeScope",u.helpTextAttributeScope)}}function a(f,C){if(1&f&&(e.TgZ(0,"div",13),e.Hsn(1,3),e.qZA()),2&f){const u=e.oxw(2);e.Q6J("id",u.errorsID)}}function m(f,C){if(1&f&&(e.ynx(0),e.TgZ(1,"label",1),e.TgZ(2,"div",2),e.Hsn(3),e.qZA(),e.YNc(4,l,5,5,"div",3),e.TgZ(5,"div",4),e.Hsn(6,1),e.qZA(),e.qZA(),e.TgZ(7,"div",5),e.Hsn(8,2),e.qZA(),e.YNc(9,a,2,1,"div",6),e.BQk()),2&f){const u=e.oxw();e.xp6(2),e.uIk("aria-describedby",u.describedByID),e.xp6(2),e.Q6J("ngIf",u.label),e.xp6(1),e.Q6J("id",u.descriptionID),e.xp6(4),e.Q6J("ngIf",u.showErrorMessage)}}const v=[[["","slot","input"]],[["","slot","description"]],[["","slot","help-text"]],[["","slot","errors"]]];class p{constructor(C){this.formGroupDirective=C,this.className=!0,this.classNameCheckbox=!0,this.label="",this.hidden=!1,this.required=!1,this.showValidationErrorOn="submit",this.internalID="op-checkbox-field-"+ +new Date}get errorClassName(){return this.showErrorMessage}get errorsID(){return`${this.internalID}-errors`}get descriptionID(){return`${this.internalID}-description`}get describedByID(){return this.showErrorMessage?this.errorsID:this.descriptionID}get formControl(){var C;return(null===(C=this.ngControl)||void 0===C?void 0:C.control)||this.control}get showErrorMessage(){var C;return!!this.formControl&&("submit"===this.showValidationErrorOn?this.formControl.invalid&&(null===(C=this.formGroupDirective)||void 0===C?void 0:C.submitted):"blur"===this.showValidationErrorOn?this.formControl.invalid&&this.formControl.touched:"change"===this.showValidationErrorOn&&(this.formControl.invalid&&this.formControl.dirty))}}p.\u0275fac=function(C){return new(C||p)(e.Y36(i.sg,8))},p.\u0275cmp=e.Xpm({type:p,selectors:[["op-checkbox-field"]],contentQueries:function(C,u,k){if(1&C&&e.Suo(k,i.a5,5),2&C){let O;e.iGM(O=e.CRH())&&(u.ngControl=O.first)}},hostVars:6,hostBindings:function(C,u){2&C&&e.ekj("op-form-field",u.className)("op-checkbox-field",u.classNameCheckbox)("op-form-field_invalid",u.errorClassName)},inputs:{label:"label",hidden:"hidden",required:"required",showValidationErrorOn:"showValidationErrorOn",control:"control",helpTextAttribute:"helpTextAttribute",helpTextAttributeScope:"helpTextAttributeScope"},ngContentSelectors:["[slot=input]","[slot=description]","[slot=help-text]","[slot=errors]"],decls:1,vars:1,consts:[[4,"ngIf"],[1,"op-form-field--label-wrap","op-checkbox-field--label-wrap"],[1,"op-form-field--input","op-checkbox-field--input"],["class","op-form-field--label op-checkbox-field--label",4,"ngIf"],[1,"op-form-field--description","op-checkbox-field--description",3,"id"],[1,"op-form-field--help-text"],["class","op-form-field--errors",3,"id",4,"ngIf"],[1,"op-form-field--label","op-checkbox-field--label"],["class","Hidden for sighted",4,"ngIf"],["class","op-form-field--label-indicator",4,"ngIf"],[3,"attribute","attributeScope"],[1,"Hidden","for","sighted"],[1,"op-form-field--label-indicator"],[1,"op-form-field--errors",3,"id"]],template:function(C,u){1&C&&(e.F$t(v),e.YNc(0,m,10,4,"ng-container",0)),2&C&&e.Q6J("ngIf",!u.hidden)},directives:[d.O5,h.y],encapsulation:2})},18252:(X,I,t)=>{"use strict";t.d(I,{V:()=>O});var i=t(1707),e=t(96617),d=t(2316),h=t(54364),r=t(83845);function n(y,b){if(1&y&&(d.TgZ(0,"span",9),d._uU(1),d.qZA()),2&y){const P=d.oxw(2);d.xp6(1),d.hij(" ",P.text.invalid," ")}}function l(y,b){1&y&&(d.TgZ(0,"span",10),d._uU(1,"*"),d.qZA())}function a(y,b){1&y&&d.GkF(0)}function m(y,b){if(1&y&&(d.ynx(0),d.YNc(1,a,1,0,"ng-container",11),d.BQk()),2&y){d.oxw(2);const P=d.MAs(2);d.xp6(1),d.Q6J("ngTemplateOutlet",P)}}function v(y,b){1&y&&d.GkF(0)}function c(y,b){if(1&y&&(d.ynx(0),d.YNc(1,v,1,0,"ng-container",11),d.BQk()),2&y){d.oxw(2);const P=d.MAs(2);d.xp6(1),d.Q6J("ngTemplateOutlet",P)}}function p(y,b){if(1&y&&(d.TgZ(0,"div",12),d.Hsn(1,1),d.qZA()),2&y){const P=d.oxw(2);d.Q6J("id",P.errorsID)}}function f(y,b){if(1&y&&(d.ynx(0),d.TgZ(1,"label",2),d.TgZ(2,"div",3),d.YNc(3,n,2,1,"span",4),d._uU(4),d.YNc(5,l,2,0,"span",5),d._UZ(6,"attribute-help-text",6),d.qZA(),d.YNc(7,m,2,1,"ng-container",0),d.qZA(),d.YNc(8,c,2,1,"ng-container",0),d.TgZ(9,"div",7),d.Hsn(10),d.qZA(),d.YNc(11,p,2,1,"div",8),d.BQk()),2&y){const P=d.oxw();d.xp6(3),d.Q6J("ngIf",P.showErrorMessage),d.xp6(1),d.hij(" ",P.label," "),d.xp6(1),d.Q6J("ngIf",P.required),d.xp6(1),d.Q6J("attribute",P.helpTextAttribute)("attributeScope",P.helpTextAttributeScope),d.xp6(1),d.Q6J("ngIf",!P.noWrapLabel),d.xp6(1),d.Q6J("ngIf",P.noWrapLabel),d.xp6(3),d.Q6J("ngIf",P.showErrorMessage)}}function C(y,b){if(1&y&&(d.TgZ(0,"div",13),d.Hsn(1,2),d.qZA(),d.TgZ(2,"div",14),d.Hsn(3,3),d.qZA()),2&y){const P=d.oxw();d.Q6J("id",P.descriptionID),d.xp6(2),d.uIk("aria-describedby",P.describedByID)}}const u=[[["","slot","help-text"]],[["","slot","errors"]],[["","slot","description"]],[["","slot","input"]]];class O{constructor(b,P){this._formGroupDirective=b,this.I18n=P,this.className=!0,this.label="",this.noWrapLabel=!1,this.required=!1,this.hidden=!1,this.showValidationErrorOn="submit",this.internalID="op-form-field-"+ +new Date,this.text={invalid:this.I18n.t("js.label_invalid")}}get errorClassName(){return this.showErrorMessage}get errorsID(){return`${this.internalID}-errors`}get descriptionID(){return`${this.internalID}-description`}get describedByID(){return this.showErrorMessage?this.errorsID:this.descriptionID}get formControl(){var b;return(null===(b=this.ngControl)||void 0===b?void 0:b.control)||this.control}get showErrorMessage(){var b;return!!this.formControl&&("submit"===this.showValidationErrorOn?this.formControl.invalid&&(null===(b=this._formGroupDirective)||void 0===b?void 0:b.submitted):"blur"===this.showValidationErrorOn?this.formControl.invalid&&this.formControl.touched:"change"===this.showValidationErrorOn&&(this.formControl.invalid&&this.formControl.dirty))}}O.\u0275fac=function(b){return new(b||O)(d.Y36(i.sg,8),d.Y36(e.D))},O.\u0275cmp=d.Xpm({type:O,selectors:[["op-form-field"]],contentQueries:function(b,P,E){if(1&b&&d.Suo(E,i.a5,5),2&b){let T;d.iGM(T=d.CRH())&&(P.ngControl=T.first)}},hostVars:4,hostBindings:function(b,P){2&b&&d.ekj("op-form-field",P.className)("op-form-field_invalid",P.errorClassName)},inputs:{label:"label",noWrapLabel:"noWrapLabel",required:"required",hidden:"hidden",showValidationErrorOn:"showValidationErrorOn",control:"control",helpTextAttribute:"helpTextAttribute",helpTextAttributeScope:"helpTextAttributeScope"},ngContentSelectors:["[slot=help-text]","[slot=errors]","[slot=description]","[slot=input]"],decls:3,vars:1,consts:[[4,"ngIf"],["inputTemplate",""],[1,"op-form-field--label-wrap"],[1,"op-form-field--label"],["class","hidden-for-sighted",4,"ngIf"],["class","op-form-field--label-indicator",4,"ngIf"],[3,"attribute","attributeScope"],[1,"op-form-field--help-text"],["class","op-form-field--errors",3,"id",4,"ngIf"],[1,"hidden-for-sighted"],[1,"op-form-field--label-indicator"],[4,"ngTemplateOutlet"],[1,"op-form-field--errors",3,"id"],[1,"op-form-field--description",3,"id"],[1,"op-form-field--input"]],template:function(b,P){1&b&&(d.F$t(u),d.YNc(0,f,12,8,"ng-container",0),d.YNc(1,C,4,2,"ng-template",null,1,d.W1O)),2&b&&d.Q6J("ngIf",!P.hidden)},directives:[h.O5,r.y,h.tP],encapsulation:2})},49369:(X,I,t)=>{"use strict";t.d(I,{_:()=>l});var i=t(2316),d=(t(75421),t(96617)),h=t(94232);class r extends h.W{}var n=t(26942);class l extends n.N{constructor(m,v){super(),this.i18n=m,this.injector=v,this.resourceChanged=new i.vpe}get widgetName(){var m,v;const c=null===(m=this.resource)||void 0===m?void 0:m.options.name,p=null===(v=this.resource)||void 0===v?void 0:v.identifier;return this.isEditable?c:this.i18n.t(`js.grid.widgets.${p}.title`,{defaultValue:c})}renameWidget(m){const v=this.setChangesetOptions({name:m});this.resourceChanged.emit(v)}get isEditable(){return!0}setChangesetOptions(m){const v=new r(this.resource);return v.setValue("options",Object.assign(Object.assign({},this.resource.options),m)),v}}l.\u0275fac=function(m){return new(m||l)(i.Y36(d.D),i.Y36(i.zs3))},l.\u0275dir=i.lG2({type:l,hostVars:8,hostBindings:function(m,v){2&m&&i.Udp("grid-column-start",v.gridColumnStart)("grid-column-end",v.gridColumnEnd)("grid-row-start",v.gridRowStart)("grid-row-end",v.gridRowEnd)},inputs:{resource:"resource"},outputs:{resourceChanged:"resourceChanged"},features:[i.qOj]})},2775:(X,I,t)=>{"use strict";t.d(I,{o:()=>h});var i=t(2316),e=t(54364);function d(r,n){if(1&r&&i._UZ(0,"span",2),2&r){const l=i.oxw();i.Q6J("textContent",l.iconTitle)}}class h{constructor(){this.iconTitle=""}}h.\u0275fac=function(n){return new(n||h)},h.\u0275cmp=i.Xpm({type:h,selectors:[["op-icon"]],hostAttrs:[1,"op-icon--wrapper"],inputs:{iconClasses:["icon-classes","iconClasses"],iconTitle:["icon-title","iconTitle"]},decls:2,vars:3,consts:[["aria-hidden","true",3,"ngClass"],["class","hidden-for-sighted",3,"textContent",4,"ngIf"],[1,"hidden-for-sighted",3,"textContent"]],template:function(n,l){1&n&&(i._UZ(0,"i",0),i.YNc(1,d,1,1,"span",1)),2&n&&(i.Q6J("ngClass",l.iconClasses),i.uIk("title",l.iconTitle||void 0),i.xp6(1),i.Q6J("ngIf",l.iconTitle))},directives:[e.mk,e.O5],encapsulation:2})},53875:(X,I,t)=>{"use strict";t.d(I,{Q:()=>d});var i=t(54364),e=t(2316);class d{}d.\u0275fac=function(r){return new(r||d)},d.\u0275mod=e.oAB({type:d}),d.\u0275inj=e.cJS({providers:[],imports:[[i.ez]]})},55280:(X,I,t)=>{"use strict";t.d(I,{v:()=>n});var i=t(54364),e=t(77355),d=t(58057),h=t(2316);class n{constructor(a,m,v){this.documentElement=a,this.injector=m,this.opModalService=v}setupListener(){const a=this.documentElement.querySelectorAll("[data-augmented-model-wrapper]");for(let m=0;m<a.length;++m)this.wrapElement(jQuery(a[m]))}wrapElement(a){const m=a.data("activationSelector")||".modal-delivery-element--activation-link",v=jQuery(m);a.data("modalInitializeNow")?this.show(a):v.click(p=>{this.show(a),p.preventDefault()})}show(a){const m=a.data("modalClassName"),v=a.data("modalIframeUrl"),c=a.find(".modal-delivery-element");let p=c.html();v&&(p=this.appendIframe(c,v)),this.opModalService.show(d.T,this.injector,{modalBody:p,modalClassName:m})}appendIframe(a,m){const v=jQuery('<iframe frameborder="0" height="400" allowfullscreen>></iframe>');return v.attr("src",m),a.find(".iframe-target-wrapper").append(v),a.html()}}n.\u0275fac=function(a){return new(a||n)(h.LFG(i.K0),h.LFG(h.zs3),h.LFG(e.S))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})},60312:(X,I,t)=>{"use strict";t.d(I,{T:()=>d});var i=t(2316),e=t(26942);class d extends e.N{constructor(r,n,l){super(),this.locals=r,this.cdRef=n,this.elementRef=l,this.closeOnEscape=!0,this.closeOnEscapeFunction=this.closeMe,this.closeOnOutsideClick=!0,this.service=this.locals.service,this.closingEvent=new i.vpe,this.openingEvent=new i.vpe}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement)}ngOnDestroy(){this.closingEvent.complete(),this.openingEvent.complete()}onClose(){return this.afterFocusOn&&this.afterFocusOn.focus(),!0}closeMe(r){this.service.close(),r&&(r.stopPropagation(),r.preventDefault())}onOpen(){this.openingEvent.emit(),this.cdRef.detectChanges()}get afterFocusOn(){return this.$element}}d.\u0275fac=function(r){i.$Z()},d.\u0275dir=i.lG2({type:d,features:[i.qOj]})},55811:(X,I,t)=>{"use strict";t.d(I,{K:()=>l});var i=t(54364),e=t(63415),d=t(53875),h=t(77355),r=t(55280),n=t(2316);class l{}l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=n.oAB({type:l}),l.\u0275inj=n.cJS({providers:[h.S,r.v],imports:[[i.ez,e.J,d.Q]]})},77355:(X,I,t)=>{"use strict";t.d(I,{E:()=>h,S:()=>r});var i=t(2316),e=t(40912),d=t(47775);const h=new i.OlP("OP_MODAL_LOCALS");class r{constructor(l,a,m,v){this.componentFactoryResolver=l,this.appRef=a,this.$transitions=m,this.injector=v,this.active=null,this.opening=!1;const c=document.createElement("div");c.classList.add("spot-modal-overlay"),document.body.appendChild(c);const p=document.createElement("button");p.classList.add("spot-button","spot-modal-close-button"),p.innerHTML='<span class="spot-icon spot-icon_close"></span>',c.appendChild(p),window.addEventListener("keydown",f=>(this.active&&this.active.closeOnEscape&&"Escape"===f.key&&this.active.closeOnEscapeFunction(),!0)),c.addEventListener("click",f=>{this.active&&!this.opening&&this.portalHostElement===f.target&&this.close()}),p.addEventListener("click",()=>{this.active&&!this.opening&&this.close()}),this.bodyPortalHost=new e.u0(c,this.componentFactoryResolver,this.appRef,this.injector),this.portalHostElement=c}show(l,a,m={},v=!1){this.close(),this.opening=!0,"global"===a&&(a=this.injector);const c=new e.C5(l,null,this.injectorFor(a,m)),p=this.bodyPortalHost.attach(c);return this.active=p.instance,this.portalHostElement.classList.add("spot-modal-overlay_active"),v&&this.portalHostElement.classList.add("spot-modal-overlay_not-full-screen"),setTimeout(()=>{this.active&&this.active.onOpen(),this.opening=!1,p.changeDetectorRef.detectChanges()},20),this.active}isActive(l){return null!==this.active&&this.active===l}close(){this.active&&this.active.onClose()&&(this.active.closingEvent.emit(this.active),this.bodyPortalHost.detach(),this.portalHostElement.classList.remove("spot-modal-overlay_active"),this.portalHostElement.classList.remove("spot-modal-overlay_not-full-screen"),this.active=null)}injectorFor(l,a){const m=new WeakMap;return a.service=this,m.set(h,a),new e.nK(l,m)}}r.\u0275fac=function(l){return new(l||r)(i.LFG(i._Vd),i.LFG(i.z2F),i.LFG(d.TransitionService),i.LFG(i.zs3))},r.\u0275prov=i.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})},298:(X,I,t)=>{"use strict";t.d(I,{j:()=>p});var i=t(60312),e=t(77355),d=t(96617),h=t(2316),r=t(55901),n=t(54364),l=t(2775);function a(f,C){1&f&&h._UZ(0,"div",12)}function m(f,C){if(1&f&&(h.TgZ(0,"span",13),h._UZ(1,"br"),h.TgZ(2,"strong"),h._uU(3),h.qZA(),h.qZA()),2&f){const u=C.$implicit;h.xp6(3),h.Oqu(u)}}function v(f,C){if(1&f&&(h.TgZ(0,"op-icon",14),h._UZ(1,"i"),h.qZA()),2&f){const u=C.ngIf;h.MGl("icon-classes","button--icon spot-icon spot-icon_",u,""),h.xp6(1),h.Gre("button--icon spot-icon spot-icon_",u,"")}}function c(f,C){if(1&f&&(h.TgZ(0,"op-icon",14),h._UZ(1,"i"),h.qZA()),2&f){const u=C.ngIf;h.MGl("icon-classes","button--icon spot-icon spot-icon_",u,""),h.xp6(1),h.Gre("button--icon spot-icon spot-icon_",u,"")}}class p extends i.T{constructor(C,u,k,O){super(u,k,C),this.elementRef=C,this.locals=u,this.cdRef=k,this.I18n=O,this.confirmed=!1,this.text={title:this.I18n.t("js.modals.form_submit.title"),text:this.I18n.t("js.modals.form_submit.text"),button_continue:this.I18n.t("js.button_continue"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.icon={continue:void 0,cancel:void 0},this.options=u.options||{},this.dangerHighlighting=_.defaultTo(this.options.dangerHighlighting,!1),this.passedData=_.defaultTo(this.options.passedData,[]),this.closeOnEscape=_.defaultTo(this.options.closeByEscape,!0),this.closeOnOutsideClick=_.defaultTo(this.options.closeByDocument,!0),this.showClose=_.defaultTo(this.options.showClose,!0),this.divideContent=_.defaultTo(this.options.divideContent,!1),this.text=_.defaults(this.options.text,this.text),this.icon=_.defaults(this.options.icon,this.icon)}confirmAndClose(C){this.confirmed=!0,this.closeMe(C)}}p.\u0275fac=function(C){return new(C||p)(h.Y36(h.SBq),h.Y36(e.E),h.Y36(h.sBO),h.Y36(d.D))},p.\u0275cmp=h.Xpm({type:p,selectors:[["ng-component"]],features:[h.qOj],decls:17,vars:10,consts:[["data-indicator-name","modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal","op-confirm-dialog","loading-indicator--location",3,"cdkTrapFocusAutoCapture"],[1,"spot-modal--header"],["class","spot-divider",4,"ngIf"],[1,"spot-modal--body","spot-container"],[1,"op-confirm-dialog--text","spot-body-small",3,"textContent"],["class","spot-body-small",4,"ngFor","ngForOf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button","data-qa-selector","confirmation-modal--cancel",1,"button","button_no-margin","spot-action-bar--action",3,"click"],["class","op-icon--wrapper",3,"icon-classes",4,"ngIf"],[1,"button--text"],["type","button","data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","spot-action-bar--action",3,"ngClass","click"],[1,"spot-divider"],[1,"spot-body-small"],[1,"op-icon--wrapper",3,"icon-classes"]],template:function(C,u){1&C&&(h.TgZ(0,"div",0),h.TgZ(1,"div",1),h._uU(2),h.qZA(),h.YNc(3,a,1,0,"div",2),h.TgZ(4,"div",3),h._UZ(5,"span",4),h.YNc(6,m,4,1,"span",5),h.qZA(),h.TgZ(7,"div",6),h.TgZ(8,"div",7),h.TgZ(9,"button",8),h.NdJ("click",function(O){return u.closeMe(O)}),h.YNc(10,v,2,4,"op-icon",9),h.TgZ(11,"span",10),h._uU(12),h.qZA(),h.qZA(),h.TgZ(13,"button",11),h.NdJ("click",function(O){return u.confirmAndClose(O)}),h.YNc(14,c,2,4,"op-icon",9),h.TgZ(15,"span",10),h._uU(16),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&C&&(h.Q6J("cdkTrapFocusAutoCapture",!0),h.xp6(2),h.Oqu(u.text.title),h.xp6(1),h.Q6J("ngIf",u.divideContent),h.xp6(2),h.Q6J("textContent",u.text.text),h.xp6(1),h.Q6J("ngForOf",u.passedData),h.xp6(4),h.Q6J("ngIf",u.icon.cancel),h.xp6(2),h.Oqu(u.text.button_cancel),h.xp6(1),h.Q6J("ngClass",u.dangerHighlighting?"-danger":"-highlight"),h.xp6(1),h.Q6J("ngIf",u.icon.continue),h.xp6(2),h.Oqu(u.text.button_continue))},directives:[r.mK,n.O5,n.sg,n.mk,l.o],styles:[".op-confirm-dialog--text[_ngcontent-%COMP%]{white-space:pre-wrap}"],changeDetection:0})},84335:(X,I,t)=>{"use strict";t.d(I,{D:()=>h});var i=t(298),e=t(77355),d=t(2316);class h{constructor(n,l){this.opModalService=n,this.injector=l,document.addEventListener("submit",a=>{const m=a.target,v=m.dataset.augmentedConfirmDialog;return!v||(this.augmentFormSubmit(m,JSON.parse(v)),a.preventDefault(),!1)})}confirm(n){return new Promise((l,a)=>{this.opModalService.show(i.j,this.injector,{options:n}).closingEvent.subscribe(v=>{v.confirmed?l():a()})})}augmentFormSubmit(n,l){this.confirm(l).then(()=>{n.removeAttribute("data-augmented-confirm-dialog"),n.submit()}).catch(()=>{})}}h.\u0275fac=function(n){return new(n||h)(d.LFG(e.S),d.LFG(d.zs3))},h.\u0275prov=d.Yz7({token:h,factory:h.\u0275fac})},82170:(X,I,t)=>{"use strict";t.d(I,{f:()=>y});var i=t(77355),e=t(60312),d=t(96617),h=t(65146),r=t(61908),n=t(2316),l=t(1707),a=t(54364);const m=["typeSelect"];function v(b,P){if(1&b&&n._UZ(0,"option",12),2&b){const E=P.$implicit,T=n.oxw();n.Q6J("textContent",E.name)("selected",T.selectedType===E.name)("value",E.name)}}class c extends e.T{constructor(P,E,T,M,S,R){super(E,S,P),this.elementRef=P,this.locals=E,this.currentProject=T,this.apiV3Service=M,this.cdRef=S,this.I18n=R,this.changed=!1,this.showClose=!0,this.closeOnEscape=!0,this.closeOnOutsideClick=!0,this.type="",this.classes="",this.text={title:this.I18n.t("js.editor.macro.work_package_button.button"),none:this.I18n.t("js.label_none"),selected_type:this.I18n.t("js.editor.macro.work_package_button.type"),button_style:this.I18n.t("js.editor.macro.work_package_button.button_style"),button_style_hint:this.I18n.t("js.editor.macro.work_package_button.button_style_hint"),button_save:this.I18n.t("js.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.selectedType=this.type=this.locals.type,this.classes=this.locals.classes,this.buttonStyle="button"===this.classes,this.apiV3Service.withOptionalProject(this.currentProject.identifier).work_packages.form.post({}).subscribe(F=>{this.availableTypes=F.schema.type.allowedValues})}applyAndClose(P){this.changed=!0,this.classes=this.buttonStyle?"button":"",this.type=this.selectedType,this.closeMe(P)}ngAfterViewInit(){this.typeSelect.nativeElement.focus()}}c.\u0275fac=function(P){return new(P||c)(n.Y36(n.SBq),n.Y36(i.E),n.Y36(h.R),n.Y36(r.T),n.Y36(n.sBO),n.Y36(d.D))},c.\u0275cmp=n.Xpm({type:c,selectors:[["ng-component"]],viewQuery:function(P,E){if(1&P&&n.Gf(m,7),2&P){let T;n.iGM(T=n.CRH())&&(E.typeSelect=T.first)}},features:[n.qOj],decls:26,vars:11,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_autoheight","loading-indicator--location",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container","form"],[1,"form--fieldset"],[3,"textContent"],[1,"form--field"],["for","selected-type",1,"form--label","hidden-for-sighted",3,"textContent"],[1,"form--field-container"],[1,"form--select-container"],["id","selected-type","tabindex","1","name","selected-type",1,"form--select",3,"change"],["typeSelect",""],[3,"textContent","selected","value"],[3,"textContent","selected","value",4,"ngFor","ngForOf"],[1,"form--field","-wide-label"],[1,"form--field-container","-vertical"],[1,"form--label-with-check-box"],[1,"form--check-box-container"],["type","checkbox","tabindex","2","id","wp_button_macro_style","name","button_style",3,"checked","change"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["tabindex","4","type","button",1,"spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["tabindex","3",1,"spot-modal--submit-button","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(P,E){1&P&&(n.TgZ(0,"form",0),n.NdJ("submit",function(M){return E.applyAndClose(M)}),n.TgZ(1,"div",1),n._uU(2),n.qZA(),n._UZ(3,"div",2),n.TgZ(4,"div",3),n.TgZ(5,"fieldset",4),n._UZ(6,"legend",5),n.TgZ(7,"div",6),n._UZ(8,"label",7),n.TgZ(9,"div",8),n.TgZ(10,"div",9),n.TgZ(11,"select",10,11),n.NdJ("change",function(M){return E.selectedType=M.target.value}),n._UZ(13,"option",12),n.YNc(14,v,1,3,"option",13),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(15,"div",14),n.TgZ(16,"div",15),n.TgZ(17,"label",16),n.TgZ(18,"div",17),n.TgZ(19,"input",18),n.NdJ("change",function(M){return E.buttonStyle=M.target.checked}),n.qZA(),n.qZA(),n._uU(20),n.qZA(),n.qZA(),n.qZA(),n._UZ(21,"p",5),n.qZA(),n.TgZ(22,"div",19),n.TgZ(23,"div",20),n.TgZ(24,"button",21),n.NdJ("click",function(M){return E.closeMe(M)}),n.qZA(),n._UZ(25,"button",22),n.qZA(),n.qZA(),n.qZA()),2&P&&(n.xp6(2),n.Oqu(E.text.title),n.xp6(4),n.Q6J("textContent",E.text.selected_type),n.xp6(2),n.Q6J("textContent",E.text.selected_type),n.xp6(5),n.Q6J("textContent",E.text.none)("selected",!E.selectedType),n.xp6(1),n.Q6J("ngForOf",E.availableTypes),n.xp6(5),n.Q6J("checked",E.buttonStyle),n.xp6(1),n.hij(" ",E.text.button_style," "),n.xp6(1),n.Q6J("textContent",E.text.button_style_hint),n.xp6(3),n.Q6J("textContent",E.text.button_cancel),n.xp6(1),n.Q6J("textContent",E.text.button_save))},directives:[l._Y,l.JL,l.F,l.YN,l.Kr,a.sg],encapsulation:2});const p=["selectedPageInput"];class f extends e.T{constructor(P,E,T,M){super(E,T,P),this.elementRef=P,this.locals=E,this.cdRef=T,this.I18n=M,this.changed=!1,this.showClose=!0,this.closeOnEscape=!0,this.closeOnOutsideClick=!0,this.page="",this.text={title:this.I18n.t("js.editor.macro.wiki_page_include.button"),hint:this.I18n.t("js.editor.macro.wiki_page_include.hint"),page:this.I18n.t("js.editor.macro.wiki_page_include.page"),button_save:this.I18n.t("js.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.selectedPage=this.page=this.locals.page}applyAndClose(P){this.changed=!0,this.page=this.selectedPage,this.closeMe(P)}ngAfterViewInit(){this.selectedPageInput.nativeElement.focus()}}f.\u0275fac=function(P){return new(P||f)(n.Y36(n.SBq),n.Y36(i.E),n.Y36(n.sBO),n.Y36(d.D))},f.\u0275cmp=n.Xpm({type:f,selectors:[["ng-component"]],viewQuery:function(P,E){if(1&P&&n.Gf(p,7),2&P){let T;n.iGM(T=n.CRH())&&(E.selectedPageInput=T.first)}},features:[n.qOj],decls:21,vars:9,consts:[[1,"spot-modal",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[1,"form--fieldset"],[3,"textContent"],[1,"form--field"],["for","selected-page",1,"form--label","hidden-for-sighted",3,"textContent"],[1,"form--field-container"],[1,"form--select-container"],["tabindex","2","type","text","id","selected-page","name","selected-page",1,"form--select",3,"value","change"],["selectedPageInput",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["tabindex","4",1,"spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["tabindex","3",1,"spot-modal--submit-button","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"]],template:function(P,E){1&P&&(n.TgZ(0,"form",0),n.NdJ("submit",function(M){return E.applyAndClose(M)}),n.TgZ(1,"div",1),n._uU(2),n.qZA(),n._UZ(3,"div",2),n.TgZ(4,"div",3),n.TgZ(5,"fieldset",4),n._UZ(6,"legend",5),n.TgZ(7,"div",6),n._UZ(8,"label",7),n.TgZ(9,"div",8),n.TgZ(10,"div",9),n.TgZ(11,"input",10,11),n.NdJ("change",function(M){return E.selectedPage=M.target.value}),n.qZA(),n.qZA(),n.qZA(),n._UZ(13,"p",5),n.TgZ(14,"p"),n.TgZ(15,"kbd"),n._uU(16,"project-identifier:my-wiki-page"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(17,"div",12),n.TgZ(18,"div",13),n.TgZ(19,"button",14),n.NdJ("click",function(M){return E.closeMe(M)}),n.qZA(),n.TgZ(20,"button",15),n.NdJ("click",function(M){return E.applyAndClose(M)}),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&P&&(n.xp6(2),n.Oqu(E.text.title),n.xp6(4),n.Q6J("textContent",E.text.page),n.xp6(2),n.Q6J("textContent",E.text.page),n.xp6(3),n.Q6J("value",E.selectedPage),n.xp6(2),n.Q6J("textContent",E.text.hint),n.xp6(6),n.Q6J("textContent",E.text.button_cancel),n.uIk("title",E.text.button_cancel),n.xp6(1),n.Q6J("textContent",E.text.button_save),n.uIk("title",E.text.button_save))},directives:[l._Y,l.JL,l.F],encapsulation:2});const C=["codeMirrorPane"];class u extends e.T{constructor(P,E,T,M){super(E,T,P),this.elementRef=P,this.locals=E,this.cdRef=T,this.I18n=M,this.changed=!1,this.showClose=!0,this.closeOnEscape=!0,this.closeOnOutsideClick=!0,this._language="",this.debouncedLanguageLoader=_.debounce(()=>this.loadLanguageAsMode(this.language),300),this.text={title:this.I18n.t("js.editor.macro.code_block.title"),language:this.I18n.t("js.editor.macro.code_block.language"),language_hint:this.I18n.t("js.editor.macro.code_block.language_hint"),button_save:this.I18n.t("js.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.languageClass=E.languageClass||"language-text",this.content=E.content;const S=/language-(\w+)/.exec(this.languageClass);this.language=S?S[1]:"text"}applyAndClose(P){this.content=this.codeMirrorInstance.getValue();const E=this.language||"text";this.languageClass=`language-${E}`,this.changed=!0,this.closeMe(P)}ngAfterViewInit(){t.e("default-node_modules_codemirror_lib_codemirror_js").then(t.t.bind(t,21302,23)).then(P=>{const E=P.default;this.codeMirrorInstance=E.fromTextArea(this.codeMirrorPane.nativeElement,{lineNumbers:!0,smartIndent:!0,autofocus:!0,value:this.content,mode:""})})}get language(){return this._language}set language(P){this._language=P,this.debouncedLanguageLoader()}loadLanguageAsMode(P){if(!P||"text"===P)return this.updateCodeMirrorMode("");t(30341)(`./${P}/${P}.js`).then(()=>{this.updateCodeMirrorMode(P)}).catch(E=>{console.error(`Failed to load language ${P}: ${E}`),this.updateCodeMirrorMode("")})}updateCodeMirrorMode(P){const E=this.codeMirrorInstance;E&&E.setOption("mode",P)}updateLanguage(P){P?/^\w+$/.exec(P)?this.language=P:console.error(`Not updating non-matching language: ${P}`):this.language=""}}u.\u0275fac=function(P){return new(P||u)(n.Y36(n.SBq),n.Y36(i.E),n.Y36(n.sBO),n.Y36(d.D))},u.\u0275cmp=n.Xpm({type:u,selectors:[["ng-component"]],viewQuery:function(P,E){if(1&P&&n.Gf(C,7),2&P){let T;n.iGM(T=n.CRH())&&(E.codeMirrorPane=T.first)}},features:[n.qOj],decls:19,vars:7,consts:[[1,"spot-modal",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["name","codemirror-element","id","codemirror-element",3,"ngModel"],["codeMirrorPane",""],[1,"form--field"],["for","selected-language",1,"form--label","hidden-for-sighted",3,"textContent"],[1,"form--field-container"],[1,"form--select-container"],["tabindex","2","type","text","id","selected-language","name","selected-language",1,"form--select",3,"ngModel","ngModelChange"],["selectedLanguage",""],[3,"textContent"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["tabindex","4","type","button",1,"spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["tabindex","3",1,"spot-modal--submit-button","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(P,E){1&P&&(n.TgZ(0,"form",0),n.NdJ("submit",function(M){return E.applyAndClose(M)}),n.TgZ(1,"div",1),n._uU(2),n.qZA(),n._UZ(3,"div",2),n.TgZ(4,"div",3),n._UZ(5,"textarea",4,5),n._UZ(7,"hr"),n.TgZ(8,"div",6),n._UZ(9,"label",7),n.TgZ(10,"div",8),n.TgZ(11,"div",9),n.TgZ(12,"input",10,11),n.NdJ("ngModelChange",function(M){return E.updateLanguage(M)}),n.qZA(),n.qZA(),n.qZA(),n._UZ(14,"p",12),n.qZA(),n.qZA(),n.TgZ(15,"div",13),n.TgZ(16,"div",14),n.TgZ(17,"button",15),n.NdJ("click",function(M){return E.closeMe(M)}),n.qZA(),n._UZ(18,"button",16),n.qZA(),n.qZA(),n.qZA()),2&P&&(n.xp6(2),n.Oqu(E.text.title),n.xp6(3),n.Q6J("ngModel",E.content),n.xp6(4),n.Q6J("textContent",E.text.language),n.xp6(3),n.Q6J("ngModel",E.language),n.xp6(2),n.Q6J("textContent",E.text.language_hint),n.xp6(3),n.Q6J("textContent",E.text.button_cancel),n.xp6(1),n.Q6J("textContent",E.text.button_save))},directives:[l._Y,l.JL,l.F,l.Fj,l.JJ,l.On],encapsulation:2});const k=["selectedPageInput"];class O extends e.T{constructor(P,E,T,M){super(E,T,P),this.elementRef=P,this.locals=E,this.cdRef=T,this.I18n=M,this.changed=!1,this.showClose=!0,this.closeOnEscape=!0,this.closeOnOutsideClick=!0,this.page="",this.includeParent=!1,this.text={title:this.I18n.t("js.editor.macro.child_pages.button"),hint:this.I18n.t("js.editor.macro.child_pages.hint"),page:this.I18n.t("js.editor.macro.child_pages.page"),include_parent:this.I18n.t("js.editor.macro.child_pages.include_parent"),button_save:this.I18n.t("js.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.selectedPage=this.page=this.locals.page,this.selectedIncludeParent=this.includeParent=this.locals.includeParent}applyAndClose(P){this.changed=!0,this.page=this.selectedPage,this.includeParent=this.selectedIncludeParent,this.closeMe(P)}ngAfterViewInit(){this.selectedPageInput.nativeElement.focus()}updateIncludeParent(P){this.selectedIncludeParent=P}}O.\u0275fac=function(P){return new(P||O)(n.Y36(n.SBq),n.Y36(i.E),n.Y36(n.sBO),n.Y36(d.D))},O.\u0275cmp=n.Xpm({type:O,selectors:[["ng-component"]],viewQuery:function(P,E){if(1&P&&n.Gf(k,7),2&P){let T;n.iGM(T=n.CRH())&&(E.selectedPageInput=T.first)}},features:[n.qOj],decls:25,vars:9,consts:[[1,"spot-modal",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container","form"],[1,"form--fieldset"],[3,"textContent"],[1,"form--field"],["for","selected-page",1,"form--label","hidden-for-sighted",3,"textContent"],[1,"form--field-container"],[1,"form--select-container"],["tabindex","2","type","text","id","selected-page","name","selected-page","placeholder","my-project:my-page",1,"form--select",3,"value","change"],["selectedPageInput",""],[1,"form--label-with-check-box"],[1,"form--check-box-container"],["tabindex","3","type","checkbox","id","include-parent","name","include-parent",1,"form--check-box",3,"ngModel","ngModelChange"],["parentIncludedInput",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button","tabindex","4",1,"spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["tabindex","3",1,"spot-modal--submit-button","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(P,E){1&P&&(n.TgZ(0,"form",0),n.NdJ("submit",function(M){return E.applyAndClose(M)}),n.TgZ(1,"div",1),n._uU(2),n.qZA(),n._UZ(3,"div",2),n.TgZ(4,"div",3),n.TgZ(5,"fieldset",4),n._UZ(6,"legend",5),n.TgZ(7,"div",6),n._UZ(8,"label",7),n.TgZ(9,"div",8),n.TgZ(10,"div",9),n.TgZ(11,"input",10,11),n.NdJ("change",function(M){return E.selectedPage=M.target.value}),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.TgZ(13,"div",6),n.TgZ(14,"div",8),n.TgZ(15,"label",12),n.TgZ(16,"div",13),n.TgZ(17,"input",14,15),n.NdJ("ngModelChange",function(M){return E.updateIncludeParent(M)}),n.qZA(),n.qZA(),n._uU(19),n.qZA(),n.qZA(),n.qZA(),n._UZ(20,"p",5),n.qZA(),n.qZA(),n.TgZ(21,"div",16),n.TgZ(22,"div",17),n.TgZ(23,"button",18),n.NdJ("click",function(M){return E.closeMe(M)}),n.qZA(),n._UZ(24,"button",19),n.qZA(),n.qZA(),n.qZA()),2&P&&(n.xp6(2),n.Oqu(E.text.title),n.xp6(4),n.Q6J("textContent",E.text.page),n.xp6(2),n.Q6J("textContent",E.text.page),n.xp6(3),n.Q6J("value",E.selectedPage),n.xp6(6),n.Q6J("ngModel",E.selectedIncludeParent),n.xp6(2),n.hij(" ",E.text.include_parent," "),n.xp6(1),n.Q6J("textContent",E.text.hint),n.xp6(3),n.Q6J("textContent",E.text.button_cancel),n.xp6(1),n.Q6J("textContent",E.text.button_save))},directives:[l._Y,l.JL,l.F,l.Wl,l.JJ,l.On],encapsulation:2});class y{constructor(P,E){this.opModalService=P,this.injector=E}configureWorkPackageButton(P,E){return new Promise((T,M)=>{this.opModalService.show(c,this.injector,{type:P,classes:E}).closingEvent.subscribe(R=>{R.changed&&T({type:R.type,classes:R.classes})})})}configureWikiPageInclude(P){return new Promise((E,T)=>{const M=P||"";this.opModalService.show(f,this.injector,{page:M}).closingEvent.subscribe(R=>{R.changed&&E(R.page)})})}editCodeBlock(P,E){return new Promise((T,M)=>{this.opModalService.show(u,this.injector,{content:P,languageClass:E}).closingEvent.subscribe(R=>{R.changed&&T({languageClass:R.languageClass,content:R.content})})})}configureChildPages(P,E){return new Promise((T,M)=>{this.opModalService.show(O,this.injector,{page:P,includeParent:E}).closingEvent.subscribe(R=>{R.changed&&T({page:R.page,includeParent:R.includeParent})})})}}y.\u0275fac=function(P){return new(P||y)(n.LFG(i.S),n.LFG(n.zs3))},y.\u0275prov=n.Yz7({token:y,factory:y.\u0275fac})},39656:(X,I,t)=>{"use strict";t.d(I,{x:()=>y});var i=t(60312),e=t(71562),d=t(96617),h=t(97973),n=t(86469),l=t(36293),a=t(18137),m=t(43440),v=t(77355),c=t(2316),p=t(53882),f=t(54364),C=t(2775);function u(b,P){if(1&b){const E=c.EpF();c.TgZ(0,"li",10),c.TgZ(1,"a",11),c.NdJ("click",function(M){const R=c.CHM(E).$implicit;return c.oxw(2).triggerByLink(R.url,M)}),c._UZ(2,"op-icon",12),c._UZ(3,"span",13),c.qZA(),c.qZA()}if(2&b){const E=P.$implicit;c.xp6(1),c.MGl("id","export-",E.identifier,""),c.uIk("href",E.url,c.LSH),c.xp6(1),c.MGl("icon-classes","icon-export-",E.identifier," icon-big"),c.xp6(1),c.Q6J("textContent",E.label)}}const k=function(b){return{"-hidden":b}};function O(b,P){if(1&b&&(c.TgZ(0,"ul",8),c.YNc(1,u,4,4,"li",9),c.qZA()),2&b){const E=c.oxw();c.Q6J("ngClass",c.VKq(2,k,E.isLoading)),c.xp6(1),c.Q6J("ngForOf",E.exportOptions)}}class y extends i.T{constructor(P,E,T,M,S,R,F,L,D){super(P,S,T),this.locals=P,this.I18n=E,this.elementRef=T,this.querySpace=M,this.cdRef=S,this.httpClient=R,this.wpTableColumns=F,this.loadingIndicator=L,this.toastService=D,this.closeOnEscape=!0,this.closeOnOutsideClick=!0,this.text={title:this.I18n.t("js.label_export"),closePopup:this.I18n.t("js.close_popup_title"),exportPreparing:this.I18n.t("js.label_export_preparing"),cancelButton:this.I18n.t("js.button_cancel")}}ngOnInit(){super.ngOnInit(),this.locals.link?this.requestExport(this.locals.link):this.querySpace.results.valuesPromise().then(P=>this.exportOptions=this.buildExportOptions(P))}buildExportOptions(P){return P.representations.map(E=>{const T=E.$link;return{identifier:T.identifier,label:T.title,url:this.addColumnsToHref(E.href)}})}triggerByLink(P,E){E.preventDefault(),this.requestExport(P)}requestExport(P){this.httpClient.get(P,{observe:"body",responseType:"json"}).subscribe(E=>this.replaceWithJobModal(E.job_id),E=>this.handleError(E))}replaceWithJobModal(P){this.service.show(a.L,"global",{jobId:P})}handleError(P){200===P.status&&P.url?window.open(P.url):this.showError(P)}showError(P){this.toastService.addError(P.message||this.I18n.t("js.error.internal"))}addColumnsToHref(P){const T=this.wpTableColumns.getColumns().map(S=>S.id),M=h(P);return M.removeSearch("columns[]"),M.addSearch("columns[]",T),M.toString()}get afterFocusOn(){return jQuery("#work-packages-settings-button")}}y.\u0275fac=function(P){return new(P||y)(c.Y36(v.E),c.Y36(d.D),c.Y36(c.SBq),c.Y36(m.q),c.Y36(c.sBO),c.Y36(p.eN),c.Y36(e.i),c.Y36(n.vt),c.Y36(l.kl))},y.\u0275cmp=c.Xpm({type:y,selectors:[["ng-component"]],features:[c.qOj],decls:10,vars:3,consts:[[1,"spot-modal","spot-modal_wide","op-wp-table-export"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["class","op-export-options",3,"ngClass",4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],[1,"op-export-options",3,"ngClass"],["class","op-export-options--option",4,"ngFor","ngForOf"],[1,"op-export-options--option"],[1,"op-export-options--option-link",3,"id","click"],[3,"icon-classes"],[1,"op-export-options--option-label",3,"textContent"]],template:function(P,E){1&P&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c._uU(2),c.qZA(),c._UZ(3,"div",2),c.TgZ(4,"div",3),c.YNc(5,O,2,4,"ul",4),c.qZA(),c.TgZ(6,"div",5),c.TgZ(7,"div",6),c.TgZ(8,"button",7),c.NdJ("click",function(){return E.closeMe()}),c._uU(9),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&P&&(c.xp6(2),c.Oqu(E.text.title),c.xp6(3),c.Q6J("ngIf",E.exportOptions),c.xp6(4),c.hij(" ",E.text.cancelButton," "))},directives:[f.O5,f.mk,f.sg,C.o],styles:[".op-wp-table-export[_ngcontent-%COMP%]   #download-link[_ngcontent-%COMP%]{display:none}.op-wp-table-export[_ngcontent-%COMP%]   .loading-indicator--location[_ngcontent-%COMP%]{height:220px}.op-wp-table-export[_ngcontent-%COMP%]   .export-options.-hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0})},58057:(X,I,t)=>{"use strict";t.d(I,{T:()=>r});var i=t(77355),e=t(60312),d=t(96617),h=t(2316);class r extends e.T{constructor(l,a,m,v){super(a,m,l),this.elementRef=l,this.locals=a,this.cdRef=m,this.I18n=v,this.closeOnOutsideClick=!1}ngOnInit(){super.ngOnInit(),this.$element.find(".dynamic-content-modal--wrapper").addClass(this.locals.modalClassName).append(this.locals.modalBody),document.querySelector(".spot-modal").querySelector("[dynamic-content-modal-close-button]").addEventListener("click",()=>this.closeMe())}ngOnDestroy(){super.ngOnDestroy()}}r.\u0275fac=function(l){return new(l||r)(h.Y36(h.SBq),h.Y36(i.E),h.Y36(h.sBO),h.Y36(d.D))},r.\u0275cmp=h.Xpm({type:r,selectors:[["ng-component"]],features:[h.qOj],decls:1,vars:0,consts:[["data-indicator-name","modal",1,"spot-modal","dynamic-content-modal--wrapper","loading-indicator--location"]],template:function(l,a){1&l&&h._UZ(0,"div",0)},encapsulation:2,changeDetection:0})},74168:(X,I,t)=>{"use strict";t.d(I,{I:()=>T});var i=t(61043),e=t(87853),d=t(60312),h=t(77355),r=t(48451),n=t(47775),l=t(96617),a=t(57014),m=t(62964),v=t(56686);function c(M){return null!==M}var p=t(2316),f=t(54364),C=t(1707);function u(M,S){if(1&M&&(p.TgZ(0,"li"),p._uU(1," #"),p._UZ(2,"span",9),p._UZ(3,"span",9),p.qZA()),2&M){const R=S.$implicit;p.xp6(2),p.Q6J("textContent",R.id),p.xp6(1),p.Q6J("textContent",R.subject||"")}}function k(M,S){if(1&M&&(p.TgZ(0,"div"),p.TgZ(1,"p",10),p._UZ(2,"span",11),p._UZ(3,"strong",9),p._uU(4,": "),p._UZ(5,"span",9),p.qZA(),p.TgZ(6,"ul"),p.YNc(7,u,4,2,"li",12),p.qZA(),p.TgZ(8,"p"),p._UZ(9,"span",9),p.qZA(),p.qZA()),2&M){const R=p.oxw(2);p.xp6(3),p.Q6J("textContent",R.text.warning),p.xp6(2),p.Q6J("textContent",R.text.hasChildren(R.singleWorkPackage)),p.xp6(2),p.Q6J("ngForOf",R.singleWorkPackageChildren),p.xp6(2),p.Q6J("textContent",R.text.deletesChildren)}}function O(M,S){if(1&M&&(p.ynx(0),p.TgZ(1,"p"),p._UZ(2,"span",9),p.TgZ(3,"strong"),p._uU(4),p.qZA(),p._uU(5," ? "),p.qZA(),p.YNc(6,k,10,4,"div",3),p.BQk()),2&M){const R=p.oxw();p.xp6(2),p.Q6J("textContent",R.text.single_text),p.xp6(2),p.AsE(" ",R.singleWorkPackage.subject," #",R.singleWorkPackage.id," "),p.xp6(2),p.Q6J("ngIf",R.singleWorkPackageChildren&&R.singleWorkPackageChildren.length>0)}}function y(M,S){if(1&M&&(p.TgZ(0,"strong"),p._uU(1),p.qZA()),2&M){const R=p.oxw().$implicit,F=p.oxw(2);p.xp6(1),p.hij(" (+ ",F.text.childCount(R),") ")}}function b(M,S){if(1&M&&(p.TgZ(0,"li"),p._uU(1," #"),p._UZ(2,"span",9),p._uU(3," "),p._UZ(4,"span",9),p.YNc(5,y,2,1,"strong",3),p.qZA()),2&M){const R=S.$implicit,F=p.oxw(2);p.xp6(2),p.Q6J("textContent",R.id),p.xp6(2),p.Q6J("textContent",R.subject),p.xp6(1),p.Q6J("ngIf",F.children(R).length>0)}}function P(M,S){if(1&M&&(p.ynx(0),p.TgZ(1,"p",10),p._UZ(2,"span",11),p._UZ(3,"strong",9),p.qZA(),p.TgZ(4,"ul"),p.YNc(5,b,6,3,"li",12),p.qZA(),p.BQk()),2&M){const R=p.oxw();p.xp6(3),p.Q6J("textContent",R.text.bulk_text),p.xp6(2),p.Q6J("ngForOf",R.workPackages)}}function E(M,S){if(1&M){const R=p.EpF();p.TgZ(0,"div"),p.TgZ(1,"label",13),p.TgZ(2,"div",14),p.TgZ(3,"input",15),p.NdJ("ngModelChange",function(L){p.CHM(R);return p.oxw().childrenDeletionConfirmed=L}),p.qZA(),p.qZA(),p._uU(4),p.qZA(),p.qZA()}if(2&M){const R=p.oxw();p.xp6(3),p.Q6J("ngModel",R.childrenDeletionConfirmed),p.xp6(1),p.hij(" ",R.text.label_confirm_children_deletion," ")}}class T extends d.T{constructor(S,R,F,L,D,G,Q,V,K,q,se){super(F,D,S),this.elementRef=S,this.workPackageService=R,this.locals=F,this.I18n=L,this.cdRef=D,this.$state=G,this.states=Q,this.wpTableFocus=V,this.wpListService=K,this.notificationService=q,this.backRoutingService=se,this.busy=!1,this.childrenDeletionConfirmed=!1,this.text={label_visibility_settings:this.I18n.t("js.label_visibility_settings"),button_save:this.I18n.t("js.modals.button_save"),confirm:this.I18n.t("js.modals.button_delete"),warning:this.I18n.t("js.label_warning"),cancel:this.I18n.t("js.button_cancel"),close:this.I18n.t("js.close_popup_title"),label_confirm_children_deletion:this.I18n.t("js.modals.destroy_work_package.confirm_deletion_children"),title:"",bulk_text:"",single_text:this.I18n.t("js.modals.destroy_work_package.single_text"),childCount:te=>"",hasChildren:te=>"",deletesChildren:""}}ngOnInit(){super.ngOnInit(),this.workPackages=this.locals.workPackages,this.workPackageLabel=this.I18n.t("js.units.workPackage",{count:this.workPackages.length}),1===this.workPackages.length&&(this.singleWorkPackage=this.workPackages[0],this.singleWorkPackageChildren=this.singleWorkPackage.children),this.text.title=this.I18n.t("js.modals.destroy_work_package.title",{label:this.workPackageLabel}),this.text.bulk_text=this.I18n.t("js.modals.destroy_work_package.bulk_text",{label:this.workPackageLabel,count:this.workPackages.length}),this.text.childCount=S=>{const R=this.children(S).length;return this.I18n.t("js.units.child_work_packages",{count:R})},this.text.hasChildren=S=>{const R=this.text.childCount(S);return this.I18n.t("js.modals.destroy_work_package.has_children",{childUnits:R})},this.text.deletesChildren=this.I18n.t("js.modals.destroy_work_package.deletes_children")}get blockedDueToUnconfirmedChildren(){return this.mustConfirmChildren&&!this.childrenDeletionConfirmed}get mustConfirmChildren(){let S=!1;return this.singleWorkPackage&&this.singleWorkPackageChildren&&(S=this.singleWorkPackageChildren.length>0),S||!!_.find(this.workPackages,R=>R.children&&R.children.length>0)}confirmDeletion(S){if(this.busy||this.blockedDueToUnconfirmedChildren)return!1;this.busy=!0;const R=this.workPackages.map(F=>F.id).filter(c);return this.workPackageService.performBulkDelete(R,!0).then(()=>{this.busy=!1,this.closeMe(S),this.wpTableFocus.clear("Clearing after destroying work packages"),this.$state.current.data.baseRoute&&this.backRoutingService.goBack(!0)}).catch(()=>{this.busy=!1}),!1}children(S){return S.hasOwnProperty("children")?S.children:[]}}T.\u0275fac=function(S){return new(S||T)(p.Y36(p.SBq),p.Y36(v.h),p.Y36(h.E),p.Y36(l.D),p.Y36(p.sBO),p.Y36(n.StateService),p.Y36(e.G),p.Y36(r.o),p.Y36(i.Z),p.Y36(m.q),p.Y36(a.Y))},T.\u0275cmp=p.Xpm({type:T,selectors:[["ng-component"]],features:[p.qOj],decls:13,vars:7,consts:[["data-indicator-name","modal","id","wp_destroy_modal",1,"spot-modal"],[1,"spot-modal--header"],[1,"spot-modal--body","spot-container"],[4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","-danger","spot-action-bar--action",3,"click"],[1,"spot-icon","spot-icon_delete"],[3,"textContent"],[1,"danger-zone--warning"],[1,"icon-context","icon-error"],[4,"ngFor","ngForOf"],[1,"form--label-with-check-box","-no-ellipsis"],[1,"form--check-box-container"],["type","checkbox","name","confirm-children-deletion","id","confirm-children-deletion",1,"form--check-box",3,"ngModel","ngModelChange"]],template:function(S,R){1&S&&(p.TgZ(0,"div",0),p.TgZ(1,"div",1),p._uU(2),p.qZA(),p.TgZ(3,"div",2),p.YNc(4,O,7,4,"ng-container",3),p.YNc(5,P,6,2,"ng-container",3),p.YNc(6,E,5,2,"div",3),p.qZA(),p.TgZ(7,"div",4),p.TgZ(8,"div",5),p.TgZ(9,"button",6),p.NdJ("click",function(L){return R.closeMe(L)}),p.qZA(),p.TgZ(10,"button",7),p.NdJ("click",function(L){return R.confirmDeletion(L)}),p._UZ(11,"span",8),p._uU(12),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&S&&(p.xp6(2),p.Oqu(R.text.title),p.xp6(2),p.Q6J("ngIf",R.singleWorkPackage),p.xp6(1),p.Q6J("ngIf",R.workPackages.length>1),p.xp6(1),p.Q6J("ngIf",R.mustConfirmChildren),p.xp6(3),p.Q6J("textContent",R.text.cancel),p.xp6(1),p.uIk("disabled",R.busy||R.blockedDueToUnconfirmedChildren||void 0),p.xp6(2),p.hij(" ",R.text.confirm," "))},directives:[f.O5,f.sg,C.Wl,C.JJ,C.On],encapsulation:2})},55216:(X,I,t)=>{"use strict";t.d(I,{X:()=>n,S:()=>l});var i=t(45410),e=t(2316),d=t(54364);function h(a,m){1&a&&e._UZ(0,"i",3)}function r(a,m){if(1&a&&e._UZ(0,"div",4),2&a){const v=e.oxw();e.Q6J("innerHTML",v.description,e.oJD)}}const n="op-no-results";class l{constructor(m){this.elementRef=m,this.showIcon=!0,this.setHostClass=!0,(0,i.E)(this)}}l.\u0275fac=function(m){return new(m||l)(e.Y36(e.SBq))},l.\u0275cmp=e.Xpm({type:l,selectors:[["op-no-results"]],hostVars:2,hostBindings:function(m,v){2&m&&e.ekj("generic-table--no-results-container",v.setHostClass)},inputs:{title:"title",description:"description",showIcon:"showIcon"},decls:4,vars:3,consts:[["class","icon-info1","aria-hidden","true",4,"ngIf"],[1,"generic-table--no-results-title"],["class","generic-table--no-results-description",3,"innerHTML",4,"ngIf"],["aria-hidden","true",1,"icon-info1"],[1,"generic-table--no-results-description",3,"innerHTML"]],template:function(m,v){1&m&&(e.YNc(0,h,1,0,"i",0),e.TgZ(1,"span",1),e._uU(2),e.YNc(3,r,1,1,"div",2),e.qZA()),2&m&&(e.Q6J("ngIf",v.showIcon),e.xp6(2),e.hij(" ",v.title," "),e.xp6(1),e.Q6J("ngIf",v.description))},directives:[d.O5],encapsulation:2,changeDetection:0})},70099:(X,I,t)=>{"use strict";t.d(I,{V:()=>h});var i=t(2316),e=t(52332);class h{constructor(){this.viewBox="0 0 400 130"}ngOnInit(){this.baseUrl=window.appBasePath}}h.\u0275fac=function(n){return new(n||h)},h.\u0275cmp=i.Xpm({type:h,selectors:[["op-content-loader"]],inputs:{viewBox:"viewBox"},ngContentSelectors:["*"],decls:2,vars:3,consts:[[3,"baseUrl","speed","viewBox"]],template:function(n,l){1&n&&(i.F$t(),i.TgZ(0,"content-loader",0),i.Hsn(1),i.qZA()),2&n&&i.Q6J("baseUrl",l.baseUrl)("speed",3)("viewBox",l.viewBox)},directives:[e.H1],encapsulation:2,changeDetection:0})},87523:(X,I,t)=>{"use strict";t.d(I,{a:()=>h});var i=t(54364),e=t(52332),d=t(2316);class h{}h.\u0275fac=function(n){return new(n||h)},h.\u0275mod=d.oAB({type:h}),h.\u0275inj=d.cJS({imports:[[i.ez,e.GO]]})},55548:(X,I,t)=>{"use strict";t.d(I,{n:()=>h});var i=t(20342),e=t(53358),d=t(2316);class h extends e.m{constructor(n,l){super(l),this.elementRef=n,this.opContextMenu=l,this.items=[]}ngAfterViewInit(){this.$element=jQuery(this.elementRef.nativeElement),this.$element.on("click",n=>{n.preventDefault(),this.opContextMenu.isActive(this)?this.opContextMenu.close():this.open(n)}),Mousetrap(this.$element[0]).bind("shift+alt+f10",n=>{this.open(n)})}positionArgs(n){return{my:"left top",at:"left bottom",of:this.$element,collision:"flipfit"}}}h.\u0275fac=function(n){return new(n||h)(d.Y36(d.SBq),d.Y36(i.$))},h.\u0275dir=d.lG2({type:h,selectors:[["","opContextMenuTrigger",""]],features:[d.qOj]})},8643:(X,I,t)=>{"use strict";t.d(I,{Y:()=>n});var i=t(20342),e=t(55548),d=t(12703),h=t(87853),r=t(2316);class n extends e.n{constructor(a,m,v,c){super(a,m),this.elementRef=a,this.opContextMenu=m,this.states=v,this.halEditing=c}open(a){const m=this.states.workPackages.get("new").value;m&&this.halEditing.changeFor(m).getForm().then(c=>{this.buildItems(c),this.opContextMenu.show(this,a)})}positionArgs(a){const v=super.positionArgs(a);return _.assign(v,{my:"right top",at:"right bottom"}),v}buildItems(a){this.items=[];const m=a.configureForm,v=a.customFields;v&&this.items.push({href:v.href,icon:"icon-custom-fields",linkText:v.name,onClick:()=>!1}),m&&this.items.push({href:m.href,icon:"icon-settings3",linkText:m.name,onClick:()=>!1})}}n.\u0275fac=function(a){return new(a||n)(r.Y36(r.SBq),r.Y36(i.$),r.Y36(h.G),r.Y36(d.l))},n.\u0275dir=r.lG2({type:n,selectors:[["","wpCreateSettingsMenu",""]],features:[r.qOj]})},11269:(X,I,t)=>{"use strict";t.d(I,{I:()=>a});var i=t(3786),e=t(96617),d=t(55548),h=t(20342),r=t(77355),n=t(2316),l=t(2775);class a extends d.n{constructor(v,c,p,f,C,u){super(v,c),this.elementRef=v,this.opContextMenu=c,this.opModalService=p,this.injector=f,this.cdRef=C,this.I18n=u}open(v){return(0,i.mG)(this,void 0,void 0,function*(){this.items=yield this.buildItems(),this.opContextMenu.show(this,v)})}positionArgs(v){const p=super.positionArgs(v);return _.assign(p,{my:"right top",at:"right bottom"}),p}buildItems(){return(0,i.mG)(this,void 0,void 0,function*(){const v=[];if(this.menuItems){const c=yield this.menuItems();return v.concat(c)}return v})}}a.\u0275fac=function(v){return new(v||a)(n.Y36(n.SBq),n.Y36(h.$),n.Y36(r.S),n.Y36(n.zs3),n.Y36(n.sBO),n.Y36(e.D))},a.\u0275cmp=n.Xpm({type:a,selectors:[["icon-triggered-context-menu"]],inputs:{menuItems:["menu-items","menuItems"]},features:[n.qOj],decls:2,vars:0,consts:[["href","#"],["icon-classes","icon-show-more-horizontal"]],template:function(v,c){1&v&&(n.TgZ(0,"a",0),n._UZ(1,"op-icon",1),n.qZA())},directives:[l.o],styles:["a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:hover{color:var(--light-gray);text-decoration:none}"]})},53358:(X,I,t)=>{"use strict";t.d(I,{m:()=>e});var i=t(26942);class e extends i.N{constructor(h){super(),this.opContextMenu=h,this.items=[]}onClose(){this.afterFocusOn.trigger("focus")}onOpen(h){h.find(".menu-item").first().trigger("focus")}positionArgs(h){return{my:"left top",at:"right bottom",of:h,collision:"flipfit"}}get locals(){return{items:this.items}}open(h){this.opContextMenu.show(this,h)}get afterFocusOn(){return this.$element}}},36322:(X,I,t)=>{"use strict";t.d(I,{n:()=>u});var i=t(30712),e=t(2316),d=t(54364),h=t(2775);function r(k,O){1&k&&e._UZ(0,"li",5)}function n(k,O){if(1&k&&e._UZ(0,"op-icon",11),2&k){const y=e.oxw(3).$implicit;e.MGl("icon-classes","icon-action-menu ",y.icon,"")}}function l(k,O){if(1&k&&e._UZ(0,"op-icon",12),2&k){const y=e.oxw(3).$implicit;e.MGl("icon-classes","icon-action-menu-post ",y.postIcon,""),e.Q6J("icon-title",y.postIconTitle||"")}}function a(k,O){if(1&k){const y=e.EpF();e.TgZ(0,"a",7),e.NdJ("click",function(P){e.CHM(y);const E=e.oxw(2).$implicit;return e.oxw().handleClick(E,P)}),e.YNc(1,n,1,1,"op-icon",8),e._UZ(2,"span",9),e.YNc(3,l,1,2,"op-icon",10),e.qZA()}if(2&k){const y=e.oxw(2).$implicit;e.ekj("inactive",y.disabled),e.Q6J("ngClass",y.class),e.uIk("href",y.href,e.LSH)("aria-disabled",y.disabled)("aria-label",y.ariaLabel||y.linkText)("title",y.title||void 0),e.xp6(1),e.Q6J("ngIf",y.icon),e.xp6(1),e.Q6J("textContent",y.linkText),e.xp6(1),e.Q6J("ngIf",y.postIcon)}}function m(k,O){if(1&k&&e._UZ(0,"op-icon",11),2&k){const y=e.oxw(3).$implicit;e.MGl("icon-classes","icon-action-menu ",y.icon,"")}}function v(k,O){if(1&k&&e._UZ(0,"op-icon",12),2&k){const y=e.oxw(3).$implicit;e.MGl("icon-classes","icon-action-menu-post ",y.postIcon,""),e.Q6J("icon-title",y.postIconTitle||"")}}function c(k,O){if(1&k){const y=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(P){e.CHM(y);const E=e.oxw(2).$implicit;return e.oxw().handleClick(E,P)}),e.YNc(1,m,1,1,"op-icon",8),e._UZ(2,"span",9),e.YNc(3,v,1,2,"op-icon",10),e.qZA()}if(2&k){const y=e.oxw(2).$implicit;e.ekj("inactive",y.disabled),e.Q6J("ngClass",y.class),e.uIk("aria-disabled",y.disabled)("aria-label",y.ariaLabel||y.linkText)("title",y.title||void 0),e.xp6(1),e.Q6J("ngIf",y.icon),e.xp6(1),e.Q6J("textContent",y.linkText),e.xp6(1),e.Q6J("ngIf",y.postIcon)}}function p(k,O){if(1&k&&(e.TgZ(0,"li"),e.YNc(1,a,4,10,"a",6),e.YNc(2,c,4,9,"button",6),e.qZA()),2&k){const y=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",y.href),e.xp6(1),e.Q6J("ngIf",!y.href)}}function f(k,O){if(1&k&&(e.ynx(0),e.YNc(1,r,1,0,"li",3),e.YNc(2,p,3,2,"li",4),e.BQk()),2&k){const y=O.$implicit;e.xp6(1),e.Q6J("ngIf",y.divider),e.xp6(1),e.Q6J("ngIf",!y.divider)}}const C=function(k){return{"-empty":k}};class u{constructor(O){this.locals=O,this.items=this.locals.items.filter(y=>!(null==y?void 0:y.hidden)),this.service=this.locals.service}handleClick(O,y){return!O.disabled&&!O.divider&&(!O.onClick(y)||(this.locals.service.close(),y.preventDefault(),y.stopPropagation(),!1))}}u.\u0275fac=function(O){return new(O||u)(e.Y36(i.Q))},u.\u0275cmp=e.Xpm({type:u,selectors:[["ng-component"]],decls:3,vars:5,consts:[["ng-class","{'dropdown-anchor-right': locals.showAnchorRight}",1,"dropdown-relative","dropdown","-overflow-in-view"],["role","menu",1,"dropdown-menu",3,"ngClass"],[4,"ngFor","ngForOf"],["class","dropdown-divider",4,"ngIf"],[4,"ngIf"],[1,"dropdown-divider"],["class","menu-item",3,"ngClass","inactive","click",4,"ngIf"],[1,"menu-item",3,"ngClass","click"],[3,"icon-classes",4,"ngIf"],[3,"textContent"],[3,"icon-title","icon-classes",4,"ngIf"],[3,"icon-classes"],[3,"icon-title","icon-classes"]],template:function(O,y){1&O&&(e.TgZ(0,"div",0),e.TgZ(1,"ul",1),e.YNc(2,f,3,2,"ng-container",2),e.qZA(),e.qZA()),2&O&&(e.uIk("id",y.locals.contextMenuId),e.xp6(1),e.Q6J("ngClass",e.VKq(3,C,0===y.items.length)),e.xp6(1),e.Q6J("ngForOf",y.items))},directives:[d.mk,d.sg,d.O5,h.o],encapsulation:2})},20342:(X,I,t)=>{"use strict";t.d(I,{$:()=>a});var i=t(40912),e=t(47775),d=t(30712),h=t(36322),r=t(33406),n=t(7101),l=t(2316);class a{constructor(v,c,p,f,C){this.componentFactoryResolver=v,this.FocusHelper=c,this.appRef=p,this.$transitions=f,this.injector=C,this.active=null,this.isOpening=!1;const u=this.portalHostElement=document.createElement("div");u.classList.add("op-context-menu--overlay"),document.body.appendChild(u),this.bodyPortalHost=new i.u0(u,this.componentFactoryResolver,this.appRef,this.injector),f.onStart({},()=>this.close()),jQuery(window).on("keydown",O=>(this.active&&O.which===r.m.ESCAPE&&this.close(),!0));const k=this;document.getElementById("wrapper").addEventListener("click",O=>{k.active&&!k.portalHostElement.contains(O.target)&&k.close()},!0)}show(v,c,p=h.n){this.close(),this.isOpening=!0;const f=new i.C5(p,null,this.injectorFor(v.locals));this.bodyPortalHost.attach(f),this.portalHostElement.style.display="block",this.active=v,setTimeout(()=>{var C;this.reposition(c),null===(C=this.active)||void 0===C||C.onOpen(this.activeMenu),this.isOpening=!1})}isActive(v){return!!this.active&&this.active===v}close(){var v;this.isOpening||(this.bodyPortalHost.detach(),this.portalHostElement.style.display="none",null===(v=this.active)||void 0===v||v.onClose(),this.active=null)}reposition(v){!this.active||this.activeMenu.position(this.active.positionArgs(v)).css("visibility","visible")}get activeMenu(){return jQuery(this.portalHostElement).find(".dropdown")}injectorFor(v){const c=new WeakMap;return v.service=this,c.set(d.Q,v),new i.nK(this.injector,c)}}a.\u0275fac=function(v){return new(v||a)(l.LFG(l._Vd),l.LFG(n.i),l.LFG(l.z2F),l.LFG(e.TransitionService),l.LFG(l.zs3))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})},30712:(X,I,t)=>{"use strict";t.d(I,{Q:()=>e});const e=new(t(2316).OlP)("CONTEXT_MENU_LOCALS")},74565:(X,I,t)=>{"use strict";t.d(I,{B:()=>O});var i=t(3786),e=t(47775),d=t(67325),h=t(7493),r=t(70233),l=(t(24897),t(53448)),a=t(55548),m=t(20342),v=t(60713),c=t(77355),p=t(29161),f=t(46709),C=t(74168);class u{constructor(b,P,E){this.workPackage=b,this.PathHelper=P,this.$state=E,this.project=b.project}linkForAction(b){let P;switch(b.key){case"copy":P=this.copyLink();break;case"copy_to_other_project":P=this.bulkCopyLink();break;default:P=this.workPackage[b.link].href}return Object.assign(Object.assign({},b),{link:P})}isPermitted(b){return void 0!==this.workPackage[b.link]}permittedActionKeys(b){return b.filter(P=>this.isPermitted(P)).map(P=>P.key)}permittedActionsWithLinks(b){return b.filter(P=>this.isPermitted(P)).map(P=>this.linkForAction(P))}copyLink(){return 0===this.$state.current.name.indexOf("work-packages.partitioned.list.details")?this.PathHelper.workPackageDetailsCopyPath(this.project.identifier,this.workPackage.id):this.PathHelper.workPackageCopyPath(this.workPackage.id)}bulkCopyLink(){return`${this.PathHelper.staticBase}/work_packages/move/new?copy=true&ids[]=${this.workPackage.id}`}}var k=t(2316);class O extends a.n{constructor(b,P,E,T,M,S,R,F){super(M,R),this.HookService=b,this.$state=P,this.injector=E,this.PathHelper=T,this.elementRef=M,this.opModalService=S,this.opContextMenuService=R,this.authorisationService=F}open(b){this.workPackage.project.$load().then(()=>{this.authorisationService.initModelAuth("work_package",this.workPackage.$links);const P=new u(this.workPackage,this.PathHelper,this.$state),E=this.getPermittedActions(P);this.buildItems(E),this.opContextMenu.show(this,b)})}triggerContextMenuAction(b,P){const{link:E}=b;switch(P){case"copy_to_other_project":window.location.href=`${this.PathHelper.staticBase}/work_packages/move/new?copy=true&ids[]=${this.workPackage.id}`;break;case"copy":this.$state.go("work-packages.copy",{copiedFromWorkPackageId:this.workPackage.id});break;case"delete":this.opModalService.show(C.I,this.injector,{workPackages:[this.workPackage]});break;case"log_time":this.timeEntryCreateService.create(moment(new Date),this.workPackage,{showWorkPackageField:!1}).catch(()=>{});break;default:window.location.href=E}}positionArgs(b){const E=super.positionArgs(b);return _.assign(E,{my:"right top",at:"right bottom"}),E}getPermittedActions(b){const P=b.permittedActionsWithLinks(v.p);return _.each(this.getPermittedPluginActions(b),E=>{const T=E.indexBy?E.indexBy(P):P.length;P.splice(T,0,E)}),P}getPermittedPluginActions(b){const P=this.HookService.call("workPackageSingleContextMenu");return b.permittedActionsWithLinks(P)}buildItems(b){const P=this.workPackage.configureForm;return this.items=b.map(E=>{const{key:T}=E;return{disabled:!1,linkText:I18n.t(`js.button_${T}`),href:E.link,icon:E.icon||`icon-${T}`,onClick:M=>(!E.link||!(0,d.F)(M))&&(this.triggerContextMenuAction(E,T),!0)}}),P&&this.items.push({href:P.href,icon:"icon-settings3",linkText:I18n.t("js.button_configure-form"),onClick:()=>!1}),this.items}}O.\u0275fac=function(b){return new(b||O)(k.Y36(l.$),k.Y36(e.StateService),k.Y36(k.zs3),k.Y36(r.j),k.Y36(k.SBq),k.Y36(c.S),k.Y36(m.$),k.Y36(h.g))},O.\u0275dir=k.lG2({type:O,selectors:[["","wpSingleContextMenu",""]],inputs:{workPackage:["wpSingleContextMenu-workPackage","workPackage"]},features:[k.qOj]}),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",f.f)],O.prototype,"timeEntryCreateService",void 0)},60713:(X,I,t)=>{"use strict";t.d(I,{p:()=>i});const i=[{key:"log_time",link:"logTime"},{key:"change_project",icon:"icon-move",link:"move"},{key:"copy",link:"copy"},{key:"copy_to_other_project",link:"copy",icon:"icon-project-types"},{key:"delete",link:"delete"},{key:"export-pdf",link:"pdf"},{key:"export-atom",link:"atom"}]},99794:(X,I,t)=>{"use strict";t.d(I,{X:()=>y});var i=t(3786),e=t(77591),d=t(87853),h=t(41945),r=t(60914),n=t(67325),l=t(53358),a=t(20342),m=t(60713),v=t(77355),c=t(47775),p=t(29161),f=t(46709),C=t(70482),u=t(74168),k=t(84699),O=t(70233);class y extends l.m{constructor(P,E,T,M={},S=!0){super(P.get(a.$)),this.injector=P,this.workPackageId=E,this.$element=T,this.additionalPositionArgs=M,this.allowSplitScreenActions=S,this.workPackage=this.states.workPackages.get(this.workPackageId).value,this.selectedWorkPackages=this.getSelectedWorkPackages(),this.permittedActions=this.WorkPackageContextMenuHelper.getPermittedActions(this.selectedWorkPackages,m.p,this.allowSplitScreenActions),this.baseRoute=this.$state.current.data.baseRoute||this.$state.current.name,this.items=this.buildItems()}get locals(){return{contextMenuId:"work-package-context-menu",items:this.items}}positionArgs(P){const E=super.positionArgs(P);return _.assign(E,this.additionalPositionArgs),E}triggerContextMenuAction(P){const{link:E}=P,T=this.workPackage.id;switch(P.key){case"delete":this.deleteSelectedWorkPackages();break;case"edit":this.editSelectedWorkPackages(E);break;case"copy":this.copySelectedWorkPackages(E);break;case"copy_to_other_project":window.location.href=`${this.pathHelper.staticBase}/work_packages/move/new?copy=true&ids[]=${T}`;break;case"relation-new-child":this.wpRelationsHierarchyService.addNewChildWp(this.baseRoute,this.workPackage);break;case"log_time":this.logTimeForSelectedWorkPackage();break;default:window.location.href=E}}deleteSelectedWorkPackages(){const P=this.getSelectedWorkPackages();this.opModalService.show(u.I,this.injector,{workPackages:P})}editSelectedWorkPackages(P){this.getSelectedWorkPackages().length>1&&(window.location.href=P)}copySelectedWorkPackages(P){const E=this.getSelectedWorkPackages();if(E.length>1)return void(window.location.href=P);const T={copiedFromWorkPackageId:E[0].id};this.$state.go(`${this.baseRoute}.copy`,T)}logTimeForSelectedWorkPackage(){this.timeEntryCreateService.create(moment(new Date),this.workPackage).catch(()=>{})}getSelectedWorkPackages(){const P=this.wpTableSelection.getSelectedWorkPackages();return 0===P.length?[this.workPackage]:(-1===P.indexOf(this.workPackage)&&P.push(this.workPackage),P)}buildItems(){const P=this.permittedActions.map(E=>({class:void 0,disabled:!1,linkText:E.text,href:E.href,icon:null!=E.icon?E.icon:`icon-${E.key}`,onClick:T=>(!E.href||!(0,n.F)(T))&&(this.triggerContextMenuAction(E),!0)}));return(0,k.Z)(this.workPackage)||(P.unshift({disabled:!1,icon:"icon-view-fullscreen",class:"openFullScreenView",href:this.$state.href("work-packages.show",{workPackageId:this.workPackageId}),linkText:I18n.t("js.button_open_fullscreen"),onClick:E=>!(0,n.F)(E)&&(this.$state.go("work-packages.show",{workPackageId:this.workPackageId}),!0)}),this.allowSplitScreenActions&&P.unshift({disabled:!1,icon:"icon-view-split",class:"detailsViewMenuItem",href:this.$state.href(`${(0,C.W)(this.$state)}.tabs`,{workPackageId:this.workPackageId,tabIdentifier:"overview"}),linkText:I18n.t("js.button_open_details"),onClick:E=>!(0,n.F)(E)&&(this.$state.go(`${(0,C.W)(this.$state)}.tabs`,{workPackageId:this.workPackageId,tabIdentifier:"overview"}),!0)})),P}}(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",d.G)],y.prototype,"states",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",h.O)],y.prototype,"wpRelationsHierarchyService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",v.S)],y.prototype,"opModalService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",c.StateService)],y.prototype,"$state",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",r.J)],y.prototype,"wpTableSelection",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",e.j)],y.prototype,"WorkPackageContextMenuHelper",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",f.f)],y.prototype,"timeEntryCreateService",void 0),(0,i.gn)([(0,p.W)(),(0,i.w6)("design:type",O.j)],y.prototype,"pathHelper",void 0)},14279:(X,I,t)=>{"use strict";t.d(I,{J:()=>n});var i=t(2316),e=t(26942),d=t(70692),h=t(12877);const r=["dateInput"];class n extends e.N{constructor(a,m,v,c,p){super(),this.injector=a,this.timezoneService=m,this.configurationService=v,this.ngZone=c,this.changeDetectorRef=p,this.canceled=new i.vpe,this.classes="",this.id="",this.name="",this.required=!1,this.size=20,this.disabled=!1,this.id||(this.id=`datepicker-input-${Math.floor(1e3*Math.random()).toString(3)}`)}ngAfterViewInit(){this.initializeDatepicker()}ngOnDestroy(){this.datePickerInstance&&this.datePickerInstance.destroy()}openOnClick(){this.disabled||this.datePickerInstance.show()}closeOnOutsideClick(a){a.relatedTarget&&this.datePickerInstance.datepickerInstance.calendarContainer.contains(a.relatedTarget)||this.close()}close(){this.datePickerInstance.hide()}isEmpty(){return""===this.currentValue.trim()}get currentValue(){var a;return(null===(a=this.inputElement)||void 0===a?void 0:a.value)||""}get inputElement(){return this.dateInput.nativeElement}}n.\u0275fac=function(a){return new(a||n)(i.Y36(i.zs3),i.Y36(d.B),i.Y36(h.e),i.Y36(i.R0b),i.Y36(i.sBO))},n.\u0275dir=i.lG2({type:n,viewQuery:function(a,m){if(1&a&&i.Gf(r,5),2&a){let v;i.iGM(v=i.CRH())&&(m.dateInput=v.first)}},inputs:{appendTo:"appendTo",classes:"classes",id:"id",name:"name",required:"required",size:"size",disabled:"disabled"},outputs:{canceled:"canceled"},features:[i.qOj]})},81496:(X,I,t)=>{"use strict";t.d(I,{I:()=>d});var i=t(54364),e=t(2316);class d{}d.\u0275fac=function(r){return new(r||d)},d.\u0275mod=e.oAB({type:d}),d.\u0275inj=e.cJS({imports:[[i.ez]]})},14882:(X,I,t)=>{"use strict";t.d(I,{M:()=>v});var i=t(3786),e=t(2281),h=t(95926),r=t(12877),n=t(96617),l=t(51590),a=t(29161),m=t(52377);class v{constructor(p,f,C,u,k){this.injector=p,this.datepickerElemIdentifier=f,this.date=C,this.options=u,this.datepickerTarget=k,this.datepickerFormat="Y-m-d",this.datepickerCont=document.querySelector(this.datepickerElemIdentifier),this.hideDuringScroll=O=>{var y,b;const P=O.target;(null===(y=null==P?void 0:P.classList)||void 0===y?void 0:y.contains("flatpickr-monthDropdown-months"))||(null===(b=null==P?void 0:P.classList)||void 0===b?void 0:b.contains("flatpickr-input"))||(this.datepickerInstance.close(),this.reshowTimeout&&clearTimeout(this.reshowTimeout),this.reshowTimeout=setTimeout(()=>{this.visibleAndActive()&&this.datepickerInstance.open()},50))},this.initialize(u)}initialize(p){this.weekdaysPromise=this.weekdaysService.loadWeekdays().toPromise().then(()=>{this.datepickerInstance&&this.datepickerInstance.redraw()});const f=_.extend({},this.defaultOptions,p);let C;C=this.datepickerTarget?(0,h.Z)(this.datepickerTarget,f):(0,h.Z)(this.datepickerElemIdentifier,f),this.datepickerInstance=Array.isArray(C)?C[0]:C,document.addEventListener("scroll",this.hideDuringScroll,!0)}clear(){this.datepickerInstance.clear()}destroy(){this.hide(),this.datepickerInstance.destroy()}hide(){this.isOpen&&this.datepickerInstance.close(),document.removeEventListener("scroll",this.hideDuringScroll,!0)}show(){this.datepickerInstance.open(),document.addEventListener("scroll",this.hideDuringScroll,!0)}setDates(p){this.datepickerInstance.setDate(p)}get isOpen(){return this.datepickerInstance.isOpen}visibleAndActive(){try{return this.isInViewport(this.datepickerCont)&&document.activeElement===this.datepickerCont}catch(p){return console.error(`Failed to test visibleAndActive ${p}`),!1}}isInViewport(p){const f=p.getBoundingClientRect();return f.top>=0&&f.left>=0&&f.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&f.right<=(window.innerWidth||document.documentElement.clientWidth)}get defaultOptions(){const p=this.configurationService.startOfWeek();return{weekNumbers:!0,getWeek:f=>e(f).format("W"),onDayCreate:(f,C,u,k)=>(0,i.mG)(this,void 0,void 0,function*(){yield this.weekdaysPromise,this.weekdaysService.isNonWorkingDay(k.dateObj)&&k.classList.add("flatpickr-non-working-day")}),dateFormat:this.datepickerFormat,defaultDate:this.date,locale:{weekdays:{shorthand:this.I18n.t("date.abbr_day_names"),longhand:this.I18n.t("date.day_names")},months:{shorthand:this.I18n.t("date.abbr_month_names").slice(1),longhand:this.I18n.t("date.month_names").slice(1)},firstDayOfWeek:p,weekAbbreviation:this.I18n.t("date.abbr_week"),rangeSeparator:` ${l.e} `}}}}(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",r.e)],v.prototype,"configurationService",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",m.u)],v.prototype,"weekdaysService",void 0),(0,i.gn)([(0,a.W)(),(0,i.w6)("design:type",n.D)],v.prototype,"I18n",void 0)},51590:(X,I,t)=>{"use strict";t.d(I,{e:()=>a,r:()=>m});var i=t(33406),e=t(14882),d=t(14279),h=t(93175),r=t(38519),n=t(2316),l=t(54364);const a="-";class m extends d.J{constructor(){super(...arguments),this.changed=new h.R((0,r.J6)(this)),this.initialDates=[],this.initialValue=""}initializeDatepicker(){this.initialDates=this.initialDates||[],this.initialValue=this.resolveDateArrayToString(this.initialDates);const c={allowInput:!0,appendTo:this.appendTo,mode:"range",onChange:(f,C)=>{this.isEmpty()||(this.inputElement.value=C,2===f.length&&this.changed.emit(this.resolveDateStringToArray(C)))},onKeyDown:(f,C,u,k)=>{k.which===i.m.ESCAPE&&this.canceled.emit()}};let p;p=this.isEmpty()&&this.initialDates.length>0?this.initialDates.map(f=>this.timezoneService.parseISODate(f).toDate()):this.resolveDateStringToArray(this.currentValue),this.datePickerInstance=new e.M(this.injector,`#${this.id}`,p,c,null)}onKeyDown(){return!1}resolveDateStringToArray(c){return c.split(` ${a} `).map(p=>p.trim())}resolveDateArrayToString(c){return c.join(` ${a} `)}}m.\u0275fac=function(){let v;return function(p){return(v||(v=n.n5z(m)))(p||m)}}(),m.\u0275cmp=n.Xpm({type:m,selectors:[["op-range-date-picker"]],inputs:{initialDates:"initialDates"},outputs:{changed:"changed"},features:[n.qOj],decls:2,vars:7,consts:[["type","text",3,"id","name","value","ngClass","size","required","disabled","click","keydown.escape","keydown","blur"],["dateInput",""]],template:function(c,p){1&c&&(n.TgZ(0,"input",0,1),n.NdJ("click",function(){return p.openOnClick()})("keydown.escape",function(){return p.close()})("keydown",function(){return p.onKeyDown()})("blur",function(C){return p.closeOnOutsideClick(C)}),n.qZA()),2&c&&n.Q6J("id",p.id)("name",p.name)("value",p.initialValue)("ngClass",p.classes+" op-input")("size",p.size)("required",p.required)("disabled",p.disabled)},directives:[l.mk],encapsulation:2,changeDetection:0})},90547:(X,I,t)=>{"use strict";t.d(I,{S:()=>a});var i=t(33406),e=t(14882),d=t(14279),h=t(93175),r=t(38519),n=t(2316),l=t(54364);class a extends d.J{constructor(){super(...arguments),this.changed=new h.R((0,r.J6)(this)),this.initialDate=""}onInputChange(){this.inputIsValidDate()?this.changed.emit(this.currentValue):this.changed.emit("")}inputIsValidDate(){return null!==/\d{4}-\d{2}-\d{2}/.exec(this.currentValue)}initializeDatepicker(){const v={allowInput:!0,appendTo:this.appendTo,onChange:(p,f)=>{const C=f;this.isEmpty()||(this.inputElement.value=C,this.changed.emit(C))},onKeyDown:(p,f,C,u)=>{u.which===i.m.ESCAPE&&this.canceled.emit()}};let c;c=this.isEmpty()&&this.initialDate?this.timezoneService.parseISODate(this.initialDate).toDate():this.currentValue,this.datePickerInstance=new e.M(this.injector,`#${this.id}`,c,v,null)}}a.\u0275fac=function(){let m;return function(c){return(m||(m=n.n5z(a)))(c||a)}}(),a.\u0275cmp=n.Xpm({type:a,selectors:[["op-single-date-picker"]],inputs:{initialDate:"initialDate"},outputs:{changed:"changed"},features:[n.qOj],decls:2,vars:7,consts:[["type","text",3,"id","name","value","ngClass","size","required","disabled","click","keydown.escape","blur","input"],["dateInput",""]],template:function(v,c){1&v&&(n.TgZ(0,"input",0,1),n.NdJ("click",function(){return c.openOnClick()})("keydown.escape",function(){return c.close()})("blur",function(f){return c.closeOnOutsideClick(f)})("input",function(){return c.onInputChange()}),n.qZA()),2&v&&n.Q6J("id",c.id)("name",c.name)("value",c.initialDate||"")("ngClass",c.classes+" op-input")("size",c.size)("required",c.required)("disabled",c.disabled)},directives:[l.mk],encapsulation:2})},75867:(X,I,t)=>{"use strict";t.d(I,{p:()=>l});var i=t(96617),e=t(70233),d=t(65146),h=t(47775),r=t(96905),n=t(2316);class l{constructor(m,v,c,p,f){this.I18n=m,this.$state=v,this.CurrentProject=c,this.PathHelper=p,this.CurrentUser=f,this.staticQueries=[],this.text={assignee:this.I18n.t("js.work_packages.properties.assignee"),author:this.I18n.t("js.work_packages.properties.author"),created_at:this.I18n.t("js.work_packages.properties.createdAt"),updated_at:this.I18n.t("js.work_packages.properties.updatedAt"),status:this.I18n.t("js.work_packages.properties.status"),work_packages:this.I18n.t("js.label_work_package_plural"),gantt:this.I18n.t("js.timelines.gantt_chart"),latest_activity:this.I18n.t("js.work_packages.default_queries.latest_activity"),created_by_me:this.I18n.t("js.work_packages.default_queries.created_by_me"),assigned_to_me:this.I18n.t("js.work_packages.default_queries.assigned_to_me"),recently_created:this.I18n.t("js.work_packages.default_queries.recently_created"),all_open:this.I18n.t("js.work_packages.default_queries.all_open"),summary:this.I18n.t("js.work_packages.default_queries.summary")},this.staticQueries=this.buildQueries()}getStaticName(m){if(this.$state.params.query_props){const v=JSON.parse(this.$state.params.query_props);delete v.pp,delete v.pa;const c=JSON.stringify(v),p=this.staticQueries.find(f=>{const C=f.uiParams;return C&&C.query_props===c});if(p)return p.title}return 1===m.filters.length&&"status"===m.filters[0].id&&"o"===m.filters[0].operator.id?this.text.all_open:this.text.work_packages}buildQueries(){let m=[{title:this.text.all_open,uiSref:"work-packages",uiParams:{query_id:"",query_props:""},view:"WorkPackagesTable"},{title:this.text.latest_activity,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","subject","type","status","assignee","updatedAt"],"hi":false,"g":"","t":"updatedAt:desc","f":[{"n":"status","o":"o","v":[]}]}'},view:"WorkPackagesTable"},{title:this.text.recently_created,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","subject","type","status","assignee","createdAt"],"hi":false,"g":"","t":"createdAt:desc","f":[{"n":"status","o":"o","v":[]}]}'},view:"WorkPackagesTable"},{title:this.text.gantt,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","type","subject","status","startDate","dueDate","duration"],"tv":true,"tzl":"auto","tll":"{\\"left\\":\\"startDate\\",\\"right\\":\\"dueDate\\",\\"farRight\\":\\"subject\\"}","hi":true,"g":"","t":"startDate:asc","f":[{"n":"status","o":"o","v":[]}]}'},view:"WorkPackagesTable"},{title:this.text.all_open,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","assignee","updatedAt"],"t":"id:desc"}'},view:"Bim"},{title:this.text.latest_activity,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","assignee","updatedAt"],"t":"updatedAt:desc","f":[{"n":"status","o":"o","v":[]}]}'},view:"Bim"},{title:this.text.recently_created,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","assignee","createdAt"],"t":"createdAt:desc","f":[{"n":"status","o":"o","v":[]}]}'},view:"Bim"}];const v=this.CurrentProject.identifier;return v&&(m=[...m,...this.projectDependentQueries(v)]),this.CurrentUser.isLoggedIn&&(m=[...m,...this.userDependentQueries()]),m}getStaticQueriesForView(m){return this.staticQueries.filter(v=>v.view===m)}projectDependentQueries(m){return[{title:this.text.summary,href:`${this.PathHelper.projectWorkPackagesPath(m)}/report`,view:"WorkPackagesTable"}]}userDependentQueries(){return[{title:this.text.created_by_me,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","subject","type","status","assignee","updatedAt"],"hi":false,"g":"","t":"updatedAt:desc,id:asc","f":[{"n":"status","o":"o","v":[]},{"n":"author","o":"=","v":["me"]}]}'},view:"WorkPackagesTable"},{title:this.text.assigned_to_me,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","subject","type","status","author","updatedAt"],"hi":false,"g":"","t":"updatedAt:desc,id:asc","f":[{"n":"status","o":"o","v":[]},{"n":"assigneeOrGroup","o":"=","v":["me"]}]}'},view:"WorkPackagesTable"},{title:this.text.created_by_me,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","assignee","updatedAt"],"t":"id:desc","f":[{"n":"status","o":"o","v":[]},{"n":"author","o":"=","v":["me"]}]}'},view:"Bim"},{title:this.text.assigned_to_me,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","author","updatedAt"],"t":"id:desc","f":[{"n":"status","o":"o","v":[]},{"n":"assigneeOrGroup","o":"=","v":["me"]}]}'},view:"Bim"}]}}l.\u0275fac=function(m){return new(m||l)(n.LFG(i.D),n.LFG(h.StateService),n.LFG(d.R),n.LFG(e.j),n.LFG(r.S))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac})},32782:(X,I,t)=>{"use strict";t.d(I,{C:()=>a});var i=t(70233),e=t(52167),d=t(61908),h=t(10190);function r(m){return m.href?m.href||"":m._links&&m._links.self.href||""}var l=t(2316);class a{constructor(v,c,p){this.pathHelper=v,this.apiV3Service=c,this.colors=p}renderMultiple(v,c,p={hide:!1,link:!1},f={hide:!1,size:"default"},C=!1){v.classList.add("op-principal");const u=document.createElement("span");for(let k=0;k<c.length;k++){const O=document.createElement("span");if(C&&O.classList.add("op-principal--multi-line"),this.render(O,c[k],p,f),u.appendChild(O),!C&&k<c.length-1){const y=document.createElement("span");y.textContent=", ",u.appendChild(y)}}v.appendChild(u)}render(v,c,p={hide:!1,link:!0},f={hide:!1,size:"default"}){v.classList.add("op-principal");const C=function(m){const v=/\/(user|group|placeholder_user|external_user)s\/\d+$/.exec(m);return v?v[1]:null}(r(c));if(!f.hide){const u=this.renderAvatar(c,f,C);v.appendChild(u)}if(!p.hide){const u=this.renderName(c,C,p.link);v.appendChild(u)}}renderAvatar(v,c,p){const f=this.getInitials(v.name),C=this.colors.toHsl(v.name),u=document.createElement("div");return u.classList.add("op-principal--avatar"),u.classList.add("op-avatar"),u.classList.add(`op-avatar_${c.size}`),u.classList.add(`op-avatar_${p.replace("_","-")}`),u.classList.add("op-avatar--fallback"),u.title=v.name,u.textContent=f,"placeholder_user"===p?(u.style.color=C,u.style.borderColor=C):u.style.background=C,"user"===p&&this.renderUserAvatar(v,u,c),u}renderUserAvatar(v,c,p){const f=this.userAvatarUrl(v);if(!f)return;const C=new Image;C.classList.add("op-avatar"),C.classList.add(`op-avatar_${p.size}`),C.src=f,C.title=v.name,C.alt=v.name,C.onload=()=>{c.replaceWith(C),c=void 0}}userAvatarUrl(v){const c=v.id||(0,h.Z)(r(v));return c?this.apiV3Service.users.id(c).avatar.toString():null}renderName(v,c,p=!0){if(p){const C=document.createElement("a");return C.textContent=v.name,C.href=this.principalURL(v,c),C.target="_blank",C.classList.add("op-principal--name"),C}const f=document.createElement("span");return f.textContent=v.name,f.classList.add("op-principal--name"),f}principalURL(v,c){const p=r(v),f=v.id||(p?(0,h.Z)(p):"");switch(c){case"group":return this.pathHelper.groupPath(f);case"placeholder_user":return this.pathHelper.placeholderUserPath(f);case"user":return this.pathHelper.userPath(f);default:throw new Error("Invalid principal type provided")}}getInitials(v){var c,p;const f=[...v],C=v.lastIndexOf(" ");return[null===(c=f[0])||void 0===c?void 0:c.toUpperCase(),null===(p=v[C+1])||void 0===p?void 0:p.toUpperCase()].join("")}}a.\u0275fac=function(v){return new(v||a)(l.LFG(i.j),l.LFG(d.T),l.LFG(e.c))},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})},32824:(X,I,t)=>{"use strict";t.d(I,{j:()=>h});var i=t(54364),e=t(32782),d=t(2316);class h{}h.\u0275fac=function(n){return new(n||h)},h.\u0275mod=d.oAB({type:h}),h.\u0275inj=d.cJS({providers:[e.C],imports:[[i.ez]]})},3742:(X,I,t)=>{"use strict";t.d(I,{y:()=>m,N:()=>v});var i=t(96617),e=t(70233),d=t(61908),h=t(70692),r=t(32782),n=t(45410),l=t(96457),a=t(2316);const m="op-principal";class v{constructor(p,f,C,u,k,O,y){this.elementRef=p,this.PathHelper=f,this.principalRenderer=C,this.principalResourceService=u,this.I18n=k,this.apiV3Service=O,this.timezoneService=y,this.hideAvatar=!1,this.hideName=!1,this.link=!0,this.size="default",(0,n.E)(this)}ngOnInit(){!this.principal.name||this.principalRenderer.render(this.elementRef.nativeElement,this.principal,{hide:this.hideName,link:this.link},{hide:this.hideAvatar,size:this.size})}}v.\u0275fac=function(p){return new(p||v)(a.Y36(a.SBq),a.Y36(e.j),a.Y36(r.C),a.Y36(l.P),a.Y36(i.D),a.Y36(d.T),a.Y36(h.B))},v.\u0275cmp=a.Xpm({type:v,selectors:[["op-principal"]],inputs:{principal:"principal",hideAvatar:"hideAvatar",hideName:"hideName",link:"link",size:"size"},decls:0,vars:0,template:function(p,f){},encapsulation:2,changeDetection:0})},19028:(X,I,t)=>{"use strict";t.d(I,{r:()=>e});const e=(d,h,r,n)=>{const l=n.filter(c=>"urn:openproject-org:api:v3:undisclosed"!==c.href);if(!l.length)return[...r,{id:h.id,name:h.name,href:h._links.self.href,disabled:!1,children:[]}];const a=l[0].href,m=r.find(c=>c.href===a);if(m)return m.children=e(d,h,m.children,l.slice(1)),[...r];const v=d.find(c=>c._links.self.href===a);return v?[...r,{id:v.id,name:v.name,href:v._links.self.href,disabled:!0,children:e(d,h,[],l.slice(1))}]:[...r]}},43882:(X,I,t)=>{"use strict";t.d(I,{P:()=>ce});var i=t(96617),e=t(76491),d=t(61486),h=t(33927),r=t(83720),n=t(80639),l=t(85816),a=t(53466),m=t(92597),v=t(9170),c=t(74647),p=t(20066),f=t(26942),C=t(91923),u=t(65146),k=t(48193),O=t(19028),y=t(75423),b=t(2316),P=t(21090),E=t(54364),T=t(91448),M=t(1707),S=t(87912),R=t(1476),F=t(1706),L=t(70233),D=t(48705),G=t(93713);function V(J,W){if(1&J&&(b.TgZ(0,"span"),b._uU(1),b.qZA()),2&J){const Y=b.oxw(2);b.xp6(1),b.Oqu(Y.text.current_project)}}function K(J,W){if(1&J&&(b.TgZ(0,"span"),b._uU(1),b.qZA()),2&J){const Y=b.oxw(3);b.xp6(1),b.Oqu(Y.text.include_all_selected)}}function q(J,W){if(1&J&&(b.TgZ(0,"span"),b._uU(1),b.qZA()),2&J){const Y=b.oxw(4);b.xp6(1),b.Oqu(Y.text.does_not_match_search)}}function se(J,W){if(1&J&&b.YNc(0,q,2,1,"span",12),2&J){const Y=b.oxw(2).$implicit;b.Q6J("ngIf",Y.disabled)}}function te(J,W){if(1&J&&(b.YNc(0,K,2,1,"span",8),b.YNc(1,se,1,1,"ng-template",null,11,b.W1O)),2&J){const Y=b.MAs(2),$=b.oxw(2);b.Q6J("ngIf",$.includeSubprojects&&$.parentChecked)("ngIfElse",Y)}}function ie(J,W){if(1&J){const Y=b.EpF();b.TgZ(0,"ul",13),b.NdJ("update",function(be){return b.CHM(Y),b.oxw(2).updateList(be)}),b.qZA()}if(2&J){const Y=b.oxw().$implicit,$=b.oxw();b.Q6J("projects",Y.children)("selected",$.selected)("includeSubprojects",$.includeSubprojects)("parentChecked",$.parentChecked||$.isChecked(Y.href))("searchText",$.searchText)}}const le=function(J,W){return{"spot-list--item-action_disabled":J,"spot-list--item-action_active":W}};function oe(J,W){if(1&J){const Y=b.EpF();b.TgZ(0,"li",1),b.TgZ(1,"spot-tooltip",2),b.ynx(2,3),b.TgZ(3,"label",4),b.NdJ("keydown.space",function(){const N=b.CHM(Y).$implicit;return b.oxw().changeSelected(N)}),b.ALo(4,"async"),b.TgZ(5,"spot-checkbox",5),b.NdJ("change",function(){const N=b.CHM(Y).$implicit;return b.oxw().changeSelected(N)}),b.qZA(),b.TgZ(6,"div",6),b._uU(7),b.qZA(),b.qZA(),b.BQk(),b.TgZ(8,"p",7),b.YNc(9,V,2,1,"span",8),b.YNc(10,te,3,2,"ng-template",null,9,b.W1O),b.qZA(),b.qZA(),b.YNc(12,ie,1,5,"ul",10),b.qZA()}if(2&J){const Y=W.$implicit,$=W.first,be=b.MAs(11),N=b.oxw();b.uIk("data-list-selector",N.projectListItemIdentifier),b.xp6(1),b.Q6J("alignment",N.getTooltipAlignment($))("disabled",!Y.disabled)("dark",!0),b.xp6(2),b.Q6J("ngClass",b.WLB(20,le,Y.disabled,b.lcZ(4,18,N.searchableProjectListService.activeItemID$)===Y.id)),b.uIk("data-list-selector",N.projectListActionIdentifier)("data-list-disabled",Y.disabled||void 0),b.xp6(2),b.Q6J("tabindex",-1)("checked",N.isChecked(Y.href)||N.includeSubprojects&&N.parentChecked)("disabled",Y.disabled),b.uIk("data-qa-project-include-id",Y.id)("data-qa-project-include-checked",N.isChecked(Y.href)||N.includeSubprojects&&N.parentChecked?1:0),b.xp6(1),b.Q6J("opSearchHighlight",N.searchText)("title",Y.name),b.xp6(1),b.Oqu(Y.name),b.xp6(2),b.Q6J("ngIf",Y.href===N.currentProjectHref)("ngIfElse",be),b.xp6(3),b.Q6J("ngIf",Y.children.length)}}class ne{constructor(W,Y,$,be){this.I18n=W,this.currentProjectService=Y,this.pathHelper=$,this.searchableProjectListService=be,this.classNameList=!0,this.className=!0,this.update=new b.vpe,this.root=!1,this.projects=[],this.selected=[],this.searchText="",this.includeSubprojects=!1,this.parentChecked=!1,this.text={does_not_match_search:this.I18n.t("js.include_projects.tooltip.does_not_match_search"),include_all_selected:this.I18n.t("js.include_projects.tooltip.include_all_selected"),current_project:this.I18n.t("js.include_projects.tooltip.current_project")}}get currentProjectHref(){return this.currentProjectService.apiv3Path}updateList(W){this.update.emit(W)}isChecked(W){return this.selected.includes(W)}changeSelected(W){if(W.disabled)return;const{href:Y}=W;this.isChecked(Y)?this.updateList(this.selected.filter(be=>be!==Y)):this.updateList([...this.selected,Y])}getTooltipAlignment(W){return this.root&&W?F.Z.BottomLeft:F.Z.TopLeft}extendedProjectUrl(W){const Y=document.querySelector('meta[name="current_menu_item"]'),$=this.pathHelper.projectPath(W);return Y?`${$}?jump=${encodeURIComponent(Y.content)}`:$}}ne.\u0275fac=function(W){return new(W||ne)(b.Y36(i.D),b.Y36(u.R),b.Y36(L.j),b.Y36(k.O))},ne.\u0275cmp=b.Xpm({type:ne,selectors:[["","op-project-include-list",""]],hostVars:6,hostBindings:function(W,Y){2&W&&b.ekj("spot-list",Y.classNameList)("op-project-include-list",Y.className)("op-project-include-list--root",Y.root)},inputs:{root:"root",projects:"projects",selected:"selected",searchText:"searchText",includeSubprojects:"includeSubprojects",parentChecked:"parentChecked"},outputs:{update:"update"},attrs:["op-project-include-list",""],decls:1,vars:1,consts:[["class","spot-list--item op-project-include-list--item","data-qa-selector","op-project-include-list--item",4,"ngFor","ngForOf"],["data-qa-selector","op-project-include-list--item",1,"spot-list--item","op-project-include-list--item"],[1,"op-project-include-list--tooltip","spot-list--item-floating-wrapper",3,"alignment","disabled","dark"],["slot","trigger"],["tabindex","-1",1,"spot-list--item-action","op-project-include-list--item-action",3,"ngClass","keydown.space"],[3,"tabindex","checked","disabled","change"],["data-qa-selector","op-project-include-list--item-title",1,"spot-list--item-title","spot-list--item-title_ellipse-text",3,"opSearchHighlight","title"],["slot","body",1,"spot-body-small"],[4,"ngIf","ngIfElse"],["otherMessages",""],["op-project-include-list","",3,"projects","selected","includeSubprojects","parentChecked","searchText","update",4,"ngIf"],["searchMatch",""],[4,"ngIf"],["op-project-include-list","",3,"projects","selected","includeSubprojects","parentChecked","searchText","update"]],template:function(W,Y){1&W&&b.YNc(0,oe,13,23,"li",0),2&W&&b.Q6J("ngForOf",Y.projects)},directives:[E.sg,D.s,E.mk,R.B,G.U,E.O5,ne],pipes:[E.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}[_nghost-%COMP%], .op-project-include-list[_ngcontent-%COMP%]{flex-shrink:1;flex-basis:100%}.op-project-include-list--root[_nghost-%COMP%], .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]{overflow-y:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.op-project-include-list--root[_nghost-%COMP%]::-webkit-scrollbar, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.op-project-include-list--root[_nghost-%COMP%]::-webkit-scrollbar-track, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.op-project-include-list--root[_nghost-%COMP%]::-webkit-scrollbar-thumb, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.op-project-include-list--root[_nghost-%COMP%]:hover, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.op-project-include-list--root[_nghost-%COMP%]:hover::-webkit-scrollbar-thumb, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}--tooltip[_nghost-%COMP%], .op-project-include-list--tooltip[_ngcontent-%COMP%]{max-width:100%}"],changeDetection:0});var fe=t(58);function ve(J,W){if(1&J&&b._UZ(0,"span",9),2&J){const Y=W.ngIf;b.Q6J("textContent",Y)}}const Se=function(J){return{"spot-list_active":J}};function Oe(J,W){if(1&J){const Y=b.EpF();b.TgZ(0,"ul",24),b.NdJ("update",function(be){b.CHM(Y);return b.oxw(3).selectedProjects=be}),b.ALo(1,"async"),b.qZA()}if(2&J){const Y=b.oxw(2).ngIf,$=b.oxw();b.Q6J("ngClass",b.VKq(8,Se,$.textFieldFocused))("projects",Y)("selected",$.selectedProjects)("includeSubprojects",b.lcZ(1,6,$.includeSubprojects$))("searchText",$.searchableProjectListService.searchText)("root",!0)}}function je(J,W){if(1&J&&(b.TgZ(0,"span",25),b._uU(1),b.qZA()),2&J){const Y=b.oxw(3);b.xp6(1),b.hij(" ",Y.text.no_results," ")}}function tt(J,W){if(1&J&&(b.ynx(0),b.YNc(1,Oe,2,10,"ul",22),b.YNc(2,je,2,1,"ng-template",null,23,b.W1O),b.BQk()),2&J){const Y=b.MAs(3),$=b.oxw().ngIf;b.xp6(1),b.Q6J("ngIf",$.length>0)("ngIfElse",Y)}}const He=function(){return{standalone:!0}};function st(J,W){if(1&J){const Y=b.EpF();b.TgZ(0,"form",10),b.NdJ("submit",function(be){return b.CHM(Y),b.oxw().onSubmit(be)}),b.TgZ(1,"spot-text-field",11),b.NdJ("ngModelChange",function(be){b.CHM(Y);return b.oxw().searchableProjectListService.searchText=be})("keydown",function(be){const Ue=b.CHM(Y).ngIf;return b.oxw().searchableProjectListService.onKeydown(be,Ue)})("inputFocus",function(){b.CHM(Y);return b.oxw().textFieldFocused=!0})("inputBlur",function(){b.CHM(Y);return b.oxw().textFieldFocused=!1}),b._UZ(2,"span",12),b.qZA(),b.YNc(3,tt,4,2,"ng-container",13),b.ALo(4,"async"),b.TgZ(5,"div",14),b.TgZ(6,"div",15),b.TgZ(7,"label",16),b.TgZ(8,"spot-checkbox",17),b.NdJ("ngModelChange",function(be){b.CHM(Y);return b.oxw().includeSubprojects=be}),b.qZA(),b.TgZ(9,"span",18),b._uU(10),b.qZA(),b.qZA(),b.qZA(),b.TgZ(11,"div",19),b.TgZ(12,"button",20),b.NdJ("click",function(){return b.CHM(Y),b.oxw().clearSelection()}),b.ALo(13,"async"),b._uU(14),b.qZA(),b.TgZ(15,"button",21),b.ALo(16,"async"),b._uU(17),b.qZA(),b.qZA(),b.qZA(),b.qZA()}if(2&J){const Y=b.oxw(),$=b.MAs(13);b.xp6(1),b.Q6J("placeholder",Y.text.search_placeholder)("ngModel",Y.searchableProjectListService.searchText)("ngModelOptions",b.DdM(18,He)),b.xp6(2),b.Q6J("ngIf",!1===b.lcZ(4,12,Y.loading$))("ngIfElse",$),b.xp6(5),b.Q6J("ngModel",Y.includeSubprojects)("ngModelOptions",b.DdM(19,He)),b.xp6(2),b.Oqu(Y.text.include_subprojects),b.xp6(2),b.Q6J("disabled",b.lcZ(13,14,Y.loading$)),b.xp6(2),b.hij(" ",Y.text.clear_selection," "),b.xp6(1),b.Q6J("disabled",b.lcZ(16,16,Y.loading$)),b.xp6(2),b.hij(" ",Y.text.apply," ")}}function Me(J,W){1&J&&b._UZ(0,"op-loading-project-list",26)}class ce extends f.N{constructor(W,Y,$,be,N,Ue){super(),this.I18n=W,this.wpTableFilters=Y,this.wpIncludeSubprojects=$,this.halResourceService=be,this.currentProjectService=N,this.searchableProjectListService=Ue,this.className=!0,this.text={toggle_title:this.I18n.t("js.include_projects.toggle_title"),title:this.I18n.t("js.include_projects.title"),filter_all:this.I18n.t("js.include_projects.selected_filter.all"),filter_selected:this.I18n.t("js.include_projects.selected_filter.selected"),search_placeholder:this.I18n.t("js.include_projects.search_placeholder"),clear_selection:this.I18n.t("js.include_projects.clear_selection"),apply:this.I18n.t("js.include_projects.apply"),include_subprojects:this.I18n.t("js.include_projects.include_subprojects"),no_results:this.I18n.t("js.include_projects.no_results")},this.opened=!1,this.textFieldFocused=!1,this.query$=this.wpTableFilters.querySpace.query.values$(),this.displayModeOptions=[{value:"all",title:this.text.filter_all},{value:"selected",title:this.text.filter_selected}],this._displayMode="all",this.displayMode$=new e.X("all"),this._includeSubprojects=!0,this.includeSubprojects$=new e.X(!0),this._selectedProjects=[],this.selectedProjects$=new e.X([]),this.projectsInFilter$=this.wpTableFilters.live$().pipe(this.untilDestroyed(),(0,h.U)(et=>{const Ke=et.find(Ee=>"ProjectQueryFilter"===Ee._type),_e=((null==Ke?void 0:Ke.values)||[]).map(Ee=>Ee.href),ye=this.currentProjectService.apiv3Path;if(_e.includes(ye))return _e;const Pe=[..._e];return ye&&Pe.push(ye),Pe})),this.numberOfProjectsInFilter$=this.projectsInFilter$.pipe((0,h.U)(et=>et.length)),this.projects$=(0,d.aj)([this.searchableProjectListService.allProjects$,this.displayMode$.pipe((0,r.x)()),this.includeSubprojects$.pipe((0,n.b)(20)),this.searchableProjectListService.searchText$.pipe((0,n.b)(200))]).pipe((0,l.zg)(([et,Ke,_e,ye])=>this.selectedProjects$.pipe((0,a.q)(1),(0,h.U)(Pe=>[et,Ke,_e,ye,Pe]))),(0,h.U)(([et,Ke,_e,ye,Pe])=>[et.filter(Ee=>{if(ye.length&&!Ee.name.toLowerCase().includes(ye.toLowerCase()))return!1;if("selected"!==Ke||Pe.includes(Ee._links.self.href))return!0;const Qe=Ee._links.ancestors.reduce((nt,ct)=>nt||Pe.includes(ct.href),!1);return!(!_e||!Qe)}).sort((Ee,Qe)=>Ee._links.ancestors.length-Qe._links.ancestors.length).reduce((Ee,Qe)=>{const{ancestors:nt}=Qe._links;return(0,O.r)(et,Qe,Ee,nt)},[]),_e]),(0,l.zg)(([et,Ke])=>this.selectedProjects$.pipe((0,h.U)(_e=>[et,Ke,_e]))),(0,h.U)(([et,Ke,_e])=>{const ye=(Ee,Qe)=>!(!Ee.disabled&&Ee.href!==this.currentProjectService.apiv3Path)||Ke&&Qe,Pe=(Ee,Qe)=>Object.assign(Object.assign({},Ee),{disabled:ye(Ee,Qe),children:Ee.children.map(nt=>Pe(nt,Qe||_e.includes(Ee.href)))});return et.map(Ee=>Pe(Ee,!1))}),(0,h.U)(et=>(0,y.V)(et)),(0,m.d)()),this.loading$=this.searchableProjectListService.fetchingProjects$.pipe((0,v.h)(et=>et),(0,a.q)(1),(0,l.zg)(()=>this.projects$),(0,l.zg)(()=>this.searchableProjectListService.fetchingProjects$)),this.projects$.pipe(this.untilDestroyed(),(0,v.h)(et=>et.length>0),(0,a.q)(1)).subscribe(et=>{this.searchableProjectListService.resetActiveResult(et)})}get displayMode(){return this._displayMode}set displayMode(W){this._displayMode=W,this.displayMode$.next(W)}get includeSubprojects(){return this._includeSubprojects}set includeSubprojects(W){this._includeSubprojects=W,this.includeSubprojects$.next(W)}get selectedProjects(){return this._selectedProjects}set selectedProjects(W){this._selectedProjects=W,this.selectedProjects$.next(W)}ngOnInit(){this.query$.pipe((0,h.U)(W=>W.includeSubprojects),(0,r.x)()).subscribe(W=>{this.includeSubprojects=W})}toggleIncludeSubprojects(){this.wpIncludeSubprojects.setIncludeSubprojects(!this.wpIncludeSubprojects.current)}toggleOpen(){this.opened=!this.opened,this.opened&&(this.searchableProjectListService.loadAllProjects(),this.projectsInFilter$.pipe((0,a.q)(1)).subscribe(W=>{this.displayMode="all",this.searchableProjectListService.searchText="",this.selectedProjects=W}))}clearSelection(){this.selectedProjects=[this.currentProjectService.apiv3Path||""]}onSubmit(W){W.preventDefault(),this.wpTableFilters.replace("project",Y=>{const $=this.selectedProjects;Y.values=$.map(be=>this.halResourceService.createHalResource({href:be},!0))}),this.wpIncludeSubprojects.update(this.includeSubprojects),this.close()}close(){this.opened=!1}}ce.\u0275fac=function(W){return new(W||ce)(b.Y36(i.D),b.Y36(c.Z),b.Y36(p.F),b.Y36(C.u),b.Y36(u.R),b.Y36(k.O))},ce.\u0275cmp=b.Xpm({type:ce,selectors:[["op-project-include"]],hostVars:2,hostBindings:function(W,Y){2&W&&b.ekj("op-project-include",Y.className)},features:[b._Bn([k.O]),b.qOj],decls:14,vars:12,consts:[["alignment","bottom-right","data-searchable-list-parent","true",1,"op-project-list-modal",3,"open","closed"],["slot","trigger","type","button","data-qa-selector","project-include-button",1,"button",3,"title","click"],["class","badge -secondary",3,"textContent",4,"ngIf"],["slot","body"],[1,"op-project-list-modal--header","op-project-include--header"],[1,"op-project-list-modal--title"],[3,"options","ngModel","ngModelChange"],["class","spot-container op-project-list-modal--body",3,"submit",4,"ngIf"],["loadingTemplate",""],[1,"badge","-secondary",3,"textContent"],[1,"spot-container","op-project-list-modal--body",3,"submit"],["name","project-include-search","data-qa-selector","project-include-search","data-list-focus-catcher-container","true","data-modal-focus-catcher-container","true",3,"placeholder","ngModel","ngModelOptions","ngModelChange","keydown","inputFocus","inputBlur"],["slot","before",1,"spot-icon","spot-icon_search"],[4,"ngIf","ngIfElse"],[1,"spot-action-bar"],[1,"spot-action-bar--left"],[1,"op-project-include--include-all","spot-action-bar--action"],["data-qa-project-include-all-subprojects","1",3,"ngModel","ngModelOptions","ngModelChange"],[1,"op-project-include--include-all-text"],[1,"spot-action-bar--right"],["type","button",1,"button","spot-action-bar--action",3,"disabled","click"],[1,"button","-highlight","spot-action-bar--action",3,"disabled"],["class","op-project-include--list","op-project-include-list","","data-qa-selector","project-include-list","data-list-root","true",3,"ngClass","projects","selected","includeSubprojects","searchText","root","update",4,"ngIf","ngIfElse"],["noResultsTemplate",""],["op-project-include-list","","data-qa-selector","project-include-list","data-list-root","true",1,"op-project-include--list",3,"ngClass","projects","selected","includeSubprojects","searchText","root","update"],[1,"op-project-list-modal--no-results"],["data-qa-selector","op-project-include--loading",1,"op-project-list-modal--loading"]],template:function(W,Y){1&W&&(b.TgZ(0,"spot-drop-modal",0),b.NdJ("closed",function(){return Y.opened=!1}),b.TgZ(1,"button",1),b.NdJ("click",function(){return Y.toggleOpen()}),b._uU(2),b.YNc(3,ve,1,1,"span",2),b.ALo(4,"async"),b.qZA(),b.ynx(5,3),b.TgZ(6,"div",4),b.TgZ(7,"h1",5),b._uU(8),b.qZA(),b.TgZ(9,"spot-toggle",6),b.NdJ("ngModelChange",function(be){return Y.displayMode=be}),b.qZA(),b.qZA(),b.YNc(10,st,18,20,"form",7),b.ALo(11,"async"),b.BQk(),b.YNc(12,Me,1,0,"ng-template",null,8,b.W1O),b.qZA()),2&W&&(b.Q6J("open",Y.opened),b.xp6(1),b.Q6J("title",Y.text.toggle_title),b.xp6(1),b.hij(" ",Y.text.toggle_title," "),b.xp6(1),b.Q6J("ngIf",b.lcZ(4,8,Y.numberOfProjectsInFilter$)),b.xp6(5),b.Oqu(Y.text.title),b.xp6(1),b.Q6J("options",Y.displayModeOptions)("ngModel",Y.displayMode),b.xp6(1),b.Q6J("ngIf",b.lcZ(11,10,Y.projects$)))},directives:[P.m,E.O5,T.v,M.JJ,M.On,M._Y,M.JL,M.F,S.A,R.B,ne,E.mk,fe.a],pipes:[E.Ov],styles:[".op-project-include--include-all[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}.op-project-include--include-all-text[_ngcontent-%COMP%]{padding-top:1px;margin-left:.5rem}.op-project-include--list[_ngcontent-%COMP%]{min-height:7rem}"],changeDetection:0})},75423:(X,I,t)=>{"use strict";t.d(I,{V:()=>i});const i=e=>e.map(d=>Object.assign(Object.assign({},d),{children:i(d.children)})).sort((d,h)=>d.name.localeCompare(h.name))},83609:(X,I,t)=>{"use strict";t.d(I,{d:()=>n});var i=t(2316),e=t(87873),d=t(54364);function h(l,a){if(1&l&&i._UZ(0,"div",1),2&l){const m=i.oxw();i.Q6J("ngClass",m.resizerClass)}}class n{constructor(){this.resizing=!1,this.end=new i.vpe,this.start=new i.vpe,this.move=new i.vpe,this.customHandler=!1,this.cursorClass="nwse-resize",this.resizerClass="resizer"}ngOnDestroy(){this.removeEventListener()}startResize(a){a.preventDefault(),a.stopPropagation(),(1===a.buttons||1===a.which||0===a.which)&&(this.oldX=this.startX=a.clientX||a.pageX||a.touches[0].clientX,this.oldY=this.startY=a.clientY||a.pageY||a.touches[0].clientY,this.newX=a.clientX||a.pageX||a.touches[0].clientX,this.newY=a.clientY||a.pageY||a.touches[0].clientY,this.resizing=!0,this.setResizeCursor(),this.bindEventListener(a),this.start.emit(this.buildDelta(a)))}onMouseUp(a){this.setAutoCursor(),this.removeEventListener(),this.end.emit(this.buildDelta(a))}onMouseMove(a){a.preventDefault(),a.stopPropagation(),this.oldX=this.newX,this.oldY=this.newY,this.newX=a.clientX||a.pageX||a.touches[0].clientX,this.newY=a.clientY||a.pageY||a.touches[0].clientX,this.move.emit(this.buildDelta(a))}bindEventListener(a){this.mouseMoveHandler=this.onMouseMove.bind(this),this.mouseUpHandler=this.onMouseUp.bind(this),window.addEventListener("mousemove",this.mouseMoveHandler),window.addEventListener("touchmove",this.mouseMoveHandler),window.addEventListener("mouseup",this.mouseUpHandler),window.addEventListener("touchend",this.mouseUpHandler)}removeEventListener(){window.removeEventListener("touchmove",this.mouseMoveHandler),window.removeEventListener("mousemove",this.mouseMoveHandler),window.removeEventListener("mouseup",this.mouseUpHandler),window.removeEventListener("touchend",this.mouseUpHandler)}setResizeCursor(){(0,e.h)(this.cursorClass,"important")}setAutoCursor(){(0,e.h)("auto")}buildDelta(a){return{origin:a,absolute:{x:this.newX-this.startX,y:this.newY-this.startY},relative:{x:this.newX-this.oldX,y:this.newY-this.oldX}}}}n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=i.Xpm({type:n,selectors:[["resizer"]],hostBindings:function(a,m){1&a&&i.NdJ("mousedown",function(c){return m.startResize(c)})("touchstart",function(c){return m.startResize(c)})},inputs:{customHandler:"customHandler",cursorClass:"cursorClass",resizerClass:"resizerClass"},outputs:{end:"end",start:"start",move:"move"},ngContentSelectors:["*"],decls:2,vars:1,consts:[[3,"ngClass",4,"ngIf"],[3,"ngClass"]],template:function(a,m){1&a&&(i.F$t(),i.YNc(0,h,1,1,"div",0),i.Hsn(1)),2&a&&i.Q6J("ngIf",!m.customHandler)},directives:[d.O5,d.mk],encapsulation:2})},87947:(X,I,t)=>{"use strict";t.d(I,{H:()=>v});var i=t(83720),e=t(80639),d=t(47775),h=t(1056),r=t(26942),n=t(82516),l=t(83835),a=t(2316),m=t(83609);class v extends r.N{constructor(p,f,C,u){super(),this.toggleService=p,this.elementRef=f,this.$transitions=C,this.browserDetector=u,this.resizeStyle="flexBasis",this.elementMinWidth=530,this.moving=!1,this.resizerClass="work-packages--resizer icon-resizer-vertical-lines"}ngOnInit(){this.resizingElement=document.getElementsByClassName(this.elementClass)[0];const p=this.parseLocalStorageValue();this.elementWidth=p||(this.resizingElement.offsetWidth<this.elementMinWidth?this.elementMinWidth:this.resizingElement.offsetWidth),0===this.elementWidth&&this.resizingElement.parentElement&&(this.elementWidth=this.resizingElement.parentElement.offsetWidth/2),this.resizingElement.style[this.resizeStyle]=`${this.elementWidth}px`,this.element=this.elementRef.nativeElement,this.toggleService.changeData$.pipe((0,i.x)(),this.untilDestroyed(),(0,e.b)(100)).subscribe(()=>{this.applyColumnLayout()}),(0,n.R)(window,"resize",{passive:!0}).pipe(this.untilDestroyed(),(0,e.b)(250)).subscribe(()=>this.applyColumnLayout())}ngAfterViewInit(){this.resizer=this.elementRef.nativeElement.getElementsByClassName(this.resizerClass)[0],this.applyColumnLayout()}ngOnDestroy(){super.ngOnDestroy(),this.resizingElement.style[this.resizeStyle]=""}resizeStart(){const p=this.parseLocalStorageValue(),f=this.resizingElement.offsetWidth;p&&p>f&&(this.elementWidth=f)}resizeEnd(){const p=this.parseLocalStorageValue();p&&(this.elementWidth=p);const f=new Event(this.resizeEvent);window.dispatchEvent(f),this.manageErrorClass(!1)}resizeMove(p){let f;this.elementWidth-=p.relative.x,this.elementWidth<this.elementMinWidth?(f=this.elementMinWidth,this.manageErrorClass(!0)):(f=this.elementWidth,this.manageErrorClass(!1)),window.OpenProject.guardedLocalStorage(this.localStorageKey,`${f}`),this.applyColumnLayout(),this.resizingElement.style[this.resizeStyle]=`${f}px`}parseLocalStorageValue(){const p=window.OpenProject.guardedLocalStorage(this.localStorageKey),f=parseInt(p||"",10);if("number"==typeof f&&NaN!==f)return f}applyColumnLayout(p=750){const f=document.querySelectorAll("[data-selector='wp-single-view']")[0];f&&jQuery(f).toggleClass("work-package--single-view_with-columns",f.offsetWidth>p)}manageErrorClass(p){p&&!this.resizer.classList.contains("-error-font")&&this.resizer.classList.add("-error-font"),!p&&this.resizer.classList.contains("-error-font")&&this.resizer.classList.remove("-error-font")}}v.\u0275fac=function(p){return new(p||v)(a.Y36(l.J),a.Y36(a.SBq),a.Y36(d.TransitionService),a.Y36(h.o))},v.\u0275cmp=a.Xpm({type:v,selectors:[["wp-resizer"]],inputs:{elementClass:"elementClass",resizeEvent:"resizeEvent",localStorageKey:"localStorageKey",resizeStyle:"resizeStyle"},features:[a.qOj],decls:1,vars:2,consts:[["cursorClass","col-resize",3,"customHandler","resizerClass","end","start","move"]],template:function(p,f){1&p&&(a.TgZ(0,"resizer",0),a.NdJ("end",function(){return f.resizeEnd()})("start",function(){return f.resizeStart()})("move",function(u){return f.resizeMove(u)}),a.qZA()),2&p&&a.Q6J("customHandler",!1)("resizerClass",f.resizerClass)},directives:[m.d],encapsulation:2,changeDetection:0})},58:(X,I,t)=>{"use strict";t.d(I,{a:()=>d});var i=t(2316),e=t(70099);class d{}d.\u0275fac=function(r){return new(r||d)},d.\u0275cmp=i.Xpm({type:d,selectors:[["op-loading-project-list"]],decls:10,vars:0,consts:[["viewBox","0 0 200 140"],["x","0","width","100%","height","12","rx","1"],["x","10","y","16","width","100%","height","12","rx","1"],["x","10","y","32","width","100%","height","12","rx","1"],["x","20","y","48","width","100%","height","12","rx","1"],["x","20","y","64","width","100%","height","12","rx","1"],["x","0","y","80","width","100%","height","12","rx","1"],["x","10","y","96","width","100%","height","12","rx","1"],["x","10","y","112","width","100%","height","12","rx","1"],["x","0","y","128","width","100%","height","12","rx","1"]],template:function(r,n){1&r&&(i.TgZ(0,"op-content-loader",0),i.O4$(),i._UZ(1,"rect",1),i._UZ(2,"rect",2),i._UZ(3,"rect",3),i._UZ(4,"rect",4),i._UZ(5,"rect",5),i._UZ(6,"rect",6),i._UZ(7,"rect",7),i._UZ(8,"rect",8),i._UZ(9,"rect",9),i.qZA())},directives:[e.V],encapsulation:2,changeDetection:0})},48193:(X,I,t)=>{"use strict";t.d(I,{O:()=>v});var i=t(73726),e=t(76491),d=t(23237),h=t(71435),r=t(53466),n=t(61908),l=t(33406),a=t(2316),m=t(53882);class v{constructor(p,f){this.http=p,this.apiV3Service=f,this._searchText="",this.activeItemID$=new e.X(null),this.searchText$=new e.X(""),this.allProjects$=new e.X([]),this.fetchingProjects$=new e.X(!1)}get searchText(){return this._searchText}set searchText(p){this._searchText=p,this.searchText$.next(p)}loadAllProjects(){this.fetchingProjects$.next(!0),(0,d.rP)(p=>{const f=(0,i.g)(Object.assign(Object.assign({},this.params),p));return this.http.get(this.apiV3Service.projects.path+f)}).pipe((0,h.x)(()=>this.fetchingProjects$.next(!1))).subscribe(p=>{this.allProjects$.next(p)})}get params(){return{filters:[["active","=",["t"]]],pageSize:-1,select:["elements/id","elements/name","elements/identifier","elements/self","elements/ancestors","total","count","pageSize"]}}onKeydown(p,f){this.activeItemID$.pipe((0,r.q)(1)).subscribe(C=>{switch(p.keyCode){case l.m.UP_ARROW:p.preventDefault(),this.selectPreviousResult(C,f);break;case l.m.DOWN_ARROW:p.preventDefault(),this.selectNextResult(C,f);break;case l.m.ENTER:p.stopPropagation(),p.preventDefault(),this.activateSelectedResult(p)}})}resetActiveResult(p){const f=C=>{for(let u=0;u<C.length;u++){if(!C[u].disabled)return C[u].id;const k=f(C[u].children);if(null!==k)return k}return null};this.activeItemID$.next(f(p))}selectPreviousResult(p,f){if(null===p)return;const C=O=>{var y;return(null===(y=null==O?void 0:O.children)||void 0===y?void 0:y.length)?C(O.children[O.children.length-1]):O},u=(O,y,b)=>{for(let P=0;P<y.length;P++){if(y[P].id===O){const T=C(y[P-1])||y[P-1]||b;return T?T.disabled?u(T.id,f):T.id:null}const E=u(O,y[P].children,y[P]);if(null!==E)return E}return null},k=u(p,f);null!==k?this.activeItemID$.next(k):this.resetActiveResult(f)}selectNextResult(p,f){if(null===p)return;const C=(k,O,y)=>{for(let b=0;b<O.length;b++){if(O[b].id===k){const E=O[b].children[0]||O[b+1]||y;return E?E.disabled?C(E.id,f):E.id:null}const P=C(k,O[b].children,O[b+1]||y);if(null!==P)return P}return null},u=C(p,f);null!==u?this.activeItemID$.next(u):this.resetActiveResult(f)}activateSelectedResult(p){var f,C;const u=y=>y?"searchableListParent"in y.dataset?y:u(y.parentElement):null,k=u(p.currentTarget),O=document.activeElement;null===(f=null==k?void 0:k.querySelector(".spot-list--item-action_active"))||void 0===f||f.click(),null===(C=O)||void 0===C||C.focus()}}v.\u0275fac=function(p){return new(p||v)(a.LFG(m.eN),a.LFG(n.T))},v.\u0275prov=a.Yz7({token:v,factory:v.\u0275fac})},14359:(X,I,t)=>{"use strict";t.d(I,{M:()=>i});class i{constructor(d,h,r){this.page=d,this.total=h,this.perPage=r}getLowerPageBound(){return this.perPage*(this.page-1)+1}getUpperPageBound(d){return Math.min(this.perPage*this.page,d)}nextPage(){this.page+=1}previousPage(){this.page-=1}}},68853:(X,I,t)=>{"use strict";t.d(I,{N:()=>h});var i=t(12877),e=t(2316);const d_maxVisiblePageOptions=6,d_optionsTruncationSize=1;class h{constructor(n){this.configuration=n,this.loadPaginationOptions()}getCachedPerPage(n){const l=this.localStoragePerPage,a=(null==n?void 0:n.length)||0;return null!==l&&l>0&&(0===a||-1!==(null==n?void 0:n.indexOf(l)))?l:a>0?n[0]:20}get localStoragePerPage(){const n=window.OpenProject.guardedLocalStorage("pagination.perPage");return void 0!==n?parseInt(n,10):null}getPaginationOptions(){return this.paginationOptions}get isPerPageKnown(){return!(!this.localStoragePerPage&&!this.paginationOptions)}getPerPage(){return this.localStoragePerPage||this.paginationOptions.perPage}getMaxVisiblePageOptions(){return _.get(this.paginationOptions,"maxVisiblePageOptions",d_maxVisiblePageOptions)}getOptionsTruncationSize(){return _.get(this.paginationOptions,"optionsTruncationSize",d_optionsTruncationSize)}setPerPage(n){window.OpenProject.guardedLocalStorage("pagination.perPage",n.toString()),this.paginationOptions.perPage=n}getPerPageOptions(){return this.paginationOptions.perPageOptions}setPerPageOptions(n){this.paginationOptions.perPageOptions=n}loadPaginationOptions(){return this.configuration.initialized.then(()=>(this.paginationOptions={perPage:this.getCachedPerPage(this.configuration.perPageOptions),perPageOptions:this.configuration.perPageOptions,maxVisiblePageOptions:d_maxVisiblePageOptions,optionsTruncationSize:d_optionsTruncationSize},this.paginationOptions))}}h.\u0275fac=function(n){return new(n||h)(e.LFG(i.e))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac})},5282:(X,I,t)=>{"use strict";t.d(I,{l:()=>l});var i=t(54364),e=t(84906),d=t(63415),h=t(71858),r=t(53875),n=t(2316);class l{}l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=n.oAB({type:l}),l.\u0275inj=n.cJS({imports:[[i.ez,d.J,r.Q,h.a,e.UIRouterModule]]})},90590:(X,I,t)=>{"use strict";t.d(I,{P:()=>b});var i=t(2316),e=t(43682),d=t(47775),h=t(54364),r=t(84906),n=t(54471);const l=["scrollContainer"],a=["scrollPane"],m=["scrollRightBtn"],v=["scrollLeftBtn"];function c(P,E){if(1&P){const T=i.EpF();i.TgZ(0,"a",16),i.NdJ("click",function(S){i.CHM(T);const R=i.oxw().$implicit;return i.oxw().clickTab(R,S)}),i.qZA()}if(2&P){const T=i.oxw().$implicit,M=i.oxw();i.ekj("op-tab-row--link_selected",T.id===M.currentTabId)("op-tab-row--link_disabled",void 0!==T.disable),i.Q6J("href",T.path,i.LSH)("textContent",T.name),i.uIk("title",M.tabTitle(T))}}function p(P,E){if(1&P&&(i._UZ(0,"op-tab-count",21),i.ALo(1,"async")),2&P){const T=i.oxw(2).$implicit,M=i.oxw();i.Q6J("count",i.lcZ(1,2,T.counter(M.injector))),i.uIk("data-qa-selector","tab-counter-"+T.name)}}function f(P,E){if(1&P&&(i.TgZ(0,"span",23),i._uU(1),i.qZA()),2&P){const T=i.oxw().ngIf;i.xp6(1),i.hij(" (",T,")")}}function C(P,E){if(1&P&&(i.ynx(0),i.YNc(1,f,2,1,"span",22),i.BQk()),2&P){const T=E.ngIf,M=i.oxw(2).$implicit;i.xp6(1),i.Q6J("ngIf",T>0&&!M.showCountAsBubble)}}function u(P,E){if(1&P){const T=i.EpF();i.TgZ(0,"a",17),i.NdJ("click",function(S){i.CHM(T);const R=i.oxw().$implicit;return i.oxw().clickTab(R,S)}),i._UZ(1,"span",18),i.YNc(2,p,2,4,"op-tab-count",19),i.YNc(3,C,2,1,"ng-container",20),i.ALo(4,"async"),i.qZA()}if(2&P){const T=i.oxw().$implicit,M=i.oxw();i.ekj("op-tab-row--link_disabled",void 0!==T.disable),i.Q6J("uiSref",T.route)("uiParams",T.routeParams),i.uIk("title",M.tabTitle(T)),i.xp6(1),i.Q6J("textContent",T.name),i.xp6(1),i.Q6J("ngIf",T.counter&&T.showCountAsBubble),i.xp6(1),i.Q6J("ngIf",i.lcZ(4,8,T.counter(M.injector)))}}function k(P,E){if(1&P){const T=i.EpF();i.TgZ(0,"li",13),i.NdJ("dragenter",function(){const R=i.CHM(T).$implicit;return i.oxw().startDebouncedTabActivation(R)})("dragleave",function(){return i.CHM(T),i.oxw().cancelDebouncedTabActivation()}),i.YNc(1,c,1,7,"a",14),i.YNc(2,u,5,10,"a",15),i.qZA()}if(2&P){const T=E.$implicit,M=i.oxw();i.uIk("data-tab-id",T.id)("data-qa-tab-id",T.id)("data-qa-tab-selected",T.id===M.currentTabId||void 0)("data-qa-tab-disabled",T.disable||void 0),i.xp6(1),i.Q6J("ngIf",!T.route),i.xp6(1),i.Q6J("ngIf",T.route)}}const O=[[["","slot","actions"]]];class b{constructor(E,T,M){this.$state=E,this.cdRef=T,this.injector=M,this.currentTabId=null,this.tabs=[],this.classes=[],this.hideLeftButton=!0,this.hideRightButton=!0,this.tabSelected=new i.vpe,this.trackById=(0,e.AT)("id"),this.dragTargetStack=0}ngAfterViewInit(){this.container=this.scrollContainer.nativeElement,this.pane=this.scrollPane.nativeElement,this.updateScrollableArea()}ngOnChanges(E){this.pane&&this.updateScrollableArea()}updateScrollableArea(){this.determineScrollButtonVisibility(),null!=this.currentTabId&&this.scrollIntoVisibleArea(this.currentTabId)}clickTab(E,T){this.currentTabId=E.id,this.tabSelected.emit(E),E.path||T.preventDefault()}startDebouncedTabActivation(E){this.dragTargetStack+=1,null!==this.debouncedTabActivationTimeout&&this.clearDebouncedTabActivation(),this.debouncedTabActivationTimeout=setTimeout(()=>{this.currentTabId=E.id,this.tabSelected.emit(E);const T=this.$state.includes("**.details.*")?this.$state.$current.name:E.route;T&&this.$state.go(T,E.routeParams),this.debouncedTabActivationTimeout=null},300)}cancelDebouncedTabActivation(){this.dragTargetStack-=1,0===this.dragTargetStack&&this.clearDebouncedTabActivation()}clearDebouncedTabActivation(){null!==this.debouncedTabActivationTimeout&&(clearTimeout(this.debouncedTabActivationTimeout),this.debouncedTabActivationTimeout=null)}onScroll(){this.determineScrollButtonVisibility()}determineScrollButtonVisibility(){this.hideLeftButton=this.pane.scrollLeft<=0,this.hideRightButton=this.pane.scrollWidth-this.pane.scrollLeft<=this.container.clientWidth,this.cdRef.detectChanges()}scrollRight(){this.pane.scrollLeft+=this.container.clientWidth}scrollLeft(){this.pane.scrollLeft-=this.container.clientWidth}tabTitle(E){return"string"==typeof E.disable?E.disable:E.name}scrollIntoVisibleArea(E){const T=jQuery(this.pane).find(`[data-tab-id=${E}]`),S=T.position().left+Number(T.outerWidth());this.pane.scrollLeft+this.container.clientWidth<S&&(this.pane.scrollLeft=S-this.container.clientWidth+40)}}b.\u0275fac=function(E){return new(E||b)(i.Y36(d.StateService),i.Y36(i.sBO),i.Y36(i.zs3))},b.\u0275cmp=i.Xpm({type:b,selectors:[["op-scrollable-tabs"]],viewQuery:function(E,T){if(1&E&&(i.Gf(l,7),i.Gf(a,7),i.Gf(m,7),i.Gf(v,7)),2&E){let M;i.iGM(M=i.CRH())&&(T.scrollContainer=M.first),i.iGM(M=i.CRH())&&(T.scrollPane=M.first),i.iGM(M=i.CRH())&&(T.scrollRightBtn=M.first),i.iGM(M=i.CRH())&&(T.scrollLeftBtn=M.first)}},inputs:{currentTabId:"currentTabId",tabs:"tabs",classes:"classes",hideLeftButton:"hideLeftButton",hideRightButton:"hideRightButton"},outputs:{tabSelected:"tabSelected"},features:[i.TTD],ngContentSelectors:["[slot=actions]"],decls:14,vars:5,consts:[[1,"op-scrollable-tabs",3,"ngClass"],[1,"op-scrollable-tabs--tab-container"],["scrollContainer",""],[1,"op-tab-row",3,"scroll"],["scrollPane",""],["class","op-tab-row--tab",3,"dragenter","dragleave",4,"ngFor","ngForOf","ngForTrackBy"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_left",3,"hidden","click"],["scrollLeftBtn",""],[1,"icon-arrow-left2"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_right",3,"hidden","click"],["scrollRightBtn",""],[1,"icon-arrow-right2"],[1,"op-scrollable-tabs--actions"],[1,"op-tab-row--tab",3,"dragenter","dragleave"],["class","op-tab-row--link",3,"href","op-tab-row--link_selected","op-tab-row--link_disabled","textContent","click",4,"ngIf"],["class","op-tab-row--link","uiSrefActive","op-tab-row--link_selected","href","","role","button",3,"uiSref","uiParams","op-tab-row--link_disabled","click",4,"ngIf"],[1,"op-tab-row--link",3,"href","textContent","click"],["uiSrefActive","op-tab-row--link_selected","href","","role","button",1,"op-tab-row--link",3,"uiSref","uiParams","click"],[3,"textContent"],[3,"count",4,"ngIf"],[4,"ngIf"],[3,"count"],["data-qa-selector","tab-count",4,"ngIf"],["data-qa-selector","tab-count"]],template:function(E,T){1&E&&(i.F$t(O),i.TgZ(0,"div",0),i.TgZ(1,"div",1,2),i.TgZ(3,"ul",3,4),i.NdJ("scroll",function(){return T.onScroll()}),i.YNc(5,k,3,6,"li",5),i.qZA(),i.TgZ(6,"div",6,7),i.NdJ("click",function(){return T.scrollLeft()}),i._UZ(8,"span",8),i.qZA(),i.TgZ(9,"div",9,10),i.NdJ("click",function(){return T.scrollRight()}),i._UZ(11,"span",11),i.qZA(),i.qZA(),i.TgZ(12,"ul",12),i.Hsn(13),i.qZA(),i.qZA()),2&E&&(i.Q6J("ngClass",T.classes),i.xp6(5),i.Q6J("ngForOf",T.tabs)("ngForTrackBy",T.trackById),i.xp6(1),i.Q6J("hidden",T.hideLeftButton),i.xp6(3),i.Q6J("hidden",T.hideRightButton))},directives:[h.mk,h.sg,h.O5,r.AnchorUISref,r.UISrefActive,r.UISrefStatus,r.UISref,n.x],pipes:[h.Ov],styles:[".op-tab-row--link[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{pointer-events:none}"],changeDetection:0})},54471:(X,I,t)=>{"use strict";t.d(I,{x:()=>r});var i=t(2316),e=t(54364);function d(n,l){if(1&n&&i._UZ(0,"span",2),2&n){const a=i.oxw(2);i.Q6J("textContent",a.count)}}function h(n,l){if(1&n&&(i.ynx(0),i.YNc(1,d,1,1,"span",1),i.BQk()),2&n){const a=i.oxw();i.xp6(1),i.Q6J("ngIf",a.count>0)}}class r{}r.\u0275fac=function(l){return new(l||r)},r.\u0275cmp=i.Xpm({type:r,selectors:[["op-tab-count"]],inputs:{count:"count"},decls:1,vars:1,consts:[[4,"ngIf"],["class","op-tab-count",3,"textContent",4,"ngIf"],[1,"op-tab-count",3,"textContent"]],template:function(l,a){1&l&&i.YNc(0,h,2,1,"ng-container",0),2&l&&i.Q6J("ngIf",a.count)},directives:[e.O5],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-tab-count[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center;box-sizing:content-box;height:16px;line-height:16px;width:16px;border-radius:.5rem;padding:0 .15rem;font-size:.7rem;font-weight:bold;background:#00A3FF;color:#fff;flex-shrink:0;margin-left:5px;vertical-align:text-bottom}"],changeDetection:0})},46709:(X,I,t)=>{"use strict";t.d(I,{f:()=>k});var i=t(77355),e=t(91923),d=t(96617),h=t(53466),r=t(12703),n=t(58021),l=t(2316),a=t(81301),m=t(54364);function v(O,y){if(1&O){const b=l.EpF();l.TgZ(0,"button",14),l.NdJ("click",function(){return l.CHM(b),l.oxw().destroy()}),l.qZA()}if(2&O){const b=l.oxw();l.Q6J("textContent",b.text.delete),l.uIk("title",b.text.delete)}}function c(O,y){if(1&O){const b=l.EpF();l.TgZ(0,"button",15),l.NdJ("click",function(E){return l.CHM(b),l.oxw().closeMe(E)}),l.qZA()}if(2&O){const b=l.oxw();l.Q6J("textContent",b.text.cancel),l.uIk("title",b.text.cancel)}}function p(O,y){if(1&O){const b=l.EpF();l.TgZ(0,"button",16),l.NdJ("click",function(){return l.CHM(b),l.oxw().saveEntry()}),l.qZA()}if(2&O){const b=l.oxw();l.Q6J("textContent",b.text.save)("disabled",b.formInFlight),l.uIk("title",b.text.save)}}class f extends n.G{get deleteAllowed(){return!1}setModifiedEntry(y){this.createdEntry=y.savedResource,this.reloadWorkPackageAndClose()}}f.\u0275fac=function(){let O;return function(b){return(O||(O=l.n5z(f)))(b||f)}}(),f.\u0275cmp=l.Xpm({type:f,selectors:[["ng-component"]],features:[l._Bn([r.l]),l.qOj],decls:14,vars:7,consts:[["data-indicator-name","modal",1,"spot-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-icon","spot-icon_time"],[3,"textContent"],[1,"spot-divider"],[1,"ngdialog-body","spot-modal--body","spot-container"],[3,"changeset","showWorkPackageField","showUserField","modifiedEntry"],["editForm",""],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["class","button button_no-margin -danger spot-action-bar--action",3,"textContent","click",4,"ngIf"],[1,"spot-action-bar--right"],["class","button button_no-margin spot-action-bar--action",3,"textContent","click",4,"ngIf"],["class","button -highlight button_no-margin spot-action-bar--action",3,"textContent","disabled","click",4,"ngIf"],[1,"button","button_no-margin","-danger","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],[1,"button","-highlight","button_no-margin","spot-action-bar--action",3,"textContent","disabled","click"]],template:function(y,b){1&y&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l._UZ(2,"span",2),l._UZ(3,"span",3),l.qZA(),l._UZ(4,"div",4),l.TgZ(5,"div",5),l.TgZ(6,"te-form",6,7),l.NdJ("modifiedEntry",function(E){return b.setModifiedEntry(E)}),l.qZA(),l.qZA(),l.TgZ(8,"div",8),l.TgZ(9,"div",9),l.YNc(10,v,1,2,"button",10),l.qZA(),l.TgZ(11,"div",11),l.YNc(12,c,1,2,"button",12),l.YNc(13,p,1,3,"button",13),l.qZA(),l.qZA(),l.qZA()),2&y&&(l.xp6(3),l.Q6J("textContent",b.text.title),l.xp6(3),l.Q6J("changeset",b.changeset)("showWorkPackageField",b.showWorkPackageField)("showUserField",b.showUserField),l.xp6(4),l.Q6J("ngIf",b.deleteAllowed),l.xp6(2),l.Q6J("ngIf",b.saveAllowed),l.xp6(1),l.Q6J("ngIf",b.saveAllowed))},directives:[a.y,m.O5],encapsulation:2,changeDetection:0});var C=t(61908),u=t(44022);class k{constructor(y,b,P,E,T,M,S){this.opModalService=y,this.injector=b,this.halResource=P,this.apiV3Service=E,this.schemaCache=T,this.halEditing=M,this.i18n=S}create(y,b,P={}){return new Promise((E,T)=>{this.createNewTimeEntry(y,b).then(M=>{const S=this.opModalService.show(f,this.injector,Object.assign(Object.assign({},P),{changeset:M}));S.closingEvent.pipe((0,h.q)(1)).subscribe(()=>{S.createdEntry?E({entry:S.createdEntry,action:"create"}):T()})})})}createNewTimeEntry(y,b){const P={spentOn:y.format("YYYY-MM-DD")};return b&&(P._links={workPackage:{href:b.href}}),this.apiV3Service.time_entries.form.post(P).toPromise().then(E=>this.fromCreateForm(E))}fromCreateForm(y){const b=this.initializeNewResource(y);return this.halEditing.edit(b,y)}initializeNewResource(y){const b=this.halResource.createHalResourceOfType("TimeEntry",y.payload.$plain());return b.$links.schema={href:"new"},b._type="TimeEntry",b.id="new",b.hours="PT1H",b.update=b.$links.update=y.$links.self,b.updateImmediately=b.$links.updateImmediately=P=>this.apiV3Service.time_entries.post(P).toPromise(),b.state.putValue(b),this.schemaCache.update(b,y.schema),b}}k.\u0275fac=function(y){return new(y||k)(l.LFG(i.S),l.LFG(l.zs3),l.LFG(e.u),l.LFG(C.T),l.LFG(u.y),l.LFG(r.l),l.LFG(d.D))},k.\u0275prov=l.Yz7({token:k,factory:k.\u0275fac})},72388:(X,I,t)=>{"use strict";t.d(I,{d:()=>u});var i=t(77355),e=t(91923),d=t(96617),h=t(53466),r=t(12703),n=t(61908),l=t(58021),a=t(2316),m=t(81301),v=t(54364);function c(k,O){if(1&k){const y=a.EpF();a.TgZ(0,"button",14),a.NdJ("click",function(){return a.CHM(y),a.oxw().destroy()}),a.qZA()}if(2&k){const y=a.oxw();a.Q6J("textContent",y.text.delete),a.uIk("title",y.text.delete)}}function p(k,O){if(1&k){const y=a.EpF();a.TgZ(0,"button",15),a.NdJ("click",function(P){return a.CHM(y),a.oxw().closeMe(P)}),a.qZA()}if(2&k){const y=a.oxw();a.Q6J("textContent",y.text.cancel),a.uIk("title",y.text.cancel)}}function f(k,O){if(1&k){const y=a.EpF();a.TgZ(0,"button",16),a.NdJ("click",function(){return a.CHM(y),a.oxw().saveEntry()}),a.qZA()}if(2&k){const y=a.oxw();a.Q6J("textContent",y.text.save)("disabled",y.formInFlight),a.uIk("title",y.text.save)}}class C extends l.G{setModifiedEntry(O){this.modifiedEntry=O.savedResource,this.reloadWorkPackageAndClose()}get saveAllowed(){return!!this.entry.update}get deleteAllowed(){return!!this.entry.delete}destroy(){!window.confirm(this.text.areYouSure)||(this.destroyedEntry=this.entry,this.service.close())}}C.\u0275fac=function(){let k;return function(y){return(k||(k=a.n5z(C)))(y||C)}}(),C.\u0275cmp=a.Xpm({type:C,selectors:[["ng-component"]],features:[a._Bn([r.l]),a.qOj],decls:14,vars:7,consts:[["data-indicator-name","modal",1,"spot-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-icon","spot-icon_time"],[3,"textContent"],[1,"spot-divider"],[1,"ngdialog-body","spot-modal--body","spot-container"],[3,"changeset","showWorkPackageField","showUserField","modifiedEntry"],["editForm",""],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["class","button button_no-margin -danger spot-action-bar--action",3,"textContent","click",4,"ngIf"],[1,"spot-action-bar--right"],["class","button button_no-margin spot-action-bar--action",3,"textContent","click",4,"ngIf"],["class","button -highlight button_no-margin spot-action-bar--action",3,"textContent","disabled","click",4,"ngIf"],[1,"button","button_no-margin","-danger","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],[1,"button","-highlight","button_no-margin","spot-action-bar--action",3,"textContent","disabled","click"]],template:function(O,y){1&O&&(a.TgZ(0,"div",0),a.TgZ(1,"div",1),a._UZ(2,"span",2),a._UZ(3,"span",3),a.qZA(),a._UZ(4,"div",4),a.TgZ(5,"div",5),a.TgZ(6,"te-form",6,7),a.NdJ("modifiedEntry",function(P){return y.setModifiedEntry(P)}),a.qZA(),a.qZA(),a.TgZ(8,"div",8),a.TgZ(9,"div",9),a.YNc(10,c,1,2,"button",10),a.qZA(),a.TgZ(11,"div",11),a.YNc(12,p,1,2,"button",12),a.YNc(13,f,1,3,"button",13),a.qZA(),a.qZA(),a.qZA()),2&O&&(a.xp6(3),a.Q6J("textContent",y.text.title),a.xp6(3),a.Q6J("changeset",y.changeset)("showWorkPackageField",y.showWorkPackageField)("showUserField",y.showUserField),a.xp6(4),a.Q6J("ngIf",y.deleteAllowed),a.xp6(2),a.Q6J("ngIf",y.saveAllowed),a.xp6(1),a.Q6J("ngIf",y.saveAllowed))},directives:[m.y,v.O5],encapsulation:2,changeDetection:0});class u{constructor(O,y,b,P,E,T){this.opModalService=O,this.injector=y,this.apiV3Service=b,this.halResource=P,this.halEditing=E,this.i18n=T}edit(O,y={}){return new Promise((b,P)=>{this.createChangeset(O).then(E=>{const T=this.opModalService.show(C,this.injector,Object.assign(Object.assign({},y),{changeset:E}));T.closingEvent.pipe((0,h.q)(1)).subscribe(()=>{T.destroyedEntry?T.destroyedEntry.delete().then(()=>{b({entry:T.destroyedEntry,action:"destroy"})}):T.modifiedEntry?b({entry:T.modifiedEntry,action:"update"}):P()})})})}createChangeset(O){return this.apiV3Service.time_entries.id(O).form.post(O).toPromise().then(y=>this.halEditing.edit(O,y))}}u.\u0275fac=function(O){return new(O||u)(a.LFG(i.S),a.LFG(a.zs3),a.LFG(n.T),a.LFG(e.u),a.LFG(r.l),a.LFG(d.D))},u.\u0275prov=a.Yz7({token:u,factory:u.\u0275fac})},81301:(X,I,t)=>{"use strict";t.d(I,{y:()=>k});var i=t(12703),e=t(96617),d=t(2316),h=t(61342),r=t(26942),l=(t(94232),t(54364)),a=t(54262);const m=["editForm"],v=function(O){return{"-required":O}};function c(O,y){if(1&O&&(d.ynx(0),d._UZ(1,"div",4),d.TgZ(2,"div",5),d._UZ(3,"op-editable-attribute-field",6),d.qZA(),d.BQk()),2&O){const b=d.oxw();d.xp6(1),d.Q6J("ngClass",d.VKq(5,v,b.isRequired("user")))("textContent",b.schema.user.name),d.xp6(2),d.Q6J("resource",b.entry)("wrapperClasses","-tiny")("fieldName","user")}}function p(O,y){if(1&O&&(d.ynx(0),d._UZ(1,"div",4),d.TgZ(2,"div",5),d._UZ(3,"op-editable-attribute-field",9),d.qZA(),d.BQk()),2&O){const b=d.oxw();d.xp6(1),d.Q6J("ngClass",d.VKq(4,v,b.isRequired("workPackage")))("textContent",b.schema.workPackage.name),d.xp6(2),d.Q6J("resource",b.entry)("fieldName","workPackage")}}function f(O,y){if(1&O&&d._UZ(0,"op-editable-attribute-field",9),2&O){const b=d.oxw();d.Q6J("resource",b.entry)("fieldName","activity")}}function C(O,y){if(1&O&&d._UZ(0,"i",11),2&O){const b=d.oxw();d.Q6J("textContent",b.text.wpRequired)}}function u(O,y){if(1&O&&(d.ynx(0),d._UZ(1,"div",4),d.TgZ(2,"div",5),d._UZ(3,"op-editable-attribute-field",9),d.qZA(),d.BQk()),2&O){const b=y.$implicit,P=d.oxw();d.xp6(1),d.Q6J("ngClass",d.VKq(4,v,P.isRequired(b.key)))("textContent",b.label),d.xp6(2),d.Q6J("resource",P.entry)("fieldName",b.key)}}class k extends r.N{constructor(y,b,P){super(),this.halEditing=y,this.cdRef=b,this.i18n=P,this.showWorkPackageField=!0,this.showUserField=!0,this.modifiedEntry=new d.vpe,this.text={wpRequired:this.i18n.t("js.time_entry.work_package_required")},this.workPackageSelected=!1,this.customFields=[]}ngOnInit(){this.halEditing.temporaryEditResource(this.changeset.projectedResource).values$().pipe(this.untilDestroyed()).subscribe(y=>{y&&y.workPackage&&(this.workPackageSelected=!0,this.cdRef.markForCheck())}),this.schema=this.changeset.schema,this.setCustomFields(),this.cdRef.detectChanges()}get entry(){return this.changeset.projectedResource}signalModifiedEntry(y){this.modifiedEntry.emit(y)}save(){return this.editForm.submit()}get inEditMode(){return!0}isRequired(y){return"workPackage"===y||this.schema.ofProperty(y).required}setCustomFields(){Object.entries(this.schema).forEach(([y,b])=>{/customField\d+/.exec(y)&&this.customFields.push({key:y,label:b.name})})}}k.\u0275fac=function(y){return new(y||k)(d.Y36(i.l),d.Y36(d.sBO),d.Y36(e.D))},k.\u0275cmp=d.Xpm({type:k,selectors:[["te-form"]],viewQuery:function(y,b){if(1&y&&d.Gf(m,7),2&y){let P;d.iGM(P=d.CRH())&&(b.editForm=P.first)}},inputs:{changeset:"changeset",showWorkPackageField:"showWorkPackageField",showUserField:"showUserField"},outputs:{modifiedEntry:"modifiedEntry"},features:[d.qOj],decls:19,vars:31,consts:[[3,"resource","inEditMode","onSaved"],["editForm",""],[1,"attributes-map"],[4,"ngIf"],[1,"attributes-map--key",3,"ngClass","textContent"],[1,"attributes-map--value"],[3,"resource","wrapperClasses","fieldName"],[3,"resource","fieldName",4,"ngIf"],[3,"textContent",4,"ngIf"],[3,"resource","fieldName"],[4,"ngFor","ngForOf"],[3,"textContent"]],template:function(y,b){1&y&&(d.TgZ(0,"edit-form",0,1),d.NdJ("onSaved",function(E){return b.signalModifiedEntry(E)}),d.TgZ(2,"div",2),d.YNc(3,c,4,7,"ng-container",3),d._UZ(4,"div",4),d.TgZ(5,"div",5),d._UZ(6,"op-editable-attribute-field",6),d.qZA(),d._UZ(7,"div",4),d.TgZ(8,"div",5),d._UZ(9,"op-editable-attribute-field",6),d.qZA(),d.YNc(10,p,4,6,"ng-container",3),d._UZ(11,"div",4),d.TgZ(12,"div",5),d.YNc(13,f,1,2,"op-editable-attribute-field",7),d.YNc(14,C,1,1,"i",8),d.qZA(),d._UZ(15,"div",4),d.TgZ(16,"div",5),d._UZ(17,"op-editable-attribute-field",9),d.qZA(),d.YNc(18,u,4,6,"ng-container",10),d.qZA(),d.qZA()),2&y&&(d.Q6J("resource",b.entry)("inEditMode",b.inEditMode),d.xp6(3),d.Q6J("ngIf",b.showUserField&&b.schema.user.writable),d.xp6(1),d.Q6J("ngClass",d.VKq(23,v,b.isRequired("spentOn")))("textContent",b.schema.spentOn.name),d.xp6(2),d.Q6J("resource",b.entry)("wrapperClasses","-tiny")("fieldName","spentOn"),d.xp6(1),d.Q6J("ngClass",d.VKq(25,v,b.isRequired("hours")))("textContent",b.schema.hours.name),d.xp6(2),d.Q6J("resource",b.entry)("wrapperClasses","-tiny")("fieldName","hours"),d.xp6(1),d.Q6J("ngIf",b.showWorkPackageField),d.xp6(1),d.Q6J("ngClass",d.VKq(27,v,b.isRequired("activity")))("textContent",b.schema.activity.name),d.xp6(2),d.Q6J("ngIf",b.workPackageSelected),d.xp6(1),d.Q6J("ngIf",!b.workPackageSelected),d.xp6(1),d.Q6J("ngClass",d.VKq(29,v,b.isRequired("comment")))("textContent",b.schema.comment.name),d.xp6(2),d.Q6J("resource",b.entry)("fieldName","comment"),d.xp6(1),d.Q6J("ngForOf",b.customFields))},directives:[h.n,l.O5,l.mk,a.k,l.sg],encapsulation:2,changeDetection:0})},54349:(X,I,t)=>{"use strict";t.d(I,{I:()=>n});var i=t(21757),e=t(55811),d=t(2246),h=t(72388),r=t(2316);class n{}n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({providers:[h.d],imports:[[i.H,e.K,d.E]]})},58021:(X,I,t)=>{"use strict";t.d(I,{G:()=>v});var i=t(3786),e=t(60312),d=t(77355),h=t(96617),n=(t(81301),t(29161)),l=t(61908),a=t(2316);const m=["editForm"];class v extends e.T{constructor(p,f,C,u,k){super(f,C,p),this.elementRef=p,this.locals=f,this.cdRef=C,this.i18n=u,this.injector=k,this.text={title:this.i18n.t("js.time_entry.title"),cancel:this.i18n.t("js.button_cancel"),close:this.i18n.t("js.button_close"),save:this.i18n.t("js.button_save"),delete:this.i18n.t("js.button_delete"),areYouSure:this.i18n.t("js.text_are_you_sure")},this.closeOnEscape=!1,this.closeOnOutsideClick=!1}get changeset(){return this.locals.changeset}get entry(){return this.changeset.projectedResource}get showWorkPackageField(){return!1!==this.locals.showWorkPackageField}get showUserField(){return!1!==this.locals.showUserField}saveEntry(){this.formInFlight=!0,this.editForm.save().then(()=>this.reloadWorkPackageAndClose()).catch(()=>{this.formInFlight=!1,this.cdRef.detectChanges()})}get saveAllowed(){return!0}get deleteAllowed(){return!0}reloadWorkPackageAndClose(){this.entry.workPackage&&this.apiV3Service.work_packages.id(this.entry.workPackage).refresh(),this.service.close(),this.formInFlight=!1,this.cdRef.detectChanges()}}v.\u0275fac=function(p){return new(p||v)(a.Y36(a.SBq),a.Y36(d.E),a.Y36(a.sBO),a.Y36(h.D),a.Y36(a.zs3))},v.\u0275dir=a.lG2({type:v,viewQuery:function(p,f){if(1&p&&a.Gf(m,7),2&p){let C;a.iGM(C=a.CRH())&&(f.editForm=C.first)}},features:[a.qOj]}),(0,i.gn)([(0,n.W)(),(0,i.w6)("design:type",l.T)],v.prototype,"apiV3Service",void 0)},36293:(X,I,t)=>{"use strict";t.d(I,{kl:()=>m});var i=t(12877),e=t(14808),d=t(85758),h=t(53882),r=t(96617),n=t(2316);class m{constructor(c,p){this.configurationService=c,this.I18n=p,this.stack=(0,e.qH)([]),jQuery(window).on("op:toasters:add",(f,C)=>{this.add(C)})}get current(){return this.stack}add(c,p=5e3){return jQuery(".flash.notice").remove(),this.stack.doModify(f=>{const C=[c].concat(f);return _.remove(C,(u,k)=>k>0&&this.removeOnAdd(u)),C}),"success"===c.type&&this.configurationService.autoHidePopups()&&setTimeout(()=>this.remove(c),p),c}removeOnAdd(c){return["success","error","loading"].includes(c.type)}addError(c,p=[]){var f,C;let u,k;k="string"==typeof p?[p]:[...p],c instanceof h.UA?(u=(0,d.G$)(c.error)?c.error.message:c.message,(null===(C=null===(f=c.error)||void 0===f?void 0:f._embedded)||void 0===C?void 0:C.errors)&&(k=[...k,...c.error._embedded.errors.map(y=>y.message)])):u=c;const O=this.createToast(u,"error");return O.data=k,this.add(O)}addWarning(c){return this.add(this.createToast(c,"warning"))}addSuccess(c){return this.add(this.createToast(c,"success"))}addNotice(c){return this.add(this.createToast(c,"info"))}addAttachmentUpload(c,p){return this.add(this.createAttachmentUploadToast(c,p))}addLoading(c){return this.add(this.createLoadingToast(this.I18n.t("js.ajax.updating"),c))}remove(c){this.stack.doModify(p=>(_.remove(p,f=>f===c),p))}clear(){this.stack.putValue([])}createToast(c,p){return"string"==typeof c?{message:c,type:p}:{message:c.message,type:p,link:c.link,data:c.data}}createAttachmentUploadToast(c,p){if(!p.length)throw new Error("Cannot create an upload toast without uploads!");const f=this.createToast(c,"upload");return f.data=p,f}createLoadingToast(c,p){const f=this.createToast(c,"loading");return f.data=p,f}}m.\u0275fac=function(c){return new(c||m)(n.LFG(i.e),n.LFG(r.D))},m.\u0275prov=n.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})},65532:(X,I,t)=>{"use strict";t.d(I,{F:()=>l});t(84481);var e=t(96617),d=t(2316),h=t(54364);function r(a,m){if(1&a&&d._UZ(0,"a",2),2&a){const v=d.oxw();d.Q6J("textContent",v.name),d.uIk("href",v.href,d.LSH)("title",v.label)}}function n(a,m){if(1&a&&(d.ynx(0),d._uU(1),d.GkF(2),d.BQk()),2&a){const v=d.oxw();d.xp6(1),d.hij(" ",v.name," ")}}class l{constructor(m){this.I18n=m}get href(){return this.user&&this.user.showUserPath}get name(){return this.user&&this.user.name}get label(){return this.I18n.t("js.label_author",{user:this.name})}}l.\u0275fac=function(m){return new(m||l)(d.Y36(e.D))},l.\u0275cmp=d.Xpm({type:l,selectors:[["op-user-link"]],inputs:{user:"user"},decls:2,vars:2,consts:[[3,"textContent",4,"ngIf"],[4,"ngIf"],[3,"textContent"]],template:function(m,v){1&m&&(d.YNc(0,r,1,3,"a",0),d.YNc(1,n,3,1,"ng-container",1)),2&m&&(d.Q6J("ngIf",v.href),d.xp6(1),d.Q6J("ngIf",!v.href))},directives:[h.O5],encapsulation:2,changeDetection:0})},84312:(X,I,t)=>{"use strict";t.d(I,{U:()=>d});var i=t(7101),e=t(2316);class d{constructor(r,n){this.FocusHelper=r,this.elementRef=n,this.condition=!0}ngAfterViewInit(){this.updateFocus()}updateFocus(){(this.condition||""===this.condition)&&this.FocusHelper.focus(this.elementRef.nativeElement)}}d.\u0275fac=function(r){return new(r||d)(e.Y36(i.i),e.Y36(e.SBq))},d.\u0275dir=e.lG2({type:d,selectors:[["","opAutofocus",""]],inputs:{condition:["opAutofocus","condition"]}})},49951:(X,I,t)=>{"use strict";function i(d,h){return d===h||d.contains(h)}function e(d,h){setTimeout(()=>{i(d,document.activeElement)||h()},20)}t.d(I,{j:()=>i,w:()=>e})},7101:(X,I,t)=>{"use strict";t.d(I,{i:()=>e});var i=t(2316);class e{getFocusableElement(h){const r=h.querySelector("input.ui-select-focusser");if(r)return r;let n=h;return h.matches(e.FOCUSABLE_SELECTORS)||(n=h.querySelector(e.FOCUSABLE_SELECTORS)||h),n}focus(h){setTimeout(()=>{const r=this.getFocusableElement(h);null==r||r.focus()},10)}}e.FOCUSABLE_SELECTORS="a, button, input, [tabindex], select, textarea",e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=i.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},51017:(X,I,t)=>{"use strict";t.d(I,{N:()=>r});var i=t(76491),e=t(77763),d=t(26942),h=t(2316);class r extends d.N{constructor(l){super(),this.elementRef=l}ngOnInit(){const l=jQuery(this.elementRef.nativeElement),a=new i.X(!1);a.pipe(this.untilDestroyed(),(0,e.e)(50)).subscribe(c=>{l.toggleClass("-focus",c)});l[0].addEventListener("focus",function(){a.next(!0)},!0);l[0].addEventListener("blur",function(){a.next(!1)},!0),setTimeout(()=>{l.addClass("op-focus-within"),l.find(this.selector).addClass("op-focus-within")},0)}}r.\u0275fac=function(l){return new(l||r)(h.Y36(h.SBq))},r.\u0275dir=h.lG2({type:r,selectors:[["","opFocusWithin",""]],inputs:{selector:"selector"},features:[h.qOj]})},63415:(X,I,t)=>{"use strict";t.d(I,{J:()=>d});var i=t(54364),e=t(2316);class d{}d.\u0275fac=function(r){return new(r||d)},d.\u0275mod=e.oAB({type:d}),d.\u0275inj=e.cJS({imports:[[i.ez]]})},81979:(X,I,t)=>{"use strict";t.d(I,{o:()=>d,K:()=>h});var i=t(2316);const d="col[opHighlightCol]";class h{constructor(n){this.elementRef=n}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.thead=this.$element.parent("colgroup").siblings("thead"),this.thead.on("mouseenter","th",n=>{this.$element.index()===jQuery(n.currentTarget).index()&&this.$element.addClass("hover")}),this.thead.on("mouseleave","th",n=>{this.$element.index()===jQuery(n.currentTarget).index()&&this.$element.removeClass("hover")})}ngOnDestroy(){this.thead.off("mouseenter mouseleave")}}h.\u0275fac=function(n){return new(n||h)(i.Y36(i.SBq))},h.\u0275cmp=i.Xpm({type:h,selectors:[["col","opHighlightCol",""]],attrs:["opHighlightCol",""],decls:0,vars:0,template:function(n,l){},encapsulation:2})},93713:(X,I,t)=>{"use strict";t.d(I,{U:()=>e});var i=t(2316);class e{constructor(h){this.elementRef=h,this.query=""}ngAfterViewChecked(){let h=this.elementRef.nativeElement;const r=h.querySelector(".op-search-highlight");if(r&&r.innerHTML.toLocaleLowerCase()===this.query.toLocaleLowerCase()||(h=this.cleanUpOldHighlighting(h),!this.query))return;const n=Array.from(h.childNodes).find(C=>C.nodeType===C.TEXT_NODE),l=(null==n?void 0:n.textContent)||"";if(!l)return;const a=this.query.toLowerCase(),m=l.toLowerCase().indexOf(a);if(m<0)return;const v=l.slice(0,m),c=l.slice(m,m+a.length),p=l.slice(m+a.length),f=document.createElement("span");f.innerHTML=`${_.escape(v)}<span class="op-search-highlight">${_.escape(c)}</span>${_.escape(p)}`,h.replaceChild(f,n)}cleanUpOldHighlighting(h){if(h.children.length>0){const r=Array.from(h.children,({textContent:n})=>null==n?void 0:n.trim()).join("");h.innerHTML="",h.innerText=r}return h}}e.\u0275fac=function(h){return new(h||e)(i.Y36(i.SBq))},e.\u0275dir=i.lG2({type:e,selectors:[["","opSearchHighlight",""]],inputs:{query:["opSearchHighlight","query"]}})},29161:(X,I,t)=>{"use strict";t.d(I,{W:()=>h});t(43887);var d=t(3352);function h(r,n=null,l){return(a,m)=>{delete a[m]&&Object.defineProperty(a,m,{get(){if(r)return this.injector.get(r,n,l);const v=Reflect.getMetadata("design:type",a,m);return this.injector.get(v,n,l)},set(){(0,d.qu)(`Trying to set InjectField property ${m}`)}})}}},43682:(X,I,t)=>{"use strict";t.d(I,{tL:()=>e,As:()=>r,u9:()=>n,AT:()=>l,WJ:()=>a,U5:()=>v,q9:()=>c});var i=t(80044);function e(p,f){return f.href}function r(p,f){return _.get(f,"name")}function n(p,f){return _.get(f,"href")}function l(p){return(f,C)=>_.get(C,p)}function a(p){return(f,C)=>{const u=_.get(C,"href")||"",k=_.get(C,p,"none");return`${u}#${p}=${k}`}}function v(p,f){return!p&&!f||!!p&&!!f&&p.href===f.href}function c(p,f){return p instanceof i.X&&f instanceof i.X?v(p,f):!p&&!f||p===f}},26942:(X,I,t)=>{"use strict";t.d(I,{N:()=>d});var i=t(38519),e=t(2316);class d extends i.QQ{constructor(){super(...arguments),this.componentDestroyed=!1}ngOnDestroy(){this.componentDestroyed=!0,super.ngOnDestroy()}untilDestroyed(){return(0,i.WJ)(this)}}d.\u0275fac=function(){let h;return function(n){return(h||(h=e.n5z(d)))(n||d)}}(),d.\u0275dir=e.lG2({type:d,features:[e.qOj]})},26269:(X,I,t)=>{"use strict";t.d(I,{qM:()=>d,PQ:()=>h});const i=["f"],e=["t"];class d{constructor(){this.filterMap={}}add(n,l,a){const m=!0===a?e:!1===a?i:a;return this.filterMap[n]={operator:l,values:m},this}remove(n){delete this.filterMap[n]}static toFilterObject(n){const l={};return n.forEach(a=>{_.each(a,(m,v)=>{l[v]=m})}),l}merge(n,...l){const a=_.pickBy(d.toFilterObject(n),(m,v)=>l.includes(v));this.filterMap=Object.assign(Object.assign({},this.filterMap),a)}get filters(){const n=[];return _.each(this.filterMap,(l,a)=>{n.push({[a]:l})}),n}toJson(){return JSON.stringify(this.filters)}toParams(n={}){const l=Object.assign({filters:this.toJson()},n);return new URLSearchParams(l).toString()}clone(){const n=new d;return this.filters.forEach(l=>{Object.keys(l).forEach(a=>{n.add(a,l[a].operator,l[a].values)})}),n}}function h(r,n,l){return(new d).add(r,n,l)}},3352:(X,I,t)=>{"use strict";t.d(I,{SC:()=>e,qu:()=>d,IN:()=>h});var i=t(92340);function e(n){i.N.production||n()}function d(n,...l){e(()=>console.log(`[DEBUG] ${n}`,...l))}function h(n,l){if(!i.N.production){const a=performance.now(),m=l(),v=performance.now();return console.log(`%c${n} completed in ${v-a} milliseconds.`,"color:#00A093;"),m}return l()}},87873:(X,I,t)=>{"use strict";function i(e,d=""){document.body.style.setProperty("cursor",e,d)}t.d(I,{h:()=>i})},35900:(X,I,t)=>{"use strict";t.d(I,{x:()=>e});var i=t(92242);class e{constructor(h,r){this.down=!1,this.elements=h,this.scrollWhenOutside=r.scrollWhenOutside||!1,this.maxSpeed=r.maxSpeed||5,this.margin=r.margin||10,this.scrollWhenOutside=r.scrollWhenOutside||!1,this.autoScroll=r.autoScroll,this.point={},this.pointCB=(0,i.Fi)(this.point),this.init()}init(){jQuery(window).on("mousemove.domautoscroll touchmove.domautoscroll",h=>{this.down&&(this.pointCB(h),this.onMove(h))}),jQuery(window).on("mousedown.domautoscroll touchstart.domautoscroll",()=>{this.down=!0}),jQuery(window).on("mouseup.domautoscroll touchend.domautoscroll",()=>this.onUp()),jQuery(window).on("scroll.domautoscroll",h=>this.setScroll(h))}destroy(){jQuery(window).off(".domautoscroll"),this.elements=[],this.cleanAnimation()}add(h){Array.isArray(h)?(this.elements=this.elements.concat(h),this.elements=Array.from(new Set(this.elements))):this.elements.push(h)}onUp(){this.down=!1,cancelAnimationFrame(this.animationFrame),cancelAnimationFrame(this.windowAnimationFrame)}setScroll(h){for(let r=0;r<this.elements.length;r++)if(this.elements[r]===h.target){this.scrolling=!0;break}this.scrolling&&requestAnimationFrame(()=>{this.scrolling=!1})}cleanAnimation(){cancelAnimationFrame(this.animationFrame),cancelAnimationFrame(this.windowAnimationFrame)}getTarget(h){if(!h)return[];const r=n=>[...this.elements.includes(n)?[n]:[],...n.parentElement?r(n.parentElement):[]];return r(h)}getElementsUnderPoint(){const h=[];for(let r=0;r<this.elements.length;r++)this.inside(this.point,this.elements[r])&&h.push(this.elements[r]);return h}onMove(h){if(!this.autoScroll()||h.dispatched)return;let r=[];null!==h.target&&r.push(h.target);const{body:n}=document;r.length>0&&r[0].parentNode===n?r=this.getElementsUnderPoint():(r=this.getTarget(r[0]),0===r.length&&(r=this.getElementsUnderPoint())),this.current=r,0===this.current.length&&(this.current=[this.outerScrollContainer]),cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(this.scrollTick.bind(this))}setOuterScrollContainer(h){this.outerScrollContainer=h}scrollTick(){0!==this.current.length&&(this.current.forEach(h=>{h&&this.scrollAutomatically(h)}),cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(this.scrollTick.bind(this)))}scrollAutomatically(h){const r=(0,i.VK)(h),n=(()=>this.point.x<r.left+this.margin?-this.maxSpeed:this.point.x>r.right-this.margin?this.maxSpeed:0)(),l=(()=>this.point.y<r.top+this.margin?-this.maxSpeed:this.point.y>r.bottom-this.margin?this.maxSpeed:0)();setTimeout(()=>{l&&this.scrollY(h,l),n&&this.scrollX(h,n)})}scrollY(h,r){h===window?window.scrollTo(h.pageXOffset,h.pageYOffset+r):h.scrollTop+=r}scrollX(h,r){h===window?window.scrollTo(h.pageXOffset+r,h.pageYOffset):h.scrollLeft+=r}inside(h,r,n){return n?h.y>n.top&&h.y<n.bottom&&h.x>n.left&&h.x<n.right:(0,i.XI)(h,r)}}},68354:(X,I,t)=>{"use strict";function i(d){return d.parentElement?Array.from(d.parentElement.children).indexOf(d):-1}function e(d,h,r){const n="string"==typeof h?parseInt(h,10):h,l=d.parentNode?Array.from(d.parentNode.children).indexOf(d):null,a=Array.from(r.children),m=null!=l&&l>=0?l>n?a[n]:a[n+1]:a[n];m?r.insertBefore(d,m):r.appendChild(d)}t.d(I,{c:()=>i,d:()=>e})},45237:(X,I,t)=>{"use strict";t.d(I,{j:()=>n});var i=t(3786),e=t(54364),d=t(35900),h=t(68354),r=t(2316);class n{constructor(a,m){this.document=a,this.injector=m,this.drake=null,this.members=[],this.escapeListener=v=>{this.drake&&"Escape"===v.key&&this.drake.cancel(!0)},this.document.documentElement.addEventListener("keydown",this.escapeListener)}ngOnDestroy(){this.document.documentElement.removeEventListener("keydown",this.escapeListener),this.autoscroll&&this.autoscroll.destroy(),this.drake&&this.drake.destroy()}remove(a){this.initialized&&(_.remove(this.drake.containers,m=>m===a),_.remove(this.members,m=>m.dragContainer===a))}member(a){return _.find(this.members,m=>m.dragContainer===a)}get initialized(){return null!==this.drake}register(a){this.members.push(a);const{scrollContainers:m}=a;this.autoscroll?this.autoscroll.add(m):this.setupAutoscroll(m);const{dragContainer:v}=a;null===this.drake?this.initializeDrake([v]):this.drake.containers.push(v)}addScrollContainer(a){this.autoscroll?this.autoscroll.add(a):this.setupAutoscroll([a]),this.autoscroll.setOuterScrollContainer(a)}setupAutoscroll(a){this.autoscroll=new d.x(a,{margin:100,maxSpeed:10,scrollWhenOutside:!0,autoScroll:()=>this.drake&&this.drake.dragging})}getMember(a){return this.members.find(m=>m.dragContainer===a)}initializeDrake(a){this.drake=dragula(a,{moves:(m,v,c,p)=>{const f=this.getMember(v);return!!f&&f.moves(m,v,c,p)},accepts:(m,v)=>{const c=this.getMember(v);return!c||!c.accepts||c.accepts(m,v)},invalid:()=>!1,direction:"vertical",copy:!1,revertOnSpill:!0,removeOnSpill:!1,mirrorContainer:document.body,ignoreInputTextSelection:!0}),this.drake.on("drag",m=>{m.dataset.sourceIndex=(0,h.c)(m).toString()}),this.drake.on("over",(m,v)=>{const c=v.closest(".drop-zone");c&&c.classList.add("-dragged-over")}),this.drake.on("out",(m,v)=>{const c=v.closest(".drop-zone");c&&c.classList.remove("-dragged-over")}),this.drake.on("cloned",(m,v)=>{const c=this.member(v.parentElement);c&&c.onCloned&&c.onCloned(m,v)}),this.drake.on("drop",(m,v,c,p)=>{try{this.handleDrop(m,v,c,p)}catch(f){console.error("Failed to handle drop of %O, %O",m,f)}}),this.drake.on("shadow",(m,v)=>{const c=this.member(v);c&&c.onShadowInserted&&c.onShadowInserted(m)}),this.drake.on("cancel",(m,v)=>{const c=this.member(v);c&&c.onCancel&&c.onCancel(m)})}handleDrop(a,m,v,c){return(0,i.mG)(this,void 0,void 0,function*(){const p=this.member(m),f=this.member(v);p&&f&&(p!==f?(yield p.onAdded(a,m,v,c))?f.onRemoved(a,m,v,c):(0,h.d)(a,a.dataset.sourceIndex||-1,v):p.onMoved(a,m,v,c))})}}n.\u0275fac=function(a){return new(a||n)(r.LFG(e.K0),r.LFG(r.zs3))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})},87286:(X,I,t)=>{"use strict";t.d(I,{p:()=>e});const i=['a[href]:not([tabindex^="-"])','area[href]:not([tabindex^="-"])','input:not([type="hidden"]):not([type="radio"]):not([disabled]):not([tabindex^="-"])','input[type="radio"]:not([disabled]):not([tabindex^="-"])','select:not([disabled]):not([tabindex^="-"])','textarea:not([disabled]):not([tabindex^="-"])','button:not([disabled]):not([tabindex^="-"])','iframe:not([tabindex^="-"])','audio[controls]:not([tabindex^="-"])','video[controls]:not([tabindex^="-"])','[contenteditable]:not([tabindex^="-"])','[tabindex]:not([tabindex^="-"]):not(.cdk-focus-trap-anchor)'];function e(d){return d.querySelectorAll(i.toString())}},97656:(X,I,t)=>{"use strict";function i(e){return`${t.p}assets/images/${e}`}t.d(I,{h:()=>i})},33406:(X,I,t)=>{"use strict";var i,e;t.d(I,{m:()=>i}),(e=i||(i={}))[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT_ARROW=37]="LEFT_ARROW",e[e.UP_ARROW=38]="UP_ARROW",e[e.RIGHT_ARROW=39]="RIGHT_ARROW",e[e.DOWN_ARROW=40]="DOWN_ARROW",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.KEY_0=48]="KEY_0",e[e.KEY_1=49]="KEY_1",e[e.KEY_2=50]="KEY_2",e[e.KEY_3=51]="KEY_3",e[e.KEY_4=52]="KEY_4",e[e.KEY_5=53]="KEY_5",e[e.KEY_6=54]="KEY_6",e[e.KEY_7=55]="KEY_7",e[e.KEY_8=56]="KEY_8",e[e.KEY_9=57]="KEY_9",e[e.KEY_A=65]="KEY_A",e[e.KEY_B=66]="KEY_B",e[e.KEY_C=67]="KEY_C",e[e.KEY_D=68]="KEY_D",e[e.KEY_E=69]="KEY_E",e[e.KEY_F=70]="KEY_F",e[e.KEY_G=71]="KEY_G",e[e.KEY_H=72]="KEY_H",e[e.KEY_I=73]="KEY_I",e[e.KEY_J=74]="KEY_J",e[e.KEY_K=75]="KEY_K",e[e.KEY_L=76]="KEY_L",e[e.KEY_M=77]="KEY_M",e[e.KEY_N=78]="KEY_N",e[e.KEY_O=79]="KEY_O",e[e.KEY_P=80]="KEY_P",e[e.KEY_Q=81]="KEY_Q",e[e.KEY_R=82]="KEY_R",e[e.KEY_S=83]="KEY_S",e[e.KEY_T=84]="KEY_T",e[e.KEY_U=85]="KEY_U",e[e.KEY_V=86]="KEY_V",e[e.KEY_W=87]="KEY_W",e[e.KEY_X=88]="KEY_X",e[e.KEY_Y=89]="KEY_Y",e[e.KEY_Z=90]="KEY_Z",e[e.LEFT_META=91]="LEFT_META",e[e.RIGHT_META=92]="RIGHT_META",e[e.SELECT=93]="SELECT",e[e.NUMPAD_0=96]="NUMPAD_0",e[e.NUMPAD_1=97]="NUMPAD_1",e[e.NUMPAD_2=98]="NUMPAD_2",e[e.NUMPAD_3=99]="NUMPAD_3",e[e.NUMPAD_4=100]="NUMPAD_4",e[e.NUMPAD_5=101]="NUMPAD_5",e[e.NUMPAD_6=102]="NUMPAD_6",e[e.NUMPAD_7=103]="NUMPAD_7",e[e.NUMPAD_8=104]="NUMPAD_8",e[e.NUMPAD_9=105]="NUMPAD_9",e[e.MULTIPLY=106]="MULTIPLY",e[e.ADD=107]="ADD",e[e.SUBTRACT=109]="SUBTRACT",e[e.DECIMAL=110]="DECIMAL",e[e.DIVIDE=111]="DIVIDE",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUM_LOCK=144]="NUM_LOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.SEMICOLON=186]="SEMICOLON",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.DASH=189]="DASH",e[e.PERIOD=190]="PERIOD",e[e.FORWARD_SLASH=191]="FORWARD_SLASH",e[e.GRAVE_ACCENT=192]="GRAVE_ACCENT",e[e.OPEN_BRACKET=219]="OPEN_BRACKET",e[e.BACK_SLASH=220]="BACK_SLASH",e[e.CLOSE_BRACKET=221]="CLOSE_BRACKET",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE"},67325:(X,I,t)=>{"use strict";function i(e){const d=e.ctrlKey||e.shiftKey||e.metaKey,h=1===e.button;return d||h}t.d(I,{F:()=>i})},65978:(X,I,t)=>{"use strict";function i(...e){const d=document.createElement("i");return d.setAttribute("aria-hidden","true"),d.classList.add(...e),d}t.d(I,{c:()=>i})},68197:(X,I,t)=>{"use strict";t.d(I,{O:()=>e});const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function e(d=16){return new Array(d).fill(null).map(()=>i.charAt(Math.floor(Math.random()*i.length))).join("")}},93175:(X,I,t)=>{"use strict";t.d(I,{R:()=>r});var i=t(2316),e=t(79441),d=t(80639),h=t(22663);class r{constructor(l,a=250){this.emitter=new i.vpe,this.debouncer=new e.xQ,this.debouncer.pipe((0,d.b)(a),(0,h.R)(l)).subscribe(m=>this.emitter.emit(m))}emit(l){this.debouncer.next(l)}subscribe(l,a,m){return this.emitter.subscribe(l,a,m)}}},88837:(X,I,t)=>{"use strict";t.d(I,{w:()=>e,b:()=>d});var i=t(3352);function e(h,r){try{h.setSelectionRange(r,r)}catch(n){(0,i.qu)("Failed to set click position for edit field.",n)}}function d(h){const r=h.originalEvent;try{if(r.rangeParent){const n=document.createRange();return n.setStart(r.rangeParent,r.rangeOffset),n.startOffset}return document.caretRangeFromPoint?document.caretRangeFromPoint(h.clientX,h.clientY).startOffset:0}catch(n){return(0,i.qu)("Failed to get click position for edit field.",n),0}}},18217:(X,I,t)=>{"use strict";function i(e,d){const h=new URL(e,window.location.origin);return Object.keys(d).forEach(r=>{h.searchParams.set(r,d[r])}),h.pathname+h.search}t.d(I,{Y:()=>i})},21757:(X,I,t)=>{"use strict";t.d(I,{H:()=>G});var i=t(1707),e=t(36868),d=t(80395),h=t(40912),r=t(54364),n=t(3353),l=t(82503),a=t(32853),m=t(84906),v=t(45921),c=t(37991),p=t(74990),f=t(53875),C=t(71858),u=t(65146),k=t(32824),O=t(81496),y=t(63415),b=t(53448),P=t(75867),E=t(81979),T=t(2316);class M{}M.\u0275fac=function(V){return new(V||M)},M.\u0275mod=T.oAB({type:M}),M.\u0275inj=T.cJS({});var S=t(51705),R=t(87523),F=t(47775),L=t(55901);class G{constructor(V){!function(Q){const V=Q.get(u.R),K=Q.get(F.UIRouterGlobals);window.ErrorReporter.addHook(()=>({project:V.identifier||"global","router state":K.current.name||"unknown"})),Q.get(b.$).register("openProjectAngularBootstrap",()=>[{selector:E.o,cls:E.K}])}(V)}}G.\u0275fac=function(V){return new(V||G)(T.LFG(T.zs3))},G.\u0275mod=T.oAB({type:G}),G.\u0275inj=T.cJS({providers:[P.p,S.s],imports:[[m.UIRouterModule,r.ez,i.u5,v.s,L.rt,h.eL,d._t,l.qE,c.H,e.A0,n._,M,k.j,R.a,p.C,O.I,y.J,f.Q,C.a],m.UIRouterModule,r.ez,i.u5,h.eL,d._t,L.rt,f.Q,C.a,e.A0,n._,M,k.j,p.C,R.a,v.s,O.I,y.J,a.wA]})},1476:(X,I,t)=>{"use strict";t.d(I,{B:()=>h});var i=t(2316),e=t(1707);const d=["input"];class h{constructor(n){this.cdRef=n,this.className=!0,this.tabindex=0,this.disabled=!1,this.name="spot-checkbox-"+ +new Date,this.checkedChange=new i.vpe,this.checked=!1,this.onChange=l=>{},this.onTouched=l=>{}}onStateChange(){const n=this.input.nativeElement.checked;this.checkedChange.emit(n),this.onChange(n),this.onTouched(n)}writeValue(n){setTimeout(()=>{this.input.nativeElement.indeterminate=null===n,this.checked=!!n,this.cdRef.detectChanges()})}registerOnChange(n){this.onChange=n}registerOnTouched(n){this.onTouched=n}}h.\u0275fac=function(n){return new(n||h)(i.Y36(i.sBO))},h.\u0275cmp=i.Xpm({type:h,selectors:[["spot-checkbox"]],viewQuery:function(n,l){if(1&n&&i.Gf(d,5),2&n){let a;i.iGM(a=i.CRH())&&(l.input=a.first)}},hostVars:2,hostBindings:function(n,l){2&n&&i.ekj("spot-checkbox",l.className)},inputs:{tabindex:"tabindex",disabled:"disabled",name:"name",checked:"checked"},outputs:{checkedChange:"checkedChange"},features:[i._Bn([{provide:e.JU,useExisting:(0,i.Gpc)(()=>h),multi:!0}])],decls:3,vars:4,consts:[["type","checkbox",1,"spot-checkbox--input",3,"disabled","checked","tabindex","change"],["input",""],[1,"spot-checkbox--fake"]],template:function(n,l){1&n&&(i.TgZ(0,"input",0,1),i.NdJ("change",function(){return l.onStateChange()}),i.qZA(),i._UZ(2,"span",2)),2&n&&(i.Q6J("disabled",l.disabled)("checked",l.checked)("tabindex",l.tabindex),i.uIk("name",l.name))},encapsulation:2,changeDetection:0})},21090:(X,I,t)=>{"use strict";t.d(I,{m:()=>c});var i=t(2316),e=t(33406),d=t(96617),h=t(1706),r=t(87286),n=t(54364);const l=function(p){return["spot-drop-modal--body","spot-container",p]};function a(p,f){if(1&p){const C=i.EpF();i.TgZ(0,"div",1),i.NdJ("click",function(k){return i.CHM(C),i.oxw().onBodyClick(k)}),i.Hsn(1,1),i.TgZ(2,"button",2),i.NdJ("click",function(){return i.CHM(C),i.oxw().close()}),i._UZ(3,"span",3),i.qZA(),i.qZA()}if(2&p){const C=i.oxw();i.Q6J("ngClass",i.VKq(2,l,C.alignmentClass)),i.xp6(2),i.uIk("aria-label",C.text.close)}}const m=[[["","slot","trigger"]],[["","slot","body"]]];class c{constructor(f,C){this.i18n=f,this.elementRef=C,this.className=!0,this.closed=new i.vpe,this.alignment=h.Z.BottomLeft,this._open=!1,this.text={close:this.i18n.t("js.spot.drop_modal.close")},this.closeEventListener=this.close.bind(this),this.onEscape=u=>{u.keyCode===e.m.ESCAPE&&this.close()},this.escapeListener=this.onEscape.bind(this)}set open(f){this._open=f,this._open?setTimeout(()=>{document.body.addEventListener("click",this.closeEventListener),document.body.addEventListener("keydown",this.escapeListener);const C=document.querySelectorAll("[data-modal-focus-catcher-container='true']")[0];C?(0,r.p)(C)[0].focus():(0,r.p)(this.elementRef.nativeElement)[1].focus()}):(document.body.removeEventListener("click",this.closeEventListener),document.body.removeEventListener("click",this.escapeListener),this.closed.emit())}get open(){return this._open}get alignmentClass(){return`spot-drop-modal--body_${this.alignment}`}close(){this.open=!1}onBodyClick(f){f.stopPropagation()}ngOnDestroy(){document.body.removeEventListener("click",this.closeEventListener),document.body.removeEventListener("click",this.escapeListener)}}c.\u0275fac=function(f){return new(f||c)(i.Y36(d.D),i.Y36(i.SBq))},c.\u0275cmp=i.Xpm({type:c,selectors:[["spot-drop-modal"]],hostVars:4,hostBindings:function(f,C){2&f&&i.ekj("spot-drop-modal",C.className)("spot-drop-modal_opened",C.open)},inputs:{alignment:"alignment",open:"open"},outputs:{closed:"closed"},ngContentSelectors:["[slot=trigger]","[slot=body]"],decls:2,vars:1,consts:[["cdkTrapFocus","",3,"ngClass","click",4,"ngIf"],["cdkTrapFocus","",3,"ngClass","click"],["type","button",1,"spot-drop-modal--close-button","spot-button",3,"click"],[1,"spot-icon","spot-icon_close"]],template:function(f,C){1&f&&(i.F$t(m),i.Hsn(0),i.YNc(1,a,4,4,"div",0)),2&f&&(i.xp6(1),i.Q6J("ngIf",C.open))},directives:[n.O5,n.mk],encapsulation:2,changeDetection:0})},96091:(X,I,t)=>{"use strict";t.d(I,{H:()=>r,G:()=>n});var i=t(2316),e=t(1707),d=t(45410);const h=["input"],r="spot-switch";class n{constructor(a,m){this.elementRef=a,this.cdRef=m,this.className=!0,this.tabindex=0,this.disabled=!1,this.name="spot-switch-"+ +new Date,this.checkedChange=new i.vpe,this.checked=!1,this.onChange=v=>{},this.onTouched=v=>{},(0,d.E)(this)}onStateChange(){const a=this.input.nativeElement.checked;this.checkedChange.emit(a),this.onChange(a),this.onTouched(a)}writeValue(a){this.checked=!!a,this.cdRef.markForCheck()}onToggle(a){this.writeValue(a),this.onChange(a),this.onTouched(a)}registerOnChange(a){this.onChange=a}registerOnTouched(a){this.onTouched=a}}n.\u0275fac=function(a){return new(a||n)(i.Y36(i.SBq),i.Y36(i.sBO))},n.\u0275cmp=i.Xpm({type:n,selectors:[["spot-switch"]],viewQuery:function(a,m){if(1&a&&i.Gf(h,5),2&a){let v;i.iGM(v=i.CRH())&&(m.input=v.first)}},hostVars:2,hostBindings:function(a,m){2&a&&i.ekj("spot-switch",m.className)},inputs:{tabindex:"tabindex",disabled:"disabled",name:"name",checked:"checked"},outputs:{checkedChange:"checkedChange"},features:[i._Bn([{provide:e.JU,useExisting:(0,i.Gpc)(()=>n),multi:!0}])],decls:3,vars:5,consts:[["type","checkbox",1,"spot-switch--input",3,"disabled","tabindex","ngModel","ngModelChange"],["input",""],["data-qa-selector","spot-switch-handle",1,"spot-switch--fake"]],template:function(a,m){1&a&&(i.TgZ(0,"input",0,1),i.NdJ("ngModelChange",function(c){return m.onToggle(c)}),i.qZA(),i._UZ(2,"span",2)),2&a&&(i.Q6J("disabled",m.disabled)("tabindex",m.tabindex)("ngModel",m.checked),i.uIk("name",m.name),i.xp6(2),i.uIk("data-qa-active",m.checked||void 0))},directives:[e.Wl,e.JJ,e.On],encapsulation:2,changeDetection:0})},87912:(X,I,t)=>{"use strict";t.d(I,{A:()=>a});var i=t(2316),e=t(1707),d=t(54364);const h=["input"];function r(m,v){if(1&m){const c=i.EpF();i.TgZ(0,"button",3),i.NdJ("click",function(){return i.CHM(c),i.oxw().valueChanged("")}),i._UZ(1,"span",4),i.qZA()}}const n=[[["","slot","before"]],[["","slot","after"]]];class a{constructor(v){this.cdRef=v,this.className=!0,this.focused=!1,this.name="spot-text-field-"+ +new Date,this.disabled=!1,this.showClearButton=!0,this.placeholder="",this.value="",this.inputFocus=new i.vpe,this.inputBlur=new i.vpe,this.onChange=c=>{},this.onTouched=c=>{}}onParentClick(){this.input.nativeElement.focus()}valueChanged(v){this.writeValue(v),this.onChange(v),this.onTouched(v)}onInputFocus(v){this.focused=!0,this.inputFocus.next(v)}onInputBlur(v){this.focused=!1,this.inputBlur.next(v)}writeValue(v){this.value=v||"",this.cdRef.markForCheck()}registerOnChange(v){this.onChange=v}registerOnTouched(v){this.onTouched=v}}a.\u0275fac=function(v){return new(v||a)(i.Y36(i.sBO))},a.\u0275cmp=i.Xpm({type:a,selectors:[["spot-text-field"]],viewQuery:function(v,c){if(1&v&&i.Gf(h,5),2&v){let p;i.iGM(p=i.CRH())&&(c.input=p.first)}},hostVars:6,hostBindings:function(v,c){1&v&&i.NdJ("click",function(){return c.onParentClick()}),2&v&&i.ekj("spot-text-field",c.className)("spot-text-field_focused",c.focused)("spot-text-field_disabled",c.disabled)},inputs:{name:"name",disabled:"disabled",showClearButton:"showClearButton",placeholder:"placeholder",value:"value"},outputs:{inputFocus:"inputFocus",inputBlur:"inputBlur"},features:[i._Bn([{provide:e.JU,useExisting:(0,i.Gpc)(()=>a),multi:!0}])],ngContentSelectors:["[slot=before]","[slot=after]"],decls:5,vars:5,consts:[[1,"spot-text-field--input",3,"disabled","placeholder","ngModel","ngModelChange","focus","blur"],["input",""],["type","button","class","spot-text-field--clear-button",3,"click",4,"ngIf"],["type","button",1,"spot-text-field--clear-button",3,"click"],[1,"spot-icon","spot-icon_close"]],template:function(v,c){1&v&&(i.F$t(n),i.Hsn(0),i.TgZ(1,"input",0,1),i.NdJ("ngModelChange",function(f){return c.valueChanged(f)})("focus",function(f){return c.onInputFocus(f)})("blur",function(f){return c.onInputBlur(f)}),i.qZA(),i.YNc(3,r,2,0,"button",2),i.Hsn(4,1)),2&v&&(i.xp6(1),i.Q6J("disabled",c.disabled)("placeholder",c.placeholder)("ngModel",c.value),i.uIk("name",c.name),i.xp6(2),i.Q6J("ngIf",c.showClearButton&&""!==c.value&&!c.disabled))},directives:[e.Fj,e.JJ,e.On,d.O5],encapsulation:2})},91448:(X,I,t)=>{"use strict";t.d(I,{v:()=>n});var i=t(2316),e=t(1707),d=t(54364);const h=function(l,a){return{button:!0,"-disabled":l,"form--field-inline-button":!0,"-active":a,"spot-toggle--button":!0}};function r(l,a){if(1&l){const m=i.EpF();i.TgZ(0,"label",1),i.TgZ(1,"input",2),i.NdJ("ngModelChange",function(c){return i.CHM(m),i.oxw().onToggle(c)}),i.qZA(),i._uU(2),i.qZA()}if(2&l){const m=a.$implicit,v=i.oxw();i.Q6J("ngClass",i.WLB(8,h,v.disabled,v.value===m.value)),i.uIk("data-qa-disabled",v.disabled||void 0)("data-qa-active-toggle",v.value===m.value),i.xp6(1),i.Q6J("disabled",v.disabled)("name",v.name)("value",m.value)("ngModel",v.value),i.xp6(1),i.hij(" ",m.title,"\n")}}class n{constructor(a){this.cdRef=a,this.classNameOld=!0,this.className=!0,this.valueChange=new i.vpe,this.options=[],this.disabled=!1,this.name="spot-toggle-"+ +new Date,this.onChange=m=>{},this.onTouched=m=>{}}writeValue(a){this.value=a,this.cdRef.markForCheck()}onToggle(a){this.writeValue(a),this.onChange(a),this.onTouched(a)}registerOnChange(a){this.onChange=a}registerOnTouched(a){this.onTouched=a}}n.\u0275fac=function(a){return new(a||n)(i.Y36(i.sBO))},n.\u0275cmp=i.Xpm({type:n,selectors:[["spot-toggle"]],hostVars:4,hostBindings:function(a,m){2&a&&i.ekj("form--field-inline-buttons-container",m.classNameOld)("spot-toggle",m.className)},inputs:{options:"options",disabled:"disabled",name:"name",value:"value"},outputs:{valueChange:"valueChange"},features:[i._Bn([{provide:e.JU,useExisting:(0,i.Gpc)(()=>n),multi:!0}])],decls:1,vars:1,consts:[["data-qa-selector","spot-toggle--option",3,"ngClass",4,"ngFor","ngForOf"],["data-qa-selector","spot-toggle--option",3,"ngClass"],["type","radio",1,"spot-toggle--option-input",3,"disabled","name","value","ngModel","ngModelChange"]],template:function(a,m){1&a&&i.YNc(0,r,3,11,"label",0),2&a&&i.Q6J("ngForOf",m.options)},directives:[d.sg,d.mk,e._,e.Fj,e.JJ,e.On],encapsulation:2,changeDetection:0})},48705:(X,I,t)=>{"use strict";t.d(I,{s:()=>a});var i=t(1706),e=t(2316),d=t(54364);const h=function(m){return["spot-tooltip--body","spot-container",m]};function r(m,v){if(1&m&&(e.TgZ(0,"div",1),e.Hsn(1,1),e.qZA()),2&m){const c=e.oxw();e.Q6J("ngClass",e.VKq(1,h,c.alignmentClass))}}const n=[[["","slot","trigger"]],[["","slot","body"]]];class a{constructor(){this.className=!0,this.dark=!1,this.disabled=!1,this.alignment=i.Z.BottomCenter}get alignmentClass(){return`spot-tooltip--body_${this.alignment}`}}a.\u0275fac=function(v){return new(v||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["spot-tooltip"]],hostVars:4,hostBindings:function(v,c){2&v&&e.ekj("spot-tooltip",c.className)("spot-tooltip_dark",c.dark)},inputs:{dark:"dark",disabled:"disabled",alignment:"alignment"},ngContentSelectors:["[slot=trigger]","[slot=body]"],decls:2,vars:1,consts:[[3,"ngClass",4,"ngIf"],[3,"ngClass"]],template:function(v,c){1&v&&(e.F$t(n),e.Hsn(0),e.YNc(1,r,2,3,"div",0)),2&v&&(e.xp6(1),e.Q6J("ngIf",!c.disabled))},directives:[d.O5,d.mk],encapsulation:2,changeDetection:0})},1706:(X,I,t)=>{"use strict";var i,d;t.d(I,{Z:()=>e}),(d=i||(i={})).TopLeft="top-left",d.TopCenter="top-center",d.TopRight="top-right",d.RightTop="right-top",d.RightCenter="right-center",d.RightBottom="right-bottom",d.BottomLeft="bottom-left",d.BottomCenter="bottom-center",d.BottomRight="bottom-right",d.LeftTop="left-top",d.LeftCenter="left-center",d.LeftBottom="left-bottom";const e=i},45921:(X,I,t)=>{"use strict";t.d(I,{s:()=>k});var i=t(1707),e=t(54364),d=t(84906),h=t(96617),r=t(2316),n=t(91448),l=t(1476);function a(O,y){if(1&O){const b=r.EpF();r.TgZ(0,"button",3),r.NdJ("click",function(){return r.CHM(b),r.oxw().remove.emit()}),r._UZ(1,"span",4),r.qZA()}if(2&O){const b=r.oxw();r.Q6J("disabled",b.disabled),r.uIk("aria-label",b.text.remove)}}function m(O,y){if(1&O&&r._UZ(0,"span",5),2&O){const b=r.oxw();r.Q6J("ngClass",b.iconClasses)}}class v{constructor(y){this.i18n=y,this.className=!0,this.disabled=!1,this.removable=!0,this.title="",this.icon="",this.remove=new r.vpe,this.text={remove:this.i18n.t("js.spot.filter_chip.remove")}}get iconClasses(){return["spot-icon",`spot-icon_${this.icon}`]}}v.\u0275fac=function(y){return new(y||v)(r.Y36(h.D))},v.\u0275cmp=r.Xpm({type:v,selectors:[["spot-filter-chip"]],hostVars:4,hostBindings:function(y,b){2&y&&r.ekj("spot-filter-chip",b.className)("spot-filter-chip_disabled",b.disabled)},inputs:{disabled:"disabled",removable:"removable",title:"title",icon:"icon"},outputs:{remove:"remove"},decls:4,vars:3,consts:[["class","spot-filter-chip--remove","type","button",3,"disabled","click",4,"ngIf"],[1,"spot-filter-chip--title"],[3,"ngClass",4,"ngIf"],["type","button",1,"spot-filter-chip--remove",3,"disabled","click"],[1,"spot-icon","spot-icon_close"],[3,"ngClass"]],template:function(y,b){1&y&&(r.YNc(0,a,2,2,"button",0),r.TgZ(1,"div",1),r.YNc(2,m,1,1,"span",2),r._uU(3),r.qZA()),2&y&&(r.Q6J("ngIf",b.removable),r.xp6(2),r.Q6J("ngIf",b.icon),r.xp6(1),r.hij(" ",b.title,"\n"))},directives:[e.O5,e.mk],encapsulation:2});var c=t(87912),p=t(21090),f=t(48705);class C{constructor(){this.indeterminateState=null,this.checkboxValue=null,this.listCheckboxValue=null,this.textFieldValue="ngModel value",this.dropModalOpen=!1,this.dropModalAlignment="bottom-left",this.tooltipAlignment="right-center",this.toggleValue=null,this.toggleOptions=[{value:1,title:"1"},{value:2,title:"2"},{value:3,title:"3"}]}onRemoveChip(){alert("Remove chip")}checkboxValueString(){return null===this.checkboxValue?"null (indeterminate)":this.checkboxValue?"true (checked)":"false (unchecked)"}}C.\u0275fac=function(y){return new(y||C)},C.\u0275cmp=r.Xpm({type:C,selectors:[["spot-docs"]],decls:404,vars:51,consts:[[1,"space-children"],[1,"spot-button"],[1,"spot-icon","spot-icon_bell"],[1,"spot-button","spot-button_main"],[1,"spot-button","spot-button_accent"],[1,"spot-button","spot-button_danger"],["disabled","",1,"spot-button"],[1,"spot-button","spot-button_outlined"],[1,"spot-button","spot-button_outlined","spot-button_main"],[1,"spot-button","spot-button_outlined","spot-button_accent"],[1,"spot-button","spot-button_outlined","spot-button_danger"],["disabled","",1,"spot-button","spot-button_outlined"],[1,"spot-link"],["href","#",1,"spot-link"],[1,"spot-link","spot-link_danger"],["href","#",1,"spot-link","spot-link_danger"],[3,"options","ngModel","ngModelChange"],[3,"checked"],[3,"disabled"],[3,"checked","disabled"],[3,"ngModel","ngModelChange"],["name","checkbox-name",3,"ngModel","disabled","ngModelChange"],[1,"spot-list"],[1,"spot-list--item"],[1,"spot-list--item-action"],[1,"spot-list--item-title"],[1,"spot-list--item-floating-wrapper"],[1,"spot-list--item-floating-actions"],[1,"spot-icon","spot-icon_folder-open"],[1,"spot-icon","spot-icon_external-link"],[1,"spot-icon","spot-icon_file-doc"],[1,"spot-list--item-action","spot-list--item-action_disabled"],[3,"ngModel","disabled","ngModelChange"],[1,"spot-list","spot-list_compact"],["title","Default chip",3,"remove"],["title","Unremovable chip",3,"removable"],["title","Default chip with icon","icon","bell",3,"remove"],["icon","bell","title","Unremovable chip with icon",3,"removable"],["title","Default chip",3,"disabled","remove"],["title","Unremovable chip",3,"removable","disabled"],["title","Default chip with icon","icon","bell",3,"disabled","remove"],["icon","bell","title","Unremovable chip with icon",3,"removable","disabled"],["placeholder","Placeholder value",1,"spot-text-field"],["value","Test value",1,"spot-text-field"],["placeholder","Placeholder value","value","Test value","name","textfield-name"],["placeholder","Placeholder value",3,"ngModel","ngModelChange"],["slot","after",1,"spot-icon","spot-icon_bell"],["slot","before",1,"spot-icon","spot-icon_bell"],[3,"open","alignment","closed"],["slot","trigger","type","button",1,"spot-button","spot-button_main",3,"click"],["slot","body"],[1,"spot-container"],[1,"spot-header-small"],[3,"alignment"],["slot","trigger"],["slot","body",1,"spot-body-small"],[1,"spot-body-small"],[3,"alignment","dark"],[1,"spot-action-bar"],[1,"spot-action-bar--left"],[1,"spot-button","spot-button_outlined","spot-button_main","spot-action-bar--action"],[1,"spot-action-bar--right"],[1,"spot-button","spot-button_main","spot-action-bar--action"],[1,"spot-modal"],[1,"spot-modal--header"],[1,"spot-modal--body","spot-container"],[1,"spot-button","spot-button_danger","spot-action-bar--action"],[1,"spot-icon","spot-icon_delete"],[1,"spot-modal","spot-modal_wide"],[1,"spot-icon","spot-icon_help1"],[1,"spot-divider"]],template:function(y,b){1&y&&(r.TgZ(0,"h1"),r._uU(1,"Buttons & Links"),r.qZA(),r.TgZ(2,"section",0),r.TgZ(3,"button",1),r._uU(4,"Default"),r.qZA(),r.TgZ(5,"button",1),r.TgZ(6,"span"),r._uU(7,"Default"),r.qZA(),r._UZ(8,"span",2),r.qZA(),r.TgZ(9,"button",1),r._UZ(10,"span",2),r.qZA(),r.qZA(),r.TgZ(11,"section",0),r.TgZ(12,"button",3),r._uU(13,"Main"),r.qZA(),r.TgZ(14,"button",3),r.TgZ(15,"span"),r._uU(16,"Main"),r.qZA(),r._UZ(17,"span",2),r.qZA(),r.TgZ(18,"button",3),r._UZ(19,"span",2),r.qZA(),r.qZA(),r.TgZ(20,"section",0),r.TgZ(21,"button",4),r._uU(22,"Accent"),r.qZA(),r.TgZ(23,"button",4),r.TgZ(24,"span"),r._uU(25,"Accent"),r.qZA(),r._UZ(26,"span",2),r.qZA(),r.TgZ(27,"button",4),r._UZ(28,"span",2),r.qZA(),r.qZA(),r.TgZ(29,"section",0),r.TgZ(30,"button",5),r._uU(31,"Danger"),r.qZA(),r.TgZ(32,"button",5),r.TgZ(33,"span"),r._uU(34,"Danger"),r.qZA(),r._UZ(35,"span",2),r.qZA(),r.TgZ(36,"button",5),r._UZ(37,"span",2),r.qZA(),r.qZA(),r.TgZ(38,"section",0),r.TgZ(39,"button",6),r._uU(40,"Disabled"),r.qZA(),r.TgZ(41,"button",6),r.TgZ(42,"span"),r._uU(43,"Disabled"),r.qZA(),r._UZ(44,"span",2),r.qZA(),r.TgZ(45,"button",6),r._UZ(46,"span",2),r.qZA(),r.qZA(),r.TgZ(47,"section",0),r.TgZ(48,"button",7),r._uU(49,"Default"),r.qZA(),r.TgZ(50,"button",8),r._uU(51,"Main"),r.qZA(),r.TgZ(52,"button",9),r._uU(53,"Accent"),r.qZA(),r.TgZ(54,"button",10),r._uU(55,"Danger"),r.qZA(),r.TgZ(56,"button",11),r._uU(57,"Disabled"),r.qZA(),r.qZA(),r.TgZ(58,"section",0),r.TgZ(59,"button",12),r._uU(60,"Default link"),r.qZA(),r.TgZ(61,"a",13),r.TgZ(62,"span"),r._uU(63,"Default Link"),r.qZA(),r._UZ(64,"span",2),r.qZA(),r.TgZ(65,"a",13),r._UZ(66,"span",2),r.TgZ(67,"span"),r._uU(68,"Default Link"),r.qZA(),r.qZA(),r.TgZ(69,"button",12),r._UZ(70,"span",2),r.qZA(),r.qZA(),r.TgZ(71,"section",0),r.TgZ(72,"button",14),r._uU(73,"Danger Link"),r.qZA(),r.TgZ(74,"a",15),r.TgZ(75,"span"),r._uU(76,"Danger Link"),r.qZA(),r._UZ(77,"span",2),r.qZA(),r.TgZ(78,"a",15),r._UZ(79,"span",2),r.TgZ(80,"span"),r._uU(81,"Danger Link"),r.qZA(),r.qZA(),r.TgZ(82,"button",14),r._UZ(83,"span",2),r.qZA(),r.qZA(),r.TgZ(84,"h1"),r._uU(85,"Toggles"),r.qZA(),r.TgZ(86,"spot-toggle",16),r.NdJ("ngModelChange",function(E){return b.toggleValue=E}),r.qZA(),r._uU(87),r.TgZ(88,"h1"),r._uU(89,"Checkbox"),r.qZA(),r.TgZ(90,"label"),r._UZ(91,"spot-checkbox"),r._uU(92," Unchecked\n"),r.qZA(),r.TgZ(93,"label"),r._UZ(94,"spot-checkbox",17),r._uU(95," Checked\n"),r.qZA(),r.TgZ(96,"label"),r._UZ(97,"spot-checkbox",18),r._uU(98," Disabled\n"),r.qZA(),r.TgZ(99,"label"),r._UZ(100,"spot-checkbox",19),r._uU(101," Disabled checked\n"),r.qZA(),r.TgZ(102,"label"),r.TgZ(103,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.checkboxValue=E}),r.qZA(),r._uU(104),r.qZA(),r.TgZ(105,"label"),r.TgZ(106,"spot-checkbox",21),r.NdJ("ngModelChange",function(E){return b.checkboxValue=E}),r.qZA(),r._uU(107),r.qZA(),r.TgZ(108,"h1"),r._uU(109,"Lists"),r.qZA(),r.TgZ(110,"h2"),r._uU(111,"Normal list"),r.qZA(),r.TgZ(112,"p"),r._uU(113,"HINT: To enable floating actions on hover, every "),r.TgZ(114,"i"),r._uU(115,"spot-list--item"),r.qZA(),r._uU(116," needs a "),r.TgZ(117,"i"),r._uU(118,"spot-list--item-floating-wrapper"),r.qZA(),r._uU(119,", which wraps the item's content and the "),r.TgZ(120,"i"),r._uU(121,"spot-list-item-floating-actions"),r.qZA(),r._uU(122,", but not any sub lists. This way, floating actions on hover are defined specific for each item, hence in the same list items with floating actions can be right next to items without."),r.qZA(),r.TgZ(123,"ul",22),r.TgZ(124,"li",23),r.TgZ(125,"label",24),r.TgZ(126,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(127,"div",25),r._uU(128,"Checkbox item"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(129,"li",23),r.TgZ(130,"div",26),r.TgZ(131,"label",24),r.TgZ(132,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(133,"div",25),r._uU(134,"Checkbox item with hover menu"),r.qZA(),r.qZA(),r.TgZ(135,"div",27),r.TgZ(136,"button",12),r._UZ(137,"span",28),r.qZA(),r.TgZ(138,"button",12),r._UZ(139,"span",29),r.qZA(),r.TgZ(140,"button",12),r._UZ(141,"span",30),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(142,"li",23),r.TgZ(143,"label",24),r.TgZ(144,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(145,"div",25),r._uU(146,"Checkbox item with children"),r.qZA(),r.qZA(),r.TgZ(147,"ul",22),r.TgZ(148,"li",23),r.TgZ(149,"div",26),r.TgZ(150,"label",24),r.TgZ(151,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(152,"div",25),r._uU(153,"Child checkbox item"),r.qZA(),r.qZA(),r.TgZ(154,"div",27),r.TgZ(155,"button",12),r._UZ(156,"span",28),r.qZA(),r.TgZ(157,"button",12),r._UZ(158,"span",30),r.qZA(),r.qZA(),r.qZA(),r.TgZ(159,"ul",22),r.TgZ(160,"li",23),r.TgZ(161,"label",24),r.TgZ(162,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(163,"div",25),r._uU(164,"Second level child"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(165,"li",23),r.TgZ(166,"label",24),r.TgZ(167,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(168,"div",25),r._uU(169,"Second child checkbox item"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(170,"li",23),r.TgZ(171,"div",26),r.TgZ(172,"label",24),r.TgZ(173,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(174,"div",25),r._uU(175,"Second child checkbox item with hover menu"),r.qZA(),r.qZA(),r.TgZ(176,"div",27),r.TgZ(177,"button",12),r._UZ(178,"span",28),r.qZA(),r.TgZ(179,"button",12),r._UZ(180,"span",30),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(181,"li",23),r.TgZ(182,"label",31),r.TgZ(183,"spot-checkbox",32),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(184,"div",25),r._uU(185,"Disabled item"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(186,"h2"),r._uU(187,"Compact list"),r.qZA(),r.TgZ(188,"ul",33),r.TgZ(189,"li",23),r.TgZ(190,"label",24),r.TgZ(191,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(192,"div",25),r._uU(193,"Checkbox item"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(194,"li",23),r.TgZ(195,"div",26),r.TgZ(196,"label",24),r.TgZ(197,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(198,"div",25),r._uU(199,"Checkbox item with hover menu"),r.qZA(),r.qZA(),r.TgZ(200,"div",27),r.TgZ(201,"button",12),r._UZ(202,"span",28),r.qZA(),r.TgZ(203,"button",12),r._UZ(204,"span",29),r.qZA(),r.TgZ(205,"button",12),r._UZ(206,"span",30),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(207,"li",23),r.TgZ(208,"label",24),r.TgZ(209,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(210,"div",25),r._uU(211,"Checkbox item with children"),r.qZA(),r.qZA(),r.TgZ(212,"ul",33),r.TgZ(213,"li",23),r.TgZ(214,"div",26),r.TgZ(215,"label",24),r.TgZ(216,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(217,"div",25),r._uU(218,"Child checkbox item"),r.qZA(),r.qZA(),r.TgZ(219,"div",27),r.TgZ(220,"button",12),r._UZ(221,"span",28),r.qZA(),r.TgZ(222,"button",12),r._UZ(223,"span",30),r.qZA(),r.qZA(),r.qZA(),r.TgZ(224,"ul",33),r.TgZ(225,"li",23),r.TgZ(226,"label",24),r.TgZ(227,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(228,"div",25),r._uU(229,"Second level child"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(230,"li",23),r.TgZ(231,"label",24),r.TgZ(232,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(233,"div",25),r._uU(234,"Second child checkbox item"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(235,"li",23),r.TgZ(236,"div",26),r.TgZ(237,"label",24),r.TgZ(238,"spot-checkbox",20),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(239,"div",25),r._uU(240,"Second child checkbox item with hover menu"),r.qZA(),r.qZA(),r.TgZ(241,"div",27),r.TgZ(242,"button",12),r._UZ(243,"span",28),r.qZA(),r.TgZ(244,"button",12),r._UZ(245,"span",30),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(246,"li",23),r.TgZ(247,"label",31),r.TgZ(248,"spot-checkbox",32),r.NdJ("ngModelChange",function(E){return b.listCheckboxValue=E}),r.qZA(),r.TgZ(249,"div",25),r._uU(250,"Disabled item"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(251,"h1"),r._uU(252,"Filter Chip"),r.qZA(),r.TgZ(253,"section",0),r.TgZ(254,"spot-filter-chip",34),r.NdJ("remove",function(){return b.onRemoveChip()}),r.qZA(),r._UZ(255,"spot-filter-chip",35),r.TgZ(256,"spot-filter-chip",36),r.NdJ("remove",function(){return b.onRemoveChip()}),r.qZA(),r._UZ(257,"spot-filter-chip",37),r.qZA(),r.TgZ(258,"section",0),r.TgZ(259,"spot-filter-chip",38),r.NdJ("remove",function(){return b.onRemoveChip()}),r.qZA(),r._UZ(260,"spot-filter-chip",39),r.TgZ(261,"spot-filter-chip",40),r.NdJ("remove",function(){return b.onRemoveChip()}),r.qZA(),r._UZ(262,"spot-filter-chip",41),r.qZA(),r.TgZ(263,"h1"),r._uU(264,"Text Field"),r.qZA(),r.TgZ(265,"section",0),r._UZ(266,"input",42),r._UZ(267,"input",43),r._UZ(268,"spot-text-field",44),r.TgZ(269,"spot-text-field",45),r.NdJ("ngModelChange",function(E){return b.textFieldValue=E}),r.qZA(),r.TgZ(270,"spot-text-field",45),r.NdJ("ngModelChange",function(E){return b.textFieldValue=E}),r._UZ(271,"span",46),r.qZA(),r.TgZ(272,"spot-text-field",45),r.NdJ("ngModelChange",function(E){return b.textFieldValue=E}),r._UZ(273,"span",47),r._UZ(274,"span",46),r.qZA(),r.TgZ(275,"spot-text-field",45),r.NdJ("ngModelChange",function(E){return b.textFieldValue=E}),r._UZ(276,"span",47),r.qZA(),r.qZA(),r.TgZ(277,"h1"),r._uU(278,"Drop Modal"),r.qZA(),r.TgZ(279,"select",20),r.NdJ("ngModelChange",function(E){return b.dropModalAlignment=E}),r.TgZ(280,"option"),r._uU(281,"left-top"),r.qZA(),r.TgZ(282,"option"),r._uU(283,"left-center"),r.qZA(),r.TgZ(284,"option"),r._uU(285,"left-bottom"),r.qZA(),r.TgZ(286,"option"),r._uU(287,"top-left"),r.qZA(),r.TgZ(288,"option"),r._uU(289,"top-center"),r.qZA(),r.TgZ(290,"option"),r._uU(291,"top-right"),r.qZA(),r.TgZ(292,"option"),r._uU(293,"right-top"),r.qZA(),r.TgZ(294,"option"),r._uU(295,"right-center"),r.qZA(),r.TgZ(296,"option"),r._uU(297,"right-bottom"),r.qZA(),r.TgZ(298,"option"),r._uU(299,"bottom-left"),r.qZA(),r.TgZ(300,"option"),r._uU(301,"bottom-center"),r.qZA(),r.TgZ(302,"option"),r._uU(303,"bottom-right"),r.qZA(),r.qZA(),r.TgZ(304,"spot-drop-modal",48),r.NdJ("closed",function(){return b.dropModalOpen=!1}),r.TgZ(305,"button",49),r.NdJ("click",function(){return b.dropModalOpen=!b.dropModalOpen}),r._uU(306,"Open Modal "),r.qZA(),r.ynx(307,50),r.TgZ(308,"div",51),r.TgZ(309,"h1",52),r._uU(310,"Test"),r.qZA(),r.TgZ(311,"spot-text-field",45),r.NdJ("ngModelChange",function(E){return b.textFieldValue=E}),r._UZ(312,"span",47),r.qZA(),r.qZA(),r.BQk(),r.qZA(),r.TgZ(313,"h1"),r._uU(314,"Tooltip"),r.qZA(),r.TgZ(315,"section",0),r.TgZ(316,"select",20),r.NdJ("ngModelChange",function(E){return b.tooltipAlignment=E}),r.TgZ(317,"option"),r._uU(318,"left-top"),r.qZA(),r.TgZ(319,"option"),r._uU(320,"left-center"),r.qZA(),r.TgZ(321,"option"),r._uU(322,"left-bottom"),r.qZA(),r.TgZ(323,"option"),r._uU(324,"top-left"),r.qZA(),r.TgZ(325,"option"),r._uU(326,"top-center"),r.qZA(),r.TgZ(327,"option"),r._uU(328,"top-right"),r.qZA(),r.TgZ(329,"option"),r._uU(330,"right-top"),r.qZA(),r.TgZ(331,"option"),r._uU(332,"right-center"),r.qZA(),r.TgZ(333,"option"),r._uU(334,"right-bottom"),r.qZA(),r.TgZ(335,"option"),r._uU(336,"bottom-left"),r.qZA(),r.TgZ(337,"option"),r._uU(338,"bottom-center"),r.qZA(),r.TgZ(339,"option"),r._uU(340,"bottom-right"),r.qZA(),r.qZA(),r.TgZ(341,"spot-tooltip",53),r.ynx(342,54),r._uU(343,"Trigger"),r.BQk(),r.TgZ(344,"p",55),r._uU(345,"Body"),r.qZA(),r.qZA(),r.TgZ(346,"spot-tooltip",53),r.ynx(347,54),r._uU(348,"Trigger"),r.BQk(),r.ynx(349,50),r.TgZ(350,"p",56),r._uU(351,"Body with multiple paragraphs coming in here"),r.qZA(),r.TgZ(352,"p",56),r._uU(353,"This is the second paragraph"),r.qZA(),r.BQk(),r.qZA(),r.TgZ(354,"spot-tooltip",57),r.ynx(355,54),r._uU(356,"Dark tooltip trigger"),r.BQk(),r.ynx(357,50),r.TgZ(358,"p",56),r._uU(359,"This is a dark tooltip"),r.qZA(),r.BQk(),r.qZA(),r.qZA(),r.TgZ(360,"h1"),r._uU(361,"Action Bar"),r.qZA(),r.TgZ(362,"div",58),r.TgZ(363,"div",59),r.TgZ(364,"button",60),r._uU(365," Independent action "),r.qZA(),r.qZA(),r.TgZ(366,"div",61),r.TgZ(367,"button",60),r._uU(368," Some Action "),r.qZA(),r.TgZ(369,"button",62),r._uU(370," Another Action "),r.qZA(),r.qZA(),r.qZA(),r.TgZ(371,"h1"),r._uU(372,"Modals"),r.qZA(),r.TgZ(373,"div",63),r.TgZ(374,"div",64),r._uU(375,"Default size modal"),r.qZA(),r.TgZ(376,"div",65),r.TgZ(377,"p",56),r._uU(378,"Here is some text in the body. Additionally this is a destructive action."),r.qZA(),r.qZA(),r.TgZ(379,"div",58),r.TgZ(380,"div",61),r.TgZ(381,"button",60),r._uU(382," Cancel "),r.qZA(),r.TgZ(383,"button",66),r._UZ(384,"span",67),r.TgZ(385,"span"),r._uU(386,"Delete"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(387,"div",68),r.TgZ(388,"div",64),r._UZ(389,"span",69),r.TgZ(390,"span"),r._uU(391,"Wide modal"),r.qZA(),r.qZA(),r._UZ(392,"div",70),r.TgZ(393,"div",65),r.TgZ(394,"p",56),r._uU(395,"Here is some text in the body."),r.qZA(),r.TgZ(396,"p",56),r._uU(397,"But this modal has a minimal height!"),r.qZA(),r.qZA(),r.TgZ(398,"div",58),r.TgZ(399,"div",61),r.TgZ(400,"span"),r._uU(401,"Some explanatory text."),r.qZA(),r.TgZ(402,"button",62),r._uU(403," OK "),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&y&&(r.xp6(86),r.Q6J("options",b.toggleOptions)("ngModel",b.toggleValue),r.xp6(1),r.hij("\nCurrently selected value is ",b.toggleValue," "),r.xp6(7),r.Q6J("checked",!0),r.xp6(3),r.Q6J("disabled",!0),r.xp6(3),r.Q6J("checked",!0)("disabled",!0),r.xp6(3),r.Q6J("ngModel",b.checkboxValue),r.xp6(1),r.hij(" Currently ",b.checkboxValueString(),"\n"),r.xp6(2),r.Q6J("ngModel",b.checkboxValue)("disabled",!0),r.xp6(1),r.hij(" Currently ",b.checkboxValueString(),"\n"),r.xp6(19),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(6),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(12),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(7),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(11),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(5),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(6),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(10),r.Q6J("ngModel",b.listCheckboxValue)("disabled",!0),r.xp6(8),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(6),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(12),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(7),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(11),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(5),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(6),r.Q6J("ngModel",b.listCheckboxValue),r.xp6(10),r.Q6J("ngModel",b.listCheckboxValue)("disabled",!0),r.xp6(7),r.Q6J("removable",!1),r.xp6(2),r.Q6J("removable",!1),r.xp6(2),r.Q6J("disabled",!0),r.xp6(1),r.Q6J("removable",!1)("disabled",!0),r.xp6(1),r.Q6J("disabled",!0),r.xp6(1),r.Q6J("removable",!1)("disabled",!0),r.xp6(7),r.Q6J("ngModel",b.textFieldValue),r.xp6(1),r.Q6J("ngModel",b.textFieldValue),r.xp6(2),r.Q6J("ngModel",b.textFieldValue),r.xp6(3),r.Q6J("ngModel",b.textFieldValue),r.xp6(4),r.Q6J("ngModel",b.dropModalAlignment),r.xp6(25),r.Q6J("open",b.dropModalOpen)("alignment",b.dropModalAlignment),r.xp6(7),r.Q6J("ngModel",b.textFieldValue),r.xp6(5),r.Q6J("ngModel",b.tooltipAlignment),r.xp6(25),r.Q6J("alignment",b.tooltipAlignment),r.xp6(5),r.Q6J("alignment",b.tooltipAlignment),r.xp6(8),r.Q6J("alignment",b.tooltipAlignment)("dark",!0))},directives:[n.v,i.JJ,i.On,l.B,v,c.A,i.EJ,i.YN,i.Kr,p.m,f.s],styles:[".space-children{display:flex;flex-wrap:wrap}.space-children>*{margin:.5rem}#content,#content-wrapper{background-color:#eee}\n","\n  #content-wrapper {\n    background-color: #eee;\n  }\n"],encapsulation:2});const u=[{name:"styleguide",parent:"root",url:"/design/spot",views:{"!$default":{component:C}}}];class k{}k.\u0275fac=function(y){return new(y||k)},k.\u0275mod=r.oAB({type:k}),k.\u0275inj=r.cJS({providers:[h.D],imports:[[d.UIRouterModule.forChild({states:u}),i.u5,e.ez]]})},92340:(X,I,t)=>{"use strict";t.d(I,{N:()=>i});const i={production:!0}},8296:(X,I,t)=>{"use strict";var i=t(71570),e=t(2316),d=t(1707),h=t(87853),r=t(2246),n=t(21757),l=t(45921),a=t(80261),m=t(7794),v=t(31283),c=t(97779),p=t(32853),f=t(53448),C=t(55811),u=t(51303),k=t(80395),O=t(49369),y=t(96617),b=t(65146);class P{constructor(o,s,w,j){this.startRow=o,this.endRow=s,this.startColumn=w,this.endColumn=j}get gridStartRow(){return 2*this.startRow}get gridEndRow(){return 2*this.endRow-1}get gridStartColumn(){return 2*this.startColumn}get gridEndColumn(){return 2*this.endColumn-1}get guid(){return this.storedGuid||(this.storedGuid=this.newGuid()),this.storedGuid}newGuid(){function o(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return`${o()+o()}-${o()}-${o()}-${o()}-${o()}${o()}${o()}`}}class E extends P{constructor(o){super(o.startRow,o.endRow,o.startColumn,o.endColumn),this.widget=o}reset(){this.startRow=this.widget.startRow,this.endRow=this.widget.endRow,this.startColumn=this.widget.startColumn,this.endColumn=this.widget.endColumn}moveRight(){this.startColumn++,this.endColumn++}moveLeft(){this.startColumn--,this.endColumn--}growColumn(){this.endColumn++}overlaps(o){return this.rowOverlaps(o)&&this.columnOverlaps(o)}rowOverlaps(o){return this.startRow<o.endRow&&this.endRow>=o.endRow||this.startRow<=o.startRow&&this.endRow>o.startRow||this.startRow>o.startRow&&this.endRow<o.endRow}columnOverlaps(o){return this.startColumn<o.endColumn&&this.endColumn>=o.endColumn||this.startColumn<=o.startColumn&&this.endColumn>o.startColumn||this.startColumn>o.startColumn&&this.endColumn<o.endColumn}startColumnOverlaps(o){return this.startColumn<o.startColumn&&this.endColumn>o.startColumn&&this.rowOverlaps(o)}get unchangedSize(){return this.startColumn===this.widget.startColumn&&this.endColumn===this.widget.endColumn&&this.startRow===this.widget.startRow&&this.endRow===this.widget.endRow}writeAreaChangeToWidget(){this.widget.startRow=this.startRow,this.widget.endRow=this.endRow,this.widget.startColumn=this.startColumn,this.widget.endColumn=this.endColumn}copyDimensionsTo(o){o.startRow=this.startRow,o.startColumn=this.startColumn,o.endRow=this.endRow,o.endColumn=this.endColumn}}class T extends P{constructor(o,s,w,j,ee){super(o,s,w,j),this.type=ee}get gridStartRow(){return this.isRow?2*this.startRow-1:2*this.startRow}get gridEndRow(){return this.isRow?2*this.endRow-2:2*this.endRow-1}get gridStartColumn(){return this.isRow?2*this.startColumn:2*this.startColumn-1}get gridEndColumn(){return this.isRow?2*this.endColumn-1:2*this.endColumn-2}get isRow(){return"row"===this.type}get isColumn(){return"column"===this.type}}var M=t(36293),S=t(76491),R=t(61908),F=t(71909);class L{constructor(o,s,w){this.apiV3Service=o,this.toastService=s,this.i18n=w,this.numColumns=0,this.numRows=0,this.mousedOverArea=null,this.$mousedOverArea=new S.X(this.mousedOverArea),this.helpMode=!1}set gridResource(o){this.resource=o,this.fetchSchema(),this.numRows=this.resource.rowCount,this.numColumns=this.resource.columnCount,this.buildAreas(!0)}get gridResource(){return this.resource}setMousedOverArea(o){this.mousedOverArea=o,this.$mousedOverArea.next(o)}cleanupUnusedAreas(){let o=_.range(this.numRows,0,-1);this.widgetAreas.forEach(w=>{o=o.filter(j=>j!==w.startRow)}),o.forEach(w=>{this.numRows>1&&this.removeRow(w)});let s=_.range(this.numColumns,0,-1);this.widgetAreas.forEach(w=>{s=s.filter(j=>j!==w.startColumn)}),s.forEach(w=>{this.numColumns>1&&this.removeColumn(w)})}buildAreas(o=!1){this.gridAreas=this.buildGridAreas(),this.gridGaps=this.buildGridGaps(),this.gridAreaIds=this.buildGridAreaIds(),o&&(this.widgetAreas=this.buildGridWidgetAreas())}rebuildAndPersist(){this.persist(),this.buildAreas(!1)}persist(){this.resource.rowCount=this.numRows=(this.widgetAreas.map(o=>o.endRow).sort((o,s)=>o-s).pop()||2)-1,this.resource.columnCount=this.numColumns,this.writeAreaChangesToWidgets(),this.saveGrid(this.resource,this.schema)}saveWidgetChangeset(o){const s=F.E.extractPayload(this.resource,this.schema),w=s.widgets.find(j=>j.id===o.pristineResource.id);Object.assign(w,o.changes),s.id=this.resource.id,this.saveGrid(s)}isGap(o){return o instanceof T}get isSingleCell(){return 1===this.numRows&&1===this.numColumns&&0===this.widgetResources.length}get inHelpMode(){return this.helpMode||this.isSingleCell}toggleHelpMode(){this.helpMode=!this.helpMode}scrollPlaceholderIntoView(){const o=jQuery(".grid--area.-placeholder");o[0].scrollIntoViewIfNeeded&&setTimeout(()=>o[0].scrollIntoViewIfNeeded())}saveGrid(o,s){this.apiV3Service.grids.id(o).patch(o,s).subscribe(w=>{this.assignAreasWidget(w),this.toastService.addSuccess(this.i18n.t("js.notice_successful_update"))})}assignAreasWidget(o){this.resource.widgets=o.widgets;const s=this.widgetAreas.map(w=>w.widget.id);this.widgetAreas.forEach(w=>{let j;j=w.widget.id?o.widgets.find(ee=>ee.id===w.widget.id):o.widgets.find(ee=>!s.includes(ee.id)&&ee.identifier===w.widget.identifier&&ee.startRow===w.widget.startRow&&ee.startColumn===w.widget.startColumn),w.widget=j})}buildGridAreas(){const o=[];for(let s=1;s<=this.numRows+1;s++)o.push(...this.buildGridAreasRow(s));return o}buildGridGaps(){const o=[];if(this.isSingleCell)return o;for(let s=1;s<=this.numRows+1;s++)o.push(...this.buildGridGapRow(s));return o}buildGridAreasRow(o){const s=[];for(let w=1;w<=this.numColumns;w++){const j=new P(o,o+1,w,w+1);s.push(j)}return s}buildGridGapRow(o){const s=[];for(let w=1;w<=this.numColumns;w++)s.push(new T(o,o+1,w,w+1,"row"));if(o<=this.numRows)for(let w=1;w<=this.numColumns+1;w++)s.push(new T(o,o+1,w,w+1,"column"));return s}buildGridWidgetAreas(){return this.widgetResources.map(o=>new E(o))}writeAreaChangesToWidgets(){this.widgetAreas.forEach(o=>{o.writeAreaChangeToWidget()})}addColumn(o,s){this.numColumns++;const w=[];for(let j=1;j<=this.numRows;j++){if(j===s)continue;const ee=this.rowWidgets(j).sort((me,De)=>me.startColumn-De.startColumn).find(me=>!(me.startRow<s&&me.endRow>s)&&(me.startColumn===o+1||me.endColumn===o+1||me.startColumn<=o&&me.endColumn>o));ee&&(w.push(ee),ee.endColumn++)}this.moveSubsequentRowWidgets(this.widgetAreas.filter(j=>!w.includes(j)),o)}addRow(o,s){this.numRows++;const w=[];for(let j=1;j<=this.numColumns;j++){if(j===s)continue;const ee=this.columnWidgets(j).sort((me,De)=>me.startRow-De.startRow).find(me=>!(me.startColumn<s&&me.endColumn>s)&&(me.startRow===o+1||me.endRow===o+1||me.startRow<=o&&me.endRow>o));ee&&(w.push(ee),ee.endRow++)}this.moveSubsequentColumnWidgets(this.widgetAreas.filter(j=>!w.includes(j)),o)}removeColumn(o){this.numColumns--,this.widgetAreas.forEach(s=>{s.startColumn<=o&&s.endColumn>=o+1&&s.endColumn--}),this.widgetAreas.filter(s=>s.startColumn>o).forEach(s=>{s.startColumn--,s.endColumn--})}removeRow(o){this.numRows--,this.widgetAreas.forEach(s=>{s.startRow<=o&&s.endRow>=o+1&&s.endRow--}),this.widgetAreas.filter(s=>s.startRow>o).forEach(s=>{s.startRow--,s.endRow--})}resetAreas(o=null){this.widgetAreas.filter(s=>!o||s.guid!==o.guid).forEach(s=>s.reset()),this.numRows=this.resource.rowCount,this.numColumns=this.resource.columnCount}get isEditable(){return void 0!==this.gridResource.updateImmediately}buildGridAreaIds(){return this.gridAreas.filter(o=>!this.isGap(o)).map(o=>o.guid)}fetchSchema(){this.apiV3Service.grids.id(this.resource).form.post({}).subscribe(o=>this.schema=o.schema)}removeWidget(o){let s=this.resource.widgets.findIndex(w=>w.id===o.id);this.resource.widgets.splice(s,1),s=this.widgetAreas.findIndex(w=>w.widget.id===o.id),this.widgetAreas.splice(s,1),this.cleanupUnusedAreas(),this.rebuildAndPersist()}get widgetResources(){return this.resource&&this.resource.widgets||[]}rowWidgets(o){return this.widgetAreas.filter(s=>s.startRow===o)}moveSubsequentRowWidgets(o,s){o.forEach(w=>{w.startColumn>s&&(w.startColumn++,w.endColumn++)})}columnWidgets(o){return this.widgetAreas.filter(s=>s.startColumn===o)}moveSubsequentColumnWidgets(o,s){o.forEach(w=>{w.startRow>s&&(w.startRow++,w.endRow++)})}}L.\u0275fac=function(o){return new(o||L)(e.LFG(R.T),e.LFG(M.kl),e.LFG(y.D))},L.\u0275prov=e.Yz7({token:L,factory:L.\u0275fac});var D=t(54364),G=t(77616);const Q=[[["","slot","prepend"]],[["","slot","menu"]]],V=function(g){return{"-editable":g}};class q{constructor(o){this.layout=o,this.editable=!0,this.onRenamed=new e.vpe}renamed(o){this.onRenamed.emit(o)}get isRenameable(){return this.editable&&this.layout.isEditable}}q.\u0275fac=function(o){return new(o||q)(e.Y36(L))},q.\u0275cmp=e.Xpm({type:q,selectors:[["widget-header"]],inputs:{name:"name",editable:"editable"},outputs:{onRenamed:"onRenamed"},ngContentSelectors:["[slot=prepend]","[slot=menu]"],decls:4,vars:5,consts:[["data-qa-selector","op-widget-box--header",1,"op-widget-box--header",3,"ngClass"],[1,"op-widget-box--header-title",3,"title","editable","onSave"]],template:function(o,s){1&o&&(e.F$t(Q),e.TgZ(0,"h3",0),e.Hsn(1),e.TgZ(2,"editable-toolbar-title",1),e.NdJ("onSave",function(j){return s.renamed(j)}),e.qZA(),e.Hsn(3,1),e.qZA()),2&o&&(e.Q6J("ngClass",e.VKq(3,V,s.isRenameable)),e.xp6(2),e.Q6J("title",s.name)("editable",s.isRenameable))},directives:[D.mk,G.s5],styles:[".op-widget-box--header.-editable[_ngcontent-%COMP%]{margin-top:0}.op-widget-box--header-title[_ngcontent-%COMP%]{padding-right:5px}"],changeDetection:0});var se=t(3786);t(75421);class ie{constructor(o){this.layout=o}area(o){this.widget(o.widget)}widget(o){this.layout.removeWidget(o)}}ie.\u0275fac=function(o){return new(o||ie)(e.LFG(L))},ie.\u0275prov=e.Yz7({token:ie,factory:ie.\u0275fac});class le{constructor(o,s,w){this.i18n=o,this.remove=s,this.layout=w,this.menuItemList=[this.removeItem]}get menuItems(){return()=>(0,se.mG)(this,void 0,void 0,function*(){return this.menuItemList})}get removeItem(){return{linkText:this.i18n.t("js.grid.remove"),onClick:()=>(this.remove.widget(this.resource),!0)}}get hasMenu(){return this.layout.isEditable}}le.\u0275fac=function(o){return new(o||le)(e.Y36(y.D),e.Y36(ie),e.Y36(L))},le.\u0275dir=e.lG2({type:le,inputs:{resource:"resource"}});var oe=t(11269);function ne(g,o){if(1&g&&e._UZ(0,"icon-triggered-context-menu",1),2&g){const s=e.oxw();e.Q6J("menu-items",s.menuItems)}}class fe extends le{}fe.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(fe)))(s||fe)}}(),fe.\u0275cmp=e.Xpm({type:fe,selectors:[["widget-menu"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"menu-items",4,"ngIf"],[3,"menu-items"]],template:function(o,s){1&o&&e.YNc(0,ne,1,1,"icon-triggered-context-menu",0),2&o&&e.Q6J("ngIf",s.hasMenu)},directives:[D.O5,oe.I],styles:["[_nghost-%COMP%]{align-self:center}"]});var ve=t(97047),Se=t(15334);class Oe extends O._{constructor(o,s,w){super(o,s),this.i18n=o,this.injector=s,this.currentProject=w}get projectIdentifier(){return this.currentProject.identifier}}Oe.\u0275fac=function(o){return new(o||Oe)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(b.R))},Oe.\u0275cmp=e.Xpm({type:Oe,selectors:[["ng-component"]],features:[e.qOj],decls:4,vars:3,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource"],["wp-isolated-query-space",""],[3,"static"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(j){return s.renameWidget(j)}),e._UZ(1,"widget-menu",1),e.qZA(),e.ynx(2,2),e._UZ(3,"op-wp-calendar",3),e.BQk()),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("static",!0))},directives:[q,fe,ve.A,Se.X],encapsulation:2});var je=t(70233),tt=t(70692),He=t(77355),st=t(60312),Me=t(12877),ce=t(86469),J=t(62964);class W{getOrderedDaysData(o,s=moment.weekdays(!0),w=moment.localeData().firstDayOfWeek()){const j=w-1,ee=j>=0?o.splice(0,j):o.splice(j),me=j>=0?[...o,...ee]:[...ee,...o];return me.map((Je,qe)=>({weekDay:s[qe],checked:Je,originalIndex:this.getOriginalIndex(j,qe,me.length)}))}getOriginalIndex(o,s,w){let j=s+o;return j<0?j=w-1:j>=w&&(j=0),j}getCheckedValuesInOriginalOrder(o){const s=o.sort((w,j)=>w.originalIndex<j.originalIndex?-1:1).map(w=>w.checked);return this.validDays(s)}validDays(o){return o.every(s=>!s)?Array.apply(null,Array(7)).map(()=>!0):o}}function Y(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",9),e._UZ(1,"label",10),e.TgZ(2,"span",11),e.TgZ(3,"span",12),e.TgZ(4,"input",13),e.NdJ("ngModelChange",function(j){return e.CHM(s).$implicit.checked=j}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit,w=o.index;e.xp6(1),e.Q6J("textContent",s.weekDay)("htmlFor","day_"+w),e.xp6(3),e.Q6J("id","day_"+w)("ngModel",s.checked)}}W.\u0275fac=function(o){return new(o||W)},W.\u0275prov=e.Yz7({token:W,factory:W.\u0275fac});class $ extends st.T{constructor(o,s,w,j,ee,me,De,Je,qe,Et){super(o,De,qe),this.locals=o,this.I18n=s,this.injector=w,this.appRef=j,this.loadingIndicator=ee,this.notificationService=me,this.cdRef=De,this.configuration=Je,this.elementRef=qe,this.timeEntriesCurrentUserConfigurationModalService=Et,this.closeOnEscape=!0,this.closeOnOutsideClick=!0,this.text={displayedDays:this.I18n.t("js.grid.widgets.time_entries_current_user.displayed_days"),closePopup:this.I18n.t("js.close_popup_title"),applyButton:this.I18n.t("js.modals.button_apply"),cancelButton:this.I18n.t("js.modals.button_cancel")}}ngOnInit(){const o=this.locals.options.days;this.daysOriginalCheckedValues=o.length>0?o:Array.from({length:7},()=>!0),this.days=this.timeEntriesCurrentUserConfigurationModalService.getOrderedDaysData(this.daysOriginalCheckedValues)}saveChanges(){const o=this.timeEntriesCurrentUserConfigurationModalService.getCheckedValuesInOriginalOrder(this.days);this.options={days:o},this.service.close()}}function be(g,o){if(1&g&&e._UZ(0,"icon-triggered-context-menu",1),2&g){const s=e.oxw();e.Q6J("menu-items",s.menuItems)}}$.\u0275fac=function(o){return new(o||$)(e.Y36(He.E),e.Y36(y.D),e.Y36(e.zs3),e.Y36(e.z2F),e.Y36(ce.vt),e.Y36(J.q),e.Y36(e.sBO),e.Y36(Me.e),e.Y36(e.SBq),e.Y36(W))},$.\u0275cmp=e.Xpm({type:$,selectors:[["ng-component"]],features:[e._Bn([W]),e.qOj],decls:10,vars:4,consts:[["data-indicator-name","modal","tabindex","0",1,"spot-modal"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["class","form--field -trailing-label",4,"ngFor","ngForOf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"],[1,"form--field","-trailing-label"],[1,"form--label",3,"textContent","htmlFor"],[1,"form--field-container"],[1,"form--check-box-container"],["type","checkbox","name","days",1,"form--check-box",3,"id","ngModel","ngModelChange"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,Y,5,4,"div",4),e.qZA(),e.TgZ(6,"div",5),e.TgZ(7,"div",6),e.TgZ(8,"button",7),e.NdJ("click",function(j){return s.closeMe(j)}),e.qZA(),e.TgZ(9,"button",8),e.NdJ("click",function(){return s.saveChanges()}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.displayedDays),e.xp6(3),e.Q6J("ngForOf",s.days),e.xp6(3),e.Q6J("textContent",s.text.cancelButton),e.xp6(1),e.Q6J("textContent",s.text.applyButton))},directives:[D.sg,d.Wl,d.JJ,d.On],encapsulation:2});class N extends le{constructor(o,s,w,j,ee){super(w,j,ee),this.injector=o,this.opModalService=s,this.i18n=w,this.remove=j,this.layout=ee,this.onConfigured=new e.vpe,this.menuItemList=[this.removeItem,this.configureItem]}get configureItem(){return{linkText:this.i18n.t("js.grid.configure"),onClick:()=>(this.opModalService.show($,this.injector,this.locals).closingEvent.subscribe(o=>{o.options&&this.onConfigured.emit(o.options)}),!0)}}get locals(){return{options:this.resource.options}}}N.\u0275fac=function(o){return new(o||N)(e.Y36(e.zs3),e.Y36(He.S),e.Y36(y.D),e.Y36(ie),e.Y36(L))},N.\u0275cmp=e.Xpm({type:N,selectors:[["widget-time-entries-current-user-menu"]],outputs:{onConfigured:"onConfigured"},features:[e.qOj],decls:1,vars:1,consts:[[3,"menu-items",4,"ngIf"],[3,"menu-items"]],template:function(o,s){1&o&&e.YNc(0,be,1,1,"icon-triggered-context-menu",0),2&o&&e.Q6J("ngIf",s.hasMenu)},directives:[D.O5,oe.I],encapsulation:2});var Ue=t(91594),et=t(2281),Ke=t(47775),_e=t(19019),ye=t(79474),Pe=t(12703),Ee=t(72388),Qe=t(46709),nt=t(52167),ct=t(1056),lt=t(44022),Ne=t(67727),Ae=t(10190),xe=t(18640),Ye=t(2775);function mt(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){return e.CHM(s),e.oxw().addEventToday()}),e._UZ(1,"op-icon",5),e._UZ(2,"span",6),e.qZA()}if(2&g){const s=e.oxw();e.uIk("aria-label",s.text.logTime),e.xp6(2),e.Q6J("textContent",s.text.logTime)}}const Ot="te-calendar--time-entry",Mt="te-calendar--add-entry",jt="-prohibited";class Jt{constructor(o,s,w,j,ee,me,De,Je,qe,Et,At,ci,rr,ar,Lr,hr){this.states=o,this.apiV3Service=s,this.$state=w,this.element=j,this.i18n=ee,this.injector=me,this.notifications=De,this.sanitizer=Je,this.configuration=qe,this.timezone=Et,this.timeEntryEdit=At,this.timeEntryCreate=ci,this.schemaCache=rr,this.colors=ar,this.browserDetector=Lr,this.calendar=hr,this.static=!1,this.entries=new e.vpe,this.minHour=1,this.maxHour=12,this.labelIntervalHours=2,this.scaleRatio=1,this.memoizedCreateAllowed=!1,this.text={logTime:this.i18n.t("js.button_log_time"),today:this.i18n.t("js.team_planner.today")},this.calendarOptions={editable:!1,locale:this.i18n.locale,fixedWeekCount:!1,headerToolbar:{right:"",center:"title",left:"prev,next today"},buttonText:{today:this.text.today},initialView:"timeGridWeek",firstDay:this.configuration.startOfWeek(),hiddenDays:[],contentHeight:550,slotEventOverlap:!1,slotLabelInterval:`${this.labelIntervalHours}:00:00`,slotLabelFormat:hi=>((this.maxHour-hi.date.hour)/this.scaleRatio).toString(),allDaySlot:!1,displayEventTime:!1,slotMinTime:this.minHour-1+":00:00",slotMaxTime:`${this.maxHour}:00:00`,events:this.calendarEventsFunction.bind(this),eventOverlap:hi=>!hi.classNames.includes(Ot),plugins:[_e.ZP,ye.ZP],eventDidMount:this.alterEventEntry.bind(this),eventWillUnmount:this.beforeEventRemove.bind(this),eventClick:this.dispatchEventClick.bind(this),eventDrop:this.moveEvent.bind(this),dayHeaderClassNames:hi=>this.calendar.applyNonWorkingDay(hi),dayCellClassNames:hi=>this.calendar.applyNonWorkingDay(hi)}}set displayedDays(o){this.setHiddenDays(o)}calendarEventsFunction(o,s,w){this.fetchTimeEntries(o.start,o.end).then(j=>{this.entries.emit(j),s(this.buildEntries(j.elements,o))}).catch(w)}fetchTimeEntries(o,s){if(!this.memoizedTimeEntries||this.memoizedTimeEntries.start.getTime()!==o.getTime()||this.memoizedTimeEntries.end.getTime()!==s.getTime()){const w=this.apiV3Service.time_entries.list({filters:this.dmFilters(o,s),pageSize:500}).toPromise().then(j=>(this.memoizedCreateAllowed=!!j.createTimeEntry,j));this.memoizedTimeEntries={start:o,end:s,entries:w}}return this.memoizedTimeEntries.entries}buildEntries(o,s){return this.setRatio(o),this.buildTimeEntryEntries(o).concat(this.buildAuxEntries(o,s))}setRatio(o){const s=this.calculateDateSums(o),w=Math.max(...Object.values(s),0),j=this.scaleRatio;w>this.maxHour-this.minHour?this.scaleRatio=this.smallerSuitableRatio((this.maxHour-this.minHour)/w):this.scaleRatio=1,j!==this.scaleRatio&&this.ucCalendar.getApi().setOption("slotLabelFormat",ee=>((this.maxHour-ee.date.hour)/this.scaleRatio).toString())}buildTimeEntryEntries(o){const s={};return o.map(w=>{let j,ee;const me=this.timezone.toHours(w.hours)*this.scaleRatio,De=w.spentOn;return s[De]?(j=s[De].clone().subtract(me,"h"),ee=s[De].clone()):(j=et(De).add(this.maxHour-me,"h"),ee=et(De).add(this.maxHour,"h")),s[De]=j,this.timeEntry(w,me,j,ee)})}buildAuxEntries(o,s){const w=this.calculateDateSums(o),j=[];for(let ee=et(s.start);ee.diff(s.end,"days")<=0;ee.add(1,"days")){const me=w[ee.format("YYYY-MM-DD")]||0;j.push(this.sumEntry(ee,me)),this.memoizedCreateAllowed&&j.push(this.addEntry(ee,me))}return j}calculateDateSums(o){const s={};return o.forEach(w=>{const j=this.timezone.toHours(w.hours),ee=w.spentOn;s[ee]?s[ee]+=j:s[ee]=j}),s}timeEntry(o,s,w,j){const ee=this.colors.toHsl(this.entryName(o)),me=[Ot],De=j.diff(w,"m");return De<40&&me.push("-no-fadeout"),{title:De<20?"":this.entryName(o),startEditable:!!o.update,start:w.format(),end:j.format(),backgroundColor:ee,borderColor:ee,classNames:me,entry:o}}sumEntry(o,s){return{start:o.clone().add(this.maxHour-Math.min(s*this.scaleRatio,this.maxHour-.5)-.5,"h").format(),end:o.clone().add(this.maxHour-Math.min((s+.05)*this.scaleRatio,this.maxHour-.5),"h").format(),classNames:"te-calendar--day-sum",rendering:"background",startEditable:!1,sum:this.i18n.t("js.units.hour",{count:this.formatNumber(s)})}}addEntry(o,s){const w=[Mt];return s>=24&&w.push(jt),{start:o.clone().format(),end:o.clone().add(this.maxHour-Math.min(s*this.scaleRatio,this.maxHour-1)-.5,"h").format(),rendering:"background",classNames:w}}dmFilters(o,s){return[["spentOn","<>d",[et(o).format("YYYY-MM-DD"),et(s).subtract(1,"d").format("YYYY-MM-DD")]],["user_id","=",["me"]]]}dispatchEventClick(o){o.event.extendedProps.entry?this.editEvent(o.event.extendedProps.entry):o.el.classList.contains(Mt)&&!o.el.classList.contains(jt)&&this.addEvent(et(o.event.start))}editEvent(o){this.timeEntryEdit.edit(o,{showUserField:!1}).then(s=>{this.updateEventSet(s.entry,s.action)}).catch(()=>{})}moveEvent(o){const s=o.event.extendedProps.entry;s.spentOn=et(o.event.end).format("YYYY-MM-DD"),this.schemaCache.ensureLoaded(s).then(w=>{this.apiV3Service.time_entries.id(s).patch(s,w).subscribe(j=>this.updateEventSet(j,"update"),j=>{this.notifications.handleRawError(j),o.revert()})})}addEventToday(){this.addEvent(et(new Date))}addEvent(o){!this.memoizedCreateAllowed||this.timeEntryCreate.create(o,void 0,{showUserField:!1}).then(s=>{this.updateEventSet(s.entry,s.action)}).catch(()=>{})}updateEventSet(o,s){this.memoizedTimeEntries.entries.then(w=>{const j=w.elements.findIndex(ee=>ee.id===o.id);switch(s){case"update":w.elements[j]=o;break;case"destroy":w.elements.splice(j,1);break;case"create":this.apiV3Service.time_entries.cache.updateFor(o),w.elements.push(o);break;default:throw new Error("Invalid action")}this.ucCalendar.getApi().refetchEvents()})}alterEventEntry(o){this.appendAddIcon(o),this.appendSum(o),o.event.extendedProps.entry&&(this.addTooltip(o),this.prependDuration(o),this.appendFadeout(o))}appendAddIcon(o){if(!o.el.classList.contains(Mt))return;const s=document.createElement("div");s.classList.add("te-calendar--add-icon"),s.innerText="+",o.el.append(s)}appendSum(o){o.event.extendedProps.sum&&(o.el.innerHTML=o.event.extendedProps.sum)}addTooltip(o){return(0,se.mG)(this,void 0,void 0,function*(){if(this.browserDetector.isMobile)return;const{entry:s}=o.event.extendedProps,w=yield this.schemaCache.ensureLoaded(s);jQuery(o.el).tooltip({content:this.tooltipContentString(o.event.extendedProps.entry,w),items:".fc-event",close(){jQuery(".ui-helper-hidden-accessible").remove()},track:!0})})}removeTooltip(o){jQuery(o.el).tooltip("disable")}prependDuration(o){const s=o.event.extendedProps.entry;if(this.timezone.toHours(s.hours)<.5)return;const w=this.timezone.formattedDuration(s.hours);jQuery(o.el).find(".fc-event-title").prepend(`<div class="fc-duration">${w}</div>`)}appendFadeout(o){const s=o.event.extendedProps.entry;if(this.timezone.toHours(s.hours)<.5)return;const w=jQuery(o.el),j=jQuery('<div class="fc-fadeout"></div>'),ee=this.colors.toHsla(this.entryName(s),0),me=this.colors.toHsla(this.entryName(s),100);j.css("background",`-webkit-linear-gradient(${ee} 0%, ${me} 100%`),["-moz-linear-gradient","-o-linear-gradient","linear-gradient","-ms-linear-gradient"].forEach(De=>{j.css("background-image",`${De}(${ee} 0%, ${me} 100%`)}),w.append(j)}beforeEventRemove(o){!o.event.extendedProps.entry||this.removeTooltip(o)}entryName(o){let{name:s}=o.project;return o.workPackage&&(s+=` - ${this.workPackageName(o)}`),s||"-"}workPackageName(o){const s=o.workPackage;return`#${(0,Ae.Z)(s.href)}: ${s.name}`}tooltipContentString(o,s){return`\n        <ul class="tooltip--map">\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.project.name}:</span>\n            <span class="tooltip--map--value">${this.sanitizedValue(o.project.name)}</span>\n          </li>\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.workPackage.name}:</span>\n            <span class="tooltip--map--value">${o.workPackage?this.sanitizedValue(this.workPackageName(o)):this.i18n.t("js.placeholders.default")}</span>\n          </li>\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.activity.name}:</span>\n            <span class="tooltip--map--value">${this.sanitizedValue(o.activity.name)}</span>\n          </li>\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.hours.name}:</span>\n            <span class="tooltip--map--value">${this.timezone.formattedDuration(o.hours)}</span>\n          </li>\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.comment.name}:</span>\n            <span class="tooltip--map--value">${o.comment.raw||this.i18n.t("js.placeholders.default")}</span>\n          </li>\n        `}sanitizedValue(o){return this.sanitizer.sanitize(e.q3G.HTML,o)||""}formatNumber(o){return this.i18n.toNumber(o,{precision:2})}smallerSuitableRatio(o){for(let s=this.labelIntervalHours+1;s<100;s++){const w=this.labelIntervalHours/s;if(o>=w)return w}return 1}setHiddenDays(o){const s=Array.from(o,(w,j)=>w?null:(j+1)%7).filter(w=>null!==w);this.calendarOptions=Object.assign(Object.assign({},this.calendarOptions),{hiddenDays:s})}}Jt.\u0275fac=function(o){return new(o||Jt)(e.Y36(h.G),e.Y36(R.T),e.Y36(Ke.StateService),e.Y36(e.SBq),e.Y36(y.D),e.Y36(e.zs3),e.Y36(Ne.W),e.Y36(i.H7),e.Y36(Me.e),e.Y36(tt.B),e.Y36(Ee.d),e.Y36(Qe.f),e.Y36(lt.y),e.Y36(nt.c),e.Y36(ct.o),e.Y36(xe.j))},Jt.\u0275cmp=e.Xpm({type:Jt,selectors:[["op-time-entries-calendar"]],viewQuery:function(o,s){if(1&o&&e.Gf(Ue.woE,5),2&o){let w;e.iGM(w=e.CRH())&&(s.ucCalendar=w.first)}},inputs:{projectIdentifier:"projectIdentifier",static:"static",displayedDays:"displayedDays"},outputs:{entries:"entries"},features:[e._Bn([xe.j,Ee.d,Qe.f,Pe.l])],decls:4,vars:3,consts:[[1,"te-calendar--container","loading-indicator--location",2,"position","relative"],["class","button te-calendar--create-button",3,"click",4,"ngIf"],[3,"options"],["ucCalendar",""],[1,"button","te-calendar--create-button",3,"click"],["icon-classes","button--icon icon-log_time"],["aria-hidden","true",1,"button--text",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,mt,3,2,"button",1),e._UZ(2,"full-calendar",2,3),e.qZA()),2&o&&(e.uIk("data-indicator-name","table"),e.xp6(1),e.Q6J("ngIf",s.memoizedCreateAllowed),e.xp6(1),e.Q6J("options",s.calendarOptions))},directives:[D.O5,Ue.woE,Ye.o],styles:["@media screen and (max-width: 679px){op-time-entries-calendar .fc-toolbar-chunk:empty{display:none}}@media screen and (min-width: 680px){op-time-entries-calendar .te-calendar--create-button{position:absolute;right:0;top:0;margin-right:0}op-time-entries-calendar .fc-toolbar-chunk:last-child{flex-basis:165px;flex-shrink:0}}op-time-entries-calendar full-calendar{overflow-x:auto}op-time-entries-calendar full-calendar .fc-view{min-width:800px}op-time-entries-calendar full-calendar thead{display:table-footer-group}op-time-entries-calendar full-calendar th.fc-day,op-time-entries-calendar full-calendar th.fc-timegrid-axis{border-bottom:none}op-time-entries-calendar full-calendar table.fc-scrollgrid.fc-scrollgrid-liquid{border-left:none}.-browser-firefox op-time-entries-calendar full-calendar .fc-col-header-cell-cushion{padding:2px 4px!important}op-time-entries-calendar full-calendar .fc-event,op-time-entries-calendar full-calendar .fc-bgevent{border-radius:0;margin-right:8px;margin-left:8px}op-time-entries-calendar full-calendar .fc-head-container{border-color:#fff}op-time-entries-calendar full-calendar .fc-day-header{padding-top:5px}op-time-entries-calendar full-calendar .fc-widget-content{border-left-color:#fff}op-time-entries-calendar full-calendar .fc-widget-content .fc-day{border-left:0;border-right:0}op-time-entries-calendar full-calendar .fc-timeGrid-view .fc-day-grid .fc-row{min-height:1em}op-time-entries-calendar full-calendar .fc-timeGrid-view .fc-day-grid .fc-row .fc-content-skeleton{padding-bottom:0}op-time-entries-calendar full-calendar .fc-timegrid-event-harness .fc-timegrid-event{box-shadow:none}op-time-entries-calendar full-calendar .fc-timegrid-slot.fc-timegrid-slot-minor{border-top:0}op-time-entries-calendar full-calendar .te-calendar--day-sum{border:none;background-color:initial;color:#000;text-align:center;font-size:.875em;font-weight:bold;line-height:22px;opacity:1;cursor:default}op-time-entries-calendar full-calendar .te-calendar--add-entry{text-align:center;font-weight:bold;opacity:0;background:none;border:none;display:flex;align-items:center}op-time-entries-calendar full-calendar .te-calendar--add-entry:hover{opacity:1;transition:opacity 1s ease;background:#EAEAEA;border:1px solid #878787}op-time-entries-calendar full-calendar .te-calendar--add-entry .te-calendar--add-icon{color:#000;width:100%;font-weight:normal;font-size:1.5rem}op-time-entries-calendar full-calendar .te-calendar--add-entry.-prohibited{cursor:not-allowed}op-time-entries-calendar full-calendar .te-calendar--add-entry.-prohibited .te-calendar--add-icon{display:none}op-time-entries-calendar full-calendar .te-calendar--add-entry .fc-event-title-container{margin:0!important}op-time-entries-calendar full-calendar .te-calendar--time-entry{color:#fff}op-time-entries-calendar full-calendar .te-calendar--time-entry .fc-content{height:100%}op-time-entries-calendar full-calendar .te-calendar--time-entry .fc-fadeout{position:relative;bottom:2em;height:2em;z-index:5}op-time-entries-calendar full-calendar .te-calendar--time-entry.-no-fadeout .fc-fadeout{display:none}op-time-entries-calendar full-calendar .te-calendar--time-entry .fc-event-title-container{margin:0 4px!important;line-height:14px!important}op-time-entries-calendar full-calendar .fc-duration{display:inline-block;margin-right:5px;padding-right:5px;font-weight:bold}\n"],encapsulation:2,changeDetection:0});class Ft extends O._{constructor(o,s,w,j,ee){super(w,o),this.injector=o,this.timezone=s,this.i18n=w,this.pathHelper=j,this.cdr=ee,this.entries=[]}ngOnInit(){this.displayedDays=this.resource.options.days}updateEntries(o){this.entries=o.elements,this.cdr.detectChanges()}get total(){const o=this.entries.reduce((s,w)=>s+this.timezone.toHours(w.hours),0);return o>0?this.i18n.t("js.units.hour",{count:this.formatNumber(o)}):this.i18n.t("js.placeholders.default")}get isEditable(){return!1}updateConfiguration(o){this.resourceChanged.emit(this.setChangesetOptions(o)),this.displayedDays=[...o.days]}formatNumber(o){return this.i18n.toNumber(o,{precision:2})}}Ft.\u0275fac=function(o){return new(o||Ft)(e.Y36(e.zs3),e.Y36(tt.B),e.Y36(y.D),e.Y36(je.j),e.Y36(e.sBO))},Ft.\u0275cmp=e.Xpm({type:Ft,selectors:[["ng-component"]],features:[e.qOj],decls:8,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource","onConfigured"],[3,"displayedDays","entries"],[1,"total-hours"],[3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.TgZ(1,"widget-time-entries-current-user-menu",1),e.NdJ("onConfigured",function(j){return s.updateConfiguration(j)}),e.qZA(),e.qZA(),e.TgZ(2,"op-time-entries-calendar",2),e.NdJ("entries",function(j){return s.updateEntries(j)}),e.qZA(),e.ynx(3),e.TgZ(4,"div",3),e.TgZ(5,"p"),e._uU(6,"Total: "),e._UZ(7,"span",4),e.qZA(),e.qZA(),e.BQk()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("displayedDays",s.displayedDays),e.xp6(5),e.Q6J("textContent",s.total))},directives:[q,N,Jt],encapsulation:2,changeDetection:0});class It{constructor(o){this.Hook=o}get registered(){let o=[];return _.each(this.Hook.call("gridWidgets"),s=>{o=o.concat(s)}),o}}It.\u0275fac=function(o){return new(o||It)(e.LFG(f.$))},It.\u0275prov=e.Yz7({token:It,factory:It.\u0275fac});var gt=t(91923),kt=t(55216);function ti(g,o){if(1&g&&e._UZ(0,"op-no-results",5),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function ii(g,o){if(1&g&&(e.ynx(0),e.TgZ(1,"h4",6),e._UZ(2,"a",7),e.qZA(),e.TgZ(3,"p",8),e._UZ(4,"em",9),e.qZA(),e._UZ(5,"div",10),e.BQk()),2&g){const s=o.$implicit,w=e.oxw();e.xp6(2),e.Q6J("href",w.documentPath(s),e.LSH)("textContent",s.title),e.xp6(2),e.Q6J("textContent",w.documentCreated(s)),e.xp6(1),e.Q6J("innerHtml",w.documentDescription(s),e.oJD)}}class $t extends O._{constructor(o,s,w,j,ee,me,De,Je,qe){super(j,De),this.halResource=o,this.pathHelper=s,this.apiV3Service=w,this.i18n=j,this.timezone=ee,this.domSanitizer=me,this.injector=De,this.currentProject=Je,this.cdr=qe,this.text={noResults:this.i18n.t("js.grid.widgets.documents.no_results")},this.entries=[],this.entriesLoaded=!1}ngOnInit(){this.halResource.get(this.documentsUrl).toPromise().then(o=>{this.entries=o.elements,this.entriesLoaded=!0,this.cdr.detectChanges()})}get isEditable(){return!1}documentPath(o){return`${this.pathHelper.appBasePath}/documents/${o.id}`}documentCreated(o){return this.timezone.formattedDatetime(o.createdAt)}documentDescription(o){return this.domSanitizer.sanitize(e.q3G.HTML,o.description.html)}get noEntries(){return!this.entries.length&&this.entriesLoaded}get documentsUrl(){const o=JSON.stringify([["updated_at","desc"]]);let s=`${this.apiV3Service.documents.toPath()}?sortBy=${o}&pageSize=10`;return this.currentProject.id&&(s+=`&filters=${JSON.stringify([{project_id:{operator:"=",values:[this.currentProject.id.toString()]}}])}`),s}}$t.\u0275fac=function(o){return new(o||$t)(e.Y36(gt.u),e.Y36(je.j),e.Y36(R.T),e.Y36(y.D),e.Y36(tt.B),e.Y36(i.H7),e.Y36(e.zs3),e.Y36(b.R),e.Y36(e.sBO))},$t.\u0275cmp=e.Xpm({type:$t,selectors:[["ng-component"]],features:[e.qOj],decls:5,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"title",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"title"],[1,"document-category-elements--header"],[3,"href","textContent"],[1,"document-category-elements--date"],[3,"textContent"],[1,"wiki","grid--widget-limited-text","op-uc-container",3,"innerHtml"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,ti,1,1,"op-no-results",3),e.YNc(4,ii,6,4,"ng-container",4),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",s.noEntries),e.xp6(1),e.Q6J("ngForOf",s.entries))},directives:[q,fe,D.O5,D.sg,kt.S],encapsulation:2,changeDetection:0});var vt=t(3742);function Ht(g,o){if(1&g&&e._UZ(0,"op-no-results",6),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function Wt(g,o){if(1&g&&e._UZ(0,"op-principal",13),2&g){const s=e.oxw().$implicit;e.Q6J("principal",s.author)("hideName",!0)}}function it(g,o){if(1&g&&e._UZ(0,"div",14),2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("innerHTML",w.text.addedBy(s),e.oJD)}}function de(g,o){if(1&g&&e._UZ(0,"p",15),2&g){const s=e.oxw().$implicit;e.Q6J("textContent",s.summary)}}function ae(g,o){if(1&g&&(e.TgZ(0,"li",7),e.YNc(1,Wt,1,2,"op-principal",8),e.TgZ(2,"div",9),e._UZ(3,"a",10),e._uU(4,": "),e._UZ(5,"a",10),e.qZA(),e.YNc(6,it,1,1,"div",11),e.YNc(7,de,1,1,"p",12),e.qZA()),2&g){const s=o.$implicit,w=e.oxw();e.xp6(1),e.Q6J("ngIf",s.author),e.xp6(2),e.Q6J("href",w.newsProjectPath(s),e.LSH)("textContent",w.newsProjectName(s)),e.xp6(2),e.Q6J("href",w.newsPath(s),e.LSH)("textContent",s.title),e.xp6(1),e.Q6J("ngIf",s.author),e.xp6(1),e.Q6J("ngIf",s.summary)}}class pe extends O._{constructor(o,s,w,j,ee,me,De){super(s,w),this.pathHelper=o,this.i18n=s,this.injector=w,this.timezone=j,this.currentProject=ee,this.apiV3Service=me,this.cdr=De,this.text={at:this.i18n.t("js.grid.widgets.news.at"),noResults:this.i18n.t("js.grid.widgets.news.no_results"),addedBy:Je=>this.i18n.t("js.label_added_time_by",{author:this.newsAuthorName(Je),age:this.newsCreated(Je),authorLink:this.newsAuthorPath(Je)})},this.entries=[],this.entriesLoaded=!1}ngOnInit(){this.apiV3Service.news.list(this.newsDmParams).subscribe(o=>this.setupNews(o.elements))}setupNews(o){this.entries=o,this.entriesLoaded=!0,this.cdr.detectChanges()}get isEditable(){return!1}newsPath(o){return this.pathHelper.newsPath(o.id)}newsProjectPath(o){var s;return this.pathHelper.projectPath((0,Ae.Z)(null===(s=o.project)||void 0===s?void 0:s.href))}newsProjectName(o){var s;return null===(s=o.project)||void 0===s?void 0:s.name}newsAuthorName(o){var s;return null===(s=o.author)||void 0===s?void 0:s.name}newsAuthorPath(o){var s;return this.pathHelper.userPath(null===(s=o.author)||void 0===s?void 0:s.id)}newsCreated(o){return this.timezone.formattedDatetime(o.createdAt)}get noEntries(){return!this.entries.length&&this.entriesLoaded}get newsDmParams(){const o={sortBy:[["created_at","desc"]],pageSize:3};return this.currentProject.id&&(o.filters=[["project_id","=",[this.currentProject.id]]]),o}}pe.\u0275fac=function(o){return new(o||pe)(e.Y36(je.j),e.Y36(y.D),e.Y36(e.zs3),e.Y36(tt.B),e.Y36(b.R),e.Y36(R.T),e.Y36(e.sBO))},pe.\u0275cmp=e.Xpm({type:pe,selectors:[["ng-component"]],features:[e.qOj],decls:6,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"title",4,"ngIf"],[1,"widget-box--arrow-links"],["class","widget-box--arrow-multiline",4,"ngFor","ngForOf"],[3,"title"],[1,"widget-box--arrow-multiline"],["class","widget-box--avatar news-author-avatar hidden-for-mobile",3,"principal","hideName",4,"ngIf"],[1,"widget-box--project"],[3,"href","textContent"],["class","widget-box--author news-author",3,"innerHTML",4,"ngIf"],["class","widget-box--additional-info",3,"textContent",4,"ngIf"],[1,"widget-box--avatar","news-author-avatar","hidden-for-mobile",3,"principal","hideName"],[1,"widget-box--author","news-author",3,"innerHTML"],[1,"widget-box--additional-info",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,Ht,1,1,"op-no-results",3),e.TgZ(4,"ul",4),e.YNc(5,ae,8,7,"li",5),e.qZA(),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",s.noEntries),e.xp6(2),e.Q6J("ngForOf",s.entries))},directives:[q,fe,D.O5,D.sg,kt.S,vt.N],encapsulation:2,changeDetection:0});var H=t(79902);class he{constructor(o,s){this.apiV3Service=o,this.halResourceService=s}initialize(o){return this.apiV3Service.grids.list({filters:[["scope","=",[o]]]}).toPromise().then(s=>0===s.total?this.myPageForm(o):s.elements[0])}myPageForm(o){const s={_links:{scope:{href:o}}};return this.apiV3Service.grids.form.post(s).pipe((0,H.w)(w=>{const j=w.payload.$source,ee=this.halResourceService.createHalResource(j);return 0===ee.widgets.length&&(ee.rowCount=1,ee.columnCount=1),this.apiV3Service.grids.post(ee,w.schema)})).toPromise()}}he.\u0275fac=function(o){return new(o||he)(e.LFG(R.T),e.LFG(gt.u))},he.\u0275prov=e.Yz7({token:he,factory:he.\u0275fac});const ue=["tabInner"];class Le{onSave(){this.tabInner.onSave()}}Le.\u0275fac=function(o){return new(o||Le)},Le.\u0275cmp=e.Xpm({type:Le,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(ue,7),2&o){let w;e.iGM(w=e.CRH())&&(s.tabInner=w.first)}},decls:3,vars:0,consts:[["wp-isolated-query-space",""],["tabInner",""]],template:function(o,s){1&o&&(e.ynx(0,0),e._UZ(1,"op-settings-tab-inner",null,1),e.BQk())},encapsulation:2});const ht=["tabInner"];class pt{onSave(){this.tabInner.onSave()}}pt.\u0275fac=function(o){return new(o||pt)},pt.\u0275cmp=e.Xpm({type:pt,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(ht,7),2&o){let w;e.iGM(w=e.CRH())&&(s.tabInner=w.first)}},decls:3,vars:0,consts:[["wp-isolated-query-space",""],["tabInner",""]],template:function(o,s){1&o&&(e.ynx(0,0),e._UZ(1,"op-filters-tab-inner",null,1),e.BQk())},encapsulation:2});class Zt{constructor(o,s,w){this.queryParams=o,this.chartOptions=s,this.chartType=w,this.queries=[],this.chartType=this.chartType||"horizontalBar"}static queryCreationParams(o,s){return{public:s,name:o.t("js.grid.widgets.work_packages_graph.title"),showHierarchies:!1,_links:{groupBy:{href:"/api/v3/queries/group_bys/status"}}}}}class Ct{constructor(o,s,w,j){this.I18n=o,this.apiv3Service=s,this.notificationService=w,this.currentProject=j,this._forms={}}persistAndReload(){return this.persistChanges().then(()=>this.reloadQueries())}persistChanges(){const o=this.queries.map(s=>this.saveQuery(s));return Promise.all(o)}get datasets(){return this.queries.map(o=>({groups:o.results.groups,queryProps:"",label:o.name}))}reloadQueries(){return this.configuration.queries.length=0,this.loadQueries()}ensureQueryAndLoad(){return 0===this.queryParams.length?this.createInitial().then(o=>(this.queryParams.push({id:o.id}),this.loadQueries())):this.loadQueries()}createInitial(){return this.apiv3Service.queries.form.loadWithParams({pageSize:0},void 0,this.currentProject.identifier,Zt.queryCreationParams(this.I18n,!!this.currentProject.identifier)).toPromise().then(([o,s])=>this.apiv3Service.queries.post(s,o).toPromise())}loadQueries(){const o=this.queryParams.map(s=>this.loadQuery(s));return Promise.all(o)}loadQuery(o){return this.apiv3Service.queries.find(Object.assign({pageSize:0},o.props),o.id,this.currentProject.identifier).toPromise().then(s=>{o.name&&(s.name=o.name),this.configuration.queries.push(s)})}saveQuery(o){return(0,se.mG)(this,void 0,void 0,function*(){return this.formFor(o).then(s=>this.apiv3Service.queries.id(o).patch(o,s).toPromise())})}get configuration(){return this._configuration}set configuration(o){this._configuration=o,this._formsPromise=null}formFor(o){return(0,se.mG)(this,void 0,void 0,function*(){return this.loadForms().then(()=>this._forms[o.id])})}get tabs(){const o=[{id:"graph-settings",name:this.I18n.t("js.chart.tabs.graph_settings"),componentClass:Le}],s=this.configuration.queries.map(w=>({id:w.id,name:this.I18n.t("js.work_packages.query.filters"),componentClass:pt}));return o.concat(s)}loadForms(){if(!this._formsPromise){const o=this.configuration.queries.map(s=>this.apiv3Service.queries.form.load(s).toPromise().then(([w])=>{this._forms[s.id]=w}).catch(w=>this.notificationService.handleRawError(w)));this._formsPromise=Promise.all(o)}return this._formsPromise}get chartType(){return this._configuration.chartType}set chartType(o){this._configuration.chartType=o}get queries(){return this._configuration.queries}get chartOptions(){return this._configuration.chartOptions}get queryParams(){return this._configuration.queryParams}}Ct.\u0275fac=function(o){return new(o||Ct)(e.LFG(y.D),e.LFG(R.T),e.LFG(J.q),e.LFG(b.R))},Ct.\u0275prov=e.Yz7({token:Ct,factory:Ct.\u0275fac});var ni=t(61736),_i=t(90590);const ri=["tabContentOutlet"];function ut(g,o){1&g&&e.GkF(0)}function ze(g,o){if(1&g&&(e.ynx(0),e.YNc(1,ut,1,0,"ng-container",12),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngComponentOutlet",s.prependModalComponent)("ngComponentOutletInjector",s.injector)}}function ke(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-scrollable-tabs",13),e.NdJ("tabSelected",function(j){return e.CHM(s),e.oxw().switchTo(j)}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("tabs",s.availableTabs)("currentTabId",null==s.tabPortalHost.currentTab?null:s.tabPortalHost.currentTab.id)}}const Te=new e.OlP("WpTableConfigurationModalPrependComponent");class Re extends st.T{constructor(o,s,w,j,ee,me,De,Je,qe,Et,At,ci){super(o,qe,At),this.locals=o,this.prependModalComponent=s,this.I18n=w,this.injector=j,this.appRef=ee,this.componentFactoryResolver=me,this.loadingIndicator=De,this.notificationService=Je,this.cdRef=qe,this.configurationService=Et,this.elementRef=At,this.graphConfiguration=ci,this.closeOnEscape=!1,this.closeOnOutsideClick=!1,this.text={title:this.I18n.t("js.chart.modal_title"),closePopup:this.I18n.t("js.close_popup_title"),applyButton:this.I18n.t("js.modals.button_apply"),cancelButton:this.I18n.t("js.modals.button_cancel")}}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.loadingIndicator.indicator("modal").promise=this.graphConfiguration.loadForms().then(()=>{this.tabPortalHost=new ni.M(this.graphConfiguration.tabs,this.tabContentOutlet.nativeElement,this.componentFactoryResolver,this.appRef,this.injector);const o=this.locals.initialTab,s=this.availableTabs.find(w=>w.id===o);this.cdRef.markForCheck(),this.switchTo(s||this.availableTabs[0])})}ngOnDestroy(){this.tabPortalHost.dispose()}get availableTabs(){return this.tabPortalHost.availableTabs}get currentTab(){return this.tabPortalHost.currentTab}switchTo(o){this.tabPortalHost.switchTo(o)}saveChanges(){this.tabPortalHost.activeComponents.forEach(o=>{o.onSave()}),this.configuration=this.graphConfiguration.configuration,this.service.close()}onClose(){return this.afterFocusOn.focus(),!0}get afterFocusOn(){return this.$element}}Re.\u0275fac=function(o){return new(o||Re)(e.Y36(He.E),e.Y36(Te,8),e.Y36(y.D),e.Y36(e.zs3),e.Y36(e.z2F),e.Y36(e._Vd),e.Y36(ce.vt),e.Y36(J.q),e.Y36(e.sBO),e.Y36(Me.e),e.Y36(e.SBq),e.Y36(Ct))},Re.\u0275cmp=e.Xpm({type:Re,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(ri,7),2&o){let w;e.iGM(w=e.CRH())&&(s.tabContentOutlet=w.first)}},features:[e.qOj],decls:13,vars:5,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_wide","wp-table--configuration-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[4,"ngIf"],[3,"tabs","currentTabId","tabSelected",4,"ngIf"],[1,"tab-content"],["tabContentOutlet",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","spot-modal-wp-table-configuration-save-button",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"tabs","currentTabId","tabSelected"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,ze,2,2,"ng-container",4),e.YNc(6,ke,1,2,"op-scrollable-tabs",5),e._UZ(7,"div",6,7),e.qZA(),e.TgZ(9,"div",8),e.TgZ(10,"div",9),e.TgZ(11,"button",10),e.NdJ("click",function(j){return s.closeMe(j)}),e.qZA(),e.TgZ(12,"button",11),e.NdJ("click",function(){return s.saveChanges()}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title),e.xp6(3),e.Q6J("ngIf",!!s.prependModalComponent),e.xp6(1),e.Q6J("ngIf",s.tabPortalHost),e.xp6(5),e.Q6J("textContent",s.text.cancelButton),e.xp6(1),e.Q6J("textContent",s.text.applyButton))},directives:[D.O5,D.$G,p.dw,_i.P],encapsulation:2,changeDetection:0});class $e extends le{constructor(o,s,w,j,ee){super(w,j,ee),this.injector=o,this.opModalService=s,this.i18n=w,this.remove=j,this.layout=ee,this.onConfigured=new e.vpe,this.menuItemList=[this.removeItem,this.configureItem]}get configureItem(){return{linkText:this.i18n.t("js.toolbar.settings.configure_view"),onClick:()=>(this.opModalService.show(this.configurationComponent,this.injector,this.locals).closingEvent.subscribe(o=>{this.onConfigured.emit(o.configuration)}),!0)}}get locals(){return{}}}function ot(g,o){if(1&g&&e._UZ(0,"icon-triggered-context-menu",1),2&g){const s=e.oxw();e.Q6J("menu-items",s.menuItems)}}$e.\u0275fac=function(o){return new(o||$e)(e.Y36(e.zs3),e.Y36(He.S),e.Y36(y.D),e.Y36(ie),e.Y36(L))},$e.\u0275dir=e.lG2({type:$e,outputs:{onConfigured:"onConfigured"},features:[e.qOj]});class dt extends $e{constructor(){super(...arguments),this.configurationComponent=Re}}dt.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(dt)))(s||dt)}}(),dt.\u0275cmp=e.Xpm({type:dt,selectors:[["widget-wp-graph-menu"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"menu-items",4,"ngIf"],[3,"menu-items"]],template:function(o,s){1&o&&e.YNc(0,ot,1,1,"icon-triggered-context-menu",0),2&o&&e.Q6J("ngIf",s.hasMenu)},directives:[D.O5,oe.I],encapsulation:2});var _t=t(22834);function Ut(g,o){if(1&g&&e._UZ(0,"canvas",4),2&g){const s=e.oxw();e.Q6J("datasets",s.chartData)("labels",s.chartLabels)("chartType",s.chartType)("options",s.internalChartOptions)}}function Lt(g,o){if(1&g&&e._UZ(0,"op-no-results",5),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}const Xt=function(g){return{height:g}};class zt{constructor(o){this.i18n=o,this.chartType="horizontalBar",this.error=null,this.chartHeight="100%",this.chartLabels=[],this.chartData=[],this.initialized=!1,this.text={noResults:this.i18n.t("js.work_packages.no_results.title")}}ngOnChanges(o){o.datasets?(this.setChartOptions(),this.updateChartData(),o.datasets.firstChange||(this.initialized=!0)):o.chartType&&this.setChartOptions()}updateChartData(){let o=_.uniq(this.datasets.reduce((w,j)=>{const ee=(j.groups||[]).map(me=>me.value);return w.concat(ee)},[]));const s=this.datasets.map(w=>{const j=(w.groups||[]).reduce((ee,me)=>Object.assign(Object.assign({},ee),{[me.value]:me.count}),{});return{label:w.label,data:o.map(ee=>j[ee]||0)}});o=o.map(w=>w||this.i18n.t("js.placeholders.default")),this.setHeight(),this.chartLabels.length=0,this.chartLabels.push(...o),this.chartData.length=0,this.chartData.push(...s)}setChartOptions(){const o={responsive:!0,maintainAspectRatio:!1,legend:{display:this.datasets.length>1},plugins:{datalabels:{align:"bar"===this.chartType?"top":"center"}}},s=(()=>"horizontalBar"===this.chartType||"bar"===this.chartType?this.setChartAxesValues():{scales:{}})();this.internalChartOptions=Object.assign(Object.assign(Object.assign({},o),s),this.chartOptions)}get hasDataToDisplay(){return this.chartData.length>0&&this.chartData.some(o=>o.data.length>0)}setHeight(){if("horizontalBar"===this.chartType&&this.datasets&&this.datasets[0]){const o=[];this.datasets.forEach(w=>w.groups.forEach(j=>{o.includes(j.value)||o.push(j.value)}));let s=40*o.length;this.datasets.length>1&&(s+=40),s+=40,this.chartHeight=`${s}px`}else this.chartHeight="100%"}setChartAxesValues(){const o={scales:{}},s=[{stacked:!0,ticks:{callback:j=>Math.floor(j)===j?j:null}}],w=[{stacked:!0}];return o.scales&&("bar"===this.chartType?(o.scales.yAxes=s,o.scales.xAxes=w):"horizontalBar"===this.chartType&&(o.scales.xAxes=s,o.scales.yAxes=w)),o}}zt.\u0275fac=function(o){return new(o||zt)(e.Y36(y.D))},zt.\u0275cmp=e.Xpm({type:zt,selectors:[["op-wp-embedded-graph"]],inputs:{datasets:"datasets",chartOptions:"chartOptions",chartType:"chartType"},features:[e.TTD],decls:4,vars:5,consts:[[1,"op-wp-embeded-graph","work-packages-embedded-view--container","loading-indicator--location",3,"ngStyle"],["graphContainer",""],["baseChart","",3,"datasets","labels","chartType","options",4,"ngIf"],[3,"title",4,"ngIf"],["baseChart","",3,"datasets","labels","chartType","options"],[3,"title"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0,1),e.YNc(2,Ut,1,4,"canvas",2),e.YNc(3,Lt,1,1,"op-no-results",3),e.qZA()),2&o&&(e.Q6J("ngStyle",e.VKq(3,Xt,s.chartHeight)),e.xp6(2),e.Q6J("ngIf",s.hasDataToDisplay),e.xp6(1),e.Q6J("ngIf",!s.hasDataToDisplay&&s.initialized))},directives:[D.PC,D.O5,_t.jh,kt.S],styles:[".op-wp-embeded-graph.work-packages-embedded-view--container[_ngcontent-%COMP%]{height:100%;max-height:500px;position:relative}"]});class li extends O._{constructor(o,s,w,j){super(o,s),this.i18n=o,this.injector=s,this.cdr=w,this.graphConfiguration=j,this.datasets=[]}ngOnInit(){this.initializeConfiguration(),this.loadQueriesInitially()}set chartType(o){this.resource.options.chartType=o}updateGraph(o){this.graphConfiguration.persistAndReload().then(()=>{if(this.repaint(),this.resource.options.chartType!==this.graphConfiguration.chartType){const s=this.setChangesetOptions({chartType:this.graphConfiguration.chartType});this.resourceChanged.emit(s)}})}repaint(){this.datasets=this.graphConfiguration.datasets,this.cdr.detectChanges()}initializeConfiguration(){const o=[];this.resource.options.queryId&&o.push({id:this.resource.options.queryId}),this.graphConfiguration.configuration=new Zt(o,this.resource.options.chartOptions,this.resource.options.chartType)}loadQueriesInitially(){this.graphConfiguration.ensureQueryAndLoad().then(()=>{if(!this.resource.options.queryId){const o=this.setChangesetOptions({queryId:this.graphConfiguration.queryParams[0].id});this.resourceChanged.emit(o)}this.repaint()})}get chartOptions(){return this.graphConfiguration.chartOptions}get chartType(){return this.graphConfiguration.chartType}}li.\u0275fac=function(o){return new(o||li)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(e.sBO),e.Y36(Ct))},li.\u0275cmp=e.Xpm({type:li,selectors:[["widget-wp-graph"]],features:[e._Bn([Ct]),e.qOj],decls:3,vars:4,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource","onConfigured"],[1,"grid--widget-content","-no-overflow",3,"datasets","chartType"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(j){return s.renameWidget(j)}),e.TgZ(1,"widget-wp-graph-menu",1),e.NdJ("onConfigured",function(j){return s.updateGraph(j)}),e.qZA(),e.qZA(),e._UZ(2,"op-wp-embedded-graph",2)),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("datasets",s.datasets)("chartType",s.chartType))},directives:[q,dt,zt],styles:["wp-embedded-table[_ngcontent-%COMP%]{overflow:auto}"],changeDetection:0});var mi=t(55977),Ci=t(43440),Zi=t(84515),Kt=t(57119);function ei(g,o){if(1&g&&e._UZ(0,"icon-triggered-context-menu",1),2&g){const s=e.oxw();e.Q6J("menu-items",s.menuItems)}}class ai extends $e{constructor(){super(...arguments),this.configurationComponent=Kt.Q}}ai.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(ai)))(s||ai)}}(),ai.\u0275cmp=e.Xpm({type:ai,selectors:[["widget-wp-table-menu"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"menu-items",4,"ngIf"],[3,"menu-items"]],template:function(o,s){1&o&&e.YNc(0,ei,1,1,"icon-triggered-context-menu",0),2&o&&e.Q6J("ngIf",s.hasMenu)},directives:[D.O5,oe.I],encapsulation:2});var Ri=t(166);function bi(g,o){if(1&g&&e._UZ(0,"wp-embedded-table",3),2&g){const s=e.oxw();e.Q6J("queryId",s.queryId)("configuration",s.configuration)}}class Oi extends O._{constructor(o,s,w,j,ee,me){super(o,s),this.i18n=o,this.injector=s,this.urlParamsHelper=w,this.state=j,this.querySpace=ee,this.apiV3Service=me,this.inFlight=!1,this.configuration={actionsColumnEnabled:!1,columnMenuEnabled:!1,hierarchyToggleEnabled:!0,contextMenuEnabled:!1}}ngOnInit(){this.resource.options.queryId?this.queryId=this.resource.options.queryId:this.createInitial().then(o=>{const s=this.setChangesetOptions({queryId:o.id});this.resourceChanged.emit(s),this.queryId=o.id}),this.query$=this.querySpace.query.values$(),this.query$.pipe((0,Zi.T)(2),this.untilDestroyed()).subscribe(o=>{this.ensureFormAndSaveQuery(o)})}get widgetName(){return this.resource.options.name}static get identifier(){return"work_packages_table"}ensureFormAndSaveQuery(o){this.queryForm?this.saveQuery(o,this.queryForm):this.apiV3Service.queries.form.load(o).subscribe(([s,w])=>{this.queryForm=s,this.saveQuery(o,s)})}saveQuery(o,s){this.inFlight=!0,this.apiV3Service.queries.id(o).patch(o,this.queryForm).subscribe(()=>this.inFlight=!1,()=>this.inFlight=!1)}createInitial(){const o=this.state.params.projectPath,s=this.resource.options.queryProps,w=Object.assign({pageSize:0},s);return this.apiV3Service.queries.form.loadWithParams(w,void 0,o,this.queryCreationParams()).toPromise().then(([j,ee])=>this.apiV3Service.queries.post(ee,j).toPromise().then(me=>(delete this.resource.options.queryProps,me)))}queryCreationParams(){return{hidden:!0,public:!!this.state.params.projectPath}}}Oi.\u0275fac=function(o){return new(o||Oi)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(mi.Z),e.Y36(Ke.StateService),e.Y36(Ci.q),e.Y36(R.T))},Oi.\u0275cmp=e.Xpm({type:Oi,selectors:[["widget-wp-table"]],features:[e.qOj],decls:3,vars:3,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource"],[3,"queryId","configuration",4,"ngIf"],[3,"queryId","configuration"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(j){return s.renameWidget(j)}),e._UZ(1,"widget-wp-table-menu",1),e.qZA(),e.YNc(2,bi,1,2,"wp-embedded-table",2)),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("ngIf",s.queryId))},directives:[q,ai,D.O5,Ri.Z],styles:["wp-embedded-table[_ngcontent-%COMP%]{overflow:auto}"],changeDetection:0});class St extends O._{onResourceChanged(o){this.resourceChanged.emit(o)}}St.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(St)))(s||St)}}(),St.\u0275cmp=e.Xpm({type:St,selectors:[["ng-component"]],features:[e.qOj],decls:2,vars:1,consts:[["wp-isolated-query-space","",1,"op-wp-table-qs"],[3,"resource","resourceChanged"]],template:function(o,s){1&o&&(e.ynx(0,0),e.TgZ(1,"widget-wp-table",1),e.NdJ("resourceChanged",function(j){return s.onResourceChanged(j)}),e.qZA(),e.BQk()),2&o&&(e.xp6(1),e.Q6J("resource",s.resource))},directives:[ve.A,Oi],styles:[".op-wp-table-qs[_ngcontent-%COMP%]   widget-wp-table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}"]});var Mi=t(74647),kn=t(74478);class cn{constructor(o,s,w){this.I18n=o,this.wpStatesInitialization=s,this.wpGraphConfiguration=w}initializeQuerySpace(){return this.wpGraphConfiguration.formFor(this.query).then(o=>{this.wpStatesInitialization.initialize(this.query,this.query.results),this.wpStatesInitialization.updateStatesFromForm(this.query,o)})}}var wi=t(78434),Pn=t(32557);function xn(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-query-filters",1),e.NdJ("filtersChanged",function(j){e.CHM(s);return e.oxw().filters=j}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("filters",s.filters)}}class Fi extends cn{constructor(o,s,w,j,ee){super(o,j,ee),this.I18n=o,this.wpTableFilters=s,this.wpFiltersService=w,this.wpStatesInitialization=j,this.wpGraphConfiguration=ee,this.filters=[],this.text={multiSelectLabel:this.I18n.t("js.work_packages.label_column_multiselect")}}ngOnInit(){this.initializeQuerySpace().then(()=>{this.wpTableFilters.onReady().then(()=>{this.filters=this.wpTableFilters.current})})}onSave(){this.filters&&(this.wpTableFilters.replaceIfComplete(this.filters),this.wpTableFilters.applyToQuery(this.wpGraphConfiguration.queries[0]))}get query(){return this.wpGraphConfiguration.queries[0]}}Fi.\u0275fac=function(o){return new(o||Fi)(e.Y36(y.D),e.Y36(Mi.Z),e.Y36(wi.U),e.Y36(kn.f),e.Y36(Ct))},Fi.\u0275cmp=e.Xpm({type:Fi,selectors:[["op-filters-tab-inner"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"filters","filtersChanged",4,"ngIf"],[3,"filters","filtersChanged"]],template:function(o,s){1&o&&e.YNc(0,xn,1,1,"op-query-filters",0),2&o&&e.Q6J("ngIf",!!s.filters)},directives:[D.O5,Pn.H],encapsulation:2});var En=t(61083);function Wi(g,o){if(1&g&&e._UZ(0,"option",9),2&g){const s=o.$implicit;e.Q6J("ngValue",s)("textContent",s.name)}}function gi(g,o){if(1&g&&e._UZ(0,"option",9),2&g){const s=o.$implicit;e.Q6J("ngValue",s)("textContent",s.label)}}const Ti=function(){return{standalone:!0}};class Ui extends cn{constructor(o,s,w,j){super(o,w,j),this.I18n=o,this.wpTableGroupBy=s,this.wpStatesInitialization=w,this.wpGraphConfiguration=j,this.availableGroups=[],this.text={group_by:this.I18n.t("js.chart.axis_criteria"),chart_type:this.I18n.t("js.chart.type")}}onSave(){this.wpGraphConfiguration.chartType=this.currentChartType.identifier,this.wpGraphConfiguration.queries.forEach(o=>{this.wpTableGroupBy.applyToQuery(o)})}get currentGroup(){return this.wpTableGroupBy.current}set currentGroup(o){this.wpTableGroupBy.update(o)}ngOnInit(){this.initializeQuerySpace().then(()=>{this.wpTableGroupBy.onReady().then(()=>{this.initializeAvailableGroups(),this.initializeAvailableChartType()})})}initializeAvailableGroups(){let{available:o}=this.wpTableGroupBy;const{current:s}=this.wpTableGroupBy;s&&(o=o.filter(w=>w.id!==s.id),o=o.concat(s)),this.availableGroups=_.sortBy(o,"name")}initializeAvailableChartType(){this.availableChartTypes=_.sortBy([{identifier:"horizontalBar",label:this.I18n.t("js.chart.types.horizontal_bar")},{identifier:"bar",label:this.I18n.t("js.chart.types.bar")},{identifier:"line",label:this.I18n.t("js.chart.types.line")},{identifier:"pie",label:this.I18n.t("js.chart.types.pie")},{identifier:"doughnut",label:this.I18n.t("js.chart.types.doughnut")},{identifier:"radar",label:this.I18n.t("js.chart.types.radar")},{identifier:"polarArea",label:this.I18n.t("js.chart.types.polar_area")}],"label"),this.currentChartType=this.availableChartTypes.find(o=>o.identifier===this.wpGraphConfiguration.configuration.chartType)||this.availableChartTypes[0]}get query(){return this.wpGraphConfiguration.queries[0]}}Ui.\u0275fac=function(o){return new(o||Ui)(e.Y36(y.D),e.Y36(En.w),e.Y36(kn.f),e.Y36(Ct))},Ui.\u0275cmp=e.Xpm({type:Ui,selectors:[["op-settings-tab-inner"]],features:[e.qOj],decls:14,vars:10,consts:[[1,"form"],[1,"form--field"],["for","selected_grouping",1,"form--label",3,"textContent"],[1,"form--field-container"],[1,"form--select-container","-middle"],["id","selected_grouping",1,"form--select",3,"ngModel","ngModelOptions","ngModelChange"],[3,"ngValue","textContent",4,"ngFor","ngForOf"],["for","selected_chart_type",1,"form--label",3,"textContent"],["id","selected_chart_type",3,"ngModel","ngModelOptions","ngModelChange"],[3,"ngValue","textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div"),e.TgZ(1,"form",0),e.TgZ(2,"div",1),e._UZ(3,"label",2),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e.TgZ(6,"select",5),e.NdJ("ngModelChange",function(j){return s.currentGroup=j}),e.YNc(7,Wi,1,2,"option",6),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",1),e._UZ(9,"label",7),e.TgZ(10,"div",3),e.TgZ(11,"div",4),e.TgZ(12,"select",8),e.NdJ("ngModelChange",function(j){return s.currentChartType=j}),e.YNc(13,gi,1,2,"option",6),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.group_by),e.xp6(3),e.Q6J("ngModel",s.currentGroup)("ngModelOptions",e.DdM(8,Ti)),e.xp6(1),e.Q6J("ngForOf",s.availableGroups),e.xp6(2),e.Q6J("textContent",s.text.chart_type),e.xp6(3),e.Q6J("ngModel",s.currentChartType)("ngModelOptions",e.DdM(9,Ti)),e.xp6(1),e.Q6J("ngForOf",s.availableChartTypes))},directives:[d._Y,d.JL,d.F,d.EJ,d.JJ,d.On,D.sg,d.YN,d.Kr],encapsulation:2});t(52386);var yi=t(5282);class Pi{constructor(){}}Pi.\u0275fac=function(o){return new(o||Pi)},Pi.\u0275mod=e.oAB({type:Pi}),Pi.\u0275inj=e.cJS({imports:[[n.H,C.K,m.H,_t.m9,yi.l]]}),e.B6R(pt,[ve.A,Fi],[]),e.B6R(Le,[ve.A,Ui],[]);var Dt=t(83845),fi=t(61342),Gi=t(54262);function On(g,o){if(1&g&&(e.TgZ(0,"edit-form",5),e._UZ(1,"op-editable-attribute-field",6),e.qZA()),2&g){const s=o.ngIf;e.Q6J("resource",s),e.xp6(1),e.Q6J("resource",s)}}class Ii extends O._{constructor(o,s,w,j,ee){super(o,s),this.i18n=o,this.injector=s,this.apiV3Service=w,this.currentProject=j,this.cdRef=ee}ngOnInit(){this.currentProject.id&&(this.project$=this.apiV3Service.projects.id(this.currentProject.id).get(),this.cdRef.detectChanges())}get isEditable(){return!1}}Ii.\u0275fac=function(o){return new(o||Ii)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(R.T),e.Y36(b.R),e.Y36(e.sBO))},Ii.\u0275cmp=e.Xpm({type:Ii,selectors:[["ng-component"]],features:[e._Bn([Pe.l]),e.qOj],decls:6,vars:7,consts:[[3,"name","editable"],["slot","prepend","attribute","description",3,"attributeScope"],["slot","menu",3,"resource"],[1,"grid--widget-content","-allow-inner-overflow"],[3,"resource",4,"ngIf"],[3,"resource"],["fieldName","description",3,"resource"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"attribute-help-text",1),e._UZ(2,"widget-menu",2),e.qZA(),e.TgZ(3,"div",3),e.YNc(4,On,2,2,"edit-form",4),e.ALo(5,"async"),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("attributeScope","Project"),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",e.lcZ(5,5,s.project$)))},directives:[q,Dt.y,fe,D.O5,fi.n,Gi.k],pipes:[D.Ov],encapsulation:2,changeDetection:0});const qi=["wpEmbeddedGraphMulti"],Mn=["wpEmbeddedGraphSingle"];function Xi(g,o){if(1&g&&(e.TgZ(0,"option",4),e._uU(1),e.qZA()),2&g){const s=o.$implicit;e.Q6J("ngValue",s.key),e.xp6(1),e.Oqu(s.label)}}function ln(g,o){if(1&g&&(e.TgZ(0,"div",5),e._UZ(1,"div",6),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.error)}}function dn(g,o){if(1&g&&e._UZ(0,"op-wp-embedded-graph",7,8),2&g){const s=e.oxw();e.Q6J("datasets",s.datasets)("chartOptions",s.chartOptions)}}function xi(g,o){if(1&g&&e._UZ(0,"op-wp-embedded-graph",7,9),2&g){const s=e.oxw();e.Q6J("datasets",s.datasets)("chartOptions",s.chartOptions)}}class Si{constructor(o,s,w,j){this.elementRef=o,this.I18n=s,this.graphConfigurationService=w,this.cdr=j,this.groupBy="status",this.chartOptions={maintainAspectRatio:!1},this.datasets=[],this.displayModeSingle=!0,this.error=null,this.availableGroupBy=[{label:s.t("js.work_packages.properties.category"),key:"category"},{label:s.t("js.work_packages.properties.type"),key:"type"},{label:s.t("js.work_packages.properties.status"),key:"status"},{label:s.t("js.work_packages.properties.priority"),key:"priority"},{label:s.t("js.work_packages.properties.author"),key:"author"},{label:s.t("js.work_packages.properties.assignee"),key:"assignee"}]}ngOnInit(){const o=this.elementRef.nativeElement;this.additionalFilter=JSON.parse(o.getAttribute("additional-filter")),this.setQueryProps()}setQueryProps(){this.datasets=[];const o=this.graphParams;this.graphConfigurationService.configuration=new Zt(o,{},"horizontalBar"),this.graphConfigurationService.reloadQueries().then(()=>{this.datasets=this.sortedDatasets(this.graphConfigurationService.datasets,o),this.cdr.detectChanges()}).catch(()=>{this.error=this.I18n.t("js.chart.errors.could_not_load"),this.cdr.detectChanges()})}get graphParams(){const o=[];return"status"===this.groupBy?(this.displayModeSingle=!0,o.push({name:this.I18n.t("js.label_all"),props:this.propsBoth})):(this.displayModeSingle=!1,o.push({name:this.I18n.t("js.label_open_work_packages"),props:this.propsOpen}),o.push({name:this.I18n.t("js.label_closed_work_packages"),props:this.propsClosed})),o}sortedDatasets(o,s){const w=s.map(j=>j.name);return o.slice().sort((j,ee)=>w.indexOf(j.label)-w.indexOf(ee.label))}get propsBoth(){return this.baseProps()}get propsOpen(){return this.baseProps({status:{operator:"o",values:[]}})}get propsClosed(){return this.baseProps({status:{operator:"c",values:[]}})}baseProps(o){const s=[{subprojectId:{operator:"*",values:[]}}];return o&&s.push(o),this.additionalFilter&&s.push(this.additionalFilter),{"columns[]":[],filters:JSON.stringify(s),group_by:this.groupBy,pageSize:0}}get displaySingle(){return this.displayModeSingle}get displayMulti(){return!this.displayModeSingle}get currentGraph(){return this.displaySingle?this.embeddedGraphSingle:this.embeddedGraphMulti}}Si.\u0275fac=function(o){return new(o||Si)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(Ct),e.Y36(e.sBO))},Si.\u0275cmp=e.Xpm({type:Si,selectors:[["wp-overview-graph"]],viewQuery:function(o,s){if(1&o&&(e.Gf(qi,5),e.Gf(Mn,5)),2&o){let w;e.iGM(w=e.CRH())&&(s.embeddedGraphMulti=w.first),e.iGM(w=e.CRH())&&(s.embeddedGraphSingle=w.first)}},inputs:{additionalFilter:"additionalFilter",groupBy:"groupBy",chartOptions:"chartOptions"},features:[e._Bn([Ct])],decls:5,vars:5,consts:[[3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["class","op-toast -error",4,"ngIf"],[3,"datasets","chartOptions",4,"ngIf"],[3,"ngValue"],[1,"op-toast","-error"],[1,"op-toast--content",3,"textContent"],[3,"datasets","chartOptions"],["wpEmbeddedGraphMulti",""],["wpEmbeddedGraphSingle",""]],template:function(o,s){1&o&&(e.TgZ(0,"select",0),e.NdJ("ngModelChange",function(j){return s.groupBy=j})("ngModelChange",function(){return s.setQueryProps()}),e.YNc(1,Xi,2,2,"option",1),e.qZA(),e.YNc(2,ln,2,1,"div",2),e.YNc(3,dn,2,2,"op-wp-embedded-graph",3),e.YNc(4,xi,2,2,"op-wp-embedded-graph",3)),2&o&&(e.Q6J("ngModel",s.groupBy),e.xp6(1),e.Q6J("ngForOf",s.availableGroupBy),e.xp6(1),e.Q6J("ngIf",s.error),e.xp6(1),e.Q6J("ngIf",s.displayMulti),e.xp6(1),e.Q6J("ngIf",s.displaySingle))},directives:[d.EJ,d.JJ,d.On,D.sg,D.O5,d.YN,d.Kr,zt],styles:["wp-embedded-graph[_ngcontent-%COMP%]{margin-top:20px;display:block}"],changeDetection:0});class Ei extends O._{}Ei.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Ei)))(s||Ei)}}(),Ei.\u0275cmp=e.Xpm({type:Ei,selectors:[["ng-component"]],features:[e.qOj],decls:3,vars:3,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource"],[1,"grid--widget-content","-no-overflow",3,"groupBy"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(j){return s.renameWidget(j)}),e._UZ(1,"widget-menu",1),e.qZA(),e._UZ(2,"wp-overview-graph",2)),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("groupBy","type"))},directives:[q,fe,Si],encapsulation:2,changeDetection:0});var Sn=t(86029),pn=t(94232);class di extends Sn.k{constructor(o,s,w,j){super(),this.elementRef=o,this.injector=s,this.halResource=w,this.schemaCache=j,this.fieldName="text"}onFocusOut(){}initialize(o){this.initializeChangeset(o),this.valueChanged$=new S.X(o.options.text)}reinitialize(o){this.initializeChangeset(o)}handleUserSubmit(){return this.update()}reset(o=""){let s=o;o.length>0&&(s+="\n"),this.changeset.setValue(this.fieldName,{raw:s})}get schema(){return{name:I18n.t("js.grid.widgets.custom_text.title"),writable:!0,required:!1,type:"Formattable",hasDefault:!1}}update(){return(0,se.mG)(this,void 0,void 0,function*(){return this.onSubmit().then(()=>{this.valueChanged$.next(this.rawText),this.deactivate()})})}get rawText(){return _.get(this.textValue,"raw","")}get htmlText(){return _.get(this.textValue,"html","")}get textValue(){return this.changeset.value(this.fieldName)}handleUserCancel(){this.deactivate()}deactivate(){this.changeset.clear(),this.active=!1}activate(){this.active=!0}get inEditMode(){return!1}get inFlight(){return this.changeset.inFlight}focus(){const o=this.elementRef.nativeElement.querySelector(".inplace-editing--trigger-container");o&&o.focus()}setErrors(){}handleUserKeydown(){}isChanged(){return!this.changeset.isEmpty()}stopPropagation(){return!1}initializeChangeset(o){const s="customtext-schema",w=o.grid,j={text:o.options.text,getEditorContext:()=>({type:"full",macros:"resource"}),canAddAttachments:o.grid.canAddAttachments,_links:{attachments:w.attachments,schema:{href:s}}};w.prepareAttachment&&(j._links.prepareAttachment=w.prepareAttachment);const ee=this.halResource.createHalResource(j,!0),me={text:this.schema,_links:{self:{href:s}}},De=this.halResource.createHalResource(me,!0);this.schemaCache.update(ee,De),this.changeset=new pn.W(ee)}}di.\u0275fac=function(o){return new(o||di)(e.LFG(e.SBq),e.LFG(e.zs3),e.LFG(gt.u),e.LFG(lt.y))},di.\u0275prov=e.Yz7({token:di,factory:di.\u0275fac});var Gt=t(9170),Yi=t(92058),Li=t(41689);const Bi=["displayContainer"];function Dn(g,o){if(1&g&&e._UZ(0,"div",12),2&g){const s=e.oxw(2);e.Q6J("innerHTML",s.customText,e.oJD)}}function An(g,o){if(1&g&&e._UZ(0,"div",13),2&g){const s=e.oxw(2);e.Q6J("innerHTML",s.placeholderText,e.oJD)}}function un(g,o){if(1&g&&(e.TgZ(0,"span",8,9),e.YNc(2,Dn,1,1,"div",10),e.YNc(3,An,1,1,"div",11),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("ngIf",!s.textEmpty),e.xp6(1),e.Q6J("ngIf",s.textEmpty)}}function jn(g,o){if(1&g&&e._UZ(0,"edit-form-portal",14),2&g){const s=e.oxw();e.Q6J("schemaInput",s.schema)("changeInput",s.changeset)("editFieldHandler",s.handler)}}function hn(g,o){if(1&g&&e._UZ(0,"attachments",15),2&g){const s=e.oxw();e.Q6J("resource",s.resource.grid)}}function _n(g,o){1&g&&e.GkF(0)}function mn(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(j){return e.CHM(s),e.oxw(2).activate(j)}),e.YNc(1,_n,1,0,"ng-container",20),e.qZA()}if(2&g){const s=e.oxw(2),w=e.MAs(3);e.Q6J("ngClass",s.inplaceEditClasses),e.xp6(1),e.Q6J("ngTemplateOutlet",w)}}function Di(g,o){1&g&&e.GkF(0)}function $i(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Di,1,0,"ng-container",20),e.BQk()),2&g){e.oxw(2);const s=e.MAs(3);e.xp6(1),e.Q6J("ngTemplateOutlet",s)}}const en=function(g){return{"inline-edit--container":g}};function Zn(g,o){if(1&g&&(e.TgZ(0,"div",16),e.YNc(1,mn,2,2,"button",17),e.YNc(2,$i,2,1,"ng-container",18),e.qZA()),2&g){const s=e.oxw();e.Q6J("ngClass",e.VKq(3,en,s.isTextEditable)),e.xp6(1),e.Q6J("ngIf",s.isTextEditable),e.xp6(1),e.Q6J("ngIf",!s.isTextEditable)}}class qt extends O._{constructor(o,s,w,j,ee,me,De){super(o,s),this.i18n=o,this.injector=s,this.handler=w,this.cdr=j,this.sanitization=ee,this.appRef=me,this.layout=De}ngOnInit(){this.setupVariables(!0),this.handler.valueChanged$.pipe(this.untilDestroyed(),(0,Gt.h)(o=>o!==this.resource.options.text)).subscribe(o=>{const s=this.setChangesetOptions({text:{raw:o}});this.resourceChanged.emit(s)})}ngOnChanges(o){o.resource.currentValue.options.text.raw!==this.currentRawText&&(this.setupVariables(),this.cdr.detectChanges())}activate(o){this.clickedElementIsLinkWithinDisplayContainer(o)||this.resource.grid.updateAttachments().then(()=>{this.handler.activate()})}get placeholderText(){return this.i18n.t("js.grid.widgets.work_packages_overview.placeholder")}get inplaceEditClasses(){let o="inplace-editing--container inline-edit--display-field -editable";return this.textEmpty&&(o+=" -placeholder"),o}get schema(){return this.handler.schema}get changeset(){return this.handler.changeset}get active(){return this.handler.active}get textEmpty(){return!this.currentRawText.length}get isTextEditable(){return this.layout.isEditable}setupVariables(o=!1){this.memorizeRawText(),o?this.handler.initialize(this.resource):this.handler.reinitialize(this.resource),this.memorizeCustomText()}memorizeRawText(){this.currentRawText=this.resource.options.text.raw}memorizeCustomText(){this.customText=this.sanitization.bypassSecurityTrustHtml(this.handler.htmlText),setTimeout(()=>{a.Z.bootstrapOptionalEmbeddable(this.appRef,this.displayContainer.nativeElement)},100)}clickedElementIsLinkWithinDisplayContainer(o){return this.displayContainer.nativeElement.contains(o.target.closest("a,macro"))}}qt.\u0275fac=function(o){return new(o||qt)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(di),e.Y36(e.sBO),e.Y36(i.H7),e.Y36(e.z2F),e.Y36(L))},qt.\u0275cmp=e.Xpm({type:qt,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(Bi,5),2&o){let w;e.iGM(w=e.CRH())&&(s.displayContainer=w.first)}},features:[e._Bn([di]),e.qOj,e.TTD],decls:9,vars:5,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource"],["text",""],[1,"grid--widget-content","-custom-text","-allow-inner-overflow"],[1,"inline-edit--container","inplace-edit"],[3,"schemaInput","changeInput","editFieldHandler",4,"ngIf"],["data-allow-uploading","true",3,"resource",4,"ngIf"],["class","inplace-edit--read wiki -no-label",3,"ngClass",4,"ngIf"],[1,"inline-edit--formattable-display-text","-default"],["displayContainer",""],["class","op-uc-container",3,"innerHTML",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[1,"op-uc-container",3,"innerHTML"],[3,"innerHTML"],[3,"schemaInput","changeInput","editFieldHandler"],["data-allow-uploading","true",3,"resource"],[1,"inplace-edit--read","wiki","-no-label",3,"ngClass"],["type","button",3,"ngClass","click",4,"ngIf"],[4,"ngIf"],["type","button",3,"ngClass","click"],[4,"ngTemplateOutlet"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(j){return s.renameWidget(j)}),e._UZ(1,"widget-menu",1),e.qZA(),e.YNc(2,un,4,2,"ng-template",null,2,e.W1O),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e.YNc(6,jn,1,3,"edit-form-portal",5),e.YNc(7,hn,1,1,"attachments",6),e.YNc(8,Zn,3,5,"div",7),e.qZA(),e.qZA()),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(5),e.Q6J("ngIf",s.active),e.xp6(1),e.Q6J("ngIf",s.active),e.xp6(1),e.Q6J("ngIf",!s.active))},directives:[q,fe,D.O5,Yi.m,Li.t,D.mk,D.tP],encapsulation:2,changeDetection:0});const Fe=["contentContainer"];function U(g,o){if(1&g&&(e.ynx(0),e.TgZ(1,"div",7),e._uU(2),e._UZ(3,"attribute-help-text",8),e.qZA(),e.TgZ(4,"div",9),e._UZ(5,"op-editable-attribute-field",10),e.qZA(),e.BQk()),2&g){const s=o.$implicit,w=e.oxw().ngIf;e.xp6(1),e.uIk("title",s.label),e.xp6(1),e.hij(" ",s.label," "),e.xp6(1),e.Q6J("attribute",s.key)("attributeScope","Project"),e.xp6(2),e.Q6J("resource",w)("fieldName",s.key)}}function z(g,o){if(1&g&&(e.TgZ(0,"edit-form",4),e.TgZ(1,"div",5),e.YNc(2,U,6,6,"ng-container",6),e.qZA(),e.qZA()),2&g){const s=o.ngIf,w=e.oxw();e.Q6J("resource",s),e.xp6(2),e.Q6J("ngForOf",w.customFields)}}class re extends O._{constructor(o,s,w,j,ee){super(o,s),this.i18n=o,this.injector=s,this.apiV3Service=w,this.currentProject=j,this.cdRef=ee,this.customFields=[]}ngOnInit(){this.loadAndRender(),this.currentProject.id&&(this.project$=this.apiV3Service.projects.id(this.currentProject.id).requireAndStream())}get isEditable(){return!1}loadAndRender(){Promise.all([this.loadProjectSchema()]).then(([o])=>{this.setCustomFields(o)})}loadProjectSchema(){return this.apiV3Service.projects.schema.get().toPromise()}setCustomFields(o){Object.entries(o).forEach(([s,w])=>{/customField\d+/.exec(s)&&this.customFields.push({key:s,label:w.name})}),this.cdRef.detectChanges()}}re.\u0275fac=function(o){return new(o||re)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(R.T),e.Y36(b.R),e.Y36(e.sBO))},re.\u0275cmp=e.Xpm({type:re,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(Fe,7),2&o){let w;e.iGM(w=e.CRH())&&(s.contentContainer=w.first)}},features:[e._Bn([Pe.l]),e.qOj],decls:5,vars:6,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"resource",4,"ngIf"],[3,"resource"],[1,"attributes-map"],[4,"ngFor","ngForOf"],[1,"attributes-map--key"],[3,"attribute","attributeScope"],[1,"attributes-map--value"],[3,"resource","fieldName"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,z,3,2,"edit-form",3),e.ALo(4,"async"),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,s.project$)))},directives:[q,fe,D.O5,fi.n,D.sg,Dt.y,Gi.k],pipes:[D.Ov],encapsulation:2,changeDetection:0});var we=t(29161),Ze=t(84335);class We extends O._{constructor(o,s,w,j,ee,me){super(w,o),this.injector=o,this.timezone=s,this.i18n=w,this.pathHelper=j,this.confirmDialog=ee,this.cdr=me,this.text={edit:this.i18n.t("js.button_edit"),delete:this.i18n.t("js.button_delete"),confirmDelete:{text:this.i18n.t("js.modals.destroy_time_entry.text"),title:this.i18n.t("js.modals.destroy_time_entry.title")},noResults:this.i18n.t("js.grid.widgets.time_entries_list.no_results")},this.entries=[],this.entriesLoaded=!1,this.rows=[]}ngOnInit(){this.apiV3Service.time_entries.list({filters:this.dmFilters(),pageSize:500}).subscribe(o=>(0,se.mG)(this,void 0,void 0,function*(){this.buildEntries(o.elements),o.count>0&&(this.schema=yield this.loadSchema()),this.entriesLoaded=!0,this.cdr.detectChanges()}))}get total(){const o=this.entries.reduce((s,w)=>s+this.timezone.toHours(w.hours),0);return this.i18n.t("js.units.hour",{count:this.formatNumber(o)})}get anyEntries(){return!!this.entries.length}activityName(o){return o.activity.name}projectName(o){return o.project.name}workPackageName(o){return`#${o.workPackage.id}: ${o.workPackage.name}`}workPackageId(o){return o.workPackage.id}comment(o){return o.comment&&o.comment.raw}hours(o){return this.formatNumber(this.timezone.toHours(o.hours))}workPackagePath(o){return this.pathHelper.workPackagePath((0,Ae.Z)(o.workPackage.href))}get isEditable(){return!1}editTimeEntry(o){this.apiV3Service.time_entries.id(o.id).get().subscribe(s=>{this.timeEntryEditService.edit(s).then(w=>{const j=this.entries.findIndex(me=>me.id===w.entry.id),ee=this.entries;ee[j]=w.entry,this.buildEntries(ee)}).catch(()=>{})})}deleteIfConfirmed(o,s){var w,j,ee;o.preventDefault(),this.confirmDialog.confirm({text:this.text.confirmDelete,closeByEscape:!0,showClose:!0,closeByDocument:!0,passedData:[`#${(0,Ae.Z)(null===(w=s.workPackage)||void 0===w?void 0:w.href)} ${null===(j=s.workPackage)||void 0===j?void 0:j.name}`,`${this.i18n.t("js.units.hour",{count:this.timezone.toHours(s.hours)})} (${null===(ee=s.activity)||void 0===ee?void 0:ee.name})`],dangerHighlighting:!0}).then(()=>{s.delete().then(()=>{const me=this.entries.filter(De=>s.id!==De.id);this.buildEntries(me)})}).catch(()=>{})}buildEntries(o){this.entries=o;const s={};o.forEach(ee=>{const me=ee.spentOn;s[me]||(s[me]=0),s[me]+=this.timezone.toHours(ee.hours)});const w=o.sort((ee,me)=>me.spentOn.localeCompare(ee.spentOn));this.rows=[];let j=null;w.forEach(ee=>{ee.spentOn!==j&&(j=ee.spentOn,this.rows.push({date:this.timezone.formattedDate(j),sum:this.formatNumber(s[j])})),this.rows.push({date:j,entry:ee})})}formatNumber(o){return this.i18n.toNumber(o,{precision:2})}get noEntries(){return!this.entries.length&&this.entriesLoaded}loadSchema(){return this.apiV3Service.time_entries.schema.get().toPromise()}}We.\u0275fac=function(o){return new(o||We)(e.Y36(e.zs3),e.Y36(tt.B),e.Y36(y.D),e.Y36(je.j),e.Y36(Ze.D),e.Y36(e.sBO))},We.\u0275dir=e.lG2({type:We,features:[e.qOj]}),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",Ee.d)],We.prototype,"timeEntryEditService",void 0),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",R.T)],We.prototype,"apiV3Service",void 0);var Ve=t(81979);function Ge(g,o){if(1&g&&e._UZ(0,"op-no-results",4),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function rt(g,o){if(1&g&&e._UZ(0,"td",26),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.Q6J("textContent",w.activityName(s.entry))}}function Xe(g,o){if(1&g&&(e.TgZ(0,"td",27),e._UZ(1,"strong",6),e.qZA()),2&g){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("textContent",s.date)}}function at(g,o){if(1&g&&(e.TgZ(0,"td",28),e._uU(1),e._UZ(2,"a",29),e.qZA()),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.xp6(1),e.hij(" ",w.projectName(s.entry)," - "),e.xp6(1),e.Q6J("href",w.workPackagePath(s.entry),e.LSH)("textContent",w.workPackageName(s.entry))}}function Bt(g,o){if(1&g&&e._UZ(0,"td",30),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.Q6J("textContent",w.projectName(s.entry))}}function oi(g,o){if(1&g&&e._UZ(0,"td",31),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.Q6J("textContent",w.comment(s.entry))}}function wt(g,o){if(1&g&&e._UZ(0,"td",32),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.Q6J("textContent",w.hours(s.entry))}}function ft(g,o){if(1&g&&(e.TgZ(0,"td",33),e._UZ(1,"em",6),e.qZA()),2&g){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("textContent",s.sum)}}function ge(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",34),e.NdJ("click",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw(3).editTimeEntry(j.entry)}),e._UZ(1,"op-icon",35),e.qZA()}if(2&g){const s=e.oxw(4);e.Q6J("title",s.text.edit)}}function B(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",34),e.NdJ("click",function(j){e.CHM(s);const ee=e.oxw().$implicit;return e.oxw(3).deleteIfConfirmed(j,ee.entry)}),e._UZ(1,"op-icon",36),e.qZA()}if(2&g){const s=e.oxw(4);e.Q6J("title",s.text.delete)}}function x(g,o){if(1&g&&(e.TgZ(0,"tr",16),e.YNc(1,rt,1,1,"td",17),e.YNc(2,Xe,2,1,"td",18),e.YNc(3,at,3,3,"td",19),e.YNc(4,Bt,1,1,"td",20),e.YNc(5,oi,1,1,"td",21),e.YNc(6,wt,1,1,"td",22),e.YNc(7,ft,2,1,"td",23),e.TgZ(8,"td",24),e.YNc(9,ge,2,1,"a",25),e.YNc(10,B,2,1,"a",25),e.qZA(),e.qZA()),2&g){const s=o.$implicit;e.xp6(1),e.Q6J("ngIf",s.entry),e.xp6(1),e.Q6J("ngIf",s.sum),e.xp6(1),e.Q6J("ngIf",s.entry&&s.entry.workPackage),e.xp6(1),e.Q6J("ngIf",s.entry&&!s.entry.workPackage),e.xp6(1),e.Q6J("ngIf",s.entry),e.xp6(1),e.Q6J("ngIf",s.entry),e.xp6(1),e.Q6J("ngIf",s.sum),e.xp6(2),e.Q6J("ngIf",s.entry&&s.entry.updateImmediately),e.xp6(1),e.Q6J("ngIf",s.entry&&s.entry.delete)}}function A(g,o){if(1&g&&(e.TgZ(0,"div",8),e.TgZ(1,"table",9),e.TgZ(2,"colgroup"),e._UZ(3,"col",10),e._UZ(4,"col",10),e._UZ(5,"col",10),e._UZ(6,"col",10),e._UZ(7,"col"),e.qZA(),e.TgZ(8,"thead",11),e.TgZ(9,"tr"),e.TgZ(10,"th"),e.TgZ(11,"div",12),e.TgZ(12,"div",13),e._UZ(13,"span",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"th"),e.TgZ(15,"div",12),e.TgZ(16,"div",13),e._UZ(17,"span",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(18,"th"),e.TgZ(19,"div",12),e.TgZ(20,"div",13),e._UZ(21,"span",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"th"),e.TgZ(23,"div",12),e.TgZ(24,"div",13),e._UZ(25,"span",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(26,"th"),e._UZ(27,"div",14),e.qZA(),e.qZA(),e.qZA(),e.TgZ(28,"tbody"),e.YNc(29,x,11,9,"tr",15),e.qZA(),e.qZA(),e.qZA()),2&g){const s=e.oxw(2);e.xp6(13),e.Q6J("textContent",s.schema.activity.name),e.xp6(4),e.Q6J("textContent",s.schema.workPackage.name),e.xp6(4),e.Q6J("textContent",s.schema.comment.name),e.xp6(4),e.Q6J("textContent",s.schema.hours.name),e.xp6(4),e.Q6J("ngForOf",s.rows)}}function Z(g,o){if(1&g&&(e.ynx(0),e.TgZ(1,"div",5),e.TgZ(2,"p"),e._uU(3,"Total: "),e._UZ(4,"span",6),e.qZA(),e.qZA(),e.YNc(5,A,30,5,"div",7),e.BQk()),2&g){const s=e.oxw();e.xp6(4),e.Q6J("textContent",s.total),e.xp6(1),e.Q6J("ngIf",s.entriesLoaded&&s.anyEntries)}}class Ce extends We{constructor(o,s,w,j,ee,me,De){super(o,s,w,j,ee,me),this.injector=o,this.timezone=s,this.i18n=w,this.pathHelper=j,this.confirmDialog=ee,this.cdr=me,this.currentProject=De}dmFilters(){return[["spentOn",">t-",["7"]],["project_id","=",[this.currentProject.id]]]}}function Ie(g,o){if(1&g&&e._UZ(0,"op-no-results",5),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function Be(g,o){1&g&&(e.TgZ(0,"span"),e._uU(1,", "),e.qZA())}function Tt(g,o){if(1&g&&(e.TgZ(0,"span"),e._UZ(1,"a",6),e.YNc(2,Be,2,0,"span",7),e.qZA()),2&g){const s=o.$implicit,w=o.last,j=e.oxw();e.xp6(1),e.Q6J("href",j.projectPath(s),e.LSH)("textContent",j.projectName(s)),e.xp6(1),e.Q6J("ngIf",!w)}}Ce.\u0275fac=function(o){return new(o||Ce)(e.Y36(e.zs3),e.Y36(tt.B),e.Y36(y.D),e.Y36(je.j),e.Y36(Ze.D),e.Y36(e.sBO),e.Y36(b.R))},Ce.\u0275cmp=e.Xpm({type:Ce,selectors:[["ng-component"]],features:[e.qOj],decls:4,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[3,"title",4,"ngIf"],[4,"ngIf"],[3,"title"],[1,"total-hours"],[3,"textContent"],["class","generic-table--results-container",4,"ngIf"],[1,"generic-table--results-container"],[1,"generic-table","time-entries"],["opHighlightCol",""],[1,"-sticky"],[1,"generic-table--sort-header-outer"],[1,"generic-table--sort-header"],[1,"generic-table--empty-header"],["class","time-entry",4,"ngFor","ngForOf"],[1,"time-entry"],["class","activity",3,"textContent",4,"ngIf"],["colspan","3",4,"ngIf"],["class","subject",4,"ngIf"],["class","subject",3,"textContent",4,"ngIf"],["class","comments",3,"textContent",4,"ngIf"],["class","hours",3,"textContent",4,"ngIf"],["class","hours",4,"ngIf"],[1,"buttons"],[3,"title","click",4,"ngIf"],[1,"activity",3,"textContent"],["colspan","3"],[1,"subject"],[3,"href","textContent"],[1,"subject",3,"textContent"],[1,"comments",3,"textContent"],[1,"hours",3,"textContent"],[1,"hours"],[3,"title","click"],["icon-classes","icon-context icon-edit"],["icon-classes","icon-context icon-delete"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.YNc(2,Ge,1,1,"op-no-results",2),e.YNc(3,Z,6,2,"ng-container",3)),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("ngIf",s.noEntries),e.xp6(1),e.Q6J("ngIf",!s.noEntries))},directives:[q,fe,D.O5,kt.S,Ve.K,D.sg,Ye.o],encapsulation:2});class Qt extends O._{constructor(o,s,w,j,ee,me,De,Je){super(w,j),this.halResource=o,this.pathHelper=s,this.i18n=w,this.injector=j,this.timezone=ee,this.apiV3Service=me,this.currentProject=De,this.cdr=Je,this.text={noResults:this.i18n.t("js.grid.widgets.subprojects.no_results")}}ngOnInit(){this.apiV3Service.projects.list(this.projectListParams).subscribe(o=>{this.projects=o.elements,this.cdr.detectChanges()})}get isEditable(){return!1}projectPath(o){return this.pathHelper.projectPath(o.identifier)}projectName(o){return o.name}get noEntries(){return this.projects&&!this.projects.length}get projectListParams(){return{sortBy:[["name","asc"]],filters:[["parent_id","=",[this.currentProject.id]]]}}}function bt(g,o){if(1&g&&e._UZ(0,"op-no-results",10),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function xt(g,o){1&g&&(e.ynx(0),e._uU(1,", "),e.BQk())}function Nt(g,o){if(1&g&&(e.ynx(0),e._UZ(1,"op-principal",13),e.YNc(2,xt,2,0,"ng-container",14),e.BQk()),2&g){const s=o.$implicit,w=o.last;e.xp6(1),e.Q6J("principal",s),e.xp6(1),e.Q6J("ngIf",!w)}}function Rt(g,o){if(1&g&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.qZA(),e.TgZ(3,"div",12),e.YNc(4,Nt,3,2,"ng-container",5),e.qZA(),e.BQk()),2&g){const s=o.$implicit;e.xp6(2),e.hij(" ",s.role.name," "),e.xp6(2),e.Q6J("ngForOf",s.users)}}function pi(g,o){if(1&g&&(e.TgZ(0,"div",15),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.moreMembersText," ")}}function tn(g,o){if(1&g&&(e.TgZ(0,"a",16),e._UZ(1,"i",17),e._UZ(2,"span",18),e.qZA()),2&g){const s=e.oxw();e.Q6J("href",s.projectMembershipsPath+"?show_add_members=true",e.LSH),e.xp6(2),e.Q6J("textContent",s.text.add)}}function Rn(g,o){if(1&g&&(e.TgZ(0,"a",19),e._UZ(1,"i",20),e._UZ(2,"span",18),e.qZA()),2&g){const s=e.oxw();e.Q6J("href",s.projectMembershipsPath,e.LSH),e.xp6(2),e.Q6J("textContent",s.text.viewAll)}}Qt.\u0275fac=function(o){return new(o||Qt)(e.Y36(gt.u),e.Y36(je.j),e.Y36(y.D),e.Y36(e.zs3),e.Y36(tt.B),e.Y36(R.T),e.Y36(b.R),e.Y36(e.sBO))},Qt.\u0275cmp=e.Xpm({type:Qt,selectors:[["ng-component"]],features:[e.qOj],decls:5,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"title",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"title"],[3,"href","textContent"],[4,"ngIf"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,Ie,1,1,"op-no-results",3),e.YNc(4,Tt,3,3,"span",4),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",s.noEntries),e.xp6(1),e.Q6J("ngForOf",s.projects))},directives:[q,fe,D.O5,D.sg,kt.S],encapsulation:2,changeDetection:0});class Gn extends O._{constructor(o,s,w,j,ee,me){super(w,j),this.pathHelper=o,this.apiV3Service=s,this.i18n=w,this.injector=j,this.currentProject=ee,this.cdr=me,this.text={add:this.i18n.t("js.grid.widgets.members.add"),noResults:this.i18n.t("js.grid.widgets.members.no_results"),viewAll:this.i18n.t("js.grid.widgets.members.view_all_members")},this.entriesByRoles={},this.entriesLoaded=!1,this.membersAddable=!1}ngOnInit(){this.apiV3Service.memberships.list(this.listMembersParams).subscribe(o=>{this.partitionEntriesByRole(o.elements),this.sortUsersByName(),this.totalMembers=o.total,this.entriesLoaded=!0,this.cdr.detectChanges()}),this.apiV3Service.memberships.available_projects.list(this.listAvailableProjectsParams).subscribe(o=>{this.membersAddable=o.total>0})}get isEditable(){return!1}get noMembers(){return this.entriesLoaded&&!Object.keys(this.entriesByRoles).length}get moreMembers(){return this.entriesLoaded&&this.totalMembers>100}get moreMembersText(){return I18n.t("js.grid.widgets.members.too_many",{count:100,total:this.totalMembers})}get projectMembershipsPath(){return this.pathHelper.projectMembershipsPath(this.currentProject.identifier)}get usersByRole(){return Object.values(this.entriesByRoles)}partitionEntriesByRole(o){o.forEach(s=>{s.roles.forEach(w=>{this.entriesByRoles[w.id]||(this.entriesByRoles[w.id]={role:w,users:[]}),this.entriesByRoles[w.id].users.push(s.principal)})})}sortUsersByName(){Object.values(this.entriesByRoles).forEach(o=>{o.users.sort((s,w)=>s.name.localeCompare(w.name))})}get listMembersParams(){const o={sortBy:[["created_at","desc"]],pageSize:100};return this.currentProject.id&&(o.filters=[["project_id","=",[this.currentProject.id]]]),o}get listAvailableProjectsParams(){const o={};return this.currentProject.id&&(o.filters=[["id","=",[this.currentProject.id]]]),o}}Gn.\u0275fac=function(o){return new(o||Gn)(e.Y36(je.j),e.Y36(R.T),e.Y36(y.D),e.Y36(e.zs3),e.Y36(b.R),e.Y36(e.sBO))},Gn.\u0275cmp=e.Xpm({type:Gn,selectors:[["ng-component"]],features:[e.qOj],decls:10,vars:8,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"title",4,"ngIf"],[1,"op-members-widget--attributes-map","-minimal-keys"],[4,"ngFor","ngForOf"],["class","op-members-widget--notification",4,"ngIf"],[1,"op-members-widget--grid--widget-footer"],["class","button -alt-highlight",3,"href",4,"ngIf"],["class","button -highlight-inverted",3,"href",4,"ngIf"],[3,"title"],[1,"attributes-map--key"],[1,"attributes-map--value"],["size","mini",3,"principal"],[4,"ngIf"],[1,"op-members-widget--notification"],[1,"button","-alt-highlight",3,"href"],["aria-hidden","true",1,"button--icon","icon-add"],[1,"button--text",3,"textContent"],[1,"button","-highlight-inverted",3,"href"],["aria-hidden","true",1,"button--icon","icon-group"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,bt,1,1,"op-no-results",3),e.TgZ(4,"div",4),e.YNc(5,Rt,5,2,"ng-container",5),e.qZA(),e.YNc(6,pi,2,1,"div",6),e.qZA(),e.TgZ(7,"div",7),e.YNc(8,tn,3,2,"a",8),e.YNc(9,Rn,3,2,"a",9),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",s.noMembers),e.xp6(2),e.Q6J("ngForOf",s.usersByRole),e.xp6(1),e.Q6J("ngIf",s.moreMembers),e.xp6(2),e.Q6J("ngIf",s.membersAddable),e.xp6(1),e.Q6J("ngIf",!s.noMembers))},directives:[q,fe,D.O5,D.sg,kt.S,vt.N],styles:[".op-members-widget--notification[_ngcontent-%COMP%]{font-style:italic;margin-top:.5rem}.op-members-widget--grid--widget-footer[_ngcontent-%COMP%]{margin-top:.5rem}.op-members-widget--grid--widget-footer[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{margin-bottom:0}.op-members-widget--attributes-map[_ngcontent-%COMP%]{padding-bottom:.875rem;line-height:1.5rem}"],changeDetection:0});var ja=t(84897);const Za=["contentContainer"];function Ra(g,o){if(1&g&&(e.TgZ(0,"edit-form",5),e.TgZ(1,"div",6),e._UZ(2,"op-editable-attribute-field",7),e.qZA(),e.TgZ(3,"div",8),e._UZ(4,"op-editable-attribute-field",9),e.qZA(),e.qZA()),2&g){const s=o.ngIf;e.Q6J("resource",s),e.xp6(2),e.Q6J("resource",s),e.xp6(2),e.Q6J("resource",s)}}class qn extends O._{constructor(o,s,w,j,ee){super(o,s),this.i18n=o,this.injector=s,this.apiV3Service=w,this.currentProject=j,this.cdRef=ee,this.currentStatusCode="not set",this.explanation=""}ngOnInit(){this.currentProject.id&&(this.project$=this.apiV3Service.projects.id(this.currentProject.id).get(),this.cdRef.detectChanges())}get isEditable(){return!1}}qn.\u0275fac=function(o){return new(o||qn)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(R.T),e.Y36(b.R),e.Y36(e.sBO))},qn.\u0275cmp=e.Xpm({type:qn,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(Za,7),2&o){let w;e.iGM(w=e.CRH())&&(s.contentContainer=w.first)}},features:[e._Bn([ja.B,Ci.q,Pe.l]),e.qOj],decls:6,vars:7,consts:[[3,"name","editable"],["slot","prepend","attribute","status",3,"attributeScope"],["slot","menu",3,"resource"],[1,"grid--widget-content","-allow-inner-overflow"],[3,"resource",4,"ngIf"],[3,"resource"],[1,"project-status--container"],["fieldName","status","wrapperClasses","project-status--display-field",3,"resource"],[1,"project-status-explanation--container"],["fieldName","statusExplanation",3,"resource"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"attribute-help-text",1),e._UZ(2,"widget-menu",2),e.qZA(),e.TgZ(3,"div",3),e.YNc(4,Ra,5,3,"edit-form",4),e.ALo(5,"async"),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("attributeScope","Project"),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",e.lcZ(5,5,s.project$)))},directives:[q,Dt.y,fe,D.O5,fi.n,Gi.k],pipes:[D.Ov],encapsulation:2,changeDetection:0});var Fa=t(54349),Fn=t(26269);class nn{constructor(o){!function(g){const o=g.get(f.$),s=g.get(y.D);o.register("gridWidgets",()=>{const w=["id","project","type","subject"],j=new Fn.qM;j.add("assignee","=",["me"]),j.add("status","o",[]);const ee={"columns[]":w,filters:j.toJson()},me=new Fn.qM;me.add("responsible","=",["me"]),me.add("status","o",[]);const De={"columns[]":w,filters:me.toJson()},Je=new Fn.qM;Je.add("author","=",["me"]),Je.add("status","o",[]);const qe={"columns[]":w,filters:Je.toJson()},Et=new Fn.qM;Et.add("watcher","=",["me"]),Et.add("status","o",[]);const At={"columns[]":w,filters:Et.toJson()};return[{identifier:"work_packages_assigned",component:St,title:s.t("js.grid.widgets.work_packages_assigned.title"),properties:{queryProps:ee,name:s.t("js.grid.widgets.work_packages_assigned.title")}},{identifier:"work_packages_accountable",component:St,title:s.t("js.grid.widgets.work_packages_accountable.title"),properties:{queryProps:De,name:s.t("js.grid.widgets.work_packages_accountable.title")}},{identifier:"work_packages_created",component:St,title:s.t("js.grid.widgets.work_packages_created.title"),properties:{queryProps:qe,name:s.t("js.grid.widgets.work_packages_created.title")}},{identifier:"work_packages_watched",component:St,title:s.t("js.grid.widgets.work_packages_watched.title"),properties:{queryProps:At,name:s.t("js.grid.widgets.work_packages_watched.title")}},{identifier:"work_packages_table",component:St,title:s.t("js.grid.widgets.work_packages_table.title"),properties:{name:s.t("js.grid.widgets.work_packages_table.title")}},{identifier:"work_packages_graph",component:li,title:s.t("js.grid.widgets.work_packages_graph.title"),properties:{name:s.t("js.grid.widgets.work_packages_graph.title")}},{identifier:"work_packages_calendar",component:Oe,title:s.t("js.grid.widgets.work_packages_calendar.title"),properties:{name:s.t("js.grid.widgets.work_packages_calendar.title")}},{identifier:"work_packages_overview",component:Ei,title:s.t("js.grid.widgets.work_packages_overview.title"),properties:{name:s.t("js.grid.widgets.work_packages_overview.title")}},{identifier:"time_entries_current_user",component:Ft,title:s.t("js.grid.widgets.time_entries_current_user.title"),properties:{name:s.t("js.grid.widgets.time_entries_current_user.title"),days:[!0,!0,!0,!0,!0,!0,!0]}},{identifier:"time_entries_project",component:Ce,title:s.t("js.grid.widgets.time_entries_list.title"),properties:{name:s.t("js.grid.widgets.time_entries_list.title")}},{identifier:"documents",component:$t,title:s.t("js.grid.widgets.documents.title"),properties:{name:s.t("js.grid.widgets.documents.title")}},{identifier:"members",component:Gn,title:s.t("js.grid.widgets.members.title"),properties:{name:s.t("js.grid.widgets.members.title")}},{identifier:"news",component:pe,title:s.t("js.grid.widgets.news.title"),properties:{name:s.t("js.grid.widgets.news.title")}},{identifier:"project_description",component:Ii,title:s.t("js.grid.widgets.project_description.title"),properties:{name:s.t("js.grid.widgets.project_description.title")}},{identifier:"custom_text",component:qt,title:s.t("js.grid.widgets.custom_text.title"),properties:{name:s.t("js.grid.widgets.custom_text.title"),text:{raw:""}}},{identifier:"project_details",component:re,title:s.t("js.grid.widgets.project_details.title"),properties:{name:s.t("js.grid.widgets.project_details.title")}},{identifier:"project_status",component:qn,title:s.t("js.grid.widgets.project_status.title"),properties:{name:s.t("js.grid.widgets.project_status.title")}},{identifier:"subprojects",component:Qt,title:s.t("js.grid.widgets.subprojects.title"),properties:{name:s.t("js.grid.widgets.subprojects.title")}}]})}(o)}}nn.\u0275fac=function(o){return new(o||nn)(e.LFG(e.zs3))},nn.\u0275mod=e.oAB({type:nn}),nn.\u0275inj=e.cJS({providers:[It,he],imports:[[i.b2,d.u5,k._t,n.H,C.K,m.H,Pi,u.OpenprojectCalendarModule,Fa.I,v.Z,p.wA.withComponents([qt,$t,Gn,pe,St,li,Oe,Ei,Ii,re,qn,Qt,Ft,Ce]),r.E]]});var Br=t(84732),Vt=t(84906);const Qr="openproject-base";class Wn{}Wn.\u0275fac=function(o){return new(o||Wn)},Wn.\u0275cmp=e.Xpm({type:Wn,selectors:[["openproject-base"]],decls:2,vars:0,consts:[[1,"openproject-base--ui-view"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"ui-view"),e.qZA())},directives:[Vt.UIView],encapsulation:2});var Ua=t(57014);const La=[{name:"my_notifications.**",url:"/my/notifications",loadChildren:()=>t.e("src_app_features_user-preferences_user-preferences_module_ts").then(t.bind(t,91880)).then(g=>g.OpenProjectMyAccountModule)},{name:"user_notifications.**",url:"/users/:userId/edit/notifications",loadChildren:()=>t.e("src_app_features_user-preferences_user-preferences_module_ts").then(t.bind(t,91880)).then(g=>g.OpenProjectMyAccountModule)},{name:"my_reminders.**",url:"/my/reminders",loadChildren:()=>t.e("src_app_features_user-preferences_user-preferences_module_ts").then(t.bind(t,91880)).then(g=>g.OpenProjectMyAccountModule)},{name:"user_reminders.**",url:"/users/:userId/edit/reminders",loadChildren:()=>t.e("src_app_features_user-preferences_user-preferences_module_ts").then(t.bind(t,91880)).then(g=>g.OpenProjectMyAccountModule)}],Ba=[{name:"notifications.**",url:"/notifications",loadChildren:()=>Promise.resolve().then(t.bind(t,27835)).then(g=>g.OpenProjectInAppNotificationsModule)}];var mr=t(53916);const $a=[{name:"new_project.**",url:"/projects/new",loadChildren:()=>Promise.resolve().then(t.bind(t,71718)).then(g=>g.OpenprojectProjectsModule)},{name:"root",abstract:!0,url:"",component:Wn,params:{flash_message:{dynamic:!0,value:null,inherit:!1}}},{name:"optional_project",parent:"root",url:"/{projects}/{projectPath}",abstract:!0,params:{projectPath:{type:"path",value:null,squash:!0},projects:{type:"path",value:null,squash:!0}},views:{"!$default":{component:Wn}}},{name:"api-docs.**",parent:"optional_project",url:"/api/docs",loadChildren:()=>t.e("src_app_features_api-docs_openproject-api-docs_module_ts").then(t.bind(t,84138)).then(g=>g.OpenprojectApiDocsModule)},{name:"boards.**",parent:"optional_project",url:"/boards",loadChildren:()=>t.e("src_app_features_boards_openproject-boards_module_ts").then(t.bind(t,20555)).then(g=>g.OpenprojectBoardsModule)},{name:"bim.**",parent:"optional_project",url:"/bcf",loadChildren:()=>t.e("src_app_features_bim_ifc_models_openproject-ifc-models_module_ts").then(t.bind(t,29526)).then(g=>g.OpenprojectIFCModelsModule)},{name:"backlogs.**",parent:"optional_project",url:"/backlogs",loadChildren:()=>t.e("src_app_features_backlogs_openproject-backlogs_module_ts").then(t.bind(t,89732)).then(g=>g.OpenprojectBacklogsModule)},{name:"backlogs_sprint.**",parent:"optional_project",url:"/sprints",loadChildren:()=>t.e("src_app_features_backlogs_openproject-backlogs_module_ts").then(t.bind(t,89732)).then(g=>g.OpenprojectBacklogsModule)},{name:"reporting.**",parent:"optional_project",url:"/cost_reports",loadChildren:()=>t.e("src_app_features_reporting_openproject-reporting_module_ts").then(t.bind(t,74672)).then(g=>g.OpenprojectReportingModule)},{name:"job-statuses.**",parent:"optional_project",url:"/job_statuses",loadChildren:()=>t.e("src_app_features_job-status_openproject-job-status_module_ts").then(t.bind(t,15732)).then(g=>g.OpenProjectJobStatusModule)},{name:"project_settings.**",parent:"optional_project",url:"/settings/general",loadChildren:()=>Promise.resolve().then(t.bind(t,71718)).then(g=>g.OpenprojectProjectsModule)},{name:"project_copy.**",parent:"optional_project",url:"/copy",loadChildren:()=>Promise.resolve().then(t.bind(t,71718)).then(g=>g.OpenprojectProjectsModule)},...La,...Ba,...[{name:"team_planner.**",parent:"optional_project",url:"/team_planner",loadChildren:()=>t.e("src_app_features_team-planner_team-planner_team-planner_module_ts").then(t.bind(t,25193)).then(g=>g.TeamPlannerModule)}],...[{name:"calendar.**",parent:"optional_project",url:"/calendars",loadChildren:()=>Promise.resolve().then(t.bind(t,51303)).then(g=>g.OpenprojectCalendarModule)}]];function gr(g,o="add"){g&&(Array.isArray(g)?g.forEach(s=>{document.body.classList[o](s)}):document.body.classList[o](g))}function Nr(g,o="add"){if(!g)return;const s=jQuery(`#main-menu .${g}`)[0];if(!s)return;s.classList[o]("selected");let w=(s.getAttribute("title")||"").split(":").slice(-1)[0];"add"===o&&(w=I18n.t("js.description_current_position")+w),s.setAttribute("title",w)}function Ha(g){const o=g.get(Ke.TransitionService),s=g.get(Ke.StateService),w=g.get(M.kl),j=g.get(b.R),ee=g.get(Br.p),me=g.get(Ua.Y),De=document.querySelector(Qr);o.onBefore({to:Je=>!!Je&&function(g){return g.data&&g.data.mobileAlternative&&(new mr.U).isMobile}(Je)},Je=>function(g){const o=g.router.stateService,s=g.to().data.mobileAlternative;return o.target(s,g.params(),{})}(Je)),o.onEnter({},(Je,qe)=>{gr(_.get(qe,"data.bodyClasses"),"add"),Je.from().data&&_.get(qe,"data.menuItem")!==Je.from().data.menuItem&&Nr(_.get(qe,"data.menuItem"),"add")}),o.onExit({},(Je,qe)=>{gr(_.get(qe,"data.bodyClasses"),"remove"),Je.to().data&&_.get(qe,"data.menuItem")!==Je.to().data.menuItem&&Nr(_.get(qe,"data.menuItem"),"remove")}),o.onStart({},Je=>{var qe;const Et=Je.router.stateService,At=Je.params("to"),ci=Je.to();if(At.start_onboarding_tour&&"work-packages.partitioned.list"!==ci.name){const hi=Object.assign({},Je.params());return hi.start_onboarding_tour=void 0,Et.target(Je.to(),hi)}me.sync(Je);const rr=window.MiniProfiler;null==rr||rr.pageTransition();const ar=ci.$$state&&ci.$$state(),Lr=null===(qe=null==ar?void 0:ar.includes)||void 0===qe?void 0:qe.root,hr=At.projectPath||j.identifier;if(Lr&&!At.projects&&hr){const hi=_.clone(At);return _.assign(hi,{projectPath:hr,projects:"projects"}),Et.target(ci,hi,{location:"replace"})}if(null===De){const hi=window.location.pathname,mm=hi+window.location.search,_r=s.href(ci,At);if(_r&&hi!==_r&&mm!==_r)return window.location.href=_r,!1}return gr(_.get(ci,"data.bodyClasses"),"add"),ee.setIfFirst(ci.name,At),Je.to().name!==Je.from().name&&w.clear(),At.flash_message&&w.add(At.flash_message),!0})}class Xn{constructor(o){Ha(o)}}Xn.\u0275fac=function(o){return new(o||Xn)(e.LFG(e.zs3))},Xn.\u0275mod=e.oAB({type:Xn}),Xn.\u0275inj=e.cJS({providers:[Br.p],imports:[[Vt.UIRouterModule.forRoot({states:$a,useHash:!1,config:function(g,o,s){g.urlService.config.strictMode(!1),g.urlService.config.type("opQueryString",{encode:encodeURIComponent,decode:decodeURIComponent,raw:!0,dynamic:!0,is:w=>"string"==typeof w,equals:(w,j)=>_.isEqual(w,j)}),g.urlService.config.type("opQueryId",{pattern:new RegExp(/(?:new|[0-9]+)/),encode:w=>w||"new",decode:w=>"new"===w?null:w,raw:!0,dynamic:!0,is:w=>"string"==typeof w,equals:(w,j)=>_.isEqual(w,j)})}})]]});var za=t(38421),Ka=t(19496),eo=t(81134),Ga=t(60914),qa=t(1818),Xa=t(82123),ec=t(5262),Jr=t(81628),tc=t(46669),Yr=t(25351),gn=t(11266),ic=t(74565),$r=t(77180),Vr=t(84312),nc=t(70971),oc=t(87947),sc=t(73905),rc=t(31021);function ac(g,o){if(1&g&&(e.TgZ(0,"li",24),e._UZ(1,"wp-watcher-button",25),e.qZA()),2&g){const s=e.oxw(2);e.xp6(1),e.Q6J("workPackage",s.workPackage)("showText",!1)}}function cc(g,o){if(1&g&&(e.TgZ(0,"li",24),e._UZ(1,"op-work-package-mark-notification-button",26),e.qZA()),2&g){const s=e.oxw(2);e.xp6(1),e.Q6J("workPackage",s.workPackage)}}const lc=function(){return["work_package.addChild","work_package.copy"]};function dc(g,o){if(1&g&&(e.TgZ(0,"div",1),e._UZ(1,"wp-breadcrumb",2),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e.TgZ(4,"div",5),e._UZ(5,"op-back-button",6),e.TgZ(6,"div",7),e._UZ(7,"wp-subject"),e.qZA(),e.qZA(),e.TgZ(8,"ul",8),e.TgZ(9,"li",9),e._UZ(10,"wp-create-button",10),e.qZA(),e.YNc(11,ac,2,2,"li",11),e.YNc(12,cc,2,1,"li",11),e.ALo(13,"async"),e.TgZ(14,"li",9),e._UZ(15,"zen-mode-toggle-button"),e.qZA(),e.TgZ(16,"li",12),e.TgZ(17,"button",13),e._UZ(18,"op-icon",14),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"div",15),e.TgZ(20,"div",16),e.TgZ(21,"div",17),e._UZ(22,"wp-single-view",2),e.qZA(),e.qZA(),e.TgZ(23,"div",18),e.TgZ(24,"div",17),e._UZ(25,"span",19),e._UZ(26,"op-wp-tabs",20),e._UZ(27,"div",21),e.qZA(),e.TgZ(28,"div",22),e._UZ(29,"wp-resizer",23),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.Q6J("resource",s.workPackage),e.xp6(1),e.Q6J("workPackage",s.workPackage),e.xp6(9),e.Q6J("allowed",e.DdM(16,lc))("stateName$",s.stateName$),e.xp6(1),e.Q6J("ngIf",s.displayWatchButton),e.xp6(1),e.Q6J("ngIf",e.lcZ(13,14,s.displayNotificationsButton$)),e.xp6(5),e.Q6J("wpSingleContextMenu-workPackage",s.workPackage),e.uIk("title",s.text.full_view.button_more),e.xp6(5),e.Q6J("workPackage",s.workPackage),e.xp6(3),e.Q6J("textContent",s.focusAnchorLabel),e.xp6(1),e.Q6J("workPackage",s.workPackage)("view","full"),e.xp6(3),e.Q6J("elementClass","work-packages-full-view--split-right")("localStorageKey","openProject-fullViewFlexBasis")}}class zo extends qa.e{constructor(o,s,w){super(o,w.params.workPackageId),this.injector=o,this.wpTableSelection=s,this.$state=w,this.stateName$=(0,eo.of)("work-packages.new")}ngOnInit(){this.observeWorkPackage()}initializeTexts(){super.initializeTexts(),this.text.full_view={button_more:this.I18n.t("js.button_more")}}init(){super.init(),this.wpTableFocus.updateFocus(this.workPackage.id),this.setWorkPackageScopeProperties(this.workPackage)}setWorkPackageScopeProperties(o){this.isWatched=o.hasOwnProperty("unwatch"),this.displayWatchButton=o.hasOwnProperty("unwatch")||o.hasOwnProperty("watch"),o.watchers&&(this.watchers=o.watchers.elements)}}zo.\u0275fac=function(o){return new(o||zo)(e.Y36(e.zs3),e.Y36(Ga.J),e.Y36(Ke.StateService))},zo.\u0275cmp=e.Xpm({type:zo,selectors:[["wp-full-view-entry"]],hostAttrs:[1,"work-packages-page--ui-view"],features:[e._Bn([Xa.O,{provide:Ne.W,useExisting:J.q}]),e.qOj],decls:1,vars:1,consts:[["edit-form","","class","work-packages--show-view",3,"resource",4,"ngIf"],["edit-form","",1,"work-packages--show-view",3,"resource"],[3,"workPackage"],[1,"toolbar-container"],["id","toolbar"],[1,"wp-show--header-container"],["linkClass","work-packages-back-button op-back-button_mobile-limited-width"],[1,"subject-header"],["id","toolbar-items",1,"toolbar-items","hide-when-print"],[1,"toolbar-item","hidden-for-mobile"],[3,"allowed","stateName$"],["class","toolbar-item",4,"ngIf"],["id","action-show-more-dropdown-menu",1,"toolbar-item","action_menu_main"],["wpSingleContextMenu","",1,"button","dropdown-relative","toolbar-icon",3,"wpSingleContextMenu-workPackage"],["icon-classes","button--icon icon-show-more"],[1,"work-packages-full-view--split-container"],[1,"work-packages-full-view--split-left"],[1,"work-packages--panel-inner"],[1,"work-packages-full-view--split-right","work-packages-tab-view--overflow"],["tabindex","-1","opAutofocus","",1,"hidden-for-sighted",3,"textContent"],[3,"workPackage","view"],["data-notification-selector","notification-scroll-container","ui-view","",1,"tabcontent"],[1,"work-packages-full-view--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"],[1,"toolbar-item"],[3,"workPackage","showText"],["data-qa-selector","mark-notification-read-button",3,"workPackage"]],template:function(o,s){1&o&&e.YNc(0,dc,30,17,"div",0),2&o&&e.Q6J("ngIf",s.workPackage)},directives:[D.O5,fi.n,ec.f,Jr.W,tc.x,Yr.z,gn.a,ic.B,Ye.o,$r.G,Vr.U,nc.e,Vt.UIView,oc.H,sc.u,rc.q],pipes:[D.Ov],encapsulation:2});var pc=t(85603),uc=t(1813),hc=t(73648),fn=t(53466),_c=t(91654),mc=t(57973),gc=t(22956),Qi=t(2888),fr=t(73165),Ai=t(61486),si=t(26942),vr=t(20342),Cr=t(55548);class Ko extends Cr.n{constructor(o,s,w,j,ee){super(o,s),this.elementRef=o,this.opContextMenu=s,this.I18n=w,this.wpDisplayRepresentationService=j,this.wpTableTimeline=ee}open(o){this.buildItems(),this.opContextMenu.show(this,o)}get locals(){return{items:this.items,contextMenuId:"wp-view-context-menu"}}buildItems(){this.items=[],this.wpDisplayRepresentationService.current!==Qi.he&&this.items.push({linkText:this.I18n.t("js.views.card"),title:this.I18n.t("js.button_show_cards"),icon:"icon-view-card",onClick:o=>(this.wpDisplayRepresentationService.setDisplayRepresentation(Qi.he),this.wpTableTimeline.isVisible&&this.wpTableTimeline.toggle(),!0)}),(this.wpTableTimeline.isVisible||this.wpDisplayRepresentationService.current===Qi.he)&&this.items.push({linkText:this.I18n.t("js.views.list"),title:this.I18n.t("js.button_show_table"),icon:"icon-view-list",onClick:o=>(this.wpDisplayRepresentationService.setDisplayRepresentation(Qi.M5),this.wpTableTimeline.isVisible&&this.wpTableTimeline.toggle(),!0)}),(!this.wpTableTimeline.isVisible||this.wpDisplayRepresentationService.current===Qi.he)&&this.items.push({linkText:this.I18n.t("js.views.timeline"),title:this.I18n.t("js.button_show_gantt"),icon:"icon-view-timeline",onClick:o=>(this.wpTableTimeline.isVisible||this.wpTableTimeline.toggle(),this.wpDisplayRepresentationService.setDisplayRepresentation(Qi.M5),!0)})}}Ko.\u0275fac=function(o){return new(o||Ko)(e.Y36(e.SBq),e.Y36(vr.$),e.Y36(y.D),e.Y36(Qi.ld),e.Y36(fr.W))},Ko.\u0275dir=e.lG2({type:Ko,selectors:[["","wpViewDropdown",""]],features:[e.qOj]});class Go extends si.N{constructor(o,s,w,j){super(),this.I18n=o,this.cdRef=s,this.wpDisplayRepresentationService=w,this.wpTableTimeline=j,this.text={card:this.I18n.t("js.views.card"),list:this.I18n.t("js.views.list"),timeline:this.I18n.t("js.views.timeline")}}ngOnInit(){(0,Ai.aj)([this.wpDisplayRepresentationService.live$(),this.wpTableTimeline.live$()]).pipe(this.untilDestroyed()).subscribe(([s,w])=>{this.detectView(s,w.visible),this.cdRef.detectChanges()})}detectView(o,s){o!==Qi.he?this.view=s?"timeline":Qi.M5:this.view=Qi.he}}Go.\u0275fac=function(o){return new(o||Go)(e.Y36(y.D),e.Y36(e.sBO),e.Y36(Qi.ld),e.Y36(fr.W))},Go.\u0275cmp=e.Xpm({type:Go,selectors:[["wp-view-toggle-button"]],features:[e.qOj],decls:4,vars:2,consts:[["id","wp-view-toggle-button","wpViewDropdown","",1,"button"],[3,"icon-classes"],["aria-hidden","true",1,"button--text",3,"textContent"],["icon-classes","button--icon icon-small icon-pulldown"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e._UZ(1,"op-icon",1),e._UZ(2,"span",2),e._UZ(3,"op-icon",3),e.qZA()),2&o&&(e.xp6(1),e.MGl("icon-classes","button--icon icon-view-",s.view,""),e.xp6(1),e.Q6J("textContent",s.text[s.view]))},directives:[Ko,Ye.o],encapsulation:2,changeDetection:0});var fc=t(48451),Hr=t(44210),zr=t(84109);class qo extends Hr.S{constructor(o,s,w,j,ee,me,De){super(s),this.$state=o,this.I18n=s,this.transitions=w,this.cdRef=j,this.states=ee,this.wpTableFocus=me,this.keepTab=De,this.accessKey=8,this.activeState="work-packages.partitioned.list.details",this.listState="work-packages.partitioned.list",this.buttonId="work-packages-details-view-button",this.buttonClass="toolbar-icon",this.iconClass="icon-info2",this.activateLabel=s.t("js.button_open_details"),this.deactivateLabel=s.t("js.button_close_details"),this.transitionListener=this.transitions.onSuccess({},()=>{this.isActive=this.$state.includes(this.activeState),this.cdRef.detectChanges()})}ngOnDestroy(){super.ngOnDestroy(),this.transitionListener()}get label(){return this.isActive?this.deactivateLabel:this.activateLabel}isToggle(){return!0}performAction(o){this.isActive?this.$state.go(this.listState):this.openDetailsView()}openListView(){}openDetailsView(){const o={workPackageId:this.wpTableFocus.focusedWorkPackage};this.keepTab.goCurrentDetailsState(o)}}function vc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li"),e.TgZ(1,"button",2),e.NdJ("click",function(){return e.CHM(s),e.oxw().enableAutoZoom()}),e._UZ(2,"op-icon",3),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngClass",s.getAutoZoomToggleClass()),e.uIk("title",s.text.zoomAuto)}}function Cc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li"),e.TgZ(1,"button",4),e.NdJ("click",function(){return e.CHM(s),e.oxw().updateZoomWithDelta(1)}),e._UZ(2,"op-icon",5),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("disabled",s.isMaxLevel),e.uIk("title",s.text.zoomOut)}}function yc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li"),e.TgZ(1,"button",6),e.NdJ("click",function(){return e.CHM(s),e.oxw().updateZoomWithDelta(-1)}),e._UZ(2,"op-icon",7),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("disabled",s.isMinLevel),e.uIk("title",s.text.zoomIn)}}qo.\u0275fac=function(o){return new(o||qo)(e.Y36(Ke.StateService),e.Y36(y.D),e.Y36(Ke.TransitionService),e.Y36(e.sBO),e.Y36(h.G),e.Y36(fc.o),e.Y36(zr.p))},qo.\u0275cmp=e.Xpm({type:qo,selectors:[["wp-details-view-button"]],features:[e.qOj],decls:2,vars:10,consts:[["type","button",3,"disabled","click"],[3,"icon-classes"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(j){return s.performAction(j)}),e._UZ(1,"op-icon",1),e.qZA()),2&o&&(e.Gre("button ",s.buttonClass,""),e.ekj("-active",s.isActive),e.Q6J("disabled",s.disabled||!s.isToggle()&&s.isActive),e.uIk("id",s.buttonId)("title",s.label)("accesskey",s.accessKey),e.xp6(1),e.MGl("icon-classes","",s.iconClass," button--icon"))},directives:[Ye.o],encapsulation:2,changeDetection:0});class Xo extends Hr.S{constructor(o,s,w){super(o),this.I18n=o,this.cdRef=s,this.wpTableTimeline=w,this.buttonId="work-packages-timeline-toggle-button",this.iconClass="icon-view-timeline",this.minZoomLevel="days",this.maxZoomLevel="years",this.isAutoZoom=!1,this.isMaxLevel=!1,this.isMinLevel=!1,this.activateLabel=o.t("js.timelines.button_activate"),this.deactivateLabel=o.t("js.timelines.button_deactivate"),this.text.zoomIn=o.t("js.timelines.zoom.in"),this.text.zoomOut=o.t("js.timelines.zoom.out"),this.text.zoomAuto=o.t("js.timelines.zoom.auto")}ngOnInit(){this.wpTableTimeline.live$().pipe(this.untilDestroyed()).subscribe(()=>{this.isAutoZoom=this.wpTableTimeline.isAutoZoom(),this.isActive=this.wpTableTimeline.isVisible,this.cdRef.detectChanges()}),this.wpTableTimeline.appliedZoomLevel$.values$().pipe(this.untilDestroyed()).subscribe(o=>{this.isMaxLevel=o===this.maxZoomLevel,this.isMinLevel=o===this.minZoomLevel,this.cdRef.detectChanges()})}get label(){return this.isActive?this.deactivateLabel:this.activateLabel}isToggle(){return!0}updateZoomWithDelta(o){this.wpTableTimeline.updateZoomWithDelta(o)}performAction(o){this.toggleTimeline()}toggleTimeline(){this.wpTableTimeline.toggle()}enableAutoZoom(){this.wpTableTimeline.enableAutozoom()}getAutoZoomToggleClass(){return this.isAutoZoom?"-disabled":""}}Xo.\u0275fac=function(o){return new(o||Xo)(e.Y36(y.D),e.Y36(e.sBO),e.Y36(fr.W))},Xo.\u0275cmp=e.Xpm({type:Xo,selectors:[["wp-timeline-toggle-button"]],features:[e.qOj],decls:4,vars:3,consts:[["id","work-packages-timeline-mode-selection",1,"toolbar-button-group","work-packages-timeline-toggle-button"],[4,"ngIf"],["id","work-packages-timeline-zoom-auto-button",1,"button","timeline-toolbar--button","toolbar-icon",3,"ngClass","click"],["icon-classes","icon-zoom-auto button--icon"],["id","work-packages-timeline-zoom-out-button",1,"button","timeline-toolbar--button","toolbar-icon",3,"disabled","click"],["icon-classes","icon-zoom-out button--icon"],["id","work-packages-timeline-zoom-in-button",1,"button","timeline-toolbar--button","toolbar-icon",3,"disabled","click"],["icon-classes","icon-zoom-in button--icon"]],template:function(o,s){1&o&&(e.TgZ(0,"ul",0),e.YNc(1,vc,3,2,"li",1),e.YNc(2,Cc,3,2,"li",1),e.YNc(3,yc,3,2,"li",1),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",s.isActive),e.xp6(1),e.Q6J("ngIf",s.isActive),e.xp6(1),e.Q6J("ngIf",s.isActive))},directives:[D.O5,D.mk,Ye.o],styles:[".work-packages-timeline-toggle-button[_ngcontent-%COMP%]   .toolbar-button-group[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:last-child{margin-right:10px}"],changeDetection:0});var bc=t(52025),wc=t(79174);class es extends Cr.n{constructor(o,s,w,j){super(o,s),this.elementRef=o,this.opContextMenu=s,this.I18n=w,this.wpViewCollapsedGroups=j}open(o){this.buildItems(),this.opContextMenu.show(this,o)}get locals(){return{items:this.items,contextMenuId:"wp-group-fold-context-menu"}}buildItems(){this.items=[{disabled:this.wpViewCollapsedGroups.allGroupsAreCollapsed,linkText:this.I18n.t("js.button_collapse_all"),icon:"icon-minus2",onClick:o=>(this.wpViewCollapsedGroups.setAllGroupsCollapseStateTo(!0),!0)},{disabled:this.wpViewCollapsedGroups.allGroupsAreExpanded,linkText:this.I18n.t("js.button_expand_all"),icon:"icon-plus",onClick:o=>(this.wpViewCollapsedGroups.setAllGroupsCollapseStateTo(!1),!0)}]}}es.\u0275fac=function(o){return new(o||es)(e.Y36(e.SBq),e.Y36(vr.$),e.Y36(y.D),e.Y36(wc.q))},es.\u0275dir=e.lG2({type:es,selectors:[["","wpGroupToggleDropdown",""]],features:[e.qOj]});class ts{}ts.\u0275fac=function(o){return new(o||ts)},ts.\u0275cmp=e.Xpm({type:ts,selectors:[["wp-fold-toggle-view-button"]],decls:4,vars:0,consts:[["id","wp-fold-toggle-button","wpGroupToggleDropdown","",1,"button"],["icon-classes","button--icon icon-outline"],[1,"button--text"],["icon-classes","button--icon icon-small icon-pulldown"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e._UZ(1,"op-icon",1),e._UZ(2,"span",2),e._UZ(3,"op-icon",3),e.qZA())},directives:[es,Ye.o],encapsulation:2,changeDetection:0});var Tc=t(43882);function kc(g,o){if(1&g&&e._UZ(0,"op-back-button",11),2&g){const s=e.oxw();e.Q6J("customBackMethod",s.backButtonCallback)}}function Pc(g,o){if(1&g&&(e.TgZ(0,"li",15),e._UZ(1,"ndc-dynamic",16),e.qZA()),2&g){const s=e.oxw().$implicit,w=e.oxw(2);e.Q6J("ngClass",s.containerClasses),e.xp6(1),e.Q6J("ndcDynamicComponent",s.component)("ndcDynamicInputs",s.inputs)("ndcDynamicInjector",w.injector)("ndcDynamicOutputs",s.outputs)}}function xc(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Pc,2,5,"li",14),e.BQk()),2&g){const s=o.$implicit;e.xp6(1),e.Q6J("ngIf",!s.show||s.show())}}function Ec(g,o){if(1&g&&(e.TgZ(0,"ul",12),e.YNc(1,xc,2,1,"ng-container",13),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.toolbarButtonComponents)}}function Oc(g,o){if(1&g&&e._UZ(0,"ndc-dynamic",17),2&g){const s=e.oxw();e.Q6J("ndcDynamicComponent",s.filterContainerDefinition.component)("ndcDynamicInputs",s.filterContainerDefinition.inputs)("ndcDynamicOutputs",s.filterContainerDefinition.outputs)("ndcDynamicInjector",s.injector)}}class to extends mc.r{constructor(){super(...arguments),this.toolbarButtonComponents=[{component:Yr.z,inputs:{stateName$:(0,eo.of)("work-packages.partitioned.list.new"),allowed:["work_packages.createWorkPackage"]}},{component:Tc.P},{component:gc.U},{component:Go,containerClasses:"hidden-for-mobile"},{component:ts,show:()=>!(!this.currentQuery||!this.currentQuery.groupBy)},{component:qo,containerClasses:"hidden-for-mobile"},{component:Xo,containerClasses:"hidden-for-mobile -no-spacing"},{component:gn.a,containerClasses:"hidden-for-mobile"},{component:bc.b}]}ngOnInit(){super.ngOnInit(),this.wpTableFilters.hidden.push("project"),this.text.button_settings=this.I18n.t("js.button_settings")}additionalLoadingTime(){return this.wpTableTimeline.isVisible?this.querySpace.timelineRendered.pipe((0,fn.q)(1)).toPromise():this.querySpace.tableRendered.valuesPromise()}shouldUpdateHtmlTitle(){return"work-packages.partitioned.list"===this.$state.current.name}}to.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(to)))(s||to)}}(),to.\u0275cmp=e.Xpm({type:to,selectors:[["wp-view-page"]],features:[e._Bn([{provide:Ne.W,useClass:J.q},_c.E]),e.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.YNc(3,kc,1,1,"op-back-button",3),e.TgZ(4,"editable-toolbar-title",4),e.NdJ("onSave",function(j){return s.changeChangesFromTitle(j)})("onEmptySubmit",function(){return s.updateTitleName("")}),e.qZA(),e.YNc(5,Ec,2,1,"ul",5),e.qZA(),e.qZA(),e.TgZ(6,"div",6),e.YNc(7,Oc,1,4,"ndc-dynamic",7),e.qZA(),e.TgZ(8,"div",8),e._UZ(9,"div",9),e._UZ(10,"div",10),e.qZA(),e.qZA()),2&o&&(e.Q6J("ngClass",s.currentPartition),e.xp6(3),e.Q6J("ngIf",s.backButtonCallback),e.xp6(1),e.Q6J("title",s.selectedTitle)("inFlight",s.toolbarDisabled)("showSaveCondition",s.showToolbarSaveButton)("editable",s.titleEditingEnabled),e.xp6(1),e.Q6J("ngIf",s.showToolbar),e.xp6(2),e.Q6J("ngIf",s.filterContainerDefinition))},directives:[D.mk,D.O5,G.s5,Vt.UIView,Jr.W,D.sg,p.B5,p.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}"],changeDetection:0});var Mc=t(46430),Ic=t(98722),Sc=t(92092),Dc=t(8643),Ac=t(66979);const jc=function(){return["status","type"]};function Zc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"edit-form",2),e.NdJ("onSaved",function(j){return e.CHM(s),e.oxw().onSaved(j)}),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e._UZ(4,"wp-type-status",5),e.qZA(),e.TgZ(5,"ul",6),e.TgZ(6,"li",7),e._UZ(7,"zen-mode-toggle-button"),e.qZA(),e.TgZ(8,"li",7),e.TgZ(9,"button",8),e._UZ(10,"i",9),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e._UZ(11,"wp-single-view",10),e.TgZ(12,"wp-edit-actions-bar",11),e.NdJ("onCancel",function(){return e.CHM(s),e.oxw().cancelAndBackToList()}),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("resource",s.newWorkPackage)("skippedFields",e.DdM(7,jc))("inEditMode",!0),e.xp6(3),e.Q6J("workPackage",s.newWorkPackage),e.xp6(5),e.uIk("title",s.text.button_settings),e.xp6(2),e.Q6J("workPackage",s.newWorkPackage)("showProject",s.copying)}}class io extends Ic.H{constructor(){super(...arguments),this.successState="work-packages.show"}}io.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(io)))(s||io)}}(),io.\u0275cmp=e.Xpm({type:io,selectors:[["wp-copy-full-view"]],hostAttrs:[1,"work-packages-page--ui-view"],features:[e.qOj],decls:1,vars:1,consts:[["class","work-package--new-state work-packages--new work-packages--show-view toolbar-container",4,"ngIf"],[1,"work-package--new-state","work-packages--new","work-packages--show-view","toolbar-container"],[3,"resource","skippedFields","inEditMode","onSaved"],[1,"toolbar"],[1,"title-container"],[3,"workPackage"],[1,"toolbar-items","hide-when-print"],[1,"toolbar-item","hidden-for-mobile"],["id","create-wp-menu-button","wpCreateSettingsMenu","",1,"button","last","work-packages-settings-button","toolbar-icon"],[1,"button--icon","icon-show-more"],[3,"workPackage","showProject"],[3,"onCancel"]],template:function(o,s){1&o&&e.YNc(0,Zc,13,8,"div",0),2&o&&e.Q6J("ngIf",s.newWorkPackage)},directives:[D.O5,fi.n,Sc.E,gn.a,Dc.Y,$r.G,Ac.Y],encapsulation:2,changeDetection:0});const Un="work-packages-menu-item",Rc=[{name:"work-packages",parent:"optional_project",url:"/work_packages?query_id&query_props&start_onboarding_tour",redirectTo:"work-packages.partitioned.list",views:{"!$default":{component:uc.p}},data:{bodyClasses:"router--work-packages-base",menuItem:Un},params:{query_id:{type:"query",dynamic:!0},query_props:{type:"opQueryString"},start_onboarding_tour:{type:"query",squash:!0,value:void 0}}},{name:"work-packages.new",url:"/new?type&parent_id",component:Ka.v,reloadOnSearch:!1,params:{defaults:{value:null}},data:{baseRoute:"work-packages",allowMovingInEditMode:!0,bodyClasses:"router--work-packages-full-create",menuItem:Un,successState:"work-packages.show"}},{name:"work-packages.copy",url:"/{copiedFromWorkPackageId:[0-9]+}/copy",component:io,reloadOnSearch:!1,data:{baseRoute:"work-packages",allowMovingInEditMode:!0,bodyClasses:"router--work-packages-full-create",menuItem:Un}},{name:"work-packages.show",url:"/{workPackageId:[0-9]+}",redirectTo:g=>{const o=g.params("to"),w=g.injector().get(zr.p).currentShowTab;return{state:"work-packages.show.tabs",params:Object.assign(Object.assign({},o),{tabIdentifier:w||"activity"})}},component:zo,data:{baseRoute:"work-packages",bodyClasses:"router--work-packages-full-view",newRoute:"work-packages.new",menuItem:Un}},{name:"work-packages.show.tabs",url:"/:tabIdentifier",component:za.t,data:{parent:"work-packages.show",menuItem:Un}},{name:"work-packages.partitioned",component:to,url:"",data:{bodyClasses:""}},{name:"work-packages.partitioned.list",url:"",reloadOnSearch:!1,views:{"content-left":{component:hc.o}},data:{bodyClasses:"router--work-packages-partitioned-split-view",menuItem:Un,partition:"-left-only"}},...(0,Mc.Z)("work-packages.partitioned.list",Un,pc.o)];class no{}no.\u0275fac=function(o){return new(o||no)},no.\u0275mod=e.oAB({type:no}),no.\u0275inj=e.cJS({imports:[[m.H,Vt.UIRouterModule.forChild({states:Rc})]]});class Vi{constructor(o,s,w,j){this.I18n=o,this.injector=s,this.PathHelper=w,this.currentProjectService=j,this._searchTerm=new S.X(""),this.searchTerm$=this._searchTerm.asObservable(),this._currentTab=new S.X("work_packages"),this.currentTab$=this._currentTab.asObservable(),this._projectScope=new S.X(""),this.projectScope$=this._projectScope.asObservable(),this._tabs=new S.X([]),this.tabs$=this._tabs.asObservable(),this._resultsHidden=new S.X(!1),this.resultsHidden$=this._resultsHidden.asObservable(),this.initialize()}initialize(){const o=this.loadGonData();o&&(o.available_search_types&&this._tabs.next(o.available_search_types),o.search_term&&this._searchTerm.next(o.search_term),o.current_tab&&this._currentTab.next(o.current_tab),o.project_scope?this._projectScope.next(o.project_scope):this.currentProjectService.path||this._projectScope.next("all"))}loadGonData(){try{return window.gon.global_search}catch(o){return null}}submitSearch(){window.location.href=this.searchPath()}searchPath(){let o=this.PathHelper.staticBase;return this.currentProjectService.path&&"all"!==this.projectScope&&(o=this.currentProjectService.path),o+=`/search?${this.searchQueryParams()}`,o}set searchTerm(o){this._searchTerm.next(o)}get searchTerm(){return this._searchTerm.value}get tabs(){return this._tabs.value}get currentTab(){return this._currentTab.value}set currentTab(o){this._currentTab.next(o)}get projectScope(){return this._projectScope.value}set projectScope(o){this._projectScope.next(o)}get resultsHidden(){return this._resultsHidden.value}set resultsHidden(o){this._resultsHidden.next(o)}searchQueryParams(){let o;return o=`q=${encodeURIComponent(this.searchTerm)}`,this.currentTab.length>0&&"all"!==this.currentTab&&(o=`${o}&${this.currentTab}=1`),this.projectScope.length>0&&(o=`${o}&scope=${this.projectScope}`),o}isAfterSearch(){return jQuery("body.controller-search").length>0}}Vi.\u0275fac=function(o){return new(o||Vi)(e.LFG(y.D),e.LFG(e.zs3),e.LFG(je.j),e.LFG(b.R))},Vi.\u0275prov=e.Yz7({token:Vi,factory:Vi.\u0275fac});var Fc=t(74990);class oo{}oo.\u0275fac=function(o){return new(o||oo)},oo.\u0275mod=e.oAB({type:oo}),oo.\u0275inj=e.cJS({providers:[Vi],imports:[[n.H,m.H,Fc.C]]});var cr=t(73881),Wc=t(27779),Kr=t(55901),yr=t(8158);function Uc(g,o){if(1&g&&e._UZ(0,"op-enterprise-banner",10),2&g){const s=e.oxw();e.Q6J("linkMessage",s.text.upsale_link)("textMessage",s.text.upsale_text)("moreInfoLink",s.text.more_info_link)}}function Lc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li",11),e.TgZ(1,"button",12),e.NdJ("click",function(j){const me=e.CHM(s).$implicit;return e.oxw().select(j,me)}),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit;e.xp6(1),e.Q6J("id",s.identifier)("textContent",s.title)}}class is extends st.T{constructor(o,s,w,j,ee,me){super(s,w,o),this.elementRef=o,this.locals=s,this.cdRef=w,this.widgetsService=j,this.i18n=ee,this.bannerService=me,this.text={title:this.i18n.t("js.grid.add_widget"),close_popup:this.i18n.t("js.button_close"),upsale_link:this.i18n.t("js.grid.upsale.link"),upsale_text:this.i18n.t("js.grid.upsale.text"),cancel_button:this.i18n.t("js.button_cancel"),more_info_link:Wc.rj.graphWidgets},this.eeShowBanners=!1}ngOnInit(){super.ngOnInit(),this.eeShowBanners=this.bannerService.eeShowBanners}get selectable(){return this.eligibleWidgets.sort((o,s)=>o.title.localeCompare(s.title))}select(o,s){this.chosenWidget=s,this.closeMe(o)}trackWidgetBy(o){return o.identifier}get eligibleWidgets(){const o=this.locals.schema.widgets.allowedValues.map(s=>s.identifier);return this.widgetsService.registered.filter(s=>o.includes(s.identifier))}}is.\u0275fac=function(o){return new(o||is)(e.Y36(e.SBq),e.Y36(He.E),e.Y36(e.sBO),e.Y36(It),e.Y36(y.D),e.Y36(cr.j))},is.\u0275cmp=e.Xpm({type:is,selectors:[["ng-component"]],features:[e.qOj],decls:12,vars:6,consts:[["tabindex","0","cdkFocusInitial","","cdkTrapFocus","","data-indicator-name","modal",1,"spot-modal","loading-indicator--location",3,"cdkTrapFocusAutoCapture"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"ngdialog-body","spot-modal--body","spot-container"],["class","grid--add-widget-ee","opReferrer","grids#add-widget",3,"linkMessage","textMessage","moreInfoLink",4,"ngIf"],[1,"spot-list"],["class","spot-list--item","data-qa-selector","op-grid--addable-widget",4,"ngFor","ngForOf","ngForTrackBy"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],["opReferrer","grids#add-widget",1,"grid--add-widget-ee",3,"linkMessage","textMessage","moreInfoLink"],["data-qa-selector","op-grid--addable-widget",1,"spot-list--item"],["type","button",1,"spot-list--item-action",3,"id","textContent","click"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,Uc,1,3,"op-enterprise-banner",4),e.TgZ(6,"ul",5),e.YNc(7,Lc,2,2,"li",6),e.qZA(),e.qZA(),e.TgZ(8,"div",7),e.TgZ(9,"div",8),e.TgZ(10,"button",9),e.NdJ("click",function(){return s.closeMe()}),e._uU(11),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("cdkTrapFocusAutoCapture",!0),e.xp6(2),e.Oqu(s.text.title),e.xp6(3),e.Q6J("ngIf",s.eeShowBanners),e.xp6(2),e.Q6J("ngForOf",s.selectable)("ngForTrackBy",s.trackWidgetBy),e.xp6(4),e.hij(" ",s.text.cancel_button," "))},directives:[Kr.mK,D.O5,D.sg,yr.P],encapsulation:2});class on{constructor(o){this.layout=o}down(o,s){const w=[];let j=this.layout.widgetAreas.slice(0);for(s&&(j=j.filter(ee=>ee.guid!==s.guid)),j.sort((ee,me)=>me.startRow-ee.startRow);null!==o;)w.push(o),j=j.filter(ee=>ee.guid!==o.guid),o=this.moveOneDown(w,j)}moveOneDown(o,s){const w=this.firstAreaToMove(o,s);if(w){const j=w[0],ee=w[1],me=j.widget.height;return j.startRow=ee.endRow,j.endRow=j.startRow+me,this.layout.numRows<j.endRow-1&&(this.layout.numRows=j.endRow-1),j}return null}firstAreaToMove(o,s){let w=null,j=null;if(s.forEach(ee=>{o.forEach(me=>{me.overlaps(ee)&&(w=me,j=ee)})}),null!==j){let ee=w;return o.forEach(me=>{me.endRow>ee.endRow&&j.columnOverlaps(me)&&(ee=me)}),[j,ee]}return null}}on.\u0275fac=function(o){return new(o||on)(e.LFG(L))},on.\u0275prov=e.Yz7({token:on,factory:on.\u0275fac});var Gr=t(8095),Hi=t(83720);class sn{constructor(o,s){this.layout=o,this.move=s,this.setupMousedOverAreaSubscription()}ngOnDestroy(){this.mousedOverAreaObserver.unsubscribe()}setupMousedOverAreaSubscription(){this.mousedOverAreaObserver=this.layout.$mousedOverArea.pipe((0,Gr.p)(10),(0,Hi.x)(),(0,Gt.h)(o=>this.currentlyDragging&&!!o&&!this.layout.isGap(o)&&(this.placeholderArea.startRow!==o.startRow||this.placeholderArea.startColumn!==o.startColumn))).subscribe(o=>{this.updateArea(o),this.layout.scrollPlaceholderIntoView()})}updateArea(o){this.layout.resetAreas(this.draggedArea),this.moveAreasOnDragging(o)}moveAreasOnDragging(o){if(!this.placeholderArea)return;const s=this.draggedArea;this.copyPositionButRestrict(o,this.placeholderArea),this.move.down(this.placeholderArea,s)}get currentlyDragging(){return!!this.draggedArea}isDropOnlyArea(o){return!this.currentlyDragging&&o.endRow===this.layout.numRows+2}isDragged(o){return this.currentlyDragging&&this.draggedArea.guid===o.guid}isPassive(o){return this.currentlyDragging&&!this.isDragged(o)}get isDraggable(){return this.layout.isEditable}start(o){this.placeholderArea=new E(o.widget),this.draggedHeight=document.getElementById(o.guid).offsetHeight-2,this.draggedArea=o}abort(){document.dispatchEvent(new Event("mouseup")),this.draggedArea=null,this.placeholderArea=null,this.layout.resetAreas()}drop(){!this.draggedArea||(this.placeholderArea.copyDimensionsTo(this.draggedArea),this.draggedArea.unchangedSize||(this.layout.writeAreaChangesToWidgets(),this.layout.cleanupUnusedAreas(),this.layout.rebuildAndPersist()),this.draggedArea=null,this.placeholderArea=null)}copyPositionButRestrict(o,s){s.startRow=o.startRow,o.startRow===this.layout.numRows+1?s.endRow=this.layout.numRows+2:o.startRow+s.widget.height>this.layout.numRows+1?s.endRow=this.layout.numRows+1:s.endRow=o.startRow+s.widget.height,s.startColumn=o.startColumn,o.startColumn+s.widget.width>this.layout.numColumns+1?s.endColumn=this.layout.numColumns+1:s.endColumn=o.startColumn+s.widget.width}}sn.\u0275fac=function(o){return new(o||sn)(e.LFG(L),e.LFG(on))},sn.\u0275prov=e.Yz7({token:sn,factory:sn.\u0275fac});class vn{constructor(o,s,w){this.layout=o,this.move=s,this.drag=w}end(o){!this.resizedArea||(this.resizedArea=null,!o.unchangedSize&&(this.layout.writeAreaChangesToWidgets(),this.layout.cleanupUnusedAreas(),this.layout.rebuildAndPersist()))}abort(){this.resizedArea&&(this.layout.resetAreas(),this.resizedArea=null)}start(o){this.resizedArea=o;const s=this.layout.gridAreas.filter(w=>{const j=w.startRow===this.resizedArea.startRow&&w.startColumn>=this.resizedArea.startColumn,ee=w.startRow>this.resizedArea.startRow&&w.startColumn>=this.resizedArea.startColumn&&this.layout.widgetAreas.some(me=>me.startRow===w.startRow&&(me.endColumn<=this.resizedArea.startColumn||me.startColumn>=w.endColumn));return j||ee});this.targetIds=s.map(w=>w.guid)}moving(){!this.resizedArea||!this.layout.mousedOverArea||!this.targetIds.includes(this.layout.mousedOverArea.guid)||(this.layout.resetAreas(),this.resizedArea.endRow=this.layout.mousedOverArea.endRow,this.resizedArea.endColumn=this.layout.mousedOverArea.endColumn,this.move.down(this.resizedArea,this.resizedArea))}isTarget(o){const s=o.guid;return this.resizedArea&&this.targetIds.includes(s)}isResized(o){return this.resizedArea&&this.resizedArea.guid===o.guid}isPassive(o){return this.currentlyResizing&&!this.isResized(o)}get currentlyResizing(){return!!this.resizedArea}get isResizable(){return!this.drag.currentlyDragging&&this.isAllowed}get isAllowed(){return this.layout.gridResource.updateImmediately}}vn.\u0275fac=function(o){return new(o||vn)(e.LFG(L),e.LFG(on),e.LFG(sn))},vn.\u0275prov=e.Yz7({token:vn,factory:vn.\u0275fac});class Cn{constructor(o,s,w,j,ee,me,De,Je){this.opModalService=o,this.injector=s,this.halResource=w,this.layout=j,this.drag=ee,this.move=me,this.resize=De,this.i18n=Je,this.text={add:this.i18n.t("js.grid.add_widget")}}isAddable(o){return!this.drag.currentlyDragging&&!this.resize.currentlyResizing&&(this.layout.mousedOverArea===o||this.layout.isSingleCell||this.layout.inHelpMode)&&this.isAllowed}widget(o){this.select(o).then(s=>{this.layout.isGap(o)&&this.addLine(o);const w=new E(s);this.setMaxWidth(w),this.persist(w)}).catch(()=>{})}get addText(){return this.text.add}select(o){return new Promise((s,w)=>{this.opModalService.show(is,this.injector,{schema:this.layout.schema}).closingEvent.subscribe(ee=>{const me=ee.chosenWidget;if(!me)return void w();const De={_type:"GridWidget",identifier:me.identifier,startRow:o.startRow,endRow:o.endRow,startColumn:o.startColumn,endColumn:o.endColumn,options:me.properties||{}},Je=this.halResource.createHalResource(De);Je.grid=this.layout.gridResource,s(Je)})})}addLine(o){o.isRow?this.layout.addRow(o.startRow-1,o.startColumn):o.isColumn&&this.layout.addColumn(o.startColumn-1,o.startRow)}setMaxWidth(o){o.endColumn=this.layout.numColumns+1,this.layout.widgetAreas.forEach(s=>{o.startColumnOverlaps(s)&&(o.endColumn=s.startColumn)})}persist(o){o.writeAreaChangeToWidget(),this.layout.widgetAreas.push(o),this.layout.widgetResources.push(o.widget),this.layout.rebuildAndPersist()}get isAllowed(){return this.layout.gridResource&&this.layout.gridResource.updateImmediately}}Cn.\u0275fac=function(o){return new(o||Cn)(e.LFG(He.S),e.LFG(e.zs3),e.LFG(gt.u),e.LFG(L),e.LFG(sn),e.LFG(on),e.LFG(vn),e.LFG(y.D))},Cn.\u0275prov=e.Yz7({token:Cn,factory:Cn.\u0275fac});class Ln{constructor(o,s,w,j,ee,me,De,Je,qe){this.gridInitialization=o,this.pathHelper=s,this.currentProject=w,this.i18n=j,this.cdRef=ee,this.title=me,this.addWidget=De,this.renderer=Je,this.areas=qe,this.text={title:this.i18n.t(`js.${this.i18nNamespace()}.label`),html_title:this.i18n.t(`js.${this.i18nNamespace()}.label`)}}ngOnInit(){this.renderer.addClass(document.body,"widget-grid-layout"),this.gridInitialization.initialize(this.gridScopePath()).then(o=>{this.grid=o,this.cdRef.detectChanges()}),this.setHtmlTitle()}ngOnDestroy(){this.renderer.removeClass(document.body,"widget-grid-layout")}setHtmlTitle(){this.title.setTitle(this.text.html_title)}}Ln.\u0275fac=function(o){return new(o||Ln)(e.Y36(he),e.Y36(je.j),e.Y36(b.R),e.Y36(y.D),e.Y36(e.sBO),e.Y36(i.Dx),e.Y36(Cn),e.Y36(e.Qsj),e.Y36(L))},Ln.\u0275dir=e.lG2({type:Ln});t(46384);var qr=t(83609);function Bc(g,o){if(1&g&&e._UZ(0,"span",10),2&g){const s=e.oxw(2);e.Q6J("hidden",s.isMobileDevice)}}function Qc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"resizer",11),e.NdJ("end",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw().resize.end(j)})("start",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw().resize.start(j)})("move",function(){return e.CHM(s),e.oxw(2).resize.moving()}),e.TgZ(1,"div",12),e._UZ(2,"i",13),e.qZA(),e.qZA()}2&g&&e.Q6J("customHandler",!0)}const Nc=function(g,o,s){return{"-dragged":g,"-passive":o,"-resizing":s}};function Jc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",5),e.TgZ(1,"div",6),e.NdJ("cdkDragStarted",function(){const ee=e.CHM(s).$implicit;return e.oxw().drag.start(ee)})("cdkDragDropped",function(){return e.CHM(s),e.oxw().drag.drop()}),e.YNc(2,Bc,1,1,"span",7),e._UZ(3,"ndc-dynamic",8),e.qZA(),e.YNc(4,Qc,3,1,"resizer",9),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.Udp("grid-row-start",s.gridStartRow)("grid-row-end",s.gridEndRow)("grid-column-start",s.gridStartColumn)("grid-column-end",s.gridEndColumn),e.Q6J("ngClass",e.kEZ(18,Nc,w.drag.isDragged(s),w.drag.isPassive(s)||w.resize.isPassive(s),w.resize.isResized(s)))("id",s.guid)("cdkDropListData",s)("cdkDropListConnectedTo",w.layout.gridAreaIds),e.xp6(1),e.Q6J("cdkDragDisabled",w.isMobileDevice||!w.drag.isDraggable),e.xp6(1),e.Q6J("ngIf",w.drag.isDraggable),e.xp6(1),e.Q6J("ndcDynamicComponent",w.widgetComponent(s))("ndcDynamicInputs",w.widgetComponentInput(s))("ndcDynamicOutputs",w.widgetComponentOutput(s)),e.xp6(1),e.Q6J("ngIf",w.resize.isResizable)}}function Yc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",16),e.NdJ("click",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw().add.widget(j)}),e.qZA()}if(2&g){const s=e.oxw(2);e.Q6J("title",s.add.addText)}}const $c=function(g,o,s,w,j){return{"-drop-target":g,"-drop-only":o,"-resize-target":s,"-addable":w,"-help-mode":j}};function Vc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",14),e.NdJ("mouseover",function(){const ee=e.CHM(s).$implicit;return e.oxw().layout.setMousedOverArea(ee)}),e.YNc(1,Yc,1,1,"div",15),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.Udp("grid-row-start",s.gridStartRow)("grid-row-end",s.gridEndRow)("grid-column-start",s.gridStartColumn)("grid-column-end",s.gridEndColumn),e.Q6J("ngClass",e.qbA(13,$c,w.drag.currentlyDragging,w.drag.isDropOnlyArea(s),w.resize.isTarget(s),w.add.isAddable(s),w.layout.inHelpMode))("id",s.guid)("cdkDropListData",s)("cdkDropListConnectedTo",w.layout.gridAreaIds),e.xp6(1),e.Q6J("ngIf",w.add.isAllowed)}}function Hc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",19),e.NdJ("click",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw().add.widget(j)}),e.qZA()}if(2&g){const s=e.oxw(2);e.Q6J("title",s.add.addText)}}const zc=function(g,o,s,w){return{"-addable":g,"-help-mode":o,"-row":s,"-column":w}};function Kc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",17),e.NdJ("mouseover",function(){const ee=e.CHM(s).$implicit;return e.oxw().layout.setMousedOverArea(ee)}),e.YNc(1,Hc,1,1,"div",18),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.Udp("grid-row-start",s.gridStartRow)("grid-row-end",s.gridEndRow)("grid-column-start",s.gridStartColumn)("grid-column-end",s.gridEndColumn),e.Q6J("ngClass",e.l5B(11,zc,w.add.isAddable(s),w.layout.inHelpMode,s.isRow,s.isColumn))("id",s.guid),e.xp6(1),e.Q6J("ngIf",w.add.isAllowed)}}function Gc(g,o){if(1&g&&(e.TgZ(0,"div",20),e._UZ(1,"div",21),e.qZA()),2&g){const s=e.oxw();e.Udp("grid-row-start",s.drag.placeholderArea.gridStartRow)("grid-row-end",s.drag.placeholderArea.gridEndRow)("grid-column-start",s.drag.placeholderArea.gridStartColumn)("grid-column-end",s.drag.placeholderArea.gridEndColumn)("min-height",s.drag.draggedHeight,"px")}}const br=[L,on,sn,vn,Cn,ie];class Bn{constructor(o,s,w,j,ee,me,De,Je){this.sanitization=o,this.widgetsService=s,this.drag=w,this.resize=j,this.layout=ee,this.add=me,this.remove=De,this.browserDetector=Je,this.uiWidgets=[],this.GRID_AREA_HEIGHT="auto",this.GRID_GAP_DIMENSION="20px",this.component=li}ngOnInit(){this.layout.gridResource=this.grid}ngOnDestroy(){this.uiWidgets.forEach(o=>o.destroy())}handleKeyboardEvent(o){"Escape"!==o.key||(this.drag.currentlyDragging?this.drag.abort():this.resize.currentlyResizing&&this.resize.abort())}widgetComponent(o){const{widget:s}=o;if(!s)return null;const w=this.widgetsService.registered.find(j=>j.identifier===s.identifier);return w?w.component:null}widgetComponentInput(o){return{resource:o.widget}}widgetComponentOutput(o){return{resourceChanged:this.layout.saveWidgetChangeset.bind(this.layout)}}get gridColumnStyle(){return this.gridStyle(this.layout.numColumns,`calc((100% - ${this.GRID_GAP_DIMENSION} * ${this.layout.numColumns+1}) / ${this.layout.numColumns})`)}get gridRowStyle(){return this.gridStyle(this.layout.numRows,this.GRID_AREA_HEIGHT)}identifyGridArea(o,s){return s.guid}get isHeadersDisplayed(){return this.layout.isEditable}get isMobileDevice(){return this.browserDetector.isMobile}gridStyle(o,s){let w="";for(let j=0;j<o;j++)w+=`${this.GRID_GAP_DIMENSION} ${s} `;return w+=`${this.GRID_GAP_DIMENSION}`,this.sanitization.bypassSecurityTrustStyle(w)}}Bn.\u0275fac=function(o){return new(o||Bn)(e.Y36(i.H7),e.Y36(It),e.Y36(sn),e.Y36(vn),e.Y36(L),e.Y36(Cn),e.Y36(ie),e.Y36(ct.o))},Bn.\u0275cmp=e.Xpm({type:Bn,selectors:[["grid"]],hostBindings:function(o,s){1&o&&e.NdJ("keyup",function(j){return s.handleKeyboardEvent(j)},!1,e.Jf7)},inputs:{grid:"grid"},decls:5,vars:11,consts:[[1,"grid--container"],["class","grid--area -widgeted","cdkDropList","",3,"ngClass","grid-row-start","grid-row-end","grid-column-start","grid-column-end","id","cdkDropListData","cdkDropListConnectedTo",4,"ngFor","ngForOf","ngForTrackBy"],["class","grid--area hidden-for-mobile","cdkDropList","",3,"ngClass","grid-row-start","grid-row-end","grid-column-start","grid-column-end","id","cdkDropListData","cdkDropListConnectedTo","mouseover",4,"ngFor","ngForOf","ngForTrackBy"],["class","grid--area -gap hidden-for-mobile",3,"ngClass","grid-row-start","grid-row-end","grid-column-start","grid-column-end","id","mouseover",4,"ngFor","ngForOf","ngForTrackBy"],["class","grid--area -widgeted -placeholder",3,"grid-row-start","grid-row-end","grid-column-start","grid-column-end","min-height",4,"ngIf"],["cdkDropList","",1,"grid--area","-widgeted",3,"ngClass","id","cdkDropListData","cdkDropListConnectedTo"],["cdkDrag","",1,"grid--area-content","widget-box",3,"cdkDragDisabled","cdkDragStarted","cdkDragDropped"],["class","grid--area-drag-handle\n                   icon\n                   icon-drag-handle\n                   hidden-for-mobile","cdkDragHandle","",3,"hidden",4,"ngIf"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs"],[3,"customHandler","end","start","move",4,"ngIf"],["cdkDragHandle","",1,"grid--area-drag-handle","icon","icon-drag-handle","hidden-for-mobile",3,"hidden"],[3,"customHandler","end","start","move"],[1,"grid--resizer"],["aria-hidden","true",1,"icon-resizer-bottom-right","hidden-for-mobile"],["cdkDropList","",1,"grid--area","hidden-for-mobile",3,"ngClass","id","cdkDropListData","cdkDropListConnectedTo","mouseover"],["class","grid--widget-add",3,"title","click",4,"ngIf"],[1,"grid--widget-add",3,"title","click"],[1,"grid--area","-gap","hidden-for-mobile",3,"ngClass","id","mouseover"],["class","grid--widget-add -gap",3,"title","click",4,"ngIf"],[1,"grid--widget-add","-gap",3,"title","click"],[1,"grid--area","-widgeted","-placeholder"],[1,"widget-box"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Jc,5,22,"div",1),e.YNc(2,Vc,2,19,"div",2),e.YNc(3,Kc,2,16,"div",3),e.YNc(4,Gc,2,10,"div",4),e.qZA()),2&o&&(e.Udp("grid-template-columns",s.gridColumnStyle)("grid-template-rows",s.gridRowStyle),e.xp6(1),e.Q6J("ngForOf",s.layout.widgetAreas)("ngForTrackBy",s.identifyGridArea),e.xp6(1),e.Q6J("ngForOf",s.layout.gridAreas)("ngForTrackBy",s.identifyGridArea),e.xp6(1),e.Q6J("ngForOf",s.layout.gridGaps)("ngForTrackBy",s.identifyGridArea),e.xp6(1),e.Q6J("ngIf",s.drag.placeholderArea))},directives:[D.sg,D.O5,k.Wj,D.mk,k.Zt,p.B5,p.oc,k.Bh,qr.d],encapsulation:2});const qc=function(g){return{"-active":g}};function Xc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){return e.CHM(s),e.oxw().areas.toggleHelpMode()}),e._UZ(1,"op-icon",10),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.addWidget.addText)("ngClass",e.VKq(2,qc,s.areas.inHelpMode))}}function el(g,o){if(1&g&&e._UZ(0,"grid",11),2&g){const s=e.oxw();e.Q6J("grid",s.grid)}}class so extends Ln{i18nNamespace(){return"dashboards"}gridScopePath(){return this.pathHelper.projectDashboardsPath(this.currentProject.identifier)}}so.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(so)))(s||so)}}(),so.\u0275cmp=e.Xpm({type:so,selectors:[["dashboard"]],features:[e._Bn(br),e.qOj],decls:10,vars:3,consts:[[1,"op-grid-page"],[1,"toolbar","op-grid-page--toolbar-container"],[1,"op-grid-page--title-container","title-container"],[3,"textContent"],[1,"op-grid-page--toolbar-items","toolbar-items","hidden-for-mobile"],[1,"toolbar-item","hidden-for-mobile"],[1,"toolbar-item"],["class","button",3,"title","ngClass","click",4,"ngIf"],[3,"grid",4,"ngIf"],[1,"button",3,"title","ngClass","click"],["icon-classes","button--icon icon-add"],[3,"grid"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"h2",3),e.qZA(),e.TgZ(4,"ul",4),e.TgZ(5,"li",5),e._UZ(6,"zen-mode-toggle-button"),e.qZA(),e.TgZ(7,"li",6),e.YNc(8,Xc,2,4,"button",7),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,el,1,1,"grid",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.title),e.xp6(5),e.Q6J("ngIf",s.addWidget.isAllowed),e.xp6(1),e.Q6J("ngIf",s.grid))},directives:[gn.a,D.O5,D.mk,Ye.o,Bn],styles:[".op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:20px;margin-bottom:-5px}.op-grid-page--toolbar-container[_ngcontent-%COMP%]{margin-bottom:0}.op-grid-page--toolbar-items[_ngcontent-%COMP%]{padding-right:20px}@media only screen and (max-width: 679px){.op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:0;margin-bottom:0}}"]});const tl=[{name:"dashboards",parent:"optional_project",url:"/dashboards/",data:{bodyClasses:["router--dashboards-view-base","widget-grid-layout"],menuItem:"dashboards-menu-item"},component:so}];class ro{}ro.\u0275fac=function(o){return new(o||ro)},ro.\u0275mod=e.oAB({type:ro}),ro.\u0275inj=e.cJS({providers:[],imports:[[n.H,nn,Vt.UIRouterModule.forChild({states:tl,config:function(g){g.urlService.rules.when(new RegExp("^/projects/(.*)/dashboards$"),o=>`/projects/${o[1]}/dashboards/`)}})]]});var nl=t(37409);function ol(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"wp-single-card",2),e.NdJ("stateLinkClicked",function(j){return e.CHM(s),e.oxw().openStateLink(j)}),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("workPackage",s.workPackage)}}class ns extends st.T{constructor(o,s,w,j,ee,me,De){super(s,w,o),this.elementRef=o,this.locals=s,this.cdRef=w,this.i18n=j,this.apiV3Service=ee,this.opModalService=me,this.$state=De,this.text={created_by:this.i18n.t("js.label_created_by")}}ngOnInit(){super.ngOnInit();const{workPackageLink:o}=this.locals,s=(0,Ae.Z)(o);this.apiV3Service.work_packages.id(s).requireAndStream().subscribe(w=>{this.workPackage=w,this.cdRef.detectChanges();const j=jQuery(this.elementRef.nativeElement).find(".op-wp-preview-modal");this.reposition(j,this.locals.event.target)})}reposition(o,s){o.position({my:"right top",at:"right bottom",of:s,collision:"flipfit"})}openStateLink(o){const s={workPackageId:o.workPackageId};this.$state.go(o.requestedState,s)}}ns.\u0275fac=function(o){return new(o||ns)(e.Y36(e.SBq),e.Y36(He.E),e.Y36(e.sBO),e.Y36(y.D),e.Y36(R.T),e.Y36(He.S),e.Y36(Ke.StateService))},ns.\u0275cmp=e.Xpm({type:ns,selectors:[["ng-component"]],features:[e.qOj],decls:1,vars:1,consts:[["class","op-wp-preview-modal","wp-isolated-query-space","",4,"ngIf"],["wp-isolated-query-space","",1,"op-wp-preview-modal"],["orientation","horizontal",3,"workPackage","stateLinkClicked"]],template:function(o,s){1&o&&e.YNc(0,ol,2,1,"div",0),2&o&&e.Q6J("ngIf",s.workPackage)},directives:[D.O5,ve.A,nl.P],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-preview-modal[_ngcontent-%COMP%]{position:absolute;z-index:5000;min-width:350px;padding:0;box-shadow:0 0 5px 2px #00000040;pointer-events:all}"],changeDetection:0});class ao{constructor(o,s,w){this.opModalService=o,this.ngZone=s,this.injector=w,this.mouseInModal=!1}setupListener(){jQuery(document.body).on("mouseover",".preview-trigger",o=>{o.preventDefault(),o.stopPropagation();const s=jQuery(o.target),w=s.attr("href");!w||(this.previewModal=this.opModalService.show(ns,this.injector,{workPackageLink:w,event:o},!0),this.modalElement=this.previewModal.elementRef.nativeElement,this.previewModal.reposition(jQuery(this.modalElement),s))}),jQuery(document.body).on("mouseleave",".preview-trigger",()=>{this.closeAfterTimeout()}),jQuery(document.body).on("mouseleave",".op-wp-preview-modal",()=>{this.mouseInModal=!1,this.closeAfterTimeout()}),jQuery(document.body).on("mouseenter",".op-wp-preview-modal",()=>{this.mouseInModal=!0})}closeAfterTimeout(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.mouseInModal||this.opModalService.close()},100)})}isMouseOverPreview(o){if(!this.modalElement)return!1;const s=jQuery(this.modalElement.children[0]);if(s&&s.offset()){const w=o.pageX>=Math.floor(s.offset().left)&&o.pageX<s.offset().left+s.width(),j=o.pageY>=Math.floor(s.offset().top)&&o.pageY<s.offset().top+s.height();return w&&j}return!1}}ao.\u0275fac=function(o){return new(o||ao)(e.LFG(He.S),e.LFG(e.R0b),e.LFG(e.zs3))},ao.\u0275prov=e.Yz7({token:ao,factory:ao.\u0275fac,providedIn:"root"});const sl=function(g){return{"-active":g}};function rl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){return e.CHM(s),e.oxw().areas.toggleHelpMode()}),e._UZ(1,"op-icon",10),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.addWidget.addText)("ngClass",e.VKq(2,sl,s.areas.inHelpMode))}}function al(g,o){if(1&g&&e._UZ(0,"grid",11),2&g){const s=e.oxw();e.Q6J("grid",s.grid)}}class co extends Ln{i18nNamespace(){return"overviews"}gridScopePath(){return this.pathHelper.projectPath(this.currentProject.identifier)}}co.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(co)))(s||co)}}(),co.\u0275cmp=e.Xpm({type:co,selectors:[["overview"]],features:[e._Bn(br),e.qOj],decls:10,vars:3,consts:[[1,"op-grid-page"],[1,"toolbar","op-grid-page--toolbar-container"],[1,"op-grid-page--title-container","title-container"],[3,"textContent"],[1,"op-grid-page--toolbar-items","toolbar-items","hidden-for-mobile"],[1,"toolbar-item","hidden-for-mobile"],[1,"toolbar-item"],["class","button",3,"title","ngClass","click",4,"ngIf"],[3,"grid",4,"ngIf"],[1,"button",3,"title","ngClass","click"],["icon-classes","button--icon icon-add"],[3,"grid"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"h2",3),e.qZA(),e.TgZ(4,"ul",4),e.TgZ(5,"li",5),e._UZ(6,"zen-mode-toggle-button"),e.qZA(),e.TgZ(7,"li",6),e.YNc(8,rl,2,4,"button",7),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,al,1,1,"grid",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.title),e.xp6(5),e.Q6J("ngIf",s.addWidget.isAllowed),e.xp6(1),e.Q6J("ngIf",s.grid))},directives:[gn.a,D.O5,D.mk,Ye.o,Bn],styles:[".op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:20px;margin-bottom:-5px}.op-grid-page--toolbar-container[_ngcontent-%COMP%]{margin-bottom:0}.op-grid-page--toolbar-items[_ngcontent-%COMP%]{padding-right:20px}@media only screen and (max-width: 679px){.op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:0;margin-bottom:0}}"]});const cl=[{name:"overview",parent:"optional_project",url:"/",data:{menuItem:"overview-menu-item"},component:co}];class lo{}lo.\u0275fac=function(o){return new(o||lo)},lo.\u0275mod=e.oAB({type:lo}),lo.\u0275inj=e.cJS({providers:[],imports:[[n.H,nn,Vt.UIRouterModule.forChild({states:cl,config:function(g){g.urlService.rules.when(new RegExp("^/projects(?!/new$)/([^/]+)$"),o=>`/projects/${o[1]}/`)}})]]});const dl=function(g){return{"-active":g}};function pl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){return e.CHM(s),e.oxw().areas.toggleHelpMode()}),e._UZ(1,"op-icon",10),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.addWidget.addText)("ngClass",e.VKq(2,dl,s.areas.inHelpMode))}}function ul(g,o){if(1&g&&e._UZ(0,"grid",11),2&g){const s=e.oxw();e.Q6J("grid",s.grid)}}class po extends Ln{i18nNamespace(){return"my_page"}gridScopePath(){return this.pathHelper.myPagePath()}}po.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(po)))(s||po)}}(),po.\u0275cmp=e.Xpm({type:po,selectors:[["ng-component"]],features:[e._Bn(br),e.qOj],decls:10,vars:3,consts:[[1,"op-grid-page"],[1,"toolbar","op-grid-page--toolbar-container"],[1,"op-grid-page--title-container","title-container"],[3,"textContent"],[1,"op-grid-page--toolbar-items","toolbar-items","hidden-for-mobile"],[1,"toolbar-item","hidden-for-mobile"],[1,"toolbar-item"],["class","button",3,"title","ngClass","click",4,"ngIf"],[3,"grid",4,"ngIf"],[1,"button",3,"title","ngClass","click"],["icon-classes","button--icon icon-add"],[3,"grid"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"h2",3),e.qZA(),e.TgZ(4,"ul",4),e.TgZ(5,"li",5),e._UZ(6,"zen-mode-toggle-button"),e.qZA(),e.TgZ(7,"li",6),e.YNc(8,pl,2,4,"button",7),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,ul,1,1,"grid",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.title),e.xp6(5),e.Q6J("ngIf",s.addWidget.isAllowed),e.xp6(1),e.Q6J("ngIf",s.grid))},directives:[gn.a,D.O5,D.mk,Ye.o,Bn],styles:[".op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:20px;margin-bottom:-5px}.op-grid-page--toolbar-container[_ngcontent-%COMP%]{margin-bottom:0}.op-grid-page--toolbar-items[_ngcontent-%COMP%]{padding-right:20px}@media only screen and (max-width: 679px){.op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:0;margin-bottom:0}}"]});const hl=[{name:"my_page",url:"/my/page",component:po,data:{bodyClasses:["router--work-packages-my-page","widget-grid-layout"],parent:"work-packages"}}];class uo{}uo.\u0275fac=function(o){return new(o||uo)},uo.\u0275mod=e.oAB({type:uo}),uo.\u0275inj=e.cJS({imports:[[n.H,nn,C.K,Vt.UIRouterModule.forChild({states:hl})]]});var _l=t(71718),Xr=t(7101);const ml={preview:1,newWorkPackage:2,edit:3,quickSearch:4,projectSearch:5,help:6,moreMenu:7,details:8};class ho{constructor(o,s,w){this.PathHelper=o,this.FocusHelper=s,this.currentProject=w,this.shortcuts={"?":()=>this.showHelpModal(),"g m":this.globalAction("myPagePath"),"g o":this.projectScoped("projectPath"),"g w p":this.projectScoped("projectWorkPackagesPath"),"g w i":this.projectScoped("projectWikiPath"),"g a":this.projectScoped("projectActivityPath"),"g c":this.projectScoped("projectCalendarPath"),"g n":this.projectScoped("projectNewsPath"),"n w p":this.projectScoped("projectWorkPackageNewPath"),"g e":this.accessKey("edit"),"g p":this.accessKey("preview"),"d w p":this.accessKey("details"),m:this.accessKey("moreMenu"),p:this.accessKey("projectSearch"),s:this.accessKey("quickSearch"),k:()=>this.focusPrevItem(),j:()=>this.focusNextItem()},this.register()}register(){_.each(this.shortcuts,(o,s)=>Mousetrap.bind(s,o))}accessKey(o){const s=ml[o];return()=>{const w=jQuery(`[accesskey=${s}]:first`);w.is("input")||"global-search-input"===w.attr("id")?setTimeout(()=>this.FocusHelper.focus(w[0]),200):w.is("[href]")?this.clickLink(w[0]):w[0].click()}}globalAction(o){return()=>{window.location.href=this.PathHelper[o]()}}projectScoped(o){return()=>{const s=this.currentProject.identifier;s&&(window.location.href=this.PathHelper[o](s))}}clickLink(o){const s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});!o.dispatchEvent(s)||(window.location.href=o.href)}showHelpModal(){window.open(this.PathHelper.keyboardShortcutsHelpPath())}focusItemOffset(o){const s=document.querySelector("table.keyboard-accessible-list");if(!s)return;const w=Array.from(s.querySelectorAll("tbody > tr"));let j;if(document.activeElement){j=w.indexOf(document.activeElement);const ee=w[j+o];null==ee||ee.focus()}}focusNextItem(){this.focusItemOffset(1)}focusPrevItem(){this.focusItemOffset(-1)}}ho.\u0275fac=function(o){return new(o||ho)(e.LFG(je.j),e.LFG(Xr.i),e.LFG(b.R))},ho.\u0275prov=e.Yz7({token:ho,factory:ho.\u0275fac,providedIn:"root"});var zi=t(36868);class _o{}_o.\u0275fac=function(o){return new(o||_o)},_o.\u0275mod=e.oAB({type:_o}),_o.\u0275inj=e.cJS({imports:[[n.H,zi.A0]]});var fl=t(55280),rn=t(3352);class Qn{constructor(o){this.documentElement=o}loadRequiredScripts(){const o=this.documentElement.querySelectorAll('meta[name="required_script"]');for(let s=0;s<o.length;++s){const w=o[s].content;(0,rn.qu)(`Loading required script ${w}`),t(37294)(`./${w}`)}}}Qn.\u0275fac=function(o){return new(o||Qn)(e.LFG(D.K0))},Qn.\u0275prov=e.Yz7({token:Qn,factory:Qn.\u0275fac,providedIn:"root"});class mo{constructor(o,s){o.setupListener(),s.loadRequiredScripts()}}mo.\u0275fac=function(o){return new(o||mo)(e.LFG(fl.v),e.LFG(Qn))},mo.\u0275mod=e.oAB({type:mo}),mo.\u0275inj=e.cJS({providers:[Qn],imports:[[C.K]]});var vl=t(7085),Cl=t(37991),ea=t(6894),yl=t(64775),ui=t(83635);class go{constructor(o,s,w){this.documentElement=o,this.opModalService=s,this.currentProjectService=w}setupListener(){const o=this.documentElement.querySelectorAll("[invite-user-modal-augment]");for(let s=0;s<o.length;++s)o[s].addEventListener("click",this.spawnModal.bind(this))}spawnModal(o){o.preventDefault(),this.opModalService.show(ui.E,"global",{projectId:this.currentProjectService.id}).closingEvent.subscribe(w=>{w.data&&window.location.reload()})}}go.\u0275fac=function(o){return new(o||go)(e.LFG(D.K0),e.LFG(He.S),e.LFG(b.R))},go.\u0275prov=e.Yz7({token:go,factory:go.\u0275fac,providedIn:"root"});var wl=t(2308),Nn=t(96905),Tl=t(91720),Yt=t(33927),kl=t(18293);var wr=t(18252),Tr=t(5443);function xl(g,o){if(1&g&&e._UZ(0,"p",4),2&g){const s=e.oxw().$implicit;e.Q6J("innerHTML",s.description,e.oJD)}}function El(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"label"),e.TgZ(1,"input",1),e.NdJ("ngModelChange",function(j){e.CHM(s);return e.oxw().selected=j}),e.qZA(),e.TgZ(2,"div"),e.TgZ(3,"p",2),e._uU(4),e.qZA(),e.YNc(5,xl,1,1,"p",3),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.Tol(w.getClassListForItem(s)),e.xp6(1),e.Q6J("value",s.value)("ngModel",w.selected)("disabled",s.disabled),e.uIk("name",w.name),e.xp6(3),e.Oqu(s.title),e.xp6(1),e.Q6J("ngIf",s.description)}}class fo{constructor(){this.className=!0,this.options=[],this.name="op-option-list-"+ +new Date,this.selectedChange=new e.vpe,this._selected=null,this.onChange=o=>{},this.onTouched=o=>{}}get selected(){return this._selected}set selected(o){this._selected=o,this.onChange(o)}getClassListForItem(o){return{"op-option-list--item":!0,"op-option-list--item_selected":this.selected===o.value,"op-option-list--item_disabled":!!o.disabled}}writeValue(o){this._selected=o}registerOnChange(o){this.onChange=o}registerOnTouched(o){this.onTouched=o}}function Ol(g,o){if(1&g&&(e.TgZ(0,"div",14),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.project.lackingPermissionInfo," ")}}function Ml(g,o){if(1&g&&(e.TgZ(0,"div",15),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.project.required," ")}}function Il(g,o){if(1&g&&(e.TgZ(0,"div",15),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.project.lackingPermission," ")}}function Sl(g,o){if(1&g&&(e.TgZ(0,"div",16),e.TgZ(1,"div",17),e._uU(2),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.hij(" ",s.text.type.required," ")}}fo.\u0275fac=function(o){return new(o||fo)},fo.\u0275cmp=e.Xpm({type:fo,selectors:[["op-option-list"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-option-list",s.className)},inputs:{options:"options",name:"name"},outputs:{selectedChange:"selectedChange"},features:[e._Bn([{provide:d.JU,useExisting:(0,e.Gpc)(()=>fo),multi:!0}])],decls:1,vars:1,consts:[[3,"class",4,"ngFor","ngForOf"],["type","radio",1,"op-option-list--input",3,"value","ngModel","disabled","ngModelChange"],[1,"op-option-list--item-title"],["class","op-option-list--item-description",3,"innerHTML",4,"ngIf"],[1,"op-option-list--item-description",3,"innerHTML"]],template:function(o,s){1&o&&e.YNc(0,El,6,8,"label",0),2&o&&e.Q6J("ngForOf",s.options)},directives:[D.sg,d._,d.Fj,d.JJ,d.On,D.O5],encapsulation:2});class os{constructor(o,s,w,j,ee,me){var g;this.I18n=o,this.elementRef=s,this.bannersService=w,this.apiV3Service=j,this.currentUserService=ee,this.cdRef=me,this.close=new e.vpe,this.save=new e.vpe,this.text={title:this.I18n.t("js.invite_user_modal.title.invite"),project:{label:this.I18n.t("js.invite_user_modal.project.label"),required:this.I18n.t("js.invite_user_modal.project.required"),lackingPermission:this.I18n.t("js.invite_user_modal.project.lacking_permission"),lackingPermissionInfo:this.I18n.t("js.invite_user_modal.project.lacking_permission_info"),noInviteRights:this.I18n.t("js.invite_user_modal.project.no_invite_rights")},type:{required:this.I18n.t("js.invite_user_modal.type.required")},nextButton:this.I18n.t("js.invite_user_modal.project.next_button"),cancelButton:this.I18n.t("js.button_cancel")},this.typeOptions=[{value:ui.e.User,title:this.I18n.t("js.invite_user_modal.type.user.title"),description:this.I18n.t("js.invite_user_modal.type.user.description")},{value:ui.e.Group,title:this.I18n.t("js.invite_user_modal.type.group.title"),description:this.I18n.t("js.invite_user_modal.type.group.description")}],this.projectAndTypeForm=new d.cw({type:new d.NI(ui.e.User,[d.kI.required]),project:new d.NI(null,[d.kI.required],(g=this.currentUserService,o=>{var s,w,j;const ee=(null===(s=o.value)||void 0===s?void 0:s.href)||(null===(j=null===(w=o.value)||void 0===w?void 0:w.$links)||void 0===j?void 0:j.self.href),me=ee?(0,Ae.Z)(ee):o.value;return g.hasCapabilities$("memberships/create",me).pipe((0,fn.q)(1),(0,Yt.U)(De=>De?null:{lackingPermission:!0}),(0,kl.K)(()=>(0,eo.of)(null)))}))}),this.projectInviteCapabilities=[],this.APIFiltersForProjects=[["active","=",!0]]}get typeControl(){return this.projectAndTypeForm.get("type")}get projectControl(){return this.projectAndTypeForm.get("project")}ngOnInit(){this.typeControl.setValue(this.type),this.project&&this.projectControl.setValue((0,Tl.fK)(this.project)),this.setPlaceholderOption(),this.currentUserService.capabilities$(["memberships/create"]).pipe((0,Yt.U)(o=>o.filter(s=>s._links.action.href.endsWith("/memberships/create")))).subscribe(o=>{this.projectInviteCapabilities=o,this.cdRef.detectChanges()})}setPlaceholderOption(){this.bannersService.eeShowBanners?this.typeOptions.push({value:ui.e.Placeholder,title:this.I18n.t("js.invite_user_modal.type.placeholder.title_no_ee"),description:this.I18n.t("js.invite_user_modal.type.placeholder.description_no_ee",{eeHref:this.bannersService.getEnterPriseEditionUrl({referrer:"placeholder-users",hash:"placeholder-users"})}),disabled:!0}):this.typeOptions.push({value:ui.e.Placeholder,title:this.I18n.t("js.invite_user_modal.type.placeholder.title"),description:this.I18n.t("js.invite_user_modal.type.placeholder.description"),disabled:!1})}onSubmit(o){var s,w;return(0,se.mG)(this,void 0,void 0,function*(){if(o.preventDefault(),this.projectAndTypeForm.invalid)return void this.projectAndTypeForm.markAsDirty();const j=(0,Ae.Z)(null===(w=null===(s=this.projectControl)||void 0===s?void 0:s.value)||void 0===w?void 0:w.href),ee=yield this.apiV3Service.projects.id(j).get().toPromise();this.save.emit({project:ee,type:this.typeControl.value})})}projectFilterFn(o){const s=o.map(w=>{const j=!this.projectInviteCapabilities.find(ee=>(0,Ae.Z)(ee._links.context.href)===w.id.toString());return Object.assign(Object.assign({},w),{disabled:j,disabledReason:j?this.text.project.noInviteRights:""})});return s.sort((w,j)=>(w.disabled?1:0)-(j.disabled?1:0)),s}}os.\u0275fac=function(o){return new(o||os)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(cr.j),e.Y36(R.T),e.Y36(Nn.S),e.Y36(e.sBO))},os.\u0275cmp=e.Xpm({type:os,selectors:[["op-ium-project-selection"]],inputs:{type:"type",project:"project"},outputs:{close:"close",save:"save"},decls:19,vars:12,consts:[[3,"formGroup","ngSubmit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["required","",3,"label"],["slot","input","formControlName","project","appendTo",".spot-modal-overlay",3,"apiFilters","mapResultsFn"],["slot","help-text",4,"ngIf"],["slot","errors","class","op-form-field--error",4,"ngIf"],["formControlName","type","slot","input",3,"options"],["class","op-form-field--errors","slot","errors",4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],[1,"button","button_no-margin","-highlight","spot-action-bar--action"],["slot","help-text"],["slot","errors",1,"op-form-field--error"],["slot","errors",1,"op-form-field--errors"],[1,"op-form-field--error"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(j){return s.onSubmit(j)}),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"op-form-field",4),e._UZ(6,"op-project-autocompleter",5),e.YNc(7,Ol,2,1,"div",6),e.YNc(8,Ml,2,1,"div",7),e.YNc(9,Il,2,1,"div",7),e.qZA(),e.TgZ(10,"op-form-field"),e._UZ(11,"op-option-list",8),e.YNc(12,Sl,3,1,"div",9),e.qZA(),e.qZA(),e.TgZ(13,"div",10),e.TgZ(14,"div",11),e.TgZ(15,"button",12),e.NdJ("click",function(){return s.close.emit()}),e._uU(16),e.qZA(),e.TgZ(17,"button",13),e._uU(18),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("formGroup",s.projectAndTypeForm),e.xp6(2),e.Oqu(s.text.title),e.xp6(3),e.Q6J("label",s.text.project.label),e.xp6(1),e.Q6J("apiFilters",s.APIFiltersForProjects)("mapResultsFn",s.projectFilterFn.bind(s)),e.xp6(1),e.Q6J("ngIf",null==s.projectControl.errors?null:s.projectControl.errors.lackingPermission),e.xp6(1),e.Q6J("ngIf",null==s.projectControl.errors?null:s.projectControl.errors.required),e.xp6(1),e.Q6J("ngIf",null==s.projectControl.errors?null:s.projectControl.errors.lackingPermission),e.xp6(2),e.Q6J("options",s.typeOptions),e.xp6(1),e.Q6J("ngIf",(null==s.projectAndTypeForm?null:s.projectAndTypeForm.dirty)&&(null==s.typeControl?null:s.typeControl.invalid)),e.xp6(4),e.hij(" ",s.text.cancelButton," "),e.xp6(2),e.Oqu(s.text.nextButton))},directives:[d._Y,d.JL,d.sg,wr.V,Tr.F,d.JJ,d.u,D.O5,fo],styles:[""],changeDetection:0});var ta=t(23896),ia=t(57958),vo=(t(9214),t(80044)),vi=(t(4816),t(53882)),na=t(79441),lr=t(80639),oa=t(3353);function Dl(g,o){if(1&g&&(e.TgZ(0,"div",4),e._uU(1),e.qZA()),2&g){const s=o.item,w=o.searchTerm;e.Q6J("ngOptionHighlight",w),e.xp6(1),e.Oqu(s.name)}}function Al(g,o){if(1&g&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.noRolesFound," ")}}class ss extends si.N{constructor(o,s,w){super(),this.I18n=o,this.elementRef=s,this.apiV3Service=w,this.input$=new na.xQ,this.roles$=new na.xQ,this.text={noRolesFound:this.I18n.t("js.invite_user_modal.role.no_roles_found")},this.items$=(0,Ai.aj)(this.input$.pipe(this.untilDestroyed(),(0,lr.b)(200),(0,Gt.h)(j=>"string"==typeof j),(0,Yt.U)(j=>j.toLowerCase()),(0,Hi.x)()),this.roles$).pipe((0,Yt.U)(([j,ee])=>ee.filter(me=>!j||-1!==me.name.toLowerCase().indexOf(j))))}ngOnInit(){const o=new Fn.qM;o.add("grantable","=",!0),o.add("unit","=",["project"]),this.apiV3Service.roles.filtered(o).get().subscribe(({elements:s})=>this.roles$.next(s)),setTimeout(()=>this.input$.next(""))}}ss.\u0275fac=function(o){return new(o||ss)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(R.T))},ss.\u0275cmp=e.Xpm({type:ss,selectors:[["op-ium-role-search"]],inputs:{roleControl:["opFormBinding","roleControl"]},features:[e.qOj],decls:5,vars:9,consts:[["appendTo",".spot-modal-overlay","bindLabel","name",3,"formControl","typeahead","items","virtualScroll","clearable","clearOnBackspace","clearSearchOnAdd"],["ngselect",""],["ng-option-tmp",""],["ng-notfound-tmp",""],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight"],[1,"ng-option","disabled"]],template:function(o,s){1&o&&(e.TgZ(0,"ng-select",0,1),e.ALo(2,"async"),e.YNc(3,Dl,2,2,"ng-template",2),e.YNc(4,Al,2,1,"ng-template",3),e.qZA()),2&o&&e.Q6J("formControl",s.roleControl)("typeahead",s.input$)("items",e.lcZ(2,7,s.items$))("virtualScroll",!0)("clearable",!0)("clearOnBackspace",!1)("clearSearchOnAdd",!1)},directives:[zi.w9,d.JJ,d.oH,zi.Z2,zi.vM,oa.s],pipes:[D.Ov],encapsulation:2});const jl={provide:d.a5,useExisting:(0,e.Gpc)(()=>Jn)};class Jn extends d.a5{get control(){return this.form}viewToModelUpdate(){}}Jn.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Jn)))(s||Jn)}}(),Jn.\u0275dir=e.lG2({type:Jn,selectors:[["","opFormBinding",""]],inputs:{form:["opFormBinding","form"]},exportAs:["ngForm"],features:[e._Bn([jl]),e.qOj]});var Zl=t(42720),Rl=t(91992),kr=t(92597),sa=t(41599);function Fl(g,o){if(1&g&&e._uU(0),2&g){const s=o.item;e.hij(" ",(null==s.principal?null:s.principal.name)||s.name," ")}}function Wl(g,o){if(1&g&&(e.TgZ(0,"div",10),e._uU(1),e.qZA()),2&g){const s=e.oxw(3);e.xp6(1),e.Oqu(s.text.alreadyAMember())}}function Ul(g,o){if(1&g&&(e.TgZ(0,"div",7),e.TgZ(1,"div",8),e._uU(2),e.qZA(),e.YNc(3,Wl,2,1,"div",9),e.qZA()),2&g){const s=e.oxw(),w=s.searchTerm,j=s.item;e.xp6(1),e.Q6J("ngOptionHighlight",w),e.xp6(1),e.Oqu(j.principal.name),e.xp6(1),e.Q6J("ngIf",j.disabled)}}function Ll(g,o){if(1&g&&e.YNc(0,Ul,4,3,"div",6),2&g){const s=o.item;e.Q6J("ngIf",s)}}function Bl(g,o){if(1&g&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.noResults[s.type]," ")}}function Ql(g,o){if(1&g&&(e.TgZ(0,"div"),e._UZ(1,"op-icon",13),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4),e.qZA()),2&g){const s=e.oxw(2);e.xp6(3),e.Oqu(s.text.inviteNewUser),e.xp6(1),e.hij(" ",s.input," ")}}function Nl(g,o){if(1&g&&(e.TgZ(0,"div"),e._UZ(1,"op-icon",14),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4),e.qZA()),2&g){const s=e.oxw(2);e.xp6(3),e.Oqu(s.text.createNewPlaceholder),e.xp6(1),e.hij(" ",s.input," ")}}function Jl(g,o){if(1&g&&(e.YNc(0,Ql,5,2,"div",12),e.ALo(1,"async"),e.YNc(2,Nl,5,2,"div",12),e.ALo(3,"async")),2&g){const s=e.oxw();e.Q6J("ngIf",e.lcZ(1,2,s.canInviteByEmail$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,4,s.canCreateNewPlaceholder$))}}class rs extends si.N{constructor(o,s,w,j,ee){super(),this.I18n=o,this.elementRef=s,this.apiV3Service=w,this.currentUserService=j,this.capabilitiesService=ee,this.createNew=new e.vpe,this.input$=new S.X(""),this.input="",this.items$=this.input$.pipe(this.untilDestroyed(),(0,lr.b)(200),(0,Hi.x)(),(0,H.w)(this.loadPrincipalData.bind(this)),(0,Rl.B)()),this.emailRegExp=/^\S+@\S+\.\S+$/,this.canInviteByEmail$=(0,Ai.aj)(this.items$,this.input$,this.currentUserService.hasCapabilities$("users/create")).pipe((0,Yt.U)(([me,De,Je])=>Je&&this.type===ui.e.User&&!!De&&this.emailRegExp.test(De)&&!me.find(qe=>qe.principal.email===De))),this.canCreateNewPlaceholder$=(0,Ai.aj)([this.items$,this.input$,this.currentUserService.hasCapabilities$("placeholder_users/create")]).pipe((0,Yt.U)(([me,De,Je])=>!(!Je||this.type!==ui.e.Placeholder)&&(!!De&&!me.find(qe=>qe.name===De)))),this.showAddTag=!1,this.text={alreadyAMember:()=>{var me;return this.I18n.t("js.invite_user_modal.principal.already_member_message",{project:null===(me=this.project)||void 0===me?void 0:me.name})},inviteNewUser:this.I18n.t("js.invite_user_modal.principal.invite_user"),createNewPlaceholder:this.I18n.t("js.invite_user_modal.principal.create_new_placeholder"),noResults:{User:this.I18n.t("js.invite_user_modal.principal.no_results_user"),PlaceholderUser:this.I18n.t("js.invite_user_modal.principal.no_results_placeholder"),Group:this.I18n.t("js.invite_user_modal.principal.no_results_group")}},this.compareWith=(me,De)=>me.principal.id===De.id,this.input$.subscribe(me=>{this.input=me}),(0,Ai.aj)(this.canInviteByEmail$,this.canCreateNewPlaceholder$).pipe((0,Yt.U)(([me,De])=>me||De)).subscribe(me=>{this.showAddTag=me})}ngOnInit(){setTimeout(()=>this.input$.next(""))}createNewFromInput(){this.createNew.emit({name:this.input})}loadPrincipalData(o){var s,w;const j=new Fn.qM;o&&j.add("any_name_attribute","~",[o]),j.add("status","!",[3]),j.add("type","=",[this.type]),j.add("member","!",[(null===(s=this.project)||void 0===s?void 0:s.id)||""]);const ee=this.apiV3Service.principals.filtered(j).get(),me=new Fn.qM;o&&me.add("any_name_attribute","~",[o]),me.add("status","!",[3]),me.add("type","=",[this.type]),me.add("member","=",[(null===(w=this.project)||void 0===w?void 0:w.id)||""]);const De=this.apiV3Service.principals.filtered(me).get();return(0,Zl.D)({members:De,nonMembers:ee}).pipe((0,Yt.U)(({members:Je,nonMembers:qe})=>[...qe.elements.map(Et=>({principal:Et,disabled:!1})),...Je.elements.map(Et=>({principal:Et,disabled:!0}))].slice(0,5)),(0,kr.d)(1))}}function Yl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-ium-principal-search",18),e.NdJ("createNew",function(j){return e.CHM(s),e.oxw().createNewFromInput(j)}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("opFormBinding",s.principalControl)("type",s.type)("project",s.project)}}function $l(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"p",19),e.TgZ(1,"b"),e._uU(2),e.qZA(),e._uU(3),e.TgZ(4,"button",20),e.NdJ("click",function(){e.CHM(s);const j=e.oxw();return null==j.principalControl?null:j.principalControl.setValue(null)}),e._uU(5),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(2),e.Oqu(s.text.principal.inviteUser),e.xp6(1),e.hij(" ",s.principal.name," "),e.xp6(2),e.Oqu(s.text.principal.change)}}function Vl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"p",19),e.TgZ(1,"b"),e._uU(2),e.qZA(),e._uU(3),e.TgZ(4,"button",20),e.NdJ("click",function(){e.CHM(s);const j=e.oxw();return null==j.principalControl?null:j.principalControl.setValue(null)}),e._uU(5),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(2),e.Oqu(s.text.principal.createNewPlaceholder),e.xp6(1),e.hij(" ",s.principal.name," "),e.xp6(2),e.Oqu(s.text.principal.change)}}function Hl(g,o){if(1&g&&(e.TgZ(0,"div",21),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.principal.required[s.type]," ")}}function zl(g,o){if(1&g&&e._UZ(0,"op-dynamic-form",22),2&g){const s=e.oxw();e.Q6J("dynamicFormGroup",s.dynamicFieldsControl)("settings",s.userDynamicFieldConfig)("formUrl",s.apiV3Service.users.form.path)("handleSubmit",!1)}}function Kl(g,o){if(1&g&&(e.TgZ(0,"div",21),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.role.required," ")}}function Gl(g,o){if(1&g&&(e.TgZ(0,"op-form-field",23),e.TgZ(1,"textarea",24,25),e._uU(3,"      "),e.qZA(),e.TgZ(4,"p",26),e._uU(5),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.Q6J("label",s.text.message.label),e.xp6(1),e.Q6J("formControl",s.messageControl),e.xp6(4),e.hij(" ",s.text.message.description()," ")}}rs.\u0275fac=function(o){return new(o||rs)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(R.T),e.Y36(Nn.S),e.Y36(sa.a))},rs.\u0275cmp=e.Xpm({type:rs,selectors:[["op-ium-principal-search"]],inputs:{principalControl:["opFormBinding","principalControl"],type:"type",project:"project"},outputs:{createNew:"createNew"},features:[e.qOj],decls:7,vars:10,consts:[["appendTo",".spot-modal-overlay","bindValue","principal",3,"formControl","addTag","typeahead","items","clearable","clearOnBackspace","clearSearchOnAdd","compareWith"],["ngselect",""],["ng-label-tmp",""],["ng-option-tmp",""],["ng-notfound-tmp",""],["ng-tag-tmp",""],["class","ng-option-label",4,"ngIf"],[1,"ng-option-label"],[3,"ngOptionHighlight"],["class","ellipsis",4,"ngIf"],[1,"ellipsis"],[1,"ng-option","disabled"],[4,"ngIf"],["icon-classes","icon-mail1 icon-context"],["icon-classes","icon-add icon-context"]],template:function(o,s){1&o&&(e.TgZ(0,"ng-select",0,1),e.ALo(2,"async"),e.YNc(3,Fl,1,1,"ng-template",2),e.YNc(4,Ll,1,1,"ng-template",3),e.YNc(5,Bl,2,1,"ng-template",4),e.YNc(6,Jl,4,6,"ng-template",5),e.qZA()),2&o&&e.Q6J("formControl",s.principalControl)("addTag",!!s.showAddTag&&s.createNewFromInput.bind(s))("typeahead",s.input$)("items",e.lcZ(2,8,s.items$))("clearable",!0)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("compareWith",s.compareWith)},directives:[zi.w9,d.JJ,d.oH,zi.bb,zi.Z2,zi.vM,zi.N6,D.O5,oa.s,Ye.o],pipes:[D.Ov],encapsulation:2});class as{constructor(o,s,w,j){this.I18n=o,this.httpClient=s,this.apiV3Service=w,this.cdRef=j,this.messageData="",this.close=new e.vpe,this.save=new e.vpe,this.back=new e.vpe,this.PrincipalType=ui.e,this.text={principal:{title:()=>this.I18n.t("js.invite_user_modal.title.invite"),label:{User:this.I18n.t("js.invite_user_modal.principal.label.name_or_email"),PlaceholderUser:this.I18n.t("js.invite_user_modal.principal.label.name"),Group:this.I18n.t("js.invite_user_modal.principal.label.name"),Email:this.I18n.t("js.label_email")},change:this.I18n.t("js.label_change"),inviteUser:this.I18n.t("js.invite_user_modal.principal.invite_user"),createNewPlaceholder:this.I18n.t("js.invite_user_modal.principal.create_new_placeholder"),required:{User:this.I18n.t("js.invite_user_modal.principal.required.user"),PlaceholderUser:this.I18n.t("js.invite_user_modal.principal.required.placeholder"),Group:this.I18n.t("js.invite_user_modal.principal.required.group")},backButton:this.I18n.t("js.invite_user_modal.back"),nextButton:this.I18n.t("js.invite_user_modal.principal.next_button"),cancelButton:this.I18n.t("js.button_cancel")},role:{label:()=>{var ee;return this.I18n.t("js.invite_user_modal.role.label",{project:null===(ee=this.project)||void 0===ee?void 0:ee.name})},description:()=>{var ee;return this.I18n.t("js.invite_user_modal.role.description",{principal:null===(ee=this.principal)||void 0===ee?void 0:ee.name})},required:this.I18n.t("js.invite_user_modal.role.required")},message:{label:this.I18n.t("js.invite_user_modal.message.label"),description:()=>{var ee;return this.I18n.t("js.invite_user_modal.message.description",{principal:null===(ee=this.principal)||void 0===ee?void 0:ee.name})}}},this.principalForm=new d.cw({principal:new d.NI(null,[d.kI.required]),userDynamicFields:new d.cw({}),role:new d.NI(null,[d.kI.required]),message:new d.NI("")}),this.userDynamicFieldConfig={payload:null,schema:null}}get messageControl(){return this.principalForm.get("message")}get roleControl(){return this.principalForm.get("role")}get principalControl(){return this.principalForm.get("principal")}get principal(){var o;return null===(o=this.principalControl)||void 0===o?void 0:o.value}get role(){var o;return null===(o=this.roleControl)||void 0===o?void 0:o.value}get message(){var o;return null===(o=this.messageControl)||void 0===o?void 0:o.value}get dynamicFieldsControl(){return this.principalForm.get("userDynamicFields")}get customFields(){var o;return null===(o=this.dynamicFieldsControl)||void 0===o?void 0:o.value}get hasPrincipalSelected(){return!!this.principal}get textLabel(){return this.type===ui.e.User&&this.isNewPrincipal?this.text.principal.label.Email:this.text.principal.label[this.type]}get isNewPrincipal(){return this.hasPrincipalSelected&&!(this.principal instanceof vo.X)}get isMemberOfCurrentProject(){var o,s,w,j;return!!(null===(j=null===(w=null===(s=null===(o=this.principalControl)||void 0===o?void 0:o.value)||void 0===s?void 0:s.memberships)||void 0===w?void 0:w.elements)||void 0===j?void 0:j.find(ee=>ee.project.id===this.project.id))}ngOnInit(){var o,s,w;if(null===(o=this.principalControl)||void 0===o||o.setValue(this.principalData.principal),null===(s=this.roleControl)||void 0===s||s.setValue(this.roleData),null===(w=this.messageControl)||void 0===w||w.setValue(this.messageData),this.type===ui.e.User){const j=this.isNewPrincipal?this.principalData.customFields:{};this.apiV3Service.users.form.post(j).pipe((0,ta.take)(1),(0,Yt.U)(ee=>ee.$source)).subscribe(ee=>{var me,De,g;this.userDynamicFieldConfig.schema=(g=null===(me=ee._embedded)||void 0===me?void 0:me.schema,Object.keys(g).reduce((o,s)=>s.startsWith("customField")&&g[s].required?Object.assign(Object.assign({},o),{[s]:g[s]}):o,{})),this.userDynamicFieldConfig.payload=null===(De=ee._embedded)||void 0===De?void 0:De.payload,this.cdRef.detectChanges()})}}createNewFromInput(o){var s;null===(s=this.principalControl)||void 0===s||s.setValue(o)}onSubmit(o){o.preventDefault(),this.dynamicForm?this.dynamicForm.validateForm().subscribe(()=>{this.onValidatedSubmit()}):this.onValidatedSubmit()}onValidatedSubmit(){if(this.principalForm.invalid)return;const o=this.userDynamicFieldConfig.schema||{},s=Object.keys(o).reduce((w,j)=>{const ee=o[j];let me=this.customFields[j];return"_links"===ee.location&&(me=Array.isArray(me)?me.map(De=>De._links?De._links.self:De):me._links?me._links.self:me),w=Object.assign(Object.assign({},w),{[j]:me})},{});this.save.emit({principalData:{customFields:s,principal:this.principal},isAlreadyMember:this.isMemberOfCurrentProject,role:this.role,message:this.message})}}as.\u0275fac=function(o){return new(o||as)(e.Y36(y.D),e.Y36(vi.eN),e.Y36(R.T),e.Y36(e.sBO))},as.\u0275cmp=e.Xpm({type:as,selectors:[["op-ium-principal"]],viewQuery:function(o,s){if(1&o&&e.Gf(ia.r,5),2&o){let w;e.iGM(w=e.CRH())&&(s.dynamicForm=w.first)}},inputs:{principalData:"principalData",project:"project",type:"type",roleData:"roleData",messageData:"messageData"},outputs:{close:"close",save:"save",back:"back"},decls:26,vars:16,consts:[[3,"formGroup","ngSubmit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["required","",3,"label"],["slot","input",3,"opFormBinding","type","project","createNew",4,"ngIf"],["slot","input",4,"ngIf"],["slot","errors","class","op-form-field--error",4,"ngIf"],[3,"dynamicFormGroup","settings","formUrl","handleSubmit",4,"ngIf"],["slot","input",3,"opFormBinding"],["slot","help-text",1,"op-form-field--description",3,"innerHtml"],[3,"label",4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],["icon-classes","button--icon icon-arrow-left1"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","-highlight","spot-action-bar--action"],["slot","input",3,"opFormBinding","type","project","createNew"],["slot","input"],["type","button",1,"spot-link",3,"click"],["slot","errors",1,"op-form-field--error"],[3,"dynamicFormGroup","settings","formUrl","handleSubmit"],[3,"label"],["slot","input",1,"op-input","op-ium-invite-message-field",3,"formControl"],["input",""],["slot","help-text",1,"op-form-field--description"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(j){return s.onSubmit(j)}),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"op-form-field",4),e.YNc(6,Yl,1,3,"op-ium-principal-search",5),e.YNc(7,$l,6,3,"p",6),e.YNc(8,Vl,6,3,"p",6),e.YNc(9,Hl,2,1,"div",7),e.qZA(),e.YNc(10,zl,1,4,"op-dynamic-form",8),e.TgZ(11,"op-form-field",4),e._UZ(12,"op-ium-role-search",9),e._UZ(13,"p",10),e.YNc(14,Kl,2,1,"div",7),e.qZA(),e.YNc(15,Gl,6,3,"op-form-field",11),e.qZA(),e.TgZ(16,"div",12),e.TgZ(17,"div",13),e.TgZ(18,"button",14),e.NdJ("click",function(){return s.back.emit()}),e._UZ(19,"op-icon",15),e._uU(20),e.qZA(),e.qZA(),e.TgZ(21,"div",16),e.TgZ(22,"button",14),e.NdJ("click",function(){return s.close.emit()}),e._uU(23),e.qZA(),e.TgZ(24,"button",17),e._uU(25),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("formGroup",s.principalForm),e.xp6(2),e.Oqu(s.text.principal.title()),e.xp6(3),e.Q6J("label",s.textLabel),e.xp6(1),e.Q6J("ngIf",!(s.hasPrincipalSelected&&s.isNewPrincipal)),e.xp6(1),e.Q6J("ngIf",s.isNewPrincipal&&s.type===s.PrincipalType.User),e.xp6(1),e.Q6J("ngIf",s.isNewPrincipal&&s.type===s.PrincipalType.Placeholder),e.xp6(1),e.Q6J("ngIf",null==s.principalControl?null:s.principalControl.invalid),e.xp6(1),e.Q6J("ngIf",s.isNewPrincipal&&s.type===s.PrincipalType.User&&s.userDynamicFieldConfig.schema),e.xp6(1),e.Q6J("label",s.text.role.label()),e.xp6(1),e.Q6J("opFormBinding",s.roleControl),e.xp6(1),e.Q6J("innerHtml",s.text.role.description(),e.oJD),e.xp6(1),e.Q6J("ngIf",null==s.roleControl?null:s.roleControl.invalid),e.xp6(1),e.Q6J("ngIf",s.type!==s.PrincipalType.Placeholder),e.xp6(5),e.hij(" ",s.text.principal.backButton," "),e.xp6(3),e.hij(" ",s.text.principal.cancelButton," "),e.xp6(2),e.Oqu(s.text.principal.nextButton))},directives:[d._Y,d.JL,d.sg,wr.V,D.O5,ss,Jn,Ye.o,rs,ia.r,d.Fj,d.JJ,d.oH],styles:[".op-ium-invite-message-field[_ngcontent-%COMP%]{height:8em}"],changeDetection:0});var Xl=t(67202);function ed(g,o){if(1&g&&(e.TgZ(0,"op-form-field",4),e.TgZ(1,"p",14),e._uU(2),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.Q6J("label",s.text.messageLabel),e.xp6(2),e.Oqu(s.message)}}class cs{constructor(o,s,w){this.I18n=o,this.elementRef=s,this.api=w,this.message="",this.close=new e.vpe,this.back=new e.vpe,this.save=new e.vpe,this.PrincipalType=ui.e,this.text={title:()=>this.I18n.t("js.invite_user_modal.title.invite"),projectLabel:this.I18n.t("js.invite_user_modal.project.label"),principalLabel:{User:this.I18n.t("js.invite_user_modal.principal.label.name_or_email"),PlaceholderUser:this.I18n.t("js.invite_user_modal.principal.label.name"),Group:this.I18n.t("js.invite_user_modal.principal.label.name")},roleLabel:()=>{var j;return this.I18n.t("js.invite_user_modal.role.label",{project:null===(j=this.project)||void 0===j?void 0:j.name})},messageLabel:this.I18n.t("js.invite_user_modal.message.label"),backButton:this.I18n.t("js.invite_user_modal.back"),cancelButton:this.I18n.t("js.invite_user_modal.summary.cancel_button"),nextButton:()=>this.I18n.t("js.invite_user_modal.summary.next_button",{type:this.type,principal:this.principal})}}get principal(){return this.principalData.principal}invite(){return(0,eo.of)(this.principalData).pipe((0,H.w)(o=>this.createPrincipal(o)),(0,H.w)(o=>this.api.memberships.post({principal:o,project:this.project,roles:[this.role],notificationMessage:{raw:this.message}}).pipe((0,Xl.h)(o))))}createPrincipal(o){const{principal:s,customFields:w}=o;if(s instanceof vo.X)return(0,eo.of)(s);switch(this.type){case ui.e.User:return this.api.users.post(Object.assign({email:s.name,status:"invited"},w));case ui.e.Placeholder:return this.api.placeholder_users.post({name:s.name});default:throw new Error("Unsupported PrincipalType given")}}onSubmit(o){o.preventDefault(),this.invite().subscribe(s=>this.save.emit({principal:s}))}}cs.\u0275fac=function(o){return new(o||cs)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(R.T))},cs.\u0275cmp=e.Xpm({type:cs,selectors:[["op-ium-summary"]],inputs:{type:"type",project:"project",role:"role",principalData:"principalData",message:"message"},outputs:{close:"close",back:"back",save:"save"},decls:26,vars:11,consts:[["name","sendUserInviteForm",1,"op-ium-summary",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[3,"label"],["slot","input"],[1,"op-ium-summary__row"],[3,"label",4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],["icon-classes","button--icon icon-arrow-left1"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","-highlight","spot-action-bar--action"],["slot","input",1,"op-ium-summary-message"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.NdJ("submit",function(j){return s.onSubmit(j)}),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"op-form-field",4),e.TgZ(6,"p",5),e._uU(7),e.qZA(),e.qZA(),e.TgZ(8,"div",6),e.TgZ(9,"op-form-field",4),e.TgZ(10,"p",5),e._uU(11),e.qZA(),e.qZA(),e.TgZ(12,"op-form-field",4),e.TgZ(13,"p",5),e._uU(14),e.qZA(),e.qZA(),e.qZA(),e.YNc(15,ed,3,2,"op-form-field",7),e.qZA(),e.TgZ(16,"div",8),e.TgZ(17,"div",9),e.TgZ(18,"button",10),e.NdJ("click",function(){return s.back.emit()}),e._UZ(19,"op-icon",11),e._uU(20),e.qZA(),e.qZA(),e.TgZ(21,"div",12),e.TgZ(22,"button",10),e.NdJ("click",function(){return s.close.emit()}),e._uU(23),e.qZA(),e.TgZ(24,"button",13),e._uU(25),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title()),e.xp6(3),e.Q6J("label",s.text.projectLabel),e.xp6(2),e.Oqu(s.project.name),e.xp6(2),e.Q6J("label",s.text.principalLabel[s.type]),e.xp6(2),e.Oqu(null==s.principal?null:s.principal.name),e.xp6(1),e.Q6J("label",s.text.roleLabel()),e.xp6(2),e.Oqu(s.role.name),e.xp6(1),e.Q6J("ngIf",s.type!==s.PrincipalType.Placeholder&&s.message),e.xp6(5),e.hij(" ",s.text.backButton," "),e.xp6(3),e.Oqu(s.text.cancelButton),e.xp6(2),e.Oqu(s.text.nextButton()))},directives:[d._Y,d.JL,d.F,wr.V,D.O5,Ye.o],styles:[".op-ium-summary-message[_ngcontent-%COMP%]{white-space:pre-wrap}"],changeDetection:0});var Pr=t(97656);class ls{constructor(o,s){this.I18n=o,this.elementRef=s,this.close=new e.vpe,this.PrincipalType=ui.e,this.user_image=(0,Pr.h)("invite-user-modal/successful-invite.svg"),this.placeholder_image=(0,Pr.h)("invite-user-modal/placeholder-added.svg"),this.text={title:()=>this.I18n.t("js.invite_user_modal.success.title",{principal:this.createdNewPrincipal?this.principal.email:this.principal.name}),description:{User:()=>{var w;return this.I18n.t("js.invite_user_modal.success.description.user",{project:null===(w=this.project)||void 0===w?void 0:w.name})},PlaceholderUser:()=>{var w;return this.I18n.t("js.invite_user_modal.success.description.placeholder",{project:null===(w=this.project)||void 0===w?void 0:w.name})},Group:()=>{var w;return this.I18n.t("js.invite_user_modal.success.description.group",{project:null===(w=this.project)||void 0===w?void 0:w.name})}},nextButton:this.I18n.t("js.invite_user_modal.success.next_button")}}}ls.\u0275fac=function(o){return new(o||ls)(e.Y36(y.D),e.Y36(e.SBq))},ls.\u0275cmp=e.Xpm({type:ls,selectors:[["op-ium-success"]],inputs:{principal:"principal",project:"project",type:"type",createdNewPrincipal:"createdNewPrincipal"},outputs:{close:"close"},decls:8,vars:4,consts:[[1,"op-ium-success"],[1,"spot-modal--body","spot-container","op-ium-success--content"],[3,"src"],[3,"textContent"],["type","button",1,"button","-highlight",3,"click"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"img",2),e._UZ(3,"h1",3),e._UZ(4,"p",3),e.TgZ(5,"p"),e.TgZ(6,"button",4),e.NdJ("click",function(){return s.close.emit()}),e._uU(7),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Q6J("src",s.type===s.PrincipalType.Placeholder?s.placeholder_image:s.user_image,e.LSH),e.xp6(1),e.Q6J("textContent",s.text.title()),e.xp6(1),e.Q6J("textContent",s.text.description[s.type]()),e.xp6(3),e.Oqu(s.text.nextButton))},styles:[".op-ium-success[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.op-ium-success--content[_ngcontent-%COMP%]{justify-content:center;align-items:center;text-align:center}"]});class Co{}Co.\u0275fac=function(o){return new(o||Co)},Co.\u0275mod=e.oAB({type:Co}),Co.\u0275inj=e.cJS({providers:[wl.j,{provide:e.ip1,useFactory:function(g){return function(){g.get(go).setupListener()}},deps:[e.zs3],multi:!0}],imports:[[D.ez,n.H,C.K,zi.A0,d.UX,vl.Ky,yl.r,ea.Y,Cl.H],ea.Y]}),e.B6R(ui.E,[D.O5,os,Kr.mK,as,cs,ls],[]);class Yn{constructor(o,s){this.injector=o,this.i18n=s,window.navigator.userAgent.search("Revit")>-1&&(this.labelText=s.t("js.revit.revit_add_in_settings"),this.groupLabelText=s.t("js.revit.revit_add_in"),this.addUserMenuItem(),this.addLoginMenuItem())}addUserMenuItem(){const o=document.getElementById("user-menu");if(o){const s=document.createElement("li");s.dataset.name=this.labelText,s.innerHTML=`\n        <a class="revit-addin-settings-menu-item ellipsis" title="${this.labelText}" href="#">\n          <span class="menu-item--title ellipsis ">${this.labelText}</span>\n        </a>\n      `,s.addEventListener("click",()=>this.goToSettings()),o.appendChild(s)}}addLoginMenuItem(){const o=document.querySelector("#nav-login-content");if(o){const s=document.createElement("div");s.dataset.name=this.labelText,s.innerHTML=`\n        <div class="login-auth-providers">\n          <h3 class="login-auth-providers-title">\n            <span>\n              ${this.groupLabelText}\n            </span>\n           </h3>\n          <div class="login-auth-provider-list revit-add-in-button">\n            <div class="auth-provider auth-provider-developer button">\n              <span class="auth-provider-name">${this.labelText}</span>\n            </div>\n          </div>\n        </div>\n      `,o.appendChild(s),o.querySelector(".revit-add-in-button").addEventListener("click",()=>this.goToSettings())}}goToSettings(){window.RevitBridge.sendMessageToRevit("GoToSettings","1","")}}Yn.\u0275fac=function(o){return new(o||Yn)(e.LFG(e.zs3),e.LFG(y.D))},Yn.\u0275prov=e.Yz7({token:Yn,factory:Yn.\u0275fac});var xr=t(76825),$n=t(14808),ds=t(18869);class ji{constructor(o,s,w,j){this.I18n=o,this.http=s,this.pathHelper=w,this.toastService=j,this.userData$=(0,$n.qH)(),this.modalOpen=!1,this.cancelled=!1,this.emailInvalid=!1,this.text={invalid_email:this.I18n.t("js.admin.enterprise.trial.form.invalid_email"),taken_email:this.I18n.t("js.admin.enterprise.trial.form.taken_email"),taken_domain:this.I18n.t("js.admin.enterprise.trial.form.taken_domain")};const{gon:ee}=window;this.baseUrlAugur=ee.augur_url,this.tokenVersion=ee.token_version,window.gon.ee_trial_key&&this.setMailSubmittedStatus()}sendForm(o){const s=Object.assign(Object.assign({},o.value),{token_version:this.tokenVersion});this.http.post(`${this.baseUrlAugur}/public/v1/trials`,s,{headers:{[ds.i]:"true"}}).toPromise().then(w=>{this.userData$.putValue(o.value),this.cancelled=!1,this.trialLink=w._links.self.href,this.saveTrialKey(this.trialLink),this.retryConfirmation()}).catch(w=>{422===w.status||400===w.status?this.error=w:this.toastService.addWarning(w.error.description||I18n.t("js.error.internal"))})}getToken(){this.http.get(this.trialLink,{headers:{[ds.i]:"true"}}).toPromise().then(o=>(0,se.mG)(this,void 0,void 0,function*(){this.confirmed=!0,o.token_retrieved||(yield this.saveToken(o.token))})).catch(o=>{422===o.status&&"waiting_for_email_verification"===o.error.identifier?(this.resendLink=o.error._links.resend.href,(!this.status||this.cancelled)&&this.saveTrialKey(this.resendLink),this.setMailSubmittedStatus(),this.confirmed=!1):"Error"===_.get(o,"error._type")?this.toastService.addError(o.error.message):this.toastService.addError(o.error||I18n.t("js.error.internal"))})}saveTrialKey(o){const s=o.split("/")[6];return this.http.post(`${this.pathHelper.appBasePath}/admin/enterprise/save_trial_key`,{trial_key:s},{withCredentials:!0}).toPromise().catch(w=>{this.toastService.addError(w.error.message||w.message||w)})}saveToken(o){return this.http.post(`${this.pathHelper.appBasePath}/admin/enterprise`,{enterprise_token:{encoded_token:o}},{withCredentials:!0}).toPromise().then(()=>{this.modalOpen||setTimeout(()=>{window.location.reload()},500)}).catch(s=>{this.http.delete(`${this.pathHelper.api.v3.apiV3Base}/admin/enterprise/delete_trial_key`,{withCredentials:!0}).toPromise(),this.toastService.addError(s.error.description||I18n.t("js.error.internal"))})}retryConfirmation(o=5e3,s=60){this.cancelled||this.confirmed||(0===s?this.cancelled=!0:(this.getToken(),setTimeout(()=>{this.retryConfirmation(o,s-1)},o)))}setStartTrialStatus(){this.status="startTrial"}setMailSubmittedStatus(){this.status="mailSubmitted"}get trialStarted(){return"startTrial"===this.status}get mailSubmitted(){return"mailSubmitted"===this.status}get domainTaken(){return!!this.error&&"domain_taken"===this.error.error.identifier}get emailTaken(){return!!this.error&&"user_already_created_trial"===this.error.error.identifier}get emailError(){return!!this.emailInvalid||!!this.error&&this.emailTaken}get errorMsg(){let o="";return this.emailInvalid?o=this.text.invalid_email:this.domainTaken?o=this.text.taken_domain:this.emailTaken&&(o=this.text.taken_email),o}}ji.\u0275fac=function(o){return new(o||ji)(e.LFG(y.D),e.LFG(vi.eN),e.LFG(je.j),e.LFG(M.kl))},ji.\u0275prov=e.Yz7({token:ji,factory:ji.\u0275fac});class yo{}yo.\u0275fac=function(o){return new(o||yo)},yo.\u0275mod=e.oAB({type:yo}),yo.\u0275inj=e.cJS({providers:[ji],imports:[[n.H,C.K,d.u5,d.UX]]});class yn{constructor(){this.navigationEvents$=new S.X("")}onActivate(...o){return this.navigationEvents$.pipe((0,Gt.h)(s=>-1!==o.indexOf(s)),(0,fn.q)(1))}recreateToggler(){const o=this;jQuery("#main-menu .toggler").remove();const s=jQuery('<a class="toggler" href="#"><i class="icon6 icon-toggler icon-arrow-right3" aria-hidden="true"></i><span class="hidden-for-sighted"></span></a>').on("click",function(){const w=jQuery(this);if(w.hasClass("toggler")){jQuery("#sidebar").toggleClass("-hidden",!0),jQuery(".menu_root li").removeClass("open"),jQuery(".menu_root").removeClass("open").addClass("closed");const j=w.closest("li");j.addClass("open").find("li > a:first, .tree-menu--title:first").first().focus(),o.navigationEvents$.next(j.data("name"))}return!1});return s.attr("title",I18n.t("js.project_menu_details")),s}wrapMainItem(){const o=jQuery("#main-menu li > a").not("ul ul a");o.wrap(s=>{const j=o[s].id,ee=jQuery('<div class="main-item-wrapper"/>');return j&&ee.attr("id",`${j}-wrapper`),ee})}register(){this.wrapMainItem();const o=document.querySelector(".tree-menu--item.-selected")||document.querySelector(".main-item-wrapper a.selected");null==o||o.scrollIntoView();const s=this.recreateToggler(),w=jQuery("#main-menu .menu_root > li.open").data("name"),j=jQuery("#main-menu .menu_root.open > li").data("name");function ee(me){me.preventDefault();const De=jQuery(this);jQuery(De).parents("li").first().removeClass("open"),jQuery(".menu_root").removeClass("closed").addClass("open"),De.parents("li").first().find(".toggler").first().focus(),jQuery("#sidebar").toggleClass("-hidden",!1)}(w||j)&&this.navigationEvents$.next(w||j),jQuery("#main-menu li:has(ul) .main-item-wrapper > a").not("ul ul a").unbind("click").wrapInner('<span class="ellipsis"/>').after(s),jQuery("#main-menu ul.main-menu--children").each((me,De)=>{const Je=jQuery(De).parents("li").find(".main-item-wrapper .op-menu--item-title").contents()[0].textContent,qe=jQuery(De).parents("li").find(".main-item-wrapper > a").attr("href"),Et=jQuery('<div class="main-menu--children-menu-header"></div>'),At=jQuery('<a class="main-menu--arrow-left-to-project" href="#"><i class="icon-arrow-left1" aria-hidden="true"></i></a>'),ci=jQuery(`<a href="${qe}" class="main-menu--parent-node ellipsis">${Je}</a>`);At.attr("title",I18n.t("js.label_up")),At.on("click",ee),Et.append(At),Et.append(ci),jQuery(De).before(Et)}),jQuery(".menu_root").hasClass("closed")&&jQuery("#sidebar").toggleClass("-hidden",!0)}}yn.\u0275fac=function(o){return new(o||yn)},yn.\u0275prov=e.Yz7({token:yn,factory:yn.\u0275fac,providedIn:"root"});var id=t(68853),nd=t(82267),dr=t(82503);class bn extends cr.j{constructor(o,s,w){super(o),this.documentElement=o,this.confirmDialog=s,this.I18n=w}showEEOnlyHint(){this.confirmDialog.confirm({text:{title:this.I18n.t("js.types.attribute_groups.upgrade_to_ee"),text:this.I18n.t("js.types.attribute_groups.upgrade_to_ee_text"),button_continue:this.I18n.t("js.types.attribute_groups.more_information"),button_cancel:this.I18n.t("js.types.attribute_groups.nevermind")}}).then(()=>{window.location.href="https://www.openproject.org/enterprise-edition/?utm_source=unknown&utm_medium=community-edition&utm_campaign=form-configuration"}).catch(()=>{})}}function od(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",2),e.NdJ("click",function(){return e.CHM(s),e.oxw().startEditing()}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("textContent",s.name)}}function sd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"input",3,4),e.NdJ("ngModelChange",function(j){e.CHM(s);return e.oxw().editedName=j})("blur",function(j){return e.CHM(s),e.oxw().saveEdition(j)})("keydown.escape",function(){return e.CHM(s),e.oxw().reset()})("keydown.enter",function(j){return e.CHM(s),e.oxw().saveEdition(j)}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("ngModel",s.editedName),e.uIk("placeholder",s.placeholder)}}bn.\u0275fac=function(o){return new(o||bn)(e.LFG(D.K0),e.LFG(Ze.D),e.LFG(y.D))},bn.\u0275prov=e.Yz7({token:bn,factory:bn.\u0275fac});class bo{constructor(o,s){this.bannerService=o,this.cdRef=s,this.placeholder="",this.onValueChange=new e.vpe,this.editing=!1}ngOnInit(){this.editedName=this.name,(!this.name||0===this.name.length)&&this.startEditing()}startEditing(){this.bannerService.conditional(()=>this.bannerService.showEEOnlyHint(),()=>{this.editing=!0})}saveEdition(o){return this.leaveEditingMode(),this.name=this.editedName.trim(),this.cdRef.detectChanges(),""!==this.name&&this.onValueChange.emit(this.name),o.preventDefault(),o.stopPropagation(),!1}reset(){this.editing=!1,this.editedName=this.name}leaveEditingMode(){null!=this.editedName&&this.editedName.trim().length>0&&(this.editing=!1)}}function rd(g,o){if(1&g&&e._UZ(0,"span",12),2&g){const s=e.oxw(2);e.Q6J("textContent",s.text.custom_field)}}function ad(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",7),e._UZ(1,"span",8),e.TgZ(2,"span",9),e._uU(3),e.YNc(4,rd,1,1,"span",10),e.qZA(),e.TgZ(5,"span",11),e.NdJ("click",function(){const ee=e.CHM(s).$implicit;return e.oxw().removeFromGroup(ee)}),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit;e.uIk("data-key",s.key),e.xp6(3),e.hij(" ",s.translation," "),e.xp6(1),e.Q6J("ngIf",s.is_cf)}}bo.\u0275fac=function(o){return new(o||bo)(e.Y36(bn),e.Y36(e.sBO))},bo.\u0275cmp=e.Xpm({type:bo,selectors:[["op-group-edit-in-place"]],inputs:{placeholder:"placeholder",name:"name"},outputs:{onValueChange:"onValueChange"},decls:2,vars:2,consts:[["class","group-edit-handler",3,"textContent","click",4,"ngIf"],["class","group-edit-in-place--input","type","text","opAutofocus","",3,"ngModel","ngModelChange","blur","keydown.escape","keydown.enter",4,"ngIf"],[1,"group-edit-handler",3,"textContent","click"],["type","text","opAutofocus","",1,"group-edit-in-place--input",3,"ngModel","ngModelChange","blur","keydown.escape","keydown.enter"],["nameInput",""]],template:function(o,s){1&o&&(e.YNc(0,od,1,1,"div",0),e.YNc(1,sd,2,2,"input",1)),2&o&&(e.Q6J("ngIf",!s.editing),e.xp6(1),e.Q6J("ngIf",s.editing))},directives:[D.O5,d.Fj,Vr.U,d.JJ,d.On],encapsulation:2,changeDetection:0});class ps{constructor(o,s){this.I18n=o,this.cdRef=s,this.deleteGroup=new e.vpe,this.removeAttribute=new e.vpe,this.text={custom_field:this.I18n.t("js.admin.type_form.custom_field")}}rename(o){this.group.name=o,delete this.group.key,this.cdRef.detectChanges()}removeFromGroup(o){this.group.attributes=this.group.attributes.filter(s=>s!==o),this.removeAttribute.emit(o)}}ps.\u0275fac=function(o){return new(o||ps)(e.Y36(y.D),e.Y36(e.sBO))},ps.\u0275cmp=e.Xpm({type:ps,selectors:[["op-type-form-attribute-group"]],inputs:{group:"group"},outputs:{deleteGroup:"deleteGroup",removeAttribute:"removeAttribute"},decls:7,vars:3,consts:[[1,"type-form-conf-group"],[1,"group-head"],[1,"group-handle","icon-drag-handle"],[1,"group-name",3,"name","onValueChange"],[1,"delete-group","icon-small","icon-close",3,"click"],["dragula","attributes",1,"attributes",3,"dragulaModel","dragulaModelChange"],["class","type-form-conf-attribute",4,"ngFor","ngForOf"],[1,"type-form-conf-attribute"],[1,"attribute-handle","icon-drag-handle"],[1,"attribute-name"],["class","attribute-cf-label",3,"textContent",4,"ngIf"],[1,"delete-attribute","icon-small","icon-close",3,"click"],[1,"attribute-cf-label",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"span",2),e.TgZ(3,"op-group-edit-in-place",3),e.NdJ("onValueChange",function(j){return s.rename(j)}),e.qZA(),e.TgZ(4,"span",4),e.NdJ("click",function(){return s.deleteGroup.emit()}),e.qZA(),e.qZA(),e.TgZ(5,"div",5),e.NdJ("dragulaModelChange",function(j){return s.group.attributes=j}),e.YNc(6,ad,6,3,"div",6),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("name",s.group.name),e.xp6(2),e.Q6J("dragulaModel",s.group.attributes),e.xp6(1),e.Q6J("ngForOf",s.group.attributes))},directives:[bo,dr.sW,D.sg,D.O5],encapsulation:2,changeDetection:0});var ra=t(74961),aa=t(35900),us=t(84032),cd=t(57597);function ld(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li",18),e.TgZ(1,"a",19),e._UZ(2,"op-icon",20),e._UZ(3,"span",6),e._UZ(4,"op-icon",21),e.qZA(),e.TgZ(5,"ul",22),e.TgZ(6,"li"),e.TgZ(7,"button",23),e.NdJ("click",function(){return e.CHM(s),e.oxw().createGroup("attribute","")}),e.qZA(),e.qZA(),e.TgZ(8,"li"),e.TgZ(9,"button",23),e.NdJ("click",function(){return e.CHM(s),e.oxw().addGroupAndOpenQuery()}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(3),e.Q6J("textContent",s.text.label_group),e.xp6(4),e.Q6J("textContent",s.text.add_group),e.xp6(2),e.Q6J("textContent",s.text.add_table)}}function dd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-type-form-attribute-group",26),e.NdJ("removeAttribute",function(j){return e.CHM(s),e.oxw(2).deactivateAttribute(j)})("deleteGroup",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw().deleteGroup(j)}),e.qZA()}if(2&g){const s=e.oxw().$implicit;e.Q6J("group",s)}}function pd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-type-form-query-group",27),e.NdJ("editQuery",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw().editQuery(j)})("deleteGroup",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw().deleteGroup(j)}),e.qZA()}if(2&g){const s=e.oxw().$implicit;e.Q6J("group",s)}}function ud(g,o){if(1&g&&(e.ynx(0),e.YNc(1,dd,1,1,"op-type-form-attribute-group",24),e.YNc(2,pd,1,1,"op-type-form-query-group",25),e.BQk()),2&g){const s=o.$implicit;e.xp6(1),e.Q6J("ngIf","attribute"===s.type),e.xp6(1),e.Q6J("ngIf","query"===s.type)}}function hd(g,o){if(1&g&&e._UZ(0,"span",32),2&g){const s=e.oxw(2);e.Q6J("textContent",s.text.custom_field)}}function _d(g,o){if(1&g&&(e.TgZ(0,"div",28),e._UZ(1,"span",29),e.TgZ(2,"span",30),e._uU(3),e.YNc(4,hd,1,1,"span",31),e.qZA(),e.qZA()),2&g){const s=o.$implicit;e.uIk("data-key",s.key),e.xp6(3),e.hij(" ",s.translation," "),e.xp6(1),e.Q6J("ngIf",s.is_cf)}}const ca="__empty";class wo extends si.N{constructor(o,s,w,j,ee,me,De,Je){super(),this.elementRef=o,this.I18n=s,this.Gon=w,this.dragula=j,this.confirmDialog=ee,this.toastService=me,this.externalRelationQuery=De,this.typeBanner=Je,this.text={drag_to_activate:this.I18n.t("js.admin.type_form.drag_to_activate"),reset:this.I18n.t("js.admin.type_form.reset_to_defaults"),label_group:this.I18n.t("js.label_group"),new_group:this.I18n.t("js.admin.type_form.new_group"),label_inactive:this.I18n.t("js.admin.type_form.inactive"),custom_field:this.I18n.t("js.admin.type_form.custom_field"),add_group:this.I18n.t("js.admin.type_form.add_group"),add_table:this.I18n.t("js.admin.type_form.add_table")},this.groups=[],this.inactives=[]}ngOnInit(){this.element=this.elementRef.nativeElement,this.no_filter_query=this.element.dataset.noFilterQuery,this.form=jQuery(this.element).closest("form"),this.submit=this.form.find(".form-configuration--save");let o=!1;this.form.on("submit",()=>{o=!0}),this.submit.on("mousedown",()=>(setTimeout(()=>{o||this.form.trigger("submit")},50),!0)),this.form.on("submit.typeformupdater",()=>(this.updateHiddenFields(),!0)),this.groupsDrake=this.dragula.createGroup("groups",{moves:(w,j,ee)=>ee.classList.contains("group-handle")}).drake,this.attributeDrake=this.dragula.createGroup("attributes",{moves:(w,j,ee)=>ee.classList.contains("attribute-handle")}).drake,this.groups=JSON.parse(this.element.dataset.activeGroups).filter(w=>(null==w?void 0:w.key)!==ca),this.inactives=JSON.parse(this.element.dataset.inactiveAttributes);const s=this;this.autoscroll=new aa.x([document.getElementById("content-wrapper")],{margin:25,maxSpeed:10,scrollWhenOutside:!0,autoScroll(){const w=s.groupsDrake&&s.groupsDrake.dragging,j=s.attributeDrake&&s.attributeDrake.dragging;return w||j}})}ngAfterViewInit(){const o=jQuery(this.elementRef.nativeElement).find(".toolbar-items");(0,cd.o)(o)}deactivateAttribute(o){this.updateInactives(this.inactives.concat(o))}addGroupAndOpenQuery(){const o=this.createGroup("query");this.editQuery(o)}editQuery(o){this.typeBanner.conditional(()=>this.typeBanner.showEEOnlyHint(),()=>{const s={"display-settings":I18n.t("js.work_packages.table_configuration.embedded_tab_disabled"),timelines:I18n.t("js.work_packages.table_configuration.embedded_tab_disabled")};this.externalRelationQuery.show({currentQuery:JSON.parse(o.query),callback:w=>o.query=JSON.stringify(w),disabledTabs:s})})}deleteGroup(o){this.typeBanner.conditional(()=>this.typeBanner.showEEOnlyHint(),()=>("attribute"===o.type&&this.updateInactives(this.inactives.concat(o.attributes)),this.groups=this.groups.filter(s=>s!==o),o))}createGroup(o,s=""){const w={type:o,name:s,key:null,query:this.no_filter_query,attributes:[]};return this.groups.unshift(w),w}resetToDefault(o){return this.confirmDialog.confirm({text:{title:this.I18n.t("js.types.attribute_groups.reset_title"),text:this.I18n.t("js.types.attribute_groups.confirm_reset"),button_continue:this.I18n.t("js.label_reset")}}).then(()=>{this.form.find("input#type_attribute_groups").val(JSON.stringify([])),this.form.off("submit.typeformupdater"),this.form.trigger("submit")}).catch(()=>{}),o.preventDefault(),!1}updateInactives(o){this.inactives=[...o].sort((s,w)=>s.translation.localeCompare(w.translation))}get emptyGroup(){return{type:"attribute",key:ca,name:"empty",attributes:[]}}updateHiddenFields(){const o=this.form.find(".admin-type-form--hidden-field");0===this.groups.length?o.val(JSON.stringify([this.emptyGroup])):o.val(JSON.stringify(this.groups))}}wo.\u0275fac=function(o){return new(o||wo)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(us.U),e.Y36(dr.pQ),e.Y36(Ze.D),e.Y36(M.kl),e.Y36(ra.Q),e.Y36(bn))},wo.\u0275cmp=e.Xpm({type:wo,selectors:[["admin-type-form-configuration"]],features:[e._Bn([bn]),e.qOj],decls:20,vars:8,consts:[[1,"toolbar-container","-with-dropdown"],[1,"toolbar","toolbar_empty-title"],[1,"toolbar-items"],[1,"toolbar-item"],["type","button -alt-highlight",1,"form-configuration--reset","button",3,"click"],["icon-classes","button--icon icon-undo"],[1,"button--text",3,"textContent"],["class","toolbar-item drop-down",4,"ngIf"],[1,"grid-block","wrap"],[1,"grid-content","small-12","medium-6"],["id","draggable-groups","dragula","groups",3,"dragulaModel","dragulaModelChange"],[4,"ngFor","ngForOf"],["id","type-form-conf-inactive-group"],[1,"group-head"],[1,"group-name",3,"textContent"],[1,"advice",3,"textContent"],["dragula","attributes",1,"attributes",3,"dragulaModel","dragulaModelChange"],["class","type-form-conf-attribute",4,"ngFor","ngForOf"],[1,"toolbar-item","drop-down"],["aria-haspopup","true",1,"form-configuration--add-group","button","-alt-highlight"],["icon-classes","button--icon icon-add"],["icon-classes","button--dropdown-indicator"],[1,"menu-drop-down-container"],["type","button",1,"menu-item","form-configuration--add-group",3,"textContent","click"],[3,"group","removeAttribute","deleteGroup",4,"ngIf"],[3,"group","editQuery","deleteGroup",4,"ngIf"],[3,"group","removeAttribute","deleteGroup"],[3,"group","editQuery","deleteGroup"],[1,"type-form-conf-attribute"],[1,"attribute-handle","icon-drag-handle"],[1,"attribute-name"],["class","attribute-cf-label",3,"textContent",4,"ngIf"],[1,"attribute-cf-label",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"ul",2),e.TgZ(3,"li",3),e.TgZ(4,"button",4),e.NdJ("click",function(j){return s.resetToDefault(j)}),e._UZ(5,"op-icon",5),e._UZ(6,"span",6),e.qZA(),e.qZA(),e.YNc(7,ld,10,3,"li",7),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",8),e.TgZ(9,"div",9),e.TgZ(10,"div",10),e.NdJ("dragulaModelChange",function(j){return s.groups=j}),e.YNc(11,ud,3,2,"ng-container",11),e.qZA(),e.qZA(),e.TgZ(12,"div",9),e.TgZ(13,"div",12),e.TgZ(14,"div",13),e._UZ(15,"span",14),e._uU(16," "),e._UZ(17,"span",15),e.qZA(),e.TgZ(18,"div",16),e.NdJ("dragulaModelChange",function(j){return s.inactives=j}),e.YNc(19,_d,5,3,"div",17),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(6),e.Q6J("textContent",s.text.reset),e.xp6(1),e.Q6J("ngIf",!s.typeBanner.eeShowBanners),e.xp6(3),e.Q6J("dragulaModel",s.groups),e.xp6(1),e.Q6J("ngForOf",s.groups),e.xp6(4),e.Q6J("textContent",s.text.label_inactive),e.xp6(2),e.Q6J("textContent",s.text.drag_to_activate),e.xp6(1),e.Q6J("dragulaModel",s.inactives),e.xp6(1),e.Q6J("ngForOf",s.inactives))},encapsulation:2});class hs{constructor(o,s){this.I18n=o,this.cdRef=s,this.text={edit_query:this.I18n.t("js.admin.type_form.edit_query")},this.editQuery=new e.vpe,this.deleteGroup=new e.vpe}rename(o){this.group.name=o,this.cdRef.detectChanges()}}hs.\u0275fac=function(o){return new(o||hs)(e.Y36(y.D),e.Y36(e.sBO))},hs.\u0275cmp=e.Xpm({type:hs,selectors:[["op-type-form-query-group"]],inputs:{group:"group"},outputs:{editQuery:"editQuery",deleteGroup:"deleteGroup"},decls:9,vars:2,consts:[[1,"type-form-conf-group","type-form-query-group"],[1,"group-head"],[1,"group-handle","icon-drag-handle"],[1,"group-name",3,"name","onValueChange"],[1,"delete-group","icon-small","icon-close",3,"click"],[1,"type-form-query"],[1,"type-form-query-group--edit-button",3,"click"],["icon-classes","button--icon icon-edit"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"span",2),e.TgZ(3,"op-group-edit-in-place",3),e.NdJ("onValueChange",function(j){return s.rename(j)}),e.qZA(),e.TgZ(4,"span",4),e.NdJ("click",function(){return s.deleteGroup.emit()}),e.qZA(),e.qZA(),e.TgZ(5,"div",5),e.TgZ(6,"span",6),e.NdJ("click",function(){return s.editQuery.emit()}),e._UZ(7,"op-icon",7),e._uU(8),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("name",s.group.name),e.xp6(5),e.hij(" ",s.text.edit_query," "))},directives:[bo,Ye.o],encapsulation:2,changeDetection:0});class To{}To.\u0275fac=function(o){return new(o||To)},To.\u0275mod=e.oAB({type:To}),To.\u0275inj=e.cJS({providers:[],imports:[[dr.qE.forRoot(),n.H]]}),e.B6R(wo,[Ye.o,D.O5,dr.sW,D.sg,ps,hs],[]);var gd=t(6496),pr=t(45410);class _s{constructor(o){this.elementRef=o,this.initialLoadingIndicator=!0,(0,pr.E)(this)}}_s.\u0275fac=function(o){return new(o||_s)(e.Y36(e.SBq))},_s.\u0275cmp=e.Xpm({type:_s,selectors:[["wp-embedded-table-entry"]],inputs:{queryProps:"queryProps",configuration:"configuration",initialLoadingIndicator:"initialLoadingIndicator"},decls:2,vars:3,consts:[["wp-isolated-query-space",""],[3,"queryProps","initialLoadingIndicator","configuration"]],template:function(o,s){1&o&&(e.ynx(0,0),e._UZ(1,"wp-embedded-table",1),e.BQk()),2&o&&(e.xp6(1),e.Q6J("queryProps",s.queryProps)("initialLoadingIndicator",s.initialLoadingIndicator)("configuration",s.configuration))},directives:[ve.A,Ri.Z],encapsulation:2});class ms{constructor(o){this.elementRef=o,this.configuration={actionsColumnEnabled:!1,columnMenuEnabled:!1,contextMenuEnabled:!1}}ngOnInit(){const o=this.elementRef.nativeElement;this.queryProps=JSON.parse(o.dataset.queryProps)}}ms.\u0275fac=function(o){return new(o||ms)(e.Y36(e.SBq))},ms.\u0275cmp=e.Xpm({type:ms,selectors:[["macro",8,"embedded-table"]],attrs:["class","embedded-table"],decls:1,vars:2,consts:[[3,"queryProps","configuration"]],template:function(o,s){1&o&&e._UZ(0,"wp-embedded-table-entry",0),2&o&&e.Q6J("queryProps",s.queryProps)("configuration",s.configuration)},directives:[_s],encapsulation:2});var la=t(87064),Er=t(90127);function Cd(g,o){if(1&g&&e._UZ(0,"wp-embedded-table",1),2&g){const s=e.oxw();e.Q6J("queryProps",s.queryProps)("configuration",s.tableConfiguration)}}class ko extends si.N{constructor(o,s,w,j,ee,me,De,Je,qe,Et,At){super(),this.FocusHelper=o,this.elementRef=s,this.renderer=w,this.I18n=j,this.halResourceService=ee,this.globalSearchService=me,this.wpTableFilters=De,this.querySpace=Je,this.wpFilters=qe,this.cdRef=Et,this.UrlParamsHelper=At,this.resultsHidden=!1,this.tableConfiguration={actionsColumnEnabled:!1,columnMenuEnabled:!0,contextMenuEnabled:!1,inlineCreateEnabled:!1,withFilters:!0,showFilterButton:!0,filterButtonText:this.I18n.t("js.button_advanced_filter")}}ngAfterViewInit(){(0,Ai.aj)([this.globalSearchService.searchTerm$,this.globalSearchService.projectScope$]).pipe((0,Zi.T)(1),(0,Hi.x)(),(0,lr.b)(10),this.untilDestroyed()).subscribe(([])=>{this.wpFilters.visible=!1,this.setQueryProps()}),this.globalSearchService.resultsHidden$.pipe(this.untilDestroyed()).subscribe(o=>this.resultsHidden=o)}ngOnInit(){this.setQueryProps()}setQueryProps(){const o=[];let s=["id","project","subject","type","status","updatedAt"];this.globalSearchService.searchTerm.length>0&&o.push({search:{operator:"**",values:[this.globalSearchService.searchTerm]}}),"current_project"===this.globalSearchService.projectScope&&(o.push({subprojectId:{operator:"!*",values:[]}}),s=["id","subject","type","status","updatedAt"]),""===this.globalSearchService.projectScope&&o.push({subprojectId:{operator:"*",values:[]}}),this.queryProps={"columns[]":s,filters:JSON.stringify(o),sortBy:JSON.stringify([["updatedAt","desc"]]),showHierarchies:!1}}}ko.\u0275fac=function(o){return new(o||ko)(e.Y36(Xr.i),e.Y36(e.SBq),e.Y36(e.Qsj),e.Y36(y.D),e.Y36(gt.u),e.Y36(Vi),e.Y36(Mi.Z),e.Y36(Ci.q),e.Y36(wi.U),e.Y36(e.sBO),e.Y36(mi.Z))},ko.\u0275cmp=e.Xpm({type:ko,selectors:[["global-search-work-packages"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"queryProps","configuration",4,"ngIf"],[3,"queryProps","configuration"]],template:function(o,s){1&o&&e.YNc(0,Cd,1,2,"wp-embedded-table",0),2&o&&e.Q6J("ngIf",!s.resultsHidden)},directives:[D.O5,Ri.Z],encapsulation:2});var bd=t(90547);function wd(g,o){if(1&g&&e._UZ(0,"option",6),2&g){const s=o.$implicit;e.Q6J("textContent",s.label)("ngValue",s)}}function Td(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"span",7),e.TgZ(1,"op-single-date-picker",8),e.NdJ("changed",function(j){return e.CHM(s),e.oxw().updateField(j)}),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("id",s.fieldId+"_visible")("name",s.fieldId+"_input")("initialDate",s.fieldValue)}}class gs{constructor(o,s,w,j){this.elementRef=o,this.cdRef=s,this.appRef=w,this.I18n=j,this.valueVisible=!1,this.onKey="on",this.currentKey="current",this.currentFieldValue="%CURRENT_DATE%",this.operators=[{key:this.onKey,label:this.I18n.t("js.custom_actions.date.specific")},{key:this.currentKey,label:this.I18n.t("js.custom_actions.date.current_date")}]}ngOnInit(){const o=this.elementRef.nativeElement;this.fieldName=o.dataset.fieldName,this.fieldValue=o.dataset.fieldValue,this.fieldValue===this.currentFieldValue?this.selectedOperator=this.operators[1]:(this.selectedOperator=this.operators[0],this.visibleValue=this.fieldValue),this.toggleValueVisibility()}toggleValueVisibility(){this.valueVisible=this.selectedOperator.key===this.onKey,this.fieldValue===this.currentFieldValue&&(this.fieldValue=""),this.updateDbValue()}updateDbValue(){this.selectedOperator.key===this.currentKey&&(this.fieldValue=this.currentFieldValue)}get fieldId(){return this.fieldName.replace(/\[|\]/g,"_").replace("__","_").replace(/_$/,"")}updateField(o){this.fieldValue=o,this.cdRef.detectChanges()}}gs.\u0275fac=function(o){return new(o||gs)(e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(e.z2F),e.Y36(y.D))},gs.\u0275cmp=e.Xpm({type:gs,selectors:[["custom-date-action-admin"]],decls:6,vars:6,consts:[[1,"form--field-container"],[1,"form--select-container"],[1,"form--select",3,"ngModel","ngModelChange","change"],[3,"textContent","ngValue",4,"ngFor","ngForOf"],["class","form--text-field-container -slim",4,"ngIf"],["type","hidden",3,"name","value"],[3,"textContent","ngValue"],[1,"form--text-field-container","-slim"],["classes","form--text-field",3,"id","name","initialDate","changed"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"span",1),e.TgZ(2,"select",2),e.NdJ("ngModelChange",function(j){return s.selectedOperator=j})("change",function(){return s.toggleValueVisibility()}),e.YNc(3,wd,1,2,"option",3),e.qZA(),e.qZA(),e.YNc(4,Td,2,3,"span",4),e._UZ(5,"input",5),e.qZA()),2&o&&(e.xp6(2),e.Q6J("ngModel",s.selectedOperator),e.uIk("id",s.fieldId),e.xp6(1),e.Q6J("ngForOf",s.operators),e.xp6(1),e.Q6J("ngIf",s.valueVisible),e.xp6(1),e.Q6J("name",s.fieldName)("value",s.fieldValue))},directives:[d.EJ,d.JJ,d.On,D.sg,D.O5,d.YN,d.Kr,bd.S],encapsulation:2});var Pd=t(3216),xd=t(56945);function Ed(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){return e.CHM(s),e.oxw().toggleCollapsed()}),e._UZ(1,"span",6),e._uU(2),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngClass",s.collapsed?"icon-arrow-down1":"icon-arrow-up1"),e.xp6(1),e.hij(" ",s.title,"\n")}}function Od(g,o){if(1&g&&(e.TgZ(0,"div",7),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.title,"\n")}}function Md(g,o){if(1&g&&e._UZ(0,"op-sidemenu",12),2&g){const s=e.oxw().$implicit;e.Q6J("title",s.title)("items",s.children)("collapsible",s.collapsible)}}function Id(g,o){1&g&&e.GkF(0)}const da=function(g){return{"op-sidemenu--item-action_with_icon":g}},pa=function(g){return{item:g}};function Sd(g,o){if(1&g&&(e.TgZ(0,"a",13),e.YNc(1,Id,1,0,"ng-container",14),e.qZA()),2&g){const s=e.oxw().$implicit;e.oxw();const w=e.MAs(5);e.Tol(e.VKq(8,da,!!s.icon)),e.Q6J("uiSref",s.uiSref)("uiParams",s.uiParams)("uiOptions",s.uiOptions),e.uIk("data-qa-selector","op-sidemenu--item-action--"+s.title.split(" ").join("")),e.xp6(1),e.Q6J("ngTemplateOutlet",w)("ngTemplateOutletContext",e.VKq(10,pa,s))}}function Dd(g,o){1&g&&e.GkF(0)}function Ad(g,o){if(1&g&&(e.TgZ(0,"a",15),e.YNc(1,Dd,1,0,"ng-container",14),e.qZA()),2&g){const s=e.oxw().$implicit;e.oxw();const w=e.MAs(5);e.Tol(e.VKq(6,da,!!s.icon)),e.Q6J("href",s.href,e.LSH),e.uIk("data-qa-selector","op-sidemenu--item-action--"+s.title.split(" ").join("")),e.xp6(1),e.Q6J("ngTemplateOutlet",w)("ngTemplateOutletContext",e.VKq(8,pa,s))}}function jd(g,o){if(1&g&&(e.TgZ(0,"li",8),e.YNc(1,Md,1,3,"op-sidemenu",9),e.YNc(2,Sd,2,12,"a",10),e.YNc(3,Ad,2,10,"a",11),e.qZA()),2&g){const s=o.$implicit;e.xp6(1),e.Q6J("ngIf",s.children&&s.children.length),e.xp6(1),e.Q6J("ngIf",!s.children&&s.uiSref),e.xp6(1),e.Q6J("ngIf",!s.children&&s.href)}}function Zd(g,o){if(1&g&&e._UZ(0,"span",19),2&g){const s=e.oxw().item;e.Tol("icon-"+s.icon)}}function Rd(g,o){if(1&g&&(e.TgZ(0,"span",20),e._uU(1),e.qZA()),2&g){const s=e.oxw().item;e.xp6(1),e.Oqu(s.count)}}function Fd(g,o){if(1&g&&(e.YNc(0,Zd,1,2,"span",16),e.TgZ(1,"span",17),e._uU(2),e.qZA(),e.YNc(3,Rd,2,1,"span",18)),2&g){const s=o.item;e.Q6J("ngIf",s.icon),e.xp6(2),e.Oqu(s.title),e.xp6(1),e.Q6J("ngIf",s.count)}}const Wd=function(g,o){return{"op-sidemenu--items_collapsed":g,"searchable-menu--search-ul":o}};class an{constructor(o,s,w){this.elementRef=o,this.cdRef=s,this.I18n=w,this.className=!0,this.items=[],this.collapsible=!1,this.searchable=!1,this.collapsed=!1}toggleCollapsed(){this.collapsed=!this.collapsed}}function Ld(g,o){if(1&g&&e._UZ(0,"op-sidemenu",4),2&g){const s=o.ngIf;e.Q6J("items",s)}}function Bd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){return e.CHM(s),e.oxw().showNewBoardModal()}),e._UZ(1,"span",6),e._UZ(2,"span",7),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.text.create_new_board),e.xp6(2),e.Q6J("textContent",s.text.board)}}an.\u0275fac=function(o){return new(o||an)(e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(y.D))},an.\u0275cmp=e.Xpm({type:an,selectors:[["op-sidemenu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-sidemenu",s.className)},inputs:{items:"items",title:"title",collapsible:"collapsible",searchable:"searchable"},decls:6,vars:7,consts:[["class","op-sidemenu--title","type","button",3,"click",4,"ngIf"],["class","op-sidemenu--title",4,"ngIf"],[1,"op-sidemenu--items",3,"ngClass"],["class","op-sidemenu--item","data-qa-selector","op-sidemenu--item",4,"ngFor","ngForOf"],["itemTemplate",""],["type","button",1,"op-sidemenu--title",3,"click"],["aria-hidden","true",1,"icon3","icon-small",3,"ngClass"],[1,"op-sidemenu--title"],["data-qa-selector","op-sidemenu--item",1,"op-sidemenu--item"],[3,"title","items","collapsible",4,"ngIf"],["class","op-sidemenu--item-action","uiSrefActive","op-sidemenu--item-action_active-child","uiSrefActiveEq","op-sidemenu--item-action_active",3,"class","uiSref","uiParams","uiOptions",4,"ngIf"],["class","op-sidemenu--item-action",3,"class","href",4,"ngIf"],[3,"title","items","collapsible"],["uiSrefActive","op-sidemenu--item-action_active-child","uiSrefActiveEq","op-sidemenu--item-action_active",1,"op-sidemenu--item-action",3,"uiSref","uiParams","uiOptions"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"op-sidemenu--item-action",3,"href"],["class","op-sidemenu--item-icon",3,"class",4,"ngIf"],[1,"op-sidemenu--item-title"],["class","op-bubble op-bubble_alt_highlighting",4,"ngIf"],[1,"op-sidemenu--item-icon"],[1,"op-bubble","op-bubble_alt_highlighting"]],template:function(o,s){1&o&&(e.YNc(0,Ed,3,2,"button",0),e.YNc(1,Od,2,1,"div",1),e.TgZ(2,"ul",2),e.YNc(3,jd,4,3,"li",3),e.qZA(),e.YNc(4,Fd,4,3,"ng-template",null,4,e.W1O)),2&o&&(e.Q6J("ngIf",s.title&&s.collapsible),e.xp6(1),e.Q6J("ngIf",s.title&&!s.collapsible),e.xp6(1),e.Q6J("ngClass",e.WLB(4,Wd,s.collapsed,s.searchable)),e.xp6(1),e.Q6J("ngForOf",s.items))},directives:[D.O5,D.mk,D.sg,an,Vt.AnchorUISref,Vt.UISrefActive,Vt.UISrefStatus,Vt.UISref,D.tP],styles:[".op-sidemenu[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:14px}.op-sidemenu--title[_ngcontent-%COMP%]{display:flex;background:transparent;color:var(--main-menu-fieldset-header-color);border:0;text-transform:uppercase;padding:8px 12px;margin-top:12px;font-size:12px;cursor:pointer}.op-sidemenu--title[_ngcontent-%COMP%]:hover{background:var(--main-menu-bg-hover-background);color:var(--main-menu-hover-font-color)}.op-sidemenu--items[_ngcontent-%COMP%]{list-style:none}.op-sidemenu--items_collapsed[_ngcontent-%COMP%]{display:none}.op-sidemenu--item-action[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--main-menu-font-color);padding:8px 12px 8px 32px}.op-sidemenu--item-action[_ngcontent-%COMP%]:hover{background:var(--main-menu-bg-hover-background);color:var(--main-menu-hover-font-color)}.op-sidemenu--item-action_active[_ngcontent-%COMP%]{background:var(--main-menu-bg-selected-background);color:var(--main-menu-selected-font-color)}.op-sidemenu--item-action_active-child[_ngcontent-%COMP%]{background:var(--main-menu-bg-selected-background);color:var(--main-menu-selected-font-color)}.op-sidemenu--item-action_with_icon[_ngcontent-%COMP%]{padding-left:12px}.op-sidemenu--item-title[_ngcontent-%COMP%]{margin-right:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:30px;text-decoration:none}.op-sidemenu--item-icon[_ngcontent-%COMP%]{font-size:24px;margin-right:8px}"],changeDetection:0});class fs extends si.N{constructor(o,s,w,j,ee,me,De,Je){super(),this.boardService=o,this.apiV3Service=s,this.currentProject=w,this.mainMenuService=j,this.currentUserService=ee,this.I18n=me,this.opModalService=De,this.injector=Je,this.className=!0,this.boardOptions$=this.apiV3Service.boards.observeAll().pipe((0,Yt.U)(qe=>qe.map(At=>({title:At.name,uiSref:"boards.partitioned.show",uiParams:{board_id:At.id,query_props:"",projects:"projects",projectPath:this.currentProject.identifier},uiOptions:{reload:!0}})).sort((At,ci)=>At.title.localeCompare(ci.title)))),this.canCreateBoards$=this.currentUserService.hasCapabilities$("boards/create",this.currentProject.id||void 0).pipe(this.untilDestroyed()),this.text={board:this.I18n.t("js.label_board"),create_new_board:this.I18n.t("js.boards.create_new")}}ngOnInit(){this.mainMenuService.onActivate("board_view").subscribe(()=>{this.focusBackArrow(),this.boardService.loadAllBoards()})}showNewBoardModal(){this.opModalService.show(xd.r,this.injector)}focusBackArrow(){jQuery('*[data-name="board_view"] .main-menu--arrow-left-to-project').focus()}}fs.\u0275fac=function(o){return new(o||fs)(e.Y36(Pd.$),e.Y36(R.T),e.Y36(b.R),e.Y36(yn),e.Y36(Nn.S),e.Y36(y.D),e.Y36(He.S),e.Y36(e.zs3))},fs.\u0275cmp=e.Xpm({type:fs,selectors:[["boards-menu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-sidebar",s.className)},features:[e.qOj],decls:6,vars:6,consts:[[1,"op-sidebar--body"],[3,"items",4,"ngIf"],[1,"op-sidebar--footer"],["class","button -alt-highlight","data-qa-selector","sidebar--create-board-button",3,"title","click",4,"ngIf"],[3,"items"],["data-qa-selector","sidebar--create-board-button",1,"button","-alt-highlight",3,"title","click"],[1,"spot-icon","spot-icon_add"],[3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Ld,1,1,"op-sidemenu",1),e.ALo(2,"async"),e.qZA(),e.TgZ(3,"div",2),e.YNc(4,Bd,3,2,"button",3),e.ALo(5,"async"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,s.boardOptions$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,4,s.canCreateBoards$)))},directives:[D.O5,an],pipes:[D.Ov],encapsulation:2});class vs{}vs.\u0275fac=function(o){return new(o||vs)},vs.\u0275cmp=e.Xpm({type:vs,selectors:[["global-search-work-packages-entry"]],decls:2,vars:0,consts:[["wp-isolated-query-space",""]],template:function(o,s){1&o&&(e.ynx(0,0),e._UZ(1,"global-search-work-packages"),e.BQk())},directives:[ve.A,ko],encapsulation:2});var Jd=t(43358),Yd=t(71435);const $d=["progressBar"],Vd=["progressPercentage"];function Hd(g,o){1&g&&e._UZ(0,"op-icon",8)}function zd(g,o){1&g&&e._UZ(0,"op-icon",9)}function Kd(g,o){if(1&g&&(e.TgZ(0,"span",5),e.YNc(1,Hd,1,0,"op-icon",6),e.YNc(2,zd,1,0,"op-icon",7),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",s.error),e.xp6(1),e.Q6J("ngIf",s.completed)}}class Cs extends si.N{constructor(o){super(),this.I18n=o,this.onError=new e.vpe,this.onSuccess=new e.vpe,this.error=!1,this.completed=!1}set value(o){this.progressBar.nativeElement.value=o,this.progressPercentage.nativeElement.innerText=`${o}%`,100===o&&(this.progressBar.nativeElement.style.display="none")}ngOnInit(){this.file=this.upload[0],this.upload[1].pipe(this.untilDestroyed()).subscribe(s=>{switch(s.type){case vi.dt.Sent:return this.value=5,(0,rn.qu)(`Uploading file "${this.file.name}" of size ${this.file.size}.`);case vi.dt.UploadProgress:return this.updateProgress(s);case vi.dt.Response:return(0,rn.qu)(`File ${this.fileName} was fully uploaded.`),this.value=100,this.completed=!0,this.onSuccess.emit()}},s=>this.handleError(s))}get fileName(){return this.file&&this.file.name}updateProgress(o){o.total?this.value=Math.round(o.loaded/o.total*100):this.value=10}handleError(o){this.error=!0,this.onError.emit(o)}}function Gd(g,o){1&g&&(e.TgZ(0,"div",8),e._UZ(1,"div",9),e._UZ(2,"div",10),e._UZ(3,"div",11),e._UZ(4,"div",12),e._UZ(5,"div",13),e.qZA())}function qd(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Gd,6,0,"div",6),e.ALo(2,"async"),e._UZ(3,"p",7),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,s.loading$)),e.xp6(2),e.Q6J("textContent",s.toast.message)}}function Xd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",15),e.NdJ("click",function(j){return e.CHM(s),e.oxw(2).executeTarget(j)}),e.qZA()}if(2&g){const s=e.oxw(2);e.Q6J("textContent",s.toast.link.text)}}function ep(g,o){if(1&g&&(e.TgZ(0,"p"),e._UZ(1,"span",7),e._UZ(2,"span",7),e.YNc(3,Xd,1,1,"a",14),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.toast.message),e.xp6(1),e.Q6J("textContent"," "),e.xp6(1),e.Q6J("ngIf",s.toast.link)}}function tp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"a",18),e.NdJ("click",function(){e.CHM(s);return e.oxw(2).show=!0}),e._UZ(2,"op-icon",19),e.qZA(),e.TgZ(3,"a",18),e.NdJ("click",function(){e.CHM(s);return e.oxw(2).show=!1}),e._UZ(4,"op-icon",20),e.qZA(),e._UZ(5,"span",7),e.qZA()}if(2&g){const s=e.oxw(2);e.xp6(1),e.Q6J("hidden",s.show),e.xp6(2),e.Q6J("hidden",!s.show),e.xp6(2),e.Q6J("textContent",s.uploadText)}}function ip(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-toasters-upload-progress",23),e.NdJ("onSuccess",function(){return e.CHM(s),e.oxw(3).onUploadSuccess()})("onError",function(){return e.CHM(s),e.oxw(3).remove()}),e.qZA()}if(2&g){const s=o.$implicit;e.Q6J("upload",s)}}function np(g,o){if(1&g&&(e.TgZ(0,"ul",21),e.YNc(1,ip,1,1,"op-toasters-upload-progress",22),e.qZA()),2&g){const s=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",s.data)}}Cs.\u0275fac=function(o){return new(o||Cs)(e.Y36(y.D))},Cs.\u0275cmp=e.Xpm({type:Cs,selectors:[["op-toasters-upload-progress"]],viewQuery:function(o,s){if(1&o&&(e.Gf($d,5),e.Gf(Vd,5)),2&o){let w;e.iGM(w=e.CRH())&&(s.progressBar=w.first),e.iGM(w=e.CRH())&&(s.progressPercentage=w.first)}},inputs:{upload:"upload"},outputs:{onError:"onError",onSuccess:"onSuccess"},features:[e.qOj],decls:8,vars:2,consts:[[1,"filename",3,"textContent"],["max","100","value","0"],["progressBar",""],["progressPercentage",""],["class","upload-completed",4,"ngIf"],[1,"upload-completed"],["icon-classes","icon-close",4,"ngIf"],["icon-classes","icon-checkmark",4,"ngIf"],["icon-classes","icon-close"],["icon-classes","icon-checkmark"]],template:function(o,s){1&o&&(e.TgZ(0,"li"),e._UZ(1,"span",0),e._UZ(2,"progress",1,2),e.TgZ(4,"p",null,3),e._uU(6,"0%"),e.qZA(),e.YNc(7,Kd,3,2,"span",4),e.qZA()),2&o&&(e.xp6(1),e.Q6J("textContent",s.fileName),e.xp6(6),e.Q6J("ngIf",s.completed||s.error))},directives:[D.O5,Ye.o],encapsulation:2});const op=function(g){return{"-hidden":g}};function sp(g,o){if(1&g&&(e.TgZ(0,"div"),e.YNc(1,tp,6,3,"div",2),e.TgZ(2,"div",16),e.YNc(3,np,2,1,"ul",17),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",s.canBeHidden),e.xp6(1),e.Q6J("ngClass",e.VKq(3,op,!s.show&&s.canBeHidden)),e.xp6(1),e.Q6J("ngIf",s.data&&s.data.length>0)}}function rp(g,o){1&g&&e._UZ(0,"div")}function ap(g,o){if(1&g&&e._UZ(0,"li",7),2&g){const s=o.$implicit;e.Q6J("textContent",s)}}function cp(g,o){if(1&g&&(e.TgZ(0,"div"),e.TgZ(1,"ul",24),e.YNc(2,ap,1,1,"li",25),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("ngForOf",s.data)}}function lp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){return e.CHM(s),e.oxw().remove()}),e._UZ(1,"op-icon",27),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.text.close_popup)}}class ys{constructor(o,s){this.I18n=o,this.toastService=s,this.text={close_popup:this.I18n.t("js.close_popup_title")},this.uploadCount=0,this.show=!1,this.canBeHidden=!1,this.removable=!0,this.loading$=new S.X(!1)}ngOnInit(){if(this.type=this.toast.type,this.removable=!["upload","loading"].includes(this.type),"upload"===this.type){const o=this.data;this.removable=!1,this.canBeHidden=o&&o.length>5}"loading"===this.type&&(this.removable=!1,this.loading$.next(!0),this.data.pipe((0,ta.take)(1),(0,Jd.V)(2e4),(0,Yd.x)(()=>{this.loading$.next(!1),this.remove()})).subscribe())}get data(){return this.toast.data}remove(){this.toastService.remove(this.toast)}executeTarget(){this.toast.link&&(this.toast.link.target(),this.remove())}onUploadSuccess(){this.uploadCount+=1}get uploadText(){return this.I18n.t("js.label_upload_counter",{done:this.uploadCount,count:this.data.length})}}function dp(g,o){if(1&g&&e._UZ(0,"op-toast",3),2&g){const s=o.$implicit;e.Q6J("toast",s)}}ys.\u0275fac=function(o){return new(o||ys)(e.Y36(y.D),e.Y36(M.kl))},ys.\u0275cmp=e.Xpm({type:ys,selectors:[["op-toast"]],inputs:{toast:"toast"},decls:9,vars:10,consts:[["tabindex","0"],["role","alert","aria-atomic","true",1,"op-toast--content"],[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["type","button","class","spot-link op-toast--close",3,"title","click",4,"ngIf"],["class","loading-indicator -small",4,"ngIf"],[3,"textContent"],[1,"loading-indicator","-small"],[1,"block-1"],[1,"block-2"],[1,"block-3"],[1,"block-4"],[1,"block-5"],["class","op-toast--target-link",3,"textContent","click",4,"ngIf"],[1,"op-toast--target-link",3,"textContent","click"],[3,"ngClass"],["class","op-toast--uploads",4,"ngIf"],[3,"hidden","click"],["icon-classes","icon-arrow-right2"],["icon-classes","icon-arrow-down1"],[1,"op-toast--uploads"],[3,"upload","onSuccess","onError",4,"ngFor","ngForOf"],[3,"upload","onSuccess","onError"],[1,"op-toast--errors"],[3,"textContent",4,"ngFor","ngForOf"],["type","button",1,"spot-link","op-toast--close",3,"title","click"],["icon-classes","icon-context icon-close icon-no-color"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.YNc(2,qd,4,4,"ng-container",2),e.YNc(3,ep,4,3,"p",2),e.TgZ(4,"div",3),e.YNc(5,sp,4,5,"div",4),e.YNc(6,rp,1,0,"div",4),e.YNc(7,cp,3,1,"div",4),e.qZA(),e.YNc(8,lp,2,1,"button",5),e.qZA(),e.qZA()),2&o&&(e.Gre("op-toast -",s.type,""),e.xp6(2),e.Q6J("ngIf","loading"===s.type),e.xp6(1),e.Q6J("ngIf","loading"!==s.type),e.xp6(1),e.Q6J("ngSwitch",s.type),e.xp6(1),e.Q6J("ngSwitchCase","upload"),e.xp6(1),e.Q6J("ngSwitchCase","success"),e.xp6(1),e.Q6J("ngSwitchCase","error"),e.xp6(1),e.Q6J("ngIf",s.removable))},directives:[D.O5,D.RF,D.n9,D.mk,Ye.o,D.sg,Cs],pipes:[D.Ov],encapsulation:2,changeDetection:0});class bs extends si.N{constructor(o,s){super(),this.toastService=o,this.cdRef=s,this.stack=[]}ngOnInit(){this.toastService.current.values$("Subscribing to changes in the toaster stack").pipe(this.untilDestroyed()).subscribe(o=>{this.stack=o,this.cdRef.detectChanges()})}}bs.\u0275fac=function(o){return new(o||bs)(e.Y36(M.kl),e.Y36(e.sBO))},bs.\u0275cmp=e.Xpm({type:bs,selectors:[["op-toasts-container"]],features:[e.qOj],decls:3,vars:1,consts:[[1,"op-toast--wrapper"],[1,"op-toast--casing"],[3,"toast",4,"ngFor","ngForOf"],[3,"toast"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.YNc(2,dp,1,1,"op-toast",2),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Q6J("ngForOf",s.stack))},directives:[D.sg,ys],encapsulation:2,changeDetection:0});var up=t(22663),ua=t(26611),hp=t(38519);function _p(g,o){if(1&g&&(e.ynx(0),e._UZ(1,"attachments",3),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("resource",s.resource)}}class ws extends si.N{constructor(o,s,w,j,ee,me,De){super(),this.elementRef=o,this.pathHelper=s,this.halResourceService=w,this.Notifications=j,this.I18n=ee,this.states=me,this.ConfigurationService=De,this.changed=!1,this.inFlight=!1,this.isEditing=!1}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.textareaSelector=this.$element.attr("textarea-selector"),this.previewContext=this.$element.attr("preview-context"),this.macros="false"!==this.$element.attr("macros");const o=this.$element.attr("editor-type")||"full",s=this.$element.data("resource");this.resource=s?this.halResourceService.createHalResource(s,!0):void 0,this.formElement=this.$element.closest("form"),this.wrappedTextArea=this.formElement.find(this.textareaSelector),this.wrappedTextArea.removeAttr("required").hide(),this.initialContent=this.wrappedTextArea.val(),this.$attachmentsElement=this.formElement.find("#attachments_fields"),this.context={type:o,resource:this.resource,previewContext:this.previewContext},this.macros||(this.context.macros="none")}ngOnDestroy(){super.ngOnDestroy(),this.formElement.off("submit.ckeditor")}markEdited(){window.OpenProject.pageWasEdited=!0}setup(o){return this.$element.data("editor",o),this.resource&&this.resource.attachments&&(this.setupAttachmentAddedCallback(o),this.setupAttachmentRemovalSignal(o)),this.formElement.on("submit.ckeditor change.ckeditor",()=>{try{this.wrappedTextArea.val(this.ckEditorInstance.getRawData())}catch(s){return console.error(`Failed to save CKEditor body to textarea: ${s}.`),this.Notifications.addError(s||this.I18n.t("js.error.internal")),!1}return this.addUploadedAttachmentsToForm(),!0}),this.setLabel(),o}setupAttachmentAddedCallback(o){o.model.on("op:attachment-added",()=>{this.states.forResource(this.resource).putValue(this.resource)})}setupAttachmentRemovalSignal(o){this.attachments=_.clone(this.resource.attachments.elements),this.states.forResource(this.resource).changes$().pipe((0,up.R)((0,hp.J6)(this)),(0,Gt.h)(s=>!!s)).subscribe(s=>{const j=_.differenceBy(this.attachments,s.attachments.elements,ee=>ee.id).map(ee=>ee.downloadLocation.href);j.length&&o.model.fire("op:attachment-removed",j),this.attachments=_.clone(s.attachments.elements)})}setLabel(){const o=this.textareaSelector.substring(1),s=jQuery(`label[for=${o}]`),w=this.$element.find(".ck-content");w.attr("aria-label",null),w.attr("aria-labelledby",o),s.click(()=>{w.focus()})}addUploadedAttachmentsToForm(){if(!this.resource||!this.resource.attachments||this.resource.id)return;const s=this.$attachmentsElement.find("input[type='file']").map((j,ee)=>{const me=/attachments\[(\d+)\]\[(?:file|id)\]/.exec(ee.getAttribute("name")||"");return me?parseInt(me[1]):0}).toArray().sort().pop()||0,w=this.resource.attachments.elements||[];jQuery.each(w,(j,ee)=>{this.$attachmentsElement.append(`<input type="hidden" name="attachments[${s+j+1}][id]" value="${ee.id}">`)})}}ws.\u0275fac=function(o){return new(o||ws)(e.Y36(e.SBq),e.Y36(je.j),e.Y36(gt.u),e.Y36(M.kl),e.Y36(y.D),e.Y36(h.G),e.Y36(Me.e))},ws.\u0275cmp=e.Xpm({type:ws,selectors:[["ckeditor-augmented-textarea"]],viewQuery:function(o,s){if(1&o&&e.Gf(ua.F,7),2&o){let w;e.iGM(w=e.CRH())&&(s.ckEditorInstance=w.first)}},features:[e.qOj],decls:4,vars:3,consts:[[1,"op-ckeditor--wrapper"],[3,"context","content","onInitialized","onContentChange"],[4,"ngIf"],["data-allow-uploading","true","data-destroy-immediately","false",3,"resource"]],template:function(o,s){1&o&&(e.ynx(0),e.TgZ(1,"div",0),e.TgZ(2,"op-ckeditor",1),e.NdJ("onInitialized",function(j){return s.setup(j)})("onContentChange",function(){return s.markEdited()}),e.qZA(),e.qZA(),e.YNc(3,_p,2,1,"ng-container",2),e.BQk()),2&o&&(e.xp6(2),e.Q6J("context",s.context)("content",s.initialContent),e.xp6(1),e.Q6J("ngIf",s.resource&&s.resource.attachments))},directives:[ua.F,D.O5,Li.t],encapsulation:2});class Ts{constructor(o){this.elementRef=o,this.isHidden=!1}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.$targetNotification=this.getTargetNotification(),this.identifier=this.$element.data("identifier"),this.isHidden="true"===window.OpenProject.guardedLocalStorage(this.identifier),this.$targetNotification.prop("hidden",!!this.isHidden),this.$element.parent().find(".persistent-toggle--click-handler").on("click",()=>this.toggle(!this.isHidden)),this.$targetNotification.find(".op-toast--close").on("click",()=>this.toggle(!0))}getTargetNotification(){return this.$element.parent().find(".persistent-toggle--toaster")}toggle(o){this.isHidden=o,window.OpenProject.guardedLocalStorage(this.identifier,(!!o).toString()),o?this.$targetNotification.slideUp(400,()=>{this.$targetNotification.prop("hidden",!0)}):(this.$targetNotification.slideDown(400),this.$targetNotification.prop("hidden",!1))}}Ts.\u0275fac=function(o){return new(o||Ts)(e.Y36(e.SBq))},Ts.\u0275cmp=e.Xpm({type:Ts,selectors:[["persistent-toggle"]],decls:0,vars:0,template:function(o,s){},encapsulation:2});class wn{constructor(o){this.displayed=(0,$n.qH)(),this.all=[];const s=o.get("hideSections");this.all=s.all,this.displayed.putValue(s.active.map(w=>(this.toggleVisibility(w.key,!0),w.key))),this.removeHiddenOnSubmit()}section(o){return document.querySelector(`section.hide-section[data-section-name="${o}"]`)}hide(o){this.displayed.doModify(s=>s.filter(w=>w!==o)),this.toggleVisibility(o,!1)}show(o){this.displayed.doModify(s=>[...s,o]),this.toggleVisibility(o,!0)}toggleVisibility(o,s){const w=this.section(o);w&&(w.hidden=!s)}removeHiddenOnSubmit(){jQuery(document.body).on("submit","form",function(o){const s=jQuery(this),w=s.find("section.hide-section:hidden");return!(!s.data("hideSectionRemoved")&&0!==w.length)||(s.data("hideSectionRemoved",!0),w.remove(),s.trigger("submit"),o.preventDefault(),!1)})}}wn.\u0275fac=function(o){return new(o||wn)(e.LFG(us.U))},wn.\u0275prov=e.Yz7({token:wn,factory:wn.\u0275fac,providedIn:"root"});class ks{constructor(o,s,w){this.elementRef=o,this.hideSectionService=s,this.I18n=w,this.displayed=!0,this.text={remove:this.I18n.t("js.label_remove")}}ngOnInit(){this.sectionName=this.elementRef.nativeElement.dataset.sectionName}hideSection(){return this.hideSectionService.hide(this.sectionName),!1}}ks.\u0275fac=function(o){return new(o||ks)(e.Y36(e.SBq),e.Y36(wn),e.Y36(y.D))},ks.\u0275cmp=e.Xpm({type:ks,selectors:[["hide-section-link"]],decls:2,vars:1,consts:[["type","button",1,"spot-link",3,"title","click"],["icon-classes","icon-close icon-small"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return s.hideSection()}),e._UZ(1,"op-icon",1),e.qZA()),2&o&&e.Q6J("title",s.text.remove)},directives:[Ye.o],encapsulation:2});class Ps{constructor(o,s){this.HideSection=o,this.elementRef=s}ngOnInit(){const o=jQuery(this.elementRef.nativeElement);this.optValue=o.data("optValue"),this.hideSecWithName=o.data("hideSecWithName"),jQuery(this.elementRef.nativeElement).prev().on("change",w=>{jQuery("option:selected",w.target).val()!==this.optValue?this.HideSection.hide(this.hideSecWithName):this.HideSection.show(this.hideSecWithName)})}}Ps.\u0275fac=function(o){return new(o||Ps)(e.Y36(wn),e.Y36(e.SBq))},Ps.\u0275cmp=e.Xpm({type:Ps,selectors:[["show-section-dropdown"]],decls:0,vars:0,template:function(o,s){},encapsulation:2});var Cp=t(43682);const yp=["fallbackOption"];function bp(g,o){if(1&g&&e._UZ(0,"option",4),2&g){const s=o.$implicit;e.Q6J("value",s.key)("textContent",s.label)}}class xs extends si.N{constructor(o,s,w){super(),this.hideSectionService=o,this.elementRef=s,this.I18n=w,this.trackByKey=(0,Cp.AT)("key"),this.selectable=[],this.active=[],this.placeholder=this.I18n.t("js.placeholders.selection")}ngOnInit(){this.htmlId=this.elementRef.nativeElement.dataset.htmlId,this.hideSectionService.displayed.values$().pipe(this.untilDestroyed()).subscribe(o=>{this.selectable=this.hideSectionService.all.filter(s=>-1===o.indexOf(s.key)).sort((s,w)=>s.label.localeCompare(w.label)),this.option.nativeElement.selected=!0})}show(o){this.hideSectionService.show(o)}}xs.\u0275fac=function(o){return new(o||xs)(e.Y36(wn),e.Y36(e.SBq),e.Y36(y.D))},xs.\u0275cmp=e.Xpm({type:xs,selectors:[["add-section-dropdown"]],viewQuery:function(o,s){if(1&o&&e.Gf(yp,7),2&o){let w;e.iGM(w=e.CRH())&&(s.option=w.first)}},features:[e.qOj],decls:4,vars:3,consts:[[1,"form--select",3,"id","change"],["value","","selected","","disabled","",3,"textContent"],["fallbackOption",""],[3,"value","textContent",4,"ngFor","ngForTrackByKey","ngForOf"],[3,"value","textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"select",0),e.NdJ("change",function(j){return s.show(j.target.value)}),e._UZ(1,"option",1,2),e.YNc(3,bp,1,2,"option",3),e.qZA()),2&o&&(e.Q6J("id",s.htmlId),e.xp6(1),e.Q6J("textContent",s.placeholder),e.xp6(2),e.Q6J("ngForOf",s.selectable))},directives:[d.YN,d.Kr,D.sg],encapsulation:2});var ha=t(7301),Tp=t(54471);function kp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",16),e.NdJ("click",function(j){e.CHM(s);const ee=e.oxw().$implicit;return e.oxw().clickTab(ee,j)}),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.ekj("op-tab-row--link_selected",s.id===w.currentTabId)("op-tab-row--link_disabled",void 0!==s.disable),e.Q6J("href",s.path,e.LSH)("textContent",s.name),e.uIk("title",w.tabTitle(s))}}function Pp(g,o){if(1&g&&(e._UZ(0,"op-tab-count",21),e.ALo(1,"async")),2&g){const s=e.oxw(2).$implicit,w=e.oxw();e.Q6J("count",e.lcZ(1,2,s.counter(w.injector))),e.uIk("data-qa-selector","tab-counter-"+s.name)}}function xp(g,o){if(1&g&&(e.TgZ(0,"span",23),e._uU(1),e.qZA()),2&g){const s=e.oxw().ngIf;e.xp6(1),e.hij(" (",s,")")}}function Ep(g,o){if(1&g&&(e.ynx(0),e.YNc(1,xp,2,1,"span",22),e.BQk()),2&g){const s=o.ngIf,w=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",s>0&&!w.showCountAsBubble)}}function Op(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",17),e.NdJ("click",function(j){e.CHM(s);const ee=e.oxw().$implicit;return e.oxw().clickTab(ee,j)}),e._UZ(1,"span",18),e.YNc(2,Pp,2,4,"op-tab-count",19),e.YNc(3,Ep,2,1,"ng-container",20),e.ALo(4,"async"),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.ekj("op-tab-row--link_disabled",void 0!==s.disable),e.Q6J("uiSref",s.route)("uiParams",s.routeParams),e.uIk("title",w.tabTitle(s)),e.xp6(1),e.Q6J("textContent",s.name),e.xp6(1),e.Q6J("ngIf",s.counter&&s.showCountAsBubble),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,8,s.counter(w.injector)))}}function Mp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li",13),e.NdJ("dragenter",function(){const ee=e.CHM(s).$implicit;return e.oxw().startDebouncedTabActivation(ee)})("dragleave",function(){return e.CHM(s),e.oxw().cancelDebouncedTabActivation()}),e.YNc(1,kp,1,7,"a",14),e.YNc(2,Op,5,10,"a",15),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.uIk("data-tab-id",s.id)("data-qa-tab-id",s.id)("data-qa-tab-selected",s.id===w.currentTabId||void 0)("data-qa-tab-disabled",s.disable||void 0),e.xp6(1),e.Q6J("ngIf",!s.route),e.xp6(1),e.Q6J("ngIf",s.route)}}const Ip=[[["","slot","actions"]]];class Es extends _i.P{constructor(o,s,w,j,ee,me){super(s,j,me),this.elementRef=o,this.$state=s,this.gon=w,this.I18n=ee,this.injector=me,this.classes=["content--tabs","scrollable-tabs"];const De=JSON.parse(this.gon.get("contentTabs").tabs),Je=JSON.parse(this.gon.get("contentTabs").selected);this.tabs=De.map(qe=>({id:qe.name,name:this.I18n.t(`js.${qe.label}`,{defaultValue:qe.label}),path:qe.path})),this.currentTabId=Je.name}}Es.\u0275fac=function(o){return new(o||Es)(e.Y36(e.SBq),e.Y36(Ke.StateService),e.Y36(us.U),e.Y36(e.sBO),e.Y36(y.D),e.Y36(e.zs3))},Es.\u0275cmp=e.Xpm({type:Es,selectors:[["op-content-tabs"]],features:[e.qOj],ngContentSelectors:["[slot=actions]"],decls:14,vars:5,consts:[[1,"op-scrollable-tabs",3,"ngClass"],[1,"op-scrollable-tabs--tab-container"],["scrollContainer",""],[1,"op-tab-row",3,"scroll"],["scrollPane",""],["class","op-tab-row--tab",3,"dragenter","dragleave",4,"ngFor","ngForOf","ngForTrackBy"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_left",3,"hidden","click"],["scrollLeftBtn",""],[1,"icon-arrow-left2"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_right",3,"hidden","click"],["scrollRightBtn",""],[1,"icon-arrow-right2"],[1,"op-scrollable-tabs--actions"],[1,"op-tab-row--tab",3,"dragenter","dragleave"],["class","op-tab-row--link",3,"href","op-tab-row--link_selected","op-tab-row--link_disabled","textContent","click",4,"ngIf"],["class","op-tab-row--link","uiSrefActive","op-tab-row--link_selected","href","","role","button",3,"uiSref","uiParams","op-tab-row--link_disabled","click",4,"ngIf"],[1,"op-tab-row--link",3,"href","textContent","click"],["uiSrefActive","op-tab-row--link_selected","href","","role","button",1,"op-tab-row--link",3,"uiSref","uiParams","click"],[3,"textContent"],[3,"count",4,"ngIf"],[4,"ngIf"],[3,"count"],["data-qa-selector","tab-count",4,"ngIf"],["data-qa-selector","tab-count"]],template:function(o,s){1&o&&(e.F$t(Ip),e.TgZ(0,"div",0),e.TgZ(1,"div",1,2),e.TgZ(3,"ul",3,4),e.NdJ("scroll",function(){return s.onScroll()}),e.YNc(5,Mp,3,6,"li",5),e.qZA(),e.TgZ(6,"div",6,7),e.NdJ("click",function(){return s.scrollLeft()}),e._UZ(8,"span",8),e.qZA(),e.TgZ(9,"div",9,10),e.NdJ("click",function(){return s.scrollRight()}),e._UZ(11,"span",11),e.qZA(),e.qZA(),e.TgZ(12,"ul",12),e.Hsn(13),e.qZA(),e.qZA()),2&o&&(e.Q6J("ngClass",s.classes),e.xp6(5),e.Q6J("ngForOf",s.tabs)("ngForTrackBy",s.trackById),e.xp6(1),e.Q6J("hidden",s.hideLeftButton),e.xp6(3),e.Q6J("hidden",s.hideRightButton))},directives:[D.mk,D.sg,D.O5,Vt.AnchorUISref,Vt.UISrefActive,Vt.UISrefStatus,Vt.UISref,Tp.x],pipes:[D.Ov],styles:["content-tabs[_ngcontent-%COMP%]{min-height:73px;display:block}"],changeDetection:0});class Os{constructor(o,s,w,j){this.toastService=o,this.elementRef=s,this.I18n=w,this.ConfigurationService=j}ngOnInit(){const o=this.elementRef.nativeElement;this.clickTarget=o.getAttribute("click-target"),this.clipboardTarget=o.getAttribute("clipboard-target"),jQuery(this.clickTarget).on("click",s=>this.onClick(s)),o.classList.add("copy-to-clipboard"),this.target=jQuery(this.clipboardTarget?this.clipboardTarget:o)}addNotification(o,s){const w=this.toastService[o](s);setTimeout(()=>this.toastService.remove(w),5e3)}onClick(o){const s=document.queryCommandSupported&&document.queryCommandSupported("copy");if(o.preventDefault(),this.target.select().focus(),s)try{if(document.execCommand("copy"))return void this.addNotification("addSuccess",this.I18n.t("js.clipboard.copied_successful"))}catch(w){console.log(`Your browser seems to support the clipboard API, but copying failed: ${w}`)}this.addNotification("addError",this.I18n.t("js.clipboard.browser_error"))}}Os.\u0275fac=function(o){return new(o||Os)(e.Y36(M.kl),e.Y36(e.SBq),e.Y36(y.D),e.Y36(Me.e))},Os.\u0275cmp=e.Xpm({type:Os,selectors:[["copy-to-clipboard"]],decls:0,vars:0,template:function(o,s){},encapsulation:2});var ur=t(98636),jp=t(67325),_a=t(50076),Zp=t(49951),Or=t(91593),ma=t(80104);const Rp=["btn"];function Fp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){return e.CHM(s),e.oxw().toggleMobileSearch()}),e._UZ(1,"i",9),e.qZA()}if(2&g){const s=e.oxw();e.s9C("title",s.text.close_search)}}function Wp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",12),e.NdJ("click",function(){e.CHM(s);const j=e.oxw().$implicit;return e.oxw().followItem(j)}),e.TgZ(2,"div",13),e._uU(3),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.xp6(3),e.hij(" ",w.currentValue,""),e.xp6(1),e.s9C("title",s.projectScope),e.xp6(1),e.hij("",s.text," \u21b5")}}function Up(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",15),e.NdJ("click",function(j){e.CHM(s);const ee=e.oxw().$implicit;return e.oxw().redirectToWp(ee.id,j)}),e._UZ(1,"op-principal",16),e.TgZ(2,"div",17),e.TgZ(3,"span",18),e._UZ(4,"span",19),e._uU(5),e.qZA(),e.TgZ(6,"div",20),e._UZ(7,"span",21),e._uU(8),e._UZ(9,"span",22),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("href",w.wpPath(s.id),e.LSH),e.xp6(1),e.Q6J("hideName",!0)("principal",s.author),e.xp6(3),e.Q6J("ngClass",w.highlighting("type",s.type.id))("textContent",s.type.name),e.xp6(1),e.hij(" ",s.subject," "),e.xp6(2),e.Q6J("textContent",s.project.name),e.xp6(1),e.hij(" #",s.id," "),e.xp6(1),e.Q6J("textContent",s.status.name)("ngClass",w.statusHighlighting(s.status.id))}}function Lp(g,o){if(1&g&&(e.YNc(0,Wp,6,3,"div",10),e.YNc(1,Up,10,10,"ng-template",null,11,e.W1O)),2&g){const s=o.$implicit,w=e.MAs(2);e.Q6J("ngIf",!s.id)("ngIfElse",w)}}const Bp=function(g,o){return{"top-menu-search--input":!0,"-markable":g,"-expanded":o}};class Ms{constructor(o,s,w,j,ee,me,De,Je,qe,Et,At){this.elementRef=o,this.I18n=s,this.apiV3Service=w,this.pathHelperService=j,this.halResourceService=ee,this.globalSearchService=me,this.currentProjectService=De,this.deviceService=Je,this.cdRef=qe,this.halNotification=Et,this.ngZone=At,this.expanded=!1,this.markable=!1,this.getAutocompleterData=ci=>this.autocompleteWorkPackages(ci),this.autocompleterOptions={filters:[],resource:"work_packages",searchKey:"subjectOrId",getOptionsFn:this.getAutocompleterData},this.currentValue="",this.isFocusedDirectly=this.globalSearchService.searchTerm.length>0,this.text={all_projects:this.I18n.t("js.global_search.all_projects"),current_project:this.I18n.t("js.global_search.current_project"),current_project_and_all_descendants:this.I18n.t("js.global_search.current_project_and_all_descendants"),search:this.I18n.t("js.global_search.search"),search_dots:`${this.I18n.t("js.global_search.search")} ...`,close_search:this.I18n.t("js.global_search.close_search")}}ngAfterViewInit(){this.searchTerm=this.globalSearchService.searchTerm,this.currentValue="",this.toggleTopMenuClass()}ngOnDestroy(){this.unregister()}set searchTerm(o){this.ngSelectComponent.ngSelectInstance.searchTerm=o}get searchTerm(){return this.ngSelectComponent.ngSelectInstance.searchTerm}handleClick(o){var s;o.preventDefault(),(0,Zp.j)(this.btn.nativeElement,o.target)&&(this.deviceService.isMobile?(this.toggleMobileSearch(),jQuery(".ng-input input").focus(),o.stopPropagation()):0===(null===(s=this.searchTerm)||void 0===s?void 0:s.length)?this.ngSelectComponent.ngSelectInstance.focus():this.submitNonEmptySearch())}toggleMobileSearch(){this.expanded=!this.expanded,this.toggleTopMenuClass()}redirectToWp(o,s){return s.stopImmediatePropagation(),!!(0,jp.F)(s)||(window.location.href=this.wpPath(o),s.preventDefault(),!1)}wpPath(o){return this.pathHelperService.workPackagePath(o)}highlighting(o,s){return _a.Z.inlineClass(o,s)}search(o){this.currentValue=this.searchTerm,this.openCloseMenu(o.term)}openCloseMenu(o){this.ngSelectComponent.ngSelectInstance.isOpen=o.trim().length>0}onFocus(){this.expanded=!0,this.toggleTopMenuClass(),this.openCloseMenu(this.currentValue)}onFocusOut(){this.deviceService.isMobile||(this.expanded=null!==this.searchTerm&&this.searchTerm.length>0,this.ngSelectComponent.ngSelectInstance.isOpen=!1,this.selectedItem=void 0,this.toggleTopMenuClass())}onClose(){this.searchTerm=this.currentValue}clearSearch(){this.currentValue="",this.searchTerm="",this.openCloseMenu(this.currentValue)}onEnterBeforeResultsLoaded(){this.selectedItem?this.followSelectedItem():this.searchInScope(this.currentScope)}statusHighlighting(o){return _a.Z.inlineClass("status",o)}followItem(o){this.selectedItem=o,o instanceof vo.X?window.location.href=this.wpPath(o.id):o&&(this.globalSearchService.searchTerm=this.currentValue,this.searchInScope(o.projectScope))}followSelectedItem(){this.selectedItem&&this.followItem(this.selectedItem)}customSearchFn(o,s){return void 0===s.id||-1!==s.subject.toLowerCase().indexOf(o.toLowerCase())}autocompleteWorkPackages(o){if(!o)return(0,eo.of)([]);this.selectedItem=void 0,this.markable=!1;const s=this.queryWithoutHash(o);return this.fetchSearchResults(s,s!==o).get().pipe((0,Yt.U)(w=>this.searchResultsToOptions(w.elements,s)),(0,ur.b)(()=>{this.setMarkedOption()}))}queryWithoutHash(o){return/^#(\d+)/.exec(o)?o.substr(1):o}fetchSearchResults(o,s){return this.apiV3Service.work_packages.filterByTypeaheadOrId(o,s)}searchResultsToOptions(o,s){const w=this.detailedSearchOptions();return this.selectedItem=o.find(j=>{var ee;return(null===(ee=j.id)||void 0===ee?void 0:ee.toString())===s})||w[0],[...w,...o]}detailedSearchOptions(){const o=[];return this.currentProjectService.path&&(o.push("current_project_and_all_descendants"),o.push("current_project")),"current_project"===this.globalSearchService.projectScope&&o.reverse(),o.push("all_projects"),o.map(s=>({projectScope:s,text:this.text[s]}))}setMarkedOption(){this.markable=!0,this.ngSelectComponent.ngSelectInstance.itemsList.markItem(this.ngSelectComponent.ngSelectInstance.itemsList.selectedItems[0]),this.cdRef.detectChanges()}searchInScope(o){switch(o){case"all_projects":{let s=!1;"all"!==this.globalSearchService.projectScope&&(s=!0,this.globalSearchService.resultsHidden=!0),this.globalSearchService.projectScope="all",this.submitNonEmptySearch(s);break}case"current_project":this.globalSearchService.projectScope="current_project",this.submitNonEmptySearch();break;case"current_project_and_all_descendants":this.globalSearchService.projectScope="",this.submitNonEmptySearch()}}submitNonEmptySearch(o=!1){if(this.globalSearchService.searchTerm=this.currentValue,this.currentValue.length>0){if(this.ngSelectComponent.ngSelectInstance.close(),!o&&this.globalSearchService.isAfterSearch()&&"work_packages"===this.globalSearchService.currentTab)return void window.history.replaceState({},`${I18n.t("global_search.search")}: ${this.searchTerm}`,this.globalSearchService.searchPath());this.globalSearchService.submitSearch()}}blur(){this.ngSelectComponent.ngSelectInstance.searchTerm="",document.activeElement.blur()}get currentScope(){const o=this.globalSearchService.projectScope;return""===o?"current_project_and_all_descendants":o}unregister(){this.unregisterGlobalListener&&(this.unregisterGlobalListener(),this.unregisterGlobalListener=void 0)}toggleTopMenuClass(){const o=document.getElementsByClassName("op-app-header")[0];o.classList.toggle("op-app-header_search-open",this.expanded),o.dataset.qaSearchOpen="1"}}Ms.\u0275fac=function(o){return new(o||Ms)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(R.T),e.Y36(je.j),e.Y36(gt.u),e.Y36(Vi),e.Y36(b.R),e.Y36(mr.U),e.Y36(e.sBO),e.Y36(Ne.W),e.Y36(e.R0b))},Ms.\u0275cmp=e.Xpm({type:Ms,selectors:[["global-search-input"]],viewQuery:function(o,s){if(1&o&&(e.Gf(Rp,7),e.Gf(Or.s,7)),2&o){let w;e.iGM(w=e.CRH())&&(s.btn=w.first),e.iGM(w=e.CRH())&&(s.ngSelectComponent=w.first)}},hostBindings:function(o,s){1&o&&e.NdJ("click",function(j){return s.handleClick(j)})},decls:8,vars:22,consts:[[1,"top-menu-search"],["class","top-menu-search--back-button","href","#",3,"title","click",4,"ngIf"],[1,"global-search",3,"defaultData","name","id","accesskey","placeholder","classes","openOnEnter","labelRequired","focusDirectly","model","searchFn","filters","resource","searchKey","getOptionsFn","focus","blur","search","open","close","change","keydown.enter","keydown.escape","clear"],["select",""],["op-autocompleter-option-tmp",""],["role","button","id","top-menu-search-button",1,"top-menu-search--button","search-form-normal",3,"title","click"],["btn",""],["icon-classes","icon5 icon-search ellipsis"],["href","#",1,"top-menu-search--back-button",3,"title","click"],["aria-hidden","true",1,"icon-arrow-left1"],[4,"ngIf","ngIfElse"],["workPackageItemTemplate",""],["tabindex","-1",1,"global-search--option",3,"click"],[1,"global-search--search-term"],[1,"global-search--project-scope",3,"title"],["tabindex","-1",1,"global-search--option",2,"line-height","1",3,"href","click"],[1,"hidden-for-mobile","global-search--principal",3,"hideName","principal"],[1,"global-search--option-meta"],[1,"global-search--wp-subject"],[3,"ngClass","textContent"],[1,"global-search--wp-content"],[1,"global-search--wp-project",3,"textContent"],[1,"global-search--wp-status",3,"textContent","ngClass"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Fp,2,1,"button",1),e.TgZ(2,"op-autocompleter",2,3),e.NdJ("focus",function(){return s.onFocus()})("blur",function(){return s.onFocusOut()})("search",function(j){return s.search(j)})("open",function(){return s.openCloseMenu(s.currentValue)})("close",function(){return s.onClose()})("change",function(j){return s.followItem(j)})("keydown.enter",function(){return s.onEnterBeforeResultsLoaded()})("keydown.escape",function(){return s.blur()})("clear",function(){return s.clearSearch()}),e.YNc(4,Lp,3,2,"ng-template",4),e.qZA(),e.TgZ(5,"button",5,6),e.NdJ("click",function(j){return s.handleClick(j)}),e._UZ(7,"op-icon",7),e.qZA(),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",s.expanded),e.xp6(1),e.Q6J("defaultData",!1)("name","global-search-input")("id","global-search-input")("accesskey",4)("placeholder",s.text.search_dots)("classes",e.WLB(19,Bp,s.markable,s.expanded))("openOnEnter",!1)("labelRequired",!1)("focusDirectly",s.isFocusedDirectly)("model",s.selectedItem)("searchFn",s.customSearchFn)("filters",s.autocompleterOptions.filters)("resource",s.autocompleterOptions.resource)("searchKey",s.autocompleterOptions.searchKey)("getOptionsFn",s.autocompleterOptions.getOptionsFn),e.xp6(3),e.ekj("-input-focused",s.expanded),e.s9C("title",s.text.search))},directives:[D.O5,Or.s,ma.u,Ye.o,vt.N,D.mk],styles:[".cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.top-menu-search{display:flex;align-items:center;position:relative;height:var(--header-height);line-height:var(--header-height);margin:0 15px}@media screen and (max-width: 679px){.top-menu-search{margin:0}}.top-menu-search--back-button{display:none}.top-menu-search--button{padding:0;margin:0;background:transparent;border:0;font:inherit;text-align:inherit;position:absolute;right:2px;font-size:var(--header-item-font-size);color:var(--header-item-font-color)}.top-menu-search--button:hover{text-decoration:none}@media screen and (max-width: 679px){.top-menu-search--button{position:relative;padding:0 8px}.top-menu-search--button:hover{background:var(--header-item-bg-hover-color);color:var(--header-item-font-hover-color);border-bottom:var(--header-border-bottom-width) solid var(--header-border-bottom-color)}}.top-menu-search--button.-input-focused{color:var(--header-search-field-font-color)}.top-menu-search--loading{top:var(--header-height)-11px;height:46px;z-index:1051}.top-menu-search--input{width:calc(160px + 3vw);font-size:.9rem;transition:width .2s ease-in-out}.top-menu-search--input::-ms-clear{margin-right:5px;width:20px}.top-menu-search--input .ng-select-container{background:transparent;border-color:var(--header-item-font-color)}.top-menu-search--input .ng-arrow-wrapper{display:none}.top-menu-search--input .ng-clear-wrapper{color:var(--header-item-font-color);top:1px;width:30px;right:25px;text-align:center}@media screen and (max-width: 679px){.top-menu-search--input .ng-input{top:0!important}}.top-menu-search--input .ng-input input{color:var(--header-item-font-color);height:30px;cursor:text}.top-menu-search--input .ng-placeholder{color:var(--header-item-font-color)!important}.top-menu-search--input.-expanded{width:calc(160px + 13vw);background:white;border-radius:4px;color:var(--header-search-field-font-color)}.top-menu-search--input.-expanded .ng-placeholder,.top-menu-search--input.-expanded .ng-clear-wrapper,.top-menu-search--input.-expanded input{color:var(--header-search-field-font-color)}.top-menu-search--input .ng-dropdown-panel-items.scroll-host{scrollbar-color:transparent transparent;scrollbar-width:thin;max-height:80vh;height:auto}.top-menu-search--input .ng-dropdown-panel-items.scroll-host::-webkit-scrollbar{height:10px;width:10px}.top-menu-search--input .ng-dropdown-panel-items.scroll-host::-webkit-scrollbar-track{background:transparent}.top-menu-search--input .ng-dropdown-panel-items.scroll-host::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.top-menu-search--input .ng-dropdown-panel-items.scroll-host:hover{scrollbar-color:#DDDDDD transparent}.top-menu-search--input .ng-dropdown-panel-items.scroll-host:hover::-webkit-scrollbar-thumb{visibility:visible}.top-menu-search--input .ng-option{border-bottom:1px solid #EAEAEA;white-space:normal;padding:5px 10px;background-color:unset}.top-menu-search--input .ng-option:last-child{border-bottom:none}.top-menu-search--input .ng-option.ng-option-marked{color:var(--header-drop-down-item-font-hover-color)}.top-menu-search--input .ng-option.ng-option-disabled{display:none}.top-menu-search--input .ng-option.ng-option-selected{color:var(--header-drop-down-item-font-hover-color)}.top-menu-search--input.-markable .ng-option.ng-option-marked{background-color:var(--drop-down-hover-bg-color)}.top-menu-search--input.-markable .ng-option.ng-option-selected{background-color:var(--drop-down-selected-bg-color)}.top-menu-search--input .ng-spinner-loader{position:relative;right:14px}\n",".cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}@media only screen and (max-width: 679px){.top-menu-search--input{display:none}.top-menu-search--input.-expanded{display:block;min-width:unset;flex-basis:100%;position:unset;flex-grow:1}.top-menu-search--input.-expanded .scroll-host{max-height:calc(100vh - var(--header-height))}.top-menu-search--input.-expanded .ng-clear-wrapper{width:40px;right:0}.top-menu-search--input.-expanded .ng-select-bottom{height:calc(100vh - var(--header-height));overflow-y:auto;margin:0}.top-menu-search--input.-expanded .ng-select-container{height:36px!important;border-radius:4px}.top-menu-search--input.-expanded .ng-input input{height:36px}.top-menu-search .top-menu-search--back-button{padding:0;margin:0;background:transparent;border:0;font:inherit;text-align:inherit;display:initial;width:50px;text-align:center;color:var(--header-item-font-color)}.top-menu-search .top-menu-search--back-button:hover,.top-menu-search .top-menu-search--back-button:focus,.top-menu-search .top-menu-search--back-button:active{text-decoration:none}.top-menu-search .top-menu-search--loading{top:var(--header-height)1px}.top-menu-search .top-menu-search--button.-input-focused{color:var(--header-item-font-color)}}\n",'.cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.global-search{flex-grow:1}@media screen and (max-width: 679px){.global-search{display:none}}.global-search--option,.global-search--option:hover{padding:5px;line-height:15px;min-height:25px;word-break:break-word;color:var(--body-font-color);text-decoration:none;display:flex}.global-search--option-meta{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}.global-search--search-term{flex-grow:1}.global-search--project-scope{flex-grow:0;flex-shrink:1;border:1px solid var(--button--border-color);font-size:13px;background:var(--button--background-color);border-radius:2px;padding:0 4px;color:var(--body-font-color)}.global-search--principal{margin-right:5px;margin-left:-5px}.global-search--wp-content{display:grid;grid-template-columns:50% 1fr auto;grid-template-areas:"project idlink status";font-size:.8rem;padding:5px 0}.global-search--wp-project{grid-area:project;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.global-search--wp-id{grid-area:idlink;place-self:right;font-style:italic;color:var(--gray-dark);font-size:13px;white-space:nowrap}.global-search--wp-status{grid-area:status;overflow:hidden;font-style:italic}.global-search--wp-subject{font-weight:bold;display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}\n'],encapsulation:2,changeDetection:0});const Np=["sectionBody"],Jp=function(g){return{"-expanded":g}};class Is{constructor(o){this.elementRef=o,this.expanded=!1}ngOnInit(){const o=this.elementRef.nativeElement;this.sectionTitle=o.getAttribute("section-title"),"true"===o.getAttribute("initially-expanded")&&(this.expanded=!0);const s=o.nextElementSibling;this.sectionBody.nativeElement.appendChild(s),s.removeAttribute("hidden")}toggle(o){this.expanded=!this.expanded,o.preventDefault()}}Is.\u0275fac=function(o){return new(o||Is)(e.Y36(e.SBq))},Is.\u0275cmp=e.Xpm({type:Is,selectors:[["collapsible-section-augment"]],viewQuery:function(o,s){if(1&o&&e.Gf(Np,7),2&o){let w;e.iGM(w=e.CRH())&&(s.sectionBody=w.first)}},decls:5,vars:5,consts:[[1,"collapsible-section",3,"ngClass"],[1,"collapsible-section--toggle-link",3,"click"],[1,"collapsible-section--legend",3,"textContent"],[1,"collapsible-section--body","toggle-slide-animation",3,"hidden"],["sectionBody",""]],template:function(o,s){1&o&&(e.TgZ(0,"section",0),e.TgZ(1,"button",1),e.NdJ("click",function(j){return s.toggle(j)}),e._UZ(2,"span",2),e.qZA(),e._UZ(3,"div",3,4),e.qZA()),2&o&&(e.Q6J("ngClass",e.VKq(3,Jp,s.expanded)),e.xp6(2),e.Q6J("textContent",s.sectionTitle),e.xp6(1),e.Q6J("hidden",!s.expanded))},directives:[D.mk],encapsulation:2});var ga=t(85816),$p=t(19028),Vp=t(75423),Mr=t(48193),Hp=t(21090),zp=t(87912),fa=t(93713);const Gp=function(g,o){return{"spot-list--item-action_disabled":g,"spot-list--item-action_active":o}};function qp(g,o){if(1&g&&(e.TgZ(0,"a",5),e.ALo(1,"async"),e.TgZ(2,"span",6),e._uU(3),e.qZA(),e.qZA()),2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("ngClass",e.WLB(8,Gp,s.disabled,e.lcZ(1,6,w.searchableProjectListService.activeItemID$)===s.id))("title",s.name)("href",w.extendedProjectUrl(s.id),e.LSH),e.uIk("data-list-selector",w.projectListActionIdentifier),e.xp6(2),e.Q6J("opSearchHighlight",w.searchText),e.xp6(1),e.Oqu(s.name)}}const Xp=function(g){return{"spot-list--item-action_active":g}};function eu(g,o){if(1&g&&(e.TgZ(0,"span",7),e.ALo(1,"async"),e.TgZ(2,"span",8),e._uU(3),e.qZA(),e.qZA()),2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("title",s.name)("ngClass",e.VKq(5,Xp,e.lcZ(1,3,w.searchableProjectListService.activeItemID$)===s.id)),e.xp6(3),e.Oqu(s.name)}}function tu(g,o){if(1&g&&e._UZ(0,"ul",9),2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("projects",s.children)("selected",w.selected)("searchText",w.searchText)}}function iu(g,o){if(1&g&&(e.TgZ(0,"li",1),e.YNc(1,qp,4,11,"a",2),e.YNc(2,eu,4,7,"span",3),e.YNc(3,tu,1,3,"ul",4),e.qZA()),2&g){const s=o.$implicit,w=e.oxw();e.uIk("data-list-selector",w.projectListItemIdentifier),e.xp6(1),e.Q6J("ngIf",!s.disabled),e.xp6(1),e.Q6J("ngIf",s.disabled),e.xp6(1),e.Q6J("ngIf",s.children.length)}}class Po{constructor(o,s,w,j){this.I18n=o,this.currentProjectService=s,this.pathHelper=w,this.searchableProjectListService=j,this.classNameList=!0,this.className=!0,this.update=new e.vpe,this.root=!1,this.projects=[],this.searchText="",this.text={does_not_match_search:this.I18n.t("js.include_projects.tooltip.does_not_match_search"),include_all_selected:this.I18n.t("js.include_projects.tooltip.include_all_selected"),current_project:this.I18n.t("js.include_projects.tooltip.current_project")}}get currentProjectHref(){return this.currentProjectService.apiv3Path}extendedProjectUrl(o){const s=document.querySelector('meta[name="current_menu_item"]'),w=this.pathHelper.projectPath(o);return s?`${w}?jump=${encodeURIComponent(s.content)}`:w}}Po.\u0275fac=function(o){return new(o||Po)(e.Y36(y.D),e.Y36(b.R),e.Y36(je.j),e.Y36(Mr.O))},Po.\u0275cmp=e.Xpm({type:Po,selectors:[["","op-header-project-select-list",""]],hostVars:6,hostBindings:function(o,s){2&o&&e.ekj("spot-list",s.classNameList)("op-header-project-select-list",s.className)("op-header-project-select-list--root",s.root)},inputs:{root:"root",projects:"projects",searchText:"searchText"},outputs:{update:"update"},attrs:["op-header-project-select-list",""],decls:1,vars:1,consts:[["class","spot-list--item","data-qa-selector","op-header-project-select--item",4,"ngFor","ngForOf"],["data-qa-selector","op-header-project-select--item",1,"spot-list--item"],["tabindex","-1","class","spot-list--item-action",3,"ngClass","title","href",4,"ngIf"],["class","spot-list--item-action spot-list--item-action_disabled",3,"title","ngClass",4,"ngIf"],["op-header-project-select-list","",3,"projects","selected","searchText",4,"ngIf"],["tabindex","-1",1,"spot-list--item-action",3,"ngClass","title","href"],["data-qa-selector","op-header-project-select--item-title",1,"spot-list--item-title","spot-list--item-title_ellipse-text",3,"opSearchHighlight"],[1,"spot-list--item-action","spot-list--item-action_disabled",3,"title","ngClass"],["data-qa-selector","op-header-project-select--item-disabled-title",1,"spot-list--item-title","spot-list--item-title_ellipse-text"],["op-header-project-select-list","",3,"projects","selected","searchText"]],template:function(o,s){1&o&&e.YNc(0,iu,4,4,"li",0),2&o&&e.Q6J("ngForOf",s.projects)},directives:[D.sg,D.O5,D.mk,fa.U,Po],pipes:[D.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}[_nghost-%COMP%], .op-header-project-select-list[_ngcontent-%COMP%]{flex-shrink:1;flex-basis:100%}.op-header-project-select-list--root[_nghost-%COMP%], .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]{overflow-y:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.op-header-project-select-list--root[_nghost-%COMP%]::-webkit-scrollbar, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.op-header-project-select-list--root[_nghost-%COMP%]::-webkit-scrollbar-track, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.op-header-project-select-list--root[_nghost-%COMP%]::-webkit-scrollbar-thumb, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.op-header-project-select-list--root[_nghost-%COMP%]:hover, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.op-header-project-select-list--root[_nghost-%COMP%]:hover::-webkit-scrollbar-thumb, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}"],changeDetection:0});var nu=t(58);const ou=function(g){return{"spot-list_active":g}};function su(g,o){if(1&g&&e._UZ(0,"ul",21),2&g){const s=e.oxw(2).ngIf,w=e.oxw();e.Q6J("ngClass",e.VKq(4,ou,w.textFieldFocused))("projects",s)("searchText",w.searchableProjectListService.searchText)("root",!0)}}function ru(g,o){if(1&g&&(e.TgZ(0,"span",22),e._uU(1),e.qZA()),2&g){const s=e.oxw(3);e.xp6(1),e.hij(" ",s.text.no_results," ")}}function au(g,o){if(1&g&&(e.ynx(0),e.YNc(1,su,1,6,"ul",19),e.YNc(2,ru,2,1,"ng-template",null,20,e.W1O),e.BQk()),2&g){const s=e.MAs(3),w=e.oxw().ngIf;e.xp6(1),e.Q6J("ngIf",w.length>0)("ngIfElse",s)}}function cu(g,o){if(1&g&&(e.TgZ(0,"a",23),e._UZ(1,"i",24),e._UZ(2,"span",17),e.qZA()),2&g){const s=e.oxw(2);e.Q6J("href",s.newProjectPath(),e.LSH),e.xp6(2),e.Q6J("textContent",s.text.project.singular)}}const lu=function(){return{standalone:!0}};function du(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",9),e.TgZ(1,"spot-text-field",10),e.NdJ("ngModelChange",function(j){e.CHM(s);return e.oxw().searchableProjectListService.searchText=j})("keydown",function(j){const me=e.CHM(s).ngIf;return e.oxw().searchableProjectListService.onKeydown(j,me)})("inputFocus",function(){e.CHM(s);return e.oxw().textFieldFocused=!0})("inputBlur",function(){e.CHM(s);return e.oxw().textFieldFocused=!1}),e._UZ(2,"span",11),e.qZA(),e.YNc(3,au,4,2,"ng-container",12),e.ALo(4,"async"),e.TgZ(5,"div",13),e.TgZ(6,"div",14),e.TgZ(7,"a",15),e._UZ(8,"i",16),e._UZ(9,"span",17),e.qZA(),e.YNc(10,cu,3,2,"a",18),e.ALo(11,"async"),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw(),w=e.MAs(10);e.xp6(1),e.Q6J("placeholder",s.text.search_placeholder)("ngModel",s.searchableProjectListService.searchText)("ngModelOptions",e.DdM(12,lu)),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(4,8,s.loading$))("ngIfElse",w),e.xp6(4),e.Q6J("href",s.allProjectsPath(),e.LSH),e.xp6(2),e.Q6J("textContent",s.text.project.list),e.xp6(1),e.Q6J("ngIf",e.lcZ(11,10,s.canCreateNewProjects$))}}function pu(g,o){1&g&&e._UZ(0,"op-loading-project-list",25)}class Ss extends si.N{constructor(o,s,w,j,ee){super(),this.pathHelper=o,this.I18n=s,this.currentProject=w,this.searchableProjectListService=j,this.currentUserService=ee,this.className=!0,this.dropModalOpen=!1,this.textFieldFocused=!1,this.canCreateNewProjects$=this.currentUserService.hasCapabilities$("projects/create"),this.projects$=(0,Ai.aj)([this.searchableProjectListService.allProjects$,this.searchableProjectListService.searchText$.pipe((0,lr.b)(200))]).pipe((0,Yt.U)(([me,De])=>me.filter(Je=>!(De.length&&!Je.name.toLowerCase().includes(De.toLowerCase()))).sort((Je,qe)=>Je._links.ancestors.length-qe._links.ancestors.length).reduce((Je,qe)=>{const{ancestors:Et}=qe._links;return(0,$p.r)(me,qe,Je,Et)},[])),(0,Yt.U)(me=>(0,Vp.V)(me)),(0,kr.d)()),this.text={project:{singular:this.I18n.t("js.label_project"),plural:this.I18n.t("js.label_project_plural"),list:this.I18n.t("js.label_project_list"),select:this.I18n.t("js.label_select_project")},search_placeholder:this.I18n.t("js.include_projects.search_placeholder"),no_results:this.I18n.t("js.include_projects.no_results")},this.loading$=this.searchableProjectListService.fetchingProjects$.pipe((0,Gt.h)(me=>me),(0,fn.q)(1),(0,ga.zg)(()=>this.projects$),(0,ga.zg)(()=>this.searchableProjectListService.fetchingProjects$)),this.projects$.pipe(this.untilDestroyed()).subscribe(me=>{this.searchableProjectListService.resetActiveResult(me)})}toggleDropModal(){this.dropModalOpen=!this.dropModalOpen,this.dropModalOpen&&this.searchableProjectListService.loadAllProjects()}close(){this.searchableProjectListService.searchText="",this.dropModalOpen=!1}currentProjectName(){return null!==this.currentProject.name?this.currentProject.name:this.text.project.select}allProjectsPath(){return this.pathHelper.projectsPath()}newProjectPath(){const o=this.currentProject.id?`?parent_id=${this.currentProject.id}`:"";return`${this.pathHelper.projectsNewPath()}${o}`}}Ss.\u0275fac=function(o){return new(o||Ss)(e.Y36(je.j),e.Y36(y.D),e.Y36(b.R),e.Y36(Mr.O),e.Y36(Nn.S))},Ss.\u0275cmp=e.Xpm({type:Ss,selectors:[["op-header-project-select"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-header-project-select",s.className)},features:[e._Bn([Mr.O]),e.qOj],decls:11,vars:6,consts:[["alignment","bottom-left","data-searchable-list-parent","true",1,"op-project-list-modal",3,"open","closed"],["id","projects-menu","accesskey","5","aria-haspopup","true","type","button","slot","trigger",1,"op-app-menu--item-action",3,"click"],[1,"op-app-menu--item-title","ellipsis",3,"textContent"],[1,"op-app-menu--item-dropdown-indicator","button--dropdown-indicator"],["slot","body"],[1,"op-project-list-modal--header"],[1,"op-project-list-modal--title",3,"textContent"],["class","op-project-list-modal--body spot-container",4,"ngIf"],["loadingTemplate",""],[1,"op-project-list-modal--body","spot-container"],["data-qa-selector","op-header-project-select--search","data-modal-focus-catcher-container","true",3,"placeholder","ngModel","ngModelOptions","ngModelChange","keydown","inputFocus","inputBlur"],["slot","before",1,"spot-icon","spot-icon_search"],[4,"ngIf","ngIfElse"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-action-bar--action",3,"href"],[1,"button--icon","spot-icon","spot-icon_unordered-list"],[1,"button--text",3,"textContent"],["class","button button_no-margin -alt-highlight spot-action-bar--action",3,"href",4,"ngIf"],["op-header-project-select-list","","data-list-root","true","data-qa-selector","op-header-project-select--list",3,"ngClass","projects","searchText","root",4,"ngIf","ngIfElse"],["noResultsTemplate",""],["op-header-project-select-list","","data-list-root","true","data-qa-selector","op-header-project-select--list",3,"ngClass","projects","searchText","root"],[1,"op-project-list-modal--no-results"],[1,"button","button_no-margin","-alt-highlight","spot-action-bar--action",3,"href"],[1,"button--icon","spot-icon","spot-icon_add"],[1,"op-project-list-modal--loading"]],template:function(o,s){1&o&&(e.TgZ(0,"spot-drop-modal",0),e.NdJ("closed",function(){return s.close()}),e.TgZ(1,"button",1),e.NdJ("click",function(){return s.toggleDropModal()}),e._UZ(2,"span",2),e._UZ(3,"i",3),e.qZA(),e.ynx(4,4),e.TgZ(5,"div",5),e._UZ(6,"h1",6),e.qZA(),e.YNc(7,du,12,13,"div",7),e.ALo(8,"async"),e.BQk(),e.YNc(9,pu,1,0,"ng-template",null,8,e.W1O),e.qZA()),2&o&&(e.Q6J("open",s.dropModalOpen),e.xp6(2),e.Q6J("textContent",s.currentProjectName()),e.xp6(4),e.Q6J("textContent",s.text.project.plural),e.xp6(1),e.Q6J("ngIf",e.lcZ(8,4,s.projects$)))},directives:[Hp.m,D.O5,zp.A,d.JJ,d.On,Po,D.mk,nu.a],pipes:[D.Ov],styles:[".op-project-menu-autocomplete{max-width:100%}\n"],encapsulation:2,changeDetection:0});var Ir=t(33406);class Ds{constructor(o,s){this.elementRef=o,this.http=s}ngOnInit(){const o=jQuery(this.elementRef.nativeElement),s=o.parent();this.inputs=s.find(".remote-field--input"),this.target=s.find(".remote-field--target"),this.url=o.data("url"),this.htmlMode="html"===o.data("mode"),this.inputs.on("keyup change",_.debounce(w=>{const j=[Ir.m.TAB,Ir.m.ENTER,Ir.m.SHIFT];("change"===w.type||w.which&&-1===j.indexOf(w.which))&&this.updater()},500))}request(o){const s={};return this.htmlMode?s.Accept="text/html":s.Accept="application/json",this.http.get(this.url,{params:o,headers:s,responseType:this.htmlMode?"text":"json",withCredentials:!0})}updater(){const o={};this.inputs.each((s,w)=>{o[w.dataset.remoteFieldKey]=w.value}),this.request(o).subscribe(s=>{this.htmlMode?this.target.html(s):_.each(s,(w,j)=>{const ee=document.getElementById(j);ee instanceof HTMLInputElement?ee.value=w:ee&&(ee.textContent=w)})})}}Ds.\u0275fac=function(o){return new(o||Ds)(e.Y36(e.SBq),e.Y36(vi.eN))},Ds.\u0275cmp=e.Xpm({type:Ds,selectors:[["remote-field-updater"]],decls:0,vars:0,template:function(o,s){},encapsulation:2});var _u=t(75867),mu=t(51705);class Ki extends si.N{constructor(o,s,w,j,ee,me,De,Je){super(),this.elementRef=o,this.apiV3Service=s,this.I18n=w,this.states=j,this.opStaticQueries=ee,this.mainMenuService=me,this.cdRef=De,this.viewsService=Je,this.text={search:this.I18n.t("js.global_search.search"),label:this.I18n.t("js.toolbar.search_query_label"),scope_default:this.I18n.t("js.label_default_queries"),scope_starred:this.I18n.t("js.label_starred_queries"),scope_global:this.I18n.t("js.label_global_queries"),scope_private:this.I18n.t("js.label_custom_queries"),no_results:this.I18n.t("js.autocompleter.notFoundText")},this.menuItems=[],this.viewCategories$=new S.X([]),this.search$=new S.X(""),this.initialized=!1,(0,pr.E)(this)}set search(o){this.search$.value!==o&&this.search$.next(o)}ngOnInit(){this.apiViewType=`Views::${this.viewType}`,this.mainMenuService.onActivate(...this.menuItems).subscribe(()=>this.initializeAutocomplete()),this.views$=(0,Ai.aj)([this.search$,this.viewCategories$]).pipe((0,Yt.U)(([o,s])=>s.map(w=>{var j;if(Ki.matchesText(w.title,o))return w;const ee=null===(j=w.children)||void 0===j?void 0:j.filter(me=>Ki.matchesText(me.title,o));return{title:w.title,children:ee,collapsible:!0}}).filter(w=>w.children&&w.children.length>0)))}initializeAutocomplete(){var o,s;if(this.initialized)return;const w=null===(s=null===(o=document.getElementById("main-menu-work-packages-wrapper"))||void 0===o?void 0:o.parentElement)||void 0===s?void 0:s.getElementsByClassName("main-menu--arrow-left-to-project")[0];w&&w.focus(),this.updateMenuOnChanges(),this.initializeViews(),this.initialized=!0}static matchesText(o,s){return o.toLowerCase().includes(s.toLowerCase())}initializeViews(){var o,s;const w={starred:[],default:[],public:[],private:[],createNew:[]},j={filters:[["type","=",[this.apiViewType]]]};this.projectId?null===(o=j.filters)||void 0===o||o.push(["project","=",[this.projectId]]):null===(s=j.filters)||void 0===s||s.push(["project","!*",[]]),this.viewsService.fetchViews(j).pipe(this.untilDestroyed()).subscribe(ee=>{ee._embedded.elements.sort((Je,qe)=>Je._links.query.title.localeCompare(qe._links.query.title)).forEach(Je=>{let qe="private";Je.public&&(qe="public"),Je.starred&&(qe="starred"),w[qe].push(this.toOpSideMenuItem(Je))});const me=this.opStaticQueries.getStaticQueriesForView(this.viewType),De=[{title:this.text.scope_starred,children:w.starred,collapsible:!0},{title:this.text.scope_default,children:me,collapsible:!0},{title:this.text.scope_global,children:w.public,collapsible:!0},{title:this.text.scope_private,children:w.private,collapsible:!0}];this.viewCategories$.next(De)})}toOpSideMenuItem(o){const{query:s}=o._links;return{title:s.title,uiSref:this.baseRoute,uiParams:{query_id:(0,Ae.Z)(s.href),query_props:""},uiOptions:{reload:!0}}}updateMenuOnChanges(){this.states.changes.queries.pipe(this.untilDestroyed()).subscribe(()=>this.initializeViews())}}Ki.\u0275fac=function(o){return new(o||Ki)(e.Y36(e.SBq),e.Y36(R.T),e.Y36(y.D),e.Y36(h.G),e.Y36(_u.p),e.Y36(yn),e.Y36(e.sBO),e.Y36(mu.s))},Ki.\u0275cmp=e.Xpm({type:Ki,selectors:[["op-view-select"]],inputs:{menuItems:"menuItems",projectId:"projectId",baseRoute:"baseRoute",viewType:"viewType"},features:[e.qOj],decls:10,vars:12,consts:[["id","viewSelect",1,"searchable-menu"],[1,"searchable-menu--search-container"],[1,"searchable-menu--search-bar"],["for","query-title-filter",1,"hidden-for-sighted",3,"textContent"],["type","text","name","query-title-filter","id","query-title-filter",1,"searchable-menu--search-input","ellipsis",3,"ngModel","ngModelChange"],[1,"icon-search","searchable-menu--search-icon"],[1,"searchable-menu--no-results-container",3,"hidden","textContent"],[1,"op-view-select--search-results",3,"items","collapsible","searchable"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"label",3),e.TgZ(4,"input",4),e.NdJ("ngModelChange",function(j){return s.search=j}),e.qZA(),e._UZ(5,"i",5),e.qZA(),e._UZ(6,"p",6),e.ALo(7,"async"),e._UZ(8,"op-sidemenu",7),e.ALo(9,"async"),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.label),e.xp6(1),e.Q6J("ngModel",s.search),e.uIk("placeholder",s.text.search),e.xp6(2),e.Q6J("hidden",e.lcZ(7,8,s.views$).length>0)("textContent",s.text.no_results),e.xp6(2),e.Q6J("items",e.lcZ(9,10,s.views$))("collapsible",!0)("searchable",!0))},directives:[d.Fj,d.JJ,d.On,an],pipes:[D.Ov],encapsulation:2,changeDetection:0});class xo extends si.N{constructor(o,s,w,j,ee){super(),this.elementRef=o,this.cdRef=s,this.globalSearchService=w,this.I18n=j,this.injector=ee,this.text={all_projects:this.I18n.t("js.global_search.title.all_projects"),project_and_subprojects:this.I18n.t("js.global_search.title.project_and_subprojects"),search_for:this.I18n.t("js.global_search.title.search_for"),in:this.I18n.t("js.label_in")}}ngOnInit(){(0,Ai.aj)([this.globalSearchService.searchTerm$,this.globalSearchService.projectScope$]).pipe((0,Hi.x)(),this.untilDestroyed()).subscribe(([o,s])=>{this.searchTerm=o,this.project=this.projectText(s),this.searchTitle=`${this.text.search_for} ${this.searchTerm} ${""===this.project?"":this.text.in} ${this.project}`,this.cdRef.detectChanges()})}projectText(o){const s=this.currentProjectService.name?this.currentProjectService.name:"";switch(o){case"all":return this.text.all_projects;case"current_project":return s;case"":return`${s} ${this.text.project_and_subprojects}`;default:return""}}}function vu(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",16),e.NdJ("click",function(j){e.CHM(s);const ee=e.oxw().$implicit;return e.oxw().clickTab(ee,j)}),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.ekj("op-tab-row--link_selected",s.id===w.currentTabId)("op-tab-row--link_disabled",void 0!==s.disable),e.Q6J("href",s.path,e.LSH)("textContent",s.name),e.uIk("title",w.tabTitle(s))}}function Cu(g,o){if(1&g&&(e._UZ(0,"op-tab-count",21),e.ALo(1,"async")),2&g){const s=e.oxw(2).$implicit,w=e.oxw();e.Q6J("count",e.lcZ(1,2,s.counter(w.injector))),e.uIk("data-qa-selector","tab-counter-"+s.name)}}function yu(g,o){if(1&g&&(e.TgZ(0,"span",23),e._uU(1),e.qZA()),2&g){const s=e.oxw().ngIf;e.xp6(1),e.hij(" (",s,")")}}function bu(g,o){if(1&g&&(e.ynx(0),e.YNc(1,yu,2,1,"span",22),e.BQk()),2&g){const s=o.ngIf,w=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",s>0&&!w.showCountAsBubble)}}function wu(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",17),e.NdJ("click",function(j){e.CHM(s);const ee=e.oxw().$implicit;return e.oxw().clickTab(ee,j)}),e._UZ(1,"span",18),e.YNc(2,Cu,2,4,"op-tab-count",19),e.YNc(3,bu,2,1,"ng-container",20),e.ALo(4,"async"),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.ekj("op-tab-row--link_disabled",void 0!==s.disable),e.Q6J("uiSref",s.route)("uiParams",s.routeParams),e.uIk("title",w.tabTitle(s)),e.xp6(1),e.Q6J("textContent",s.name),e.xp6(1),e.Q6J("ngIf",s.counter&&s.showCountAsBubble),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,8,s.counter(w.injector)))}}function Tu(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li",13),e.NdJ("dragenter",function(){const ee=e.CHM(s).$implicit;return e.oxw().startDebouncedTabActivation(ee)})("dragleave",function(){return e.CHM(s),e.oxw().cancelDebouncedTabActivation()}),e.YNc(1,vu,1,7,"a",14),e.YNc(2,wu,5,10,"a",15),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.uIk("data-tab-id",s.id)("data-qa-tab-id",s.id)("data-qa-tab-selected",s.id===w.currentTabId||void 0)("data-qa-tab-disabled",s.disable||void 0),e.xp6(1),e.Q6J("ngIf",!s.route),e.xp6(1),e.Q6J("ngIf",s.route)}}xo.\u0275fac=function(o){return new(o||xo)(e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(Vi),e.Y36(y.D),e.Y36(e.zs3))},xo.\u0275cmp=e.Xpm({type:xo,selectors:[["global-search-title"]],inputs:{searchTerm:"searchTerm",project:"project",projectScope:"projectScope",searchTitle:"searchTitle"},features:[e.qOj],decls:11,vars:5,consts:[[1,"toolbar-container"],[1,"toolbar"],[1,"title-container"],[1,"toolbar-items"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"h2"),e._uU(4),e.TgZ(5,"i"),e._uU(6),e.qZA(),e._uU(7),e.TgZ(8,"i"),e._uU(9),e.qZA(),e.qZA(),e._UZ(10,"ul",3),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.uIk("title",s.searchTitle),e.xp6(1),e.hij(" ",s.text.search_for," "),e.xp6(2),e.hij('"',s.searchTerm,'"'),e.xp6(1),e.hij(" ",""===s.project?"":s.text.in," "),e.xp6(2),e.Oqu(s.project))},encapsulation:2}),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",b.R)],xo.prototype,"currentProjectService",void 0);const ku=[[["","slot","actions"]]];class As extends _i.P{constructor(o,s,w,j){super(s,j,w),this.globalSearchService=o,this.$state=s,this.injector=w,this.classes=["global-search--tabs","scrollable-tabs"]}ngOnInit(){this.currentTabSub=this.globalSearchService.currentTab$.subscribe(o=>{this.currentTabId=o}),this.tabsSub=this.globalSearchService.tabs$.subscribe(o=>{this.tabs=o,this.tabs.map(s=>s.path="#")})}clickTab(o,s){super.clickTab(o,s),this.globalSearchService.currentTab=o.id,this.globalSearchService.submitSearch()}ngOnDestroy(){this.currentTabSub.unsubscribe(),this.tabsSub.unsubscribe()}}As.\u0275fac=function(o){return new(o||As)(e.Y36(Vi),e.Y36(Ke.StateService),e.Y36(e.zs3),e.Y36(e.sBO))},As.\u0275cmp=e.Xpm({type:As,selectors:[["global-search-tabs"]],features:[e.qOj],ngContentSelectors:["[slot=actions]"],decls:14,vars:5,consts:[[1,"op-scrollable-tabs",3,"ngClass"],[1,"op-scrollable-tabs--tab-container"],["scrollContainer",""],[1,"op-tab-row",3,"scroll"],["scrollPane",""],["class","op-tab-row--tab",3,"dragenter","dragleave",4,"ngFor","ngForOf","ngForTrackBy"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_left",3,"hidden","click"],["scrollLeftBtn",""],[1,"icon-arrow-left2"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_right",3,"hidden","click"],["scrollRightBtn",""],[1,"icon-arrow-right2"],[1,"op-scrollable-tabs--actions"],[1,"op-tab-row--tab",3,"dragenter","dragleave"],["class","op-tab-row--link",3,"href","op-tab-row--link_selected","op-tab-row--link_disabled","textContent","click",4,"ngIf"],["class","op-tab-row--link","uiSrefActive","op-tab-row--link_selected","href","","role","button",3,"uiSref","uiParams","op-tab-row--link_disabled","click",4,"ngIf"],[1,"op-tab-row--link",3,"href","textContent","click"],["uiSrefActive","op-tab-row--link_selected","href","","role","button",1,"op-tab-row--link",3,"uiSref","uiParams","click"],[3,"textContent"],[3,"count",4,"ngIf"],[4,"ngIf"],[3,"count"],["data-qa-selector","tab-count",4,"ngIf"],["data-qa-selector","tab-count"]],template:function(o,s){1&o&&(e.F$t(ku),e.TgZ(0,"div",0),e.TgZ(1,"div",1,2),e.TgZ(3,"ul",3,4),e.NdJ("scroll",function(){return s.onScroll()}),e.YNc(5,Tu,3,6,"li",5),e.qZA(),e.TgZ(6,"div",6,7),e.NdJ("click",function(){return s.scrollLeft()}),e._UZ(8,"span",8),e.qZA(),e.TgZ(9,"div",9,10),e.NdJ("click",function(){return s.scrollRight()}),e._UZ(11,"span",11),e.qZA(),e.qZA(),e.TgZ(12,"ul",12),e.Hsn(13),e.qZA(),e.qZA()),2&o&&(e.Q6J("ngClass",s.classes),e.xp6(5),e.Q6J("ngForOf",s.tabs)("ngForTrackBy",s.trackById),e.xp6(1),e.Q6J("hidden",s.hideLeftButton),e.xp6(3),e.Q6J("hidden",s.hideRightButton))},directives:[D.mk,D.sg,D.O5,Vt.AnchorUISref,Vt.UISrefActive,Vt.UISrefStatus,Vt.UISref],pipes:[D.Ov],encapsulation:2,changeDetection:0});var Eu=t(51784),Ou=t(44265);function Mu(g,o){if(1&g&&e._UZ(0,"op-principal",7),2&g){const s=e.oxw().$implicit;e.Q6J("principal",s)("hideName",!0)}}function Iu(g,o){if(1&g&&(e.YNc(0,Mu,1,2,"op-principal",5),e.TgZ(1,"span",6),e._uU(2),e.qZA()),2&g){const s=o.$implicit,w=o.search;e.Q6J("ngIf",s&&s.href),e.xp6(1),e.Q6J("opSearchHighlight",w),e.xp6(1),e.hij(" ",s.name," ")}}function Su(g,o){if(1&g&&e._UZ(0,"op-invite-user-button",9),2&g){const s=e.oxw(2);e.Q6J("projectId",s.inviteUserToProject)}}function Du(g,o){1&g&&e.YNc(0,Su,1,1,"ng-template",8)}class Tn extends Er.U{getAvailableUsers(o){return this.http.get(this.url,{params:new vi.LE({encoder:new Eu.c,fromObject:{q:o}}),responseType:"json",headers:{"Content-Type":"application/json; charset=utf-8"}})}}Tn.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Tn)))(s||Tn)}}(),Tn.\u0275cmp=e.Xpm({type:Tn,selectors:[["op-members-autocompleter"]],features:[e.qOj],decls:5,vars:12,consts:[[3,"model","openDirectly","getOptionsFn","trackByFn","multiple","labelForId","appendTo","focusDirectly","change","keydown.escape"],["op-autocompleter-option-tmp",""],[4,"ngIf"],["type","hidden",3,"name","value"],["hiddenInput",""],["size","mini",3,"principal","hideName",4,"ngIf"],[3,"opSearchHighlight"],["size","mini",3,"principal","hideName"],["op-autocompleter-footer-tmp",""],[1,"op-select-footer",3,"projectId"]],template:function(o,s){1&o&&(e.TgZ(0,"op-autocompleter",0),e.NdJ("change",function(j){return s.writeValue(j)})("keydown.escape",function(){return s.cancel.emit()}),e.YNc(1,Iu,3,3,"ng-template",1),e.YNc(2,Du,1,0,void 0,2),e.qZA(),e._UZ(3,"input",3,4)),2&o&&(e.Q6J("model",s.value)("openDirectly",!0)("getOptionsFn",s.getAvailableUsers.bind(s))("trackByFn",s.userTracker)("multiple",s.multiple)("labelForId",s.labelForId)("appendTo",s.appendTo)("openDirectly",s.openDirectly)("focusDirectly",s.focusDirectly),e.xp6(2),e.Q6J("ngIf",s.inviteUserToProject),e.xp6(1),e.Q6J("name",s.name)("value",s.plainValue))},directives:[Or.s,ma.u,D.O5,fa.U,vt.N,Ou.q],encapsulation:2}),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",vi.eN)],Tn.prototype,"http",void 0),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",je.j)],Tn.prototype,"pathHelper",void 0);class Ni{constructor(o){this.injector=o,this.text={edit:this.i18n.t("js.button_edit"),delete:this.i18n.t("js.button_delete"),error:this.i18n.t("js.error.internal"),areYouSure:this.i18n.t("js.text_are_you_sure")}}editTimeEntry(){this.loadEntry().then(o=>{this.timeEntryEditService.edit(o).then(()=>{window.location.reload()}).catch(()=>{})})}deleteTimeEntry(){!window.confirm(this.text.areYouSure)||this.loadEntry().then(o=>{this.apiv3Service.time_entries.id(o).delete().subscribe(()=>window.location.reload(),s=>this.toastService.addError(s||this.text.error))})}loadEntry(){const o=this.elementRef.nativeElement.dataset.entry;return this.apiv3Service.time_entries.id(o).get().toPromise()}}Ni.\u0275fac=function(o){return new(o||Ni)(e.Y36(e.zs3))},Ni.\u0275cmp=e.Xpm({type:Ni,selectors:[["time-entry--trigger-actions-entry"]],features:[e._Bn([Pe.l,Ee.d])],decls:4,vars:2,consts:[[1,"no-decoration-on-hover",3,"title","click"],["icon-classes","icon-context icon-edit"],["icon-classes","icon-context icon-delete"]],template:function(o,s){1&o&&(e.TgZ(0,"a",0),e.NdJ("click",function(){return s.editTimeEntry()}),e._UZ(1,"op-icon",1),e.qZA(),e.TgZ(2,"a",0),e.NdJ("click",function(){return s.deleteTimeEntry()}),e._UZ(3,"op-icon",2),e.qZA()),2&o&&(e.Q6J("title",s.text.edit),e.xp6(2),e.Q6J("title",s.text.delete))},directives:[Ye.o],encapsulation:2,changeDetection:0}),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",Ee.d)],Ni.prototype,"timeEntryEditService",void 0),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",R.T)],Ni.prototype,"apiv3Service",void 0),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",M.kl)],Ni.prototype,"toastService",void 0),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",e.SBq)],Ni.prototype,"elementRef",void 0),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",y.D)],Ni.prototype,"i18n",void 0),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",e.sBO)],Ni.prototype,"cdRef",void 0);var va=t(67731),js=t(60874),Zu=t(90425),Ca=t(45871);class Vn{constructor(o,s,w,j){this.apiV3Service=o,this.transitions=s,this.currentProject=w,this.I18n=j,this.text={not_found:this.I18n.t("js.editor.macro.attribute_reference.not_found")},this.cache$=(0,$n.r9)(),s.onStart({},()=>(this.cache$.clear(),!0))}require(o,s){const w=`${o}-${s}`,j=this.cache$.get(w);if(j.isPristine()){const ee=this.load(o,s).pipe((0,Gt.h)(me=>!!me)).toPromise();return j.clearAndPutFromPromise(ee),ee}return j.values$().pipe((0,fn.q)(1),(0,ur.b)(ee=>console.log(`VAL ${ee}`),ee=>console.error(`ERR ${ee}`))).toPromise()}load(o,s){switch(o){case"workPackage":return this.loadWorkPackage(s);case"project":return this.loadProject(s);default:return Zu.C}}loadProject(o){return(o=o||this.currentProject.id)?this.apiV3Service.projects.id(o).get().pipe((0,fn.q)(1)):(0,Ca._)(this.text.not_found)}loadWorkPackage(o){return o?/^[1-9]\d*$/.test(o)?this.apiV3Service.work_packages.id(o).get().pipe((0,fn.q)(1)):this.apiV3Service.withOptionalProject(this.currentProject.id).work_packages.filterByTypeaheadOrId(o,!1,{pageSize:"1"}).get().pipe((0,fn.q)(1),(0,Yt.U)(s=>s.elements[0]||null)):(0,Ca._)(this.text.not_found)}}Vn.\u0275fac=function(o){return new(o||Vn)(e.LFG(R.T),e.LFG(Ke.TransitionService),e.LFG(b.R),e.LFG(y.D))},Vn.\u0275prov=e.Yz7({token:Vn,factory:Vn.\u0275fac,providedIn:"root"});const Ru=["displayFieldContainer"];class Eo{constructor(o,s,w){this.injector=o,this.displayFieldService=s,this.schemaCache=w,this.containerType="table",this.displayFieldOptions={}}ngOnInit(){this.schemaCache.ensureLoaded(this.resource).then(o=>{this.render(o[this.fieldName])})}render(o){const s=this.getDisplayFieldInstance(o),w=this.container.nativeElement;w.hidden=!1,s.isEmpty()?w.textContent="-":s.render(w,s.valueString)}getDisplayFieldInstance(o){if(this.displayClass){const s=new this.displayClass(this.fieldName,this.displayFieldContext);return s.apply(this.resource,o),s}return this.displayFieldService.getField(this.resource,this.fieldName,o,this.displayFieldContext)}get displayFieldContext(){return{injector:this.injector,container:this.containerType,options:this.displayFieldOptions}}}Eo.\u0275fac=function(o){return new(o||Eo)(e.Y36(e.zs3),e.Y36(js.i),e.Y36(lt.y))},Eo.\u0275cmp=e.Xpm({type:Eo,selectors:[["display-field"]],viewQuery:function(o,s){if(1&o&&e.Gf(Ru,5),2&o){let w;e.iGM(w=e.CRH())&&(s.container=w.first)}},inputs:{resource:"resource",fieldName:"fieldName",displayClass:"displayClass",containerType:"containerType",displayFieldOptions:"displayFieldOptions"},decls:2,vars:0,consts:[["displayFieldContainer",""]],template:function(o,s){1&o&&e._UZ(0,"span",null,0)},encapsulation:2,changeDetection:0});const Fu=["displayContainer"];function Uu(g,o){if(1&g&&(e.TgZ(0,"span"),e._UZ(1,"i",2),e._UZ(2,"em",3),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.error)}}const Lu=function(){return{writable:!1}};function Bu(g,o){if(1&g&&e._UZ(0,"display-field",4),2&g){const s=e.oxw();e.Q6J("resource",s.resource)("displayFieldOptions",e.DdM(3,Lu))("fieldName",s.fieldName)}}class Zs{constructor(o,s,w,j,ee,me,De){this.elementRef=o,this.injector=s,this.resourceLoader=w,this.schemaCache=j,this.displayField=ee,this.I18n=me,this.cdRef=De,this.error=null,this.text={help:this.I18n.t("js.editor.macro.attribute_reference.macro_help_tooltip"),placeholder:this.I18n.t("js.placeholders.default"),not_found:this.I18n.t("js.editor.macro.attribute_reference.not_found"),invalid_attribute:Je=>this.I18n.t("js.editor.macro.attribute_reference.invalid_attribute",{name:Je})},this.hostTitle=this.text.help}ngOnInit(){const o=this.elementRef.nativeElement,s=o.dataset.model,w=o.dataset.id,j=o.dataset.attribute;this.loadAndRender(s,w,j)}loadAndRender(o,s,w){return(0,se.mG)(this,void 0,void 0,function*(){let j;try{j=yield this.resourceLoader.require(o,s)}catch(Je){return console.error(`Failed to render macro ${Je}`),this.markError(this.text.not_found)}if(!j)return void this.markError(this.text.not_found);const ee=yield this.schemaCache.ensureLoaded(j),me=ee.attributeFromLocalizedName(w)||w;ee[me]?(this.resource=j,this.fieldName=me):this.markError(this.text.invalid_attribute(w)),this.cdRef.detectChanges()})}markError(o){this.error=this.I18n.t("js.editor.macro.error",{message:o}),this.cdRef.detectChanges()}}Zs.\u0275fac=function(o){return new(o||Zs)(e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(Vn),e.Y36(lt.y),e.Y36(js.i),e.Y36(y.D),e.Y36(e.sBO))},Zs.\u0275cmp=e.Xpm({type:Zs,selectors:[["macro",8,"macro--attribute-value"]],viewQuery:function(o,s){if(1&o&&e.Gf(Fu,5),2&o){let w;e.iGM(w=e.CRH())&&(s.displayContainer=w.first)}},hostVars:1,hostBindings:function(o,s){2&o&&e.Ikx("title",s.hostTitle)},features:[e._Bn([Pe.l])],attrs:["class","macro--attribute-value"],decls:2,vars:2,consts:[[4,"ngIf"],[3,"resource","displayFieldOptions","fieldName",4,"ngIf"],[1,"icon","icon-error"],[3,"textContent"],[3,"resource","displayFieldOptions","fieldName"]],template:function(o,s){1&o&&(e.YNc(0,Uu,3,1,"span",0),e.YNc(1,Bu,1,4,"display-field",1)),2&o&&(e.Q6J("ngIf",s.error),e.xp6(1),e.Q6J("ngIf",!!s.resource))},directives:[D.O5,Eo],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}@media screen{[_nghost-%COMP%]{display:inline-block;background:rgba(218,223,225,.19);border:1px solid transparent;padding:2px}[_nghost-%COMP%]:hover{cursor:default;border-color:#c7c7c7;background:rgba(218,223,225,.75)}}"],changeDetection:0});function Yu(g,o){if(1&g&&(e.ynx(0),e._UZ(1,"span",1),e._UZ(2,"attribute-help-text",2),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.label),e.xp6(1),e.Q6J("attribute",s.attribute)("attributeScope",s.attributeScope)}}function $u(g,o){if(1&g&&(e.TgZ(0,"span"),e._UZ(1,"i",3),e._UZ(2,"em",1),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.error)}}class Rs{constructor(o,s,w,j,ee,me,De){this.elementRef=o,this.injector=s,this.resourceLoader=w,this.schemaCache=j,this.displayField=ee,this.I18n=me,this.cdRef=De,this.error=null,this.text={help:this.I18n.t("js.editor.macro.attribute_reference.macro_help_tooltip"),not_found:this.I18n.t("js.editor.macro.attribute_reference.not_found"),invalid_attribute:Je=>this.I18n.t("js.editor.macro.attribute_reference.invalid_attribute",{name:Je})},this.hostTitle=this.text.help,this.resource=null}ngOnInit(){const o=this.elementRef.nativeElement,s=o.dataset.model,w=o.dataset.id,j=o.dataset.attribute;var g;this.attributeScope=(g=s).charAt(0).toUpperCase()+g.slice(1),this.loadResourceAttribute(s,w,j)}loadResourceAttribute(o,s,w){var j;return(0,se.mG)(this,void 0,void 0,function*(){let ee;try{this.resource=ee=yield this.resourceLoader.require(o,s)}catch(De){return console.error(`Failed to render macro ${De}`),this.markError(this.text.not_found)}if(!ee)return void this.markError(this.text.not_found);const me=yield this.schemaCache.ensureLoaded(ee);this.attribute=me.attributeFromLocalizedName(w)||w,this.label=null===(j=me[this.attribute])||void 0===j?void 0:j.name,this.label||this.markError(this.text.invalid_attribute(w)),this.cdRef.detectChanges()})}markError(o){this.error=this.I18n.t("js.editor.macro.error",{message:o}),this.cdRef.detectChanges()}}Rs.\u0275fac=function(o){return new(o||Rs)(e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(Vn),e.Y36(lt.y),e.Y36(js.i),e.Y36(y.D),e.Y36(e.sBO))},Rs.\u0275cmp=e.Xpm({type:Rs,selectors:[["macro",8,"macro--attribute-label"]],hostVars:1,hostBindings:function(o,s){2&o&&e.Ikx("title",s.hostTitle)},features:[e._Bn([Pe.l])],attrs:["class","macro--attribute-label"],decls:2,vars:2,consts:[[4,"ngIf"],[3,"textContent"],[3,"attribute","attributeScope"],[1,"icon","icon-error"]],template:function(o,s){1&o&&(e.YNc(0,Yu,3,3,"ng-container",0),e.YNc(1,$u,3,1,"span",0)),2&o&&(e.Q6J("ngIf",s.resource),e.xp6(1),e.Q6J("ngIf",s.error))},directives:[D.O5,Dt.y],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}@media screen{[_nghost-%COMP%]{display:inline-block;background:rgba(218,223,225,.19);border:1px solid transparent;padding:2px}[_nghost-%COMP%]:hover{cursor:default;border-color:#c7c7c7;background:rgba(218,223,225,.75)}}"],changeDetection:0});var Hu=t(74215);const Fs=function(){return{writable:!1}};function Ku(g,o){if(1&g&&e._UZ(0,"display-field",5),2&g){const s=e.oxw().ngIf;e.Q6J("resource",s)("displayFieldOptions",e.DdM(2,Fs))}}function Gu(g,o){if(1&g&&e._UZ(0,"display-field",8),2&g){const s=e.oxw(2).ngIf;e.Q6J("resource",s)("displayFieldOptions",e.DdM(2,Fs))}}function qu(g,o){if(1&g&&e._UZ(0,"display-field",9),2&g){const s=e.oxw(2).ngIf,w=e.oxw();e.Q6J("resource",s)("displayFieldOptions",e.DdM(3,Fs))("displayClass",w.dateDisplayField)}}function Xu(g,o){if(1&g&&(e.ynx(0),e._uU(1," ("),e.YNc(2,Gu,1,3,"display-field",6),e.YNc(3,qu,1,4,"display-field",7),e._uU(4,") "),e.BQk()),2&g){const s=e.oxw().ngIf;e.xp6(2),e.Q6J("ngIf",!!s.date),e.xp6(1),e.Q6J("ngIf",!s.date)}}function eh(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Ku,1,3,"display-field",1),e._UZ(2,"display-field",2),e.TgZ(3,"a",3),e._uU(4),e.qZA(),e._UZ(5,"display-field",4),e.YNc(6,Xu,5,2,"ng-container",0),e.BQk()),2&g){const s=o.ngIf,w=e.oxw();e.xp6(1),e.Q6J("ngIf",w.detailed),e.xp6(1),e.Q6J("resource",s)("displayFieldOptions",e.DdM(9,Fs)),e.xp6(1),e.Q6J("href",w.workPackageLink,e.LSH),e.uIk("data-work-package-id",s.id),e.xp6(1),e.hij(" #",s.id,": "),e.xp6(1),e.Q6J("resource",s)("displayFieldOptions",e.DdM(10,Fs)),e.xp6(1),e.Q6J("ngIf",w.detailed)}}function th(g,o){if(1&g&&(e.TgZ(0,"span"),e._UZ(1,"i",10),e._UZ(2,"em",11),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.error)}}class Ws{constructor(o,s,w,j,ee,me,De,Je){this.elementRef=o,this.injector=s,this.apiV3Service=w,this.schemaCache=j,this.displayField=ee,this.pathHelper=me,this.I18n=De,this.cdRef=Je,this.error=null,this.text={not_found:this.I18n.t("js.editor.macro.attribute_reference.not_found"),help:this.I18n.t("js.editor.macro.attribute_reference.macro_help_tooltip")},this.hostTitle=this.text.help,this.dateDisplayField=Hu.Z,this.detailed=!1}ngOnInit(){const o=this.elementRef.nativeElement,s=o.dataset.id;this.detailed="true"===o.dataset.detailed,this.workPackageLink=this.pathHelper.workPackagePath(s),this.workPackage$=this.apiV3Service.work_packages.id(s).get().pipe((0,ur.b)({error:w=>this.markError(this.text.not_found)}))}markError(o){console.error(`Failed to render macro ${o}`),this.error=this.I18n.t("js.editor.macro.error",{message:o}),this.cdRef.detectChanges()}}Ws.\u0275fac=function(o){return new(o||Ws)(e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(R.T),e.Y36(lt.y),e.Y36(js.i),e.Y36(je.j),e.Y36(y.D),e.Y36(e.sBO))},Ws.\u0275cmp=e.Xpm({type:Ws,selectors:[["macro",8,"macro--wp-quickinfo"]],hostVars:1,hostBindings:function(o,s){2&o&&e.Ikx("title",s.hostTitle)},features:[e._Bn([Pe.l])],attrs:["class","macro--wp-quickinfo"],decls:3,vars:4,consts:[[4,"ngIf"],["fieldName","status",3,"resource","displayFieldOptions",4,"ngIf"],["fieldName","type",3,"resource","displayFieldOptions"],[1,"work-package--quickinfo","preview-trigger",3,"href"],["fieldName","subject",3,"resource","displayFieldOptions"],["fieldName","status",3,"resource","displayFieldOptions"],["fieldName","date",3,"resource","displayFieldOptions",4,"ngIf"],["fieldName","startDate",3,"resource","displayFieldOptions","displayClass",4,"ngIf"],["fieldName","date",3,"resource","displayFieldOptions"],["fieldName","startDate",3,"resource","displayFieldOptions","displayClass"],[1,"icon","icon-error"],[3,"textContent"]],template:function(o,s){1&o&&(e.YNc(0,eh,7,11,"ng-container",0),e.ALo(1,"async"),e.YNc(2,th,3,1,"span",0)),2&o&&(e.Q6J("ngIf",e.lcZ(1,2,s.workPackage$)),e.xp6(2),e.Q6J("ngIf",s.error))},directives:[D.O5,Eo],pipes:[D.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}@media screen{[_nghost-%COMP%]{display:inline-block;background:rgba(218,223,225,.19);border:1px solid transparent;padding:2px}[_nghost-%COMP%]:hover{cursor:default;border-color:#c7c7c7;background:rgba(218,223,225,.75)}}display-field[_ngcontent-%COMP%]{padding-right:2px}"],changeDetection:0});var ya=t(96091),nh=t(18137);class Hn{constructor(o){this.apiV3Service=o}triggerBackup(o,s=!0){return this.apiV3Service.backups.post(o,s)}}Hn.\u0275fac=function(o){return new(o||Hn)(e.LFG(R.T))},Hn.\u0275prov=e.Yz7({token:Hn,factory:Hn.\u0275fac,providedIn:"root"});const oh=["backupTokenInput"];class Oo{constructor(o,s,w,j,ee,me){this.elementRef=o,this.injector=s,this.i18n=w,this.toastService=j,this.opModalService=ee,this.pathHelper=me,this.text={info:this.i18n.t("js.backup.info"),note:this.i18n.t("js.backup.note"),title:this.i18n.t("js.backup.title"),lastBackup:this.i18n.t("js.backup.last_backup"),lastBackupFrom:this.i18n.t("js.backup.last_backup_from"),includeAttachments:this.i18n.t("js.backup.include_attachments"),options:this.i18n.t("js.backup.options"),downloadBackup:this.i18n.t("js.backup.download_backup"),requestBackup:this.i18n.t("js.backup.request_backup"),attachmentsDisabled:this.i18n.t("js.backup.attachments_disabled")},this.jobStatusId=this.elementRef.nativeElement.dataset.jobStatusId,this.lastBackupDate=this.elementRef.nativeElement.dataset.lastBackupDate,this.lastBackupAttachmentId=this.elementRef.nativeElement.dataset.lastBackupAttachmentId,this.mayIncludeAttachments="false"!=this.elementRef.nativeElement.dataset.mayIncludeAttachments,this.isInProgress=!1,this.includeAttachments=!0,this.backupToken="",this.includeAttachments=this.mayIncludeAttachments}ngAfterViewInit(){this.backupTokenInput.nativeElement.focus()}isDownloadReady(){return void 0!==this.jobStatusId&&""!==this.jobStatusId&&void 0!==this.lastBackupAttachmentId&&""!==this.lastBackupAttachmentId}getDownloadUrl(){return this.pathHelper.attachmentDownloadPath(this.lastBackupAttachmentId,void 0)}includeAttachmentsDefault(){return this.mayIncludeAttachments}includeAttachmentsTitle(){return this.mayIncludeAttachments?"":this.text.attachmentsDisabled}triggerBackup(o){o&&(o.stopPropagation(),o.preventDefault());const{backupToken:s}=this;this.backupToken="",this.opBackup.triggerBackup(s,this.includeAttachments).subscribe(w=>{this.jobStatusId=w.jobStatusId,this.opModalService.show(nh.L,"global",{jobId:w.jobStatusId})},w=>{this.toastService.addError(w.message)})}}function ba(g){const{locale:o}=I18n;return g[o]||g.en}function rh(g,o){if(1&g&&(e.TgZ(0,"div",27),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Oqu(s.eeTrialService.errorMsg)}}function ah(g,o){if(1&g&&e._UZ(0,"p",28),2&g){const s=e.oxw();e.Q6J("textContent",s.text.domain_mismatch)}}function ch(g,o){if(1&g&&e._UZ(0,"p",28),2&g){const s=e.oxw();e.Q6J("textContent",s.eeTrialService.errorMsg)}}Oo.\u0275fac=function(o){return new(o||Oo)(e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(y.D),e.Y36(M.kl),e.Y36(He.S),e.Y36(je.j))},Oo.\u0275cmp=e.Xpm({type:Oo,selectors:[["backup"]],viewQuery:function(o,s){if(1&o&&e.Gf(oh,5),2&o){let w;e.iGM(w=e.CRH())&&(s.backupTokenInput=w.first)}},decls:41,vars:17,consts:[["method","get",1,"form","-bordered","-compressed",3,"action","hidden"],[1,"form--section"],[1,"form--section-title"],[1,"form--field"],[1,"form--label"],[1,"form--field-container"],[1,"form--text-field-container"],["name","button","type","submit",1,"button"],[1,"button--icon","icon-save"],[1,"button--text"],["action","#",1,"form","danger-zone"],[1,"wiki"],[1,"danger-zone--warning"],[1,"icon","icon-error"],[1,"form--fieldset"],[1,"form--fieldset-legend"],[1,"form--label-with-check-box",3,"title"],[1,"form--check-box-container"],["type","checkbox",1,"form--check-box",3,"checked","disabled","change"],[1,"danger-zone--verification"],["type","password","name","backupToken","placeholder","Backup token","required","required",3,"value","input"],["backupTokenInput",""],["name","button","type","submit",1,"-highlight","button",3,"disabled","click"],[1,"button--icon","icon-export"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.TgZ(1,"section",1),e.TgZ(2,"h3",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.TgZ(5,"label",4),e._uU(6),e.qZA(),e.TgZ(7,"div",5),e.TgZ(8,"div",6),e.TgZ(9,"em"),e._uU(10),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"button",7),e._UZ(12,"i",8),e.TgZ(13,"span",9),e._uU(14),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(15,"form",10),e.TgZ(16,"div",11),e.TgZ(17,"section",1),e.TgZ(18,"h3",2),e._uU(19),e.qZA(),e.TgZ(20,"p"),e._uU(21),e.qZA(),e.TgZ(22,"p",12),e._UZ(23,"span",13),e.TgZ(24,"span"),e._uU(25),e.qZA(),e.qZA(),e.TgZ(26,"div"),e.TgZ(27,"fieldset",14),e.TgZ(28,"legend",15),e._uU(29),e.qZA(),e.TgZ(30,"label",16),e.TgZ(31,"div",17),e.TgZ(32,"input",18),e.NdJ("change",function(){return s.includeAttachments=!s.includeAttachments}),e.qZA(),e.qZA(),e._uU(33),e.qZA(),e.qZA(),e.qZA(),e.TgZ(34,"div",19),e.TgZ(35,"input",20,21),e.NdJ("input",function(j){return s.backupToken=j.target.value}),e.qZA(),e.TgZ(37,"button",22),e.NdJ("click",function(j){return s.triggerBackup(j)}),e._UZ(38,"i",23),e.TgZ(39,"span",9),e._uU(40),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("action",s.getDownloadUrl(),e.LSH)("hidden",!s.isDownloadReady()),e.xp6(3),e.hij(" ",s.text.lastBackup," "),e.xp6(3),e.hij("",s.text.lastBackupFrom,":"),e.xp6(4),e.Oqu(s.lastBackupDate),e.xp6(4),e.Oqu(s.text.downloadBackup),e.xp6(5),e.hij(" ",s.text.title," "),e.xp6(2),e.hij(" ",s.text.info," "),e.xp6(4),e.Oqu(s.text.note),e.xp6(4),e.hij(" ",s.text.options," "),e.xp6(1),e.Q6J("title",s.includeAttachmentsTitle()),e.xp6(2),e.Q6J("checked",s.includeAttachments)("disabled",!s.mayIncludeAttachments),e.xp6(1),e.hij(" ",s.text.includeAttachments," "),e.xp6(2),e.Q6J("value",s.backupToken),e.xp6(2),e.Q6J("disabled",0==s.backupToken.length),e.xp6(3),e.Oqu(s.text.requestBackup))},encapsulation:2}),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",Hn)],Oo.prototype,"opBackup",void 0);const wa=function(g){return{"-required-highlighting":g}};class Mo{constructor(o,s,w,j,ee,me){this.elementRef=o,this.I18n=s,this.formBuilder=w,this.currentUserService=j,this.configurationService=ee,this.eeTrialService=me,this.userData=this.eeTrialService.userData$.getValueOr({}),this.requestHost=window.location.host,this.configuredHost=this.configurationService.hostName,this.trialForm=this.formBuilder.group({company:[this.userData.company,d.kI.required],first_name:[this.userData.first_name,d.kI.required],last_name:[this.userData.last_name,d.kI.required],email:["",[d.kI.required,d.kI.email]],domain:[this.userData.domain||this.configuredHost,d.kI.required],general_consent:[null,d.kI.required],newsletter_consent:null,language:this.currentUserService.language}),this.text={general_consent:this.I18n.t("js.admin.enterprise.trial.form.general_consent",{link_terms:ba({en:"https://www.openproject.org/terms-of-service/",de:"https://www.openproject.org/de/nutzungsbedingungen/"}),link_privacy:ba({en:"https://www.openproject.org/data-privacy-and-security/",de:"https://www.openproject.org/de/datenschutz/"})}),label_test_ee:this.I18n.t("js.admin.enterprise.trial.form.test_ee"),label_company:this.I18n.t("js.admin.enterprise.trial.form.label_company"),label_first_name:this.I18n.t("js.admin.enterprise.trial.form.label_first_name"),label_last_name:this.I18n.t("js.admin.enterprise.trial.form.label_last_name"),label_email:this.I18n.t("js.label_email"),label_domain:this.I18n.t("js.admin.enterprise.trial.form.label_domain"),domain_mismatch:this.I18n.t("js.admin.enterprise.trial.form.domain_mismatch"),privacy_policy:this.I18n.t("js.admin.enterprise.trial.form.privacy_policy"),receive_newsletter:this.I18n.t("js.admin.enterprise.trial.form.receive_newsletter",{link:"https://www.openproject.org/newsletter/"}),terms_of_service:this.I18n.t("js.admin.enterprise.trial.form.terms_of_service")}}checkMailField(){""!==this.trialForm.value.email&&this.trialForm.controls.email.errors?this.eeTrialService.emailInvalid=!0:(this.eeTrialService.emailInvalid=!1,this.eeTrialService.error=void 0)}}Mo.\u0275fac=function(o){return new(o||Mo)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(d.qu),e.Y36(Nn.S),e.Y36(Me.e),e.Y36(ji))},Mo.\u0275cmp=e.Xpm({type:Mo,selectors:[["enterprise-trial-form"]],decls:47,vars:17,consts:[["id","enterprise-trial-form",1,"form",3,"formGroup"],[1,"form--field","-wide-label","-required"],["for","trial-company-name",1,"form--label"],[1,"form--field-container"],[1,"form--text-field-container"],["type","text","id","trial-company-name","formControlName","company",1,"form--text-field"],["for","trial-first-name",1,"form--label"],["type","text","id","trial-first-name","formControlName","first_name",1,"form--text-field"],["for","trial-last-name",1,"form--label"],["type","text","id","trial-last-name","formControlName","last_name",1,"form--text-field"],["for","trial-email",1,"form--label"],[1,"form--text-field-container",3,"ngClass"],["type","email","id","trial-email","formControlName","email",1,"form--text-field",3,"blur"],["class","form--field-instructions op-ee-trial-email-error",4,"ngIf"],["for","trial-domain-name",1,"form--label"],["type","text","id","trial-domain-name","formControlName","domain","disabled","",1,"form--text-field"],[1,"form--field-instructions"],[3,"textContent",4,"ngIf"],[1,"form--field","-required"],["for","trial-general-consent",1,"form--label-with-check-box","-no-ellipsis"],[1,"form--check-box-container"],["type","checkbox","id","trial-general-consent","formControlName","general_consent","required","",1,"form--check-box"],[3,"innerHTML"],[1,"form--field"],["for","trial-newsletter-consent",1,"form--label-with-check-box","-no-ellipsis"],["type","checkbox","id","trial-newsletter-consent","formControlName","newsletter_consent",1,"form--check-box"],[3,"innerHtml"],[1,"form--field-instructions","op-ee-trial-email-error"],[3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.TgZ(1,"div",1),e.TgZ(2,"label",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e._UZ(6,"input",5),e.qZA(),e.qZA(),e.qZA(),e.TgZ(7,"div",1),e.TgZ(8,"label",6),e._uU(9),e.qZA(),e.TgZ(10,"div",3),e.TgZ(11,"div",4),e._UZ(12,"input",7),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"div",1),e.TgZ(14,"label",8),e._uU(15),e.qZA(),e.TgZ(16,"div",3),e.TgZ(17,"div",4),e._UZ(18,"input",9),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"div",1),e.TgZ(20,"label",10),e._uU(21),e.qZA(),e.TgZ(22,"div",3),e.TgZ(23,"div",11),e.TgZ(24,"input",12),e.NdJ("blur",function(){return s.checkMailField()}),e.qZA(),e.qZA(),e.qZA(),e.YNc(25,rh,2,1,"div",13),e.qZA(),e.TgZ(26,"div",1),e.TgZ(27,"label",14),e._uU(28),e.qZA(),e.TgZ(29,"div",3),e.TgZ(30,"div",11),e._UZ(31,"input",15),e.qZA(),e.qZA(),e.TgZ(32,"div",16),e.YNc(33,ah,1,1,"p",17),e.YNc(34,ch,1,1,"p",17),e.qZA(),e.qZA(),e.TgZ(35,"div",18),e.TgZ(36,"div",3),e.TgZ(37,"label",19),e.TgZ(38,"div",20),e._UZ(39,"input",21),e.qZA(),e._UZ(40,"span",22),e.qZA(),e.qZA(),e.qZA(),e.TgZ(41,"div",23),e.TgZ(42,"div",3),e.TgZ(43,"label",24),e.TgZ(44,"div",20),e._UZ(45,"input",25),e.qZA(),e._UZ(46,"span",26),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("formGroup",s.trialForm),e.xp6(3),e.Oqu(s.text.label_company),e.xp6(6),e.Oqu(s.text.label_first_name),e.xp6(6),e.Oqu(s.text.label_last_name),e.xp6(6),e.Oqu(s.text.label_email),e.xp6(2),e.Q6J("ngClass",e.VKq(13,wa,s.eeTrialService.emailError)),e.xp6(2),e.Q6J("ngIf",s.eeTrialService.emailError),e.xp6(3),e.Oqu(s.text.label_domain),e.xp6(2),e.Q6J("ngClass",e.VKq(15,wa,s.eeTrialService.domainTaken)),e.xp6(3),e.Q6J("ngIf",s.requestHost!==s.configuredHost),e.xp6(1),e.Q6J("ngIf",s.eeTrialService.domainTaken),e.xp6(6),e.Q6J("innerHTML",s.text.general_consent,e.oJD),e.xp6(6),e.Q6J("innerHtml",s.text.receive_newsletter,e.oJD))},directives:[d._Y,d.JL,d.sg,d.Fj,d.JJ,d.u,D.mk,D.O5,d.Wl,d.Zs],styles:[".op-ee-trial-email-error[_ngcontent-%COMP%]{width:min-content}"]});class Ta extends si.N{constructor(o){super(),this.I18n=o,this.text={label_email:this.I18n.t("js.label_email"),label_expires_at:this.I18n.t("js.admin.enterprise.trial.form.label_expires_at"),label_maximum_users:this.I18n.t("js.admin.enterprise.trial.form.label_maximum_users"),label_company:this.I18n.t("js.admin.enterprise.trial.form.label_company"),label_domain:this.I18n.t("js.admin.enterprise.trial.form.label_domain"),label_starts_at:this.I18n.t("js.admin.enterprise.trial.form.label_starts_at"),label_subscriber:this.I18n.t("js.admin.enterprise.trial.form.label_subscriber"),text_expired:this.I18n.t("js.admin.enterprise.text_expired"),text_reprieve_days_left:s=>this.I18n.t("js.admin.enterprise.text_reprieve_days_left",{days:s})}}}function dh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_company)}}function ph(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.company)}}function uh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_domain)}}function hh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.domain)}}function _h(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_maximum_users)}}function mh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.userCount)}}function gh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_starts_at)}}function fh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.startsAt)}}function vh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_expires_at)}}function Ch(g,o){if(1&g&&e._UZ(0,"span",10),2&g){const s=e.oxw(2);e.Q6J("textContent",s.expiredWarningText)}}function yh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.YNc(3,Ch,1,1,"span",9),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.expiresAt),e.xp6(1),e.Q6J("ngIf",s.isExpired)}}class Us extends Ta{constructor(o,s,w,j,ee,me){super(w),this.elementRef=o,this.cdRef=s,this.I18n=w,this.http=j,this.Gon=ee,this.eeTrialService=me}ngOnInit(){this.subscriber||(this.eeTrialService.userData$.values$().pipe((0,Hi.x)(),this.untilDestroyed()).subscribe(o=>{this.formatUserData(o),this.cdRef.detectChanges()}),this.initialize())}initialize(){const o=this.Gon.get("ee_trial_key");o&&!this.eeTrialService.userData$.hasValue()&&(this.eeTrialService.trialLink=`${this.eeTrialService.baseUrlAugur}/public/v1/trials/${o.value}`,this.getUserDataFromAugur())}getUserDataFromAugur(){this.http.get(`${this.eeTrialService.trialLink}/details`,{headers:{[ds.i]:"true"}}).toPromise().then(o=>{this.eeTrialService.userData$.putValue(o),this.eeTrialService.retryConfirmation()}).catch(o=>{this.eeTrialService.getToken()})}formatUserData(o){this.subscriber=`${o.first_name} ${o.last_name}`,this.email=o.email,this.company=o.company,this.domain=o.domain}}function bh(g,o){if(1&g&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&g){const s=e.oxw(2);e.xp6(1),e.Oqu(s.text.session_timeout)}}function wh(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"span",3),e._uU(1),e.TgZ(2,"button",4),e.NdJ("click",function(){return e.CHM(s),e.oxw().resendMail()}),e._uU(3),e.qZA(),e.YNc(4,bh,2,1,"p",5),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.status_waiting," "),e.xp6(2),e.hij(" ",s.text.resend,""),e.xp6(1),e.Q6J("ngIf",s.eeTrialService.cancelled)}}function Th(g,o){if(1&g&&(e.TgZ(0,"span",6),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.status_confirmed,"")}}Us.\u0275fac=function(o){return new(o||Us)(e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(y.D),e.Y36(vi.eN),e.Y36(us.U),e.Y36(ji))},Us.\u0275cmp=e.Xpm({type:Us,selectors:[["enterprise-active-trial"]],features:[e.qOj],decls:21,vars:14,consts:[["data-qa-selector","op-enterprise--active-token",1,"op-enterprise--active-token"],[1,"attributes-group"],[1,"attributes-key-value"],[1,"attributes-key-value--key",3,"textContent"],[1,"attributes-key-value--value-container"],[1,"attributes-key-value--value","-text"],[3,"textContent"],["class","attributes-key-value--key",3,"textContent",4,"ngIf"],["class","attributes-key-value--value-container",4,"ngIf"],["class","expired-warning",3,"textContent",4,"ngIf"],[1,"expired-warning",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"div",3),e.TgZ(4,"div",4),e.TgZ(5,"div",5),e._UZ(6,"span",6),e.qZA(),e.qZA(),e._UZ(7,"div",3),e.TgZ(8,"div",4),e.TgZ(9,"div",5),e._UZ(10,"span",6),e.qZA(),e.qZA(),e.YNc(11,dh,1,1,"div",7),e.YNc(12,ph,3,1,"div",8),e.YNc(13,uh,1,1,"div",7),e.YNc(14,hh,3,1,"div",8),e.YNc(15,_h,1,1,"div",7),e.YNc(16,mh,3,1,"div",8),e.YNc(17,gh,1,1,"div",7),e.YNc(18,fh,3,1,"div",8),e.YNc(19,vh,1,1,"div",7),e.YNc(20,yh,4,2,"div",8),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.label_subscriber),e.xp6(3),e.Q6J("textContent",s.subscriber),e.xp6(1),e.Q6J("textContent",s.text.label_email),e.xp6(3),e.Q6J("textContent",s.email),e.xp6(1),e.Q6J("ngIf",s.company),e.xp6(1),e.Q6J("ngIf",s.company),e.xp6(1),e.Q6J("ngIf",s.domain),e.xp6(1),e.Q6J("ngIf",s.domain),e.xp6(1),e.Q6J("ngIf",s.userCount),e.xp6(1),e.Q6J("ngIf",s.userCount),e.xp6(1),e.Q6J("ngIf",s.startsAt),e.xp6(1),e.Q6J("ngIf",s.startsAt),e.xp6(1),e.Q6J("ngIf",s.expiresAt),e.xp6(1),e.Q6J("ngIf",s.expiresAt))},directives:[D.O5],styles:[".op-enterprise--active-token[_ngcontent-%COMP%]   .attributes-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.op-enterprise--active-token[_ngcontent-%COMP%]   .expired-warning[_ngcontent-%COMP%]{margin-left:.4rem;color:red;font-weight:bold}"]});class Io{constructor(o,s,w,j,ee,me){this.elementRef=o,this.I18n=s,this.http=w,this.toastService=j,this.eeTrialService=ee,this.timezoneService=me,this.created=this.timezoneService.formattedDate((new Date).toString()),this.email="",this.text={confirmation_info:(De,Je)=>this.I18n.t("js.admin.enterprise.trial.confirmation_info",{date:De,email:Je}),resend:this.I18n.t("js.admin.enterprise.trial.resend_link"),resend_success:this.I18n.t("js.admin.enterprise.trial.resend_success"),resend_warning:this.I18n.t("js.admin.enterprise.trial.resend_warning"),session_timeout:this.I18n.t("js.admin.enterprise.trial.session_timeout"),status_confirmed:this.I18n.t("js.admin.enterprise.trial.status_confirmed"),status_label:this.I18n.t("js.admin.enterprise.trial.status_label"),status_waiting:this.I18n.t("js.admin.enterprise.trial.status_waiting")}}ngOnInit(){const o=window.gon.ee_trial_key;if(o){const s=o.created.split(" ")[0];this.created=this.timezoneService.formattedDate(s)}this.eeTrialService.userData$.values$().pipe((0,Hi.x)()).subscribe(s=>{this.email=s.email})}resendMail(){this.eeTrialService.cancelled=!1,this.http.post(this.eeTrialService.resendLink,{},{headers:{[ds.i]:"true"}}).toPromise().then(()=>{this.toastService.addSuccess(this.text.resend_success),this.eeTrialService.retryConfirmation()}).catch(()=>{this.eeTrialService.trialLink?this.eeTrialService.getToken():this.toastService.addError(this.text.resend_warning)})}}function kh(g,o){1&g&&(e.TgZ(0,"div"),e._UZ(1,"enterprise-trial-form"),e.qZA())}function Ph(g,o){1&g&&(e.TgZ(0,"div"),e._UZ(1,"enterprise-trial-waiting"),e.qZA())}function xh(g,o){if(1&g&&(e.TgZ(0,"div"),e.TgZ(1,"div",9),e.TgZ(2,"div",10),e.TgZ(3,"span"),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"div",11),e._UZ(6,"iframe",12),e.qZA(),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(4),e.Oqu(s.text.quick_overview),e.xp6(2),e.Q6J("src",s.trustedEEVideoURL,e.uOi)}}function Eh(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"button",13),e.NdJ("click",function(j){return e.CHM(s),e.oxw().closeModal(j)}),e.qZA(),e.TgZ(2,"button",14),e.NdJ("click",function(){return e.CHM(s),e.oxw().onSubmit()}),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.text.button_cancel),e.uIk("title",s.text.button_cancel),e.xp6(1),e.Q6J("disabled",!s.trialForm||s.trialForm.invalid)("textContent",s.text.button_submit)("hidden",s.eeTrialService.mailSubmitted&&!s.eeTrialService.cancelled),e.uIk("title",s.text.button_submit)}}function Oh(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(j){return e.CHM(s),e.oxw(2).closeModal(j)}),e.qZA()}if(2&g){const s=e.oxw(2);e.Q6J("textContent",s.text.button_continue),e.uIk("title",s.text.button_continue)}}function Mh(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",6),e.TgZ(1,"button",15),e.NdJ("click",function(){return e.CHM(s),e.oxw().startEnterpriseTrial()}),e.qZA(),e.YNc(2,Oh,1,2,"button",16),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.text.button_continue)("disabled",!s.eeTrialService.confirmed)("hidden",s.eeTrialService.trialStarted),e.uIk("title",s.text.button_continue),e.xp6(1),e.Q6J("ngIf",s.eeTrialService.trialStarted)}}Io.\u0275fac=function(o){return new(o||Io)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(vi.eN),e.Y36(M.kl),e.Y36(ji),e.Y36(tt.B))},Io.\u0275cmp=e.Xpm({type:Io,selectors:[["enterprise-trial-waiting"]],decls:10,vars:4,consts:[[1,"op-ee-trial-waiting"],["class","op-ee-trial-waiting-status--waiting","data-qa-selector","op-ee-trial-waiting-status--waiting",4,"ngIf","ngIfElse"],["confirmedStatus",""],["data-qa-selector","op-ee-trial-waiting-status--waiting",1,"op-ee-trial-waiting-status--waiting"],["data-qa-selector","op-ee-trial-waiting-resend-link",1,"spot-link","op-ee-trial-waiting-resend-link",3,"click"],[4,"ngIf"],["data-qa-selector","op-ee-trial-waiting-status--confirmed",1,"op-ee-trial-waiting-status--confirmed","icon-yes"]],template:function(o,s){if(1&o&&(e.TgZ(0,"div",0),e._UZ(1,"enterprise-active-trial"),e.TgZ(2,"p"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e.TgZ(5,"span"),e._uU(6),e.qZA(),e.YNc(7,wh,5,3,"span",1),e.YNc(8,Th,2,1,"ng-template",null,2,e.W1O),e.qZA(),e.qZA()),2&o){const w=e.MAs(9);e.xp6(3),e.Oqu(s.text.confirmation_info(s.created,s.email)),e.xp6(3),e.hij("",s.text.status_label," "),e.xp6(1),e.Q6J("ngIf",!s.eeTrialService.confirmed)("ngIfElse",w)}},directives:[Us,D.O5],styles:[".op-ee-trial-waiting-status--confirmed[_ngcontent-%COMP%]{color:var(--button--alt-highlight-background-color)}.op-ee-trial-waiting-status--waiting[_ngcontent-%COMP%]{color:orange}"]});class So extends st.T{constructor(o,s,w,j,ee,me){super(s,w,o),this.elementRef=o,this.locals=s,this.cdRef=w,this.I18n=j,this.domSanitizer=ee,this.eeTrialService=me,this.showClose=!0,this.closeOnEscape=!1,this.closeOnOutsideClick=!1,this.text={button_submit:this.I18n.t("js.modals.button_submit"),button_cancel:this.I18n.t("js.modals.button_cancel"),button_continue:this.I18n.t("js.button_continue"),close_popup:this.I18n.t("js.close_popup_title"),heading_confirmation:this.I18n.t("js.admin.enterprise.trial.confirmation"),heading_next_steps:this.I18n.t("js.admin.enterprise.trial.next_steps"),heading_test_ee:this.I18n.t("js.admin.enterprise.trial.test_ee"),quick_overview:this.I18n.t("js.admin.enterprise.trial.quick_overview")},this.trustedEEVideoURL=this.trustedURL("https://www.youtube.com/embed/zLMSydhFSkw?autoplay=1")}ngAfterViewInit(){this.trialForm=this.formComponent.trialForm}onSubmit(){this.trialForm.valid&&(this.trialForm.addControl("_type",new d.NI("enterprise-trial")),this.eeTrialService.sendForm(this.trialForm))}startEnterpriseTrial(){this.eeTrialService.setStartTrialStatus()}headerText(){return this.eeTrialService.mailSubmitted?this.text.heading_confirmation:this.eeTrialService.trialStarted?this.text.heading_next_steps:this.text.heading_test_ee}closeModal(o){if(this.closeMe(o),this.eeTrialService.trialStarted||this.eeTrialService.confirmed)window.location.reload();else if(this.eeTrialService.mailSubmitted)return void window.location.reload();this.eeTrialService.modalOpen=!1}trustedURL(o){return this.domSanitizer.bypassSecurityTrustResourceUrl(o)}openWindow(){return!this.eeTrialService.status||this.eeTrialService.cancelled?1:this.eeTrialService.mailSubmitted&&!this.eeTrialService.cancelled?2:3}}function Sh(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"p"),e._uU(2),e.qZA(),e.TgZ(3,"p",3),e._uU(4),e.qZA(),e.TgZ(5,"p"),e.TgZ(6,"span",3),e._uU(7),e.qZA(),e._UZ(8,"br"),e.TgZ(9,"span"),e._uU(10),e.qZA(),e.qZA(),e.TgZ(11,"button",4),e.NdJ("click",function(){return e.CHM(s),e.oxw().openTrialModal()}),e._uU(12),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(2),e.Oqu(s.text.enterprise_edition),e.xp6(2),e.Oqu(s.text.confidence),e.xp6(3),e.Oqu(s.text.become_hero),e.xp6(3),e.Oqu(s.text.you_contribute),e.xp6(2),e.hij(" ",s.text.button_trial," ")}}function Dh(g,o){if(1&g){const s=e.EpF();e._UZ(0,"enterprise-trial-waiting"),e.TgZ(1,"p",5),e._uU(2),e.TgZ(3,"a",6),e.NdJ("click",function(){return e.CHM(s),e.oxw().openTrialModal()}),e._uU(4),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(2),e.hij("",s.text.email_not_received," "),e.xp6(2),e.Oqu(s.text.try_another_email)}}So.\u0275fac=function(o){return new(o||So)(e.Y36(e.SBq),e.Y36(He.E),e.Y36(e.sBO),e.Y36(y.D),e.Y36(i.H7),e.Y36(ji))},So.\u0275cmp=e.Xpm({type:So,selectors:[["enterprise-trial-modal"]],viewQuery:function(o,s){if(1&o&&e.Gf(Mo,5),2&o){let w;e.iGM(w=e.CRH())&&(s.formComponent=w.first)}},inputs:{opReferrer:"opReferrer"},features:[e.qOj],decls:13,vars:7,consts:[[1,"spot-modal","op-enterprise-modal"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["class","spot-action-bar--right",4,"ngIf","ngIfElse"],["mailSubmitted",""],[1,"onboarding--video-block"],[1,"onboarding--video-text"],[1,"onboarding--video","iframe-target-wrapper"],["frameborder","0","height","400","width","100%","allowfullscreen","",3,"src"],["data-qa-selector","confirmation-modal--cancel",1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"disabled","textContent","hidden","click"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","disabled","hidden","click"],["class","button button_no-margin -highlight spot-action-bar--action","data-qa-selector","confirmation-modal--confirmed",3,"textContent","click",4,"ngIf"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"]],template:function(o,s){if(1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,kh,2,0,"div",4),e.YNc(6,Ph,2,0,"div",4),e.YNc(7,xh,7,2,"div",4),e.qZA(),e.TgZ(8,"div",5),e.TgZ(9,"div",6),e.YNc(10,Eh,3,6,"div",7),e.YNc(11,Mh,3,5,"ng-template",null,8,e.W1O),e.qZA(),e.qZA(),e.qZA()),2&o){const w=e.MAs(12);e.xp6(2),e.Oqu(s.headerText()),e.xp6(2),e.Q6J("ngSwitch",s.openWindow()),e.xp6(1),e.Q6J("ngSwitchCase",1),e.xp6(1),e.Q6J("ngSwitchCase",2),e.xp6(1),e.Q6J("ngSwitchCase",3),e.xp6(3),e.Q6J("ngIf",!s.eeTrialService.status||s.eeTrialService.cancelled)("ngIfElse",w)}},directives:[D.RF,D.n9,D.O5,Mo,Io],styles:[".op-enterprise-modal[_ngcontent-%COMP%]   .onboarding--video-text[_ngcontent-%COMP%]{margin-bottom:1.25rem}"]});class Ls{constructor(o,s,w,j){this.I18n=o,this.opModalService=s,this.injector=w,this.eeTrialService=j,this.text={button_trial:this.I18n.t("js.admin.enterprise.upsale.button_start_trial"),button_book:this.I18n.t("js.admin.enterprise.upsale.button_book_now"),link_quote:this.I18n.t("js.admin.enterprise.upsale.link_quote"),become_hero:this.I18n.t("js.admin.enterprise.upsale.become_hero"),you_contribute:this.I18n.t("js.admin.enterprise.upsale.you_contribute"),email_not_received:this.I18n.t("js.admin.enterprise.trial.email_not_received"),enterprise_edition:this.I18n.t("js.admin.enterprise.upsale.text"),confidence:this.I18n.t("js.admin.enterprise.upsale.confidence"),try_another_email:this.I18n.t("js.admin.enterprise.trial.try_another_email")}}openTrialModal(){this.eeTrialService.cancelled=!0,this.eeTrialService.modalOpen=!0,this.opModalService.show(So,this.injector)}get noTrialRequested(){return void 0===window.gon.ee_trial_key}}Ls.\u0275fac=function(o){return new(o||Ls)(e.Y36(y.D),e.Y36(He.S),e.Y36(e.zs3),e.Y36(ji))},Ls.\u0275cmp=e.Xpm({type:Ls,selectors:[["enterprise-base"]],decls:4,vars:2,consts:[[1,"op-enterprise-base"],[4,"ngIf","ngIfElse"],["alreadyRequested",""],[1,"-bold"],[1,"button","-alt-highlight",3,"click"],[1,"op-enterprise-base--confirmation-hint"],[3,"click"]],template:function(o,s){if(1&o&&(e.TgZ(0,"div",0),e.YNc(1,Sh,13,5,"div",1),e.YNc(2,Dh,5,2,"ng-template",null,2,e.W1O),e.qZA()),2&o){const w=e.MAs(3);e.xp6(1),e.Q6J("ngIf",s.noTrialRequested)("ngIfElse",w)}},directives:[D.O5,Io],styles:[".op-enterprise-base[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{float:left}.op-enterprise-base--confirmation-hint[_ngcontent-%COMP%]{font-size:.9em;font-style:italic;margin-bottom:2rem}"]});const jh=function(g){return{"tooltip--top":g}};class Bs{constructor(o,s,w,j,ee,me,De,Je){this.I18n=o,this.opModalService=s,this.injector=w,this.http=j,this.cdRef=ee,this.Gon=me,this.eeTrialService=De,this.timezoneService=Je,this.created=this.timezoneService.formattedDate((new Date).toString()),this.email="",this.text={button_trial:this.I18n.t("js.admin.enterprise.upsale.button_start_trial"),confirmation_info:(qe,Et)=>this.I18n.t("js.admin.enterprise.trial.confirmation_info",{date:qe,email:Et})}}ngOnInit(){this.eeTrialService.userData$.values$().pipe((0,Hi.x)()).subscribe(o=>{this.email=o.email,this.cdRef.detectChanges()}),this.initialize()}initialize(){const o=this.Gon.get("ee_trial_key");if(o){const s=o.created.split(" ")[0];this.created=this.timezoneService.formattedDate(s),this.eeTrialService.userData$.hasValue()||(this.eeTrialService.trialLink=`${this.eeTrialService.baseUrlAugur}/public/v1/trials/${o.value}`,this.getUserDataFromAugur())}}getUserDataFromAugur(){this.http.get(`${this.eeTrialService.trialLink}/details`).toPromise().then(o=>{this.eeTrialService.userData$.putValue(o),this.eeTrialService.retryConfirmation()}).catch(()=>{this.eeTrialService.getToken()})}openTrialModal(){this.eeTrialService.cancelled=!0,this.eeTrialService.modalOpen=!0,this.opModalService.show(So,this.injector)}get trialRequested(){const o=this.Gon.get("ee_trial_key");return o&&void 0!==o}}function Rh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_company)}}function Fh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.company)}}function Wh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_domain)}}function Uh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.domain)}}function Lh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_maximum_users)}}function Bh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.userCount)}}function Qh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_starts_at)}}function Nh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.startsAt)}}function Jh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_expires_at)}}function Yh(g,o){if(1&g&&e._UZ(0,"span",10),2&g){const s=e.oxw(2);e.Q6J("textContent",s.expiredWarningText)}}function $h(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.YNc(3,Yh,1,1,"span",9),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.expiresAt),e.xp6(1),e.Q6J("ngIf",s.isExpired)}}Bs.\u0275fac=function(o){return new(o||Bs)(e.Y36(y.D),e.Y36(He.S),e.Y36(e.zs3),e.Y36(vi.eN),e.Y36(e.sBO),e.Y36(us.U),e.Y36(ji),e.Y36(tt.B))},Bs.\u0275cmp=e.Xpm({type:Bs,selectors:[["free-trial-button"]],decls:3,vars:6,consts:[[3,"ngClass"],["type","button",1,"button","-alt-highlight",3,"disabled","click"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return s.openTrialModal()}),e._uU(2),e.qZA(),e.qZA()),2&o&&(e.Q6J("ngClass",e.VKq(4,jh,s.trialRequested)),e.uIk("data-tooltip",s.trialRequested?s.text.confirmation_info(s.created,s.email):""),e.xp6(1),e.Q6J("disabled",s.trialRequested),e.xp6(1),e.hij(" ",s.text.button_trial," "))},directives:[D.mk],encapsulation:2,changeDetection:0});class Qs extends Ta{constructor(o,s){super(s),this.elementRef=o,this.I18n=s,this.subscriber=this.elementRef.nativeElement.dataset.subscriber,this.email=this.elementRef.nativeElement.dataset.email,this.company=this.elementRef.nativeElement.dataset.company,this.domain=this.elementRef.nativeElement.dataset.domain,this.userCount=this.elementRef.nativeElement.dataset.userCount,this.startsAt=this.elementRef.nativeElement.dataset.startsAt,this.expiresAt=this.elementRef.nativeElement.dataset.expiresAt,this.isExpired="true"===this.elementRef.nativeElement.dataset.isExpired,this.reprieveDaysLeft=this.elementRef.nativeElement.dataset.reprieveDaysLeft}get expiredWarningText(){let o=this.text.text_expired;return this.reprieveDaysLeft&&this.reprieveDaysLeft>0&&(o=`${o}: ${this.text.text_reprieve_days_left(this.reprieveDaysLeft)}`),o}}Qs.\u0275fac=function(o){return new(o||Qs)(e.Y36(e.SBq),e.Y36(y.D))},Qs.\u0275cmp=e.Xpm({type:Qs,selectors:[["enterprise-active-saved-trial"]],features:[e.qOj],decls:21,vars:14,consts:[["data-qa-selector","op-enterprise--active-token",1,"op-enterprise--active-token"],[1,"attributes-group"],[1,"attributes-key-value"],[1,"attributes-key-value--key",3,"textContent"],[1,"attributes-key-value--value-container"],[1,"attributes-key-value--value","-text"],[3,"textContent"],["class","attributes-key-value--key",3,"textContent",4,"ngIf"],["class","attributes-key-value--value-container",4,"ngIf"],["class","expired-warning",3,"textContent",4,"ngIf"],[1,"expired-warning",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"div",3),e.TgZ(4,"div",4),e.TgZ(5,"div",5),e._UZ(6,"span",6),e.qZA(),e.qZA(),e._UZ(7,"div",3),e.TgZ(8,"div",4),e.TgZ(9,"div",5),e._UZ(10,"span",6),e.qZA(),e.qZA(),e.YNc(11,Rh,1,1,"div",7),e.YNc(12,Fh,3,1,"div",8),e.YNc(13,Wh,1,1,"div",7),e.YNc(14,Uh,3,1,"div",8),e.YNc(15,Lh,1,1,"div",7),e.YNc(16,Bh,3,1,"div",8),e.YNc(17,Qh,1,1,"div",7),e.YNc(18,Nh,3,1,"div",8),e.YNc(19,Jh,1,1,"div",7),e.YNc(20,$h,4,2,"div",8),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.label_subscriber),e.xp6(3),e.Q6J("textContent",s.subscriber),e.xp6(1),e.Q6J("textContent",s.text.label_email),e.xp6(3),e.Q6J("textContent",s.email),e.xp6(1),e.Q6J("ngIf",s.company),e.xp6(1),e.Q6J("ngIf",s.company),e.xp6(1),e.Q6J("ngIf",s.domain),e.xp6(1),e.Q6J("ngIf",s.domain),e.xp6(1),e.Q6J("ngIf",s.userCount),e.xp6(1),e.Q6J("ngIf",s.userCount),e.xp6(1),e.Q6J("ngIf",s.startsAt),e.xp6(1),e.Q6J("ngIf",s.startsAt),e.xp6(1),e.Q6J("ngIf",s.expiresAt),e.xp6(1),e.Q6J("ngIf",s.expiresAt))},directives:[D.O5],styles:[".op-enterprise--active-token[_ngcontent-%COMP%]   .attributes-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.op-enterprise--active-token[_ngcontent-%COMP%]   .expired-warning[_ngcontent-%COMP%]{margin-left:.4rem;color:red;font-weight:bold}"],changeDetection:0});class Ns{constructor(o,s){this.i18n=o,this.domSanitizer=s,this.new_features_image=(0,Pr.h)("12_3_features.png"),this.text={newFeatures:this.i18n.t("js.label_new_features"),descriptionNewFeatures:this.i18n.t("js.homescreen.blocks.new_features.text_new_features"),learnAbout:this.i18n.t("js.homescreen.blocks.new_features.learn_about")},this.isStandardEdition=window.OpenProject.isStandardEdition}get teaserWebsiteUrl(){const o=this.translated("learn_about_link");return this.domSanitizer.bypassSecurityTrustResourceUrl(o)}get currentNewFeatureHtml(){return this.translated("new_features_html")}translated(o){return this.i18n.t(`js.homescreen.blocks.new_features.12_3.${this.isStandardEdition?"standard":"bim"}.${o}`,{list_styling_class:"widget-box--arrow-links",bcf_api_link:"https://github.com/opf/openproject/blob/dev/docs/api/bcf/bcf-rest-api.md"})}}Ns.\u0275fac=function(o){return new(o||Ns)(e.Y36(y.D),e.Y36(i.H7))},Ns.\u0275cmp=e.Xpm({type:Ns,selectors:[["homescreen-new-features-block"]],decls:8,vars:5,consts:[[1,"op-new-features"],[1,"widget-box--additional-info"],[1,"widget-box--description"],[3,"innerHtml"],[1,"widget-box--teaser-image","op-new-features--teaser-image",3,"src"],["target","_blank",3,"href"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"p",1),e._uU(2),e.qZA(),e.TgZ(3,"div",2),e._UZ(4,"p",3),e._UZ(5,"img",4),e.qZA(),e.TgZ(6,"a",5),e._uU(7),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.hij(" ",s.text.descriptionNewFeatures," "),e.xp6(2),e.Q6J("innerHtml",s.currentNewFeatureHtml,e.oJD),e.xp6(1),e.Q6J("src",s.new_features_image,e.LSH),e.xp6(1),e.Q6J("href",s.teaserWebsiteUrl,e.LSH),e.xp6(1),e.Oqu(s.text.learnAbout))},styles:[".op-new-features--teaser-image[_ngcontent-%COMP%]{background-image:var(--new-feature-teaser-image);min-width:170px;background-size:contain;background-repeat:no-repeat;background-position-x:right}"]});var ka=t(83835);function Gh(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(j){return e.CHM(s),e.oxw().toggleService.toggleNavigation(j)}),e._UZ(1,"op-icon",2),e._UZ(2,"op-icon",3),e.qZA()}if(2&g){const s=e.oxw();e.uIk("title",s.toggleTitle)}}class Do extends si.N{constructor(o,s,w,j){super(),this.toggleService=o,this.cdRef=s,this.deviceService=w,this.injector=j,this.toggleTitle=""}ngOnInit(){this.toggleService.initializeMenu(),this.toggleService.titleData$.pipe((0,Hi.x)(),this.untilDestroyed()).subscribe(o=>{this.toggleTitle=o,this.cdRef.detectChanges()})}}Do.\u0275fac=function(o){return new(o||Do)(e.Y36(ka.J),e.Y36(e.sBO),e.Y36(mr.U),e.Y36(e.zs3))},Do.\u0275cmp=e.Xpm({type:Do,selectors:[["main-menu-toggle"]],hostAttrs:[1,"op-app-menu","op-main-menu-toggle"],features:[e.qOj],decls:1,vars:1,consts:[["class","op-app-menu--item-action","id","main-menu-toggle","aria-haspopup","true","type","button",3,"click",4,"ngIf"],["id","main-menu-toggle","aria-haspopup","true","type","button",1,"op-app-menu--item-action",3,"click"],["aria-hidden","true",1,"icon-hamburger"],["aria-hidden","true",1,"icon-close"]],template:function(o,s){1&o&&e.YNc(0,Gh,3,1,"button",0),2&o&&e.Q6J("ngIf",null!==s.currentProject.id||s.deviceService.isMobile)},directives:[D.O5,Ye.o],encapsulation:2,changeDetection:0}),(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",b.R)],Do.prototype,"currentProject",void 0);class Js extends si.N{constructor(o,s,w){super(),this.toggleService=o,this.cdRef=s,this.elementRef=w,this.mainMenu=jQuery("#main-menu")[0],this.moving=!1}ngOnInit(){this.toggleService.titleData$.pipe((0,Hi.x)(),this.untilDestroyed()).subscribe(o=>{this.toggleTitle=o,this.cdRef.detectChanges()}),this.resizeEvent="main-menu-resize",this.localStorageKey="openProject-mainMenuWidth"}resizeStart(){this.elementWidth=this.mainMenu.clientWidth}resizeMove(o){this.toggleService.saveWidth(this.elementWidth+o.absolute.x)}resizeEnd(){const o=new Event(this.resizeEvent);window.dispatchEvent(o)}}Js.\u0275fac=function(o){return new(o||Js)(e.Y36(ka.J),e.Y36(e.sBO),e.Y36(e.SBq))},Js.\u0275cmp=e.Xpm({type:Js,selectors:[["main-menu-resizer"]],features:[e.qOj],decls:4,vars:5,consts:[[1,"main-menu--resizer",3,"customHandler","cursorClass","end","start","move"],[1,"resizer-toggle-container"],[1,"spot-link","main-menu--navigation-toggler",3,"click"],["icon-classes","icon-resizer-vertical-lines"]],template:function(o,s){1&o&&(e.TgZ(0,"resizer",0),e.NdJ("end",function(){return s.resizeEnd()})("start",function(){return s.resizeStart()})("move",function(j){return s.resizeMove(j)}),e.TgZ(1,"div",1),e.TgZ(2,"button",2),e.NdJ("click",function(j){return s.toggleService.toggleNavigation(j)}),e._UZ(3,"op-icon",3),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("customHandler",!0)("cursorClass","col-resize"),e.xp6(2),e.ekj("open",s.toggleService.showNavigation),e.uIk("title",s.toggleTitle))},directives:[qr.d,Ye.o],encapsulation:2});var Pa=t(5275);class Ys{constructor(o,s,w,j,ee){this.elementRef=o,this.I18n=s,this.cdRef=w,this.urlParamsHelper=j,this.externalQuery=ee,this.urlParams=!1,this.text={edit_query:this.I18n.t("js.admin.type_form.edit_query")}}ngOnInit(){const o=this.elementRef.nativeElement;this.id=o.dataset.id,this.name=o.dataset.name,this.urlParams="true"===o.dataset.urlParams,this.queryProps=o.dataset.query}editQuery(){const o=(()=>{if(this.urlParams)return this.queryProps;try{return JSON.parse(this.queryProps)}catch(s){return console.error(`Failed to parse query props from ${this.queryProps}: ${s}`),{}}})();this.externalQuery.show({currentQuery:o,urlParams:this.urlParams,callback:s=>{this.queryProps=this.urlParams?s:JSON.stringify(s),this.cdRef.detectChanges()}})}}Ys.\u0275fac=function(o){return new(o||Ys)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(e.sBO),e.Y36(mi.Z),e.Y36(Pa.W))},Ys.\u0275cmp=e.Xpm({type:Ys,selectors:[["editable-query-props"]],decls:2,vars:4,consts:[["type","hidden",3,"value"],["type","button",1,"spot-link",3,"textContent","click"]],template:function(o,s){1&o&&(e._UZ(0,"input",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return s.editQuery()}),e.qZA()),2&o&&(e.Q6J("value",s.queryProps),e.uIk("name",s.name||void 0)("id",s.id||void 0),e.xp6(1),e.Q6J("textContent",s.text.edit_query))},encapsulation:2,changeDetection:0});var t_=t(89919),xa=t(12702),i_=t(86664),n_=t(13623);function o_(g,o){if(1&g&&(e._UZ(0,"span",4),e.ALo(1,"async")),2&g){const s=e.oxw(2);e.Q6J("textContent",e.lcZ(1,1,s.unreadCountText$))}}function s_(g,o){if(1&g&&(e.ynx(0),e.YNc(1,o_,2,3,"span",3),e.BQk()),2&g){const s=o.ngIf;e.xp6(1),e.Q6J("ngIf",0!==s)}}class $s{constructor(o,s,w,j){this.storeService=o,this.apiV3Service=s,this.activeWindow=w,this.pathHelper=j,this.polling$=(0,t_.T)((0,xa.H)(10,1e4).pipe((0,Gt.h)(()=>this.activeWindow.isActive)),(0,xa.H)(10,12e4).pipe((0,Gt.h)(()=>!this.activeWindow.isActive))).pipe((0,Gr.p)(1e4),(0,H.w)(()=>this.storeService.fetchUnread())),this.unreadCount$=(0,Ai.aj)([this.storeService.unread$,this.polling$]).pipe((0,Yt.U)(([ee])=>ee),(0,kr.d)(1)),this.unreadCountText$=this.unreadCount$.pipe((0,Yt.U)(ee=>ee>99?"99+":ee<=0?"":ee))}notificationsPath(){return this.pathHelper.notificationsPath()}}$s.\u0275fac=function(o){return new(o||$s)(e.Y36(n_.L),e.Y36(R.T),e.Y36(i_.u),e.Y36(je.j))},$s.\u0275cmp=e.Xpm({type:$s,selectors:[["op-in-app-notification-bell"]],decls:4,vars:4,consts:[["data-qa-selector","op-ian-bell",1,"op-ian-bell","op-app-menu--item-action",3,"href"],["icon-classes","icon-bell"],[4,"ngIf"],["class","op-ian-bell--indicator","data-qa-selector","op-ian-notifications-count",3,"textContent",4,"ngIf"],["data-qa-selector","op-ian-notifications-count",1,"op-ian-bell--indicator",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"a",0),e._UZ(1,"op-icon",1),e.YNc(2,s_,2,1,"ng-container",2),e.ALo(3,"async"),e.qZA()),2&o&&(e.Q6J("href",s.notificationsPath(),e.LSH),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,2,s.unreadCount$)))},directives:[Ye.o,D.O5],pipes:[D.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-bell[_ngcontent-%COMP%]{position:relative}.op-ian-bell--indicator[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center;box-sizing:content-box;height:16px;line-height:16px;width:16px;border-radius:.5rem;padding:0 .15rem;font-size:.7rem;font-weight:bold;background:#00A3FF;color:#fff;flex-shrink:0;position:absolute;top:10px;right:3px;background:darkred}"],changeDetection:0});var Oa=t(78509),Sr=t(44838),Ma=t(60419),Dr=t(31909),Ar=t(44040),Vs=t(19100);const c_={pageSize:100,groupBy:"project",filters:[["read_ian","=",!1]]},l_={pageSize:100,groupBy:"reason",filters:[["read_ian","=",!1]]};let jr=class extends Vs.yh{constructor(){super({notificationsByProject:[],notificationsByReason:[],projectsFilter:{}})}};jr=(0,se.gn)([(0,Vs.yC)({name:"ian-menu"}),(0,se.w6)("design:paramtypes",[])],jr);var Hs=t(96725);let Ji=class{constructor(o,s,w,j,ee){this.injector=o,this.ianResourceService=s,this.projectsResourceService=w,this.actions$=j,this.apiV3Service=ee,this.id="ian-center",this.store=new jr,this.query=new Vs.AE(this.store),this.projectsFilter$=this.query.select("projectsFilter"),this.projectsForNotifications$=this.projectsFilter$.pipe((0,H.w)(me=>{const De=(0,Hs.ZU)(me);return this.projectsResourceService.collection(De)})),this.notificationsByProject$=(0,Ai.aj)([this.query.select("notificationsByProject"),this.projectsForNotifications$]).pipe((0,Yt.U)(([me,De])=>me.map(Je=>{const qe=De.find(Et=>Et.id.toString()===(0,Ae.Z)(Je._links.valueLink[0].href));return Object.assign(Object.assign({},Je),{projectHasParent:!!(null==qe?void 0:qe._links.parent.href)})}))),this.notificationsByReason$=this.query.select("notificationsByReason")}checkForNewNotifications(){this.reload()}reloadOnNotificationRead(){return this.reload()}reload(){this.ianResourceService.fetchNotifications(c_).subscribe(o=>{const s={pageSize:100,filters:[]};o.groups&&(s.filters=[["id","=",o.groups.map(w=>(0,Ae.Z)(w._links.valueLink[0].href))]]),this.store.update({notificationsByProject:o.groups,projectsFilter:s}),o.groups&&o.groups.length>0&&this.projectsResourceService.fetchProjects(s).subscribe()}),this.ianResourceService.fetchNotifications(l_).subscribe(o=>this.store.update({notificationsByReason:o.groups}))}};Ji.\u0275fac=function(o){return new(o||Ji)(e.LFG(e.zs3),e.LFG(Dr.W),e.LFG(Ar.D),e.LFG(Ma.b),e.LFG(R.T))},Ji.\u0275prov=e.Yz7({token:Ji,factory:Ji.\u0275fac}),(0,se.gn)([(0,Sr.B)(Oa.vw),(0,se.w6)("design:type",Function),(0,se.w6)("design:paramtypes",[]),(0,se.w6)("design:returntype",void 0)],Ji.prototype,"checkForNewNotifications",null),(0,se.gn)([(0,Sr.B)(Oa.A6),(0,se.w6)("design:type",Function),(0,se.w6)("design:paramtypes",[]),(0,se.w6)("design:returntype",void 0)],Ji.prototype,"reloadOnNotificationRead",null),Ji=(0,se.gn)([Sr.b,(0,se.w6)("design:paramtypes",[e.zs3,Dr.W,Ar.D,Ma.b,R.T])],Ji);const Ao=(g={})=>({uiSref:"notifications.center.show",uiParams:g});class zs{constructor(o,s,w,j){this.cdRef=o,this.I18n=s,this.ianMenuService=w,this.state=j,this.className=!0,this.baseMenuItems=[Object.assign({key:"inbox",title:this.I18n.t("js.notifications.menu.inbox"),icon:"inbox"},Ao({filter:"",name:""}))],this.reasonMenuItems=[Object.assign({key:"mentioned",title:this.I18n.t("js.notifications.menu.mentioned"),icon:"mention"},Ao({filter:"reason",name:"mentioned"})),Object.assign({key:"assigned",title:this.I18n.t("js.label_assignee"),icon:"assigned"},Ao({filter:"reason",name:"assigned"})),Object.assign({key:"responsible",title:this.I18n.t("js.notifications.menu.accountable"),icon:"accountable"},Ao({filter:"reason",name:"responsible"})),Object.assign({key:"watched",title:this.I18n.t("js.notifications.menu.watching"),icon:"watching"},Ao({filter:"reason",name:"watched"}))],this.notificationsByProject$=this.ianMenuService.notificationsByProject$.pipe((0,Yt.U)(ee=>ee.map(me=>Object.assign(Object.assign(Object.assign({},me),{title:(me.projectHasParent?"... ":"")+me.value}),Ao({filter:"project",name:(0,Ae.Z)(me._links.valueLink[0].href)}))).sort((me,De)=>De.projectHasParent&&!me.projectHasParent?-1:me.value.toLowerCase().localeCompare(De.value.toLowerCase())))),this.notificationsByReason$=this.ianMenuService.notificationsByReason$.pipe((0,Yt.U)(ee=>this.reasonMenuItems.map(me=>Object.assign(Object.assign({},ee.find(De=>De.value===me.key)),me)))),this.menuItems$=(0,Ai.aj)([this.notificationsByProject$,this.notificationsByReason$]).pipe((0,Yt.U)(([ee,me])=>[...this.baseMenuItems.map(De=>Object.assign(Object.assign({},De),{count:ee.reduce((Je,qe)=>Je+(qe.count||0),0)})),{title:this.I18n.t("js.notifications.menu.by_reason"),collapsible:!0,children:me},{title:this.I18n.t("js.notifications.menu.by_project"),collapsible:!0,children:ee}])),this.text={title:this.I18n.t("js.notifications.title"),button_close:this.I18n.t("js.button_close"),no_results:{unread:this.I18n.t("js.notifications.no_unread"),all:this.I18n.t("js.notice_no_results_to_display")}}}ngOnInit(){this.ianMenuService.reload()}}function u_(g,o){if(1&g&&(e.TgZ(0,"button",3),e._UZ(1,"span",4),e._UZ(2,"span",5),e.qZA()),2&g){const s=e.oxw();e.Q6J("uiSref",s.createButton.uiSref)("uiParams",s.createButton.uiParams)("title",s.createButton.title),e.xp6(2),e.Q6J("textContent",s.createButton.text)}}zs.\u0275fac=function(o){return new(o||zs)(e.Y36(e.sBO),e.Y36(y.D),e.Y36(Ji),e.Y36(Ke.StateService))},zs.\u0275cmp=e.Xpm({type:zs,selectors:[["op-ian-menu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-ian-menu",s.className)},features:[e._Bn([Ji])],decls:2,vars:3,consts:[["data-qa-selector","op-sidemenu",3,"items"]],template:function(o,s){1&o&&(e._UZ(0,"op-sidemenu",0),e.ALo(1,"async")),2&o&&e.Q6J("items",e.lcZ(1,1,s.menuItems$))},directives:[an],pipes:[D.Ov],styles:[".op-ian-menu[_ngcontent-%COMP%], [_nghost-%COMP%]{display:block;padding-top:16px}"],changeDetection:0});class Ks extends si.N{constructor(o,s,w,j,ee){super(),this.elementRef=o,this.currentUserService=s,this.currentProjectService=w,this.bannersService=j,this.I18n=ee,this.className=!0,this.menuItems=[],this.canAddTeamPlanner$=this.currentUserService.hasCapabilities$("team_planners/create",this.currentProjectService.id||void 0).pipe((0,Yt.U)(me=>me&&!this.bannersService.eeShowBanners)),this.createButton={text:this.I18n.t("js.team_planner.create_label"),title:this.I18n.t("js.team_planner.create_title"),uiSref:"team_planner.page.show",uiParams:{query_id:null,query_props:""}},(0,pr.E)(this)}}function __(g,o){if(1&g&&(e.TgZ(0,"button",3),e._UZ(1,"span",4),e._UZ(2,"span",5),e.qZA()),2&g){const s=e.oxw();e.Q6J("uiSref",s.createButton.uiSref)("uiParams",s.createButton.uiParams)("title",s.text.create_new_calendar),e.xp6(2),e.Q6J("textContent",s.createButton.title)}}Ks.\u0275fac=function(o){return new(o||Ks)(e.Y36(e.SBq),e.Y36(Nn.S),e.Y36(b.R),e.Y36(cr.j),e.Y36(y.D))},Ks.\u0275cmp=e.Xpm({type:Ks,selectors:[["op-team-planner-sidemenu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-sidebar",s.className)},inputs:{menuItems:"menuItems",projectId:"projectId"},features:[e.qOj],decls:4,vars:5,consts:[["baseRoute","team_planner.page.show","viewType","TeamPlanner",1,"op-sidebar--body",3,"projectId","menuItems"],[1,"op-sidebar--footer"],["class","button -alt-highlight","data-qa-selector","team-planner--create-button",3,"uiSref","uiParams","title",4,"ngIf"],["data-qa-selector","team-planner--create-button",1,"button","-alt-highlight",3,"uiSref","uiParams","title"],[1,"spot-icon","spot-icon_add"],[3,"textContent"]],template:function(o,s){1&o&&(e._UZ(0,"op-view-select",0),e.TgZ(1,"div",1),e.YNc(2,u_,3,4,"button",2),e.ALo(3,"async"),e.qZA()),2&o&&(e.Q6J("projectId",s.projectId)("menuItems",s.menuItems),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,3,s.canAddTeamPlanner$)))},directives:[Ki,D.O5,Vt.UISref],pipes:[D.Ov],encapsulation:2,changeDetection:0});class Gs extends si.N{constructor(o,s,w,j){super(),this.elementRef=o,this.currentUserService=s,this.currentProjectService=w,this.I18n=j,this.className=!0,this.menuItems=[],this.canCreateCalendar$=this.currentUserService.hasCapabilities$("calendars/create",this.currentProjectService.id||void 0).pipe(this.untilDestroyed()),this.text={calendar:this.I18n.t("js.calendar.title"),create_new_calendar:this.I18n.t("js.calendar.create_new")},this.createButton={title:this.text.calendar,uiSref:"calendar.page.show",uiParams:{query_id:null,query_props:""}},(0,pr.E)(this)}}Gs.\u0275fac=function(o){return new(o||Gs)(e.Y36(e.SBq),e.Y36(Nn.S),e.Y36(b.R),e.Y36(y.D))},Gs.\u0275cmp=e.Xpm({type:Gs,selectors:[["op-calendar-sidemenu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-sidebar",s.className)},inputs:{menuItems:"menuItems",projectId:"projectId"},features:[e.qOj],decls:4,vars:5,consts:[["baseRoute","calendar.page.show","viewType","WorkPackagesCalendar",1,"op-sidebar--body",3,"projectId","menuItems"],[1,"op-sidebar--footer"],["class","button -alt-highlight",3,"uiSref","uiParams","title",4,"ngIf"],[1,"button","-alt-highlight",3,"uiSref","uiParams","title"],[1,"spot-icon","spot-icon_add"],[3,"textContent"]],template:function(o,s){1&o&&(e._UZ(0,"op-view-select",0),e.TgZ(1,"div",1),e.YNc(2,__,3,4,"button",2),e.ALo(3,"async"),e.qZA()),2&o&&(e.Q6J("projectId",s.projectId)("menuItems",s.menuItems),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,3,s.canCreateCalendar$)))},directives:[Ki,D.O5,Vt.UISref],pipes:[D.Ov],encapsulation:2,changeDetection:0});const g_=[{selector:Qr,cls:Wn},{selector:Dt.w,cls:Dt.y},{selector:"macro.embedded-table",cls:ms,embeddable:!0},{selector:la.w,cls:la.O},{selector:gn.h,cls:gn.a},{selector:Li.e,cls:Li.t,embeddable:!0},{selector:Er.X,cls:Er.U},{selector:"op-members-autocompleter",cls:Tn},{selector:"global-search-tabs",cls:As},{selector:"global-search-work-packages",cls:ko},{selector:"homescreen-new-features-block",cls:Ns},{selector:"custom-date-action-admin",cls:gs},{selector:"boards-menu",cls:fs},{selector:"global-search-work-packages-entry",cls:vs},{selector:"op-toasts-container",cls:bs},{selector:"op-sidemenu",cls:an},{selector:"admin-type-form-configuration",cls:wo},{selector:"ckeditor-augmented-textarea",cls:ws,embeddable:!0},{selector:"persistent-toggle",cls:Ts},{selector:vt.y,cls:vt.N},{selector:"hide-section-link",cls:ks},{selector:"show-section-dropdown",cls:Ps},{selector:"add-section-dropdown",cls:xs},{selector:ha.$,cls:ha.r},{selector:"content-tabs",cls:Es},{selector:"global-search-title",cls:xo},{selector:"copy-to-clipboard",cls:Os},{selector:"main-menu-resizer",cls:Js},{selector:"main-menu-toggle",cls:Do},{selector:"global-search-input",cls:Ms},{selector:"collapsible-section-augment",cls:Is},{selector:yr.z,cls:yr.P},{selector:kt.X,cls:kt.S},{selector:"enterprise-base",cls:Ls},{selector:"free-trial-button",cls:Bs},{selector:"enterprise-active-saved-trial",cls:Qs},{selector:"op-header-project-select",cls:Ss},{selector:Tr.B,cls:Tr.F},{selector:"remote-field-updater",cls:Ds},{selector:"wp-overview-graph",cls:Si},{selector:"op-view-select",cls:Ki},{selector:"op-team-planner-sidemenu",cls:Ks},{selector:"op-calendar-sidemenu",cls:Gs},{selector:"time-entry--trigger-actions-entry",cls:Ni,embeddable:!0},{selector:va.m,cls:va.V},{selector:"macro.macro--attribute-value",cls:Zs,embeddable:!0},{selector:"macro.macro--attribute-label",cls:Rs,embeddable:!0},{selector:"macro.macro--wp-quickinfo",cls:Ws,embeddable:!0},{selector:"editable-query-props",cls:Ys},{selector:ya.H,cls:ya.G},{selector:"backup",cls:Oo},{selector:"op-in-app-notification-bell",cls:$s},{selector:"op-ian-menu",cls:zs}];var Zr=t(55741),f_=t(84568),v_=t(17076),C_=t(82170);class jo{constructor(o){this.sanitizer=o}sanitize(o){return this.sanitizer.sanitize(e.q3G.HTML,o)||""}}jo.\u0275fac=function(o){return new(o||jo)(e.LFG(i.H7))},jo.\u0275prov=e.Yz7({token:jo,factory:jo.\u0275fac,providedIn:"root"});var y_=t(58057),b_=t(298);const w_=["passwordConfirmationField"];class Zo extends b_.j{constructor(){super(...arguments),this.password_confirmation=null,this.additionalText={field_description:I18n.t("js.password_confirmation.field_description"),confirm_button:I18n.t("js.button_confirm"),password:I18n.t("js.label_password"),cancel_button:I18n.t("js.button_cancel")}}ngOnInit(){super.ngOnInit(),this.text.title=I18n.t("js.password_confirmation.title"),this.closeOnEscape=!1,this.closeOnOutsideClick=!1,this.showClose=!1}confirmAndClose(o){this.passwordValuePresent()&&super.confirmAndClose(o)}onOpen(){super.onOpen(),this.passwordConfirmationField.nativeElement.focus()}passwordValuePresent(){return null!==this.password_confirmation&&this.password_confirmation.length>0}}Zo.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Zo)))(s||Zo)}}(),Zo.\u0275cmp=e.Xpm({type:Zo,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(w_,7),2&o){let w;e.iGM(w=e.CRH())&&(s.passwordConfirmationField=w.first)}},features:[e.qOj],decls:16,vars:8,consts:[["data-indicator-name","modal",1,"spot-modal","form","-vertical","confirm-form-submit--modal","password-confirm-dialog--modal","loading-indicator--location",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container","form"],[1,"form--field","-required"],["for","request_for_confirmation_password",1,"form--label","-bold",3,"textContent"],[1,"form--field-container"],[1,"form--text-field-container"],["type","password","id","request_for_confirmation_password","name","request_for_confirmation_password",1,"form--text-field",3,"ngModel","ngModelChange"],["passwordConfirmationField",""],[1,"form--field-instructions",3,"textContent"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","disabled"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.NdJ("submit",function(j){return s.confirmAndClose(j)}),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e._UZ(6,"label",5),e.TgZ(7,"div",6),e.TgZ(8,"div",7),e.TgZ(9,"input",8,9),e.NdJ("ngModelChange",function(j){return s.password_confirmation=j}),e.qZA(),e.qZA(),e.qZA(),e._UZ(11,"div",10),e.qZA(),e.qZA(),e.TgZ(12,"div",11),e.TgZ(13,"div",12),e.TgZ(14,"button",13),e.NdJ("click",function(){return s.closeMe()}),e.qZA(),e._UZ(15,"button",14),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title),e.xp6(4),e.Q6J("textContent",s.additionalText.password),e.uIk("aria-label",s.additionalText.field_description),e.xp6(3),e.Q6J("ngModel",s.password_confirmation),e.xp6(2),e.Q6J("textContent",s.additionalText.field_description),e.xp6(3),e.Q6J("textContent",s.additionalText.cancel_button),e.xp6(1),e.Q6J("textContent",s.additionalText.confirm_button)("disabled",!s.passwordValuePresent()))},directives:[d._Y,d.JL,d.F,d.Fj,d.JJ,d.On],encapsulation:2,changeDetection:0});var Ia=t(88826);class Sa{constructor(o){this.injector=o,this._knownHookNames=["workPackageBulkContextMenu","workPackageTableContextMenu","workPackageSingleContextMenu","workPackageNewInitialization"],this.services={confirmDialog:this.injector.get(Ze.D),externalQueryConfiguration:this.injector.get(Pa.W),externalRelationQueryConfiguration:this.injector.get(ra.Q),halResource:this.injector.get(gt.u),hooks:this.injector.get(f.$),i18n:this.injector.get(y.D),notifications:this.injector.get(M.kl),opModalService:this.injector.get(He.S),opFileUpload:this.injector.get(xr.r),displayField:this.injector.get(js.i),editField:this.injector.get(f_.h),macros:this.injector.get(C_.f),htmlSanitizeService:this.injector.get(jo),ckEditorPreview:this.injector.get(v_.K),pathHelperService:this.injector.get(je.j),states:this.injector.get(h.G),apiV3Service:this.injector.get(R.T),configurationService:this.injector.get(Me.e),attachmentsResourceService:this.injector.get(Ia.v)},this.helpers={idFromLink:Ae.Z},this.classes={modals:{passwordConfirmation:Zo,dynamicContent:y_.T},HalResource:vo.X,DisplayField:Zr.C,DomAutoscrollService:aa.x},this.hooks={},this._knownHookNames.forEach(s=>{this.hooks[s]=w=>this.services.hooks.register(s,w)})}runInZone(o){this.zone.run(o)}bootstrap(o){a.Z.bootstrapOptionalEmbeddable(this.injector.get(e.z2F),o)}}(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",e.R0b)],Sa.prototype,"zone",void 0);class Ro{constructor(o){(0,rn.qu)("Registering OpenProject plugin context");const s=new Sa(o);window.OpenProject.pluginContext.putValue(s)}}Ro.\u0275fac=function(o){return new(o||Ro)(e.LFG(e.zs3))},Ro.\u0275mod=e.oAB({type:Ro}),Ro.\u0275inj=e.cJS({providers:[f.$]});class zn{constructor(o,s){this.halNotification=o,this.http=s}listen(){jQuery("costs-budget-subform").each((o,s)=>{const w=jQuery(s),j=w.find(".budget-item-container"),ee=w.find(".budget-row-template");ee.detach();const me=ee[0].outerHTML;let De=parseInt(w.attr("item-count"),10);w.on("change",".budget-item-value",Je=>{const qe=jQuery(Je.target).closest(".cost_entry");this.refreshRow(w,qe.attr("id"))}),w.on("click",".delete-budget-item",Je=>(Je.preventDefault(),jQuery(Je.target).closest(".cost_entry").remove(),!1)),w.find(".budget-add-row").on("click",Je=>{Je.preventDefault();const qe=jQuery(me.replace(/INDEX/g,De.toString()));return qe.show(),qe.removeClass("budget-row-template"),j.append(qe),De+=1,!1})})}refreshRow(o,s){const w=o.find(`#${s}`),j=this.buildRefreshRequest(w,s);this.http.post(o.attr("update-url"),j,{headers:{Accept:"application/json"},withCredentials:!0}).subscribe(ee=>{_.each(ee,(me,De)=>{const Je=document.getElementById(De);Je instanceof HTMLInputElement?(Je.disabled=!1,Je.value=me):Je&&(Je.textContent=me)})},ee=>this.halNotification.handleRawError(ee))}buildRefreshRequest(o,s){const w={element_id:s,fixed_date:jQuery("#budget_fixed_date").val()};return o.find(".budget-item-value").each((j,ee)=>{const me=jQuery(ee);w[me.data("requestKey")]=me.val()||"0"}),w}}zn.\u0275fac=function(o){return new(o||zn)(e.LFG(Ne.W),e.LFG(vi.eN))},zn.\u0275prov=e.Yz7({token:zn,factory:zn.\u0275fac});class Fo{constructor(){jQuery("costs-subform").each((o,s)=>{const w=jQuery(s),j=w.find(".subform-container"),ee=w.find(".subform-row-template");ee.detach();const me=ee[0].outerHTML;let De=parseInt(w.attr("item-count"));w.on("click",".delete-row-button,.delete-budget-item",Je=>(jQuery(Je.target).closest(".subform-row").remove(),!1)),w.find(".add-row-button,.wp-inline-create--add-link").click(Je=>{Je.preventDefault();const qe=jQuery(me.replace(/INDEX/g,De.toString()));return qe.show(),qe.removeClass("subform-row-template"),qe.find("input.costs-date-picker").prop("required",!0),qe.find('input[id^="cost_type_new_rate_attributes"]').prop("required",!0),j.append(qe),De+=1,j.find(".subform-row:last-child input:first").focus(),!1})})}}Fo.\u0275fac=function(o){return new(o||Fo)},Fo.\u0275prov=e.Yz7({token:Fo,factory:Fo.\u0275fac});var Da=t(67248);class k_ extends vo.X{}const P_=(0,Da.n)(k_);function x_(g){window.OpenProject.getPluginContext().then(o=>{o.services.editField.extendFieldType("select",["Budget"]),o.services.displayField.extendFieldType("resource",["Budget"]),o.services.halResource.registerResource("Budget",{cls:P_});const{states:j}=o.services;j.add("budgets",(0,$n.r9)()),new Fo,class{static listen(){jQuery(document).on("click",".costs--edit-planned-costs-btn",o=>{const s=o.target,w=s.nextElementSibling;s.hidden=!0,w.hidden=!1,w.querySelector("input").disabled=!1}),jQuery(document).on("click",".costs--edit-planned-costs-cancel-btn",o=>{const s=o.target.closest(".costs--edit-form");s.previousElementSibling.hidden=!1,s.hidden=!0,s.querySelector("input").disabled=!0})}}.listen(),g.get(zn).listen()})}class Wo{constructor(o){x_(o)}}Wo.\u0275fac=function(o){return new(o||Wo)(e.LFG(e.zs3))},Wo.\u0275mod=e.oAB({type:Wo}),Wo.\u0275inj=e.cJS({providers:[zn]});class Aa extends Zr.C{apply(o,s){super.apply(o,s),this.loadIfNecessary()}loadIfNecessary(){this.value&&!1===this.value.$loaded&&this.value.$load().then(()=>{"WorkPackage"===this.resource.$source._type&&this.apiV3Service.work_packages.cache.touch(this.resource.id)})}get title(){return""}render(o,s){this.isEmpty()?o.textContent=this.placeholder:this.value.elements.forEach((w,j)=>{this.resource.showCosts?this.renderCostAsLink(w,o,j):this.renderCostAsText(w,o,j)})}isEmpty(){return!this.value||!this.value.elements||0===this.value.elements.length}renderCostAsLink(o,s,w){const j=this.resource.showCosts,ee=document.createElement("a");ee.href=j.href+"&unit="+o.costType.id,ee.setAttribute("target","_blank"),ee.textContent=o.spentUnits+" "+o.costType.name,s.appendChild(ee),this.addSeparator(s,w)}renderCostAsText(o,s,w){const j=document.createElement("span");j.textContent=o.spentUnits+" "+o.costType.name,s.appendChild(j),this.addSeparator(s,w)}addSeparator(o,s){if(s<this.value.elements.length-1){const w=document.createElement("span");w.textContent=", ",o.appendChild(w)}}}(0,se.gn)([(0,we.W)(),(0,se.w6)("design:type",R.T)],Aa.prototype,"apiV3Service",void 0);class E_ extends Zr.C{isEmpty(){return!this.value||!parseFloat(this.value.match(/\d+/g)[0])}}class Uo{constructor(o){window.OpenProject.getPluginContext().then(o=>{const s=o.services.displayField;s.addFieldType(Aa,"costs",["costsByType"]),s.addFieldType(E_,"currency",["laborCosts","materialCosts","overallCosts"]),o.hooks.workPackageSingleContextMenu(w=>({key:"log_costs",icon:"icon-projects",indexBy(j){const ee=_.findIndex(j,{key:"log_time"});return-1!==ee?ee+1:j.length},resource:"workPackage",link:"logCosts"})),o.hooks.workPackageTableContextMenu(w=>({key:"log_costs",icon:"icon-projects",link:"logCosts",indexBy(j){const ee=_.findIndex(j,{link:"logTime"});return-1!==ee?ee+1:j.length},text:I18n.t("js.button_log_costs")}))})}}function M_(g){const o=g.split(",")[0].indexOf("base64")>=0?atob(g.split(",")[1]):unescape(g.split(",")[1]),s=g.split(",")[0].split(":")[1].split(";")[0],w=o.length,j=new Uint8Array(w);for(let ee=0;ee<w;ee+=1)j[ee]=o.charCodeAt(ee);return new Blob([j],{type:s})}function S_(g,o){return new Promise(s=>{const w=new FileReader;w.onload=j=>{const ee=new Image;ee.onload=()=>s(function(g,o){const s=document.createElement("canvas"),w=s.getContext("2d");let{width:j}=o,{height:ee}=o;j>ee?j>g&&(ee*=g/j,j=g):ee>g&&(j*=g/ee,ee=g),s.width=j,s.height=ee,w.drawImage(o,0,0,j,ee);const me=s.toDataURL("image/jpeg");return[me,M_(me)]}(g,ee)),ee.src=j.target.result},w.readAsDataURL(o)})}Uo.\u0275fac=function(o){return new(o||Uo)(e.LFG(e.zs3))},Uo.\u0275mod=e.oAB({type:Uo}),Uo.\u0275inj=e.cJS({providers:[]});const D_=["avatarFilePicker"];function A_(g,o){if(1&g&&e._UZ(0,"span",6),2&g){const s=e.oxw();e.Q6J("textContent",s.text.wrong_file_format)}}function j_(g,o){if(1&g&&(e.TgZ(0,"fieldset",11),e._UZ(1,"legend",12),e._UZ(2,"img",13),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.text.preview),e.xp6(1),e.Q6J("src",s.avatarPreviewUrl,e.LSH)}}const Z_=function(g){return{"-error":g}};class qs{constructor(o,s,w,j){this.I18n=o,this.elementRef=s,this.toastService=w,this.opFileUpload=j,this.busy=!1,this.fileInvalid=!1,this.text={label_choose_avatar:this.I18n.t("js.avatars.label_choose_avatar"),upload_instructions:this.I18n.t("js.avatars.text_upload_instructions"),error_too_large:this.I18n.t("js.avatars.error_image_too_large"),wrong_file_format:this.I18n.t("js.avatars.wrong_file_format"),button_update:this.I18n.t("js.button_update"),uploading:this.I18n.t("js.avatars.uploading_avatar"),preview:this.I18n.t("js.label_preview")}}ngOnInit(){const o=this.elementRef.nativeElement;this.target=o.getAttribute("target"),this.method=o.getAttribute("method")}onFilePickerChanged(o){const s=Array.from(this.avatarFilePicker.nativeElement.files);if(0===s.length)return;const w=s[0];-1!==["image/jpeg","image/png","image/gif"].indexOf(w.type)?S_(128,w).then(([j,ee])=>{ee.name=w.name,this.avatarFile=ee,this.avatarPreviewUrl=j}):this.fileInvalid=!0}uploadAvatar(o){o.preventDefault(),this.busy=!0;const s=this.opFileUpload.uploadSingle(this.target,this.avatarFile,this.method,"text");this.toastService.addAttachmentUpload(this.text.uploading,[s]),s[1].subscribe(w=>{switch(w.type){case 0:return;case 4:return this.avatarFile.progress=100,this.busy=!1,void window.location.reload();default:return}},w=>{this.toastService.addError(w.error),this.busy=!1})}}qs.\u0275fac=function(o){return new(o||qs)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(M.kl),e.Y36(xr.r))},qs.\u0275cmp=e.Xpm({type:qs,selectors:[["avatar-upload-form"]],viewQuery:function(o,s){if(1&o&&e.Gf(D_,7),2&o){let w;e.iGM(w=e.CRH())&&(s.avatarFilePicker=w.first)}},decls:11,vars:9,consts:[[1,"form--field"],["for","avatar_file_input",1,"form--label",3,"ngClass","textContent"],[1,"form--field-container"],["type","file","accept","image/jpeg,image/png,image/gif","id","avatar_file_input","name","avatar_file_input",3,"change"],["avatarFilePicker",""],[1,"form--field-instructions"],[3,"textContent"],[1,"avatars--error-pane"],[3,"textContent",4,"ngIf"],["class","preview",4,"ngIf"],["type","submit",1,"button","-highlight","-with-icon","icon-checkmark",3,"textContent","click"],[1,"preview"],[1,"preview--legend",3,"textContent"],[1,"avatars--local-avatar-preview",3,"src"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"label",1),e.TgZ(2,"div",2),e.TgZ(3,"input",3,4),e.NdJ("change",function(j){return s.onFilePickerChanged(j)}),e.qZA(),e.qZA(),e.TgZ(5,"div",5),e._UZ(6,"span",6),e.TgZ(7,"div",7),e.YNc(8,A_,1,1,"span",8),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,j_,3,2,"fieldset",9),e.TgZ(10,"button",10),e.NdJ("click",function(j){return s.uploadAvatar(j)}),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngClass",e.VKq(7,Z_,s.fileInvalid))("textContent",s.text.label_choose_avatar),e.xp6(5),e.Q6J("textContent",s.text.upload_instructions),e.xp6(2),e.Q6J("ngIf",s.fileInvalid),e.xp6(1),e.Q6J("ngIf",s.avatarPreviewUrl),e.xp6(1),e.Q6J("textContent",s.text.button_update),e.uIk("disabled",!s.avatarFile||s.busy||void 0))},directives:[D.mk,D.O5],encapsulation:2});class Lo{constructor(o){o.get(f.$).register("openProjectAngularBootstrap",()=>[{selector:"avatar-upload-form",cls:qs}])}}Lo.\u0275fac=function(o){return new(o||Lo)(e.LFG(e.zs3))},Lo.\u0275mod=e.oAB({type:Lo}),Lo.\u0275inj=e.cJS({imports:[[D.ez]]});class R_ extends vo.X{constructor(){super(...arguments),this.attachmentsBackend=!1}}const F_=(0,Da.n)(R_);class Bo{constructor(){window.OpenProject.getPluginContext().then(g=>{g.services.halResource.registerResource("Document",{cls:F_});const{states:s}=g.services;s.add("documents",(0,$n.r9)())})}}Bo.\u0275fac=function(o){return new(o||Bo)},Bo.\u0275mod=e.oAB({type:Bo}),Bo.\u0275inj=e.cJS({});var U_=t(39154),L_=(t(24897),t(79505));class Qo{sanitizeBranchString(o){return o.replace(/&/g,"and ").replace(/ +/g,"-").replace(/[\000-\039]/g,"").replace(/\177/g,"").replace(/[#\\\/\?\*\~\^\:\{\}@\.\[\]'"]/g,"").replace(/^[-]+/g,"").replace(/[-]+$/g,"").replace(/-+/g,"-").trim()}formattingInput(o){const s=o.type.name||"",w=o.id||"";return{id:w,type:s,title:o.subject,url:window.location.origin+o.pathHelper.workPackagePath(w),description:""}}sanitizeShellInput(o){return`${o.replace(/'/g,"\\'")}`}branchName(o){const{type:s,id:w,title:j}=this.formattingInput(o);return`${this.sanitizeBranchString(s)}/${w}-${this.sanitizeBranchString(j)}`.toLocaleLowerCase()}commitMessage(o){const{title:s,id:w,description:j,url:ee}=this.formattingInput(o);return`[#${w}] ${s}\n\n${j}\n\n${ee}\n`.replace(/\n\n+/g,"\n\n")}gitCommand(o){const s=this.branchName(o),w=this.commitMessage(o);return`git checkout -b '${this.sanitizeShellInput(s)}' && git commit --allow-empty -m '${this.sanitizeShellInput(w)}'`}}Qo.\u0275fac=function(o){return new(o||Qo)},Qo.\u0275prov=e.Yz7({token:Qo,factory:Qo.\u0275fac,providedIn:"root"});var B_=t(36322),Q_=t(30712);function N_(g,o){if(1&g&&e._UZ(0,"div",11),2&g){const s=e.oxw(2);e.Q6J("textContent",s.lastCopyResult)}}function J_(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",3),e.TgZ(1,"label",4),e.TgZ(2,"div",5),e._uU(3),e.qZA(),e.TgZ(4,"div",6),e._UZ(5,"input",7),e.TgZ(6,"button",8),e.NdJ("click",function(){const ee=e.CHM(s).$implicit;return e.oxw().onCopyButtonClick(ee)}),e._UZ(7,"op-icon",9),e.qZA(),e.YNc(8,N_,1,1,"div",10),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.xp6(3),e.Oqu(s.name),e.xp6(2),e.Q6J("value",s.textToCopy()),e.xp6(1),e.uIk("aria-label",w.text.copyButtonHelpText),e.xp6(2),e.Q6J("ngIf",w.showCopyResult&&s.id===w.copiedSnippetId)}}class Xs extends B_.n{constructor(o,s,w){super(o),this.locals=o,this.I18n=s,this.gitActions=w,this.text={title:this.I18n.t("js.github_integration.tab_header.git_actions.title"),copyButtonHelpText:this.I18n.t("js.github_integration.tab_header.git_actions.copy_button_help"),copyResult:{success:this.I18n.t("js.github_integration.tab_header.git_actions.copy_success"),error:this.I18n.t("js.github_integration.tab_header.git_actions.copy_error")}},this.lastCopyResult=this.text.copyResult.success,this.showCopyResult=!1,this.copiedSnippetId="",this.snippets=[{id:"branch",name:this.I18n.t("js.github_integration.tab_header.git_actions.branch_name"),textToCopy:()=>this.gitActions.branchName(this.workPackage)},{id:"message",name:this.I18n.t("js.github_integration.tab_header.git_actions.commit_message"),textToCopy:()=>this.gitActions.commitMessage(this.workPackage)},{id:"command",name:this.I18n.t("js.github_integration.tab_header.git_actions.cmd"),textToCopy:()=>this.gitActions.gitCommand(this.workPackage)}],this.workPackage=this.locals.workPackage}onCopyButtonClick(o){(0,L_.Z)(o.textToCopy())?this.lastCopyResult=this.text.copyResult.success:this.lastCopyResult=this.text.copyResult.error,this.copiedSnippetId=o.id,this.showCopyResult=!0,window.setTimeout(()=>{this.showCopyResult=!1},2e3)}}Xs.\u0275fac=function(o){return new(o||Xs)(e.Y36(Q_.Q),e.Y36(y.D),e.Y36(Qo))},Xs.\u0275cmp=e.Xpm({type:Xs,selectors:[["op-git-actions-menu"]],inputs:{workPackage:"workPackage"},features:[e.qOj],decls:4,vars:2,consts:[[1,"git-actions-menu","dropdown-relative","dropdown","-overflow-in-view","dropdown-anchor-right"],[1,"title"],["class","copy-wrapper op-form-field",4,"ngFor","ngForOf"],[1,"copy-wrapper","op-form-field"],[1,"op-form-field--label-wrap"],[1,"op-form-field--label"],[1,"op-form-field--input"],["type","text","readonly","true",1,"copy-content","op-input",3,"value"],["type","button",1,"button","copy-button",3,"click"],["icon-classes","button--icon icon-copy"],["class","copy-result-message",3,"textContent",4,"ngIf"],[1,"copy-result-message",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"h3",1),e._uU(2),e.qZA(),e.YNc(3,J_,9,4,"div",2),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title),e.xp6(1),e.Q6J("ngForOf",s.snippets))},directives:[D.sg,Ye.o,D.O5],styles:['.git-actions-menu[_ngcontent-%COMP%]{background-color:var(--body-background);border:var(--content-default-border-width) solid var(--content-default-border-color);padding:1rem 1rem 2rem;min-width:25rem;box-shadow:.1em .1em .4em #0000001a}.git-actions-menu[_ngcontent-%COMP%]   .copy-wrapper[_ngcontent-%COMP%]{width:100%;position:relative;margin-bottom:1rem}.git-actions-menu[_ngcontent-%COMP%]   .copy-content[_ngcontent-%COMP%]{width:calc(100% - 3em);min-height:calc(2 * .65em + .9em + 1px);border-radius:2px 0 0 2px;padding:.65em;color:var(--gray-dark);white-space:pre;resize:none;font-size:.9rem;display:inline-block}.git-actions-menu[_ngcontent-%COMP%]   .copy-button[_ngcontent-%COMP%]{margin:0;border:1px solid #ccc;border-radius:0 2px 2px 0;vertical-align:top;left:-1px;position:relative;font-size:.9rem}.git-actions-menu[_ngcontent-%COMP%]   .copy-button[_ngcontent-%COMP%]:hover{border-color:#999}.git-actions-menu[_ngcontent-%COMP%]   .copy-result-message[_ngcontent-%COMP%]{background-color:var(--main-menu-bg-color);display:inline-block;padding:.5em;border-radius:5px;color:var(--main-menu-font-color);position:absolute;right:0;top:calc(2 * .65em + .9em + 1px + 9px);box-shadow:1px 1px 4px var(--gray-dark);z-index:1}.git-actions-menu[_ngcontent-%COMP%]   .copy-result-message[_ngcontent-%COMP%]:before{content:"";border-bottom:.6em solid var(--main-menu-bg-color);height:0;width:0;position:absolute;top:-9px;right:10px;border-left:.3em solid transparent;border-right:.3em solid transparent}']});class er extends Cr.n{constructor(o,s){super(o,s),this.elementRef=o,this.opContextMenu=s}open(o){this.opContextMenu.show(this,o,Xs)}get locals(){return{workPackage:this.workPackage,contextMenuId:"github-integration-git-actions-menu",items:[]}}}er.\u0275fac=function(o){return new(o||er)(e.Y36(e.SBq),e.Y36(vr.$))},er.\u0275dir=e.lG2({type:er,selectors:[["","gitActionsCopyDropdown",""]],inputs:{workPackage:["gitActionsCopyDropdown-workPackage","workPackage"]},features:[e.qOj]});class tr{constructor(o){this.I18n=o,this.text={title:this.I18n.t("js.github_integration.tab_header.title"),createPrButtonLabel:this.I18n.t("js.github_integration.tab_header.create_pr.label"),createPrButtonDescription:this.I18n.t("js.github_integration.tab_header.create_pr.description"),gitMenuLabel:this.I18n.t("js.github_integration.tab_header.copy_menu.label"),gitMenuDescription:this.I18n.t("js.github_integration.tab_header.copy_menu.description")}}}tr.\u0275fac=function(o){return new(o||tr)(e.Y36(y.D))},tr.\u0275cmp=e.Xpm({type:tr,selectors:[["tab-header"]],inputs:{workPackage:"workPackage"},decls:10,vars:4,consts:[[1,"github-pr-header"],[1,"title"],["icon-classes","button--icon icon-merge-branch"],[1,"toolbar-items","hide-when-print"],[1,"toolbar-item"],["type","button","gitActionsCopyDropdown","",1,"button","github-git-copy",3,"gitActionsCopyDropdown-workPackage"],["icon-classes","button--icon icon-console-light"],["aria-hidden","true",1,"button--text",3,"textContent"],["icon-classes","button--icon icon-small icon-pulldown hidden-for-mobile"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"h3",1),e._UZ(2,"op-icon",2),e._uU(3),e.qZA(),e.TgZ(4,"ul",3),e.TgZ(5,"li",4),e.TgZ(6,"button",5),e._UZ(7,"op-icon",6),e._UZ(8,"span",7),e._UZ(9,"op-icon",8),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.hij(" ",s.text.title," "),e.xp6(3),e.Q6J("gitActionsCopyDropdown-workPackage",s.workPackage),e.uIk("aria-label",s.text.gitMenuDescription),e.xp6(2),e.Q6J("textContent",s.text.gitMenuLabel))},directives:[Ye.o,er],styles:[".github-pr-header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap-reverse;justify-content:flex-end;border-bottom:1px solid #ddd;margin:0 0 .8rem}.github-pr-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex:1 1 auto;border-bottom:0;margin:0;padding:0;font-weight:bold;font-size:1rem;line-height:32px;text-transform:uppercase}"]});var Y_=t(21501);function $_(g,o){if(1&g&&e._UZ(0,"img",12),2&g){const s=e.oxw();e.Q6J("src",s.pullRequest.githubUser.avatarUrl,e.LSH)}}function V_(g,o){if(1&g&&e._UZ(0,"a",13),2&g){const s=e.oxw();e.Q6J("href",s.pullRequest.githubUser.htmlUrl,e.LSH)("textContent",s.pullRequest.githubUser.login)}}function H_(g,o){if(1&g&&(e.TgZ(0,"span",14),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Oqu(s.text.label_actions)}}function z_(g,o){if(1&g&&(e.TgZ(0,"li",17),e.TgZ(1,"span",18),e._UZ(2,"op-icon",19),e.qZA(),e.TgZ(3,"span",20),e._UZ(4,"img",21),e.qZA(),e.TgZ(5,"span",22),e._UZ(6,"span",23),e._UZ(7,"span",24),e.qZA(),e.TgZ(8,"span",25),e.TgZ(9,"a",26),e._uU(10),e.qZA(),e.qZA(),e.qZA()),2&g){const s=o.$implicit,w=e.oxw(2);e.xp6(1),e.Q6J("ngClass","op-pr-check--state-icon_"+w.checkRunState(s)),e.xp6(1),e.MGl("icon-classes","icon-",w.checkRunStateIcon(s),""),e.Q6J("icon-title",w.checkRunStateText(s)),e.xp6(2),e.Q6J("src",s.appOwnerAvatarUrl,e.LSH),e.xp6(2),e.Q6J("textContent",s.name),e.xp6(1),e.Q6J("textContent",w.checkRunStateText(s)),e.xp6(2),e.Q6J("href",s.detailsUrl,e.LSH),e.xp6(1),e.hij(" ",w.text.label_details," ")}}function K_(g,o){if(1&g&&(e.TgZ(0,"ul",15),e.YNc(1,z_,11,8,"li",16),e.qZA()),2&g){const s=e.oxw();e.uIk("aria-label",s.text.label_actions),e.xp6(1),e.Q6J("ngForOf",s.pullRequest.checkRuns)}}class ir{constructor(o,s){this.PathHelper=o,this.I18n=s,this.text={label_created_by:this.I18n.t("js.label_created_by"),label_last_updated_on:this.I18n.t("js.label_last_updated_on"),label_details:this.I18n.t("js.label_details"),label_actions:this.I18n.t("js.github_integration.github_actions")}}get state(){return"open"===this.pullRequest.state?this.pullRequest.draft?"draft":"open":this.pullRequest.merged?"merged":"closed"}checkRunStateText(o){return o.outputTitle||o.conclusion||o.status}checkRunState(o){return o.conclusion||o.status}checkRunStateIcon(o){switch(this.checkRunState(o)){case"success":return"checkmark";case"queued":return"getting-started";case"in_progress":return"loading1";case"failure":return"cancel";case"timed_out":return"reminder";case"action_required":return"warning";case"stale":return"not-supported";case"skipped":return"redo";case"neutral":case"cancelled":return"minus1";default:return"not-supported"}}}function G_(g,o){if(1&g&&(e.ynx(0),e._UZ(1,"p",2),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("innerHTML",s.getEmptyText(),e.oJD)}}function q_(g,o){if(1&g&&e._UZ(0,"github-pull-request",3),2&g){const s=o.$implicit;e.Q6J("pullRequest",s)}}ir.\u0275fac=function(o){return new(o||ir)(e.Y36(je.j),e.Y36(y.D))},ir.\u0275cmp=e.Xpm({type:ir,selectors:[["github-pull-request"]],hostAttrs:[1,"op-pull-request"],inputs:{pullRequest:"pullRequest"},decls:17,vars:12,consts:[["target","blank",1,"op-pull-request--link",3,"href","textContent"],[1,"op-pull-request--title",3,"textContent"],[1,"op-pull-request--info"],["alt","PR author avatar","class","op-pull-request--avatar op-avatar op-avatar_mini",3,"src",4,"ngIf"],[1,"op-pull-request--user"],[3,"href","textContent",4,"ngIf"],[1,"op-pull-request--date"],[3,"dateTimeValue"],[1,"op-pull-request--state",3,"ngClass"],["icon-classes","button--icon icon-merge-branch"],["class","op-pull-request--checks-label",4,"ngIf"],["class","op-pull-request--checks",4,"ngIf"],["alt","PR author avatar",1,"op-pull-request--avatar","op-avatar","op-avatar_mini",3,"src"],[3,"href","textContent"],[1,"op-pull-request--checks-label"],[1,"op-pull-request--checks"],["class","op-pr-check",4,"ngFor","ngForOf"],[1,"op-pr-check"],[1,"op-pr-check--state-icon",3,"ngClass"],[3,"icon-classes","icon-title"],[1,"op-pr-check--avatar"],["alt","app owner avatar",3,"src"],[1,"op-pr-check--info"],[1,"op-pr-check--name",3,"textContent"],[1,"op-pr-check--state",3,"textContent"],[1,"op-pr-check--details"],[3,"href"]],template:function(o,s){1&o&&(e._UZ(0,"a",0),e._UZ(1,"div",1),e.TgZ(2,"div",2),e._uU(3),e.YNc(4,$_,1,1,"img",3),e.TgZ(5,"span",4),e.YNc(6,V_,1,2,"a",5),e._uU(7,". "),e.qZA(),e.TgZ(8,"span",6),e._uU(9),e._UZ(10,"op-date-time",7),e.qZA(),e._uU(11,".\n"),e.qZA(),e.TgZ(12,"span",8),e._UZ(13,"op-icon",9),e._uU(14),e.qZA(),e.YNc(15,H_,2,1,"span",10),e.YNc(16,K_,2,2,"ul",11)),2&o&&(e.Q6J("href",s.pullRequest.htmlUrl,e.LSH)("textContent",s.pullRequest.repository+"#"+s.pullRequest.number),e.xp6(1),e.Q6J("textContent",s.pullRequest.title),e.xp6(2),e.hij(" ",s.text.label_created_by," "),e.xp6(1),e.Q6J("ngIf",s.pullRequest.githubUser),e.xp6(2),e.Q6J("ngIf",s.pullRequest.githubUser),e.xp6(3),e.hij(" ",s.text.label_last_updated_on," "),e.xp6(1),e.Q6J("dateTimeValue",s.pullRequest.githubUpdatedAt),e.xp6(2),e.Q6J("ngClass","op-pull-request--state_"+s.state),e.xp6(2),e.hij(" ",s.state,"\n"),e.xp6(1),e.Q6J("ngIf",null==s.pullRequest.checkRuns?null:s.pullRequest.checkRuns.length),e.xp6(1),e.Q6J("ngIf",null==s.pullRequest.checkRuns?null:s.pullRequest.checkRuns.length))},directives:[D.O5,Y_.F,D.mk,Ye.o,D.sg],styles:['.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}[_nghost-%COMP%], .op-pull-request[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto auto;grid-template-areas:"link link link link" "title title title state" "info info info info" "checks-label checks-label checks-label checks-label" "checks checks checks checks";margin-bottom:11px;padding-bottom:11px;border-bottom:1px solid #dddddd}[_nghost-%COMP%]:last-child, .op-pull-request[_ngcontent-%COMP%]:last-child{border-bottom:none}--title[_nghost-%COMP%], .op-pull-request--title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap;font-weight:bold;grid-area:title;line-height:32px;margin-right:20px}--avatar[_nghost-%COMP%], .op-pull-request--avatar[_ngcontent-%COMP%]{grid-area:info}--info[_nghost-%COMP%], .op-pull-request--info[_ngcontent-%COMP%]{display:block;margin-bottom:3px;font-size:.9rem;grid-area:info;color:var(--gray-dark);margin-top:-4px}--date[_nghost-%COMP%], .op-pull-request--date[_ngcontent-%COMP%]{grid-area:info}--link[_nghost-%COMP%], .op-pull-request--link[_ngcontent-%COMP%]{grid-area:link;margin-top:6px;font-size:.9rem}--state[_nghost-%COMP%], .op-pull-request--state[_ngcontent-%COMP%]{grid-area:state;display:inline-block;padding:8px 11px;border-radius:16px;border:1px solid #fff;color:#fff;font-size:.9rem;text-transform:capitalize}--state_draft[_nghost-%COMP%], .op-pull-request--state_draft[_ngcontent-%COMP%]{background-color:#6a737d}--state_open[_nghost-%COMP%], .op-pull-request--state_open[_ngcontent-%COMP%]{background-color:#28a745}--state_merged[_nghost-%COMP%], .op-pull-request--state_merged[_ngcontent-%COMP%]{background-color:#6f42c1}--state_closed[_nghost-%COMP%], .op-pull-request--state_closed[_ngcontent-%COMP%]{background-color:#d73a49}--checks-label[_nghost-%COMP%], .op-pull-request--checks-label[_ngcontent-%COMP%]{grid-area:checks-label;margin-top:12px;font-size:.9rem;font-weight:bold}--checks[_nghost-%COMP%], .op-pull-request--checks[_ngcontent-%COMP%]{margin-top:12px;margin-left:0;grid-area:checks}','.op-pr-check[_ngcontent-%COMP%]{display:grid;grid-row:span 4;grid-template-columns:28px 33px 1fr auto;grid-template-areas:"check-state-icon check-avatar check-info check-details";list-style-type:none;border:1px solid #dddddd;padding:.3rem 1rem;background:rgba(0,0,0,.05);font-size:.9rem}.op-pr-check[_ngcontent-%COMP%]:first-child{border-top-right-radius:5px;border-top-left-radius:5px}.op-pr-check[_ngcontent-%COMP%]:last-child{border-bottom-right-radius:5px;border-bottom-left-radius:5px}.op-pr-check--avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{grid-area:check-avatar;display:inline-block;width:22px;height:22px;margin-right:5px;border-radius:var(--user-avatar-border-radius)}.op-pr-check--info[_ngcontent-%COMP%]{grid-area:check-info}.op-pr-check--state[_ngcontent-%COMP%]{color:var(--gray-dark);font-style:italic;margin-left:1em}.op-pr-check--state-icon[_ngcontent-%COMP%]{grid-area:check-state-icon}.op-pr-check--state-icon_queued[_ngcontent-%COMP%]{color:#5f9ea0}.op-pr-check--state-icon_in_progress[_ngcontent-%COMP%]{color:orange}.op-pr-check--state-icon_success[_ngcontent-%COMP%]{color:green}.op-pr-check--state-icon_failure[_ngcontent-%COMP%], .op-pr-check--state-icon_timed_out[_ngcontent-%COMP%], .op-pr-check--state-icon_action_required[_ngcontent-%COMP%], .op-pr-check--state-icon_stale[_ngcontent-%COMP%]{color:red}.op-pr-check--state-icon_skipped[_ngcontent-%COMP%], .op-pr-check--state-icon_neutral[_ngcontent-%COMP%], .op-pr-check--state-icon_cancelled[_ngcontent-%COMP%]{color:gray}.op-pr-check--details[_ngcontent-%COMP%]{grid-area:check-details}']});class nr{constructor(o,s,w,j){this.I18n=o,this.apiV3Service=s,this.halResourceService=w,this.changeDetector=j,this.pullRequests=[]}ngOnInit(){var o;const s=null===(o=this.apiV3Service.work_packages.id({id:this.workPackage.id}))||void 0===o?void 0:o.github_pull_requests.path;this.halResourceService.get(s).subscribe(w=>{this.pullRequests=w.elements,this.changeDetector.detectChanges()})}getEmptyText(){return this.I18n.t("js.github_integration.tab_prs.empty",{wp_id:this.workPackage.id})}}nr.\u0275fac=function(o){return new(o||nr)(e.Y36(y.D),e.Y36(R.T),e.Y36(gt.u),e.Y36(e.sBO))},nr.\u0275cmp=e.Xpm({type:nr,selectors:[["tab-prs"]],hostAttrs:[1,"op-prs"],inputs:{workPackage:"workPackage"},decls:2,vars:2,consts:[[4,"ngIf"],[3,"pullRequest",4,"ngFor","ngForOf"],[3,"innerHTML"],[3,"pullRequest"]],template:function(o,s){1&o&&(e.YNc(0,G_,2,1,"ng-container",0),e.YNc(1,q_,1,1,"github-pull-request",1)),2&o&&(e.Q6J("ngIf",0===s.pullRequests.length),e.xp6(1),e.Q6J("ngForOf",s.pullRequests))},directives:[D.O5,D.sg,ir],encapsulation:2});class or{constructor(o,s){this.PathHelper=o,this.I18n=s}}or.\u0275fac=function(o){return new(o||or)(e.Y36(je.j),e.Y36(y.D))},or.\u0275cmp=e.Xpm({type:or,selectors:[["github-tab"]],inputs:{workPackage:"workPackage"},decls:2,vars:2,consts:[[3,"workPackage"]],template:function(o,s){1&o&&(e._UZ(0,"tab-header",0),e._UZ(1,"tab-prs",0)),2&o&&(e.Q6J("workPackage",s.workPackage),e.xp6(1),e.Q6J("workPackage",s.workPackage))},directives:[tr,nr],encapsulation:2});var X_=t(61289);class No extends X_.N{constructor(o){super(),this.ConfigurationService=o}load(o){return o.github_pull_requests.$update().then(s=>this.sortList(s.elements))}sortList(o,s="createdAt"){return _.sortBy(_.flatten(o),s)}}No.\u0275fac=function(o){return new(o||No)(e.LFG(Me.e))},No.\u0275prov=e.Yz7({token:No,factory:No.\u0275fac});class Jo{constructor(o){o.get(U_.o).register({component:or,name:I18n.t("js.github_integration.work_packages.tab_name"),id:"github",displayable:s=>!!s.github})}}Jo.\u0275fac=function(o){return new(o||Jo)(e.LFG(e.zs3))},Jo.\u0275mod=e.oAB({type:Jo}),Jo.\u0275inj=e.cJS({providers:[No],imports:[[n.H,yi.l]]});class Yo{}Yo.\u0275fac=function(o){return new(o||Yo)},Yo.\u0275mod=e.oAB({type:Yo}),Yo.\u0275inj=e.cJS({imports:[[Wo,Uo,Lo,Bo,Jo]]});var tm=t(27835),im=t(48249),nm=t(96457);let Rr=class extends Vs.cf{constructor(){super((0,Hs.cq)())}};Rr=(0,se.gn)([(0,Vs.yC)({name:"days"}),(0,se.w6)("design:paramtypes",[])],Rr);var om=t(17954);class $o extends om.o{constructor(o,s){super(),this.http=o,this.apiV3Service=s}get daysPath(){return this.apiV3Service.days.path}fetchDays(o){const s=(0,Hs.ZU)(o);return this.http.get(this.daysPath+s).pipe((0,Yt.U)(w=>(0,Hs.zv)(w)),(0,ur.b)(w=>(0,Hs.V7)(this.store,w,s)))}createStore(){return new Rr}}$o.\u0275fac=function(o){return new(o||$o)(e.LFG(vi.eN),e.LFG(R.T))},$o.\u0275prov=e.Yz7({token:$o,factory:$o.\u0275fac});var sm=t(46934);class Vo{}Vo.\u0275fac=function(o){return new(o||Vo)},Vo.\u0275mod=e.oAB({type:Vo}),Vo.\u0275inj=e.cJS({providers:[Ia.v,Dr.W,Ar.D,nm.P,sa.a,$o,sm.s]});var rm=t(87523);class Ho{ngDoBootstrap(o){a.Z.register(...g_),a.Z.bootstrapOptionalDocument(o,document),o._injector.get(f.$).call("openProjectAngularBootstrap").forEach(w=>{a.Z.bootstrapOptionalDocument(o,document,w)})}}Ho.\u0275fac=function(o){return new(o||Ho)},Ho.\u0275mod=e.oAB({type:Ho}),Ho.\u0275inj=e.cJS({providers:[{provide:h.G,useValue:new h.G},{provide:vi.TP,useClass:ds.s,multi:!0},{provide:e.ip1,useFactory:function(g){return()=>{const o=g.get(ao),s=g.get(yn),w=g.get(ho);g.get(Yn),s.register(),o.setupListener(),w.register()}},deps:[e.zs3],multi:!0},id.N,Hn,xr.r,im.c,nd.O,Ze.D,Yn],imports:[[i.b2,n.H,l.s,Vo,Xn,gd.f,c.$,r.E,nn,v.Z,_l.OpenprojectProjectsModule,m.H,no,Pi,u.OpenprojectCalendarModule,ro,lo,uo,oo,To,yo,Ro,Yo,_o,d.UX,mo,C.K,Co,yi.l,tm.OpenProjectInAppNotificationsModule,rm.a]]});var Fr=t(31600);var Wr=t(92340),lm=t(82561),dm=t(8849);class Ur{constructor(){this.contextHooks=[]}addHook(...o){this.contextHooks.push(...o)}hookPromises(){const o=this.contextHooks.map(s=>Promise.resolve(s()));return Promise.all(o)}}class sr extends Ur{constructor(){super();const o=document.querySelector("meta[name=openproject_sentry]");this.loadSentry(o)}loadSentry(o){const s=o.dataset.dsn||"",w=o.dataset.version||"unknown",j=parseFloat(o.dataset.tracingFactor||"0.0");t.e("src_app_core_errors_sentry_sentry-dependency_ts").then(t.bind(t,17046)).then(ee=>{const me=ee.Sentry;me.init({dsn:s,debug:!Wr.N.production,release:w,environment:Wr.N.production?"production":"development",integrations:[new ee.Integrations.BrowserTracing],tracesSampler:De=>{switch(De.transactionContext.op){case"op":case"navigation":return Math.min(.01*j,1);default:return Math.min(.001*j,1)}},ignoreErrors:["The transition has been superseded by a different transition","Uncaught (in promise)","Non-Error exception captured with keys: $embedded, $halType, $links, $loaded"],beforeSend:(De,Je)=>sr.filterEvent(De,Je)}),this.sentryLoaded(me)})}sentryLoaded(o){this.client=o,o.configureScope(this.setupContext.bind(this))}captureMessage(o,s="info"){this.client?this.client.withScope(w=>{this.setupContext(w).then(()=>this.client.captureMessage(o,lm.z.fromString(s)))}):(0,rn.qu)("Sentry is not yet loaded, ignoring %O",o)}captureException(o){(!this.client||!o)&&(0,rn.qu)("Sentry is not yet loaded, ignoring error %O",o),"string"!=typeof o?this.client.withScope(s=>{this.setupContext(s).then(()=>this.client.captureException(o))}):this.captureMessage(o,"error")}setupContext(o){return(0,se.mG)(this,void 0,void 0,function*(){o.setTag("code_origin","frontend"),o.setTag("locale",window.I18n.locale),o.setTag("domain",window.location.hostname),o.setTag("url_path",window.location.pathname),o.setExtra("url_query",window.location.search),(yield this.hookPromises()).forEach(w=>{Object.keys(w).forEach(j=>{"user"===j?o.setUser({id:w[j]}):o.setTag(j,w[j])})})})}static filterEvent(o,s){const w=null==s?void 0:s.originalException;return w instanceof vi.UA?sr.filterHttpError(o,w):w instanceof dm.o?sr.filterHttpError(o,w.httpError):document.body.classList.contains("-unsupported-browser")?(console.warn("Browser is not supported, skipping sentry reporting completely."),null):o}static filterHttpError(o,s){return s.status>=500?o:null}}class pm extends Ur{constructor(){super();const o=document.querySelector("meta[name=openproject_appsignal]");this.loadAppsignal(o)}captureMessage(o,s="info"){console.warn("Logging message %O with severity %O",o,s)}captureException(o){if(!this.client||!o)return void(0,rn.qu)("Appsignal is not yet loaded, ignoring error %O",o);const s="string"==typeof o?new Error(o):o;this.client.sendError(s,w=>this.setupContext(w))}loadAppsignal(o){const s=o.dataset.pushKey||"",w=o.dataset.version||"";t.e("src_app_core_errors_appsignal_appsignal-dependency_ts").then(t.bind(t,30835)).then(j=>{this.client=new j.Appsignal({namespace:"frontend",key:s,revision:w}),this.client.use(j.networkPlugin())})}setupContext(o){return(0,se.mG)(this,void 0,void 0,function*(){const s=yield this.hookPromises();let w={locale:window.I18n.locale,domain:window.location.hostname,url_path:window.location.pathname,url_query:window.location.search};return s.forEach(j=>{w=Object.assign(Object.assign({},w),j)}),o.setTags(w),o})}}class um extends Ur{captureMessage(o,s="info"){this.handleOfflineMessage("captureMessage",[o,s])}captureException(o){throw this.handleOfflineMessage("captureException",[o]),o}handleOfflineMessage(o,s){(0,rn.qu)("[ErrorReporter] Would queue message %O %O, but is not configured.",o,s)}}window.global=window;window.appBasePath=Fr("meta[name=app_base_path]").attr("content")||"",t.p=window.appBasePath+"/assets/frontend/",window.ErrorReporter=null!==document.querySelector("meta[name=openproject_sentry]")?new sr:null!==document.querySelector("meta[name=openproject_appsignal]")?new pm:new um,t(50725),t(47281),Wr.N.production&&(0,e.G48)(),(0,rn.SC)(()=>{window.enableReactiveStatesLogging=()=>(0,$n.$C)(!0),window.disableReactiveStatesLogging=()=>(0,$n.$C)(!1)}),function(){const g=document.querySelector("meta[name=openproject_initializer]"),o=g.dataset.locale||"en",s=parseInt(g.dataset.firstDayOfWeek||"",10),w=parseInt(g.dataset.firstWeekOfYear||"",10);return I18n.locale=o,!Number.isNaN(s)&&!Number.isNaN(w)&&(I18n.firstDayOfWeek=s,et.updateLocale(o,{week:{dow:s,doy:7+s-w}})),I18n.pluralization.default=function(j){switch(j){case 0:return["zero","other"];case 1:return["one","other"];default:return["other"]}},t(51230)(`./${I18n.locale}.js`)}().then(()=>{Fr(()=>{i.q6().bootstrapModule(Ho).then(()=>{Fr("body").addClass("__ng2-bootstrap-has-run")})})})},30341:(X,I,t)=>{var i={"./apl/apl.js":[55818,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_apl_apl_js"],"./asciiarmor/asciiarmor.js":[36050,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_asciiarmor_asciiarmor_js"],"./asn.1/asn.1.js":[5923,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_asn_1_asn_1_js"],"./asterisk/asterisk.js":[37277,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_asterisk_asterisk_js"],"./brainfuck/brainfuck.js":[30942,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_brainfuck_brainfuck_js"],"./clike/clike.js":[70409,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_clike_clike_js"],"./clojure/clojure.js":[99505,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_clojure_clojure_js"],"./cmake/cmake.js":[15022,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_cmake_cmake_js"],"./cobol/cobol.js":[96407,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_cobol_cobol_js"],"./coffeescript/coffeescript.js":[13359,"default-node_modules_codemirror_lib_codemirror_js","common"],"./commonlisp/commonlisp.js":[97677,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_commonlisp_commonlisp_js"],"./crystal/crystal.js":[42081,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_crystal_crystal_js"],"./css/css.js":[1040,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_css_css_js"],"./cypher/cypher.js":[13430,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_cypher_cypher_js"],"./d/d.js":[18346,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_d_d_js"],"./dart/dart.js":[21691,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_clike_clike_js","node_modules_codemirror_mode_dart_dart_js"],"./diff/diff.js":[56948,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_diff_diff_js"],"./django/django.js":[73829,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_django_django_js"],"./dockerfile/dockerfile.js":[2875,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_dockerfile_dockerfile_js"],"./dtd/dtd.js":[32178,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_dtd_dtd_js"],"./dylan/dylan.js":[80105,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_dylan_dylan_js"],"./ebnf/ebnf.js":[21856,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ebnf_ebnf_js"],"./ecl/ecl.js":[57813,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ecl_ecl_js"],"./eiffel/eiffel.js":[18251,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_eiffel_eiffel_js"],"./elm/elm.js":[78923,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_elm_elm_js"],"./erlang/erlang.js":[7247,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_erlang_erlang_js"],"./factor/factor.js":[77281,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_factor_factor_js"],"./fcl/fcl.js":[1877,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_fcl_fcl_js"],"./forth/forth.js":[90045,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_forth_forth_js"],"./fortran/fortran.js":[35866,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_fortran_fortran_js"],"./gas/gas.js":[55653,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_gas_gas_js"],"./gfm/gfm.js":[3900,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_markdown_markdown_js","common","node_modules_codemirror_mode_gfm_gfm_js"],"./gherkin/gherkin.js":[56061,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_gherkin_gherkin_js"],"./go/go.js":[94883,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_go_go_js"],"./groovy/groovy.js":[93716,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_groovy_groovy_js"],"./haml/haml.js":[33498,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_haml_haml_js"],"./handlebars/handlebars.js":[41025,"default-node_modules_codemirror_lib_codemirror_js","common"],"./haskell-literate/haskell-literate.js":[70852,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_haskell-literate_haskell-literate_js"],"./haskell/haskell.js":[6370,"default-node_modules_codemirror_lib_codemirror_js","common"],"./haxe/haxe.js":[73066,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_haxe_haxe_js"],"./htmlembedded/htmlembedded.js":[83837,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_htmlembedded_htmlembedded_js"],"./htmlmixed/htmlmixed.js":[26083,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","node_modules_codemirror_mode_htmlmixed_htmlmixed_js"],"./http/http.js":[91872,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_http_http_js"],"./idl/idl.js":[14195,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_idl_idl_js"],"./javascript/javascript.js":[39837,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js"],"./jinja2/jinja2.js":[6136,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_jinja2_jinja2_js"],"./jsx/jsx.js":[71557,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","node_modules_codemirror_mode_jsx_jsx_js"],"./julia/julia.js":[93958,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_julia_julia_js"],"./livescript/livescript.js":[22961,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_livescript_livescript_js"],"./lua/lua.js":[96704,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_lua_lua_js"],"./markdown/markdown.js":[90191,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_markdown_markdown_js"],"./mathematica/mathematica.js":[56569,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mathematica_mathematica_js"],"./mbox/mbox.js":[47905,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mbox_mbox_js"],"./mirc/mirc.js":[36167,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mirc_mirc_js"],"./mllike/mllike.js":[50772,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mllike_mllike_js"],"./modelica/modelica.js":[22860,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_modelica_modelica_js"],"./mscgen/mscgen.js":[60351,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mscgen_mscgen_js"],"./mumps/mumps.js":[87269,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mumps_mumps_js"],"./nginx/nginx.js":[73946,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_nginx_nginx_js"],"./nsis/nsis.js":[4866,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_nsis_nsis_js"],"./ntriples/ntriples.js":[90951,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ntriples_ntriples_js"],"./octave/octave.js":[66e3,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_octave_octave_js"],"./oz/oz.js":[24371,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_oz_oz_js"],"./pascal/pascal.js":[36390,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_pascal_pascal_js"],"./pegjs/pegjs.js":[85515,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","node_modules_codemirror_mode_pegjs_pegjs_js"],"./perl/perl.js":[66727,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_perl_perl_js"],"./php/php.js":[13283,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","default-node_modules_codemirror_mode_clike_clike_js","node_modules_codemirror_mode_php_php_js"],"./pig/pig.js":[52488,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_pig_pig_js"],"./powershell/powershell.js":[4757,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_powershell_powershell_js"],"./properties/properties.js":[73226,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_properties_properties_js"],"./protobuf/protobuf.js":[23455,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_protobuf_protobuf_js"],"./pug/pug.js":[60850,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","default-node_modules_codemirror_mode_pug_pug_js"],"./puppet/puppet.js":[16367,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_puppet_puppet_js"],"./python/python.js":[84229,"default-node_modules_codemirror_lib_codemirror_js","common"],"./q/q.js":[92885,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_q_q_js"],"./r/r.js":[26389,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_r_r_js"],"./rpm/rpm.js":[77995,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_rpm_rpm_js"],"./rst/rst.js":[15215,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_rst_rst_js"],"./ruby/ruby.js":[88558,"default-node_modules_codemirror_lib_codemirror_js","common"],"./rust/rust.js":[50871,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_rust_rust_js"],"./sas/sas.js":[17540,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_sas_sas_js"],"./sass/sass.js":[49966,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_css_css_js","common"],"./scheme/scheme.js":[99975,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_scheme_scheme_js"],"./shell/shell.js":[11577,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_shell_shell_js"],"./sieve/sieve.js":[31208,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_sieve_sieve_js"],"./slim/slim.js":[26469,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_slim_slim_js"],"./smalltalk/smalltalk.js":[18009,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_smalltalk_smalltalk_js"],"./smarty/smarty.js":[45002,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_smarty_smarty_js"],"./solr/solr.js":[20899,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_solr_solr_js"],"./soy/soy.js":[5369,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","node_modules_codemirror_mode_soy_soy_js"],"./sparql/sparql.js":[99767,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_sparql_sparql_js"],"./spreadsheet/spreadsheet.js":[31343,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_spreadsheet_spreadsheet_js"],"./sql/sql.js":[85883,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_sql_sql_js"],"./stex/stex.js":[18681,"default-node_modules_codemirror_lib_codemirror_js","common"],"./stylus/stylus.js":[78176,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_stylus_stylus_js"],"./swift/swift.js":[68711,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_swift_swift_js"],"./tcl/tcl.js":[36410,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_tcl_tcl_js"],"./textile/textile.js":[28556,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_textile_textile_js"],"./tiddlywiki/tiddlywiki.js":[55959,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_tiddlywiki_tiddlywiki_js"],"./tiki/tiki.js":[32740,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_tiki_tiki_js"],"./toml/toml.js":[54804,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_toml_toml_js"],"./tornado/tornado.js":[53373,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_tornado_tornado_js"],"./troff/troff.js":[1462,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_troff_troff_js"],"./ttcn-cfg/ttcn-cfg.js":[37942,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ttcn-cfg_ttcn-cfg_js"],"./ttcn/ttcn.js":[88430,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ttcn_ttcn_js"],"./turtle/turtle.js":[18409,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_turtle_turtle_js"],"./twig/twig.js":[71632,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_twig_twig_js"],"./vb/vb.js":[58781,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_vb_vb_js"],"./vbscript/vbscript.js":[24594,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_vbscript_vbscript_js"],"./velocity/velocity.js":[97145,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_velocity_velocity_js"],"./verilog/verilog.js":[2456,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_verilog_verilog_js"],"./vhdl/vhdl.js":[92865,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_vhdl_vhdl_js"],"./vue/vue.js":[88869,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","default-node_modules_codemirror_mode_stylus_stylus_js","default-node_modules_codemirror_mode_pug_pug_js","common","node_modules_codemirror_mode_vue_vue_js"],"./wast/wast.js":[38602,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_wast_wast_js"],"./webidl/webidl.js":[79883,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_webidl_webidl_js"],"./xml/xml.js":[79140,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_xml_xml_js"],"./xquery/xquery.js":[34218,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_xquery_xquery_js"],"./yacas/yacas.js":[34785,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_yacas_yacas_js"],"./yaml-frontmatter/yaml-frontmatter.js":[796,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_yaml-frontmatter_yaml-frontmatter_js"],"./yaml/yaml.js":[35098,"default-node_modules_codemirror_lib_codemirror_js","common"],"./z80/z80.js":[59190,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_z80_z80_js"]};function e(d){if(!t.o(i,d))return Promise.resolve().then(()=>{var n=new Error("Cannot find module '"+d+"'");throw n.code="MODULE_NOT_FOUND",n});var h=i[d],r=h[0];return Promise.all(h.slice(1).map(t.e)).then(()=>t.t(r,23))}e.keys=()=>Object.keys(i),e.id=30341,X.exports=e},32198:(X,I,t)=>{X.exports=global.I18n=t(32091)},46700:(X,I,t)=>{var i={"./af":62275,"./af.js":62275,"./ar":90857,"./ar-dz":11218,"./ar-dz.js":11218,"./ar-kw":14754,"./ar-kw.js":14754,"./ar-ly":66680,"./ar-ly.js":66680,"./ar-ma":92178,"./ar-ma.js":92178,"./ar-sa":56522,"./ar-sa.js":56522,"./ar-tn":95682,"./ar-tn.js":95682,"./ar.js":90857,"./az":70164,"./az.js":70164,"./be":79774,"./be.js":79774,"./bg":60947,"./bg.js":60947,"./bm":21832,"./bm.js":21832,"./bn":89650,"./bn-bd":74477,"./bn-bd.js":74477,"./bn.js":89650,"./bo":66005,"./bo.js":66005,"./br":98492,"./br.js":98492,"./bs":70534,"./bs.js":70534,"./ca":52061,"./ca.js":52061,"./cs":84737,"./cs.js":84737,"./cv":61167,"./cv.js":61167,"./cy":77996,"./cy.js":77996,"./da":9528,"./da.js":9528,"./de":14540,"./de-at":49430,"./de-at.js":49430,"./de-ch":67978,"./de-ch.js":67978,"./de.js":14540,"./dv":83426,"./dv.js":83426,"./el":6616,"./el.js":6616,"./en-au":63816,"./en-au.js":63816,"./en-ca":32162,"./en-ca.js":32162,"./en-gb":83305,"./en-gb.js":83305,"./en-ie":61954,"./en-ie.js":61954,"./en-il":43060,"./en-il.js":43060,"./en-in":59923,"./en-in.js":59923,"./en-nz":13540,"./en-nz.js":13540,"./en-sg":16505,"./en-sg.js":16505,"./eo":41907,"./eo.js":41907,"./es":86640,"./es-do":41246,"./es-do.js":41246,"./es-mx":56131,"./es-mx.js":56131,"./es-us":36430,"./es-us.js":36430,"./es.js":86640,"./et":62551,"./et.js":62551,"./eu":32711,"./eu.js":32711,"./fa":54572,"./fa.js":54572,"./fi":33390,"./fi.js":33390,"./fil":87860,"./fil.js":87860,"./fo":48216,"./fo.js":48216,"./fr":99291,"./fr-ca":98527,"./fr-ca.js":98527,"./fr-ch":58407,"./fr-ch.js":58407,"./fr.js":99291,"./fy":47054,"./fy.js":47054,"./ga":49540,"./ga.js":49540,"./gd":73917,"./gd.js":73917,"./gl":51486,"./gl.js":51486,"./gom-deva":56245,"./gom-deva.js":56245,"./gom-latn":48868,"./gom-latn.js":48868,"./gu":59652,"./gu.js":59652,"./he":89019,"./he.js":89019,"./hi":42040,"./hi.js":42040,"./hr":63402,"./hr.js":63402,"./hu":79322,"./hu.js":79322,"./hy-am":27609,"./hy-am.js":27609,"./id":57942,"./id.js":57942,"./is":98275,"./is.js":98275,"./it":73053,"./it-ch":4378,"./it-ch.js":4378,"./it.js":73053,"./ja":46176,"./ja.js":46176,"./jv":679,"./jv.js":679,"./ka":92726,"./ka.js":92726,"./kk":72953,"./kk.js":72953,"./km":86957,"./km.js":86957,"./kn":59181,"./kn.js":59181,"./ko":47148,"./ko.js":47148,"./ku":27752,"./ku.js":27752,"./ky":65675,"./ky.js":65675,"./lb":41263,"./lb.js":41263,"./lo":65746,"./lo.js":65746,"./lt":11143,"./lt.js":11143,"./lv":38753,"./lv.js":38753,"./me":44054,"./me.js":44054,"./mi":31573,"./mi.js":31573,"./mk":30202,"./mk.js":30202,"./ml":68523,"./ml.js":68523,"./mn":79794,"./mn.js":79794,"./mr":56681,"./mr.js":56681,"./ms":56975,"./ms-my":39859,"./ms-my.js":39859,"./ms.js":56975,"./mt":3691,"./mt.js":3691,"./my":5152,"./my.js":5152,"./nb":7607,"./nb.js":7607,"./ne":21526,"./ne.js":21526,"./nl":86368,"./nl-be":40076,"./nl-be.js":40076,"./nl.js":86368,"./nn":68420,"./nn.js":68420,"./oc-lnc":51906,"./oc-lnc.js":51906,"./pa-in":94504,"./pa-in.js":94504,"./pl":54721,"./pl.js":54721,"./pt":74645,"./pt-br":54548,"./pt-br.js":54548,"./pt.js":74645,"./ro":71977,"./ro.js":71977,"./ru":26042,"./ru.js":26042,"./sd":78849,"./sd.js":78849,"./se":27739,"./se.js":27739,"./si":50084,"./si.js":50084,"./sk":92449,"./sk.js":92449,"./sl":23086,"./sl.js":23086,"./sq":33139,"./sq.js":33139,"./sr":30607,"./sr-cyrl":30063,"./sr-cyrl.js":30063,"./sr.js":30607,"./ss":40131,"./ss.js":40131,"./sv":21665,"./sv.js":21665,"./sw":5642,"./sw.js":5642,"./ta":33622,"./ta.js":33622,"./te":74825,"./te.js":74825,"./tet":48336,"./tet.js":48336,"./tg":39238,"./tg.js":39238,"./th":99463,"./th.js":99463,"./tk":39986,"./tk.js":39986,"./tl-ph":29672,"./tl-ph.js":29672,"./tlh":40043,"./tlh.js":40043,"./tr":51212,"./tr.js":51212,"./tzl":50110,"./tzl.js":50110,"./tzm":80482,"./tzm-latn":38309,"./tzm-latn.js":38309,"./tzm.js":80482,"./ug-cn":42495,"./ug-cn.js":42495,"./uk":54157,"./uk.js":54157,"./ur":80984,"./ur.js":80984,"./uz":64141,"./uz-latn":43662,"./uz-latn.js":43662,"./uz.js":64141,"./vi":12607,"./vi.js":12607,"./x-pseudo":66460,"./x-pseudo.js":66460,"./yo":92948,"./yo.js":92948,"./zh-cn":62658,"./zh-cn.js":62658,"./zh-hk":39352,"./zh-hk.js":39352,"./zh-mo":38274,"./zh-mo.js":38274,"./zh-tw":98451,"./zh-tw.js":98451};function e(h){var r=d(h);return t(r)}function d(h){if(!t.o(i,h)){var r=new Error("Cannot find module '"+h+"'");throw r.code="MODULE_NOT_FOUND",r}return i[h]}e.keys=function(){return Object.keys(i)},e.resolve=d,X.exports=e,e.id=46700},37294:(X,I,t)=>{var i={"./admin_users":[5022,7,"src_app_core_augmenting_dynamic-scripts_admin_users_js"],"./admin_users.js":[5022,7,"src_app_core_augmenting_dynamic-scripts_admin_users_js"],"./administration_settings":[62739,7,"src_app_core_augmenting_dynamic-scripts_administration_settings_js"],"./administration_settings.js":[62739,7,"src_app_core_augmenting_dynamic-scripts_administration_settings_js"],"./backlogs":[32505,7,"common","src_app_core_augmenting_dynamic-scripts_backlogs_js"],"./backlogs.js":[32505,7,"common","src_app_core_augmenting_dynamic-scripts_backlogs_js"],"./backlogs/backlog":[57915,7,"common"],"./backlogs/backlog.js":[57915,7,"common"],"./backlogs/burndown":[12847,7,"common"],"./backlogs/burndown.js":[12847,7,"common"],"./backlogs/common":[61562,7,"common"],"./backlogs/common.js":[61562,7,"common"],"./backlogs/editable_inplace":[68040,7,"common"],"./backlogs/editable_inplace.js":[68040,7,"common"],"./backlogs/impediment":[86733,7,"common"],"./backlogs/impediment.js":[86733,7,"common"],"./backlogs/master_backlog":[6250,7,"common"],"./backlogs/master_backlog.js":[6250,7,"common"],"./backlogs/model":[20527,7,"common"],"./backlogs/model.js":[20527,7,"common"],"./backlogs/show_main":[63074,7,"common"],"./backlogs/show_main.js":[63074,7,"common"],"./backlogs/sprint":[80933,7,"common"],"./backlogs/sprint.js":[80933,7,"common"],"./backlogs/story":[71076,7,"common"],"./backlogs/story.js":[71076,7,"common"],"./backlogs/task":[10926,7,"common"],"./backlogs/task.js":[10926,7,"common"],"./backlogs/taskboard":[59439,7,"common"],"./backlogs/taskboard.js":[59439,7,"common"],"./backlogs/work_package":[39503,7,"common"],"./backlogs/work_package.js":[39503,7,"common"],"./custom_fields":[95691,7,"src_app_core_augmenting_dynamic-scripts_custom_fields_js"],"./custom_fields.js":[95691,7,"src_app_core_augmenting_dynamic-scripts_custom_fields_js"],"./forums":[99068,7,"src_app_core_augmenting_dynamic-scripts_forums_js"],"./forums.js":[99068,7,"src_app_core_augmenting_dynamic-scripts_forums_js"],"./global_roles":[49140,7,"src_app_core_augmenting_dynamic-scripts_global_roles_ts"],"./global_roles.ts":[49140,7,"src_app_core_augmenting_dynamic-scripts_global_roles_ts"],"./meeting":[81522,7,"src_app_core_augmenting_dynamic-scripts_meeting_js"],"./meeting.js":[81522,7,"src_app_core_augmenting_dynamic-scripts_meeting_js"],"./members_form":[48299,7,"src_app_core_augmenting_dynamic-scripts_members_form_js"],"./members_form.js":[48299,7,"src_app_core_augmenting_dynamic-scripts_members_form_js"],"./new_user":[52722,7,"src_app_core_augmenting_dynamic-scripts_new_user_js"],"./new_user.js":[52722,7,"src_app_core_augmenting_dynamic-scripts_new_user_js"],"./project":[98798,7,"src_app_core_augmenting_dynamic-scripts_project_js"],"./project.js":[98798,7,"src_app_core_augmenting_dynamic-scripts_project_js"],"./project_form_listener":[65904,7,"src_app_core_augmenting_dynamic-scripts_project_form_listener_js"],"./project_form_listener.js":[65904,7,"src_app_core_augmenting_dynamic-scripts_project_form_listener_js"],"./repository_navigation":[78076,7,"src_app_core_augmenting_dynamic-scripts_repository_navigation_js"],"./repository_navigation.js":[78076,7,"src_app_core_augmenting_dynamic-scripts_repository_navigation_js"],"./repository_settings":[58562,7,"src_app_core_augmenting_dynamic-scripts_repository_settings_js"],"./repository_settings.js":[58562,7,"src_app_core_augmenting_dynamic-scripts_repository_settings_js"],"./two_factor_authentication":[84078,9,"src_app_core_augmenting_dynamic-scripts_two_factor_authentication_ts"],"./two_factor_authentication.ts":[84078,9,"src_app_core_augmenting_dynamic-scripts_two_factor_authentication_ts"]};function e(d){if(!t.o(i,d))return Promise.resolve().then(()=>{var n=new Error("Cannot find module '"+d+"'");throw n.code="MODULE_NOT_FOUND",n});var h=i[d],r=h[0];return Promise.all(h.slice(2).map(t.e)).then(()=>t.t(r,16|h[1]))}e.keys=()=>Object.keys(i),e.id=37294,X.exports=e},51230:(X,I,t)=>{var i={"./af.js":[63158,"src_locales_af_js"],"./ar.js":[71100,"src_locales_ar_js"],"./az.js":[8135,"src_locales_az_js"],"./be.js":[27095,"src_locales_be_js"],"./bg.js":[2140,"src_locales_bg_js"],"./bn.js":[27e3,"src_locales_bn_js"],"./bs.js":[72886,"src_locales_bs_js"],"./ca-CAT.js":[76700,"src_locales_ca-CAT_js"],"./ca.js":[83103,"src_locales_ca_js"],"./ckb-IR.js":[79637,"src_locales_ckb-IR_js"],"./cs.js":[54042,"src_locales_cs_js"],"./cy.js":[28689,"src_locales_cy_js"],"./da-DK.js":[4399,"src_locales_da-DK_js"],"./da.js":[7331,"src_locales_da_js"],"./de-AT.js":[72475,"src_locales_de-AT_js"],"./de-CH.js":[16864,"src_locales_de-CH_js"],"./de-DE.js":[72082,"src_locales_de-DE_js"],"./de.js":[81972,"src_locales_de_js"],"./ee.js":[3682,"src_locales_ee_js"],"./el-CY.js":[64354,"src_locales_el-CY_js"],"./el.js":[97792,"src_locales_el_js"],"./en-AU.js":[45079,"src_locales_en-AU_js"],"./en-BORK.js":[73697,"src_locales_en-BORK_js"],"./en-CA.js":[10653,"src_locales_en-CA_js"],"./en-CY.js":[20608,"src_locales_en-CY_js"],"./en-GB.js":[85186,"src_locales_en-GB_js"],"./en-IE.js":[78114,"src_locales_en-IE_js"],"./en-IN.js":[29656,"src_locales_en-IN_js"],"./en-IND.js":[4861,"src_locales_en-IND_js"],"./en-MS.js":[65442,"src_locales_en-MS_js"],"./en-NEP.js":[56844,"src_locales_en-NEP_js"],"./en-NG.js":[19325,"src_locales_en-NG_js"],"./en-NZ.js":[6086,"src_locales_en-NZ_js"],"./en-PAK.js":[58215,"src_locales_en-PAK_js"],"./en-SG.js":[66590,"src_locales_en-SG_js"],"./en-TH.js":[11443,"src_locales_en-TH_js"],"./en-TT.js":[75109,"src_locales_en-TT_js"],"./en-UG.js":[76819,"src_locales_en-UG_js"],"./en-US.js":[66183,"src_locales_en-US_js"],"./en-ZA.js":[26790,"src_locales_en-ZA_js"],"./en-au-ocker.js":[82676,"src_locales_en-au-ocker_js"],"./en.js":[49058,"src_locales_en_js"],"./eo.js":[13634,"src_locales_eo_js"],"./es-419.js":[14585,"src_locales_es-419_js"],"./es-AR.js":[84730,"src_locales_es-AR_js"],"./es-CL.js":[90497,"src_locales_es-CL_js"],"./es-CO.js":[58668,"src_locales_es-CO_js"],"./es-CR.js":[61158,"src_locales_es-CR_js"],"./es-EC.js":[51495,"src_locales_es-EC_js"],"./es-ES.js":[73295,"src_locales_es-ES_js"],"./es-MX.js":[86920,"src_locales_es-MX_js"],"./es-NI.js":[72142,"src_locales_es-NI_js"],"./es-PA.js":[71093,"src_locales_es-PA_js"],"./es-PE.js":[1470,"src_locales_es-PE_js"],"./es-US.js":[41433,"src_locales_es-US_js"],"./es-VE.js":[68880,"src_locales_es-VE_js"],"./es.js":[48238,"src_locales_es_js"],"./et.js":[97443,"src_locales_et_js"],"./eu.js":[84126,"src_locales_eu_js"],"./fa.js":[81870,"src_locales_fa_js"],"./fi-FI.js":[1552,"src_locales_fi-FI_js"],"./fi.js":[13587,"src_locales_fi_js"],"./fil.js":[7612,"src_locales_fil_js"],"./fr-CA.js":[82236,"src_locales_fr-CA_js"],"./fr-CH.js":[71025,"src_locales_fr-CH_js"],"./fr-FR.js":[81079,"src_locales_fr-FR_js"],"./fr.js":[38703,"src_locales_fr_js"],"./fy.js":[60658,"src_locales_fy_js"],"./gl.js":[61372,"src_locales_gl_js"],"./he.js":[62539,"src_locales_he_js"],"./hi-IN.js":[86299,"src_locales_hi-IN_js"],"./hi.js":[65684,"src_locales_hi_js"],"./hr.js":[69006,"src_locales_hr_js"],"./hu.js":[67207,"src_locales_hu_js"],"./hy.js":[69662,"src_locales_hy_js"],"./id.js":[67629,"src_locales_id_js"],"./is.js":[88879,"src_locales_is_js"],"./it-CH.js":[42753,"src_locales_it-CH_js"],"./it.js":[91281,"src_locales_it_js"],"./ja.js":[25276,"src_locales_ja_js"],"./ka.js":[87716,"src_locales_ka_js"],"./kk.js":[87693,"src_locales_kk_js"],"./km.js":[20202,"src_locales_km_js"],"./kn.js":[71330,"src_locales_kn_js"],"./ko.js":[9312,"src_locales_ko_js"],"./lb.js":[39574,"src_locales_lb_js"],"./lo.js":[46772,"src_locales_lo_js"],"./lol.js":[36027,"src_locales_lol_js"],"./lt.js":[38328,"src_locales_lt_js"],"./lv.js":[82289,"src_locales_lv_js"],"./mg.js":[94740,"src_locales_mg_js"],"./mi-NZ.js":[6740,"src_locales_mi-NZ_js"],"./mk.js":[91210,"src_locales_mk_js"],"./ml.js":[87452,"src_locales_ml_js"],"./mn.js":[79835,"src_locales_mn_js"],"./mr-IN.js":[32737,"src_locales_mr-IN_js"],"./ms.js":[12873,"src_locales_ms_js"],"./nb-NO.js":[52915,"src_locales_nb-NO_js"],"./nb.js":[99343,"src_locales_nb_js"],"./ne.js":[60983,"src_locales_ne_js"],"./nl.js":[63837,"src_locales_nl_js"],"./nn.js":[62144,"src_locales_nn_js"],"./no-NO.js":[40855,"src_locales_no-NO_js"],"./no.js":[42684,"src_locales_no_js"],"./oc.js":[76003,"src_locales_oc_js"],"./or.js":[89030,"src_locales_or_js"],"./pa.js":[42335,"src_locales_pa_js"],"./pap-AW.js":[82268,"src_locales_pap-AW_js"],"./pap-CW.js":[76212,"src_locales_pap-CW_js"],"./pl.js":[52635,"src_locales_pl_js"],"./pt-BR.js":[94145,"src_locales_pt-BR_js"],"./pt-PT.js":[40643,"src_locales_pt-PT_js"],"./pt.js":[38366,"src_locales_pt_js"],"./rm.js":[99603,"src_locales_rm_js"],"./ro.js":[58721,"src_locales_ro_js"],"./ru.js":[85745,"src_locales_ru_js"],"./rw.js":[79666,"src_locales_rw_js"],"./si.js":[74743,"src_locales_si_js"],"./sk.js":[88230,"src_locales_sk_js"],"./sl.js":[31928,"src_locales_sl_js"],"./sq.js":[41520,"src_locales_sq_js"],"./sr.js":[84072,"src_locales_sr_js"],"./st.js":[58413,"src_locales_st_js"],"./sv-SE.js":[88395,"src_locales_sv-SE_js"],"./sv.js":[80919,"src_locales_sv_js"],"./sw.js":[38397,"src_locales_sw_js"],"./ta.js":[27908,"src_locales_ta_js"],"./te.js":[83950,"src_locales_te_js"],"./th.js":[33683,"src_locales_th_js"],"./tl.js":[43909,"src_locales_tl_js"],"./tr.js":[65320,"src_locales_tr_js"],"./tt.js":[99083,"src_locales_tt_js"],"./ug.js":[34557,"src_locales_ug_js"],"./uk.js":[5034,"src_locales_uk_js"],"./ur.js":[2978,"src_locales_ur_js"],"./uz.js":[38964,"src_locales_uz_js"],"./vi.js":[88695,"src_locales_vi_js"],"./wo.js":[36511,"src_locales_wo_js"],"./zh-CN.js":[42640,"src_locales_zh-CN_js"],"./zh-HK.js":[17264,"src_locales_zh-HK_js"],"./zh-TW.js":[34573,"src_locales_zh-TW_js"],"./zh-YUE.js":[17662,"src_locales_zh-YUE_js"]};function e(d){if(!t.o(i,d))return Promise.resolve().then(()=>{var n=new Error("Cannot find module '"+d+"'");throw n.code="MODULE_NOT_FOUND",n});var h=i[d],r=h[0];return t.e(h[1]).then(()=>t.t(r,23))}e.keys=()=>Object.keys(i),e.id=51230,X.exports=e},87983:(X,I,t)=>{var i={"./af.js":[61225,"src_vendor_ckeditor_translations_af_js"],"./ar.js":[99858,"src_vendor_ckeditor_translations_ar_js"],"./ast.js":[85552,"src_vendor_ckeditor_translations_ast_js"],"./az.js":[73469,"src_vendor_ckeditor_translations_az_js"],"./bg.js":[44512,"src_vendor_ckeditor_translations_bg_js"],"./bs.js":[28453,"src_vendor_ckeditor_translations_bs_js"],"./ca.js":[26287,"src_vendor_ckeditor_translations_ca_js"],"./cs.js":[4543,"src_vendor_ckeditor_translations_cs_js"],"./da.js":[23677,"src_vendor_ckeditor_translations_da_js"],"./de-ch.js":[94783,"src_vendor_ckeditor_translations_de-ch_js"],"./de.js":[21005,"src_vendor_ckeditor_translations_de_js"],"./el.js":[77507,"src_vendor_ckeditor_translations_el_js"],"./en-au.js":[81258,"src_vendor_ckeditor_translations_en-au_js"],"./en-gb.js":[90287,"src_vendor_ckeditor_translations_en-gb_js"],"./eo.js":[90298,"src_vendor_ckeditor_translations_eo_js"],"./es.js":[88151,"src_vendor_ckeditor_translations_es_js"],"./et.js":[47523,"src_vendor_ckeditor_translations_et_js"],"./eu.js":[27170,"src_vendor_ckeditor_translations_eu_js"],"./fa.js":[44090,"src_vendor_ckeditor_translations_fa_js"],"./fi.js":[37469,"src_vendor_ckeditor_translations_fi_js"],"./fr.js":[34457,"src_vendor_ckeditor_translations_fr_js"],"./gl.js":[7652,"src_vendor_ckeditor_translations_gl_js"],"./gu.js":[68407,"src_vendor_ckeditor_translations_gu_js"],"./he.js":[27929,"src_vendor_ckeditor_translations_he_js"],"./hi.js":[35011,"src_vendor_ckeditor_translations_hi_js"],"./hr.js":[49871,"src_vendor_ckeditor_translations_hr_js"],"./hu.js":[44330,"src_vendor_ckeditor_translations_hu_js"],"./id.js":[12297,"src_vendor_ckeditor_translations_id_js"],"./it.js":[94680,"src_vendor_ckeditor_translations_it_js"],"./ja.js":[32041,"src_vendor_ckeditor_translations_ja_js"],"./jv.js":[76835,"src_vendor_ckeditor_translations_jv_js"],"./km.js":[5338,"src_vendor_ckeditor_translations_km_js"],"./kn.js":[42542,"src_vendor_ckeditor_translations_kn_js"],"./ko.js":[55539,"src_vendor_ckeditor_translations_ko_js"],"./ku.js":[50326,"src_vendor_ckeditor_translations_ku_js"],"./lt.js":[99071,"src_vendor_ckeditor_translations_lt_js"],"./lv.js":[10779,"src_vendor_ckeditor_translations_lv_js"],"./ms.js":[20624,"src_vendor_ckeditor_translations_ms_js"],"./nb.js":[38611,"src_vendor_ckeditor_translations_nb_js"],"./ne.js":[12749,"src_vendor_ckeditor_translations_ne_js"],"./nl.js":[48140,"src_vendor_ckeditor_translations_nl_js"],"./no.js":[41831,"src_vendor_ckeditor_translations_no_js"],"./oc.js":[90459,"src_vendor_ckeditor_translations_oc_js"],"./pl.js":[79377,"src_vendor_ckeditor_translations_pl_js"],"./pt-br.js":[97416,"src_vendor_ckeditor_translations_pt-br_js"],"./pt.js":[55567,"src_vendor_ckeditor_translations_pt_js"],"./ro.js":[87462,"src_vendor_ckeditor_translations_ro_js"],"./ru.js":[25675,"src_vendor_ckeditor_translations_ru_js"],"./si.js":[89298,"src_vendor_ckeditor_translations_si_js"],"./sk.js":[78948,"src_vendor_ckeditor_translations_sk_js"],"./sl.js":[6921,"src_vendor_ckeditor_translations_sl_js"],"./sq.js":[92816,"src_vendor_ckeditor_translations_sq_js"],"./sr-latn.js":[67221,"src_vendor_ckeditor_translations_sr-latn_js"],"./sr.js":[91817,"src_vendor_ckeditor_translations_sr_js"],"./sv.js":[53530,"src_vendor_ckeditor_translations_sv_js"],"./th.js":[58264,"src_vendor_ckeditor_translations_th_js"],"./tk.js":[80801,"src_vendor_ckeditor_translations_tk_js"],"./tr.js":[57018,"src_vendor_ckeditor_translations_tr_js"],"./tt.js":[54570,"src_vendor_ckeditor_translations_tt_js"],"./ug.js":[25899,"src_vendor_ckeditor_translations_ug_js"],"./uk.js":[66516,"src_vendor_ckeditor_translations_uk_js"],"./ur.js":[92805,"src_vendor_ckeditor_translations_ur_js"],"./uz.js":[36527,"src_vendor_ckeditor_translations_uz_js"],"./vi.js":[26661,"src_vendor_ckeditor_translations_vi_js"],"./zh-cn.js":[55739,"src_vendor_ckeditor_translations_zh-cn_js"],"./zh.js":[86908,"src_vendor_ckeditor_translations_zh_js"]};function e(d){if(!t.o(i,d))return Promise.resolve().then(()=>{var n=new Error("Cannot find module '"+d+"'");throw n.code="MODULE_NOT_FOUND",n});var h=i[d],r=h[0];return t.e(h[1]).then(()=>t.t(r,23))}e.keys=()=>Object.keys(i),e.id=87983,X.exports=e}},X=>{X.O(0,["vendor"],()=>{return i=8296,X(X.s=i);var i});X.O()}]);
//# sourceMappingURL=main.2a4c20db8631abab0d4d.js.map