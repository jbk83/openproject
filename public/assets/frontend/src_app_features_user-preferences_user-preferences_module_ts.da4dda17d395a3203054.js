"use strict";(self.webpackChunkopenproject_frontend=self.webpackChunkopenproject_frontend||[]).push([["src_app_features_user-preferences_user-preferences_module_ts"],{28943:(mt,L,c)=>{c.r(L),c.d(L,{OpenProjectMyAccountModule:()=>w});var g=c(54364),oe=c(84906),s=c(1707),se=c(21757),ae=c(74990),re=c(33276),le=c(36293),h=c(96617),E=c(3786),P=c(19100);let q=class extends P.yh{constructor(){super({autoHidePopups:!0,commentSortDescending:!1,hideMail:!0,timeZone:null,warnOnLeavingUnsaved:!0,notifications:[],dailyReminders:{enabled:!0,times:["08:00"]},workdays:[1,2,3,4,5],immediateReminders:{mentioned:!1},pauseReminders:{enabled:!1}})}};q=(0,E.gn)([(0,P.yC)({name:"notification-settings"}),(0,E.w6)("design:paramtypes",[])],q);var d=c(33927),J=c(9170);class de extends P.AE{constructor(i){super(i),this.store=i,this.notificationSettings$=this.select("notifications"),this.notificationsGroupedByProject$=this.notificationSettings$.pipe((0,d.U)(t=>t.filter(o=>o._links.project.href)),(0,d.U)(t=>_.groupBy(t,o=>o._links.project.title))),this.notificationsForGlobal$=this.notificationSettings$.pipe((0,d.U)(t=>t.find(o=>null===o._links.project.href))),this.projectNotifications$=this.notificationSettings$.pipe((0,d.U)(t=>t.filter(o=>null!==o._links.project.href))),this.globalNotification$=this.notificationSettings$.pipe((0,d.U)(t=>t.find(o=>!o._links.project.href)),(0,J.h)(t=>!!t)),this.selectedProjects$=this.notificationSettings$.pipe((0,d.U)(t=>new Set(t.map(o=>{var a;return null===(a=o._links.project)||void 0===a?void 0:a.href})))),this.dailyReminders$=this.select("dailyReminders"),this.dailyRemindersEnabled$=this.dailyReminders$.pipe((0,d.U)(t=>t.enabled)),this.dailyRemindersTimes$=this.dailyReminders$.pipe((0,d.U)(t=>t.times)),this.preferences$=this.select()}}var e=c(2316);class f{constructor(i,t,o){this.apiV3Service=i,this.toastService=t,this.I18n=o,this.store=new q,this.query=new de(this.store)}get(i){this.store.setLoading(!0),this.preferenceAPI(i).get().subscribe(t=>this.store.update(t),t=>this.toastService.addError(t)).add(()=>this.store.setLoading(!1))}update(i,t){this.store.setLoading(!0),this.preferenceAPI(i).patch(t).subscribe(o=>{this.store.update(o),this.toastService.addSuccess(this.I18n.t("js.notice_successful_update"))},o=>this.toastService.addError(o)).add(()=>this.store.setLoading(!1))}preferenceAPI(i){return this.apiV3Service.users.id(i).preferences}}f.\u0275fac=function(i){return new(i||f)(e.LFG(re.T),e.LFG(le.kl),e.LFG(h.D))},f.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"});var B=c(23896),z=c(47775),V=c(96905),W=c(26942),H=c(73881),pe=c(27779);const X=[{value:"PT0S",title:window.I18n.t("js.notifications.settings.reminders.timeframes.normal.PT0S")},{value:"P1D",title:window.I18n.t("js.notifications.settings.reminders.timeframes.normal.P1D")},{value:"P3D",title:window.I18n.t("js.notifications.settings.reminders.timeframes.normal.P3D")},{value:"P7D",title:window.I18n.t("js.notifications.settings.reminders.timeframes.normal.P7D")}],K=[{value:"P1D",title:window.I18n.t("js.notifications.settings.reminders.timeframes.overdue.P1D")},{value:"P3D",title:window.I18n.t("js.notifications.settings.reminders.timeframes.overdue.P3D")},{value:"P7D",title:window.I18n.t("js.notifications.settings.reminders.timeframes.overdue.P7D")}];class Z{constructor(i,t){this.storeService=i,this.I18n=t,this.projectSettings$=this.storeService.query.projectNotifications$,this.text={title:this.I18n.t("js.notifications.settings.title")}}removeAll(){this.storeService.store.update(({notifications:i})=>({notifications:i.filter(t=>null===t._links.project.href)}))}}Z.\u0275fac=function(i){return new(i||Z)(e.Y36(f),e.Y36(h.D))},Z.\u0275cmp=e.Xpm({type:Z,selectors:[["op-notifications-settings-toolbar"]],decls:4,vars:1,consts:[[1,"toolbar-container"],[1,"toolbar"],[1,"title-container"],[3,"textContent"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"h2",3),e.qZA(),e.qZA(),e.qZA()),2&i&&(e.xp6(3),e.Q6J("textContent",t.text.title))},encapsulation:2,changeDetection:0});var k=c(99100),me=c(8158),ge=c(70233),fe=c(10190),ue=c(5443);function _e(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",3),e.NdJ("click",function(){e.CHM(t);return e.oxw().active=!0}),e._UZ(1,"span",4),e._UZ(2,"span",5),e.qZA()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("textContent",t.text.add_setting)}}function he(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"op-project-autocompleter",6),e.NdJ("valueChange",function(a){return e.CHM(t),e.oxw().selectProject(a)})("keydown.escape",function(){e.CHM(t);return e.oxw().active=!1}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("apiFilters",t.APIFilters)("mapResultsFn",t.mapProjectsFn.bind(t))("placeholder",t.text.please_select)}}class y{constructor(i){this.I18n=i,this.selected=new e.vpe,this.active=!1,this.text={add_setting:this.I18n.t("js.notifications.settings.project_specific.add"),please_select:this.I18n.t("js.placeholders.selection"),already_selected:this.I18n.t("js.notifications.settings.project_specific.already_selected")}}get APIFilters(){return[["visible","=",[this.userId]]]}selectProject(i){this.selected.emit({title:i.name,href:i.href}),this.active=!1}mapProjectsFn(i){return i.map(t=>Object.assign(Object.assign({},t),{disabled:!!this.settings.controls.find(o=>o.get("project").value.href===t.href),disabledReason:this.text.already_selected}))}}function ve(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"th",4),e.TgZ(2,"a",8),e._uU(3),e.qZA(),e.qZA(),e.BQk()),2&n){const t=i.$implicit,o=e.oxw(2);e.xp6(2),e.Q6J("href",o.projectLink(t.controls.project.value.href),e.LSH),e.xp6(1),e.Oqu(t.controls.project.value.title)}}function xe(n,i){1&n&&(e.ynx(0),e._UZ(1,"td",9),e.BQk())}function be(n,i){1&n&&(e.ynx(0),e.TgZ(1,"td",9),e._UZ(2,"input",10),e.qZA(),e.BQk())}function ke(n,i){1&n&&(e.ynx(0),e.TgZ(1,"td",9),e._UZ(2,"input",10),e.qZA(),e.BQk())}function Te(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",11),e._UZ(2,"input",12),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function we(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",11),e._UZ(2,"input",13),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function Ze(n,i){1&n&&(e.ynx(0),e._UZ(1,"td",9),e.BQk())}function ye(n,i){if(1&n&&(e.TgZ(0,"tr"),e.TgZ(1,"th",6),e.TgZ(2,"h5"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.qZA(),e.YNc(6,Ze,2,0,"ng-container",5),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.Oqu(t.text.dateAlerts.title),e.xp6(2),e.Oqu(t.text.dateAlerts.description),e.xp6(1),e.Q6J("ngForOf",t.settings.controls)}}function Ie(n,i){if(1&n&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("ngValue",t.value),e.xp6(1),e.hij(" ",t.title," ")}}function Ce(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",14),e.TgZ(2,"select",15),e.YNc(3,Ie,2,2,"option",16),e.qZA(),e.qZA(),e.BQk()),2&n){const t=i.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title),e.xp6(1),e.Q6J("ngForOf",o.availableTimes)}}function je(n,i){if(1&n&&(e.TgZ(0,"tr"),e.TgZ(1,"th",6),e._uU(2),e.qZA(),e.YNc(3,Ce,4,3,"ng-container",5),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.hij(" ",t.text.startDate," "),e.xp6(1),e.Q6J("ngForOf",t.settings.controls)}}function Ne(n,i){if(1&n&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("ngValue",t.value),e.xp6(1),e.hij(" ",t.title," ")}}function Ae(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",14),e.TgZ(2,"select",18),e.YNc(3,Ne,2,2,"option",16),e.qZA(),e.qZA(),e.BQk()),2&n){const t=i.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title),e.xp6(1),e.Q6J("ngForOf",o.availableTimes)}}function Se(n,i){if(1&n&&(e.TgZ(0,"tr"),e.TgZ(1,"th",6),e._uU(2),e.qZA(),e.YNc(3,Ae,4,3,"ng-container",5),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.hij(" ",t.text.dueDate," "),e.xp6(1),e.Q6J("ngForOf",t.settings.controls)}}function Pe(n,i){if(1&n&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("ngValue",t.value),e.xp6(1),e.hij(" ",t.title," ")}}function qe(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",14),e.TgZ(2,"select",19),e.YNc(3,Pe,2,2,"option",16),e.qZA(),e.qZA(),e.BQk()),2&n){const t=i.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title),e.xp6(1),e.Q6J("ngForOf",o.availableTimesOverdue)}}function Je(n,i){if(1&n&&(e.TgZ(0,"tr"),e.TgZ(1,"th",6),e._uU(2),e.qZA(),e.YNc(3,qe,4,3,"ng-container",5),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.hij(" ",t.text.overdue," "),e.xp6(1),e.Q6J("ngForOf",t.settings.controls)}}function Oe(n,i){1&n&&(e.ynx(0),e._UZ(1,"td",9),e.BQk())}function Qe(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",11),e._UZ(2,"input",20),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function Ue(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",11),e._UZ(2,"input",21),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function De(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",11),e._UZ(2,"input",22),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function Fe(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",11),e._UZ(2,"input",23),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function Ye(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",11),e._UZ(2,"input",24),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function Me(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"td",9),e.TgZ(2,"button",25),e.NdJ("click",function(){const l=e.CHM(t).index;return e.oxw(2).removeProjectSettings(l)}),e._uU(3),e.qZA(),e.qZA(),e.BQk()}if(2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.text.remove_project_settings," ")}}function Re(n,i){if(1&n&&(e.TgZ(0,"div",2),e.TgZ(1,"table",3),e.TgZ(2,"thead"),e.TgZ(3,"tr"),e.TgZ(4,"th",4),e._uU(5),e.qZA(),e.YNc(6,ve,4,2,"ng-container",5),e.qZA(),e.qZA(),e.TgZ(7,"tbody"),e.TgZ(8,"tr"),e.TgZ(9,"th",6),e.TgZ(10,"h5"),e._uU(11),e.qZA(),e.TgZ(12,"p"),e._uU(13),e.qZA(),e.qZA(),e.YNc(14,xe,2,0,"ng-container",5),e.qZA(),e.TgZ(15,"tr"),e.TgZ(16,"th",6),e._uU(17),e.qZA(),e.YNc(18,be,3,0,"ng-container",5),e.qZA(),e.TgZ(19,"tr"),e.TgZ(20,"th",6),e._uU(21),e.qZA(),e.YNc(22,ke,3,0,"ng-container",5),e.qZA(),e.TgZ(23,"tr"),e.TgZ(24,"th",6),e._uU(25),e.qZA(),e.YNc(26,Te,3,2,"ng-container",5),e.qZA(),e.TgZ(27,"tr"),e.TgZ(28,"th",6),e._uU(29),e.qZA(),e.YNc(30,we,3,2,"ng-container",5),e.qZA(),e.YNc(31,ye,7,3,"tr",7),e.YNc(32,je,4,2,"tr",7),e.YNc(33,Se,4,2,"tr",7),e.YNc(34,Je,4,2,"tr",7),e.TgZ(35,"tr"),e.TgZ(36,"th",6),e.TgZ(37,"h5"),e._uU(38),e.qZA(),e.TgZ(39,"p"),e._uU(40),e.qZA(),e.qZA(),e.YNc(41,Oe,2,0,"ng-container",5),e.qZA(),e.TgZ(42,"tr"),e.TgZ(43,"th",6),e._uU(44),e.qZA(),e.YNc(45,Qe,3,2,"ng-container",5),e.qZA(),e.TgZ(46,"tr"),e.TgZ(47,"th",6),e._uU(48),e.qZA(),e.YNc(49,Ue,3,2,"ng-container",5),e.qZA(),e.TgZ(50,"tr"),e.TgZ(51,"th",6),e._uU(52),e.qZA(),e.YNc(53,De,3,2,"ng-container",5),e.qZA(),e.TgZ(54,"tr"),e.TgZ(55,"th",6),e._uU(56),e.qZA(),e.YNc(57,Fe,3,2,"ng-container",5),e.qZA(),e.TgZ(58,"tr"),e.TgZ(59,"th",6),e._uU(60),e.qZA(),e.YNc(61,Ye,3,2,"ng-container",5),e.qZA(),e.TgZ(62,"tr"),e._UZ(63,"th",6),e.YNc(64,Me,4,1,"ng-container",5),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(5),e.hij(" ",t.text.notify_me," "),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(5),e.Oqu(t.text.notifyImmediately.title),e.xp6(2),e.Oqu(t.text.notifyImmediately.description),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.hij(" ",t.text.mentioned_header.title," "),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.watched_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.hij(" ",t.text.assignee," "),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.hij(" ",t.text.responsible," "),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(1),e.Q6J("ngIf",!t.eeShowBanners),e.xp6(1),e.Q6J("ngIf",!t.eeShowBanners),e.xp6(1),e.Q6J("ngIf",!t.eeShowBanners),e.xp6(1),e.Q6J("ngIf",!t.eeShowBanners),e.xp6(4),e.Oqu(t.text.alsoNotifyFor.title),e.xp6(2),e.Oqu(t.text.alsoNotifyFor.description),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_created_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_processed_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_scheduled_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_prioritized_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_commented_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Q6J("ngForOf",t.settings.controls)}}function $e(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"op-notification-setting-inline-create",26),e.NdJ("selected",function(a){return e.CHM(t),e.oxw().addProjectSettings(a)}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("userId",t.userId)("settings",t.settings)}}y.\u0275fac=function(i){return new(i||y)(e.Y36(h.D))},y.\u0275cmp=e.Xpm({type:y,selectors:[["op-notification-setting-inline-create"]],inputs:{userId:"userId",settings:"settings"},outputs:{selected:"selected"},decls:3,vars:2,consts:[[1,"wp-inline-create-button"],["class","spot-link","type","button",3,"click",4,"ngIf"],["dropdownPosition","top",3,"apiFilters","mapResultsFn","placeholder","valueChange","keydown.escape",4,"ngIf"],["type","button",1,"spot-link",3,"click"],[1,"spot-icon","spot-icon_add"],[3,"textContent"],["dropdownPosition","top",3,"apiFilters","mapResultsFn","placeholder","valueChange","keydown.escape"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0),e.YNc(1,_e,3,1,"button",1),e.YNc(2,he,1,3,"op-project-autocompleter",2),e.qZA()),2&i&&(e.xp6(1),e.Q6J("ngIf",!t.active),e.xp6(1),e.Q6J("ngIf",t.active))},directives:[g.O5,ue.F],styles:[".op-autocompleter[_ngcontent-%COMP%]{display:block;max-width:600px}"],changeDetection:0});class I{constructor(i,t,o){this.I18n=i,this.pathHelper=t,this.bannersService=o,this.eeShowBanners=!1,this.availableTimes=[{value:null,title:this.I18n.t("js.notifications.settings.reminders.no_notification")},...X],this.availableTimesOverdue=[{value:null,title:this.I18n.t("js.notifications.settings.reminders.no_notification")},...K],this.text={notify_me:this.I18n.t("js.notifications.settings.notify_me"),save:this.I18n.t("js.button_save"),mentioned_header:{title:this.I18n.t("js.notifications.settings.reasons.mentioned.title"),description:this.I18n.t("js.notifications.settings.reasons.mentioned.description")},notifyImmediately:{title:this.I18n.t("js.notifications.settings.global.immediately.title"),description:this.I18n.t("js.notifications.settings.global.immediately.description")},alsoNotifyFor:{title:this.I18n.t("js.notifications.settings.global.delayed.title"),description:this.I18n.t("js.notifications.settings.global.delayed.description")},dateAlerts:{title:this.I18n.t("js.notifications.settings.global.date_alerts.title"),description:this.I18n.t("js.notifications.settings.global.date_alerts.description")},assignee:this.I18n.t("js.notifications.settings.reasons.assignee"),responsible:this.I18n.t("js.notifications.settings.reasons.responsible"),watched_header:this.I18n.t("js.notifications.settings.reasons.watched"),work_package_commented_header:this.I18n.t("js.notifications.settings.reasons.work_package_commented"),work_package_created_header:this.I18n.t("js.notifications.settings.reasons.work_package_created"),work_package_processed_header:this.I18n.t("js.notifications.settings.reasons.work_package_processed"),work_package_prioritized_header:this.I18n.t("js.notifications.settings.reasons.work_package_prioritized"),work_package_scheduled_header:this.I18n.t("js.notifications.settings.reasons.work_package_scheduled"),remove_project_settings:this.I18n.t("js.notifications.settings.project_specific.remove"),startDate:this.I18n.t("js.work_packages.properties.startDate"),dueDate:this.I18n.t("js.work_packages.properties.dueDate"),overdue:this.I18n.t("js.notifications.settings.global.overdue")}}ngOnInit(){this.eeShowBanners=this.bannersService.eeShowBanners}projectLink(i){return this.pathHelper.projectPath((0,fe.Z)(i))}addProjectSettings(i){this.settings.push(new s.cw({project:new s.NI(i),assignee:new s.NI(!1),responsible:new s.NI(!1),workPackageCreated:new s.NI(!1),workPackageProcessed:new s.NI(!1),workPackageScheduled:new s.NI(!1),workPackagePrioritized:new s.NI(!1),workPackageCommented:new s.NI(!1),startDate:new s.NI(this.availableTimes[2].value),dueDate:new s.NI(this.availableTimes[2].value),overdue:new s.NI(this.availableTimesOverdue[0].value)}))}removeProjectSettings(i){this.settings.removeAt(i)}}function Ge(n,i){if(1&n&&(e.TgZ(0,"option",30),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.title," ")}}function Le(n,i){if(1&n&&(e.TgZ(0,"select",28),e.YNc(1,Ge,2,2,"option",29),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.availableTimes)}}function Ee(n,i){if(1&n&&(e.TgZ(0,"option",30),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.title," ")}}function Be(n,i){if(1&n&&(e.TgZ(0,"select",31),e.YNc(1,Ee,2,2,"option",29),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.availableTimes)}}function ze(n,i){if(1&n&&(e.TgZ(0,"option",30),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.title," ")}}function Ve(n,i){if(1&n&&(e.TgZ(0,"select",32),e.YNc(1,ze,2,2,"option",29),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.availableTimesOverdue)}}function We(n,i){if(1&n&&(e.TgZ(0,"div"),e.TgZ(1,"div",16),e._UZ(2,"input",17),e._UZ(3,"label",18),e.YNc(4,Le,2,1,"select",19),e.qZA(),e.TgZ(5,"div",20),e._UZ(6,"input",21),e._UZ(7,"label",22),e.YNc(8,Be,2,1,"select",23),e.qZA(),e.TgZ(9,"div",24),e._UZ(10,"input",25),e._UZ(11,"label",26),e.YNc(12,Ve,2,1,"select",27),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("textContent",t.text.startDate),e.xp6(1),e.Q6J("ngIf",t.dateAlertsStatuses.startDate),e.xp6(3),e.Q6J("textContent",t.text.dueDate),e.xp6(1),e.Q6J("ngIf",t.dateAlertsStatuses.dueDate),e.xp6(3),e.Q6J("textContent",t.text.overdue),e.xp6(1),e.Q6J("ngIf",t.dateAlertsStatuses.overdue)}}function He(n,i){if(1&n&&e._UZ(0,"op-enterprise-banner",33),2&n){const t=e.oxw();e.Q6J("moreInfoLink",t.text.more_info_link)("collapsible",!0)("textMessage",t.text.teaser_text)}}function Xe(n,i){if(1&n&&e._UZ(0,"op-notification-settings-table",34),2&n){const t=e.oxw();e.Q6J("userId",t.userId)("settings",t.form.controls.projectSettings)}}I.\u0275fac=function(i){return new(i||I)(e.Y36(h.D),e.Y36(ge.j),e.Y36(H.j))},I.\u0275cmp=e.Xpm({type:I,selectors:[["op-notification-settings-table"]],inputs:{userId:"userId",settings:"settings"},decls:2,vars:2,consts:[["class","op-scrollable-table",4,"ngIf"],["data-qa-selector","notification-setting-inline-create",3,"userId","settings","selected",4,"ngIf"],[1,"op-scrollable-table"],[1,"op-table"],[1,"op-table--cell","op-table--cell_heading"],[4,"ngFor","ngForOf"],[1,"op-table--cell","op-table--cell_soft-heading"],[4,"ngIf"],[1,"spot-link",3,"href"],[1,"op-table--cell"],["type","checkbox","disabled","","checked",""],[1,"op-table--cell",3,"formGroup"],["type","checkbox","formControlName","assignee","data-qa-project-notification-type","assignee"],["type","checkbox","formControlName","responsible","data-qa-project-notification-type","responsible"],[1,"op-table--cell--date-alerts",3,"formGroup"],["formControlName","startDate","data-qa-project-notification-type","op-reminder-settings-start-date-alerts","required","true",1,"op-reminder-settings-table-date-alerts--time","form--select"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],["formControlName","dueDate","data-qa-project-notification-type","op-reminder-settings-due-date-alerts","required","true",1,"op-reminder-settings-table-date-alerts--time","form--select"],["formControlName","overdue","data-qa-project-notification-type","op-reminder-settings-overdue-alerts","required","true",1,"op-reminder-settings-table-date-alerts--time","form--select"],["type","checkbox","formControlName","workPackageCreated","data-qa-project-notification-type","work_package_created"],["type","checkbox","formControlName","workPackageProcessed","data-qa-project-notification-type","work_package_processed"],["type","checkbox","formControlName","workPackageScheduled","data-qa-project-notification-type","work_package_scheduled"],["type","checkbox","formControlName","workPackagePrioritized","data-qa-project-notification-type","work_package_prioritized"],["type","checkbox","formControlName","workPackageCommented","data-qa-project-notification-type","work_package_commented"],["type","button",1,"spot-link",3,"click"],["data-qa-selector","notification-setting-inline-create",3,"userId","settings","selected"]],template:function(i,t){1&i&&(e.YNc(0,Re,65,31,"div",0),e.YNc(1,$e,1,2,"op-notification-setting-inline-create",1)),2&i&&(e.Q6J("ngIf",t.settings.length>0),e.xp6(1),e.Q6J("ngIf",t.userId))},directives:[g.O5,g.sg,s.JL,s.sg,s.Wl,s.JJ,s.u,s.EJ,s.Q7,s.YN,s.Kr,y],styles:["[_nghost-%COMP%]{max-width:100%;width:100%}.op-table[_ngcontent-%COMP%]{margin-bottom:1rem}.op-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding-right:1rem}.op-reminder-settings-table-date-alerts--time[_ngcontent-%COMP%]{height:32px;width:auto;min-width:100%;padding:4px 22px 4px 12px;margin:auto}.op-table--cell--date-alerts[_ngcontent-%COMP%]{border:1px solid #cccccc;text-align:center;padding:12px 16px}"],changeDetection:0});class T extends W.N{constructor(i,t,o,a,l,r){super(),this.changeDetectorRef=i,this.I18n=t,this.storeService=o,this.currentUserService=a,this.uiRouterGlobals=l,this.bannersService=r,this.availableTimes=X,this.availableTimesOverdue=K,this.eeShowBanners=!1,this.form=new s.cw({assignee:new s.NI(!1),responsible:new s.NI(!1),workPackageCreated:new s.NI(!1),workPackageProcessed:new s.NI(!1),workPackageScheduled:new s.NI(!1),workPackagePrioritized:new s.NI(!1),workPackageCommented:new s.NI(!1),startDate:new s.cw({active:new s.NI(!1),time:new s.NI(this.availableTimes[1])}),dueDate:new s.cw({active:new s.NI(!1),time:new s.NI(this.availableTimes[1])}),overdue:new s.cw({active:new s.NI(!1),time:new s.NI(this.availableTimesOverdue[0])}),projectSettings:new s.Oe([])}),this.text={notifyImmediately:{title:this.I18n.t("js.notifications.settings.global.immediately.title"),description:this.I18n.t("js.notifications.settings.global.immediately.description")},alsoNotifyFor:{title:this.I18n.t("js.notifications.settings.global.delayed.title"),description:this.I18n.t("js.notifications.settings.global.delayed.description")},dateAlerts:{title:this.I18n.t("js.notifications.settings.global.date_alerts.title"),description:this.I18n.t("js.notifications.settings.global.date_alerts.description")},mentioned:{title:this.I18n.t("js.notifications.settings.reasons.mentioned.title"),description:this.I18n.t("js.notifications.settings.reasons.mentioned.description")},watched:this.I18n.t("js.notifications.settings.reasons.watched"),work_package_commented:this.I18n.t("js.notifications.settings.reasons.work_package_commented"),work_package_created:this.I18n.t("js.notifications.settings.reasons.work_package_created"),work_package_processed:this.I18n.t("js.notifications.settings.reasons.work_package_processed"),work_package_prioritized:this.I18n.t("js.notifications.settings.reasons.work_package_prioritized"),work_package_scheduled:this.I18n.t("js.notifications.settings.reasons.work_package_scheduled"),save:this.I18n.t("js.button_save"),projectSpecific:{title:this.I18n.t("js.notifications.settings.project_specific.title"),description:this.I18n.t("js.notifications.settings.project_specific.description")},assignee:this.I18n.t("js.notifications.settings.reasons.assignee"),responsible:this.I18n.t("js.notifications.settings.reasons.responsible"),startDate:this.I18n.t("js.work_packages.properties.startDate"),dueDate:this.I18n.t("js.work_packages.properties.dueDate"),overdue:this.I18n.t("js.notifications.settings.global.overdue"),teaser_text:this.I18n.t("js.notifications.settings.global.date_alerts.teaser_text"),upgrade_to_ee_text:this.I18n.t("js.boards.upsale.upgrade"),more_info_link:pe.rj.website},this.dateAlertsStatuses={startDate:!1,dueDate:!1,overdue:!1}}ngOnInit(){var i,t,o;this.form.disable(),this.userId=this.userId||this.uiRouterGlobals.params.userId,this.eeShowBanners=this.bannersService.eeShowBanners,this.currentUserService.user$.pipe((0,B.take)(1)).subscribe(a=>{this.userId=this.userId||a.id,this.storeService.get(this.userId)}),null===(i=this.form.get("startDate.active"))||void 0===i||i.valueChanges.subscribe(a=>{this.dateAlertsStatuses.startDate=!!a}),null===(t=this.form.get("dueDate.active"))||void 0===t||t.valueChanges.subscribe(a=>{this.dateAlertsStatuses.dueDate=!!a}),null===(o=this.form.get("overdue.active"))||void 0===o||o.valueChanges.subscribe(a=>{this.dateAlertsStatuses.overdue=!!a}),this.storeService.query.notificationsForGlobal$.pipe(this.untilDestroyed()).subscribe(a=>{var l,r,u,p,m,U,D,F,Y,M,R,$,G;!a||(null===(l=this.form.get("assignee"))||void 0===l||l.setValue(a.assignee),null===(r=this.form.get("responsible"))||void 0===r||r.setValue(a.responsible),null===(u=this.form.get("workPackageCreated"))||void 0===u||u.setValue(a.workPackageCreated),null===(p=this.form.get("workPackageProcessed"))||void 0===p||p.setValue(a.workPackageProcessed),null===(m=this.form.get("workPackageScheduled"))||void 0===m||m.setValue(a.workPackageScheduled),null===(U=this.form.get("workPackagePrioritized"))||void 0===U||U.setValue(a.workPackagePrioritized),null===(D=this.form.get("workPackageCommented"))||void 0===D||D.setValue(a.workPackageCommented),null===(F=this.form.get("startDate.active"))||void 0===F||F.setValue(!!a.startDate),null===(Y=this.form.get("startDate.time"))||void 0===Y||Y.setValue(a.startDate||this.availableTimes[1].value),null===(M=this.form.get("dueDate.active"))||void 0===M||M.setValue(!!a.dueDate),null===(R=this.form.get("dueDate.time"))||void 0===R||R.setValue(a.dueDate||this.availableTimes[1].value),null===($=this.form.get("overdue.active"))||void 0===$||$.setValue(!!a.overdue),null===(G=this.form.get("overdue.time"))||void 0===G||G.setValue(a.overdue||this.availableTimesOverdue[0].value))}),this.storeService.query.projectNotifications$.pipe(this.untilDestroyed()).subscribe(a=>{if(!a)return;const l=new s.Oe([]);l.clear(),a.sort((r,u)=>r._links.project.title.localeCompare(u._links.project.title)).forEach(r=>l.push(new s.cw({project:new s.NI(r._links.project),assignee:new s.NI(r.assignee),responsible:new s.NI(r.responsible),workPackageCreated:new s.NI(r.workPackageCreated),workPackageProcessed:new s.NI(r.workPackageProcessed),workPackageScheduled:new s.NI(r.workPackageScheduled),workPackagePrioritized:new s.NI(r.workPackagePrioritized),workPackageCommented:new s.NI(r.workPackageCommented),startDate:new s.NI(r.startDate),dueDate:new s.NI(r.dueDate),overdue:new s.NI(r.overdue)}))),this.form.setControl("projectSettings",l),this.changeDetectorRef.detectChanges()}),this.form.enable()}saveChanges(){const i=this.storeService.store.getValue(),t=this.form.value,o=i.notifications.find(r=>!r._links.project.href),a=Object.assign(Object.assign({},o),{_links:{project:{href:null}},watched:!0,mentioned:!0,assignee:t.assignee,responsible:t.responsible,workPackageCreated:t.workPackageCreated,workPackageProcessed:t.workPackageProcessed,workPackageScheduled:t.workPackageScheduled,workPackagePrioritized:t.workPackagePrioritized,workPackageCommented:t.workPackageCommented,startDate:t.startDate.active?t.startDate.time:null,dueDate:t.dueDate.active?t.dueDate.time:null,overdue:t.overdue.active?t.overdue.time:null}),l=t.projectSettings.map(r=>({_links:{project:{href:r.project.href}},watched:!0,mentioned:!0,assignee:r.assignee,responsible:r.responsible,workPackageCreated:r.workPackageCreated,workPackageProcessed:r.workPackageProcessed,workPackageScheduled:r.workPackageScheduled,workPackagePrioritized:r.workPackagePrioritized,workPackageCommented:r.workPackageCommented,newsAdded:!1,newsCommented:!1,documentAdded:!1,forumMessages:!1,wikiPageAdded:!1,wikiPageUpdated:!1,membershipAdded:!1,membershipUpdated:!1,startDate:r.startDate,dueDate:r.dueDate,overdue:r.overdue}));this.storeService.update(this.userId,Object.assign(Object.assign({},i),{notifications:[a,...l]}))}}function Ke(n,i){if(1&n&&(e.TgZ(0,"spot-selector-field",4),e._UZ(1,"input",5),e.qZA()),2&n){const t=i.$implicit,o=e.oxw();e.Q6J("label",o.text[t])("control",o.form.get(t)),e.xp6(1),e.Q6J("formControlName",t)}}T.\u0275fac=function(i){return new(i||T)(e.Y36(e.sBO),e.Y36(h.D),e.Y36(f),e.Y36(V.S),e.Y36(z.UIRouterGlobals),e.Y36(H.j))},T.\u0275cmp=e.Xpm({type:T,selectors:[["op-notifications-page"]],inputs:{userId:"userId"},features:[e.qOj],decls:41,vars:30,consts:[[1,"op-form",3,"formGroup","ngSubmit"],[1,"op-notifications-settings--bold-label",3,"label"],["disabled","","checked","","type","checkbox","slot","input"],[3,"label","control"],["slot","input","type","checkbox","formControlName","assignee","data-qa-global-notification-type","assignee"],["slot","input","type","checkbox","formControlName","responsible","data-qa-global-notification-type","responsible"],[4,"ngIf"],["opReferrer","notifications#date-alerts","class","op-date-alert-ee-banner",3,"moreInfoLink","collapsible","textMessage",4,"ngIf"],["slot","input","type","checkbox","formControlName","workPackageCreated","data-qa-global-notification-type","work_package_created"],["slot","input","type","checkbox","formControlName","workPackageProcessed","data-qa-global-notification-type","work_package_processed"],["slot","input","type","checkbox","formControlName","workPackageScheduled","data-qa-global-notification-type","work_package_scheduled"],["slot","input","type","checkbox","formControlName","workPackagePrioritized","data-qa-global-notification-type","work_package_prioritized"],["slot","input","type","checkbox","formControlName","workPackageCommented","data-qa-global-notification-type","work_package_commented"],["formArrayName","projectSettings","class","op-notification-settings-page--table",3,"userId","settings",4,"ngIf"],[1,"generic-table--action-buttons"],["type","submit",1,"button","-highlight",3,"textContent"],["formGroupName","startDate",1,"op-reminder-settings-date-alerts--row"],["type","checkbox","formControlName","active","data-qa-global-notification-type","op-settings-start-date-active","id","op-settings-start-date",1,"op-reminder-settings-date-alerts--active"],["for","op-settings-start-date",1,"op-reminder-settings-date-alerts--label",3,"textContent"],["formControlName","time","class","op-reminder-settings-date-alerts--time form--select -narrow","data-qa-global-notification-type","op-reminder-settings-start-date-alerts","required","true",4,"ngIf"],["formGroupName","dueDate",1,"op-reminder-settings-date-alerts--row"],["type","checkbox","formControlName","active","data-qa-global-notification-type","op-settings-due-date-active","id","op-settings-due-date",1,"op-reminder-settings-date-alerts--active"],["for","op-settings-due-date",1,"op-reminder-settings-date-alerts--label",3,"textContent"],["formControlName","time","class","op-reminder-settings-date-alerts--time form--select -narrow","data-qa-global-notification-type","op-reminder-settings-due-date-alerts","required","true",4,"ngIf"],["formGroupName","overdue",1,"op-reminder-settings-date-alerts--row"],["formControlName","active","type","checkbox","data-qa-global-notification-type","op-settings-overdue-date-active","id","op-settings-overdue-date",1,"op-reminder-settings-date-alerts--active"],["for","op-settings-overdue-date",1,"op-reminder-settings-date-alerts--label",3,"textContent"],["formControlName","time","class","op-reminder-settings-date-alerts--time form--select -narrow","data-qa-global-notification-type","op-reminder-settings-overdue-alerts","required","true",4,"ngIf"],["formControlName","time","data-qa-global-notification-type","op-reminder-settings-start-date-alerts","required","true",1,"op-reminder-settings-date-alerts--time","form--select","-narrow"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","time","data-qa-global-notification-type","op-reminder-settings-due-date-alerts","required","true",1,"op-reminder-settings-date-alerts--time","form--select","-narrow"],["formControlName","time","data-qa-global-notification-type","op-reminder-settings-overdue-alerts","required","true",1,"op-reminder-settings-date-alerts--time","form--select","-narrow"],["opReferrer","notifications#date-alerts",1,"op-date-alert-ee-banner",3,"moreInfoLink","collapsible","textMessage"],["formArrayName","projectSettings",1,"op-notification-settings-page--table",3,"userId","settings"]],template:function(i,t){1&i&&(e._UZ(0,"op-notifications-settings-toolbar"),e.TgZ(1,"form",0),e.NdJ("ngSubmit",function(){return t.saveChanges()}),e.TgZ(2,"h5"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"spot-selector-field",1),e._UZ(7,"input",2),e.qZA(),e.TgZ(8,"spot-selector-field",3),e._UZ(9,"input",2),e.qZA(),e.TgZ(10,"spot-selector-field",3),e._UZ(11,"input",4),e.qZA(),e.TgZ(12,"spot-selector-field",3),e._UZ(13,"input",5),e.qZA(),e.TgZ(14,"h5"),e._uU(15),e.qZA(),e.TgZ(16,"p"),e._uU(17),e.qZA(),e.YNc(18,We,13,6,"div",6),e.YNc(19,He,1,3,"op-enterprise-banner",7),e.TgZ(20,"h5"),e._uU(21),e.qZA(),e.TgZ(22,"p"),e._uU(23),e.qZA(),e.TgZ(24,"spot-selector-field",3),e._UZ(25,"input",8),e.qZA(),e.TgZ(26,"spot-selector-field",3),e._UZ(27,"input",9),e.qZA(),e.TgZ(28,"spot-selector-field",3),e._UZ(29,"input",10),e.qZA(),e.TgZ(30,"spot-selector-field",3),e._UZ(31,"input",11),e.qZA(),e.TgZ(32,"spot-selector-field",3),e._UZ(33,"input",12),e.qZA(),e.TgZ(34,"h5"),e._uU(35),e.qZA(),e.TgZ(36,"p"),e._uU(37),e.qZA(),e.YNc(38,Xe,1,2,"op-notification-settings-table",13),e.TgZ(39,"div",14),e._UZ(40,"button",15),e.qZA(),e.qZA()),2&i&&(e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(2),e.Oqu(t.text.notifyImmediately.title),e.xp6(2),e.Oqu(t.text.notifyImmediately.description),e.xp6(1),e.Q6J("label",t.text.mentioned.title),e.xp6(2),e.Q6J("label",t.text.watched)("control",t.form.get("watched")),e.xp6(2),e.Q6J("label",t.text.assignee)("control",t.form.get("assignee")),e.xp6(2),e.Q6J("label",t.text.responsible)("control",t.form.get("responsible")),e.xp6(3),e.Oqu(t.text.dateAlerts.title),e.xp6(2),e.Oqu(t.text.dateAlerts.description),e.xp6(1),e.Q6J("ngIf",!t.eeShowBanners),e.xp6(1),e.Q6J("ngIf",t.eeShowBanners),e.xp6(2),e.Oqu(t.text.alsoNotifyFor.title),e.xp6(2),e.Oqu(t.text.alsoNotifyFor.description),e.xp6(1),e.Q6J("label",t.text.work_package_created)("control",t.form.get("workPackageCreated")),e.xp6(2),e.Q6J("label",t.text.work_package_processed)("control",t.form.get("workPackageProcessed")),e.xp6(2),e.Q6J("label",t.text.work_package_scheduled)("control",t.form.get("workPackageScheduled")),e.xp6(2),e.Q6J("label",t.text.work_package_prioritized)("control",t.form.get("workPackagePrioritized")),e.xp6(2),e.Q6J("label",t.text.work_package_commented)("control",t.form.get("workPackageCommented")),e.xp6(3),e.Oqu(t.text.projectSpecific.title),e.xp6(2),e.Oqu(t.text.projectSpecific.description),e.xp6(1),e.Q6J("ngIf",t.userId),e.xp6(2),e.Q6J("textContent",t.text.save))},directives:[Z,s._Y,s.JL,s.sg,k.o,s.Wl,s.JJ,s.u,g.O5,s.x0,s.EJ,s.Q7,g.sg,s.YN,s.Kr,me.P,I,s.CE],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-reminder-settings-date-alerts--enable[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:30px;margin-bottom:10px}.op-reminder-settings-date-alerts--row[_ngcontent-%COMP%]{line-height:45px;display:flex;align-items:center}.op-reminder-settings-date-alerts--label[_ngcontent-%COMP%]{flex:0 0 180px;margin-bottom:0;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-reminder-settings-date-alerts--time[_ngcontent-%COMP%]{height:32px;width:128px;padding:4px 8px 4px 12px}.op-date-alert-ee-banner[_ngcontent-%COMP%]{width:100%}"],changeDetection:0});const ee=["newsAdded","newsCommented","documentAdded","forumMessages","wikiPageAdded","wikiPageUpdated","membershipAdded","membershipUpdated"];class C{constructor(i,t,o){this.I18n=i,this.storeService=t,this.rootFormGroup=o,this.alerts=ee,this.text={title:this.I18n.t("js.reminders.settings.alerts.title"),explanation:this.I18n.t("js.reminders.settings.alerts.explanation"),newsAdded:this.I18n.t("js.reminders.settings.alerts.news_added"),newsCommented:this.I18n.t("js.reminders.settings.alerts.news_commented"),documentAdded:this.I18n.t("js.reminders.settings.alerts.document_added"),forumMessages:this.I18n.t("js.reminders.settings.alerts.forum_messages"),wikiPageAdded:this.I18n.t("js.reminders.settings.alerts.wiki_page_added"),wikiPageUpdated:this.I18n.t("js.reminders.settings.alerts.wiki_page_updated"),membershipAdded:this.I18n.t("js.reminders.settings.alerts.membership_added"),membershipUpdated:this.I18n.t("js.reminders.settings.alerts.membership_updated")}}ngOnInit(){this.form=this.rootFormGroup.control.get("emailAlerts")}}C.\u0275fac=function(i){return new(i||C)(e.Y36(h.D),e.Y36(f),e.Y36(s.sg))},C.\u0275cmp=e.Xpm({type:C,selectors:[["op-email-alerts-settings"]],decls:5,vars:4,consts:[[3,"formGroup"],[1,"op-form--section-header"],[3,"textContent"],[3,"label","control",4,"ngFor","ngForOf"],[3,"label","control"],["slot","input","type","checkbox",3,"formControlName"]],template:function(i,t){1&i&&(e.ynx(0,0),e.TgZ(1,"div",1),e._UZ(2,"h5",2),e._UZ(3,"p",2),e.qZA(),e.YNc(4,Ke,2,3,"spot-selector-field",3),e.BQk()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("textContent",t.text.title),e.xp6(1),e.Q6J("textContent",t.text.explanation),e.xp6(1),e.Q6J("ngForOf",t.alerts))},directives:[s.JL,s.sg,g.sg,k.o,s.Wl,s.JJ,s.u],encapsulation:2,changeDetection:0});var te=c(17163);class j{constructor(i,t,o){this.I18n=i,this.storeService=t,this.rootFormGroup=o,this.text={title:this.I18n.t("js.reminders.settings.immediate.title"),explanation:this.I18n.t("js.reminders.settings.immediate.explanation"),mentioned:this.I18n.t("js.reminders.settings.immediate.mentioned")}}ngOnInit(){this.form=this.rootFormGroup.control.get("immediateReminders")}}j.\u0275fac=function(i){return new(i||j)(e.Y36(h.D),e.Y36(f),e.Y36(s.sg))},j.\u0275cmp=e.Xpm({type:j,selectors:[["op-immediate-reminder-settings"]],decls:5,vars:4,consts:[[3,"formGroup"],[1,"op-form--section-header"],[3,"textContent"],[3,"label","control"],["slot","input","type","checkbox","formControlName","mentioned","data-qa-immediate-reminder","mentioned"]],template:function(i,t){1&i&&(e.ynx(0,0),e.TgZ(1,"div",1),e._UZ(2,"h5",2),e.qZA(),e.TgZ(3,"spot-selector-field",3),e._UZ(4,"input",4),e.qZA(),e.BQk()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("textContent",t.text.title),e.xp6(1),e.Q6J("label",t.text.mentioned)("control",t.form.get("mentioned")))},directives:[s.JL,s.sg,k.o,s.Wl,s.JJ,s.u],encapsulation:2,changeDetection:0});var A=c(1143),ie=c(92597),S=c(90425),O=c(61486),tt=c(12877),Q=c(2281),it=c(2775);const ne=function(){return{standalone:!0}};function nt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"input",16),e.NdJ("ngModelChange",function(a){e.CHM(t);const l=e.oxw().index,r=e.oxw().ngIf;return e.oxw().toggleActive(a,l,r)}),e.qZA()}if(2&n){const t=i.ngIf,o=e.oxw(),a=o.index,l=o.$implicit,r=e.oxw(2);e.Q2q("data-qa-selector","op-settings-daily-time--active-",a+1,""),e.Q6J("ngModel",r.isActive(l))("ngModelOptions",e.DdM(4,ne))("disabled",r.isDisabled(l,t))}}function ot(n,i){if(1&n&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&n){const t=i.$implicit,o=e.oxw().$implicit,a=e.oxw().ngIf,l=e.oxw();e.Q6J("value",t)("disabled",o!==t&&a.includes(t)),e.xp6(1),e.hij(" ",l.timeLabel(t)," ")}}function st(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().index,l=e.oxw().ngIf;return e.oxw().removeTime(l,a)}),e._UZ(1,"op-icon",19),e.qZA()}if(2&n){const t=e.oxw().index;e.Q2q("data-qa-selector","op-settings-daily-time--remove-",t+1,"")}}function at(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",10),e.YNc(1,nt,1,5,"input",11),e.ALo(2,"async"),e._UZ(3,"label",12),e.TgZ(4,"select",13),e.NdJ("ngModelChange",function(a){const r=e.CHM(t).index,u=e.oxw().ngIf;return e.oxw().changeTime(a,u,r)}),e.ALo(5,"async"),e.YNc(6,ot,2,3,"option",14),e.qZA(),e.YNc(7,st,2,1,"button",15),e.ALo(8,"async"),e.qZA()}if(2&n){const t=i.$implicit,o=i.index,a=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,9,a.activeTimes$)),e.xp6(2),e.Q2q("for","op-reminder-settings-daily-time-",o+1,"--time"),e.Q6J("textContent",a.text.timeLabel(o+1)),e.xp6(1),e.Q2q("id","op-reminder-settings-daily-time-",o+1,"--time"),e.Q6J("ngModel",t)("ngModelOptions",e.DdM(15,ne))("disabled",!1===e.lcZ(5,11,a.enabled$)),e.xp6(2),e.Q6J("ngForOf",a.availableTimes),e.xp6(1),e.Q6J("ngIf",e.lcZ(8,13,a.timeRemovable$))}}function rt(n,i){if(1&n){const t=e.EpF();e.ynx(0,1),e.TgZ(1,"div",2),e._UZ(2,"h5",3),e._UZ(3,"p",3),e.qZA(),e.TgZ(4,"spot-selector-field",4),e._UZ(5,"input",5),e.qZA(),e.YNc(6,at,9,16,"div",6),e.TgZ(7,"button",7),e.NdJ("click",function(){const l=e.CHM(t).ngIf;return e.oxw().addTime(l)}),e.ALo(8,"async"),e._UZ(9,"i",8),e.TgZ(10,"span",9),e._uU(11),e.qZA(),e.qZA(),e.BQk()}if(2&n){const t=i.ngIf,o=e.oxw();e.Q6J("formGroup",o.form),e.xp6(2),e.Q6J("textContent",o.text.title),e.xp6(1),e.Q6J("textContent",o.text.explanation),e.xp6(1),e.Q6J("label",o.text.enable)("control",o.form.get("enabled")),e.xp6(2),e.Q6J("ngForOf",t)("ngForTrackBy",o.index),e.xp6(1),e.Q6J("disabled",e.lcZ(8,9,o.nonAddable$)),e.xp6(4),e.Oqu(o.text.addTime)}}class v{constructor(i,t,o,a){this.I18n=i,this.storeService=t,this.rootFormGroup=o,this.configurationService=a,this.availableTimes=v.setupAvailableTimes(),this.inactiveTimes=[],this.suggestedTimes=["08:00","12:00","15:00","18:00"],this.selectedTimes$=S.C,this.activeTimes$=S.C,this.timeRemovable$=S.C,this.nonAddable$=S.C,this.text={title:this.I18n.t("js.reminders.settings.daily.title"),explanation:this.I18n.t("js.reminders.settings.daily.explanation",{no_time_zone:this.configurationService.isTimezoneSet()?"":this.I18n.t("js.reminders.settings.daily.no_time_zone")}),timeLabel:l=>this.I18n.t("js.reminders.settings.daily.time_label",{counter:l}),addTime:this.I18n.t("js.reminders.settings.daily.add_time"),enable:this.I18n.t("js.reminders.settings.daily.enable")}}ngOnInit(){this.form=this.rootFormGroup.control.get("dailyReminders"),this.enabled$=this.form.valueChanges.pipe((0,A.O)(()=>{var i;return null===(i=this.form.get("enabled"))||void 0===i?void 0:i.value}),(0,d.U)(()=>{var i;return null===(i=this.form.get("enabled"))||void 0===i?void 0:i.value}),(0,ie.d)(1)),this.selectedTimes$=this.form.get("times").valueChanges.pipe((0,A.O)(()=>{var i;return null===(i=this.form.get("times"))||void 0===i?void 0:i.value}),(0,d.U)(()=>{const t=this.form.get("times").controls.map(o=>o.value);return this.inactiveTimes.sort((o,a)=>o.position-a.position).forEach(o=>{t.splice(o.position,0,o.time)}),t}),(0,ie.d)(1)),this.timeRemovable$=(0,O.aj)([this.enabled$,this.selectedTimes$]).pipe((0,d.U)(([i,t])=>i&&t.length>1)),this.nonAddable$=(0,O.aj)([this.enabled$,this.selectedTimes$]).pipe((0,d.U)(([i,t])=>!i||t.length===this.availableTimes.length)),this.activeTimes$=(0,O.aj)([this.enabled$,this.selectedTimes$]).pipe((0,d.U)(([i,t])=>i?t:[]))}addTime(i){const t=this.firstAvailableSuggested(i)||this.firstAfterSelected(i);t&&this.storeTimes(i.concat(t))}changeTime(i,t,o){t.splice(o,1,i),this.storeTimes(t)}isActive(i){return!this.inactiveTimes.find(t=>t.time===i)}removeTime(i,t){this.inactiveTimes=this.inactiveTimes.filter(o=>o.time!==i[t]),this.inactiveTimes.forEach(o=>{o.position>t&&(o.position-=1)}),i.splice(t,1),1===i.length&&(this.inactiveTimes=[]),i.length===this.inactiveTimes.length&&this.inactiveTimes.shift(),this.storeTimes(i)}toggleActive(i,t,o){i?this.inactiveTimes=this.inactiveTimes.filter(a=>a.time!==o[t]):this.inactiveTimes.push({position:t,time:o[t]}),this.storeTimes(o)}timeLabel(i){return this.I18n.toTime("time.formats.time",v.dateForHour(parseInt(i.split(":")[0],10)))}isDisabled(i,t){return 0===t.length||1===t.length&&t[0]===i}storeTimes(i){const t=i.filter(a=>!this.inactiveTimes.map(l=>l.time).includes(a)),o=this.form.get("times");o.clear({emitEvent:!1}),t.forEach(a=>{o.push(new s.NI(a),{emitEvent:!1})}),o.enable({emitEvent:!0})}firstAvailableSuggested(i){return this.availableTimes.find(t=>this.suggestedTimes.includes(t)&&!i.includes(t))}firstAfterSelected(i){const t=this.availableTimes.indexOf(i[i.length-1]);for(let o=t;o<24+t;o++)if(!i.includes(this.availableTimes[o%24]))return this.availableTimes[o%24];return null}static setupAvailableTimes(){return Array.from({length:24},(i,t)=>v.dateForHour(t).toLocaleTimeString("en-US",{hour12:!1,hour:"numeric",minute:"numeric"}))}static dateForHour(i){const t=new Date;return t.setTime(36e5*(i-1)),new Date(Q(t).utc().hours(i).format("YYYY-MM-DDTHH:mm:ss"))}}v.\u0275fac=function(i){return new(i||v)(e.Y36(h.D),e.Y36(f),e.Y36(s.sg),e.Y36(tt.e))},v.\u0275cmp=e.Xpm({type:v,selectors:[["op-reminder-settings-daily-time"]],decls:2,vars:3,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"op-form--section-header"],[3,"textContent"],[3,"label","control"],["slot","input","type","checkbox","formControlName","enabled"],["class","op-reminder-settings-daily-time--row",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"button","op-reminder-settings-daily-time--add",3,"disabled","click"],[1,"button--icon","icon-add"],[1,"button--text"],[1,"op-reminder-settings-daily-time--row"],["type","checkbox","class","op-reminder-settings-daily-time--active",3,"ngModel","ngModelOptions","disabled","ngModelChange",4,"ngIf"],[1,"op-reminder-settings-daily-time--label",3,"textContent"],["required","true",1,"op-reminder-settings-daily-time--time","form--select","-narrow",3,"ngModel","ngModelOptions","disabled","ngModelChange"],[3,"value","disabled",4,"ngFor","ngForOf"],["class","spot-link op-reminder-settings-daily-time--remove","type","button",3,"click",4,"ngIf"],["type","checkbox",1,"op-reminder-settings-daily-time--active",3,"ngModel","ngModelOptions","disabled","ngModelChange"],[3,"value","disabled"],["type","button",1,"spot-link","op-reminder-settings-daily-time--remove",3,"click"],["icon-classes","icon-small icon-remove icon4"]],template:function(i,t){1&i&&(e.YNc(0,rt,12,11,"ng-container",0),e.ALo(1,"async")),2&i&&e.Q6J("ngIf",e.lcZ(1,1,t.selectedTimes$))},directives:[g.O5,s.JL,s.sg,k.o,s.Wl,s.JJ,s.u,g.sg,s.EJ,s.Q7,s.On,s.YN,s.Kr,it.o],pipes:[g.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-reminder-settings-daily-time--enable[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:30px;margin-bottom:10px}.op-reminder-settings-daily-time--row[_ngcontent-%COMP%]{margin-left:40px;line-height:45px;display:flex;align-items:center}.op-reminder-settings-daily-time--row[_ngcontent-%COMP%]:nth-of-type(1){margin-top:10px}.op-reminder-settings-daily-time--active[_ngcontent-%COMP%]{flex:0 0 25px}.op-reminder-settings-daily-time--label[_ngcontent-%COMP%]{flex:0 0 60px;margin-bottom:0;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-reminder-settings-daily-time--time[_ngcontent-%COMP%]{height:32px;width:150px}.op-reminder-settings-daily-time--remove[_ngcontent-%COMP%]{padding-left:10px}.op-reminder-settings-daily-time--add[_ngcontent-%COMP%]{margin-top:20px;margin-left:40px;width:auto}"],changeDetection:0});var lt=c(51590);class N{constructor(i,t){this.I18n=i,this.rootFormGroup=t,this.text={label:this.I18n.t("js.reminders.settings.pause.label"),date_placeholder:this.I18n.t("js.placeholders.date"),first_day:this.I18n.t("js.reminders.settings.pause.first_day"),last_day:this.I18n.t("js.reminders.settings.pause.first_day")}}ngOnInit(){this.form=this.rootFormGroup.control.get("pauseReminders"),this.selectedDates$=this.form.valueChanges.pipe((0,A.O)(this.form.value),(0,d.U)(i=>[i.firstDay,i.lastDay])),this.enabled$=this.form.valueChanges.pipe((0,A.O)(this.form.value),(0,d.U)(i=>i.enabled))}setDates(i){const[t,o]=i;this.form.patchValue({firstDay:t,lastDay:o})}}function ct(n,i){if(1&n&&(e.TgZ(0,"spot-selector-field",4),e._UZ(1,"input",5),e.qZA()),2&n){const t=i.$implicit,o=e.oxw();e.Q6J("label",t)("control",o.controlForLocalWorkday(t)),e.xp6(1),e.Q6J("formControlName",o.indexOfLocalWorkday(t))}}N.\u0275fac=function(i){return new(i||N)(e.Y36(h.D),e.Y36(s.sg))},N.\u0275cmp=e.Xpm({type:N,selectors:[["op-pause-reminders"]],decls:7,vars:13,consts:[[1,"op-pause-reminders",3,"formGroup"],[1,"op-pause-reminders--checkbox",3,"label","control"],["slot","input","type","checkbox","formControlName","enabled"],[3,"size","required","disabled","initialDates","changed"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0),e.TgZ(1,"spot-selector-field",1),e._UZ(2,"input",2),e.qZA(),e.TgZ(3,"op-range-date-picker",3),e.NdJ("changed",function(a){return t.setDates(a)}),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.qZA(),e.qZA()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("label",t.text.label)("control",t.form.get("enabled")),e.xp6(2),e.Q6J("size",23)("required",e.lcZ(4,7,t.enabled$))("disabled",!e.lcZ(5,9,t.enabled$))("initialDates",e.lcZ(6,11,t.selectedDates$)))},directives:[s.JL,s.sg,k.o,s.Wl,s.JJ,s.u,lt.r],pipes:[g.Ov],styles:[".op-pause-reminders[_ngcontent-%COMP%]{display:flex;align-items:center}.op-pause-reminders--checkbox[_ngcontent-%COMP%]{margin-right:2rem}"],changeDetection:0});class b{constructor(i,t){this.I18n=i,this.formGroup=t,this.localeWorkdays=Q.weekdays(!0),this.isoWorkdays=b.buildISOWeekdays(),this.text={title:this.I18n.t("js.reminders.settings.workdays.title")}}ngOnInit(){this.control=this.formGroup.control.get("workdays")}indexOfLocalWorkday(i){return this.isoWorkdays.indexOf(i)}controlForLocalWorkday(i){const t=this.indexOfLocalWorkday(i);return this.control.at(t)}static buildISOWeekdays(){const i=Q.weekdays(!1);return i.push(i.shift()),i}}function dt(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"form",3),e.NdJ("ngSubmit",function(){return e.CHM(t),e.oxw().saveChanges()}),e._UZ(1,"op-immediate-reminder-settings",4),e._UZ(2,"op-reminder-settings-daily-time",4),e._UZ(3,"op-workdays-settings",4),e._UZ(4,"op-email-alerts-settings",4),e.TgZ(5,"div",5),e._UZ(6,"button",6),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(6),e.Q6J("textContent",t.text.save)}}b.\u0275fac=function(i){return new(i||b)(e.Y36(h.D),e.Y36(s.sg))},b.\u0275cmp=e.Xpm({type:b,selectors:[["op-workdays-settings"]],decls:5,vars:3,consts:[[3,"formGroup"],[1,"op-form--section-header"],[3,"textContent"],["formArrayName","workdays",3,"label","control",4,"ngFor","ngForOf"],["formArrayName","workdays",3,"label","control"],["slot","input","type","checkbox",3,"formControlName"]],template:function(i,t){1&i&&(e.ynx(0,0),e.TgZ(1,"div",1),e._UZ(2,"h5",2),e.qZA(),e.YNc(3,ct,2,3,"spot-selector-field",3),e._UZ(4,"op-pause-reminders"),e.BQk()),2&i&&(e.Q6J("formGroup",t.formGroup.control),e.xp6(2),e.Q6J("textContent",t.text.title),e.xp6(1),e.Q6J("ngForOf",t.localeWorkdays))},directives:[s.JL,s.sg,g.sg,N,k.o,s.CE,s.Wl,s.JJ,s.u],styles:[""],changeDetection:0});class x extends W.N{constructor(i,t,o,a,l,r){super(),this.I18n=i,this.storeService=t,this.currentUserService=o,this.uiRouterGlobals=a,this.fb=l,this.cdRef=r,this.form=this.fb.group({immediateReminders:this.fb.group({mentioned:this.fb.control(!1)}),dailyReminders:this.fb.group({enabled:this.fb.control(!1),times:this.fb.array([])}),pauseReminders:this.fb.group({enabled:this.fb.control(!1),firstDay:this.fb.control(""),lastDay:this.fb.control("")}),workdays:this.fb.array([this.fb.control(!1),this.fb.control(!0),this.fb.control(!0),this.fb.control(!0),this.fb.control(!0),this.fb.control(!0),this.fb.control(!1)]),emailAlerts:this.fb.group({newsAdded:this.fb.control(!1),newsCommented:this.fb.control(!1),documentAdded:this.fb.control(!1),forumMessages:this.fb.control(!1),wikiPageAdded:this.fb.control(!1),wikiPageUpdated:this.fb.control(!1),membershipAdded:this.fb.control(!1),membershipUpdated:this.fb.control(!1)})}),this.text={title:this.I18n.t("js.reminders.settings.title"),save:this.I18n.t("js.button_save")},this.formInitialized=!1}ngOnInit(){var n,i;this.userId=this.userId||this.uiRouterGlobals.params.userId,this.currentUserService.user$.pipe((0,B.take)(1)).subscribe(i=>{this.userId=this.userId||(null==i?void 0:i.id),this.storeService.get(this.userId)}),this.storeService.query.select().pipe((0,J.h)(i=>!!i),(0,te.M)(this.storeService.query.globalNotification$),(n=this.storeService.query.selectLoading(),i=i=>!i,t=>t.pipe((0,te.M)(n),(0,J.h)(([,o])=>i(o)),(0,d.U)(([o])=>o)))).subscribe(([i,t])=>{this.buildForm(i,t)})}buildForm(i,t){var o,a,l;null===(o=this.form.get("immediateReminders.mentioned"))||void 0===o||o.setValue(i.immediateReminders.mentioned),null===(a=this.form.get("dailyReminders.enabled"))||void 0===a||a.setValue(i.dailyReminders.enabled),null===(l=this.form.get("pauseReminders"))||void 0===l||l.patchValue(i.pauseReminders);const r=this.form.get("dailyReminders.times");r.clear({emitEvent:!1}),[...i.dailyReminders.times].sort().forEach(p=>{r.push(this.fb.control(p),{emitEvent:!1})}),r.enable({emitEvent:!0});const u=this.form.get("workdays");for(let p=0;p<=6;p++)u.at(p).setValue(i.workdays.includes(p+1));ee.forEach(p=>{var m;null===(m=this.form.get(`emailAlerts.${p}`))||void 0===m||m.setValue(t[p])}),this.formInitialized=!0,this.cdRef.detectChanges()}saveChanges(){const i=this.storeService.query.getValue(),t=i.notifications.filter(m=>!m._links.project.href),o=i.notifications.filter(m=>!!m._links.project.href),a=this.form.value,l=x.buildWorkdays(a.workdays),r=x.buildPauses(a.pauseReminders),{dailyReminders:u,immediateReminders:p}=a;this.storeService.update(this.userId,Object.assign(Object.assign({},i),{workdays:l,dailyReminders:u,immediateReminders:p,pauseReminders:r,notifications:[...t.map(m=>Object.assign(Object.assign({},m),a.emailAlerts)),...o]}))}static buildWorkdays(i){return i.reduce((t,o,a)=>o?t.concat([a+1]):t,[])}static buildPauses(i){return i.enabled?i:{enabled:!1}}}x.\u0275fac=function(i){return new(i||x)(e.Y36(h.D),e.Y36(f),e.Y36(V.S),e.Y36(z.UIRouterGlobals),e.Y36(s.qu),e.Y36(e.sBO))},x.\u0275cmp=e.Xpm({type:x,selectors:[["op-reminders-page"]],inputs:{userId:"userId"},features:[e.qOj],decls:3,vars:2,consts:[[1,"title-container"],[3,"textContent"],["class","op-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"op-form",3,"formGroup","ngSubmit"],[1,"op-form--fieldset"],[1,"op-form--submit"],["type","submit",1,"button","-highlight",3,"textContent"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0),e._UZ(1,"h2",1),e.qZA(),e.YNc(2,dt,7,2,"form",2)),2&i&&(e.xp6(1),e.Q6J("textContent",t.text.title),e.xp6(1),e.Q6J("ngIf",t.formInitialized))},directives:[g.O5,s._Y,s.JL,s.sg,j,v,b,C],styles:[".form--section-title[_ngcontent-%COMP%]{text-transform:initial;border-bottom:initial;margin-bottom:initial!important}"],changeDetection:0});const pt=[{name:"my_notifications",url:"/my/notifications",component:T},{name:"user_notifications",url:"/users/:userId/edit/notifications",component:T},{name:"my_reminders",url:"/my/reminders",component:x},{name:"user_reminders",url:"/users/:userId/edit/reminders",component:x}];class w{}w.\u0275fac=function(i){return new(i||w)},w.\u0275mod=e.oAB({type:w}),w.\u0275inj=e.cJS({providers:[f],imports:[[g.ez,se.H,ae.C,s.u5,s.UX,oe.UIRouterModule.forChild({states:pt})]]})}}]);
//# sourceMappingURL=src_app_features_user-preferences_user-preferences_module_ts.da4dda17d395a3203054.js.map