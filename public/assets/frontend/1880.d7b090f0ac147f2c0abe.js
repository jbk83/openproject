"use strict";(self.webpackChunkopenproject_frontend=self.webpackChunkopenproject_frontend||[]).push([[1880],{91880:(Se,J,c)=>{c.r(J),c.d(J,{OpenProjectMyAccountModule:()=>Z});var p=c(38583),z=c(68311),s=c(3679),W=c(21757),B=c(74990),H=c(61908),X=c(36293),f=c(96617),Q=c(64762),q=c(90276);let N=class extends q.yh{constructor(){super({autoHidePopups:!0,commentSortDescending:!1,hideMail:!0,timeZone:null,warnOnLeavingUnsaved:!0,notifications:[],dailyReminders:{enabled:!0,times:["08:00"]},workdays:[],immediateReminders:{mentioned:!1},pauseReminders:{enabled:!1}})}};N=(0,Q.gn)([(0,q.yC)({name:"notification-settings"}),(0,Q.w6)("design:paramtypes",[])],N);var d=c(88002),U=c(45435);class K extends q.AE{constructor(i){super(i),this.store=i,this.notificationSettings$=this.select("notifications"),this.notificationsGroupedByProject$=this.notificationSettings$.pipe((0,d.U)(t=>t.filter(o=>o._links.project.href)),(0,d.U)(t=>_.groupBy(t,o=>o._links.project.title))),this.notificationsForGlobal$=this.notificationSettings$.pipe((0,d.U)(t=>t.find(o=>null===o._links.project.href))),this.projectNotifications$=this.notificationSettings$.pipe((0,d.U)(t=>t.filter(o=>null!==o._links.project.href))),this.globalNotification$=this.notificationSettings$.pipe((0,d.U)(t=>t.find(o=>!o._links.project.href)),(0,U.h)(t=>!!t)),this.selectedProjects$=this.notificationSettings$.pipe((0,d.U)(t=>new Set(t.map(o=>{var r;return null===(r=o._links.project)||void 0===r?void 0:r.href})))),this.dailyReminders$=this.select("dailyReminders"),this.dailyRemindersEnabled$=this.dailyReminders$.pipe((0,d.U)(t=>t.enabled)),this.dailyRemindersTimes$=this.dailyReminders$.pipe((0,d.U)(t=>t.times)),this.preferences$=this.select()}}var e=c(37716);class m{constructor(i,t,o){this.apiV3Service=i,this.toastService=t,this.I18n=o,this.store=new N,this.query=new K(this.store)}get(i){this.store.setLoading(!0),this.preferenceAPI(i).get().subscribe(t=>this.store.update(t),t=>this.toastService.addError(t)).add(()=>this.store.setLoading(!1))}update(i,t){this.store.setLoading(!0),this.preferenceAPI(i).patch(t).subscribe(o=>{this.store.update(o),this.toastService.addSuccess(this.I18n.t("js.notice_successful_update"))},o=>this.toastService.addError(o)).add(()=>this.store.setLoading(!1))}preferenceAPI(i){return this.apiV3Service.users.id(i).preferences}}m.\u0275fac=function(i){return new(i||m)(e.LFG(H.T),e.LFG(X.kl),e.LFG(f.D))},m.\u0275prov=e.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"});var F=c(71056),R=c(99120),$=c(96905),M=c(26942);class w{constructor(i,t){this.storeService=i,this.I18n=t,this.projectSettings$=this.storeService.query.projectNotifications$,this.text={title:this.I18n.t("js.notifications.settings.title")}}removeAll(){this.storeService.store.update(({notifications:i})=>({notifications:i.filter(t=>null===t._links.project.href)}))}}w.\u0275fac=function(i){return new(i||w)(e.Y36(m),e.Y36(f.D))},w.\u0275cmp=e.Xpm({type:w,selectors:[["op-notifications-settings-toolbar"]],decls:4,vars:1,consts:[[1,"toolbar-container"],[1,"toolbar"],[1,"title-container"],[3,"textContent"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"h2",3),e.qZA(),e.qZA(),e.qZA()),2&i&&(e.xp6(3),e.Q6J("textContent",t.text.title))},encapsulation:2,changeDetection:0});var b=c(22784),ee=c(70233),te=c(10190),ie=c(5443);function oe(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",3),e.NdJ("click",function(){e.CHM(t);return e.oxw().active=!0}),e._UZ(1,"span",4),e._UZ(2,"span",5),e.qZA()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("textContent",t.text.add_setting)}}function ne(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"op-project-autocompleter",6),e.NdJ("valueChange",function(r){return e.CHM(t),e.oxw().selectProject(r)})("keydown.escape",function(){e.CHM(t);return e.oxw().active=!1}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("apiFilters",t.APIFilters)("mapResultsFn",t.mapProjectsFn.bind(t))("placeholder",t.text.please_select)}}class T{constructor(i){this.I18n=i,this.selected=new e.vpe,this.active=!1,this.text={add_setting:this.I18n.t("js.notifications.settings.project_specific.add"),please_select:this.I18n.t("js.placeholders.selection"),already_selected:this.I18n.t("js.notifications.settings.project_specific.already_selected")}}get APIFilters(){return[["visible","=",[this.userId]]]}selectProject(i){this.selected.emit({title:i.name,href:i.href}),this.active=!1}mapProjectsFn(i){return i.map(t=>Object.assign(Object.assign({},t),{disabled:!!this.settings.controls.find(o=>o.get("project").value.href===t.href),disabledReason:this.text.already_selected}))}}function se(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"th",4),e.TgZ(2,"a",7),e._uU(3),e.qZA(),e.qZA(),e.BQk()),2&n){const t=i.$implicit,o=e.oxw(2);e.xp6(2),e.Q6J("href",o.projectLink(t.controls.project.value.href),e.LSH),e.xp6(1),e.Oqu(t.controls.project.value.title)}}function re(n,i){1&n&&(e.ynx(0),e.TgZ(1,"td",8),e._UZ(2,"input",9),e.qZA(),e.BQk())}function ae(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",10),e._UZ(2,"input",11),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function ce(n,i){1&n&&(e.ynx(0),e.TgZ(1,"td",8),e._UZ(2,"input",9),e.qZA(),e.BQk())}function le(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",10),e._UZ(2,"input",12),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function de(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",10),e._UZ(2,"input",13),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function pe(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",10),e._UZ(2,"input",14),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function me(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",10),e._UZ(2,"input",15),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function ge(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"td",10),e._UZ(2,"input",16),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(1),e.Q6J("formGroup",t),e.xp6(1),e.uIk("data-qa-project",t.controls.project.value.title)}}function fe(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"td",8),e.TgZ(2,"button",17),e.NdJ("click",function(){const a=e.CHM(t).index;return e.oxw(2).removeProjectSettings(a)}),e._uU(3),e.qZA(),e.qZA(),e.BQk()}if(2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.text.remove_project_settings," ")}}function ue(n,i){if(1&n&&(e.TgZ(0,"div",2),e.TgZ(1,"table",3),e.TgZ(2,"thead"),e.TgZ(3,"tr"),e.TgZ(4,"th",4),e._uU(5),e.qZA(),e.YNc(6,se,4,2,"ng-container",5),e.qZA(),e.qZA(),e.TgZ(7,"tbody"),e.TgZ(8,"tr"),e.TgZ(9,"th",6),e.TgZ(10,"h5"),e._uU(11),e.qZA(),e.TgZ(12,"p"),e._uU(13),e.qZA(),e.qZA(),e.YNc(14,re,3,0,"ng-container",5),e.qZA(),e.TgZ(15,"tr"),e.TgZ(16,"th",6),e.TgZ(17,"h5"),e._uU(18),e.qZA(),e.TgZ(19,"p"),e._uU(20),e.qZA(),e.qZA(),e.YNc(21,ae,3,2,"ng-container",5),e.qZA(),e.TgZ(22,"tr"),e.TgZ(23,"th",6),e._uU(24),e.qZA(),e.YNc(25,ce,3,0,"ng-container",5),e.qZA(),e.TgZ(26,"tr"),e.TgZ(27,"th",6),e._uU(28),e.qZA(),e.YNc(29,le,3,2,"ng-container",5),e.qZA(),e.TgZ(30,"tr"),e.TgZ(31,"th",6),e._uU(32),e.qZA(),e.YNc(33,de,3,2,"ng-container",5),e.qZA(),e.TgZ(34,"tr"),e.TgZ(35,"th",6),e._uU(36),e.qZA(),e.YNc(37,pe,3,2,"ng-container",5),e.qZA(),e.TgZ(38,"tr"),e.TgZ(39,"th",6),e._uU(40),e.qZA(),e.YNc(41,me,3,2,"ng-container",5),e.qZA(),e.TgZ(42,"tr"),e.TgZ(43,"th",6),e._uU(44),e.qZA(),e.YNc(45,ge,3,2,"ng-container",5),e.qZA(),e.TgZ(46,"tr"),e._UZ(47,"th",6),e.YNc(48,fe,4,1,"ng-container",5),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(5),e.hij(" ",t.text.notify_me," "),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(5),e.Oqu(t.text.mentioned_header.title),e.xp6(2),e.Oqu(t.text.mentioned_header.description),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(4),e.Oqu(t.text.involved_header.title),e.xp6(2),e.Oqu(t.text.involved_header.description),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.watched_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_created_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_processed_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_scheduled_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_prioritized_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Oqu(t.text.work_package_commented_header),e.xp6(1),e.Q6J("ngForOf",t.settings.controls),e.xp6(3),e.Q6J("ngForOf",t.settings.controls)}}function he(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"op-notification-setting-inline-create",18),e.NdJ("selected",function(r){return e.CHM(t),e.oxw().addProjectSettings(r)}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("userId",t.userId)("settings",t.settings)}}T.\u0275fac=function(i){return new(i||T)(e.Y36(f.D))},T.\u0275cmp=e.Xpm({type:T,selectors:[["op-notification-setting-inline-create"]],inputs:{userId:"userId",settings:"settings"},outputs:{selected:"selected"},decls:3,vars:2,consts:[[1,"wp-inline-create-button"],["class","spot-link","type","button",3,"click",4,"ngIf"],["dropdownPosition","top",3,"apiFilters","mapResultsFn","placeholder","valueChange","keydown.escape",4,"ngIf"],["type","button",1,"spot-link",3,"click"],[1,"spot-icon","spot-icon_add"],[3,"textContent"],["dropdownPosition","top",3,"apiFilters","mapResultsFn","placeholder","valueChange","keydown.escape"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0),e.YNc(1,oe,3,1,"button",1),e.YNc(2,ne,1,3,"op-project-autocompleter",2),e.qZA()),2&i&&(e.xp6(1),e.Q6J("ngIf",!t.active),e.xp6(1),e.Q6J("ngIf",t.active))},directives:[p.O5,ie.F],styles:[".op-autocompleter[_ngcontent-%COMP%]{display:block;max-width:600px}"],changeDetection:0});class C{constructor(i,t){this.I18n=i,this.pathHelper=t,this.text={notify_me:this.I18n.t("js.notifications.settings.notify_me"),save:this.I18n.t("js.button_save"),mentioned_header:{title:this.I18n.t("js.notifications.settings.reasons.mentioned.title"),description:this.I18n.t("js.notifications.settings.reasons.mentioned.description")},involved_header:{title:this.I18n.t("js.notifications.settings.reasons.involved.title"),description:this.I18n.t("js.notifications.settings.reasons.involved.description")},watched_header:this.I18n.t("js.notifications.settings.reasons.watched"),work_package_commented_header:this.I18n.t("js.notifications.settings.reasons.work_package_commented"),work_package_created_header:this.I18n.t("js.notifications.settings.reasons.work_package_created"),work_package_processed_header:this.I18n.t("js.notifications.settings.reasons.work_package_processed"),work_package_prioritized_header:this.I18n.t("js.notifications.settings.reasons.work_package_prioritized"),work_package_scheduled_header:this.I18n.t("js.notifications.settings.reasons.work_package_scheduled"),remove_project_settings:this.I18n.t("js.notifications.settings.project_specific.remove")}}projectLink(i){return this.pathHelper.projectPath((0,te.Z)(i))}addProjectSettings(i){this.settings.push(new s.cw({project:new s.NI(i),involved:new s.NI(!1),workPackageCreated:new s.NI(!1),workPackageProcessed:new s.NI(!1),workPackageScheduled:new s.NI(!1),workPackagePrioritized:new s.NI(!1),workPackageCommented:new s.NI(!1)}))}removeProjectSettings(i){this.settings.removeAt(i)}}function _e(n,i){if(1&n&&e._UZ(0,"op-notification-settings-table",15),2&n){const t=e.oxw();e.Q6J("userId",t.userId)("settings",t.form.controls.projectSettings)}}C.\u0275fac=function(i){return new(i||C)(e.Y36(f.D),e.Y36(ee.j))},C.\u0275cmp=e.Xpm({type:C,selectors:[["op-notification-settings-table"]],inputs:{userId:"userId",settings:"settings"},decls:2,vars:2,consts:[["class","op-scrollable-table",4,"ngIf"],["data-qa-selector","notification-setting-inline-create",3,"userId","settings","selected",4,"ngIf"],[1,"op-scrollable-table"],[1,"op-table"],[1,"op-table--cell","op-table--cell_heading"],[4,"ngFor","ngForOf"],[1,"op-table--cell","op-table--cell_soft-heading"],[1,"spot-link",3,"href"],[1,"op-table--cell"],["type","checkbox","disabled","","checked",""],[1,"op-table--cell",3,"formGroup"],["type","checkbox","formControlName","involved","data-qa-project-notification-type","involved"],["type","checkbox","formControlName","workPackageCreated","data-qa-project-notification-type","work_package_created"],["type","checkbox","formControlName","workPackageProcessed","data-qa-project-notification-type","work_package_processed"],["type","checkbox","formControlName","workPackageScheduled","data-qa-project-notification-type","work_package_scheduled"],["type","checkbox","formControlName","workPackagePrioritized","data-qa-project-notification-type","work_package_prioritized"],["type","checkbox","formControlName","workPackageCommented","data-qa-project-notification-type","work_package_commented"],["type","button",1,"spot-link",3,"click"],["data-qa-selector","notification-setting-inline-create",3,"userId","settings","selected"]],template:function(i,t){1&i&&(e.YNc(0,ue,49,21,"div",0),e.YNc(1,he,1,2,"op-notification-setting-inline-create",1)),2&i&&(e.Q6J("ngIf",t.settings.length>0),e.xp6(1),e.Q6J("ngIf",t.userId))},directives:[p.O5,p.sg,s.JL,s.sg,s.Wl,s.JJ,s.u,T],styles:[".op-table[_ngcontent-%COMP%]{margin-bottom:1rem}"],changeDetection:0});class y extends M.N{constructor(i,t,o,r,a){super(),this.changeDetectorRef=i,this.I18n=t,this.storeService=o,this.currentUserService=r,this.uiRouterGlobals=a,this.form=new s.cw({involved:new s.NI(!1),workPackageCreated:new s.NI(!1),workPackageProcessed:new s.NI(!1),workPackageScheduled:new s.NI(!1),workPackagePrioritized:new s.NI(!1),workPackageCommented:new s.NI(!1),projectSettings:new s.Oe([])}),this.text={notifyImmediately:{title:this.I18n.t("js.notifications.settings.global.immediately.title"),description:this.I18n.t("js.notifications.settings.global.immediately.description")},alsoNotifyFor:{title:this.I18n.t("js.notifications.settings.global.delayed.title"),description:this.I18n.t("js.notifications.settings.global.delayed.description")},mentioned:{title:this.I18n.t("js.notifications.settings.reasons.mentioned.title"),description:this.I18n.t("js.notifications.settings.reasons.mentioned.description")},involved:{title:this.I18n.t("js.notifications.settings.reasons.involved.title"),description:this.I18n.t("js.notifications.settings.reasons.involved.description")},watched:this.I18n.t("js.notifications.settings.reasons.watched"),work_package_commented:this.I18n.t("js.notifications.settings.reasons.work_package_commented"),work_package_created:this.I18n.t("js.notifications.settings.reasons.work_package_created"),work_package_processed:this.I18n.t("js.notifications.settings.reasons.work_package_processed"),work_package_prioritized:this.I18n.t("js.notifications.settings.reasons.work_package_prioritized"),work_package_scheduled:this.I18n.t("js.notifications.settings.reasons.work_package_scheduled"),save:this.I18n.t("js.button_save"),projectSpecific:{title:this.I18n.t("js.notifications.settings.project_specific.title"),description:this.I18n.t("js.notifications.settings.project_specific.description")}}}ngOnInit(){this.userId=this.userId||this.uiRouterGlobals.params.userId,this.currentUserService.user$.pipe((0,F.take)(1)).subscribe(i=>{this.userId=this.userId||i.id,this.storeService.get(this.userId)}),this.storeService.query.notificationsForGlobal$.pipe(this.untilDestroyed()).subscribe(i=>{var t,o,r,a,l,u;!i||(null===(t=this.form.get("involved"))||void 0===t||t.setValue(i.involved),null===(o=this.form.get("workPackageCreated"))||void 0===o||o.setValue(i.workPackageCreated),null===(r=this.form.get("workPackageProcessed"))||void 0===r||r.setValue(i.workPackageProcessed),null===(a=this.form.get("workPackageScheduled"))||void 0===a||a.setValue(i.workPackageScheduled),null===(l=this.form.get("workPackagePrioritized"))||void 0===l||l.setValue(i.workPackagePrioritized),null===(u=this.form.get("workPackageCommented"))||void 0===u||u.setValue(i.workPackageCommented))}),this.storeService.query.projectNotifications$.pipe(this.untilDestroyed()).subscribe(i=>{if(!i)return;const t=new s.Oe([]);t.clear(),i.sort((o,r)=>o._links.project.title.localeCompare(r._links.project.title)).forEach(o=>t.push(new s.cw({project:new s.NI(o._links.project),involved:new s.NI(o.involved),workPackageCreated:new s.NI(o.workPackageCreated),workPackageProcessed:new s.NI(o.workPackageProcessed),workPackageScheduled:new s.NI(o.workPackageScheduled),workPackagePrioritized:new s.NI(o.workPackagePrioritized),workPackageCommented:new s.NI(o.workPackageCommented)}))),this.form.setControl("projectSettings",t),this.changeDetectorRef.detectChanges()})}saveChanges(){const i=this.storeService.store.getValue(),t=this.form.value,o=i.notifications.find(l=>!l._links.project.href),r=Object.assign(Object.assign({},o),{_links:{project:{href:null}},watched:!0,mentioned:!0,involved:t.involved,workPackageCreated:t.workPackageCreated,workPackageProcessed:t.workPackageProcessed,workPackageScheduled:t.workPackageScheduled,workPackagePrioritized:t.workPackagePrioritized,workPackageCommented:t.workPackageCommented}),a=t.projectSettings.map(l=>({_links:{project:{href:l.project.href}},watched:!0,mentioned:!0,involved:l.involved,workPackageCreated:l.workPackageCreated,workPackageProcessed:l.workPackageProcessed,workPackageScheduled:l.workPackageScheduled,workPackagePrioritized:l.workPackagePrioritized,workPackageCommented:l.workPackageCommented,newsAdded:!1,newsCommented:!1,documentAdded:!1,forumMessages:!1,wikiPageAdded:!1,wikiPageUpdated:!1,membershipAdded:!1,membershipUpdated:!1}));this.storeService.update(this.userId,Object.assign(Object.assign({},i),{notifications:[r,...a]}))}}function ke(n,i){if(1&n&&(e.TgZ(0,"op-checkbox-field",4),e._UZ(1,"input",5),e.TgZ(2,"p",6),e._uU(3),e.qZA(),e.qZA()),2&n){const t=i.$implicit,o=e.oxw();e.Q6J("control",o.form.get(t)),e.xp6(1),e.Q6J("formControlName",t),e.xp6(2),e.Oqu(o.text[t])}}y.\u0275fac=function(i){return new(i||y)(e.Y36(e.sBO),e.Y36(f.D),e.Y36(m),e.Y36($.S),e.Y36(R.UIRouterGlobals))},y.\u0275cmp=e.Xpm({type:y,selectors:[["op-notifications-page"]],inputs:{userId:"userId"},features:[e.qOj],decls:50,vars:25,consts:[[1,"op-form",3,"formGroup","ngSubmit"],[3,"label"],["disabled","","checked","","type","checkbox","slot","input"],["slot","description"],[3,"label","control"],["slot","input","type","checkbox","formControlName","involved","data-qa-global-notification-type","involved"],[3,"control"],["slot","input","type","checkbox","formControlName","workPackageCreated","data-qa-global-notification-type","work_package_created"],["slot","input","type","checkbox","formControlName","workPackageProcessed","data-qa-global-notification-type","work_package_processed"],["slot","input","type","checkbox","formControlName","workPackageScheduled","data-qa-global-notification-type","work_package_scheduled"],["slot","input","type","checkbox","formControlName","workPackagePrioritized","data-qa-global-notification-type","work_package_prioritized"],["slot","input","type","checkbox","formControlName","workPackageCommented","data-qa-global-notification-type","work_package_commented"],["formArrayName","projectSettings","class","op-notification-settings-page--table",3,"userId","settings",4,"ngIf"],[1,"generic-table--action-buttons"],["type","submit",1,"button","-highlight",3,"textContent"],["formArrayName","projectSettings",1,"op-notification-settings-page--table",3,"userId","settings"]],template:function(i,t){1&i&&(e._UZ(0,"op-notifications-settings-toolbar"),e.TgZ(1,"form",0),e.NdJ("ngSubmit",function(){return t.saveChanges()}),e.TgZ(2,"h5"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"op-checkbox-field",1),e._UZ(7,"input",2),e.TgZ(8,"p",3),e._uU(9),e.qZA(),e.qZA(),e.TgZ(10,"op-checkbox-field",4),e._UZ(11,"input",5),e.TgZ(12,"p",3),e._uU(13),e.qZA(),e.qZA(),e.TgZ(14,"h5"),e._uU(15),e.qZA(),e.TgZ(16,"p"),e._uU(17),e.qZA(),e.TgZ(18,"op-checkbox-field"),e._UZ(19,"input",2),e.TgZ(20,"p",3),e._uU(21),e.qZA(),e.qZA(),e.TgZ(22,"op-checkbox-field",6),e._UZ(23,"input",7),e.TgZ(24,"p",3),e._uU(25),e.qZA(),e.qZA(),e.TgZ(26,"op-checkbox-field",6),e._UZ(27,"input",8),e.TgZ(28,"p",3),e._uU(29),e.qZA(),e.qZA(),e.TgZ(30,"op-checkbox-field",6),e._UZ(31,"input",9),e.TgZ(32,"p",3),e._uU(33),e.qZA(),e.qZA(),e.TgZ(34,"op-checkbox-field",6),e._UZ(35,"input",10),e.TgZ(36,"p",3),e._uU(37),e.qZA(),e.qZA(),e.TgZ(38,"op-checkbox-field",6),e._UZ(39,"input",11),e.TgZ(40,"p",3),e._uU(41),e.qZA(),e.qZA(),e._UZ(42,"hr"),e.TgZ(43,"h5"),e._uU(44),e.qZA(),e.TgZ(45,"p"),e._uU(46),e.qZA(),e.YNc(47,_e,1,2,"op-notification-settings-table",12),e.TgZ(48,"div",13),e._UZ(49,"button",14),e.qZA(),e.qZA()),2&i&&(e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(2),e.Oqu(t.text.notifyImmediately.title),e.xp6(2),e.Oqu(t.text.notifyImmediately.description),e.xp6(1),e.Q6J("label",t.text.mentioned.title),e.xp6(3),e.Oqu(t.text.mentioned.description),e.xp6(1),e.Q6J("label",t.text.involved.title)("control",t.form.get("involved")),e.xp6(3),e.Oqu(t.text.involved.description),e.xp6(2),e.Oqu(t.text.alsoNotifyFor.title),e.xp6(2),e.Oqu(t.text.alsoNotifyFor.description),e.xp6(4),e.Oqu(t.text.watched),e.xp6(1),e.Q6J("control",t.form.get("workPackageCreated")),e.xp6(3),e.Oqu(t.text.work_package_created),e.xp6(1),e.Q6J("control",t.form.get("workPackageProcessed")),e.xp6(3),e.Oqu(t.text.work_package_processed),e.xp6(1),e.Q6J("control",t.form.get("workPackageScheduled")),e.xp6(3),e.Oqu(t.text.work_package_scheduled),e.xp6(1),e.Q6J("control",t.form.get("workPackagePrioritized")),e.xp6(3),e.Oqu(t.text.work_package_prioritized),e.xp6(1),e.Q6J("control",t.form.get("workPackageCommented")),e.xp6(3),e.Oqu(t.text.work_package_commented),e.xp6(3),e.Oqu(t.text.projectSpecific.title),e.xp6(2),e.Oqu(t.text.projectSpecific.description),e.xp6(1),e.Q6J("ngIf",t.userId),e.xp6(2),e.Q6J("textContent",t.text.save))},directives:[w,s._Y,s.JL,s.sg,b.X,s.Wl,s.JJ,s.u,p.O5,C,s.CE],encapsulation:2,changeDetection:0});const Y=["newsAdded","newsCommented","documentAdded","forumMessages","wikiPageAdded","wikiPageUpdated","membershipAdded","membershipUpdated"];class I{constructor(i,t,o){this.I18n=i,this.storeService=t,this.rootFormGroup=o,this.alerts=Y,this.text={title:this.I18n.t("js.reminders.settings.alerts.title"),explanation:this.I18n.t("js.reminders.settings.alerts.explanation"),newsAdded:this.I18n.t("js.reminders.settings.alerts.news_added"),newsCommented:this.I18n.t("js.reminders.settings.alerts.news_commented"),documentAdded:this.I18n.t("js.reminders.settings.alerts.document_added"),forumMessages:this.I18n.t("js.reminders.settings.alerts.forum_messages"),wikiPageAdded:this.I18n.t("js.reminders.settings.alerts.wiki_page_added"),wikiPageUpdated:this.I18n.t("js.reminders.settings.alerts.wiki_page_updated"),membershipAdded:this.I18n.t("js.reminders.settings.alerts.membership_added"),membershipUpdated:this.I18n.t("js.reminders.settings.alerts.membership_updated")}}ngOnInit(){this.form=this.rootFormGroup.control.get("emailAlerts")}}I.\u0275fac=function(i){return new(i||I)(e.Y36(f.D),e.Y36(m),e.Y36(s.sg))},I.\u0275cmp=e.Xpm({type:I,selectors:[["op-email-alerts-settings"]],decls:5,vars:4,consts:[[3,"formGroup"],[1,"op-form--section-header"],[3,"textContent"],[3,"control",4,"ngFor","ngForOf"],[3,"control"],["slot","input","type","checkbox",3,"formControlName"],["slot","description"]],template:function(i,t){1&i&&(e.ynx(0,0),e.TgZ(1,"div",1),e._UZ(2,"h5",2),e._UZ(3,"p",2),e.qZA(),e.YNc(4,ke,4,3,"op-checkbox-field",3),e.BQk()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("textContent",t.text.title),e.xp6(1),e.Q6J("textContent",t.text.explanation),e.xp6(1),e.Q6J("ngForOf",t.alerts))},directives:[s.JL,s.sg,p.sg,b.X,s.Wl,s.JJ,s.u],encapsulation:2,changeDetection:0});var D=c(57057);class j{constructor(i,t,o){this.I18n=i,this.storeService=t,this.rootFormGroup=o,this.text={title:this.I18n.t("js.reminders.settings.immediate.title"),explanation:this.I18n.t("js.reminders.settings.immediate.explanation"),mentioned:this.I18n.t("js.reminders.settings.immediate.mentioned")}}ngOnInit(){this.form=this.rootFormGroup.control.get("immediateReminders")}}j.\u0275fac=function(i){return new(i||j)(e.Y36(f.D),e.Y36(m),e.Y36(s.sg))},j.\u0275cmp=e.Xpm({type:j,selectors:[["op-immediate-reminder-settings"]],decls:7,vars:4,consts:[[3,"formGroup"],[1,"op-form--section-header"],[3,"textContent"],[3,"control"],["slot","input","type","checkbox","formControlName","mentioned","data-qa-immediate-reminder","mentioned"],["slot","description"]],template:function(i,t){1&i&&(e.ynx(0,0),e.TgZ(1,"div",1),e._UZ(2,"h5",2),e.qZA(),e.TgZ(3,"op-checkbox-field",3),e._UZ(4,"input",4),e.TgZ(5,"p",5),e._uU(6),e.qZA(),e.qZA(),e.BQk()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(2),e.Q6J("textContent",t.text.title),e.xp6(1),e.Q6J("control",t.form.get("mentioned")),e.xp6(3),e.Oqu(t.text.mentioned))},directives:[s.JL,s.sg,b.X,s.Wl,s.JJ,s.u],encapsulation:2,changeDetection:0});var P=c(39761),G=c(47349),S=c(17757),O=c(9112),xe=c(12877),be=c(2775);const L=function(){return{standalone:!0}};function ye(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"input",17),e.NdJ("ngModelChange",function(r){e.CHM(t);const a=e.oxw().index,l=e.oxw().ngIf;return e.oxw().toggleActive(r,a,l)}),e.qZA()}if(2&n){const t=i.ngIf,o=e.oxw(),r=o.index,a=o.$implicit,l=e.oxw(2);e.Q2q("data-qa-selector","op-settings-daily-time--active-",r+1,""),e.Q6J("ngModel",l.isActive(a))("ngModelOptions",e.DdM(4,L))("disabled",l.isDisabled(a,t))}}function Ze(n,i){if(1&n&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&n){const t=i.$implicit,o=e.oxw().$implicit,r=e.oxw().ngIf,a=e.oxw();e.Q6J("value",t)("disabled",o!==t&&r.includes(t)),e.xp6(1),e.hij(" ",a.timeLabel(t)," ")}}function we(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().index,a=e.oxw().ngIf;return e.oxw().removeTime(a,r)}),e._UZ(1,"op-icon",20),e.qZA()}if(2&n){const t=e.oxw().index;e.Q2q("data-qa-selector","op-settings-daily-time--remove-",t+1,"")}}function Te(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",11),e.YNc(1,ye,1,5,"input",12),e.ALo(2,"async"),e._UZ(3,"label",13),e.TgZ(4,"select",14),e.NdJ("ngModelChange",function(r){const l=e.CHM(t).index,u=e.oxw().ngIf;return e.oxw().changeTime(r,u,l)}),e.ALo(5,"async"),e.YNc(6,Ze,2,3,"option",15),e.qZA(),e.YNc(7,we,2,1,"button",16),e.ALo(8,"async"),e.qZA()}if(2&n){const t=i.$implicit,o=i.index,r=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,9,r.activeTimes$)),e.xp6(2),e.Q2q("for","op-reminder-settings-daily-time-",o+1,"--time"),e.Q6J("textContent",r.text.timeLabel(o+1)),e.xp6(1),e.Q2q("id","op-reminder-settings-daily-time-",o+1,"--time"),e.Q6J("ngModel",t)("ngModelOptions",e.DdM(15,L))("disabled",!1===e.lcZ(5,11,r.enabled$)),e.xp6(2),e.Q6J("ngForOf",r.availableTimes),e.xp6(1),e.Q6J("ngIf",e.lcZ(8,13,r.timeRemovable$))}}function Ce(n,i){if(1&n){const t=e.EpF();e.ynx(0,1),e.TgZ(1,"div",2),e._UZ(2,"h5",3),e._UZ(3,"p",3),e.qZA(),e.TgZ(4,"op-checkbox-field",4),e._UZ(5,"input",5),e.TgZ(6,"p",6),e._uU(7),e.qZA(),e.qZA(),e.YNc(8,Te,9,16,"div",7),e.TgZ(9,"button",8),e.NdJ("click",function(){const a=e.CHM(t).ngIf;return e.oxw().addTime(a)}),e.ALo(10,"async"),e._UZ(11,"i",9),e.TgZ(12,"span",10),e._uU(13),e.qZA(),e.qZA(),e.BQk()}if(2&n){const t=i.ngIf,o=e.oxw();e.Q6J("formGroup",o.form),e.xp6(2),e.Q6J("textContent",o.text.title),e.xp6(1),e.Q6J("textContent",o.text.explanation),e.xp6(1),e.Q6J("control",o.form.get("enabled")),e.xp6(3),e.Oqu(o.text.enable),e.xp6(1),e.Q6J("ngForOf",t)("ngForTrackBy",o.index),e.xp6(1),e.Q6J("disabled",e.lcZ(10,9,o.nonAddable$)),e.xp6(4),e.Oqu(o.text.addTime)}}class k{constructor(i,t,o,r){this.I18n=i,this.storeService=t,this.rootFormGroup=o,this.configurationService=r,this.availableTimes=k.setupAvailableTimes(),this.inactiveTimes=[],this.suggestedTimes=["08:00","12:00","15:00","18:00"],this.selectedTimes$=S.C,this.activeTimes$=S.C,this.timeRemovable$=S.C,this.nonAddable$=S.C,this.text={title:this.I18n.t("js.reminders.settings.daily.title"),explanation:this.I18n.t("js.reminders.settings.daily.explanation",{no_time_zone:this.configurationService.isTimezoneSet()?"":this.I18n.t("js.reminders.settings.daily.no_time_zone")}),timeLabel:a=>this.I18n.t("js.reminders.settings.daily.time_label",{counter:a}),addTime:this.I18n.t("js.reminders.settings.daily.add_time"),enable:this.I18n.t("js.reminders.settings.daily.enable")}}ngOnInit(){this.form=this.rootFormGroup.control.get("dailyReminders"),this.enabled$=this.form.valueChanges.pipe((0,P.O)(()=>{var i;return null===(i=this.form.get("enabled"))||void 0===i?void 0:i.value}),(0,d.U)(()=>{var i;return null===(i=this.form.get("enabled"))||void 0===i?void 0:i.value}),(0,G.d)(1)),this.selectedTimes$=this.form.get("times").valueChanges.pipe((0,P.O)(()=>{var i;return null===(i=this.form.get("times"))||void 0===i?void 0:i.value}),(0,d.U)(()=>{const t=this.form.get("times").controls.map(o=>o.value);return this.inactiveTimes.sort((o,r)=>o.position-r.position).forEach(o=>{t.splice(o.position,0,o.time)}),t}),(0,G.d)(1)),this.timeRemovable$=(0,O.aj)([this.enabled$,this.selectedTimes$]).pipe((0,d.U)(([i,t])=>i&&t.length>1)),this.nonAddable$=(0,O.aj)([this.enabled$,this.selectedTimes$]).pipe((0,d.U)(([i,t])=>!i||t.length===this.availableTimes.length)),this.activeTimes$=(0,O.aj)([this.enabled$,this.selectedTimes$]).pipe((0,d.U)(([i,t])=>i?t:[]))}addTime(i){const t=this.firstAvailableSuggested(i)||this.firstAfterSelected(i);t&&this.storeTimes(i.concat(t))}changeTime(i,t,o){t.splice(o,1,i),this.storeTimes(t)}isActive(i){return!this.inactiveTimes.find(t=>t.time===i)}removeTime(i,t){this.inactiveTimes=this.inactiveTimes.filter(o=>o.time!==i[t]),this.inactiveTimes.forEach(o=>{o.position>t&&(o.position-=1)}),i.splice(t,1),1===i.length&&(this.inactiveTimes=[]),i.length===this.inactiveTimes.length&&this.inactiveTimes.shift(),this.storeTimes(i)}toggleActive(i,t,o){i?this.inactiveTimes=this.inactiveTimes.filter(r=>r.time!==o[t]):this.inactiveTimes.push({position:t,time:o[t]}),this.storeTimes(o)}timeLabel(i){return this.I18n.toTime("time.formats.time",k.dateForHour(parseInt(i.split(":")[0],10)))}isDisabled(i,t){return 0===t.length||1===t.length&&t[0]===i}storeTimes(i){const t=i.filter(r=>!this.inactiveTimes.map(a=>a.time).includes(r)),o=this.form.get("times");o.clear({emitEvent:!1}),t.forEach(r=>{o.push(new s.NI(r),{emitEvent:!1})}),o.enable({emitEvent:!0})}firstAvailableSuggested(i){return this.availableTimes.find(t=>this.suggestedTimes.includes(t)&&!i.includes(t))}firstAfterSelected(i){const t=this.availableTimes.indexOf(i[i.length-1]);for(let o=t;o<24+t;o++)if(!i.includes(this.availableTimes[o%24]))return this.availableTimes[o%24];return null}static setupAvailableTimes(){return Array.from({length:24},(i,t)=>k.dateForHour(t).toLocaleTimeString("en-US",{hour12:!1,hour:"numeric",minute:"numeric"}))}static dateForHour(i){const t=new Date;return t.setTime(36e5*(i-1)),t}}k.\u0275fac=function(i){return new(i||k)(e.Y36(f.D),e.Y36(m),e.Y36(s.sg),e.Y36(xe.e))},k.\u0275cmp=e.Xpm({type:k,selectors:[["op-reminder-settings-daily-time"]],decls:2,vars:3,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"op-form--section-header"],[3,"textContent"],[3,"control"],["slot","input","type","checkbox","formControlName","enabled"],["slot","description"],["class","op-reminder-settings-daily-time--row",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"button","op-reminder-settings-daily-time--add",3,"disabled","click"],[1,"button--icon","icon-add"],[1,"button--text"],[1,"op-reminder-settings-daily-time--row"],["type","checkbox","class","op-reminder-settings-daily-time--active",3,"ngModel","ngModelOptions","disabled","ngModelChange",4,"ngIf"],[1,"op-reminder-settings-daily-time--label",3,"textContent"],["required","true",1,"op-reminder-settings-daily-time--time","form--select","-narrow",3,"ngModel","ngModelOptions","disabled","ngModelChange"],[3,"value","disabled",4,"ngFor","ngForOf"],["class","spot-link op-reminder-settings-daily-time--remove","type","button",3,"click",4,"ngIf"],["type","checkbox",1,"op-reminder-settings-daily-time--active",3,"ngModel","ngModelOptions","disabled","ngModelChange"],[3,"value","disabled"],["type","button",1,"spot-link","op-reminder-settings-daily-time--remove",3,"click"],["icon-classes","icon-small icon-remove icon4"]],template:function(i,t){1&i&&(e.YNc(0,Ce,14,11,"ng-container",0),e.ALo(1,"async")),2&i&&e.Q6J("ngIf",e.lcZ(1,1,t.selectedTimes$))},directives:[p.O5,s.JL,s.sg,b.X,s.Wl,s.JJ,s.u,p.sg,s.EJ,s.Q7,s.On,s.YN,s.Kr,be.o],pipes:[p.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-reminder-settings-daily-time--enable[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:30px;margin-bottom:10px}.op-reminder-settings-daily-time--row[_ngcontent-%COMP%]{margin-left:40px;line-height:45px;display:flex;align-items:center}.op-reminder-settings-daily-time--row[_ngcontent-%COMP%]:nth-of-type(1){margin-top:10px}.op-reminder-settings-daily-time--active[_ngcontent-%COMP%]{flex:0 0 25px}.op-reminder-settings-daily-time--label[_ngcontent-%COMP%]{flex:0 0 60px;margin-bottom:0;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-reminder-settings-daily-time--time[_ngcontent-%COMP%]{height:32px;width:150px}.op-reminder-settings-daily-time--remove[_ngcontent-%COMP%]{padding-left:10px}.op-reminder-settings-daily-time--add[_ngcontent-%COMP%]{margin-top:20px;margin-left:40px;width:auto}"],changeDetection:0});var E=c(16738),Ie=c(51590);class A{constructor(i,t){this.I18n=i,this.rootFormGroup=t,this.text={label:this.I18n.t("js.reminders.settings.pause.label"),date_placeholder:this.I18n.t("js.placeholders.date"),first_day:this.I18n.t("js.reminders.settings.pause.first_day"),last_day:this.I18n.t("js.reminders.settings.pause.first_day")}}ngOnInit(){this.form=this.rootFormGroup.control.get("pauseReminders"),this.selectedDates$=this.form.valueChanges.pipe((0,P.O)(this.form.value),(0,d.U)(i=>[i.firstDay,i.lastDay])),this.enabled$=this.form.valueChanges.pipe((0,P.O)(this.form.value),(0,d.U)(i=>i.enabled))}setDates(i){const[t,o]=i;this.form.patchValue({firstDay:t,lastDay:o})}}function je(n,i){if(1&n&&(e.TgZ(0,"op-checkbox-field",4),e._UZ(1,"input",5),e._UZ(2,"p",6),e.qZA()),2&n){const t=i.$implicit,o=e.oxw();e.Q6J("control",o.controlForLocalWorkday(t)),e.xp6(1),e.Q6J("formControlName",o.indexOfLocalWorkday(t)),e.xp6(1),e.Q6J("textContent",t)}}A.\u0275fac=function(i){return new(i||A)(e.Y36(f.D),e.Y36(s.sg))},A.\u0275cmp=e.Xpm({type:A,selectors:[["op-pause-reminders"]],decls:9,vars:13,consts:[[1,"op-pause-reminders",3,"formGroup"],[1,"op-pause-reminders--checkbox",3,"control"],["slot","input","type","checkbox","formControlName","enabled"],["slot","description"],[3,"size","required","disabled","initialDates","changed"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0),e.TgZ(1,"op-checkbox-field",1),e._UZ(2,"input",2),e.TgZ(3,"p",3),e._uU(4),e.qZA(),e.qZA(),e.TgZ(5,"op-range-date-picker",4),e.NdJ("changed",function(r){return t.setDates(r)}),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"async"),e.qZA(),e.qZA()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("control",t.form.get("enabled")),e.xp6(3),e.Oqu(t.text.label),e.xp6(1),e.Q6J("size",23)("required",e.lcZ(6,7,t.enabled$))("disabled",!e.lcZ(7,9,t.enabled$))("initialDates",e.lcZ(8,11,t.selectedDates$)))},directives:[s.JL,s.sg,b.X,s.Wl,s.JJ,s.u,Ie.r],pipes:[p.Ov],styles:[".op-pause-reminders[_ngcontent-%COMP%]{display:flex;align-items:center}.op-pause-reminders--checkbox[_ngcontent-%COMP%]{margin-right:2rem}"],changeDetection:0});class x{constructor(i,t){this.I18n=i,this.formGroup=t,this.localeWorkdays=E.weekdays(!0),this.isoWorkdays=x.buildISOWeekdays(),this.text={title:this.I18n.t("js.reminders.settings.workdays.title")}}ngOnInit(){this.control=this.formGroup.control.get("workdays")}indexOfLocalWorkday(i){return this.isoWorkdays.indexOf(i)}controlForLocalWorkday(i){const t=this.indexOfLocalWorkday(i);return this.control.at(t)}static buildISOWeekdays(){const i=E.weekdays(!1);return i.push(i.shift()),i}}function Ae(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"form",3),e.NdJ("ngSubmit",function(){return e.CHM(t),e.oxw().saveChanges()}),e._UZ(1,"op-immediate-reminder-settings",4),e._UZ(2,"op-reminder-settings-daily-time",4),e._UZ(3,"op-workdays-settings",4),e._UZ(4,"op-email-alerts-settings",4),e.TgZ(5,"div",5),e._UZ(6,"button",6),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(6),e.Q6J("textContent",t.text.save)}}x.\u0275fac=function(i){return new(i||x)(e.Y36(f.D),e.Y36(s.sg))},x.\u0275cmp=e.Xpm({type:x,selectors:[["op-workdays-settings"]],decls:5,vars:3,consts:[[3,"formGroup"],[1,"op-form--section-header"],[3,"textContent"],["formArrayName","workdays",3,"control",4,"ngFor","ngForOf"],["formArrayName","workdays",3,"control"],["slot","input","type","checkbox",3,"formControlName"],["slot","description",3,"textContent"]],template:function(i,t){1&i&&(e.ynx(0,0),e.TgZ(1,"div",1),e._UZ(2,"h5",2),e.qZA(),e.YNc(3,je,3,3,"op-checkbox-field",3),e._UZ(4,"op-pause-reminders"),e.BQk()),2&i&&(e.Q6J("formGroup",t.formGroup.control),e.xp6(2),e.Q6J("textContent",t.text.title),e.xp6(1),e.Q6J("ngForOf",t.localeWorkdays))},directives:[s.JL,s.sg,p.sg,A,b.X,s.CE,s.Wl,s.JJ,s.u],styles:[""],changeDetection:0});class v extends M.N{constructor(i,t,o,r,a,l){super(),this.I18n=i,this.storeService=t,this.currentUserService=o,this.uiRouterGlobals=r,this.fb=a,this.cdRef=l,this.form=this.fb.group({immediateReminders:this.fb.group({mentioned:this.fb.control(!1)}),dailyReminders:this.fb.group({enabled:this.fb.control(!1),times:this.fb.array([])}),pauseReminders:this.fb.group({enabled:this.fb.control(!1),firstDay:this.fb.control(""),lastDay:this.fb.control("")}),workdays:this.fb.array([this.fb.control(!1),this.fb.control(!0),this.fb.control(!0),this.fb.control(!0),this.fb.control(!0),this.fb.control(!0),this.fb.control(!1)]),emailAlerts:this.fb.group({newsAdded:this.fb.control(!1),newsCommented:this.fb.control(!1),documentAdded:this.fb.control(!1),forumMessages:this.fb.control(!1),wikiPageAdded:this.fb.control(!1),wikiPageUpdated:this.fb.control(!1),membershipAdded:this.fb.control(!1),membershipUpdated:this.fb.control(!1)})}),this.text={title:this.I18n.t("js.reminders.settings.title"),save:this.I18n.t("js.button_save")},this.formInitialized=!1}ngOnInit(){var n,i;this.userId=this.userId||this.uiRouterGlobals.params.userId,this.currentUserService.user$.pipe((0,F.take)(1)).subscribe(i=>{this.userId=this.userId||(null==i?void 0:i.id),this.storeService.get(this.userId)}),this.storeService.query.select().pipe((0,U.h)(i=>!!i),(0,D.M)(this.storeService.query.globalNotification$),(n=this.storeService.query.selectLoading(),i=i=>!i,t=>t.pipe((0,D.M)(n),(0,U.h)(([,o])=>i(o)),(0,d.U)(([o])=>o)))).subscribe(([i,t])=>{this.buildForm(i,t)})}buildForm(i,t){var o,r,a;null===(o=this.form.get("immediateReminders.mentioned"))||void 0===o||o.setValue(i.immediateReminders.mentioned),null===(r=this.form.get("dailyReminders.enabled"))||void 0===r||r.setValue(i.dailyReminders.enabled),null===(a=this.form.get("pauseReminders"))||void 0===a||a.patchValue(i.pauseReminders);const l=this.form.get("dailyReminders.times");l.clear({emitEvent:!1}),[...i.dailyReminders.times].sort().forEach(g=>{l.push(this.fb.control(g),{emitEvent:!1})}),l.enable({emitEvent:!0});const u=this.form.get("workdays");for(let g=0;g<=6;g++)u.at(g).setValue(i.workdays.includes(g+1));Y.forEach(g=>{var h;null===(h=this.form.get(`emailAlerts.${g}`))||void 0===h||h.setValue(t[g])}),this.formInitialized=!0,this.cdRef.detectChanges()}saveChanges(){const i=this.storeService.query.getValue(),t=i.notifications.filter(h=>!h._links.project.href),o=i.notifications.filter(h=>!!h._links.project.href),r=this.form.value,a=v.buildWorkdays(r.workdays),l=v.buildPauses(r.pauseReminders),{dailyReminders:u,immediateReminders:g}=r;this.storeService.update(this.userId,Object.assign(Object.assign({},i),{workdays:a,dailyReminders:u,immediateReminders:g,pauseReminders:l,notifications:[...t.map(h=>Object.assign(Object.assign({},h),r.emailAlerts)),...o]}))}static buildWorkdays(i){return i.reduce((t,o,r)=>o?t.concat([r+1]):t,[])}static buildPauses(i){return i.enabled?i:{enabled:!1}}}v.\u0275fac=function(i){return new(i||v)(e.Y36(f.D),e.Y36(m),e.Y36($.S),e.Y36(R.UIRouterGlobals),e.Y36(s.qu),e.Y36(e.sBO))},v.\u0275cmp=e.Xpm({type:v,selectors:[["op-reminders-page"]],inputs:{userId:"userId"},features:[e.qOj],decls:3,vars:2,consts:[[1,"title-container"],[3,"textContent"],["class","op-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"op-form",3,"formGroup","ngSubmit"],[1,"op-form--fieldset"],[1,"op-form--submit"],["type","submit",1,"button","-highlight",3,"textContent"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0),e._UZ(1,"h2",1),e.qZA(),e.YNc(2,Ae,7,2,"form",2)),2&i&&(e.xp6(1),e.Q6J("textContent",t.text.title),e.xp6(1),e.Q6J("ngIf",t.formInitialized))},directives:[p.O5,s._Y,s.JL,s.sg,j,k,x,I],styles:[".form--section-title[_ngcontent-%COMP%]{text-transform:initial;border-bottom:initial;margin-bottom:initial!important}"],changeDetection:0});const Pe=[{name:"my_notifications",url:"/my/notifications",component:y},{name:"user_notifications",url:"/users/:userId/edit/notifications",component:y},{name:"my_reminders",url:"/my/reminders",component:v},{name:"user_reminders",url:"/users/:userId/edit/reminders",component:v}];class Z{}Z.\u0275fac=function(i){return new(i||Z)},Z.\u0275mod=e.oAB({type:Z}),Z.\u0275inj=e.cJS({providers:[m],imports:[[p.ez,W.H,B.C,s.u5,s.UX,z.UIRouterModule.forChild({states:Pe})]]})}}]);