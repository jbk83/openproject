"use strict";(self.webpackChunkopenproject_frontend=self.webpackChunkopenproject_frontend||[]).push([["src_app_features_boards_openproject-boards_module_ts"],{20555:(to,qt,s)=>{s.r(qt),s.d(qt,{OpenprojectBoardsModule:()=>tt});var se=s(21757),ae=s(7794),ce=s(55811),et=s(84906),A=s(3786),t=s(2316),Dt=s(86469),St=s(8403),H=s(43440),wt=s(91923),u=s(96617),Jt=s(81134),V=s(33927),de=s(18293),$=s(70233),It=s(65146),Bt=s(44022),Nt=s(79460),le=s(62964),Ut=s(55977),v=s(33276),jt=s(26269),kt=s(91593);class nt{constructor(e,n,i,r,a,c,d,l,h,g,m){this.querySpace=e,this.pathHelper=n,this.apiV3Service=i,this.urlParamsHelper=r,this.notificationService=a,this.CurrentProject=c,this.halResourceService=d,this.schemaCacheService=l,this.cdRef=h,this.I18n=g,this.wpCardDragDrop=m,this.text={placeholder:this.I18n.t("js.relations_autocomplete.placeholder")},this.getAutocompleterData=w=>{if(0===w.length)return(0,Jt.of)([]);const F=new jt.qM,U=this.querySpace.results.value;F.add("subjectOrId","**",[w]),U&&U.elements.length>0&&F.add("id","!",U.elements.map(f=>f.id));const Y=this.querySpace.query.value;if(null==Y?void 0:Y.filters){const f=this.urlParamsHelper.buildV3GetFilters(Y.filters);F.merge(f,"subprojectId")}return this.apiV3Service.withOptionalProject(this.CurrentProject.id).work_packages.filtered(F).get().pipe((0,V.U)(f=>f.elements),(0,de.K)(f=>(this.notificationService.handleRawError(f),(0,Jt.of)([]))))},this.autocompleterOptions={resource:"work_packages",getOptionsFn:this.getAutocompleterData},this.appendToContainer="body",this.onCancel=new t.vpe,this.onReferenced=new t.vpe}ngAfterViewInit(){!this.ngSelectComponent.ngSelectInstance||(this.ngSelectComponent.openSelect(),this.ngSelectComponent.focusSelect(),this.wpCardDragDrop.removeReferenceWorkPackageForm())}cancel(){this.onCancel.emit()}addWorkPackageToQuery(e){e&&this.schemaCacheService.ensureLoaded(e).then(()=>{this.onReferenced.emit(e),this.ngSelectComponent.closeSelect()})}}nt.\u0275fac=function(e){return new(e||nt)(t.Y36(H.q),t.Y36($.j),t.Y36(v.T),t.Y36(Ut.Z),t.Y36(le.q),t.Y36(It.R),t.Y36(wt.u),t.Y36(Bt.y),t.Y36(t.sBO),t.Y36(u.D),t.Y36(Nt.q))},nt.\u0275cmp=t.Xpm({type:nt,selectors:[["board-inline-add-autocompleter"]],viewQuery:function(e,n){if(1&e&&t.Gf(kt.s,5),2&e){let i;t.iGM(i=t.CRH())&&(n.ngSelectComponent=i.first)}},inputs:{appendToContainer:"appendToContainer"},outputs:{onCancel:"onCancel",onReferenced:"onReferenced"},decls:1,vars:5,consts:[["classes","wp-inline-create--reference-autocompleter",3,"appendTo","closeOnSelect","placeholder","resource","getOptionsFn","close","change"]],template:function(e,n){1&e&&(t.TgZ(0,"op-autocompleter",0),t.NdJ("close",function(){return n.cancel()})("change",function(r){return n.addWorkPackageToQuery(r)}),t.qZA()),2&e&&t.Q6J("appendTo",n.appendToContainer)("closeOnSelect",!1)("placeholder",n.text.placeholder)("resource",n.autocompleterOptions.resource)("getOptionsFn",n.autocompleterOptions.getOptionsFn)},directives:[kt.s],styles:["ng-select.wp-inline-create--reference-autocompleter{border:none}ng-select.wp-inline-create--reference-autocompleter .ng-clear-wrapper{display:none}\n"],encapsulation:2});class z extends St.m{constructor(e,n,i){super(e),this.injector=e,this.querySpace=n,this.halResourceService=i,this.referenceComponentClass=nt,this.referenceTarget=null,this.buttonTexts={reference:this.I18n.t("js.relation_buttons.add_existing_child"),create:this.I18n.t("js.relation_buttons.add_new_child")}}get canAdd(){return this.currentUser.hasCapabilities$(["work_packages/create"],this.currentProject.id||"global")}get canReference(){return this.currentUser.hasCapabilities$(["work_packages/update"],this.currentProject.id||"global")}}z.\u0275fac=function(e){return new(e||z)(t.LFG(t.zs3),t.LFG(H.q),t.LFG(wt.u))},z.\u0275prov=t.Yz7({token:z,factory:z.\u0275fac});var pe=s(49369),ot=s(36293),At=s(7493),Ht=s(50076),Vt=s(91488),Ft=s(74478),T=s(3216),he=s(12703),it=s(67727),rt=s(84308),ue=s(64538),Z=s(77355),p=s(54364),ge=s(11269);function me(o,e){if(1&o&&(t.ynx(0,1),t._UZ(1,"icon-triggered-context-menu",2),t.BQk()),2&o){const n=t.oxw();t.xp6(1),t.Q6J("menu-items",n.menuItems)}}class E{constructor(e,n,i,r,a,c){this.opModalService=e,this.authorisationService=n,this.querySpace=i,this.boardService=r,this.boardActionRegistry=a,this.I18n=c,this.onRemove=new t.vpe}get menuItems(){return()=>(0,A.mG)(this,void 0,void 0,function*(){const e=[{disabled:!this.canDelete,linkText:this.I18n.t("js.boards.lists.delete"),onClick:()=>(this.onRemove.emit(),!0)}];if(this.board.isAction){const n=yield this.actionService.getAdditionalListMenuItems(this.query);return e.concat(n)}return e})}get actionService(){return this.boardActionRegistry.get(this.board.actionAttribute)}get canManage(){return this.boardService.canManage(this.board)}canDelete(){return this.canManage&&!!this.query.delete}get query(){return this.querySpace.query.value}}E.\u0275fac=function(e){return new(e||E)(t.Y36(Z.S),t.Y36(At.g),t.Y36(H.q),t.Y36(T.$),t.Y36(rt.X),t.Y36(u.D))},E.\u0275cmp=t.Xpm({type:E,selectors:[["board-list-menu"]],inputs:{board:"board"},outputs:{onRemove:"onRemove"},decls:1,vars:1,consts:[["class","board-list--more-menu",4,"ngIf"],[1,"board-list--more-menu"],[3,"menu-items"]],template:function(e,n){1&e&&t.YNc(0,me,2,1,"ng-container",0),2&e&&t.Q6J("ngIf",n.canDelete())},directives:[p.O5,ge.I],encapsulation:2});var be=s(3352),$t=s(14808);class I{constructor(){this.filters=(0,$t.qH)([])}get current(){return this.filters.getValueOr([])}}I.\u0275fac=function(e){return new(e||I)},I.\u0275prov=t.Yz7({token:I,factory:I.\u0275fac});var C=s(47775),fe=s(48451),ve=s(60914),Tt=s(79441),x=s(9170);class M{constructor(){this.selections$=new Tt.xQ}updateSelection(e){this.selections$.next(e)}selectionsForQuery(e){return this.selections$.pipe((0,x.h)(n=>n.withinQuery!==e))}selections(){return this.selections$}}M.\u0275fac=function(e){return new(e||M)},M.\u0275prov=t.Yz7({token:M,factory:M.\u0275fac});var W=s(53466),Yt=s(80639),_e=s(84109),Ce=s(1403);const xe=["loadingIndicator"];function ye(o,e){if(1&o&&t._UZ(0,"div",13),2&o){const n=t.oxw(2);t.Q6J("ngClass",n.actionResourceClass)}}const Se=function(o){return{resource:o}};function we(o,e){if(1&o&&t._UZ(0,"ndc-dynamic",14),2&o){const n=t.oxw(2);t.Q6J("ndcDynamicComponent",n.headerComponent)("ndcDynamicInputs",t.VKq(2,Se,n.actionResource))}}function Ie(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"editable-toolbar-title",15),t.NdJ("onSave",function(r){t.CHM(n);const a=t.oxw(2);return a.renameQuery(a.query,r)}),t.qZA()}if(2&o){const n=t.oxw(2);t.Q6J("title",n.query.name)("smallHeader",!0)("inFlight",n.inFlight)("editable",n.canRename)("initialFocus",n.initiallyFocused)}}function ke(o,e){if(1&o&&(t.TgZ(0,"button",16),t._UZ(1,"op-icon",17),t.qZA()),2&o){const n=t.oxw(2);t.Q6J("title",n.text.addCard)}}const Ae=function(o){return{"-with-create-button":o}};function Te(o,e){if(1&o){const n=t.EpF();t.ynx(0),t.YNc(1,ye,1,1,"div",4),t.TgZ(2,"div",5),t.YNc(3,we,1,4,"ndc-dynamic",6),t.YNc(4,Ie,1,5,"editable-toolbar-title",7),t.TgZ(5,"board-list-menu",8),t.NdJ("onRemove",function(){return t.CHM(n),t.oxw().deleteList()}),t.qZA(),t.qZA(),t.TgZ(6,"div",9),t.TgZ(7,"div",10),t.YNc(8,ke,2,1,"button",11),t.qZA(),t.TgZ(9,"wp-card-view",12),t.NdJ("itemClicked",function(r){return t.CHM(n),t.oxw().openFullViewOnDoubleClick(r)})("stateLinkClicked",function(r){return t.CHM(n),t.oxw().openStateLink(r)}),t.qZA(),t.qZA(),t.BQk()}if(2&o){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.board.isAction),t.xp6(2),t.Q6J("ngIf",n.headerComponent),t.xp6(1),t.Q6J("ngIf",!n.headerComponent),t.xp6(1),t.Q6J("board",n.board),t.xp6(1),t.Q6J("ngClass",t.VKq(13,Ae,n.board.isAction||n.showAddButton)),t.xp6(2),t.Q6J("ngIf",n.showAddButton),t.xp6(1),t.Q6J("dragOutOfHandler",n.canDragOutOfHandler)("dragInto",n.canDragInto)("workPackageAddedHandler",n.workPackageAddedHandler)("cardsRemovable",n.board.isFree&&n.canDragOutOf)("showInfoButton",!0)("highlightingMode",n.board.highlightingMode)("showStatusButton",n.showCardStatusButton())}}function Ze(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",18),t.TgZ(1,"p"),t._UZ(2,"span",19),t._uU(3," "),t.TgZ(4,"buton",20),t.NdJ("click",function(){return t.CHM(n),t.oxw().onRemove.emit()}),t._UZ(5,"span",19),t.qZA(),t.qZA(),t.qZA()}if(2&o){const n=t.oxw();t.xp6(2),t.Q6J("textContent",n.errorMessage),t.xp6(3),t.Q6J("textContent",n.text.click_to_remove)}}const Me=function(o){return{"-action-list":o}};class P extends pe._{constructor(e,n,i,r,a,c,d,l,h,g,m,w,F,U,Y,f,Ot,re,Rt,zn,En,Wn,Gn,Xn,Kn){super(n,Ot),this.apiv3Service=e,this.I18n=n,this.state=i,this.cdRef=r,this.transitions=a,this.boardFilters=c,this.toastService=d,this.querySpace=l,this.halNotification=h,this.halEvents=g,this.wpStatesInitialization=m,this.wpViewFocusService=w,this.wpViewSelectionService=F,this.boardListCrossSelectionService=U,this.authorisationService=Y,this.wpInlineCreate=f,this.injector=Ot,this.halEditing=re,this.loadingIndicator=Rt,this.schemaCache=zn,this.boardService=En,this.boardActionRegistry=Wn,this.causedUpdates=Gn,this.keepTab=Xn,this.$state=Kn,this.onRemove=new t.vpe,this.visibilityChange=new t.vpe,this.actionResourceClass="",this.showAddButton=!1,this.canAdd=this.wpInlineCreate.canAdd.pipe((0,W.q)(1)).toPromise(),this.text={addCard:this.I18n.t("js.boards.add_card"),updateSuccessful:this.I18n.t("js.notice_successful_update"),areYouSure:this.I18n.t("js.text_are_you_sure"),unnamed_list:this.I18n.t("js.boards.label_unnamed_list"),click_to_remove:this.I18n.t("js.boards.click_to_remove_list")},this.canDragInto=!1,this.initiallyFocused=!1,this.workPackageAddedHandler=Qt=>this.addWorkPackage(Qt),this.canDragOutOf=!1,this.canDragOutOfHandler=Qt=>this.canMove(Qt)}ngOnInit(){if(this.initiallyFocused=this.resource.isNewWidget,this.resource.isNewWidget=!1,this.state.includes(`${this.state.current.data.baseRoute}.details`)){const e=this.state.params.workPackageId;this.wpViewSelectionService.initializeSelection([e])}this.wpViewSelectionService.updates$().pipe((0,Yt.b)(100),this.untilDestroyed()).subscribe(e=>{const n=Object.keys(_.pickBy(e.selected,(r,a)=>!0===r)),i=this.wpViewFocusService.focusedWorkPackage;this.boardListCrossSelectionService.updateSelection({withinQuery:this.queryId,focusedWorkPackage:i,allSelected:n})}),this.boardListCrossSelectionService.selectionsForQuery(this.queryId).pipe(this.untilDestroyed()).subscribe(e=>{this.wpViewSelectionService.initializeSelection(e.allSelected)}),this.boardFilters.filters.values$().pipe(this.untilDestroyed()).subscribe(()=>this.updateQuery(!0)),this.listenToActionAttributeChanges(),this.querySpace.query.values$().pipe(this.untilDestroyed()).subscribe(e=>(0,A.mG)(this,void 0,void 0,function*(){this.query=e,this.canDragOutOf=!!this.query.updateOrderedWorkPackages,yield this.loadActionAttribute(e),this.cdRef.detectChanges()}))}ngOnDestroy(){super.ngOnDestroy()}get errorMessage(){return this.I18n.t("js.boards.error_loading_the_list",{error_message:this.loadingError})}canMove(e){return this.canDragOutOf&&(!this.actionService||this.actionService.canMove(e))}get canManage(){return this.boardService.canManage(this.board)}get canRename(){return this.canManage&&!!this.query.updateImmediately&&this.board.isFree}addReferenceCard(){this.cardView.setReferenceMode(!0)}addNewCard(){this.cardView.addNewCard()}deleteList(e){e=e||this.query,window.confirm(this.text.areYouSure)&&this.apiv3Service.queries.id(e).delete().subscribe(()=>this.onRemove.emit())}renameQuery(e,n){this.inFlight=!0,this.query.name=n,this.apiv3Service.queries.id(this.query).patch({name:n}).subscribe(()=>{this.inFlight=!1,this.toastService.addSuccess(this.text.updateSuccessful)},i=>this.inFlight=!1)}boardListActionColorClass(e){const n=this.board.actionAttribute;return e&&e.id?Ht.Z.backgroundClass(n,e.id):""}get listName(){return this.query&&this.query.name}showCardStatusButton(){return this.board.showStatusButton()}refreshQueryUnlessCaused(e,n=!0){this.causedUpdates.includes(e)||((0,be.qu)(`Refreshing ${e.name} visibly due to external changes`),this.updateQuery(n))}updateQuery(e=!0){this.setQueryProps(this.boardFilters.current),this.loadQuery(e)}loadActionAttribute(e){return(0,A.mG)(this,void 0,void 0,function*(){if(!this.board.isAction){this.actionResource=void 0,this.headerComponent=void 0,this.canDragInto=!!e.updateOrderedWorkPackages;const r=yield this.canAdd;return void(this.showAddButton=this.canDragInto&&r)}const n=this.actionService,i=n.getActionValueId(e);if(!this.actionResource||i!==this.actionResource.href)return n.getLoadedActionValue(e).then(r=>(0,A.mG)(this,void 0,void 0,function*(){this.actionResource=r,this.headerComponent=n.headerComponent(),this.buttonPlaceholder=n.disabledAddButtonPlaceholder(r),this.actionResourceClass=this.boardListActionColorClass(r),this.canDragInto=n.dragIntoAllowed(e,r);const a=yield n.canAddToQuery(e),c=yield this.canAdd;this.showAddButton=this.canDragInto&&c&&a,this.cdRef.detectChanges()}))})}get actionService(){if(this.board.actionAttribute)return this.boardActionRegistry.get(this.board.actionAttribute)}addWorkPackage(e){var n;const i=this.querySpace.query.value,r=this.halEditing.changeFor(e);return null===(n=this.actionService)||void 0===n||n.assignToWorkPackage(r,i),r.isEmpty()?this.apiv3Service.work_packages.cache.updateWorkPackage(e):this.halEditing.save(r)}get queryId(){return this.resource.options.queryId.toString()}loadQuery(e=!0){let n=this.apiv3Service.queries.find(this.columnsQueryProps,this.queryId);e&&(n=n.pipe((0,Dt.xc)(this.indicatorInstance,50))),n.subscribe(i=>{this.wpStatesInitialization.updateQuerySpace(i,i.results)},i=>{"urn:openproject-org:api:v3:errors:InvalidQuery"===i.errorIdentifier&&this.visibilityChange.emit(!1),this.loadingError=this.halNotification.retrieveErrorMessage(i),this.cdRef.detectChanges()})}get indicatorInstance(){return this.loadingIndicator.indicator(jQuery(this.indicator.nativeElement))}setQueryProps(e){const i=(this.resource.options.filters||[]).concat(e),r={"columns[]":["id","subject"],showHierarchies:!1,pageSize:500,filters:JSON.stringify(i)};this.columnsQueryProps=r}listenToActionAttributeChanges(){!this.board.actionAttribute||this.halEvents.events$.pipe((0,x.h)(e=>"WorkPackage"===e.resourceType),(0,x.h)(e=>"updated"===e.eventType),(0,V.U)(e=>{var n;return null===(n=e.commit)||void 0===n?void 0:n.changes[this.actionService.filterName]}),(0,x.h)(e=>!!e),(0,x.h)(e=>{var n,i,r;const a=null===(n=this.actionResource)||void 0===n?void 0:n.href,c=null===(i=e.to)||void 0===i?void 0:i.href,d=null===(r=e.from)||void 0===r?void 0:r.href;return!!a&&(a===c||a===d)})).subscribe(()=>{this.updateQuery(!0)})}openFullViewOnDoubleClick(e){e.double&&this.state.go("work-packages.show",{workPackageId:e.workPackageId})}openStateLink(e){const n={workPackageId:e.workPackageId};"split"===e.requestedState?this.keepTab.goCurrentDetailsState(n):this.keepTab.goCurrentShowState(n)}schema(e){return this.schemaCache.of(e)}}P.\u0275fac=function(e){return new(e||P)(t.Y36(v.T),t.Y36(u.D),t.Y36(C.StateService),t.Y36(t.sBO),t.Y36(C.TransitionService),t.Y36(I),t.Y36(ot.kl),t.Y36(H.q),t.Y36(it.W),t.Y36(Ce.J),t.Y36(Ft.f),t.Y36(fe.o),t.Y36(ve.J),t.Y36(M),t.Y36(At.g),t.Y36(St.m),t.Y36(t.zs3),t.Y36(he.l),t.Y36(Dt.vt),t.Y36(Bt.y),t.Y36(T.$),t.Y36(rt.X),t.Y36(ue.h),t.Y36(_e.p),t.Y36(C.StateService))},P.\u0275cmp=t.Xpm({type:P,selectors:[["board-list"]],viewQuery:function(e,n){if(1&e&&(t.Gf(xe,7),t.Gf(Vt.x,5)),2&e){let i;t.iGM(i=t.CRH())&&(n.indicator=i.first),t.iGM(i=t.CRH())&&(n.cardView=i.first)}},inputs:{board:"board"},outputs:{onRemove:"onRemove",visibilityChange:"visibilityChange"},features:[t._Bn([{provide:St.m,useClass:z},E,Nt.q]),t.qOj],decls:4,vars:6,consts:[["data-qa-selector","op-board-list",1,"op-board-list","loading-indicator--location",3,"ngClass"],["loadingIndicator",""],[4,"ngIf"],["class","op-board-list--toaster-box -error",4,"ngIf"],["class","op-board-list--action-bar",3,"ngClass",4,"ngIf"],["data-qa-selector","op-board-list--header",1,"op-board-list--header"],[3,"ndcDynamicComponent","ndcDynamicInputs",4,"ngIf"],["class","-small",3,"title","smallHeader","inFlight","editable","initialFocus","onSave",4,"ngIf"],["data-qa-selector","op-board-list--menu",1,"op-board-list--menu",3,"board","onRemove"],[1,"op-board-list--query-container","drop-zone",3,"ngClass"],[1,"op-board-list--button-container"],["data-qa-selector","op-board-list--card-dropdown-add-button","class","op-board-list--add-button op-board-list--card-dropdown-button button","op-addCardDropdown","",3,"title",4,"ngIf"],[3,"dragOutOfHandler","dragInto","workPackageAddedHandler","cardsRemovable","showInfoButton","highlightingMode","showStatusButton","itemClicked","stateLinkClicked"],[1,"op-board-list--action-bar",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs"],[1,"-small",3,"title","smallHeader","inFlight","editable","initialFocus","onSave"],["data-qa-selector","op-board-list--card-dropdown-add-button","op-addCardDropdown","",1,"op-board-list--add-button","op-board-list--card-dropdown-button","button",3,"title"],["icon-classes","icon-small icon-add"],[1,"op-board-list--toaster-box","-error"],[3,"textContent"],["type","button",1,"spot-link",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0,1),t.YNc(2,Te,10,15,"ng-container",2),t.YNc(3,Ze,6,2,"div",3),t.qZA()),2&e&&(t.Q6J("ngClass",t.VKq(4,Me,n.board.isAction)),t.uIk("data-query-name",n.listName),t.xp6(2),t.Q6J("ngIf",n.query),t.xp6(1),t.Q6J("ngIf",n.loadingError))},styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-board-list[_ngcontent-%COMP%]{height:100%;max-width:300px;display:flex;flex-direction:column}.op-board-list[_ngcontent-%COMP%]:hover   .op-board-list--menu[_ngcontent-%COMP%]{visibility:visible}.op-board-list--action-bar[_ngcontent-%COMP%]{width:calc(100% - 30px);height:5px;margin:auto}.op-board-list--header[_ngcontent-%COMP%]{padding:5px 15px;display:flex;align-items:center;max-height:52px}.op-board-list--header[_ngcontent-%COMP%]   editable-toolbar-title[_ngcontent-%COMP%]{flex:1;margin-bottom:0;margin-right:.25rem}.op-board-list--toaster-box[_ngcontent-%COMP%]{margin-top:0;z-index:100}.op-board-list--add-button[_ngcontent-%COMP%]{background-color:var(--body-background);width:calc(100% - 30px - 10px);margin:0 15px;box-shadow:1px 1px 3px #d3d3d3}.op-board-list--add-button[_ngcontent-%COMP%]:hover{background-color:#eeeeee50}.op-board-list--add-button[_ngcontent-%COMP%]:disabled{background-color:#cccccc50}.op-board-list--menu[_ngcontent-%COMP%]{visibility:hidden}.op-board-list--query-container[_ngcontent-%COMP%]{max-width:inherit;overflow:hidden;height:100%}.op-board-list--query-container.-with-create-button[_ngcontent-%COMP%]{display:grid;grid-template:34px minmax(0,1fr)/1fr}.op-board-list--button-container[_ngcontent-%COMP%]{background-color:var(--body-background);position:sticky;top:0px;z-index:1}"],changeDetection:0});var zt=s(55548),Et=s(20342);class st extends zt.n{constructor(e,n,i,r,a,c,d,l,h,g){super(e,n),this.elementRef=e,this.opContextMenu=n,this.opModalService=i,this.authorisationService=r,this.wpInlineCreate=a,this.boardList=c,this.injector=d,this.querySpace=l,this.cdRef=h,this.I18n=g}open(e){this.items=this.buildItems(),this.opContextMenu.show(this,e)}positionArgs(e){const i=super.positionArgs(e);return _.assign(i,{my:"left top",at:"left bottom"}),i}buildItems(){return[{disabled:!this.wpInlineCreate.canAdd,linkText:this.I18n.t("js.card.add_new"),onClick:()=>(this.boardList.addNewCard(),!0)},{disabled:!this.wpInlineCreate.canReference,linkText:this.I18n.t("js.relation_buttons.add_existing"),onClick:()=>(this.boardList.addReferenceCard(),!0)}]}}st.\u0275fac=function(e){return new(e||st)(t.Y36(t.SBq),t.Y36(Et.$),t.Y36(Z.S),t.Y36(At.g),t.Y36(St.m),t.Y36(P),t.Y36(t.zs3),t.Y36(H.q),t.Y36(t.sBO),t.Y36(u.D))},st.\u0275dir=t.lG2({type:st,selectors:[["","op-addCardDropdown",""]],features:[t.qOj]});var L=s(80395),Pe=s(76491),Oe=s(82516),R=s(22663);class De{constructor(e,n){this.container=e,this.scrollCallback=n,this.margin=30,this.maxSpeed=25,this.point={x:0,y:0},this.boundaryRect=this.container.getBoundingClientRect()}onMove(e){this.point=e,cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(()=>this.scrollTick())}scrollTick(){cancelAnimationFrame(this.animationFrame),this.autoScroll()&&(this.animationFrame=requestAnimationFrame(()=>this.scrollTick()))}autoScroll(){let e,n;return e=this.point.x<this.boundaryRect.left+this.margin?Math.floor(Math.max(-1,(this.point.x-this.boundaryRect.left)/this.margin-1)*this.maxSpeed):this.point.x>this.boundaryRect.right-this.margin?Math.ceil(Math.min(1,(this.point.x-this.boundaryRect.right)/this.margin+1)*this.maxSpeed):0,n=this.point.y<this.boundaryRect.top+this.margin?Math.floor(Math.max(-1,(this.point.y-this.boundaryRect.top)/this.margin-1)*this.maxSpeed):this.point.y>this.boundaryRect.bottom-this.margin?Math.ceil(Math.min(1,(this.point.y-this.boundaryRect.bottom)/this.margin+1)*this.maxSpeed):0,setTimeout(()=>{n&&this.scrollY(n),e&&this.scrollX(e)}),e||n}scrollY(e){this.container.scrollTop+=e,this.scrollCallback&&this.scrollCallback({x:0,y:e})}scrollX(e){this.container.scrollLeft+=e,this.scrollCallback&&this.scrollCallback({x:e,y:0})}destroy(){cancelAnimationFrame(this.animationFrame)}}class b{constructor(){this.debugInfo=new Pe.X(null),this.enabled=!1}log(e){this.debugInfo.next(e)}reset(){this.debugInfo.next(null)}}b.\u0275fac=function(e){return new(e||b)},b.\u0275prov=t.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b.ctorParameters=()=>[],b.ngInjectableDef=(0,t.Yz7)({factory:function(){return new b},token:b,providedIn:"root"});class Q{constructor(e,n,i,r){this.cdkDrag=e,this.dragDebugService=n,this.zone=i,this.changeDetectorRef=r,this.destroy$=new Tt.xQ,this.stopDragging$=new Tt.xQ,this.lastScroll={top:0,left:0},this.dragRef=this.cdkDrag._dragRef,this.dragRef?this.zone.runOutsideAngular(()=>{this.dragRef.started.pipe((0,R.R)(this.destroy$)).subscribe(a=>{this.log("Started",a,this.dragRef.isDragging()),this.started()}),this.dragRef.ended.pipe((0,R.R)(this.destroy$)).subscribe(a=>{this.log("Ended",a),this.ended()}),this.dragRef.entered.pipe((0,R.R)(this.destroy$)).subscribe(a=>{this.log("Entered",a),this.entered()}),this.dragRef.exited.pipe((0,R.R)(this.destroy$)).subscribe(a=>{this.log("Exited",a),this.exited()})}):this.log("CdkDrag not found",this.cdkDrag,this.dragRef)}ngOnChanges(e){e.dragConnectedIds&&this.dragRef.isDragging()&&setTimeout(()=>{this.syncSiblings()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.stopDragging$.next(),this.stopDragging$.complete(),this.destroyAutoScroll()}started(){!this.scrollContainer||(this.destroyAutoScroll(),this.addDebugInfo(),this.autoScroll=new De(this.scrollContainer),this.lastScroll.top=this.scrollContainer.scrollTop,this.lastScroll.left=this.scrollContainer.scrollLeft,(0,Oe.R)(this.scrollContainer,"scroll").pipe((0,R.R)(this.stopDragging$)).subscribe(()=>{const e=this.scrollContainer.scrollLeft-this.lastScroll.left,n=this.scrollContainer.scrollTop-this.lastScroll.top;(e||n)&&this.handleScroll(e,n),this.lastScroll.top=this.scrollContainer.scrollTop,this.lastScroll.left=this.scrollContainer.scrollLeft}),this.dragRef.moved.pipe((0,Yt.b)(10),(0,R.R)(this.stopDragging$)).subscribe(e=>{this.autoScroll.onMove(e.pointerPosition)}))}ended(){this.destroyAutoScroll(),this.stopDragging$.next(),this.dragDebugService.reset()}entered(){this.dragFixContainer()}exited(){this.dragFixContainer()}handleScroll(e,n){const i=this.getDropListRef();this.adjustContainers(),this.adjustItems(e,n),i._draggables.length>i._itemPositions.length&&this.syncItems(),this.addDebugInfo()}destroyAutoScroll(){this.autoScroll&&(this.autoScroll.destroy(),this.autoScroll=null)}getDropListRef(){return this.dragRef._dropContainer}addDebugInfo(){if(!this.dragDebugService.enabled)return;const e=this.getDropListRef(),n=[...e._itemPositions.map(i=>({clientRect:i.clientRect,color:"blue",id:i.drag.data.data.name})),...e._siblings.map(i=>({clientRect:i._clientRect,color:"green",id:""})),{clientRect:e._clientRect,color:"#2FD1BB",id:""}];this.dragDebugService.log(n.filter(i=>i.clientRect))}dragFixContainer(){setTimeout(()=>{this.getDropListRef()._cacheOwnPosition(),this.addDebugInfo()}),this.changeDetectorRef.markForCheck()}syncSiblings(){const e=this.getDropListRef();this.log("syncSiblings before",e._siblings.length),e.beforeStarted.next(),this.log("syncSiblings after",e._siblings.length),this.adjustContainers()}syncItems(){const e=this.getDropListRef(),n=e._itemPositions;e._activeDraggables=e._draggables.slice(),e._cacheItemPositions();const i=e._itemPositions;e._itemPositions=[...n],i.forEach(r=>{n.find(a=>r.drag===a.drag)||e._itemPositions.push(r)}),e._activeDraggables.push(this.dragRef)}adjustContainers(){const e=this.getDropListRef();e._cacheOwnPosition(),e._siblings.forEach(n=>{n._cacheOwnPosition()})}adjustItems(e,n){this.getDropListRef()._itemPositions.forEach(r=>{r.originalRect=r.originalRect||r.clientRect,r.clientRect=Object.assign({},r.clientRect,{left:r.clientRect.left-e,right:r.clientRect.right-e,top:r.clientRect.top-n,bottom:r.clientRect.bottom-n})})}log(e,...n){this.dragDebugService.enabled&&console.log(e,n)}}Q.\u0275fac=function(e){return new(e||Q)(t.Y36(L.Zt),t.Y36(b),t.Y36(t.R0b),t.Y36(t.sBO))},Q.\u0275dir=t.lG2({type:Q,selectors:[["","vsDragScroll",""]],inputs:{dragConnectedIds:["vsDragScrollConnectedTo","dragConnectedIds"],scrollContainer:["vsDragScrollContainer","scrollContainer"]},exportAs:["vsDragScroll"],features:[t.TTD]}),Q.ctorParameters=()=>[{type:L.Zt},{type:b},{type:t.R0b},{type:t.sBO}],Q.propDecorators={dragConnectedIds:[{type:t.IIB,args:["vsDragScrollConnectedTo"]}],scrollContainer:[{type:t.IIB,args:["vsDragScrollContainer"]}]};class G{}G.\u0275fac=function(e){return new(e||G)},G.\u0275mod=t.oAB({type:G}),G.\u0275inj=t.cJS({imports:[[L._t]]});var Be=s(92814);const je=function(o,e){return{"-closed":o,"-locked":e}};function Fe(o,e){if(1&o&&(t.TgZ(0,"div",1),t.TgZ(1,"h2",2),t._UZ(2,"small",3),t._UZ(3,"br"),t._UZ(4,"a",4),t.qZA(),t.TgZ(5,"span",5),t._uU(6),t.qZA(),t.qZA()),2&o){const n=t.oxw();t.Q6J("ngClass",t.WLB(5,je,n.version.isClosed(),n.version.isLocked())),t.xp6(2),t.Q6J("textContent",n.text.version),t.xp6(2),t.Q6J("href",n.pathHelper.versionShowPath(n.version.id),t.LSH)("textContent",n.version.name),t.xp6(2),t.hij(" ",n.version.endDate," ")}}class X{constructor(e,n){this.I18n=e,this.pathHelper=n,this.text={isLocked:this.I18n.t("js.boards.version.is_locked"),isClosed:this.I18n.t("js.boards.version.is_closed"),version:this.I18n.t("js.work_packages.properties.version")}}}X.\u0275fac=function(e){return new(e||X)(t.Y36(u.D),t.Y36($.j))},X.\u0275cmp=t.Xpm({type:X,selectors:[["ng-component"]],hostAttrs:[1,"title-container","-small"],inputs:{version:["resource","version"]},decls:1,vars:1,consts:[["class","op-version-board-header","data-qa-selector","op-version-board-header",3,"ngClass",4,"ngIf"],["data-qa-selector","op-version-board-header",1,"op-version-board-header",3,"ngClass"],[1,"editable-toolbar-title--fixed"],[3,"textContent"],["target","_blank",3,"href","textContent"],[1,"op-version-board-header--info-row","-italic","-small-font"]],template:function(e,n){1&e&&t.YNc(0,Fe,7,8,"div",0),2&e&&t.Q6J("ngIf",n.version)},directives:[p.O5,p.mk],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-version-board-header[_ngcontent-%COMP%]{display:flex;flex-direction:column}.op-version-board-header[_ngcontent-%COMP%]   .editable-toolbar-title--fixed[_ngcontent-%COMP%]{line-height:1!important}"]});var at=s(32853),k=s(1707);class ct{constructor(e,n,i){this.injector=e,this.locals=n,this.I18n=i,this.highlightingMode="none",this.entireCardMode=!1,this.lastEntireCardAttribute="type",this.text={highlighting_mode:{description:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.description"),none:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.none"),type:this.I18n.t("js.work_packages.properties.type"),priority:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.priority"),entire_card_by:this.I18n.t("js.card.highlighting.entire_card_by")}}}onSave(){this.updateMode(this.highlightingMode),this.board.highlightingMode=this.highlightingMode}ngOnInit(){this.board=this.locals.board,this.highlightingMode=this.board.highlightingMode,this.updateMode(this.highlightingMode)}updateMode(e){this.highlightingMode="inline"===e?this.lastEntireCardAttribute:e,-1!==["priority","type"].indexOf(this.highlightingMode)?(this.lastEntireCardAttribute=this.highlightingMode,this.entireCardMode=!0):this.entireCardMode=!1}}ct.\u0275fac=function(e){return new(e||ct)(t.Y36(t.zs3),t.Y36(Z.E),t.Y36(u.D))},ct.\u0275cmp=t.Xpm({type:ct,selectors:[["ng-component"]],decls:17,vars:10,consts:[[3,"textContent"],[1,"form--field","-full-width"],[1,"form--field-container"],[1,"option-label"],["type","radio","name","entire_card_switch",3,"ngModel","value","ngModelChange","change"],["id","selected_attribute","name","selected_attribute",1,"form--select","form--inline-select",3,"change"],["value","type",3,"textContent","selected"],["value","priority",3,"textContent","selected"],["type","radio","value","none","name","highlighting_mode_switch",3,"ngModel","ngModelChange","change"]],template:function(e,n){1&e&&(t.TgZ(0,"div"),t.TgZ(1,"form"),t._UZ(2,"p",0),t.TgZ(3,"div",1),t.TgZ(4,"div",2),t.TgZ(5,"label",3),t.TgZ(6,"input",4),t.NdJ("ngModelChange",function(r){return n.entireCardMode=r})("change",function(){return n.updateMode("inline")}),t.qZA(),t._UZ(7,"span",0),t._uU(8," "),t.TgZ(9,"select",5),t.NdJ("change",function(r){return n.updateMode(r.target.value)}),t._UZ(10,"option",6),t._UZ(11,"option",7),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"div",1),t.TgZ(13,"div",2),t.TgZ(14,"label",3),t.TgZ(15,"input",8),t.NdJ("ngModelChange",function(r){return n.highlightingMode=r})("change",function(r){return n.updateMode(r.target.value)}),t.qZA(),t._UZ(16,"span",0),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("textContent",n.text.highlighting_mode.description),t.xp6(4),t.Q6J("ngModel",n.entireCardMode)("value",!0),t.xp6(1),t.Q6J("textContent",n.text.highlighting_mode.entire_card_by),t.xp6(3),t.Q6J("textContent",n.text.highlighting_mode.type)("selected","type"===n.lastEntireCardAttribute),t.xp6(1),t.Q6J("textContent",n.text.highlighting_mode.priority)("selected","priority"===n.lastEntireCardAttribute),t.xp6(4),t.Q6J("ngModel",n.highlightingMode),t.xp6(1),t.Q6J("textContent",n.text.highlighting_mode.none))},directives:[k._Y,k.JL,k.F,k._,k.Fj,k.JJ,k.On,k.YN,k.Kr],encapsulation:2});class q{constructor(e){this.I18n=e,this._tabs=[{id:"highlighting",name:this.I18n.t("js.work_packages.table_configuration.highlighting"),componentClass:ct}]}get tabs(){return this._tabs}}q.\u0275fac=function(e){return new(e||q)(t.LFG(u.D))},q.\u0275prov=t.Yz7({token:q,factory:q.\u0275fac});var Ye=s(66220),Wt=s(24335),Le=s(97979),Re=s(80044),Zt=s(10190);class J{constructor(e,n,i,r,a,c,d,l){this.injector=e,this.boardListsService=n,this.I18n=i,this.halResourceService=r,this.pathHelper=a,this.currentProject=c,this.apiV3Service=d,this.schemaCache=l}getActionFilter(e,n=!1){return e.filters.find(i=>i.id===this.filterName)}getActionValueId(e,n=!1){const i=this.getActionFilter(e);if(!i)return;const r=i.values[0];return r instanceof Re.X?n?r.href:r.id:r}getLoadedActionValue(e){const n=this.getActionValueId(e);return n?this.require(n):Promise.resolve(void 0)}addInitialColumnsForAction(e){return Promise.resolve(e)}addColumnWithActionAttribute(e,n){const i={name:n.name},r={[this.filterName]:{operator:"=",values:[(0,Zt.Z)(n.href)]}};return this.boardListsService.addQuery(e,i,[r])}loadAvailable(e,n){return this.loadValues(n).pipe((0,V.U)(i=>i.filter(r=>!e.has(r.id))))}getAdditionalListMenuItems(e){return Promise.resolve([])}autocompleterComponent(){return Ye.c}headerComponent(){}disabledAddButtonPlaceholder(e){}warningTextWhenNoOptionsAvailable(e){return Promise.resolve(void 0)}dragIntoAllowed(e,n){return!0}canAddToQuery(e){return Promise.resolve(!0)}canMove(e){const i=this.schemaCache.of(e)[this.filterName];return null==i?void 0:i.writable}assignToWorkPackage(e,n){if(!e.isWritable(this.filterName))throw new Error(this.I18n.t("js.boards.error_attribute_not_writable",{attribute:e.humanName(this.filterName)}));new Le.R(this.injector,n.filters).applyDefaultsFromFilters(e)}}J.\u0275fac=function(e){return new(e||J)(t.LFG(t.zs3),t.LFG(Wt.s),t.LFG(u.D),t.LFG(wt.u),t.LFG($.j),t.LFG(It.R),t.LFG(v.T),t.LFG(Bt.y))},J.\u0275prov=t.Yz7({token:J,factory:J.\u0275fac});class y extends J{constructor(){super(...arguments),this.cache=(0,$t.qH)()}loadValues(e){return this.cache.putFromPromiseIfPristine(()=>this.loadUncached()),this.cache.values$().pipe((0,V.U)(n=>e?n.filter(i=>new RegExp(e,"i").test(i.name)):n),(0,W.q)(1))}addColumnWithActionAttribute(e,n){if(this.cache.value&&!this.cache.value.find(i=>i.id===n.id)){const i=[...this.cache.value,n];this.cache.putValue(i)}return super.addColumnWithActionAttribute(e,n)}require(e){return this.cache.putFromPromiseIfPristine(()=>this.loadUncached()),this.cache.values$().pipe((0,W.q)(1)).toPromise().then(n=>n.find(i=>i.id===e))}}y.\u0275fac=function(){let o;return function(n){return(o||(o=t.n5z(y)))(n||y)}}(),y.\u0275prov=t.Yz7({token:y,factory:y.\u0275fac});s(34863);function Qe(o,e){if(1&o&&(t.TgZ(0,"div",1),t.TgZ(1,"h2",2),t._UZ(2,"small",3),t._UZ(3,"br"),t._uU(4),t.qZA(),t.qZA()),2&o){const n=t.oxw();t.xp6(2),t.Q6J("textContent",n.text.status),t.xp6(2),t.hij(" ",n.status.name," ")}}class dt{constructor(e){this.I18n=e,this.text={status:this.I18n.t("js.work_packages.properties.status")}}}dt.\u0275fac=function(e){return new(e||dt)(t.Y36(u.D))},dt.\u0275cmp=t.Xpm({type:dt,selectors:[["ng-component"]],hostAttrs:[1,"title-container","-small"],inputs:{status:["resource","status"]},decls:1,vars:1,consts:[["class","op-status-board-header",4,"ngIf"],[1,"op-status-board-header"],[1,"editable-toolbar-title--fixed"],[3,"textContent"]],template:function(e,n){1&e&&t.YNc(0,Qe,5,2,"div",0),2&e&&t.Q6J("ngIf",n.status)},directives:[p.O5],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-status-board-header[_ngcontent-%COMP%]   .editable-toolbar-title--fixed[_ngcontent-%COMP%]{line-height:1!important}"]});var lt=s(97656);class O extends y{constructor(){super(...arguments),this.filterName="status",this.resourceName="status",this.text=this.I18n.t("js.boards.board_type.board_type_title.status"),this.description=this.I18n.t("js.boards.board_type.action_text_status"),this.label=this.I18n.t("js.boards.add_list_modal.labels.status"),this.icon="icon-workflow",this.image=(0,lt.h)("board_creation_modal/status.svg"),this.localizedName=this.I18n.t("js.work_packages.properties.status")}headerComponent(){return dt}addInitialColumnsForAction(e){return this.loadValues().toPromise().then(n=>Promise.all(n.map(i=>i.isDefault?this.addColumnWithActionAttribute(e,i):Promise.resolve(e))).then(()=>e))}warningTextWhenNoOptionsAvailable(){return Promise.resolve(this.I18n.t("js.boards.add_list_modal.warning.status"))}loadUncached(){return this.apiV3Service.statuses.get().toPromise().then(e=>e.elements)}}O.\u0275fac=function(){let o;return function(n){return(o||(o=t.n5z(O)))(n||O)}}(),O.\u0275prov=t.Yz7({token:O,factory:O.\u0275fac});var Gt=s(67325),Xt=s(29161),qe=s(54622);class S extends y{constructor(){super(...arguments),this.filterName="version",this.resourceName="version",this.text=this.I18n.t("js.boards.board_type.board_type_title.version"),this.description=this.I18n.t("js.boards.board_type.action_text_version"),this.label=this.I18n.t("js.boards.add_list_modal.labels.version"),this.icon="icon-getting-started",this.image=(0,lt.h)("board_creation_modal/version.svg"),this.localizedName=this.I18n.t("js.work_packages.properties.version")}canAddToQuery(e){return _.get(e,"results.createWorkPackage.href",null)?(this.writable$||(this.writable$=e.results.createWorkPackage().then(i=>i.schema.version.writable)),this.writable$):Promise.resolve(!1)}addInitialColumnsForAction(e){return this.loadValues().toPromise().then(n=>Promise.all(n.map(i=>{const r=_.get(i,"definingProject.name",null);return i.isOpen()&&r&&r===this.currentProject.name?this.addColumnWithActionAttribute(e,i):Promise.resolve(e)})).then(()=>e))}getAdditionalListMenuItems(e){return this.getLoadedActionValue(e).then(n=>n?this.buildItemsForVersion(n):[])}autocompleterComponent(){return qe.y}headerComponent(){return X}disabledAddButtonPlaceholder(e){return e.isLocked()?{icon:"locked",text:this.I18n.t("js.boards.version.locked")}:e.isClosed()?{icon:"not-supported",text:this.I18n.t("js.boards.version.closed")}:void 0}dragIntoAllowed(e,n){return n instanceof Be.g&&n.isOpen()}loadUncached(){return null===this.currentProject.id?Promise.resolve([]):this.apiV3Service.projects.id(this.currentProject.id).versions.get().toPromise().then(e=>e.elements)}patchVersionStatus(e,n){this.apiV3Service.versions.id(e).patch({status:n}).subscribe(i=>{this.state.go(".",{},{reload:!0})},i=>this.halNotification.handleRawError(i))}buildItemsForVersion(e){const n=e.id;return[{hidden:!e.isOpen()||e.isLocked()&&!e.$links.update,linkText:this.I18n.t("js.boards.version.lock_version"),onClick:()=>(this.patchVersionStatus(e,"locked"),!0)},{hidden:!e.isLocked()||e.isOpen()&&!e.$links.update,linkText:this.I18n.t("js.boards.version.unlock_version"),onClick:()=>(this.patchVersionStatus(e,"open"),!0)},{hidden:e.isClosed()||!e.isClosed()&&!e.$links.update,linkText:this.I18n.t("js.boards.version.close_version"),onClick:()=>(this.patchVersionStatus(e,"closed"),!0)},{hidden:!e.isClosed()||e.isClosed()&&!e.$links.update,linkText:this.I18n.t("js.boards.version.open_version"),onClick:()=>(this.patchVersionStatus(e,"open"),!0)},{linkText:this.I18n.t("js.boards.version.show_version"),href:this.pathHelper.versionShowPath(n),onClick:i=>!(0,Gt.F)(i)&&(window.open(this.pathHelper.versionShowPath(n),"_blank"),!0)},{hidden:!e.$links.update,linkText:this.I18n.t("js.boards.version.edit_version"),href:this.pathHelper.versionEditPath(n),onClick:i=>!(0,Gt.F)(i)&&(window.open(this.pathHelper.versionEditPath(n),"_blank"),!0)}]}}S.\u0275fac=function(){let o;return function(n){return(o||(o=t.n5z(S)))(n||S)}}(),S.\u0275prov=t.Yz7({token:S,factory:S.\u0275fac}),(0,A.gn)([(0,Xt.W)(),(0,A.w6)("design:type",C.StateService)],S.prototype,"state",void 0),(0,A.gn)([(0,Xt.W)(),(0,A.w6)("design:type",it.W)],S.prototype,"halNotification",void 0);var Je=s(41618),Ne=s(1143),Kt=s(79902),Ue=s(86664);class N{constructor(e,n){this.activeWindow=e,this.apiV3Service=n}monitor(e){let n=new Date;return(0,Je.F)(2e3).pipe((0,Ne.O)(0),(0,x.h)(()=>e.length>0),(0,x.h)(()=>this.activeWindow.isActive),(0,Kt.w)(()=>{const i=this.queryForUpdates(e,n);return n=new Date,i}),(0,x.h)(i=>i.count>0))}queryForUpdates(e,n){return this.apiV3Service.queries.list({filters:[["id","=",e],["updatedAt","<>d",[n.toISOString()]]]})}}N.\u0275fac=function(e){return new(e||N)(t.LFG(Ue.u),t.LFG(v.T))},N.\u0275prov=t.Yz7({token:N,factory:N.\u0275fac});s(84481);var Ve=s(3742);function $e(o,e){if(1&o&&t._UZ(0,"op-principal",7),2&o){const n=t.oxw(2);t.Q6J("principal",n.user)("hideName",!0)}}function ze(o,e){if(1&o&&t._UZ(0,"a",8),2&o){const n=t.oxw(2);t.Q6J("href",n.pathHelper.userPath(n.user.id),t.LSH)("textContent",n.user.name)}}function Ee(o,e){if(1&o&&t._UZ(0,"span",4),2&o){const n=t.oxw(2);t.Q6J("textContent",n.user.name)}}function We(o,e){if(1&o&&(t.TgZ(0,"div",1),t.YNc(1,$e,1,2,"op-principal",2),t.TgZ(2,"h2",3),t._UZ(3,"small",4),t._UZ(4,"br"),t.YNc(5,ze,1,2,"a",5),t.YNc(6,Ee,1,1,"span",6),t.qZA(),t.qZA()),2&o){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.user.id),t.xp6(2),t.Q6J("textContent",n.text.assignee),t.xp6(2),t.Q6J("ngIf",n.user.id),t.xp6(1),t.Q6J("ngIf",!n.user.id)}}class pt{constructor(e,n){this.pathHelper=e,this.I18n=n,this.text={assignee:this.I18n.t("js.work_packages.properties.assignee")}}}pt.\u0275fac=function(e){return new(e||pt)(t.Y36($.j),t.Y36(u.D))},pt.\u0275cmp=t.Xpm({type:pt,selectors:[["ng-component"]],hostAttrs:[1,"title-container","-small"],inputs:{user:["resource","user"]},decls:1,vars:1,consts:[["class","op-assignee-board-header",4,"ngIf"],[1,"op-assignee-board-header"],["size","mini",3,"principal","hideName",4,"ngIf"],[1,"editable-toolbar-title--fixed"],[3,"textContent"],["target","_blank",3,"href","textContent",4,"ngIf"],[3,"textContent",4,"ngIf"],["size","mini",3,"principal","hideName"],["target","_blank",3,"href","textContent"]],template:function(e,n){1&e&&t.YNc(0,We,7,4,"div",0),2&e&&t.Q6J("ngIf",n.user)},directives:[p.O5,Ve.N],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-assignee-board-header[_ngcontent-%COMP%]{display:flex}.op-assignee-board-header[_ngcontent-%COMP%]   op-principal[_ngcontent-%COMP%]{align-self:center;padding-right:5px}.op-assignee-board-header[_ngcontent-%COMP%]   .editable-toolbar-title--fixed[_ngcontent-%COMP%]{line-height:1!important}"]});class D extends y{constructor(){super(...arguments),this.filterName="assignee",this.resourceName="assignee",this.text=this.I18n.t("js.boards.board_type.board_type_title.assignee"),this.description=this.I18n.t("js.boards.board_type.action_text_assignee"),this.label=this.I18n.t("js.boards.add_list_modal.labels.assignee"),this.icon="icon-user",this.image=(0,lt.h)("board_creation_modal/assignees.svg"),this.unassignedUser={id:null,href:null,name:this.I18n.t("js.filter.noneElement")},this.localizedName=this.I18n.t("js.work_packages.properties.assignee")}addColumnWithActionAttribute(e,n){const i={name:n.name};let r;return r=null===n.id?{assignee:{operator:"!*",values:[]}}:{assignee:{operator:"=",values:[(0,Zt.Z)(n.href)]}},this.boardListsService.addQuery(e,i,[r])}getLoadedActionValue(e){const n=this.getActionFilter(e);return n&&"!*"===n.operator.id?Promise.resolve(this.unassignedUser):super.getLoadedActionValue(e)}headerComponent(){return pt}warningTextWhenNoOptionsAvailable(e){let n=e?this.I18n.t("js.boards.add_list_modal.warning.assignee"):this.I18n.t("js.boards.add_list_modal.warning.no_member");return this.apiV3Service.projects.id(this.currentProject.id).get().toPromise().then(i=>(i.memberships&&(n=n.concat(this.I18n.t("js.boards.add_list_modal.warning.add_members",{link:this.pathHelper.projectMembershipsPath(this.currentProject.identifier)}))),n))}loadUncached(){return this.apiV3Service.projects.id(this.currentProject.identifier).available_assignees.get().toPromise().then(e=>[this.unassignedUser].concat(e.elements))}}function Ge(o,e){if(1&o&&(t.TgZ(0,"div",1),t.TgZ(1,"h2",2),t._UZ(2,"small",3),t._UZ(3,"br"),t._UZ(4,"a",4),t.qZA(),t.qZA()),2&o){const n=t.oxw();t.xp6(2),t.Q6J("textContent",n.text.project),t.xp6(2),t.Q6J("href",n.pathHelper.projectPath(n.idFromLink(n.resource.href)),t.LSH)("textContent",n.resource.name)}}D.\u0275fac=function(){let o;return function(n){return(o||(o=t.n5z(D)))(n||D)}}(),D.\u0275prov=t.Yz7({token:D,factory:D.\u0275fac});class ht{constructor(e,n){this.pathHelper=e,this.I18n=n,this.idFromLink=Zt.Z,this.text={project:this.I18n.t("js.label_project")}}}ht.\u0275fac=function(e){return new(e||ht)(t.Y36($.j),t.Y36(u.D))},ht.\u0275cmp=t.Xpm({type:ht,selectors:[["ng-component"]],hostAttrs:[1,"title-container","-small"],inputs:{resource:"resource"},decls:1,vars:1,consts:[["class","op-subproject-board-header",4,"ngIf"],[1,"op-subproject-board-header"],[1,"editable-toolbar-title--fixed"],[3,"textContent"],["target","_blank",3,"href","textContent"]],template:function(e,n){1&e&&t.YNc(0,Ge,5,3,"div",0),2&e&&t.Q6J("ngIf",n.resource)},directives:[p.O5],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-subproject-board-header[_ngcontent-%COMP%]   .editable-toolbar-title--fixed[_ngcontent-%COMP%]{line-height:1!important}"]});class B extends y{constructor(){super(...arguments),this.filterName="onlySubproject",this.resourceName="subproject",this.text=this.I18n.t("js.boards.board_type.board_type_title.subproject"),this.description=this.I18n.t("js.boards.board_type.action_text_subprojects"),this.label=this.I18n.t("js.boards.add_list_modal.labels.subproject"),this.icon="icon-projects",this.image=(0,lt.h)("board_creation_modal/subproject.svg"),this.localizedName=this.I18n.t("js.work_packages.properties.subproject")}headerComponent(){return ht}canMove(e){return!!e.move}assignToWorkPackage(e,n){const i=this.getActionValueId(n,!0);e.setValue("project",{href:i})}loadUncached(){const e=this.currentProject.id;return this.apiV3Service.projects.filtered((new jt.qM).add("ancestor","=",[e]).add("active","=",!0)).get().toPromise().then(n=>n.elements)}}B.\u0275fac=function(){let o;return function(n){return(o||(o=t.n5z(B)))(n||B)}}(),B.\u0275prov=t.Yz7({token:B,factory:B.\u0275fac});s(24897);function Xe(o,e){if(1&o&&(t.TgZ(0,"div",1),t.TgZ(1,"h2",2),t._UZ(2,"small",3),t._UZ(3,"br"),t._UZ(4,"span",4),t._UZ(5,"a",5),t.qZA(),t.qZA()),2&o){const n=t.oxw();t.xp6(2),t.Q6J("textContent",n.text.workPackage),t.xp6(2),t.Q6J("ngClass",n.typeHighlightingClass)("textContent",n.resource.type.name),t.xp6(1),t.Q6J("href",n.pathHelper.workPackagePath(n.idFromLink(n.resource.href)),t.LSH)("textContent",n.resource.subjectWithId())}}class ut{constructor(e,n){this.pathHelper=e,this.I18n=n,this.idFromLink=Zt.Z,this.text={workPackage:this.I18n.t("js.label_work_package_parent")}}ngOnInit(){this.typeHighlightingClass=Ht.Z.inlineClass("type",this.resource.type.id)}}ut.\u0275fac=function(e){return new(e||ut)(t.Y36($.j),t.Y36(u.D))},ut.\u0275cmp=t.Xpm({type:ut,selectors:[["ng-component"]],hostAttrs:[1,"title-container","-small"],inputs:{resource:"resource"},decls:1,vars:1,consts:[["class","op-subtask-board-header",4,"ngIf"],[1,"op-subtask-board-header"],[1,"editable-toolbar-title--fixed"],[3,"textContent"],[1,"op-subtask-board-header--work-package-type",3,"ngClass","textContent"],["target","_blank",3,"href","textContent"]],template:function(e,n){1&e&&t.YNc(0,Xe,6,5,"div",0),2&e&&t.Q6J("ngIf",n.resource)},directives:[p.O5,p.mk],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-subtask-board-header--work-package-type[_ngcontent-%COMP%]{padding-right:.5rem}.op-subtask-board-header[_ngcontent-%COMP%]   .editable-toolbar-title--fixed[_ngcontent-%COMP%]{line-height:1!important}"]});class j extends J{constructor(){super(...arguments),this.filterName="parent",this.resourceName="parent-child",this.text=this.I18n.t("js.boards.board_type.board_type_title.subtasks"),this.description=this.I18n.t("js.boards.board_type.action_text_subtasks"),this.label=this.I18n.t("js.boards.add_list_modal.labels.subtasks"),this.icon="icon-hierarchy",this.image=(0,lt.h)("board_creation_modal/parent-child.svg"),this.localizedName=this.I18n.t("js.boards.board_type.action_type.subtasks")}headerComponent(){return ut}canMove(e){return!!e.changeParent}assignToWorkPackage(e,n){var i;if((null===(i=this.getActionValueId(n))||void 0===i?void 0:i.toString())===e.id)throw new Error(this.I18n.t("js.boards.error_cannot_move_into_self"));super.assignToWorkPackage(e,n)}loadValues(e){const n=new jt.qM;return n.add("is_milestone","=",!1),n.add("project","=",[this.currentProject.id||""]),e&&n.add("subjectOrId","**",[e]),this.apiV3Service.work_packages.filtered(n,{pageSize:"-1"}).get().pipe((0,V.U)(i=>i.elements))}require(e){return this.apiV3Service.work_packages.id(e).get().toPromise()}}j.\u0275fac=function(){let o;return function(n){return(o||(o=t.n5z(j)))(n||j)}}(),j.\u0275prov=t.Yz7({token:j,factory:j.\u0275fac});var te=s(97047);class gt{constructor(e){this.injector=e;const n=e.get(rt.X);n.add("status",e.get(O)),n.add("assignee",e.get(D)),n.add("version",e.get(S)),n.add("subproject",e.get(B)),n.add("subtasks",e.get(j))}}gt.\u0275fac=function(e){return new(e||gt)(t.Y36(t.zs3))},gt.\u0275cmp=t.Xpm({type:gt,selectors:[["boards-entry"]],features:[t._Bn([q,O,S,D,B,j,N])],decls:1,vars:0,consts:[["wp-isolated-query-space",""]],template:function(e,n){1&e&&t._UZ(0,"ui-view",0)},directives:[et.UIView,te.A],encapsulation:2});var Ke=s(56945),Mt=s(26942),ee=s(38519),mt=s(2775),tn=s(81979),en=s(21501);function nn(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"li",8),t.TgZ(1,"a",9),t.NdJ("click",function(){return t.CHM(n),t.oxw().newBoard()}),t._UZ(2,"op-icon",10),t._UZ(3,"span",11),t.qZA(),t.qZA()}if(2&o){const n=t.oxw();t.xp6(1),t.Q6J("title",n.text.create_new_board),t.xp6(2),t.Q6J("textContent",n.text.board)}}function on(o,e){if(1&o&&(t.TgZ(0,"tr",21),t.TgZ(1,"td",22),t.TgZ(2,"span"),t._UZ(3,"op-icon",23),t.TgZ(4,"span"),t._UZ(5,"strong",3),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o){const n=t.oxw(2);t.xp6(5),t.Q6J("textContent",n.text.noResults)}}function rn(o,e){if(1&o&&t._UZ(0,"span",3),2&o){const n=t.oxw(3);t.Q6J("textContent",n.text.type_free)}}function sn(o,e){if(1&o&&t._UZ(0,"span",3),2&o){const n=t.oxw().$implicit,i=t.oxw(2);t.Q6J("textContent",i.text.action_by_attribute(n.actionAttribute))}}const an=function(o){return{board_id:o}};function cn(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"tr"),t.TgZ(1,"td",24),t._UZ(2,"a",25),t.qZA(),t.TgZ(3,"td"),t.YNc(4,rn,1,1,"span",26),t.YNc(5,sn,1,1,"span",26),t.qZA(),t.TgZ(6,"td"),t._UZ(7,"op-date-time",27),t.qZA(),t.TgZ(8,"td",28),t.TgZ(9,"button",29),t.NdJ("click",function(){const a=t.CHM(n).$implicit;return t.oxw(2).destroyBoard(a)}),t._UZ(10,"op-icon",30),t.qZA(),t.qZA(),t.qZA()}if(2&o){const n=e.$implicit,i=t.oxw(2);t.xp6(2),t.Q6J("textContent",n.name)("uiParams",t.VKq(6,an,n.id)),t.xp6(2),t.Q6J("ngIf",n.isFree),t.xp6(1),t.Q6J("ngIf",n.isAction),t.xp6(2),t.Q6J("dateTimeValue",n.createdAt),t.xp6(2),t.Q6J("title",i.text.delete)}}function dn(o,e){if(1&o&&(t.TgZ(0,"div",12),t.TgZ(1,"div",13),t.TgZ(2,"table",14),t.TgZ(3,"colgroup"),t._UZ(4,"col",15),t._UZ(5,"col",15),t._UZ(6,"col",15),t._UZ(7,"col",15),t._UZ(8,"col"),t.qZA(),t.TgZ(9,"thead"),t.TgZ(10,"tr"),t.TgZ(11,"th"),t.TgZ(12,"div",16),t.TgZ(13,"div",17),t._UZ(14,"span",3),t.qZA(),t.qZA(),t.qZA(),t.TgZ(15,"th"),t.TgZ(16,"div",16),t.TgZ(17,"div",17),t._UZ(18,"span",3),t.qZA(),t.qZA(),t.qZA(),t.TgZ(19,"th"),t.TgZ(20,"div",16),t.TgZ(21,"div",17),t._UZ(22,"span",3),t.qZA(),t.qZA(),t.qZA(),t.TgZ(23,"th"),t._UZ(24,"div",18),t.qZA(),t.qZA(),t.qZA(),t.TgZ(25,"tbody"),t.YNc(26,on,6,1,"tr",19),t.YNc(27,cn,11,8,"tr",20),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o){const n=e.ngIf,i=t.oxw();t.xp6(14),t.Q6J("textContent",i.text.name),t.xp6(4),t.Q6J("textContent",i.text.type),t.xp6(4),t.Q6J("textContent",i.text.createdAt),t.xp6(4),t.Q6J("ngIf",0===n.length),t.xp6(1),t.Q6J("ngForOf",n)}}class bt extends Mt.N{constructor(e,n,i,r,a,c,d,l){super(),this.boardService=e,this.apiV3Service=n,this.I18n=i,this.toastService=r,this.opModalService=a,this.loadingIndicatorService=c,this.authorisationService=d,this.injector=l,this.text={name:this.I18n.t("js.modals.label_name"),create:this.I18n.t("js.button_create"),create_new_board:this.I18n.t("js.boards.create_new"),board:this.I18n.t("js.label_board"),boards:this.I18n.t("js.label_board_plural"),type:this.I18n.t("js.boards.label_board_type"),type_free:this.I18n.t("js.boards.board_type.free"),action_by_attribute:h=>this.I18n.t("js.boards.board_type.action_by_attribute",{attribute:this.I18n.t(`js.boards.board_type.action_type.${h}`)}),createdAt:this.I18n.t("js.label_created_on"),delete:this.I18n.t("js.button_delete"),areYouSure:this.I18n.t("js.text_are_you_sure"),deleteSuccessful:this.I18n.t("js.notice_successful_delete"),noResults:this.I18n.t("js.notice_no_results_to_display")},this.canAdd=!1,this.boards$=this.apiV3Service.boards.observeAll().pipe((0,V.U)(h=>h.sort((g,m)=>g.name.localeCompare(m.name))))}ngOnInit(){this.authorisationService.observeUntil((0,ee.J6)(this)).subscribe(()=>{this.canAdd=this.authorisationService.can("boards","create")})}ngAfterViewInit(){this.loadingIndicatorService.indicator("boards-module").promise=this.boardService.loadAllBoards()}newBoard(){this.opModalService.show(Ke.r,this.injector)}destroyBoard(e){!window.confirm(this.text.areYouSure)||this.boardService.delete(e).then(()=>{this.toastService.addSuccess(this.text.deleteSuccessful)}).catch(n=>this.toastService.addError(`Deletion failed: ${n}`))}}bt.\u0275fac=function(e){return new(e||bt)(t.Y36(T.$),t.Y36(v.T),t.Y36(u.D),t.Y36(ot.kl),t.Y36(Z.S),t.Y36(Dt.vt),t.Y36(At.g),t.Y36(t.zs3))},bt.\u0275cmp=t.Xpm({type:bt,selectors:[["ng-component"]],features:[t.qOj],decls:9,vars:5,consts:[[1,"toolbar-container"],[1,"toolbar"],[1,"title-container"],[3,"textContent"],[1,"toolbar-items"],["class","toolbar-item",4,"ngIf"],["data-indicator-name","boards-module",1,"boards--listing-group","loading-indicator--location"],["class","generic-table--container",4,"ngIf"],[1,"toolbar-item"],[1,"button","-alt-highlight",3,"title","click"],["icon-classes","button--icon icon-add"],[1,"button--text",3,"textContent"],[1,"generic-table--container"],[1,"generic-table--results-container"],[1,"generic-table"],["opHighlightCol",""],[1,"generic-table--sort-header-outer"],[1,"generic-table--sort-header"],[1,"generic-table--empty-header"],["id","empty-row-notification",4,"ngIf"],[4,"ngFor","ngForOf"],["id","empty-row-notification"],["colspan","4"],["icon-classes","icon-info1 icon-context"],["data-qa-selector","boards-table-column--name",1,"name"],["uiSref","boards.partitioned.show",3,"textContent","uiParams"],[3,"textContent",4,"ngIf"],[3,"dateTimeValue"],[1,"buttons"],["type","button",1,"spot-link",3,"title","click"],["icon-classes","icon icon-delete"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t._UZ(3,"h2",3),t.qZA(),t.TgZ(4,"ul",4),t.YNc(5,nn,4,2,"li",5),t.qZA(),t.qZA(),t.qZA(),t.TgZ(6,"div",6),t.YNc(7,dn,28,5,"div",7),t.ALo(8,"async"),t.qZA()),2&e&&(t.xp6(3),t.Q6J("textContent",n.text.boards),t.xp6(2),t.Q6J("ngIf",n.canAdd),t.xp6(2),t.Q6J("ngIf",t.lcZ(8,3,n.boards$)))},directives:[p.O5,mt.o,tn.K,p.sg,et.AnchorUISref,et.UISref,en.F],pipes:[p.Ov],styles:[".boards--listing-group[_ngcontent-%COMP%]{position:relative}.boards--teaser-video-container[_ngcontent-%COMP%]{height:50vh;text-align:center}.boards--teaser-video-container[_ngcontent-%COMP%]   .boards--teaser-video[_ngcontent-%COMP%]{width:100%;height:100%}"]});var ln=s(74647),pn=s(84515),hn=s(77434);class ft extends Mt.N{constructor(e,n,i,r,a,c,d,l,h){super(),this.currentProjectService=e,this.querySpace=n,this.apiV3Service=i,this.halResourceService=r,this.wpStatesInitialization=a,this.wpTableFilters=c,this.urlParamsHelper=d,this.boardFilters=l,this.$state=h,this.initialized=!1}ngAfterViewInit(){!this.board$||this.board$.pipe((0,W.q)(1)).subscribe(e=>{this.loadQueryForm(),this.updateChecksumOnFilterChanges(),e.isAction&&this.wpTableFilters.hidden.push(e.actionAttribute)})}updateChecksumOnFilterChanges(){this.wpTableFilters.live$().pipe(this.untilDestroyed(),(0,pn.T)(1),(0,Yt.b)(250)).subscribe(()=>{const e=this.wpTableFilters.current,n=this.urlParamsHelper.buildV3GetFilters(e),i=JSON.stringify(n);this.boardFilters.filters.putValue(n),this.$state.go(".",{query_props:i},{custom:{notify:!1}})})}loadQueryForm(){this.apiV3Service.queries.form.loadWithParams({filters:JSON.stringify(this.boardFilters.current)},void 0,this.currentProjectService.id).subscribe(([e,n])=>{this.querySpace.query.putValue(n),this.wpStatesInitialization.updateStatesFromForm(n,e)})}}ft.\u0275fac=function(e){return new(e||ft)(t.Y36(It.R),t.Y36(H.q),t.Y36(v.T),t.Y36(wt.u),t.Y36(Ft.f),t.Y36(ln.Z),t.Y36(Ut.Z),t.Y36(I),t.Y36(C.StateService))},ft.\u0275cmp=t.Xpm({type:ft,selectors:[["board-filter"]],inputs:{board$:"board$"},features:[t.qOj],decls:1,vars:0,template:function(e,n){1&e&&t._UZ(0,"op-filter-container")},directives:[hn.J],encapsulation:2});var ne=s(45237),un=s(22956),gn=s(11266),oe=s(60312),mn=s(61736);const bn=["tabContentOutlet"];class vt extends oe.T{constructor(e,n,i,r,a,c,d,l,h){super(e,l,h),this.locals=e,this.I18n=n,this.boardService=i,this.boardConfigurationService=r,this.injector=a,this.appRef=c,this.componentFactoryResolver=d,this.cdRef=l,this.elementRef=h,this.text={title:this.I18n.t("js.boards.configuration_modal.title"),closePopup:this.I18n.t("js.close_popup_title"),applyButton:this.I18n.t("js.modals.button_apply"),cancelButton:this.I18n.t("js.modals.button_cancel")}}ngOnInit(){this.$element=this.elementRef.nativeElement,this.tabPortalHost=new mn.M(this.boardConfigurationService.tabs,this.tabContentOutlet.nativeElement,this.componentFactoryResolver,this.appRef,this.injector),setTimeout(()=>{const e=this.availableTabs[0];this.switchTo(e)})}ngOnDestroy(){this.tabPortalHost.dispose()}get availableTabs(){return this.tabPortalHost.availableTabs}get currentTab(){return this.tabPortalHost.currentTab}switchTo(e){this.tabPortalHost.switchTo(e)}saveChanges(){this.tabPortalHost.activeComponents.forEach(n=>{n.onSave()});const e=this.locals.board;this.boardService.save(e).subscribe(()=>{this.service.close()})}onClose(){return this.afterFocusOn.focus(),!0}get afterFocusOn(){return this.$element}}vt.\u0275fac=function(e){return new(e||vt)(t.Y36(Z.E),t.Y36(u.D),t.Y36(T.$),t.Y36(q),t.Y36(t.zs3),t.Y36(t.z2F),t.Y36(t._Vd),t.Y36(t.sBO),t.Y36(t.SBq))},vt.\u0275cmp=t.Xpm({type:vt,selectors:[["ng-component"]],viewQuery:function(e,n){if(1&e&&t.Gf(bn,7),2&e){let i;t.iGM(i=t.CRH())&&(n.tabContentOutlet=i.first)}},features:[t.qOj],decls:11,vars:3,consts:[["data-indicator-name","modal",1,"spot-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[1,"tab-content"],["tabContentOutlet",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t._uU(2),t.qZA(),t._UZ(3,"div",2),t.TgZ(4,"div",3),t._UZ(5,"div",4,5),t.qZA(),t.TgZ(7,"div",6),t.TgZ(8,"div",7),t.TgZ(9,"button",8),t.NdJ("click",function(r){return n.closeMe(r)}),t.qZA(),t.TgZ(10,"button",9),t.NdJ("click",function(){return n.saveChanges()}),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Oqu(n.text.title),t.xp6(7),t.Q6J("textContent",n.text.cancelButton),t.xp6(1),t.Q6J("textContent",n.text.applyButton))},encapsulation:2});var Lt=s(77616);class _t extends zt.n{constructor(e,n,i,r,a,c,d,l){super(e,n),this.elementRef=e,this.opContextMenu=n,this.opModalService=i,this.boardService=r,this.Notifications=a,this.State=c,this.injector=d,this.I18n=l,this.text={deleteSuccessful:this.I18n.t("js.notice_successful_delete")}}get locals(){return{contextMenuId:"boardsToolbarMenu",items:this.items}}open(e){this.buildItems(),this.opContextMenu.show(this,e)}buildItems(){this.items=[{linkText:this.I18n.t("js.toolbar.settings.configure_view"),icon:"icon-settings",onClick:()=>(this.opContextMenu.close(),this.opModalService.show(vt,this.injector,{board:this.board}),!0)},{linkText:this.I18n.t("js.toolbar.settings.page_settings"),icon:"icon-edit",onClick:()=>(this.board.grid.updateImmediately&&jQuery(".toolbar-container .editable-toolbar-title--input").trigger(Lt.mE),!0)},{linkText:this.I18n.t("js.toolbar.settings.delete"),icon:"icon-delete",onClick:()=>(this.board.grid.delete&&window.confirm(this.I18n.t("js.text_query_destroy_confirmation"))&&this.boardService.delete(this.board).then(()=>{this.State.go("boards.list",{flash_message:{type:"success",message:this.text.deleteSuccessful}})}),!0)}]}}_t.\u0275fac=function(e){return new(e||_t)(t.Y36(t.SBq),t.Y36(Et.$),t.Y36(Z.S),t.Y36(T.$),t.Y36(ot.kl),t.Y36(C.StateService),t.Y36(t.zs3),t.Y36(u.D))},_t.\u0275dir=t.lG2({type:_t,selectors:[["","boardsToolbarMenu",""]],inputs:{board:["boardsToolbarMenu-resource","board"]},features:[t.qOj]});class Ct{constructor(e){this.I18n=e,this.text={button_more:this.I18n.t("js.button_more")}}}Ct.\u0275fac=function(e){return new(e||Ct)(t.Y36(u.D))},Ct.\u0275cmp=t.Xpm({type:Ct,selectors:[["ng-component"]],inputs:{board$:"board$"},decls:3,vars:4,consts:[["boardsToolbarMenu","",1,"button","last","board--settings-dropdown","toolbar-icon",3,"title","boardsToolbarMenu-resource"],["icon-classes","button--icon icon-show-more"]],template:function(e,n){1&e&&(t.TgZ(0,"button",0),t.ALo(1,"async"),t._UZ(2,"op-icon",1),t.qZA()),2&e&&(t.s9C("title",n.text.button_more),t.Q6J("boardsToolbarMenu-resource",t.lcZ(1,2,n.board$)))},directives:[_t,mt.o],pipes:[p.Ov],encapsulation:2});class fn{constructor(e){this.handler=e,this.requests=new Tt.xQ,this.responses$=this.requests.pipe((0,Kt.w)(this.handler))}request(e){this.requests.next(e)}observe(e){return this.responses$.pipe((0,R.R)(e))}}var vn=s(71435),_n=(s(31744),s(57810)),Cn=s(81628);function xn(o,e){if(1&o&&t._UZ(0,"op-back-button",11),2&o){const n=t.oxw();t.Q6J("customBackMethod",n.backButtonCallback)}}function yn(o,e){if(1&o&&(t.TgZ(0,"li",15),t._UZ(1,"ndc-dynamic",16),t.qZA()),2&o){const n=t.oxw().$implicit,i=t.oxw(2);t.Q6J("ngClass",n.containerClasses),t.xp6(1),t.Q6J("ndcDynamicComponent",n.component)("ndcDynamicInputs",n.inputs)("ndcDynamicInjector",i.injector)("ndcDynamicOutputs",n.outputs)}}function Sn(o,e){if(1&o&&(t.ynx(0),t.YNc(1,yn,2,5,"li",14),t.BQk()),2&o){const n=e.$implicit;t.xp6(1),t.Q6J("ngIf",!n.show||n.show())}}function wn(o,e){if(1&o&&(t.TgZ(0,"ul",12),t.YNc(1,Sn,2,1,"ng-container",13),t.qZA()),2&o){const n=t.oxw();t.xp6(1),t.Q6J("ngForOf",n.toolbarButtonComponents)}}function In(o,e){if(1&o&&t._UZ(0,"ndc-dynamic",17),2&o){const n=t.oxw();t.Q6J("ndcDynamicComponent",n.filterContainerDefinition.component)("ndcDynamicInputs",n.filterContainerDefinition.inputs)("ndcDynamicOutputs",n.filterContainerDefinition.outputs)("ndcDynamicInjector",n.injector)}}class K extends Mt.N{constructor(e,n,i,r,a,c,d,l,h,g,m){super(),this.I18n=e,this.cdRef=n,this.$transitions=i,this.state=r,this.toastService=a,this.halNotification=c,this.injector=d,this.apiV3Service=l,this.boardFilters=h,this.Boards=g,this.titleService=m,this.text={button_more:this.I18n.t("js.button_more"),delete:this.I18n.t("js.button_delete"),areYouSure:this.I18n.t("js.text_are_you_sure"),deleteSuccessful:this.I18n.t("js.notice_successful_delete"),updateSuccessful:this.I18n.t("js.notice_successful_update"),unnamedBoard:this.I18n.t("js.boards.label_unnamed_board"),loadingError:"No such board found",addList:this.I18n.t("js.boards.add_list"),upsaleBoards:this.I18n.t("js.boards.upsale.teaser_text"),upsaleCheckOutLink:this.I18n.t("js.work_packages.table_configuration.upsale.check_out_link"),unnamed_list:this.I18n.t("js.boards.label_unnamed_list")},this.board$=this.apiV3Service.boards.id(this.state.params.board_id.toString()).observe(),this.isNew=!!this.state.params.isNew,this.toolbarDisabled=!1,this.showToolbar=!0,this.filterAllowed=!0,this.currentPartition="-split",this.filterContainerDefinition={component:ft,inputs:{board$:this.board$}},this.boardSaver=new fn(w=>(this.toolbarDisabled=!0,this.Boards.save(w).pipe((0,vn.x)(()=>this.toolbarDisabled=!1)))),this.toolbarButtonComponents=[{component:un.U,containerClasses:"hidden-for-mobile"},{component:gn.a,containerClasses:"hidden-for-mobile"},{component:Ct,containerClasses:"hidden-for-mobile",show:()=>this.editable,inputs:{board$:this.board$}}]}ngOnInit(){this.Boards.loadAllBoards(),this.boardSaver.observe((0,ee.J6)(this)).subscribe(()=>{this.toastService.addSuccess(this.text.updateSuccessful)},e=>this.halNotification.handleRawError(e)),this.removeTransitionSubscription=this.$transitions.onSuccess({},e=>{const n=e.to(),i=e.params("to");this.showToolbarSaveButton=!!i.query_props,this.setPartition(n),this.board$.pipe((0,W.q)(1)).subscribe(r=>{this.titleService.setFirstPart(r.name)}),this.cdRef.detectChanges()}),this.board$.pipe(this.untilDestroyed()).subscribe(e=>{const n=this.state.params.query_props;this.editable=e.editable,this.selectedTitle=e.name,this.titleService.setFirstPart(e.name),this.boardFilters.filters.putValue(n?JSON.parse(n):e.filters),this.cdRef.detectChanges()})}ngOnDestroy(){super.ngOnDestroy(),this.removeTransitionSubscription()}changeChangesFromTitle(e){this.board$.pipe((0,W.q)(1)).subscribe(n=>{n.name=e,n.filters=this.boardFilters.current;this.state.go(".",{isNew:!1,query_props:null},{custom:{notify:!1}}),this.boardSaver.request(n)})}updateTitleName(e){this.changeChangesFromTitle(e)}get titleEditingEnabled(){return this.editable}setPartition(e){this.currentPartition=e.data&&e.data.partition?e.data.partition:"-split"}}K.\u0275fac=function(e){return new(e||K)(t.Y36(u.D),t.Y36(t.sBO),t.Y36(C.TransitionService),t.Y36(C.StateService),t.Y36(ot.kl),t.Y36(it.W),t.Y36(t.zs3),t.Y36(v.T),t.Y36(I),t.Y36(T.$),t.Y36(_n.V))},K.\u0275cmp=t.Xpm({type:K,selectors:[["ng-component"]],features:[t._Bn([ne.j,I]),t.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.YNc(3,xn,1,1,"op-back-button",3),t.TgZ(4,"editable-toolbar-title",4),t.NdJ("onSave",function(r){return n.changeChangesFromTitle(r)})("onEmptySubmit",function(){return n.updateTitleName("")}),t.qZA(),t.YNc(5,wn,2,1,"ul",5),t.qZA(),t.qZA(),t.TgZ(6,"div",6),t.YNc(7,In,1,4,"ndc-dynamic",7),t.qZA(),t.TgZ(8,"div",8),t._UZ(9,"div",9),t._UZ(10,"div",10),t.qZA(),t.qZA()),2&e&&(t.Q6J("ngClass",n.currentPartition),t.xp6(3),t.Q6J("ngIf",n.backButtonCallback),t.xp6(1),t.Q6J("title",n.selectedTitle)("inFlight",n.toolbarDisabled)("showSaveCondition",n.showToolbarSaveButton)("editable",n.titleEditingEnabled),t.xp6(1),t.Q6J("ngIf",n.showToolbar),t.xp6(2),t.Q6J("ngIf",n.filterContainerDefinition))},directives:[p.mk,p.O5,Lt.s5,et.UIView,Cn.W,p.sg,at.B5,at.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}",".work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:hidden}"],changeDetection:0});var kn=s(73881),An=s(43682),ie=s(98636),Tn=s(44265);function Zn(o,e){if(1&o&&(t.TgZ(0,"div",16),t.TgZ(1,"div",17),t._UZ(2,"p",18),t.qZA(),t.qZA()),2&o){const n=t.oxw();t.xp6(2),t.Q6J("innerHTML",n.warningText,t.oJD)}}function Mn(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){return t.CHM(n),t.oxw(2).onNewActionCreated()}),t.TgZ(1,"span",21),t._UZ(2,"op-icon",22),t._uU(3),t.qZA(),t.qZA()}if(2&o){const n=t.oxw(2);t.xp6(3),t.AsE(" ",n.text.button_create," ",n.ngSelectComponent.ngSelectInstance.searchTerm," ")}}function Pn(o,e){1&o&&t.YNc(0,Mn,4,2,"ng-template",19)}class xt extends oe.T{constructor(e,n,i,r,a,c,d,l,h,g){super(n,i,e),this.elementRef=e,this.locals=n,this.cdRef=i,this.boardActions=r,this.halNotification=a,this.state=c,this.boardService=d,this.I18n=l,this.apiV3Service=h,this.currentProject=g,this.getAutocompleterData=m=>(m=m.replace(/^#/,""),this.actionService.loadAvailable(this.active,m).pipe((0,ie.b)(w=>this.warnIfNoOptions(w)))),this.autocompleterOptions={resource:"",getOptionsFn:this.getAutocompleterData},this.confirmed=!1,this.inFlight=!1,this.trackByHref=An.u9,this.text={title:this.I18n.t("js.boards.add_list"),button_add:this.I18n.t("js.button_add"),button_create:this.I18n.t("js.button_create"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title"),free_board:this.I18n.t("js.boards.board_type.free"),free_board_text:this.I18n.t("js.boards.board_type.free_text"),action_board:this.I18n.t("js.boards.board_type.action"),action_board_text:this.I18n.t("js.boards.board_type.action_text"),select_attribute:this.I18n.t("js.boards.board_type.select_attribute"),placeholder:this.I18n.t("js.placeholders.selection")},this.showWarning=!1}ngOnInit(){super.ngOnInit(),this.board=this.locals.board,this.active=new Set(this.locals.active),this.actionService=this.boardActions.get(this.board.actionAttribute),this.autocompleterOptions.resource=this.actionService.resourceName.toLowerCase()}onModelChange(e){this.selectedAttribute=e}create(){this.inFlight=!0,this.actionService.addColumnWithActionAttribute(this.board,this.selectedAttribute).then(e=>this.boardService.save(e).toPromise()).then(e=>{this.inFlight=!1,this.closeMe(),this.state.go("boards.partitioned.show",{board_id:e.id,isNew:!0})}).catch(()=>this.inFlight=!1)}onNewActionCreated(){this.apiV3Service.versions.post(this.getVersionPayload(this.ngSelectComponent.ngSelectInstance.searchTerm)).subscribe(e=>{this.selectedAttribute=e,this.create()},e=>{this.ngSelectComponent.closeSelect(),this.halNotification.handleRawError(e)})}getVersionPayload(e){const n={};return n.name=e,n._links={definingProject:{href:this.apiV3Service.projects.id(this.currentProject.id).path}},n}warnIfNoOptions(e){let n=!1;n=0===e.length&&void 0!==this.ngSelectComponent.ngSelectInstance.searchTerm&&""!==this.ngSelectComponent.ngSelectInstance.searchTerm,this.actionService.warningTextWhenNoOptionsAvailable(n).then(i=>{this.warningText=i}).catch(()=>{}),this.showWarning=void 0!==this.ngSelectComponent.ngSelectInstance.searchTerm&&0===e.length,this.cdRef.detectChanges()}}xt.\u0275fac=function(e){return new(e||xt)(t.Y36(t.SBq),t.Y36(Z.E),t.Y36(t.sBO),t.Y36(rt.X),t.Y36(it.W),t.Y36(C.StateService),t.Y36(T.$),t.Y36(u.D),t.Y36(v.T),t.Y36(It.R))},xt.\u0275cmp=t.Xpm({type:xt,selectors:[["ng-component"]],viewQuery:function(e,n){if(1&e&&t.Gf(kt.s,7),2&e){let i;t.iGM(i=t.CRH())&&(n.ngSelectComponent=i.first)}},features:[t.qOj],decls:17,vars:13,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_autoheight","confirm-form-submit--modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["class","op-toast -warning",4,"ngIf"],[1,"form--field"],[1,"form--field-container"],[1,"form--select-container"],[1,"form--label",3,"textContent"],["classes","new-list--action-select","appendTo","body",3,"resource","openDirectly","fetchDataDirectly","getOptionsFn","change"],["select",""],[4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["data-qa-selector","confirmation-modal--cancel",1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"disabled","textContent","click"],[1,"op-toast","-warning"],[1,"op-toast--content"],[3,"innerHTML"],["op-autocompleter-footer-tmp",""],["type","button",1,"op-select-footer--label",3,"click"],[1,"icon-context"],["icon-classes","icon-plus icon-context"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t._uU(2),t.qZA(),t._UZ(3,"div",2),t.TgZ(4,"div",3),t.YNc(5,Zn,3,1,"div",4),t.TgZ(6,"div",5),t.TgZ(7,"div",6),t.TgZ(8,"div",7),t._UZ(9,"label",8),t.TgZ(10,"op-autocompleter",9,10),t.NdJ("change",function(r){return n.onModelChange(r)}),t.YNc(12,Pn,1,0,void 0,11),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(13,"div",12),t.TgZ(14,"div",13),t.TgZ(15,"button",14),t.NdJ("click",function(r){return n.closeMe(r)}),t.qZA(),t.TgZ(16,"button",15),t.NdJ("click",function(){return n.create()}),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Oqu(n.text.title),t.xp6(3),t.Q6J("ngIf",n.showWarning&&n.warningText),t.xp6(4),t.Q6J("textContent",n.actionService.label),t.xp6(1),t.Q6J("resource",n.autocompleterOptions.resource)("openDirectly",!0)("fetchDataDirectly",!0)("getOptionsFn",n.autocompleterOptions.getOptionsFn),t.xp6(2),t.Q6J("ngIf","version"==n.autocompleterOptions.resource),t.xp6(3),t.Q6J("textContent",n.text.button_cancel),t.uIk("title",n.text.button_cancel),t.xp6(1),t.Q6J("disabled",!n.selectedAttribute||n.inFlight)("textContent",n.text.button_add),t.uIk("title",n.text.button_add))},directives:[p.O5,kt.s,Tn.q,mt.o],encapsulation:2});var On=s(27779),Dn=s(8158);const Bn=["container"];function jn(o,e){1&o&&t._UZ(0,"span",11)}function Fn(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",8),t.YNc(1,jn,1,0,"span",9),t.TgZ(2,"board-list",10),t.NdJ("onRemove",function(){const a=t.CHM(n).$implicit,c=t.oxw(2).ngIf;return t.oxw().removeList(c,a)})("visibilityChange",function(r){const c=t.CHM(n).$implicit,d=t.oxw(2).ngIf;return t.oxw().changeVisibilityOfList(d,c,r)}),t.qZA(),t.qZA()}if(2&o){const n=e.$implicit,i=t.oxw(2).ngIf,r=t.oxw();t.Q6J("cdkDragData",n)("vsDragScrollContainer",r._container),t.xp6(1),t.Q6J("ngIf",i.editable),t.xp6(1),t.Q6J("resource",n)("board",i)}}function Yn(o,e){if(1&o&&(t.TgZ(0,"span",12),t._UZ(1,"i",13),t.qZA()),2&o){const n=t.oxw(3);t.uIk("data-tooltip",n.text.hiddenListWarning)}}function Ln(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",14),t.NdJ("click",function(){t.CHM(n);const r=t.oxw(2).ngIf;return t.oxw().addList(r)}),t.TgZ(1,"div",15),t._UZ(2,"op-icon",16),t._UZ(3,"span",17),t.qZA(),t.qZA()}if(2&o){const n=t.oxw(3);t.xp6(3),t.Q6J("textContent",n.text.addList)}}const Rn=function(o){return{"-free":o}};function Qn(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",3,4),t.NdJ("cdkDropListDropped",function(r){t.CHM(n);const a=t.oxw().ngIf;return t.oxw().moveList(a,r)}),t.YNc(2,Fn,3,5,"div",5),t.YNc(3,Yn,2,1,"span",6),t.YNc(4,Ln,4,1,"div",7),t.qZA()}if(2&o){const n=t.oxw().ngIf,i=t.oxw();t.Q6J("ngClass",t.VKq(6,Rn,n.isFree))("cdkDropListDisabled",!n.editable),t.xp6(2),t.Q6J("ngForOf",i.boardWidgets)("ngForTrackBy",i.trackByQueryId),t.xp6(1),t.Q6J("ngIf",i.showHiddenListWarning),t.xp6(1),t.Q6J("ngIf",n.editable)}}function qn(o,e){if(1&o&&t._UZ(0,"op-enterprise-banner",18),2&o){const n=t.oxw(2);t.Q6J("moreInfoLink",n.text.more_info_link)("leftMargin",!0)("linkMessage",n.text.upgrade_to_ee_text)("textMessage",n.text.teaser_text)}}function Jn(o,e){if(1&o&&(t.ynx(0),t.YNc(1,Qn,5,8,"div",1),t.YNc(2,qn,1,4,"op-enterprise-banner",2),t.BQk()),2&o){const n=e.ngIf,i=t.oxw();t.xp6(1),t.Q6J("ngIf",!i.eeShowBanners||n.isFree),t.xp6(1),t.Q6J("ngIf",i.eeShowBanners)}}class yt extends Mt.N{constructor(e,n,i,r,a,c,d,l,h,g,m,w,F,U,Y,f,Ot){super(),this.I18n=e,this.state=n,this.toastService=i,this.halNotification=r,this.boardComponent=a,this.BoardList=c,this.boardActionRegistry=d,this.opModalService=l,this.injector=h,this.apiV3Service=g,this.Boards=m,this.Banner=w,this.boardListCrossSelectionService=F,this.wpStatesInitialization=U,this.Drag=Y,this.apiv3Service=f,this.QueryUpdated=Ot,this.text={delete:this.I18n.t("js.button_delete"),areYouSure:this.I18n.t("js.text_are_you_sure"),deleteSuccessful:this.I18n.t("js.notice_successful_delete"),updateSuccessful:this.I18n.t("js.notice_successful_update"),loadingError:"No such board found",addList:this.I18n.t("js.boards.add_list"),unnamedList:this.I18n.t("js.boards.label_unnamed_list"),hiddenListWarning:this.I18n.t("js.boards.text_hidden_list_warning"),teaser_text:this.I18n.t("js.boards.upsale.teaser_text"),upgrade_to_ee_text:this.I18n.t("js.boards.upsale.upgrade"),more_info_link:On.rj.boards},this.trackByQueryId=(re,Rt)=>Rt.options.queryId,this.boardWidgets=[],this.showHiddenListWarning=!1,this.eeShowBanners=this.Banner.eeShowBanners}set container(e){void 0!==e&&(void 0===this._container&&this.Drag.addScrollContainer(e.nativeElement),setTimeout(()=>this._container=e.nativeElement))}ngOnInit(){const e=this.state.params.board_id.toString();this.board$=this.apiV3Service.boards.id(e).requireAndStream().pipe((0,ie.b)(n=>this.setupQueryUpdatedMonitoring(n))),this.Boards.currentBoard$.next(e),this.boardListCrossSelectionService.selections().pipe(this.untilDestroyed(),(0,x.h)(n=>null!==n.focusedWorkPackage),(0,x.h)(()=>this.state.includes(`${this.state.current.data.baseRoute}.details`))).subscribe(n=>{this.state.go(`${this.state.current.data.baseRoute}.details`,{workPackageId:n.focusedWorkPackage})})}moveList(e,n){(0,L.bA)(e.queries,n.previousIndex,n.currentIndex),this.saveBoard(e)}removeList(e,n){e.removeQuery(n),this.saveBoard(e)}addList(e){if(e.isFree)return this.BoardList.addFreeQuery(e,{name:this.text.unnamedList}).then(i=>this.Boards.save(i).toPromise()).catch(i=>this.showError(i));const n=this.getActionFiltersFromWidget(e);this.opModalService.show(xt,this.injector,{board:e,active:n})}changeVisibilityOfList(e,n,i){i||(this.showHiddenListWarning=!0,this.boardWidgets=this.boardWidgets.filter(r=>r.id!==n.id))}saveBoard(e){this.boardComponent.boardSaver.request(e)}setupQueryUpdatedMonitoring(e){this.currentQueryUpdatedMonitoring&&this.currentQueryUpdatedMonitoring.unsubscribe(),this.boardWidgets=e.queries,this.currentQueryUpdatedMonitoring=this.QueryUpdated.monitor(e.queries.map(n=>n.options.queryId)).pipe(this.untilDestroyed()).subscribe(n=>this.requestRefreshOfUpdatedLists(n.elements))}showError(e=this.text.loadingError){this.toastService.addError(e)}requestRefreshOfUpdatedLists(e){e.forEach(n=>{this.lists.filter(i=>n.id.toString()===i.resource.options.queryId.toString()).forEach(i=>i.refreshQueryUnlessCaused(n,!1))})}getActionFiltersFromWidget(e){return e.grid.widgets.map(n=>{const i=this.boardActionRegistry.get(e.actionAttribute),{filterName:r}=i,a=n.options,c=_.find(a.filters,d=>!!d[r]);if(c)return c[r].values[0]||null}).filter(n=>void 0!==n)}}yt.\u0275fac=function(e){return new(e||yt)(t.Y36(u.D),t.Y36(C.StateService),t.Y36(ot.kl),t.Y36(it.W),t.Y36(K),t.Y36(Wt.s),t.Y36(rt.X),t.Y36(Z.S),t.Y36(t.zs3),t.Y36(v.T),t.Y36(T.$),t.Y36(kn.j),t.Y36(M),t.Y36(Ft.f),t.Y36(ne.j),t.Y36(v.T),t.Y36(N))},yt.\u0275cmp=t.Xpm({type:yt,selectors:[["ng-component"]],viewQuery:function(e,n){if(1&e&&(t.Gf(Bn,5),t.Gf(P,5)),2&e){let i;t.iGM(i=t.CRH())&&(n.container=i.first),t.iGM(i=t.CRH())&&(n.lists=i)}},features:[t._Bn([M]),t.qOj],decls:2,vars:3,consts:[[4,"ngIf"],["class","boards-list--container","cdkDropList","","cdkDropListOrientation","horizontal",3,"ngClass","cdkDropListDisabled","cdkDropListDropped",4,"ngIf"],["opReferrer","boards#board-show",3,"moreInfoLink","leftMargin","linkMessage","textMessage",4,"ngIf"],["cdkDropList","","cdkDropListOrientation","horizontal",1,"boards-list--container",3,"ngClass","cdkDropListDisabled","cdkDropListDropped"],["container",""],["class","boards-list--item","wp-isolated-query-space","","cdkDrag","","vsDragScroll","",3,"cdkDragData","vsDragScrollContainer",4,"ngFor","ngForOf","ngForTrackBy"],["class","boards-list--tooltip tooltip--right",4,"ngIf"],["class","boards-list--add-item -no-text-select",3,"click",4,"ngIf"],["wp-isolated-query-space","","cdkDrag","","vsDragScroll","",1,"boards-list--item",3,"cdkDragData","vsDragScrollContainer"],["class","boards-list-item-handle icon icon-drag-handle","cdkDragHandle","",4,"ngIf"],[3,"resource","board","onRemove","visibilityChange"],["cdkDragHandle","",1,"boards-list-item-handle","icon","icon-drag-handle"],[1,"boards-list--tooltip","tooltip--right"],[1,"icon","icon-attention"],[1,"boards-list--add-item","-no-text-select",3,"click"],[1,"boards-list--add-item-text"],["icon-classes","icon-add icon-context"],[3,"textContent"],["opReferrer","boards#board-show",3,"moreInfoLink","leftMargin","linkMessage","textMessage"]],template:function(e,n){1&e&&(t.YNc(0,Jn,3,2,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,n.board$))},directives:[p.O5,L.Wj,p.mk,p.sg,te.A,L.Zt,Q,P,L.Bh,mt.o,Dn.P],pipes:[p.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.boards-list--container[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;flex-grow:1;height:100%;overflow-y:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.boards-list--container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.boards-list--container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.boards-list--container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.boards-list--container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.boards-list--container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.boards-list-item-handle[_ngcontent-%COMP%]{position:absolute;font-size:14px;left:0;top:18px;z-index:100;opacity:0;cursor:grab}.boards-list--container.-free[_ngcontent-%COMP%]   .boards-list-item-handle[_ngcontent-%COMP%]{top:13px}.boards-list-item-handle[_ngcontent-%COMP%]:before{padding:0;color:var(--light-gray)}.boards-list--item[_ngcontent-%COMP%]:hover   .boards-list-item-handle[_ngcontent-%COMP%]{opacity:1}.boards-list--add-item[_ngcontent-%COMP%]{flex:0 0 auto;height:42px;line-height:42px;font-size:14px;cursor:pointer;color:var(--gray-dark)}.boards-list--add-item[_ngcontent-%COMP%]   .boards-list--add-item-text[_ngcontent-%COMP%]{padding:5px 15px 0}.boards-list--container.-free[_ngcontent-%COMP%]   .boards-list--add-item[_ngcontent-%COMP%]{margin-top:0}.boards-list--add-item[_ngcontent-%COMP%]:hover{color:var(--body-font-color)}.boards-list--item[_ngcontent-%COMP%]{flex:0 0 300px;max-width:300px;position:relative}.boards-list--item[_ngcontent-%COMP%]:first-of-type{margin-left:5px}.boards-list--item.cdk-drag-placeholder[_ngcontent-%COMP%]{border:1px dashed var(--primary-color);pointer-events:none}.boards-list--item.cdk-drag-placeholder[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:hidden}.boards-list--tooltip[_ngcontent-%COMP%]{align-self:start;margin-top:18px}"]});var Nn=s(46430),Un=s(85603);const Pt="board-view-menu-item",Hn=[{name:"boards",parent:"optional_project",url:"/boards/?query_props",data:{bodyClasses:"router--boards-view-base",menuItem:Pt},params:{query_props:{type:"opQueryString",dynamic:!0}},redirectTo:"boards.list",component:gt},{name:"boards.list",component:bt,data:{parent:"boards",bodyClasses:"router--boards-list-view",menuItem:Pt}},{name:"boards.partitioned",url:"{board_id}",params:{board_id:{type:"int"},isNew:{type:"bool",inherit:!1,dynamic:!0}},data:{parent:"boards",bodyClasses:"router--boards-full-view",menuItem:Pt},reloadOnSearch:!1,component:K,redirectTo:"boards.partitioned.show"},{name:"boards.partitioned.show",url:"",data:{baseRoute:"boards.partitioned.show"},views:{"content-left":{component:yt}}},...(0,Nn.Z)("boards.partitioned.show",Pt,Un.o)];var $n=s(74990);class tt{}tt.\u0275fac=function(e){return new(e||tt)},tt.\u0275mod=t.oAB({type:tt}),tt.\u0275inj=t.cJS({imports:[[se.H,ae.H,ce.K,G,$n.C,at.wA.withComponents([X]),et.UIRouterModule.forChild({states:Hn,config:function(o){o.urlService.rules.when(new RegExp("^/projects/(.*)/boards$"),e=>`/projects/${e[1]}/boards/`)}})]]}),t.B6R(P,[p.mk,p.O5,at.B5,at.oc,Lt.s5,E,st,mt.o,Vt.x],[])}}]);
//# sourceMappingURL=src_app_features_boards_openproject-boards_module_ts.0f090df33d3239ecbe40.js.map