(self.webpackChunkopenproject_frontend=self.webpackChunkopenproject_frontend||[]).push([[6243],{36243:(st,rt,ot)=>{"use strict";ot.r(rt),ot.d(rt,{start:()=>o});var V=ot(12630);function ht(n,h){let g;g="basic"===n?h===V.vV.demo?"Basic board":"Task board":"Kanban";const _="basic"===n?"basic":"kanban";return[{"next .board-view-menu-item":I18n.t("js.onboarding.steps.boards.overview"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},onNext(){jQuery(".board-view-menu-item ~ .toggler")[0].click(),(0,V.br)(".op-sidemenu--items","#main-menu",()=>{jQuery(`.op-sidemenu--item-action:contains(${g})`)[0].click()})}},{'next [data-qa-selector="op-board-list"]':I18n.t(`js.onboarding.steps.boards.lists_${_}`),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark -hidden-arrow",timeout:()=>new Promise(y=>{(0,V.br)(".op-wp-single-card","#content",()=>{y(void 0)})})},{'next [data-qa-selector="op-board-list--card-dropdown-add-button"]':I18n.t("js.onboarding.steps.boards.add"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},condition:()=>0!==document.getElementsByClassName("op-board-list--add-button").length},{"next .boards-list--container":I18n.t("js.onboarding.steps.boards.drag"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark -hidden-arrow",onNext(){const l=Array.from(document.getElementsByClassName("main-menu--arrow-left-to-project")).find(p=>"Boards"===p.nextElementSibling.innerText);l&&l.click()}}]}function f(n,h,g){window.onboardingTourInstance=new window.EnjoyHint({onStart(){jQuery("#content-wrapper, #menu-sidebar").addClass("-hidden-overflow")},onEnd(){sessionStorage.setItem(V.PI,n),jQuery("#content-wrapper, #menu-sidebar").removeClass("-hidden-overflow")},onSkip(){sessionStorage.setItem(V.PI,"skipped"),h&&jQuery(h).removeClass("-disabled").unbind("click",V.vx),g&&jQuery.each((0,V.Lt)(),(_,y)=>{jQuery(y).off("click")}),jQuery("#content-wrapper, #menu-sidebar").removeClass("-hidden-overflow")}})}function d(n){window.onboardingTourInstance.set(n),window.onboardingTourInstance.run()}function e(n){return document.getElementsByClassName(`${n}-view-menu-item`).length>0}function c(n=V.vV.demo){f("mainTourFinished");const h="true"===jQuery("meta[name=boards_demo_data_available]").attr("content"),g="true"===jQuery("meta[name=demo_view_of_type_team_planner_seeded]").attr("content"),_=!jQuery("body").hasClass("ee-banners-visible");(0,V.br)(".work-package--results-tbody","#content",()=>{let y=[{"next .wp-table--row":I18n.t("js.onboarding.steps.wp.list"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},onNext(){jQuery(".inline-edit--display-field.id a ")[0].click()}},{"next .work-packages-full-view--split-left":I18n.t("js.onboarding.steps.wp.full_view"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark -hidden-arrow"},{"next .work-packages-back-button":I18n.t("js.onboarding.steps.wp.back_button"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},onNext(){jQuery(".work-packages-back-button")[0].click()}},{"next .add-work-package":I18n.t("js.onboarding.steps.wp.create_button"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},shape:"circle",timeout:()=>new Promise(n=>{(0,V.br)("#work-packages-filter-toggle-button .badge","#content",()=>{n(void 0)})}),onNext(){jQuery("#wp-view-toggle-button").click()}},{"next #wp-view-toggle-button":I18n.t("js.onboarding.steps.wp.timeline_button"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},bottom:"-64",onNext(){jQuery("#wp-view-context-menu .icon-view-timeline")[0].click()}},{"next .work-packages-tabletimeline--timeline-side":I18n.t("js.onboarding.steps.wp.timeline"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark -hidden-arrow"},{"next .main-menu--arrow-left-to-project":I18n.t("js.onboarding.steps.sidebar_arrow"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},onNext(){jQuery(".main-menu--arrow-left-to-project")[0].click()}}];_?(h&&e("board")&&(y=y.concat(ht("enterprise",n))),g&&e("team-planner")&&(y=y.concat([{"next .team-planner-view-menu-item":I18n.t("js.onboarding.steps.team_planner.overview"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},onNext(){jQuery(".team-planner-view-menu-item ~ .toggler")[0].click(),(0,V.br)(".op-sidemenu--items","#main-menu",()=>{jQuery(".op-sidemenu--item-action:contains('Team planner')")[0].click()})}},{'next [data-qa-selector="op-team-planner--calendar-pane"]':I18n.t("js.onboarding.steps.team_planner.calendar"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark -hidden-arrow",timeout:()=>new Promise(n=>{(0,V.br)(".op-wp-single-card","#content",()=>{n(void 0)})})},{'next [data-qa-selector="tp-assignee-add-button"]':I18n.t("js.onboarding.steps.team_planner.add_assignee"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")}},{'next [data-qa-selector="op-team-planner--add-existing-toggle"]':I18n.t("js.onboarding.steps.team_planner.add_existing"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")}},{'next [data-qa-selector="op-wp-single-card"]':I18n.t("js.onboarding.steps.team_planner.card"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},onNext(){const n=document.querySelector('li[data-name="team_planner_view"] .main-menu--arrow-left-to-project');n&&n.click()}}]))):h&&e("board")&&(y=y.concat(ht("basic",n))),y=y.concat([{"next .members-menu-item":I18n.t("js.onboarding.steps.members"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},condition:()=>0!==document.getElementsByClassName("members-menu-item").length},{"next .wiki-menu--main-item":I18n.t("js.onboarding.steps.wiki"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},condition:()=>0!==document.getElementsByClassName("wiki-menu--main-item").length},{"next .op-quick-add-menu":I18n.t("js.onboarding.steps.quick_add_button"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},condition:()=>0!==document.getElementsByClassName("op-quick-add-menu--icon").length},{"next .op-app-help":I18n.t("js.onboarding.steps.help_menu"),shape:"circle",showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.got_it")}}]),d(y)})}function o(n,h){switch(n){case"prepareBacklogs":f("prepareTaskBoardTour"),d([{"next .backlogs-menu-item":I18n.t("js.onboarding.steps.backlogs.overview"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark -hidden-arrow",onNext(){jQuery(".backlogs-menu-item")[0].click()}}]);break;case"backlogs":f("startTaskBoardTour"),d([{"next #content-wrapper":I18n.t("js.onboarding.steps.backlogs.sprints"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark -hidden-arrow"},{event_type:"next",selector:"#sprint_backlogs_container .backlog .menu-trigger",description:I18n.t("js.onboarding.steps.backlogs.task_board_arrow"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},onNext(){jQuery("#sprint_backlogs_container .backlog .menu-trigger")[0].click()}},{event_type:"next",selector:"#sprint_backlogs_container .backlog .menu .items",description:I18n.t("js.onboarding.steps.backlogs.task_board_select"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark",onNext(){jQuery("#sprint_backlogs_container .backlog .show_task_board")[0].click()}}]);break;case"taskboard":f("startMainTourFromBacklogs"),d([{"next #content-wrapper":I18n.t("js.onboarding.steps.backlogs.task_board"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-dark -hidden-arrow",condition:()=>0!==document.getElementsByClassName("backlogs-menu-item").length},{"next #main-menu-work-packages-wrapper":I18n.t("js.onboarding.steps.wp.toggler"),showSkip:!1,nextButton:{text:I18n.t("js.onboarding.buttons.next")},onNext(){jQuery("#main-menu-work-packages")[0].click()}}]);break;case"homescreen":f("startProjectTour",".widget-box--blocks--buttons a",!0),d([{"next .op-app-header":I18n.t("js.onboarding.steps.welcome"),skipButton:{className:"enjoyhint_btn-transparent",text:I18n.t("js.onboarding.buttons.skip")},nextButton:{text:I18n.t("js.onboarding.buttons.next")},containerClass:"-hidden-arrow",bottom:7},{description:I18n.t("js.onboarding.steps.project_selection"),selector:".widget-box.welcome",event:"custom",showSkip:!1,containerClass:"-dark -hidden-arrow",clickable:!0,onBeforeStart(){jQuery(`.widget-box.welcome a:contains(${V.wh})`).click(function(){window.onboardingTourInstance.trigger("next"),window.location.href=`${this.href}/?start_scrum_onboarding_tour=true`}),jQuery(`.widget-box.welcome a:contains(${V.RO})`).click(function(){window.onboardingTourInstance.trigger("next"),window.location.href=`${this.href}/work_packages/?start_onboarding_tour=true`}),jQuery(".widget-box.welcome a").addClass("-disabled").bind("click",V.vx)}}]);break;case"main":c(h)}}ot(35883)},35883:(st,rt,ot)=>{var V,ht,$;!function(K){var r,i,a,s,f,d,e,o,_,y,l;window.EnjoyHint=function(r){var i,a=this,f=K.extend({onStart:function(){},onEnd:function(){},onSkip:function(){},onNext:function(){}},r),d=[],e=0;$body=K("body");var o=function(m){m.preventDefault()},n=function(){K(".enjoyhint").remove(),$body.css({overflow:"auto"}),$body.removeClass("enjoyhint-tutorial"),K(document).off("touchmove",o)};a.clear=function(){var m=K(".enjoyhint_next_btn"),w=K(".enjoyhint_skip_btn");m.removeClass(a.nextUserClass),m.text("Next"),w.removeClass(a.skipUserClass),w.text("Skip")};var h=function(){if(!d||!d[e])return $body.enjoyhint("hide"),f.onEnd(),void n();f.onNext();var m=K(".enjoyhint"),w=d[e];if(w.condition&&!w.condition())return e++,void h();if(m.removeClass(),m.addClass("enjoyhint enjoyhint-step-"+(e+1)),w.clickable&&m.addClass("-clickable"),w.containerClass&&m.addClass(w.containerClass),w.onBeforeStart&&"function"==typeof w.onBeforeStart&&w.onBeforeStart(),w.timeout&&"function"==typeof w.timeout)w.timeout().then(function(){k()});else{var P=w.timeout||0;setTimeout(function(){k()},P)}function k(){if(!w.selector)for(var x in w)w.hasOwnProperty(x)&&x.split(" ")[1]&&(w.selector=x.split(" ")[1],w.event=x.split(" ")[0],("next"==x.split(" ")[0]||"auto"==x.split(" ")[0]||"custom"==x.split(" ")[0])&&(w.event_type=x.split(" ")[0]),w.description=w[x]);setTimeout(function(){a.clear()},250),K(document.body).scrollTop(w.selector,w.scrollAnimationSpeed||250,{offset:-100}),setTimeout(function(){var D=K(w.selector),u=y(w.event);if($body.enjoyhint("show"),$body.enjoyhint("hide_next"),i=D,w.event_selector&&(i=K(w.event_selector)),!w.event_type&&"key"==w.event&&D.keydown(function(W){W.which==w.keyCode&&(e++,h())}),1==w.showNext&&$body.enjoyhint("show_next"),0==w.showSkip?$body.enjoyhint("hide_skip"):$body.enjoyhint("show_skip"),w.showSkip,w.nextButton){var v=K(".enjoyhint_next_btn");v.addClass(w.nextButton.className||""),v.text(w.nextButton.text||"Next"),a.nextUserClass=w.nextButton.className}if(w.skipButton){var b=K(".enjoyhint_skip_btn");b.addClass(w.skipButton.className||""),b.text(w.skipButton.text||"Skip"),a.skipUserClass=w.skipButton.className}if(w.event_type)switch(w.event_type){case"auto":return D[w.event](),w.event,e++,void h();case"custom":l(w.event,function(){e++,p(w.event),h()});break;case"next":$body.enjoyhint("show_next")}else i.on(u,function(W){w.keyCode&&W.keyCode!=w.keyCode||(e++,K(this).off(u),h())});var F=Math.max(D.outerWidth(),D.outerHeight()),T=w.radius||Math.round(F/2)+5,M=D.offset(),I=D.outerWidth(),B=D.outerHeight(),j=void 0!==w.margin?w.margin:10,C={x:M.left+Math.round(I/2),y:M.top+Math.round(B/2)-K(document).scrollTop()},G={enjoyHintElementSelector:w.selector,center_x:C.x,center_y:C.y,text:w.description,top:w.top,bottom:w.bottom,left:w.left,right:w.right,margin:w.margin,scroll:w.scroll};w.shape&&"circle"==w.shape?(G.shape="circle",G.radius=T):(G.radius=0,G.width=I+j,G.height=B+j),$body.enjoyhint("render_label_with_shape",G,a.stop)},w.scrollAnimationSpeed+20||270)}},g=function(){e++,h()},_=function(){var m=d[e],w=K(m.selector);p(m.event),w.off(y(m.event)),n()},y=function(m,w){return m+(w?"custom":"")+".enjoy_hint"},l=function(m,w){$body.on(y(m,!0),w)},p=function(m){$body.off(y(m,!0))};window.addEventListener("resize",function(){null!=i&&$body.enjoyhint("redo_events_near_rect",i[0].getBoundingClientRect())}),a.stop=function(){_()},a.reRunScript=function(m){e=m,h()},a.runScript=function(){e=0,f.onStart(),h()},a.resumeScript=function(){h()},a.setCurrentStep=function(m){e=m},a.getCurrentStep=function(){return e},a.trigger=function(m){switch(m){case"next":g();break;case"skip":_()}},a.setScript=function(m){m&&(d=m)},a.set=function(m){a.setScript(m)},a.setSteps=function(m){a.setScript(m)},a.run=function(){a.runScript()},a.resume=function(){a.resumeScript()},K(".enjoyhint")&&K(".enjoyhint").remove(),$body.css({overflow:"hidden"}),$body.addClass("enjoyhint-tutorial"),K(document).on("touchmove",o),$body.enjoyhint({onNextClick:function(){d[e].onNext&&"function"==typeof d[e].onNext&&d[e].onNext(),g()},onSkipClick:function(){f.onSkip(),_()}})},CanvasRenderingContext2D.prototype.roundRect=function(r,i,a,s,f){return a<2*f&&(f=a/2),s<2*f&&(f=s/2),this.beginPath(),this.moveTo(r+f,i),this.arcTo(r+a,i,r+a,i+s,f),this.arcTo(r+a,i+s,r,i+s,f),this.arcTo(r,i+s,r,i,f),this.arcTo(r,i,r+a,i,f),this.closePath(),this},r=window.jQuery,_=window.innerWidth,y=window.innerHeight,l={init:function(p){return this.each(function(){this.enjoyhint_obj={},(i=this.enjoyhint_obj).resetComponentStuff=function(){a=null,s=null,f=null,d=null,e=null,o=null,_=window.innerWidth,y=window.innerHeight};var w=r(this);function P(C,G){var W=document.createElementNS("http://www.w3.org/2000/svg",C);for(var Y in G)W.setAttribute(Y,G[Y]);return W}i.options=jQuery.extend({onNextClick:function(){},onSkipClick:function(){},animation_time:800},p),i.gcl={chooser:"enjoyhint"},i.cl={enjoy_hint:"enjoyhint",hide:"enjoyhint_hide",disable_events_element:"enjoyhint_disable_events",btn:"enjoyhint_btn",skip_btn:"enjoyhint_skip_btn",close_btn:"enjoyhint_close_btn",next_btn:"enjoyhint_next_btn",main_canvas:"enjoyhint_canvas",main_svg:"enjoyhint_svg",svg_wrapper:"enjoyhint_svg_wrapper",svg_transparent:"enjoyhint_svg_transparent",kinetic_container:"kinetic_container"},i.canvas_size={w:1.4*r(window).width(),h:1.4*r(window).height()},i.enjoyhint=r("<div>",{class:i.cl.enjoy_hint+" "+i.cl.svg_transparent}).appendTo(w),i.enjoyhint_svg_wrapper=r("<div>",{class:i.cl.svg_wrapper+" "+i.cl.svg_transparent}).appendTo(i.enjoyhint),i.$stage_container=r('<div id="'+i.cl.kinetic_container+'">').appendTo(i.enjoyhint),i.$canvas=r('<canvas id="enj_canvas" width="'+i.canvas_size.w+'" height="'+i.canvas_size.h+'" class="'+i.cl.main_canvas+'">').appendTo(i.enjoyhint),i.$svg=r('<svg width="'+i.canvas_size.w+'" height="'+i.canvas_size.h+'" class="'+i.cl.main_canvas+" "+i.cl.main_svg+'">').appendTo(i.enjoyhint_svg_wrapper);var x=r(P("defs")),D=r(P("marker",{id:"arrowMarker",viewBox:"0 0 36 21",refX:"21",refY:"10",markerUnits:"strokeWidth",orient:"auto",markerWidth:"16",markerHeight:"12"})),u=r(P("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:2",d:"M0,0 c30,11 30,9 0,20"}));x.append(D.append(u)).appendTo(i.$svg),i.kinetic_stage=new t.Stage({container:i.cl.kinetic_container,width:i.canvas_size.w,height:i.canvas_size.h,scaleX:1}),i.layer=new t.Layer,i.rect=new t.Rect({fill:"rgba(0,0,0,0.6)",width:i.canvas_size.w,height:i.canvas_size.h});var v=r("<div>",{class:i.cl.disable_events_element}).appendTo(i.enjoyhint),b=v.clone().appendTo(i.enjoyhint),F=v.clone().appendTo(i.enjoyhint),T=v.clone().appendTo(i.enjoyhint),M=function(C){C.stopImmediatePropagation()};r("button").focusout(M),v.click(M),b.click(M),F.click(M),T.click(M),i.$skip_btn=r("<div>",{class:i.cl.skip_btn}).appendTo(i.enjoyhint).html("Skip").click(function(C){i.hide(),i.options.onSkipClick()}),i.$next_btn=r("<div>",{class:i.cl.next_btn}).appendTo(i.enjoyhint).html("Next").click(function(C){i.options.onNextClick()}),i.$close_btn=r("<div>",{class:i.cl.close_btn}).appendTo(i.enjoyhint).html("").click(function(C){i.hide(),i.options.onSkipClick()}),i.$canvas.mousedown(function(C){r("canvas").css({left:"4000px"});try{var G=document.elementFromPoint(C.clientX,C.clientY);r("canvas").css({left:"0px"}),r(G).click()}catch(W){console.error("Failed to click on element from point. "+W)}return!1});var B=130;return i.shape=new t.Shape({radius:0,center_x:-B,center_y:-B,width:0,height:0,sceneFunc:function(C){var G=this.getContext("2d")._context,Y=(this.pos,G.globalCompositeOperation);G.globalCompositeOperation="destination-out",G.beginPath();var E=this.attrs.center_x-Math.round(this.attrs.width/2),O=this.attrs.center_y-Math.round(this.attrs.height/2);G.roundRect(E,O,this.attrs.width,this.attrs.height,this.attrs.radius),G.fillStyle="red",G.fill(),G.globalCompositeOperation=Y}}),i.shape.radius=0,i.layer.add(i.rect),i.layer.add(i.shape),i.kinetic_stage.add(i.layer),r(window).on("resize",function(){if(!r(i.stepData.enjoyHintElementSelector).is(":visible"))return i.stopFunction(),void r(window).off("resize");window.innerWidth,window.innerHeight;var C=r(i.stepData.enjoyHintElementSelector)[0].getBoundingClientRect();i.shape.attrs.center_x=Math.round(C.left+C.width/2),i.shape.attrs.center_y=Math.round(C.top+C.height/2),i.shape.attrs.width=C.width+11,i.shape.attrs.height=C.height+11;var G=window.innerWidth,W=window.innerHeight,Y=G/_,E=W/y;if(i.kinetic_stage.setAttr("width",_*Y),i.kinetic_stage.setAttr("height",y*E),null!=i.stepData){if(window.innerWidth,window.innerHeight,e||(e=i.shape.attrs.center_x,i.shape.attrs.center_y),!f){f=[];var O=r("#enjoyhint_arrpw_line").attr("d");f.push(O.substr(1).split(",")[0]),f.push(O.substr(O.indexOf("Q")+1).split(",")[0]),f.push(O.split(" ")[2].split(",")[0]),(d=[]).push(O.split(",")[1].split(" ")[0]),d.push(O.split(",")[2].split(" ")[0]),d.push(O.split(",")[3])}var H=r(".enjoy_hint_label");a||(a=H[0].getBoundingClientRect().left,s=H[0].getBoundingClientRect().top);var z=r(".enjoyhint_skip_btn");o||(o=z[0].getBoundingClientRect().left,z[0].getBoundingClientRect().top),H.css("left",window.innerWidth/2-H.outerWidth()/2);var R=H[0].getBoundingClientRect();if(window.innerWidth<640)r("#enjoyhint_arrpw_line").hide(),H.css("top",window.innerHeight/2-H.outerHeight()/2);else{r("#enjoyhint_arrpw_line").show(),H.css("top",s);var L,U,S,A,N=R.left+R.width/2<i.shape.attrs.center_x,X=R.top+R.height/2<i.shape.attrs.center_y;window.innerWidth<900?(L=Math.round(R.left+(R.width/2+15)*(R.left+R.width/2<i.shape.attrs.center_x?1:-1)),S=Math.round(R.top+R.height*(R.top+R.height/2<i.shape.attrs.center_y?1:-1)),U=Math.round(i.shape.attrs.center_x+(i.shape.attrs.radius+15)*(N?-1:1)),A=Math.round(i.shape.attrs.center_y)):(L=Math.round(R.left+R.width/2+(R.width/2+15)*(N?1:-1)),S=Math.round(R.top+R.height/2),U=Math.round(i.shape.attrs.center_x),A=Math.round(i.shape.attrs.center_y+(i.shape.attrs.height/2+15)*(X?-1:1)));var J=L<U?U:L,et=S<A?S:A;Math.abs(R.left+R.width/2-i.shape.attrs.center_x)<200&&(J=L=U=R.left+R.width/2,et=S=R.top,console.log("ok")),window.innerWidth<900&&(J=L<U?L:U,et=S<A?A:S);var ct="M%d1,%d2 Q%d3,%d4 %d5,%d6".replace("%d1",L).replace("%d2",S).replace("%d3",J).replace("%d4",et).replace("%d5",U).replace("%d6",A);r("#enjoyhint_arrpw_line")[0].setAttribute("d",ct)}var at=+o+(i.shape.attrs.center_x-e)/2;z.css("left",at<15?15:at),z.css("top",R.top+R.height+20)}i.rect=new t.Rect({fill:"rgba(0,0,0,0.6)",width:window.innerWidth,height:window.innerHeight}),i.layer.removeChildren(),i.layer.add(i.rect),i.layer.add(i.shape),i.layer.draw(),i.kinetic_stage.draw()}),i.enjoyhint,i.show=function(){i.enjoyhint.removeClass(i.cl.hide)},i.hide=function(){i.enjoyhint.addClass(i.cl.hide),new t.Tween({node:i.shape,duration:.002,center_x:-B,center_y:-B}).play()},i.hide(),i.hideNextBtn=function(){i.$next_btn.addClass(i.cl.hide),i.nextBtn="hide"},i.showNextBtn=function(){i.$next_btn.removeClass(i.cl.hide),i.nextBtn="show"},i.hideSkipBtn=function(){i.$skip_btn.addClass(i.cl.hide)},i.showSkipBtn=function(){i.$skip_btn.removeClass(i.cl.hide)},i.renderCircle=function(C){var G=C.r||0,W=C.x||0,Y=C.y||0;new t.Tween({node:i.shape,duration:.2,center_x:W,center_y:Y,width:2*G,height:2*G,radius:G}).play();var O=W-G,H=W+G,z=Y-G,R=Y+G;return{x:W,y:Y,left:O,right:H,top:z,bottom:R,conn:{left:{x:O-20,y:Y},right:{x:H+20,y:Y},top:{x:W,y:z-20},bottom:{x:W,y:R+20}}}},i.renderRect=function(C,G){var W=C.r||0,Y=C.x||0,E=C.y||0,O=C.w||0,H=C.h||0;new t.Tween({node:i.shape,duration:G,center_x:Y,center_y:E,width:O,height:H,radius:W}).play();var L=Math.round(O/2),U=Math.round(H/2),S=Y-L,A=Y+L,N=E-U,X=E+U;return{x:Y,y:E,left:S,right:A,top:N,bottom:X,conn:{left:{x:S-20,y:E},right:{x:A+20,y:E},top:{x:Y,y:N-20},bottom:{x:Y,y:X+20}}}},i.renderLabel=function(C){var G=C.x||0;i.originalElementX=G;var W=C.y||0,E=(C.text,i.getLabelElement({x:G,y:W,text:C.text})),O=E.width(),H=E.height(),z=E.offset().left,R=E.offset().left+O,L=E.offset().top-r(document).scrollTop(),U=E.offset().top+H,A={x:z-10,y:L+Math.round(H/2)},N={x:R+10,y:L+Math.round(H/2)},X={x:z+Math.round(O/2),y:L-10},Q={x:z+Math.round(O/2),y:U+10};return E.detach(),setTimeout(function(){r("#enjoyhint_label").remove(),E.appendTo(i.enjoyhint)},i.options.animation_time/2),{label:E,left:z,right:R,top:L,bottom:U,conn:{left:A,right:N,top:X,bottom:Q}}},i.renderArrow=function(C){if(window.innerWidth>=640){var G=C.x_from||0,W=C.y_from||0,Y=C.x_to||0,E=C.y_to||0,O=C.by_top_side,H=0,z=0;O?W>=E?(z=E,H=G):(z=W,H=Y):W>=E?(z=W,H=Y):(z=E,H=G)}C.text,i.enjoyhint.addClass(i.cl.svg_transparent),setTimeout(function(){r("#enjoyhint_arrpw_line").remove();var L="M"+G+","+W+" Q"+H+","+z+" "+Y+","+E;i.$svg.append(P("path",{style:"fill:none; stroke:rgb(255,255,255); stroke-width:3","marker-end":"url("+location.href+"#arrowMarker)",d:L,id:"enjoyhint_arrpw_line"})),i.enjoyhint.removeClass(i.cl.svg_transparent)},i.options.animation_time/2)},i.getLabelElement=function(C){return r("<div>",{class:"enjoy_hint_label",id:"enjoyhint_label"}).css({top:C.y+"px",left:C.x+"px"}).html(C.text).appendTo(i.enjoyhint)},i.disableEventsNearRect=function(C){v.css({top:"0",left:"0"}).height(C.top),b.css({top:C.bottom+"px",left:"0"}),F.css({top:"0",left:"0px"}).width(C.left),T.css({top:"0",left:C.right+"px"})},jQuery.event.special.destroyed={remove:function(G){G.handler&&G.handler()}},i.renderLabelWithShape=function(C){i.stepData=C;var W=function G(it){return"MD-DIALOG"===it.tagName?it:void 0===it.tagName?null:G(r(it).parent()[0])}(r(i.stepData.enjoyHintElementSelector)[0]);null!=W&&r(W).on("dialogClosing",function(){i.stopFunction()}),i.resetComponentStuff();var Y=C.shape||"rect",E={},O=0,H=0,z_top=C.top||0,z_bottom=C.bottom||0,z_left=C.left||0,z_right=C.right||0;switch(Y){case"circle":O=H=C.radius;var L=(R={top:C.center_y-H+z_top,bottom:C.center_y+H-z_bottom,left:C.center_x-O+z_left,right:C.center_x+O-z_right}).right-R.left,U=R.bottom-R.top;C.radius=Math.round(Math.min(L,U)/2),O=H=Math.round(C.radius/2);var S=Math.round(L/2),A=Math.round(U/2);C.center_x=R.left+S,C.center_y=R.top+A,E=i.renderCircle({x:C.center_x,y:C.center_y,r:C.radius});break;case"rect":O=Math.round(C.width/2),H=Math.round(C.height/2);var R={top:C.center_y-H+z_top,bottom:C.center_y+H-z_bottom,left:C.center_x-O+z_left,right:C.center_x+O-z_right};C.width=R.right-R.left,C.height=R.bottom-R.top,O=Math.round(C.width/2),H=Math.round(C.height/2),C.center_x=R.left+O,C.center_y=R.top+H,E=i.renderRect({x:C.center_x,y:C.center_y,w:C.width,h:C.height,r:C.radius},.2)}i.enjoyhint.width();var N_h=i.enjoyhint.height(),X=i.getLabelElement({x:0,y:0,text:C.text}),Q=X.outerWidth(),q=X.outerHeight();X.remove();var J=C.center_y-H,et=N_h-(C.center_y+H),mt=(C.center_x,C.center_x,C.center_x,C.center_x,150+q+40),yt=H+150,lt="top"==(N_h-C.center_y<C.center_y?"top":"bottom")?C.center_y-yt-q:C.center_y+yt,wt=window.innerWidth/2-Q/2;J<mt&&et<mt&&(lt=C.center_y+40),window.innerWidth;var Z=i.renderLabel({x:wt,y:lt,text:C.text}),St=window.innerWidth/2-i.$next_btn.width()/2;i.$next_btn.css({left:St,top:lt+q+20});var bt=St+i.$next_btn.width()+30;"hide"==i.nextBtn&&(bt=wt),i.$skip_btn.css({left:bt,top:lt+q+20}),i.$close_btn.css({right:10,top:10}),i.disableEventsNearRect({top:E.top,bottom:E.bottom,left:E.left,right:E.right});var xt=!1,Ct="left",kt="left",Dt=Z.left<=E.x&&Z.right>=E.x,Mt=Z.right<E.x,ft=(Z.left,E.x,Z.right,E.left,Z.left,E.right,Z.bottom<E.top),Ft=Z.top>E.bottom,It=Z.bottom>=E.y&&Z.top<=E.y,Gt=Z.bottom<=E.y&&!ft,Lt=Z.top>=E.y&&!Ft;function gt(it,pt,vt){Ct=it,kt=pt,xt=vt}function Tt(it,pt,vt,Nt,Rt){var tt=[];(tt=ft?it:Gt?pt:It?vt:Lt?Nt:Rt)&&gt(tt[0],tt[1],tt[2])}if(Dt)if(ft)gt("bottom","top","top");else{if(!Ft)return;gt("top","bottom","bottom")}else Mt?Tt(["right","top","top"],["bottom","left","bottom"],["right","left","top"],["top","left","top"],["right","bottom","bottom"]):Tt(["left","top","top"],["bottom","right","bottom"],["left","right","top"],["top","right","top"],["left","bottom","bottom"]);var Pt=Z.conn[Ct],At=E.conn[kt],jt="top"==xt;i.renderArrow({x_from:Pt.x,y_from:Pt.y,x_to:window.innerWidth<640?E.left+(E.left>0):At.x,y_to:window.innerWidth<640?E.conn.left.y:At.y,by_top_side:jt})},i.clear=function(){i.ctx.clearRect(0,0,3e3,2e3)},this})},set:function(p){return this.each(function(){this.enjoyhint_obj.setValue(p)}),this},show:function(){return this.each(function(){this.enjoyhint_obj.show()}),this},hide:function(){return this.each(function(){this.enjoyhint_obj.hide()}),this},hide_next:function(){return this.each(function(){this.enjoyhint_obj.hideNextBtn()}),this},show_next:function(){return this.each(function(){this.enjoyhint_obj.showNextBtn()}),this},hide_skip:function(){return this.each(function(){this.enjoyhint_obj.hideSkipBtn()}),this},show_skip:function(){return this.each(function(){this.enjoyhint_obj.showSkipBtn()}),this},render_circle:function(p,m,w){return this.each(function(){this.enjoyhint_obj.renderCircle(p,m,w)}),this},render_label:function(p,m,w){return this.each(function(){this.enjoyhint_obj.renderLabel(p,m,w)}),this},render_label_with_shape:function(p,m){return this.each(function(){i.stopFunction=m,this.enjoyhint_obj.renderLabelWithShape(p)}),this},redo_events_near_rect:function(p){i.disableEventsNearRect({top:p.top,bottom:p.bottom,left:p.left,right:p.right})},clear:function(){return this.each(function(){this.enjoyhint_obj.clear()}),this},close:function(p){return this.each(function(){this.enjoyhint_obj.closePopdown()}),this}},r.fn.enjoyhint=function(p){return l[p]?l[p].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof p&&p?(r.error("Method "+p+" does not exist on $.numinput"),this):l.init.apply(this,arguments)};var t={};(function(r){var i=Math.PI/180;(t={version:"5.2.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,showWarnings:!0,Filters:{},Node:function(a){this._init(a)},Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},BaseLayer:function(a){this.___init(a)},Layer:function(a){this.____init(a)},FastLayer:function(a){this.____init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=t.DD;return!!a&&a.isDragging},isDragReady:function(){var a=t.DD;return!!a&&!!a.node},_addId:function(a,s){void 0!==s&&(this.ids[s]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,s){if(void 0!==s)for(var f=s.split(/\s/g),d=0;d<f.length;d++){var e=f[d];e&&(void 0===this.names[e]&&(this.names[e]=[]),this.names[e].push(a))}},_removeName:function(a,s){if(void 0!==a){var f=this.names[a];if(void 0!==f){for(var d=0;d<f.length;d++){f[d]._id===s&&f.splice(d,1)}0===f.length&&delete this.names[a]}}},getAngle:function(a){return this.angleDeg?a*i:a},_parseUA:function(a){var s=a.toLowerCase(),f=/(chrome)[ \/]([\w.]+)/.exec(s)||/(webkit)[ \/]([\w.]+)/.exec(s)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(s)||/(msie) ([\w.]+)/.exec(s)||s.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(s)||[],d=!!a.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),e=!!a.match(/IEMobile/i);return{browser:f[1]||"",version:f[2]||"0",mobile:d,ieMobile:e}},UA:void 0}).UA=t._parseUA(r.navigator&&r.navigator.userAgent||"")})(this),function(r,i){var a=t;global.window===global&&(t.document=global.document,t.window=global),t.root=r,st.exports=a}(this),function(){t.Collection=function(){var l=[].slice.call(arguments),p=l.length,m=0;for(this.length=p;p>m;m++)this[m]=l[m];return this},t.Collection.prototype=[],t.Collection.prototype.each=function(l){for(var p=0;p<this.length;p++)l(this[p],p)},t.Collection.prototype.toArray=function(){var l,p=[],m=this.length;for(l=0;m>l;l++)p.push(this[l]);return p},t.Collection.toCollection=function(l){var p,m=new t.Collection,w=l.length;for(p=0;w>p;p++)m.push(l[p]);return m},t.Collection._mapMethod=function(l){t.Collection.prototype[l]=function(){var p,m=this.length,w=[].slice.call(arguments);for(p=0;m>p;p++)this[p][l].apply(this[p],w);return this}},t.Collection.mapMethods=function(l){var p=l.prototype;for(var m in p)t.Collection._mapMethod(m)},t.Transform=function(l){this.m=l&&l.slice()||[1,0,0,1,0,0]},t.Transform.prototype={copy:function(){return new t.Transform(this.m)},point:function(l){var p=this.m;return{x:p[0]*l.x+p[2]*l.y+p[4],y:p[1]*l.x+p[3]*l.y+p[5]}},translate:function(l,p){return this.m[4]+=this.m[0]*l+this.m[2]*p,this.m[5]+=this.m[1]*l+this.m[3]*p,this},scale:function(l,p){return this.m[0]*=l,this.m[1]*=l,this.m[2]*=p,this.m[3]*=p,this},rotate:function(l){var p=Math.cos(l),m=Math.sin(l),w=this.m[0]*p+this.m[2]*m,P=this.m[1]*p+this.m[3]*m,k=this.m[0]*-m+this.m[2]*p,x=this.m[1]*-m+this.m[3]*p;return this.m[0]=w,this.m[1]=P,this.m[2]=k,this.m[3]=x,this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(l,p){var m=this.m[0]+this.m[2]*p,w=this.m[1]+this.m[3]*p,P=this.m[2]+this.m[0]*l,k=this.m[3]+this.m[1]*l;return this.m[0]=m,this.m[1]=w,this.m[2]=P,this.m[3]=k,this},multiply:function(l){var p=this.m[0]*l.m[0]+this.m[2]*l.m[1],m=this.m[1]*l.m[0]+this.m[3]*l.m[1],w=this.m[0]*l.m[2]+this.m[2]*l.m[3],P=this.m[1]*l.m[2]+this.m[3]*l.m[3],k=this.m[0]*l.m[4]+this.m[2]*l.m[5]+this.m[4],x=this.m[1]*l.m[4]+this.m[3]*l.m[5]+this.m[5];return this.m[0]=p,this.m[1]=m,this.m[2]=w,this.m[3]=P,this.m[4]=k,this.m[5]=x,this},invert:function(){var l=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),p=this.m[3]*l,m=-this.m[1]*l,w=-this.m[2]*l,P=this.m[0]*l,k=l*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),x=l*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=p,this.m[1]=m,this.m[2]=w,this.m[3]=P,this.m[4]=k,this.m[5]=x,this},getMatrix:function(){return this.m},setAbsolutePosition:function(l,p){var m=this.m[0],w=this.m[1],P=this.m[2],k=this.m[3],x=this.m[4],u=(m*(p-this.m[5])-w*(l-x))/(m*k-w*P),v=(l-x-P*u)/m;return this.translate(v,u)}};var f=Math.PI/180,d=180/Math.PI,_={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},y=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;t.Util={_isElement:function(l){return!(!l||1!=l.nodeType)},_isFunction:function(l){return!!(l&&l.constructor&&l.call&&l.apply)},_isObject:function(l){return!!l&&l.constructor==Object},_isArray:function(l){return"[object Array]"==Object.prototype.toString.call(l)},_isNumber:function(l){return"[object Number]"==Object.prototype.toString.call(l)},_isString:function(l){return"[object String]"==Object.prototype.toString.call(l)},_throttle:function(l,p,m){var w,P,k,x=null,D=0,u=m||{},v=function(){D=!1===u.leading?0:(new Date).getTime(),x=null,k=l.apply(w,P),w=P=null};return function(){var b=(new Date).getTime();D||!1!==u.leading||(D=b);var F=p-(b-D);return w=this,P=arguments,0>=F?(clearTimeout(x),x=null,D=b,k=l.apply(w,P),w=P=null):x||!1===u.trailing||(x=setTimeout(v,F)),k}},_hasMethods:function(l){var p,m=[];for(p in l)this._isFunction(l[p])&&m.push(p);return m.length>0},createCanvasElement:function(){var l=t.document.createElement("canvas");try{l.style=l.style||{}}catch(p){}return l},isBrowser:function(){return"object"!=typeof rt},_isInDocument:function(l){for(;l=l.parentNode;)if(l==t.document)return!0;return!1},_simplifyArray:function(l){var p,m,w=[],P=l.length,k=t.Util;for(p=0;P>p;p++)m=l[p],k._isNumber(m)?m=Math.round(1e3*m)/1e3:k._isString(m)||(m=m.toString()),w.push(m);return w},_getImage:function(l,p){var m,w;if(l)if(this._isElement(l))p(l);else if(this._isString(l))(m=new t.window.Image).onload=function(){p(m)},m.src=l;else if(l.data){(w=t.Util.createCanvasElement()).width=l.width,w.height=l.height,w.getContext("2d").putImageData(l,0,0),this._getImage(w.toDataURL(),p)}else p(null);else p(null)},_getRGBAString:function(l){return["rgba(",l.red||0,",",l.green||0,",",l.blue||0,",",l.alpha||1,")"].join("")},_rgbToHex:function(l,p,m){return((1<<24)+(l<<16)+(p<<8)+m).toString(16).slice(1)},_hexToRgb:function(l){l=l.replace("#","");var p=parseInt(l,16);return{r:p>>16&255,g:p>>8&255,b:255&p}},getRandomColor:function(){for(var l=(16777215*Math.random()<<0).toString(16);l.length<6;)l="0"+l;return"#"+l},get:function(l,p){return void 0===l?p:l},getRGB:function(l){var p;return l in _?{r:(p=_[l])[0],g:p[1],b:p[2]}:"#"===l[0]?this._hexToRgb(l.substring(1)):"rgb("===l.substr(0,4)?(p=y.exec(l.replace(/ /g,"")),{r:parseInt(p[1],10),g:parseInt(p[2],10),b:parseInt(p[3],10)}):{r:0,g:0,b:0}},_merge:function(l,p){var m=this._clone(p);for(var w in l)m[w]=this._isObject(l[w])?this._merge(l[w],m[w]):l[w];return m},cloneObject:function(l){var p={};for(var m in l)p[m]=this._isObject(l[m])?this.cloneObject(l[m]):this._isArray(l[m])?this.cloneArray(l[m]):l[m];return p},cloneArray:function(l){return l.slice(0)},_degToRad:function(l){return l*f},_radToDeg:function(l){return l*d},_capitalize:function(l){return l.charAt(0).toUpperCase()+l.slice(1)},error:function(l){throw new Error("Kinetic error: "+l)},warn:function(l){t.root.console&&console.warn&&t.showWarnings&&console.warn("Kinetic warning: "+l)},extend:function(l,p){function m(){this.constructor=l}m.prototype=p.prototype;var w=l.prototype;for(var P in l.prototype=new m,w)w.hasOwnProperty(P)&&(l.prototype[P]=w[P]);l.__super__=p.prototype},addMethods:function(l,p){var m;for(m in p)l.prototype[m]=p[m]},_getControlPoints:function(l,p,m,w,P,k,x){var D=Math.sqrt(Math.pow(m-l,2)+Math.pow(w-p,2)),u=Math.sqrt(Math.pow(P-m,2)+Math.pow(k-w,2)),v=x*D/(D+u),b=x*u/(D+u);return[m-v*(P-l),w-v*(k-p),m+b*(P-l),w+b*(k-p)]},_expandPoints:function(l,p){var m,w,P=l.length,k=[];for(m=2;P-2>m;m+=2)w=t.Util._getControlPoints(l[m-2],l[m-1],l[m],l[m+1],l[m+2],l[m+3],p),k.push(w[0]),k.push(w[1]),k.push(l[m]),k.push(l[m+1]),k.push(w[2]),k.push(w[3]);return k},_removeLastLetter:function(l){return l.substring(0,l.length-1)}}}(),function(){var i=t.Util.createCanvasElement().getContext("2d"),a=t.UA.mobile?(window.devicePixelRatio||1)/(i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1):1;t.Canvas=function(s){this.init(s)},t.Canvas.prototype={init:function(s){var d=(s||{}).pixelRatio||t.pixelRatio||a;this.pixelRatio=d,this._canvas=t.Util.createCanvasElement(),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(s){this.pixelRatio=s,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(s){this.width=this._canvas.width=s*this.pixelRatio,this._canvas.style.width=s+"px"},setHeight:function(s){this.height=this._canvas.height=s*this.pixelRatio,this._canvas.style.height=s+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(s,f){this.setWidth(s),this.setHeight(f)},toDataURL:function(s,f){try{return this._canvas.toDataURL(s,f)}catch(d){try{return this._canvas.toDataURL()}catch(e){return t.Util.warn("Unable to get data URL. "+e.message),""}}}},t.SceneCanvas=function(s){var f=s||{},d=f.width||0,e=f.height||0;t.Canvas.call(this,f),this.context=new t.SceneContext(this),this.setSize(d,e)},t.SceneCanvas.prototype={setWidth:function(s){var f=this.pixelRatio,d=this.getContext()._context;t.Canvas.prototype.setWidth.call(this,s),d.scale(f,f)},setHeight:function(s){var f=this.pixelRatio,d=this.getContext()._context;t.Canvas.prototype.setHeight.call(this,s),d.scale(f,f)}},t.Util.extend(t.SceneCanvas,t.Canvas),t.HitCanvas=function(s){var f=s||{},d=f.width||0,e=f.height||0;t.Canvas.call(this,f),this.context=new t.HitContext(this),this.setSize(d,e),this.hitCanvas=!0},t.Util.extend(t.HitCanvas,t.Canvas)}(),function(){var o=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];t.Context=function(n){this.init(n)},t.Context.prototype={init:function(n){this.canvas=n,this._context=n._canvas.getContext("2d"),t.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(n){n.getFillEnabled()&&this._fill(n)},strokeShape:function(n){n.getStrokeEnabled()&&this._stroke(n)},fillStrokeShape:function(n){n.getFillEnabled()&&this._fill(n),n.getStrokeEnabled()&&this._stroke(n)},getTrace:function(n){var h,g,_,y,l=this.traceArr,p=l.length,m="";for(h=0;p>h;h++)(_=(g=l[h]).method)?(y=g.args,m+=_,m+=n?"()":t.Util._isArray(y[0])?"(["+y.join(",")+"])":"("+y.join(",")+")"):(m+=g.property,n||(m+="="+g.val)),m+=";";return m},clearTrace:function(){this.traceArr=[]},_trace:function(n){var g=this.traceArr;g.push(n),g.length>=t.traceArrMax&&g.shift()},reset:function(){var n=this.getCanvas().getPixelRatio();this.setTransform(1*n,0,0,1*n,0,0)},getCanvas:function(){return this.canvas},clear:function(n){var h=this.getCanvas();n?this.clearRect(n.x||0,n.y||0,n.width||0,n.height||0):this.clearRect(0,0,h.getWidth(),h.getHeight())},_applyLineCap:function(n){var h=n.getLineCap();h&&this.setAttr("lineCap",h)},_applyOpacity:function(n){var h=n.getAbsoluteOpacity();1!==h&&this.setAttr("globalAlpha",h)},_applyLineJoin:function(n){var h=n.getLineJoin();h&&this.setAttr("lineJoin",h)},setAttr:function(n,h){this._context[n]=h},arc:function(){var n=arguments;this._context.arc(n[0],n[1],n[2],n[3],n[4],n[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var n=arguments;this._context.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])},clearRect:function(){var n=arguments;this._context.clearRect(n[0],n[1],n[2],n[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var n=arguments;return 2===n.length?this._context.createImageData(n[0],n[1]):1===n.length?this._context.createImageData(n[0]):void 0},createLinearGradient:function(){var n=arguments;return this._context.createLinearGradient(n[0],n[1],n[2],n[3])},createPattern:function(){var n=arguments;return this._context.createPattern(n[0],n[1])},createRadialGradient:function(){var n=arguments;return this._context.createRadialGradient(n[0],n[1],n[2],n[3],n[4],n[5])},drawImage:function(){var n=arguments,h=this._context;3===n.length?h.drawImage(n[0],n[1],n[2]):5===n.length?h.drawImage(n[0],n[1],n[2],n[3],n[4]):9===n.length&&h.drawImage(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},fill:function(){this._context.fill()},fillText:function(){var n=arguments;this._context.fillText(n[0],n[1],n[2])},getImageData:function(){var n=arguments;return this._context.getImageData(n[0],n[1],n[2],n[3])},lineTo:function(){var n=arguments;this._context.lineTo(n[0],n[1])},moveTo:function(){var n=arguments;this._context.moveTo(n[0],n[1])},rect:function(){var n=arguments;this._context.rect(n[0],n[1],n[2],n[3])},putImageData:function(){var n=arguments;this._context.putImageData(n[0],n[1],n[2])},quadraticCurveTo:function(){var n=arguments;this._context.quadraticCurveTo(n[0],n[1],n[2],n[3])},restore:function(){this._context.restore()},rotate:function(){var n=arguments;this._context.rotate(n[0])},save:function(){this._context.save()},scale:function(){var n=arguments;this._context.scale(n[0],n[1])},setLineDash:function(){var n=arguments,h=this._context;this._context.setLineDash?h.setLineDash(n[0]):"mozDash"in h?h.mozDash=n[0]:"webkitLineDash"in h&&(h.webkitLineDash=n[0])},setTransform:function(){var n=arguments;this._context.setTransform(n[0],n[1],n[2],n[3],n[4],n[5])},stroke:function(){this._context.stroke()},strokeText:function(){var n=arguments;this._context.strokeText(n[0],n[1],n[2])},transform:function(){var n=arguments;this._context.transform(n[0],n[1],n[2],n[3],n[4],n[5])},translate:function(){var n=arguments;this._context.translate(n[0],n[1])},_enableTrace:function(){var n,h,g=this,_=o.length,y=t.Util._simplifyArray,l=this.setAttr,p=function(m){var w,P=g[m];g[m]=function(){return h=y(Array.prototype.slice.call(arguments,0)),w=P.apply(g,arguments),g._trace({method:m,args:h}),w}};for(n=0;_>n;n++)p(o[n]);g.setAttr=function(){l.apply(g,arguments),g._trace({property:arguments[0],val:arguments[1]})}}},t.SceneContext=function(n){t.Context.call(this,n)},t.SceneContext.prototype={_fillColor:function(n){var h=n.fill()||t.Util._getRGBAString({red:n.fillRed(),green:n.fillGreen(),blue:n.fillBlue(),alpha:n.fillAlpha()});this.setAttr("fillStyle",h),n._fillFunc(this)},_fillPattern:function(n){var h=n.getFillPatternImage(),g=n.getFillPatternX(),_=n.getFillPatternY(),y=n.getFillPatternScale(),l=t.getAngle(n.getFillPatternRotation()),p=n.getFillPatternOffset(),m=n.getFillPatternRepeat();(g||_)&&this.translate(g||0,_||0),l&&this.rotate(l),y&&this.scale(y.x,y.y),p&&this.translate(-1*p.x,-1*p.y),this.setAttr("fillStyle",this.createPattern(h,m||"repeat")),this.fill()},_fillLinearGradient:function(n){var h=n.getFillLinearGradientStartPoint(),g=n.getFillLinearGradientEndPoint(),_=n.getFillLinearGradientColorStops(),y=this.createLinearGradient(h.x,h.y,g.x,g.y);if(_){for(var l=0;l<_.length;l+=2)y.addColorStop(_[l],_[l+1]);this.setAttr("fillStyle",y),this.fill()}},_fillRadialGradient:function(n){for(var h=n.getFillRadialGradientStartPoint(),g=n.getFillRadialGradientEndPoint(),_=n.getFillRadialGradientStartRadius(),y=n.getFillRadialGradientEndRadius(),l=n.getFillRadialGradientColorStops(),p=this.createRadialGradient(h.x,h.y,_,g.x,g.y,y),m=0;m<l.length;m+=2)p.addColorStop(l[m],l[m+1]);this.setAttr("fillStyle",p),this.fill()},_fill:function(n){var h=n.fill()||n.fillRed()||n.fillGreen()||n.fillBlue(),g=n.getFillPatternImage(),_=n.getFillLinearGradientColorStops(),y=n.getFillRadialGradientColorStops(),l=n.getFillPriority();h&&"color"===l?this._fillColor(n):g&&"pattern"===l?this._fillPattern(n):_&&"linear-gradient"===l?this._fillLinearGradient(n):y&&"radial-gradient"===l?this._fillRadialGradient(n):h?this._fillColor(n):g?this._fillPattern(n):_?this._fillLinearGradient(n):y&&this._fillRadialGradient(n)},_stroke:function(n){var h=n.dash(),g=n.getStrokeScaleEnabled();n.hasStroke()&&(g||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(n),h&&n.dashEnabled()&&this.setLineDash(h),this.setAttr("lineWidth",n.strokeWidth()),this.setAttr("strokeStyle",n.stroke()||t.Util._getRGBAString({red:n.strokeRed(),green:n.strokeGreen(),blue:n.strokeBlue(),alpha:n.strokeAlpha()})),n._strokeFunc(this),g||this.restore())},_applyShadow:function(n){var h=t.Util,g=n.getAbsoluteOpacity(),_=h.get(n.getShadowColor(),"black"),y=h.get(n.getShadowBlur(),5),l=h.get(n.getShadowOpacity(),1),p=h.get(n.getShadowOffset(),{x:0,y:0});l&&this.setAttr("globalAlpha",l*g),this.setAttr("shadowColor",_),this.setAttr("shadowBlur",y),this.setAttr("shadowOffsetX",p.x),this.setAttr("shadowOffsetY",p.y)}},t.Util.extend(t.SceneContext,t.Context),t.HitContext=function(n){t.Context.call(this,n)},t.HitContext.prototype={_fill:function(n){this.save(),this.setAttr("fillStyle",n.colorKey),n._fillFuncHit(this),this.restore()},_stroke:function(n){n.hasStroke()&&(this._applyLineCap(n),this.setAttr("lineWidth",n.strokeWidth()),this.setAttr("strokeStyle",n.colorKey),n._strokeFuncHit(this))}},t.Util.extend(t.HitContext,t.Context)}(),function(){var r="get",i="set";t.Factory={addGetterSetter:function(a,s,f,d,e){this.addGetter(a,s,f),this.addSetter(a,s,d,e),this.addOverloadedGetterSetter(a,s)},addGetter:function(a,s,f){var d=r+t.Util._capitalize(s);a.prototype[d]=function(){var e=this.attrs[s];return void 0===e?f:e}},addSetter:function(a,s,f,d){var e=i+t.Util._capitalize(s);a.prototype[e]=function(c){return f&&(c=f.call(this,c)),this._setAttr(s,c),d&&d.call(this),this}},addComponentsGetterSetter:function(a,s,f,d,e){var c,o,n=f.length,h=t.Util._capitalize,g=r+h(s),_=i+h(s);a.prototype[g]=function(){var y={};for(c=0;n>c;c++)y[o=f[c]]=this.getAttr(s+h(o));return y},a.prototype[_]=function(y){var l,p=this.attrs[s];for(l in d&&(y=d.call(this,y)),y)this._setAttr(s+h(l),y[l]);return this._fireChangeEvent(s,p,y),e&&e.call(this),this},this.addOverloadedGetterSetter(a,s)},addOverloadedGetterSetter:function(a,s){var f=t.Util._capitalize(s),d=i+f,e=r+f;a.prototype[s]=function(){return arguments.length?(this[d](arguments[0]),this):this[e]()}},backCompat:function(a,s){var f;for(f in s)a.prototype[f]=a.prototype[s[f]]},afterSetFilter:function(){this._filterUpToDate=!1}},t.Validators={RGBComponent:function(a){return a>255?255:0>a?0:Math.round(a)},alphaComponent:function(a){return a>1?1:1e-4>a?1e-4:a}}}(),function(){var r="absoluteOpacity",i="absoluteTransform",n="listening",h="mouseenter",g="mouseleave",l="Shape",m="stage",w="transform",k="visible",x=["id"],D=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(" ");t.Util.addMethods(t.Node,{_init:function(u){var v=this;this._id=t.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this.setAttrs(u),this.on(D,function(){this._clearCache(w),v._clearSelfAndDescendantCache(i)}),this.on("visibleChange.kinetic",function(){v._clearSelfAndDescendantCache(k)}),this.on("listeningChange.kinetic",function(){v._clearSelfAndDescendantCache(n)}),this.on("opacityChange.kinetic",function(){v._clearSelfAndDescendantCache(r)})},_clearCache:function(u){u?delete this._cache[u]:this._cache={}},_getCache:function(u,v){return void 0===this._cache[u]&&(this._cache[u]=v.call(this)),this._cache[u]},_clearSelfAndDescendantCache:function(u){this._clearCache(u),this.children&&this.getChildren().each(function(v){v._clearSelfAndDescendantCache(u)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(u){var v=u||{},b=v.x||0,F=v.y||0,T=v.width||this.width(),M=v.height||this.height(),I=v.drawBorder||!1;if(0!==T&&0!==M){var B=new t.SceneCanvas({pixelRatio:1,width:T,height:M}),j=new t.SceneCanvas({pixelRatio:1,width:T,height:M}),C=new t.HitCanvas({width:T,height:M}),G=B.getContext(),W=C.getContext();return C.isCache=!0,this.clearCache(),G.save(),W.save(),I&&(G.save(),G.beginPath(),G.rect(0,0,T,M),G.closePath(),G.setAttr("strokeStyle","red"),G.setAttr("lineWidth",5),G.stroke(),G.restore()),G.translate(-1*b,-1*F),W.translate(-1*b,-1*F),"Shape"===this.nodeType&&(G.translate(-1*this.x(),-1*this.y()),W.translate(-1*this.x(),-1*this.y())),this.drawScene(B,this),this.drawHit(C,this),G.restore(),W.restore(),this._cache.canvas={scene:B,filter:j,hit:C},this}t.Util.warn("Width or height of caching configuration equals 0. Cache is ignored.")},_drawCachedSceneCanvas:function(u){u.save(),this.getLayer()._applyTransform(this,u),u._applyOpacity(this),u.drawImage(this._getCachedSceneCanvas()._canvas,0,0),u.restore()},_getCachedSceneCanvas:function(){var u,v,b,T=this.filters(),M=this._cache.canvas,I=M.scene,B=M.filter,j=B.getContext();if(T){if(!this._filterUpToDate){try{for(u=T.length,j.clear(),j.drawImage(I._canvas,0,0),v=j.getImageData(0,0,B.getWidth(),B.getHeight()),b=0;u>b;b++)T[b].call(this,v),j.putImageData(v,0,0)}catch(C){t.Util.warn("Unable to apply filter. "+C.message)}this._filterUpToDate=!0}return B}return I},_drawCachedHitCanvas:function(u){var b=this._cache.canvas.hit;u.save(),this.getLayer()._applyTransform(this,u),u.drawImage(b._canvas,0,0),u.restore()},on:function(u,v){var b,T,M,I,B=u.split(" "),j=B.length;for(b=0;j>b;b++)M=(T=B[b].split("."))[0],I=T[1]||"",this.eventListeners[M]||(this.eventListeners[M]=[]),this.eventListeners[M].push({name:I,handler:v});return this},off:function(u){var v,b,T,M,I,B=(u||"").split(" "),j=B.length;if(!u)for(b in this.eventListeners)this._off(b);for(v=0;j>v;v++)if(M=(T=B[v].split("."))[0],I=T[1],M)this.eventListeners[M]&&this._off(M,I);else for(b in this.eventListeners)this._off(b,I);return this},dispatchEvent:function(u){var v={target:this,type:u.type,evt:u};this.fire(u.type,v)},addEventListener:function(u,v){this.on(u,function(b){v.call(this,b.evt)})},removeEventListener:function(u){this.off(u)},remove:function(){var u=this.getParent();return u&&u.children&&(u.children.splice(this.index,1),u._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(m),this._clearSelfAndDescendantCache(i),this._clearSelfAndDescendantCache(k),this._clearSelfAndDescendantCache(n),this._clearSelfAndDescendantCache(r),this},destroy:function(){t._removeId(this.getId()),t._removeName(this.getName(),this._id),this.remove()},getAttr:function(u){var v="get"+t.Util._capitalize(u);return t.Util._isFunction(this[v])?this[v]():this.attrs[u]},getAncestors:function(){for(var u=this.getParent(),v=new t.Collection;u;)v.push(u),u=u.getParent();return v},getAttrs:function(){return this.attrs||{}},setAttrs:function(u){var v,b;if(u)for(v in u)"children"===v||u[v]instanceof t.Node||(b="set"+t.Util._capitalize(v),t.Util._isFunction(this[b])?this[b](u[v]):this._setAttr(v,u[v]));return this},isListening:function(){return this._getCache(n,this._isListening)},_isListening:function(){var u=this.getListening(),v=this.getParent();return"inherit"===u?!v||v.isListening():u},isVisible:function(){return this._getCache(k,this._isVisible)},_isVisible:function(){var u=this.getVisible(),v=this.getParent();return"inherit"===u?!v||v.isVisible():u},shouldDrawHit:function(u){var v=this.getLayer();return u&&u.isCache||v&&v.hitGraphEnabled()&&this.isListening()&&this.isVisible()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){var v,b,F,T,M=this.getDepth(),I=this,B=0;return"Stage"!==I.nodeType&&function u(j){for(v=[],b=j.length,F=0;b>F;F++)T=j[F],B++,T.nodeType!==l&&(v=v.concat(T.getChildren().toArray())),T._id===I._id&&(F=b);v.length>0&&v[0].getDepth()<=M&&u(v)}(I.getStage().getChildren()),B},getDepth:function(){for(var u=0,v=this.parent;v;)u++,v=v.parent;return u},setPosition:function(u){return this.setX(u.x),this.setY(u.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var u=this.getAbsoluteTransform().getMatrix(),v=new t.Transform,b=this.offset();return v.m=u.slice(),v.translate(b.x,b.y),v.getTranslation()},setAbsolutePosition:function(u){var v,b=this._clearTransform();return this.attrs.x=b.x,this.attrs.y=b.y,delete b.x,delete b.y,(v=this.getAbsoluteTransform()).invert(),v.translate(u.x,u.y),u={x:this.attrs.x+v.getTranslation().x,y:this.attrs.y+v.getTranslation().y},this.setPosition({x:u.x,y:u.y}),this._setTransform(b),this},_setTransform:function(u){var v;for(v in u)this.attrs[v]=u[v];this._clearCache(w),this._clearSelfAndDescendantCache(i)},_clearTransform:function(){var u={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(w),this._clearSelfAndDescendantCache(i),u},move:function(u){var v=u.x,b=u.y,F=this.getX(),T=this.getY();return void 0!==v&&(F+=v),void 0!==b&&(T+=b),this.setPosition({x:F,y:T}),this},_eachAncestorReverse:function(u,v){var b,F,T=[],M=this.getParent();if(v&&v._id===this._id)return u(this),!0;for(T.unshift(this);M&&(!v||M._id!==v._id);)T.unshift(M),M=M.parent;for(b=T.length,F=0;b>F;F++)u(T[F])},rotate:function(u){return this.setRotation(this.getRotation()+u),this},moveToTop:function(){if(this.parent){var u=this.index;return this.parent.children.splice(u,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0}t.Util.warn("Node has no parent. moveToTop function is ignored.")},moveUp:function(){if(this.parent){var u=this.index;return this.parent.getChildren().length-1>u&&(this.parent.children.splice(u,1),this.parent.children.splice(u+1,0,this),this.parent._setChildrenIndices(),!0)}t.Util.warn("Node has no parent. moveUp function is ignored.")},moveDown:function(){if(this.parent){var u=this.index;return u>0&&(this.parent.children.splice(u,1),this.parent.children.splice(u-1,0,this),this.parent._setChildrenIndices(),!0)}t.Util.warn("Node has no parent. moveDown function is ignored.")},moveToBottom:function(){if(this.parent){var u=this.index;return u>0&&(this.parent.children.splice(u,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}t.Util.warn("Node has no parent. moveToBottom function is ignored.")},setZIndex:function(u){if(this.parent){var v=this.index;return this.parent.children.splice(v,1),this.parent.children.splice(u,0,this),this.parent._setChildrenIndices(),this}t.Util.warn("Node has no parent. zIndex parameter is ignored.")},getAbsoluteOpacity:function(){return this._getCache(r,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var u=this.getOpacity();return this.getParent()&&(u*=this.getParent().getAbsoluteOpacity()),u},moveTo:function(u){return this.getParent()!==u&&(this.remove(),u.add(this)),this},toObject:function(){var u,v,b,F,T=t.Util,M={},I=this.getAttrs();for(u in M.attrs={},I)v=I[u],T._isFunction(v)||T._isElement(v)||T._isObject(v)&&T._hasMethods(v)||(b=this[u],delete I[u],F=b?b.call(this):null,I[u]=v,F!==v&&(M.attrs[u]=v));return M.className=this.getClassName(),M},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var u=this.getParent();return u?u.getLayer():null},getStage:function(){return this._getCache(m,this._getStage)},_getStage:function(){var u=this.getParent();return u?u.getStage():void 0},fire:function(u,v,b){return b?this._fireAndBubble(u,v||{}):this._fire(u,v||{}),this},getAbsoluteTransform:function(u){return u?this._getAbsoluteTransform(u):this._getCache(i,this._getAbsoluteTransform)},_getAbsoluteTransform:function(u){var v,b,F=new t.Transform;return this._eachAncestorReverse(function(T){v=T.transformsEnabled(),b=T.getTransform(),"all"===v?F.multiply(b):"position"===v&&F.translate(T.x(),T.y())},u),F},getTransform:function(){return this._getCache(w,this._getTransform)},_getTransform:function(){var u=new t.Transform,v=this.getX(),b=this.getY(),F=t.getAngle(this.getRotation()),T=this.getScaleX(),M=this.getScaleY(),I=this.getSkewX(),B=this.getSkewY(),j=this.getOffsetX(),C=this.getOffsetY();return(0!==v||0!==b)&&u.translate(v,b),0!==F&&u.rotate(F),(0!==I||0!==B)&&u.skew(I,B),(1!==T||1!==M)&&u.scale(T,M),(0!==j||0!==C)&&u.translate(-1*j,-1*C),u},clone:function(u){var v,b,F,T,M,I=this.getClassName(),B=t.Util.cloneObject(this.attrs);for(var j in x){delete B[x[j]]}for(v in u)B[v]=u[v];var G=new t[I](B);for(v in this.eventListeners)for(F=(b=this.eventListeners[v]).length,T=0;F>T;T++)(M=b[T]).name.indexOf("kinetic")<0&&(G.eventListeners[v]||(G.eventListeners[v]=[]),G.eventListeners[v].push(M));return G},toDataURL:function(u){var v=(u=u||{}).mimeType||null,b=u.quality||null,F=this.getStage(),T=u.x||0,M=u.y||0,I=new t.SceneCanvas({width:u.width||this.getWidth()||(F?F.getWidth():0),height:u.height||this.getHeight()||(F?F.getHeight():0),pixelRatio:1}),B=I.getContext();return B.save(),(T||M)&&B.translate(-1*T,-1*M),this.drawScene(I),B.restore(),I.toDataURL(v,b)},toImage:function(u){t.Util._getImage(this.toDataURL(u),function(v){u.callback(v)})},setSize:function(u){return this.setWidth(u.width),this.setHeight(u.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():t.dragDistance},_get:function(u){return this.className===u||this.nodeType===u?[this]:[]},_off:function(u,v){var b,F,T=this.eventListeners[u];for(b=0;b<T.length;b++)if(!("kinetic"===(F=T[b].name)&&"kinetic"!==v||v&&F!==v)){if(T.splice(b,1),0===T.length){delete this.eventListeners[u];break}b--}},_fireChangeEvent:function(u,v,b){this._fire(u+"Change",{oldVal:v,newVal:b})},setId:function(u){var v=this.getId();return t._removeId(v),t._addId(this,u),this._setAttr("id",u),this},setName:function(u){var v=this.getName();return t._removeName(v,this._id),t._addName(this,u),this._setAttr("name",u),this},setAttr:function(u,v){var F=this["set"+t.Util._capitalize(u)];return t.Util._isFunction(F)?F.call(this,v):this._setAttr(u,v),this},_setAttr:function(u,v){var b;void 0!==v&&(b=this.attrs[u],this.attrs[u]=v,this._fireChangeEvent(u,b,v))},_setComponentAttr:function(u,v,b){var F;void 0!==b&&((F=this.attrs[u])||(this.attrs[u]=this.getAttr(u)),this.attrs[u][v]=b,this._fireChangeEvent(u,F,b))},_fireAndBubble:function(u,v,b){var F=!0;if(v&&this.nodeType===l&&(v.target=this),(u===h&&b&&(this._id===b._id||this.isAncestorOf&&this.isAncestorOf(b))||u===g&&b&&(this._id===b._id||this.isAncestorOf&&this.isAncestorOf(b)))&&(F=!1),F){this._fire(u,v);var T=(u===h||u===g)&&(b&&b.isAncestorOf&&b.isAncestorOf(this)||!(!b||!b.isAncestorOf));v&&!v.cancelBubble&&this.parent&&this.parent.isListening()&&!T&&(b&&b.parent?this._fireAndBubble.call(this.parent,u,v,b.parent):this._fireAndBubble.call(this.parent,u,v))}},_fire:function(u,v){var b,F=this.eventListeners[u];if(v.type=u,F)for(b=0;b<F.length;b++)F[b].handler.call(this,v)},draw:function(){return this.drawScene(),this.drawHit(),this}}),t.Node.create=function(u,v){return this._createNode(JSON.parse(u),v)},t.Node._createNode=function(u,v){var b,F,T,M=t.Node.prototype.getClassName.call(u),I=u.children;if(v&&(u.attrs.container=v),b=new t[M](u.attrs),I)for(F=I.length,T=0;F>T;T++)b.add(this._createNode(I[T]));return b},t.Factory.addOverloadedGetterSetter(t.Node,"position"),t.Factory.addGetterSetter(t.Node,"x",0),t.Factory.addGetterSetter(t.Node,"y",0),t.Factory.addGetterSetter(t.Node,"opacity",1),t.Factory.addGetter(t.Node,"name"),t.Factory.addOverloadedGetterSetter(t.Node,"name"),t.Factory.addGetter(t.Node,"id"),t.Factory.addOverloadedGetterSetter(t.Node,"id"),t.Factory.addGetterSetter(t.Node,"rotation",0),t.Factory.addComponentsGetterSetter(t.Node,"scale",["x","y"]),t.Factory.addGetterSetter(t.Node,"scaleX",1),t.Factory.addGetterSetter(t.Node,"scaleY",1),t.Factory.addComponentsGetterSetter(t.Node,"skew",["x","y"]),t.Factory.addGetterSetter(t.Node,"skewX",0),t.Factory.addGetterSetter(t.Node,"skewY",0),t.Factory.addComponentsGetterSetter(t.Node,"offset",["x","y"]),t.Factory.addGetterSetter(t.Node,"offsetX",0),t.Factory.addGetterSetter(t.Node,"offsetY",0),t.Factory.addSetter(t.Node,"dragDistance"),t.Factory.addOverloadedGetterSetter(t.Node,"dragDistance"),t.Factory.addSetter(t.Node,"width",0),t.Factory.addOverloadedGetterSetter(t.Node,"width"),t.Factory.addSetter(t.Node,"height",0),t.Factory.addOverloadedGetterSetter(t.Node,"height"),t.Factory.addGetterSetter(t.Node,"listening","inherit"),t.Factory.addGetterSetter(t.Node,"filters",void 0,function(u){return this._filterUpToDate=!1,u}),t.Factory.addGetterSetter(t.Node,"visible","inherit"),t.Factory.addGetterSetter(t.Node,"transformsEnabled","all"),t.Factory.addOverloadedGetterSetter(t.Node,"size"),t.Factory.backCompat(t.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),t.Collection.mapMethods(t.Node)}(),t.Filters.Grayscale=function(r){var i,a,s=r.data,f=s.length;for(i=0;f>i;i+=4)a=.34*s[i]+.5*s[i+1]+.16*s[i+2],s[i]=a,s[i+1]=a,s[i+2]=a},t.Filters.Brighten=function(r){var i,a=255*this.brightness(),s=r.data,f=s.length;for(i=0;f>i;i+=4)s[i]+=a,s[i+1]+=a,s[i+2]+=a},t.Factory.addGetterSetter(t.Node,"brightness",0,null,t.Factory.afterSetFilter),t.Filters.Invert=function(r){var i,a=r.data,s=a.length;for(i=0;s>i;i+=4)a[i]=255-a[i],a[i+1]=255-a[i+1],a[i+2]=255-a[i+2]},function(){function r(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],s=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];t.Filters.Blur=function(f){var d=Math.round(this.blurRadius());d>0&&function(f,d){var e,c,o,n,h,g,_,y,l,p,m,w,P,k,x,D,u,v,b,F,T,M,I,B,j=f.data,C=f.width,G=f.height,W=d+d+1,Y=C-1,E=G-1,O=d+1,H=O*(O+1)/2,z=new r,R=null,L=z,U=null,S=null,A=a[d],N=s[d];for(o=1;W>o;o++)L=L.next=new r,o==O&&(R=L);for(L.next=z,_=g=0,c=0;G>c;c++){for(D=u=v=b=y=l=p=m=0,w=O*(F=j[g]),P=O*(T=j[g+1]),k=O*(M=j[g+2]),x=O*(I=j[g+3]),y+=H*F,l+=H*T,p+=H*M,m+=H*I,L=z,o=0;O>o;o++)L.r=F,L.g=T,L.b=M,L.a=I,L=L.next;for(o=1;O>o;o++)n=g+((o>Y?Y:o)<<2),y+=(L.r=F=j[n])*(B=O-o),l+=(L.g=T=j[n+1])*B,p+=(L.b=M=j[n+2])*B,m+=(L.a=I=j[n+3])*B,D+=F,u+=T,v+=M,b+=I,L=L.next;for(U=z,S=R,e=0;C>e;e++)j[g+3]=I=m*A>>N,0!==I?(I=255/I,j[g]=(y*A>>N)*I,j[g+1]=(l*A>>N)*I,j[g+2]=(p*A>>N)*I):j[g]=j[g+1]=j[g+2]=0,y-=w,l-=P,p-=k,m-=x,w-=U.r,P-=U.g,k-=U.b,x-=U.a,n=_+((n=e+d+1)<Y?n:Y)<<2,y+=D+=U.r=j[n],l+=u+=U.g=j[n+1],p+=v+=U.b=j[n+2],m+=b+=U.a=j[n+3],U=U.next,w+=F=S.r,P+=T=S.g,k+=M=S.b,x+=I=S.a,D-=F,u-=T,v-=M,b-=I,S=S.next,g+=4;_+=C}for(e=0;C>e;e++){for(u=v=b=D=l=p=m=y=0,w=O*(F=j[g=e<<2]),P=O*(T=j[g+1]),k=O*(M=j[g+2]),x=O*(I=j[g+3]),y+=H*F,l+=H*T,p+=H*M,m+=H*I,L=z,o=0;O>o;o++)L.r=F,L.g=T,L.b=M,L.a=I,L=L.next;for(h=C,o=1;d>=o;o++)g=h+e<<2,y+=(L.r=F=j[g])*(B=O-o),l+=(L.g=T=j[g+1])*B,p+=(L.b=M=j[g+2])*B,m+=(L.a=I=j[g+3])*B,D+=F,u+=T,v+=M,b+=I,L=L.next,E>o&&(h+=C);for(g=e,U=z,S=R,c=0;G>c;c++)j[3+(n=g<<2)]=I=m*A>>N,I>0?(I=255/I,j[n]=(y*A>>N)*I,j[n+1]=(l*A>>N)*I,j[n+2]=(p*A>>N)*I):j[n]=j[n+1]=j[n+2]=0,y-=w,l-=P,p-=k,m-=x,w-=U.r,P-=U.g,k-=U.b,x-=U.a,n=e+((n=c+O)<E?n:E)*C<<2,y+=D+=U.r=j[n],l+=u+=U.g=j[n+1],p+=v+=U.b=j[n+2],m+=b+=U.a=j[n+3],U=U.next,w+=F=S.r,P+=T=S.g,k+=M=S.b,x+=I=S.a,D-=F,u-=T,v-=M,b-=I,S=S.next,g+=C}}(f,d)},t.Factory.addGetterSetter(t.Node,"blurRadius",0,null,t.Factory.afterSetFilter)}(),function(){function r(o,n,h){var g=4*(h*o.width+n),_=[];return _.push(o.data[g++],o.data[g++],o.data[g++],o.data[g++]),_}function i(o,n){return Math.sqrt(Math.pow(o[0]-n[0],2)+Math.pow(o[1]-n[1],2)+Math.pow(o[2]-n[2],2))}t.Filters.Mask=function(o){var h=function(o,n){var h=r(o,0,0),g=r(o,o.width-1,0),_=r(o,0,o.height-1),y=r(o,o.width-1,o.height-1),l=n||10;if(i(h,g)<l&&i(g,y)<l&&i(y,_)<l&&i(_,h)<l){for(var p=function(o){for(var n=[0,0,0],h=0;h<o.length;h++)n[0]+=o[h][0],n[1]+=o[h][1],n[2]+=o[h][2];return n[0]/=o.length,n[1]/=o.length,n[2]/=o.length,n}([g,h,y,_]),m=[],w=0;w<o.width*o.height;w++){var P=i(p,[o.data[4*w],o.data[4*w+1],o.data[4*w+2]]);m[w]=l>P?0:255}return m}}(o,this.threshold());return h&&function(o,n){for(var h=0;h<o.width*o.height;h++)o.data[4*h+3]=n[h]}(o,h=function(o,n,h){for(var g=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],_=Math.round(Math.sqrt(g.length)),y=Math.floor(_/2),l=[],p=0;h>p;p++)for(var m=0;n>m;m++){for(var w=p*n+m,P=0,k=0;_>k;k++)for(var x=0;_>x;x++){var D=p+k-y,u=m+x-y;if(D>=0&&h>D&&u>=0&&n>u){var v=D*n+u,b=g[k*_+x];P+=o[v]*b}}l[w]=P}return l}(h=function(o,n,h){for(var g=[1,1,1,1,1,1,1,1,1],_=Math.round(Math.sqrt(g.length)),y=Math.floor(_/2),l=[],p=0;h>p;p++)for(var m=0;n>m;m++){for(var w=p*n+m,P=0,k=0;_>k;k++)for(var x=0;_>x;x++){var D=p+k-y,u=m+x-y;if(D>=0&&h>D&&u>=0&&n>u){var v=D*n+u,b=g[k*_+x];P+=o[v]*b}}l[w]=P>=1020?255:0}return l}(h=function(o,n,h){for(var g=[1,1,1,1,0,1,1,1,1],_=Math.round(Math.sqrt(g.length)),y=Math.floor(_/2),l=[],p=0;h>p;p++)for(var m=0;n>m;m++){for(var w=p*n+m,P=0,k=0;_>k;k++)for(var x=0;_>x;x++){var D=p+k-y,u=m+x-y;if(D>=0&&h>D&&u>=0&&n>u){var v=D*n+u,b=g[k*_+x];P+=o[v]*b}}l[w]=2040===P?255:0}return l}(h,o.width,o.height),o.width,o.height),o.width,o.height)),o},t.Factory.addGetterSetter(t.Node,"threshold",0,null,t.Factory.afterSetFilter)}(),t.Filters.RGB=function(r){var i,a,s=r.data,f=s.length,d=this.red(),e=this.green(),c=this.blue();for(i=0;f>i;i+=4)a=(.34*s[i]+.5*s[i+1]+.16*s[i+2])/255,s[i]=a*d,s[i+1]=a*e,s[i+2]=a*c,s[i+3]=s[i+3]},t.Factory.addGetterSetter(t.Node,"red",0,function(r){return this._filterUpToDate=!1,r>255?255:0>r?0:Math.round(r)}),t.Factory.addGetterSetter(t.Node,"green",0,function(r){return this._filterUpToDate=!1,r>255?255:0>r?0:Math.round(r)}),t.Factory.addGetterSetter(t.Node,"blue",0,t.Validators.RGBComponent,t.Factory.afterSetFilter),t.Filters.HSV=function(r){var i,a,s,f,d,e=r.data,c=e.length,o=Math.pow(2,this.value()),n=Math.pow(2,this.saturation()),h=Math.abs(this.hue()+360)%360,g=o*n*Math.cos(h*Math.PI/180),_=o*n*Math.sin(h*Math.PI/180),y=.299*o+.701*g+.167*_,l=.587*o-.587*g+.33*_,p=.114*o-.114*g-.497*_,m=.299*o-.299*g-.328*_,w=.587*o+.413*g+.035*_,P=.114*o-.114*g+.293*_,k=.299*o-.3*g+1.25*_,x=.587*o-.586*g-1.05*_,D=.114*o+.886*g-.2*_;for(i=0;c>i;i+=4)a=e[i+0],s=e[i+1],f=e[i+2],d=e[i+3],e[i+0]=y*a+l*s+p*f,e[i+1]=m*a+w*s+P*f,e[i+2]=k*a+x*s+D*f,e[i+3]=d},t.Factory.addGetterSetter(t.Node,"hue",0,null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"saturation",0,null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"value",0,null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"hue",0,null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"saturation",0,null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"luminance",0,null,t.Factory.afterSetFilter),t.Filters.HSL=function(r){var i,a,s,f,d,e=r.data,c=e.length,n=Math.pow(2,this.saturation()),h=Math.abs(this.hue()+360)%360,g=127*this.luminance(),_=1*n*Math.cos(h*Math.PI/180),y=1*n*Math.sin(h*Math.PI/180),l=.299+.701*_+.167*y,p=.587-.587*_+.33*y,m=.114-.114*_-.497*y,w=.299-.299*_-.328*y,P=.587+.413*_+.035*y,k=.114-.114*_+.293*y,x=.299-.3*_+1.25*y,D=.587-.586*_-1.05*y,u=.114+.886*_-.2*y;for(i=0;c>i;i+=4)a=e[i+0],s=e[i+1],f=e[i+2],d=e[i+3],e[i+0]=l*a+p*s+m*f+g,e[i+1]=w*a+P*s+k*f+g,e[i+2]=x*a+D*s+u*f+g,e[i+3]=d},t.Filters.Emboss=function(r){var i=10*this.embossStrength(),a=255*this.embossWhiteLevel(),s=this.embossDirection(),f=this.embossBlend(),d=0,e=0,c=r.data,o=r.width,n=r.height,h=4*o,g=n;switch(s){case"top-left":d=-1,e=-1;break;case"top":d=-1,e=0;break;case"top-right":d=-1,e=1;break;case"right":d=0,e=1;break;case"bottom-right":d=1,e=1;break;case"bottom":d=1,e=0;break;case"bottom-left":d=1,e=-1;break;case"left":d=0,e=-1}do{var _=(g-1)*h,y=d;1>g+y&&(y=0),g+y>n&&(y=0);var l=(g-1+y)*o*4,p=o;do{var m=_+4*(p-1),w=e;1>p+w&&(w=0),p+w>o&&(w=0);var P=l+4*(p-1+w),k=c[m]-c[P],x=c[m+1]-c[P+1],D=c[m+2]-c[P+2],u=k,v=u>0?u:-u;if((x>0?x:-x)>v&&(u=x),(D>0?D:-D)>v&&(u=D),u*=i,f){var T=c[m]+u,M=c[m+1]+u,I=c[m+2]+u;c[m]=T>255?255:0>T?0:T,c[m+1]=M>255?255:0>M?0:M,c[m+2]=I>255?255:0>I?0:I}else{var B=a-u;0>B?B=0:B>255&&(B=255),c[m]=c[m+1]=c[m+2]=B}}while(--p)}while(--g)},t.Factory.addGetterSetter(t.Node,"embossStrength",.5,null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"embossDirection","top-left",null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"embossBlend",!1,null,t.Factory.afterSetFilter),function(){function r(i,a,s,f,d){var c=s-a,o=d-f;return 0===c?f+o/2:0===o?f:o*((i-a)/c)+f}t.Filters.Enhance=function(i){var a,s,f,d,e=i.data,c=e.length,o=e[0],n=o,h=e[1],g=h,_=e[2],y=_,l=this.enhance();if(0!==l){for(d=0;c>d;d+=4)o>(a=e[d+0])?o=a:a>n&&(n=a),h>(s=e[d+1])?h=s:s>g&&(g=s),_>(f=e[d+2])?_=f:f>y&&(y=f);var p,m,w,P,k,x,D,u,v;for(n===o&&(n=255,o=0),g===h&&(g=255,h=0),y===_&&(y=255,_=0),l>0?(m=n+l*(255-n),w=o-l*(o-0),k=g+l*(255-g),x=h-l*(h-0),u=y+l*(255-y),v=_-l*(_-0)):(m=n+l*(n-(p=.5*(n+o))),w=o+l*(o-p),k=g+l*(g-(P=.5*(g+h))),x=h+l*(h-P),u=y+l*(y-(D=.5*(y+_))),v=_+l*(_-D)),d=0;c>d;d+=4)e[d+0]=r(e[d+0],o,n,w,m),e[d+1]=r(e[d+1],h,g,x,k),e[d+2]=r(e[d+2],_,y,v,u)}},t.Factory.addGetterSetter(t.Node,"enhance",0,null,t.Factory.afterSetFilter)}(),t.Filters.Posterize=function(r){var i,a=Math.round(254*this.levels())+1,s=r.data,f=s.length,d=255/a;for(i=0;f>i;i+=1)s[i]=Math.floor(s[i]/d)*d},t.Factory.addGetterSetter(t.Node,"levels",.5,null,t.Factory.afterSetFilter),t.Filters.Noise=function(r){var i,a=255*this.noise(),s=r.data,f=s.length,d=a/2;for(i=0;f>i;i+=4)s[i+0]+=d-2*d*Math.random(),s[i+1]+=d-2*d*Math.random(),s[i+2]+=d-2*d*Math.random()},t.Factory.addGetterSetter(t.Node,"noise",.2,null,t.Factory.afterSetFilter),t.Filters.Pixelate=function(r){var i,a,s,f,d,e,c,o,n,h,g,_,y,l,p=Math.ceil(this.pixelSize()),m=r.width,w=r.height,P=Math.ceil(m/p),k=Math.ceil(w/p);for(r=r.data,_=0;P>_;_+=1)for(y=0;k>y;y+=1){for(f=0,d=0,e=0,c=0,n=(o=_*p)+p,g=(h=y*p)+p,l=0,i=o;n>i;i+=1)if(!(i>=m))for(a=h;g>a;a+=1)a>=w||(f+=r[0+(s=4*(m*a+i))],d+=r[s+1],e+=r[s+2],c+=r[s+3],l+=1);for(f/=l,d/=l,e/=l,i=o;n>i;i+=1)if(!(i>=m))for(a=h;g>a;a+=1)a>=w||(r[0+(s=4*(m*a+i))]=f,r[s+1]=d,r[s+2]=e,r[s+3]=c)}},t.Factory.addGetterSetter(t.Node,"pixelSize",8,null,t.Factory.afterSetFilter),t.Filters.Threshold=function(r){var i,a=255*this.threshold(),s=r.data,f=s.length;for(i=0;f>i;i+=1)s[i]=s[i]<a?0:255},t.Factory.addGetterSetter(t.Node,"threshold",.5,null,t.Factory.afterSetFilter),t.Filters.Sepia=function(r){var i,a,s,f,d,e,c,o,n,h=r.data,g=r.width,_=r.height,y=4*g;do{i=(_-1)*y,a=g;do{c=.393*(f=h[s=i+4*(a-1)])+.769*(d=h[s+1])+.189*(e=h[s+2]),o=.349*f+.686*d+.168*e,n=.272*f+.534*d+.131*e,h[s]=c>255?255:c,h[s+1]=o>255?255:o,h[s+2]=n>255?255:n,h[s+3]=h[s+3]}while(--a)}while(--_)},t.Filters.Solarize=function(r){var i=r.data,a=r.width,f=4*a,d=r.height;do{var e=(d-1)*f,c=a;do{var o=e+4*(c-1),n=i[o],h=i[o+1],g=i[o+2];n>127&&(n=255-n),h>127&&(h=255-h),g>127&&(g=255-g),i[o]=n,i[o+1]=h,i[o+2]=g}while(--c)}while(--d)},function(){var a=t.Util.createCanvasElement();t.Filters.Kaleidoscope=function(s){var f,d,c,o,n,h,g,_,y,l=s.width,p=s.height,m=Math.round(this.kaleidoscopePower()),w=Math.round(this.kaleidoscopeAngle()),P=Math.floor(l*(w%360)/360);if(!(1>m)){a.width=l,a.height=p;var k=a.getContext("2d").getImageData(0,0,l,p);!function(s,f,d){var e,c,o,n,h=s.data,g=f.data,_=s.width,y=s.height,l=d.polarCenterX||_/2,p=d.polarCenterY||y/2,m=0,w=0,P=0,k=0,x=Math.sqrt(l*l+p*p);c=_-l,o=y-p,x=(n=Math.sqrt(c*c+o*o))>x?n:x;var D,u,v,b,F=y,T=_,M=360/T*Math.PI/180;for(u=0;T>u;u+=1)for(v=Math.sin(u*M),b=Math.cos(u*M),D=0;F>D;D+=1)c=Math.floor(l+x*D/F*b),m=h[0+(e=4*((o=Math.floor(p+x*D/F*v))*_+c))],w=h[e+1],P=h[e+2],k=h[e+3],g[0+(e=4*(u+D*_))]=m,g[e+1]=w,g[e+2]=P,g[e+3]=k}(s,k,{polarCenterX:l/2,polarCenterY:p/2});for(var x=l/Math.pow(2,m);8>=x;)x*=2,m-=1;var D=x=Math.ceil(x),u=0,v=D,b=1;for(P+x>l&&(u=D,v=0,b=-1),d=0;p>d;d+=1)for(f=u;f!==v;f+=b)_=4*(l*d+Math.round(f+P)%l),o=k.data[_+0],n=k.data[_+1],h=k.data[_+2],g=k.data[_+3],y=4*(l*d+f),k.data[y+0]=o,k.data[y+1]=n,k.data[y+2]=h,k.data[y+3]=g;for(d=0;p>d;d+=1)for(D=Math.floor(x),c=0;m>c;c+=1){for(f=0;D+1>f;f+=1)_=4*(l*d+f),o=k.data[_+0],n=k.data[_+1],h=k.data[_+2],g=k.data[_+3],y=4*(l*d+2*D-f-1),k.data[y+0]=o,k.data[y+1]=n,k.data[y+2]=h,k.data[y+3]=g;D*=2}!function(s,f,d){var e,c,o,n,h,g,_=s.data,y=f.data,l=s.width,p=s.height,m=d.polarCenterX||l/2,w=d.polarCenterY||p/2,P=0,k=0,x=0,D=0,u=Math.sqrt(m*m+w*w);c=l-m,o=p-w,u=(g=Math.sqrt(c*c+o*o))>u?g:u;var v,b,F,M=p,I=l,B=d.polarRotation||0;for(c=0;l>c;c+=1)for(o=0;p>o;o+=1)n=c-m,h=o-w,v=Math.sqrt(n*n+h*h)*M/u,b=(b=(180*Math.atan2(h,n)/Math.PI+360+B)%360)*I/360,F=Math.floor(b),P=_[0+(e=4*(Math.floor(v)*l+F))],k=_[e+1],x=_[e+2],D=_[e+3],y[0+(e=4*(o*l+c))]=P,y[e+1]=k,y[e+2]=x,y[e+3]=D}(k,s,{polarRotation:0})}},t.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,null,t.Factory.afterSetFilter),t.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,null,t.Factory.afterSetFilter)}(),function(){function r(e){setTimeout(e,1e3/60)}var s=t.root.performance&&t.root.performance.now?function(){return t.root.performance.now()}:function(){return(new Date).getTime()},f=t.root.requestAnimationFrame||t.root.webkitRequestAnimationFrame||t.root.mozRequestAnimationFrame||t.root.oRequestAnimationFrame||t.root.msRequestAnimationFrame||r;t.Animation=function(e,c){var o=t.Animation;this.func=e,this.setLayers(c),this.id=o.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:s()}},t.Animation.prototype={setLayers:function(e){var c;c=e?e.length>0?e:[e]:[],this.layers=c},getLayers:function(){return this.layers},addLayer:function(e){var c,o,n=this.layers;if(n){for(c=n.length,o=0;c>o;o++)if(n[o]._id===e._id)return!1}else this.layers=[];return this.layers.push(e),!0},isRunning:function(){var e,o=t.Animation.animations,n=o.length;for(e=0;n>e;e++)if(o[e].id===this.id)return!0;return!1},start:function(){var e=t.Animation;this.stop(),this.frame.timeDiff=0,this.frame.lastTime=s(),e._addAnimation(this)},stop:function(){t.Animation._removeAnimation(this)},_updateFrameObject:function(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},t.Animation.animations=[],t.Animation.animIdCounter=0,t.Animation.animRunning=!1,t.Animation._addAnimation=function(e){this.animations.push(e),this._handleAnimation()},t.Animation._removeAnimation=function(e){var c,o=e.id,n=this.animations,h=n.length;for(c=0;h>c;c++)if(n[c].id===o){this.animations.splice(c,1);break}},t.Animation._runFrames=function(){var e,c,o,n,h,g,_,y,p={},m=this.animations;for(n=0;n<m.length;n++)if(c=(e=m[n]).layers,o=e.func,e._updateFrameObject(s()),g=c.length,!o||!1!==o.call(e,e.frame))for(h=0;g>h;h++)void 0!==(_=c[h])._id&&(p[_._id]=_);for(y in p)p[y].draw()},t.Animation._animationLoop=function(){var e=t.Animation;e.animations.length?(function(){f.apply(t.root,arguments)}(e._animationLoop),e._runFrames()):e.animRunning=!1},t.Animation._handleAnimation=function(){this.animRunning||(this.animRunning=!0,this._animationLoop())};var d=t.Node.prototype.moveTo;t.Node.prototype.moveTo=function(e){d.call(this,e)},t.BaseLayer.prototype.batchDraw=function(){var e=this,c=t.Animation;this.batchAnim||(this.batchAnim=new c(function(){e.lastBatchDrawTime&&s()-e.lastBatchDrawTime>500&&e.batchAnim.stop()},this)),this.lastBatchDrawTime=s(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},t.Stage.prototype.batchDraw=function(){this.getChildren().each(function(e){e.batchDraw()})}}(),function(){var r={node:1,duration:1,easing:1,onFinish:1,yoyo:1},f=0;t.Tween=function(e){var c,o,n=this,h=e.node,g=h._id,_=e.easing||t.Easings.Linear,y=!!e.yoyo;for(o in c=void 0===e.duration?1:0===e.duration?.001:e.duration,this.node=h,this._id=f++,this.anim=new t.Animation(function(){n.tween.onEnterFrame()},h.getLayer()||(h instanceof t.Stage?h.getLayers():null)),this.tween=new d(o,function(l){n._tweenFunc(l)},_,0,1,1e3*c,y),this._addListeners(),t.Tween.attrs[g]||(t.Tween.attrs[g]={}),t.Tween.attrs[g][this._id]||(t.Tween.attrs[g][this._id]={}),t.Tween.tweens[g]||(t.Tween.tweens[g]={}),e)void 0===r[o]&&this._addAttr(o,e[o]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset},t.Tween.attrs={},t.Tween.tweens={},t.Tween.prototype={_addAttr:function(e,c){var o,n,h,g,_,y=this.node,l=y._id;if((h=t.Tween.tweens[l][e])&&delete t.Tween.attrs[l][h][e],o=y.getAttr(e),t.Util._isArray(c))for(n=[],_=c.length,g=0;_>g;g++)n.push(c[g]-o[g]);else n=c-o;t.Tween.attrs[l][this._id][e]={start:o,diff:n},t.Tween.tweens[l][e]=this._id},_tweenFunc:function(e){var c,o,n,h,g,_,y,l=this.node,p=t.Tween.attrs[l._id][this._id];for(c in p){if(n=(o=p[c]).start,h=o.diff,t.Util._isArray(n))for(g=[],y=n.length,_=0;y>_;_++)g.push(n[_]+h[_]*e);else g=n+h*e;l.setAttr(c,g)}},_addListeners:function(){var e=this;this.tween.onPlay=function(){e.anim.start()},this.tween.onReverse=function(){e.anim.start()},this.tween.onPause=function(){e.anim.stop()},this.tween.onFinish=function(){e.onFinish&&e.onFinish()},this.tween.onReset=function(){e.onReset&&e.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){return this.tween.reset(),this},seek:function(e){return this.tween.seek(1e3*e),this},pause:function(){return this.tween.pause(),this},finish:function(){return this.tween.finish(),this},destroy:function(){var e,c=this.node._id,o=this._id,n=t.Tween.tweens[c];for(e in this.pause(),n)delete t.Tween.tweens[c][e];delete t.Tween.attrs[c][o]}};var d=function(e,c,o,n,h,g,_){this.prop=e,this.propFunc=c,this.begin=n,this._pos=n,this.duration=g,this._change=0,this.prevPos=0,this.yoyo=_,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=o,this._change=h-this.begin,this.pause()};d.prototype={fire:function(e){var c=this[e];c&&c()},setTime:function(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>e?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())},getTime:function(){return this._time},setPosition:function(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e},getPosition:function(e){return void 0===e&&(e=this._time),this.func(e,this.begin,this._change,this.duration)},play:function(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var e=this.getTimer()-this._startTime;2===this.state?this.setTime(e):3===this.state&&this.setTime(this.duration-e)},pause:function(){this.state=1,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},t.Easings={BackEaseIn:function(e,c,o,n){var h=1.70158;return o*(e/=n)*e*((h+1)*e-h)+c},BackEaseOut:function(e,c,o,n){var h=1.70158;return o*((e=e/n-1)*e*((h+1)*e+h)+1)+c},BackEaseInOut:function(e,c,o,n){var h=1.70158;return(e/=n/2)<1?o/2*e*e*((1+(h*=1.525))*e-h)+c:o/2*((e-=2)*e*((1+(h*=1.525))*e+h)+2)+c},ElasticEaseIn:function(e,c,o,n,h,g){var _=0;return 0===e?c:1==(e/=n)?c+o:(g||(g=.3*n),!h||h<Math.abs(o)?(h=o,_=g/4):_=g/(2*Math.PI)*Math.asin(o/h),-h*Math.pow(2,10*(e-=1))*Math.sin(2*(e*n-_)*Math.PI/g)+c)},ElasticEaseOut:function(e,c,o,n,h,g){var _=0;return 0===e?c:1==(e/=n)?c+o:(g||(g=.3*n),!h||h<Math.abs(o)?(h=o,_=g/4):_=g/(2*Math.PI)*Math.asin(o/h),h*Math.pow(2,-10*e)*Math.sin(2*(e*n-_)*Math.PI/g)+o+c)},ElasticEaseInOut:function(e,c,o,n,h,g){var _=0;return 0===e?c:2==(e/=n/2)?c+o:(g||(g=.3*n*1.5),!h||h<Math.abs(o)?(h=o,_=g/4):_=g/(2*Math.PI)*Math.asin(o/h),1>e?-.5*h*Math.pow(2,10*(e-=1))*Math.sin(2*(e*n-_)*Math.PI/g)+c:h*Math.pow(2,-10*(e-=1))*Math.sin(2*(e*n-_)*Math.PI/g)*.5+o+c)},BounceEaseOut:function(e,c,o,n){return(e/=n)<1/2.75?7.5625*o*e*e+c:2/2.75>e?o*(7.5625*(e-=1.5/2.75)*e+.75)+c:2.5/2.75>e?o*(7.5625*(e-=2.25/2.75)*e+.9375)+c:o*(7.5625*(e-=2.625/2.75)*e+.984375)+c},BounceEaseIn:function(e,c,o,n){return o-t.Easings.BounceEaseOut(n-e,0,o,n)+c},BounceEaseInOut:function(e,c,o,n){return n/2>e?.5*t.Easings.BounceEaseIn(2*e,0,o,n)+c:.5*t.Easings.BounceEaseOut(2*e-n,0,o,n)+.5*o+c},EaseIn:function(e,c,o,n){return o*(e/=n)*e+c},EaseOut:function(e,c,o,n){return-o*(e/=n)*(e-2)+c},EaseInOut:function(e,c,o,n){return(e/=n/2)<1?o/2*e*e+c:-o/2*(--e*(e-2)-1)+c},StrongEaseIn:function(e,c,o,n){return o*(e/=n)*e*e*e*e+c},StrongEaseOut:function(e,c,o,n){return o*((e=e/n-1)*e*e*e*e+1)+c},StrongEaseInOut:function(e,c,o,n){return(e/=n/2)<1?o/2*e*e*e*e*e+c:o/2*((e-=2)*e*e*e*e+2)+c},Linear:function(e,c,o,n){return o*e/n+c}}}(),function(){t.DD={anim:new t.Animation(function(){var a=this.dirty;return this.dirty=!1,a}),isDragging:!1,justDragged:!1,offset:{x:0,y:0},node:null,_drag:function(a){var s=t.DD,f=s.node;if(f){if(!s.isDragging){var d=f.getStage().getPointerPosition();if(f.dragDistance()>Math.max(Math.abs(d.x-s.startPointerPos.x),Math.abs(d.y-s.startPointerPos.y)))return}f._setDragPosition(a),s.isDragging||(s.isDragging=!0,f.fire("dragstart",{type:"dragstart",target:f,evt:a},!0)),f.fire("dragmove",{type:"dragmove",target:f,evt:a},!0)}},_endDragBefore:function(a){var f,d=t.DD,e=d.node;e&&(e.nodeType,f=e.getLayer(),d.anim.stop(),d.isDragging&&(d.isDragging=!1,d.justDragged=!0,t.listenClickTap=!1,a&&(a.dragEndNode=e)),delete d.node,(f||e).draw())},_endDragAfter:function(a){var s=(a=a||{}).dragEndNode;a&&s&&s.fire("dragend",{type:"dragend",target:s,evt:a},!0)}},t.Node.prototype.startDrag=function(){var a=t.DD,s=this.getStage(),f=this.getLayer(),d=s.getPointerPosition(),e=this.getAbsolutePosition();d&&(a.node&&a.node.stopDrag(),a.node=this,a.startPointerPos=d,a.offset.x=d.x-e.x,a.offset.y=d.y-e.y,a.anim.setLayers(f||this.getLayers()),a.anim.start(),this._setDragPosition())},t.Node.prototype._setDragPosition=function(a){var s=t.DD,f=this.getStage().getPointerPosition(),d=this.getDragBoundFunc();if(f){var e={x:f.x-s.offset.x,y:f.y-s.offset.y};void 0!==d&&(e=d.call(this,e,a)),this.setAbsolutePosition(e),this._lastPos&&this._lastPos.x===e.x&&this._lastPos.y===e.y||(s.anim.dirty=!0),this._lastPos=e}},t.Node.prototype.stopDrag=function(){var a=t.DD,s={};a._endDragBefore(s),a._endDragAfter(s)},t.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a),this._dragChange()};var r=t.Node.prototype.destroy;t.Node.prototype.destroy=function(){var a=t.DD;a.node&&a.node._id===this._id&&this.stopDrag(),r.call(this)},t.Node.prototype.isDragging=function(){var a=t.DD;return!(!a.node||a.node._id!==this._id||!a.isDragging)},t.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(s){t.DD.node||a.startDrag(s)}):this.on("mousedown.kinetic touchstart.kinetic",function(s){1!==s.evt.button&&2!==s.evt.button&&(t.DD.node||a.startDrag(s))})},t.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),s=t.DD;a&&s.node&&s.node._id===this._id&&s.node.stopDrag()}},t.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))},t.Factory.addGetterSetter(t.Node,"dragBoundFunc"),t.Factory.addGetter(t.Node,"draggable",!1),t.Factory.addOverloadedGetterSetter(t.Node,"draggable");var i=t.document.documentElement;i.addEventListener("mouseup",t.DD._endDragBefore,!0),i.addEventListener("touchend",t.DD._endDragBefore,!0),i.addEventListener("mouseup",t.DD._endDragAfter,!1),i.addEventListener("touchend",t.DD._endDragAfter,!1)}(),t.Util.addMethods(t.Container,{__init:function(r){this.children=new t.Collection,t.Node.call(this,r)},getChildren:function(r){if(r){var i=new t.Collection;return this.children.each(function(a){r(a)&&i.push(a)}),i}return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var r,i=t.Collection.toCollection(this.children),a=0;a<i.length;a++)delete(r=i[a]).parent,r.index=0,r.hasChildren()&&r.removeChildren(),r.remove();return i=null,this.children=new t.Collection,this},destroyChildren:function(){for(var r,i=t.Collection.toCollection(this.children),a=0;a<i.length;a++)delete(r=i[a]).parent,r.index=0,r.destroy();return i=null,this.children=new t.Collection,this},add:function(r){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}if(r.getParent())return r.moveTo(this),this;var a=this.children;return this._validateAdd(r),r.index=a.length,r.parent=this,a.push(r),this._fire("add",{child:r}),r.isDragging()&&t.DD.anim.setLayers(r.getLayer()),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),t.Node.prototype.destroy.call(this)},find:function(r){var i,a,s,f,d,e,c,o=[],n=r.replace(/ /g,"").split(","),h=n.length;for(i=0;h>i;i++)if("#"===(s=n[i]).charAt(0))(d=this._getNodeById(s.slice(1)))&&o.push(d);else if("."===s.charAt(0))f=this._getNodesByName(s.slice(1)),o=o.concat(f);else for(c=(e=this.getChildren()).length,a=0;c>a;a++)o=o.concat(e[a]._get(s));return t.Collection.toCollection(o)},_getNodeById:function(r){var i=t.ids[r];return void 0!==i&&this.isAncestorOf(i)?i:null},_getNodesByName:function(r){var i=t.names[r]||[];return this._getDescendants(i)},_get:function(r){for(var i=t.Node.prototype._get.call(this,r),a=this.getChildren(),s=a.length,f=0;s>f;f++)i=i.concat(a[f]._get(r));return i},toObject:function(){var r=t.Node.prototype.toObject.call(this);r.children=[];for(var i=this.getChildren(),a=i.length,s=0;a>s;s++){var f=i[s];r.children.push(f.toObject())}return r},_getDescendants:function(r){for(var i=[],a=r.length,s=0;a>s;s++){var f=r[s];this.isAncestorOf(f)&&i.push(f)}return i},isAncestorOf:function(r){for(var i=r.getParent();i;){if(i._id===this._id)return!0;i=i.getParent()}return!1},clone:function(r){var i=t.Node.prototype.clone.call(this,r);return this.getChildren().each(function(a){i.add(a.clone())}),i},getAllIntersections:function(r){var i=[];return this.find("Shape").each(function(a){a.isVisible()&&a.intersects(r)&&i.push(a)}),i},_setChildrenIndices:function(){this.children.each(function(r,i){r.index=i})},drawScene:function(r,i){var a=this.getLayer(),s=r||a&&a.getCanvas(),f=s&&s.getContext(),d=this._cache.canvas,e=d&&d.scene;return this.isVisible()&&(e?this._drawCachedSceneCanvas(f):this._drawChildren(s,"drawScene",i)),this},drawHit:function(r,i){var a=this.getLayer(),s=r||a&&a.hitCanvas,f=s&&s.getContext(),d=this._cache.canvas,e=d&&d.hit;return this.shouldDrawHit(s)&&(a&&a.clearHitCache(),e?this._drawCachedHitCanvas(f):this._drawChildren(s,"drawHit",i)),this},_drawChildren:function(r,i,a){var s,f,d=this.getLayer(),e=r&&r.getContext(),c=this.getClipWidth(),o=this.getClipHeight(),n=c&&o;n&&d&&(s=this.getClipX(),f=this.getClipY(),e.save(),d._applyTransform(this,e),e.beginPath(),e.rect(s,f,c,o),e.clip(),e.reset()),this.children.each(function(h){h[i](r,a)}),n&&e.restore()},shouldDrawHit:function(r){var i=this.getLayer(),s=t.DD&&t.isDragging()&&-1!==t.DD.anim.getLayers().indexOf(i);return r&&r.isCache||i&&i.hitGraphEnabled()&&this.isVisible()&&!s}}),t.Util.extend(t.Container,t.Node),t.Container.prototype.get=t.Container.prototype.find,t.Factory.addComponentsGetterSetter(t.Container,"clip",["x","y","width","height"]),t.Factory.addGetterSetter(t.Container,"clipX"),t.Factory.addGetterSetter(t.Container,"clipY"),t.Factory.addGetterSetter(t.Container,"clipWidth"),t.Factory.addGetterSetter(t.Container,"clipHeight"),t.Collection.mapMethods(t.Container),function(){function r(e){e.fill()}function i(e){e.stroke()}function a(e){e.fill()}function s(e){e.stroke()}function f(){this._clearCache(d)}var d="hasShadow";t.Util.addMethods(t.Shape,{__init:function(e){this.nodeType="Shape",this._fillFunc=r,this._strokeFunc=i,this._fillFuncHit=a,this._strokeFuncHit=s;for(var c,o=t.shapes;!(c=t.Util.getRandomColor())||c in o;);this.colorKey=c,o[c]=this,t.Node.call(this,e),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",f)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(d,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},intersects:function(e){var n=this.getStage().bufferHitCanvas;return n.getContext().clear(),this.drawScene(n),n.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data[3]>0},destroy:function(){t.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(e,c){var n,h,g=this.getLayer(),_=e||g.getCanvas(),y=_.getContext(),l=this._cache.canvas,p=this.sceneFunc(),m=this.hasShadow();if(this.isVisible())if(l)this._drawCachedSceneCanvas(y);else if(p){if(y.save(),this._useBufferCanvas()){if((h=(n=this.getStage().bufferCanvas).getContext()).clear(),h.save(),h._applyLineJoin(this),g)g._applyTransform(this,h,c);else{var w=this.getAbsoluteTransform(c).getMatrix();y.transform(w[0],w[1],w[2],w[3],w[4],w[5])}p.call(this,h),h.restore(),m&&!_.hitCanvas&&(y.save(),y._applyShadow(this),y.drawImage(n._canvas,0,0),y.restore()),y._applyOpacity(this),y.drawImage(n._canvas,0,0)}else{if(y._applyLineJoin(this),g)g._applyTransform(this,y,c);else{var P=this.getAbsoluteTransform(c).getMatrix();y.transform(P[0],P[1],P[2],P[3],P[4],P[5])}m&&!_.hitCanvas&&(y.save(),y._applyShadow(this),p.call(this,y),y.restore()),y._applyOpacity(this),p.call(this,y)}y.restore()}return this},drawHit:function(e,c){var o=this.getLayer(),n=e||o.hitCanvas,h=n.getContext(),g=this.hitFunc()||this.sceneFunc(),_=this._cache.canvas,y=_&&_.hit;if(this.shouldDrawHit(n))if(o&&o.clearHitCache(),y)this._drawCachedHitCanvas(h);else if(g){if(h.save(),h._applyLineJoin(this),o)o._applyTransform(this,h,c);else{var l=this.getAbsoluteTransform(c).getMatrix();h.transform(l[0],l[1],l[2],l[3],l[4],l[5])}g.call(this,h),h.restore()}return this},drawHitFromCache:function(e){var o,n,h,g,_,y,p=e||0,m=this._cache.canvas,w=this._getCachedSceneCanvas(),P=w.getContext(),x=m.hit.getContext(),D=w.getWidth(),u=w.getHeight();x.clear();try{for(o=P.getImageData(0,0,D,u).data,h=(n=x.getImageData(0,0,D,u)).data,g=o.length,_=t.Util._hexToRgb(this.colorKey),y=0;g>y;y+=4)o[y+3]>p&&(h[y]=_.r,h[y+1]=_.g,h[y+2]=_.b,h[y+3]=255);x.putImageData(n,0,0)}catch(v){t.Util.warn("Unable to draw hit graph from cached scene canvas. "+v.message)}return this}}),t.Util.extend(t.Shape,t.Node),t.Factory.addGetterSetter(t.Shape,"stroke"),t.Factory.addGetterSetter(t.Shape,"strokeRed",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"strokeGreen",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"strokeBlue",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"strokeAlpha",1,t.Validators.alphaComponent),t.Factory.addGetterSetter(t.Shape,"strokeWidth",2),t.Factory.addGetterSetter(t.Shape,"lineJoin"),t.Factory.addGetterSetter(t.Shape,"lineCap"),t.Factory.addGetterSetter(t.Shape,"sceneFunc"),t.Factory.addGetterSetter(t.Shape,"hitFunc"),t.Factory.addGetterSetter(t.Shape,"dash"),t.Factory.addGetterSetter(t.Shape,"shadowColor"),t.Factory.addGetterSetter(t.Shape,"shadowRed",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"shadowGreen",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"shadowBlue",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"shadowAlpha",1,t.Validators.alphaComponent),t.Factory.addGetterSetter(t.Shape,"shadowBlur"),t.Factory.addGetterSetter(t.Shape,"shadowOpacity"),t.Factory.addComponentsGetterSetter(t.Shape,"shadowOffset",["x","y"]),t.Factory.addGetterSetter(t.Shape,"shadowOffsetX",0),t.Factory.addGetterSetter(t.Shape,"shadowOffsetY",0),t.Factory.addGetterSetter(t.Shape,"fillPatternImage"),t.Factory.addGetterSetter(t.Shape,"fill"),t.Factory.addGetterSetter(t.Shape,"fillRed",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"fillGreen",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"fillBlue",0,t.Validators.RGBComponent),t.Factory.addGetterSetter(t.Shape,"fillAlpha",1,t.Validators.alphaComponent),t.Factory.addGetterSetter(t.Shape,"fillPatternX",0),t.Factory.addGetterSetter(t.Shape,"fillPatternY",0),t.Factory.addGetterSetter(t.Shape,"fillLinearGradientColorStops"),t.Factory.addGetterSetter(t.Shape,"fillRadialGradientStartRadius",0),t.Factory.addGetterSetter(t.Shape,"fillRadialGradientEndRadius",0),t.Factory.addGetterSetter(t.Shape,"fillRadialGradientColorStops"),t.Factory.addGetterSetter(t.Shape,"fillPatternRepeat","repeat"),t.Factory.addGetterSetter(t.Shape,"fillEnabled",!0),t.Factory.addGetterSetter(t.Shape,"strokeEnabled",!0),t.Factory.addGetterSetter(t.Shape,"shadowEnabled",!0),t.Factory.addGetterSetter(t.Shape,"dashEnabled",!0),t.Factory.addGetterSetter(t.Shape,"strokeScaleEnabled",!0),t.Factory.addGetterSetter(t.Shape,"fillPriority","color"),t.Factory.addComponentsGetterSetter(t.Shape,"fillPatternOffset",["x","y"]),t.Factory.addGetterSetter(t.Shape,"fillPatternOffsetX",0),t.Factory.addGetterSetter(t.Shape,"fillPatternOffsetY",0),t.Factory.addComponentsGetterSetter(t.Shape,"fillPatternScale",["x","y"]),t.Factory.addGetterSetter(t.Shape,"fillPatternScaleX",1),t.Factory.addGetterSetter(t.Shape,"fillPatternScaleY",1),t.Factory.addComponentsGetterSetter(t.Shape,"fillLinearGradientStartPoint",["x","y"]),t.Factory.addGetterSetter(t.Shape,"fillLinearGradientStartPointX",0),t.Factory.addGetterSetter(t.Shape,"fillLinearGradientStartPointY",0),t.Factory.addComponentsGetterSetter(t.Shape,"fillLinearGradientEndPoint",["x","y"]),t.Factory.addGetterSetter(t.Shape,"fillLinearGradientEndPointX",0),t.Factory.addGetterSetter(t.Shape,"fillLinearGradientEndPointY",0),t.Factory.addComponentsGetterSetter(t.Shape,"fillRadialGradientStartPoint",["x","y"]),t.Factory.addGetterSetter(t.Shape,"fillRadialGradientStartPointX",0),t.Factory.addGetterSetter(t.Shape,"fillRadialGradientStartPointY",0),t.Factory.addComponentsGetterSetter(t.Shape,"fillRadialGradientEndPoint",["x","y"]),t.Factory.addGetterSetter(t.Shape,"fillRadialGradientEndPointX",0),t.Factory.addGetterSetter(t.Shape,"fillRadialGradientEndPointY",0),t.Factory.addGetterSetter(t.Shape,"fillPatternRotation",0),t.Factory.backCompat(t.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),t.Collection.mapMethods(t.Shape)}(),function(){function r(S,A){S.content.addEventListener(A,function(N){S[H+A](N)},!1)}var f="mouseout",d="mouseleave",e="mouseover",o="mousemove",n="mousedown",h="mouseup",y="touchstart",l="touchend",w="touchmove",k="mousewheel",G="div",H="_",L=[n,o,h,f,y,w,l,e,"DOMMouseScroll",k,"wheel"],U=L.length;t.Util.addMethods(t.Stage,{___init:function(S){this.nodeType="Stage",t.Container.call(this,S),this._id=t.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,t.stages.push(this)},_validateAdd:function(S){"Layer"!==S.getType()&&t.Util.error("You may only add layers to the stage.")},setContainer:function(S){if("string"==typeof S){var A=S;if(!(S=t.document.getElementById(S)))throw"Can not find container in document with id "+A}return this._setAttr("container",S),this},shouldDrawHit:function(){return!0},draw:function(){return t.Node.prototype.draw.call(this),this},setHeight:function(S){return t.Node.prototype.setHeight.call(this,S),this._resizeDOM(),this},setWidth:function(S){return t.Node.prototype.setWidth.call(this,S),this._resizeDOM(),this},clear:function(){var S,A=this.children,N=A.length;for(S=0;N>S;S++)A[S].clear();return this},clone:function(S){return S||(S={}),S.container=t.document.createElement(G),t.Container.prototype.clone.call(this,S)},destroy:function(){var S=this.content;t.Container.prototype.destroy.call(this),S&&t.Util._isInDocument(S)&&this.getContainer().removeChild(S);var A=t.stages.indexOf(this);A>-1&&t.stages.splice(A,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(S){var N=(S=S||{}).mimeType||null,X=S.quality||null,Q=S.x||0,q=S.y||0,J=new t.SceneCanvas({width:S.width||this.getWidth(),height:S.height||this.getHeight(),pixelRatio:1}),et=J.getContext()._context,ct=this.children;(Q||q)&&et.translate(-1*Q,-1*q),function A(at){var dt=ct[at].toDataURL(),nt=new t.window.Image;nt.onload=function(){et.drawImage(nt,0,0),at<ct.length-1?A(at+1):S.callback(J.toDataURL(N,X))},nt.src=dt}(0)},toImage:function(S){var A=S.callback;S.callback=function(N){t.Util._getImage(N,function(X){A(X)})},this.toDataURL(S)},getIntersection:function(S){var A,N,X=this.getChildren();for(A=X.length-1;A>=0;A--)if(N=X[A].getIntersection(S))return N;return null},_resizeDOM:function(){if(this.content){var S,A,N=this.getWidth(),X=this.getHeight(),Q=this.getChildren(),q=Q.length;for(this.content.style.width=N+"px",this.content.style.height=X+"px",this.bufferCanvas.setSize(N,X),this.bufferHitCanvas.setSize(N,X),S=0;q>S;S++)(A=Q[S]).setSize(N,X),A.draw()}},add:function(S){if(!(arguments.length>1))return t.Container.prototype.add.call(this,S),S._setCanvasSize(this.width(),this.height()),S.draw(),this.content.appendChild(S.canvas._canvas),this;for(var A=0;A<arguments.length;A++)this.add(arguments[A])},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var S=0;U>S;S++)r(this,L[S])},_mouseover:function(S){t.UA.mobile||(this._setPointerPosition(S),this._fire("contentMouseover",{evt:S}))},_mouseout:function(S){if(!t.UA.mobile){this._setPointerPosition(S);var A=this.targetShape;A&&!t.isDragging()&&(A._fireAndBubble(f,{evt:S}),A._fireAndBubble(d,{evt:S}),this.targetShape=null),this.pointerPos=void 0,this._fire("contentMouseout",{evt:S})}},_mousemove:function(S){if(t.UA.ieMobile)return this._touchmove(S);if((void 0===S.webkitMovementX&&void 0===S.webkitMovementY||0!==S.webkitMovementY||0!==S.webkitMovementX)&&!t.UA.mobile){this._setPointerPosition(S);var A,N=t.DD;t.isDragging()||((A=this.getIntersection(this.getPointerPosition()))&&A.isListening()?t.isDragging()||this.targetShape&&this.targetShape._id===A._id?A._fireAndBubble(o,{evt:S}):(this.targetShape&&(this.targetShape._fireAndBubble(f,{evt:S},A),this.targetShape._fireAndBubble(d,{evt:S},A)),A._fireAndBubble(e,{evt:S},this.targetShape),A._fireAndBubble("mouseenter",{evt:S},this.targetShape),this.targetShape=A):this.targetShape&&!t.isDragging()&&(this.targetShape._fireAndBubble(f,{evt:S}),this.targetShape._fireAndBubble(d,{evt:S}),this.targetShape=null),this._fire("contentMousemove",{evt:S})),N&&N._drag(S),S.preventDefault&&S.preventDefault()}},_mousedown:function(S){if(t.UA.ieMobile)return this._touchstart(S);if(!t.UA.mobile){this._setPointerPosition(S);var A=this.getIntersection(this.getPointerPosition());t.listenClickTap=!0,A&&A.isListening()&&(this.clickStartShape=A,A._fireAndBubble(n,{evt:S})),this._fire("contentMousedown",{evt:S})}S.preventDefault&&S.preventDefault()},_mouseup:function(S){if(t.UA.ieMobile)return this._touchend(S);if(!t.UA.mobile){this._setPointerPosition(S);var A=this.getIntersection(this.getPointerPosition()),N=this.clickStartShape,X=!1,Q=t.DD;t.inDblClickWindow?(X=!0,t.inDblClickWindow=!1):Q&&Q.justDragged?Q&&(Q.justDragged=!1):t.inDblClickWindow=!0,setTimeout(function(){t.inDblClickWindow=!1},t.dblClickWindow),A&&A.isListening()&&(A._fireAndBubble(h,{evt:S}),t.listenClickTap&&N&&N._id===A._id&&(A._fireAndBubble("click",{evt:S}),X&&A._fireAndBubble("dblclick",{evt:S}))),this._fire("contentMouseup",{evt:S}),t.listenClickTap&&(this._fire("contentClick",{evt:S}),X&&this._fire("contentDblclick",{evt:S})),t.listenClickTap=!1}S.preventDefault&&S.preventDefault()},_touchstart:function(S){this._setPointerPosition(S);var A=this.getIntersection(this.getPointerPosition());t.listenClickTap=!0,A&&A.isListening()&&(this.tapStartShape=A,A._fireAndBubble(y,{evt:S}),A.isListening()&&S.preventDefault&&S.preventDefault()),this._fire("contentTouchstart",{evt:S})},_touchend:function(S){this._setPointerPosition(S);var A=this.getIntersection(this.getPointerPosition()),N=!1;t.inDblClickWindow?(N=!0,t.inDblClickWindow=!1):t.inDblClickWindow=!0,setTimeout(function(){t.inDblClickWindow=!1},t.dblClickWindow),A&&A.isListening()&&(A._fireAndBubble(l,{evt:S}),t.listenClickTap&&A._id===this.tapStartShape._id&&(A._fireAndBubble("tap",{evt:S}),N&&A._fireAndBubble("dbltap",{evt:S})),A.isListening()&&S.preventDefault&&S.preventDefault()),t.listenClickTap&&(this._fire("contentTouchend",{evt:S}),N&&this._fire("contentDbltap",{evt:S})),t.listenClickTap=!1},_touchmove:function(S){this._setPointerPosition(S);var A,N=t.DD;t.isDragging()||((A=this.getIntersection(this.getPointerPosition()))&&A.isListening()&&(A._fireAndBubble(w,{evt:S}),A.isListening()&&S.preventDefault&&S.preventDefault()),this._fire("contentTouchmove",{evt:S})),N&&(N._drag(S),t.isDragging()&&S.preventDefault())},_DOMMouseScroll:function(S){this._mousewheel(S)},_mousewheel:function(S){this._setPointerPosition(S);var A=this.getIntersection(this.getPointerPosition());A&&A.isListening()&&A._fireAndBubble(k,{evt:S})},_wheel:function(S){this._mousewheel(S)},_setPointerPosition:function(S){var A,N=this._getContentPosition(),X=S.offsetX,Q=S.clientX,q=null,J=null;void 0!==(S=S||window.event).touches?S.touches.length>0&&(q=(A=S.touches[0]).clientX-N.left,J=A.clientY-N.top):void 0!==X?(q=X,J=S.offsetY):"mozilla"===t.UA.browser?(q=S.layerX,J=S.layerY):void 0!==Q&&N&&(q=Q-N.left,J=S.clientY-N.top),null!==q&&null!==J&&(this.pointerPos={x:q,y:J})},_getContentPosition:function(){var S=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:S.top,left:S.left}},_buildDOM:function(){var S=this.getContainer();if(!S){if(t.Util.isBrowser())throw"Stage has no container. A container is required.";S=t.document.createElement(G)}S.innerHTML="",this.content=t.document.createElement(G),this.content.style.position="relative",this.content.style.display="inline-block",this.content.className="kineticjs-content",this.content.setAttribute("role","presentation"),S.appendChild(this.content),this.bufferCanvas=new t.SceneCanvas({pixelRatio:1}),this.bufferHitCanvas=new t.HitCanvas,this._resizeDOM()},_onContent:function(S,A){var N,X,Q=S.split(" "),q=Q.length;for(N=0;q>N;N++)X=Q[N],this.content.addEventListener(X,A,!1)},cache:function(){t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}}),t.Util.extend(t.Stage,t.Container),t.Factory.addGetter(t.Stage,"container"),t.Factory.addOverloadedGetterSetter(t.Stage,"container")}(),t.Util.addMethods(t.BaseLayer,{___init:function(r){this.nodeType="Layer",t.Container.call(this,r)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(r){return this.getContext().clear(r),this.getHitCanvas().getContext().clear(r),this},clearHitCache:function(){this._hitImageData=void 0},setZIndex:function(r){t.Node.prototype.setZIndex.call(this,r);var i=this.getStage();return i&&(i.content.removeChild(this.getCanvas()._canvas),r<i.getChildren().length-1?i.content.insertBefore(this.getCanvas()._canvas,i.getChildren()[r+1].getCanvas()._canvas):i.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){t.Node.prototype.moveToTop.call(this);var r=this.getStage();r&&(r.content.removeChild(this.getCanvas()._canvas),r.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(t.Node.prototype.moveUp.call(this)){var r=this.getStage();r&&(r.content.removeChild(this.getCanvas()._canvas),this.index<r.getChildren().length-1?r.content.insertBefore(this.getCanvas()._canvas,r.getChildren()[this.index+1].getCanvas()._canvas):r.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(t.Node.prototype.moveDown.call(this)){var r=this.getStage();if(r){var i=r.getChildren();r.content.removeChild(this.getCanvas()._canvas),r.content.insertBefore(this.getCanvas()._canvas,i[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(t.Node.prototype.moveToBottom.call(this)){var r=this.getStage();if(r){var i=r.getChildren();r.content.removeChild(this.getCanvas()._canvas),r.content.insertBefore(this.getCanvas()._canvas,i[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var r=this.getCanvas()._canvas;return t.Node.prototype.remove.call(this),r&&r.parentNode&&t.Util._isInDocument(r)&&r.parentNode.removeChild(r),this},getStage:function(){return this.parent},setSize:function(r,i){this.canvas.setSize(r,i)},getWidth:function(){return this.parent?this.parent.getWidth():void 0},setWidth:function(){t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},getHeight:function(){return this.parent?this.parent.getHeight():void 0},setHeight:function(){t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}}),t.Util.extend(t.BaseLayer,t.Container),t.Factory.addGetterSetter(t.BaseLayer,"clearBeforeDraw",!0),t.Collection.mapMethods(t.BaseLayer),function(){var s=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],f=s.length;t.Util.addMethods(t.Layer,{____init:function(d){this.nodeType="Layer",this.canvas=new t.SceneCanvas,this.hitCanvas=new t.HitCanvas,t.BaseLayer.call(this,d)},_setCanvasSize:function(d,e){this.canvas.setSize(d,e),this.hitCanvas.setSize(d,e)},_validateAdd:function(d){var e=d.getType();"Group"!==e&&"Shape"!==e&&t.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(d){var e,c,o,n;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(var h=1,g=!1;;){for(c=0;f>c;c++){if(o=s[c],n=(e=this._getIntersection({x:d.x+o.x*h,y:d.y+o.y*h})).shape)return n;e.antialiased&&(g=!0)}if(!g)return;h+=1}},_getImageData:function(d,e){var c=this.hitCanvas.width||1,o=this.hitCanvas.height||1,n=Math.round(e)*c+Math.round(d);return this._hitImageData||(this._hitImageData=this.hitCanvas.context.getImageData(0,0,c,o)),[this._hitImageData.data[4*n+0],this._hitImageData.data[4*n+1],this._hitImageData.data[4*n+2],this._hitImageData.data[4*n+3]]},_getIntersection:function(d){var e,o=this.hitCanvas.context.getImageData(d.x,d.y,1,1).data,n=o[3];return 255===n?(e=t.Util._rgbToHex(o[0],o[1],o[2]),{shape:t.shapes["#"+e]}):n>0?{antialiased:!0}:{}},drawScene:function(d,e){var c=this.getLayer(),o=d||c&&c.getCanvas();return this._fire("beforeDraw",{node:this}),this.getClearBeforeDraw()&&o.getContext().clear(),t.Container.prototype.drawScene.call(this,o,e),this._fire("draw",{node:this}),this},_applyTransform:function(d,e,c){var o=d.getAbsoluteTransform(c).getMatrix();e.transform(o[0],o[1],o[2],o[3],o[4],o[5])},drawHit:function(d,e){var c=this.getLayer(),o=d||c&&c.hitCanvas;return c&&c.getClearBeforeDraw()&&c.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,o,e),this.imageData=null,this},clear:function(d){return this.getContext().clear(d),this.getHitCanvas().getContext().clear(d),this.imageData=null,this},setVisible:function(d){return t.Node.prototype.setVisible.call(this,d),d?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this},setSize:function(d,e){t.BaseLayer.prototype.setSize.call(this,d,e),this.hitCanvas.setSize(d,e)}}),t.Util.extend(t.Layer,t.BaseLayer),t.Factory.addGetterSetter(t.Layer,"hitGraphEnabled",!0),t.Collection.mapMethods(t.Layer)}(),t.Util.addMethods(t.FastLayer,{____init:function(r){this.nodeType="Layer",this.canvas=new t.SceneCanvas,t.BaseLayer.call(this,r)},_validateAdd:function(r){"Shape"!==r.getType()&&t.Util.error("You may only add shapes to a fast layer.")},_setCanvasSize:function(r,i){this.canvas.setSize(r,i)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(r){var i=this.getLayer(),a=r||i&&i.getCanvas();return this.getClearBeforeDraw()&&a.getContext().clear(),t.Container.prototype.drawScene.call(this,a),this},_applyTransform:function(r,i,a){if(!a||a._id!==this._id){var s=r.getTransform().getMatrix();i.transform(s[0],s[1],s[2],s[3],s[4],s[5])}},draw:function(){return this.drawScene(),this},clear:function(r){return this.getContext().clear(r),this},setVisible:function(r){return t.Node.prototype.setVisible.call(this,r),this.getCanvas()._canvas.style.display=r?"block":"none",this}}),t.Util.extend(t.FastLayer,t.BaseLayer),t.Collection.mapMethods(t.FastLayer),t.Util.addMethods(t.Group,{___init:function(r){this.nodeType="Group",t.Container.call(this,r)},_validateAdd:function(r){var i=r.getType();"Group"!==i&&"Shape"!==i&&t.Util.error("You may only add groups and shapes to groups.")}}),t.Util.extend(t.Group,t.Container),t.Collection.mapMethods(t.Group),t.Rect=function(r){this.___init(r)},t.Rect.prototype={___init:function(r){t.Shape.call(this,r),this.className="Rect",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(r){var i=this.getCornerRadius(),a=this.getWidth(),s=this.getHeight();r.beginPath(),i?(r.moveTo(i,0),r.lineTo(a-i,0),r.arc(a-i,i,i,3*Math.PI/2,0,!1),r.lineTo(a,s-i),r.arc(a-i,s-i,i,0,Math.PI/2,!1),r.lineTo(i,s),r.arc(i,s-i,i,Math.PI/2,Math.PI,!1),r.lineTo(0,i),r.arc(i,i,i,Math.PI,3*Math.PI/2,!1)):r.rect(0,0,a,s),r.closePath(),r.fillStrokeShape(this)}},t.Util.extend(t.Rect,t.Shape),t.Factory.addGetterSetter(t.Rect,"cornerRadius",0),t.Collection.mapMethods(t.Rect),function(){var r=2*Math.PI-1e-4;t.Circle=function(a){this.___init(a)},t.Circle.prototype={___init:function(a){t.Shape.call(this,a),this.className="Circle",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath(),a.arc(0,0,this.getRadius(),0,r,!1),a.closePath(),a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){t.Node.prototype.setWidth.call(this,a),this.radius()!==a/2&&this.setRadius(a/2)},setHeight:function(a){t.Node.prototype.setHeight.call(this,a),this.radius()!==a/2&&this.setRadius(a/2)},setRadius:function(a){this._setAttr("radius",a),this.setWidth(2*a),this.setHeight(2*a)}},t.Util.extend(t.Circle,t.Shape),t.Factory.addGetter(t.Circle,"radius",0),t.Factory.addOverloadedGetterSetter(t.Circle,"radius"),t.Collection.mapMethods(t.Circle)}(),function(){var r=2*Math.PI-1e-4;t.Ellipse=function(a){this.___init(a)},t.Ellipse.prototype={___init:function(a){t.Shape.call(this,a),this.className="Ellipse",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var s=this.getRadiusX(),f=this.getRadiusY();a.beginPath(),a.save(),s!==f&&a.scale(1,f/s),a.arc(0,0,s,0,r,!1),a.restore(),a.closePath(),a.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadiusX()},getHeight:function(){return 2*this.getRadiusY()},setWidth:function(a){t.Node.prototype.setWidth.call(this,a),this.setRadius({x:a/2})},setHeight:function(a){t.Node.prototype.setHeight.call(this,a),this.setRadius({y:a/2})}},t.Util.extend(t.Ellipse,t.Shape),t.Factory.addComponentsGetterSetter(t.Ellipse,"radius",["x","y"]),t.Factory.addGetterSetter(t.Ellipse,"radiusX",0),t.Factory.addGetterSetter(t.Ellipse,"radiusY",0),t.Collection.mapMethods(t.Ellipse)}(),function(){var r=2*Math.PI-1e-4;t.Ring=function(i){this.___init(i)},t.Ring.prototype={___init:function(i){t.Shape.call(this,i),this.className="Ring",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(i){i.beginPath(),i.arc(0,0,this.getInnerRadius(),0,r,!1),i.moveTo(this.getOuterRadius(),0),i.arc(0,0,this.getOuterRadius(),r,0,!0),i.closePath(),i.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(i){t.Node.prototype.setWidth.call(this,i),this.outerRadius()!==i/2&&this.setOuterRadius(i/2)},setHeight:function(i){t.Node.prototype.setHeight.call(this,i),this.outerRadius()!==i/2&&this.setOuterRadius(i/2)},setOuterRadius:function(i){this._setAttr("outerRadius",i),this.setWidth(2*i),this.setHeight(2*i)}},t.Util.extend(t.Ring,t.Shape),t.Factory.addGetterSetter(t.Ring,"innerRadius",0),t.Factory.addGetter(t.Ring,"outerRadius",0),t.Factory.addOverloadedGetterSetter(t.Ring,"outerRadius"),t.Collection.mapMethods(t.Ring)}(),t.Wedge=function(r){this.___init(r)},t.Wedge.prototype={___init:function(r){t.Shape.call(this,r),this.className="Wedge",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(r){r.beginPath(),r.arc(0,0,this.getRadius(),0,t.getAngle(this.getAngle()),this.getClockwise()),r.lineTo(0,0),r.closePath(),r.fillStrokeShape(this)}},t.Util.extend(t.Wedge,t.Shape),t.Factory.addGetterSetter(t.Wedge,"radius",0),t.Factory.addGetterSetter(t.Wedge,"angle",0),t.Factory.addGetterSetter(t.Wedge,"clockwise",!1),t.Factory.backCompat(t.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),t.Collection.mapMethods(t.Wedge),t.Arc=function(r){this.___init(r)},t.Arc.prototype={___init:function(r){t.Shape.call(this,r),this.className="Arc",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(r){var i=t.getAngle(this.angle()),a=this.clockwise();r.beginPath(),r.arc(0,0,this.getOuterRadius(),0,i,a),r.arc(0,0,this.getInnerRadius(),i,0,!a),r.closePath(),r.fillStrokeShape(this)}},t.Util.extend(t.Arc,t.Shape),t.Factory.addGetterSetter(t.Arc,"innerRadius",0),t.Factory.addGetterSetter(t.Arc,"outerRadius",0),t.Factory.addGetterSetter(t.Arc,"angle",0),t.Factory.addGetterSetter(t.Arc,"clockwise",!1),t.Collection.mapMethods(t.Arc),t.Image=function(i){this.___init(i)},t.Image.prototype={___init:function(i){t.Shape.call(this,i),this.className="Image",this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()&&this.getStage()},_sceneFunc:function(i){var a,s,f,d=this.getWidth(),e=this.getHeight(),c=this.getImage();c&&(a=this.getCropWidth(),s=this.getCropHeight(),f=a&&s?[c,this.getCropX(),this.getCropY(),a,s,0,0,d,e]:[c,0,0,d,e]),(this.hasFill()||this.hasStroke()||this.hasShadow())&&(i.beginPath(),i.rect(0,0,d,e),i.closePath(),i.fillStrokeShape(this)),c&&i.drawImage.apply(i,f)},_hitFunc:function(i){var a=this.getWidth(),s=this.getHeight();i.beginPath(),i.rect(0,0,a,s),i.closePath(),i.fillStrokeShape(this)},getWidth:function(){var i=this.getImage();return this.attrs.width||(i?i.width:0)},getHeight:function(){var i=this.getImage();return this.attrs.height||(i?i.height:0)}},t.Util.extend(t.Image,t.Shape),t.Factory.addGetterSetter(t.Image,"image"),t.Factory.addComponentsGetterSetter(t.Image,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(t.Image,"cropX",0),t.Factory.addGetterSetter(t.Image,"cropY",0),t.Factory.addGetterSetter(t.Image,"cropWidth",0),t.Factory.addGetterSetter(t.Image,"cropHeight",0),t.Collection.mapMethods(t.Image),function(){function r(u){u.fillText(this.partialText,0,0)}function i(u){u.strokeText(this.partialText,0,0)}var a="auto",o="left",_="normal",k=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","lineHeight","text","width","height","wrap"],x=k.length,D=t.Util.createCanvasElement().getContext("2d");t.Text=function(u){this.___init(u)},t.Text.prototype={___init:function(u){(u=u||{}).fill=u.fill||"black",void 0===u.width&&(u.width=a),void 0===u.height&&(u.height=a),t.Shape.call(this,u),this._fillFunc=r,this._strokeFunc=i,this.className="Text";for(var v=0;x>v;v++)this.on(k[v]+"Change.kinetic",this._setTextData);this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(u){var v,b=this.getPadding(),F=this.getTextHeight(),T=this.getLineHeight()*F,M=this.textArr,I=M.length,B=this.getWidth();for(u.setAttr("font",this._getContextFont()),u.setAttr("textBaseline","middle"),u.setAttr("textAlign",o),u.save(),u.translate(b,0),u.translate(0,b+F/2),v=0;I>v;v++){var j=M[v],C=j.text,G=j.width;u.save(),"right"===this.getAlign()?u.translate(B-G-2*b,0):"center"===this.getAlign()&&u.translate((B-G-2*b)/2,0),this.partialText=C,u.fillStrokeShape(this),u.restore(),u.translate(0,T)}u.restore()},_hitFunc:function(u){var v=this.getWidth(),b=this.getHeight();u.beginPath(),u.rect(0,0,v,b),u.closePath(),u.fillStrokeShape(this)},setText:function(u){var v=t.Util._isString(u)?u:u.toString();return this._setAttr("text",v),this},getWidth:function(){return this.attrs.width===a?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===a?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(u){var v,b=D,F=this.getFontSize();return b.save(),b.font=this._getContextFont(),v=b.measureText(u),b.restore(),{width:v.width,height:parseInt(F,10)}},_getContextFont:function(){return this.getFontStyle()+" "+this.getFontVariant()+" "+this.getFontSize()+"px "+this.getFontFamily()},_addTextLine:function(u,v){return this.textArr.push({text:u,width:v})},_getTextWidth:function(u){return D.measureText(u).width},_setTextData:function(){var u=this.getText().split("\n"),v=+this.getFontSize(),b=0,F=this.getLineHeight()*v,T=this.attrs.width,M=this.attrs.height,I=T!==a,B=M!==a,j=this.getPadding(),C=T-2*j,G=M-2*j,W=0,Y=this.getWrap(),E="none"!==Y,O="char"!==Y&&E;this.textArr=[],D.save(),D.font=this._getContextFont();for(var H=0,z=u.length;z>H;++H){var R=u[H],L=this._getTextWidth(R);if(I&&L>C)for(;R.length>0;){for(var U=0,S=R.length,A="",N=0;S>U;){var X=U+S>>>1,Q=R.slice(0,X+1),q=this._getTextWidth(Q);C>=q?(U=X+1,A=Q,N=q):S=X}if(!A)break;if(O){var J=Math.max(A.lastIndexOf(" "),A.lastIndexOf("-"))+1;J>0&&(U=J,A=A.slice(0,U),N=this._getTextWidth(A))}if(this._addTextLine(A,N),b=Math.max(b,N),W+=F,!E||B&&W+F>G)break;if((R=R.slice(U)).length>0&&C>=(L=this._getTextWidth(R))){this._addTextLine(R,L),W+=F,b=Math.max(b,L);break}}else this._addTextLine(R,L),W+=F,b=Math.max(b,L);if(B&&W+F>G)break}D.restore(),this.textHeight=v,this.textWidth=b}},t.Util.extend(t.Text,t.Shape),t.Factory.addGetterSetter(t.Text,"fontFamily","Arial"),t.Factory.addGetterSetter(t.Text,"fontSize",12),t.Factory.addGetterSetter(t.Text,"fontStyle",_),t.Factory.addGetterSetter(t.Text,"fontVariant",_),t.Factory.addGetterSetter(t.Text,"padding",0),t.Factory.addGetterSetter(t.Text,"align",o),t.Factory.addGetterSetter(t.Text,"lineHeight",1),t.Factory.addGetterSetter(t.Text,"wrap","word"),t.Factory.addGetter(t.Text,"text",""),t.Factory.addOverloadedGetterSetter(t.Text,"text"),t.Collection.mapMethods(t.Text)}(),t.Line=function(r){this.___init(r)},t.Line.prototype={___init:function(r){t.Shape.call(this,r),this.className="Line",this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(r){var i,a,s,f=this.getPoints(),d=f.length,e=this.getTension(),c=this.getClosed();if(d){if(r.beginPath(),r.moveTo(f[0],f[1]),0!==e&&d>4){for(a=(i=this.getTensionPoints()).length,s=c?0:4,c||r.quadraticCurveTo(i[0],i[1],i[2],i[3]);a-2>s;)r.bezierCurveTo(i[s++],i[s++],i[s++],i[s++],i[s++],i[s++]);c||r.quadraticCurveTo(i[a-2],i[a-1],f[d-2],f[d-1])}else for(s=2;d>s;s+=2)r.lineTo(f[s],f[s+1]);c?(r.closePath(),r.fillStrokeShape(this)):r.strokeShape(this)}},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():t.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var r=this.getPoints(),i=r.length,a=this.getTension(),s=t.Util,f=s._getControlPoints(r[i-2],r[i-1],r[0],r[1],r[2],r[3],a),d=s._getControlPoints(r[i-4],r[i-3],r[i-2],r[i-1],r[0],r[1],a),e=t.Util._expandPoints(r,a);return[f[2],f[3]].concat(e).concat([d[0],d[1],r[i-2],r[i-1],d[2],d[3],f[0],f[1],r[0],r[1]])}},t.Util.extend(t.Line,t.Shape),t.Factory.addGetterSetter(t.Line,"closed",!1),t.Factory.addGetterSetter(t.Line,"tension",0),t.Factory.addGetterSetter(t.Line,"points",[]),t.Collection.mapMethods(t.Line),t.Sprite=function(r){this.___init(r)},t.Sprite.prototype={___init:function(r){t.Shape.call(this,r),this.className="Sprite",this._updated=!0;var i=this;this.anim=new t.Animation(function(){var a=i._updated;return i._updated=!1,a}),this.on("animationChange.kinetic",function(){this.frameIndex(0)}),this.on("frameIndexChange.kinetic",function(){this._updated=!0}),this.on("frameRateChange.kinetic",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(r){var i=this.getAnimation(),a=this.frameIndex(),s=4*a,f=this.getAnimations()[i],d=this.frameOffsets(),e=f[s+0],c=f[s+1],o=f[s+2],n=f[s+3],h=this.getImage();if(h)if(d){var g=d[i],_=2*a;r.drawImage(h,e,c,o,n,g[_+0],g[_+1],o,n)}else r.drawImage(h,e,c,o,n,0,0,o,n)},_hitFunc:function(r){var i=this.getAnimation(),a=this.frameIndex(),s=4*a,f=this.getAnimations()[i],d=this.frameOffsets(),e=f[s+2],c=f[s+3];if(r.beginPath(),d){var o=d[i],n=2*a;r.rect(o[n+0],o[n+1],e,c)}else r.rect(0,0,e,c);r.closePath(),r.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_setInterval:function(){var r=this;this.interval=setInterval(function(){r._updateIndex()},1e3/this.getFrameRate())},start:function(){var r=this.getLayer();this.anim.setLayers(r),this._setInterval(),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var r=this.frameIndex(),i=this.getAnimation(),f=this.getAnimations()[i].length/4;this.frameIndex(f-1>r?r+1:0)}},t.Util.extend(t.Sprite,t.Shape),t.Factory.addGetterSetter(t.Sprite,"animation"),t.Factory.addGetterSetter(t.Sprite,"animations"),t.Factory.addGetterSetter(t.Sprite,"frameOffsets"),t.Factory.addGetterSetter(t.Sprite,"image"),t.Factory.addGetterSetter(t.Sprite,"frameIndex",0),t.Factory.addGetterSetter(t.Sprite,"frameRate",17),t.Factory.backCompat(t.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),t.Collection.mapMethods(t.Sprite),t.Path=function(r){this.___init(r)},t.Path.prototype={___init:function(r){this.dataArray=[];var i=this;t.Shape.call(this,r),this.className="Path",this.dataArray=t.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){i.dataArray=t.Path.parsePathData(this.getData())}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(r){var i=this.dataArray,a=!1;r.beginPath();for(var s=0;s<i.length;s++){var f=i[s].command,d=i[s].points;switch(f){case"L":r.lineTo(d[0],d[1]);break;case"M":r.moveTo(d[0],d[1]);break;case"C":r.bezierCurveTo(d[0],d[1],d[2],d[3],d[4],d[5]);break;case"Q":r.quadraticCurveTo(d[0],d[1],d[2],d[3]);break;case"A":var e=d[0],c=d[1],o=d[2],n=d[3],h=d[4],g=d[5],_=d[6],y=d[7],l=o>n?o:n,p=o>n?1:o/n,m=o>n?n/o:1;r.translate(e,c),r.rotate(_),r.scale(p,m),r.arc(0,0,l,h,h+g,1-y),r.scale(1/p,1/m),r.rotate(-_),r.translate(-e,-c);break;case"z":r.closePath(),a=!0}}a?r.fillStrokeShape(this):r.strokeShape(this)}},t.Util.extend(t.Path,t.Shape),t.Path.getLineLength=function(r,i,a,s){return Math.sqrt((a-r)*(a-r)+(s-i)*(s-i))},t.Path.getPointOnLine=function(r,i,a,s,f,d,e){void 0===d&&(d=i),void 0===e&&(e=a);var c=(f-a)/(s-i+1e-8),o=Math.sqrt(r*r/(1+c*c));i>s&&(o*=-1);var n,h=c*o;if(s===i)n={x:d,y:e+h};else if((e-a)/(d-i+1e-8)===c)n={x:d+o,y:e+h};else{var g,_,y=this.getLineLength(i,a,s,f);if(1e-8>y)return;var l=(d-i)*(s-i)+(e-a)*(f-a);g=i+(l/=y*y)*(s-i),_=a+l*(f-a);var p=this.getLineLength(d,e,g,_),m=Math.sqrt(r*r-p*p);o=Math.sqrt(m*m/(1+c*c)),i>s&&(o*=-1),n={x:g+o,y:_+(h=c*o)}}return n},t.Path.getPointOnCubicBezier=function(r,i,a,s,f,d,e,c,o){function n(p){return p*p*p}function h(p){return 3*p*p*(1-p)}function g(p){return 3*p*(1-p)*(1-p)}function _(p){return(1-p)*(1-p)*(1-p)}return{x:c*n(r)+d*h(r)+s*g(r)+i*_(r),y:o*n(r)+e*h(r)+f*g(r)+a*_(r)}},t.Path.getPointOnQuadraticBezier=function(r,i,a,s,f,d,e){function c(_){return _*_}function o(_){return 2*_*(1-_)}function n(_){return(1-_)*(1-_)}return{x:d*c(r)+s*o(r)+i*n(r),y:e*c(r)+f*o(r)+a*n(r)}},t.Path.getPointOnEllipticalArc=function(r,i,a,s,f,d){var e=Math.cos(d),c=Math.sin(d),o_x=a*Math.cos(f),o_y=s*Math.sin(f);return{x:r+(o_x*e-o_y*c),y:i+(o_x*c+o_y*e)}},t.Path.parsePathData=function(r){if(!r)return[];var i=r,a=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];i=i.replace(new RegExp(" ","g"),",");for(var s=0;s<a.length;s++)i=i.replace(new RegExp(a[s],"g"),"|"+a[s]);var f=i.split("|"),d=[],e=0,c=0;for(s=1;s<f.length;s++){var o=f[s],n=o.charAt(0),h=(o=(o=(o=(o=o.slice(1)).replace(new RegExp(",-","g"),"-")).replace(new RegExp("-","g"),",-")).replace(new RegExp("e,-","g"),"e-")).split(",");h.length>0&&""===h[0]&&h.shift();for(var g=0;g<h.length;g++)h[g]=parseFloat(h[g]);for(;h.length>0&&!isNaN(h[0]);){var _,y,l,p,m,w,P,k,x,D,u=null,v=[],b=e,F=c;switch(n){case"l":e+=h.shift(),c+=h.shift(),u="L",v.push(e,c);break;case"L":e=h.shift(),c=h.shift(),v.push(e,c);break;case"m":var T=h.shift(),M=h.shift();if(e+=T,c+=M,u="M",d.length>2&&"z"===d[d.length-1].command)for(var I=d.length-2;I>=0;I--)if("M"===d[I].command){e=d[I].points[0]+T,c=d[I].points[1]+M;break}v.push(e,c),n="l";break;case"M":e=h.shift(),c=h.shift(),u="M",v.push(e,c),n="L";break;case"h":e+=h.shift(),u="L",v.push(e,c);break;case"H":e=h.shift(),u="L",v.push(e,c);break;case"v":c+=h.shift(),u="L",v.push(e,c);break;case"V":c=h.shift(),u="L",v.push(e,c);break;case"C":v.push(h.shift(),h.shift(),h.shift(),h.shift()),e=h.shift(),c=h.shift(),v.push(e,c);break;case"c":v.push(e+h.shift(),c+h.shift(),e+h.shift(),c+h.shift()),e+=h.shift(),c+=h.shift(),u="C",v.push(e,c);break;case"S":y=e,l=c,"C"===(_=d[d.length-1]).command&&(y=e+(e-_.points[2]),l=c+(c-_.points[3])),v.push(y,l,h.shift(),h.shift()),e=h.shift(),c=h.shift(),u="C",v.push(e,c);break;case"s":y=e,l=c,"C"===(_=d[d.length-1]).command&&(y=e+(e-_.points[2]),l=c+(c-_.points[3])),v.push(y,l,e+h.shift(),c+h.shift()),e+=h.shift(),c+=h.shift(),u="C",v.push(e,c);break;case"Q":v.push(h.shift(),h.shift()),e=h.shift(),c=h.shift(),v.push(e,c);break;case"q":v.push(e+h.shift(),c+h.shift()),e+=h.shift(),c+=h.shift(),u="Q",v.push(e,c);break;case"T":y=e,l=c,"Q"===(_=d[d.length-1]).command&&(y=e+(e-_.points[0]),l=c+(c-_.points[1])),e=h.shift(),c=h.shift(),u="Q",v.push(y,l,e,c);break;case"t":y=e,l=c,"Q"===(_=d[d.length-1]).command&&(y=e+(e-_.points[0]),l=c+(c-_.points[1])),e+=h.shift(),c+=h.shift(),u="Q",v.push(y,l,e,c);break;case"A":p=h.shift(),m=h.shift(),w=h.shift(),P=h.shift(),k=h.shift(),x=e,D=c,e=h.shift(),c=h.shift(),u="A",v=this.convertEndpointToCenterParameterization(x,D,e,c,P,k,p,m,w);break;case"a":p=h.shift(),m=h.shift(),w=h.shift(),P=h.shift(),k=h.shift(),x=e,D=c,e+=h.shift(),c+=h.shift(),u="A",v=this.convertEndpointToCenterParameterization(x,D,e,c,P,k,p,m,w)}d.push({command:u||n,points:v,start:{x:b,y:F},pathLength:this.calcLength(b,F,u||n,v)})}("z"===n||"Z"===n)&&d.push({command:"z",points:[],start:void 0,pathLength:0})}return d},t.Path.calcLength=function(r,i,a,s){var f,d,e,c,o=t.Path;switch(a){case"L":return o.getLineLength(r,i,s[0],s[1]);case"C":for(f=0,d=o.getPointOnCubicBezier(0,r,i,s[0],s[1],s[2],s[3],s[4],s[5]),c=.01;1>=c;c+=.01)e=o.getPointOnCubicBezier(c,r,i,s[0],s[1],s[2],s[3],s[4],s[5]),f+=o.getLineLength(d.x,d.y,e.x,e.y),d=e;return f;case"Q":for(f=0,d=o.getPointOnQuadraticBezier(0,r,i,s[0],s[1],s[2],s[3]),c=.01;1>=c;c+=.01)e=o.getPointOnQuadraticBezier(c,r,i,s[0],s[1],s[2],s[3]),f+=o.getLineLength(d.x,d.y,e.x,e.y),d=e;return f;case"A":f=0;var n=s[4],h=s[5],g=s[4]+h,_=Math.PI/180;if(Math.abs(n-g)<_&&(_=Math.abs(n-g)),d=o.getPointOnEllipticalArc(s[0],s[1],s[2],s[3],n,0),0>h)for(c=n-_;c>g;c-=_)e=o.getPointOnEllipticalArc(s[0],s[1],s[2],s[3],c,0),f+=o.getLineLength(d.x,d.y,e.x,e.y),d=e;else for(c=n+_;g>c;c+=_)e=o.getPointOnEllipticalArc(s[0],s[1],s[2],s[3],c,0),f+=o.getLineLength(d.x,d.y,e.x,e.y),d=e;return e=o.getPointOnEllipticalArc(s[0],s[1],s[2],s[3],g,0),f+o.getLineLength(d.x,d.y,e.x,e.y)}return 0},t.Path.convertEndpointToCenterParameterization=function(r,i,a,s,f,d,e,c,o){var n=o*(Math.PI/180),h=Math.cos(n)*(r-a)/2+Math.sin(n)*(i-s)/2,g=-1*Math.sin(n)*(r-a)/2+Math.cos(n)*(i-s)/2,_=h*h/(e*e)+g*g/(c*c);_>1&&(e*=Math.sqrt(_),c*=Math.sqrt(_));var y=Math.sqrt((e*e*c*c-e*e*g*g-c*c*h*h)/(e*e*g*g+c*c*h*h));f===d&&(y*=-1),isNaN(y)&&(y=0);var l=y*e*g/c,p=y*-c*h/e,m=(r+a)/2+Math.cos(n)*l-Math.sin(n)*p,w=(i+s)/2+Math.sin(n)*l+Math.cos(n)*p,P=function(F){return Math.sqrt(F[0]*F[0]+F[1]*F[1])},k=function(F,T){return(F[0]*T[0]+F[1]*T[1])/(P(F)*P(T))},x=function(F,T){return(F[0]*T[1]<F[1]*T[0]?-1:1)*Math.acos(k(F,T))},D=x([1,0],[(h-l)/e,(g-p)/c]),u=[(h-l)/e,(g-p)/c],v=[(-1*h-l)/e,(-1*g-p)/c],b=x(u,v);return k(u,v)<=-1&&(b=Math.PI),k(u,v)>=1&&(b=0),0===d&&b>0&&(b-=2*Math.PI),1===d&&0>b&&(b+=2*Math.PI),[m,w,e,c,D,b,n,d]},t.Factory.addGetterSetter(t.Path,"data"),t.Collection.mapMethods(t.Path),function(){function r(f){f.fillText(this.partialText,0,0)}function i(f){f.strokeText(this.partialText,0,0)}var s="normal";t.TextPath=function(f){this.___init(f)},t.TextPath.prototype={___init:function(f){var d=this;this.dummyCanvas=t.Util.createCanvasElement(),this.dataArray=[],t.Shape.call(this,f),this._fillFunc=r,this._strokeFunc=i,this._fillFuncHit=r,this._strokeFuncHit=i,this.className="TextPath",this.dataArray=t.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){d.dataArray=t.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",d._setTextData),d._setTextData(),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(f){f.setAttr("font",this._getContextFont()),f.setAttr("textBaseline","middle"),f.setAttr("textAlign","left"),f.save();for(var d=this.glyphInfo,e=0;e<d.length;e++){f.save();var c=d[e].p0;f.translate(c.x,c.y),f.rotate(d[e].rotation),this.partialText=d[e].text,f.fillStrokeShape(this),f.restore()}f.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(f){t.Text.prototype.setText.call(this,f)},_getTextSize:function(f){var e=this.dummyCanvas.getContext("2d");e.save(),e.font=this._getContextFont();var c=e.measureText(f);return e.restore(),{width:c.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var f=this,d=this._getTextSize(this.attrs.text);this.textWidth=d.width,this.textHeight=d.height,this.glyphInfo=[];for(var e,c,o,n=this.attrs.text.split(""),h=-1,g=0,_=function(){g=0;for(var k=f.dataArray,x=h+1;x<k.length;x++){if(k[x].pathLength>0)return h=x,k[x];"M"==k[x].command&&(e={x:k[x].points[0],y:k[x].points[1]})}return{}},y=function(k){var x=f._getTextSize(k).width,D=0,u=0;for(c=void 0;Math.abs(x-D)/x>.01&&25>u;){u++;for(var v=D;void 0===o;)(o=_())&&v+o.pathLength<x&&(v+=o.pathLength,o=void 0);if(o==={}||void 0===e)return;var b=!1;switch(o.command){case"L":t.Path.getLineLength(e.x,e.y,o.points[0],o.points[1])>x?c=t.Path.getPointOnLine(x,e.x,e.y,o.points[0],o.points[1],e.x,e.y):o=void 0;break;case"A":var F=o.points[4],T=o.points[5],M=o.points[4]+T;0===g?g=F+1e-8:x>D?g+=Math.PI/180*T/Math.abs(T):g-=Math.PI/360*T/Math.abs(T),(0>T&&M>g||T>=0&&g>M)&&(g=M,b=!0),c=t.Path.getPointOnEllipticalArc(o.points[0],o.points[1],o.points[2],o.points[3],g,o.points[6]);break;case"C":0===g?g=x>o.pathLength?1e-8:x/o.pathLength:x>D?g+=(x-D)/o.pathLength:g-=(D-x)/o.pathLength,g>1&&(g=1,b=!0),c=t.Path.getPointOnCubicBezier(g,o.start.x,o.start.y,o.points[0],o.points[1],o.points[2],o.points[3],o.points[4],o.points[5]);break;case"Q":0===g?g=x/o.pathLength:x>D?g+=(x-D)/o.pathLength:g-=(D-x)/o.pathLength,g>1&&(g=1,b=!0),c=t.Path.getPointOnQuadraticBezier(g,o.start.x,o.start.y,o.points[0],o.points[1],o.points[2],o.points[3])}void 0!==c&&(D=t.Path.getLineLength(e.x,e.y,c.x,c.y)),b&&(b=!1,o=void 0)}},l=0;l<n.length&&(y(n[l]),void 0!==e&&void 0!==c);l++){var p=t.Path.getLineLength(e.x,e.y,c.x,c.y),w=t.Path.getPointOnLine(0+p/2,e.x,e.y,c.x,c.y),P=Math.atan2(c.y-e.y,c.x-e.x);this.glyphInfo.push({transposeX:w.x,transposeY:w.y,text:n[l],rotation:P,p0:e,p1:c}),e=c}}},t.TextPath.prototype._getContextFont=t.Text.prototype._getContextFont,t.Util.extend(t.TextPath,t.Shape),t.Factory.addGetterSetter(t.TextPath,"fontFamily","Arial"),t.Factory.addGetterSetter(t.TextPath,"fontSize",12),t.Factory.addGetterSetter(t.TextPath,"fontStyle",s),t.Factory.addGetterSetter(t.TextPath,"fontVariant",s),t.Factory.addGetter(t.TextPath,"text",""),t.Collection.mapMethods(t.TextPath)}(),t.RegularPolygon=function(r){this.___init(r)},t.RegularPolygon.prototype={___init:function(r){t.Shape.call(this,r),this.className="RegularPolygon",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(r){var i,a,s,f=this.attrs.sides,d=this.attrs.radius;for(r.beginPath(),r.moveTo(0,0-d),i=1;f>i;i++)a=d*Math.sin(2*i*Math.PI/f),s=-1*d*Math.cos(2*i*Math.PI/f),r.lineTo(a,s);r.closePath(),r.fillStrokeShape(this)}},t.Util.extend(t.RegularPolygon,t.Shape),t.Factory.addGetterSetter(t.RegularPolygon,"radius",0),t.Factory.addGetterSetter(t.RegularPolygon,"sides",0),t.Collection.mapMethods(t.RegularPolygon),t.Star=function(r){this.___init(r)},t.Star.prototype={___init:function(r){t.Shape.call(this,r),this.className="Star",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(r){var i=this.innerRadius(),a=this.outerRadius(),s=this.numPoints();r.beginPath(),r.moveTo(0,0-a);for(var f=1;2*s>f;f++){var d=f%2==0?a:i,e=d*Math.sin(f*Math.PI/s),c=-1*d*Math.cos(f*Math.PI/s);r.lineTo(e,c)}r.closePath(),r.fillStrokeShape(this)}},t.Util.extend(t.Star,t.Shape),t.Factory.addGetterSetter(t.Star,"numPoints",5),t.Factory.addGetterSetter(t.Star,"innerRadius",0),t.Factory.addGetterSetter(t.Star,"outerRadius",0),t.Collection.mapMethods(t.Star),function(){var r=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],f="right",d="down",e="left",o=r.length;t.Label=function(n){this.____init(n)},t.Label.prototype={____init:function(n){var h=this;t.Group.call(this,n),this.className="Label",this.on("add.kinetic",function(g){h._addListeners(g.child),h._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(n){var h,g=this,_=function(){g._sync()};for(h=0;o>h;h++)n.on(r[h]+"Change.kinetic",_)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var n,h,g,_,y,l,p,m=this.getText(),w=this.getTag();if(m&&w){switch(n=m.getWidth(),h=m.getHeight(),g=w.getPointerDirection(),_=w.getPointerWidth(),p=w.getPointerHeight(),y=0,l=0,g){case"up":y=n/2,l=-1*p;break;case f:y=n+_,l=h/2;break;case d:y=n/2,l=h+p;break;case e:y=-1*_,l=h/2}w.setAttrs({x:-1*y,y:-1*l,width:n,height:h}),m.setAttrs({x:-1*y,y:-1*l})}}},t.Util.extend(t.Label,t.Group),t.Collection.mapMethods(t.Label),t.Tag=function(n){this.___init(n)},t.Tag.prototype={___init:function(n){t.Shape.call(this,n),this.className="Tag",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(n){var h=this.getWidth(),g=this.getHeight(),_=this.getPointerDirection(),y=this.getPointerWidth(),l=this.getPointerHeight(),p=this.getCornerRadius();n.beginPath(),n.moveTo(0,0),"up"===_&&(n.lineTo((h-y)/2,0),n.lineTo(h/2,-1*l),n.lineTo((h+y)/2,0)),p?(n.lineTo(h-p,0),n.arc(h-p,p,p,3*Math.PI/2,0,!1)):n.lineTo(h,0),_===f&&(n.lineTo(h,(g-l)/2),n.lineTo(h+y,g/2),n.lineTo(h,(g+l)/2)),p?(n.lineTo(h,g-p),n.arc(h-p,g-p,p,0,Math.PI/2,!1)):n.lineTo(h,g),_===d&&(n.lineTo((h+y)/2,g),n.lineTo(h/2,g+l),n.lineTo((h-y)/2,g)),p?(n.lineTo(p,g),n.arc(p,g-p,p,Math.PI/2,Math.PI,!1)):n.lineTo(0,g),_===e&&(n.lineTo(0,(g+l)/2),n.lineTo(-1*y,g/2),n.lineTo(0,(g-l)/2)),p&&(n.lineTo(0,p),n.arc(p,p,p,Math.PI,3*Math.PI/2,!1)),n.closePath(),n.fillStrokeShape(this)}},t.Util.extend(t.Tag,t.Shape),t.Factory.addGetterSetter(t.Tag,"pointerDirection","none"),t.Factory.addGetterSetter(t.Tag,"pointerWidth",0),t.Factory.addGetterSetter(t.Tag,"pointerHeight",0),t.Factory.addGetterSetter(t.Tag,"cornerRadius",0),t.Collection.mapMethods(t.Tag)}(),t.Arrow=function(r){this.____init(r)},t.Arrow.prototype={____init:function(r){t.Line.call(this,r),this.className="Arrow"},_sceneFunc:function(r){var i=2*Math.PI,a=this.points(),s=a.length,f=a[s-2]-a[s-4],d=a[s-1]-a[s-3],e=(Math.atan2(d,f)+i)%i,c=this.pointerLength(),o=this.pointerWidth();r.save(),r.beginPath(),r.translate(a[s-2],a[s-1]),r.rotate(e),r.moveTo(0,0),r.lineTo(-c,o/2),r.lineTo(-c,-o/2),r.closePath(),r.restore(),this.pointerAtBeginning()&&(r.save(),r.translate(a[0],a[1]),f=a[2]-a[0],d=a[3]-a[1],r.rotate((Math.atan2(-d,-f)+i)%i),r.moveTo(0,0),r.lineTo(-10,6),r.lineTo(-10,-6),r.closePath(),r.restore()),r.fillStrokeShape(this),t.Line.prototype._sceneFunc.apply(this,arguments)}},t.Util.extend(t.Arrow,t.Line),t.Factory.addGetterSetter(t.Arrow,"pointerLength",10),t.Factory.addGetterSetter(t.Arrow,"pointerWidth",10),t.Factory.addGetterSetter(t.Arrow,"pointerAtBeginning",!1),t.Collection.mapMethods(t.Arrow),function(r){"use strict";ht=[ot(91704)],void 0!==($="function"==typeof(V=function(r){function i(f){return!f.nodeName||-1!==r.inArray(f.nodeName.toLowerCase(),["iframe","#document","html","body"])}function a(f){return r.isFunction(f)||r.isPlainObject(f)?f:{top:f,left:f}}var s=r.scrollTo=function(f,d,e){return r(window).scrollTo(f,d,e)};return s.defaults={axis:"xy",duration:0,limit:!0},r.fn.scrollTo=function(f,d,e){"object"==typeof d&&(e=d,d=0),"function"==typeof e&&(e={onAfter:e}),"max"===f&&(f=9e9),e=r.extend({},s.defaults,e),d=d||e.duration;var c=e.queue&&1<e.axis.length;return c&&(d/=2),e.offset=a(e.offset),e.over=a(e.over),this.each(function(){function o(m){var w=r.extend({},e,{queue:!0,duration:d,complete:m&&function(){m.call(h,_,e)}});g.animate(y,w)}if(null!==f){var l,n=i(this),h=n?this.contentWindow||window:this,g=r(h),_=f,y={};switch(typeof _){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(_)){_=a(_);break}_=n?r(_):r(_,h);case"object":if(0===_.length)return;(_.is||_.style)&&(l=(_=r(_)).offset())}var p=r.isFunction(e.offset)&&e.offset(h,_)||e.offset;r.each(e.axis.split(""),function(m,w){var P="x"===w?"Left":"Top",k=P.toLowerCase(),x="scroll"+P,D=g[x](),u=s.max(h,w);l?(y[x]=l[k]+(n?0:D-g.offset()[k]),e.margin&&(y[x]-=parseInt(_.css("margin"+P),10)||0,y[x]-=parseInt(_.css("border"+P+"Width"),10)||0),y[x]+=p[k]||0,e.over[k]&&(y[x]+=_["x"===w?"width":"height"]()*e.over[k])):(P=_[k],y[x]=P.slice&&"%"===P.slice(-1)?parseFloat(P)/100*u:P),e.limit&&/^\d+$/.test(y[x])&&(y[x]=0>=y[x]?0:Math.min(y[x],u)),!m&&1<e.axis.length&&(D===y[x]?y={}:c&&(o(e.onAfterFirst),y={}))}),o(e.onAfter)}})},s.max=function(f,d){var c="scroll"+(e="x"===d?"Width":"Height");if(!i(f))return f[c]-r(f)[e.toLowerCase()]();var e="client"+e,n=(o=f.ownerDocument||f.document).documentElement,o=o.body;return Math.max(n[c],o[c])-Math.min(n[e],o[e])},r.Tween.propHooks.scrollLeft=r.Tween.propHooks.scrollTop={get:function(f){return r(f.elem)[f.prop]()},set:function(f){var d=this.get(f);if(f.options.interrupt&&f._last&&f._last!==d)return r(f.elem).stop();var e=Math.round(f.now);d!==e&&(r(f.elem)[f.prop](e),f._last=this.get(f))}},s})?V.apply(rt,ht):V)&&(st.exports=$)}()}(jQuery)}}]);