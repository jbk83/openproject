(self.webpackChunkopenproject_frontend=self.webpackChunkopenproject_frontend||[]).push([["main"],{98255:te=>{function M(t){return Promise.resolve().then(()=>{var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n})}M.keys=()=>[],M.resolve=M,M.id=98255,te.exports=M},32091:function(te,M,t){var n,e;e=this,void 0!==(n=function(){return function(e){"use strict";var p=e&&e.I18n||{},h=Array.prototype.slice,c=function(O){return("0"+O.toString()).substr(-2)},i=function(O,I){return C("round",O,-I).toFixed(I)},l=function(O){var I=typeof O;return"function"===I||"object"===I},r=function(O){return"function"==typeof O},d=function(O){return null!=O},f=function(O){return Array.isArray?Array.isArray(O):"[object Array]"===Object.prototype.toString.call(O)},a=function(O){return"string"==typeof value||"[object String]"===Object.prototype.toString.call(O)},m=function(O){return"number"==typeof O||"[object Number]"===Object.prototype.toString.call(O)},v=function(O){return!0===O||!1===O},C=function(O,I,Z){return void 0===Z||0==+Z?Math[O](I):(I=+I,Z=+Z,isNaN(I)||"number"!=typeof Z||Z%1!=0?NaN:(I=I.toString().split("e"),+((I=(I=Math[O](+(I[0]+"e"+(I[1]?+I[1]-Z:-Z)))).toString().split("e"))[0]+"e"+(I[1]?+I[1]+Z:Z))))},u=function(O,I){return r(O)?O(I):O},k=function(O,I){var Z,j;for(Z in I)I.hasOwnProperty(Z)&&(j=I[Z],a(j)||m(j)||v(j)||f(j)?O[Z]=j:(null==O[Z]&&(O[Z]={}),k(O[Z],j)));return O},x={day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridian:["AM","PM"]},b={precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1},y={unit:"$",precision:2,format:"%u%n",sign_first:!0,delimiter:",",separator:"."},P={unit:"%",precision:3,format:"%n%u",separator:".",delimiter:""},E=[null,"kb","mb","gb","tb"],T={defaultLocale:"en",locale:"en",defaultSeparator:".",placeholder:/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,fallbacks:!1,translations:{},missingBehaviour:"message",missingTranslationPrefix:""};return p.reset=function(){var O;for(O in T)this[O]=T[O]},p.initializeOptions=function(){var O;for(O in T)d(this[O])||(this[O]=T[O])},p.initializeOptions(),p.locales={},p.locales.get=function(O){var I=this[O]||this[p.locale]||this.default;return r(I)&&(I=I(O)),!1===f(I)&&(I=[I]),I},p.locales.default=function(O){var I=[],Z=[];return O&&I.push(O),!O&&p.locale&&I.push(p.locale),p.fallbacks&&p.defaultLocale&&I.push(p.defaultLocale),I.forEach(function(j){var B=j.split("-"),J=null,R=null;3===B.length?(J=[B[0],B[1]].join("-"),R=B[0]):2===B.length&&(J=B[0]),-1===Z.indexOf(j)&&Z.push(j),p.fallbacks&&[J,R].forEach(function(F){null!=F&&F!==j&&-1===Z.indexOf(F)&&Z.push(F)})}),I.length||I.push("en"),Z},p.pluralization={},p.pluralization.get=function(O){return this[O]||this[p.locale]||this.default},p.pluralization.default=function(O){switch(O){case 0:return["zero","other"];case 1:return["one"];default:return["other"]}},p.currentLocale=function(){return this.locale||this.defaultLocale},p.isSet=d,p.lookup=function(O,I){I=I||{};var B,J,R,F,Z=this.locales.get(I.locale).slice();for(Z[0],R=this.getFullScope(O,I);Z.length;)if(B=Z.shift(),J=R.split(this.defaultSeparator),F=this.translations[B]){for(;J.length&&null!=(F=F[J.shift()]););if(null!=F)return F}if(d(I.defaultValue))return u(I.defaultValue,O)},p.pluralizationLookupWithoutFallback=function(O,I,Z){var J,R,B=this.pluralization.get(I)(O);if(l(Z))for(;B.length;)if(J=B.shift(),d(Z[J])){R=Z[J];break}return R},p.pluralizationLookup=function(O,I,Z){Z=Z||{};var J,R,F,Y,j=this.locales.get(Z.locale).slice();for(j[0],I=this.getFullScope(I,Z);j.length;)if(J=j.shift(),R=I.split(this.defaultSeparator),F=this.translations[J]){for(;R.length&&(F=F[R.shift()],l(F));)0==R.length&&(Y=this.pluralizationLookupWithoutFallback(O,J,F));if(null!=Y&&null!=Y)break}return(null==Y||null==Y)&&d(Z.defaultValue)&&(Y=l(Z.defaultValue)?this.pluralizationLookupWithoutFallback(O,Z.locale,Z.defaultValue):Z.defaultValue,F=Z.defaultValue),{message:Y,translations:F}},p.meridian=function(){var O=this.lookup("time"),I=this.lookup("date");return O&&O.am&&O.pm?[O.am,O.pm]:I&&I.meridian?I.meridian:x.meridian},p.prepareOptions=function(){for(var Z,O=h.call(arguments),I={};O.length;)if("object"==typeof(Z=O.shift()))for(var j in Z)!Z.hasOwnProperty(j)||d(I[j])||(I[j]=Z[j]);return I},p.createTranslationOptions=function(O,I){var Z=[{scope:O}];return d(I.defaults)&&(Z=Z.concat(I.defaults)),d(I.defaultValue)&&Z.push({message:I.defaultValue}),Z},p.translate=function(O,I){I=I||{};var j,Z=this.createTranslationOptions(O,I),B=this.prepareOptions(I);return delete B.defaultValue,Z.some(function(R){if(d(R.scope)?j=this.lookup(R.scope,B):d(R.message)&&(j=u(R.message,O)),null!=j)return!0},this)?("string"==typeof j?j=this.interpolate(j,I):l(j)&&d(I.count)&&(j=this.pluralize(I.count,O,I)),j):this.missingTranslation(O,I)},p.interpolate=function(O,I){I=I||{};var j,J,R,B,Z=O.match(this.placeholder);if(!Z)return O;for(;Z.length;)J=(j=Z.shift()).replace(this.placeholder,"$1"),B=d(I[J])?I[J].toString().replace(/\$/gm,"_#$#_"):J in I?this.nullPlaceholder(j,O,I):this.missingPlaceholder(j,O,I),R=new RegExp(j.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),O=O.replace(R,B);return O.replace(/_#\$#_/g,"$")},p.pluralize=function(O,I,Z){var j,J;return Z=this.prepareOptions({count:String(O)},Z),null==(J=this.pluralizationLookup(O,I,Z)).translations||null==J.translations?this.missingTranslation(I,Z):null!=J.message&&null!=J.message?this.interpolate(J.message,Z):(j=this.pluralization.get(Z.locale),this.missingTranslation(I+"."+j(O)[0],Z))},p.missingTranslation=function(O,I){if("guess"==this.missingBehaviour){var Z=O.split(".").slice(-1)[0];return(this.missingTranslationPrefix.length>0?this.missingTranslationPrefix:"")+Z.replace("_"," ").replace(/([a-z])([A-Z])/g,function(R,F,Y){return F+" "+Y.toLowerCase()})}return'[missing "'+[null!=I&&null!=I.locale?I.locale:this.currentLocale(),this.getFullScope(O,I)].join(this.defaultSeparator)+'" translation]'},p.missingPlaceholder=function(O,I,Z){return"[missing "+O+" value]"},p.nullPlaceholder=function(){return p.missingPlaceholder.apply(p,arguments)},p.toNumber=function(O,I){I=this.prepareOptions(I,this.lookup("number.format"),b);var J,F,Z=O<0,B=i(Math.abs(O),I.precision).toString().split("."),R=[],Y=I.format||"%n",X=Z?"-":"";for(O=B[0],J=B[1];O.length>0;)R.unshift(O.substr(Math.max(0,O.length-3),3)),O=O.substr(0,O.length-3);return F=R.join(I.delimiter),I.strip_insignificant_zeros&&J&&(J=J.replace(/0+$/,"")),I.precision>0&&J&&(F+=I.separator+J),F=(Y=I.sign_first?"%s"+Y:Y.replace("%n","%s%n")).replace("%u",I.unit).replace("%n",F).replace("%s",X)},p.toCurrency=function(O,I){return I=this.prepareOptions(I,this.lookup("number.currency.format"),this.lookup("number.format"),y),this.toNumber(O,I)},p.localize=function(O,I,Z){switch(Z||(Z={}),O){case"currency":return this.toCurrency(I);case"number":return O=this.lookup("number.format"),this.toNumber(I,O);case"percentage":return this.toPercentage(I);default:var j;return j=O.match(/^(date|time)/)?this.toTime(O,I):I.toString(),this.interpolate(j,Z)}},p.parseDate=function(O){var I,Z,j;if("object"==typeof O)return O;if(I=O.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2})([\.,]\d{1,3})?)?(Z|\+00:?00)?/)){for(var B=1;B<=6;B++)I[B]=parseInt(I[B],10)||0;I[2]-=1,j=I[7]?1e3*("0"+I[7]):null,Z=I[8]?new Date(Date.UTC(I[1],I[2],I[3],I[4],I[5],I[6],j)):new Date(I[1],I[2],I[3],I[4],I[5],I[6],j)}else"number"==typeof O?(Z=new Date).setTime(O):O.match(/([A-Z][a-z]{2}) ([A-Z][a-z]{2}) (\d+) (\d+:\d+:\d+) ([+-]\d+) (\d+)/)?(Z=new Date).setTime(Date.parse([RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$6,RegExp.$4,RegExp.$5].join(" "))):(O.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/),(Z=new Date).setTime(Date.parse(O)));return Z},p.strftime=function(O,I){var Z=this.lookup("date"),j=p.meridian();if(Z||(Z={}),Z=this.prepareOptions(Z,x),isNaN(O.getTime()))throw new Error("I18n.strftime() requires a valid date object, but received an invalid date.");var B=O.getDay(),J=O.getDate(),R=O.getFullYear(),F=O.getMonth()+1,Y=O.getHours(),X=Y,K=Y>11?1:0,ie=O.getSeconds(),H=O.getMinutes(),ee=O.getTimezoneOffset(),ce=Math.floor(Math.abs(ee/60)),se=Math.abs(ee)-60*ce,re=(ee>0?"-":"+")+(ce.toString().length<2?"0"+ce:ce)+(se.toString().length<2?"0"+se:se);return X>12?X-=12:0===X&&(X=12),I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=(I=I.replace("%a",Z.abbr_day_names[B])).replace("%A",Z.day_names[B])).replace("%b",Z.abbr_month_names[F])).replace("%B",Z.month_names[F])).replace("%d",c(J))).replace("%e",J)).replace("%-d",J)).replace("%H",c(Y))).replace("%-H",Y)).replace("%I",c(X))).replace("%-I",X)).replace("%m",c(F))).replace("%-m",F)).replace("%M",c(H))).replace("%-M",H)).replace("%p",j[K])).replace("%S",c(ie))).replace("%-S",ie)).replace("%w",B)).replace("%y",c(R))).replace("%-y",c(R).replace(/^0+/,""))).replace("%Y",R)).replace("%z",re)},p.toTime=function(O,I){var Z=this.parseDate(I),j=this.lookup(O);return Z.toString().match(/invalid/i)||!j?Z.toString():this.strftime(Z,j)},p.toPercentage=function(O,I){return I=this.prepareOptions(I,this.lookup("number.percentage.format"),this.lookup("number.format"),P),this.toNumber(O,I)},p.toHumanSize=function(O,I){for(var J,R,Z=1024,j=O,B=0;j>=Z&&B<4;)j/=Z,B+=1;return 0===B?(J=this.t("number.human.storage_units.units.byte",{count:j}),R=0):(J=this.t("number.human.storage_units.units."+E[B]),R=j-Math.floor(j)==0?0:1),I=this.prepareOptions(I,{unit:J,precision:R,format:"%n%u",delimiter:""}),this.toNumber(j,I)},p.getFullScope=function(O,I){return I=I||{},f(O)&&(O=O.join(this.defaultSeparator)),I.scope&&(O=[I.scope,O].join(this.defaultSeparator)),O},p.extend=function(O,I){return void 0===O&&void 0===I?{}:k(O,I)},p.t=p.translate,p.l=p.localize,p.p=p.pluralize,p}(e)}.call(M,t,M,te))&&(te.exports=n)},86664:(te,M,t)=>{"use strict";t.d(M,{u:()=>c});var n=t(54364),e=t(76491),p=t(3352),h=t(2316);class c{constructor(l){this.activeState$=new e.X(!0),l.addEventListener("visibilitychange",()=>{l.visibilityState&&((0,p.qu)(`Browser window has visibility state changed to ${l.visibilityState}`),this.activeState$.next("visible"===l.visibilityState))})}get isActive(){return this.activeState$.value}get active$(){return this.activeState$.asObservable()}}c.\u0275fac=function(l){return new(l||c)(h.LFG(n.K0))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"})},33276:(te,M,t)=>{"use strict";t.d(M,{T:()=>Jt});var n=t(6976),e=t(70233),p=t(71909);class h extends n.f2{constructor(){super(...arguments),this.form=this.subResource("form",p.E)}patch(N,Q=null){const je=this.form.extractPayload(N,Q);return this.halResourceService.patch(this.path,je)}delete(){return this.halResourceService.delete(this.path)}}var c=t(73726);class i extends n.ZQ{constructor(N,Q){super(N,Q,"grids",h),this.apiRoot=N,this.basePath=Q,this.form=this.subResource("form",p.E)}list(N){return this.halResourceService.get(this.path+(0,c.g)(N))}post(N,Q=null){return this.halResourceService.post(this.path,this.form.extractPayload(N,Q))}}var l=t(3786),r=t(29161),d=t(87853),f=t(83972),a=t(81134),m=t(53466),v=t(92597),C=t(79902),u=t(67202),k=t(98636),x=t(44022);class b extends n.f2{constructor(){super(...arguments),this.cache=this.createCache()}requireAndStream(N=!1){const Q=this.id.toString();if(this.cache.stale(Q)||N){const je=this.load().pipe((0,m.q)(1),(0,v.d)(1));return this.cache.clearAndLoad(Q,je),(0,f.z)(je,this.cache.state(Q).values$())}return this.cache.state(Q).values$()}observe(){return this.cache.observe(this.id.toString())}get(){return this.requireAndStream(!1).pipe((0,m.q)(1))}refresh(){return this.requireAndStream(!0).pipe((0,m.q)(1)).toPromise()}load(){return this.halResourceService.get(this.path).pipe((0,C.w)(N=>N.$links.schema?this.schemaCache.requireAndStream(N.$links.schema.href).pipe((0,m.q)(1),(0,u.h)(N)):(0,a.of)(N)))}touch(N){this.cache.updateFor(N)}cacheResponse(){return N=>N.pipe((0,k.b)(Q=>this.touch(Q)))}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",d.G)],b.prototype,"states",void 0),(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",x.y)],b.prototype,"schemaCache",void 0);var y=t(83498),P=t(26784),E=t(80044);class T extends b{constructor(){super(...arguments),this.form=this.subResource("form",y.f)}patch(N,Q=null){return this.halResourceService.patch(this.path,this.extractPayload(N,Q)).pipe((0,k.b)(je=>this.touch(je)))}delete(){return this.halResourceService.delete(this.path).pipe((0,k.b)(()=>this.cache.clearSome(this.id.toString())))}createCache(){return this.parent.cache}extractPayload(N,Q=null){return N instanceof E.X&&Q?P.u.extractPayloadFromSchema(N,Q):N instanceof E.X?{}:N}}var O=t(20501);class I extends n.ZQ{constructor(){super(...arguments),this.cache=this.createCache()}observeAll(){return this.cache.observeAll()}cacheResponse(){return N=>N.pipe((0,k.b)(Q=>{var je;Q instanceof O.Y?null===(je=Q.elements)||void 0===je||je.forEach(this.touch.bind(this)):Q instanceof E.X&&this.touch(Q)}))}touch(N){this.cache.updateFor(N)}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",d.G)],I.prototype,"states",void 0);var Z=t(79175);class j extends Z.r{constructor(N,Q){super(Q),this.injector=N}updateValue(N,Q){return this.schemaCache.ensureLoaded(Q).then(()=>(this.putValue(N,Q),Q))}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",d.G)],j.prototype,"states",void 0),(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",x.y)],j.prototype,"schemaCache",void 0);class B extends I{constructor(N,Q){super(N,Q,"time_entries",T),this.apiRoot=N,this.basePath=Q,this.form=this.subResource("form",y.f),this.schema=this.subResource("schema")}list(N){return this.halResourceService.get(this.path+(0,c.g)(N)).pipe(this.cacheResponse())}post(N){return this.halResourceService.post(this.path,N).pipe(this.cacheResponse())}createCache(){return new j(this.injector,this.states.timeEntries)}}class J extends n.f2{}class R extends n.ZQ{constructor(N,Q){super(N,Q,"capabilities",J),this.apiRoot=N,this.basePath=Q}}var F=t(33927),Y=t(26269);class X extends n.f2{list(N){return this.halResourceService.get(this.path+(0,c.g)(N))}exists(N){return this.halResourceService.get(this.path,{filters:(0,Y.PQ)("id","=",[N]).toJson()}).pipe((0,F.U)(Q=>Q.count>0))}}class K extends y.f{static extractPayload(N){return{_links:{project:{href:N.project.href},principal:{href:N.principal.href},roles:N.roles.map(Q=>({href:Q.href}))},_meta:{notificationMessage:{raw:N.notificationMessage.raw}}}}extractPayload(N){return K.extractPayload(N)}}class ie extends n.ZQ{constructor(N,Q){super(N,Q,"memberships"),this.apiRoot=N,this.basePath=Q,this.form=this.subResource("form",K),this.available_projects=this.subResource("available_projects",X)}list(N){return this.halResourceService.get(this.path+(0,c.g)(N))}post(N){const Q=this.form.extractPayload(N);return this.halResourceService.post(this.path,Q)}}var H=t(53882);class ee extends n.G7{get(){return this.http.get(this.path)}patch(N){return this.http.patch(this.path,N,{withCredentials:!0,responseType:"json"})}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",H.eN)],ee.prototype,"http",void 0);class ce extends b{constructor(){super(...arguments),this.avatar=this.subResource("avatar"),this.preferences=this.subResource("preferences",ee)}createCache(){return new Z.r(this.states.users)}}class se extends n.ZQ{constructor(N,Q){super(N,Q,"users",ce),this.apiRoot=N,this.basePath=Q,this.me=this.subResource("me",ce),this.form=this.subResource("form",y.f)}post(N){return this.halResourceService.post(this.path,N)}}class re extends b{createCache(){return this.parent.cache}}class Me extends I{constructor(N,Q){super(N,Q,"types",re),this.apiRoot=N,this.basePath=Q}createCache(){return new Z.r(this.states.types)}}var Ae=t(17577),Ye=t(49152);class ze extends Ye.J{constructor(N,Q,je){super(Q,je),this.injector=N,this.basePath=Q,this.id=je}get(){return this.http.get(this.path).toPromise().then(N=>N||{})}update(N){return this.http.patch(this.path,{delta:N},{withCredentials:!0}).toPromise().then(Q=>Q.t)}delete(N,...Q){const je={};return Q.forEach(Ee=>je[Ee]=-1),this.update(je)}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",H.eN)],ze.prototype,"http",void 0);var Xe=t(97973),it=t(19866);class at extends y.f{load(N){const Q={name:N.name||"!!!__O__o__O__!!!"};N.project&&(Q._links={project:{href:N.project.href}});const{path:je}=this.apiRoot.queries.withOptionalId(N.id).form;return this.halResourceService.post(je,Q).pipe((0,k.b)(Ee=>this.queryFilters.setSchemas(Ee.$embedded.schema.$embedded.filtersSchemas)),(0,F.U)(Ee=>[Ee,this.buildQueryResource(Ee)]))}loadWithParams(N,Q,je,Ee={}){!Q&&!Ee.name&&(Ee.name="!!!__O__o__O__!!!"),je&&(Ee._links=Ee._links||{},Ee._links.project={href:this.apiRoot.projects.id(je).toString()});const{path:ht}=this.apiRoot.queries.withOptionalId(Q).form,kt=Xe(ht).search(N).toString();return this.halResourceService.post(kt,Ee).pipe((0,k.b)(si=>this.queryFilters.setSchemas(si.$embedded.schema.$embedded.filtersSchemas)),(0,F.U)(si=>[si,this.buildQueryResource(si)]))}buildQueryResource(N){return this.halResourceService.createHalResourceOfType("Query",N.payload)}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",it.r)],at.prototype,"queryFilters",void 0);class lt extends n.f2{constructor(){super(...arguments),this.form=this.subResource("form",at),this.order=new ze(this.injector,this.path,"order")}parameterised(N){return this.halResourceService.get(this.path,N)}patch(N,Q){return N instanceof Ae.P&&Q&&(this.queryFilters.mapSchemasIntoFilters(N,Q),N=P.u.extractPayloadFromSchema(N,Q.schema)),this.halResourceService.patch(this.path,N)}delete(){return this.halResourceService.delete(this.path)}paginated(N){return this.parameterised(N)}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",it.r)],lt.prototype,"queryFilters",void 0);class dt extends n.ZQ{constructor(N,Q){super(N,Q,"queries",lt),this.apiRoot=N,this.basePath=Q,this.form=this.subResource("form",at),this.default=this.subResource("default"),this.filter_instance_schemas=new n.ZQ(this.apiRoot,this.path,"filter_instance_schemas")}list(N){return this.halResourceService.get(this.path+(0,c.g)(N))}find(N,Q,je){let Ee;return Ee=Q?this.apiRoot.queries.id(Q).toString():this.apiRoot.withOptionalProject(je).queries.default.toString(),this.halResourceService.get(Ee,N)}parameterised(N){return this.halResourceService.get(this.default.path,N)}post(N,Q){return N instanceof Ae.P&&Q&&(this.queryFilters.mapSchemasIntoFilters(N,Q),N=P.u.extractPayloadFromSchema(N,Q.schema)),this.halResourceService.post(this.apiRoot.queries.path,N)}toggleStarred(N){return N.starred?N.unstar():N.star()}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",it.r)],dt.prototype,"queryFilters",void 0);var de=t(30400);class oe extends n.ZQ{constructor(N,Q){super(N,Q,"relations"),this.apiRoot=N,this.basePath=Q}get(){return this.halResourceService.get(this.path)}loadInvolved(N){const Q=_.filter(N,je=>/\d+/.test(je));return 0===Q.length?(0,de.D)([]):this.filtered((0,Y.PQ)("involved","=",Q)).getPaginatedResults()}}class D extends y.f{forTypePayload(N){N._links.type&&N._links.type;return this.post(N)}forPayload(N){return this.post(N)}}class G extends b{constructor(){super(...arguments),this.relations=this.subResource("relations",oe),this.revisions=this.subResource("revisions"),this.activities=this.subResource("activities"),this.available_watchers=this.subResource("available_watchers"),this.available_projects=this.subResource("available_projects"),this.github_pull_requests=this.subResource("github_pull_requests"),this.form=this.subResource("form",D)}createCache(){return this.parent.cache}}var V=t(14808),me=t(3352),$=t(84699),Se=t(2316);class ot extends Z.r{constructor(N,Q){super(Q),this.injector=N}updateValue(N,Q){return this.schemaCacheService.ensureLoaded(Q).then(()=>(this.putValue(N,Q),Q))}updateWorkPackage(N,Q=!1){return Q||(0,$.Z)(N)?super.updateValue(N.id,N):this.updateValue(N.id,N)}updateWorkPackageList(N,Q=!0){N.forEach(je=>{const Ee=je,ht=Ee.id,kt=this.multiState.get(ht);(0,$.Z)(Ee)?kt.putValue(Ee):this.schemaCacheService.ensureLoaded(Ee).then(()=>{Q&&kt.hasValue()&&_.isEqual(kt.value.$source,Ee.$source)?(0,me.qu)("Skipping identical work package from updating"):kt.putValue(Ee)})})}}ot.\u0275fac=function(N){return new(N||ot)(Se.LFG(Se.zs3),Se.LFG(V.J$))},ot.\u0275prov=Se.Yz7({token:ot,factory:ot.\u0275fac}),(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",x.y)],ot.prototype,"schemaCacheService",void 0);class st extends n.f2{get(){return this.halResourceService.get(this.path).pipe((0,k.b)(N=>N.schemas&&this.updateSchemas(N.schemas)),(0,k.b)(N=>this.cache.updateWorkPackageList(N.elements)),(0,m.q)(1))}get cache(){return this.parent.cache}updateSchemas(N){N.elements.forEach(Q=>{this.states.schemas.get(Q.href).putValue(Q)})}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",d.G)],st.prototype,"states",void 0);class he extends I{constructor(N,Q){super(N,Q,"work_packages",G),this.apiRoot=N,this.basePath=Q,this.form=this.subResource("form",D),this.available_projects=this.subResource("available_projects")}requireAll(N){return 0===N.length?Promise.resolve():new Promise((Q,je)=>{this.loadCollectionsFor(_.uniq(N)).then(Ee=>{_.each(Ee,ht=>{ht.schemas&&_.each(ht.schemas.elements,kt=>{this.states.schemas.get(kt.href).putValue(kt)}),ht.elements&&this.cache.updateWorkPackageList(ht.elements)}),Q(void 0)},je)})}post(N){return this.halResourceService.post(this.path,N).pipe(this.cacheResponse())}filtered(N,Q={}){return super.filtered(N,Q,st)}filterByTypeaheadOrId(N,Q=!1,je={}){const Ee=new Y.qM;Q?Ee.add("id","=",[N]):Ee.add("typeahead","**",[N]);const ht=Object.assign({sortBy:'[["updatedAt","desc"]]',offset:"1",pageSize:"10"},je);return this.filtered(Ee,ht)}filterUpdatedSince(N,Q){const je=(new Y.qM).add("id","=",N.filter(ht=>ht)).add("updatedAt","<>d",[Q,""]);return this.filtered(je,{offset:"1",pageSize:"10"})}loadCollectionsFor(N){return this.halResourceService.getAllPaginated(this.path,{filters:(0,Y.PQ)("id","=",N).toJson()}).toPromise()}createCache(){return new ot(this.injector,this.states.workPackages)}}class ye extends b{patch(N){return this.halResourceService.patch(this.path,N).pipe((0,k.b)(Q=>this.touch(Q)))}createCache(){return new Z.r(this.states.versions)}}class xe extends n.ZQ{constructor(N,Q){super(N,Q,"versions",ye),this.apiRoot=N,this.basePath=Q,this.form=this.subResource("form",y.f),this.available_projects=this.subResource("available_projects",X)}get(){return this.halResourceService.get(this.path)}post(N){return this.halResourceService.post(this.path,N)}}class De extends Ye.J{constructor(N,Q){super(Q,"copy"),this.apiRoot=N,this.basePath=Q,this.form=new y.f(this.apiRoot,this.path,"form")}}class Qe extends b{constructor(){super(...arguments),this.available_assignees=this.subResource("available_assignees"),this.queries=new dt(this.apiRoot,this.path),this.types=new Me(this.apiRoot,this.path),this.work_packages=new he(this.apiRoot,this.path),this.versions=new xe(this.apiRoot,this.path),this.copy=new De(this.apiRoot,this.path)}createCache(){return this.parent.cache}}class Ve extends Z.r{constructor(N,Q){super(Q),this.injector=N}updateValue(N,Q){return this.schemaCacheService.ensureLoaded(Q).then(()=>(this.putValue(N,Q),Q))}}Ve.\u0275fac=function(N){return new(N||Ve)(Se.LFG(Se.zs3),Se.LFG(V.J$))},Ve.\u0275prov=Se.Yz7({token:Ve,factory:Ve.\u0275fac}),(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",x.y)],Ve.prototype,"schemaCacheService",void 0);class nt extends I{constructor(N,Q){super(N,Q,"projects",Qe),this.apiRoot=N,this.basePath=Q,this.schema=this.subResource("schema")}list(N){return this.halResourceService.get(this.path+(0,c.g)(N)).pipe(this.cacheResponse())}createCache(){return new Ve(this.injector,this.states.projects)}}class mt extends b{createCache(){return new Z.r(this.states.statuses)}}class Ue extends n.ZQ{constructor(N,Q){super(N,Q,"statuses",mt),this.apiRoot=N,this.basePath=Q}get(){return this.halResourceService.get(this.path).pipe((0,k.b)(N=>{N.elements.forEach((Q,je)=>{this.id(Q.id).cache.updateValue(Q.id,Q)})}))}}class Fe extends b{createCache(){return new Z.r(this.states.roles)}}class Te extends n.ZQ{constructor(N,Q){super(N,Q,"roles",Fe),this.apiRoot=N,this.basePath=Q}get(){return this.halResourceService.get(this.path).pipe((0,k.b)(N=>{N.elements.forEach((Q,je)=>{this.id(Q.id).cache.updateValue(Q.id,Q)})}))}}class tt extends n.ZQ{constructor(N,Q){super(N,Q,"news"),this.apiRoot=N,this.basePath=Q}list(N){return this.halResourceService.get(this.path+(0,c.g)(N))}}class ut extends n.ZQ{constructor(N,Q){super(N,Q,"help_texts"),this.apiRoot=N,this.basePath=Q}get(){return this.halResourceService.get(this.path)}}class Yt extends n.f2{constructor(N,Q){super(N,Q,"configuration"),this.apiRoot=N,this.basePath=Q}get(){return this.$configuration?this.$configuration:this.$configuration=this.halResourceService.get(this.path).pipe((0,v.d)())}}class It{constructor(N){this.grid=N}get id(){return this.grid.id}get name(){return this.grid.name}get editable(){return!!this.grid.updateImmediately}get isFree(){return!this.isAction}get isAction(){return"action"===this.grid.options.type}get actionAttribute(){if(!this.isFree)return this.grid.options.attribute}set highlightingMode(N){this.grid.options.highlightingMode=N}get highlightingMode(){return this.grid.options.highlightingMode||"none"}set name(N){this.grid.name=N}addQuery(N){N.isNewWidget=!0,this.grid.widgets.push(N)}removeQuery(N){this.grid.widgets=this.grid.widgets.filter(Q=>Q.options.queryId!==N.options.queryId)}get queries(){return this.grid.widgets}get createdAt(){return this.grid.createdAt}get filters(){return this.grid.options.filters||[]}set filters(N){this.grid.options.filters=N}sortWidgets(){this.grid.widgets=this.grid.widgets.sort((N,Q)=>N.startColumn-Q.startColumn)}showStatusButton(){return"status"!==this.actionAttribute}}var Nt=t(7493);class wt extends b{load(){return this.apiRoot.grids.id(this.id).get().pipe((0,F.U)(N=>{const Q=new It(N);return Q.sortWidgets(),Q}))}save(N){return this.fetchSchema(N).pipe((0,C.w)(Q=>this.apiRoot.grids.id(N.grid).patch(N.grid,Q)),(0,F.U)(Q=>(N.grid=Q,N.sortWidgets(),N)),this.cacheResponse())}delete(){return this.apiRoot.grids.id(this.id).delete().pipe((0,k.b)(()=>this.cache.clearSome(this.id.toString())))}fetchSchema(N){return this.apiRoot.grids.id(N.grid).form.post({}).pipe((0,F.U)(Q=>Q.schema))}createCache(){return this.parent.cache}}var zt=t(23237);class Kt extends I{constructor(N,Q){super(N,Q,"grids",wt),this.apiRoot=N,this.basePath=Q}list(N){return this.halResourceService.get(this.path+(0,c.g)(N)).pipe((0,k.b)(Q=>this.authorisationService.initModelAuth("boards",Q.$links)),(0,F.U)(Q=>Q.elements.map(je=>{const Ee=new It(je);return Ee.sortWidgets(),this.touch(Ee),Ee})))}allInScope(N){const Q=this.boardPath(N);return this.list({filters:[["scope","=",[Q]]],pageSize:zt.LZ})}create(N,Q,je,Ee){const ht=this.boardPath(je);return this.createGrid(N,Q,ht,Ee).pipe((0,F.U)(kt=>new It(kt)))}boardPath(N){return this.PathHelper.projectBoardsPath(N)}createCache(){const N=this.states.forType("boards");return new Z.r(N)}createGrid(N,Q,je,Ee){const ht=_.set({name:Q},"_links.scope.href",je);return ht.options={type:N},Ee&&(ht.options.attribute=Ee),this.apiRoot.grids.form.post(ht).pipe((0,C.w)(kt=>this.apiRoot.grids.post(kt.payload.$source)))}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",Nt.g)],Kt.prototype,"authorisationService",void 0),(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",e.j)],Kt.prototype,"PathHelper",void 0);class ei extends n.f2{patch(N){return this.halResourceService.patch(this.path,{name:N.name})}delete(){return this.halResourceService.delete(this.path)}}class Rt extends n.ZQ{constructor(N,Q){super(N,Q,"placeholder_users",ei),this.apiRoot=N,this.basePath=Q}list(N){return this.halResourceService.get(this.path+(0,c.g)(N))}post(N){return this.halResourceService.post(this.path,N)}}class Mt extends n.f2{patch(N){return this.halResourceService.patch(this.path,{name:N.name})}delete(){return this.halResourceService.delete(this.path)}}class Ot extends n.ZQ{constructor(N,Q){super(N,Q,"groups",Mt),this.apiRoot=N,this.basePath=Q}list(N){return this.halResourceService.get(this.path+(0,c.g)(N))}post(N){return this.halResourceService.post(this.path,N)}}class St extends n.f2{markRead(){return this.http.post(`${this.path}/read_ian`,{},{withCredentials:!0,responseType:"json"})}markUnread(){return this.http.post(`${this.path}/unread_ian`,{},{withCredentials:!0,responseType:"json"})}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",H.eN)],St.prototype,"http",void 0);class ti extends n.ZQ{constructor(N,Q){super(N,Q,"notifications",St),this.apiRoot=N,this.basePath=Q}facet(N,Q){return"unread"===N?this.unread(Q):this.list(Q)}list(N){return this.http.get(this.path+(0,c.g)(N))}listPath(N){return this.path+(0,c.g)(N)}unread(N){const je=[...(null==N?void 0:N.filters)?N.filters:[],["readIAN","=",!1]],Ee=Object.assign(Object.assign({},N),{filters:je});return this.list(Ee)}markRead(N){return this.http.post(`${this.path}/read_ian${(0,c.g)({filters:[["id","=",N.map(Q=>Q.toString())]]})}`,{},{withCredentials:!0,responseType:"json"})}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",H.eN)],ti.prototype,"http",void 0);class Tt extends n.ZQ{constructor(N,Q){super(N,Q,"views"),this.apiRoot=N,this.basePath=Q}post(N,Q){return this.http.post(`${this.path}/${Q}`,N,{withCredentials:!0,responseType:"json"}).pipe((0,F.U)(je=>je))}}(0,l.gn)([(0,r.W)(),(0,l.w6)("design:type",H.eN)],Tt.prototype,"http",void 0);class qt extends n.f2{constructor(N,Q){super(N,Q,"backups"),this.apiRoot=N,this.basePath=Q}post(N,Q){return this.halResourceService.post(this.path,{backupToken:N,attachments:Q})}}class Qt extends n.f2{}class Gt extends n.ZQ{constructor(N,Q){super(N,Q,"days",Qt),this.apiRoot=N,this.basePath=Q,this.week=new n.f2(this.apiRoot,this.path,"week",this)}}class ii extends n.ZQ{constructor(N,Q){super(N,Q,"storages"),this.apiRoot=N,this.basePath=Q,this.files=this.subResource("files")}}class Jt{constructor(N,Q){this.injector=N,this.pathHelper=Q,this.attachments=this.apiV3CollectionEndpoint("attachments"),this.backups=this.apiV3CustomEndpoint(qt),this.configuration=this.apiV3CustomEndpoint(Yt),this.days=this.apiV3CustomEndpoint(Gt),this.documents=this.apiV3CollectionEndpoint("documents"),this.file_links=this.apiV3CollectionEndpoint("file_links"),this.notifications=this.apiV3CustomEndpoint(ti),this.grids=this.apiV3CustomEndpoint(i),this.principals=this.apiV3CollectionEndpoint("principals"),this.root=this.apiV3SingularEndpoint(""),this.statuses=this.apiV3CustomEndpoint(Ue),this.relations=this.apiV3CustomEndpoint(oe),this.priorities=this.apiV3CollectionEndpoint("priorities"),this.time_entries=this.apiV3CustomEndpoint(B),this.actions=this.apiV3CollectionEndpoint("actions"),this.capabilities=this.apiV3CustomEndpoint(R),this.memberships=this.apiV3CustomEndpoint(ie),this.news=this.apiV3CustomEndpoint(tt),this.storages=this.apiV3CustomEndpoint(ii),this.types=this.apiV3CustomEndpoint(Me),this.versions=this.apiV3CustomEndpoint(xe),this.work_packages=this.apiV3CustomEndpoint(he),this.queries=this.apiV3CustomEndpoint(dt),this.projects=this.apiV3CustomEndpoint(nt),this.users=this.apiV3CustomEndpoint(se),this.placeholder_users=this.apiV3CustomEndpoint(Rt),this.groups=this.apiV3CustomEndpoint(Ot),this.roles=this.apiV3CustomEndpoint(Te),this.help_texts=this.apiV3CustomEndpoint(ut),this.job_statuses=this.apiV3CollectionEndpoint("job_statuses"),this.views=this.apiV3CustomEndpoint(Tt),this.boards=this.apiV3CustomEndpoint(Kt)}withOptionalProject(N){return _.isNil(N)?this:this.projects.id(N)}collectionFromString(N){const Q=N.replace(`${this.pathHelper.api.v3.apiV3Base}/`,"");return this.apiV3CollectionEndpoint(Q)}apiV3CollectionEndpoint(N,Q){return new n.ZQ(this,this.pathHelper.api.v3.apiV3Base,N,Q)}apiV3CustomEndpoint(N){return new N(this,this.pathHelper.api.v3.apiV3Base)}apiV3SingularEndpoint(N){return new n.f2(this,this.pathHelper.api.v3.apiV3Base,N)}}Jt.\u0275fac=function(N){return new(N||Jt)(Se.LFG(Se.zs3),Se.LFG(e.j))},Jt.\u0275prov=Se.Yz7({token:Jt,factory:Jt.\u0275fac,providedIn:"root"})},79175:(te,M,t)=>{"use strict";t.d(M,{r:()=>i});var n=t(53466),e=t(91992),p=t(1143),h=t(77763),c=t(33927);class i{constructor(r,d=3600){this.multiState=r,this.cacheDurationInMs=1e3*d}state(r){return this.multiState.get(r)}touch(r){const d=this.multiState.get(r);d.putValue(d.value,"Touching the state")}current(r,d){return this.state(r).getValueOr(d)}clearAndLoad(r,d){const f=d.pipe((0,n.q)(1),(0,e.B)());return this.multiState.get(r).clearAndPutFromPromise(f.toPromise()),f}updateValue(r,d){return this.putValue(r,d),Promise.resolve(d)}updateFor(r){return this.updateValue(r.id,r)}observe(r){return this.state(r).values$()}changes$(r){return this.state(r).changes$()}observeAll(){return this.multiState.observeChange().pipe((0,p.O)([]),(0,h.e)(250),(0,c.U)(()=>{const r=[];return _.each(this.multiState.getValueOr({}),d=>{d.value&&r.push(d.value)}),r}))}clearSome(...r){r.forEach(d=>this.multiState.get(d).clear())}stale(r){const d=this.multiState.get(r);return!d.hasActivePromiseRequest()&&(d.isPristine()||d.isValueOlderThan(this.cacheDurationInMs))}putValue(r,d){this.multiState.get(r).putValue(d)}}},71909:(te,M,t)=>{"use strict";t.d(M,{E:()=>h});var n=t(83498),e=t(26784),p=t(80044);class h extends n.f{static extractPayload(i,l=null){if(i instanceof p.X&&l){const r=i,d=e.u.extractPayloadFromSchema(r,l);return d.widgets&&(d.widgets=r.widgets.map(f=>({id:f.id,startRow:f.startRow,endRow:f.endRow,startColumn:f.startColumn,endColumn:f.endColumn,identifier:f.identifier,options:f.options}))),d}return i||{}}extractPayload(i,l=null){return h.extractPayload(i,l)}}},83498:(te,M,t)=>{"use strict";t.d(M,{f:()=>p});var n=t(6976),e=t(26784);class p extends n.G7{post(c={},i=null){return this.halResourceService.post(this.path,this.extractPayload(c,i))}extractPayload(c,i=null){return e.u.extractPayload(c,i)}}},90044:(te,M,t)=>{"use strict";function n(e,p,h={}){const c=new URL(e,window.location.origin);if(c.searchParams.has("filters")){const i=JSON.parse(c.searchParams.get("filters"));c.searchParams.set("filters",JSON.stringify(i.concat(p.filters)))}else c.searchParams.set("filters",p.toJson());return Object.keys(h).forEach(i=>{c.searchParams.set(i,h[i])}),c}t.d(M,{d:()=>n})},23237:(te,M,t)=>{"use strict";t.d(M,{LZ:()=>i,JQ:()=>r,rP:()=>d});var n=t(85816),e=t(33927),p=t(42720),h=t(81134),c=t(80044);const i=-1;function r(f,a=i){return f({pageSize:a,offset:1}).pipe((0,n.zg)(m=>{const v=m.pageSize;if(m.total>m.count){const C=m.total-m.count,u=Math.ceil(C/v),k=new Array(u).fill(null).map((x,b)=>f({pageSize:v,offset:b+2}));return(0,p.D)(...k).pipe((0,e.U)(x=>[m,...x]))}return(0,h.of)([m])}))}function d(f,a=i){return r(f,a).pipe((0,e.U)(m=>m.reduce((v,C)=>v.concat(function(f){var a;return f instanceof c.X?f.elements||[]:(null===(a=f._embedded)||void 0===a?void 0:a.elements)||[]}(C)),[])))}},73726:(te,M,t)=>{"use strict";t.d(M,{g:()=>e});var n=t(26269);function e(p){const h=[];if(p&&p.sortBy&&h.push(`sortBy=${JSON.stringify(p.sortBy)}`),p&&p.groupBy&&h.push(`groupBy=${p.groupBy}`),p&&void 0!==p.pageSize&&h.push(`pageSize=${p.pageSize}`),p&&void 0!==p.offset&&h.push(`offset=${p.offset}`),p&&void 0!==p.select&&h.push(`select=${p.select.join(",")}`),p&&p.filters){const i=new n.qM;p.filters.forEach(l=>{i.add(...l)}),h.push(i.toParams())}let c="";return h.length&&(c=`?${h.join("&")}`),c}},6976:(te,M,t)=>{"use strict";t.d(M,{G7:()=>r,f2:()=>d,ZQ:()=>a});var n=t(3786),e=t(49152),p=t(29161),h=t(91923),c=t(23237),i=t(53882),l=t(90044);class r extends e.J{constructor(v,C,u,k){super(C,u),this.apiRoot=v,this.basePath=C,this.id=u,this.parent=k,this.injector=this.apiRoot.injector}subResource(v,C=d){return new C(this.apiRoot,this.path,v,this)}}(0,n.gn)([(0,p.W)(),(0,n.w6)("design:type",h.u)],r.prototype,"halResourceService",void 0);class d extends r{get(){return this.halResourceService.get(this.path)}}class f extends d{getPaginatedResults(){return(0,c.rP)(v=>this.halResourceService.request("get",this.path,v),-1)}}class a extends e.D{constructor(v,C,u,k){super(C,u,k),this.apiRoot=v,this.basePath=C,this.resource=k,this.injector=this.apiRoot.injector}id(v){let C;return C="string"==typeof v||"number"==typeof v?v.toString():v.id,new(this.resource||d)(this.apiRoot,this.path,C,this)}withOptionalId(v){return _.isNil(v)?this:this.id(v)}toString(){return this.path}toPath(){return this.path}filtered(v,C={},u){const k=(0,l.d)(this.path,v,C);return new(u||f)(this.apiRoot,k.pathname,k.search,this)}signalled(v,C,u={}){const k=(0,l.d)(this.path,v,Object.assign(Object.assign({},u),{select:C.join(",")}));return this.http.get(k.toString())}subResource(v,C=d){return new C(this.apiRoot,this.path,v,this)}}(0,n.gn)([(0,p.W)(),(0,n.w6)("design:type",i.eN)],a.prototype,"http",void 0),(0,n.gn)([(0,p.W)(),(0,n.w6)("design:type",h.u)],a.prototype,"halResourceService",void 0)},49152:(te,M,t)=>{"use strict";t.d(M,{D:()=>n,J:()=>e});class n{constructor(h,c,i){this.basePath=h,this.segment=c,this.resource=i,this.path=`${this.basePath}/${c}`}id(h){return new(this.resource||e)(this.path,h)}withOptionalId(h){return _.isNil(h)?this:this.id(h)}toString(){return this.path}toPath(){return this.path}}class e{constructor(h,c){this.basePath=h,this.segment=c;const i=c.toString().startsWith("?")?"":"/";this.path=`${this.basePath}${i}${c}`}toString(){return this.path}toPath(){return this.path}}},1056:(te,M,t)=>{"use strict";t.d(M,{o:()=>p});var n=t(54364),e=t(2316);class p{constructor(c){this.documentElement=c}get isMobile(){return this.hasBodyClass("-browser-mobile")}get isEdge(){return this.hasBodyClass("-browser-edge")}hasBodyClass(c){return this.documentElement.body.classList.contains(c)}}p.\u0275fac=function(c){return new(c||p)(e.LFG(n.K0))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})},53916:(te,M,t)=>{"use strict";t.d(M,{U:()=>e});var n=t(2316);class e{constructor(){this.mobileWidthTreshold=680}get isMobile(){return window.innerWidth<this.mobileWidthTreshold}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},12877:(te,M,t)=>{"use strict";t.d(M,{e:()=>i});var n=t(96617),e=t(2281),h=t(33276),c=t(2316);class i{constructor(r,d){this.I18n=r,this.apiV3Service=d,this.initialized=this.loadConfiguration().then(()=>!0).catch(()=>!1)}commentsSortedInDescendingOrder(){return this.userPreference("commentSortDescending")}warnOnLeavingUnsaved(){return this.userPreference("warnOnLeavingUnsaved")}autoHidePopups(){return this.userPreference("autoHidePopups")}isTimezoneSet(){return!!this.timezone()}timezone(){return this.userPreference("timeZone")}isDirectUploads(){return!!this.prepareAttachmentURL}get prepareAttachmentURL(){return _.get(this.configuration,["prepareAttachment","href"])}get maximumAttachmentFileSize(){return this.systemPreference("maximumAttachmentFileSize")}get perPageOptions(){return this.systemPreference("perPageOptions")}dateFormatPresent(){return!!this.systemPreference("dateFormat")}dateFormat(){return this.systemPreference("dateFormat")}timeFormatPresent(){return!!this.systemPreference("timeFormat")}timeFormat(){return this.systemPreference("timeFormat")}startOfWeekPresent(){return!!this.systemPreference("startOfWeek")}startOfWeek(){return this.startOfWeekPresent()?this.systemPreference("startOfWeek"):e.localeData(I18n.locale).firstDayOfWeek()}get hostName(){return this.systemPreference("hostName")}get activeFeatureFlags(){return this.systemPreference("activeFeatureFlags")}loadConfiguration(){return this.apiV3Service.configuration.get().toPromise().then(r=>{this.configuration=r})}userPreference(r){return _.get(this.configuration,["userPreferences",r])}systemPreference(r){return _.get(this.configuration,r)}}i.\u0275fac=function(r){return new(r||i)(c.LFG(n.D),c.LFG(h.T))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})},65146:(te,M,t)=>{"use strict";t.d(M,{R:()=>h});var n=t(70233),e=t(33276),p=t(2316);class h{constructor(i,l){this.PathHelper=i,this.apiV3Service=l,this.detect()}get inProjectContext(){return void 0!==this.current}get path(){return this.current?this.PathHelper.projectPath(this.current.identifier):null}get apiv3Path(){return this.current?this.apiV3Service.projects.id(this.current.id).toString():null}get id(){return this.getCurrent("id")}get name(){return this.getCurrent("name")}get identifier(){return this.getCurrent("identifier")}getCurrent(i){return this.current&&this.current[i]?this.current[i].toString():null}detect(){const i=document.querySelector("meta[name=current_project]");i&&(this.current={id:i.dataset.projectId,name:i.dataset.projectName,identifier:i.dataset.projectIdentifier})}}h.\u0275fac=function(i){return new(i||h)(p.LFG(n.j),p.LFG(e.T))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},37991:(te,M,t)=>{"use strict";t.d(M,{H:()=>l});var n=t(96905),e=t(52657),p=t(4678),h=t(53466),c=t(2316);class l{constructor(d){!function(r){const d=r.get(n.S);window.ErrorReporter.addHook(()=>d.user$.pipe((0,h.q)(1)).toPromise().then(({id:a})=>({user:a||"anon"})));const f=document.querySelectorAll("meta[name=current_user]")[0];d.setUser({id:(null==f?void 0:f.dataset.id)||null,name:(null==f?void 0:f.dataset.name)||null,mail:(null==f?void 0:f.dataset.mail)||null})}(d)}}l.\u0275fac=function(d){return new(d||l)(c.LFG(c.zs3))},l.\u0275mod=c.oAB({type:l}),l.\u0275inj=c.cJS({providers:[n.S,e.D,p.b]})},4678:(te,M,t)=>{"use strict";t.d(M,{b:()=>h});var n=t(19100),e=t(52657),p=t(2316);class h extends n.AE{constructor(i){super(i),this.store=i,this.isLoggedIn$=this.select(l=>!!l.id),this.user$=this.select(({id:l,name:r,mail:d})=>({id:l,name:r,mail:d}))}}h.\u0275fac=function(i){return new(i||h)(p.LFG(e.D))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},96905:(te,M,t)=>{"use strict";t.d(M,{S:()=>a});var n=t(33276),e=t(52657),p=t(4678),h=t(41599),c=t(33927),i=t(79902),l=t(83720),r=t(9170),d=t(53466),f=t(2316);class a{constructor(v,C,u,k){this.apiV3Service=v,this.currentUserStore=C,this.currentUserQuery=u,this.capabilitiesService=k,this.isLoggedIn$=this.currentUserQuery.isLoggedIn$,this.user$=this.currentUserQuery.user$,this._isLoggedIn=!1,this._user={id:null,name:null,mail:null},this.setupLegacyDataListeners()}setUser(v){this.currentUserStore.update(C=>Object.assign(Object.assign({},C),v))}capabilities$(v=[],C){return this.principalFilter$().pipe((0,c.U)(u=>{const k=[u];return C&&k.push(["context","=",["global"===C?"g":`p${C}`]]),v.length>0&&k.push(["action","=",v]),{filters:k,pageSize:-1}}),(0,i.w)(u=>this.capabilitiesService.require(u)))}hasCapabilities$(v,C){const u=_.castArray(v);return this.capabilities$(u,C).pipe((0,c.U)(k=>u.reduce((x,b)=>x&&!!k.find(y=>y._links.action.href.endsWith(`/api/v3/actions/${b}`)),k.length>0)),(0,l.x)())}hasAnyCapabilityOf$(v,C){const u=_.castArray(v);return this.capabilities$(u,C).pipe((0,c.U)(k=>k.reduce((x,b)=>x||!!u.find(y=>b._links.action.href.endsWith(`/api/v3/actions/${y}`)),!1)),(0,l.x)())}principalFilter$(){return this.user$.pipe((0,r.h)(v=>!!v.id),(0,d.q)(1),(0,c.U)(v=>["principal","=",[v.id]]))}setupLegacyDataListeners(){this.currentUserQuery.user$.subscribe(v=>this._user=v),this.currentUserQuery.isLoggedIn$.subscribe(v=>this._isLoggedIn=v)}get isLoggedIn(){return this._isLoggedIn}get userId(){return this._user.id||""}get name(){return this._user.name||""}get mail(){return this._user.mail||""}get href(){return`/api/v3/users/${this.userId}`}get language(){return I18n.locale||"en"}}a.\u0275fac=function(v){return new(v||a)(f.LFG(n.T),f.LFG(e.D),f.LFG(p.b),f.LFG(h.a))},a.\u0275prov=f.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})},52657:(te,M,t)=>{"use strict";t.d(M,{D:()=>c});var n=t(3786),e=t(19100),p=t(2316);let c=class extends e.yh{constructor(){super({id:null,name:null,mail:null})}};c.\u0275fac=function(l){return new(l||c)},c.\u0275prov=p.Yz7({token:c,factory:c.\u0275fac}),c=(0,n.gn)([(0,e.yC)({name:"current-user"}),(0,n.w6)("design:paramtypes",[])],c)},70692:(te,M,t)=>{"use strict";t.d(M,{B:()=>i});var n=t(12877),e=t(96617),p=t(86035),c=t(2316);class i{constructor(r,d){this.configurationService=r,this.I18n=d,this.setupLocale()}setupLocale(){p.locale(I18n.locale)}parseDatetime(r,d){const f=p.utc(r,d);return this.configurationService.isTimezoneSet()&&(f.local(),f.tz(this.configurationService.timezone())),f}parseDate(r,d){return p(r,d)}parseISODatetime(r){return this.parseDatetime(r,"YYYY-MM-DDTHH:mm:ssZ")}parseISODate(r){return this.parseDate(r,"YYYY-MM-DD")}formattedDate(r){return this.parseDate(r).format(this.getDateFormat())}daysFromToday(r){const d=this.parseDate(r),f=p().startOf("day");return d.diff(f,"days")}formattedTime(r){return this.parseDatetime(r).format(this.getTimeFormat())}formattedDatetime(r){const d=this.formattedDatetimeComponents(r);return`${d[0]} ${d[1]}`}formattedRelativeDateTime(r){return this.parseDatetime(r).fromNow()}formattedDatetimeComponents(r){const d=this.parseDatetime(r);return[d.format(this.getDateFormat()),d.format(this.getTimeFormat())]}toHours(r){return Number(p.duration(r).asHours().toFixed(2))}toDays(r){return Number(p.duration(r).asDays().toFixed(2))}toISODuration(r,d){return p.duration(r,d).toIsoString()}formattedDuration(r,d="hour"){switch(d){case"hour":return this.I18n.t("js.units.hour",{count:this.toHours(r)});case"days":return this.I18n.t("js.units.day",{count:this.toDays(r)});default:return""}}formattedISODate(r){return this.parseDate(r).format("YYYY-MM-DD")}formattedISODateTime(r){return r.format()}isValidISODate(r){return this.isValid(r,"YYYY-MM-DD")}isValidISODateTime(r){return this.isValid(r,"YYYY-MM-DDTHH:mm:ssZ")}isValid(r,d){const f=d||this.getDateFormat();return p(r,[f],!0).isValid()}getDateFormat(){return this.configurationService.dateFormatPresent()?this.configurationService.dateFormat():"L"}getTimeFormat(){return this.configurationService.timeFormatPresent()?this.configurationService.timeFormat():"LT"}}i.\u0275fac=function(r){return new(r||i)(c.LFG(n.e),c.LFG(e.D))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})},52377:(te,M,t)=>{"use strict";t.d(M,{u:()=>f});var n=t(3786),e=t(2281),h=t(53466),c=t(98636),i=t(29161),l=t(46934),r=t(81134),d=t(2316);class f{constructor(m){this.injector=m}isNonWorkingDay(m){const v="number"==typeof m?m:e(m).isoWeekday();return!!(this.weekdays||[]).find(C=>C.day===v&&!C.working)}get nonWorkingDays(){return this.weekdays.filter(m=>!m.working)}loadWeekdays(){return this.weekdays?(0,r.of)(this.weekdays):this.weekdaysService.require().pipe((0,h.q)(1),(0,c.b)(m=>{this.weekdays=m}))}}f.\u0275fac=function(m){return new(m||f)(d.LFG(d.zs3))},f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),(0,n.gn)([(0,i.W)(),(0,n.w6)("design:type",l.s)],f.prototype,"weekdaysService",void 0)},73881:(te,M,t)=>{"use strict";t.d(M,{j:()=>h});var n=t(54364),e=t(27779),p=t(2316);class h{constructor(i){this.documentElement=i,this._banners=!0,this._banners=i.body.classList.contains("ee-banners-visible")}get eeShowBanners(){return this._banners}getEnterPriseEditionUrl({referrer:i,hash:l}={}){const r=new URL(e.Mg);return i&&r.searchParams.set("op_referrer",i),l&&(r.hash=l),r.toString()}conditional(i,l){this._banners?this.callMaybe(i):this.callMaybe(l)}callMaybe(i){i&&i()}}h.\u0275fac=function(i){return new(i||h)(p.LFG(n.K0))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},48249:(te,M,t)=>{"use strict";t.d(M,{c:()=>m});var n=t(3786),e=t(53882),p=t(30400),h=t(81134),c=t(79902),i=t(91992),l=t(22464),d=t(76825),f=t(18869),a=t(2316);class m extends d.r{uploadSingle(C,u,k="post",x="text"){return[u,(0,p.D)(this.getDirectUploadFormFrom(C,u)).pipe((0,c.w)(this.uploadToExternal(u,k,x)),(0,i.B)())]}uploadToExternal(C,u,k){return x=>(x.form.append("file",C,C.customName||C.name),this.http.request(u,x.url,{body:x.form,observe:"events",headers:{[f.i]:"true"},responseType:k,reportProgress:!0}).pipe((0,c.w)(this.finishUpload(x))))}finishUpload(C){return u=>{var k,x,b;return u instanceof e.Zn?this.http.get(null===(b=null===(x=null===(k=C.response)||void 0===k?void 0:k._links)||void 0===x?void 0:x.completeUpload)||void 0===b?void 0:b.href,{observe:"response"}):(0,h.of)(u)}}getDirectUploadFormFrom(C,u){return(0,n.mG)(this,void 0,void 0,function*(){const k=u.customName||u.name,x=u.type||k&&(0,l.getType)(k)||"",b=new FormData,y={fileName:k,contentType:x,description:u.description,fileSize:u.size};b.append("metadata",JSON.stringify(y));const P=yield this.http.request("post",C,{body:b,withCredentials:!0,responseType:"json"}).toPromise(),E=new FormData;return _.each(P._links.addAttachment.form_fields,(T,O)=>{E.append(O,T)}),{form:E,url:P._links.addAttachment.href,response:P}})}}m.\u0275fac=function(){let v;return function(u){return(v||(v=a.n5z(m)))(u||m)}}(),m.\u0275prov=a.Yz7({token:m,factory:m.\u0275fac})},76825:(te,M,t)=>{"use strict";t.d(M,{r:()=>l});var n=t(53882),e=t(91992),p=t(9170),h=t(33927),c=t(91923),i=t(2316);class l{constructor(d,f){this.http=d,this.halResource=f}uploadAndMapResponse(d,f,a="post"){const{uploads:m,finished:v}=this.upload(d,f);return{uploads:m,finished:v.then(u=>u.map(k=>({response:k,uploadUrl:k.staticDownloadLocation.href})))}}upload(d,f,a="post"){f=_.filter(f,C=>"directory"!==C.type);const m=_.map(f,C=>this.uploadSingle(d,C,a));return{uploads:m,finished:this.whenFinished(m)}}uploadSingle(d,f,a="post",m="json"){const v=new FormData,C={description:f.description,fileName:f.customName||f.name};v.append("metadata",JSON.stringify(C)),v.append("file",f,C.fileName);return[f,this.http.request(a,d,{body:v,observe:"events",withCredentials:!0,responseType:m,reportProgress:!0}).pipe((0,e.B)())]}whenFinished(d){const f=d.map(([a,m])=>m.pipe((0,p.h)(v=>v.type===n.dt.Response),(0,h.U)(v=>this.halResource.createHalResource(v.body))).toPromise());return Promise.all(f)}}l.\u0275fac=function(d){return new(d||l)(i.LFG(n.eN),i.LFG(c.u))},l.\u0275prov=i.Yz7({token:l,factory:l.\u0275fac})},84032:(te,M,t)=>{"use strict";t.d(M,{U:()=>e});var n=t(2316);class e{get(...h){return _.get(window.gon,h,null)}get gon(){return window.gon}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},57810:(te,M,t)=>{"use strict";t.d(M,{V:()=>h});var n=t(2316),e=t(71570);const p=" | ";class h{constructor(i){this.titleService=i}get current(){return this.titleService.getTitle()}get titleParts(){return this.current.split(p)}setFirstPart(i){const l=this.titleParts;l[0]=i,this.titleService.setTitle(l.join(p))}prependFirstPart(i){const l=this.titleParts;l.unshift(i),this.titleService.setTitle(l.join(p))}}h.\u0275fac=function(i){return new(i||h)(n.LFG(e.Dx))},h.\u0275prov=n.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},96617:(te,M,t)=>{"use strict";t.d(M,{D:()=>e});var n=t(2316);class e{constructor(){this.i18n=window.I18n,this.t=this.i18n.t.bind(this.i18n),this.lookup=this.i18n.lookup.bind(this.i18n),this.toTime=this.i18n.toTime.bind(this.i18n),this.toNumber=this.i18n.toNumber.bind(this.i18n),this.toPercentage=this.i18n.toPercentage.bind(this.i18n),this.toCurrency=this.i18n.toCurrency.bind(this.i18n),this.strftime=this.i18n.strftime.bind(this.i18n),this.toHumanSize=this.i18n.toHumanSize.bind(this.i18n)}get locale(){return this.i18n.locale}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},86469:(te,M,t)=>{"use strict";t.d(M,{xc:()=>c,RA:()=>i,vt:()=>r});var n=t(98636),e=t(2316);function c(d,f){return a=>(d.start(),a.pipe((0,n.b)(()=>d.delayedStop(f),()=>d.stop(),()=>d.stop())))}function i(d){return f=>(setTimeout(()=>d().start()),f.pipe((0,n.b)(()=>{},()=>d().stop(),()=>d().stop())))}class l{constructor(f){this.indicator=f,this.indicatorTemplate='<div class="loading-indicator--background">\n      <div class="loading-indicator">\n        <div class="block-1"></div>\n        <div class="block-2"></div>\n        <div class="block-3"></div>\n        <div class="block-4"></div>\n        <div class="block-5"></div>\n      </div>\n    </div>\n   '}set promise(f){this.start();const a=()=>this.delayedStop();f.then(a).catch(a)}start(){this.stop(),this.indicator.prepend(this.indicatorTemplate)}delayedStop(f=25){setTimeout(()=>this.stop(),f)}stop(){this.indicator.find(".loading-indicator--background").remove()}}class r{get table(){return this.indicator("table")}get wpDetails(){return this.indicator("wpDetails")}get modal(){return this.indicator("modal")}getter(f){return this.indicator.bind(this,f)}indicator(f){return"string"==typeof f&&(f=this.getIndicatorAt(f)),new l(f)}getIndicatorAt(f){return jQuery(".loading-indicator--location").filter(`[data-indicator-name="${f}"]`)}}r.\u0275fac=function(f){return new(f||r)},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})},83835:(te,M,t)=>{"use strict";t.d(M,{J:()=>r});var n=t(3786),e=t(76491),p=t(96617),h=t(65146),c=t(53916),i=t(29161),l=t(2316);class r{constructor(f,a,m){this.I18n=f,this.injector=a,this.deviceService=m,this.elementMinWidth=11,this.defaultWidth=230,this.localStorageKey="openProject-mainMenuWidth",this.localStorageStateKey="openProject-mainMenuCollapsed",this.global=window,this.htmlNode=document.getElementsByTagName("html")[0],this.mainMenu=jQuery("#main-menu")[0],this.hideElements=jQuery(".can-hide-navigation"),this.titleData=new e.X(""),this.titleData$=this.titleData.asObservable(),this.changeData=new e.X({}),this.changeData$=this.changeData.asObservable()}initializeMenu(){if(!this.mainMenu)return;this.elementWidth=parseInt(window.OpenProject.guardedLocalStorage(this.localStorageKey));const f=window.OpenProject.guardedLocalStorage(this.localStorageStateKey);this.elementWidth?f&&JSON.parse(f)?this.closeMenu():this.setWidth():this.saveWidth(this.mainMenu.offsetWidth);const a=this.injector.get(h.R);(jQuery(document.body).hasClass("controller-my")&&0===this.elementWidth||null===a.id)&&this.saveWidth(this.defaultWidth),this.closeWhenOnMobile()}toggleNavigation(f){if(f&&(f.stopPropagation(),f.preventDefault()),this.showNavigation)this.closeMenu();else if(this.deviceService.isMobile)this.setWidth(window.innerWidth);else{const a=parseInt(window.OpenProject.guardedLocalStorage(this.localStorageKey)),m=a>=this.elementMinWidth?a:this.defaultWidth;this.saveWidth(m)}setTimeout(()=>{jQuery('#main-menu [class*="-menu-item"]:visible').first().focus()},500)}closeMenu(){this.setWidth(0),window.OpenProject.guardedLocalStorage(this.localStorageStateKey,"true"),jQuery(".searchable-menu--search-input").blur()}closeWhenOnMobile(){this.deviceService.isMobile&&(this.closeMenu(),window.OpenProject.guardedLocalStorage(this.localStorageStateKey,"false"))}saveWidth(f){this.setWidth(f),window.OpenProject.guardedLocalStorage(this.localStorageKey,String(this.elementWidth)),window.OpenProject.guardedLocalStorage(this.localStorageStateKey,String(0===this.elementWidth))}setWidth(f){if(void 0!==f){const m=this.deviceService.isMobile?window.innerWidth-120:window.innerWidth-520;this.elementWidth=f>m?m:f}this.snapBack(),this.setToggleTitle(),this.toggleClassHidden(),this.global.showNavigation=this.showNavigation,this.htmlNode.style.setProperty("--main-menu-width",`${this.elementWidth}px`);const a=jQuery.Event("change");this.changeData.next(a)}get showNavigation(){return this.elementWidth>=this.elementMinWidth}snapBack(){this.elementWidth<this.elementMinWidth&&(this.elementWidth=0)}setToggleTitle(){this.showNavigation?this.toggleTitle=this.I18n.t("js.label_hide_project_menu"):this.toggleTitle=this.I18n.t("js.label_expand_project_menu"),this.titleData.next(this.toggleTitle)}toggleClassHidden(){this.hideElements.toggleClass("hidden-navigation",!this.showNavigation)}}r.\u0275fac=function(f){return new(f||r)(l.LFG(p.D),l.LFG(l.zs3),l.LFG(c.U))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),(0,n.gn)([(0,i.W)(),(0,n.w6)("design:type",h.R)],r.prototype,"currentProject",void 0)},7493:(te,M,t)=>{"use strict";t.d(M,{g:()=>h});var n=t(14808),e=t(22663),p=t(2316);class h{constructor(){this.links=(0,n.qH)({})}initModelAuth(i,l){this.links.doModify(r=>{const d=Object.assign({},r);return d[i]=l,d})}observeUntil(i){return this.links.values$().pipe((0,e.R)(i))}can(i,l){const r=this.links.getValueOr({});return r[i]&&l in r[i]}cannot(i,l){return!this.can(i,l)}}h.\u0275fac=function(i){return new(i||h)},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},70233:(te,M,t)=>{"use strict";t.d(M,{j:()=>h});var n=t(26269);class e{constructor(i){this.apiV3Base=`${i}/api/v3`}get openApiSpecPath(){return`${this.apiV3Base}/spec.json`}previewMarkup(i){const l=`${this.apiV3Base}/render/markdown`;return i?`${l}?context=${i}`:l}principals(i,l){const r=new n.qM;return r.add("status","!",["3"]),r.add("member","=",[i.toString()]),r.add("type","=",["User","Group"]),l&&l.length>0&&r.add("name","~",[l]),`${this.apiV3Base}/principals?${r.toParams({sortBy:'[["name","asc"]]',offset:"1",pageSize:"10"})}`}}var p=t(2316);class h{constructor(){this.appBasePath=window.appBasePath||"",this.api={v3:new e(this.appBasePath)}}get staticBase(){return this.appBasePath}attachmentDownloadPath(i,l){const r=`${this.staticBase}/attachments/${i}`;return l?`${r}/${l}`:r}attachmentContentPath(i){return`${this.staticBase}/attachments/${i}/content`}ifcModelsPath(i){return`${this.staticBase}/projects/${i}/ifc_models`}ifcModelsNewPath(i){return`${this.ifcModelsPath(i)}/new`}ifcModelsEditPath(i,l){return`${this.ifcModelsPath(i)}/${l}/edit`}ifcModelsDeletePath(i,l){return`${this.ifcModelsPath(i)}/${l}`}bimDetailsPath(i,l,r=null){let d=`${this.projectPath(i)}/bcf/details/${l}`;return null!==r&&(d+=`?query_props=%7B"t"%3A"id%3Adesc"%2C"dr"%3A"splitCards"%7D&viewpoint=${r}`),d}highlightingCssPath(){return`${this.staticBase}/highlighting/styles`}forumPath(i,l){return`${this.projectForumPath(i)}/${l}`}keyboardShortcutsHelpPath(){return`${this.staticBase}/help/keyboard_shortcuts`}messagePath(i){return`${this.staticBase}/topics/${i}`}myPagePath(){return`${this.staticBase}/my/page`}myNotificationsSettingsPath(){return`${this.staticBase}/my/notifications`}newsPath(i){return`${this.staticBase}/news/${i}`}notificationsPath(){return`${this.staticBase}/notifications`}loginPath(){return`${this.staticBase}/login`}projectsPath(){return`${this.staticBase}/projects`}projectsNewPath(){return`${this.staticBase}/projects/new`}projectPath(i){return`${this.projectsPath()}/${i}`}projectActivityPath(i){return`${this.projectPath(i)}/activity`}projectForumPath(i){return`${this.projectPath(i)}/forums`}projectCalendarPath(i){return`${this.projectPath(i)}/calendar`}projectMembershipsPath(i){return`${this.projectPath(i)}/members`}projectNewsPath(i){return`${this.projectPath(i)}/news`}projectTimeEntriesPath(i){return`${this.projectPath(i)}/cost_reports`}projectWikiPath(i){return`${this.projectPath(i)}/wiki`}projectWorkPackagePath(i,l){return`${this.projectWorkPackagesPath(i)}/${l}`}projectWorkPackagesPath(i){return`${this.projectPath(i)}/work_packages`}projectWorkPackageNewPath(i){return`${this.projectWorkPackagesPath(i)}/new`}projectBoardsPath(i){return i?`${this.projectPath(i)}/boards`:`${this.staticBase}/boards`}projectDashboardsPath(i){return`${this.projectPath(i)}/dashboards`}timeEntriesPath(i){const l="/time_entries";return i?this.workPackagePath(i)+l:this.staticBase+l}usersPath(){return`${this.staticBase}/users`}groupsPath(){return`${this.staticBase}/groups`}placeholderUsersPath(){return`${this.staticBase}/placeholder_users`}userPath(i){return`${this.usersPath()}/${i}`}placeholderUserPath(i){return`${this.placeholderUsersPath()}/${i}`}groupPath(i){return`${this.groupsPath()}/${i}`}rolesPath(){return`${this.staticBase}/roles`}rolePath(i){return`${this.rolesPath()}/${i}`}versionsPath(){return`${this.staticBase}/versions`}versionEditPath(i){return`${this.staticBase}/versions/${i}/edit`}versionShowPath(i){return`${this.staticBase}/versions/${i}`}workPackagesPath(){return`${this.staticBase}/work_packages`}workPackagePath(i){return`${this.staticBase}/work_packages/${i}`}workPackageCopyPath(i){return`${this.workPackagePath(i)}/copy`}workPackageDetailsCopyPath(i,l){return`${this.projectWorkPackagesPath(i)}/details/${l}/copy`}workPackagesBulkDeletePath(){return`${this.workPackagesPath()}/bulk`}textFormattingHelp(){return`${this.staticBase}/help/text_formatting`}}h.\u0275fac=function(i){return new(i||h)},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},84732:(te,M,t)=>{"use strict";t.d(M,{p:()=>e});var n=t(2316);class e{constructor(){}get isEmpty(){return!this.name}setIfFirst(h,c){!this.isEmpty||!h||(this.name=h,this.params=c)}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac})},44022:(te,M,t)=>{"use strict";t.d(M,{y:()=>d});var n=t(79175),e=t(53466),p=t(87853),h=t(81531),c=t(91923),i=t(81923),l=t(80044),r=t(2316);class d extends n.r{constructor(a,m){super(a.schemas),this.states=a,this.halResourceService=m}state(a){return super.state(this.stateKey(a))}of(a){const m=this.state(a).value;if(!m)throw new Error(`Schema for resource ${a} was expected to be loaded but isn't.`);return"WorkPackage"===a._type?i.X.create(m,a):h.V.create(m,a)}getSchemaHref(a){var m;const v=null===(m=a.$links.schema)||void 0===m?void 0:m.href;if(!v)throw new Error(`Resource ${a} has no schema to load.`);return v}ensureLoaded(a){const m=a instanceof l.X?this.getSchemaHref(a):a;return this.requireAndStream(m).pipe((0,e.q)(1)).toPromise()}requireAndStream(a,m=!1){return(this.stale(a)||m)&&this.clearAndLoad(a,this.load(a)),this.state(a).values$()}load(a){return this.halResourceService.get(a).pipe((0,e.q)(1))}loadAll(a){return Promise.all(a.map(m=>this.load(m)))}update(a,m){this.multiState.get(this.stateKey(a)).putValue(m)}stateKey(a){return a instanceof l.X?this.getSchemaHref(a):a}}d.\u0275fac=function(a){return new(a||d)(r.LFG(p.G),r.LFG(c.u))},d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac})},27779:(te,M,t)=>{"use strict";t.d(M,{Mg:()=>n,vY:()=>e,wp:()=>p,rj:()=>h});const n="https://www.openproject.org/enterprise-edition/?op_edition=community-edition",e={en:"https://www.openproject.org/contact/",de:"https://www.openproject.org/de/kontakt/"},p="https://www.openproject.org/pricing",h={website:"https://www.openproject.org/enterprise-edition/",boards:"https://www.openproject.org/docs/user-guide/agile-boards/#action-boards-enterprise-add-on",tableHighlighting:"https://www.openproject.org/docs/user-guide/work-packages/work-package-table-configuration/#attribute-highlighting-enterprise-add-on",graphWidgets:"https://www.openproject.org/docs/user-guide/project-overview/#work-package-graph-widgets-enterprise-add-on"}},80261:(te,M,t)=>{"use strict";t.d(M,{Z:()=>e});var n=t(3352);class e{static register(...h){this.optionalBoostrapComponents.push(...h)}static bootstrapOptionalDocument(h,c,i=this.optionalBoostrapComponents){this.performBootstrap(h,c,!1,i)}static bootstrapOptionalEmbeddable(h,c,i=this.optionalBoostrapComponents){Promise.resolve().then(()=>this.performBootstrap(h,c,!0,i))}static getEmbeddable(){return this.optionalBoostrapComponents.filter(h=>h.embeddable)}static performBootstrap(h,c,i,l){l.forEach(r=>{if(i&&!r.embeddable)return;const d=c.querySelectorAll(r.selector);for(let f=0;f<d.length;f++){const a=d[f];if(!i&&a.closest("[op-dynamic-bootstrap]"))return void(0,n.qu)(`Skipping nested bootstrap ${r.selector} in %O`,a);h.bootstrap(r.cls,a),a.setAttribute("op-dynamic-bootstrap","true")}})}}e.optionalBoostrapComponents=[]},12630:(te,M,t)=>{"use strict";t.d(M,{RO:()=>n,wh:()=>e,PI:()=>p,vV:()=>h,br:()=>c,Lt:()=>i,vx:()=>l});const n="Demo project",e="Scrum project",p="openProject-onboardingTour";var h,r;function c(r,d,f){new MutationObserver((m,v)=>{jQuery(r).length&&(v.disconnect(),f())}).observe(jQuery(d)[0],{childList:!0,subtree:!0})}function i(){const r=[],d=jQuery(`.widget-box.welcome a:contains(${n})`),f=jQuery(`.widget-box.welcome a:contains(${e})`);return d.length&&r.push(d),f.length&&r.push(f),r}function l(r){r.preventDefault(),r.stopPropagation()}(r=h||(h={})).demo="demo",r.scrum="scrum"},83531:()=>{var te;(te=jQuery)(()=>{te("[data-selected-page]").closest(".tree-menu--container").each((t,n)=>{const e=te(n).data("selected-page");if(e){const p=te(`[slug="${e}"]`,n);p.toggleClass("-selected",!0),p.length>0&&p[0].scrollIntoView()}}),te(".pages-hierarchy.-with-hierarchy .tree-menu--hierarchy-span").on("click keypress",function(t){return"keypress"===t.type&&13!==t.which||te(t.target).closest("ul.-with-hierarchy > li").toggleClass("-hierarchy-collapsed -hierarchy-expanded"),!1})})},44500:(te,M,t)=>{"use strict";t.r(M);t(58256),t(80261);var p=t(14808),h=t(53466);class c{checkAll(d,f){document.querySelectorAll(`#${d} input[type="checkbox"]:not([disabled])`).forEach(a=>a.checked=f)}toggleCheckboxesBySelector(d){const f=jQuery(d);let a=!0;for(let m=0;m<f.length;m++)!1===f[m].checked&&(a=!1);for(let m=0;m<f.length;m++)f[m].checked=!a}}window.OpenProject=new class{constructor(){this.pluginContext=(0,p.qH)(),this.helpers=new c,this.pageWasEdited=!1,this.pageIsSubmitted=!1}getPluginContext(){return this.pluginContext.values$().pipe((0,h.q)(1)).toPromise()}get urlRoot(){return jQuery("meta[name=app_base_path]").attr("content")||""}get environment(){return jQuery("meta[name=openproject_initializer]").data("environment")}get edition(){return jQuery("meta[name=openproject_initializer]").data("edition")}get isStandardEdition(){return"standard"===this.edition}get isBimEdition(){return"bim"===this.edition}guardedLocalStorage(d,f){try{if(void 0===f){const a=window.localStorage.getItem(d);return null===a?void 0:a}window.localStorage.setItem(d,f)}catch(a){console.error("Failed to access your browsers local storage. Is your local database corrupted?")}}};t(83531)},50725:(te,M,t)=>{t(30121),t(67285),t(5222),t(47939),t(20302),t(84906),t(84236),t(76213),t(89265),t(80146),t(78915),t(96024),t(84818),t(83305),t(14540),t(66732),t(56192),t(77729),t(39541),t(41250),t(12305),t(32198),t(95321)},60419:(te,M,t)=>{"use strict";t.d(M,{b:()=>h});var n=t(79441),e=t(43155),p=t(2316);class h{constructor(){this.actions=new n.xQ,this.actions$=this.actions.asObservable()}ofType(i){return this.actions$.pipe((0,e.l)(i))}dispatch(i){this.actions.next(i)}}h.\u0275fac=function(i){return new(i||h)},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})},88826:(te,M,t)=>{"use strict";t.d(M,{v:()=>y});var n=t(3786),e=t(53882),p=t(19100),h=t(30400),c=t(98636),i=t(18293),l=t(33927),r=t(96725);let d=class extends p.cf{constructor(){super((0,r.cq)())}};d=(0,n.gn)([(0,p.yC)({name:"attachments"}),(0,n.w6)("design:paramtypes",[])],d);var f=t(36293),a=t(76825),m=t(48249),v=t(96617),C=t(84699),u=t(12877),k=t(69795),x=t(29161),b=t(2316);class y extends k.o{requireCollection(E){this.store.getValue().collections[E]||this.fetchAttachments(E).subscribe()}fetchAttachments(E){return this.http.get(E).pipe((0,c.b)(T=>(0,r.V7)(this.store,T,E)),(0,i.K)(T=>{throw this.toastService.addError(T),T}))}removeAttachment(E,T){const O=new e.WM({"Content-Type":"application/json"});return this.http.delete(T._links.delete.href,{withCredentials:!0,headers:O}).pipe((0,c.b)(()=>(0,r.sS)(this.store,T.id,E)),(0,i.K)(I=>{throw this.toastService.addError(I),I}))}attachFiles(E,T){const O=y.getAttachmentsSelfLink(E)||C.m,I=this.getUploadTarget(E),Z=!!this.getDirectUploadLink(E);return this.addAttachments(O,I,T,Z)}addAttachments(E,T,O,I=!1){return this.uploadAttachments(T,O,I).pipe((0,c.b)(Z=>{(0,p.Y0)(()=>{this.store.add(Z),this.store.update(({collections:j})=>{var B;return{collections:Object.assign(Object.assign({},j),{[E]:Object.assign(Object.assign({},j[E]),{ids:((null===(B=j[E])||void 0===B?void 0:B.ids)||[]).concat(Z.map(J=>J.id))})})}})})}))}uploadAttachments(E,T,O){const{uploads:I,finished:Z}=O?this.directFileUploadService.uploadAndMapResponse(E,T):this.fileUploadService.uploadAndMapResponse(E,T),j=this.I18n.t("js.label_upload_notification"),B=this.toastService.addAttachmentUpload(j,I);return(0,h.D)(Z).pipe((0,c.b)(()=>{setTimeout(()=>this.toastService.remove(B),700)}),(0,l.U)(J=>J.map(({response:R})=>R.$source)),(0,i.K)(J=>{throw this.toastService.addError(J),J}))}getUploadTarget(E){return this.getDirectUploadLink(E)||y.getAttachmentsSelfLink(E)||this.apiV3Service.attachments.path}getDirectUploadLink(E){const T=E.$links;return T.prepareAttachment?T.prepareAttachment.href:(0,C.Z)(E)?this.configurationService.prepareAttachmentURL:null}static getAttachmentsSelfLink(E){const T=E.attachments;return(null==T?void 0:T.href)||null}createStore(){return new d}basePath(){return this.apiV3Service.attachments.path}}y.\u0275fac=function(){let P;return function(T){return(P||(P=b.n5z(y)))(T||y)}}(),y.\u0275prov=b.Yz7({token:y,factory:y.\u0275fac}),(0,n.gn)([(0,x.W)(),(0,n.w6)("design:type",v.D)],y.prototype,"I18n",void 0),(0,n.gn)([(0,x.W)(),(0,n.w6)("design:type",a.r)],y.prototype,"fileUploadService",void 0),(0,n.gn)([(0,x.W)(),(0,n.w6)("design:type",m.c)],y.prototype,"directFileUploadService",void 0),(0,n.gn)([(0,x.W)(),(0,n.w6)("design:type",u.e)],y.prototype,"configurationService",void 0),(0,n.gn)([(0,x.W)(),(0,n.w6)("design:type",f.kl)],y.prototype,"toastService",void 0)},41599:(te,M,t)=>{"use strict";t.d(M,{a:()=>m});var n=t(3786),e=t(79902),p=t(33927),h=t(18293),c=t(36293),i=t(96725),l=t(19100);let r=class extends l.cf{constructor(){super((0,i.cq)())}};r=(0,n.gn)([(0,l.yC)({name:"capabilities"}),(0,n.w6)("design:paramtypes",[])],r);var d=t(69795),f=t(29161),a=t(2316);class m extends d.o{require$(C){const u=(0,i.ZU)(C);return this.collectionExists(u)||this.collectionLoading(u)?this.loadedCollection(u):this.fetchCapabilities(C).pipe((0,e.w)(()=>this.loadedCollection(u)))}loadedCapabilities$(C){return this.query.selectAll().pipe((0,p.U)(u=>u.filter(k=>k._links.context.href.endsWith(`/${C}`))))}fetchCapabilities(C){return this.fetchCollection(C).pipe((0,h.K)(u=>{throw this.toastService.addError(u),u}))}createStore(){return new r}basePath(){return this.apiV3Service.capabilities.path}}m.\u0275fac=function(){let v;return function(u){return(v||(v=a.n5z(m)))(u||m)}}(),m.\u0275prov=a.Yz7({token:m,factory:m.\u0275fac}),(0,n.gn)([(0,f.W)(),(0,n.w6)("design:type",c.kl)],m.prototype,"toastService",void 0)},96725:(te,M,t)=>{"use strict";t.d(M,{n:()=>i,cq:()=>l,ZU:()=>r,wY:()=>d,mp:()=>f,V7:()=>a,sS:()=>m,zv:()=>C});var n=t(19100),e=t(73726),p=t(10190),h=t(202);function i(u){return{ids:u._embedded.elements.map(k=>k.id)}}function l(){return{collections:{},loadingCollections:{}}}function r(u){return(0,e.g)(u)}function d(u,k){u.update(({loadingCollections:x})=>({loadingCollections:Object.assign(Object.assign({},x),{[k]:!0})}))}function f(u,k){u.update(({loadingCollections:x})=>({loadingCollections:(0,h.filter)(x,(b,y)=>y!==k)}))}function a(u,k,x){const{elements:b}=k._embedded,y=(null==b?void 0:b.map(P=>P.id))||[];(0,n.Y0)(()=>{b&&b.length>0&&u.upsertMany(b),u.update(({collections:P})=>({collections:Object.assign(Object.assign({},P),{[x]:{ids:y}})}))})}function m(u,k,x){(0,n.Y0)(()=>{u.remove(k),u.update(({collections:b})=>{var y;return{collections:Object.assign(Object.assign({},b),{[x]:Object.assign(Object.assign({},b[x]),{ids:((null===(y=b[x])||void 0===y?void 0:y.ids)||[]).filter(P=>P!==k)})})}})})}function C(u){const k=u._embedded.elements.map(x=>Object.assign(Object.assign({},x),{id:(0,p.Z)(x._links.self.href)}));return Object.assign(Object.assign({},u),{_embedded:Object.assign(Object.assign({},u._embedded),{elements:k})})}},46934:(te,M,t)=>{"use strict";t.d(M,{s:()=>a});var n=t(79902),e=t(33927),p=t(98636),h=t(8117),c=t(96725),i=t(3786),l=t(19100);let r=class extends l.cf{constructor(){super((0,c.cq)())}};r=(0,i.gn)([(0,l.yC)({name:"weekdays"}),(0,i.w6)("design:paramtypes",[])],r);var d=t(69795),f=t(2316);class a extends d.o{require(){return this.query.selectHasCache().pipe((0,n.w)(v=>v?h.E:this.fetchWeekdays()),(0,n.w)(()=>this.query.selectAll()))}fetchWeekdays(){return this.http.get(this.basePath()).pipe((0,e.U)(C=>(0,c.zv)(C)),(0,p.b)(C=>(0,c.V7)(this.store,C,"all")))}createStore(){return new r}basePath(){return this.apiV3Service.days.week.path}}a.\u0275fac=function(){let m;return function(C){return(m||(m=f.n5z(a)))(C||a)}}(),a.\u0275prov=f.Yz7({token:a,factory:a.\u0275fac})},44838:(te,M,t)=>{"use strict";t.d(M,{b:()=>i,B:()=>l});t(43887);var p=t(3352),h=t(18511);const c=Symbol("EffectHandlers");function i(r){return class extends r{constructor(...d){super(...d),this.serviceDestroyed=!1;const f=r.prototype[c];f&&f.forEach((a,m)=>{(0,p.qu)(`[${r.name}] Subscribing to effect ${m}`),this.actions$.ofType(a.action).pipe((0,h.o)(()=>!this.serviceDestroyed)).subscribe(v=>{try{a.callback.call(this,v)}catch(C){console.error(`Error thrown in effect callback ${m}: ${C}`)}})})}ngOnDestroy(){this.serviceDestroyed=!0,super.ngOnDestroy&&super.ngOnDestroy()}}}function l(r){return(d,f,a)=>{const m=d;m[c]||(m[c]=new Map),m[c].set(f,{action:r,callback:a.value})}}},92144:(te,M,t)=>{"use strict";t.d(M,{s:()=>x});var n=t(3786),e=t(19100),p=t(53882),h=t(30400),c=t(98636),i=t(79902),l=t(43084),r=t(85816),d=t(11045),f=t(36293),a=t(96725);let m=class extends e.cf{constructor(){super((0,a.cq)())}};m=(0,n.gn)([(0,e.yC)({name:"file_links"}),(0,n.w6)("design:paramtypes",[])],m);var v=t(69795),C=t(29161),u=t(10190),k=t(2316);class x extends v.o{updateCollectionsForWorkPackage(y){this.http.get(y).pipe((0,c.b)(P=>(0,a.V7)(this.store,P,y)),(0,i.w)(P=>(0,h.D)(P._embedded.elements)),(0,l.v)(P=>P._links.storage.href,P=>P),(0,r.zg)(P=>{const E={storage:P.key,fileLinks:[]};return P.pipe((0,d.u)((T,O)=>(T.fileLinks=[...T.fileLinks,O],T),E))})).subscribe(P=>{const E=(0,u.Z)(P.storage),T=`${y}?filters=[{"storage":{"operator":"=","values":["${E}"]}}]`,O={_embedded:{elements:P.fileLinks}};(0,a.V7)(this.store,O,T)},this.toastAndThrow.bind(this))}createStore(){return new m}remove(y,P){if(!P._links.delete)return;const E=new p.WM({"Content-Type":"application/json"});this.http.delete(P._links.delete.href,{withCredentials:!0,headers:E}).subscribe(()=>(0,a.sS)(this.store,P.id,y),this.toastAndThrow.bind(this))}addFileLinks(y,P,E,T){const O=T.map(I=>({originData:{id:I.id,name:I.name,mimeType:I.mimeType,size:I.size,createdAt:I.createdAt,lastModifiedAt:I.lastModifiedAt,createdByName:I.createdByName,lastModifiedByName:I.lastModifiedByName},_links:{storage:E}}));this.http.post(P,{_type:"Collection",_embedded:{elements:O}}).subscribe(I=>{(0,e.Y0)(()=>{const Z=I._embedded.elements;this.store.add(Z),this.store.update(({collections:j})=>{var B;return{collections:Object.assign(Object.assign({},j),{[y]:Object.assign(Object.assign({},j[y]),{ids:((null===(B=j[y])||void 0===B?void 0:B.ids)||[]).concat(Z.map(J=>J.id))})})}})})},this.toastAndThrow.bind(this))}basePath(){return this.apiV3Service.file_links.path}toastAndThrow(y){throw this.toastService.addError(y),y}}x.\u0275fac=function(){let b;return function(P){return(b||(b=k.n5z(x)))(P||x)}}(),x.\u0275prov=k.Yz7({token:x,factory:x.\u0275fac}),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",f.kl)],x.prototype,"toastService",void 0)},24782:(te,M,t)=>{"use strict";t.d(M,{Z:()=>n});const n=100},78509:(te,M,t)=>{"use strict";t.d(M,{L5:()=>e,A6:()=>p,vw:()=>h,$v:()=>c});var n=t(87916);const e=(0,n.aD)("[IAN] Mark notifications as read",(0,n.NQ)()),p=(0,n.aD)("[IAN] Notifications were marked as read",(0,n.NQ)()),h=(0,n.aD)("[IAN] The backend sent a notification count that was higher than the last known",(0,n.NQ)()),c=(0,n.aD)("[IAN] The notification center updated the notification list without a full page refresh",(0,n.NQ)())},31909:(te,M,t)=>{"use strict";t.d(M,{W:()=>m});var n=t(3786),e=t(98636),p=t(78509),h=t(44838),c=t(60419),i=t(19100),l=t(96725);let r=class extends i.cf{constructor(){super((0,l.cq)())}};r=(0,n.gn)([(0,i.yC)({name:"in-app-notifications"}),(0,n.w6)("design:paramtypes",[])],r);var d=t(69795),f=t(29161),a=t(2316);let m=class extends d.o{update(C,u){this.store.update(C,u)}markAsRead(C){return this.apiV3Service.notifications.markRead(C).pipe((0,e.b)(()=>{this.store.update(C,{readIAN:!0})}))}markNotificationsAsRead(C){this.markAsRead(C.notifications).subscribe(()=>this.actions$.dispatch((0,p.A6)(C)))}createStore(){return new r}basePath(){return this.apiV3Service.notifications.path}};m.\u0275fac=function(){let v;return function(u){return(v||(v=a.n5z(m)))(u||m)}}(),m.\u0275prov=a.Yz7({token:m,factory:m.\u0275fac}),(0,n.gn)([(0,f.W)(),(0,n.w6)("design:type",c.b)],m.prototype,"actions$",void 0),(0,n.gn)([(0,h.B)(p.L5),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0]),(0,n.w6)("design:returntype",void 0)],m.prototype,"markNotificationsAsRead",null),m=(0,n.gn)([h.b],m)},63863:(te,M,t)=>{"use strict";function n(e){return void 0!==e}t.d(M,{Z:()=>n})},96457:(te,M,t)=>{"use strict";t.d(M,{P:()=>v});var n=t(3786),e=t(98636),p=t(18293),h=t(19100),c=t(36293),i=t(96725),l=t(44838),r=t(60419);let d=class extends h.cf{constructor(){super((0,i.cq)())}};d=(0,n.gn)([(0,h.yC)({name:"principals"}),(0,n.w6)("design:paramtypes",[])],d);var f=t(69795),a=t(29161),m=t(2316);let v=class extends f.o{fetchUser(u){return this.http.get(this.apiV3Service.users.id(u).path).pipe((0,e.b)(k=>{(0,h.Y0)(()=>{this.store.upsertMany([k])})}),(0,p.K)(k=>{throw this.toastService.addError(k),k}))}fetchPrincipals(u){const k=(0,i.ZU)(u);return this.http.get(this.basePath()+k).pipe((0,e.b)(x=>(0,i.V7)(this.store,x,k)),(0,p.K)(x=>{throw this.toastService.addError(x),x}))}createStore(){return new d}basePath(){return this.apiV3Service.principals.path}};v.\u0275fac=function(){let C;return function(k){return(C||(C=m.n5z(v)))(k||v)}}(),v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac}),(0,n.gn)([(0,a.W)(),(0,n.w6)("design:type",r.b)],v.prototype,"actions$",void 0),(0,n.gn)([(0,a.W)(),(0,n.w6)("design:type",c.kl)],v.prototype,"toastService",void 0),v=(0,n.gn)([l.b],v)},44040:(te,M,t)=>{"use strict";t.d(M,{D:()=>r});var n=t(98636),e=t(69795),p=t(3786),h=t(19100),c=t(96725);let i=class extends h.cf{constructor(){super((0,c.cq)())}};i=(0,p.gn)([(0,h.yC)({name:"projects"}),(0,p.w6)("design:paramtypes",[])],i);var l=t(2316);class r extends e.o{update(f){return this.http.get(f).pipe((0,n.b)(a=>{this.store.upsertMany([a])}))}createStore(){return new i}basePath(){return this.apiV3Service.projects.path}}r.\u0275fac=function(){let d;return function(a){return(d||(d=l.n5z(r)))(a||r)}}(),r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac})},69795:(te,M,t)=>{"use strict";t.d(M,{o:()=>k});var n=t(19100),e=t(79902),p=t(9170),h=t(33927),c=t(98636),i=t(71435),l=t(18293),r=t(96725),d=t(202),a=t(63863),m=t(33276),v=t(36293),C=t(2316),u=t(53882);class k{constructor(b,y,P,E){this.injector=b,this.http=y,this.apiV3Service=P,this.toastService=E,this.store=this.createStore(),this.query=new n.Gv(this.store)}require(b){const y=(0,r.ZU)(b);return this.collectionExists(y)||this.collectionLoading(y)?this.loadedCollection(y):this.fetchCollection(b).pipe((0,e.w)(()=>this.loadedCollection(y)))}collection(b){return this.collectionState(b).pipe((0,e.w)(y=>this.query.selectMany((null==y?void 0:y.ids)||[])))}loadedCollection(b){return this.collectionState(b).pipe((0,p.h)(y=>!!y),(0,e.w)(y=>this.query.selectMany(y.ids)))}collectionState(b){return this.query.select().pipe((0,h.U)(y=>y.collections[b]))}lookup(b){return this.query.selectEntity(b).pipe((0,p.h)(a.Z))}lookupMany(b){return this.query.selectMany(b)}exists(b){return this.query.hasEntity(b)}collectionExists(b){const y="string"==typeof b?b:(0,r.ZU)(b);return!!this.query.getValue().collections[y]}collectionLoading(b){const y="string"==typeof b?b:(0,r.ZU)(b);return!0===this.query.getValue().loadingCollections[y]}clear(b){this.store.update(({collections:y})=>({collections:(0,d.omit)(y,b)}))}update(b,y){this.store.update(b,y)}fetchResults(b){return this.fetchCollection(b).pipe((0,h.U)(y=>y._embedded.elements))}fetchCollection(b){const y="string"==typeof b?b:(0,r.ZU)(b);return(0,r.wY)(this.store,y),this.http.get(this.basePath()+y).pipe((0,c.b)(P=>(0,r.V7)(this.store,P,y)),(0,i.x)(()=>(0,r.mp)(this.store,y)),(0,l.K)(P=>{throw this.handleCollectionLoadingError(P,y),P}))}handleCollectionLoadingError(b,y){this.toastService.addError(b)}}k.\u0275fac=function(b){return new(b||k)(C.LFG(C.zs3),C.LFG(u.eN),C.LFG(m.T),C.LFG(v.kl))},k.\u0275prov=C.Yz7({token:k,factory:k.\u0275fac})},82187:(te,M,t)=>{"use strict";t.d(M,{X:()=>d});var n=t(98636),e=t(33927),p=t(69795),h=t(3786),c=t(19100),i=t(96725);let l=class extends c.cf{constructor(){super((0,i.cq)())}};l=(0,h.gn)([(0,c.yC)({name:"storage-files",resettable:!0}),(0,h.w6)("design:paramtypes",[])],l);var r=t(2316);class d extends p.o{createStore(){return new l}files(a){return this.collectionExists(a.href)?this.collection(a.href):this.http.get(a.href).pipe((0,n.b)(m=>{(0,i.V7)(this.store,m,a.href)}),(0,e.U)(m=>m._embedded.elements))}reset(){this.store.reset()}basePath(){return this.apiV3Service.storages.files.path}}d.\u0275fac=function(){let f;return function(m){return(f||(f=r.n5z(d)))(m||d)}}(),d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac})},4018:(te,M,t)=>{"use strict";t.d(M,{l:()=>r});var n=t(42720),e=t(3786),p=t(19100),h=t(96725);let c=class extends p.cf{constructor(){super((0,h.cq)())}};c=(0,e.gn)([(0,p.yC)({name:"storages"}),(0,e.w6)("design:paramtypes",[])],c);var i=t(69795),l=t(2316);class r extends i.o{updateCollection(f,a){(0,n.D)(a.map(m=>this.http.get(m.href))).subscribe(m=>{const v={_embedded:{elements:m}};(0,h.V7)(this.store,v,f)})}createStore(){return new c}basePath(){return this.apiV3Service.storages.path}}r.\u0275fac=function(){let d;return function(a){return(d||(d=l.n5z(r)))(a||r)}}(),r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac})},51705:(te,M,t)=>{"use strict";t.d(M,{s:()=>f});var n=t(3786),e=t(44838),p=t(60419),h=t(19100),c=t(96725);let i=class extends h.cf{constructor(){super((0,c.cq)())}};i=(0,n.gn)([(0,h.yC)({name:"views"}),(0,n.w6)("design:paramtypes",[])],i);var l=t(69795),r=t(29161),d=t(2316);let f=class extends l.o{createStore(){return new i}basePath(){return this.apiV3Service.views.path}};f.\u0275fac=function(){let a;return function(v){return(a||(a=d.n5z(f)))(v||f)}}(),f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac}),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",p.b)],f.prototype,"actions$",void 0),f=(0,n.gn)([e.b],f)},87853:(te,M,t)=>{"use strict";t.d(M,{G:()=>p});var n=t(14808),e=t(79441);class p extends n.Ui{constructor(){super(...arguments),this.name="MainStore",this.projects=(0,n.r9)(),this.workPackages=(0,n.r9)(),this.posts=(0,n.r9)(),this.schemas=(0,n.r9)(),this.types=(0,n.r9)(),this.statuses=(0,n.r9)(),this.timeEntries=(0,n.r9)(),this.versions=(0,n.r9)(),this.users=(0,n.r9)(),this.placeholderUsers=(0,n.r9)(),this.roles=(0,n.r9)(),this.changes={queries:new e.xQ},this.additional={}}forType(c){let i=this[c]||this.additional[c];return i||(i=this.additional[c]=(0,n.r9)()),i}forResource(c){const i=`${_.camelCase(c._type)}s`,l=this.forType(i);return l&&l.get(c.id)}add(c,i){this.additional[c]=i}}},67731:(te,M,t)=>{"use strict";t.d(M,{m:()=>e,V:()=>p});var n=t(2316);const e="op-backlogs-page";class p{ngOnInit(){document.getElementById("projected-content").hidden=!1}}p.\u0275fac=function(c){return new(c||p)},p.\u0275cmp=n.Xpm({type:p,selectors:[["op-backlogs-page"]],decls:0,vars:0,template:function(c,i){},styles:['@charset "UTF-8";#rb .meta{display:none}#rb #helpers{display:none}#rb .editors{display:none}#rb .ui-dialog .editor{display:block}.ui-dialog .ui-dialog-title{float:left;margin-right:0}.ui-dialog.ui-widget-content{border:none}.ui-dialog .ui-dialog-buttonpane.ui-widget-content{border:none}.subject-input{width:99%}th{font-weight:bold}#toolbar .links{display:none!important}.jqplot-target{position:relative;color:#666;font-family:"Trebuchet MS",Arial,Helvetica,sans-serif;font-size:1em}.jqplot-axis{font-size:.75em}.jqplot-xaxis{margin-top:10px}.jqplot-x2axis{margin-bottom:10px}.jqplot-yaxis{margin-right:10px}.jqplot-y2axis,.jqplot-y3axis,.jqplot-y4axis,.jqplot-y5axis,.jqplot-y6axis,.jqplot-y7axis,.jqplot-y8axis,.jqplot-y9axis{margin-left:10px;margin-right:10px}.jqplot-axis-tick,.jqplot-xaxis-tick,.jqplot-yaxis-tick,.jqplot-x2axis-tick,.jqplot-y2axis-tick,.jqplot-y3axis-tick,.jqplot-y4axis-tick,.jqplot-y5axis-tick,.jqplot-y6axis-tick,.jqplot-y7axis-tick,.jqplot-y8axis-tick,.jqplot-y9axis-tick{position:absolute}.jqplot-xaxis-tick{top:0;left:15px;vertical-align:top}.jqplot-x2axis-tick{bottom:0;left:15px;vertical-align:bottom}.jqplot-yaxis-tick{right:0;top:15px;text-align:right}.jqplot-y2axis-tick,.jqplot-y3axis-tick,.jqplot-y4axis-tick,.jqplot-y5axis-tick,.jqplot-y6axis-tick,.jqplot-y7axis-tick,.jqplot-y8axis-tick,.jqplot-y9axis-tick{left:0;top:15px;text-align:left}.jqplot-xaxis-label{margin-top:10px;font-size:11pt;position:absolute}.jqplot-x2axis-label{margin-bottom:10px;font-size:11pt;position:absolute}.jqplot-yaxis-label{margin-right:10px;font-size:11pt;position:absolute}.jqplot-y2axis-label,.jqplot-y3axis-label,.jqplot-y4axis-label,.jqplot-y5axis-label,.jqplot-y6axis-label,.jqplot-y7axis-label,.jqplot-y8axis-label,.jqplot-y9axis-label{font-size:11pt;position:absolute}table.jqplot-table-legend,table.jqplot-cursor-legend{background-color:#fff9;border:1px solid #ccc;position:absolute;font-size:.75em}td.jqplot-table-legend{vertical-align:middle}td.jqplot-table-legend>div{border:1px solid #ccc;padding:.2em}div.jqplot-table-legend-swatch{width:0;height:0;border-top-width:.35em;border-bottom-width:.35em;border-left-width:.6em;border-right-width:.6em;border-top-style:solid;border-bottom-style:solid;border-left-style:solid;border-right-style:solid}.jqplot-title{top:0;left:0;padding-bottom:.5em;font-size:1.2em}table.jqplot-cursor-tooltip{border:1px solid #ccc;font-size:.75em}.jqplot-cursor-tooltip{border:1px solid #ccc;font-size:.75em;white-space:nowrap;background:rgba(208,208,208,.5);padding:1px}.jqplot-highlighter-tooltip{border:1px solid #ccc;font-size:.75em;white-space:nowrap;background:rgba(208,208,208,.5);padding:1px}.jqplot-point-label{font-size:.75em}td.jqplot-cursor-legend-swatch{vertical-align:middle;text-align:center}div.jqplot-cursor-legend-swatch{width:1.2em;height:.7em}.score{text-align:center;width:1.5em;font-size:large;display:inline-block}.score_0{background-color:red}.score_1{background-color:#ff5300}.score_2{background-color:#ff8100}.score_3{background-color:#ffa100}.score_4{background-color:#fb0}.score_5{background-color:#ffd300}.score_6{background-color:#ffec00}.score_7{background-color:#e9fb00}.score_8{background-color:#b1f100}.score_9{background-color:#74e600}.score_10{background-color:#0c0}#rb #backlogs_container{width:100%;display:flex;flex-wrap:wrap;justify-content:space-between}#rb #owner_backlogs_container{min-width:420px;order:2;width:49%;flex:0 0 49%}#rb #sprint_backlogs_container{min-width:420px;width:49%;flex:0 0 49%;min-height:230px}#rb #owner_backlogs_container .backlog .header>.add_new_story{height:28px;line-height:31px;padding:0;position:absolute;right:10px;text-align:right;top:1px;width:100px}#rb #backlogs_container .backlog{border:1px solid #E4E4E4;display:block;margin:0 0 10px;width:100%}.controller-rb_master_backlogs .action-index #content{padding-bottom:180px}#rb #backlogs_container .backlog .header{background-color:#eee;height:30px;position:relative;width:100%}#rb .backlog .header .menu{border-right:1px solid #E4E4E4;cursor:pointer;height:30px;overflow:visible;position:absolute;top:0;right:0;width:30px}#rb .backlog .header .menu .icon-context{position:absolute;top:7px;left:12px}#rb .backlog .header .menu .icon-context:before{padding:0}#rb .backlog .header .menu .icon-context.open+.items{display:block}#rb .backlog .header .menu .items{display:none;background-color:#eee;border:1px solid #E4E4E4;position:absolute;top:30px;right:-2px;list-style:none;margin:0;padding:0;z-index:1000}#rb .backlog .header .menu .item{display:block;width:160px;height:2rem;font-size:.9rem;text-align:left;text-decoration:none;vertical-align:middle;overflow:hidden;white-space:nowrap}#rb .backlog .header .menu .item.hover,#rb .backlog .header .menu .item:hover{background-color:#999}#rb .backlog .header .menu .item a{display:block;height:100%;padding:6px;width:100%}#rb .backlog .header .menu .item.hover a,#rb .backlog .header .menu .item:hover a{color:#fff;text-decoration:none}#rb #backlogs_container .backlog .header .velocity{height:28px;line-height:31px;padding:0 3px 0 9px;position:absolute;right:25px;text-align:right;top:0px;width:32px}#rb #backlogs_container .backlog .header .toggler{font-family:"openproject-icon-font";height:30px;line-height:31px;padding:0;position:absolute;left:0;top:0;width:23px;cursor:pointer}#rb #backlogs_container .backlog .header .toggler:before{position:absolute;left:6px;top:10px}#rb #backlogs_container .backlog .header .toggler.closed:before{position:absolute;left:6px;top:10px}#rb #backlogs_container .backlog .header .toggler:hover{cursor:pointer;background-color:#d8d8d8}#rb #backlogs_container .backlog .sprint{background-color:transparent;cursor:pointer;display:block;height:29px;width:auto;margin-left:30px;margin-right:50px}#rb #backlogs_container .backlog .sprint.error.icon-bug{background:none;text-align:center}#rb #backlogs_container .backlog .sprint.error.icon-bug:before{position:absolute;color:red}#rb #backlogs_container .backlog .sprint .id,#rb #backlogs_container .backlog .sprint .status{display:none}#rb #backlogs_container .backlog .sprint .name{line-height:2rem;font-weight:bold;overflow:hidden;white-space:nowrap;margin-left:.5em}#rb #backlogs_container .backlog .sprint .start_date,#rb #backlogs_container .backlog .sprint .effective_date{float:right;height:28px;line-height:2rem;width:6.5em;margin-left:.5em}#rb #backlogs_container .backlog .stories{list-style:none;min-height:2rem;margin:0;padding:0;z-index:500;overflow-y:auto;overflow-x:hidden}#rb #backlogs_container .backlog .stories.closed{display:none}#rb #backlogs_container .backlog .stories .error.icon.icon-bug{text-align:left}#rb #backlogs_container .stories .story{cursor:move;display:block;font-size:.9rem;margin:0;overflow:hidden;position:relative;width:100%}#rb #backlogs_container .stories .story.odd{background-color:#f6f7f8}#rb #backlogs_container .stories .story.even{background-color:#fff}#rb #backlogs_container .stories .story.error.icon-bug{background:none;text-align:center}#rb #backlogs_container .stories .story.error.icon-bug:before{position:absolute;color:red;pointer-events:none}#rb #backlogs_container .stories .story.hover,#rb #backlogs_container .stories .story:hover{background-color:#fef8a8}#rb #backlogs_container .stories .story.closed{text-decoration:line-through}#rb #backlogs_container .stories .story .id{float:left;margin-left:1em;margin-right:1em;padding:5px 2px 4px;width:4em;text-align:right;white-space:nowrap}#rb #backlogs_container .stories .story .type_id .t{float:left;padding:5px 2px 4px;text-align:right;white-space:nowrap}#rb #backlogs_container .stories .story .subject{overflow:hidden;margin-left:4em;padding:5px 2px 4px;white-space:nowrap;min-height:1em}#rb #backlogs_container .stories .story .status_id{float:right;padding:5px 2px 4px;margin-left:1em;width:68px}#rb #backlogs_container .stories .story .story_points{float:right;padding:5px 1rem 4px 2px;width:3.5rem;min-height:14px;height:2rem;text-align:center}#rb #backlogs_container .stories .story .type_id .v,#rb #backlogs_container .stories .story .id .v,#rb #backlogs_container .stories .story .status_id .v,#rb #backlogs_container .stories .story .version_id,#rb #backlogs_container .stories .story .higher_item_id{display:none}.rb_dialog .burndown_chart{margin-top:20px;margin-bottom:20px;margin-left:20px}.rb_dialog #charts{overflow:hidden}.rb_dialog #charts h3{border:0px}.rb_dialog #charts fieldset.burndown_control{padding-left:10px;border:none}.rb_dialog #charts .axislabel{font-weight:bold}#rb #backlogs_container .sprint.editing .editors,#rb #backlogs_container .sprint.editing>.editor{display:block}#rb #backlogs_container .sprint.editing label,#rb #backlogs_container .sprint.editing>*{display:none}#rb #backlogs_container .sprint.editing+.velocity,#rb #backlogs_container .sprint.editing+.add_new_story{display:none}#rb #backlogs_container .backlog .sprint.editing .editor{font-size:.9rem;line-height:1.5rem;height:30px;margin:0;padding:0}#rb #backlogs_container .backlog .sprint.editing .editor.name{min-width:15em;width:calc(100% - 2 * 85px - 10px)}#rb #backlogs_container .backlog .sprint.editing .editor.start_date,#rb #backlogs_container .backlog .sprint.editing .editor.effective_date{width:85px}#rb #backlogs_container .stories .story.editing>*,#rb #backlogs_container .stories .story.editing>.editors label{display:none}#rb #backlogs_container .stories .story.editing .editors{display:block}#rb #backlogs_container .stories .story.editing select,#rb #backlogs_container .stories .story.editing input{display:inline-block;float:none;margin:5px 3px 4px 2px;font-size:.8rem;line-height:inherit}#rb #backlogs_container .stories .story.editing .type_id.editor{width:15%;max-width:140px}#rb #backlogs_container .stories .story.editing .subject.editor{width:55%}#rb #backlogs_container .stories .story.editing .status_id.editor{width:15%;float:right}#rb #backlogs_container .stories .story.editing .story_points.editor{float:right;width:10%}.controller-rb_master_backlogs.action-show #main,.controller-rb_master_backlogs.action-show #content,.controller-rb_master_backlogs.action-show #rb #backlogs_container .backlog .stories{overflow:visible}.controller-rb_master_backlogs.action-show div.calendar{z-index:10000}.backlog{font-size:.9rem}.controller-rb_taskboards.action-show #main{overflow:visible}#rb .task{color:#484848;line-height:inherit;white-space:inherit}#rb #taskboard{overflow-x:auto}#rb #taskboard #assigned_to_id_options{display:none}#rb #taskboard .swimlane{min-width:107px;padding:5px;width:107px}#rb #taskboard #board_header{background-color:#ebebeb;border:1px solid #CCCCCC;margin-bottom:0;margin-right:10px}#rb #taskboard #board_header td{background-color:#ebebeb;border-right:1px dotted #CFCFCF;color:#000;font-weight:bold;text-align:center;vertical-align:middle;padding-top:0;padding-bottom:0;line-height:30px}#rb #taskboard #board_header td:first-child{min-width:241px;width:241px}#rb #taskboard .board{background-color:#fcfcfc;border:1px solid #CCCCCC;border-top:none;margin-right:10px;table-layout:fixed;border-collapse:collapse;empty-cells:show}#rb #taskboard .board tr:hover{background-color:#fff}#rb #taskboard .board td{border-right:1px dotted #CFCFCF;border-bottom:1px dotted #CFCFCF;vertical-align:top}#rb #taskboard .board td:first-child{min-width:210px;padding:5px;width:210px}#rb #taskboard .board tr:last-child td{border-bottom:none}#rb #taskboard .board .add_new{margin:0;min-width:30px;padding:0;text-align:center;vertical-align:middle;width:30px}#rb #taskboard .board .add_new.clickable:hover{cursor:pointer;background-color:#ffc}#rb #taskboard .story,#rb #taskboard .label_sprint_impediments{background-color:#f8f6a5;border:none;display:block;float:left;min-height:84px;margin:5px;padding:5px;position:relative;width:190px}#rb #taskboard .story .subject{height:42px;line-height:13px;margin-top:0;overflow:hidden;padding:2px;width:180px}#rb #taskboard .story.closed .subject{text-decoration:line-through}#rb #taskboard .work_package,#rb #taskboard .placeholder{background-color:#afafaf;border:none;cursor:move;display:block;float:left;font-size:10px;height:80px;padding:5px;margin:5px 0;position:relative;width:85px}#rb #taskboard .work_package.prevent_edit{cursor:default}#rb #taskboard .placeholder{background-color:#ff0;border:1px dashed #333300;height:78px;width:83px}#rb #taskboard .work_package.closed .subject.editable{text-decoration:line-through}#rb #taskboard .work_package .v{display:none}#rb #taskboard .work_package .remaining_hours.editable{border:2px solid #FFFFFF;background-color:#e00;bottom:-5px;color:#fff;font-size:9px;height:13px;padding-left:5px;padding-right:5px;position:absolute;right:-5px}#rb #taskboard .work_package .blocks,#rb #taskboard .work_package .remaining_hours.editable.empty{display:none}#rb #taskboard .work_package .indicator{display:none}#rb #taskboard .work_package.error .indicator{background:none;border:none}#rb #taskboard .work_package.error.icon-bug:before{position:absolute;top:30px;left:28px;color:red}#rb #taskboard .work_package .editors{display:none}.task_editor_dialog.ui-dialog .ui-widget-header{background:none;background-color:#fff;opacity:.5;filter:alpha(opacity=50)}.task_editor_dialog.ui-dialog .ui-dialog-title{float:right;margin-right:0;color:var(--body-font-color)}.task_editor_dialog.ui-dialog.ui-widget-content{background:none;border:none}.task_editor_dialog.ui-dialog.ui-widget-content .editor{color:var(--body-font-color)}.task_editor_dialog.ui-dialog .ui-dialog-buttonpane.ui-widget-content{background:none;background-color:none;border:none}.ui-dialog-titlebar-close{overflow:hidden}.dark #task_editor label{color:#fff}.light #task_editor label{color:#000}.dark div{color:#fff}.light div{color:#000}#task_editor label{display:block;font-size:11px;text-transform:capitalize;width:100%}#task_editor .editor{font-size:11px;margin-bottom:10px;width:100%}#task_editor .subject{height:65px;width:272px}#task_editor .remaining_hours,#task_editor .blocks{width:268px}#rb .compact .story,#rb .compact .label_sprint_impediments{height:15px}#rb .compact .story .subject{display:none}#rb .compact .work_package{height:21px;padding:0;width:21px}#rb .compact .work_package *{display:none}#rb .compact .placeholder{background-color:#ff0;border:1px dashed #333300;height:19px;width:19px}#rb #impediment_template,#rb #task_template{display:none}.story .story-bar{background-color:#fff;font-size:1rem-rem-calc(5px);opacity:.8;filter:alpha(opacity=80);overflow:hidden;padding-bottom:1px;padding-right:3px;text-align:right;width:180px;clear:both}.story .story-bar .id{float:right}.story .story-bar .status{float:left}.story,.label_sprint_impediments{font-size:1rem-rem-calc(3px)}.work_package .id{background-color:#fff;font-size:1rem-rem-calc(5px);opacity:.8;filter:alpha(opacity=80);overflow:hidden;padding-bottom:1px;padding-right:3px;text-align:right;width:75px}.work_package .id a{opacity:1;filter:alpha(opacity=100)}.work_package .editable:hover{background-color:transparent}.work_package .subject.editable{font-size:1rem-rem-calc(3px);height:42px;line-height:13px;margin-top:0;overflow:hidden;padding:2px;width:81px}.story .story-footer .assigned_to_id{float:left;font-size:1rem-rem-calc(5px);width:85%;margin-top:4px;padding:0 2px 2px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.story .story-footer .story-points{margin-top:2px;float:right}.work_package .assigned_to_id.editable{float:left;font-size:1rem-rem-calc(5px);width:85%;margin-top:4px;padding:0 2px 2px}.work_package .assigned_to_id.editable .t{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#toolbar label[for=col_width_input]{padding-top:rem-calc(20px)}#toolbar #col_width_input{max-width:60px}.controller-rb_master_backlogs .ui-dialog-titlebar-close,.controller-rb_taskboards .ui-dialog-titlebar-close{display:none}.controller-rb_master_backlogs .ui-dialog,.controller-rb_taskboards .ui-dialog{background:#FFFFFF;border:1px solid #E4E4E4}\n'],encapsulation:2})},12084:(te,M,t)=>{"use strict";t.d(M,{y:()=>F});var n=t(49152);class e extends n.J{constructor(X,K,ie){super(K,ie),this.injector=X,this.id=ie}}class p extends n.D{constructor(X,K,ie,H){super(K,ie,H),this.injector=X,this.basePath=K,this.resource=H}id(X){return new(this.resource||e)(this.injector,this.path,X)}}var h=t(3786),c=t(53882),i=t(88361),l=t(45871),r=t(33927),d=t(18293),f=t(29161),a=t(51784);class m{constructor(X,K){this.injector=X,this.resourceClass=K}get(X,K,ie={}){const H={headers:ie,params:new c.LE({encoder:new a.c,fromObject:K}),withCredentials:!0,responseType:"json"};return this._request("get",X,H)}request(X,K,ie={},H={}){if("get"===X)return this.get(K,ie,H);const ee={body:ie||{},headers:H,withCredentials:!0,responseType:"json"};return this._request(X,K,ee)}_request(X,K,ie){return this.http.request(X,K,ie).pipe((0,r.U)(H=>this.deserialize(H)),(0,d.K)(H=>(console.error(`Failed to ${X} ${K}: ${H.name}`),(0,l._)(H))))}deserialize(X){return this.resourceClass?new i.r5(this.resourceClass).parse(X):X}}(0,h.gn)([(0,f.W)(),(0,h.w6)("design:type",c.eN)],m.prototype,"http",void 0);var v=t(63628),C=t(95571);let u=class{};(0,h.gn)([v.R,(0,h.w6)("design:type",Number)],u.prototype,"project_id",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",String)],u.prototype,"name",void 0),u=(0,h.gn)([C.O],u);var k=t(68118),x=t(2281);let b=class{};(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],b.prototype,"topic_actions",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],b.prototype,"topic_status",void 0),b=(0,h.gn)([C.O],b);let y=class{};(0,h.gn)([v.R,(0,h.w6)("design:type",String)],y.prototype,"guid",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",String)],y.prototype,"topic_type",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",String)],y.prototype,"topic_status",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",String)],y.prototype,"priority",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],y.prototype,"reference_links",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",String)],y.prototype,"title",void 0),(0,h.gn)([(0,v.R)({preserveNull:!0}),(0,h.w6)("design:type",Object)],y.prototype,"index",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],y.prototype,"labels",void 0),(0,h.gn)([(0,v.R)({deserializer:Y=>x(Y),serializer:Y=>Y.toISOString()}),(0,h.w6)("design:type",Object)],y.prototype,"creation_date",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",String)],y.prototype,"creation_author",void 0),(0,h.gn)([(0,v.R)({deserializer:Y=>x(Y),serializer:Y=>Y.toISOString()}),(0,h.w6)("design:type",Object)],y.prototype,"modified_date",void 0),(0,h.gn)([(0,v.R)({preserveNull:!0}),(0,h.w6)("design:type",Object)],y.prototype,"modified_author",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",String)],y.prototype,"assigned_to",void 0),(0,h.gn)([(0,v.R)({preserveNull:!0}),(0,h.w6)("design:type",Object)],y.prototype,"stage",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",String)],y.prototype,"description",void 0),(0,h.gn)([(0,v.R)({deserializer:Y=>x(Y),serializer:Y=>Y.format("YYYY-MM-DD")}),(0,h.w6)("design:type",Object)],y.prototype,"due_date",void 0),(0,h.gn)([v.R,(0,h.w6)("design:type",b)],y.prototype,"authorization",void 0),y=(0,h.gn)([C.O],y);class P extends e{constructor(){super(...arguments),this.bcfViewpointsService=new m(this.injector)}get(X={},K={}){return this.bcfViewpointsService.get(this.toPath(),X,K)}}class E extends e{constructor(){super(...arguments),this.bcfViewpointsService=new m(this.injector)}get(X={},K={}){return this.bcfViewpointsService.get(this.toPath(),X,K)}}class T extends e{constructor(){super(...arguments),this.bcfViewpointsService=new m(this.injector),this.selection=new P(this.injector,this.path,"selection"),this.visibility=new E(this.injector,this.path,"visibility")}get(X={},K={}){return this.bcfViewpointsService.get(this.toPath(),X,K)}delete(X={}){return this.bcfViewpointsService.request("delete",this.toPath(),{},X).pipe((0,r.U)(()=>{}))}}class O extends p{constructor(){super(...arguments),this.bcfViewpointService=new m(this.injector)}post(X){return this.bcfViewpointService.request("post",this.toPath(),X)}}class I extends e{constructor(){super(...arguments),this.bcfTopicService=new m(this.injector,y),this.comments=new p(this.injector,this.path,"comments"),this.viewpoints=new O(this.injector,this.path,"viewpoints",T)}get(X={},K={}){return this.bcfTopicService.get(this.toPath(),X,K)}}class Z extends p{constructor(X,K,ie){super(X,K,ie,I),this.injector=X,this.basePath=K,this.bcfTopicService=new m(this.injector,y)}get(X={},K={}){throw new Error("Not implemented")}post(X){return this.bcfTopicService.request("post",this.toPath(),X)}}let j=class{};(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],j.prototype,"topic_actions",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],j.prototype,"project_actions",void 0),(0,h.gn)([(0,k.g)(String),(0,h.w6)("design:type",Array)],j.prototype,"comment_actions",void 0),j=(0,h.gn)([C.O],j);class B extends e{constructor(){super(...arguments),this.bcfExtensionService=new m(this.injector,j)}get(X={},K={}){return this.bcfExtensionService.get(this.toPath(),X,K)}}class J extends e{constructor(){super(...arguments),this.bcfProjectService=new m(this.injector,u),this.topics=new Z(this.injector,this.path,"topics"),this.extensions=new B(this.injector,this.path,"extensions")}get(X={},K={}){return this.bcfProjectService.get(this.toPath(),X,K)}}var R=t(2316);class F{constructor(X){this.injector=X,this.bcfApiVersion="2.1",this.appBasePath=window.appBasePath||"",this.bcfApiBase=`${this.appBasePath}/api/bcf/${this.bcfApiVersion}`,this.projects=new p(this.injector,this.bcfApiBase,"projects",J)}parse(X){if(!X.startsWith(this.bcfApiBase))throw new Error(`Cannot parse ${X} into BCF resource.`);const K=X.replace(`${this.bcfApiBase}/`,"").split("/");let ie=this;for(let H=0;H<K.length;H++){const ee=K[H];if(ee in ie)ie=ie[ee];else{if(!(ie instanceof p))break;ie=ie.id(ee)}}return ie===this?void 0:ie}}F.\u0275fac=function(X){return new(X||F)(R.LFG(R.zs3))},F.\u0275prov=R.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"})},38998:(te,M,t)=>{"use strict";t.d(M,{L:()=>c});var n=t(3786),e=t(29161),p=t(47775),h=t(2316);class c{constructor(l){this.injector=l}}c.\u0275fac=function(l){return new(l||c)(h.LFG(h.zs3))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac}),(0,n.gn)([(0,e.W)(),(0,n.w6)("design:type",p.StateService)],c.prototype,"state",void 0)},51566:(te,M,t)=>{"use strict";t.d(M,{b:()=>p});var n=t(70233),e=t(2316);class p{constructor(c){this.pathHelper=c}projectImportIssuePath(c){return`${this.pathHelper.projectPath(c)}/issues/upload`}projectExportIssuesPath(c,i){return i?`${this.pathHelper.projectPath(c)}/work_packages.bcf?filters=${i}`:`${this.pathHelper.projectPath(c)}/work_packages.bcf`}snapshotPath(c){return`${c.href}/snapshot`}}p.\u0275fac=function(c){return new(c||p)(e.LFG(n.j))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac})},3412:(te,M,t)=>{"use strict";t.d(M,{V:()=>v});var n=t(3786),e=t(29161),p=t(12084),h=t(38998),c=t(33927),i=t(98636),l=t(79902),r=t(42720),d=t(81134),f=t(33276),a=t(10190),m=t(2316);class v{constructor(u){this.injector=u}getViewPointResource(u,k){const x=u.bcfViewpoints[k].href;return this.bcfApi.parse(x)}getViewPoint$(u,k){const x=this.getViewPointResource(u,k);return(0,r.D)({viewpoint:x.get(),selection:x.selection.get(),visibility:x.visibility.get()}).pipe((0,c.U)(({viewpoint:b,selection:y,visibility:P})=>{const E=b;return E.components={selection:y.selection,visibility:P.visibility},E}))}deleteViewPoint$(u,k){return this.getViewPointResource(u,k).delete().pipe((0,i.b)(()=>this.apiV3Service.work_packages.id(u).requireAndStream(!0)))}saveViewpoint$(u,k){const x=u.project.href,b=(0,a.Z)(x),y=this.setBcfTopic$(u),P=k?(0,d.of)(k):this.viewerBridge.getViewpoint$();return(0,r.D)({topicUUID:y,viewpoint:P}).pipe((0,l.w)(E=>this.bcfApi.projects.id(b).topics.id(E.topicUUID).viewpoints.post(E.viewpoint)),(0,i.b)(()=>this.apiV3Service.work_packages.id(u).requireAndStream(!0)))}setBcfTopic$(u){var k;if(this.topicUUID)return(0,d.of)(this.topicUUID);const x=null===(k=u.bcfTopic)||void 0===k?void 0:k.href;return(x?(0,d.of)(this.bcfApi.parse(x).id):this.createBcfTopic$(u)).pipe((0,c.U)(y=>(this.topicUUID=y,this.topicUUID)))}createBcfTopic$(u){const k=(0,a.Z)(u.project.href),x=u.convertBCF.payload;return this.bcfApi.projects.id(k).topics.post(x).pipe((0,c.U)(b=>(this.topicUUID=b.guid,this.topicUUID)))}}v.\u0275fac=function(u){return new(u||v)(m.LFG(m.zs3))},v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac}),(0,n.gn)([(0,e.W)(),(0,n.w6)("design:type",p.y)],v.prototype,"bcfApi",void 0),(0,n.gn)([(0,e.W)(),(0,n.w6)("design:type",h.L)],v.prototype,"viewerBridge",void 0),(0,n.gn)([(0,e.W)(),(0,n.w6)("design:type",f.T)],v.prototype,"apiV3Service",void 0)},70795:(te,M,t)=>{"use strict";t.d(M,{w:()=>de});var n=t(2316),e=t(21757),p=t(60169),h=t(60874),c=t(3786),i=t(55741),l=t(29161),r=t(51566);class d extends i.C{render(D,G){const V=this.resource.bcfViewpoints;if(V&&V.length>0){const me=V[0];D.innerHTML=`\n        <img src="${this.bcfPathHelper.snapshotPath(me)}" class="thumbnail">\n      `}else D.innerHTML=""}}(0,c.gn)([(0,l.W)(),(0,c.w6)("design:type",r.b)],d.prototype,"bcfPathHelper",void 0);var f=t(54364);class a{constructor(D){this.documentElement=D}get isBcfActivated(){return this.hasBodyClass("bcf-activated")}hasBodyClass(D){return this.documentElement.body.classList.contains(D)}}a.\u0275fac=function(D){return new(D||a)(n.LFG(f.K0))},a.\u0275prov=n.Yz7({token:a,factory:a.\u0275fac});var m=t(3412),v=t(64533),C=t(38998),u=t(53448),k=t(47775),b=(t(24897),t(10190)),y=t(96617),P=t(26942),E=t(36293),T=t(63829),O=t(14808),I=t(12084),Z=t(33927),j=t(53466);class B{constructor(D){this.bcfApi=D,this.authorizationMap=(0,O.r9)()}authorized$(D,G,V){const me=this.authorizationMap.get(D);return me.putFromPromiseIfPristine(()=>this.bcfApi.projects.id(D).extensions.get().toPromise()),me.values$().pipe((0,Z.U)($=>$[G]&&$[G].includes(V)))}isAllowedTo(D,G,V){return this.authorized$(D,G,V).pipe((0,j.q)(1)).toPromise().catch(()=>!1)}}B.\u0275fac=function(D){return new(D||B)(n.LFG(I.y))},B.\u0275prov=n.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"});var J=t(33276),R=t(8368),F=t(9170),Y=t(2775);function X(oe,D){if(1&oe){const G=n.EpF();n.TgZ(0,"div",7),n.TgZ(1,"ngx-gallery",8),n.NdJ("change",function(me){return n.CHM(G),n.oxw(2).onGalleryChanged(me)})("imagesReady",function(){return n.CHM(G),n.oxw(2).selectViewpointInGallery()})("previewOpen",function(){return n.CHM(G),n.oxw(2).galleryPreviewOpen()})("previewClose",function(){return n.CHM(G),n.oxw(2).galleryPreviewClose()}),n.qZA(),n.qZA()}if(2&oe){const G=n.oxw(2);n.xp6(1),n.Q6J("options",G.galleryOptions)("images",G.galleryImages)}}function K(oe,D){if(1&oe){const G=n.EpF();n.TgZ(0,"a",9),n.NdJ("click",function(){n.CHM(G);const me=n.oxw(2);return me.saveViewpoint(me.workPackage)}),n._UZ(1,"op-icon",10),n.TgZ(2,"span",11),n._uU(3),n.qZA(),n.qZA()}if(2&oe){const G=n.oxw(2);n.Q6J("title",G.text.add_viewpoint),n.xp6(3),n.hij(" ",G.text.viewpoint," ")}}function ie(oe,D){if(1&oe&&(n.ynx(0),n.TgZ(1,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n._UZ(4,"h3",4),n.qZA(),n.qZA(),n.YNc(5,X,2,2,"div",5),n.YNc(6,K,4,2,"a",6),n.qZA(),n.BQk()),2&oe){const G=n.oxw();n.xp6(4),n.Q6J("textContent",G.text.bcf),n.xp6(1),n.Q6J("ngIf",G.galleryImages.length>0),n.xp6(1),n.Q6J("ngIf",G.viewerVisible&&G.createAllowed)}}class H extends P.N{constructor(D,G,V,me,$,Se,ot,st,he,ye){super(),this.state=D,this.bcfAuthorization=G,this.viewerBridge=V,this.apiV3Service=me,this.wpCreate=$,this.toastService=Se,this.bcfViewer=ot,this.cdRef=st,this.I18n=he,this.viewpointsService=ye,this.text={bcf:this.I18n.t("js.bcf.label_bcf"),viewpoint:this.I18n.t("js.bcf.viewpoint"),add_viewpoint:this.I18n.t("js.bcf.add_viewpoint"),show_viewpoint:this.I18n.t("js.bcf.show_viewpoint"),delete_viewpoint:this.I18n.t("js.bcf.delete_viewpoint"),text_are_you_sure:this.I18n.t("js.text_are_you_sure"),notice_successful_create:this.I18n.t("js.notice_successful_create"),notice_successful_delete:this.I18n.t("js.notice_successful_delete")},this.galleryOptions=[{width:"100%",height:"400px",startIndex:0,image:!1,thumbnailsColumns:1,thumbnailsAutoHide:!1,thumbnailSize:"contain",imageAnimation:"",previewAnimation:!1,previewCloseOnEsc:!0,previewKeyboardNavigation:!0,imageSize:"contain",imageArrowsAutoHide:!0,thumbnailsMargin:5,thumbnailMargin:5,previewDownload:!0,previewCloseOnClick:!0,arrowPrevIcon:"icon-arrow-left2",arrowNextIcon:"icon-arrow-right2",closeIcon:"icon-close",downloadIcon:"icon-download",thumbnailActions:this.actions(),actions:this.actions()},{breakpoint:800,width:"100%",height:"400px",imagePercent:80,thumbnailsPercent:20,thumbnailsMargin:5,thumbnailMargin:5},{breakpoint:680,height:"200px",thumbnailsColumns:3,thumbnailsMargin:5,thumbnailMargin:5}],this.viewpoints=[],this.galleryImages=[],this.viewAllowed=!1,this.createAllowed=!1,this.viewerVisible=!1}ngAfterViewInit(){this.observeChanges()}ngOnInit(){this.viewerBridge.viewerVisible$.subscribe(D=>{this.viewerVisible=!!D,this.cdRef.detectChanges()})}observeChanges(){this.apiV3Service.work_packages.id(this.workPackage).requireAndStream().pipe(this.untilDestroyed()).subscribe(D=>(0,c.mG)(this,void 0,void 0,function*(){this.workPackage=D,this.projectId||(yield this.initialize(this.workPackage)),D.bcfViewpoints&&this.refreshViewpoints(D.bcfViewpoints)}))}initialize(D){return(0,c.mG)(this,void 0,void 0,function*(){this.projectId=(0,b.Z)(D.project.href),this.viewAllowed=yield this.bcfAuthorization.isAllowedTo(this.projectId,"project_actions","viewTopic"),this.createAllowed=yield this.bcfAuthorization.isAllowedTo(this.projectId,"topic_actions","createViewpoint"),this.loadViewpointFromRoute(D),this.cdRef.detectChanges()})}refreshViewpoints(D){this.viewpoints=D.map(G=>({href:G.href,snapshotURL:`${G.href}/snapshot`})),this.setViewpointsOnGallery(this.viewpoints)}showViewpoint(D,G){if(this.bcfViewer&&this.viewerBridge.shouldShowViewer){switch(this.bcfViewer.currentViewerState()){case"table":this.bcfViewer.update("splitTable");break;case"cards":this.bcfViewer.update("splitCards")}this.viewerBridge.viewerVisible$.pipe((0,F.h)(V=>V),(0,j.q)(1)).subscribe(()=>this.viewerBridge.showViewpoint(D,G))}else this.viewerBridge.showViewpoint(D,G)}deleteViewpoint(D,G){!window.confirm(this.text.text_are_you_sure)||this.viewpointsService.deleteViewPoint$(D,G).subscribe(()=>{this.toastService.addSuccess(this.text.notice_successful_delete),this.gallery.preview.close()})}saveViewpoint(D){this.viewpointsService.saveViewpoint$(D).subscribe(()=>{this.toastService.addSuccess(this.text.notice_successful_create),this.showIndex=this.viewpoints.length})}loadViewpointFromRoute(D){if("number"==typeof this.state.params.viewpoint){const G=this.state.params.viewpoint;this.showViewpoint(D,G),this.showIndex=G,this.selectViewpointInGallery(),this.state.go(".",Object.assign(Object.assign({},this.state.params),{viewpoint:void 0}),{reload:!1})}}shouldShowGroup(){return this.viewAllowed&&(this.viewpoints.length>0||this.createAllowed&&this.viewerVisible)}actions(){return[{icon:"icon-view-model",onClick:(D,G)=>{this.showViewpoint(this.workPackage,G),this.gallery.preview.close()},titleText:this.text.show_viewpoint},{icon:"icon-delete",onClick:(D,G)=>this.deleteViewpoint(this.workPackage,G),titleText:this.text.delete_viewpoint}]}galleryPreviewOpen(){jQuery(".op-app-header").addClass("-no-z-index")}galleryPreviewClose(){jQuery(".op-app-header").removeClass("-no-z-index")}selectViewpointInGallery(){setTimeout(()=>{var D;return null===(D=this.gallery)||void 0===D?void 0:D.show(this.showIndex)},250)}onGalleryChanged(D){this.showIndex=D.index}set showIndex(D){const G=[...this.galleryOptions];G[0].startIndex=D,this.galleryOptions=G}get showIndex(){return this.galleryOptions[0].startIndex}setViewpointsOnGallery(D){const{length:G}=D;this.setThumbnailProperties(G),this.showIndex<0||G<1?this.showIndex=0:this.showIndex>=G&&(this.showIndex=G-1),this.galleryImages=D.map(V=>({small:V.snapshotURL,medium:V.snapshotURL,big:V.snapshotURL})),this.cdRef.detectChanges()}setThumbnailProperties(D){const G=[...this.galleryOptions];G[0].thumbnailsColumns=D<5?D:4,G[1].thumbnailsColumns=D<5?D:4,G[2].thumbnailsColumns=D<4?D:3,G[0].height=`${this.dynamicThumbnailHeight(D)}px`,G[1].height=`${this.dynamicThumbnailHeight(D)}px`,G[2].height=`${this.dynamicThumbnailHeight(D)}px`,this.galleryOptions=G}dynamicThumbnailHeight(D){return Math.max(Math.round(300/D),120)}}H.\u0275fac=function(D){return new(D||H)(n.Y36(k.StateService),n.Y36(B),n.Y36(C.L),n.Y36(J.T),n.Y36(T.P),n.Y36(E.kl),n.Y36(R.zJ,8),n.Y36(n.sBO),n.Y36(y.D),n.Y36(m.V))},H.\u0275cmp=n.Xpm({type:H,selectors:[["ng-component"]],viewQuery:function(D,G){if(1&D&&n.Gf(p.g$,5),2&D){let V;n.iGM(V=n.CRH())&&(G.gallery=V.first)}},inputs:{workPackage:"workPackage"},features:[n._Bn([m.V]),n.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"attributes-group","description-group"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],["class","bcf--viewpoints",4,"ngIf"],["class","button",3,"title","click",4,"ngIf"],[1,"bcf--viewpoints"],[3,"options","images","change","imagesReady","previewOpen","previewClose"],[1,"button",3,"title","click"],["icon-classes","button--icon icon-add"],[1,"button--text"]],template:function(D,G){1&D&&n.YNc(0,ie,7,3,"ng-container",0),2&D&&n.Q6J("ngIf",G.shouldShowGroup())},directives:[f.O5,p.g$,Y.o],styles:[".bcf--viewpoints[_ngcontent-%COMP%]{clear:both}ngx-gallery[_ngcontent-%COMP%]{display:inline-block}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-thumbnails .ngx-gallery-arrow{color:var(--content-link-color)}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-arrow.ngx-gallery-disabled{display:none}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper{background:rgba(255,255,255,.5);padding:5px}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper .ngx-gallery-icon{margin-top:0}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper ngx-gallery-action:last-of-type .ngx-gallery-icon{margin-right:0}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail{background-color:#fff}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail.ngx-gallery-clickable .ngx-gallery-icon{font-size:1.25rem;color:var(--content-link-color)}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-active, ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail{border:1px solid #E7E7E7!important}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-preview-img{background-color:#fff}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-preview{background:rgba(0,0,0,.8)!important}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-preview a:hover{color:#fff}"],changeDetection:0});var ee=t(79902),ce=t(42720),se=t(84699);function re(oe,D){if(1&oe){const G=n.EpF();n.TgZ(0,"div",7),n.TgZ(1,"ngx-gallery",8),n.NdJ("change",function(me){return n.CHM(G),n.oxw(2).onGalleryChanged(me)})("imagesReady",function(){return n.CHM(G),n.oxw(2).selectViewpointInGallery()})("previewOpen",function(){return n.CHM(G),n.oxw(2).galleryPreviewOpen()})("previewClose",function(){return n.CHM(G),n.oxw(2).galleryPreviewClose()}),n.qZA(),n.qZA()}if(2&oe){const G=n.oxw(2);n.xp6(1),n.Q6J("options",G.galleryOptions)("images",G.galleryImages)}}function Me(oe,D){if(1&oe){const G=n.EpF();n.TgZ(0,"a",9),n.NdJ("click",function(){n.CHM(G);const me=n.oxw(2);return me.saveViewpoint(me.workPackage)}),n._UZ(1,"op-icon",10),n.TgZ(2,"span",11),n._uU(3),n.qZA(),n.qZA()}if(2&oe){const G=n.oxw(2);n.Q6J("title",G.text.add_viewpoint),n.xp6(3),n.hij(" ",G.text.viewpoint," ")}}function Ae(oe,D){if(1&oe&&(n.ynx(0),n.TgZ(1,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n._UZ(4,"h3",4),n.qZA(),n.qZA(),n.YNc(5,re,2,2,"div",5),n.YNc(6,Me,4,2,"a",6),n.qZA(),n.BQk()),2&oe){const G=n.oxw();n.xp6(4),n.Q6J("textContent",G.text.bcf),n.xp6(1),n.Q6J("ngIf",G.galleryImages.length>0),n.xp6(1),n.Q6J("ngIf",G.viewerVisible&&G.createAllowed)}}class Ye extends H{constructor(){super(...arguments),this.galleryViewpoints=[]}ngAfterViewInit(){this.viewerVisible&&(super.ngAfterViewInit(),(0,se.Z)(this.workPackage)&&this.observeCreation())}observeCreation(){this.wpCreate.onNewWorkPackage().pipe(this.untilDestroyed(),(0,j.q)(1),(0,ee.w)(D=>this.viewpointsService.setBcfTopic$(D),D=>D),(0,ee.w)(D=>{this.workPackage=D;const G=this.galleryViewpoints.filter(V=>!V.href&&V.viewpoint).map(V=>this.viewpointsService.saveViewpoint$(this.workPackage,V.viewpoint));return(0,ce.D)(G)})).subscribe(()=>{this.showIndex=this.galleryViewpoints.length-1})}showViewpoint(D,G){}deleteViewpoint(D,G){this.galleryViewpoints=this.galleryViewpoints.filter((V,me)=>me!==G),this.setViewpointsOnGallery(this.galleryViewpoints)}saveViewpoint(){this.viewerBridge.getViewpoint$().subscribe(D=>{const G={snapshotURL:D.snapshot.snapshot_data,viewpoint:D};this.galleryViewpoints=[...this.galleryViewpoints,G],this.setViewpointsOnGallery(this.galleryViewpoints),this.showIndex=this.galleryViewpoints.length-1,this.selectViewpointInGallery()})}shouldShowGroup(){return this.createAllowed&&this.viewerVisible}actions(){return super.actions().filter(D=>"icon-delete"===D.icon)}}Ye.\u0275fac=function(){let oe;return function(G){return(oe||(oe=n.n5z(Ye)))(G||Ye)}}(),Ye.\u0275cmp=n.Xpm({type:Ye,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"attributes-group","description-group"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],["class","bcf--viewpoints",4,"ngIf"],["class","button",3,"title","click",4,"ngIf"],[1,"bcf--viewpoints"],[3,"options","images","change","imagesReady","previewOpen","previewClose"],[1,"button",3,"title","click"],["icon-classes","button--icon icon-add"],[1,"button--text"]],template:function(D,G){1&D&&n.YNc(0,Ae,7,3,"ng-container",0),2&D&&n.Q6J("ngIf",G.shouldShowGroup())},directives:[f.O5,p.g$,Y.o],styles:[".bcf--viewpoints[_ngcontent-%COMP%]{clear:both}ngx-gallery[_ngcontent-%COMP%]{display:inline-block}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-thumbnails .ngx-gallery-arrow{color:var(--content-link-color)}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-arrow.ngx-gallery-disabled{display:none}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper{background:rgba(255,255,255,.5);padding:5px}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper .ngx-gallery-icon{margin-top:0}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-icons-wrapper ngx-gallery-action:last-of-type .ngx-gallery-icon{margin-right:0}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail{background-color:#fff}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail.ngx-gallery-clickable .ngx-gallery-icon{font-size:1.25rem;color:var(--content-link-color)}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-active, ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-thumbnail{border:1px solid #E7E7E7!important}ngx-gallery[_ngcontent-%COMP%]     .ngx-gallery-preview-img{background-color:#fff}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-preview{background:rgba(0,0,0,.8)!important}ngx-gallery[_ngcontent-%COMP%]     ngx-gallery-preview a:hover{color:#fff}"],changeDetection:0});var ze=t(76491),Xe=t(79441),it=t(83720),at=t(20088);class lt extends C.L{constructor(D){super(D),this.injector=D,this.shouldShowViewer=!1,this.viewerVisible$=new ze.X(!1),this.revitMessageReceivedSource=new Xe.xQ,this.trackingIdNumber=0,this.revitMessageReceived$=this.revitMessageReceivedSource.asObservable(),window.RevitBridge?this.hookUpRevitListener():window.addEventListener("revit.plugin.ready",()=>{this.hookUpRevitListener()},{once:!0})}viewerVisible(){return this.viewerVisible$.getValue()}getViewpoint$(){const D=this.newTrackingId();return this.sendMessageToRevit("ViewpointGenerationRequest",D,""),this.revitMessageReceived$.pipe((0,it.x)(),(0,F.h)(G=>"ViewpointData"===G.messageType&&G.trackingId===D),(0,at.P)(),(0,Z.U)(G=>{const V=G.messagePayload;return V.snapshot.hasOwnProperty("snapshot_type")&&V.snapshot.hasOwnProperty("snapshot_data")||(V.snapshot={snapshot_type:"png",snapshot_data:V.snapshot}),V}))}showViewpoint(D,G){this.viewpointsService.getViewPoint$(D,G).subscribe(V=>this.sendMessageToRevit("ShowViewpoint",this.newTrackingId(),JSON.stringify(V)))}sendMessageToRevit(D,G,V){!this.viewerVisible()||window.RevitBridge.sendMessageToRevit(D,G,V)}hookUpRevitListener(){window.RevitBridge.sendMessageToOpenProject=D=>{const{messageType:G,trackingId:V,messagePayload:me}=JSON.parse(D);this.revitMessageReceivedSource.next({messageType:G,trackingId:V,messagePayload:JSON.parse(me)})},this.viewerVisible$.next(!0)}newTrackingId(){return this.trackingIdNumber+=1,String(this.trackingIdNumber)}}lt.\u0275fac=function(D){return new(D||lt)(n.LFG(n.zs3))},lt.\u0275prov=n.Yz7({token:lt,factory:lt.\u0275fac}),(0,c.gn)([(0,l.W)(),(0,c.w6)("design:type",m.V)],lt.prototype,"viewpointsService",void 0);class de{constructor(D){de.bootstrap(D)}static bootstrap(D){this.bootstrapCalled||(this.bootstrapCalled=!0,D.get(h.i).addFieldType(d,"bcfThumbnail",["BCF Thumbnail"]),D.get(u.$).register("prependedAttributeGroups",me=>{if(window.OpenProject.isBimEdition)return(0,se.Z)(me)?Ye:H}))}}de.bootstrapCalled=!1,de.\u0275fac=function(D){return new(D||de)(n.LFG(n.zs3))},de.\u0275mod=n.oAB({type:de}),de.\u0275inj=n.cJS({providers:[{provide:C.L,useFactory:oe=>window.navigator.userAgent.search("Revit")>-1?new lt(oe):oe.get(v.T,new v.T(oe)),deps:[n.zs3]},a,r.b,m.V],imports:[[e.H,p.ji]]})},64533:(te,M,t)=>{"use strict";t.d(M,{T:()=>k});var n=t(3786),e=t(62967);class p{constructor(b){this.pathHelper=b,this.ifcModels=window.gon.ifc_models}getProjects(b,y){b({projects:this.ifcModels.projects})}getProject(b,y,P){y({id:b[0].id,name:b[0].name,models:this.ifcModels.models,viewerContent:{modelsLoaded:this.ifcModels.shown_models},viewerConfigs:{}})}getGeometry(b,y,P,E){const T=this.ifcModels.xkt_attachment_ids[y];console.log(`Loading model geometry for: ${T}`),e.P6.loadArraybuffer(this.pathHelper.attachmentContentPath(T),P,E)}}var h=t(38998),c=t(76491),i=t(81134),l=t(70233),r=t(12084),d=t(29161),f=t(3412),a=t(65146),m=t(53882),v=t(34364),C=t(10190),u=t(2316);class k extends h.L{constructor(b){super(b),this.injector=b,this.shouldShowViewer=!0,this.viewerVisible$=new c.X(!1),this.inspectorVisible$=new c.X(!1)}newViewer(b,y){const P=new p(this.pathHelper),E=new v.po(P,b);E.on("modelLoaded",()=>this.viewerVisible$.next(!0)),E.loadProject(y[0].id),E.on("addModel",()=>{window.location.href=this.pathHelper.ifcModelsNewPath(this.currentProjectService.identifier)}),E.on("openInspector",()=>{this.inspectorVisible$.next(!0)}),E.on("editModel",T=>{window.location.href=this.pathHelper.ifcModelsEditPath(this.currentProjectService.identifier,T.modelId)}),E.on("deleteModel",T=>{const O=new FormData;O.append("authenticity_token",jQuery("meta[name=csrf-token]").attr("content")),O.append("_method","delete"),this.httpClient.post(this.pathHelper.ifcModelsDeletePath(this.currentProjectService.identifier,T.modelId),O).subscribe().add(()=>{window.location.reload()})}),this.viewer=E}destroy(){this.viewerVisible$.next(!1),this.viewer&&(this.viewer.destroy(),this.viewer=void 0)}get viewer(){return this.xeokitViewer}set viewer(b){this.xeokitViewer=b}setKeyboardEnabled(b){var y;null===(y=this.viewer)||void 0===y||y.setKeyboardEnabled(b)}getViewpoint$(){if(!this.viewer)return(0,i.of)();const y=this.viewer.saveBCFViewpoint({spacesVisible:!0,reverseClippingPlanes:!0});return y.bitmaps=null,(0,i.of)(y)}showViewpoint(b,y){if(this.viewerVisible()){const P={updateCompositeObjects:!0,reverseClippingPlanes:!0};this.viewpointsService.getViewPoint$(b,y).subscribe(E=>{var T;null===(T=this.viewer)||void 0===T||T.loadBCFViewpoint(E,P)})}else window.location.href=this.pathHelper.bimDetailsPath((0,C.Z)(b.project.href),b.id||"",y)}viewerVisible(){return!!this.viewer}}k.\u0275fac=function(b){return new(b||k)(u.LFG(u.zs3))},k.\u0275prov=u.Yz7({token:k,factory:k.\u0275fac}),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",l.j)],k.prototype,"pathHelper",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",r.y)],k.prototype,"bcfApi",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",f.V)],k.prototype,"viewpointsService",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",a.R)],k.prototype,"currentProjectService",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",m.eN)],k.prototype,"httpClient",void 0)},8368:(te,M,t)=>{"use strict";t.d(M,{jN:()=>i,iV:()=>l,IY:()=>r,JY:()=>d,sw:()=>f,zJ:()=>a});var n=t(96617),e=t(54592),p=t(43440),h=t(38998),c=t(2316);const i="cards",l="viewer",r="splitTable",d="splitCards",f="table";class a extends e.q{constructor(v,C,u){super(u),this.I18n=v,this.viewerBridgeService=C,this.querySpace=u,this.text={cards:this.I18n.t("js.views.card"),viewer:this.I18n.t("js.ifc_models.views.viewer"),splitTable:this.I18n.t("js.ifc_models.views.split"),splitCards:this.I18n.t("js.ifc_models.views.split_cards"),table:this.I18n.t("js.views.list")},this.icon={cards:"icon-view-card",viewer:"icon-view-model",splitTable:"icon-view-split-viewer-table",splitCards:"icon-view-split2",table:"icon-view-list"}}hasChanged(v){return this.current!==v.displayRepresentation}applyToQuery(v){return v.displayRepresentation=this.current,!0}valueFromQuery(v){const C=v.displayRepresentation;switch(C){case"splitCards":case"splitTable":case"cards":case"table":case"viewer":return C;default:return this.viewerBridgeService.shouldShowViewer?"splitCards":"cards"}}currentViewerState(){return this.current}}a.\u0275fac=function(v){return new(v||a)(c.LFG(n.D),c.LFG(h.L),c.LFG(p.q))},a.\u0275prov=c.Yz7({token:a,factory:a.\u0275fac})},84308:(te,M,t)=>{"use strict";t.d(M,{X:()=>p});var n=t(73881),e=t(2316);class p{constructor(c){this.bannersService=c,this.mapping={}}add(c,i){this.mapping[c]=i}available(){return _.map(this.mapping,(c,i)=>({attribute:i,text:c.localizedName,icon:"",description:"",image:"",disabled:this.bannersService.eeShowBanners}))}get(c){if(this.mapping[c])return this.mapping[c];throw new Error(`No action service exists for ${c}`)}}p.\u0275fac=function(c){return new(c||p)(e.LFG(n.j))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})},24335:(te,M,t)=>{"use strict";t.d(M,{s:()=>f});var n=t(3786),e=t(65146),p=t(70233),h=t(91923),c=t(96617),i=t(36293),l=t(33276),r=t(75421),d=t(2316);class f{constructor(m,v,C,u,k,x){this.CurrentProject=m,this.pathHelper=v,this.apiV3Service=C,this.halResourceService=u,this.toastService=k,this.I18n=x,this.v3=this.pathHelper.api.v3}create(m,v){const C=JSON.stringify(v);return this.apiV3Service.queries.form.loadWithParams({pageSize:0,filters:C},void 0,this.CurrentProject.identifier,this.buildQueryRequest(m)).toPromise().then(([u,k])=>{if(u.schema.public.writable)return this.apiV3Service.queries.post(k,u).toPromise();throw new Error(this.I18n.t("js.boards.error_permission_missing"))})}addFreeQuery(m,v){const C=this.freeBoardQueryFilter();return this.addQuery(m,v,[C])}addQuery(m,v,C){return(0,n.mG)(this,void 0,void 0,function*(){const u=m.queries.length;try{const x={_type:"GridWidget",identifier:"work_package_query",startRow:1,endRow:2,startColumn:u+1,endColumn:u+2,options:{queryId:(yield this.create(v,C)).id,filters:C}},b=this.halResourceService.createHalResourceOfClass(r.z,x);m.addQuery(b)}catch(k){this.toastService.addError(k),console.error(k)}return m})}buildQueryRequest(m){return Object.assign({public:!0,_links:{sortBy:[{href:`${this.v3.apiV3Base}/queries/sort_bys/manualSorting-asc`},{href:`${this.v3.apiV3Base}/queries/sort_bys/id-asc`}]}},m)}freeBoardQueryFilter(){return{manualSort:{operator:"ow",values:[]}}}}f.\u0275fac=function(m){return new(m||f)(d.LFG(e.R),d.LFG(p.j),d.LFG(l.T),d.LFG(h.u),d.LFG(i.kl),d.LFG(c.D))},f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})},3216:(te,M,t)=>{"use strict";t.d(M,{$:()=>a});var n=t(3786),e=t(24335),p=t(91923),h=t(70233),c=t(65146),i=t(96617),l=t(84308),r=t(76491),d=t(33276),f=t(2316);class a{constructor(v,C,u,k,x,b,y){this.apiV3Service=v,this.PathHelper=C,this.CurrentProject=u,this.halResourceService=k,this.boardActions=x,this.I18n=b,this.boardsList=y,this.currentBoard$=new r.X(null),this.text={unnamed_board:this.I18n.t("js.boards.label_unnamed_board"),action_board:P=>this.I18n.t("js.boards.board_type.action_by_attribute",{attribute:this.I18n.t(`js.boards.board_type.action_type.${P}`)}),unnamed_list:this.I18n.t("js.boards.label_unnamed_list")}}loadAllBoards(v=this.CurrentProject.identifier,C=!1){return C||void 0===this.loadAllPromise?this.loadAllPromise=this.apiV3Service.boards.allInScope(v).toPromise():this.loadAllPromise}canManage(v){return!!v.grid.$links.delete}save(v){return this.reorderWidgets(v),this.apiV3Service.boards.id(v).save(v)}create(v){return(0,n.mG)(this,void 0,void 0,function*(){const C=yield this.apiV3Service.boards.create(v.type,this.boardName(v),this.CurrentProject.identifier,v.attribute).toPromise();return"free"===v.type?yield this.boardsList.addFreeQuery(C,{name:this.text.unnamed_list}):yield this.boardActions.get(v.attribute).addInitialColumnsForAction(C),yield this.save(C).toPromise(),C})}delete(v){return this.apiV3Service.boards.id(v).delete().toPromise()}boardName(v){return v.boardName?v.boardName:"action"===v.type?this.text.action_board(v.attribute):this.text.unnamed_board}reorderWidgets(v){v.grid.columnCount=Math.max(v.grid.widgets.length,1),v.grid.widgets.map((C,u)=>(C.startColumn=u+1,C.endColumn=u+2,C))}}a.\u0275fac=function(v){return new(v||a)(f.LFG(d.T),f.LFG(h.j),f.LFG(c.R),f.LFG(p.u),f.LFG(l.X),f.LFG(i.D),f.LFG(e.s))},a.\u0275prov=f.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})},64538:(te,M,t)=>{"use strict";t.d(M,{h:()=>e});var n=t(2316);class e{constructor(){this.causedUpdates=[]}includes(h){return this.causedUpdates.includes(this.cacheValue(h))}add(h){this.causedUpdates.length>100&&this.causedUpdates.splice(0,90),this.causedUpdates.push(this.cacheValue(h))}cacheValue(h){return h.updatedAt+h.href}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac})},56945:(te,M,t)=>{"use strict";t.d(M,{r:()=>E});var n=t(60312),e=t(77355),p=t(96617),h=t(47775),c=t(3216),i=t(84308),l=t(86469),r=t(67727),d=t(97656),f=t(73881),a=t(36293),m=t(27779),v=t(2316),C=t(54364);function u(T,O){if(1&T){const I=v.EpF();v.TgZ(0,"button",2),v.NdJ("click",function(){const B=v.CHM(I).$implicit;return v.oxw().created(B.attribute)}),v._UZ(1,"img",3),v.TgZ(2,"div"),v.TgZ(3,"span",4),v._uU(4),v.qZA(),v._UZ(5,"p",5),v.qZA(),v.qZA()}if(2&T){const I=O.$implicit,Z=v.oxw();v.Q6J("disabled",I.disabled||Z.disable),v.xp6(1),v.Q6J("src",I.image,v.LSH),v.xp6(3),v.Oqu(I.text),v.xp6(1),v.Q6J("textContent",I.description)}}class k{constructor(){this.disable=!1,this.create=new v.vpe}created(O){this.create.emit(O)}}k.\u0275fac=function(O){return new(O||k)},k.\u0275cmp=v.Xpm({type:k,selectors:[["tile-view"]],inputs:{tiles:"tiles",disable:"disable"},outputs:{create:"create"},decls:2,vars:1,consts:[[1,"op-tile-block"],["class","op-tile-block--tile button button_no-margin","data-qa-selector","op-tile-block","type","button",3,"disabled","click",4,"ngFor","ngForOf"],["data-qa-selector","op-tile-block","type","button",1,"op-tile-block--tile","button","button_no-margin",3,"disabled","click"],[1,"op-tile-block--image",3,"src"],["data-qa-selector","op-tile-block-title",1,"op-tile-block--title"],[1,"op-tile-block--description",3,"textContent"]],template:function(O,I){1&O&&(v.TgZ(0,"div",0),v.YNc(1,u,6,4,"button",1),v.qZA()),2&O&&(v.xp6(1),v.Q6J("ngForOf",I.tiles))},directives:[C.sg],styles:[".op-tile-block[_ngcontent-%COMP%]{display:grid;grid-template-rows:repeat(minmax(200px,auto));grid-template-columns:auto auto;grid-gap:1rem}.op-tile-block--tile[_ngcontent-%COMP%]{border-radius:10px;display:grid;grid-template:95px 1fr/1fr;grid-template-columns:auto 1fr auto;grid-template-rows:auto;grid-row-gap:5px;justify-items:left;background:#f7fafc;min-height:150px}.op-tile-block--tile[_ngcontent-%COMP%]:disabled{background:#fafafa}.op-tile-block--tile[_ngcontent-%COMP%]:hover{text-decoration:none;border:1px solid grey;border-radius:10px!important;cursor:pointer}.op-tile-block--image[_ngcontent-%COMP%]{display:block;margin-top:auto;margin-bottom:auto}.op-tile-block--title[_ngcontent-%COMP%]{padding-top:30px;padding-bottom:5px;color:var(--primary-color-dark);display:block;text-align:left;font-weight:bolder;font-size:large}.op-tile-block--description[_ngcontent-%COMP%]{text-align:left;width:90%}"],changeDetection:0});var x=t(8158);const b=["actionAttributeSelect"];function y(T,O){if(1&T&&(v.TgZ(0,"p"),v._UZ(1,"op-enterprise-banner",11),v.qZA()),2&T){const I=v.oxw();v.xp6(1),v.Q6J("linkMessage",I.text.upgrade_to_ee_text)("textMessage",I.text.teaser_text)("moreInfoLink",I.text.more_info_ee_link)}}function P(T,O){if(1&T&&v._UZ(0,"p",12),2&T){const I=v.oxw();v.Q6J("textContent",I.text.select_board_type)}}class E extends n.T{constructor(O,I,Z,j,B,J,R,F,Y,X,K,ie){super(O,Z,I),this.locals=O,this.elementRef=I,this.cdRef=Z,this.state=j,this.boardService=B,this.boardActions=J,this.halNotification=R,this.loadingIndicatorService=F,this.I18n=Y,this.boardActionRegistry=X,this.bannersService=K,this.toastService=ie,this.showClose=!0,this.confirmed=!1,this.available=this.boardActions.available(),this.inFlight=!1,this.eeShowBanners=!1,this.text={close_popup:this.I18n.t("js.close_popup_title"),free_board:this.I18n.t("js.boards.board_type.free"),free_board_text:this.I18n.t("js.boards.board_type.free_text"),free_board_title:this.I18n.t("js.boards.board_type.board_type_title.basic"),board_type:this.I18n.t("js.boards.board_type.text"),action_board:this.I18n.t("js.boards.board_type.action"),action_board_text:this.I18n.t("js.boards.board_type.action_text"),select_attribute:this.I18n.t("js.boards.board_type.select_attribute"),select_board_type:this.I18n.t("js.boards.board_type.select_board_type"),placeholder:this.I18n.t("js.placeholders.selection"),teaser_text:this.I18n.t("js.boards.upsale.teaser_text"),upgrade_to_ee_text:this.I18n.t("js.boards.upsale.upgrade"),more_info_ee_link:m.rj.boards,cancel_button:this.I18n.t("js.button_cancel")},this.initiateTiles()}ngOnInit(){super.ngOnInit(),this.eeShowBanners=this.bannersService.eeShowBanners}createBoard(O){"basic"===O?this.createFree():this.createAction(O)}initiateTiles(){this.available.unshift({attribute:"basic",text:this.text.free_board_title,icon:"icon-boards",description:this.text.free_board_text,image:(0,d.h)("board_creation_modal/lists.svg")}),this.addIcon(this.available),this.addDescription(this.available),this.addText(this.available),this.addImage(this.available)}createFree(){this.create({type:"free"})}createAction(O){this.eeShowBanners?this.toastService.addError(this.I18n.t("js.upsale.ee_only")):this.create({type:"action",attribute:O})}create(O){this.inFlight=!0,this.loadingIndicatorService.modal.promise=this.boardService.create(O).then(I=>{this.inFlight=!1,this.closeMe(),this.state.go("boards.partitioned.show",{board_id:I.id,isNew:!0})}).catch(I=>{this.inFlight=!1,this.halNotification.handleRawError(I)})}addDescription(O){O.forEach(I=>{if("basic"!==I.attribute){const Z=this.boardActionRegistry.get(I.attribute);I.description=Z.description}})}addIcon(O){O.forEach(I=>{if("basic"!==I.attribute){const Z=this.boardActionRegistry.get(I.attribute);I.icon=Z.icon}})}addText(O){O.forEach(I=>{if("basic"!==I.attribute){const Z=this.boardActionRegistry.get(I.attribute);I.text=Z.text}})}addImage(O){O.forEach(I=>{if("basic"!==I.attribute){const Z=this.boardActionRegistry.get(I.attribute);I.image=Z.image}})}}E.\u0275fac=function(O){return new(O||E)(v.Y36(e.E),v.Y36(v.SBq),v.Y36(v.sBO),v.Y36(h.StateService),v.Y36(c.$),v.Y36(i.X),v.Y36(r.W),v.Y36(l.vt),v.Y36(p.D),v.Y36(i.X),v.Y36(f.j),v.Y36(a.kl))},E.\u0275cmp=v.Xpm({type:E,selectors:[["ng-component"]],viewQuery:function(O,I){if(1&O&&v.Gf(b,7),2&O){let Z;v.iGM(Z=v.CRH())&&(I.actionAttributeSelect=Z.first)}},features:[v.qOj],decls:13,vars:6,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_wide","confirm-form-submit--modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[4,"ngIf"],["class","spot-body-small",3,"textContent",4,"ngIf"],[1,"new-board--section"],[3,"tiles","disable","create"],[1,"spot-action-bar","hidden-for-mobile"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action","spot-modal--cancel-button",3,"click"],["opReferrer","boards",3,"linkMessage","textMessage","moreInfoLink"],[1,"spot-body-small",3,"textContent"]],template:function(O,I){1&O&&(v.TgZ(0,"div",0),v.TgZ(1,"div",1),v._uU(2),v.qZA(),v._UZ(3,"div",2),v.TgZ(4,"div",3),v.YNc(5,y,2,3,"p",4),v.YNc(6,P,1,1,"p",5),v.TgZ(7,"section",6),v.TgZ(8,"tile-view",7),v.NdJ("create",function(j){return I.createBoard(j)}),v.qZA(),v.qZA(),v.qZA(),v.TgZ(9,"div",8),v.TgZ(10,"div",9),v.TgZ(11,"button",10),v.NdJ("click",function(){return I.closeMe()}),v._uU(12),v.qZA(),v.qZA(),v.qZA(),v.qZA()),2&O&&(v.xp6(2),v.Oqu(I.text.board_type),v.xp6(3),v.Q6J("ngIf",I.eeShowBanners),v.xp6(1),v.Q6J("ngIf",!I.eeShowBanners),v.xp6(2),v.Q6J("tiles",I.available)("disable",I.inFlight),v.xp6(4),v.hij(" ",I.text.cancel_button," "))},directives:[C.O5,k,x.P],encapsulation:2})},18640:(te,M,t)=>{"use strict";t.d(M,{j:()=>c});var n=t(79441),e=t(26942),p=t(52377),h=t(2316);class c extends e.N{constructor(l){super(),this.weekdayService=l,this.resize$=new n.xQ}resizeObserver(l){!l||(this.resizeObs||(this.resizeObs=new ResizeObserver(()=>this.resize$.next())),this.resizeObs.observe(l.nativeElement))}applyNonWorkingDay({date:l}){return l&&this.weekdayService.isNonWorkingDay(l)?["fc-non-working-day"]:[]}}c.\u0275fac=function(l){return new(l||c)(h.LFG(p.u))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac})},89118:(te,M,t)=>{"use strict";t.d(M,{W:()=>Y});var n=t(3786),e=t(96617),p=t(12877),h=t(44022),c=t(70482),i=t(36293),l=t(74647),r=t(61043),d=t(43440),f=t(26942),a=t(53466),m=t(91923),v=t(55977),C=t(33276),u=t(47775),k=t(70692),x=t(81539),b=t(12703),y=t(2281),E=t(60914),T=t(67325),O=t(20506),I=t(3352),Z=t(99794),j=t(20342),B=t(18640),J=t(52377),R=t(2316),F=t(71570);class Y extends f.N{constructor(K,ie,H,ee,ce,se,re,Me,Ae,Ye,ze,Xe,it,at,lt,dt,de,oe,D,G,V){super(),this.I18n=K,this.configuration=ie,this.sanitizer=H,this.$state=ee,this.injector=ce,this.schemaCache=se,this.toastService=re,this.wpTableFilters=Me,this.wpListService=Ae,this.wpListChecksumService=Ye,this.urlParamsHelper=ze,this.querySpace=Xe,this.apiV3Service=it,this.halResourceService=at,this.uiRouterGlobals=lt,this.timezoneService=dt,this.halEditing=de,this.wpTableSelection=oe,this.contextMenuService=D,this.calendarService=G,this.weekdayService=V,this.currentWorkPackages$=this.querySpace.results.values$().pipe((0,a.q)(1))}workPackagesListener$(K){this.querySpace.results.values$().pipe(this.untilDestroyed()).subscribe(()=>{K()})}calendarOptions(K){return Object.assign(Object.assign({},this.defaultOptions()),K)}eventDate(K,ie){return this.isMilestone(K)?K.date:K[`${ie}Date`]}isMilestone(K){return this.schemaCache.of(K).isMilestone}warnOnTooManyResults(K,ie=!1){K.count<K.total?this.tooManyResultsText=this.I18n.t("js.calendar.too_many",{count:K.total,max:Y.MAX_DISPLAYED}):this.tooManyResultsText=null,this.tooManyResultsText&&!ie&&this.toastService.addNotice(this.tooManyResultsText)}updateTimeframe(K,ie){return(0,n.mG)(this,void 0,void 0,function*(){if(this.areFiltersEmpty&&this.querySpace.query.value)return Promise.resolve();const H=y(K.start).format("YYYY-MM-DD"),ee=y(K.end).format("YYYY-MM-DD");let se,ce=null;if(this.urlParams.query_id&&(ce=this.urlParams.query_id),this.initializingWithQuery){const re=yield this.apiV3Service.queries.find({pageSize:0},ce).toPromise();se=this.generateQueryProps(re,H,ee)}else if(this.initializingWithQueryProps)if(this.urlParams.query_props){const re=JSON.parse(this.urlParams.query_props),Me=Object.assign(Object.assign({},re),{f:[...re.f.filter(Ae=>"datesInterval"!==Ae.n),Y.dateFilter(H,ee)]});se=JSON.stringify(Me)}else se=Y.defaultQueryProps(H,ee);else se=this.generateQueryProps(this.querySpace.query.value,H,ee),this.wpListChecksumService.set(ce,se);return this.wpListService.fromQueryParams({query_id:ce,query_props:se},ie||void 0).toPromise()})}generateQueryProps(K,ie,H){return this.urlParamsHelper.encodeQueryJsonParams(K,ee=>Object.assign(Object.assign({},ee),{pp:Y.MAX_DISPLAYED,pa:1,f:[...ee.f.filter(ce=>"datesInterval"!==ce.n),Y.dateFilter(ie,H)]}))}get initialView(){return this.urlParams.cview}dateEditable(K){const ie=this.schemaCache.of(K),H=ie.isAttributeEditable("startDate")&&ie.isAttributeEditable("dueDate");return(K.isLeaf||K.scheduleManually)&&H}eventDurationEditable(K){return this.dateEditable(K)&&!this.isMilestone(K)}getEndDateFromTimestamp(K){return y(K).subtract(1,"d").format("YYYY-MM-DD")}openSplitView(K,ie=!1){this.wpTableSelection.setSelection(K,-1),(!ie||this.$state.includes("**.details.*"))&&this.$state.go(`${(0,c.W)(this.$state)}.tabs`,{workPackageId:K,tabIdentifier:"overview"})}openFullView(K){this.wpTableSelection.setSelection(K,-1),this.$state.go("work-packages.show",{workPackageId:K})}onCardClicked({workPackageId:K,event:ie}){(0,T.F)(ie)||this.openSplitView(K,!0)}onCardDblClicked({workPackageId:K,event:ie}){(0,T.F)(ie)||this.openFullView(K)}showEventContextMenu({workPackageId:K,event:ie}){if((0,T.F)(ie))return;if(ie.target.closest(`.${O.yF}`))return void(0,I.qu)("Allowing original context menu on state link");this.wpTableSelection.setSelection(K,-1),ie.preventDefault();const H=new Z.X(this.injector,K,jQuery(ie.target));this.contextMenuService.show(H,ie)}defaultOptions(){return{editable:!1,locale:this.I18n.locale,fixedWeekCount:!1,firstDay:this.configuration.startOfWeek(),timeZone:this.configuration.isTimezoneSet()?this.configuration.timezone():"local",height:"auto",headerToolbar:{left:"prev,next today",center:"title",right:""},initialDate:this.initialDate,initialView:this.initialView,datesSet:K=>this.updateDateParam(K),dayHeaderClassNames:K=>this.calendarService.applyNonWorkingDay(K),dayCellClassNames:K=>this.calendarService.applyNonWorkingDay(K),dayGridClassNames:K=>this.calendarService.applyNonWorkingDay(K),slotLaneClassNames:K=>this.calendarService.applyNonWorkingDay(K),slotLabelClassNames:K=>this.calendarService.applyNonWorkingDay(K)}}static defaultQueryProps(K,ie){const H={c:["id"],t:"id:asc",f:[{n:"status",o:"*",v:[]},this.dateFilter(K,ie)],dr:"cards",hi:!1,pp:Y.MAX_DISPLAYED,pa:1};return JSON.stringify(H)}static dateFilter(K,ie){return{n:"datesInterval",o:"<>d",v:[K,ie]}}get initializingWithQueryProps(){return this.areFiltersEmpty||this.urlParams.query_props}get initializingWithQuery(){return this.areFiltersEmpty&&!!this.urlParams.query_id&&!this.urlParams.query_props}get urlParams(){return this.uiRouterGlobals.params}get areFiltersEmpty(){return this.wpTableFilters.isEmpty}get initialDate(){const K=this.urlParams.cdate;if(K)return this.timezoneService.formattedISODate(K)}updateDateParam(K){this.$state.go(".",{cdate:this.timezoneService.formattedISODate(K.view.currentStart),cview:K.view.type},{custom:{notify:!1}})}updateDates(K,ie){const H=K.event.extendedProps.workPackage,ee=this.halEditing.edit(H);if(!H.ignoreNonWorkingDays&&H.duration&&ie)ee.setValue("duration",H.duration);else{const ce=y(K.event.endStr).subtract(1,"day").format("YYYY-MM-DD");ee.setValue("dueDate",ce)}return ee.setValue("startDate",K.event.startStr),ee}}Y.MAX_DISPLAYED=100,Y.\u0275fac=function(K){return new(K||Y)(R.LFG(e.D),R.LFG(p.e),R.LFG(F.H7),R.LFG(u.StateService),R.LFG(R.zs3),R.LFG(h.y),R.LFG(i.kl),R.LFG(l.Z),R.LFG(r.Z),R.LFG(x.Y),R.LFG(v.Z),R.LFG(d.q),R.LFG(C.T),R.LFG(m.u),R.LFG(u.UIRouterGlobals),R.LFG(k.B),R.LFG(b.l),R.LFG(E.J),R.LFG(j.$),R.LFG(B.j),R.LFG(J.u))},Y.\u0275prov=R.Yz7({token:Y,factory:Y.\u0275fac})},51303:(te,M,t)=>{"use strict";t.r(M),t.d(M,{OpenprojectCalendarModule:()=>F});var n=t(21757),e=t(91594),p=t(7794),h=t(84906),c=t(2246),i=t(54349),l=t(46430),r=t(85603),d=t(1813),f=t(15334),a=t(57973),m=t(77434),v=t(22956),C=t(11266),u=t(52025),k=t(91654),x=t(74097),b=t(2316),y=t(54364),P=t(77616),E=t(81628),T=t(32853);function O(Y,X){if(1&Y&&b._UZ(0,"op-back-button",11),2&Y){const K=b.oxw();b.Q6J("customBackMethod",K.backButtonCallback)}}function I(Y,X){if(1&Y&&(b.TgZ(0,"li",15),b._UZ(1,"ndc-dynamic",16),b.qZA()),2&Y){const K=b.oxw().$implicit,ie=b.oxw(2);b.Q6J("ngClass",K.containerClasses),b.xp6(1),b.Q6J("ndcDynamicComponent",K.component)("ndcDynamicInputs",K.inputs)("ndcDynamicInjector",ie.injector)("ndcDynamicOutputs",K.outputs)}}function Z(Y,X){if(1&Y&&(b.ynx(0),b.YNc(1,I,2,5,"li",14),b.BQk()),2&Y){const K=X.$implicit;b.xp6(1),b.Q6J("ngIf",!K.show||K.show())}}function j(Y,X){if(1&Y&&(b.TgZ(0,"ul",12),b.YNc(1,Z,2,1,"ng-container",13),b.qZA()),2&Y){const K=b.oxw();b.xp6(1),b.Q6J("ngForOf",K.toolbarButtonComponents)}}function B(Y,X){if(1&Y&&b._UZ(0,"ndc-dynamic",17),2&Y){const K=b.oxw();b.Q6J("ndcDynamicComponent",K.filterContainerDefinition.component)("ndcDynamicInputs",K.filterContainerDefinition.inputs)("ndcDynamicOutputs",K.filterContainerDefinition.outputs)("ndcDynamicInjector",K.injector)}}class J extends a.r{constructor(){super(...arguments),this.text={title:this.I18n.t("js.calendar.title"),unsaved_title:this.I18n.t("js.calendar.unsaved_title")},this.selectedTitle=this.text.unsaved_title,this.filterContainerDefinition={component:m.J},this.currentPartition="-split",this.showToolbar=!0,this.titleEditingEnabled=!1,this.showToolbarSaveButton=!0,this.toolbarDisabled=!1,this.toolbarButtonComponents=[{component:x.P},{component:v.U},{component:C.a},{component:u.b,containerClasses:"hidden-for-mobile",show:()=>this.authorisationService.can("query","updateImmediately"),inputs:{hideTableOptions:!0}}]}setPartition(X){var K;this.currentPartition=(null===(K=X.data)||void 0===K?void 0:K.partition)||"-split"}staticQueryName(X){return this.text.unsaved_title}loadInitialQuery(){}}J.\u0275fac=function(){let Y;return function(K){return(Y||(Y=b.n5z(J)))(K||J)}}(),J.\u0275cmp=b.Xpm({type:J,selectors:[["ng-component"]],viewQuery:function(X,K){if(1&X&&b.Gf(f.X,7),2&X){let ie;b.iGM(ie=b.CRH())&&(K.calendarElement=ie.first)}},features:[b._Bn([k.E]),b.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(X,K){1&X&&(b.TgZ(0,"div",0),b.TgZ(1,"div",1),b.TgZ(2,"div",2),b.YNc(3,O,1,1,"op-back-button",3),b.TgZ(4,"editable-toolbar-title",4),b.NdJ("onSave",function(H){return K.changeChangesFromTitle(H)})("onEmptySubmit",function(){return K.updateTitleName("")}),b.qZA(),b.YNc(5,j,2,1,"ul",5),b.qZA(),b.qZA(),b.TgZ(6,"div",6),b.YNc(7,B,1,4,"ndc-dynamic",7),b.qZA(),b.TgZ(8,"div",8),b._UZ(9,"div",9),b._UZ(10,"div",10),b.qZA(),b.qZA()),2&X&&(b.Q6J("ngClass",K.currentPartition),b.xp6(3),b.Q6J("ngIf",K.backButtonCallback),b.xp6(1),b.Q6J("title",K.selectedTitle)("inFlight",K.toolbarDisabled)("showSaveCondition",K.showToolbarSaveButton)("editable",K.titleEditingEnabled),b.xp6(1),b.Q6J("ngIf",K.showToolbar),b.xp6(2),b.Q6J("ngIf",K.filterContainerDefinition))},directives:[y.mk,y.O5,P.s5,h.UIView,E.W,y.sg,T.B5,T.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}"],changeDetection:0});const R=[{name:"calendar",parent:"optional_project",url:"/calendars/:query_id?&query_props&cdate&cview",redirectTo:"calendar.page",views:{"!$default":{component:d.p}},params:{query_id:{type:"opQueryId",dynamic:!0},cdate:{type:"string",dynamic:!0},cview:{type:"string",dynamic:!0},query_props:{type:"opQueryString"}}},{name:"calendar.page",component:J,redirectTo:"calendar.page.show",data:{bodyClasses:"router--calendar"}},{name:"calendar.page.show",data:{baseRoute:"calendar.page.show"},views:{"content-left":{component:f.X}}},...(0,l.Z)("calendar.page.show",void 0,r.o)];class F{}F.\u0275fac=function(X){return new(X||F)},F.\u0275mod=b.oAB({type:F}),F.\u0275inj=b.cJS({imports:[[n.H,h.UIRouterModule.forChild({states:R}),p.H,i.I,c.E,e.z1U]]})},15334:(te,M,t)=>{"use strict";t.d(M,{X:()=>K});var n=t(3786),e=t(2316),p=t(91594),h=t(44437),c=t(2281),l=t(79441),r=t(80639),d=t(87853),f=t(43440),a=t(74647),m=t(61043),v=t(47775),C=t(96617),u=t(36293),k=t(12877),x=t(26942),b=t(44022),y=t(65146),P=t(79474),E=t(12703),T=t(67727),O=t(70482),I=t(89118),Z=t(18640),j=t(52377),B=t(71570),J=t(54364);const R=["ucCalendar"];function F(ie,H){if(1&ie&&e._UZ(0,"full-calendar",4,5),2&ie){const ee=e.oxw().ngIf;e.Q6J("options",ee)}}function Y(ie,H){if(1&ie&&(e.ynx(0),e.YNc(1,F,2,1,"full-calendar",3),e.BQk()),2&ie){const ee=H.ngIf;e.xp6(1),e.Q6J("ngIf",ee)}}function X(ie,H){if(1&ie&&e._UZ(0,"div",6),2&ie){const ee=e.oxw();e.Q6J("textContent",ee.workPackagesCalendar.tooManyResultsText)}}class K extends x.N{constructor(H,ee,ce,se,re,Me,Ae,Ye,ze,Xe,it,at,lt,dt,de,oe,D,G){super(),this.states=H,this.$state=ee,this.wpTableFilters=ce,this.wpListService=se,this.querySpace=re,this.schemaCache=Me,this.element=Ae,this.i18n=Ye,this.toastService=ze,this.sanitizer=Xe,this.I18n=it,this.configuration=at,this.calendar=lt,this.workPackagesCalendar=dt,this.currentProject=de,this.halEditing=oe,this.halNotification=D,this.weekdayService=G,this.static=!1,this.calendarOptions$=new l.xQ,this.alreadyLoaded=!1,this.text={cannot_drag_to_non_working_day:this.I18n.t("js.team_planner.cannot_drag_to_non_working_day")}}set ucCalendarElement(H){this.calendar.resizeObserver(H)}ngOnInit(){this.wpTableFilters.hidden.push("project"),this.calendar.resize$.pipe(this.untilDestroyed(),(0,r.b)(50)).subscribe(()=>{this.ucCalendar.getApi().updateSize()}),this.querySpace.stopAllSubscriptions.next(),this.setupWorkPackagesListener(),this.initializeCalendar()}calendarEventsFunction(H,ee){if(this.alreadyLoaded){this.alreadyLoaded=!1;const ce=this.updateResults(this.querySpace.results.value);ee(ce)}else this.workPackagesCalendar.currentWorkPackages$.subscribe(ce=>{const se=this.updateResults(ce);ee(se)});this.workPackagesCalendar.updateTimeframe(H,this.currentProject.identifier||void 0)}ngOnDestroy(){var H;super.ngOnDestroy(),null===(H=this.calendar.resizeObs)||void 0===H||H.disconnect()}initializeCalendar(){const H={height:"100%",headerToolbar:this.buildHeader(),eventSources:[{id:"work_packages",events:this.calendarEventsFunction.bind(this)},{events:[],id:"background",color:"red",background:"red",textColor:"white",display:"background",editable:!1}],plugins:[h.ZP,P.ZP],selectable:!0,select:this.handleDateClicked.bind(this),eventResizableFromStart:!0,editable:!0,eventDidMount:ee=>{var ce;const{el:se,event:re}=ee;if("background"===(null===(ce=re.source)||void 0===ce?void 0:ce.id))return;const Me=re.extendedProps.workPackage;se.dataset.workPackageId=Me.id},eventResize:ee=>{const ce=c(ee.event.endStr).subtract(1,"day").toDate(),se=c(ee.event.startStr).toDate();if(!ee.event.extendedProps.workPackage.ignoreNonWorkingDays&&(this.weekdayService.isNonWorkingDay(se)||this.weekdayService.isNonWorkingDay(ce)))return this.toastService.addError(this.text.cannot_drag_to_non_working_day),void(null==ee||ee.revert());this.updateEvent(ee,!1)},eventDrop:ee=>{const ce=c(ee.event.startStr).toDate();if(!ee.event.extendedProps.workPackage.ignoreNonWorkingDays&&this.weekdayService.isNonWorkingDay(ce))return this.toastService.addError(this.text.cannot_drag_to_non_working_day),void(null==ee||ee.revert());this.updateEvent(ee,!0)},eventResizeStart:ee=>{ee.event.extendedProps.workPackage.ignoreNonWorkingDays||this.addBackgroundEventsForNonWorkingDays()},eventResizeStop:()=>this.removeBackGroundEvents(),eventDragStart:ee=>{ee.event.extendedProps.workPackage.ignoreNonWorkingDays||this.addBackgroundEventsForNonWorkingDays()},eventDragStop:ee=>{const{el:ce}=ee;ce.style.removeProperty("pointer-events"),this.removeBackGroundEvents()},eventClick:ee=>{const ce=ee.event.extendedProps.workPackage.id;this.$state.includes("calendar")?this.workPackagesCalendar.openSplitView(ce):this.$state.go("work-packages.show",{workPackageId:ce})}};this.static&&(H.initialView="dayGridWeek"),Promise.all([this.configuration.initialized,this.weekdayService.loadWeekdays().toPromise()]).then(()=>{this.calendarOptions$.next(this.workPackagesCalendar.calendarOptions(H))})}buildHeader(){return!this.static&&{right:"dayGridMonth,dayGridWeek",center:"title",left:"prev,next today"}}openContextMenu(H){const ee=H.target.closest(".fc-event");if(!ee)return;const ce=ee.dataset.workPackageId;this.workPackagesCalendar.showEventContextMenu({workPackageId:ce,event:H})}setupWorkPackagesListener(){this.workPackagesCalendar.workPackagesListener$(()=>{this.alreadyLoaded=!0,this.ucCalendar.getApi().refetchEvents()})}updateResults(H){return this.workPackagesCalendar.warnOnTooManyResults(H,this.static),this.mapToCalendarEvents(H.elements)}mapToCalendarEvents(H){return H.map(ee=>{const ce=this.workPackagesCalendar.eventDate(ee,"start"),se=this.workPackagesCalendar.eventDate(ee,"due"),re=c(se).add(1,"days").format("YYYY-MM-DD");return{title:ee.subject,start:ce,editable:this.workPackagesCalendar.eventDurationEditable(ee),end:re,allDay:!0,className:`__hl_background_type_${ee.type.id||""}`,workPackage:ee}})}updateEvent(H,ee){return(0,n.mG)(this,void 0,void 0,function*(){const ce=this.workPackagesCalendar.updateDates(H,ee);try{const se=yield this.halEditing.save(ce);this.halNotification.showSave(se.resource,se.wasNew)}catch(se){this.halNotification.handleRawError(se,ce.projectedResource),H.revert()}})}handleDateClicked(H){const ee=c(H.endStr).subtract(1,"day").toDate(),ce=this.weekdayService.isNonWorkingDay(H.start)||this.weekdayService.isNonWorkingDay(ee),se={startDate:H.startStr,dueDate:this.workPackagesCalendar.getEndDateFromTimestamp(H.endStr),ignoreNonWorkingDays:ce};this.$state.go((0,O.W)(this.$state,"new"),{defaults:se,tabIdentifier:"overview"})}removeBackGroundEvents(){this.ucCalendar.getApi().getEvents().filter(H=>{var ee;return"background"===(null===(ee=H.source)||void 0===ee?void 0:ee.id)}).forEach(H=>H.remove())}addBackgroundEventsForNonWorkingDays(){const H=this.ucCalendar.getApi();let ee=this.ucCalendar.getApi().view.activeStart;const ce=this.ucCalendar.getApi().view.activeEnd,se=new Array;for(;ee.toString()!==ce.toString();)this.weekdayService.isNonWorkingDay(ee)&&se.push({start:c(ee).format("YYYY-MM-DD"),end:c(ee).add("1","day").format("YYYY-MM-DD")}),ee=c(ee).add("1","day").toDate();se.forEach(re=>{H.addEvent(Object.assign({},re),"background")})}}K.\u0275fac=function(H){return new(H||K)(e.Y36(d.G),e.Y36(v.StateService),e.Y36(a.Z),e.Y36(m.Z),e.Y36(f.q),e.Y36(b.y),e.Y36(e.SBq),e.Y36(C.D),e.Y36(u.kl),e.Y36(B.H7),e.Y36(C.D),e.Y36(k.e),e.Y36(Z.j),e.Y36(I.W),e.Y36(y.R),e.Y36(E.l),e.Y36(T.W),e.Y36(j.u))},K.\u0275cmp=e.Xpm({type:K,selectors:[["op-wp-calendar"]],viewQuery:function(H,ee){if(1&H&&(e.Gf(p.woE,5),e.Gf(R,5,e.SBq)),2&H){let ce;e.iGM(ce=e.CRH())&&(ee.ucCalendar=ce.first),e.iGM(ce=e.CRH())&&(ee.ucCalendarElement=ce.first)}},inputs:{static:"static"},features:[e._Bn([I.W,Z.j]),e.qOj],decls:4,vars:5,consts:[["data-qa-selector","op-wp-calendar",1,"op-wp-calendar",3,"contextmenu"],[4,"ngIf"],["class","op-wp-calendar--notification",3,"textContent",4,"ngIf"],[3,"options",4,"ngIf"],[3,"options"],["ucCalendar",""],[1,"op-wp-calendar--notification",3,"textContent"]],template:function(H,ee){1&H&&(e.TgZ(0,"div",0),e.NdJ("contextmenu",function(se){return ee.openContextMenu(se)}),e.YNc(1,Y,2,1,"ng-container",1),e.ALo(2,"async"),e.YNc(3,X,1,1,"div",2),e.qZA()),2&H&&(e.uIk("data-indicator-name","table"),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,3,ee.calendarOptions$)),e.xp6(2),e.Q6J("ngIf",ee.static))},directives:[J.O5,p.woE],pipes:[J.Ov],styles:[".op-wp-calendar[_ngcontent-%COMP%]{--fc-border-color: #cccccc;min-height:200px;height:100%}.op-wp-calendar--notification[_ngcontent-%COMP%]{font-style:italic;margin-top:.5rem}"],changeDetection:0})},72456:(te,M,t)=>{"use strict";t.d(M,{$:()=>e});var n=t(26942);class e extends n.N{constructor(h){super(),this.I18n=h,this.text={label_email:this.I18n.t("js.label_email"),label_expires_at:this.I18n.t("js.admin.enterprise.trial.form.label_expires_at"),label_maximum_users:this.I18n.t("js.admin.enterprise.trial.form.label_maximum_users"),label_company:this.I18n.t("js.admin.enterprise.trial.form.label_company"),label_domain:this.I18n.t("js.admin.enterprise.trial.form.label_domain"),label_starts_at:this.I18n.t("js.admin.enterprise.trial.form.label_starts_at"),label_subscriber:this.I18n.t("js.admin.enterprise.trial.form.label_subscriber"),text_expired:this.I18n.t("js.admin.enterprise.text_expired"),text_reprieve_days_left:c=>this.I18n.t("js.admin.enterprise.text_reprieve_days_left",{days:c})}}}},42320:(te,M,t)=>{"use strict";t.d(M,{$:()=>K});var n=t(1707),e=t(60312),p=t(77355),h=t(96617),c=t(49685),i=t(96905);function l(ie){const{locale:H}=I18n;return ie[H]||ie.en}var r=t(12877),d=t(2316),f=t(54364);function a(ie,H){if(1&ie&&d._UZ(0,"div",24),2&ie){const ee=d.oxw().ngIf;d.Q6J("textContent",ee.emailError)}}const m=function(ie){return{"-required-highlighting":ie}};function v(ie,H){if(1&ie){const ee=d.EpF();d.TgZ(0,"div",1),d.TgZ(1,"label",20),d._uU(2),d.qZA(),d.TgZ(3,"div",3),d.TgZ(4,"div",21),d.TgZ(5,"input",22),d.NdJ("blur",function(){return d.CHM(ee),d.oxw().checkMailField()}),d.qZA(),d.qZA(),d.qZA(),d.YNc(6,a,1,1,"div",23),d.qZA()}if(2&ie){const ee=H.ngIf,ce=d.oxw();d.xp6(2),d.Oqu(ce.text.label_email),d.xp6(2),d.Q6J("ngClass",d.VKq(3,m,ee.emailError)),d.xp6(2),d.Q6J("ngIf",ee.emailError)}}function C(ie,H){if(1&ie&&d._UZ(0,"p",29),2&ie){const ee=d.oxw(2);d.Q6J("textContent",ee.text.domain_mismatch)}}function u(ie,H){if(1&ie&&d._UZ(0,"p",29),2&ie){const ee=d.oxw().ngIf;d.Q6J("textContent",ee.domainError)}}function k(ie,H){if(1&ie&&(d.TgZ(0,"div",1),d.TgZ(1,"label",25),d._uU(2),d.qZA(),d.TgZ(3,"div",3),d.TgZ(4,"div",21),d._UZ(5,"input",26),d.qZA(),d.qZA(),d.TgZ(6,"div",27),d.YNc(7,C,1,1,"p",28),d.YNc(8,u,1,1,"p",28),d.qZA(),d.qZA()),2&ie){const ee=H.ngIf,ce=d.oxw();d.xp6(2),d.Oqu(ce.text.label_domain),d.xp6(2),d.Q6J("ngClass",d.VKq(4,m,ee.domainError)),d.xp6(3),d.Q6J("ngIf",ce.requestHost!==ce.configuredHost),d.xp6(1),d.Q6J("ngIf",ee.domainError)}}const x=function(ie){return{emailError:ie}},b=function(ie){return{domainError:ie}};class P{constructor(H,ee,ce,se,re,Me){this.elementRef=H,this.I18n=ee,this.formBuilder=ce,this.currentUserService=se,this.configurationService=re,this.eeTrialService=Me,this.userData=this.eeTrialService.current.data||{},this.requestHost=window.location.host,this.configuredHost=this.configurationService.hostName,this.trialForm=this.formBuilder.group({company:[this.userData.company,n.kI.required],first_name:[this.userData.first_name,n.kI.required],last_name:[this.userData.last_name,n.kI.required],email:["",[n.kI.required,n.kI.email]],domain:[this.userData.domain||this.configuredHost,n.kI.required],general_consent:[null,n.kI.required],newsletter_consent:null,language:this.currentUserService.language}),this.text={general_consent:this.I18n.t("js.admin.enterprise.trial.form.general_consent",{link_terms:l({en:"https://www.openproject.org/terms-of-service/",de:"https://www.openproject.org/de/nutzungsbedingungen/"}),link_privacy:l({en:"https://www.openproject.org/data-privacy-and-security/",de:"https://www.openproject.org/de/datenschutz/"})}),label_test_ee:this.I18n.t("js.admin.enterprise.trial.form.test_ee"),label_company:this.I18n.t("js.admin.enterprise.trial.form.label_company"),label_first_name:this.I18n.t("js.admin.enterprise.trial.form.label_first_name"),label_last_name:this.I18n.t("js.admin.enterprise.trial.form.label_last_name"),label_email:this.I18n.t("js.label_email"),label_domain:this.I18n.t("js.admin.enterprise.trial.form.label_domain"),domain_mismatch:this.I18n.t("js.admin.enterprise.trial.form.domain_mismatch"),privacy_policy:this.I18n.t("js.admin.enterprise.trial.form.privacy_policy"),receive_newsletter:this.I18n.t("js.admin.enterprise.trial.form.receive_newsletter",{link:"https://www.openproject.org/newsletter/"}),terms_of_service:this.I18n.t("js.admin.enterprise.trial.form.terms_of_service")}}checkMailField(){""!==this.trialForm.value.email&&this.trialForm.controls.email.errors?this.eeTrialService.store.update({emailInvalid:!0}):this.eeTrialService.store.update({emailInvalid:!1,error:void 0})}}P.\u0275fac=function(H){return new(H||P)(d.Y36(d.SBq),d.Y36(h.D),d.Y36(n.qu),d.Y36(i.S),d.Y36(r.e),d.Y36(c.V))},P.\u0275cmp=d.Xpm({type:P,selectors:[["enterprise-trial-form"]],decls:35,vars:16,consts:[["id","enterprise-trial-form",1,"form",3,"formGroup"],[1,"form--field","-wide-label","-required"],["for","trial-company-name",1,"form--label"],[1,"form--field-container"],[1,"form--text-field-container"],["type","text","id","trial-company-name","formControlName","company",1,"form--text-field"],["for","trial-first-name",1,"form--label"],["type","text","id","trial-first-name","formControlName","first_name",1,"form--text-field"],["for","trial-last-name",1,"form--label"],["type","text","id","trial-last-name","formControlName","last_name",1,"form--text-field"],["class","form--field -wide-label -required",4,"ngIf"],[1,"form--field","-required"],["for","trial-general-consent",1,"form--label-with-check-box","-no-ellipsis"],[1,"form--check-box-container"],["type","checkbox","id","trial-general-consent","formControlName","general_consent","required","",1,"form--check-box"],[3,"innerHTML"],[1,"form--field"],["for","trial-newsletter-consent",1,"form--label-with-check-box","-no-ellipsis"],["type","checkbox","id","trial-newsletter-consent","formControlName","newsletter_consent",1,"form--check-box"],[3,"innerHtml"],["for","trial-email",1,"form--label"],[1,"form--text-field-container",3,"ngClass"],["type","email","id","trial-email","formControlName","email",1,"form--text-field",3,"blur"],["class","form--field-instructions op-ee-trial-email-error",3,"textContent",4,"ngIf"],[1,"form--field-instructions","op-ee-trial-email-error",3,"textContent"],["for","trial-domain-name",1,"form--label"],["type","text","id","trial-domain-name","formControlName","domain","disabled","",1,"form--text-field"],[1,"form--field-instructions"],[3,"textContent",4,"ngIf"],[3,"textContent"]],template:function(H,ee){1&H&&(d.TgZ(0,"form",0),d.TgZ(1,"div",1),d.TgZ(2,"label",2),d._uU(3),d.qZA(),d.TgZ(4,"div",3),d.TgZ(5,"div",4),d._UZ(6,"input",5),d.qZA(),d.qZA(),d.qZA(),d.TgZ(7,"div",1),d.TgZ(8,"label",6),d._uU(9),d.qZA(),d.TgZ(10,"div",3),d.TgZ(11,"div",4),d._UZ(12,"input",7),d.qZA(),d.qZA(),d.qZA(),d.TgZ(13,"div",1),d.TgZ(14,"label",8),d._uU(15),d.qZA(),d.TgZ(16,"div",3),d.TgZ(17,"div",4),d._UZ(18,"input",9),d.qZA(),d.qZA(),d.qZA(),d.YNc(19,v,7,5,"div",10),d.ALo(20,"async"),d.YNc(21,k,9,6,"div",10),d.ALo(22,"async"),d.TgZ(23,"div",11),d.TgZ(24,"div",3),d.TgZ(25,"label",12),d.TgZ(26,"div",13),d._UZ(27,"input",14),d.qZA(),d._UZ(28,"span",15),d.qZA(),d.qZA(),d.qZA(),d.TgZ(29,"div",16),d.TgZ(30,"div",3),d.TgZ(31,"label",17),d.TgZ(32,"div",13),d._UZ(33,"input",18),d.qZA(),d._UZ(34,"span",19),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&H&&(d.Q6J("formGroup",ee.trialForm),d.xp6(3),d.Oqu(ee.text.label_company),d.xp6(6),d.Oqu(ee.text.label_first_name),d.xp6(6),d.Oqu(ee.text.label_last_name),d.xp6(4),d.Q6J("ngIf",d.VKq(12,x,d.lcZ(20,8,ee.eeTrialService.emailError$))),d.xp6(2),d.Q6J("ngIf",d.VKq(14,b,d.lcZ(22,10,ee.eeTrialService.domainTaken$))),d.xp6(7),d.Q6J("innerHTML",ee.text.general_consent,d.oJD),d.xp6(6),d.Q6J("innerHtml",ee.text.receive_newsletter,d.oJD))},directives:[n._Y,n.JL,n.sg,n.Fj,n.JJ,n.u,f.O5,n.Wl,n.Zs,f.mk],pipes:[f.Ov],styles:[".op-ee-trial-email-error[_ngcontent-%COMP%]{width:min-content}"],changeDetection:0});var E=t(33927),T=t(71570),O=t(3606);function I(ie,H){1&ie&&(d.TgZ(0,"div"),d._UZ(1,"enterprise-trial-form"),d.qZA())}function Z(ie,H){1&ie&&(d.TgZ(0,"div"),d._UZ(1,"enterprise-trial-waiting"),d.qZA())}function j(ie,H){if(1&ie&&(d.TgZ(0,"div"),d.TgZ(1,"div",6),d.TgZ(2,"div",7),d.TgZ(3,"span"),d._uU(4),d.qZA(),d.qZA(),d.TgZ(5,"div",8),d._UZ(6,"iframe",9),d.qZA(),d.qZA(),d.qZA()),2&ie){const ee=d.oxw();d.xp6(4),d.Oqu(ee.text.quick_overview),d.xp6(2),d.Q6J("src",ee.trustedEEVideoURL,d.uOi)}}function B(ie,H){if(1&ie){const ee=d.EpF();d.TgZ(0,"div",11),d.TgZ(1,"button",14),d.NdJ("click",function(se){return d.CHM(ee),d.oxw(2).closeModal(se)}),d.qZA(),d.TgZ(2,"button",15),d.NdJ("click",function(){return d.CHM(ee),d.oxw(2).onSubmit()}),d.qZA(),d.qZA()}if(2&ie){const ee=d.oxw().ngIf,ce=d.oxw();d.xp6(1),d.Q6J("textContent",ce.text.button_cancel),d.uIk("title",ce.text.button_cancel),d.xp6(1),d.Q6J("disabled",!ce.trialForm||ce.trialForm.invalid)("textContent",ce.text.button_submit)("hidden","mailSubmitted"===ee.status&&!ee.cancelled),d.uIk("title",ce.text.button_submit)}}function J(ie,H){if(1&ie){const ee=d.EpF();d.TgZ(0,"button",18),d.NdJ("click",function(se){return d.CHM(ee),d.oxw(3).closeModal(se)}),d.qZA()}if(2&ie){const ee=d.oxw(3);d.Q6J("textContent",ee.text.button_continue),d.uIk("title",ee.text.button_continue)}}function R(ie,H){if(1&ie){const ee=d.EpF();d.TgZ(0,"div",11),d.TgZ(1,"button",16),d.NdJ("click",function(){return d.CHM(ee),d.oxw(2).startEnterpriseTrial()}),d.qZA(),d.YNc(2,J,1,2,"button",17),d.qZA()}if(2&ie){const ee=d.oxw().ngIf,ce=d.oxw();d.xp6(1),d.Q6J("textContent",ce.text.button_continue)("disabled",!ee.confirmed)("hidden","startTrial"===ee.status),d.uIk("title",ce.text.button_continue),d.xp6(1),d.Q6J("ngIf","startTrial"===ee.status)}}function F(ie,H){if(1&ie&&(d.TgZ(0,"div",10),d.TgZ(1,"div",11),d.YNc(2,B,3,6,"div",12),d.YNc(3,R,3,5,"ng-template",null,13,d.W1O),d.qZA(),d.qZA()),2&ie){const ee=H.ngIf,ce=d.MAs(4);d.xp6(2),d.Q6J("ngIf",!ee.status||ee.cancelled)("ngIfElse",ce)}}const Y=function(ie,H,ee){return{status:ie,cancelled:H,confirmed:ee}};class K extends e.T{constructor(H,ee,ce,se,re,Me){super(ee,ce,H),this.elementRef=H,this.locals=ee,this.cdRef=ce,this.I18n=se,this.domSanitizer=re,this.eeTrialService=Me,this.text={button_submit:this.I18n.t("js.modals.button_submit"),button_cancel:this.I18n.t("js.modals.button_cancel"),button_continue:this.I18n.t("js.button_continue"),close_popup:this.I18n.t("js.close_popup_title"),heading_confirmation:this.I18n.t("js.admin.enterprise.trial.confirmation"),heading_next_steps:this.I18n.t("js.admin.enterprise.trial.next_steps"),heading_test_ee:this.I18n.t("js.admin.enterprise.trial.test_ee"),quick_overview:this.I18n.t("js.admin.enterprise.trial.quick_overview")},this.headerText$=this.eeTrialService.observe$.pipe((0,E.U)(({status:Ae})=>"mailSubmitted"===Ae?this.text.heading_confirmation:"startTrial"===Ae?this.text.heading_next_steps:this.text.heading_test_ee)),this.showState$=this.eeTrialService.observe$.pipe((0,E.U)(({status:Ae,cancelled:Ye})=>!Ae||Ye?"trial-form":"mailSubmitted"!==Ae||Ye?"overview":"trial-waiting")),this.trustedEEVideoURL=this.trustedURL("https://www.youtube.com/embed/zLMSydhFSkw?autoplay=1")}ngAfterViewInit(){this.trialForm=this.formComponent.trialForm}onSubmit(){this.trialForm.valid&&(this.trialForm.addControl("_type",new n.NI("enterprise-trial")),this.eeTrialService.sendForm(this.trialForm))}startEnterpriseTrial(){this.eeTrialService.setStartTrialStatus()}closeModal(H){this.closeMe(H);const{status:ee,confirmed:ce}=this.eeTrialService.current;if("startTrial"===ee||ce)window.location.reload();else if("mailSubmitted"===ee)return void window.location.reload();this.eeTrialService.store.update({modalOpen:!1})}trustedURL(H){return this.domSanitizer.bypassSecurityTrustResourceUrl(H)}}K.\u0275fac=function(H){return new(H||K)(d.Y36(d.SBq),d.Y36(p.E),d.Y36(d.sBO),d.Y36(h.D),d.Y36(T.H7),d.Y36(c.V))},K.\u0275cmp=d.Xpm({type:K,selectors:[["enterprise-trial-modal"]],viewQuery:function(H,ee){if(1&H&&d.Gf(P,5),2&H){let ce;d.iGM(ce=d.CRH())&&(ee.formComponent=ce.first)}},inputs:{opReferrer:"opReferrer"},features:[d.qOj],decls:13,vars:20,consts:[[1,"spot-modal","op-enterprise-modal"],[1,"spot-modal--header",3,"textContent"],[1,"spot-divider"],[1,"spot-modal--body","spot-container",3,"ngSwitch"],[4,"ngSwitchCase"],["class","spot-action-bar",4,"ngIf"],[1,"onboarding--video-block"],[1,"onboarding--video-text"],[1,"onboarding--video","iframe-target-wrapper"],["frameborder","0","height","400","width","100%","allowfullscreen","",3,"src"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["class","spot-action-bar--right",4,"ngIf","ngIfElse"],["mailSubmitted",""],["data-qa-selector","confirmation-modal--cancel",1,"button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"disabled","textContent","hidden","click"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","disabled","hidden","click"],["class","button button_no-margin -highlight spot-action-bar--action","data-qa-selector","confirmation-modal--confirmed",3,"textContent","click",4,"ngIf"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"]],template:function(H,ee){1&H&&(d.TgZ(0,"div",0),d._UZ(1,"div",1),d.ALo(2,"async"),d._UZ(3,"div",2),d.TgZ(4,"div",3),d.ALo(5,"async"),d.YNc(6,I,2,0,"div",4),d.YNc(7,Z,2,0,"div",4),d.YNc(8,j,7,2,"div",4),d.qZA(),d.YNc(9,F,5,2,"div",5),d.ALo(10,"async"),d.ALo(11,"async"),d.ALo(12,"async"),d.qZA()),2&H&&(d.xp6(1),d.Q6J("textContent",d.lcZ(2,6,ee.headerText$)),d.xp6(3),d.Q6J("ngSwitch",d.lcZ(5,8,ee.showState$)),d.xp6(2),d.Q6J("ngSwitchCase","trial-form"),d.xp6(1),d.Q6J("ngSwitchCase","trial-waiting"),d.xp6(1),d.Q6J("ngSwitchCase","overview"),d.xp6(1),d.Q6J("ngIf",d.kEZ(16,Y,d.lcZ(10,10,ee.eeTrialService.status$),d.lcZ(11,12,ee.eeTrialService.cancelled$),d.lcZ(12,14,ee.eeTrialService.confirmed$))))},directives:[f.RF,f.n9,f.O5,P,O.c],pipes:[f.Ov],styles:[".op-enterprise-modal[_ngcontent-%COMP%]   .onboarding--video-text[_ngcontent-%COMP%]{margin-bottom:1.25rem}"],changeDetection:0})},3606:(te,M,t)=>{"use strict";t.d(M,{c:()=>R});var n=t(96617),e=t(49685),p=t(36293),h=t(83720),c=t(70692),i=t(18869),l=t(2316),r=t(53882),d=t(54364),f=t(72456),a=t(84032);function m(F,Y){if(1&F&&l._UZ(0,"div",3),2&F){const X=l.oxw();l.Q6J("textContent",X.text.label_company)}}function v(F,Y){if(1&F&&(l.TgZ(0,"div",4),l.TgZ(1,"div",5),l._UZ(2,"span",6),l.qZA(),l.qZA()),2&F){const X=l.oxw();l.xp6(2),l.Q6J("textContent",X.company)}}function C(F,Y){if(1&F&&l._UZ(0,"div",3),2&F){const X=l.oxw();l.Q6J("textContent",X.text.label_domain)}}function u(F,Y){if(1&F&&(l.TgZ(0,"div",4),l.TgZ(1,"div",5),l._UZ(2,"span",6),l.qZA(),l.qZA()),2&F){const X=l.oxw();l.xp6(2),l.Q6J("textContent",X.domain)}}function k(F,Y){if(1&F&&l._UZ(0,"div",3),2&F){const X=l.oxw();l.Q6J("textContent",X.text.label_maximum_users)}}function x(F,Y){if(1&F&&(l.TgZ(0,"div",4),l.TgZ(1,"div",5),l._UZ(2,"span",6),l.qZA(),l.qZA()),2&F){const X=l.oxw();l.xp6(2),l.Q6J("textContent",X.userCount)}}function b(F,Y){if(1&F&&l._UZ(0,"div",3),2&F){const X=l.oxw();l.Q6J("textContent",X.text.label_starts_at)}}function y(F,Y){if(1&F&&(l.TgZ(0,"div",4),l.TgZ(1,"div",5),l._UZ(2,"span",6),l.qZA(),l.qZA()),2&F){const X=l.oxw();l.xp6(2),l.Q6J("textContent",X.startsAt)}}function P(F,Y){if(1&F&&l._UZ(0,"div",3),2&F){const X=l.oxw();l.Q6J("textContent",X.text.label_expires_at)}}function E(F,Y){if(1&F&&l._UZ(0,"span",10),2&F){const X=l.oxw(2);l.Q6J("textContent",X.expiredWarningText)}}function T(F,Y){if(1&F&&(l.TgZ(0,"div",4),l.TgZ(1,"div",5),l._UZ(2,"span",6),l.YNc(3,E,1,1,"span",9),l.qZA(),l.qZA()),2&F){const X=l.oxw();l.xp6(2),l.Q6J("textContent",X.expiresAt),l.xp6(1),l.Q6J("ngIf",X.isExpired)}}class O extends f.${constructor(Y,X,K,ie,H,ee){super(K),this.elementRef=Y,this.cdRef=X,this.I18n=K,this.http=ie,this.Gon=H,this.eeTrialService=ee}ngOnInit(){this.subscriber||(this.eeTrialService.userData$.pipe((0,h.x)(),this.untilDestroyed()).subscribe(Y=>{this.formatUserData(Y),this.cdRef.detectChanges()}),this.initialize())}initialize(){const Y=this.Gon.get("ee_trial_key"),{data:X}=this.eeTrialService.current;if(Y&&!X){const K=`${this.eeTrialService.baseUrlAugur}/public/v1/trials/${Y.value}`;this.eeTrialService.store.update({trialLink:K}),this.getUserDataFromAugur(K)}}getUserDataFromAugur(Y){this.http.get(`${Y}/details`,{headers:{[i.i]:"true"}}).toPromise().then(X=>{this.eeTrialService.store.update({data:X}),this.eeTrialService.retryConfirmation()}).catch(()=>{this.eeTrialService.getToken()})}formatUserData(Y){this.subscriber=`${Y.first_name} ${Y.last_name}`,this.email=Y.email,this.company=Y.company,this.domain=Y.domain}}function I(F,Y){if(1&F){const X=l.EpF();l.TgZ(0,"span",5),l._uU(1),l.TgZ(2,"button",6),l.NdJ("click",function(){return l.CHM(X),l.oxw(2).resendMail()}),l._uU(3),l.qZA(),l.qZA()}if(2&F){const X=l.oxw(2);l.xp6(1),l.hij(" ",X.text.status_waiting," "),l.xp6(2),l.hij(" ",X.text.resend,"")}}function Z(F,Y){if(1&F&&(l.TgZ(0,"span"),l._uU(1),l.qZA()),2&F){const X=l.oxw(2);l.xp6(1),l.Oqu(X.text.session_timeout)}}function j(F,Y){if(1&F&&(l.TgZ(0,"span",7),l._uU(1),l.qZA()),2&F){const X=l.oxw(2);l.xp6(1),l.hij(" ",X.text.status_confirmed," ")}}function B(F,Y){if(1&F&&(l.TgZ(0,"div",1),l._UZ(1,"enterprise-active-trial"),l.TgZ(2,"p"),l._uU(3),l.qZA(),l.TgZ(4,"p"),l.TgZ(5,"span"),l._uU(6),l.qZA(),l.YNc(7,I,4,2,"span",2),l.YNc(8,Z,2,1,"span",3),l.YNc(9,j,2,1,"ng-template",null,4,l.W1O),l.qZA(),l.qZA()),2&F){const X=Y.ngIf,K=l.MAs(10),ie=l.oxw();l.xp6(3),l.Oqu(ie.text.confirmation_info(ie.created,ie.email)),l.xp6(3),l.hij("",ie.text.status_label," "),l.xp6(1),l.Q6J("ngIf",!X.confirmed)("ngIfElse",K),l.xp6(1),l.Q6J("ngIf",X.cancelled)}}O.\u0275fac=function(Y){return new(Y||O)(l.Y36(l.SBq),l.Y36(l.sBO),l.Y36(n.D),l.Y36(r.eN),l.Y36(a.U),l.Y36(e.V))},O.\u0275cmp=l.Xpm({type:O,selectors:[["enterprise-active-trial"]],features:[l.qOj],decls:21,vars:14,consts:[["data-qa-selector","op-enterprise--active-token",1,"op-enterprise--active-token"],[1,"attributes-group"],[1,"attributes-key-value"],[1,"attributes-key-value--key",3,"textContent"],[1,"attributes-key-value--value-container"],[1,"attributes-key-value--value","-text"],[3,"textContent"],["class","attributes-key-value--key",3,"textContent",4,"ngIf"],["class","attributes-key-value--value-container",4,"ngIf"],["class","expired-warning",3,"textContent",4,"ngIf"],[1,"expired-warning",3,"textContent"]],template:function(Y,X){1&Y&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l.TgZ(2,"div",2),l._UZ(3,"div",3),l.TgZ(4,"div",4),l.TgZ(5,"div",5),l._UZ(6,"span",6),l.qZA(),l.qZA(),l._UZ(7,"div",3),l.TgZ(8,"div",4),l.TgZ(9,"div",5),l._UZ(10,"span",6),l.qZA(),l.qZA(),l.YNc(11,m,1,1,"div",7),l.YNc(12,v,3,1,"div",8),l.YNc(13,C,1,1,"div",7),l.YNc(14,u,3,1,"div",8),l.YNc(15,k,1,1,"div",7),l.YNc(16,x,3,1,"div",8),l.YNc(17,b,1,1,"div",7),l.YNc(18,y,3,1,"div",8),l.YNc(19,P,1,1,"div",7),l.YNc(20,T,4,2,"div",8),l.qZA(),l.qZA(),l.qZA()),2&Y&&(l.xp6(3),l.Q6J("textContent",X.text.label_subscriber),l.xp6(3),l.Q6J("textContent",X.subscriber),l.xp6(1),l.Q6J("textContent",X.text.label_email),l.xp6(3),l.Q6J("textContent",X.email),l.xp6(1),l.Q6J("ngIf",X.company),l.xp6(1),l.Q6J("ngIf",X.company),l.xp6(1),l.Q6J("ngIf",X.domain),l.xp6(1),l.Q6J("ngIf",X.domain),l.xp6(1),l.Q6J("ngIf",X.userCount),l.xp6(1),l.Q6J("ngIf",X.userCount),l.xp6(1),l.Q6J("ngIf",X.startsAt),l.xp6(1),l.Q6J("ngIf",X.startsAt),l.xp6(1),l.Q6J("ngIf",X.expiresAt),l.xp6(1),l.Q6J("ngIf",X.expiresAt))},directives:[d.O5],styles:[".op-enterprise--active-token[_ngcontent-%COMP%]   .attributes-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.op-enterprise--active-token[_ngcontent-%COMP%]   .expired-warning[_ngcontent-%COMP%]{margin-left:.4rem;color:red;font-weight:bold}"]});const J=function(F,Y){return{confirmed:F,cancelled:Y}};class R{constructor(Y,X,K,ie,H,ee){this.elementRef=Y,this.I18n=X,this.http=K,this.toastService=ie,this.eeTrialService=H,this.timezoneService=ee,this.created=this.timezoneService.formattedDate((new Date).toString()),this.email="",this.text={confirmation_info:(ce,se)=>this.I18n.t("js.admin.enterprise.trial.confirmation_info",{date:ce,email:se}),resend:this.I18n.t("js.admin.enterprise.trial.resend_link"),resend_success:this.I18n.t("js.admin.enterprise.trial.resend_success"),resend_warning:this.I18n.t("js.admin.enterprise.trial.resend_warning"),session_timeout:this.I18n.t("js.admin.enterprise.trial.session_timeout"),status_confirmed:this.I18n.t("js.admin.enterprise.trial.status_confirmed"),status_label:this.I18n.t("js.admin.enterprise.trial.status_label"),status_waiting:this.I18n.t("js.admin.enterprise.trial.status_waiting")}}ngOnInit(){const Y=window.gon.ee_trial_key;if(Y){const X=Y.created.split(" ")[0];this.created=this.timezoneService.formattedDate(X)}this.eeTrialService.userData$.pipe((0,h.x)()).subscribe(X=>{this.email=X.email})}resendMail(){const{resendLink:Y}=this.eeTrialService.store.getValue();!Y||(this.eeTrialService.store.update({cancelled:!1}),this.http.post(Y,{},{headers:{[i.i]:"true"}}).toPromise().then(()=>{this.toastService.addSuccess(this.text.resend_success),this.eeTrialService.retryConfirmation()}).catch(()=>{const{trialLink:X}=this.eeTrialService.store.getValue();X?this.eeTrialService.getToken():this.toastService.addError(this.text.resend_warning)}))}}R.\u0275fac=function(Y){return new(Y||R)(l.Y36(l.SBq),l.Y36(n.D),l.Y36(r.eN),l.Y36(p.kl),l.Y36(e.V),l.Y36(c.B))},R.\u0275cmp=l.Xpm({type:R,selectors:[["enterprise-trial-waiting"]],decls:3,vars:8,consts:[["class","op-ee-trial-waiting",4,"ngIf"],[1,"op-ee-trial-waiting"],["class","op-ee-trial-waiting-status--waiting","data-qa-selector","op-ee-trial-waiting-status--waiting",4,"ngIf","ngIfElse"],[4,"ngIf"],["confirmedStatus",""],["data-qa-selector","op-ee-trial-waiting-status--waiting",1,"op-ee-trial-waiting-status--waiting"],["data-qa-selector","op-ee-trial-waiting-resend-link",1,"spot-link","op-ee-trial-waiting-resend-link",3,"click"],["data-qa-selector","op-ee-trial-waiting-status--confirmed",1,"op-ee-trial-waiting-status--confirmed","icon-yes"]],template:function(Y,X){1&Y&&(l.YNc(0,B,11,5,"div",0),l.ALo(1,"async"),l.ALo(2,"async")),2&Y&&l.Q6J("ngIf",l.WLB(5,J,l.lcZ(1,1,X.eeTrialService.confirmed$),l.lcZ(2,3,X.eeTrialService.cancelled$)))},directives:[d.O5,O],pipes:[d.Ov],styles:[".op-ee-trial-waiting-status--confirmed[_ngcontent-%COMP%]{color:var(--button--alt-highlight-background-color)}.op-ee-trial-waiting-status--waiting[_ngcontent-%COMP%]{color:orange}"]})},49685:(te,M,t)=>{"use strict";t.d(M,{V:()=>u});var n=t(3786),e=t(19100),p=t(9170),h=t(33927),c=t(92597),i=t(96617),l=t(70233),r=t(36293),d=t(18869);let a=class extends e.yh{constructor(){super({modalOpen:!1,confirmed:!1,cancelled:!1,emailInvalid:!1})}};a=(0,n.gn)([(0,e.yC)({name:"enterprise-trial"}),(0,n.w6)("design:paramtypes",[])],a);var m=t(63863),v=t(2316),C=t(53882);class u{constructor(x,b,y,P){this.I18n=x,this.http=b,this.pathHelper=y,this.toastService=P,this.store=new a,this.query=new e.AE(this.store),this.confirmed$=this.query.select("confirmed"),this.cancelled$=this.query.select("cancelled"),this.status$=this.query.select("status"),this.observe$=this.query.select(),this.userData$=this.query.select("data").pipe((0,p.h)(m.Z)),this.emailError$=this.query.select().pipe((0,h.U)(({error:T,emailInvalid:O})=>{if(O)return this.text.invalid_email;const I=null==T?void 0:T.error;return T&&"user_already_created_trial"===I.identifier?this.text.taken_email:null}),(0,c.d)(1)),this.domainTaken$=this.query.select().pipe((0,h.U)(({error:T})=>{const O=null==T?void 0:T.error;return T&&"domain_taken"===O.identifier?this.text.taken_domain:null}),(0,c.d)(1)),this.text={invalid_email:this.I18n.t("js.admin.enterprise.trial.form.invalid_email"),taken_email:this.I18n.t("js.admin.enterprise.trial.form.taken_email"),taken_domain:this.I18n.t("js.admin.enterprise.trial.form.taken_domain")};const E=window.gon;this.baseUrlAugur=E.augur_url,this.tokenVersion=E.token_version,E.ee_trial_key&&this.setMailSubmittedStatus()}sendForm(x){const b=Object.assign(Object.assign({},x.value),{token_version:this.tokenVersion});return this.http.post(`${this.baseUrlAugur}/public/v1/trials`,b,{headers:{[d.i]:"true"}}).toPromise().then(y=>{const P=y._links.self.href,E=x.value;this.store.update({trialLink:P,data:E,cancelled:!1}),this.saveTrialKey(P),this.retryConfirmation()}).catch(y=>{if(422===y.status||400===y.status)this.store.update({error:y});else{const P=y.error.description;this.toastService.addWarning(P||I18n.t("js.error.internal"))}})}getToken(){this.http.get(this.store.getValue().trialLink,{headers:{[d.i]:"true"}}).toPromise().then(x=>(0,n.mG)(this,void 0,void 0,function*(){this.store.update({confirmed:!0}),x.token_retrieved||(yield this.saveToken(x.token))})).catch(x=>{const b=x.error;if(422===x.status&&"waiting_for_email_verification"===b.identifier){const y=b._links.resend.href;this.store.update({resendLink:y});const{status:P,cancelled:E}=this.store.getValue();(!P||E)&&this.saveTrialKey(y),this.setMailSubmittedStatus(),this.store.update({confirmed:!1})}else(null==b?void 0:b.message)?this.toastService.addError(b.message):this.toastService.addError(x.error||I18n.t("js.error.internal"))})}saveTrialKey(x){const b=x.split("/")[6];return this.http.post(`${this.pathHelper.appBasePath}/admin/enterprise/save_trial_key`,{trial_key:b},{withCredentials:!0}).toPromise().catch(y=>{const P=y.error;this.toastService.addError(P.message||y.message||y)})}saveToken(x){return this.http.post(`${this.pathHelper.appBasePath}/admin/enterprise`,{enterprise_token:{encoded_token:x}},{withCredentials:!0}).toPromise().then(()=>{const{modalOpen:b}=this.store.getValue();b||setTimeout(()=>{window.location.reload()},500)}).catch(b=>{this.http.delete(`${this.pathHelper.api.v3.apiV3Base}/admin/enterprise/delete_trial_key`,{withCredentials:!0}).toPromise();const y=b.error;this.toastService.addError(y.description||I18n.t("js.error.internal"))})}retryConfirmation(x=5e3,b=60){const{cancelled:y,confirmed:P}=this.store.getValue();y||P||(0===b?this.store.update({cancelled:!0}):(this.getToken(),setTimeout(()=>{this.retryConfirmation(x,b-1)},x)))}setStartTrialStatus(){this.store.update({status:"startTrial"})}setMailSubmittedStatus(){this.store.update({status:"mailSubmitted"})}get current(){return this.store.getValue()}}u.\u0275fac=function(x){return new(x||u)(v.LFG(i.D),v.LFG(C.eN),v.LFG(l.j),v.LFG(r.kl))},u.\u0275prov=v.Yz7({token:u,factory:u.\u0275fac})},12839:(te,M,t)=>{"use strict";t.d(M,{b:()=>m,o:()=>v});var n=t(96617),e=t(42320),p=t(77355),h=t(49685),c=t(70692),i=t(83720),l=t(84032),r=t(2316),d=t(53882),f=t(54364);const a=function(C){return{"tooltip--top":C}},m="free-trial-button";class v{constructor(u,k,x,b,y,P,E,T){this.I18n=u,this.opModalService=k,this.injector=x,this.http=b,this.cdRef=y,this.Gon=P,this.eeTrialService=E,this.timezoneService=T,this.created=this.timezoneService.formattedDate((new Date).toString()),this.email="",this.text={button_trial:this.I18n.t("js.admin.enterprise.upsale.button_start_trial"),confirmation_info:(O,I)=>this.I18n.t("js.admin.enterprise.trial.confirmation_info",{date:O,email:I})}}ngOnInit(){this.eeTrialService.userData$.pipe((0,i.x)()).subscribe(u=>{this.email=u.email,this.cdRef.detectChanges()}),this.initialize()}initialize(){const u=this.Gon.get("ee_trial_key");if(u){const k=u.created.split(" ")[0];this.created=this.timezoneService.formattedDate(k);const{data:x}=this.eeTrialService.store.getValue();if(x){const b=`${this.eeTrialService.baseUrlAugur}/public/v1/trials/${u.value}`;this.eeTrialService.store.update({trialLink:b}),this.getUserDataFromAugur(b)}}}getUserDataFromAugur(u){this.http.get(`${u}/details`).toPromise().then(k=>{this.eeTrialService.store.update({data:k}),this.eeTrialService.retryConfirmation()}).catch(()=>{this.eeTrialService.getToken()})}openTrialModal(){this.eeTrialService.store.update({cancelled:!0,modalOpen:!0}),this.opModalService.show(e.$,this.injector)}get trialRequested(){return!!this.Gon.get("ee_trial_key")}}v.\u0275fac=function(u){return new(u||v)(r.Y36(n.D),r.Y36(p.S),r.Y36(r.zs3),r.Y36(d.eN),r.Y36(r.sBO),r.Y36(l.U),r.Y36(h.V),r.Y36(c.B))},v.\u0275cmp=r.Xpm({type:v,selectors:[["free-trial-button"]],decls:3,vars:6,consts:[[3,"ngClass"],["type","button",1,"button","-alt-highlight",3,"disabled","click"]],template:function(u,k){1&u&&(r.TgZ(0,"div",0),r.TgZ(1,"button",1),r.NdJ("click",function(){return k.openTrialModal()}),r._uU(2),r.qZA(),r.qZA()),2&u&&(r.Q6J("ngClass",r.VKq(4,a,k.trialRequested)),r.uIk("data-tooltip",k.trialRequested?k.text.confirmation_info(k.created,k.email):""),r.xp6(1),r.Q6J("disabled",k.trialRequested),r.xp6(1),r.hij(" ",k.text.button_trial," "))},directives:[f.mk],encapsulation:2,changeDetection:0})},95060:(te,M,t)=>{"use strict";t.d(M,{d:()=>n});class n{constructor(p,h=null,c="",i="get",l=!1,r,d="application/json",f){this.requestMethod=p,this.href=h,this.title=c,this.method=i,this.templated=l,this.payload=r,this.type=d,this.identifier=f}static fromObject(p,h){return new n((c,i,l,r)=>p.request(c,i,l,r).toPromise(),h.href,h.title,h.method,h.templated,h.payload,h.type,h.identifier)}$fetch(...p){const[h,c]=p;return this.requestMethod(this.method,this.href,h,c)}$prepare(p){if(!this.templated)throw new Error(`The link ${this.href} is not templated.`);let h=_.clone(this.href)||"";return _.each(p,(c,i)=>{const l=new RegExp(`{${i}}`);h=h.replace(l,c)}),new n(this.requestMethod,h,this.title,this.method,!1,this.payload,this.type,this.identifier).$callable()}$callable(){const p=(...h)=>this.$fetch(...h);return _.extend(p,{$link:this,href:this.href,title:this.title,method:this.method,templated:this.templated,payload:this.payload,type:this.type,identifier:this.identifier}),p}}},91720:(te,M,t)=>{"use strict";t.d(M,{fK:()=>c,FQ:()=>h,EZ:()=>i});var p,n=t(43348),e=t(95060);function h(l){return _.isNil(l)?[]:l.map(r=>r.$copy())}function c(l){return _.isNil(l)?l:l.$copy()}function i(l,r){function f(b,y=!0){return _.isNil(b)?b:b._links||b._embedded||b._type?l.createHalResource(b,y):b}function C(b,y){const P=`$${b}`,E=`_${b}`,T=r.$source[E];_.isObject(T)&&Object.keys(T).forEach(O=>{p.lazy(r[P],O,()=>y(T[O]))})}function x(b,y){const P=Array.isArray(b);if(b)if(P)r.$source._links[y]=b.map(E=>({href:E.href}));else if(b.hasOwnProperty("$link")){const E=b.$link;E.href&&(r.$source._links[y]=E)}else"href"in b&&(r.$source._links[y]={href:b.href});else r.$source._links[y]={href:null};return r.$embedded&&r.$embedded[y]&&(r.$embedded[y]=b,r.$source._embedded[y]=P?b.map(E=>E.$source):_.get(b,"$source",b)),b}r.$source._links||(r.$source._links={}),r.$source._links.self||(r.$source._links.self={href:null}),C("links",b=>Array.isArray(b)?b.map(y=>e.d.fromObject(l,y).$callable()):e.d.fromObject(l,b).$callable()),C("embedded",b=>Array.isArray(b)?b.map(y=>f(y,!0)):(_.isObject(b)&&_.each(b,(y,P)=>{y&&(y._embedded||y._links)&&p.lazy(b,P,()=>f(y,!0))}),f(b,!0))),r.$embeddableKeys().forEach(b=>{Object.defineProperty(r,b,{get:()=>f(r.$source[b],!0),set(y){r.$source[b]=y},enumerable:!0,configurable:!0})}),r.$linkableKeys().forEach(b=>{p.lazy(r,b,()=>{const y=r.$links[b].$link||r.$links[b];if(Array.isArray(y)){const E=y.map(T=>l.createLinkedResource(r,b,T.$link));var P=new n(...E).on("change",()=>{P.forEach(T=>{T.$link||P.splice(P.indexOf(T),1)}),r.$source._links[b]=P.map(T=>T.$link)});return P}return y.href?"get"!==y.method?e.d.fromObject(l,y).$callable():l.createLinkedResource(r,b,y):null},y=>x(y,b))}),!r.$source._embedded||Object.keys(r.$source._embedded).forEach(b=>{p.lazy(r,b,()=>r.$embedded[b],y=>x(y,b))})}(p||(p={})).lazy=function(d,f,a,m){if(_.isObject(d)){let C,v=!1;const u={get:()=>(v||(C=a(),v=!0),C),set:()=>{},configurable:!0,enumerable:!0};m&&(u.set=k=>{C=m(k),v=!0}),Object.defineProperty(d,f,u)}}},10190:(te,M,t)=>{"use strict";function n(e){const p=(e||"").split("/").pop();return decodeURIComponent(p)}t.d(M,{Z:()=>n})},84699:(te,M,t)=>{"use strict";t.d(M,{m:()=>n,Z:()=>e});const n="new";function e(p){return!p.id||p.id===n}},48934:(te,M,t)=>{"use strict";function n(e){return!(!e.id||"new"===e.id)}t.d(M,{Z:()=>n})},18869:(te,M,t)=>{"use strict";t.d(M,{i:()=>e,s:()=>p});var n=t(2316);const e="X-External-Request";class p{intercept(c,i){return"true"!==c.headers.get(e)?this.handleAuthenticatedRequest(c,i):this.handleExternalRequest(c,i)}handleExternalRequest(c,i){const l=c.clone({withCredentials:!1,headers:c.headers.delete(e)});return i.handle(l)}handleAuthenticatedRequest(c,i){const l=jQuery("meta[name=csrf-token]").attr("content");let r=c.headers.set("X-Authentication-Scheme","Session").set("X-Requested-With","XMLHttpRequest");l&&(r=r.set("X-CSRF-TOKEN",l));const d=c.clone({withCredentials:!0,headers:r});return i.handle(d)}}p.\u0275fac=function(c){return new(c||p)},p.\u0275prov=n.Yz7({token:p,factory:p.\u0275fac})},6496:(te,M,t)=>{"use strict";t.d(M,{f:()=>D});var n=t(2316),e=t(54364),p=t(96617),h=t(80044),c=t(85758),i=t(8849),l=t(53882);class r extends n.qLn{constructor(V){super(),this.I18n=V,this.text={internal_error:this.I18n.t("js.error.internal")}}handleError(V){var me,$;let Se=this.text.internal_error;(null===(me=V)||void 0===me?void 0:me.rejection)instanceof i.o?this.handleError(V.rejection):(V instanceof i.o?(console.error("Returned HTTP HAL error resource %O",V.message),Se=(null===($=V.httpError)||void 0===$?void 0:$.status)>=500?`${Se} ${V.message}`:V.message,r.captureError(V.httpError)):V instanceof c.Xf?(console.error("Returned error resource %O",V),Se+=` ${V.errorMessages.join("\n")}`):V instanceof h.X?(console.error("Returned hal resource %O",V),Se+=`Resource returned ${V.name}`):V instanceof Error?window.ErrorReporter.captureException(V):V instanceof l.UA?(r.captureError(V),Se=V.message):"string"==typeof V&&(window.ErrorReporter.captureMessage(V),Se=V),super.handleError(Se))}static captureError(V){window.ErrorReporter.captureException(V)}}r.\u0275fac=function(V){return new(V||r)(n.LFG(p.D))},r.\u0275prov=n.Yz7({token:r,factory:r.\u0275fac});var d=t(24897),f=t(84481),a=t(20501),m=t(17577),v=t(53407),C=t(67248);class u extends h.X{constructor(){super(...arguments),this.attachmentsBackend=!1}}const k=(0,C.n)(u);class x extends h.X{constructor(){super(...arguments),this.attachmentsBackend=!1}}const b=(0,C.n)(x);class y extends h.X{constructor(){super(...arguments),this.attachmentsBackend=!1}}const P=(0,C.n)(y);var E=t(34863),T=t(54475),O=t(75421),I=t(46384);class Z extends h.X{get state(){return this.states.timeEntries.get(this.id)}$linkableKeys(){return _.without(super.$linkableKeys(),"schema")}}class j extends h.X{}var B=t(92814);class J extends h.X{}var R=t(4816),F=t(9214);class Y extends h.X{}class X extends h.X{}class K extends h.X{get state(){return this.states.types.get(this.href)}}var ie=t(10190);class H extends h.X{get id(){return this.$source.id||(0,ie.Z)(this.href)}set id(V){this.$source.id=V}}var ee=t(63085);class ce extends h.X{getErrors(){const V=_.values(this.validationErrors),me=V.length;if(0===me)return null;let $;return 1===me?$=new c.Xf(this.injector,V[0],!0,this.halInitializer,"Error"):($=new c.Xf(this.injector,{},!0,this.halInitializer,"Error"),$.errorIdentifier=c.$5,$.errors=V),$.isValidationError=!0,$}}class se extends h.X{}const re=(0,C.n)(se);class Me extends h.X{get state(){return this.states.schemas.get(this.href)}get availableAttributes(){return _.keys(this.$source).filter(V=>0!==V.indexOf("_"))}attributeFromLocalizedName(V){let me=null;for(const $ of this.availableAttributes){const Se=this[$];if((null==Se?void 0:Se.name)===V){me=$;break}}return me}}class Ye extends h.X{forValue(V){return this.dependencies[V]}}class ze extends Me{constructor(){super(...arguments),this.type="QueryFilterInstanceSchema"}get availableOperators(){return this.operator.allowedValues}get allowedFilterValue(){return this.filter.allowedValues instanceof a.Y?this.filter.allowedValues.elements[0]:this.filter.allowedValues[0]}$initialize(V){super.$initialize(V),V._dependencies&&(this.dependency=new Ye(this.injector,V._dependencies[0],!0,this.halInitializer,"SchemaDependency"))}getFilter(){const V=this.operator.allowedValues[0],me=this.filter.allowedValues[0],$={name:me.name,_links:{filter:me.$source._links.self,schema:this.$source._links.self,operator:V.$source._links.self}};return this.definesAllowedValues()?$._links.values=[]:$.values=[],new ee.L(this.injector,$,!0,this.halInitializer,"QueryFilterInstance")}isValueRequired(){return!!this.values}isResourceValue(){return!(!this.values||!this.values.allowedValues)}loadedAllowedValues(){var V;return Array.isArray(null===(V=this.values)||void 0===V?void 0:V.allowedValues)}resultingSchema(V){const me=this.$source,$=this.dependency.forValue(V.href.toString()),Se={};return _.merge(Se,me,$),new ze(this.injector,Se,!0,this.halInitializer,"QueryFilterInstanceSchema")}definesAllowedValues(){return _.some(this._dependencies[0].dependencies,V=>V.values&&V.values._links&&V.values._links.allowedValues)}}class Xe extends a.Y{}var it=t(69057),at=t(63588);const lt={WorkPackage:{cls:d.X,attrTypes:{parent:"WorkPackage",ancestors:"WorkPackage",children:"WorkPackage",relations:"Relation",schema:"Schema",status:"Status",type:"Type"}},Activity:{cls:h.X,attrTypes:{user:"User"}},"Activity::Comment":{cls:h.X,attrTypes:{user:"User"}},"Activity::Revision":{cls:h.X,attrTypes:{user:"User"}},Relation:{cls:it.d,attrTypes:{from:"WorkPackage",to:"WorkPackage"}},Schema:{cls:Me},Type:{cls:K},Status:{cls:E.F},SchemaDependency:{cls:Ye},Error:{cls:c.Xf},User:{cls:f.q},Group:{cls:Y},Collection:{cls:a.Y},WorkPackageCollection:{cls:Xe},AttachmentCollection:{cls:T.e},Query:{cls:m.P,attrTypes:{filters:"QueryFilterInstance"}},Form:{cls:ce,attrTypes:{payload:"FormPayload"}},FormPayload:{cls:h.X,attrTypes:{attachments:"AttachmentsCollection"}},QueryFilterInstance:{cls:ee.L,attrTypes:{schema:"QueryFilterInstanceSchema",filter:"QueryFilter",operator:"QueryOperator"}},QueryFilterInstanceSchema:{cls:ze},QueryFilter:{cls:at.e},Root:{cls:X},QueryOperator:{cls:H},HelpText:{cls:re},CustomAction:{cls:v.M},WikiPage:{cls:k},MeetingContent:{cls:b},Post:{cls:P},Project:{cls:F.c},Role:{cls:R.q},Grid:{cls:I.H},GridWidget:{cls:O.z},TimeEntry:{cls:Z},Membership:{cls:J},News:{cls:j},Version:{cls:B.g}};var de=t(91923),oe=t(67727);class D{}D.\u0275fac=function(V){return new(V||D)},D.\u0275mod=n.oAB({type:D}),D.\u0275inj=n.cJS({providers:[{provide:n.qLn,useClass:r},{provide:n.ip1,useFactory:function(G){return()=>{_.each(lt,(V,me)=>G.registerResource(me,V))}},deps:[de.u],multi:!0},oe.W],imports:[[e.ez]]})},54475:(te,M,t)=>{"use strict";t.d(M,{e:()=>e});var n=t(20501);class e extends n.Y{$initialize(h){super.$initialize(h),this.elements=this.elements||[]}}},20501:(te,M,t)=>{"use strict";t.d(M,{Y:()=>e});var n=t(80044);class e extends n.X{updateElements(){return this.href?this.$load().then(h=>this.elements=h.elements):Promise.resolve()}}},53407:(te,M,t)=>{"use strict";t.d(M,{M:()=>e});var n=t(80044);class e extends n.X{}},85758:(te,M,t)=>{"use strict";t.d(M,{$5:()=>p,G$:()=>h,Xf:()=>c});var n=t(80044);const p="urn:openproject-org:api:v3:errors:MultipleErrors";function h(i){return"_type"in i&&"message"in i&&"errorIdentifier"in i}class c extends n.X{constructor(){super(...arguments),this.isValidationError=!1}toString(){return`[ErrorResource ${this.message}]`}get errorMessages(){return this.isMultiErrorMessage()?this.errors.map(l=>l.message):[this.message]}isMultiErrorMessage(){return this.errorIdentifier===p}getInvolvedAttributes(){let l=[];return this.details?l=[{details:this.details}]:this.errors&&(l=this.errors),_.flatten(l.map(r=>r.errorIdentifier===p?this.extractMultiError(r)[0]:r.details.attribute))}getMessagesPerAttribute(){const l={};return this.details?l[this.details.attribute]=[this.message]:_.forEach(this.errors,r=>{if(r.errorIdentifier===p){const[d,f]=this.extractMultiError(r),a=l[d]||[];l[d]=a.concat(f)}else l[r.details.attribute]?l[r.details.attribute].push(r.message):l[r.details.attribute]=[r.message]}),l}extractMultiError(l){const{attribute:r}=l.errors[0].details;return[r,l.errors.map(f=>f.message)]}}},46384:(te,M,t)=>{"use strict";t.d(M,{H:()=>i});var n=t(3786),e=t(80044),p=t(75421),h=t(67248);class c extends e.X{constructor(){super(...arguments),this.attachmentsBackend=!0}$initialize(r){super.$initialize(r),this.widgets=this.widgets.map(d=>{const f=new p.z(this.injector,d,!0,this.halInitializer,"GridWidget");return f.grid=this,f})}updateAttachments(){return(0,n.mG)(this,void 0,void 0,function*(){return this.attachments.$update().then(()=>(this.states.forResource(this).putValue(this),this.attachments))})}}const i=(0,h.n)(c)},75421:(te,M,t)=>{"use strict";t.d(M,{z:()=>c});var n=t(3786),e=t(80044),p=t(29161),h=t(91923);class c extends e.X{get height(){return this.endRow-this.startRow}get width(){return this.endColumn-this.startColumn}get schema(){return this.halResource.createHalResource({_type:"Schema"},!0)}}(0,n.gn)([(0,p.W)(),(0,n.w6)("design:type",h.u)],c.prototype,"halResource",void 0)},80044:(te,M,t)=>{"use strict";t.d(M,{X:()=>l});var n=t(3786),e=t(87853),p=t(96617),h=t(29161),c=t(10190),i=t(84699);class l{constructor(d,f,a,m,v){this.injector=d,this.$source=f,this.$loaded=a,this.halInitializer=m,this.$links={},this.$embedded={},this.$halType=v,this.$initialize(f)}static getEmptyResource(d={href:null}){return{_links:{self:d}}}static matchFromLink(d,f){const a=new RegExp(`/api/v3/${f}/(\\d+)`).exec(d);return a&&a[1]}$initialize(d){this.$source=d.$source||d,this.halInitializer(this)}toString(){return this.href?`[HalResource href=${this.href}]`:`[HalResource id=${this.id}]`}get id(){if(this.$source.id)return this.$source.id.toString();const d=(0,c.Z)(this.href);return/^\d+$/.exec(d)?d:null}set id(d){this.$source.id=d}retainFrom(d){this.__initialized_at=d.__initialized_at}$copy(d={}){return new(0,this.constructor)(this.injector,_.merge(this.$plain(),d),this.$loaded,this.halInitializer,this.$halType)}$plain(){return _.cloneDeep(this.$source)}get $isHal(){return!0}get $link(){return this.$links.self.$link}get name(){return this._name||this.$link.title||""}set name(d){this._name=d}get href(){return this.$link.href}get state(){return null}push(d){return this.state&&this.state.putValue(d),Promise.resolve()}previewPath(){if((0,i.Z)(this)&&this.project)return this.project.href}getEditorContext(d){return{type:"constrained"}}$load(d=!1){if(!this.state)return this.$loadResource(d);const{state:f}=this;return d&&f.clear(),f.putFromPromiseIfPristine(()=>this.$loadResource(d)),f.valuesPromise().then(a=>(this.$initialize(a),this.$loaded=!0,this))}$loadResource(d=!1){if(!d){if(this.$loaded)return Promise.resolve(this);if(!this.$loaded&&this.$self)return this.$self}return this.$loaded=!1,this.$self=this.$links.self({}).then(f=>(this.$loaded=!0,this.$initialize(f.$source),this)),this.$self}$update(){return this.$load(!0)}$embeddableKeys(){const d=Object.keys(this.$source);return _.without(d,"_links","_embedded","id")}$linkableKeys(){const d=Object.keys(this.$links);return _.without(d,"self")}}(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",e.G)],l.prototype,"states",void 0),(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",p.D)],l.prototype,"I18n",void 0)},67248:(te,M,t)=>{"use strict";t.d(M,{n:()=>f});var n=t(67727),e=t(70233),p=t(36293),h=t(12877),c=t(33276),i=t(48249),l=t(76825),r=t(54475),d=t(84699);function f(a){return class extends a{get canAddAttachments(){return!!this.$links.addAttachment||(0,d.Z)(this)}get hasAttachments(){return _.get(this.attachments,"elements.length",0)>0}lookupDownloadLocationByName(m){if(!this.attachments||!this.attachments.elements)return null;const v=_.find(this.attachments.elements,C=>C.name===m);return _.get(v,"staticDownloadLocation.href",null)}removeAttachment(m){return _.pull(this.attachments.elements,m),m.$isHal?m.delete().then(()=>{this.attachmentsBackend?this.updateAttachments():this.attachments.count=Math.max(this.attachments.count-1,0)}).catch(v=>{this.halNotification.handleRawError(v,this),this.attachments.elements.push(m)}):Promise.resolve()}updateAttachments(){return this.attachments.updateElements().then(()=>(this.updateState(),this.attachments))}uploadAttachments(m){const{uploads:v,finished:C}=this.performUpload(m),u=I18n.t("js.label_upload_notification"),k=this.ToastService.addAttachmentUpload(u,v);return C.then(x=>(setTimeout(()=>this.ToastService.remove(k),700),this.attachments.count+=x.length,x.forEach(b=>{this.attachments.elements.push(b.response)}),this.updateState(),x)).catch(x=>{let b;return console.error("Error while uploading: %O",x),b=x.error instanceof ErrorEvent?this.I18n.t("js.error_attachment_upload",{error:x}):"Error"===_.get(x,"error._type")?x.error.message:x.error,this.halNotification.handleRawError(b),b||I18n.t("js.error.internal")})}performUpload(m){let v=this.directUploadURL||"";return v?this.opDirectFileUpload.uploadAndMapResponse(v,m):(v=!(0,d.Z)(this)&&this.id&&this.attachmentsBackend?this.addAttachment.$link.href:this.apiV3Service.attachments.path,this.opFileUpload.uploadAndMapResponse(v,m))}get directUploadURL(){return this.$links.prepareAttachment?this.$links.prepareAttachment.href:(0,d.Z)(this)?this.config.prepareAttachmentURL:null}updateState(){this.state&&this.state.putValue(this)}$initialize(m){this.ToastService||(this.ToastService=this.injector.get(p.kl)),this.halNotification||(this.halNotification=this.injector.get(n.W)),this.opFileUpload||(this.opFileUpload=this.injector.get(l.r)),this.opDirectFileUpload||(this.opDirectFileUpload=this.injector.get(i.c)),this.config||(this.config=this.injector.get(h.e)),this.pathHelper||(this.pathHelper=this.injector.get(e.j)),this.apiV3Service||(this.apiV3Service=this.injector.get(c.T)),super.$initialize(m);const v=this.attachments||{$source:{},elements:[]};this.attachments=new r.e(this.injector,v,!1,this.halInitializer,"HalResource")}}}},9214:(te,M,t)=>{"use strict";t.d(M,{c:()=>e});var n=t(80044);class e extends n.X{get state(){return this.states.projects.get(this.id)}getEditorContext(h){return-1!==["statusExplanation","description"].indexOf(h)?{type:"full",macros:"resource"}:{type:"constrained"}}$linkableKeys(){return _.without(super.$linkableKeys(),"schema")}}},63085:(te,M,t)=>{"use strict";t.d(M,{L:()=>l});var n=t(3786),e=t(29161),p=t(44022),h=t(70233),c=t(80044),i=t(10190);class l extends c.X{constructor(){super(...arguments),this.memoizedCurrentSchemas={}}$initialize(d){super.$initialize(d),this.$links.schema={href:`${this.pathHelper.api.v3.apiV3Base}/queries/filter_instance_schemas/${(0,i.Z)(this.filter.href)}`}}get id(){return this.filter.id}get name(){return this.filter.name}get currentSchema(){if(!this.operator)return null;const d=this.operator.href.toString();if(void 0===this.memoizedCurrentSchemas[d])try{this.memoizedCurrentSchemas[d]=this.schemaCache.of(this).resultingSchema(this.operator)}catch(f){console.error(`Failed to access filter schema${f}`)}return this.memoizedCurrentSchemas[d]}isCompletelyDefined(){return this.values.length||this.currentSchema&&!this.currentSchema.isValueRequired()}findOperator(d){return _.find(this.schemaCache.of(this).availableOperators,f=>f.id===d)}isTemplated(){let d=!1;return this.values.find(f=>{d=((null==f?void 0:f.href)||f.toString()||"").includes("{id}")}),d}}(0,n.gn)([(0,e.W)(p.y),(0,n.w6)("design:type",p.y)],l.prototype,"schemaCache",void 0),(0,n.gn)([(0,e.W)(h.j),(0,n.w6)("design:type",h.j)],l.prototype,"pathHelper",void 0)},63588:(te,M,t)=>{"use strict";t.d(M,{e:()=>p});var n=t(80044),e=t(10190);class p extends n.X{get id(){return this.$source.id||(0,e.Z)(this.href)}set id(c){this.$source.id=c}}},17577:(te,M,t)=>{"use strict";t.d(M,{P:()=>p});var n=t(80044),e=t(63085);class p extends n.X{setSortBy(c){this.sortBy=c}$initialize(c){super.$initialize(c),this.filters=this.filters.map(i=>new e.L(this.injector,i,!0,this.halInitializer,"QueryFilterInstance"))}}},15893:(te,M,t)=>{"use strict";t.d(M,{S9:()=>e,iV:()=>p});t(80044);const e="urn:openproject-org:api:v3:queries:directions:asc",p="urn:openproject-org:api:v3:queries:directions:desc"},69057:(te,M,t)=>{"use strict";t.d(M,{d:()=>p});var n=t(80044),e=t(10190);class p extends n.X{static RELATION_TYPES(c=!0){const i=["relates","duplicates","duplicated","blocks","blocked","precedes","follows","includes","partof","requires","required"];return c&&i.push("parent","children"),i}static LOCALIZED_RELATION_TYPES(c=!0){return p.RELATION_TYPES(c).map(l=>({name:l,label:I18n.t(`js.relation_labels.${l}`)}))}static DEFAULT(){return"relates"}normalizedType(c){return this.denormalized(c).relationType}denormalized(c){const i=this.to.href===c.href?"from":"to";return{target:this[i],targetId:this[i].id,relationType:"from"===i?this.reverseType:this.type,reverseRelationType:"from"===i?this.type:this.reverseType}}isInvolved(c){return _.values(this.ids).indexOf(c.toString())>=0}get ids(){return{from:(0,e.Z)(this.from.href),to:(0,e.Z)(this.to.href)}}updateDescription(c){return this.$links.updateImmediately({description:c})}updateType(c){return this.$links.updateImmediately({type:c})}}},4816:(te,M,t)=>{"use strict";t.d(M,{q:()=>e});var n=t(80044);class e extends n.X{}},34863:(te,M,t)=>{"use strict";t.d(M,{F:()=>e});var n=t(80044);class e extends n.X{get state(){return this.states.statuses.get(this.href)}}},84481:(te,M,t)=>{"use strict";t.d(M,{q:()=>e});var n=t(80044);class e extends n.X{static get active_user_statuses(){return["active","registered"]}get state(){return this.states.users.get(this.href)}get showUserPath(){return this.showUser?this.showUser.$link.href:null}get isActive(){return e.active_user_statuses.indexOf(this.status)>=0}}},92814:(te,M,t)=>{"use strict";t.d(M,{g:()=>e});var n=t(80044);class e extends n.X{isLocked(){return"locked"===this.status}isOpen(){return"open"===this.status}isClosed(){return"closed"===this.status}}},24897:(te,M,t)=>{"use strict";t.d(M,{X:()=>k});var n=t(3786),e=t(96617),p=t(87853),h=t(70233),c=t(36293),i=t(54892),l=t(62964),r=t(29161),d=t(33276),f=t(76825),a=t(54475),m=t(80044),v=t(67248),C=t(84699);class u extends m.X{constructor(){super(...arguments),this.attachmentsBackend=!0}get ancestorIds(){const{ancestors:b}=this;return b.map(y=>y.id)}subjectWithType(b=40){return`${this.type?`${this.type.name}: `:""}${this.subjectWithId(b)}`}subjectWithId(b=40){const y=(0,C.Z)(this)?"":` (#${this.id})`;return`${_.truncate(this.subject,{length:b})}${y}`}get isLeaf(){const{children:b}=this.$links;return!(b&&b.length>0)}previewPath(){return(0,C.Z)(this)?super.previewPath():this.apiV3Service.work_packages.id(this.id).path}getEditorContext(b){return Object.assign({type:"description"===b?"full":"constrained",macros:!1},b.startsWith("customField")&&{disabledMentions:["user"]})}isParentOf(b){var y;return(null===(y=b.parent)||void 0===y?void 0:y.$links.self.$link.href)===this.$links.self.$link.href}updateLinkedResources(...b){const y={};b.forEach(E=>{const T=this[E];y[E]=T?T.$update():Promise.reject(void 0)});const P=Promise.all(_.values(y));return P.then(()=>{this.wpCacheService.touch(this.id)}),P}$initialize(b){super.$initialize(b);const y=this.attachments||{$source:{},elements:[]};this.attachments=new a.e(this.injector,_.get(y,"$source",y),!1,this.halInitializer,"HalResource")}$linkableKeys(){return _.without(super.$linkableKeys(),"schema")}get state(){return this.states.workPackages.get(this.id)}push(b){return this.wpActivity.clear(b.id),b.parent&&this.apiV3Service.work_packages.id(b.parent).refresh(),this.apiV3Service.work_packages.cache.updateWorkPackage(b)}}(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",e.D)],u.prototype,"I18n",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",p.G)],u.prototype,"states",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",i.a)],u.prototype,"wpActivity",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",d.T)],u.prototype,"apiV3Service",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",c.kl)],u.prototype,"ToastService",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",l.q)],u.prototype,"workPackageNotificationService",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",h.j)],u.prototype,"pathHelper",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",f.r)],u.prototype,"opFileUpload",void 0);const k=(0,v.n)(u)},26784:(te,M,t)=>{"use strict";t.d(M,{u:()=>e});var n=t(80044);class e{static extractPayload(h,c=null){return h instanceof n.X&&c?this.extractPayloadFromSchema(h,c):!h||h instanceof n.X?{}:h}static extractPayloadFromSchema(h,c){const i={_links:{}},l=[];for(const r in c)c.hasOwnProperty(r)&&c[r]&&c[r].writable&&(h.$links[r]?Array.isArray(h[r])?i._links[r]=_.map(h[r],d=>({href:d.href})):i._links[r]={href:h[r]&&h[r].href}:l.push(r));return _.each(l,r=>{(h.hasOwnProperty(r)||h[r])&&(Array.isArray(h[r])?i[r]=_.map(h[r],d=>d instanceof n.X?this.extractPayloadFromSchema(d,d.currentSchema||d.schema):d):i[r]=h[r])}),i}}},81531:(te,M,t)=>{"use strict";t.d(M,{V:()=>e});var n=t(84699);class e{constructor(h,c){this.schema=h,this.resource=c}static create(h,c){return new Proxy(h,new this(h,c))}get(h,c,i){switch(c){case"ofProperty":return this.proxyMethod(this.ofProperty);case"isAttributeEditable":return this.proxyMethod(this.isAttributeEditable);case"mappedName":return this.proxyMethod(this.mappedName);case"isEditable":return this.isEditable;default:return Reflect.get(h,c,i)}}ofProperty(h){const c=this.schema[this.mappedName(h)];return c?Object.assign(Object.assign({},c),{writable:this.isEditable&&c&&c.writable}):null}isAttributeEditable(h){const c=this.ofProperty(h);return!!c&&c.writable}get isEditable(){return(0,n.Z)(this.resource)||!!this.resource.$links.update}mappedName(h){return h}proxyMethod(h){const c=this;return new Proxy(h,{apply:(i,l,r)=>h.apply(c,[r[0]])})}}},81923:(te,M,t)=>{"use strict";t.d(M,{X:()=>e});var n=t(81531);class e extends n.V{get(h,c,i){switch(c){case"isMilestone":return this.isMilestone;case"isReadonly":return this.isReadonly;default:return super.get(h,c,i)}}ofProperty(h){if("combinedDate"===h){const c=super.ofProperty("startDate");return c?(c.writable=c.writable||this.isAttributeEditable("dueDate")||this.isAttributeEditable("scheduleManually"),c):null}return super.ofProperty(h)}get isReadonly(){var h;return this.resource.readonly||!!(null===(h=this.resource.status)||void 0===h?void 0:h.isReadonly)}isAttributeEditable(h){return(!this.isReadonly||"status"===h)&&(["startDate","dueDate","date"].includes(h)&&this.resource.scheduleManually?super.isAttributeEditable("scheduleManually"):super.isAttributeEditable(h))}get isMilestone(){return this.schema.hasOwnProperty("date")}mappedName(h){return!this.isMilestone||"startDate"!==h&&"dueDate"!==h?h:"date"}}},8849:(te,M,t)=>{"use strict";t.d(M,{o:()=>n});class n extends Error{constructor(p,h){super(),this.httpError=p,this.resource=h,this.name="HALError",Object.setPrototypeOf(this,n.prototype)}get message(){var p,h;return(null===(p=this.resource)||void 0===p?void 0:p.message)||(null===(h=this.httpError)||void 0===h?void 0:h.message)||"Unknown error"}get errorIdentifier(){var p;return(null===(p=this.resource)||void 0===p?void 0:p.errorIdentifier)||"unknown"}}},1403:(te,M,t)=>{"use strict";t.d(M,{J:()=>i});var n=t(79441),e=t(9170),p=t(96330),h=t(80639),c=t(2316);class i{constructor(){this._events=new n.xQ,this.events$=this._events.asObservable()}aggregated$(r,d=500){return this.events$.pipe((0,e.h)(f=>f.resourceType===r),(0,p.f)(this.events$.pipe((0,h.b)(d))))}push(r,d){d.id=r.id,d.resourceType=r._type,this._events.next(d)}}i.\u0275fac=function(r){return new(r||i)},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})},67727:(te,M,t)=>{"use strict";t.d(M,{W:()=>C});var n=t(3786),e=t(47775),p=t(91923),h=t(86469),c=t(36293),i=t(96617),l=t(53882),r=t(80044),d=t(29161),f=t(44022),a=t(85758),m=t(8849),v=t(2316);class C{constructor(k){this.injector=k}showSave(k,x=!1){const b={message:this.I18n.t("js.notice_successful_"+(x?"create":"update"))};this.ToastService.addSuccess(b)}handleRawError(k,x){if(console.error("Handling error message %O for work package %O",k,x),k instanceof m.o&&x)return this.handleErrorResponse(k.resource,x);const b=this.retrieveError(k);if(b instanceof r.X)return this.handleErrorResponse(b,x);"string"!=typeof k?k instanceof Error?this.ToastService.addError(k.message):this.showGeneralError(b||k):this.ToastService.addError(k)}retrieveErrorMessage(k){const x=this.retrieveError(k);return x instanceof a.Xf||x instanceof m.o?x.message:"string"==typeof x?x:this.I18n.t("js.error.internal")}retrieveError(k){let x=k;return k instanceof l.UA&&(x=k.message||k.error),"Error"===_.get(k,"data._type")&&(x=k.data),x&&"Error"===x._type?this.halResourceService.createHalResourceOfClass(a.Xf,x):x}handleErrorResponse(k,x){return k instanceof m.o&&x?this.showError(k.resource,x):k instanceof a.Xf?x?this.showError(k,x):this.showApiErrorMessages(k):this.showGeneralError(k)}showError(k,x){this.showCustomError(k,x)||this.showApiErrorMessages(k)}showGeneralError(k){let x=this.I18n.t("js.error.internal");("string"==typeof k||_.has(k,"toString"))&&(x+=` ${k.toString()}`),this.ToastService.addError(x)}showEditingBlockedError(k){this.ToastService.addError(this.I18n.t("js.hal.error.edit_prohibited",{attribute:k}))}showCustomError(k,x){if("urn:openproject-org:api:v3:errors:PropertyFormatError"===k.errorIdentifier){const b=this.schemaCache.of(x).ofProperty(k.details.attribute),y=b.name,E=`js.hal.error.format.${b.type.toLowerCase()}`;return void 0!==this.I18n.lookup(E)&&(this.ToastService.addError(this.I18n.t(E,{attribute:y})),!0)}return!1}showApiErrorMessages(k){const x=k.errorMessages;return x.length>1?this.ToastService.addError("",x):this.ToastService.addError(x[0]),!0}}C.\u0275fac=function(k){return new(k||C)(v.LFG(v.zs3))},C.\u0275prov=v.Yz7({token:C,factory:C.\u0275fac}),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",i.D)],C.prototype,"I18n",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",e.StateService)],C.prototype,"$state",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",p.u)],C.prototype,"halResourceService",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",c.kl)],C.prototype,"ToastService",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",h.vt)],C.prototype,"loadingIndicator",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",f.y)],C.prototype,"schemaCache",void 0)},29092:(te,M,t)=>{"use strict";t.d(M,{h:()=>e});var n=t(2316);class e{constructor(){this.config={user:"name",project:"name"}}sort(h,c){if(0===h.length)return h;const i=c||h[0]._type;if(!i)return h;const l=this.sortingProperty(i);return l?_.sortBy(h,r=>r[l].toLowerCase()):h}sortingProperty(h){return h=h.toLowerCase().replace(/^\[\]/,""),this.config[h]}hasSortingProperty(h){return void 0!==this.sortingProperty(h)}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},91923:(te,M,t)=>{"use strict";t.d(M,{u:()=>u});var n=t(53882),e=t(33927),p=t(18293),h=t(45871),c=t(23376),i=t(47174),l=t(3352),r=t(95060),d=t(51784),f=t(80044),a=t(91720),m=t(8849),v=t(23237),C=t(2316);class u{constructor(x,b){this.injector=x,this.http=b,this.config={}}request(x,b,y,P={}){if("get"===x)return this.get(b,y,P);const E={body:y||{},headers:P,withCredentials:!0,responseType:"json"};return this.performRequest(x,b,E)}performRequest(x,b,y){return this.http.request(x,b,y).pipe((0,e.U)(P=>this.createHalResource(P)),(0,p.K)(P=>((0,l.SC)(()=>console.error(`Failed to ${x} ${b}: ${P.name}`)),this.createErrorObservable(P))))}get(x,b,y){const P={headers:y,params:new n.LE({encoder:new d.c,fromObject:b}),withCredentials:!0,responseType:"json"};return this.performRequest("get",x,P)}getAllPaginated(x,b={},y={}){return(0,v.JQ)(P=>{const E=Object.assign(Object.assign({},b),P);return this.request("get",x,this.toEprops(E),y)},b.pageSize||-1)}put(x,b,y){return this.request("put",x,b,y)}post(x,b,y){return this.request("post",x,b,y)}patch(x,b,y){return this.request("patch",x,b,y)}delete(x,b,y){return this.request("delete",x,b,y)}registerResource(x,b){this.config[x]=b}get defaultClass(){return f.X}createHalResource(x,b=!0){_.isNil(x)&&(x=f.X.getEmptyResource());const y=x._type||"HalResource";return this.createHalResourceOfType(y,x,b)}createHalResourceOfType(x,b,y=!1){return new(this.getResourceClassOfType(x))(this.injector,b,y,O=>(0,a.EZ)(this,O),x)}createHalResourceOfClass(x,b,y=!1){const E=b._type||"HalResource";return new x(this.injector,b,y,O=>(0,a.EZ)(this,O),E)}fromLink(x){const b=f.X.getEmptyResource(r.d.fromObject(this,x));return this.createHalResource(b,!1)}fromSelfLink(x){const b={_links:{self:{href:x}}};return this.createHalResource(b)}createLinkedResource(x,b,y){const P=f.X.getEmptyResource(),E=x.$halType,T=this.getResourceClassOfAttribute(E,b)||"HalResource";return P._links.self=y,this.createHalResourceOfType(T,P,!1)}getResourceClassOfType(x){const b=this.config[x];return b&&b.cls?b.cls:this.defaultClass}getResourceClassOfAttribute(x,b){const y=this.config[x];return(y&&y.attrTypes||{})[b]}toEprops(x){const b=c.Wt(JSON.stringify(x));return{eprops:i.J2(b)}}createErrorObservable(x){var b;let y=null;const P=x.error;return"object"==typeof P&&(null===(b=P)||void 0===b?void 0:b._type)&&(y=this.createHalResource(x.error)),(0,h._)(new m.o(x,y))}}u.\u0275fac=function(x){return new(x||u)(C.LFG(C.zs3),C.LFG(n.eN))},u.\u0275prov=C.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})},51784:(te,M,t)=>{"use strict";t.d(M,{c:()=>n});class n{encodeKey(p){return encodeURIComponent(p)}encodeValue(p){return encodeURIComponent(p)}decodeKey(p){return decodeURIComponent(p)}decodeValue(p){return decodeURIComponent(p)}}},13623:(te,M,t)=>{"use strict";t.d(M,{L:()=>y});var n=t(3786),e=t(19100);let h=class extends e.yh{constructor(){super({totalUnread:0})}};h=(0,n.gn)([(0,e.yC)({name:"ian-bell"}),(0,n.w6)("design:paramtypes",[])],h);var c=t(31909),i=t(33905),l=t(84515),r=t(33927),d=t(98636),f=t(18293),a=t(8117),m=t(15347),v=t(9170);class C extends e.AE{constructor(E){super(E),this.store=E,this.unread$=this.select("totalUnread"),this.unreadCountIncreased$=this.unread$.pipe((0,m.G)(),(0,v.h)(([T,O])=>O>T),(0,r.U)(([,T])=>T))}}var u=t(44838),k=t(78509),x=t(60419),b=t(2316);let y=class{constructor(E,T){this.actions$=E,this.resourceService=T,this.id="ian-bell",this.store=new h,this.query=new C(this.store),this.unread$=this.query.unread$,this.query.unreadCountIncreased$.pipe((0,l.T)(1)).subscribe(O=>{this.actions$.dispatch((0,k.vw)({origin:this.id,count:O}))})}fetchUnread(){return this.resourceService.fetchCollection({filters:i.yz.unread,pageSize:0}).pipe((0,r.U)(E=>E.total),(0,d.b)(E=>{this.store.update({totalUnread:E})},E=>{console.error("Failed to load notifications: %O",E),this.store.update({totalUnread:-1})}),(0,f.K)(()=>a.E))}reloadOnNotificationRead(E){this.store.update(({totalUnread:T})=>({totalUnread:T-E.notifications.length}))}};y.\u0275fac=function(E){return new(E||y)(b.LFG(x.b),b.LFG(c.W))},y.\u0275prov=b.Yz7({token:y,factory:y.\u0275fac,providedIn:"root"}),(0,n.gn)([(0,u.B)(k.A6),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0]),(0,n.w6)("design:returntype",void 0)],y.prototype,"reloadOnNotificationRead",null),y=(0,n.gn)([u.b,(0,n.w6)("design:paramtypes",[x.b,c.W])],y)},33905:(te,M,t)=>{"use strict";t.d(M,{yz:()=>h,m8:()=>i});var n=t(3786),e=t(19100),p=t(24782);const h={unread:[["readIAN","=",!1]],all:[]};let i=class extends e.yh{constructor(){super({params:{pageSize:p.Z,page:1},filters:{},activeCollection:{ids:[]},activeFacet:"unread",notLoaded:0})}};i=(0,n.gn)([(0,e.yC)({name:"ian-center"}),(0,n.w6)("design:paramtypes",[])],i)},44092:(te,M,t)=>{"use strict";t.r(M),t.d(M,{OpenProjectInAppNotificationsModule:()=>Pe});var n=t(21757),e=t(54364),p=t(53875),h=t(33276),c=t(10190),i=t(96617),l=t(70692),r=t(33927),d=t(92597),f=t(17163),a=t(70233),m=t(23896),v=t(80044),C=t(3786),u=t(2316),k=t(83720),x=t(79902),b=t(53466),y=t(51253),P=t(80639),E=t(98636),T=t(67202),O=t(94236),I=t(42720),Z=t(79441),j=t(30400),B=t(19100),J=t(36293),R=t(78509),F=t(44838),Y=t(60419),X=t(31909),K=t(96725),ie=t(33905),H=t(26942),ee=t(47775),ce=t(53916);let se=class extends H.N{constructor(pe,ue,Ze,Ge,ft,Pt,yt,Lt,Xt){var At;super(),this.I18n=pe,this.injector=ue,this.resourceService=Ze,this.actions$=Ge,this.apiV3Service=ft,this.toastService=Pt,this.uiRouterGlobals=yt,this.state=Lt,this.deviceService=Xt,this.id="ian-center",this.store=new ie.m8,this.query=new B.AE(this.store),this.activeFacet$=this.query.select("activeFacet"),this.notLoaded$=this.query.select("notLoaded"),this.paramsChanges$=this.query.select(["params","activeFacet"]),this.activeCollection$=this.query.select("activeCollection"),this.activeReason$=this.uiRouterGlobals.params$.pipe(this.untilDestroyed(),(0,k.x)(),(0,r.U)(vt=>"reason"===vt.filter?vt.name:null),(0,d.d)(1)),this.loading$=this.query.selectLoading(),this.selectNotifications$=this.activeCollection$.pipe((0,x.w)(vt=>(0,I.D)(vt.ids.map(ai=>this.resourceService.lookup(ai).pipe((0,b.q)(1)))).pipe((0,y.d)([])))),this.aggregatedCenterNotifications$=this.selectNotifications$.pipe((0,r.U)(vt=>_.groupBy(vt,mi=>{var ai;return(null===(ai=mi._links.resource)||void 0===ai?void 0:ai.href)||"none"})),(0,k.x)()),this.notifications$=this.aggregatedCenterNotifications$.pipe((0,r.U)(vt=>Object.values(vt)),(0,k.x)()),this.hasNotifications$=this.notifications$.pipe((0,k.x)(),(0,r.U)(vt=>vt.length>0),(0,k.x)()),this.hasMoreThanPageSize$=this.notLoaded$.pipe((0,r.U)(vt=>vt>0),(0,k.x)()),this.activeReloadToast=null,this.reload=new Z.xQ,this.onReload=this.reload.pipe((0,P.b)(0),(0,E.b)(vt=>{vt&&this.store.setLoading(!0)}),(0,x.w)(()=>this.resourceService.fetchCollection(this.params).pipe((0,x.w)(vt=>(0,j.D)(this.sideLoadInvolvedWorkPackages(vt._embedded.elements)).pipe((0,T.h)((0,K.n)(vt)))))),(0,E.b)(()=>setTimeout(()=>this.store.setLoading(!1)))),this.selectedNotificationIndex=0,this.stateChanged$=null===(At=this.uiRouterGlobals.params$)||void 0===At?void 0:At.pipe(this.untilDestroyed(),(0,O.j)("workPackageId"),(0,k.x)(),(0,r.U)(vt=>vt?this.apiV3Service.work_packages.id(vt).path:void 0),(0,d.d)()),this.reload.subscribe(),this.stateChanged$&&this.stateChanged$.subscribe(()=>{this.updateSelectedNotification()})}get params(){const pe=this.store.getValue(),ue=pe.filters.name&&pe.filters.filter;return Object.assign(Object.assign({},pe.params),{filters:[...ie.yz[pe.activeFacet],...ue?[[pe.filters.filter,"=",[pe.filters.name]]]:[]]})}setFilters(pe){this.store.update({filters:pe}),this.onReload.pipe((0,b.q)(1)).subscribe(ue=>{this.store.update({activeCollection:ue})}),this.reload.next(!0)}setFacet(pe){var ue;this.store.update({activeFacet:pe}),this.onReload.pipe((0,b.q)(1)).subscribe(Ze=>{this.store.update({activeCollection:Ze})}),"unread"===pe&&(null===(ue=this.selectedNotification)||void 0===ue?void 0:ue.readIAN)&&this.goToCenter(),this.reload.next(!0)}markAsRead(pe){this.actions$.dispatch((0,R.L5)({origin:this.id,notifications:pe}))}markAllAsRead(){const pe=(0,K.ZU)(this.params);this.resourceService.collection(pe).pipe((0,b.q)(1)).subscribe(ue=>{const Ze=ue.filter(Ge=>!1===Ge.readIAN).map(Ge=>Ge.id);Ze.length>0&&this.markAsRead(Ze)})}openSplitScreen(pe,ue="activity"){this.state.go(`${this.state.current.data.baseRoute}.details.tabs`,{workPackageId:pe,tabIdentifier:ue})}goToCenter(){this.state.go(this.state.current.data.baseRoute)}showNextNotification(){this.notifications$.pipe((0,b.q)(1)).subscribe(pe=>{if(pe.length<=0)this.state.go(`${this.state.current.data.baseRoute}`);else if(pe[0][0]._links.resource||pe[this.selectedNotificationIndex][0]._links.resource){const ue=(0,c.Z)(pe[this.selectedNotificationIndex>=pe.length?0:this.selectedNotificationIndex][0]._links.resource.href);this.openSplitScreen(ue)}})}checkForNewNotifications(){this.onReload.pipe((0,b.q)(1)).subscribe(pe=>{const{activeCollection:ue}=this.query.getValue();pe.ids.reduce((Ge,ft)=>Ge&&ue.ids.includes(ft),!0)||(this.activeReloadToast&&(this.toastService.remove(this.activeReloadToast),this.activeReloadToast=null),this.activeReloadToast=this.toastService.add({type:"info",message:this.I18n.t("js.notifications.center.new_notifications.message"),link:{text:this.I18n.t("js.notifications.center.new_notifications.link_text"),target:()=>{this.store.update({activeCollection:pe}),this.actions$.dispatch((0,R.$v)({origin:this.id})),this.activeReloadToast=null}}}))}),this.reload.next(!1)}reloadOnNotificationRead(pe){const{activeCollection:ue}=this.query.getValue();this.store.update({activeCollection:{ids:ue.ids.filter(Ze=>!pe.notifications.includes(Ze))}}),!this.deviceService.isMobile&&this.state.includes("**.details.*")&&this.showNextNotification()}sideLoadInvolvedWorkPackages(pe){const{cache:ue}=this.apiV3Service.work_packages,Ze=pe.map(ft=>{var Pt;const yt=null===(Pt=ft._links.resource)||void 0===Pt?void 0:Pt.href;return yt&&v.X.matchFromLink(yt,"work_packages")}).filter(ft=>ft&&ue.stale(ft)),Ge=this.apiV3Service.work_packages.requireAll(_.compact(Ze));return Ze.forEach(ft=>{ue.clearAndLoad(ft,(0,j.D)(Ge).pipe((0,r.U)(()=>ue.current(ft))))}),Ge}updateSelectedNotification(){this.notifications$.pipe((0,b.q)(1)).subscribe(pe=>{for(let ue=0;ue<pe.length;++ue)if(pe[ue][0]._links.resource&&(0,c.Z)(pe[ue][0]._links.resource.href)===this.uiRouterGlobals.params.workPackageId)return this.selectedNotificationIndex=ue,void([this.selectedNotification]=pe[ue])})}};se.\u0275fac=function(pe){return new(pe||se)(u.LFG(i.D),u.LFG(u.zs3),u.LFG(X.W),u.LFG(Y.b),u.LFG(h.T),u.LFG(J.kl),u.LFG(ee.UIRouterGlobals),u.LFG(ee.StateService),u.LFG(ce.U))},se.\u0275prov=u.Yz7({token:se,factory:se.\u0275fac}),(0,C.gn)([(0,F.B)(R.vw),(0,C.w6)("design:type",Function),(0,C.w6)("design:paramtypes",[]),(0,C.w6)("design:returntype",void 0)],se.prototype,"checkForNewNotifications",null),(0,C.gn)([(0,F.B)(R.A6),(0,C.w6)("design:type",Function),(0,C.w6)("design:paramtypes",[void 0]),(0,C.w6)("design:returntype",void 0)],se.prototype,"reloadOnNotificationRead",null),se=(0,C.gn)([F.b,(0,C.w6)("design:paramtypes",[i.D,u.zs3,X.W,Y.b,h.T,J.kl,ee.UIRouterGlobals,ee.StateService,ce.U])],se);var re=t(84906),Me=t(50076);t(34863);class Ye{ngOnChanges(pe){if(pe.status){const ue=pe.status;this.highlightClass=Me.Z.backgroundClass("status",ue.currentValue.id||"")}}}Ye.\u0275fac=function(pe){return new(pe||Ye)},Ye.\u0275cmp=u.Xpm({type:Ye,selectors:[["op-in-app-notification-status"]],inputs:{status:"status"},features:[u.TTD],decls:2,vars:2,consts:[[1,"op-ian-wp-status",3,"ngClass"],[1,"op-ian-wp-status--text",3,"textContent"]],template:function(pe,ue){1&pe&&(u.TgZ(0,"span",0),u._UZ(1,"span",1),u.qZA()),2&pe&&(u.Q6J("ngClass",ue.highlightClass),u.xp6(1),u.Q6J("textContent",ue.status.name))},directives:[e.mk],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-wp-status[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;background-color:var(--status-selector-bg-color);color:#fff;margin-bottom:0;padding:1px 8px;border:none;border-radius:2px;max-width:100%;font-size:12px;display:inline-block;min-height:16px;line-height:16px}.op-ian-wp-status--text[_ngcontent-%COMP%]{margin:0 5px}"],changeDetection:0});t(24897);var Xe=t(2281);class it{constructor(pe,ue){this.I18n=pe,this.timezoneService=ue,this.className=!0,this.text={work_package_is:this.I18n.t("js.notifications.date_alerts.work_package_is"),overdue:this.I18n.t("js.notifications.date_alerts.overdue"),overdue_since:Ze=>this.I18n.t("js.notifications.date_alerts.overdue_since",{difference_in_days:Ze}),property_is:Ze=>this.I18n.t("js.notifications.date_alerts.property_is",{difference_in_days:Ze}),property_was:Ze=>this.I18n.t("js.notifications.date_alerts.property_was",{difference_in_days:Ze}),property_deleted:this.I18n.t("js.notifications.date_alerts.property_is_deleted"),startDate:this.I18n.t("js.work_packages.properties.startDate"),dueDate:this.I18n.t("js.work_packages.properties.dueDate"),date:this.I18n.t("js.notifications.date_alerts.milestone_date"),due_today:this.I18n.t("js.notifications.date_alerts.property_today")}}ngOnInit(){const ue=this.deriveMostRelevantAlert(this.aggregatedNotifications)._embedded.details[0],Ze=ue.property;ue.value?this.deriveDueDate(ue.value,Ze):(this.propertyText=this.text[Ze],this.alertText=this.text.property_deleted)}deriveDueDate(pe,ue){const Ze=this.timezoneService.parseISODate(pe).startOf("day"),Ge=Xe();this.dateIsPast=Ze.isBefore(Ge,"day"),this.isOverdue=this.dateIsPast&&["date","dueDate"].includes(ue);const ft=this.dateDiff(Ze);this.propertyText=this.isOverdue&&ft>0?this.text.overdue:this.text[ue],this.alertText=this.buildAlertText(ft)}buildAlertText(pe){if(0===pe)return this.text.due_today;const ue=this.I18n.t("js.units.day",{count:pe});return this.isOverdue?this.text.overdue_since(ue):this.dateIsPast?this.text.property_was(ue):this.text.property_is(ue)}dateDiff(pe){const ue=Xe().startOf("day");return Math.abs(ue.diff(pe,"days"))}deriveMostRelevantAlert(pe){const ue=pe.filter(Ge=>"dateAlert"===Ge.reason),Ze=pe[0];return ue.length>1&&ue.find(ft=>"dueDate"===ft._embedded.details[0].property)||Ze}}it.\u0275fac=function(pe){return new(pe||it)(u.Y36(i.D),u.Y36(l.B))},it.\u0275cmp=u.Xpm({type:it,selectors:[["op-in-app-notification-date-alert"]],hostVars:4,hostBindings:function(pe,ue){2&pe&&u.ekj("op-ian-date-alert",ue.className)("op-ian-date-alert_overdue",ue.isOverdue)},inputs:{aggregatedNotifications:"aggregatedNotifications",workPackage:"workPackage"},decls:3,vars:2,consts:[[1,"op-ian-date-alert--property",3,"textContent"],[1,"op-ian-date-alert--days",3,"textContent"]],template:function(pe,ue){1&pe&&(u._UZ(0,"span",0),u._uU(1," "),u._UZ(2,"span",1)),2&pe&&(u.Q6J("textContent",ue.propertyText),u.xp6(2),u.Q6J("textContent",ue.alertText))},styles:[".op-ian-date-alert{color:var(--gray-dark)}.op-ian-date-alert_overdue{color:var(--warn)}.op-ian-date-alert--property{font-weight:bold}\n"],encapsulation:2,changeDetection:0});var at=t(12702),lt=t(3742);function dt(ve,pe){if(1&ve&&(u.TgZ(0,"span"),u._uU(1),u.qZA()),2&ve){const ue=u.oxw(2);u.xp6(1),u.hij(" ",ue.text.and," ")}}function de(ve,pe){1&ve&&u._UZ(0,"span",5),2&ve&&u.Q6J("textContent",", ")}function oe(ve,pe){if(1&ve&&(u.ynx(0),u.YNc(1,dt,2,1,"span",2),u._UZ(2,"op-principal",3),u.YNc(3,de,1,1,"span",4),u.BQk()),2&ve){const ue=pe.$implicit,Ze=pe.last,Ge=u.oxw();u.xp6(1),u.Q6J("ngIf",Ze&&Ge.actors.length>1&&Ge.actors.length<4),u.xp6(1),u.Q6J("principal",ue)("hideName",!1)("hideAvatar",!0)("link",!Ge.deviceService.isMobile),u.xp6(1),u.Q6J("ngIf",!Ze&&Ge.actors.length>2)}}function D(ve,pe){if(1&ve&&(u.TgZ(0,"span"),u._uU(1),u.qZA()),2&ve){const ue=u.oxw();u.xp6(1),u.hij(" ",ue.text_for_additional_authors(ue.actors.length-3),"")}}class G{constructor(pe,ue,Ze){this.deviceService=pe,this.I18n=ue,this.timezoneService=Ze,this.className=!0,this.actors=[],this.text={and:this.I18n.t("js.notifications.center.label_actor_and"),and_other_singular:this.I18n.t("js.notifications.center.and_more_users.one"),and_other_plural:Ge=>this.I18n.t("js.notifications.center.and_more_users.other",{count:Ge}),loading:this.I18n.t("js.ajax.loading"),placeholder:this.I18n.t("js.placeholders.default"),mark_as_read:this.I18n.t("js.notifications.center.mark_as_read"),updated_by_at:Ge=>this.I18n.t("js.notifications.center.text_update_date",{date:Ge})}}ngOnInit(){this.buildActors(),this.buildTime()}text_for_additional_authors(pe){return 1===pe?this.text.and_other_singular:this.text.and_other_plural(pe)}buildTime(){this.fixedTime=this.timezoneService.formattedDatetime(this.notification.createdAt),this.relativeTime$=(0,at.H)(0,1e4).pipe((0,r.U)(()=>this.text.updated_by_at(this.timezoneService.formattedRelativeDateTime(this.notification.createdAt))),(0,k.x)())}buildActors(){const pe=this.aggregatedNotifications.map(ue=>{const{actor:Ze}=ue._links;return Ze?{href:Ze.href,name:Ze.title}:null}).filter(ue=>null!==ue);this.actors=_.uniqBy(pe,ue=>ue.href)}}G.\u0275fac=function(pe){return new(pe||G)(u.Y36(ce.U),u.Y36(i.D),u.Y36(l.B))},G.\u0275cmp=u.Xpm({type:G,selectors:[["op-in-app-notification-actors-line"]],hostVars:2,hostBindings:function(pe,ue){2&pe&&u.ekj("op-ian-actors",ue.className)},inputs:{aggregatedNotifications:"aggregatedNotifications",notification:"notification"},decls:6,vars:10,consts:[[1,"op-ian-actors--date",3,"title","textContent"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"op-ian-item--actors",3,"principal","hideName","hideAvatar","link"],[3,"textContent",4,"ngIf"],[3,"textContent"]],template:function(pe,ue){1&pe&&(u._UZ(0,"div",0),u.ALo(1,"async"),u.TgZ(2,"div"),u.YNc(3,oe,4,6,"ng-container",1),u.ALo(4,"slice"),u.YNc(5,D,2,1,"span",2),u.qZA()),2&pe&&(u.Q6J("title",ue.fixedTime)("textContent",u.lcZ(1,4,ue.relativeTime$)),u.xp6(3),u.Q6J("ngForOf",u.Dn7(4,6,ue.actors,0,3)),u.xp6(2),u.Q6J("ngIf",ue.actors.length>3))},directives:[e.sg,e.O5,lt.N],pipes:[e.Ov,e.OU],styles:[".cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-actors{display:grid;grid-template-columns:auto 1fr;grid-column-gap:.25rem;align-items:center;color:var(--gray-dark)}.op-ian-actors--line{vertical-align:baseline}.op-ian-actors--date{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap;max-width:100%;line-height:16px}\n"],encapsulation:2,changeDetection:0});var V=t(70099);function me(ve,pe){if(1&ve){const ue=u.EpF();u.TgZ(0,"div",19),u._uU(1," - "),u.TgZ(2,"a",20),u.NdJ("click",function(Ge){return u.CHM(ue),u.oxw(2).projectClicked(Ge)}),u.qZA(),u._uU(3," - "),u.qZA()}if(2&ve){const ue=u.oxw(2);u.xp6(2),u.ekj("spot-link_inactive",ue.isMobile()),u.Q6J("href",ue.project.showUrl,u.LSH)("textContent",ue.project.title)}}function $(ve,pe){1&ve&&(u.ynx(0),u._uU(1,", "),u.BQk())}function Se(ve,pe){if(1&ve&&(u.TgZ(0,"span",21),u._uU(1),u.YNc(2,$,2,0,"ng-container",18),u.qZA()),2&ve){const ue=pe.$implicit,Ze=pe.last;u.xp6(1),u.hij(" ",ue.key,""),u.xp6(1),u.Q6J("ngIf",!Ze)}}function ot(ve,pe){if(1&ve&&u._UZ(0,"span",22),2&ve){const ue=u.oxw(2);u.Q6J("textContent",ue.aggregatedNotifications.length)}}function st(ve,pe){if(1&ve){const ue=u.EpF();u.TgZ(0,"i",23),u.NdJ("click",function(Ge){u.CHM(ue);const ft=u.oxw(2);return ft.markAsRead(Ge,ft.aggregatedNotifications)}),u.qZA()}if(2&ve){const ue=u.oxw(2);u.Q6J("title",ue.text.mark_as_read)}}function he(ve,pe){if(1&ve&&u._UZ(0,"op-in-app-notification-date-alert",26),2&ve){const ue=u.oxw(2).ngIf,Ze=u.oxw();u.Q6J("workPackage",ue)("aggregatedNotifications",Ze.aggregatedNotifications)}}function ye(ve,pe){if(1&ve&&u._UZ(0,"op-in-app-notification-actors-line",27),2&ve){const ue=u.oxw(3);u.Q6J("notification",ue.notification)("aggregatedNotifications",ue.aggregatedNotifications)}}function xe(ve,pe){if(1&ve&&(u.ynx(0),u.YNc(1,he,1,2,"op-in-app-notification-date-alert",24),u.YNc(2,ye,1,2,"op-in-app-notification-actors-line",25),u.BQk()),2&ve){const ue=pe.ngIf;u.xp6(1),u.Q6J("ngIf",ue.showDateAlert),u.xp6(1),u.Q6J("ngIf",!ue.showDateAlert)}}const De=function(ve){return{workPackageId:ve}},Qe=function(ve){return{showDateAlert:ve}};function Ve(ve,pe){if(1&ve){const ue=u.EpF();u.ynx(0),u.TgZ(1,"div",3),u.TgZ(2,"div",4),u._UZ(3,"op-in-app-notification-status",5),u.qZA(),u._UZ(4,"a",6),u.YNc(5,me,4,4,"div",7),u.TgZ(6,"div",8),u.YNc(7,Se,3,2,"span",9),u.ALo(8,"keyvalue"),u.qZA(),u.YNc(9,ot,1,1,"span",10),u.TgZ(10,"div",11),u.YNc(11,st,1,1,"i",12),u.TgZ(12,"i",13),u.NdJ("keydown.enter",function(){return u.CHM(ue),u.oxw().showDetails()}),u.qZA(),u.qZA(),u.qZA(),u.TgZ(13,"div",14),u._UZ(14,"span",15),u._UZ(15,"span",16),u.qZA(),u.TgZ(16,"div",17),u.YNc(17,xe,3,2,"ng-container",18),u.ALo(18,"async"),u.qZA(),u.BQk()}if(2&ve){const ue=pe.ngIf,Ze=u.oxw();u.xp6(3),u.Q6J("status",ue.status),u.xp6(1),u.ekj("spot-link_inactive",Ze.isMobile()),u.Q6J("uiParams",u.VKq(20,De,ue.id))("textContent","#"+ue.id),u.uIk("title",ue.subject),u.xp6(1),u.Q6J("ngIf",Ze.project),u.xp6(2),u.Q6J("ngForOf",u.lcZ(8,16,Ze.translatedReasons)),u.xp6(2),u.Q6J("ngIf",!Ze.notification.readIAN),u.xp6(2),u.Q6J("ngIf",!Ze.notification.readIAN),u.xp6(3),u.Q6J("ngClass","op-ian-item--work-package-type __hl_inline_type_"+ue.type.id)("textContent",ue.type.name),u.xp6(1),u.ekj("-read",Ze.notification.readIAN),u.Q6J("textContent",ue.subject),u.xp6(2),u.Q6J("ngIf",u.VKq(22,Qe,u.lcZ(18,18,Ze.showDateAlert$)))}}function nt(ve,pe){1&ve&&(u.TgZ(0,"op-content-loader",32),u.O4$(),u._UZ(1,"rect",33),u._UZ(2,"rect",34),u._UZ(3,"rect",35),u.qZA())}function mt(ve,pe){if(1&ve&&(u.TgZ(0,"div",28),u.YNc(1,nt,4,0,"op-content-loader",29),u._UZ(2,"span",30),u.TgZ(3,"div",11),u._UZ(4,"i",31),u.qZA(),u.qZA()),2&ve){const ue=u.oxw();u.xp6(1),u.Q6J("ngIf",ue.workPackage$)}}class Ue{constructor(pe,ue,Ze,Ge,ft,Pt,yt){this.apiV3Service=pe,this.I18n=ue,this.storeService=Ze,this.timezoneService=Ge,this.pathHelper=ft,this.state=Pt,this.deviceService=yt,this.className=!0,this.workPackage$=null,this.showDateAlert$=this.storeService.activeReason$.pipe((0,r.U)(Lt=>"date_alert"===Lt),(0,r.U)(Lt=>{const Xt=this.aggregatedNotifications.filter(At=>"dateAlert"===At.reason);return Lt||Xt.length===this.aggregatedNotifications.length}),(0,d.d)(1)),this.loading$=this.storeService.query.selectLoading(),this.stateChanged$=this.storeService.stateChanged$,this.text={loading:this.I18n.t("js.ajax.loading"),placeholder:this.I18n.t("js.placeholders.default"),mark_as_read:this.I18n.t("js.notifications.center.mark_as_read")}}ngOnInit(){this.buildTranslatedReason(),this.buildProject(),this.loadWorkPackage()}loadWorkPackage(){var pe;const ue=null===(pe=this.notification._links.resource)||void 0===pe?void 0:pe.href,Ze=ue&&v.X.matchFromLink(ue,"work_packages");Ze&&(this.workPackage$=this.apiV3Service.work_packages.id(Ze).requireAndStream())}showDetails(){!this.workPackage$||this.workPackage$.pipe((0,m.take)(1),(0,f.M)(this.showDateAlert$)).subscribe(([pe,ue])=>{const Ze=ue?"overview":"activity";this.storeService.openSplitScreen(pe.id,Ze)})}projectClicked(pe){pe.stopPropagation()}markAsRead(pe,ue){pe.stopPropagation(),this.storeService.markAsRead(ue.map(Ze=>Ze.id))}isMobile(){return this.deviceService.isMobile}buildTranslatedReason(){const pe={};this.aggregatedNotifications.forEach(ue=>{const Ze=this.I18n.t(`js.notifications.reasons.${ue.reason}`,{defaultValue:ue.reason||this.text.placeholder});pe[Ze]=pe[Ze]||0,pe[Ze]+=1}),this.translatedReasons=pe}buildProject(){const{project:pe}=this.notification._links;pe&&(this.project=Object.assign(Object.assign({},pe),{showUrl:this.pathHelper.projectPath((0,c.Z)(pe.href))}))}}Ue.\u0275fac=function(pe){return new(pe||Ue)(u.Y36(h.T),u.Y36(i.D),u.Y36(se),u.Y36(l.B),u.Y36(a.j),u.Y36(ee.StateService),u.Y36(ce.U))},Ue.\u0275cmp=u.Xpm({type:Ue,selectors:[["op-in-app-notification-entry"]],hostVars:2,hostBindings:function(pe,ue){2&pe&&u.ekj("op-ian-item",ue.className)},inputs:{notification:"notification",aggregatedNotifications:"aggregatedNotifications"},decls:5,vars:4,consts:[[1,"op-ian-item--row",3,"click"],[4,"ngIf","ngIfElse"],["workPackageLoading",""],[1,"op-ian-item--top-line"],[1,"op-ian-item--status"],[3,"status"],["uiSref","work-packages.show",1,"op-ian-item--work-package-id-link","spot-link",3,"uiParams","textContent"],["class","op-ian-item--project",4,"ngIf"],[1,"op-ian-item--reason-wrapper"],["class","op-ian-item--reason",4,"ngFor","ngForOf"],["class","op-ian-item--reason-count",3,"textContent",4,"ngIf"],[1,"op-ian-item--buttons"],["data-qa-selector","mark-as-read-button","class","op-ian-item--button icon-mark-read","tabindex","0",3,"title","click",4,"ngIf"],["tabindex","0",1,"op-ian-item--button","op-ian-item--button_shown-on-focus","icon-info1",3,"keydown.enter"],[1,"op-ian-item--middle-line"],[3,"ngClass","textContent"],[1,"op-ian-item--work-package-subject",3,"textContent"],[1,"op-ian-item--bottom-line"],[4,"ngIf"],[1,"op-ian-item--project"],["target","_blank",1,"op-ian-item--project-link",3,"href","textContent","click"],[1,"op-ian-item--reason"],[1,"op-ian-item--reason-count",3,"textContent"],["data-qa-selector","mark-as-read-button","tabindex","0",1,"op-ian-item--button","icon-mark-read",3,"title","click"],[3,"workPackage","aggregatedNotifications",4,"ngIf"],[3,"notification","aggregatedNotifications",4,"ngIf"],[3,"workPackage","aggregatedNotifications"],[3,"notification","aggregatedNotifications"],[1,"op-ian-item--loading"],["class","op-ian-item--loading-indicator","viewBox","0 0 200 20",4,"ngIf"],[1,"op-ian-item--reason-count"],[1,"op-ian-item--button","icon-mark-read"],["viewBox","0 0 200 20",1,"op-ian-item--loading-indicator"],["x","0","y","0","width","100%","height","5","rx","1"],["x","0","y","7","width","100%","height","5","rx","1"],["x","0","y","14","width","80%","height","5","rx","1"]],template:function(pe,ue){if(1&pe&&(u.TgZ(0,"div",0),u.NdJ("click",function(){return ue.showDetails()}),u.YNc(1,Ve,19,24,"ng-container",1),u.ALo(2,"async"),u.YNc(3,mt,5,1,"ng-template",null,2,u.W1O),u.qZA()),2&pe){const Ze=u.MAs(4);u.xp6(1),u.Q6J("ngIf",ue.workPackage$&&u.lcZ(2,2,ue.workPackage$))("ngIfElse",Ze)}},directives:[e.O5,Ye,re.AnchorUISref,re.UISref,e.sg,e.mk,it,G,V.V],pipes:[e.Ov,e.Nd],styles:['.cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-item{display:block;background:#FFFFFF;margin:0;padding:15px 10px;font-size:.9rem;border-top:1px solid var(--content-default-border-color);border-radius:2px;height:100px}.op-ian-item:hover{background:var(--gray-light)}.op-ian-item:last-of-type{border-bottom:1px solid var(--content-default-border-color)}.op-ian-item_selected{background:#D1E5F5}.op-ian-item_selected:hover{background:#c9e0f3}.op-ian-item_read{background:#F3F3F3}.op-ian-item_read:hover{background:#eeeeee}.op-ian-item--row{padding:0;margin:0;background:transparent;border:0;font:inherit;text-align:inherit;width:100%;height:100%;display:grid;grid-template-rows:auto 14px auto;grid-template-areas:"header" "body" "footer";grid-gap:10px;align-items:center;cursor:pointer}.op-ian-item--top-line{grid-area:header;display:grid;grid-template-columns:max-content max-content minmax(0,max-content) minmax(0,max-content) auto minmax(20px,max-content);grid-template-areas:"status wpIdLink project reason count buttons";grid-column-gap:5px;font-size:14px;align-items:center}.op-ian-item--middle-line{grid-area:body;display:grid;grid-template-columns:auto 1fr;grid-column-gap:5px;line-height:normal}.op-ian-item--bottom-line{grid-area:footer}.op-ian-item--work-package-subject{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap;font-weight:bold}.op-ian-item--work-package-subject.-read{font-weight:normal}.op-ian-item--work-package-id-link{grid-area:wpIdLink}.op-ian-item--project{grid-area:project;color:var(--gray-dark);overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-ian-item--project-link,.op-ian-item--work-package-id-link{color:var(--gray-dark);font-weight:bold}.op-ian-item--reason-count{grid-area:count;display:inline-flex;justify-content:center;align-items:center;box-sizing:content-box;height:16px;line-height:16px;width:16px;border-radius:.5rem;padding:0 .15rem;font-size:.7rem;font-weight:bold;background:#00A3FF;color:#fff;flex-shrink:0;justify-self:flex-end;margin-right:5px}.op-ian-item--reason-wrapper{grid-area:reason;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap;color:var(--gray-dark)}.op-ian-item--status{grid-area:status;margin-right:5px}.op-ian-item--buttons{grid-area:buttons;font-size:16px}.op-ian-item--button:hover{color:var(--content-link-hover-active-color)}.op-ian-item--button_shown-on-focus{position:absolute;right:-10000px}.op-ian-item--button_shown-on-focus:focus{right:0}.op-ian-item--loading-indicator{height:100%;display:block;grid-area:loadingIndicator}.op-ian-item--loading-indicator svg{height:calc(100px - 30px)}.op-ian-item--loading{display:grid;grid-template-columns:max-content auto minmax(20px,max-content);grid-template-areas:"loadingIndicator count buttons";grid-column-gap:5px}\n'],encapsulation:2,changeDetection:0});var Fe=t(32824),Te=t(90922),tt=t(46430),ut=t(85603),Yt=t(9170),It=t(24782),Nt=t(13623),wt=t(97656);function zt(ve,pe){if(1&ve&&(u._UZ(0,"op-in-app-notification-entry",9),u.ALo(1,"async"),u.ALo(2,"async")),2&ve){const ue=pe.$implicit,Ze=u.oxw(3);u.ekj("op-ian-item_expanded",ue[0].expanded)("op-ian-item_read",!0===ue[0].readIAN)("op-ian-item_selected",u.lcZ(1,11,Ze.stateChanged$)===ue[0]._links.resource.href),u.Q2q("data-qa-selector","op-ian-notification-item-",ue[0].id,""),u.Q6J("notification",ue[0])("aggregatedNotifications",ue),u.uIk("data-qa-ian-read",!0===ue[0].readIAN||void 0)("data-qa-ian-selected",u.lcZ(2,13,Ze.stateChanged$)===ue[0]._links.resource.href)}}function Kt(ve,pe){if(1&ve&&(u.ynx(0),u.TgZ(1,"cdk-virtual-scroll-viewport",7),u.YNc(2,zt,3,15,"op-in-app-notification-entry",8),u.ALo(3,"async"),u.qZA(),u.BQk()),2&ve){const ue=u.oxw(2);u.xp6(2),u.Q6J("cdkVirtualForOf",u.lcZ(3,3,ue.notifications$))("cdkVirtualForTrackBy",ue.trackNotificationGroups)("cdkVirtualForTemplateCacheSize",0)}}function ei(ve,pe){if(1&ve&&(u.TgZ(0,"div",10),u._UZ(1,"img",11),u.TgZ(2,"p",12),u._UZ(3,"span",13),u.ALo(4,"async"),u.qZA(),u._UZ(5,"span",13),u.ALo(6,"async"),u.qZA()),2&ve){const ue=u.oxw(2);u.xp6(1),u.Q6J("src",ue.image.no_notification,u.LSH),u.xp6(2),u.Q6J("textContent",ue.noNotificationText(ue.hasNotifications,u.lcZ(4,3,ue.totalCount$))),u.xp6(2),u.Q6J("textContent",u.lcZ(6,5,ue.noResultText$))}}function Rt(ve,pe){if(1&ve&&(u.ynx(0),u.YNc(1,Kt,4,5,"ng-container",2),u.ALo(2,"async"),u.YNc(3,ei,7,7,"ng-template",null,6,u.W1O),u.BQk()),2&ve){const ue=u.MAs(4),Ze=u.oxw();u.xp6(1),u.Q6J("ngIf",u.lcZ(2,2,Ze.hasNotifications$))("ngIfElse",ue)}}function Mt(ve,pe){if(1&ve&&u._UZ(0,"img",14),2&ve){const ue=u.oxw();u.Q6J("src",ue.image.loading,u.LSH)}}function Ot(ve,pe){if(1&ve&&(u._UZ(0,"p",15),u.ALo(1,"async")),2&ve){const ue=u.oxw();u.Q6J("textContent",u.lcZ(1,1,ue.totalCountWarning$))}}class St{constructor(pe,ue,Ze,Ge,ft,Pt,yt,Lt,Xt){var At;this.cdRef=pe,this.elementRef=ue,this.I18n=Ze,this.storeService=Ge,this.bellService=ft,this.uiRouterGlobals=Pt,this.state=yt,this.apiV3=Lt,this.pathService=Xt,this.maxSize=It.Z,this.hasMoreThanPageSize$=this.storeService.hasMoreThanPageSize$,this.hasNotifications$=this.storeService.hasNotifications$,this.notifications$=this.storeService.notifications$,this.loading$=this.storeService.loading$,this.totalCount$=this.bellService.unread$,this.noResultText$=this.totalCount$.pipe((0,r.U)(vt=>vt>0?this.text.no_results.with_current_filter:this.text.no_results.at_all)),this.totalCountWarning$=this.storeService.notLoaded$.pipe((0,Yt.h)(vt=>vt>0),(0,r.U)(vt=>this.I18n.t("js.notifications.center.total_count_warning",{newest_count:this.maxSize,more_count:vt}))),this.stateChanged$=this.storeService.stateChanged$,this.originalOrder=()=>0,this.reasonMenuItems=[{key:"mentioned",title:this.I18n.t("js.notifications.menu.mentioned")},{key:"assigned",title:this.I18n.t("js.label_assignee")},{key:"responsible",title:this.I18n.t("js.notifications.menu.accountable")},{key:"watched",title:this.I18n.t("js.notifications.menu.watched")},{key:"dateAlert",title:this.I18n.t("js.notifications.menu.date_alert")}],this.selectedFilter=null===(At=this.reasonMenuItems.find(vt=>vt.key===this.uiRouterGlobals.params.name))||void 0===At?void 0:At.title,this.image={no_notification:(0,wt.h)("notification-center/empty-state-no-notification.svg"),no_selection:(0,wt.h)("notification-center/empty-state-no-selection.svg"),loading:(0,wt.h)("notification-center/notification_loading.gif")},this.trackNotificationGroups=(vt,mi)=>mi.map(ai=>`${ai.id}@${ai.updatedAt}`).join(","),this.text={no_notification:this.I18n.t("js.notifications.center.empty_state.no_notification"),no_notification_with_current_filter_project:this.I18n.t("js.notifications.center.empty_state.no_notification_with_current_project_filter"),no_notification_with_current_filter:this.I18n.t("js.notifications.center.empty_state.no_notification_with_current_filter",{filter:this.selectedFilter}),no_selection:this.I18n.t("js.notifications.center.empty_state.no_selection"),change_notification_settings:this.I18n.t("js.notifications.settings.change_notification_settings",{url:this.pathService.myNotificationsSettingsPath()}),title:this.I18n.t("js.notifications.title"),button_close:this.I18n.t("js.button_close"),no_results:{at_all:this.I18n.t("js.notifications.center.no_results.at_all"),with_current_filter:this.I18n.t("js.notifications.center.no_results.with_current_filter")}}}ngOnInit(){this.storeService.setFacet("unread"),this.storeService.setFilters({filter:this.uiRouterGlobals.params.filter,name:this.uiRouterGlobals.params.name})}noNotificationText(pe,ue){return!pe&&ue>0?"project"===this.uiRouterGlobals.params.filter?this.text.no_notification_with_current_filter_project:this.text.no_notification_with_current_filter:this.text.no_notification}}St.\u0275fac=function(pe){return new(pe||St)(u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(i.D),u.Y36(se),u.Y36(Nt.L),u.Y36(ee.UIRouterGlobals),u.Y36(ee.StateService),u.Y36(h.T),u.Y36(a.j))},St.\u0275cmp=u.Xpm({type:St,selectors:[["op-in-app-notification-center"]],decls:9,vars:7,consts:[[1,"op-ian-center"],[1,"op-ian-center--content"],[4,"ngIf","ngIfElse"],["loading",""],[1,"op-ian-center--footer"],["class","op-ian-center--max-warning",3,"textContent",4,"ngIf"],["noResults",""],["itemSize","100",1,"op-ian-center--viewport"],["class","op-ian-item",3,"op-ian-item_expanded","op-ian-item_read","op-ian-item_selected","notification","aggregatedNotifications",4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy","cdkVirtualForTemplateCacheSize"],[1,"op-ian-item",3,"notification","aggregatedNotifications"],[1,"op-ian-center--loading-indicator"],[1,"op-ian-center-loading-image",3,"src"],[1,"op-ian-center-loading-text"],[3,"textContent"],["data-qa-selector","op-ian-center--loading-indicator",1,"op-ian-center--loading-indicator","op-ian-center-loading-image",3,"src"],[1,"op-ian-center--max-warning",3,"textContent"]],template:function(pe,ue){if(1&pe&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.YNc(2,Rt,5,4,"ng-container",2),u.ALo(3,"async"),u.YNc(4,Mt,1,1,"ng-template",null,3,u.W1O),u.qZA(),u.TgZ(6,"div",4),u.YNc(7,Ot,2,3,"p",5),u.ALo(8,"async"),u.qZA(),u.qZA()),2&pe){const Ze=u.MAs(5);u.xp6(2),u.Q6J("ngIf",!1===u.lcZ(3,3,ue.loading$))("ngIfElse",Ze),u.xp6(5),u.Q6J("ngIf",u.lcZ(8,5,ue.hasMoreThanPageSize$))}},styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-center[_ngcontent-%COMP%]{display:grid;grid-template-rows:1fr auto;height:100%}.op-ian-center--content[_ngcontent-%COMP%]{height:100%}.op-ian-center--viewport[_ngcontent-%COMP%]{height:100%;overflow-x:hidden;scrollbar-color:transparent transparent;scrollbar-width:thin}.op-ian-center--viewport[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.op-ian-center--viewport[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.op-ian-center--viewport[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.op-ian-center--viewport[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.op-ian-center--viewport[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.op-ian-center--max-warning[_ngcontent-%COMP%]{margin-bottom:0;text-align:center;font-style:italic}.op-ian-center--loading-indicator[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;max-width:600px}@media screen and (max-width: 679px){.op-ian-center--loading-indicator[_ngcontent-%COMP%]{left:0;top:2rem;transform:none}}.-browser-safari   .op-ian-center   [_nghost-%COMP%]{height:100%}.op-ian-center-loading-text[_ngcontent-%COMP%]{color:var(--gray-dark);font-size:18px}.op-ian-center-loading-image[_ngcontent-%COMP%]{max-height:130px;min-height:130px;margin-bottom:15px}"],changeDetection:0});var ti=t(2775);class Tt{constructor(pe,ue){this.I18n=pe,this.pathHelper=ue,this.myNotificationSettingsLink=this.pathHelper.myNotificationsSettingsPath(),this.text={mySettings:this.I18n.t("js.notifications.settings.title")}}}function qt(ve,pe){if(1&ve){const ue=u.EpF();u.ynx(0),u.TgZ(1,"button",1),u.NdJ("click",function(){const ft=u.CHM(ue).$implicit;return u.oxw().activateFacet(ft)}),u.ALo(2,"async"),u._UZ(3,"span",2),u.qZA(),u.BQk()}if(2&ve){const ue=pe.$implicit,Ze=u.oxw();u.xp6(1),u.ekj("-active",ue===u.lcZ(2,4,Ze.activeFacet$)),u.Q6J("title",Ze.text.facet_titles[ue]),u.xp6(2),u.Q6J("textContent",Ze.text.facets[ue])}}Tt.\u0275fac=function(pe){return new(pe||Tt)(u.Y36(i.D),u.Y36(a.j))},Tt.\u0275cmp=u.Xpm({type:Tt,selectors:[["op-notification-settings-button"]],decls:3,vars:2,consts:[["target","_blank",1,"button",3,"href"],["icon-classes","button--icon icon-settings"],[1,"button--text",3,"textContent"]],template:function(pe,ue){1&pe&&(u.TgZ(0,"a",0),u._UZ(1,"op-icon",1),u._UZ(2,"span",2),u.qZA()),2&pe&&(u.Q6J("href",ue.myNotificationSettingsLink,u.LSH),u.xp6(2),u.Q6J("textContent",ue.text.mySettings))},directives:[ti.o],encapsulation:2,changeDetection:0});class Qt{constructor(pe,ue){this.I18n=pe,this.storeService=ue,this.text={facets:{unread:this.I18n.t("js.notifications.facets.unread"),all:this.I18n.t("js.notifications.facets.all")},facet_titles:{unread:this.I18n.t("js.notifications.facets.unread_title"),all:this.I18n.t("js.notifications.facets.all_title")}},this.availableFacets=Object.keys(ie.yz),this.activeFacet$=this.storeService.activeFacet$}activateFacet(pe){this.storeService.setFacet(pe)}}Qt.\u0275fac=function(pe){return new(pe||Qt)(u.Y36(i.D),u.Y36(se))},Qt.\u0275cmp=u.Xpm({type:Qt,selectors:[["op-activate-facet"]],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["type","button",1,"button","form--field-inline-button",3,"title","click"],[1,"button--text","button--text_without_icon",3,"textContent"]],template:function(pe,ue){1&pe&&u.YNc(0,qt,4,6,"ng-container",0),2&pe&&u.Q6J("ngForOf",ue.availableFacets)},directives:[e.sg],pipes:[e.Ov],encapsulation:2,changeDetection:0});class Gt{constructor(pe,ue){this.I18n=pe,this.storeService=ue,this.text={mark_all_read:this.I18n.t("js.notifications.center.mark_all_read")}}markAllRead(){this.storeService.markAllAsRead()}}Gt.\u0275fac=function(pe){return new(pe||Gt)(u.Y36(i.D),u.Y36(se))},Gt.\u0275cmp=u.Xpm({type:Gt,selectors:[["op-mark-all-as-read-button"]],decls:3,vars:1,consts:[["type","button",1,"button",3,"click"],["icon-classes","button--icon icon-mark-all-read"],[1,"button--text",3,"textContent"]],template:function(pe,ue){1&pe&&(u.TgZ(0,"button",0),u.NdJ("click",function(){return ue.markAllRead()}),u._UZ(1,"op-icon",1),u._UZ(2,"span",2),u.qZA()),2&pe&&(u.xp6(2),u.Q6J("textContent",ue.text.mark_all_read))},directives:[ti.o],encapsulation:2,changeDetection:0});var ii=t(57014),Jt=t(57810),Ce=t(77616),N=t(81628),Q=t(32853);function je(ve,pe){if(1&ve&&u._UZ(0,"op-back-button",11),2&ve){const ue=u.oxw();u.Q6J("customBackMethod",ue.backButtonCallback)}}function Ee(ve,pe){if(1&ve&&(u.TgZ(0,"li",15),u._UZ(1,"ndc-dynamic",16),u.qZA()),2&ve){const ue=u.oxw().$implicit,Ze=u.oxw(2);u.Q6J("ngClass",ue.containerClasses),u.xp6(1),u.Q6J("ndcDynamicComponent",ue.component)("ndcDynamicInputs",ue.inputs)("ndcDynamicInjector",Ze.injector)("ndcDynamicOutputs",ue.outputs)}}function ht(ve,pe){if(1&ve&&(u.ynx(0),u.YNc(1,Ee,2,5,"li",14),u.BQk()),2&ve){const ue=pe.$implicit;u.xp6(1),u.Q6J("ngIf",!ue.show||ue.show())}}function kt(ve,pe){if(1&ve&&(u.TgZ(0,"ul",12),u.YNc(1,ht,2,1,"ng-container",13),u.qZA()),2&ve){const ue=u.oxw();u.xp6(1),u.Q6J("ngForOf",ue.toolbarButtonComponents)}}function si(ve,pe){if(1&ve&&u._UZ(0,"ndc-dynamic",17),2&ve){const ue=u.oxw();u.Q6J("ndcDynamicComponent",ue.filterContainerDefinition.component)("ndcDynamicInputs",ue.filterContainerDefinition.inputs)("ndcDynamicOutputs",ue.filterContainerDefinition.outputs)("ndcDynamicInjector",ue.injector)}}class Wt extends H.N{constructor(pe,ue,Ze,Ge,ft,Pt,yt,Lt){super(),this.I18n=pe,this.cdRef=ue,this.$transitions=Ze,this.state=Ge,this.injector=ft,this.apiV3Service=Pt,this.backRoutingService=yt,this.titleService=Lt,this.text={title:this.I18n.t("js.notifications.title")},this.backButtonCallback=void 0,this.selectedTitle=this.text.title,this.filterContainerDefinition=null,this.currentPartition="-split",this.showToolbar=!0,this.titleEditingEnabled=!1,this.showToolbarSaveButton=!1,this.toolbarDisabled=!1,this.toolbarButtonComponents=[{component:Qt,containerClasses:"form--field-inline-buttons-container"},{component:Gt},{component:Tt,containerClasses:"hidden-for-mobile"}]}ngOnInit(){this.documentReferer=document.referrer,this.setInitialHtmlTitle(),this.removeTransitionSubscription=this.$transitions.onSuccess({},()=>{this.titleService.setFirstPart(this.text.title)})}ngOnDestroy(){super.ngOnDestroy(),this.removeTransitionSubscription()}setPartition(pe){var ue;this.currentPartition=(null===(ue=pe.data)||void 0===ue?void 0:ue.partition)||"-split"}updateTitleName(pe){}changeChangesFromTitle(pe){}setInitialHtmlTitle(){const pe=this.titleService.titleParts;1===pe.length&&this.titleService.prependFirstPart(this.text.title),pe[0]!==this.text.title&&this.titleService.setFirstPart(this.text.title)}}Wt.\u0275fac=function(pe){return new(pe||Wt)(u.Y36(i.D),u.Y36(u.sBO),u.Y36(ee.TransitionService),u.Y36(ee.StateService),u.Y36(u.zs3),u.Y36(h.T),u.Y36(ii.Y),u.Y36(Jt.V))},Wt.\u0275cmp=u.Xpm({type:Wt,selectors:[["ng-component"]],features:[u._Bn([se]),u.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(pe,ue){1&pe&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.TgZ(2,"div",2),u.YNc(3,je,1,1,"op-back-button",3),u.TgZ(4,"editable-toolbar-title",4),u.NdJ("onSave",function(Ge){return ue.changeChangesFromTitle(Ge)})("onEmptySubmit",function(){return ue.updateTitleName("")}),u.qZA(),u.YNc(5,kt,2,1,"ul",5),u.qZA(),u.qZA(),u.TgZ(6,"div",6),u.YNc(7,si,1,4,"ndc-dynamic",7),u.qZA(),u.TgZ(8,"div",8),u._UZ(9,"div",9),u._UZ(10,"div",10),u.qZA(),u.qZA()),2&pe&&(u.Q6J("ngClass",ue.currentPartition),u.xp6(3),u.Q6J("ngIf",ue.backButtonCallback),u.xp6(1),u.Q6J("title",ue.selectedTitle)("inFlight",ue.toolbarDisabled)("showSaveCondition",ue.showToolbarSaveButton)("editable",ue.titleEditingEnabled),u.xp6(1),u.Q6J("ngIf",ue.showToolbar),u.xp6(2),u.Q6J("ngIf",ue.filterContainerDefinition))},directives:[e.mk,e.O5,Ce.s5,re.UIView,N.W,e.sg,Q.B5,Q.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}"],changeDetection:0});var ri=t(1813);var Qi=t(54547);class _i{constructor(pe){var ve;this.I18n=pe,this.video=(ve="notification-center/date-alert-notifications.mp4",`${t.p}assets/videos/${ve}`),this.text={title:this.I18n.t("js.notifications.date_alerts.upsale.title"),description:this.I18n.t("js.notifications.date_alerts.upsale.description")}}}_i.\u0275fac=function(pe){return new(pe||_i)(u.Y36(i.D))},_i.\u0275cmp=u.Xpm({type:_i,selectors:[["op-ian-date-alerts-upsale"]],decls:1,vars:4,consts:[[3,"feature_video","feature_title","feature_description","hide_breadcrumb"]],template:function(pe,ue){1&pe&&u._UZ(0,"op-enterprise-page",0),2&pe&&u.Q6J("feature_video",ue.video)("feature_title",ue.text.title)("feature_description",ue.text.description)("hide_breadcrumb",!0)},directives:[Qi._],encapsulation:2,changeDetection:0});const bi=[{name:"notifications",parent:"root",url:"/notifications?{filter:string}&{name:string}",data:{bodyClasses:"router--work-packages-base"},redirectTo:"notifications.center.show",views:{"!$default":{component:ri.p}}},{url:"/date_alerts",name:"notifications.date_alerts_upsale",component:_i},{name:"notifications.center",component:Wt,redirectTo:"notifications.center.show"},{name:"notifications.center.show",data:{baseRoute:"notifications.center.show"},views:{"content-left":{component:St}}},...(0,tt.Z)("notifications.center.show",void 0,ut.o)];var Ke=t(7794),Oe=t(87523);class Pe{}Pe.\u0275fac=function(pe){return new(pe||Pe)},Pe.\u0275mod=u.oAB({type:Pe}),Pe.\u0275inj=u.cJS({providers:[Nt.L],imports:[[n.H,re.UIRouterModule.forChild({states:bi}),Q.wA,e.ez,p.Q,Fe.j,Ke.H,Oe.a,Te.Cl]]}),u.B6R(St,[e.O5,Te.N7,Te.xd,Te.x0,Ue],[e.Ov])},6894:(te,M,t)=>{"use strict";t.d(M,{Y:()=>h});var n=t(54364),e=t(53875),p=t(2316);class h{}h.\u0275fac=function(i){return new(i||h)},h.\u0275mod=p.oAB({type:h}),h.\u0275inj=p.cJS({imports:[[n.ez,e.Q]]})},2308:(te,M,t)=>{"use strict";t.d(M,{j:()=>c});var n=t(2316),e=t(65146),p=t(77355),h=t(83635);class c{constructor(l,r){this.opModalService=l,this.currentProjectService=r,this.close=new n.vpe}open(l=this.currentProjectService.id){this.opModalService.show(h.E,"global",{projectId:l}).subscribe(r=>r.closingEvent.subscribe(d=>{this.close.emit(d.data)}))}}c.\u0275fac=function(l){return new(l||c)(n.LFG(p.S),n.LFG(e.R))},c.\u0275prov=n.Yz7({token:c,factory:c.\u0275fac})},83635:(te,M,t)=>{"use strict";t.d(M,{e:()=>a,E:()=>m});var f,v,a,n=t(60312),e=t(77355),p=t(33276),h=t(2316);function c(v,C){1&v&&h._UZ(0,"div",5)}function i(v,C){if(1&v){const u=h.EpF();h.TgZ(0,"op-ium-project-selection",6),h.NdJ("save",function(x){return h.CHM(u),h.oxw().onProjectSelectionSave(x)})("close",function(){return h.CHM(u),h.oxw().closeMe()}),h.qZA()}if(2&v){const u=h.oxw();h.Q6J("project",u.project)("type",u.type)("cdkTrapFocusAutoCapture",!0)}}function l(v,C){if(1&v){const u=h.EpF();h.TgZ(0,"op-ium-principal",7),h.NdJ("save",function(x){return h.CHM(u),h.oxw().onPrincipalSave(x)})("back",function(){h.CHM(u);const x=h.oxw();return x.goTo(x.Steps.ProjectSelection)})("close",function(){return h.CHM(u),h.oxw().closeMe()}),h.qZA()}if(2&v){const u=h.oxw();h.Q6J("project",u.project)("roleData",u.role)("messageData",u.message)("principalData",u.principalData)("type",u.type)("cdkTrapFocusAutoCapture",!0)}}function r(v,C){if(1&v){const u=h.EpF();h.TgZ(0,"op-ium-summary",8),h.NdJ("save",function(x){return h.CHM(u),h.oxw().onSuccessfulSubmission(x)})("back",function(){h.CHM(u);const x=h.oxw();return x.goTo(x.Steps.Principal)})("close",function(){return h.CHM(u),h.oxw().closeMe()}),h.qZA()}if(2&v){const u=h.oxw();h.Q6J("project",u.project)("principalData",u.principalData)("type",u.type)("role",u.role)("message",u.message)("cdkTrapFocusAutoCapture",!0)}}function d(v,C){if(1&v){const u=h.EpF();h.TgZ(0,"op-ium-success",9),h.NdJ("close",function(){return h.CHM(u),h.oxw().closeWithPrincipal()}),h.qZA()}if(2&v){const u=h.oxw();h.Q6J("principal",u.principalData.principal)("project",u.project)("type",u.type)("createdNewPrincipal",u.createdNewPrincipal)("cdkTrapFocusAutoCapture",!0)}}(v=f||(f={}))[v.ProjectSelection=0]="ProjectSelection",v[v.Principal=1]="Principal",v[v.Summary=2]="Summary",v[v.Success=3]="Success",function(v){v.User="User",v.Placeholder="PlaceholderUser",v.Group="Group"}(a||(a={}));class m extends n.T{constructor(C,u,k,x){super(C,u,k),this.locals=C,this.cdRef=u,this.elementRef=k,this.apiV3Service=x,this.Steps=f,this.step=f.ProjectSelection,this.data=null,this.type=null,this.project=null,this.principalData={principal:null,customFields:{}},this.role=null,this.message="",this.createdNewPrincipal=!1}get loading(){return this.locals.projectId&&!this.project}ngOnInit(){super.ngOnInit(),this.locals.projectId&&this.apiV3Service.projects.id(this.locals.projectId).get().subscribe(C=>{this.project=C,this.cdRef.markForCheck()},()=>{this.locals.projectId=null,this.cdRef.markForCheck()})}onProjectSelectionSave({type:C,project:u}){this.type=C,this.project=u,this.goTo(f.Principal)}onPrincipalSave({principalData:C,isAlreadyMember:u,role:k,message:x}){return this.principalData=C,this.role=k,this.message=x,u?this.closeWithPrincipal():this.goTo(f.Summary)}onSuccessfulSubmission(C){this.principalData.principal!==C.principal&&this.type===a.User&&(this.createdNewPrincipal=!0),this.principalData.principal=C.principal,this.goTo(f.Success)}goTo(C){this.step=C}closeWithPrincipal(){this.data=this.principalData.principal,this.closeMe()}}m.\u0275fac=function(C){return new(C||m)(h.Y36(e.E),h.Y36(h.sBO),h.Y36(h.SBq),h.Y36(p.T))},m.\u0275cmp=h.Xpm({type:m,selectors:[["ng-component"]],features:[h.qOj],decls:5,vars:5,consts:[["class","spot-modal",4,"ngIf"],["class","spot-modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",3,"project","type","cdkTrapFocusAutoCapture","save","close",4,"ngIf"],["class","spot-modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",3,"project","roleData","messageData","principalData","type","cdkTrapFocusAutoCapture","save","back","close",4,"ngIf"],["class","spot-modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",3,"project","principalData","type","role","message","cdkTrapFocusAutoCapture","save","back","close",4,"ngIf"],["class","spot-modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",3,"principal","project","type","createdNewPrincipal","cdkTrapFocusAutoCapture","close",4,"ngIf"],[1,"spot-modal"],["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal",3,"project","type","cdkTrapFocusAutoCapture","save","close"],["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal",3,"project","roleData","messageData","principalData","type","cdkTrapFocusAutoCapture","save","back","close"],["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal",3,"project","principalData","type","role","message","cdkTrapFocusAutoCapture","save","back","close"],["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal",3,"principal","project","type","createdNewPrincipal","cdkTrapFocusAutoCapture","close"]],template:function(C,u){1&C&&(h.YNc(0,c,1,0,"div",0),h.YNc(1,i,1,3,"op-ium-project-selection",1),h.YNc(2,l,1,6,"op-ium-principal",2),h.YNc(3,r,1,6,"op-ium-summary",3),h.YNc(4,d,1,5,"op-ium-success",4)),2&C&&(h.Q6J("ngIf",u.loading),h.xp6(1),h.Q6J("ngIf",!u.loading&&u.step===u.Steps.ProjectSelection),h.xp6(1),h.Q6J("ngIf",!u.loading&&u.step===u.Steps.Principal),h.xp6(1),h.Q6J("ngIf",!u.loading&&u.step===u.Steps.Summary),h.xp6(1),h.Q6J("ngIf",!u.loading&&u.step===u.Steps.Success))},styles:[".op-modal form{display:flex;flex-direction:column;height:100%;flex-grow:1}.op-modal .spot-form-field+.spot-form-field{margin-top:1rem}\n"],encapsulation:2,changeDetection:0})},18137:(te,M,t)=>{"use strict";t.d(M,{L:()=>P});var n=t(60312),e=t(77355),p=t(96617),h=t(12702),c=t(79902),i=t(18511),l=t(86469),r=t(70233),d=t(36293),f=t(33276),a=t(18869),m=t(2316),v=t(53882),C=t(54364);const u=["downloadLink"];function k(E,T){if(1&E&&(m.TgZ(0,"div",11),m._UZ(1,"span",12),m.qZA()),2&E){const O=m.oxw();m.xp6(1),m.Q6J("ngClass",O.statusIcon)}}function x(E,T){if(1&E&&(m.TgZ(0,"ul"),m._UZ(1,"li",15),m.qZA()),2&E){const O=T.$implicit;m.xp6(1),m.Q6J("textContent",O)}}function b(E,T){if(1&E&&(m.TgZ(0,"p"),m._UZ(1,"span",15),m._UZ(2,"a",15),m.qZA()),2&E){const O=m.oxw(2);m.xp6(1),m.Q6J("textContent",O.text.redirect_errors),m.xp6(1),m.Q6J("textContent",O.text.redirect_link),m.uIk("href",O.payload.redirect,m.LSH)}}function y(E,T){if(1&E&&(m.ynx(0),m._UZ(1,"h3",13),m.YNc(2,x,2,1,"ul",14),m.YNc(3,b,3,3,"p",10),m.BQk()),2&E){const O=m.oxw();m.xp6(1),m.Q6J("textContent",O.text.errors),m.xp6(1),m.Q6J("ngForOf",O.payload.errors),m.xp6(1),m.Q6J("ngIf",null==O.payload?null:O.payload.redirect)}}class P extends n.T{constructor(T,O,I,Z,j,B,J,R,F){super(T,O,Z),this.locals=T,this.cdRef=O,this.I18n=I,this.elementRef=Z,this.pathHelper=j,this.apiV3Service=B,this.loadingIndicator=J,this.toastService=R,this.httpClient=F,this.text={title:this.I18n.t("js.job_status.title"),closePopup:this.I18n.t("js.close_popup_title"),redirect:this.I18n.t("js.job_status.redirect"),redirect_errors:`${this.I18n.t("js.job_status.redirect_errors")} `,redirect_link:this.I18n.t("js.job_status.redirect_link"),errors:this.I18n.t("js.job_status.errors"),download_starts:this.I18n.t("js.job_status.download_starts"),click_to_download:this.I18n.t("js.job_status.click_to_download")},this.isLoading=!1,this.title=this.text.title,this.downloadHref=null,this.jobId=T.jobId}ngOnInit(){super.ngOnInit(),this.listenOnJobStatus()}listenOnJobStatus(){(0,h.H)(0,2e3).pipe((0,c.w)(()=>this.performRequest()),(0,i.o)(T=>!!T.body&&this.continuedStatus(T.body),!0),this.untilDestroyed(),(0,l.RA)(this.loadingIndicator.getter("modal"))).subscribe(T=>this.onResponse(T),T=>this.handleError(T),()=>{this.isLoading=!1})}iconForStatus(){switch(this.status){case"cancelled":case"failure":case"error":return"icon-error";case"success":return"icon-checkmark";default:return null}}continuedStatus(T){return["in_queue","in_process"].includes(T.status)}onResponse(T){var O;const{body:I}=T;if(!I)throw new Error(T);const Z=this.status=I.status;this.message=I.message||this.I18n.t(`js.job_status.generic_messages.${Z}`,{defaultValue:Z}),this.payload=I.payload,I.payload&&(this.title=I.payload.title||this.text.title,this.handleRedirect(I.payload),this.handleDownload(null===(O=I.payload)||void 0===O?void 0:O.download)),this.statusIcon=this.iconForStatus(),this.cdRef.detectChanges()}handleRedirect(T){(null==T?void 0:T.redirect)&&!(null==T?void 0:T.errors)&&(setTimeout(()=>{window.location.href=T.redirect},2e3),this.message+=`. ${this.text.redirect}`)}handleDownload(T){void 0!==T&&this.httpClient.get(T,{observe:"response",responseType:"text",headers:{[a.i]:"true"}}).subscribe(O=>{this.downloadHref=O.url,this.cdRef.detectChanges(),this.downloadLink.nativeElement.click()},O=>{0===O.status&&(this.downloadHref=T,this.cdRef.detectChanges())})}performRequest(){return this.httpClient.get(this.jobUrl,{observe:"response",responseType:"json"})}handleError(T){404===(null==T?void 0:T.status)?(this.statusIcon="icon-help",this.message=this.I18n.t("js.job_status.generic_messages.not_found")):(this.statusIcon="icon-error",this.message=(null==T?void 0:T.message)||this.I18n.t("js.error.internal"),this.toastService.addError(this.message)),this.cdRef.detectChanges()}get jobUrl(){return this.apiV3Service.job_statuses.id(this.jobId).toString()}}P.\u0275fac=function(T){return new(T||P)(m.Y36(e.E),m.Y36(m.sBO),m.Y36(p.D),m.Y36(m.SBq),m.Y36(r.j),m.Y36(f.T),m.Y36(l.vt),m.Y36(d.kl),m.Y36(v.eN))},P.\u0275cmp=m.Xpm({type:P,selectors:[["ng-component"]],viewQuery:function(T,O){if(1&T&&m.Gf(u,5),2&T){let I;m.iGM(I=m.CRH())&&(O.downloadLink=I.first)}},features:[m.qOj],decls:14,vars:8,consts:[[1,"spot-modal","job-status--modal"],["data-qa-selector","job-status--header",1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["data-indicator-name","modal",1,"loading-indicator--location"],["class","status-icon-wrapper",4,"ngIf"],[1,"job-status--modal-main-message",3,"textContent"],[3,"hidden"],["download","","target","_blank",3,"textContent"],["downloadLink",""],[4,"ngIf"],[1,"status-icon-wrapper"],[1,"icon-big",3,"ngClass"],[1,"job-status--modal-additional-errors",3,"textContent"],[4,"ngFor","ngForOf"],[3,"textContent"]],template:function(T,O){1&T&&(m.TgZ(0,"div",0),m.TgZ(1,"div",1),m._uU(2),m.qZA(),m._UZ(3,"div",2),m.TgZ(4,"div",3),m.TgZ(5,"div",4),m.YNc(6,k,2,1,"div",5),m.qZA(),m.TgZ(7,"div"),m._UZ(8,"span",6),m.TgZ(9,"span",7),m._uU(10),m._UZ(11,"a",8,9),m.qZA(),m.YNc(13,y,4,3,"ng-container",10),m.qZA(),m.qZA(),m.qZA()),2&T&&(m.xp6(2),m.Oqu(O.title),m.xp6(4),m.Q6J("ngIf",!O.isLoading&&O.statusIcon),m.xp6(2),m.Q6J("textContent",O.message),m.xp6(1),m.Q6J("hidden",!O.downloadHref),m.xp6(1),m.hij(" ",O.text.download_starts," "),m.xp6(1),m.Q6J("textContent",O.text.click_to_download),m.uIk("href",O.downloadHref,m.LSH),m.xp6(2),m.Q6J("ngIf",null==O.payload?null:O.payload.errors))},directives:[C.O5,C.mk,C.sg],styles:[".job-status--modal[_ngcontent-%COMP%]{min-height:350px;min-width:450px;overflow-y:scroll}@media screen and (max-width: 679px){.job-status--modal[_ngcontent-%COMP%]{min-width:200px}}.loading-indicator--location[_ngcontent-%COMP%]{height:220px}.status-icon-wrapper[_ngcontent-%COMP%]{display:flex;height:100%;align-items:center;justify-content:center}.job-status--modal-main-message[_ngcontent-%COMP%]{font-weight:bold;display:flex;justify-content:center}.job-status--modal-additional-errors[_ngcontent-%COMP%]{margin-top:2rem}"],changeDetection:0})},53448:(te,M,t)=>{"use strict";t.d(M,{$:()=>e});var n=t(2316);class e{constructor(){this.hooks={}}register(h,c){!c||(this.hooks[h]||(this.hooks[h]=[]),this.hooks[h].push(c))}call(h,...c){const i=[];if(this.hooks[h])for(let l=0;l<this.hooks[h].length;l++){const r=this.hooks[h][l](...c);r&&i.push(r)}return i}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},71718:(te,M,t)=>{"use strict";t.r(M),t.d(M,{OpenprojectProjectsModule:()=>J});var n=t(6496),e=t(84906),p=t(2246),h=t(47775),c=t(26942),i=t(65146),l=t(70233),r=t(2316),d=t(98377);class f extends c.N{constructor(F,Y,X){super(),this._pathHelperService=F,this._$state=Y,this._currentProjectService=X,this.formMethod="patch",this.hiddenFields=["identifier","active"]}ngOnInit(){this.projectsPath=this._currentProjectService.apiv3Path,this.dynamicFieldsSettingsPipe=F=>F.reduce((Y,X)=>(this.isFieldHidden(X.key)&&(X=Object.assign(Object.assign({},X),{hide:!0})),[...Y,X]),[])}isFieldHidden(F){return this.hiddenFields.includes(F||"")}}f.\u0275fac=function(F){return new(F||f)(r.Y36(l.j),r.Y36(h.StateService),r.Y36(i.R))},f.\u0275cmp=r.Xpm({type:f,selectors:[["app-projects"]],features:[r.qOj],decls:1,vars:3,consts:[["helpTextAttributeScope","Project",3,"resourcePath","formHttpMethod","fieldsSettingsPipe"]],template:function(F,Y){1&F&&r._UZ(0,"op-dynamic-form",0),2&F&&r.Q6J("resourcePath",Y.projectsPath)("formHttpMethod",Y.formMethod)("fieldsSettingsPipe",Y.dynamicFieldsSettingsPipe)},directives:[d.r],styles:[""]});var a=t(96617),m=t(1707),v=t(33276),C=t(33927),u=t(18137),k=t(77355),x=t(26269),b=t(54364),y=t(92512),P=t(36868);const E=function(R){return{"op-highlighted-input":!0,"op-highlighted-input_active":R}};class T extends c.N{constructor(F,Y,X,K,ie,H){super(),this.apiV3Service=F,this.uIRouterGlobals=Y,this.pathHelperService=X,this.modalService=K,this.$state=ie,this.I18n=H,this.dynamicFieldsSettingsPipe=this.fieldSettingsPipe.bind(this),this.initialPayload={},this.text={use_template:this.I18n.t("js.project.use_template"),no_template_selected:this.I18n.t("js.project.no_template_selected"),advancedSettingsLabel:this.I18n.t("js.forms.advanced_settings"),copySettingsLabel:this.I18n.t("js.project.copy.copy_options")},this.hiddenFields=["identifier","active"],this.copyableTemplateFilter=(new x.qM).add("user_action","=",["projects/copy"]).add("templated","=",!0),this.templateOptions$=this.apiV3Service.projects.filtered(this.copyableTemplateFilter,{pageSize:"-1"}).get().pipe((0,C.U)(ee=>ee.elements.map(ce=>({href:ce.href,name:ce.name})))),this.templateForm=new m.cw({template:new m.NI})}get templateControl(){return this.templateForm.get("template")}ngOnInit(){this.resourcePath=this.apiV3Service.projects.path,this.fieldGroups=[{name:this.text.advancedSettingsLabel,fieldsFilter:F=>{var Y,X,K;return!(["name","parent"].includes(null===(Y=F.templateOptions)||void 0===Y?void 0:Y.property)||this.isMeta(null===(X=F.templateOptions)||void 0===X?void 0:X.property)||(null===(K=F.templateOptions)||void 0===K?void 0:K.required)&&!F.templateOptions.hasDefault&&null==F.templateOptions.payloadValue)}},{name:this.text.copySettingsLabel,fieldsFilter:F=>{var Y;return this.isMeta(null===(Y=F.templateOptions)||void 0===Y?void 0:Y.property)}}],this.uIRouterGlobals.params.parent_id&&this.setParentAsPayload(this.uIRouterGlobals.params.parent_id)}onSubmitted(F){"JobStatus"===F._type?this.modalService.show(u.L,"global",{jobId:F.jobId}):window.location.href=this.pathHelperService.projectPath(F.identifier)}onTemplateSelected(F){var Y;this.initialPayload=Object.assign(Object.assign({},this.initialPayload),{name:this.dynamicForm.model.name,_meta:Object.assign(Object.assign({},null===(Y=this.initialPayload)||void 0===Y?void 0:Y._meta),{sendNotifications:!1})}),this.formUrl=(null==F?void 0:F.href)?`${F.href}/copy`:null}isHiddenField(F){return"_meta.sendNotifications"!==F&&(!!F&&(this.hiddenFields.includes(F)||this.isMeta(F)))}isMeta(F){return!!F&&(F.startsWith("copy")||"sendNotifications"===F)}setParentAsPayload(F){const Y=this.apiV3Service.projects.id(F).path;this.initialPayload={_links:{parent:{href:Y}}}}fieldSettingsPipe(F){return F.map(Y=>Object.assign(Object.assign({},Y),{hide:this.isHiddenField(Y.key)}))}}T.\u0275fac=function(F){return new(F||T)(r.Y36(v.T),r.Y36(h.UIRouterGlobals),r.Y36(l.j),r.Y36(k.S),r.Y36(h.StateService),r.Y36(a.D))},T.\u0275cmp=r.Xpm({type:T,selectors:[["op-new-project"]],viewQuery:function(F,Y){if(1&F&&r.Gf(d.r,5),2&F){let X;r.iGM(X=r.CRH())&&(Y.dynamicForm=X.first)}},features:[r.qOj],decls:6,vars:15,consts:[[1,"op-form",3,"formGroup"],[3,"ngClass"],["data-qa-field-name","use_template",3,"label"],["bindLabel","name","slot","input",3,"formControl","items","placeholder","ngModelChange"],["helpTextAttributeScope","Project",3,"formUrl","resourcePath","initialPayload","fieldsSettingsPipe","fieldGroups","submitted"]],template:function(F,Y){1&F&&(r.TgZ(0,"form",0),r.TgZ(1,"div",1),r.TgZ(2,"spot-form-field",2),r.TgZ(3,"ng-select",3),r.NdJ("ngModelChange",function(K){return Y.onTemplateSelected(K)}),r.ALo(4,"async"),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(5,"op-dynamic-form",4),r.NdJ("submitted",function(K){return Y.onSubmitted(K)}),r.qZA()),2&F&&(r.Q6J("formGroup",Y.templateForm),r.xp6(1),r.Q6J("ngClass",r.VKq(13,E,!(null==Y.templateControl||!Y.templateControl.value))),r.xp6(1),r.Q6J("label",Y.text.use_template),r.xp6(1),r.Q6J("formControl",Y.templateControl)("items",r.lcZ(4,11,Y.templateOptions$))("placeholder",Y.text.no_template_selected),r.xp6(2),r.Q6J("formUrl",Y.formUrl)("resourcePath",Y.resourcePath)("initialPayload",Y.initialPayload)("fieldsSettingsPipe",Y.dynamicFieldsSettingsPipe)("fieldGroups",Y.fieldGroups))},directives:[m._Y,m.JL,m.sg,b.mk,y.I,P.w9,m.JJ,m.oH,d.r],pipes:[b.Ov],styles:[".op-form[_ngcontent-%COMP%]{margin-bottom:1rem}"]});class O extends c.N{constructor(F,Y,X,K,ie,H){super(),this.apiV3Service=F,this.currentProjectService=Y,this.pathHelperService=X,this.modalService=K,this.$state=ie,this.I18n=H,this.dynamicFieldsSettingsPipe=this.fieldSettingsPipe.bind(this),this.hiddenFields=["identifier","active"],this.text={advancedSettingsLabel:this.I18n.t("js.forms.advanced_settings"),copySettingsLabel:this.I18n.t("js.project.copy.copy_options")}}ngOnInit(){this.formUrl=this.apiV3Service.projects.id(this.currentProjectService.id).copy.form.path,this.fieldGroups=[{name:this.text.advancedSettingsLabel,fieldsFilter:F=>{var Y;return!this.isMeta(null===(Y=F.templateOptions)||void 0===Y?void 0:Y.property)&&!this.isPrimaryAttribute(F.templateOptions)}},{name:this.text.copySettingsLabel,fieldsFilter:F=>{var Y;return this.isMeta(null===(Y=F.templateOptions)||void 0===Y?void 0:Y.property)}}]}onSubmitted(F){this.modalService.show(u.L,"global",{jobId:F.jobId})}isHiddenField(F){return!!F&&this.hiddenFields.includes(F)}fieldSettingsPipe(F){return this.sortedCopyFields(F).map(Y=>Object.assign(Object.assign({},Y),{hide:this.isHiddenField(Y.key)}))}isPrimaryAttribute(F){return!!F&&(F.required&&!F.hasDefault&&null==F.payloadValue||"name"===F.property||"parent"===F.property)}isMeta(F){return!!F&&(F.startsWith("copy")||"sendNotifications"===F)}sortedCopyFields(F){const Y=F.filter(K=>K.key&&K.key.startsWith("_meta.copy")).sort((K,ie)=>K.templateOptions&&K.templateOptions.label&&ie.templateOptions&&ie.templateOptions.label?K.templateOptions.label.localeCompare(ie.templateOptions.label):0),X=F.filter(K=>!K.key||!K.key.startsWith("_meta.copy"));return Y.concat(X)}}O.\u0275fac=function(F){return new(F||O)(r.Y36(v.T),r.Y36(i.R),r.Y36(l.j),r.Y36(k.S),r.Y36(h.StateService),r.Y36(a.D))},O.\u0275cmp=r.Xpm({type:O,selectors:[["op-copy-project"]],features:[r.qOj],decls:1,vars:3,consts:[["helpTextAttributeScope","Project",3,"formUrl","fieldsSettingsPipe","fieldGroups","submitted"]],template:function(F,Y){1&F&&(r.TgZ(0,"op-dynamic-form",0),r.NdJ("submitted",function(K){return Y.onSubmitted(K)}),r.qZA()),2&F&&r.Q6J("formUrl",Y.formUrl)("fieldsSettingsPipe",Y.dynamicFieldsSettingsPipe)("fieldGroups",Y.fieldGroups)},directives:[d.r],encapsulation:2});const I=[{name:"project_settings",parent:"optional_project",url:"/settings/general/",component:f},{name:"project_copy",parent:"optional_project",url:"/copy",component:O},{name:"new_project",url:"/projects/new?parent_id",component:T}];var j=t(64775),B=t(21757);class J{}J.\u0275fac=function(F){return new(F||J)},J.\u0275mod=r.oAB({type:J}),J.\u0275inj=r.cJS({imports:[[B.H,m.UX,n.f,p.E,e.UIRouterModule.forChild({states:I,config:function(R){R.urlService.rules.when(new RegExp("^/projects/(.*)/settings/general$"),F=>`/projects/${F[1]}/settings/general/`)}}),j.r]]})},81628:(te,M,t)=>{"use strict";t.d(M,{W:()=>i});var n=t(57014),e=t(96617),p=t(2316),h=t(54364),c=t(2775);class i{constructor(r,d){this.backRoutingService=r,this.I18n=d,this.text={goBack:this.I18n.t("js.button_back")}}goBack(){this.customBackMethod?this.customBackMethod():this.backRoutingService.goBack()}}i.\u0275fac=function(r){return new(r||i)(p.Y36(n.Y),p.Y36(e.D))},i.\u0275cmp=p.Xpm({type:i,selectors:[["op-back-button"]],inputs:{linkClass:"linkClass",customBackMethod:"customBackMethod"},decls:2,vars:2,consts:[["data-qa-selector","op-back-button",1,"op-back-button","button","hide-when-print",3,"ngClass","title","click"],["icon-classes","op-back-button--icon button--icon icon-back-up"]],template:function(r,d){1&r&&(p.TgZ(0,"button",0),p.NdJ("click",function(){return d.goBack()}),p._UZ(1,"op-icon",1),p.qZA()),2&r&&p.Q6J("ngClass",d.linkClass)("title",d.text.goBack)},directives:[h.mk,c.o],styles:[".op-back-button[_ngcontent-%COMP%]{padding:0;line-height:32px;margin:0 1rem 0 0;width:75px;height:34px}.op-back-button--icon[_ngcontent-%COMP%]{font-size:1rem;line-height:22px}@media only screen and (max-width: 679px){.op-back-button_mobile-limited-width[_ngcontent-%COMP%]{width:64px}}"],changeDetection:0})},57014:(te,M,t)=>{"use strict";t.d(M,{Y:()=>i});var n=t(3786),e=t(47775),p=t(84109),h=t(29161),c=t(2316);class i{constructor(r){this.injector=r}goToOtherState(r,d){return this.$state.go(r,d)}goBackToDetailsState(r,d){if(r)this.goToOtherState(d,this.backRoute.params);else{const f=`${d}.details.tabs`,a=Object.assign(Object.assign({},this.backRoute.params),{tabIdentifier:this.keepTab.currentDetailsTab});this.goToOtherState(f,a)}}goBackNotToDetailsState(){this.backRoute.parent?this.goToOtherState(this.backRoute.name,this.backRoute.params).then(()=>{this.$state.reload()}):this.goToOtherState(this.backRoute.name,this.backRoute.params)}goBackToPreviousState(r,d){this.keepTab.isDetailsState(this.backRoute.parent)?this.goBackToDetailsState(r,d):this.goBackNotToDetailsState()}goBack(r=!1){var d;const f=(null===(d=this.backRoute)||void 0===d?void 0:d.baseRoute)||this.$state.current.data.baseRoute||"work-packages.partitioned.list";!this.backRoute&&f.includes("show")?this.$state.reload():!this.backRoute||this.backRoute.name.includes("new")?this.$state.go(f,this.$state.params):this.goBackToPreviousState(r,f)}goToBaseState(){const r=this.$state.current.data.baseRoute||"work-packages.partitioned.list";this.$state.go(r,this.$state.params)}sync(r){const d=r.from(),f=r.to();if(d.name&&d.data&&f.data&&d.data.parent!==f.data.parent){const a=Object.assign({},r.params("from"));this.backRoute={name:d.name,params:a,parent:d.data.parent,baseRoute:d.data.baseRoute}}}set backRoute(r){this._backRoute=r}get backRoute(){return this._backRoute}}i.\u0275fac=function(r){return new(r||i)(c.LFG(c.zs3))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",e.StateService)],i.prototype,"$state",void 0),(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",p.p)],i.prototype,"keepTab",void 0)},66979:(te,M,t)=>{"use strict";t.d(M,{Y:()=>c});var n=t(2316),e=t(96617),p=t(61342),h=t(2775);class c{constructor(l,r,d){this.I18n=l,this.editForm=r,this.cdRef=d,this.onSave=new n.vpe,this.onCancel=new n.vpe,this._saving=!1,this.text={save:this.I18n.t("js.button_save"),cancel:this.I18n.t("js.button_cancel")}}set saving(l){this._saving=l,this.cdRef.detectChanges()}get saving(){return this._saving}save(){this.saving||(this.saving=!0,this.editForm.submit().then(()=>{this.saving=!1,this.onSave.emit()}).catch(()=>{this.saving=!1}))}cancel(){this.editForm.cancel(),this.onCancel.emit()}}c.\u0275fac=function(l){return new(l||c)(n.Y36(e.D),n.Y36(p.n),n.Y36(n.sBO))},c.\u0275cmp=n.Xpm({type:c,selectors:[["wp-edit-actions-bar"]],outputs:{onSave:"onSave",onCancel:"onCancel"},decls:7,vars:3,consts:[[1,"work-packages--edit-actions"],["id","work-packages--edit-actions-save","accesskey","3",1,"button","-highlight",3,"disabled","click"],["icon-classes","button--icon icon-checkmark"],[1,"button--text",3,"textContent"],["id","work-packages--edit-actions-cancel","accesskey","7",1,"button",3,"click"],["icon-classes","button--icon icon-close"]],template:function(l,r){1&l&&(n.TgZ(0,"div",0),n.TgZ(1,"button",1),n.NdJ("click",function(){return r.save()}),n._UZ(2,"op-icon",2),n._UZ(3,"span",3),n.qZA(),n.TgZ(4,"button",4),n.NdJ("click",function(){return r.cancel()}),n._UZ(5,"op-icon",5),n._UZ(6,"span",3),n.qZA(),n.qZA()),2&l&&(n.xp6(1),n.Q6J("disabled",r.saving),n.xp6(2),n.Q6J("textContent",r.text.save),n.xp6(3),n.Q6J("textContent",r.text.cancel))},directives:[h.o],encapsulation:2,changeDetection:0})},77434:(te,M,t)=>{"use strict";t.d(M,{J:()=>v});var n=t(74647),e=t(93175),p=t(26942),h=t(38519),c=t(78434),i=t(2316),l=t(54364),r=t(32557);function d(C,u){if(1&C){const k=i.EpF();i.TgZ(0,"button",3),i.NdJ("click",function(){return i.CHM(k),i.oxw().wpFiltersService.toggleVisibility()}),i.ALo(1,"async"),i._UZ(2,"i",4),i._UZ(3,"span",5),i.qZA()}if(2&C){const k=i.oxw();i.ekj("-active",i.lcZ(1,3,k.visible$)),i.xp6(3),i.Q6J("textContent",k.filterButtonText)}}function f(C,u){if(1&C){const k=i.EpF();i.TgZ(0,"op-query-filters",8),i.NdJ("filtersChanged",function(b){return i.CHM(k),i.oxw(2).replaceIfComplete(b)}),i.qZA()}if(2&C){const k=i.oxw(2);i.Q6J("filters",k.filters)("showCloseFilter",!0)}}function a(C,u){if(1&C&&(i.TgZ(0,"div",6),i.YNc(1,f,1,2,"op-query-filters",7),i.qZA()),2&C){const k=i.oxw();i.xp6(1),i.Q6J("ngIf",!!k.filters)}}const m=function(C){return{"-loaded":C}};class v extends p.N{constructor(u,k,x){super(),this.wpTableFilters=u,this.cdRef=k,this.wpFiltersService=x,this.showFilterButton=!1,this.filterButtonText=I18n.t("js.button_filter"),this.filtersChanged=new e.R((0,h.J6)(this)),this.filters=this.wpTableFilters.current,this.loaded=!1,this.visible$=this.wpFiltersService.observeUntil((0,h.J6)(this))}ngOnInit(){this.wpTableFilters.pristine$().pipe(this.untilDestroyed()).subscribe(()=>{this.filters=this.wpTableFilters.current,this.loaded=!0,this.cdRef.detectChanges()})}replaceIfComplete(u){const k=u.filter(x=>this.wpTableFilters.isAvailable(x));this.wpTableFilters.replaceIfComplete(k),this.filtersChanged.emit(k)}}v.\u0275fac=function(u){return new(u||v)(i.Y36(n.Z),i.Y36(i.sBO),i.Y36(c.U))},v.\u0275cmp=i.Xpm({type:v,selectors:[["op-filter-container"]],inputs:{showFilterButton:"showFilterButton",filterButtonText:"filterButtonText"},outputs:{filtersChanged:"filtersChanged"},features:[i.qOj],decls:4,vars:7,consts:[["class","button -small advanced-filters--toggle",3,"-active","click",4,"ngIf"],[1,"work-packages--filters-optional-container",3,"ngClass"],["id","query_form_content","class","hide-when-print",4,"ngIf"],[1,"button","-small","advanced-filters--toggle",3,"click"],[1,"button--icon","icon-filter"],[1,"button--text",3,"textContent"],["id","query_form_content",1,"hide-when-print"],[3,"filters","showCloseFilter","filtersChanged",4,"ngIf"],[3,"filters","showCloseFilter","filtersChanged"]],template:function(u,k){1&u&&(i.YNc(0,d,4,5,"button",0),i.TgZ(1,"div",1),i.YNc(2,a,2,1,"div",2),i.ALo(3,"async"),i.qZA()),2&u&&(i.Q6J("ngIf",k.showFilterButton),i.xp6(1),i.Q6J("ngClass",i.VKq(5,m,k.loaded)),i.xp6(1),i.Q6J("ngIf",i.lcZ(3,3,k.visible$)))},directives:[l.O5,l.mk,r.H],pipes:[l.Ov],encapsulation:2,changeDetection:0})},32557:(te,M,t)=>{"use strict";t.d(M,{H:()=>Jt});var n=t(96617),e=t(93175),p=t(43682),h=t(73881),c=t(36868),i=t(74647),l=t(78434),r=t(26942),d=t(38519),f=t(27779),a=t(2316),m=t(54364),v=t(79441),C=t(33927),u=t(83720),k=t(98636),x=t(80639),b=t(43440),y=t(14808),P=t(1707);class E extends r.N{constructor(N,Q,je){super(),this.I18n=N,this.querySpace=Q,this.wpTableFilters=je,this.deactivateFilter=new a.vpe,this.text={createWithDropdown:this.I18n.t("js.work_packages.create.button"),createButton:this.I18n.t("js.label_work_package"),explanation:this.I18n.t("js.label_create_work_package"),placeholder:this.I18n.t("js.work_packages.placeholder_filter_by_text")},this.searchTerm=(0,y.qH)(""),this.searchTermChanged=new v.xQ,this.wpTableFilters.pristine$().pipe(this.untilDestroyed(),(0,C.U)(()=>{const Ee=this.wpTableFilters.find("search");return Ee?Ee.values[0]:""})).subscribe(Ee=>{console.log(`upstream ${Ee} ${this.searchTerm.timestampOfLastValue}`),(!this.searchTerm.value||this.searchTerm.isValueOlderThan(500))&&(console.log(`Upstream value setting to ${Ee}`),this.searchTerm.putValue(Ee))}),this.searchTermChanged.pipe(this.untilDestroyed(),(0,u.x)(),(0,k.b)(Ee=>this.searchTerm.putValue(Ee)),(0,x.b)(500)).subscribe(Ee=>{if(Ee.length>0)this.wpTableFilters.replace("search",ht=>{ht.operator=ht.findOperator("**"),ht.values=[Ee]});else{const ht=this.wpTableFilters.find("search");this.wpTableFilters.remove(ht),this.deactivateFilter.emit(ht)}})}}E.\u0275fac=function(N){return new(N||E)(a.Y36(n.D),a.Y36(b.q),a.Y36(i.Z))},E.\u0275cmp=a.Xpm({type:E,selectors:[["wp-filter-by-text-input"]],outputs:{deactivateFilter:"deactivateFilter"},features:[a.qOj],decls:2,vars:4,consts:[["id","filter-by-text-input","type","text",3,"placeholder","ngModel","ngModelChange"]],template:function(N,Q){1&N&&(a.TgZ(0,"input",0),a.NdJ("ngModelChange",function(Ee){return Q.searchTermChanged.next(Ee)}),a.ALo(1,"async"),a.qZA()),2&N&&(a.s9C("placeholder",Q.text.placeholder),a.Q6J("ngModel",a.lcZ(1,2,Q.searchTerm.values$())))},directives:[P.Fj,P.JJ,P.On],pipes:[m.Ov],encapsulation:2});var T=t(2775),O=t(44022),I=t(65146),j=(t(63085),t(96091));class B{constructor(N){this.I18n=N,this.shouldFocus=!1,this.filterChanged=new a.vpe}get value(){return this.filter.values[0]}onFilterUpdated(N){this.filter.values[0]=N,this.filterChanged.emit(this.filter)}}B.\u0275fac=function(N){return new(N||B)(a.Y36(n.D))},B.\u0275cmp=a.Xpm({type:B,selectors:[["op-filter-boolean-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},decls:2,vars:3,consts:[[3,"id"],[3,"name","ngModel","ngModelChange"]],template:function(N,Q){1&N&&(a.TgZ(0,"label",0),a.TgZ(1,"spot-switch",1),a.NdJ("ngModelChange",function(Ee){return Q.onFilterUpdated(Ee)}),a.qZA(),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.MGl("name","v[",Q.filter.name,"]"),a.Q6J("ngModel",Q.value))},directives:[j.G,P.JJ,P.On],encapsulation:2});var J=t(84312);class R extends r.N{constructor(N,Q){super(),this.I18n=N,this.schemaCache=Q,this.shouldFocus=!1,this.filterChanged=new e.R((0,d.J6)(this))}get value(){return parseInt(this.filter.values[0])}set value(N){this.filter.values="number"==typeof N?[N.toString()]:[],this.filterChanged.emit(this.filter)}get unit(){switch(this.schema.filter.allowedValues[0].id){case"startDate":case"dueDate":case"updatedAt":case"createdAt":return this.I18n.t("js.work_packages.time_relative.days");default:return""}}get schema(){return this.schemaCache.of(this.filter)}}R.\u0275fac=function(N){return new(N||R)(a.Y36(n.D),a.Y36(O.y))},R.\u0275cmp=a.Xpm({type:R,selectors:[["op-filter-integer-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[a.qOj],decls:3,vars:7,consts:[[1,"inline-label",3,"id"],["required","","type","number",1,"advanced-filters--number-field",3,"ngModel","opAutofocus","id","name","ngModelChange"],[1,"advanced-filters--affix",3,"for","textContent"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"input",1),a.NdJ("ngModelChange",function(Ee){return Q.value=Ee}),a.qZA(),a._UZ(2,"label",2),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.MGl("id","values-",Q.filter.id,""),a.MGl("name","v[",Q.filter.id,"]"),a.Q6J("ngModel",Q.value)("opAutofocus",Q.shouldFocus),a.xp6(1),a.MGl("for","values-",Q.filter.id,""),a.Q6J("textContent",Q.unit))},directives:[P.wV,P.Fj,P.Q7,P.JJ,P.On,J.U],encapsulation:2});var F=t(70692),Y=t(90547);class X extends r.N{constructor(N,Q){super(),this.timezoneService=N,this.I18n=Q,this.shouldFocus=!1,this.filterChanged=new e.R((0,d.J6)(this))}get value(){return this.filter.values[0]}set value(N){this.filter.values=[N],this.filterChanged.emit(this.filter)}parser(N){return moment(N,"YYYY-MM-DD",!0).isValid()?N:null}formatter(N){if(moment(N,"YYYY-MM-DD",!0).isValid()){const Q=this.timezoneService.parseDate(N);return this.timezoneService.formattedISODate(Q)}return null}}X.\u0275fac=function(N){return new(N||X)(a.Y36(F.B),a.Y36(n.D))},X.\u0275cmp=a.Xpm({type:X,selectors:[["op-filter-date-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[a.qOj],decls:2,vars:5,consts:[[3,"id"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","opAutofocus","id","name","changed"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"op-single-date-picker",1),a.NdJ("changed",function(Ee){return Q.value=Q.parser(Ee)}),a.qZA(),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.Q6J("initialDate",Q.formatter(Q.value))("opAutofocus",Q.shouldFocus)("id","values-"+Q.filter.id)("name","v["+Q.filter.id+"]"))},directives:[Y.S,J.U],encapsulation:2});var K=t(2281);class ie extends r.N{constructor(N,Q){super(),this.timezoneService=N,this.I18n=Q,this.shouldFocus=!1,this.filterChanged=new e.R((0,d.J6)(this)),this.text={spacer:this.I18n.t("js.filter.value_spacer")}}get begin(){return this.filter.values[0]}set begin(N){this.filter.values[0]=N||"",this.filterChanged.emit(this.filter)}get end(){return this.filter.values[1]}set end(N){this.filter.values[1]=N||"",this.filterChanged.emit(this.filter)}parser(N){return K(N,"YYYY-MM-DD",!0).isValid()?N:null}formatter(N){if(K(N,"YYYY-MM-DD",!0).isValid()){const Q=this.timezoneService.parseDate(N);return this.timezoneService.formattedISODate(Q)}return null}}ie.\u0275fac=function(N){return new(N||ie)(a.Y36(F.B),a.Y36(n.D))},ie.\u0275cmp=a.Xpm({type:ie,selectors:[["op-filter-dates-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[a.qOj],decls:4,vars:9,consts:[[1,"inline-label",3,"id"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","opAutofocus","id","name","changed"],[1,"advanced-filters--affix",3,"textContent"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","id","name","changed"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"op-single-date-picker",1),a.NdJ("changed",function(Ee){return Q.begin=Q.parser(Ee)}),a.qZA(),a._UZ(2,"span",2),a.TgZ(3,"op-single-date-picker",3),a.NdJ("changed",function(Ee){return Q.end=Q.parser(Ee)}),a.qZA(),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.Q6J("initialDate",Q.formatter(Q.begin))("opAutofocus",Q.shouldFocus)("id","values-"+Q.filter.id+"-begin")("name","v["+Q.filter.id+"]-begin"),a.xp6(1),a.Q6J("textContent",Q.text.spacer),a.xp6(1),a.Q6J("initialDate",Q.formatter(Q.end))("id","values-"+Q.filter.id+"-end")("name","v["+Q.filter.id+"]-end"))},directives:[Y.S,J.U],encapsulation:2});class H extends r.N{constructor(N,Q){super(),this.I18n=N,this.timezoneService=Q}ngOnInit(){_.remove(this.filter.values,N=>!this.timezoneService.isValidISODateTime(N))}isoDateParser(N){if(!this.timezoneService.isValidISODate(N))return"";const Q=this.timezoneService.parseISODatetime(N);return this.timezoneService.formattedISODateTime(Q)}isoDateFormatter(N){if(!this.timezoneService.isValidISODateTime(N))return"";const Q=this.timezoneService.parseISODatetime(N);return this.timezoneService.formattedISODate(Q)}get isTimeZoneDifferent(){const N=this.lowerBoundary||this.upperBoundary;return!!N&&(0!==N.hours()||0!==N.minutes())}get timeZoneText(){return this.lowerBoundary&&this.upperBoundary?this.I18n.t("js.filter.time_zone_converted.two_values",{from:this.lowerBoundary.format("YYYY-MM-DD HH:mm"),to:this.upperBoundary.format("YYYY-MM-DD HH:mm")}):this.upperBoundary?this.I18n.t("js.filter.time_zone_converted.only_end",{to:this.upperBoundary.format("YYYY-MM-DD HH:mm")}):this.lowerBoundary?this.I18n.t("js.filter.time_zone_converted.only_start",{from:this.lowerBoundary.format("YYYY-MM-DD HH:mm")}):""}}function ee(Ce,N){if(1&Ce&&(a.TgZ(0,"span",3),a._UZ(1,"op-icon",4),a.qZA()),2&Ce){const Q=a.oxw();a.uIk("data-tooltip",Q.timeZoneText)}}H.\u0275fac=function(N){return new(N||H)(a.Y36(n.D),a.Y36(F.B))},H.\u0275dir=a.lG2({type:H,features:[a.qOj]});class ce extends H{constructor(N,Q){super(N,Q),this.I18n=N,this.timezoneService=Q,this.shouldFocus=!1,this.filterChanged=new e.R((0,d.J6)(this))}get value(){return this.filter.values[0]}get valueString(){return this.filter.values[0].toString()}set value(N){this.filter.values=[N],this.filterChanged.emit(this.filter)}get lowerBoundary(){return this.value&&this.timezoneService.isValidISODateTime(this.valueString)?this.timezoneService.parseDatetime(this.valueString):null}get upperBoundary(){return this.value&&this.timezoneService.isValidISODateTime(this.valueString)?this.timezoneService.parseDatetime(this.valueString).add(24,"hours"):null}}function se(Ce,N){if(1&Ce&&(a.TgZ(0,"span",5),a._UZ(1,"op-icon",6),a.qZA()),2&Ce){const Q=a.oxw();a.uIk("data-tooltip",Q.timeZoneText)}}ce.\u0275fac=function(N){return new(N||ce)(a.Y36(n.D),a.Y36(F.B))},ce.\u0275cmp=a.Xpm({type:ce,selectors:[["op-filter-date-time-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[a.qOj],decls:3,vars:6,consts:[[1,"inline-label",3,"id"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","opAutofocus","id","name","changed"],["class","advanced-filters--tooltip-trigger -multiline",4,"ngIf"],[1,"advanced-filters--tooltip-trigger","-multiline"],["icon-classes","icon icon-warning"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"op-single-date-picker",1),a.NdJ("changed",function(Ee){return Q.value=Q.isoDateParser(Ee)}),a.qZA(),a.YNc(2,ee,2,1,"span",2),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.Q6J("initialDate",Q.isoDateFormatter(Q.value))("opAutofocus",Q.shouldFocus)("id","values-"+Q.filter.id)("name","v["+Q.filter.id+"]"),a.xp6(1),a.Q6J("ngIf",Q.isTimeZoneDifferent))},directives:[Y.S,J.U,m.O5,T.o],encapsulation:2});class re extends H{constructor(N,Q){super(N,Q),this.I18n=N,this.timezoneService=Q,this.shouldFocus=!1,this.filterChanged=new e.R((0,d.J6)(this)),this.text={spacer:this.I18n.t("js.filter.value_spacer")}}get begin(){return this.filter.values[0]}set begin(N){this.filter.values[0]=N||"",this.filterChanged.emit(this.filter)}get end(){return this.filter.values[1]}set end(N){this.filter.values[1]=N||"",this.filterChanged.emit(this.filter)}get lowerBoundary(){return this.begin&&this.timezoneService.isValidISODateTime(this.begin.toString())?this.timezoneService.parseDatetime(this.begin.toString()):null}get upperBoundary(){return this.end&&this.timezoneService.isValidISODateTime(this.end.toString())?this.timezoneService.parseDatetime(this.end.toString()):null}}re.\u0275fac=function(N){return new(N||re)(a.Y36(n.D),a.Y36(F.B))},re.\u0275cmp=a.Xpm({type:re,selectors:[["op-filter-date-times-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[a.qOj],decls:5,vars:10,consts:[[1,"inline-label",3,"id"],["required","true","classes","advanced-filters--date-field","size","10",3,"initialDate","opAutofocus","id","name","changed"],[1,"advanced-filters--affix",3,"textContent"],["classes","advanced-filters--date-field","size","10",3,"initialDate","id","name","changed"],["class","advanced-filters--tooltip-trigger -multiline",4,"ngIf"],[1,"advanced-filters--tooltip-trigger","-multiline"],["icon-classes","icon icon-warning"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"op-single-date-picker",1),a.NdJ("changed",function(Ee){return Q.begin=Q.isoDateParser(Ee)}),a.qZA(),a._UZ(2,"span",2),a.TgZ(3,"op-single-date-picker",3),a.NdJ("changed",function(Ee){return Q.end=Q.isoDateParser(Ee)}),a.qZA(),a.YNc(4,se,2,1,"span",4),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.Q6J("initialDate",Q.isoDateFormatter(Q.begin))("opAutofocus",Q.shouldFocus)("id","values-"+Q.filter.id+"-begin")("name","v["+Q.filter.id+"]-begin"),a.xp6(1),a.Q6J("textContent",Q.text.spacer),a.xp6(1),a.Q6J("initialDate",Q.isoDateFormatter(Q.end))("id","values-"+Q.filter.id+"-end")("name","v["+Q.filter.id+"]-end"),a.xp6(1),a.Q6J("ngIf",Q.isTimeZoneDifferent))},directives:[Y.S,J.U,m.O5,T.o],encapsulation:2});class Me extends r.N{constructor(N){super(),this.I18n=N,this.shouldFocus=!1,this.filterChanged=new e.R((0,d.J6)(this)),this.text={enter_text:this.I18n.t("js.work_packages.description_enter_text")}}get value(){return this.filter.values[0]}set value(N){N.length?this.filter.values[0]=N:this.filter.values.length=0,this.filterChanged.emit(this.filter)}}Me.\u0275fac=function(N){return new(N||Me)(a.Y36(n.D))},Me.\u0275cmp=a.Xpm({type:Me,selectors:[["op-filter-string-value"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[a.qOj],decls:3,vars:7,consts:[[3,"id"],["required","true","type","text",1,"advanced-filters--text-field",3,"ngModel","opAutofocus","id","name","ngModelChange"],[1,"hidden-for-sighted",3,"for","textContent"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"input",1),a.NdJ("ngModelChange",function(Ee){return Q.value=Ee}),a.qZA(),a._UZ(2,"label",2),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.name,""),a.xp6(1),a.MGl("id","values-",Q.filter.name,""),a.MGl("name","v[",Q.filter.name,"]"),a.Q6J("ngModel",Q.value)("opAutofocus",Q.shouldFocus),a.xp6(1),a.MGl("for","values-",Q.filter.name,""),a.Q6J("textContent",Q.text.enter_text))},directives:[P.Fj,P.Q7,P.JJ,P.On,J.U],encapsulation:2});var Ae=t(3786),Ye=t(33276),ze=t(5443);class Xe extends r.N{constructor(N,Q,je){super(),this.I18n=N,this.apiV3Service=Q,this.currentProjectService=je,this.shouldFocus=!1,this.filterChanged=new e.R((0,d.J6)(this)),this.additionalProjectApiFilters=[]}ngOnInit(){const N=this.currentProjectService.id;N&&("subprojectId"===this.filter.id||"onlySubproject"===this.filter.id)&&this.additionalProjectApiFilters.push(["ancestor","=",[N]])}onChange(N){return(0,Ae.mG)(this,void 0,void 0,function*(){if(N===this.filter.values||void 0===N)return;if(!N)return this.filter.values.length=0,void this.filterChanged.emit(this.filter);const Q=yield this.apiV3Service.projects.list({filters:[["id","=",N.map(je=>String(je.id)||"")]]}).toPromise();this.filter.values=Q.elements,this.filterChanged.emit(this.filter)})}}Xe.\u0275fac=function(N){return new(N||Xe)(a.Y36(n.D),a.Y36(Ye.T),a.Y36(I.R))},Xe.\u0275cmp=a.Xpm({type:Xe,selectors:[["op-filter-project"]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged"},features:[a.qOj],decls:2,vars:6,consts:[[1,"inline-label","ng-select-container",3,"id"],[1,"advanced-filters--ng-select","-multi-select",3,"value","focusDirectly","multiple","id","apiFilters","valueChange"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"op-project-autocompleter",1),a.NdJ("valueChange",function(Ee){return Q.onChange(Ee)}),a.qZA(),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.Q6J("value",Q.filter.values)("focusDirectly",Q.shouldFocus)("multiple",!0)("id","values-"+Q.filter.id)("apiFilters",Q.additionalProjectApiFilters))},directives:[ze.F],encapsulation:2,changeDetection:0});var it=t(29092),at=t(70233),lt=t(96905),dt=t(91923),de=t(91593);const oe=["ngSelectInstance"],D=function(Ce){return{"-required-highlighting":Ce}};class G{constructor(N,Q,je,Ee,ht,kt,si){this.halResourceService=N,this.halSorting=Q,this.PathHelper=je,this.apiV3Service=Ee,this.currentUser=ht,this.cdRef=kt,this.I18n=si,this.shouldFocus=!1,this.filterChanged=new a.vpe,this.availableOptions=[],this.text={placeholder:this.I18n.t("js.placeholders.selection")}}ngOnInit(){this.options=[];const N=this.filter.currentSchema.values.allowedValues,Q=this.filter.values;this.availableOptions=this.halSorting.sort(N);const je=Q.map(Ee=>Ee.id);this.halSorting.sort(N).forEach(Ee=>{je.includes(Ee.id)||this.options.push(Ee)})}ngAfterViewInit(){this.ngSelectInstance&&this.shouldFocus&&this.ngSelectInstance.focus()}get value(){return this.filter.values}setValues(N){this.options=[];const Q=this.filter.currentSchema.values.allowedValues;this.filter.values=_.castArray(N);const je=this.filter.values.map(Ee=>Ee.id);this.halSorting.sort(Q).forEach(Ee=>{je.includes(Ee.id)||this.options.push(Ee)}),this.filterChanged.emit(this.filter),this.cdRef.detectChanges()}}G.\u0275fac=function(N){return new(N||G)(a.Y36(dt.u),a.Y36(it.h),a.Y36(at.j),a.Y36(Ye.T),a.Y36(lt.S),a.Y36(a.sBO),a.Y36(n.D))},G.\u0275cmp=a.Xpm({type:G,selectors:[["op-filter-toggled-multiselect-value"]],viewQuery:function(N,Q){if(1&N&&a.Gf(oe,7),2&N){let je;a.iGM(je=a.CRH())&&(Q.ngSelectInstance=je.first)}},inputs:{shouldFocus:"shouldFocus",options:"options",filter:"filter"},outputs:{filterChanged:"filterChanged"},decls:2,vars:11,consts:[[1,"inline-label","ng-select-container",3,"id"],["appendTo","body","bindLabel","name",1,"advanced-filters--ng-select","-multi-select",3,"id","items","classes","virtualScroll","closeOnSelect","placeholder","hideSelected","multiple","model","change"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"op-autocompleter",1),a.NdJ("change",function(Ee){return Q.setValues(Ee)}),a.qZA(),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.Q6J("id","values-"+Q.filter.id)("items",Q.options)("classes",a.VKq(9,D,0===Q.value.length))("closeOnSelect",!1)("placeholder",Q.text.placeholder)("hideSelected",!0)("multiple",!0)("model",Q.value))},directives:[de.s],encapsulation:2,changeDetection:0});var V=t(81134),me=t(26269),$=t(92597),Se=t(79902),ot=t(17163),st=t(67727),he=t(23896);const ye=["ngSelectInstance"],xe=function(Ce){return{"-required-highlighting":Ce}};class De extends r.N{constructor(N,Q,je,Ee,ht,kt,si,Wt){super(),this.halResourceService=N,this.apiV3Service=Q,this.cdRef=je,this.I18n=Ee,this.currentProject=ht,this.currentUser=kt,this.halNotification=si,this.ngZone=Wt,this.shouldFocus=!1,this.filterChanged=new a.vpe,this.meValue=this.halResourceService.createHalResource({_links:{self:{href:this.apiV3Service.users.me.path,title:this.I18n.t("js.label_me")}}},!0),this.autocompleterFn=ri=>this.autocomplete(ri),this.itemTracker=ri=>ri.href||ri.id||ri.name,this.compareByHref=p.U5,this.resourceType=null,this.text={placeholder:this.I18n.t("js.placeholders.selection")}}get value(){return this.filter.values}ngOnInit(){"id"===this.filter.id&&(this.resourceType="work_packages"),this.initialRequest$=this.loadCollection("").pipe((0,$.d)(1))}autocomplete(N){return this.initialRequest$.pipe((0,Se.w)(Q=>Q.count===Q.total?this.matchingItems(Q.elements,N):this.loadCollection(N).pipe((0,Se.w)(je=>this.withMeValue(N,je.elements)))))}matchingItems(N,Q){let je;if(""!==Q&&Q){const Ee=Q.toLowerCase();je=N.filter(ht=>ht.id.includes(Ee)||ht.name.toLowerCase().includes(Ee))}else je=N;return this.withMeValue(Q,je)}loadCollection(N){const Q=this.createFilters(N);return this.apiV3Service.collectionFromString(this.allowedValuesLink).filtered(Q,{pageSize:"-1"}).get()}createFilters(N){const Q=new me.qM;return N&&Q.add("typeahead","**",[N]),Q}setValues(N){this.filter.values=N.length>0?Array.isArray(N)?N:[N]:[],this.filterChanged.emit(this.filter),this.cdRef.detectChanges()}get allowedValuesLink(){const{href:N}=this.filter.currentSchema.values.allowedValues;return N}withMeValue(N,Q){return!this.isUserResource||N&&"me"!==N?(0,V.of)(Q):this.currentUser.isLoggedIn$.pipe((0,he.take)(1),(0,ot.M)(this.currentUser.user$),(0,C.U)(([je,Ee])=>je&&Ee?[this.meValue].concat(Q):Q))}get isUserResource(){const N=_.get(this.filter.currentSchema,"values.type",null);return N&&N.indexOf("User")>0}}De.\u0275fac=function(N){return new(N||De)(a.Y36(dt.u),a.Y36(Ye.T),a.Y36(a.sBO),a.Y36(n.D),a.Y36(I.R),a.Y36(lt.S),a.Y36(st.W),a.Y36(a.R0b))},De.\u0275cmp=a.Xpm({type:De,selectors:[["op-filter-searchable-multiselect-value"]],viewQuery:function(N,Q){if(1&N&&a.Gf(ye,7),2&N){let je;a.iGM(je=a.CRH())&&(Q.ngSelectInstance=je.first)}},inputs:{filter:"filter",shouldFocus:"shouldFocus"},outputs:{filterChanged:"filterChanged"},features:[a.qOj],decls:2,vars:16,consts:[[1,"inline-label","ng-select-container",3,"id"],["appendTo","body",1,"advanced-filters--ng-select","-multi-select",3,"id","getOptionsFn","classes","virtualScroll","closeOnSelect","placeholder","hideSelected","multiple","fetchDataDirectly","focusDirectly","model","resource","compareWith","trackByFn","change"]],template:function(N,Q){1&N&&(a.TgZ(0,"div",0),a.TgZ(1,"op-autocompleter",1),a.NdJ("change",function(Ee){return Q.setValues(Ee)}),a.qZA(),a.qZA()),2&N&&(a.MGl("id","div-values-",Q.filter.id,""),a.xp6(1),a.Q6J("id","values-"+Q.filter.id)("getOptionsFn",Q.autocompleterFn)("classes",a.VKq(14,xe,0===Q.value.length))("closeOnSelect",!1)("placeholder",Q.text.placeholder)("hideSelected",!0)("multiple",!0)("fetchDataDirectly",!0)("focusDirectly",Q.shouldFocus)("model",Q.value)("resource",Q.resourceType)("compareWith",Q.compareByHref)("trackByFn",Q.itemTracker))},directives:[de.s],encapsulation:2,changeDetection:0});function Ve(Ce,N){if(1&Ce&&a._UZ(0,"option",12),2&Ce){const Q=N.$implicit;a.Q6J("textContent",Q.name)("ngValue",Q)}}function nt(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"select",10),a.NdJ("ngModelChange",function(Ee){a.CHM(Q);return a.oxw().filter.operator=Ee})("ngModelChange",function(){a.CHM(Q);const Ee=a.oxw();return Ee.onFilterUpdated(Ee.filter)}),a.YNc(1,Ve,1,2,"option",11),a.qZA()}if(2&Ce){const Q=a.oxw();a.MGl("id","operators-",Q.filter.id,""),a.MGl("name","op[",Q.filter.id,"]"),a.Q6J("ngModel",Q.filter.operator)("compareWith",Q.compareByHref),a.xp6(1),a.Q6J("ngForOf",Q.availableOperators)}}function mt(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-boolean-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw().onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw();a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function Ue(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-integer-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(2).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function Fe(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-date-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(2).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function Te(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-dates-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(2).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function tt(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-date-time-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(2).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function ut(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-date-times-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(2).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function Yt(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-string-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(2).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function It(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-string-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(2).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function Nt(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-project",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(2).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function wt(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-toggled-multiselect-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(3).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(3);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function zt(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"op-filter-searchable-multiselect-value",13),a.NdJ("filterChanged",function(Ee){return a.CHM(Q),a.oxw(3).onFilterUpdated(Ee)}),a.qZA()}if(2&Ce){const Q=a.oxw(3);a.Q6J("shouldFocus",Q.shouldFocus)("filter",Q.filter)}}function Kt(Ce,N){if(1&Ce&&(a.ynx(0),a.YNc(1,wt,1,2,"op-filter-toggled-multiselect-value",4),a.YNc(2,zt,1,2,"op-filter-searchable-multiselect-value",4),a.BQk()),2&Ce){const Q=a.oxw(2);a.xp6(1),a.Q6J("ngIf",Q.filter.currentSchema.loadedAllowedValues()),a.xp6(1),a.Q6J("ngIf",!Q.filter.currentSchema.loadedAllowedValues())}}function ei(Ce,N){if(1&Ce&&(a.ynx(0),a.TgZ(1,"div",14),a.YNc(2,Ue,1,2,"op-filter-integer-value",15),a.YNc(3,Fe,1,2,"op-filter-date-value",15),a.YNc(4,Te,1,2,"op-filter-dates-value",15),a.YNc(5,tt,1,2,"op-filter-date-time-value",15),a.YNc(6,ut,1,2,"op-filter-date-times-value",15),a.YNc(7,Yt,1,2,"op-filter-string-value",15),a.YNc(8,It,1,2,"op-filter-string-value",15),a.YNc(9,Nt,1,2,"op-filter-project",15),a.YNc(10,Kt,3,2,"ng-container",16),a.qZA(),a.BQk()),2&Ce){const Q=a.oxw();a.xp6(1),a.Q6J("ngSwitch",Q.valueType),a.xp6(1),a.Q6J("ngSwitchCase","[1]Integer"),a.xp6(1),a.Q6J("ngSwitchCase","[1]Date"),a.xp6(1),a.Q6J("ngSwitchCase","[2]Date"),a.xp6(1),a.Q6J("ngSwitchCase","[1]DateTime"),a.xp6(1),a.Q6J("ngSwitchCase","[2]DateTime"),a.xp6(1),a.Q6J("ngSwitchCase","[1]String"),a.xp6(1),a.Q6J("ngSwitchCase","[1]Float"),a.xp6(1),a.Q6J("ngSwitchCase","[]Project")}}function Rt(Ce,N){1&Ce&&a._UZ(0,"div",17)}class Mt{constructor(N,Q,je,Ee,ht){this.wpTableFilters=N,this.schemaCache=Q,this.I18n=je,this.currentProject=Ee,this.bannerService=ht,this.shouldFocus=!1,this.filterChanged=new a.vpe,this.deactivateFilter=new a.vpe,this.showValuesInput=!1,this.eeShowBanners=!1,this.trackByHref=p.tL,this.compareByHref=p.U5,this.text={open_filter:this.I18n.t("js.filter.description.text_open_filter"),close_filter:this.I18n.t("js.filter.description.text_close_filter"),label_filter_add:this.I18n.t("js.work_packages.label_filter_add"),upsale_for_more:this.I18n.t("js.filter.upsale_for_more"),upsale_link:this.I18n.t("js.filter.upsale_link"),button_delete:this.I18n.t("js.button_delete")}}onFilterUpdated(N){this.filter=N,this.showValuesInput=this.showValues(),this.filterChanged.emit()}removeThisFilter(){this.deactivateFilter.emit(this.filter)}get valueType(){if(this.filter.currentSchema&&this.filter.currentSchema.values)return this.filter.currentSchema.values.type}ngOnInit(){this.eeShowBanners=this.bannerService.eeShowBanners,this.availableOperators=this.schemaCache.of(this.filter).availableOperators,this.showValuesInput=this.showValues()}showValues(){return this.filter.currentSchema.isValueRequired()&&"[1]Boolean"!==this.filter.currentSchema.values.type}}Mt.\u0275fac=function(N){return new(N||Mt)(a.Y36(i.Z),a.Y36(O.y),a.Y36(n.D),a.Y36(I.R),a.Y36(h.j))},Mt.\u0275cmp=a.Xpm({type:Mt,selectors:[["","query-filter",""]],inputs:{shouldFocus:"shouldFocus",filter:"filter"},outputs:{filterChanged:"filterChanged",deactivateFilter:"deactivateFilter"},attrs:["query-filter",""],decls:12,vars:11,consts:[[1,"advanced-filters--filter-name",3,"for","textContent"],[1,"advanced-filters--filter-operator"],[1,"hidden-for-sighted",3,"for"],["required","","class","advanced-filters--select","style","vertical-align: top;",3,"id","name","ngModel","compareWith","ngModelChange",4,"ngIf"],[3,"shouldFocus","filter","filterChanged",4,"ngIf"],[4,"ngIf"],["class","advanced-filters--filter-value",4,"ngIf"],[1,"advanced-filters--remove-filter"],["type","button",1,"spot-link",3,"title","click"],["icon-classes","icon-close advanced-filters--remove-filter-icon"],["required","",1,"advanced-filters--select",2,"vertical-align","top",3,"id","name","ngModel","compareWith","ngModelChange"],[3,"textContent","ngValue",4,"ngFor","ngForOf"],[3,"textContent","ngValue"],[3,"shouldFocus","filter","filterChanged"],[1,"advanced-filters--filter-value",3,"ngSwitch"],[3,"shouldFocus","filter","filterChanged",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"advanced-filters--filter-value"]],template:function(N,Q){1&N&&(a.ynx(0),a._UZ(1,"label",0),a.TgZ(2,"div",1),a.TgZ(3,"label",2),a._uU(4),a.qZA(),a.YNc(5,nt,2,5,"select",3),a.YNc(6,mt,1,2,"op-filter-boolean-value",4),a.qZA(),a.YNc(7,ei,11,9,"ng-container",5),a.YNc(8,Rt,1,0,"div",6),a.TgZ(9,"div",7),a.TgZ(10,"button",8),a.NdJ("click",function(){return Q.removeThisFilter()}),a._UZ(11,"op-icon",9),a.qZA(),a.qZA(),a.BQk()),2&N&&(a.xp6(1),a.MGl("for","operators-",Q.filter.id,""),a.Q6J("textContent",Q.filter.name),a.uIk("title",Q.filter.name),a.xp6(2),a.MGl("for","operators-",Q.filter.id,""),a.xp6(1),a.AsE(" ",Q.filter.name," ",Q.text.open_filter," "),a.xp6(1),a.Q6J("ngIf","[1]Boolean"!==Q.valueType),a.xp6(1),a.Q6J("ngIf","[1]Boolean"==Q.valueType),a.xp6(1),a.Q6J("ngIf",Q.showValuesInput&&Q.valueType),a.xp6(1),a.Q6J("ngIf",!Q.showValuesInput),a.xp6(2),a.Q6J("title",Q.text.button_delete))},directives:[m.O5,T.o,P.EJ,P.Q7,P.JJ,P.On,m.sg,P.YN,P.Kr,B,m.RF,m.n9,m.ED,R,X,ie,ce,re,Me,Xe,G,De],encapsulation:2});var Ot=t(8158);function St(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"a",20),a.NdJ("click",function(){return a.CHM(Q),a.oxw(2).closeFilter()}),a.qZA()}if(2&Ce){const Q=a.oxw(2);a.uIk("title",Q.text.close_form)}}function ti(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"li",22),a.NdJ("deactivateFilter",function(Ee){return a.CHM(Q),a.oxw(3).deactivateFilter(Ee)})("filterChanged",function(){a.CHM(Q);const Ee=a.oxw(3);return Ee.filtersChanged.emit(Ee.filters)}),a.qZA()}if(2&Ce){const Q=a.oxw(),je=Q.$implicit,Ee=Q.index,ht=a.oxw(2);a.MGl("id","filter_",je.id,""),a.Q6J("shouldFocus",Ee==ht.focusElementIndex)("filter",je)}}function Tt(Ce,N){if(1&Ce&&(a.ynx(0),a.YNc(1,ti,1,3,"li",21),a.BQk()),2&Ce){const Q=N.$implicit,je=a.oxw(2);a.xp6(1),a.Q6J("ngIf",je.isFilterAvailable(Q))}}function qt(Ce,N){1&Ce&&a._UZ(0,"li",9)}function Qt(Ce,N){if(1&Ce&&a._UZ(0,"op-enterprise-banner",23),2&Ce){const Q=a.oxw(2);a.Q6J("linkMessage",Q.text.upsale_link)("textMessage",Q.text.upsale_for_more)("moreInfoLink",Q.text.more_info_link)}}function Gt(Ce,N){if(1&Ce){const Q=a.EpF();a.TgZ(0,"fieldset",1),a._UZ(1,"legend",2),a.YNc(2,St,1,1,"a",3),a.TgZ(3,"ul",4),a.TgZ(4,"li",5),a._UZ(5,"label",6),a.TgZ(6,"div",7),a.TgZ(7,"wp-filter-by-text-input",8),a.NdJ("deactivateFilter",function(Ee){return a.CHM(Q),a.oxw().deactivateFilter(Ee)}),a.qZA(),a.qZA(),a.qZA(),a._UZ(8,"li",9),a.YNc(9,Tt,2,1,"ng-container",10),a.YNc(10,qt,1,0,"li",11),a.TgZ(11,"li",12),a.TgZ(12,"label",13),a._UZ(13,"op-icon",14),a._uU(14),a.qZA(),a.TgZ(15,"label",15),a._uU(16),a.qZA(),a.TgZ(17,"div",16),a.TgZ(18,"ng-select",17,18),a.NdJ("open",function(){return a.CHM(Q),a.oxw().onOpen()})("change",function(Ee){return a.CHM(Q),a.oxw().onFilterAdded(Ee)}),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.YNc(20,Qt,1,3,"op-enterprise-banner",19),a.qZA()}if(2&Ce){const Q=a.oxw();a.xp6(1),a.Q6J("textContent",Q.text.selected_filter_list),a.xp6(1),a.Q6J("ngIf",Q.showCloseFilter),a.xp6(3),a.Q6J("textContent",Q.text.filter_by_text),a.uIk("title",Q.text.filter_by_text),a.xp6(4),a.Q6J("ngForOf",Q.filters)("ngForTrackBy",Q.trackByName),a.xp6(1),a.Q6J("ngIf",Q.isSecondSpacerVisible),a.xp6(4),a.hij(" ",Q.text.label_filter_add,": "),a.xp6(2),a.lnq(" ",Q.text.label_filter_add," ",Q.text.open_filter," ",Q.text.close_filter," "),a.xp6(2),a.Q6J("items",Q.remainingFilters)("clearSearchOnAdd",!0)("multiple",!1)("clearable",!0)("clearOnBackspace",!0)("closeOnSelect",!0)("virtualScroll",!0)("placeholder",Q.text.please_select),a.xp6(2),a.Q6J("ngIf",Q.eeShowBanners)}}class Jt extends r.N{constructor(N,Q,je,Ee){super(),this.wpTableFilters=N,this.wpFiltersService=Q,this.I18n=je,this.bannerService=Ee,this.showCloseFilter=!1,this.filtersChanged=new e.R((0,d.J6)(this),500),this.remainingFilters=[],this.eeShowBanners=!1,this.focusElementIndex=0,this.trackByName=p.As,this.text={open_filter:this.I18n.t("js.filter.description.text_open_filter"),label_filter_add:this.I18n.t("js.work_packages.label_filter_add"),close_filter:this.I18n.t("js.filter.description.text_close_filter"),upsale_for_more:this.I18n.t("js.filter.upsale_for_more"),upsale_link:this.I18n.t("js.filter.upsale_link"),more_info_link:f.rj.website,close_form:this.I18n.t("js.close_form_title"),selected_filter_list:this.I18n.t("js.label_selected_filter_list"),button_delete:this.I18n.t("js.button_delete"),please_select:this.I18n.t("js.placeholders.selection"),filter_by_text:this.I18n.t("js.work_packages.label_filter_by_text")}}ngOnInit(){this.eeShowBanners=this.bannerService.eeShowBanners}ngOnChanges(){this.updateRemainingFilters()}onFilterAdded(N){if(N){const Q=this.wpTableFilters.instantiate(N);this.filters.push(Q);const je=this.currentFilterLength();this.updateFilterFocus(je),this.updateRemainingFilters(),this.filtersChanged.emit(this.filters),this.ngSelectComponent.clearItem(N)}}closeFilter(){this.wpFiltersService.toggleVisibility()}deactivateFilter(N){const Q=this.filters.indexOf(N);_.remove(this.filters,je=>je.id===N.id),this.filtersChanged.emit(this.filters),this.updateFilterFocus(Q),this.updateRemainingFilters()}get isSecondSpacerVisible(){const N=!!_.find(this.filters,je=>"search"===je.id),Q=!!this.filters.find(je=>"search"!==je.id&&this.isFilterAvailable(je));return N&&Q}updateRemainingFilters(){this.remainingFilters=_.sortBy(this.wpTableFilters.remainingVisibleFilters(this.filters),"name")}updateFilterFocus(N){const Q=this.currentFilterLength();if(0===Q)this.focusElementIndex=-1;else{const je=N<Q?N:Q-1,Ee=this.currentFilterAt(je);this.focusElementIndex=this.filters.indexOf(Ee)}}currentFilterLength(){return this.filters.length}currentFilterAt(N){return this.filters[N]}isFilterAvailable(N){return this.wpTableFilters.availableFilters.some(Q=>Q.id===N.id)&&!(this.wpTableFilters.hidden.includes(N.id)||N.isTemplated())}onOpen(){setTimeout(()=>{const N=this.ngSelectComponent;N&&N.dropdownPanel&&N.dropdownPanel._updatePosition()},25)}}Jt.\u0275fac=function(N){return new(N||Jt)(a.Y36(i.Z),a.Y36(l.U),a.Y36(n.D),a.Y36(h.j))},Jt.\u0275cmp=a.Xpm({type:Jt,selectors:[["op-query-filters"]],viewQuery:function(N,Q){if(1&N&&a.Gf(c.w9,5),2&N){let je;a.iGM(je=a.CRH())&&(Q.ngSelectComponent=je.first)}},inputs:{filters:"filters",showCloseFilter:"showCloseFilter"},outputs:{filtersChanged:"filtersChanged"},features:[a.qOj,a.TTD],decls:1,vars:1,consts:[["id","filters","class","advanced-filters--container",4,"ngIf"],["id","filters",1,"advanced-filters--container"],[3,"textContent"],["class","advanced-filters--close icon-context icon-close",3,"click",4,"ngIf"],[1,"advanced-filters--filters"],["id","filter_search",1,"advanced-filters--filter","--without-operator"],["for","filter-by-text-input",1,"advanced-filters--filter-name",3,"textContent"],[1,"advanced-filters--filter-value"],[3,"deactivateFilter"],[1,"advanced-filters--spacer"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","advanced-filters--spacer",4,"ngIf"],[1,"advanced-filters--add-filter"],["for","add_filter_select","aria-hidden","true",1,"advanced-filters--add-filter-label"],["icon-classes","icon-add icon4"],["for","add_filter_select",1,"hidden-for-sighted"],[1,"advanced-filters--add-filter-value"],["id","add_filter_select","bindLabel","name","appendTo","body",3,"items","clearSearchOnAdd","multiple","clearable","clearOnBackspace","closeOnSelect","virtualScroll","placeholder","open","change"],["ngSelectComponent",""],["class","advanced-filters--add-filter-info","opReferrer","wp-filter#filters",3,"linkMessage","textMessage","moreInfoLink",4,"ngIf"],[1,"advanced-filters--close","icon-context","icon-close",3,"click"],["query-filter","","class","advanced-filters--filter",3,"id","shouldFocus","filter","deactivateFilter","filterChanged",4,"ngIf"],["query-filter","",1,"advanced-filters--filter",3,"id","shouldFocus","filter","deactivateFilter","filterChanged"],["opReferrer","wp-filter#filters",1,"advanced-filters--add-filter-info",3,"linkMessage","textMessage","moreInfoLink"]],template:function(N,Q){1&N&&a.YNc(0,Gt,21,20,"fieldset",0),2&N&&a.Q6J("ngIf",Q.filters)},directives:[m.O5,E,m.sg,T.o,c.w9,Mt,Ot.P],encapsulation:2,changeDetection:0})},78434:(te,M,t)=>{"use strict";t.d(M,{U:()=>h});var n=t(14808),e=t(22663),p=t(2316);class h{constructor(){this.state=(0,n.qH)(!1)}get visible(){return this.state.getValueOr(!1)}set visible(i){this.state.putValue(i)}observeUntil(i){return this.state.values$().pipe((0,e.R)(i))}toggleVisibility(){this.state.doModify(i=>!i)}}h.\u0275fac=function(i){return new(i||h)},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},82267:(te,M,t)=>{"use strict";t.d(M,{O:()=>i});var n=t(96617),e=t(36293),p=t(79441),h=t(62964),c=t(2316);class i{constructor(r,d,f){this.I18n=r,this.workPackageNotificationService=d,this.toastService=f,this.quoteEvents=new p.xQ}createComment(r,d){return r.addComment?r.addComment({comment:d},{"Content-Type":"application/json; charset=UTF-8"}).catch(f=>this.errorAndReject(f,r)):r.privateComment({comment:d},{"Content-Type":"application/json; charset=UTF-8"}).catch(f=>this.errorAndReject(f,r))}updateComment(r,d,f){JSON.stringify({comment:d,isPrivate:f});return r.update({comment:d,isPrivate:f},{"Content-Type":"application/json; charset=UTF-8"}).then(m=>(this.toastService.addSuccess(this.I18n.t("js.work_packages.comment_updated")),m)).catch(m=>this.errorAndReject(m))}errorAndReject(r,d){return this.workPackageNotificationService.handleRawError(r,d),Promise.reject(r)}}i.\u0275fac=function(r){return new(r||i)(c.LFG(n.D),c.LFG(h.q),c.LFG(e.kl))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac})},5262:(te,M,t)=>{"use strict";t.d(M,{f:()=>Z});var n=t(96617),p=(t(24897),t(2316)),h=t(54364),c=t(41945),i=t(62964),l=t(84906),r=t(2775),d=t(11950);const f=function(j){return{workPackageId:j}};function a(j,B){if(1&j&&(p.TgZ(0,"a",5),p._UZ(1,"span",6),p.qZA()),2&j){const J=p.oxw(2);p.Q6J("uiParams",p.VKq(3,f,J.parent.id)),p.uIk("title",J.parent.name),p.xp6(1),p.Q6J("textContent",J.parent.name)}}function m(j,B){if(1&j&&p._UZ(0,"span",6),2&j){const J=p.oxw(3);p.Q6J("textContent",J.text.set_parent)}}function v(j,B){if(1&j){const J=p.EpF();p.TgZ(0,"button",7),p.NdJ("click",function(){return p.CHM(J),p.oxw(2).open()}),p.YNc(1,m,1,1,"span",8),p._UZ(2,"op-icon",9),p.qZA()}if(2&j){const J=p.oxw(2);p.Q6J("title",J.parent?J.text.edit_parent:J.text.set_parent),p.xp6(1),p.Q6J("ngIf",!J.parent),p.xp6(1),p.MGl("icon-classes","icon-small ",J.parent?"icon-edit icon5 icon-no-color":"icon-add icon4","")}}function C(j,B){if(1&j){const J=p.EpF();p.TgZ(0,"button",10),p.NdJ("click",function(){return p.CHM(J),p.oxw(2).updateParent(null)}),p._UZ(1,"op-icon",11),p.qZA()}if(2&j){const J=p.oxw(2);p.Q6J("title",J.text.remove_parent)}}function u(j,B){if(1&j&&(p.ynx(0),p.YNc(1,a,2,5,"a",2),p.YNc(2,v,3,3,"button",3),p.YNc(3,C,2,1,"button",4),p.BQk()),2&j){const J=p.oxw();p.xp6(1),p.Q6J("ngIf",J.parent),p.xp6(1),p.Q6J("ngIf",J.canModifyParent()),p.xp6(1),p.Q6J("ngIf",J.canModifyParent()&&J.parent)}}function k(j,B){if(1&j){const J=p.EpF();p.TgZ(0,"wp-relations-autocomplete",12),p.NdJ("onCancel",function(){return p.CHM(J),p.oxw().close()})("onSelected",function(F){return p.CHM(J),p.oxw().updateParent(F)}),p.qZA()}if(2&j){const J=p.oxw();p.Q6J("inputPlaceholder",J.text.set_or_remove_parent)("workPackage",J.workPackage)}}class x{constructor(B,J,R){this.I18n=B,this.wpRelationsHierarchy=J,this.notificationService=R,this.onSwitch=new p.vpe,this.isSaving=!1,this.text={edit_parent:this.I18n.t("js.relation_buttons.change_parent"),set_or_remove_parent:this.I18n.t("js.relations_autocomplete.parent_placeholder"),remove_parent:this.I18n.t("js.relation_buttons.remove_parent"),set_parent:this.I18n.t("js.relation_buttons.set_parent")}}canModifyParent(){return!!this.workPackage.changeParent}get parent(){return this.workPackage&&this.workPackage.parent}get active(){return this.editing}close(){this.toggle(!1)}open(){this.toggle(!0)}updateParent(B){this.close();const J=B?B.id:null;_.get(this.parent,"id",null)!==J&&(this.isSaving=!0,this.wpRelationsHierarchy.changeParent(this.workPackage,J).catch(R=>{this.notificationService.handleRawError(R,this.workPackage)}).then(()=>this.isSaving=!1))}toggle(B){this.editing!==B&&(this.editing=B,this.onSwitch.emit(this.editing))}}x.\u0275fac=function(B){return new(B||x)(p.Y36(n.D),p.Y36(c.O),p.Y36(i.q))},x.\u0275cmp=p.Xpm({type:x,selectors:[["wp-breadcrumb-parent"]],inputs:{workPackage:"workPackage"},outputs:{onSwitch:"onSwitch"},decls:2,vars:2,consts:[[4,"ngIf"],["filterCandidatesFor","parent",3,"inputPlaceholder","workPackage","onCancel","onSelected",4,"ngIf"],["uiSref","work-packages.show","class","op-wp-breadcrumb-parent nocut","data-qa-selector","op-wp-breadcrumb-parent",3,"uiParams",4,"ngIf"],["type","button","class","spot-link wp-relation--parent-change -no-decoration hide-when-print",3,"title","click",4,"ngIf"],["type","button","class","spot-link wp-relation--parent-remove hide-when-print -no-decoration",3,"title","click",4,"ngIf"],["uiSref","work-packages.show","data-qa-selector","op-wp-breadcrumb-parent",1,"op-wp-breadcrumb-parent","nocut",3,"uiParams"],[3,"textContent"],["type","button",1,"spot-link","wp-relation--parent-change","-no-decoration","hide-when-print",3,"title","click"],[3,"textContent",4,"ngIf"],[3,"icon-classes"],["type","button",1,"spot-link","wp-relation--parent-remove","hide-when-print","-no-decoration",3,"title","click"],["icon-classes","icon-small icon-no-color icon-remove icon4"],["filterCandidatesFor","parent",3,"inputPlaceholder","workPackage","onCancel","onSelected"]],template:function(B,J){1&B&&(p.YNc(0,u,4,3,"ng-container",0),p.YNc(1,k,1,2,"wp-relations-autocomplete",1)),2&B&&(p.Q6J("ngIf",!J.active),p.xp6(1),p.Q6J("ngIf",J.active))},directives:[h.O5,l.AnchorUISref,l.UISref,r.o,d.t],encapsulation:2});const b=function(j){return{"icon4 icon-small icon-arrow-right5":j}},y=function(j){return{workPackageId:j}};function P(j,B){if(1&j&&(p.TgZ(0,"li",8),p._UZ(1,"a",9),p.qZA()),2&j){const J=p.oxw(),R=J.first,F=J.$implicit;p.Q6J("ngClass",p.VKq(4,b,!R)),p.xp6(1),p.Q6J("textContent",F.name)("uiParams",p.VKq(6,y,F.id)),p.uIk("title",F.name)}}function E(j,B){if(1&j&&(p.ynx(0),p.YNc(1,P,2,8,"li",7),p.BQk()),2&j){const J=B.last;p.xp6(1),p.Q6J("ngIf",!J)}}function T(j,B){if(1&j&&(p.ynx(0),p.TgZ(1,"li"),p.TgZ(2,"span"),p._uU(3),p.qZA(),p.qZA(),p.YNc(4,E,2,1,"ng-container",6),p.BQk()),2&j){const J=p.oxw(2);p.xp6(3),p.hij("",J.hierarchyLabel,": "),p.xp6(1),p.Q6J("ngForOf",J.workPackage.ancestors)}}const O=function(j,B){return{"op-wp-breadcrumb--active-parent-select":j,"icon4 icon-small icon-arrow-right5":B}};function I(j,B){if(1&j){const J=p.EpF();p.TgZ(0,"div",1),p.TgZ(1,"ul",2),p.YNc(2,T,5,2,"ng-container",3),p.TgZ(3,"li",4),p.TgZ(4,"wp-breadcrumb-parent",5),p.NdJ("onSwitch",function(F){return p.CHM(J),p.oxw().updateActiveInput(F)}),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&j){const J=p.oxw();p.xp6(2),p.Q6J("ngIf",!J.inputActive&&J.hierarchyCount>0),p.xp6(1),p.Q6J("ngClass",p.WLB(3,O,J.inputActive,!J.inputActive&&J.hierarchyCount>1)),p.xp6(1),p.Q6J("workPackage",J.workPackage)}}class Z{constructor(B){this.I18n=B,this.text={parent:this.I18n.t("js.relations_hierarchy.parent_headline"),hierarchy:this.I18n.t("js.relations_hierarchy.hierarchy_headline")},this.inputActive=!1}get hierarchyCount(){return this.workPackage.ancestors.length}get hierarchyLabel(){return 1===this.hierarchyCount?this.text.parent:this.text.hierarchy}updateActiveInput(B){this.inputActive=B}}Z.\u0275fac=function(B){return new(B||Z)(p.Y36(n.D))},Z.\u0275cmp=p.Xpm({type:Z,selectors:[["wp-breadcrumb"]],inputs:{workPackage:"workPackage"},decls:1,vars:1,consts:[["class","op-wp-breadcrumb -show","data-qa-selector","op-wp-breadcrumb",4,"ngIf"],["data-qa-selector","op-wp-breadcrumb",1,"op-wp-breadcrumb","-show"],["data-qa-selector","op-breadcrumb",1,"op-breadcrumb"],[4,"ngIf"],[3,"ngClass"],[3,"workPackage","onSwitch"],[4,"ngFor","ngForOf"],["class","op-wp-breadcrumb--ellipsed",3,"ngClass",4,"ngIf"],[1,"op-wp-breadcrumb--ellipsed",3,"ngClass"],["uiSref","work-packages.show",1,"nocut",3,"textContent","uiParams"]],template:function(B,J){1&B&&p.YNc(0,I,5,6,"div",0),2&B&&p.Q6J("ngIf",J.workPackage)},directives:[h.O5,h.mk,x,h.sg,l.AnchorUISref,l.UISref],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-breadcrumb[_ngcontent-%COMP%]{margin-top:10px;display:none;transition:all .1s ease-in-out 0s;overflow:hidden;width:auto;height:initial}.op-wp-breadcrumb[_ngcontent-%COMP%]   ul.op-breadcrumb[_ngcontent-%COMP%]{height:initial;margin:0;padding:0}.op-wp-breadcrumb[_ngcontent-%COMP%]   ul.op-breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:var(--breadcrumb-font-color);font-family:var(--body-font-family);font-size:var(--breadcrumb-font-size);font-weight:normal;list-style-type:none;float:left;margin:0 5px 0 0;padding:0;line-height:20px;max-width:100%;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-wp-breadcrumb.-show[_ngcontent-%COMP%]{display:block}.op-wp-breadcrumb--ellipsed[_ngcontent-%COMP%]{max-width:600px;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-wp-breadcrumb--active-parent-select[_ngcontent-%COMP%]{width:500px}@media screen and (max-width: 1248px){.op-wp-breadcrumb[_ngcontent-%COMP%]{margin-top:0}}.op-wp-breadcrumb[_ngcontent-%COMP%]   ul.op-breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   wp-breadcrumb-parent[_ngcontent-%COMP%]{white-space:initial}.op-wp-breadcrumb[_ngcontent-%COMP%]   .ng-placeholder[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}"]})},44210:(te,M,t)=>{"use strict";t.d(M,{S:()=>e});var n=t(26942);class e extends n.N{constructor(h){super(),this.I18n=h,this.isActive=!1,this.text={activate:this.I18n.t("js.label_activate"),deactivate:this.I18n.t("js.label_deactivate"),label:this.labelKey?this.I18n.t(this.labelKey):"",buttonText:this.textKey?this.I18n.t(this.textKey):""}}get label(){return this.text.label}get buttonText(){return this.text.buttonText}get labelKey(){return""}get textKey(){return""}get activationPrefix(){return this.isActive?"":`${this.text.activate} `}get deactivationPrefix(){return this.isActive?`${this.text.deactivate} `:""}get prefix(){return this.activationPrefix||this.deactivationPrefix}isToggle(){return!1}}},25351:(te,M,t)=>{"use strict";t.d(M,{z:()=>x});var n=t(47775),e=t(96617),p=t(7493),h=t(26942),c=t(38519),i=t(65146),l=t(2316),r=t(20342),d=t(67325),f=t(55548),a=t(1056),m=t(63829),v=t(50076);class C extends f.n{constructor(y,P,E,T,O){super(y,P),this.elementRef=y,this.opContextMenu=P,this.browserDetector=E,this.wpCreate=T,this.$state=O}ngAfterViewInit(){super.ngAfterViewInit(),this.active&&this.browserDetector.isMobile&&(this.stateName="work-packages.new")}open(y){this.wpCreate.getEmptyForm(this.projectIdentifier).then(P=>{this.buildItems(P.schema.type.allowedValues),this.opContextMenu.show(this,y)})}get locals(){return{items:this.items,contextMenuId:"types-context-menu"}}buildItems(y){this.items=y.map(P=>({disabled:!1,linkText:P.name,href:this.$state.href(this.stateName,{type:P.id}),ariaLabel:P.name,class:v.Z.inlineClass("type",P.id),onClick:E=>!(0,d.F)(E)&&(this.$state.go(this.stateName,{type:P.id}),!0)}))}}C.\u0275fac=function(y){return new(y||C)(l.Y36(l.SBq),l.Y36(r.$),l.Y36(a.o),l.Y36(m.P),l.Y36(n.StateService))},C.\u0275dir=l.lG2({type:C,selectors:[["","opTypesCreateDropdown",""]],inputs:{projectIdentifier:"projectIdentifier",stateName:"stateName",active:["dropdownActive","active"]},features:[l.qOj]});var u=t(2775),k=t(54364);class x extends h.N{constructor(y,P,E,T,O,I){super(),this.$state=y,this.currentProject=P,this.authorisationService=E,this.transition=T,this.I18n=O,this.cdRef=I,this.text={title:this.I18n.t("js.work_packages.create.title"),createWithDropdown:this.I18n.t("js.work_packages.create.button"),createButton:this.I18n.t("js.label_work_package"),explanation:this.I18n.t("js.label_create_work_package")}}ngOnInit(){this.projectIdentifier=this.currentProject.identifier,this.authorisationService.observeUntil((0,c.J6)(this)).subscribe(()=>{this.allowed=!!this.allowedWhen.find(y=>{const[P,E]=y.split(".");return this.authorisationService.can(P,E)}),this.updateDisabledState()}),this.transitionUnregisterFn=this.transition.onSuccess({},this.updateDisabledState.bind(this))}ngOnDestroy(){super.ngOnDestroy(),this.transitionUnregisterFn()}updateDisabledState(){this.disabled=!this.allowed||this.$state.includes("**.new"),this.cdRef.detectChanges()}}x.\u0275fac=function(y){return new(y||x)(l.Y36(n.StateService),l.Y36(i.R),l.Y36(p.g),l.Y36(n.TransitionService),l.Y36(e.D),l.Y36(l.sBO))},x.\u0275cmp=l.Xpm({type:x,selectors:[["wp-create-button"]],inputs:{allowedWhen:["allowed","allowedWhen"],stateName$:"stateName$"},features:[l.qOj],decls:6,vars:9,consts:[[1,"wp-create-button"],["opTypesCreateDropdown","",1,"button","-alt-highlight","add-work-package",3,"disabled","projectIdentifier","stateName","dropdownActive","title"],[1,"spot-icon","spot-icon_add"],["aria-hidden","true",1,"button--text",3,"textContent"],["icon-classes","button--icon icon-small icon-pulldown hidden-for-mobile"]],template:function(y,P){1&y&&(l.TgZ(0,"div",0),l.TgZ(1,"button",1),l.ALo(2,"async"),l._UZ(3,"span",2),l._UZ(4,"span",3),l._UZ(5,"op-icon",4),l.qZA(),l.qZA()),2&y&&(l.xp6(1),l.Q6J("disabled",P.disabled)("projectIdentifier",P.projectIdentifier)("stateName",l.lcZ(2,7,P.stateName$))("dropdownActive",P.allowed)("title",P.text.title),l.uIk("aria-label",P.text.explanation),l.xp6(3),l.Q6J("textContent",P.text.createWithDropdown))},directives:[C,u.o],pipes:[k.Ov],encapsulation:2,changeDetection:0})},22956:(te,M,t)=>{"use strict";t.d(M,{U:()=>a});var n=t(44210),e=t(96617),p=t(74647),h=t(38519),c=t(78434),i=t(2316),l=t(54364),r=t(2775);function d(m,v){if(1&m&&i._UZ(0,"span",4),2&m){const C=i.oxw();i.Q6J("textContent",C.filterCount)}}const f=function(m){return{"-active":m}};class a extends n.S{constructor(v,C,u,k){super(v),this.I18n=v,this.cdRef=C,this.wpFiltersService=u,this.wpTableFilters=k,this.initialized=!1,this.buttonId="work-packages-filter-toggle-button",this.iconClass="icon-filter",this.title=this.I18n.t("js.work_packages.filters.title")}ngOnInit(){this.setupObserver()}get labelKey(){return"js.button_filter"}get textKey(){return"js.toolbar.filter"}get label(){return this.prefix+this.text.label}get filterCount(){return this.count}performAction(v){this.toggleVisibility()}toggleVisibility(){this.wpFiltersService.toggleVisibility()}setupObserver(){this.wpTableFilters.live$().pipe(this.untilDestroyed()).subscribe(()=>{this.count=this.wpTableFilters.currentlyVisibleFilters.length,this.initialized=!0,this.cdRef.detectChanges()}),this.wpFiltersService.observeUntil((0,h.J6)(this)).subscribe(()=>{this.isActive=this.wpFiltersService.visible,this.cdRef.detectChanges()})}}a.\u0275fac=function(v){return new(v||a)(i.Y36(e.D),i.Y36(i.sBO),i.Y36(c.U),i.Y36(p.Z))},a.\u0275cmp=i.Xpm({type:a,selectors:[["wp-filter-button"]],features:[i.qOj],decls:5,vars:11,consts:[["data-qa-selector","wp-filter-button",1,"button",3,"disabled","ngClass","click"],[3,"icon-classes"],[1,"button--text"],["class","badge -secondary",3,"textContent",4,"ngIf"],[1,"badge","-secondary",3,"textContent"]],template:function(v,C){1&v&&(i.TgZ(0,"button",0),i.NdJ("click",function(k){return C.performAction(k)}),i._UZ(1,"op-icon",1),i.TgZ(2,"span",2),i._uU(3),i.YNc(4,d,1,1,"span",3),i.qZA(),i.qZA()),2&v&&(i.Q6J("disabled",C.disabled)("ngClass",i.VKq(9,f,C.isActive)),i.uIk("id",C.buttonId)("accesskey",C.accessKey)("title",C.title)("aria-label",C.label),i.xp6(1),i.MGl("icon-classes","",C.iconClass," button--icon"),i.xp6(2),i.hij(" ",C.buttonText," "),i.xp6(1),i.Q6J("ngIf",C.initialized))},directives:[l.mk,r.o,l.O5],encapsulation:2,changeDetection:0})},31021:(te,M,t)=>{"use strict";t.d(M,{q:()=>r});var n=t(96617),p=(t(24897),t(82123)),h=t(2316),c=t(2775),i=t(54364);function l(d,f){if(1&d&&h._UZ(0,"span",3),2&d){const a=h.oxw();h.Q6J("textContent",a.text.mark_as_read)}}class r{constructor(f,a){this.I18n=f,this.storeService=a,this.text={mark_as_read:this.I18n.t("js.notifications.center.mark_as_read")}}markAllBelongingNotificationsAsRead(){this.storeService.markAllAsRead()}}r.\u0275fac=function(f){return new(f||r)(h.Y36(n.D),h.Y36(p.O))},r.\u0275cmp=h.Xpm({type:r,selectors:[["op-work-package-mark-notification-button"]],inputs:{workPackage:"workPackage",showWithText:"showWithText"},decls:3,vars:2,consts:[[1,"button",3,"click"],["icon-classes","button--icon icon-mark-read"],["class","button--text",3,"textContent",4,"ngIf"],[1,"button--text",3,"textContent"]],template:function(f,a){1&f&&(h.TgZ(0,"button",0),h.NdJ("click",function(){return a.markAllBelongingNotificationsAsRead()}),h._UZ(1,"op-icon",1),h.YNc(2,l,1,1,"span",2),h.qZA()),2&f&&(h.uIk("title",a.text.mark_as_read),h.xp6(2),h.Q6J("ngIf",a.showWithText))},directives:[c.o,i.O5],encapsulation:2,changeDetection:0})},52025:(te,M,t)=>{"use strict";t.d(M,{b:()=>Z});var n=t(96617),e=t(2316),p=t(7493),h=t(55548),c=t(20342),i=t(87853),l=t(61043),d=(t(17577),t(77355)),f=t(57119),a=t(43440),m=t(77616),v=t(67727),C=t(36293),u=t(60312),k=t(1707);class x{constructor(B,J,R,F){this.states=B,this.querySpace=J,this.authorisationService=R,this.I18n=F,this.onChange=new e.vpe,this.text={showInMenu:this.I18n.t("js.label_star_query"),visibleForOthers:this.I18n.t("js.label_public_query"),showInMenuText:this.I18n.t("js.work_packages.query.star_text"),visibleForOthersText:this.I18n.t("js.work_packages.query.public_text")}}get canStar(){return this.isSave||this.authorisationService.can("query","star")||this.authorisationService.can("query","unstar")}get canPublish(){const B=this.querySpace.queryForm.value;return this.authorisationService.can("query","updateImmediately")&&B.schema.public.writable}updateStarred(B){this.isStarred=B,this.changed()}updatePublic(B){this.isPublic=B,this.changed()}changed(){this.onChange.emit({isStarred:!!this.isStarred,isPublic:!!this.isPublic})}}x.\u0275fac=function(B){return new(B||x)(e.Y36(i.G),e.Y36(a.q),e.Y36(p.g),e.Y36(n.D))},x.\u0275cmp=e.Xpm({type:x,selectors:[["query-sharing-form"]],inputs:{isSave:"isSave",isStarred:"isStarred",isPublic:"isPublic"},outputs:{onChange:"onChange"},decls:14,vars:8,consts:[[1,"form--field"],[1,"form--field-container","-vertical"],[1,"form--label-with-check-box"],[1,"form--check-box-container"],["type","checkbox","name","is_public","id","show-public",1,"form--check-box",3,"ngModel","disabled","ngModelChange"],[1,"form--field-instructions","-no-margin",3,"textContent"],["type","checkbox","name","show_in_menu","id","show-in-menu",1,"form--check-box",3,"ngModel","disabled","ngModelChange"]],template:function(B,J){1&B&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"label",2),e.TgZ(3,"div",3),e.TgZ(4,"input",4),e.NdJ("ngModelChange",function(F){return J.updatePublic(F)}),e.qZA(),e.qZA(),e._uU(5),e.qZA(),e._UZ(6,"div",5),e.qZA(),e.qZA(),e.TgZ(7,"div",0),e.TgZ(8,"div",1),e.TgZ(9,"label",2),e.TgZ(10,"div",3),e.TgZ(11,"input",6),e.NdJ("ngModelChange",function(F){return J.updateStarred(F)}),e.qZA(),e.qZA(),e._uU(12),e.qZA(),e._UZ(13,"div",5),e.qZA(),e.qZA()),2&B&&(e.xp6(4),e.Q6J("ngModel",J.isPublic)("disabled",!J.canPublish),e.xp6(1),e.hij(" ",J.text.visibleForOthers," "),e.xp6(1),e.Q6J("textContent",J.text.visibleForOthersText),e.xp6(5),e.Q6J("ngModel",J.isStarred)("disabled",!J.canStar),e.xp6(1),e.hij(" ",J.text.showInMenu," "),e.xp6(1),e.Q6J("textContent",J.text.showInMenuText))},directives:[k.Wl,k.JJ,k.On],encapsulation:2});class b extends u.T{constructor(B,J,R,F,Y,X,K,ie,H){super(J,X,B),this.elementRef=B,this.locals=J,this.I18n=R,this.states=F,this.querySpace=Y,this.cdRef=X,this.wpListService=K,this.halNotification=ie,this.toastService=H,this.isStarred=!1,this.isPublic=!1,this.isBusy=!1,this.text={title:this.I18n.t("js.modals.form_submit.title"),text:this.I18n.t("js.modals.form_submit.text"),save_as:this.I18n.t("js.label_save_as"),label_name:this.I18n.t("js.modals.label_name"),label_visibility_settings:this.I18n.t("js.label_visibility_settings"),button_save:this.I18n.t("js.modals.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")}}ngOnInit(){super.ngOnInit(),this.query=this.querySpace.query.value,this.isStarred=this.query.starred,this.isPublic=this.query.public}setValues(B){this.isStarred=B.isStarred,this.isPublic=B.isPublic}get afterFocusOn(){return document.getElementById("work-packages-settings-button")}saveQuery(B){if(this.isBusy)return;this.isBusy=!0;const J=[];this.query.public!==this.isPublic&&(this.query.public=this.isPublic,J.push(this.wpListService.save(this.query))),this.query.starred!==this.isStarred&&J.push(this.wpListService.toggleStarred(this.query)),Promise.all(J).then(()=>{this.closeMe(B),this.isBusy=!1}).catch(()=>{this.toastService.addError(this.I18n.t("js.error.query_saving")),this.isBusy=!1})}}b.\u0275fac=function(B){return new(B||b)(e.Y36(e.SBq),e.Y36(d.E),e.Y36(n.D),e.Y36(i.G),e.Y36(a.q),e.Y36(e.sBO),e.Y36(l.Z),e.Y36(v.W),e.Y36(C.kl))},b.\u0275cmp=e.Xpm({type:b,selectors:[["ng-component"]],features:[e.qOj],decls:9,vars:7,consts:[["data-indicator-name","modal",1,"spot-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container",3,"isSave","isStarred","isPublic","onChange"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","disabled","click"],[1,"button","button_no-margin","-highlight","-with-icon","icon-save","spot-action-bar--action",3,"textContent","click"]],template:function(B,J){1&B&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"query-sharing-form",3),e.NdJ("onChange",function(F){return J.setValues(F)}),e.qZA(),e.TgZ(5,"div",4),e.TgZ(6,"div",5),e.TgZ(7,"button",6),e.NdJ("click",function(F){return J.closeMe(F)}),e.qZA(),e.TgZ(8,"button",7),e.NdJ("click",function(F){return J.saveQuery(F)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&B&&(e.xp6(2),e.Oqu(J.text.label_visibility_settings),e.xp6(2),e.Q6J("isSave",!1)("isStarred",J.isStarred)("isPublic",J.isPublic),e.xp6(3),e.Q6J("textContent",J.text.button_cancel)("disabled",J.isBusy),e.xp6(1),e.Q6J("textContent",J.text.button_save))},directives:[x],encapsulation:2});var y=t(39656);const P=["queryNameField"];class E extends u.T{constructor(B,J,R,F,Y,X,K,ie,H){super(J,ie,B),this.elementRef=B,this.locals=J,this.I18n=R,this.states=F,this.querySpace=Y,this.wpListService=X,this.halNotification=K,this.cdRef=ie,this.toastService=H,this.queryName="",this.isStarred=!1,this.isPublic=!1,this.isBusy=!1,this.text={title:this.I18n.t("js.modals.form_submit.title"),text:this.I18n.t("js.modals.form_submit.text"),save_as:this.I18n.t("js.label_save_as"),label_name:this.I18n.t("js.modals.label_name"),label_visibility_settings:this.I18n.t("js.label_visibility_settings"),button_save:this.I18n.t("js.modals.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")}}setValues(B){this.isStarred=B.isStarred,this.isPublic=B.isPublic}onOpen(){this.queryNameField.nativeElement.focus()}get afterFocusOn(){return document.getElementById("work-packages-settings-button")}saveQueryAs(B){if(B.preventDefault(),this.isBusy||!this.queryName)return;this.isBusy=!0;const J=this.querySpace.query.value;J.public=this.isPublic,this.wpListService.create(J,this.queryName).then(R=>this.isStarred&&!R.starred?this.wpListService.toggleStarred(R).then(()=>this.closeMe(B)):(this.closeMe(B),Promise.resolve(!0))).catch(R=>this.halNotification.handleRawError(R)).then(()=>this.isBusy=!1)}}E.\u0275fac=function(B){return new(B||E)(e.Y36(e.SBq),e.Y36(d.E),e.Y36(n.D),e.Y36(i.G),e.Y36(a.q),e.Y36(l.Z),e.Y36(v.W),e.Y36(e.sBO),e.Y36(C.kl))},E.\u0275cmp=e.Xpm({type:E,selectors:[["ng-component"]],viewQuery:function(B,J){if(1&B&&e.Gf(P,7),2&B){let R;e.iGM(R=e.CRH())&&(J.queryNameField=R.first)}},features:[e.qOj],decls:19,vars:10,consts:[["data-indicator-name","modal","name","modalSaveForm",1,"spot-modal","loading-indicator--location",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],["name","modalSaveForm",1,"spot-modal--body","spot-container"],[1,"form--field","-required"],["for","save-query-name",1,"form--label","-bold",3,"textContent"],[1,"form--field-container"],[1,"form--text-field-container"],["type","text","name","save-query-name","id","save-query-name","required","",1,"form--text-field",3,"ngModel","ngModelChange"],["queryNameField",""],[1,"spot-subheader-extra-small"],[3,"isSave","isStarred","isPublic","onChange"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","-highlight","-with-icon","icon-save","spot-action-bar--action",3,"textContent","disabled"]],template:function(B,J){1&B&&(e.TgZ(0,"form",0),e.NdJ("submit",function(F){return J.saveQueryAs(F)}),e.TgZ(1,"h1",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e._UZ(6,"label",5),e.TgZ(7,"div",6),e.TgZ(8,"div",7),e.TgZ(9,"input",8,9),e.NdJ("ngModelChange",function(F){return J.queryName=F}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e._UZ(11,"div",2),e.TgZ(12,"h2",10),e._uU(13),e.qZA(),e.TgZ(14,"query-sharing-form",11),e.NdJ("onChange",function(F){return J.setValues(F)}),e.qZA(),e.qZA(),e.TgZ(15,"div",12),e.TgZ(16,"div",13),e.TgZ(17,"button",14),e.NdJ("click",function(F){return J.closeMe(F)}),e.qZA(),e._UZ(18,"button",15),e.qZA(),e.qZA(),e.qZA()),2&B&&(e.xp6(2),e.Oqu(J.text.save_as),e.xp6(4),e.Q6J("textContent",J.text.label_name),e.xp6(3),e.Q6J("ngModel",J.queryName),e.xp6(4),e.Oqu(J.text.label_visibility_settings),e.xp6(1),e.Q6J("isSave",!0)("isStarred",J.isStarred)("isPublic",J.isPublic),e.xp6(3),e.Q6J("textContent",J.text.button_cancel),e.xp6(1),e.Q6J("textContent",J.text.button_save)("disabled",J.isBusy||!J.queryName))},directives:[k._Y,k.JL,k.F,k.Fj,k.Q7,k.JJ,k.On,x],encapsulation:2});var T=t(48934);class O extends h.n{constructor(B,J,R,F,Y,X,K,ie,H){super(B,J),this.elementRef=B,this.opContextMenu=J,this.opModalService=R,this.wpListService=F,this.authorisationService=Y,this.states=X,this.injector=K,this.querySpace=ie,this.I18n=H,this.focusAfterClose=!0}ngAfterViewInit(){super.ngAfterViewInit(),this.querySpace.query.values$().pipe(this.untilDestroyed()).subscribe(B=>{this.query=B}),this.loadingPromise=this.querySpace.queryForm.valuesPromise(),this.querySpace.queryForm.values$().pipe(this.untilDestroyed()).subscribe(B=>{this.form=B})}open(B){this.loadingPromise.then(()=>{this.buildItems(),this.opContextMenu.show(this,B)})}get locals(){return{contextMenuId:"settingsDropdown",items:this.items}}positionArgs(B){const R=super.positionArgs(B);return _.assign(R,{my:"right top",at:"right bottom"}),R}onClose(){this.focusAfterClose&&this.afterFocusOn.focus()}allowQueryAction(B,J){return this.allowAction(B,"query",J)}allowWorkPackageAction(B,J){return this.allowAction(B,"work_packages",J)}allowFormAction(B,J){return!!this.form.$links[J]||(B.stopPropagation(),!1)}allowAction(B,J,R){return!!this.authorisationService.can(J,R)||(B.stopPropagation(),!1)}buildItems(){this.items=[{disabled:!1,linkText:this.I18n.t("js.toolbar.settings.configure_view"),hidden:this.hideTableOptions,icon:"icon-settings",onClick:B=>(this.opContextMenu.close(),this.opModalService.show(f.Q,this.injector),!0)},{linkText:this.I18n.t("js.work_packages.query.insert_columns"),hidden:this.hideTableOptions,icon:"icon-columns",class:"hidden-for-mobile",onClick:()=>(this.opModalService.show(f.Q,this.injector,{initialTab:"columns"}),!0)},{linkText:this.I18n.t("js.toolbar.settings.sort_by"),hidden:this.hideTableOptions,icon:"icon-sort-by",onClick:()=>(this.opModalService.show(f.Q,this.injector,{initialTab:"sort-by"}),!0)},{linkText:this.I18n.t("js.toolbar.settings.group_by"),hidden:this.hideTableOptions,icon:"icon-group-by",class:"hidden-for-mobile",onClick:()=>(this.opModalService.show(f.Q,this.injector,{initialTab:"display-settings"}),!0)},{disabled:!this.query.id||this.authorisationService.cannot("query","updateImmediately"),linkText:this.I18n.t("js.toolbar.settings.page_settings"),icon:"icon-edit",onClick:B=>(this.allowQueryAction(B,"update")&&(this.focusAfterClose=!1,jQuery(`${m.U$}`).trigger(m.mE)),!0)},{disabled:this.authorisationService.cannot("query","updateImmediately"),linkText:this.I18n.t("js.toolbar.settings.save"),icon:"icon-save",onClick:B=>{const{query:J}=this;return!(0,T.Z)(J)&&this.allowQueryAction(B,"updateImmediately")?this.opModalService.show(E,this.injector):J.id&&this.allowQueryAction(B,"updateImmediately")&&this.wpListService.save(J),!0}},{disabled:this.form?!this.form.$links.create_new:this.authorisationService.cannot("query","updateImmediately"),linkText:this.I18n.t("js.toolbar.settings.save_as"),icon:"icon-save",onClick:B=>(this.allowFormAction(B,"create_new")&&this.opModalService.show(E,this.injector),!0)},{disabled:this.authorisationService.cannot("query","delete"),linkText:this.I18n.t("js.toolbar.settings.delete"),icon:"icon-delete",onClick:B=>(this.allowQueryAction(B,"delete")&&window.confirm(this.I18n.t("js.text_query_destroy_confirmation"))&&this.wpListService.delete(),!0)},{disabled:this.authorisationService.cannot("work_packages","representations"),linkText:this.I18n.t("js.toolbar.settings.export"),hidden:this.hideTableOptions,icon:"icon-export",onClick:B=>(this.allowWorkPackageAction(B,"representations")&&this.opModalService.show(y.x,this.injector),!0)},{disabled:this.authorisationService.cannot("query","unstar")&&this.authorisationService.cannot("query","star"),linkText:this.I18n.t("js.toolbar.settings.visibility_settings"),icon:"icon-watched",onClick:B=>((this.allowQueryAction(B,"unstar")||this.allowQueryAction(B,"star"))&&this.opModalService.show(b,this.injector),!0)},{divider:!0,hidden:!(this.query.results.customFields&&this.form.configureForm)},{hidden:!this.query.results.customFields||this.hideTableOptions,href:this.query.results.customFields&&this.query.results.customFields.href,linkText:this.query.results.customFields&&this.query.results.customFields.name,icon:"icon-custom-fields",onClick:()=>!1}]}}O.\u0275fac=function(B){return new(B||O)(e.Y36(e.SBq),e.Y36(c.$),e.Y36(d.S),e.Y36(l.Z),e.Y36(p.g),e.Y36(i.G),e.Y36(e.zs3),e.Y36(a.q),e.Y36(n.D))},O.\u0275dir=e.lG2({type:O,selectors:[["","opSettingsContextMenu",""]],inputs:{query:["opSettingsContextMenu-query","query"],hideTableOptions:"hideTableOptions"},features:[e.qOj]});var I=t(2775);class Z{constructor(B){this.I18n=B,this.hideTableOptions=!1,this.text={more_actions:this.I18n.t("js.button_more_actions")}}}Z.\u0275fac=function(B){return new(B||Z)(e.Y36(n.D))},Z.\u0275cmp=e.Xpm({type:Z,selectors:[["ng-component"]],inputs:{hideTableOptions:"hideTableOptions"},decls:2,vars:2,consts:[["id","work-packages-settings-button","opSettingsContextMenu","","opSettingsContextMenu-query","query",1,"button","last","work-packages-settings-button","toolbar-icon",3,"title","hideTableOptions"],["icon-classes","button--icon icon-show-more"]],template:function(B,J){1&B&&(e.TgZ(0,"button",0),e._UZ(1,"op-icon",1),e.qZA()),2&B&&e.Q6J("title",J.text.more_actions)("hideTableOptions",J.hideTableOptions)},directives:[O,I.o],encapsulation:2,changeDetection:0})},96418:(te,M,t)=>{"use strict";t.d(M,{f:()=>E});t(24897);var e=t(12703),p=t(96617),h=t(50076),c=t(26942),i=t(44022),l=t(2316),r=t(54364),d=t(47775),f=t(20342),a=t(55548),m=t(36293),v=t(1403),C=t(62964),u=t(84699);class k extends a.n{constructor(O,I,Z,j,B,J,R,F){super(O,I),this.elementRef=O,this.opContextMenu=I,this.$state=Z,this.workPackageNotificationService=j,this.halEditing=B,this.toastService=J,this.I18n=R,this.halEvents=F}open(O){const I=this.halEditing.changeFor(this.workPackage);I.getForm().then(Z=>{const j=Z.schema.status.allowedValues;this.buildItems(j);const{writable:B}=I.schema.status;B?this.opContextMenu.show(this,O):this.toastService.addError(this.I18n.t("js.work_packages.message_work_package_status_blocked"))})}get locals(){return{items:this.items,contextMenuId:"wp-status-context-menu"}}updateStatus(O){const I=this.halEditing.changeFor(this.workPackage);I.projectedResource.status=O,(0,u.Z)(this.workPackage)||this.halEditing.save(I).then(()=>{this.workPackageNotificationService.showSave(this.workPackage)})}buildItems(O){this.items=O.map(I=>({disabled:!1,linkText:I.name,postIcon:I.isReadonly?"icon-locked":null,postIconTitle:this.I18n.t("js.work_packages.message_work_package_read_only"),class:h.Z.inlineClass("status",I.id),onClick:()=>(this.updateStatus(I),!0)}))}}k.\u0275fac=function(O){return new(O||k)(l.Y36(l.SBq),l.Y36(f.$),l.Y36(d.StateService),l.Y36(C.q),l.Y36(e.l),l.Y36(m.kl),l.Y36(p.D),l.Y36(v.J))},k.\u0275dir=l.lG2({type:k,selectors:[["","wpStatusDropdown",""]],inputs:{workPackage:["wpStatusDropdown-workPackage","workPackage"]},features:[l.qOj]});var x=t(2775);function b(T,O){1&T&&(l.TgZ(0,"span",6),l._UZ(1,"op-icon",7),l.qZA())}const y=function(T){return{"op-wp-status-button_small":T}};function P(T,O){if(1&T&&(l.TgZ(0,"div",1),l.TgZ(1,"button",2),l.YNc(2,b,2,0,"span",3),l._UZ(3,"span",4),l._UZ(4,"op-icon",5),l.qZA(),l.qZA()),2&T){const I=l.oxw();l.Q6J("ngClass",l.VKq(9,y,I.small)),l.uIk("title",I.buttonTitle),l.xp6(1),l.Q6J("ngClass",I.statusHighlightClass)("disabled",!I.allowed)("title",I.status.name)("wpStatusDropdown-workPackage",I.workPackage),l.uIk("aria-label",I.text.explanation),l.xp6(1),l.Q6J("ngIf",I.isReadonly),l.xp6(1),l.Q6J("textContent",I.status.name)}}class E extends c.N{constructor(O,I,Z,j){super(),this.I18n=O,this.cdRef=I,this.schemaCache=Z,this.halEditing=j,this.small=!1,this.text={explanation:this.I18n.t("js.label_edit_status"),workPackageReadOnly:this.I18n.t("js.work_packages.message_work_package_read_only"),workPackageStatusBlocked:this.I18n.t("js.work_packages.message_work_package_status_blocked")}}ngOnInit(){this.halEditing.temporaryEditResource(this.workPackage).values$().pipe(this.untilDestroyed()).subscribe(O=>{this.workPackage=O,this.workPackage.status&&this.workPackage.status.$load(),this.cdRef.detectChanges()})}get buttonTitle(){return this.schema.isReadonly?this.text.workPackageReadOnly:this.schema.isEditable&&!this.allowed?this.text.workPackageStatusBlocked:""}get statusHighlightClass(){const{status:O}=this;if(O)return h.Z.backgroundClass("status",O.id)}get status(){return this.workPackage.status}get isReadonly(){return this.schema.isReadonly}get allowed(){return this.schema.isAttributeEditable("status")}get schema(){return this.halEditing.typedState(this.workPackage).hasValue()?this.halEditing.typedState(this.workPackage).value.schema:this.schemaCache.of(this.workPackage)}}E.\u0275fac=function(O){return new(O||E)(l.Y36(p.D),l.Y36(l.sBO),l.Y36(i.y),l.Y36(e.l))},E.\u0275cmp=l.Xpm({type:E,selectors:[["wp-status-button"]],inputs:{workPackage:"workPackage",small:"small"},features:[l.qOj],decls:1,vars:1,consts:[["class","op-wp-status-button","data-qa-selector","op-wp-status-button",3,"ngClass",4,"ngIf"],["data-qa-selector","op-wp-status-button",1,"op-wp-status-button",3,"ngClass"],["wpStatusDropdown","",1,"op-wp-status-button--button","button",3,"ngClass","disabled","title","wpStatusDropdown-workPackage"],["class","op-wp-status-button--text button--text",4,"ngIf"],["aria-hidden","true",1,"op-wp-status-button--text","button--text",3,"textContent"],["icon-classes","button--icon icon-small icon-pulldown"],[1,"op-wp-status-button--text","button--text"],["icon-classes","button--icon icon-locked"]],template:function(O,I){1&O&&l.YNc(0,P,5,11,"div",0),2&O&&l.Q6J("ngIf",I.status)},directives:[r.O5,r.mk,k,x.o],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-status-button--button[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;padding:5px;margin-bottom:0;background-color:var(--status-selector-bg-color);border:none;color:#fff;max-width:100%;display:flex}.op-wp-status-button--text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-wp-status-button_small[_ngcontent-%COMP%]   .op-wp-status-button--button[_ngcontent-%COMP%]{line-height:16px;font-size:12px;height:16px;padding:0 5px;margin-right:0}"]})},11266:(te,M,t)=>{"use strict";t.d(M,{h:()=>r,a:()=>d});var n=t(96617),e=t(15950),h=t(44210),c=t(2316),i=t(2775);const l=e,r="zen-mode-toggle-button";class d extends h.S{constructor(a,m){super(a),this.I18n=a,this.cdRef=m,this.buttonId="work-packages-zen-mode-toggle-button",this.buttonClass="toolbar-icon",this.iconClass="icon-zen-mode",this.activateLabel=a.t("js.zen_mode.button_activate"),this.deactivateLabel=a.t("js.zen_mode.button_deactivate");const v=this;l.enabled&&l.onchange(()=>{l.isFullscreen||v.deactivateZenMode()})}get label(){return this.isActive?this.deactivateLabel:this.activateLabel}isToggle(){return!0}deactivateZenMode(){this.isActive=d.inZenMode=!1,jQuery("body").removeClass("zen-mode"),this.disabled=!1,l.enabled&&l.isFullscreen&&l.exit(),this.cdRef.detectChanges()}activateZenMode(){this.isActive=d.inZenMode=!0,jQuery("body").addClass("zen-mode"),l.enabled&&l.request(),this.cdRef.detectChanges()}performAction(a){return d.inZenMode?this.deactivateZenMode():this.activateZenMode(),a.preventDefault(),!1}}d.inZenMode=!1,d.\u0275fac=function(a){return new(a||d)(c.Y36(n.D),c.Y36(c.sBO))},d.\u0275cmp=c.Xpm({type:d,selectors:[["zen-mode-toggle-button"]],features:[c.qOj],decls:2,vars:10,consts:[["type","button",3,"disabled","click"],[3,"icon-classes"]],template:function(a,m){1&a&&(c.TgZ(0,"button",0),c.NdJ("click",function(C){return m.performAction(C)}),c._UZ(1,"op-icon",1),c.qZA()),2&a&&(c.Gre("button ",m.buttonClass,""),c.ekj("-active",m.isActive),c.Q6J("disabled",m.disabled||!m.isToggle()&&m.isActive),c.uIk("id",m.buttonId)("title",m.label)("accesskey",m.accessKey),c.xp6(1),c.MGl("icon-classes","",m.iconClass," button--icon"))},directives:[i.o],encapsulation:2,changeDetection:0})},31744:(te,M,t)=>{"use strict";t.d(M,{T:()=>k});var n=t(3786),e=t(60914),p=t(48451),h=t(11337),c=t(47775),i=t(53916),l=t(29161);class r{constructor(b,y){this.injector=b}get EVENT(){return"click.cardView.card"}get SELECTOR(){return'[data-qa-selector="op-wp-single-card"]'}eventScope(b){return jQuery(b.container.nativeElement)}handleEvent(b,y){const P=jQuery(y.target);if(P.is("a")||P.parent().is("a"))return!0;const E=P.closest("wp-single-card"),T=E.data("workPackageId");return!T||(this.handleWorkPackage(b,T,E,y),!1)}handleWorkPackage(b,y,P,E){this.setSelection(b,y,P,E),b.itemClicked.emit({workPackageId:y,double:!1})}setSelection(b,y,P,E){const T=P.data("classIdentifier"),O=this.wpCardView.findRenderedCard(T);E.ctrlKey||E.metaKey||E.shiftKey||this.wpTableSelection.setSelection(y,O),E.shiftKey&&this.wpTableSelection.setMultiSelectionFrom(this.wpCardView.renderedCards,y,O),(E.ctrlKey||E.metaKey)&&this.wpTableSelection.toggleRow(y),b.selectionChanged.emit(this.wpTableSelection.getSelectedWorkPackageIds()),this.wpTableFocus.updateFocus(y)}}(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",i.U)],r.prototype,"deviceService",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",c.StateService)],r.prototype,"$state",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",e.J)],r.prototype,"wpTableSelection",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",p.o)],r.prototype,"wpTableFocus",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",h.c)],r.prototype,"wpCardView",void 0);class d{constructor(b,y){this.injector=b}get EVENT(){return"dblclick.cardView.card"}get SELECTOR(){return'[data-qa-selector="op-wp-single-card"]'}eventScope(b){return jQuery(b.container.nativeElement)}handleEvent(b,y){const P=jQuery(y.target);if(P.is("a")||P.parent().is("a"))return!0;const T=P.closest("wp-single-card").data("workPackageId");return!T||(b.itemClicked.emit({workPackageId:T,double:!0}),!1)}}(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",c.StateService)],d.prototype,"$state",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",e.J)],d.prototype,"wpTableSelection",void 0);var f=t(20506),a=t(3352),m=t(20342),v=t(99794);class C{constructor(b,y){this.injector=b}get EVENT(){return"contextmenu.cardView.rightclick"}get SELECTOR(){return'[data-qa-selector="op-wp-single-card"]'}eventScope(b){return jQuery(b.container.nativeElement)}handleEvent(b,y){const P=jQuery(y.target);if(P.closest(`.${f.yF}`).length)return(0,a.qu)("Allowing original context menu on state link"),!0;y.preventDefault(),y.stopPropagation();const E=P.closest("wp-single-card"),T=E.data("workPackageId");if(!T)return!0;const O=E.data("classIdentifier"),I=this.wpCardView.findRenderedCard(O);this.wpTableSelection.isSelected(T)||this.wpTableSelection.setSelection(T,I);const Z=new v.X(this.injector,T,jQuery(y.target),{},b.showInfoButton);return this.opContextMenu.show(Z,y),!1}}(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",e.J)],C.prototype,"wpTableSelection",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",h.c)],C.prototype,"wpCardView",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",m.$)],C.prototype,"opContextMenu",void 0);var u=t(55236);class k extends u.A{constructor(){super(...arguments),this.eventHandlers=[b=>new r(this.injector,b),b=>new d(this.injector,b),b=>new C(this.injector,b)]}}},79460:(te,M,t)=>{"use strict";t.d(M,{q:()=>v});var n=t(3786),e=t(95846),p=t(87853),h=t(63829),c=t(8403),i=t(45237),l=t(68354),r=t(33276),d=t(65146),f=t(62964),a=t(84699),m=t(2316);class v{constructor(u,k,x,b,y,P,E,T,O){this.states=u,this.injector=k,this.reorderService=x,this.wpCreate=b,this.notificationService=y,this.apiV3Service=P,this.currentProject=E,this.dragService=T,this.wpInlineCreate=O}init(u){this.cardView=u}destroy(){null!==this.dragService&&this.dragService.remove(this.cardView.container.nativeElement)}registerDragAndDrop(){null!==this.dragService&&this.dragService.register({dragContainer:this.cardView.container.nativeElement,scrollContainers:[this.cardView.container.nativeElement],moves:u=>{const k=u.dataset.workPackageId,x=this.states.workPackages.get(k).value;return!!x&&this.cardView.canDragOutOf(x)&&!u.dataset.isNew},accepts:()=>this.cardView.dragInto,onMoved:u=>(0,n.mG)(this,void 0,void 0,function*(){const k=u.dataset.workPackageId,x=(0,l.c)(u),b=yield this.reorderService.move(this.currentOrder,k,x);this.updateOrder(b),this.cardView.onMoved.emit()}),onRemoved:u=>{const k=u.dataset.workPackageId,x=this.reorderService.remove(this.currentOrder,k);this.updateOrder(x)},onAdded:u=>(0,n.mG)(this,void 0,void 0,function*(){const k=u.dataset.workPackageId,x=(0,l.c)(u),b=yield this.apiV3Service.work_packages.id(k).get().toPromise(),y=yield this.addWorkPackageToQuery(b,x);return u.parentElement&&u.parentElement.removeChild(u),y})})}get workPackages(){return this._workPackages}set workPackages(u){if(this.activeInlineCreateWp){const k=this._workPackages.find(x=>(0,a.Z)(x));if(k){const x=this._workPackages.indexOf(k);this._workPackages[x]=this.activeInlineCreateWp}else this._workPackages=[this.activeInlineCreateWp,...u]}else this._workPackages=[...u]}get currentOrder(){return this.workPackages.filter(u=>u&&!(0,a.Z)(u)).map(u=>u.id)}updateOrder(u){u=_.uniq(u),Promise.all(u.map(k=>this.apiV3Service.work_packages.id(k).get().toPromise())).then(k=>{this.workPackages=k,this.cardView.cdRef.detectChanges()})}addNewCard(){this.wpCreate.createOrContinueWorkPackage(this.currentProject.identifier).then(u=>{this.activeInlineCreateWp=u.projectedResource,this.workPackages=this.workPackages,this.cardView.cdRef.detectChanges()})}addWorkPackageToQuery(u,k=-1){return(0,n.mG)(this,void 0,void 0,function*(){try{yield this.cardView.workPackageAddedHandler(u);const x=yield this.reorderService.add(this.currentOrder,u.id,k);return this.updateOrder(x),!0}catch(x){this.notificationService.handleRawError(x,u)}return!1})}removeReferenceWorkPackageForm(){this.activeInlineCreateWp&&this.removeCard(this.activeInlineCreateWp)}removeCard(u){const k=this.workPackages.indexOf(u);if(this.workPackages.splice(k,1),this.activeInlineCreateWp=void 0,!(0,a.Z)(u)){const x=this.reorderService.remove(this.currentOrder,u.id);this.updateOrder(x)}}onCardSaved(u){return(0,n.mG)(this,void 0,void 0,function*(){const k=this.workPackages.findIndex(x=>"new"===x.id);if(-1!==k){this.activeInlineCreateWp=void 0;const x=yield this.reorderService.add(this.currentOrder,u.id,k);this.updateOrder(x),this.wpInlineCreate.newInlineWorkPackageCreated.next(u.id)}})}}v.\u0275fac=function(u){return new(u||v)(m.LFG(p.G),m.LFG(m.zs3),m.LFG(e.M),m.LFG(h.P),m.LFG(f.q),m.LFG(r.T),m.LFG(d.R),m.LFG(i.j,8),m.LFG(c.m))},v.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac})},11337:(te,M,t)=>{"use strict";t.d(M,{c:()=>p});var n=t(43440),e=t(2316);class p{constructor(c){this.querySpace=c}classIdentifier(c){return`wp-row-${c.id}`}get renderedCards(){return this.querySpace.tableRendered.getValueOr([])}findRenderedCard(c){return _.findIndex(this.renderedCards,l=>l.classIdentifier===c)}updateRenderedCardsValues(c){this.querySpace.tableRendered.putValue(c.map(i=>({classIdentifier:this.classIdentifier(i),workPackageId:i.id,hidden:!1})))}}p.\u0275fac=function(c){return new(c||p)(e.LFG(n.q))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac})},91488:(te,M,t)=>{"use strict";t.d(M,{x:()=>X});var n=t(3786),e=t(2316),p=t(43440),h=t(96617),c=t(8403),i=t(63829),l=t(43682),r=t(7493),d=t(47775),f=t(87853),a=t(95846),m=t(70233),v=t(33927),C=t(9170),u=t(17163),k=t(64538),x=t(60914),b=t(31744),y=t(11337),P=t(79460),E=t(62964),T=t(53916),O=t(55236),I=t(26942),Z=t(1403),j=t(84699);const B=["container"];function J(K,ie){if(1&K&&(e.TgZ(0,"div",5),e._UZ(1,"ndc-dynamic",6),e.qZA()),2&K){const H=e.oxw();e.xp6(1),e.Q6J("ndcDynamicComponent",H.referenceClass)("ndcDynamicInjector",H.injector)("ndcDynamicOutputs",H.referenceOutputs)}}function R(K,ie){1&K&&e._UZ(0,"hr",9)}function F(K,ie){if(1&K){const H=e.EpF();e.ynx(0),e.TgZ(1,"wp-single-card",7),e.NdJ("onRemove",function(){const se=e.CHM(H).$implicit;return e.oxw().removeCard(se)})("stateLinkClicked",function(ce){return e.CHM(H),e.oxw().stateLinkClicked.emit(ce)}),e.qZA(),e.YNc(2,R,1,0,"hr",8),e.BQk()}if(2&K){const H=ie.$implicit,ee=e.oxw();e.xp6(1),e.Q6J("workPackage",H)("showInfoButton",ee.showInfoButton)("showStatusButton",ee.showStatusButton)("showRemoveButton",ee.cardsRemovable)("highlightingMode",ee.highlightingMode)("draggable",ee.canDragOutOf(H))("orientation",ee.orientation)("shrinkOnMobile",ee.shrinkOnMobile),e.uIk("data-is-new",ee.isNewResource(H)||void 0)("data-work-package-id",H.id)("data-class-identifier",ee.cardView.classIdentifier(H)),e.xp6(1),e.Q6J("ngIf",ee.shrinkOnMobile)}}function Y(K,ie){if(1&K&&(e.TgZ(0,"div"),e._UZ(1,"op-no-results",10),e.qZA()),2&K){const H=e.oxw();e.xp6(1),e.Q6J("title",H.text.noResults.title)("description",H.text.noResults.description)}}class X extends I.N{constructor(ie,H,ee,ce,se,re,Me,Ae,Ye,ze,Xe,it,at,lt,dt,de,oe,D){super(),this.querySpace=ie,this.states=H,this.injector=ee,this.$state=ce,this.I18n=se,this.wpCreate=re,this.wpInlineCreate=Me,this.notificationService=Ae,this.halEvents=Ye,this.authorisationService=ze,this.causedUpdates=Xe,this.cdRef=it,this.pathHelper=at,this.wpTableSelection=lt,this.wpViewOrder=dt,this.cardView=de,this.cardDragDrop=oe,this.deviceService=D,this.showStatusButton=!0,this.showInfoButton=!1,this.orientation="vertical",this.cardsRemovable=!1,this.showEmptyResultsBox=!1,this.shrinkOnMobile=!1,this.onMoved=new e.vpe,this.selectionChanged=new e.vpe,this.itemClicked=new e.vpe,this.stateLinkClicked=new e.vpe,this.trackByHref=(0,l.WJ)("lockVersion"),this.isResultEmpty=!1,this.text={removeCard:this.I18n.t("js.card.remove_from_list"),addNewCard:this.I18n.t("js.card.add_new"),noResults:{title:this.I18n.t("js.work_packages.no_results.title"),description:this.I18n.t("js.work_packages.no_results.description")}},this.inReference=!1,this.referenceClass=this.wpInlineCreate.referenceComponentClass,this.referenceOutputs={onCancel:()=>this.setReferenceMode(!1),onReferenced:G=>this.cardDragDrop.addWorkPackageToQuery(G,0)},this.isNewResource=j.Z}ngOnInit(){this.registerCreationCallback(),this.halEvents.aggregated$("WorkPackage").pipe((0,v.U)(ie=>ie.filter(H=>"updated"===H.eventType)),(0,C.h)(ie=>{const H=this.workPackages.map(ee=>ee.id.toString());return!!ie.find(ee=>-1!==H.indexOf(ee.id))})).subscribe(()=>{this.workPackages=this.workPackages.map(ie=>this.states.workPackages.get(ie.id).getValueOr(ie)),this.cdRef.detectChanges()}),this.querySpace.results.values$().pipe((0,u.M)(this.querySpace.query.values$()),this.untilDestroyed()).subscribe(([ie,H])=>{this.query=H,this.workPackages=this.wpViewOrder.orderedWorkPackages(),this.cardView.updateRenderedCardsValues(this.workPackages),this.isResultEmpty=0===this.workPackages.length,this.cdRef.detectChanges()})}ngAfterViewInit(){this.cardDragDrop.init(this),this.deviceService.isMobile||this.cardDragDrop.registerDragAndDrop();const ie=this.injector.get(O.m,b.T);ie instanceof b.T?ie.attachTo(this):new ie(this.injector).attachTo(this),this.wpTableSelection.registerSelectAllListener(()=>this.cardView.renderedCards),this.wpTableSelection.registerDeselectAllListener()}ngOnDestroy(){super.ngOnDestroy(),this.cardDragDrop.destroy()}get workPackages(){return this.cardDragDrop.workPackages}set workPackages(ie){this.cardDragDrop.workPackages=ie}setReferenceMode(ie){this.inReference=ie,this.cdRef.detectChanges()}addNewCard(){this.cardDragDrop.addNewCard()}removeCard(ie){this.cardDragDrop.removeCard(ie)}onCardSaved(ie){return(0,n.mG)(this,void 0,void 0,function*(){yield this.cardDragDrop.onCardSaved(ie)})}classes(){let ie="wp-cards-container ";return ie+=`-${this.orientation}`,ie+=this.shrinkOnMobile?" -shrink":"",ie}registerCreationCallback(){this.wpCreate.onNewWorkPackage().pipe(this.untilDestroyed()).subscribe(ie=>(0,n.mG)(this,void 0,void 0,function*(){this.onCardSaved(ie)}))}}X.\u0275fac=function(ie){return new(ie||X)(e.Y36(p.q),e.Y36(f.G),e.Y36(e.zs3),e.Y36(d.StateService),e.Y36(h.D),e.Y36(i.P),e.Y36(c.m),e.Y36(E.q),e.Y36(Z.J),e.Y36(r.g),e.Y36(k.h),e.Y36(e.sBO),e.Y36(m.j),e.Y36(x.J),e.Y36(a.M),e.Y36(y.c),e.Y36(P.q),e.Y36(T.U))},X.\u0275cmp=e.Xpm({type:X,selectors:[["wp-card-view"]],viewQuery:function(ie,H){if(1&ie&&e.Gf(B,7),2&ie){let ee;e.iGM(ee=e.CRH())&&(H.container=ee.first)}},inputs:{canDragOutOf:["dragOutOfHandler","canDragOutOf"],dragInto:"dragInto",highlightingMode:"highlightingMode",workPackageAddedHandler:"workPackageAddedHandler",showStatusButton:"showStatusButton",showInfoButton:"showInfoButton",orientation:"orientation",cardsRemovable:"cardsRemovable",showEmptyResultsBox:"showEmptyResultsBox",shrinkOnMobile:"shrinkOnMobile"},outputs:{onMoved:"onMoved",selectionChanged:"selectionChanged",itemClicked:"itemClicked",stateLinkClicked:"stateLinkClicked"},features:[e.qOj],decls:5,vars:5,consts:[["data-qa-selector","op-wp-card-view",3,"ngClass"],["container",""],["class","wp-inline-create--reference-container",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"wp-inline-create--reference-container"],[3,"ndcDynamicComponent","ndcDynamicInjector","ndcDynamicOutputs"],[3,"workPackage","showInfoButton","showStatusButton","showRemoveButton","highlightingMode","draggable","orientation","shrinkOnMobile","onRemove","stateLinkClicked"],["class","form--separator hidden-for-desktop",4,"ngIf"],[1,"form--separator","hidden-for-desktop"],[3,"title","description"]],template:function(ie,H){1&ie&&(e.TgZ(0,"div",0,1),e.YNc(2,J,2,3,"div",2),e.YNc(3,F,3,12,"ng-container",3),e.qZA(),e.YNc(4,Y,2,2,"div",4)),2&ie&&(e.Q6J("ngClass",H.classes()),e.xp6(2),e.Q6J("ngIf",H.inReference),e.xp6(1),e.Q6J("ngForOf",H.workPackages)("ngForTrackBy",H.trackByHref),e.xp6(1),e.Q6J("ngIf",H.showEmptyResultsBox&&H.isResultEmpty))},styles:[".wp-inline-create-button[_ngcontent-%COMP%]{font-size:.9rem;padding-top:1rem;text-align:center}.wp-inline-create--reference-container[_ngcontent-%COMP%]{margin-bottom:3rem;margin-top:10px}",".wp-cards-container.-horizontal[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));grid-column-gap:10px;grid-row-gap:10px;margin-right:5px}@media only screen and (max-width: 679px){.wp-cards-container.-horizontal.-shrink[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-row-gap:0;margin-right:0}.wp-cards-container.-horizontal.-shrink[_ngcontent-%COMP%]   .form--separator[_ngcontent-%COMP%]{margin-bottom:0}}",".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.wp-cards-container.-vertical[_ngcontent-%COMP%]{height:100%;padding:0 15px;border-radius:2px;overflow-y:scroll;scrollbar-color:transparent transparent;scrollbar-width:thin}.wp-cards-container.-vertical[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.wp-cards-container.-vertical[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.wp-cards-container.-vertical[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.wp-cards-container.-vertical[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.wp-cards-container.-vertical[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}"],changeDetection:0})},37409:(te,M,t)=>{"use strict";t.d(M,{P:()=>ee});var n=t(2316),e=t(20506),p=t(70233),h=t(50076),c=t(47775),i=t(60914),l=t(11337),r=t(96617),d=t(26942),f=t(48451),m=(t(24897),t(67325)),v=t(84699),C=t(70692),u=t(61486),k=t(33927),x=t(54364),b=t(2775),y=t(61342),P=t(54262),E=t(96418),T=t(3742);function O(ce,se){if(1&ce){const re=n.EpF();n.TgZ(0,"button",9),n.NdJ("click",function(Ae){n.CHM(re);const Ye=n.oxw();return Ye.emitStateLinkClicked(Ae,Ye.workPackage,!0)}),n._UZ(1,"op-icon",10),n.qZA()}if(2&ce){const re=n.oxw();n.Q6J("title",re.text.detailsView)}}function I(ce,se){if(1&ce){const re=n.EpF();n.TgZ(0,"button",11),n.NdJ("click",function(){n.CHM(re);const Ae=n.oxw();return Ae.onRemoved(Ae.workPackage)}),n._UZ(1,"op-icon",12),n.qZA()}if(2&ce){const re=n.oxw();n.ekj("-show",re.isNewResource(re.workPackage)),n.Q6J("title",re.text.removeCard)}}function Z(ce,se){if(1&ce&&n._UZ(0,"op-icon",13),2&ce){const re=n.oxw();n.Q6J("ngClass","tooltip--"+re.disabledInfo.orientation),n.uIk("data-tooltip",re.disabledInfo.text)}}function j(ce,se){if(1&ce&&(n.TgZ(0,"edit-form",14),n.TgZ(1,"div",15),n._UZ(2,"op-editable-attribute-field",16),n._UZ(3,"op-editable-attribute-field",17),n.qZA(),n.qZA()),2&ce){const re=n.oxw();n.Q6J("resource",re.workPackage)("inEditMode",re.isNewResource(re.workPackage)),n.xp6(2),n.Q6J("resource",re.workPackage)("wrapperClasses","work-packages--type-selector")("fieldName","type"),n.xp6(1),n.Q6J("resource",re.workPackage)}}function B(ce,se){if(1&ce&&(n.TgZ(0,"span",29),n._uU(1),n.qZA()),2&ce){const re=n.oxw(2);n.xp6(1),n.hij(" ",re.startDate(re.workPackage)," - ")}}function J(ce,se){if(1&ce&&n._UZ(0,"span",30),2&ce){const re=n.oxw(2);n.Q6J("textContent",re.wpTypeAttribute(re.workPackage))("ngClass",re.typeHighlightingClass(re.workPackage))}}function R(ce,se){if(1&ce&&(n.TgZ(0,"span",29),n._uU(1),n.qZA()),2&ce){const re=n.oxw(2);n.xp6(1),n.hij(" - ",re.endDate(re.workPackage)," ")}}function F(ce,se){if(1&ce&&n._UZ(0,"img",31),2&ce){const re=n.oxw(2);n.Q6J("src",re.bcfSnapshotPath(re.workPackage),n.LSH)}}function Y(ce,se){if(1&ce&&n._UZ(0,"wp-status-button",32),2&ce){const re=n.oxw(2);n.Q6J("workPackage",re.workPackage)("small",!0)}}function X(ce,se){if(1&ce&&n._UZ(0,"op-principal",33),2&ce){const re=n.oxw(2);n.Q6J("principal",re.workPackage.assignee)("hideName",!0)("link",!1)}}function K(ce,se){if(1&ce&&n._UZ(0,"span",34),2&ce){const re=n.oxw(2);n.Q6J("textContent",re.wpDates(re.workPackage))("ngClass",re.wpOverDueHighlighting(re.workPackage))}}const ie=function(ce){return{"op-wp-single-card--content-project-name_hideable":ce}};function H(ce,se){if(1&ce){const re=n.EpF();n.TgZ(0,"div",18),n.TgZ(1,"span",19),n._uU(2),n.qZA(),n.TgZ(3,"a",20),n.NdJ("click",function(Ae){n.CHM(re);const Ye=n.oxw();return Ye.emitStateLinkClicked(Ae,Ye.workPackage)}),n._uU(4),n.qZA(),n.TgZ(5,"span",21),n.YNc(6,B,2,1,"span",22),n.YNc(7,J,1,2,"span",23),n._UZ(8,"span",24),n.YNc(9,R,2,1,"span",22),n.qZA(),n.YNc(10,F,1,1,"img",25),n.YNc(11,Y,1,2,"wp-status-button",26),n.YNc(12,X,1,3,"op-principal",27),n.YNc(13,K,1,2,"span",28),n.qZA()}if(2&ce){const re=n.oxw();n.xp6(1),n.Q6J("ngClass",n.VKq(13,ie,re.showInfoButton||re.showRemoveButton)),n.xp6(1),n.hij(" - ",re.wpProjectName(re.workPackage)," "),n.xp6(1),n.Q6J("href",re.fullWorkPackageLink(re.workPackage),n.LSH)("ngClass",re.uiStateLinkClass),n.xp6(1),n.hij(" #",re.workPackage.id," "),n.xp6(2),n.Q6J("ngIf",re.showAsInlineCard&&re.showStartDate),n.xp6(1),n.Q6J("ngIf",!re.showAsInlineCard&&"type"!==re.highlightingMode),n.xp6(1),n.Q6J("textContent",re.wpSubject(re.workPackage)),n.xp6(1),n.Q6J("ngIf",re.showAsInlineCard&&re.showEndDate),n.xp6(1),n.Q6J("ngIf",re.cardCoverImageShown(re.workPackage)&&!re.showAsInlineCard),n.xp6(1),n.Q6J("ngIf",re.showStatusButton),n.xp6(1),n.Q6J("ngIf",re.workPackage.assignee),n.xp6(1),n.Q6J("ngIf",!re.showAsInlineCard)}}class ee extends d.N{constructor(se,re,Me,Ae,Ye,ze,Xe,it,at){super(),this.pathHelper=se,this.I18n=re,this.$state=Me,this.uiRouterGlobals=Ae,this.wpTableSelection=Ye,this.wpTableFocus=ze,this.cardView=Xe,this.cdRef=it,this.timezoneService=at,this.selectedWhenOpen=!1,this.showInfoButton=!1,this.showStatusButton=!0,this.showRemoveButton=!1,this.highlightingMode="inline",this.draggable=!1,this.orientation="vertical",this.shrinkOnMobile=!1,this.showAsInlineCard=!1,this.showStartDate=!0,this.showEndDate=!0,this.isClosed=!1,this.showAsGhost=!1,this.onRemove=new n.vpe,this.stateLinkClicked=new n.vpe,this.cardClicked=new n.vpe,this.cardDblClicked=new n.vpe,this.cardContextMenu=new n.vpe,this.uiStateLinkClass=e.yF,this.selected=!1,this.text={removeCard:this.I18n.t("js.card.remove_from_list"),detailsView:this.I18n.t("js.button_open_details")},this.isNewResource=v.Z,this.dateTimeFormatYear=new Intl.DateTimeFormat(this.I18n.locale,{year:"numeric",month:"short",day:"numeric"}),this.dateTimeFormat=new Intl.DateTimeFormat(this.I18n.locale,{month:"short",day:"numeric"})}ngOnInit(){(0,u.aj)([this.wpTableSelection.live$(),this.uiRouterGlobals.params$]).pipe(this.untilDestroyed(),(0,k.U)(()=>this.selectedWhenOpen?this.uiRouterGlobals.params.workPackageId===this.workPackage.id:this.wpTableSelection.isSelected(this.workPackage.id))).subscribe(se=>{this.selected=se,this.cdRef.detectChanges()})}classIdentifier(se){return this.cardView.classIdentifier(se)}emitStateLinkClicked(se,re,Me){if((0,m.F)(se))return;const Ae=this.classIdentifier(re),Ye=Me?"split":"show";this.wpTableSelection.setSelection(re.id,this.cardView.findRenderedCard(Ae)),this.wpTableFocus.updateFocus(re.id),this.stateLinkClicked.emit({workPackageId:re.id,requestedState:Ye}),se.preventDefault()}cardClasses(){const se="op-wp-single-card";return{[`${se}_selected`]:this.selected,[`${se}_draggable`]:this.draggable,[`${se}_new`]:(0,v.Z)(this.workPackage),[`${se}_shrink`]:this.shrinkOnMobile,[`${se}_inline`]:this.showAsInlineCard,[`${se}_closed`]:this.isClosed,[`${se}_ghosted`]:this.showAsGhost,[`${se}-${this.workPackage.id}`]:!!this.workPackage.id,[`${se}_${this.orientation}`]:!0}}cardTitle(){return`${this.workPackage.subject} (${this.workPackage.status.name})`}wpTypeAttribute(se){return se.type.name}wpSubject(se){return se.subject}wpProjectName(se){var re;return null===(re=se.project)||void 0===re?void 0:re.name}wpDates(se){const{startDate:re,dueDate:Me}=se;return re&&Me?String(this.dateTimeFormatYear.formatRange(new Date(re),new Date(Me))):!re&&Me?`\u2013 ${this.dateTimeFormatYear.format(new Date(Me))}`:re&&!Me?`${this.dateTimeFormatYear.format(new Date(re))} \u2013`:""}startDate(se){const{startDate:re}=se;return re?this.dateTimeFormat.format(new Date(re)):""}endDate(se){const{dueDate:re}=se;return re?this.dateTimeFormat.format(new Date(re)):""}wpOverDueHighlighting(se){const re=this.timezoneService.daysFromToday(se.dueDate);return h.Z.overdueDate(re)}fullWorkPackageLink(se){return this.$state.href("work-packages.show",{workPackageId:se.id})}cardHighlightingClass(se){return this.cardHighlighting(se)}typeHighlightingClass(se){return this.attributeHighlighting("type",se)}onRemoved(se){this.onRemove.emit(se)}cardCoverImageShown(se){return null!==this.bcfSnapshotPath(se)}bcfSnapshotPath(se){return se.bcfViewpoints&&se.bcfViewpoints.length>0?`${se.bcfViewpoints[0].href}/snapshot`:null}cardHighlighting(se){return["status","priority","type"].includes(this.highlightingMode)?h.Z.backgroundClass(this.highlightingMode,se[this.highlightingMode].id):""}attributeHighlighting(se,re){return h.Z.inlineClass(se,re.type.id)}}ee.\u0275fac=function(se){return new(se||ee)(n.Y36(p.j),n.Y36(r.D),n.Y36(c.StateService),n.Y36(c.UIRouterGlobals),n.Y36(i.J),n.Y36(f.o),n.Y36(l.c),n.Y36(n.sBO),n.Y36(C.B))},ee.\u0275cmp=n.Xpm({type:ee,selectors:[["wp-single-card"]],inputs:{workPackage:"workPackage",selectedWhenOpen:"selectedWhenOpen",showInfoButton:"showInfoButton",showStatusButton:"showStatusButton",showRemoveButton:"showRemoveButton",highlightingMode:"highlightingMode",draggable:"draggable",orientation:"orientation",shrinkOnMobile:"shrinkOnMobile",disabledInfo:"disabledInfo",showAsInlineCard:"showAsInlineCard",showStartDate:"showStartDate",showEndDate:"showEndDate",isClosed:"isClosed",showAsGhost:"showAsGhost"},outputs:{onRemove:"onRemove",stateLinkClicked:"stateLinkClicked",cardClicked:"cardClicked",cardDblClicked:"cardDblClicked",cardContextMenu:"cardContextMenu"},features:[n.qOj],decls:9,vars:10,consts:[["data-qa-selector","op-wp-single-card",1,"op-wp-single-card",3,"ngClass","title","click","dblclick","contextmenu"],[1,"op-wp-single-card--highlighting",3,"ngClass"],[1,"op-wp-single-card--card-actions"],["data-qa-selector","op-wp-single-card--inline-buttons",1,"op-wp-single-card--inline-buttons","hidden-for-mobile"],["type","button","class","spot-link op-wp-single-card--details-button op-wp-single-card--card-action","data-qa-selector","op-wp-single-card--details-button",3,"title","click",4,"ngIf"],["class","spot-link op-wp-single-card--inline-cancel-button op-wp-single-card--card-action","data-qa-selector","op-wp-single-card--inline-cancel-button",3,"-show","title","click",4,"ngIf"],["class","-multiline op-wp-single-card--card-action op-wp-single-card--card-action_closed","icon-classes","icon-context icon-not-supported",3,"ngClass",4,"ngIf"],[3,"resource","inEditMode",4,"ngIf"],["class","op-wp-single-card--content",4,"ngIf"],["type","button","data-qa-selector","op-wp-single-card--details-button",1,"spot-link","op-wp-single-card--details-button","op-wp-single-card--card-action",3,"title","click"],["icon-classes","icon3 icon-info2"],["data-qa-selector","op-wp-single-card--inline-cancel-button",1,"spot-link","op-wp-single-card--inline-cancel-button","op-wp-single-card--card-action",3,"title","click"],["icon-classes","icon-context icon-close"],["icon-classes","icon-context icon-not-supported",1,"-multiline","op-wp-single-card--card-action","op-wp-single-card--card-action_closed",3,"ngClass"],[3,"resource","inEditMode"],[1,"op-wp-single-card-content","-new"],[1,"op-wp-single-card-content--type",3,"resource","wrapperClasses","fieldName"],["fieldName","subject",1,"op-wp-single-card-content--subject","-bold",3,"resource"],[1,"op-wp-single-card--content"],[1,"op-wp-single-card--content-project-name",3,"ngClass"],[1,"op-wp-single-card--content-id",3,"href","ngClass","click"],[1,"op-wp-single-card--content-subject-line"],["class","op-wp-single-card--content-inline-date",4,"ngIf"],["class","op-wp-single-card--content-type","data-qa-selector","op-wp-single-card--content-type",3,"textContent","ngClass",4,"ngIf"],["data-qa-selector","op-wp-single-card--content-subject",1,"op-wp-single-card--content-subject",3,"textContent"],["class","op-wp-single-card--content-cover-image",3,"src",4,"ngIf"],["class","op-wp-single-card--content-status",3,"workPackage","small",4,"ngIf"],["size","mini","class","op-wp-single-card--content-assignee","data-qa-selector","op-wp-single-card--content-assignee",3,"principal","hideName","link",4,"ngIf"],["class","op-wp-single-card--content-dates",3,"textContent","ngClass",4,"ngIf"],[1,"op-wp-single-card--content-inline-date"],["data-qa-selector","op-wp-single-card--content-type",1,"op-wp-single-card--content-type",3,"textContent","ngClass"],[1,"op-wp-single-card--content-cover-image",3,"src"],[1,"op-wp-single-card--content-status",3,"workPackage","small"],["size","mini","data-qa-selector","op-wp-single-card--content-assignee",1,"op-wp-single-card--content-assignee",3,"principal","hideName","link"],[1,"op-wp-single-card--content-dates",3,"textContent","ngClass"]],template:function(se,re){1&se&&(n.TgZ(0,"div",0),n.NdJ("click",function(Ae){return re.cardClicked.emit({workPackageId:re.workPackage.id,event:Ae})})("dblclick",function(Ae){return re.cardDblClicked.emit({workPackageId:re.workPackage.id,event:Ae})})("contextmenu",function(Ae){return re.cardContextMenu.emit({workPackageId:re.workPackage.id,event:Ae})}),n._UZ(1,"div",1),n.TgZ(2,"div",2),n.TgZ(3,"div",3),n.YNc(4,O,2,1,"button",4),n.YNc(5,I,2,3,"button",5),n.YNc(6,Z,1,2,"op-icon",6),n.qZA(),n.qZA(),n.YNc(7,j,4,6,"edit-form",7),n.YNc(8,H,14,15,"div",8),n.qZA()),2&se&&(n.Q6J("ngClass",re.cardClasses())("title",re.cardTitle()),n.uIk("data-qa-draggable",re.draggable||void 0)("data-qa-selected",re.selected||void 0),n.xp6(1),n.Q6J("ngClass",re.cardHighlightingClass(re.workPackage)),n.xp6(3),n.Q6J("ngIf",!re.isNewResource(re.workPackage)&&re.showInfoButton),n.xp6(1),n.Q6J("ngIf",re.isNewResource(re.workPackage)||re.showRemoveButton),n.xp6(1),n.Q6J("ngIf",re.disabledInfo&&re.disabledInfo.text.length>0),n.xp6(1),n.Q6J("ngIf",re.isNewResource(re.workPackage)),n.xp6(1),n.Q6J("ngIf",!re.isNewResource(re.workPackage)))},directives:[x.mk,x.O5,b.o,y.n,P.k,E.f,T.N],styles:['.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-single-card[_ngcontent-%COMP%]{display:flex;-webkit-user-select:none;user-select:none;width:calc(100% - 2px);border:1px solid var(--widget-box-block-border-color);border-radius:2px;padding:10px;position:relative;box-shadow:1px 1px 3px #d3d3d3;background:var(--body-background);font-size:var(--card-font-size)}.op-wp-single-card[_ngcontent-%COMP%]:hover   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{opacity:1;z-index:2;background-image:linear-gradient(to left,white,rgba(255,255,255,0))}.op-wp-single-card_new[_ngcontent-%COMP%]{padding-right:25px}.op-wp-single-card_ghosted[_ngcontent-%COMP%]{opacity:.5}.op-wp-single-card_selected[_ngcontent-%COMP%]{background-color:#d1e5f5}.op-wp-single-card_selected[_ngcontent-%COMP%]   .op-icon--wrapper[_ngcontent-%COMP%]{background:#d1e5f5}.op-wp-single-card_selected[_ngcontent-%COMP%]:hover   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{background-image:linear-gradient(to left,#d1e5f5,rgba(209,229,245,0))}.op-wp-single-card_closed[_ngcontent-%COMP%]:not(.op-wp-single-card_selected){background-color:#f3f3f3}.op-wp-single-card_closed[_ngcontent-%COMP%]:not(.op-wp-single-card_selected)   .op-icon--wrapper[_ngcontent-%COMP%]{background:#f3f3f3}.op-wp-single-card_closed[_ngcontent-%COMP%]:not(.op-wp-single-card_selected):hover   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{background-image:linear-gradient(to left,#f3f3f3,rgba(243,243,243,0))}.op-wp-single-card_horizontal[_ngcontent-%COMP%]{height:100%}.op-wp-single-card_vertical[_ngcontent-%COMP%]{margin-top:10px}.op-wp-single-card_vertical[_ngcontent-%COMP%]:last-of-type{margin-bottom:5px}.op-wp-single-card_inline[_ngcontent-%COMP%]   .op-wp-single-card--content[_ngcontent-%COMP%]{grid-template-columns:max-content max-content auto auto 1fr;grid-template-rows:auto max-content;grid-template-areas:"status id project project project" "subject subject subject subject subject"}.op-wp-single-card_inline[_ngcontent-%COMP%]   .op-wp-single-card--content-assignee[_ngcontent-%COMP%]{display:none}.op-wp-single-card_inline[_ngcontent-%COMP%]   .op-wp-single-card--content-subject-line[_ngcontent-%COMP%]{display:flex}.op-wp-single-card_inline[_ngcontent-%COMP%]   .op-wp-single-card--content-subject[_ngcontent-%COMP%]{flex-grow:1;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}wp-single-card.gu-transit[_nghost-%COMP%]   .op-wp-single-card[_ngcontent-%COMP%]{border:1px dashed var(--primary-color);pointer-events:none}wp-single-card.gu-transit[_nghost-%COMP%]   .op-wp-single-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{visibility:hidden}.op-wp-single-card--content[_ngcontent-%COMP%]:not(.-new){display:grid;grid-template-columns:max-content max-content auto auto 1fr;grid-template-rows:auto max-content max-content 1fr;grid-row-gap:5px;grid-column-gap:5px;grid-template-areas:"status id project project project" "subject subject subject subject subject" "image image image image image" "avatar avatar avatar dates dates";overflow:hidden;flex-grow:1;font-size:14px;line-height:16px}.op-wp-single-card--content-project-name[_ngcontent-%COMP%]{grid-area:project;font-style:italic;color:#878787;font-size:12px;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.op-wp-single-card--content-type[_ngcontent-%COMP%]{grid-area:type;margin-right:4px}.op-wp-single-card--content-subject-line[_ngcontent-%COMP%]{grid-area:subject;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis}.op-wp-single-card--content-assignee[_ngcontent-%COMP%]{margin-right:auto;grid-area:avatar;max-width:140px;color:#878787;font-size:12px}.op-wp-single-card--content-id[_ngcontent-%COMP%]{grid-area:id;color:#878787;font-size:12px}.op-wp-single-card--content-status[_ngcontent-%COMP%]{grid-area:status;margin-right:5px;max-width:92px;overflow:hidden}.op-wp-single-card--content-cover-image[_ngcontent-%COMP%]{grid-area:image;max-height:350px}@media screen and (max-width: 679px){.op-wp-single-card--content-cover-image[_ngcontent-%COMP%]{max-height:250px}}.op-wp-single-card--content-dates[_ngcontent-%COMP%]{grid-area:dates;place-self:center end;white-space:nowrap;color:#878787;font-size:12px}.op-wp-single-card--content-inline-date[_ngcontent-%COMP%]{font-size:12px;color:#878787;margin:0 8px;white-space:nowrap}.op-wp-single-card--highlighting[_ngcontent-%COMP%]{width:100%;height:2px;position:absolute;top:0;left:0;border-radius:2px 2px 0 0}.op-wp-single-card--card-actions[_ngcontent-%COMP%]{display:flex;position:absolute;top:9px;right:0}.op-wp-single-card--card-action[_ngcontent-%COMP%]{z-index:2}.op-wp-single-card--card-action_closed[_ngcontent-%COMP%]{color:#555}.op-wp-single-card_selected[_ngcontent-%COMP%]   .op-wp-single-card--card-action[_ngcontent-%COMP%]{background-color:#d1e5f5}.op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{opacity:0;padding-left:30px;padding-right:4px;white-space:nowrap}.op-wp-single-card_selected[_ngcontent-%COMP%]   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{padding-left:15px}.op-icon--wrapper[_ngcontent-%COMP%]:not(.op-wp-single-card--inline-buttons_selected){background:white}.op-wp-single-card--inline-buttons.-show[_ngcontent-%COMP%]{opacity:1}.op-wp-single-card_selected[_ngcontent-%COMP%]   .op-wp-single-card--inline-buttons[_ngcontent-%COMP%]{background-color:#d1e5f5}.op-wp-single-card--inline-cancel-button[_ngcontent-%COMP%]{color:var(--warn)}@media only screen and (max-width: 679px){.op-wp-single-card_shrink[_ngcontent-%COMP%]{border:none;box-shadow:none;padding:15px}}'],changeDetection:0})},98722:(te,M,t)=>{"use strict";t.d(M,{H:()=>r});var n=t(3786),e=t(53466),p=t(39410),h=t(53457),c=t(12703),i=t(29161),l=t(2316);class r extends p.I{constructor(){super(...arguments),this.copying=!0}ngOnInit(){super.ngOnInit(),this.wpCreate.onNewWorkPackage().pipe(this.untilDestroyed()).subscribe(f=>{f.__initialized_at===this.__initialized_at&&this.wpRelations.addCommonRelation(f.id,"relates",this.copiedWorkPackageId)})}createdWorkPackage(){return this.copiedWorkPackageId=this.stateParams.copiedFromWorkPackageId,new Promise((f,a)=>{this.apiV3Service.work_packages.id(this.copiedWorkPackageId).get().pipe((0,e.q)(1)).subscribe(m=>{this.createCopyFrom(m).then(f,a)})})}setTitle(){this.titleService.setFirstPart(this.I18n.t("js.work_packages.copy.title"))}createCopyFrom(f){const a=this.halEditing.changeFor(f);return this.wpCreate.copyWorkPackage(a).then(m=>(this.__initialized_at=m.pristineResource.__initialized_at,this.apiV3Service.work_packages.cache.updateWorkPackage(m.pristineResource,!0),this.halEditing.updateValue("new",m),m))}}r.\u0275fac=function(){let d;return function(a){return(d||(d=l.n5z(r)))(a||r)}}(),r.\u0275dir=l.lG2({type:r,features:[l.qOj]}),(0,n.gn)([(0,i.W)(),(0,n.w6)("design:type",h.V)],r.prototype,"wpRelations",void 0),(0,n.gn)([(0,i.W)(),(0,n.w6)("design:type",c.l)],r.prototype,"halEditing",void 0)},97979:(te,M,t)=>{"use strict";t.d(M,{R:()=>d});var n=t(3786),e=t(80044),p=t(96905),h=t(91923),c=t(43682),i=t(55749),l=t(29161),r=t(65146);class d{constructor(a,m,v=[]){this.injector=a,this.filters=m,this.excluded=v,this.handlers={"=":this.applyFirstValue.bind(this),"!*":this.setToNull.bind(this)}}applyDefaultsFromFilters(a){_.each(this.filters,m=>{if(-1!==this.excluded.indexOf(m.id))return;if("project"===m.id){const u=_.find(m.values,k=>(k instanceof e.X?k.href:k)===this.currentProject.apiv3Path);return void this.setValue(a,"project",u||m.values[0])}if("id"===m.id)return;const v=m.operator.id,C=this.handlers[v];null==C||C.call(this,a,m)})}applyFirstValue(a,m){if(this.filterAlreadyApplied(a,m))return;const v=m.values[0];if(v){const C=this.mapFilterToAttribute(m);this.setValueFor(a,C,v)}}setToNull(a,m){const v=this.mapFilterToAttribute(m);this.setValue(a,v,{href:null})}setValueFor(a,m,v){const C=this.findSpecialValue(v,m)||v;C&&this.setValue(a,m,C)}setValue(a,m,v){a instanceof i.G?a.setValue(m,v):a[m]=v}findSpecialValue(a,m){return"parent"===m?a:a instanceof e.X&&"/api/v3/users/me"===a.href&&this.currentUser.isLoggedIn?this.halResourceService.fromSelfLink(`/api/v3/users/${this.currentUser.userId}`):void 0}filterAlreadyApplied(a,m){let v=a instanceof i.G?a.projectedResource[m.id]:a[m.id];v=_.castArray(v);for(let C=0;C<m.values.length;C++)for(let u=0;u<v.length;u++)if((0,c.q9)(v[u],m.values[C]))return!0;return!1}mapFilterToAttribute(a){return"onlySubproject"===a.id?"project":a.id}}(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",p.S)],d.prototype,"currentUser",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",h.u)],d.prototype,"halResourceService",void 0),(0,n.gn)([(0,l.W)(),(0,n.w6)("design:type",r.R)],d.prototype,"currentProject",void 0)},55749:(te,M,t)=>{"use strict";t.d(M,{G:()=>h});var n=t(94232),e=t(81923),p=t(84699);class h extends n.W{setValue(i,l){super.setValue(i,l),("project"===i||"type"===i)&&this.updateForm()}applyChanges(i){return delete i.description,super.applyChanges(i)}setNewDefaultFor(i,l){"description"===i&&(0,p.Z)(this.pristineResource)?this.pristineResource.description=l:super.setNewDefaultFor(i,l)}get schema(){return this.form$.hasValue()?e.X.create(super.schema,this.projectedResource):super.schema}}},35403:(te,M,t)=>{"use strict";t.d(M,{L:()=>h});var n=t(61342),e=t(2316);class h{constructor(i,l){this.wpeditForm=i,this.elementRef=l}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement)}activate(i){if(jQuery(i.target).closest(".help-text--entry").length)return!0;const r=this.wpeditForm.fields[this.fieldName];return r&&r.handleUserActivate(null),!1}}h.\u0275fac=function(i){return new(i||h)(e.Y36(n.n),e.Y36(e.SBq))},h.\u0275cmp=e.Xpm({type:h,selectors:[["wp-replacement-label"]],inputs:{fieldName:"fieldName"},ngContentSelectors:["*"],decls:2,vars:1,consts:[["tabindex","-1",1,"wp-replacement-label",3,"click"]],template:function(i,l){1&i&&(e.F$t(),e.TgZ(0,"span",0),e.NdJ("click",function(d){return l.activate(d)}),e.Hsn(1),e.qZA()),2&i&&e.uIk("data-qa-selector",l.fieldName)},encapsulation:2})},88156:(te,M,t)=>{"use strict";t.d(M,{Nm:()=>c,ag:()=>i,r1:()=>l});var n=t(3786),e=t(7812),p=t(44022),h=t(29161);const c="wp-table--cell-td",i="wp-table--cell-container";class l{constructor(d){this.injector=d,this.fieldRenderer=new e.uA(this.injector,"table")}build(d,f){const a=document.createElement("td"),m=f.id;a.classList.add(c,m),"subject"===m&&a.classList.add("-max");const v=this.schemaCache.of(d).ofProperty(m);v&&"User"===v.type&&a.classList.add("-contains-avatar");const C=document.createElement("span");C.classList.add(i,e.zZ,m);const u=this.fieldRenderer.render(d,m,null);return C.appendChild(u),a.appendChild(C),a}refresh(d,f,a){const m=this.fieldRenderer.render(f,a,null);d.innerHTML="",d.appendChild(m)}}(0,n.gn)([(0,h.W)(p.y),(0,n.w6)("design:type",p.y)],l.prototype,"schemaCache",void 0)},50076:(te,M,t)=>{"use strict";var n,e;t.d(M,{Z:()=>n}),(e=n||(n={})).backgroundClass=function(r,d){return`__hl_background_${r}_${d}`},e.inlineClass=function(r,d){return`__hl_inline_${r}_${d}`},e.colorClass=function(r,d){return r?`__hl_inline_color_${d}_text`:`__hl_inline_color_${d}_dot`},e.overdueDate=function(r){return 0===r?"__hl_date_due_today":r<=-1?"__hl_date_overdue":"__hl_date_not_overdue"},e.isBright=function(r,d,f){const a=`--hl-${d}-${f}-dark`;return""!==r.getPropertyValue(a)}},72875:(te,M,t)=>{"use strict";t.d(M,{t:()=>n,X:()=>e});const n={id:"__internal-sorthandle"},e={id:"__internal-contextMenu"}},72184:(te,M,t)=>{"use strict";t.d(M,{L:()=>r});var n=t(3786),e=t(29161),p=t(21680),h=t(43440),c=t(44022),i=t(60874),l=t(67749);class r extends p.i9{constructor(){super(...arguments),this.text={sum:this.I18n.t("js.label_sum")}}buildSumsRow(f){const a=document.createElement("tr");return a.classList.add("wp-table--sums-row","wp-table--row",(0,l.yZ)(f.index)),this.renderColumns(f.sums,a),a}renderColumns(f,a){this.augmentedColumns.forEach((m,v)=>{const C=document.createElement("td"),u=this.renderContent(f,m.id,this.sumsSchema[m.id]);0===v&&this.appendFirstLabel(u),C.appendChild(u),a.append(C)})}appendFirstLabel(f){const a=document.createElement("span");a.textContent=`${this.text.sum}`,a.title=`${this.text.sum}`,f.prepend(a)}get sumsSchema(){const a=this.querySpace.results.value.sumsSchema.href;return this.schemaCache.state(a).value}renderContent(f,a,m){const v=document.createElement("div");if(v.classList.add("wp-table--sum-container",a),!m)return v;const C=this.displayFieldService.getField(f,a,m,{injector:this.injector,container:"table",options:{}});return C.isEmpty()||C.render(v,C.valueString),v}}(0,n.gn)([(0,e.W)(),(0,n.w6)("design:type",h.q)],r.prototype,"querySpace",void 0),(0,n.gn)([(0,e.W)(),(0,n.w6)("design:type",c.y)],r.prototype,"schemaCache",void 0),(0,n.gn)([(0,e.W)(),(0,n.w6)("design:type",i.i)],r.prototype,"displayFieldService",void 0)},68130:(te,M,t)=>{"use strict";t.d(M,{u:()=>n,k:()=>e});const n="wp-table--group-header",e="-collapsed"},67749:(te,M,t)=>{"use strict";function n(l){let r=l.value||"nullValue";if(l.href)try{r+=l.href.map(d=>d.href).join("-")}catch(d){console.error(`Failed to extract group identifier for ${l.value}`)}return r=r.toLowerCase().replace(/[^a-z0-9]+/g,"-"),`${p(l)}-${r}`}function e(l){const{value:r}=l;return null===r?"-":r}function p(l){return l._links.groupBy.href.split("/").pop()}function h(l){return`__row-group-${l}`}function c(l){return l.split("-")[0]}function i(l){return l.split("-").pop()}t.d(M,{M4:()=>n,_n:()=>e,Ph:()=>p,yZ:()=>h,dF:()=>c,yD:()=>i})},67362:(te,M,t)=>{"use strict";t.d(M,{YZ:()=>l,On:()=>d,UT:()=>m});var n=t(3786),e=t(21680),p=t(87853),h=t(32030),c=t(99676),i=t(29161);const l="-hierarchy-collapsed",d="wp-table--hierarchy-aditional-row";class m extends e.i9{constructor(C,u){super(C,u),this.injector=C,this.workPackageTable=u,this.text={leaf:k=>this.I18n.t("js.work_packages.hierarchy.leaf",{level:k}),expanded:k=>this.I18n.t("js.work_packages.hierarchy.children_expanded",{level:k}),collapsed:k=>this.I18n.t("js.work_packages.hierarchy.children_collapsed",{level:k})}}refreshRow(C,u){const k=super.refreshRow(C,u);return k.find(".wp-table--hierarchy-span").remove(),this.appendHierarchyIndicator(C,k),k}buildEmpty(C){const[u,k]=super.buildEmpty(C),[x,b]=this.ancestorRowData(C);return u.classList.add(...x),this.appendHierarchyIndicator(C,jQuery(u)),[u,b]}ancestorRowData(C){const u=this.wpTableHierarchies.current,k=[];let x=!1;return this.parentsWithVisibleChildren[C.id]&&k.push((0,h.MO)(C.id)),_.isArray(C.ancestors)&&C.ancestors.forEach(b=>{k.push((0,h.oQ)(b.id)),u.collapsed[b.id]&&(x=!0,k.push((0,h.xU)(b.id)))}),[k,x]}buildAncestorRow(C,u,k){const x=this.states.workPackages.get(C.id).value,[b,y]=this.buildEmpty(x);return b.classList.add(d),[b,y]}appendHierarchyIndicator(C,u,k){const x=void 0===k?C.ancestors.length:k,b=this.buildHierarchyIndicator(C,u,x);u.find("td.subject").addClass("-with-hierarchy").prepend(b),u.find("td.subject").css("minWidth",125+20*x+"px"),u.find("td.subject .wp-table--cell-container").css("width",`calc(100% - 25px - ${20*x}px)`)}buildHierarchyIndicator(C,u,k){const x=document.createElement("span"),b=this.wpTableHierarchies.collapsed(C.id),y=25+20*k+"px";if(x.classList.add("wp-table--hierarchy-span"),x.style.width=y,x.dataset.indentation=y,this.parentsWithVisibleChildren[C.id]){const P=b?l:"";x.innerHTML=`\n            <a href tabindex="0" role="button" class="wp-table--hierarchy-indicator ${P}">\n              <span class="wp-table--hierarchy-indicator-icon" aria-hidden="true"></span>\n              <span class="wp-table--hierarchy-indicator-expanded hidden-for-sighted">${this.text.expanded(k)}</span>\n              <span class="wp-table--hierarchy-indicator-collapsed hidden-for-sighted">${this.text.collapsed(k)}</span>\n            </a>\n        `}else x.innerHTML=`\n            <span tabindex="0" class="wp-table--leaf-indicator">\n              <span class="hidden-for-sighted">${this.text.leaf(k)}</span>\n            </span>\n        `;return x}}(0,n.gn)([(0,i.W)(),(0,n.w6)("design:type",c.Y)],m.prototype,"wpTableHierarchies",void 0),(0,n.gn)([(0,i.W)(),(0,n.w6)("design:type",p.G)],m.prototype,"states",void 0)},33791:(te,M,t)=>{"use strict";t.d(M,{OR:()=>l,_M:()=>r,Lp:()=>d});var n=t(3786),e=t(41195),p=t(29161),h=t(87853),c=t(53457),i=t(88156);const l="wp-table--relation-cell-td",r="wp-table--relation-indicator";class d{constructor(a){this.injector=a}build(a,m){const v=document.createElement("td");v.classList.add(i.Nm,l,m.id),v.dataset.columnId=m.id;const C=this.wpTableRelationColumns.getExpandFor(a.id)===m.id,u=this.wpRelations.state(a.id).value,k=this.wpTableRelationColumns.relationsForColumn(a,u,m),x=this.renderIndicator(),b=this.renderBadge(k);return C&&v.classList.add("-expanded"),k.length>0&&(v.appendChild(b),v.appendChild(x)),v}renderIndicator(){const a=document.createElement("span");return a.classList.add(r),a.setAttribute("aria-hidden","true"),a.setAttribute("tabindex","0"),a}renderBadge(a){const m=document.createElement("span");return m.classList.add("wp-table--relation-count"),m.textContent=`${a.length}`,m.classList.add("badge","-border-only"),m}}(0,n.gn)([(0,p.W)(),(0,n.w6)("design:type",h.G)],d.prototype,"states",void 0),(0,n.gn)([(0,p.W)(),(0,n.w6)("design:type",c.V)],d.prototype,"wpRelations",void 0),(0,n.gn)([(0,p.W)(),(0,n.w6)("design:type",e.a)],d.prototype,"wpTableRelationColumns",void 0)},21680:(te,M,t)=>{"use strict";t.d(M,{i9:()=>b,HE:()=>x,S:()=>k});var n=t(3786),e=t(96617),p=t(99919),h=t(71562),c=t(93903),i=t(85003),l=t(72875),r=t(29161),d=t(88156);class f{constructor(P){this.injector=P}build(P){const E=document.createElement("td");E.classList.add(d.Nm,i.oE,l.X.id,"hide-when-print");const T=document.createElement("span");return T.classList.add(i.K$),this.tableActionsService.render(P).forEach(O=>{T.appendChild(O)}),E.appendChild(T),E}}(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",c.j)],f.prototype,"tableActionsService",void 0);var a=t(60914),m=t(3352),v=t(20506),C=t(33791),u=t(70319);const k="wp-table--row",x="wp--row";class b{constructor(P,E){this.injector=P,this.workPackageTable=E,this.cellBuilder=new d.r1(this.injector),this.relationCellBuilder=new C.Lp(this.injector),this.contextLinkBuilder=new f(this.injector),this.augmentedColumns=this.buildAugmentedColumns()}get columns(){return this.wpTableColumns.getColumns()}buildAugmentedColumns(){const P=[...this.columns,l.X];return this.workPackageTable.configuration.dragAndDropEnabled&&P.unshift(l.t),P}buildCell(P,E){if((0,u.q)(E))return this.relationCellBuilder.build(P,E);switch(E.id){case l.X.id:if(this.workPackageTable.configuration.actionsColumnEnabled)return this.contextLinkBuilder.build(P);if(this.workPackageTable.configuration.columnMenuEnabled){const T=document.createElement("td");return T.classList.add("hide-when-print"),T}return null;default:return this.cellBuilder.build(P,E)}}buildEmpty(P){const E=this.createEmptyRow(P);return this.buildEmptyRow(P,E)}createEmptyRow(P){const E=this.classIdentifier(P),T=document.createElement("tr");return T.setAttribute("tabindex","0"),T.dataset.workPackageId=P.id,T.dataset.classIdentifier=E,T.classList.add(k,x,E,`${E}-table`,"issue"),T}get placeholderRow(){const P=document.createElement("tr"),E=document.createElement("td");return P.classList.add("wp--placeholder-row"),E.colSpan=this.augmentedColumns.length,P.appendChild(E),P}classIdentifier(P){return`wp-row-${P.id}`}refreshRow(P,E){const T=E.find(`.${d.Nm}`).detach(),O=[];return this.augmentedColumns.forEach(I=>{const Z=T.filter(`td.${I.id}`);if((I.id.startsWith("__internal")||this.isColumnBeingEdited(P,I))&&Z.length)return void O.push(Z[0]);const j=this.buildCell(P,I);j&&O.push(j)}),E.prepend(O),E}isColumnBeingEdited(P,E){const T=this.workPackageTable.editing.forms[P.id];return T&&T.activeFields[E.id]}buildEmptyRow(P,E){const T=this.workPackageTable.editing.change(P),O={};if(T&&!T.isEmpty()){const I=(0,p.ay)(this.classIdentifier(P));T.changedAttributes.forEach(Z=>{O[Z]=I.find(`.${d.Nm}.${Z}`)})}return this.augmentedColumns.forEach(I=>{let Z;const j=O[I.id];j&&j.length?((0,m.qu)(`Rendering previous open column ${I.id} on ${P.id}`),jQuery(E).append(j)):(Z=this.buildCell(P,I),Z&&E.appendChild(Z))}),this.wpTableSelection.isSelected(P.id)&&E.classList.add(v.HZ),[E,!1]}}(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",a.J)],b.prototype,"wpTableSelection",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",h.i)],b.prototype,"wpTableColumns",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",e.D)],b.prototype,"I18n",void 0)},77850:(te,M,t)=>{"use strict";t.d(M,{j:()=>i,v:()=>l});var n=t(3786),e=t(87853),p=t(73165),h=t(29161),c=t(21680);const i="wp-timeline-cell";class l{constructor(d,f){this.injector=d,this.workPackageTable=f}build(d){const f=document.createElement("div");return f.classList.add(i,c.HE),d&&(f.dataset.workPackageId=d),f}insert(d,f,a=[]){const m=this.build(d);m.classList.add(...a),f.appendChild(m)}}(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",e.G)],l.prototype,"states",void 0),(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",p.W)],l.prototype,"wpTableTimeline",void 0)},20506:(te,M,t)=>{"use strict";t.d(M,{yF:()=>n,HZ:()=>e,mE:()=>p});const n="__ui-state-link",e="-checked";class p{constructor(c,i){this.$state=c,this.keepTab=i}linkToDetails(c,i,l){return this.build(c,"split",i,l)}linkToShow(c,i,l){return this.build(c,"show",i,l)}build(c,i,l,r){const d=document.createElement("a");let f,a;return"show"===i?(f="work-packages.show.tabs",a=this.keepTab.currentShowTab):(f="work-packages.partitioned.list.details.tabs",a=this.keepTab.currentDetailsTab),d.href=this.$state.href(f,{workPackageId:c,tabIdentifier:a}),d.classList.add(n),d.dataset.workPackageId=c,d.dataset.wpState=i,d.setAttribute("title",l),d.textContent=r,d}}},52787:(te,M,t)=>{"use strict";t.d(M,{S:()=>e,X:()=>p});var n=t(33406);function e(h,c){return"click"!==h.type&&("keydown"!==h.type||h.which!==n.m.ENTER)||(c(),!1)}class p{handleEvent(c,i){e(i,()=>this.processEvent(c.workPackageTable,i))}}},32030:(te,M,t)=>{"use strict";function n(c=""){return`__collapsed-group-${c}`}function e(c){return`__hierarchy-group-${c}`}function p(c){return`__hierarchy-root-${c}`}function h(c){return`wp-ancestor-row-${c}`}t.d(M,{xU:()=>n,oQ:()=>e,MO:()=>p,Mh:()=>h})},99919:(te,M,t)=>{"use strict";t.d(M,{is:()=>e,gx:()=>p,Fb:()=>h,ay:()=>c,_D:()=>i,hK:()=>l,Ui:()=>r});var n=t(32030);function e(d){return`wp-row-${d}-table`}function p(){return"wp-table--relations-aditional-row"}function h(d){return jQuery(`.${e(d)}`)}function c(d){return jQuery(`.${d}-table`)}function i(d){return!!d&&null!=Array.from(d.classList).find(f=>f.includes((0,n.xU)()))}function l(d,f){let a=d.previousElementSibling;for(;a;){if(a.matches(f))return a;a=a.previousElementSibling}return null}function r(d){try{const f=h(d),a=f.scrollParent(),m=a.scrollTop(),v=m+a.height(),C=f[0].offsetTop,u=C+f.height();C<m?a[0].scrollTop=C:u>v&&(a[0].scrollTop=u-a.height())}catch(f){console.warn(`Can't scroll row element into view: ${f}`)}}},55054:(te,M,t)=>{"use strict";t.d(M,{t:()=>ot});var n=t(3786),e=t(96617),p=t(43440),h=t(87853),c=t(29161),i=t(33276),l=t(79174),r=t(3352),d=t(68130),f=t(71562),a=t(21680);class m{constructor(he,ye){this.injector=he,this.workPackageTable=ye}isApplicable(he){return!0}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.G)],m.prototype,"states",void 0);var v=t(67749);function C(st){return`group-${st.identifier}`}class u{constructor(he){this.injector=he,this.text={collapse:this.I18n.t("js.label_collapse"),expand:this.I18n.t("js.label_expand")}}buildGroupRow(he,ye){const xe=document.createElement("tr");let De,Qe;return he.collapsed?(Qe=this.text.expand,De="icon-plus"):(Qe=this.text.collapse,De="icon-minus2"),xe.classList.add(d.u,C(he)),xe.id=`wp-table-rowgroup-${he.index}`,xe.dataset.groupIndex=he.index.toString(),xe.dataset.groupIdentifier=he.identifier,xe.innerHTML=`\n      <td colspan="${ye}" class="-no-highlighting">\n        <div class="expander icon-context ${De}">\n          <span class="hidden-for-sighted">${_.escape(Qe)}</span>\n        </div>\n        <div class="group--value" data-qa-selector="op-group--value">\n          ${_.escape((0,v._n)(he))}\n          <span class="count">\n            (${he.count})\n          </span>\n        </div>\n      </td>\n    `,xe}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",e.D)],u.prototype,"I18n",void 0);var k=t(72184),x=t(12703),b=t(84897),y=t(50076);class P{constructor(he,ye,xe){this.injector=he,this.table=ye,this.tablePass=xe}render(){if(!this.isApplicable)return;const he=this.wpTableHighlighting.current.mode;window.getComputedStyle(document.body);this.tablePass.renderedOrder.forEach((xe,De)=>{if(!xe.workPackage)return;const Qe=xe.workPackage[he];if(!Qe)return;const Ve=Qe.id;this.tablePass.tableBody.children[De].classList.add(y.Z.backgroundClass(he,Ve))})}get isApplicable(){return!(this.wpTableHighlighting.isInline||this.wpTableHighlighting.isDisabled)}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",b.B)],P.prototype,"wpTableHighlighting",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",p.q)],P.prototype,"querySpace",void 0);var E=t(88156),T=t(16451),O=t(72875);class Z{constructor(he){this.injector=he;const ye=this.injector.get(T.B);this.actionService=ye.get(he)}build(he,ye){const xe=document.createElement("td");if(xe.classList.add(E.Nm,O.t.id),!this.actionService.canPickup(he))return xe;xe.classList.add("wp-table--sort-td",O.t.id,"hide-when-print");const De=document.createElement("span");return De.classList.add("wp-table--drag-and-drop-handle","icon-drag-handle"),xe.appendChild(De),xe}}var j=t(95846);class B{constructor(he,ye,xe){this.injector=he,this.table=ye,this.tablePass=xe,this.dragDropHandleBuilder=new Z(this.injector)}render(){!this.table.configuration.dragAndDropEnabled||this.wpTableOrder.withLoadedPositions().then(he=>{this.tablePass.renderedOrder.forEach((ye,xe)=>{if(!ye.workPackage||"relations"===ye.renderType)return;const De=this.dragDropHandleBuilder.build(ye.workPackage,he[ye.workPackage.id]);De&&ye.element.replaceChild(De,ye.element.firstElementChild)})})}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",f.i)],B.prototype,"wpTableColumns",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",j.M)],B.prototype,"wpTableOrder",void 0);var J=t(77850);class R{constructor(he,ye,xe){this.injector=he,this.table=ye,this.tablePass=xe}render(){this.timelineBody=document.createDocumentFragment(),this.timelineBuilder=new J.v(this.injector,this.table),this.tablePass.renderedOrder.forEach(he=>{const ye=he.workPackage?he.workPackage.id:null,xe=this.timelineBuilder.build(ye);xe.classList.add(he.classIdentifier,`${he.classIdentifier}-timeline`,...he.additionalClasses),this.timelineBody.appendChild(xe)})}}var F=t(53457),Y=t(41195),X=t(70319);function K(st){return`__relations-expanded-from-${st}`}const H="wp-table--relation-cell-td";class ee extends a.i9{constructor(he,ye){super(he,ye),this.injector=he,this.workPackageTable=ye}buildCell(he,ye){return(0,X.q)(ye)?this.emptyRelationCell(ye):super.buildCell(he,ye)}buildEmptyRelationRow(he,ye,xe){const De=ye.denormalized(he),Qe=this.states.workPackages.get(De.targetId).value,Ve=this.createEmptyRelationRow(he,Qe),[nt,mt]=super.buildEmptyRow(Qe,Ve);return[nt,Qe]}createEmptyRelationRow(he,ye){const xe=this.relationClassIdentifier(he,ye),De=document.createElement("tr");return De.dataset.workPackageId=ye.id,De.dataset.classIdentifier=xe,De.classList.add(a.HE,a.S,"issue","wp-table--relations-aditional-row",xe,`${xe}-table`,K(he.id)),De}relationClassIdentifier(he,ye){return function(st,he){return`wp-relation-row-${he}-to-${st}`}(ye.id,he.id)}appendRelationLabel(he,ye,xe,De,Qe){const Ve=xe.denormalized(ye);let nt="";"toType"===Qe&&(nt=this.I18n.t(`js.relation_labels.${Ve.reverseRelationType}`)),"ofType"===Qe&&(nt=this.states.workPackages.get(Ve.target.id).value.type.name);const mt=document.createElement("span");mt.classList.add("relation-row--type-label"),mt.textContent=nt;document.createTextNode(Ve.target.name);he.find(`.${H}`).empty(),he.find(`.${H}.${De}`).append(mt)}emptyRelationCell(he){const ye=document.createElement("td");return ye.classList.add(H,E.Nm,he.id),ye}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.G)],ee.prototype,"states",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",e.D)],ee.prototype,"I18n",void 0);class ce{constructor(he,ye,xe){this.injector=he,this.table=ye,this.tablePass=xe,this.relationRowBuilder=new ee(he,ye)}render(){this.isApplicable&&_.clone(this.tablePass.renderedOrder).forEach((ye,xe)=>{if(!ye.workPackage)return;const{workPackage:De}=ye,Qe=De.id,Ve=this.wpRelations.state(Qe);!Ve.hasValue()||0===_.size(Ve.value)||this.wpTableRelationColumns.relationsToExtendFor(De,Ve.value,(nt,mt,Ue)=>{const[Fe,Te]=this.relationRowBuilder.buildEmptyRelationRow(De,nt,Ue);Fe.classList.add(...ye.additionalClasses),this.relationRowBuilder.appendRelationLabel(jQuery(Fe),De,nt,mt.id,Ue),this.tablePass.spliceRow(Fe,`.${this.relationRowBuilder.classIdentifier(De)},.${K(Qe)}`,{classIdentifier:this.relationRowBuilder.relationClassIdentifier(De,Te),additionalClasses:ye.additionalClasses.concat(["wp-table--relations-aditional-row"]),workPackage:Te,belongsTo:De,renderType:"relations",hidden:ye.hidden,data:{relation:nt,columnId:mt.id,relationType:Ue}})})})}refreshRelationRow(he,ye,xe){const De=this.relationRowBuilder.refreshRow(ye,xe);return this.relationRowBuilder.appendRelationLabel(De,he.belongsTo,he.data.relation,he.data.columnId,he.data.relationType),De}get isApplicable(){return this.wpTableColumns.hasRelationColumns()}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",F.V)],ce.prototype,"wpRelations",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",f.i)],ce.prototype,"wpTableColumns",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",Y.a)],ce.prototype,"wpTableRelationColumns",void 0);class se{constructor(he,ye,xe){this.injector=he,this.workPackageTable=ye,this.rowBuilder=xe}render(){return(0,r.IN)("Primary render pass",()=>{this.prepare(),this.doRender(),this.postRender()}),this.highlighting.render(),(0,r.IN)("Relations render pass",()=>{this.relations.render()}),(0,r.IN)("Drag handle render pass",()=>{this.dragDropHandle.render()}),(0,r.IN)("Timelines render pass",()=>{this.timeline.render()}),this}refresh(he,ye,xe){const De=jQuery(xe).find(`.${he.classIdentifier}`);let Qe=null;switch(he.renderType){case"primary":Qe=this.rowBuilder.refreshRow(ye,De);break;case"relations":Qe=this.relations.refreshRelationRow(he,ye,De)}null!==Qe&&De.length&&De.replaceWith(Qe)}get result(){return this.renderedOrder.map(he=>({classIdentifier:he.classIdentifier,workPackageId:he.workPackage?he.workPackage.id:null,hidden:he.hidden}))}spliceRow(he,ye,xe){const De=jQuery(this.tableBody).find(ye).last();De.after(he);const Qe=De.index();this.renderedOrder.splice(Qe+1,0,xe)}prepare(){this.timeline=new R(this.injector,this.workPackageTable,this),this.relations=new ce(this.injector,this.workPackageTable,this),this.dragDropHandle=new B(this.injector,this.workPackageTable,this),this.highlighting=new P(this.injector,this.workPackageTable,this),this.tableBody=document.createDocumentFragment(),this.renderedOrder=[]}postRender(){0===this.renderedOrder.length&&this.workPackageTable.renderPlaceholderRow&&this.tableBody.appendChild(this.rowBuilder.placeholderRow)}appendRow(he,ye,xe=[],De=!1){this.tableBody.appendChild(ye),this.renderedOrder.push({classIdentifier:this.rowBuilder.classIdentifier(he),additionalClasses:xe,workPackage:he,renderType:"primary",element:ye,hidden:De})}appendNonWorkPackageRow(he,ye,xe=[],De=!1){he.classList.add(ye),this.tableBody.appendChild(he),this.renderedOrder.push({element:he,classIdentifier:ye,additionalClasses:xe,workPackage:null,renderType:"primary",hidden:De})}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",x.l)],se.prototype,"halEditing",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.G)],se.prototype,"states",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",e.D)],se.prototype,"I18n",void 0);class re extends se{constructor(he,ye,xe){super(he,ye,xe),this.injector=he,this.workPackageTable=ye,this.rowBuilder=xe}doRender(){this.workPackageTable.originalRows.forEach(he=>{const ye=this.workPackageTable.originalRowIndex[he],[xe]=this.rowBuilder.buildEmpty(ye.object);ye.element=xe,this.appendRow(ye.object,xe),this.tableBody.appendChild(xe)})}}class Ae extends re{constructor(he,ye,xe,De,Qe){super(he,ye,new a.i9(he,ye)),this.injector=he,this.workPackageTable=ye,this.groups=xe,this.headerBuilder=De,this.colspan=Qe,this.sumsBuilder=new k.L(this.injector,this.workPackageTable)}doRender(){let he=null;const{length:ye}=this.workPackageTable.originalRows;this.workPackageTable.originalRows.forEach((xe,De)=>{const Qe=this.workPackageTable.originalRowIndex[xe],Ve=this.matchingGroup(Qe.object),nt=he!==Ve;if(he&&nt&&this.renderSumsRow(he),Ve&&nt){const mt=C(Ve),Ue=this.headerBuilder.buildGroupRow(Ve,this.colspan);this.appendNonWorkPackageRow(Ue,mt,["-group-row"]),he=Ve}Qe.group=he,this.buildSingleRow(Qe)}),he&&this.renderSumsRow(he)}matchingGroup(he){return _.find(this.groups,ye=>{let xe=he[(0,v.Ph)(ye)];if(void 0===xe&&(xe=null),_.isArray(xe))return this.matchesMultiValue(xe,ye);if(xe&&xe.href)return!!_.find(ye._links.valueLink,Qe=>xe.href===Qe.href);let De=""===ye.value?null:ye.value;return De&&"string"==typeof De&&(De=De.replace("%","")),De==xe})}matchesMultiValue(he,ye){if(he.length!==ye.href.length)return!1;const xe=De=>_.map(De,Qe=>Qe.href).sort().join(", ");return _.isEqualWith(he,ye.href,(De,Qe)=>xe(De)===xe(Qe))}buildSingleRow(he){const{group:ye}=he;ye||console.warn("All rows should have a group, but this one doesn't %O",he);let xe=!1;const De=[],[Qe,Ve]=this.rowBuilder.buildEmpty(he.object);ye&&(De.push((0,v.yZ)(ye.index)),xe=!!ye.collapsed,xe&&De.push(d.k)),he.element=Qe,Qe.classList.add(...De),this.appendRow(he.object,Qe,De,xe)}renderSumsRow(he){if(!he.sums)return;const ye=C(he),xe=this.sumsBuilder.buildSumsRow(he);this.appendNonWorkPackageRow(xe,ye)}}class Ye extends m{constructor(he,ye){super(he,ye),this.injector=he}isApplicable(he){return!_.isEmpty(this.groups)}get groups(){return this.querySpace.groups.value||[]}get collapsedGroups(){return this.querySpace.collapsedGroups.value||{}}get colspan(){return this.wpTableColumns.columnCount+2}buildRows(){const he=new u(this.injector);return new Ae(this.injector,this.workPackageTable,this.getGroupData(),he,this.colspan).render()}refreshExpansionState(){const he=this.getGroupData(),ye=this.querySpace.tableRendered.value,xe=new u(this.injector);jQuery(this.workPackageTable.tableAndTimelineContainer).find(`.${d.u}`).each((De,Qe)=>{const Ve=jQuery(Qe).data("groupIndex"),nt=he[Ve],mt=xe.buildGroupRow(nt,this.colspan);Qe.parentNode&&Qe.parentNode.replaceChild(mt,Qe);const Ue=jQuery(this.workPackageTable.tableAndTimelineContainer).find(`.${(0,v.yZ)(Ve)}`);Ue.toggleClass(d.k,!!nt.collapsed),Ue.filter(`.${a.S}`).each((Fe,Te)=>{const tt=jQuery(Te).index();ye[tt].hidden=!!nt.collapsed})}),this.querySpace.tableRendered.putValue(ye,"Updated hidden state of rows after group change.")}getGroupData(){return this.groups.map((he,ye)=>(he.index=ye,he._links&&he._links.valueLink&&(he.href=he._links.valueLink),he.identifier=(0,v.M4)(he),he.collapsed=this.collapsedGroups[he.identifier],he))}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",p.q)],Ye.prototype,"querySpace",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.G)],Ye.prototype,"states",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",f.i)],Ye.prototype,"wpTableColumns",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",e.D)],Ye.prototype,"I18n",void 0);var ze=t(99676),Xe=t(32030),it=t(67362);class at extends se{constructor(he,ye,xe){super(he,ye,xe),this.injector=he,this.workPackageTable=ye,this.rowBuilder=xe,this.rendered={},this.additionalParents={},this.deferred={},this.parentsWithVisibleChildren={}}prepare(){super.prepare(),this.hierarchies=this.wpTableHierarchies.current,_.each(this.workPackageTable.originalRowIndex,he=>{he.object.ancestors.forEach(ye=>{this.parentsWithVisibleChildren[ye.id]=!0})}),this.rowBuilder.parentsWithVisibleChildren=this.parentsWithVisibleChildren}doRender(){this.workPackageTable.originalRows.forEach(he=>{const ye=this.workPackageTable.originalRowIndex[he],xe=ye.object;if(!this.deferInsertion(xe)){if(xe.ancestors.length)this.buildWithHierarchy(ye);else{const[De,Qe]=this.rowBuilder.buildEmpty(xe);ye.element=De,this.tableBody.appendChild(De),this.markRendered(De,xe,Qe)}this.renderAllDeferredChildren(xe)}})}deferInsertion(he){const{ancestors:ye}=he;if(0===ye.length)return!1;const xe=ye.concat([he]);for(let De=xe.length-2;De>=0;--De){const Qe=xe[De],Ve=this.workPackageTable.originalRowIndex[Qe.id];if(this.rendered[Qe.id])return!1;if(Ve){let mt=this.deferred[Qe.id]||[],Ue=xe.slice(De+1,xe.length);return Ue=Ue.map(Fe=>this.apiV3Service.work_packages.cache.state(Fe.id).value),mt=mt.concat(Ue),this.deferred[Qe.id]=_.uniqBy(mt,Fe=>Fe.id),!0}}return!1}renderAllDeferredChildren(he){const ye=he.id;(this.deferred[ye]||[]).forEach(De=>{this.insertUnderParent(this.getOrBuildRow(De),De.parent||he),this.renderAllDeferredChildren(De)})}getOrBuildRow(he){let ye=this.workPackageTable.originalRowIndex[he.id];return ye||(ye={object:he}),ye}buildWithHierarchy(he){const{ancestors:ye}=he.object,xe=[];ye.forEach((Qe,Ve)=>{const nt=this.states.workPackages.get(Qe.id).getValueOr(Qe);if(!this.rendered[nt.id]){const[mt,Ue]=this.rowBuilder.buildAncestorRow(nt,xe,Ve);if(0===Ve)this.tableBody.appendChild(mt),this.markRendered(mt,nt,Ue,!0);else{const Fe=ye[Ve-1];this.insertAtExistingHierarchy(nt,mt,Fe,Ue,!0)}this.additionalParents[nt.id]=nt}xe.push((0,Xe.oQ)(nt.id)),ye.slice(0,Ve).forEach(mt=>{xe.push((0,Xe.oQ)(mt.id))})});const De=_.last(ye);this.insertUnderParent(he,De)}insertUnderParent(he,ye){const[xe,De]=this.rowBuilder.buildEmpty(he.object);he.element=xe,this.insertAtExistingHierarchy(he.object,xe,ye,De,!1)}markRendered(he,ye,xe=!1,De=!1){this.rendered[ye.id]=!0,this.renderedOrder.push(this.buildRenderInfo(he,ye,xe,De))}insertAtExistingHierarchy(he,ye,xe,De,Qe){const Ve=`.__hierarchy-root-${xe.id}`,nt=`.__hierarchy-group-${xe.id}`;this.spliceRow(ye,`${Ve},${nt}`,this.buildRenderInfo(ye,he,De,Qe)),this.rendered[he.id]=!0}buildRenderInfo(he,ye,xe,De){const Qe={element:he,classIdentifier:"",additionalClasses:[],workPackage:ye,renderType:"primary",hidden:xe},[Ve,nt]=this.rowBuilder.ancestorRowData(ye);return De?(Qe.additionalClasses=[it.On].concat(Ve),Qe.classIdentifier=(0,Xe.Mh)(ye.id)):(Qe.additionalClasses=Ve,Qe.classIdentifier=this.rowBuilder.classIdentifier(ye)),Qe}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",p.q)],at.prototype,"querySpace",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.G)],at.prototype,"states",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",i.T)],at.prototype,"apiV3Service",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",ze.Y)],at.prototype,"wpTableHierarchies",void 0);class lt extends m{constructor(he,ye){super(he,ye),this.injector=he,this.workPackageTable=ye}isApplicable(he){return this.wpTableHierarchies.isEnabled}buildRows(){const he=new it.UT(this.injector,this.workPackageTable);return new at(this.injector,this.workPackageTable,he).render()}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.G)],lt.prototype,"states",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",f.i)],lt.prototype,"wpTableColumns",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",ze.Y)],lt.prototype,"wpTableHierarchies",void 0);class dt extends m{constructor(he,ye){super(he,ye),this.injector=he}buildRows(){const he=new a.i9(this.injector,this.workPackageTable);return new re(this.injector,this.workPackageTable,he).render()}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",e.D)],dt.prototype,"I18n",void 0);var de=t(7101),oe=t(37048),D=t(91260),G=t(18322);class $ extends D.Py{constructor(he,ye,xe,De){super(he),this.injector=he,this.table=ye,this.workPackageId=xe,this.classIdentifier=De,this.cellBuilder=new E.r1(this.injector),this.resourceSubscription=this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().subscribe(Qe=>this.resource=Qe)}destroy(){this.resourceSubscription.unsubscribe()}findContainer(he){return this.rowContainer.find(`.${E.Nm}.${he} .${E.ag}`).first()}findCell(he){return this.rowContainer.find(`.${E.Nm}.${he}`).first()}activateField(he,ye,xe,De){return this.waitForContainer(xe).then(Qe=>{const Ve=this.findCell(xe);Ve.addClass(G.sS);let nt=parseInt(Ve.css("width"));return nt=nt>150?nt-10:150,Ve.css("max-width",`${nt}px`),Ve.css("width",`${nt}px`),this.editingPortalService.create(Qe,this.injector,he,ye,xe,De)})}reset(he,ye){const xe=this.findContainer(he),De=this.findCell(he);xe.length&&(this.findCell(he).css("width",""),this.findCell(he).css("max-width",""),this.cellBuilder.refresh(xe[0],this.resource,he),De.removeClass(G.sS),ye&&this.FocusHelper.focus(xe[0]))}requireVisible(he){return this.wpTableColumns.addColumn(he),this.waitForContainer(he)}focusOnFirstError(){jQuery(this.table.tableAndTimelineContainer).find(".inline-edit--active-field.-error .inline-edit--field").first().trigger("focus")}loadFieldSchema(he,ye=!1){return["startDate","dueDate","date"].includes(he)&&(he="combinedDate"),super.loadFieldSchema(he,ye)}waitForContainer(he){return new Promise((ye,xe)=>{const De=setInterval(()=>{const Qe=this.findContainer(he);Qe.length>0&&(clearInterval(De),ye(Qe[0]))},100)})}get rowContainer(){return jQuery(this.table.tableAndTimelineContainer).find(`.${this.classIdentifier}-table`)}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",f.i)],$.prototype,"wpTableColumns",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",i.T)],$.prototype,"apiV3Service",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.G)],$.prototype,"states",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",de.i)],$.prototype,"FocusHelper",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",oe.b)],$.prototype,"editingPortalService",void 0);class Se{constructor(he,ye){this.table=he,this.injector=ye,this.forms={}}reset(){_.each(this.forms,he=>he.destroy()),this.forms={}}change(he){return this.halEditing.typedState(he).value}stopEditing(he){this.halEditing.stopEditing(he);const ye=this.forms[he.id];ye&&(ye.destroy(),delete this.forms[he.id])}startEditing(he,ye){const xe=he.id;return this.forms[xe]||(this.forms[xe]=new $(this.injector,this.table,xe,ye))}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",x.l)],Se.prototype,"halEditing",void 0);class ot{constructor(he,ye,xe,De,Qe,Ve,nt){this.injector=he,this.tableAndTimelineContainer=ye,this.scrollContainer=xe,this.tbody=De,this.timelineBody=Qe,this.timelineController=Ve,this.configuration=nt,this.originalRows=[],this.originalRowIndex={},this.hierarchyRowsBuilder=new lt(this.injector,this),this.groupedRowsBuilder=new Ye(this.injector,this),this.plainRowsBuilder=new dt(this.injector,this),this.builders=[this.hierarchyRowsBuilder,this.groupedRowsBuilder,this.plainRowsBuilder],this.lastRenderPass=null,this.editing=new Se(this,this.injector)}get renderedRows(){return this.querySpace.tableRendered.getValueOr([])}findRenderedRow(he){const ye=_.findIndex(this.renderedRows,xe=>xe.classIdentifier===he);return[ye,this.renderedRows[ye]]}get rowBuilder(){return _.find(this.builders,he=>he.isApplicable(this))}buildIndex(he){this.originalRowIndex={},this.originalRows=he.map((ye,xe)=>{const De=ye.id;return ye=this.apiV3Service.work_packages.cache.current(De,ye),this.originalRowIndex[De]={object:ye,workPackageId:De,position:xe},De})}initialSetup(he){this.buildIndex(he),this.redrawTableAndTimeline()}redrawTableAndTimeline(){const he=this.performRenderPass(!1);requestAnimationFrame(()=>{this.tbody.innerHTML="",this.timelineBody.innerHTML="",this.tbody.appendChild(he.tableBody),this.timelineBody.appendChild(he.timeline.timelineBody),setTimeout(()=>this.querySpace.tableRendered.putValue(he.result))})}redrawTable(){const he=this.performRenderPass();this.querySpace.tableRendered.putValue(he.result)}refreshRows(he){const ye=this.lastRenderPass;ye?_.each(ye.renderedOrder,xe=>{xe.workPackage&&xe.workPackage.id===he.id&&((0,r.qu)(`Refreshing rendered row ${xe.classIdentifier}`),xe.workPackage=he,ye.refresh(xe,he,this.tbody))}):(0,r.qu)("Trying to refresh a singular row without a previous render pass.")}get renderPlaceholderRow(){return this.configuration.dragAndDropEnabled}performRenderPass(he=!0){this.editing.reset();const ye=this.lastRenderPass=this.rowBuilder.buildRows();return he&&requestAnimationFrame(()=>{this.tbody.innerHTML="",this.tbody.appendChild(ye.tableBody)}),ye}setGroupsCollapseState(he){this.querySpace.collapsedGroups.putValue(he);const ye=performance.now();this.groupedRowsBuilder.refreshExpansionState();const xe=performance.now();(0,r.qu)(`Group redraw took ${xe-ye} milliseconds.`)}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",p.q)],ot.prototype,"querySpace",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",i.T)],ot.prototype,"apiV3Service",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.G)],ot.prototype,"states",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",e.D)],ot.prototype,"I18n",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",l.q)],ot.prototype,"workPackageViewCollapsedGroupsService",void 0)},88923:(te,M,t)=>{"use strict";t.d(M,{b:()=>C});var n=t(2316),e=t(84897),p=t(82763),h=t(22663),c=t(83720),i=t(43440),l=t(45237),r=t(79460),d=t(61043),f=t(91488),a=t(54364),m=t(87947);function v(u,k){if(1&u&&(n.TgZ(0,"div",2),n._UZ(1,"wp-resizer",3),n.qZA()),2&u){const x=n.oxw();n.xp6(1),n.Q6J("elementClass",x.resizerClass)("localStorageKey",x.resizerStorageKey)}}class C{constructor(k,x,b,y,P){this.wpTableHighlight=k,this.wpTableSortBy=x,this.wpList=b,this.querySpace=y,this.cdRef=P,this.showResizer=!1,this.resizerClass="",this.resizerStorageKey="",this.selectionChanged=new n.vpe,this.itemClicked=new n.vpe,this.stateLinkClicked=new n.vpe,this.gridOrientation="horizontal",this.highlightingMode="none"}ngOnInit(){this.dragInto=this.configuration.dragAndDropEnabled,this.canDragOutOf=()=>this.configuration.dragAndDropEnabled,this.wpTableHighlight.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,c.x)()).subscribe(()=>{this.highlightingMode=this.wpTableHighlight.current.mode,this.cdRef.detectChanges()})}switchToManualSorting(){const k=this.querySpace.query.value;k&&this.wpTableSortBy.switchToManualSorting(k)&&this.wpList.createOrSave(k)}}C.\u0275fac=function(k){return new(k||C)(n.Y36(e.B),n.Y36(p.q),n.Y36(d.Z),n.Y36(i.q),n.Y36(n.sBO))},C.\u0275cmp=n.Xpm({type:C,selectors:[["wp-grid"]],inputs:{configuration:"configuration",showResizer:"showResizer",resizerClass:"resizerClass",resizerStorageKey:"resizerStorageKey"},outputs:{selectionChanged:"selectionChanged",itemClicked:"itemClicked",stateLinkClicked:"stateLinkClicked"},features:[n._Bn([l.j,r.q])],decls:2,vars:10,consts:[[3,"dragOutOfHandler","dragInto","cardsRemovable","highlightingMode","showStatusButton","orientation","showEmptyResultsBox","showInfoButton","shrinkOnMobile","onMoved","selectionChanged","itemClicked","stateLinkClicked"],["class","hidden-for-mobile hide-when-print",4,"ngIf"],[1,"hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"]],template:function(k,x){1&k&&(n.TgZ(0,"wp-card-view",0),n.NdJ("onMoved",function(){return x.switchToManualSorting()})("selectionChanged",function(y){return x.selectionChanged.emit(y)})("itemClicked",function(y){return x.itemClicked.emit(y)})("stateLinkClicked",function(y){return x.stateLinkClicked.emit(y)}),n.qZA(),n.YNc(1,v,2,2,"div",1)),2&k&&(n.Q6J("dragOutOfHandler",x.canDragOutOf)("dragInto",x.dragInto)("cardsRemovable",!1)("highlightingMode",x.highlightingMode)("showStatusButton",!0)("orientation",x.gridOrientation)("showEmptyResultsBox",!0)("showInfoButton",!0)("shrinkOnMobile",!0),n.xp6(1),n.Q6J("ngIf",x.showResizer))},directives:[f.x,a.O5,m.H],encapsulation:2,changeDetection:0})},84366:(te,M,t)=>{"use strict";t.d(M,{I:()=>ee});var n=t(2316),e=t(7493),p=t(48451),h=t(9170),c=t(43440),i=t(96617),l=t(8403),r=t(61486),d=t(71562),f=t(26942),a=t(44022),m=t(3786),v=t(87853),C=t(60914),u=t(88156),k=t(72875),x=t(29161),b=t(99919),y=t(21680);const P="wp-inline-create-row",E="wp-table--cancel-create-link";class T extends y.i9{constructor(se,re){super(se,re),this.injector=se,this.text={cancelButton:this.I18n.t("js.button_cancel")}}buildCell(se,re){switch(re.id){case k.X.id:return this.buildCancelButton();default:return super.buildCell(se,re)}}buildNew(se,re){const[Me,Ae]=this.buildEmpty(se);return[Me,Ae]}createEmptyRow(se){const re=this.classIdentifier(se),Me=document.createElement("tr");return Me.id=(0,b.is)(se.id),Me.dataset.workPackageId=se.id,Me.dataset.classIdentifier=re,Me.classList.add(P,y.HE,y.S,"issue",re,`${re}-table`),Me}buildCancelButton(){const se=document.createElement("td");return se.classList.add(u.Nm,"wp-table--cancel-create-td"),se.innerHTML=`\n    <a\n       href="#"\n       class="${E} icon icon-cancel"\n       aria-label="${this.text.cancelButton}">\n    </a>\n   `,se}}(0,m.gn)([(0,x.W)(),(0,m.w6)("design:type",v.G)],T.prototype,"states",void 0),(0,m.gn)([(0,x.W)(),(0,m.w6)("design:type",C.J)],T.prototype,"wpTableSelection",void 0),(0,m.gn)([(0,x.W)(),(0,m.w6)("design:type",d.i)],T.prototype,"wpTableColumns",void 0),(0,m.gn)([(0,x.W)(),(0,m.w6)("design:type",i.D)],T.prototype,"I18n",void 0);var O=t(63829),Z=(t(55054),t(52787)),j=t(54364),B=t(84312),J=t(32853);function F(ce,se){if(1&ce){const re=n.EpF();n.TgZ(0,"button",6),n.NdJ("click",function(){return n.CHM(re),n.oxw(3).handleAddRowClick()}),n._UZ(1,"span",7),n._UZ(2,"span",8),n.qZA()}if(2&ce){const re=n.oxw(3);n.ekj("wp-inline-create--split-link",re.hasReferenceClass),n.Q6J("opAutofocus",re.focus),n.uIk("aria-label",re.text.create),n.xp6(2),n.Q6J("textContent",re.text.create)}}function Y(ce,se){if(1&ce){const re=n.EpF();n.TgZ(0,"button",9),n.NdJ("click",function(){return n.CHM(re),n.oxw(3).handleReferenceClick()}),n._UZ(1,"span",10),n._UZ(2,"span",8),n.qZA()}if(2&ce){const re=n.oxw(3);n.uIk("aria-label",re.text.create),n.xp6(2),n.Q6J("textContent",re.text.reference)}}function X(ce,se){if(1&ce&&(n.TgZ(0,"tr",2),n.TgZ(1,"td",3),n.YNc(2,F,3,5,"button",4),n.YNc(3,Y,3,2,"button",5),n.qZA(),n.qZA()),2&ce){const re=n.oxw(2);n.xp6(1),n.uIk("colspan",re.colspan),n.xp6(1),n.Q6J("ngIf",re.canAdd),n.xp6(1),n.Q6J("ngIf",re.canReference)}}function K(ce,se){1&ce&&n.GkF(0)}function ie(ce,se){if(1&ce&&(n.TgZ(0,"tr",2),n.TgZ(1,"td",11),n.YNc(2,K,1,0,"ng-container",12),n.qZA(),n.qZA()),2&ce){const re=n.oxw(2);n.xp6(1),n.uIk("colspan",re.colspan),n.xp6(1),n.Q6J("ngComponentOutlet",re.referenceClass)("ngComponentOutletInjector",re.injector)}}function H(ce,se){if(1&ce&&(n.ynx(0),n.YNc(1,X,4,3,"tr",1),n.YNc(2,ie,3,3,"tr",1),n.BQk()),2&ce){const re=n.oxw();n.xp6(1),n.Q6J("ngIf","inactive"===re.mode),n.xp6(1),n.Q6J("ngIf",re.hasReferenceClass&&"reference"===re.mode)}}class ee extends f.N{constructor(se,re,Me,Ae,Ye,ze,Xe,it,at,lt,dt){super(),this.injector=se,this.elementRef=re,this.schemaCache=Me,this.I18n=Ae,this.querySpace=Ye,this.cdRef=ze,this.wpCreate=Xe,this.wpInlineCreate=it,this.wpTableColumns=at,this.wpTableFocus=lt,this.authorisationService=dt,this.showing=new n.vpe,this.canAdd=!1,this.canReference=!1,this.mode="inactive",this.focus=!1,this.text=this.wpInlineCreate.buttonTexts}get isActive(){return"inactive"!==this.mode}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement)}ngAfterViewInit(){(0,r.aj)([this.wpInlineCreate.canAdd,this.wpInlineCreate.canReference]).pipe(this.untilDestroyed()).subscribe(([se,re])=>{this.canAdd=se,this.canReference=this.hasReferenceClass&&re,this.cdRef.detectChanges(),this.showing.emit(this.canAdd||this.canReference)}),this.registerCreationCallback(),this.refreshOnColumnChanges(),this.registerCancelHandler()}registerCancelHandler(){this.$element.on("click keydown",`.${E}`,se=>((0,Z.S)(se,()=>{this.resetRow()}),se.stopImmediatePropagation(),!1))}refreshOnColumnChanges(){this.wpTableColumns.updates$().pipe((0,h.h)(()=>this.isActive),this.untilDestroyed()).subscribe(()=>this.refreshRow())}registerCreationCallback(){this.wpCreate.onNewWorkPackage().pipe(this.untilDestroyed()).subscribe(se=>{this.currentWorkPackage&&this.currentWorkPackage.__initialized_at===se.__initialized_at?(this.resetRow(),this.table.configuration.isEmbedded||this.wpTableFocus.updateFocus(se.id),this.wpInlineCreate.newInlineWorkPackageCreated.next(se.id)):(this.wpCreate.cancelCreation(),this.removeWorkPackageRow(),this.showRow()),this.cdRef.detectChanges()})}handleAddRowClick(){return this.addWorkPackageRow(),!1}handleReferenceClick(){return this.mode="reference",!1}get referenceClass(){return this.wpInlineCreate.referenceComponentClass}get hasReferenceClass(){return!!this.referenceClass}addWorkPackageRow(){this.wpCreate.createOrContinueWorkPackage(this.projectIdentifier).then(se=>{const re=this.currentWorkPackage=se.projectedResource;this.editingSubscription=this.wpCreate.changesetUpdates$().pipe((0,h.h)(()=>!!this.currentWorkPackage)).subscribe(Me=>{this.isActive?(this.schemaCache.update(this.currentWorkPackage,Me.schema),this.refreshRow()):this.insertRow(re)})})}insertRow(se){const re=this.workPackageEditForm=this.renderInlineCreateRow(se);setTimeout(()=>{re.activateMissingFields(),this.hideRow()})}refreshRow(){const se=new T(this.injector,this.table),re=this.$element.find(`.${P}`);re.length&&this.currentWorkPackage&&se.refreshRow(this.currentWorkPackage,re)}renderInlineCreateRow(se){const re=new T(this.injector,this.table),Me=this.table.editing.startEditing(se,re.classIdentifier(se)),[Ae]=re.buildNew(se,Me);return this.$element.append(Ae),Me}resetRow(){this.focus=!0,this.removeWorkPackageRow(),setTimeout(()=>{this.showRow(),this.cdRef.detectChanges()},50)}removeWorkPackageRow(){this.wpCreate.cancelCreation(),this.currentWorkPackage=null,this.$element.find(".wp-row-new").remove(),this.editingSubscription&&this.editingSubscription.unsubscribe()}showRow(){this.mode="inactive",this.cdRef.detectChanges()}hideRow(){this.mode="create",this.cdRef.detectChanges()}get colspan(){return this.wpTableColumns.columnCount+1}}ee.\u0275fac=function(se){return new(se||ee)(n.Y36(n.zs3),n.Y36(n.SBq),n.Y36(a.y),n.Y36(i.D),n.Y36(c.q),n.Y36(n.sBO),n.Y36(O.P),n.Y36(l.m),n.Y36(d.i),n.Y36(p.o),n.Y36(e.g))},ee.\u0275cmp=n.Xpm({type:ee,selectors:[["","wpInlineCreate",""]],hostBindings:function(se,re){1&se&&n.NdJ("keydown.escape",function(){return re.resetRow()})},inputs:{table:["wp-inline-create--table","table"],projectIdentifier:["wp-inline-create--project-identifier","projectIdentifier"]},outputs:{showing:"wp-inline-create--showing"},features:[n.qOj],attrs:["wpInlineCreate",""],decls:1,vars:1,consts:[[4,"ngIf"],["class","wp-inline-create-button-row hide-when-print",4,"ngIf"],[1,"wp-inline-create-button-row","hide-when-print"],[1,"wp-inline-create-button-td"],["type","button","class","spot-link","aria-haspopup","true","data-qa-selector","op-wp-inline-create",3,"wp-inline-create--split-link","opAutofocus","click",4,"ngIf"],["type","button","class","spot-link wp-inline-create--split-link","aria-haspopup","true","data-qa-selector","op-wp-inline-create-reference",3,"click",4,"ngIf"],["type","button","aria-haspopup","true","data-qa-selector","op-wp-inline-create",1,"spot-link",3,"opAutofocus","click"],[1,"spot-icon","spot-icon_add"],[3,"textContent"],["type","button","aria-haspopup","true","data-qa-selector","op-wp-inline-create-reference",1,"spot-link","wp-inline-create--split-link",3,"click"],[1,"spot-icon","spot-icon_link"],[1,"wp-inline-reference-row-td","-no-highlighting"],[4,"ngComponentOutlet","ngComponentOutletInjector"]],template:function(se,re){1&se&&n.YNc(0,H,3,2,"ng-container",0),2&se&&n.Q6J("ngIf",re.canAdd||re.canReference)},directives:[j.O5,B.U,j.$G,J.dw],encapsulation:2})},8403:(te,M,t)=>{"use strict";t.d(M,{m:()=>d});var n=t(3786),e=t(79441),p=t(81134),h=t(96617),c=t(29161),i=t(96905),l=t(65146),r=t(2316);class d{constructor(a){this.injector=a,this.referenceComponentClass=null,this.referenceTarget=null,this.buttonTexts={reference:"",create:this.I18n.t("js.label_create_work_package")},this.newInlineWorkPackageCreated=new e.xQ,this.newInlineWorkPackageReferenced=new e.xQ}get canAdd(){return this.canCreateWorkPackages()}get canReference(){return(0,p.of)(!1)}canCreateWorkPackages(a=this.currentProject.id){return this.currentUser.hasCapabilities$(["work_packages/create","work_packages/update"],a||null)}ngOnDestroy(){this.newInlineWorkPackageCreated.complete(),this.newInlineWorkPackageReferenced.complete()}}d.\u0275fac=function(a){return new(a||d)(r.LFG(r.zs3))},d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac}),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.D)],d.prototype,"I18n",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",i.S)],d.prototype,"currentUser",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",l.R)],d.prototype,"currentProject",void 0)},81539:(te,M,t)=>{"use strict";t.d(M,{Y:()=>h});var n=t(47775),e=t(55977),p=t(2316);class h{constructor(i,l){this.UrlParamsHelper=i,this.$state=l}updateIfDifferent(i,l){const r=this.getNewChecksum(i,l);let d=Promise.resolve();return this.isUninitialized()||(this.isIdDifferent(i.id)?(d=this.maintainUrlQueryState(i.id,null),this.clear()):this.isChecksumDifferent(r)&&(d=this.maintainUrlQueryState(i.id,r))),this.set(i.id,r),d}update(i,l){const r=this.getNewChecksum(i,l);this.set(i.id,r),this.maintainUrlQueryState(i.id,r)}setToQuery(i,l){const r=this.getNewChecksum(i,l);return this.set(i.id,r),this.maintainUrlQueryState(i.id,null)}isQueryOutdated(i,l){const r=this.getNewChecksum(i,l);return this.isOutdated(i.id,r)}executeIfOutdated(i,l,r){(this.isUninitialized()||this.isOutdated(i,l))&&(this.set(i,l),r())}set(i,l){this.id=i,this.checksum=l}clear(){this.id=null,this.checksum=null,this.visibleChecksum=null}isUninitialized(){return!this.id&&!this.checksum}isIdDifferent(i){return this.id!==i}isChecksumDifferent(i){return this.checksum&&i!==this.checksum}isOutdated(i,l){const r=!!this.id,d=!!this.checksum,f=this.id!==i,a=l!==this.checksum,m=this.checksum&&!l&&this.visibleChecksum;return(r||d)&&(f||!f&&a&&(l||this.visibleChecksum)||!r&&m)}getNewChecksum(i,l){return this.UrlParamsHelper.encodeQueryJsonParams(i,{pp:l.perPage,pa:l.page})}maintainUrlQueryState(i,l){return this.visibleChecksum=l,this.$state.go(".",{query_props:l,query_id:i},{custom:{notify:!1}})}}h.\u0275fac=function(i){return new(i||h)(p.LFG(e.Z),p.LFG(n.StateService))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},97354:(te,M,t)=>{"use strict";t.d(M,{R:()=>p});var n=t(91923),e=t(2316);class p{constructor(c){this.halResourceService=c}restoreQuery(c,i){this.restoreFilters(c,i.payload,i.schema),this.restoreColumns(c,i.payload,i.schema),this.restoreSortBy(c,i.payload,i.schema),this.restoreGroupBy(c,i.payload,i.schema),this.restoreOtherProperties(c,i.payload)}restoreFilters(c,i,l){let r=_.map(i.filters,d=>{const f=_.find(l.filtersSchemas.elements,v=>v.filter.allowedValues[0].href===d.filter.href);if(!f)return null;const a=f.getFilter(),m=_.find(f.operator.allowedValues,v=>v.href===d.operator.href);return m&&(a.operator=m),a.values.length=0,_.each(d.values,v=>a.values.push(v)),a});r=_.compact(r),c.filters.length=0,_.each(r,d=>c.filters.push(d))}restoreColumns(c,i,l){let r=_.map(i.columns,d=>_.find(l.columns.allowedValues,f=>f.href===d.href));r=_.compact(r),c.columns.length=0,_.each(r,d=>c.columns.push(d))}restoreSortBy(c,i,l){let r=_.map(i.sortBy,d=>_.find(l.sortBy.allowedValues,f=>f.href===d.href));r=_.compact(r),c.sortBy.length=0,_.each(r,d=>c.sortBy.push(d))}restoreGroupBy(c,i,l){const r=_.find(l.groupBy.allowedValues,d=>i.groupBy&&i.groupBy.href===d.href);c.groupBy=r}restoreOtherProperties(c,i){_.without(Object.keys(i.$source),"_links","filters").forEach(l=>{c[l]=i[l]}),_.without(Object.keys(i.$source._links),"columns","groupBy","sortBy").forEach(l=>{c[l]=i[l]})}}p.\u0275fac=function(c){return new(c||p)(e.LFG(n.u))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac})},61043:(te,M,t)=>{"use strict";t.d(M,{Z:()=>B});var n=t(3786),e=t(87853),p=t(7493),h=t(47775),c=t(43440),i=t(48934),l=t(55977),r=t(36293),d=t(96617),f=t(30400),a=t(81134),m=t(14808),v=t(79902),C=t(85816),u=t(91992),k=t(18293),x=t(53466),b=t(67202),y=t(40533),P=t(12877),E=t(33276),T=t(68853),O=t(74478),I=t(97354),Z=t(76869),j=t(2316);class B{constructor(R,F,Y,X,K,ie,H,ee,ce,se,re,Me,Ae,Ye){this.toastService=R,this.I18n=F,this.UrlParamsHelper=Y,this.authorisationService=X,this.$state=K,this.apiV3Service=ie,this.states=H,this.querySpace=ee,this.pagination=ce,this.configuration=se,this.wpTablePagination=re,this.wpStatesInitialization=Me,this.wpListInvalidQueryService=Ae,this.wpQueryView=Ye,this.queryRequests=(0,m.qH)(),this.queryLoading=this.queryRequests.values$().pipe((0,v.w)(ze=>(0,f.D)(this.ensurePerPageKnown().then(()=>ze))),(0,v.w)(ze=>this.streamQueryRequest(ze.queryParams,ze.projectIdentifier)),(0,C.zg)(ze=>(this.conditionallyLoadForm(ze),this.wpStatesInitialization.initialize(ze,ze.results),(0,a.of)(ze))),(0,u.B)())}streamQueryRequest(R,F){const Y=this.getCurrentQueryProps(R),X=this.UrlParamsHelper.buildV3GetQueryFromJsonParams(Y);return this.apiV3Service.queries.find(X,R.query_id,F).pipe((0,k.K)(ie=>{const H=this.UrlParamsHelper.buildV3GetQueryFromJsonParams(Y);return(0,f.D)(this.handleQueryLoadingError(ie,H,R.query_id,F))}))}fromQueryParams(R,F){return this.queryRequests.clear(),this.queryRequests.putValue({queryParams:R,projectIdentifier:F}),this.queryLoading.pipe((0,x.q)(1))}getCurrentQueryProps(R){return R.query_props?decodeURIComponent(R.query_props):null}loadDefaultQuery(R){return this.fromQueryParams({},R).toPromise()}reloadQuery(R,F){const Y=this.extractParamsFromQuery(R,{pa:1});return this.queryRequests.clear(),this.queryRequests.putValue({queryParams:{query_id:R.id||void 0,query_props:Y},projectIdentifier:F}),this.queryLoading.pipe((0,x.q)(1))}extractParamsFromQuery(R,F={}){return this.UrlParamsHelper.encodeQueryJsonParams(R,Object.assign({pa:this.wpTablePagination.current.page,pp:this.wpTablePagination.current.perPage},F))}loadQueryFromExisting(R,F,Y){const X=this.UrlParamsHelper.buildV3GetQueryFromQueryResource(R,F);let K;return K=R.id?this.apiV3Service.queries.id(R.id):this.apiV3Service.withOptionalProject(Y).queries,K.parameterised(X)}loadCurrentQueryFromParams(R){return this.fromQueryParams(this.$state.params,R).toPromise()}loadForm(R){return this.apiV3Service.queries.form.load(R).toPromise().then(([F,Y])=>(this.wpStatesInitialization.updateStatesFromForm(R,F),F))}create(R,F){const Y=this.querySpace.queryForm.value;return R.name=F,this.createQueryAndView(R,Y).toPromise().then(K=>(this.toastService.addSuccess(this.I18n.t("js.notice_successful_create")),this.reloadQuery(K).subscribe(()=>{this.states.changes.queries.next(K.id)}),K))}delete(){const R=this.currentQuery,F=this.apiV3Service.queries.id(R).delete().toPromise();return F.then(()=>{let Y;this.toastService.addSuccess(this.I18n.t("js.notice_successful_delete")),R.project&&(Y=R.project.href.split("/").pop()),this.loadDefaultQuery(Y),this.states.changes.queries.next(R.id)}),F}save(R){return(0,n.mG)(this,void 0,void 0,function*(){const F=R||this.currentQuery,Y=yield this.querySpace.queryForm.valuesPromise(),X=this.apiV3Service.queries.id(F).patch(F,Y).toPromise();return X.then(()=>{this.toastService.addSuccess(this.I18n.t("js.notice_successful_update")),this.$state.go(".",{query_id:F.id,query_props:null},{reload:!0}),this.states.changes.queries.next(F.id)}).catch(K=>{this.toastService.addError(K.message)}),X})}createOrSave(R){return(0,n.mG)(this,void 0,void 0,function*(){return(0,i.Z)(R)?this.save(R):this.create(R,"New manually sorted query")})}toggleStarred(R){const F=this.apiV3Service.queries.toggleStarred(R);return F.then(Y=>{this.querySpace.query.putValue(Y),this.toastService.addSuccess(this.I18n.t("js.notice_successful_update")),this.states.changes.queries.next(Y.id)}),F}getPaginationInfo(){return this.wpTablePagination.paginationObject}conditionallyLoadForm(R){const F=this.querySpace.queryForm.value;(!F||R.$links.update.href!==F.href)&&setTimeout(()=>this.loadForm(R),0)}get currentQuery(){return this.querySpace.query.value}handleQueryLoadingError(R,F,Y,X){return this.toastService.addError(this.I18n.t("js.work_packages.faulty_query.description"),R.message),new Promise((K,ie)=>{this.apiV3Service.queries.form.loadWithParams(F,Y,X).toPromise().then(([H,ee])=>{this.apiV3Service.queries.find({pageSize:0},void 0,X).toPromise().then(ce=>{this.wpListInvalidQueryService.restoreQuery(ce,H),ce.results.pageSize=F.pageSize,ce.results.total=0,Y&&(ce.id=Y),this.wpStatesInitialization.initialize(ce,ce.results),this.wpStatesInitialization.updateStatesFromForm(ce,H),K(ce)}).catch(ie)}).catch(ie)})}ensurePerPageKnown(){return(0,n.mG)(this,void 0,void 0,function*(){return!!this.pagination.isPerPageKnown||this.configuration.initialized})}createQueryAndView(R,F){return this.apiV3Service.queries.post(R,F).pipe((0,v.w)(Y=>this.wpQueryView.create(Y).pipe((0,b.h)(Y))))}}B.\u0275fac=function(R){return new(R||B)(j.LFG(r.kl),j.LFG(d.D),j.LFG(l.Z),j.LFG(p.g),j.LFG(h.StateService),j.LFG(E.T),j.LFG(e.G),j.LFG(c.q),j.LFG(T.N),j.LFG(P.e),j.LFG(y.S),j.LFG(O.f),j.LFG(I.R),j.LFG(Z.$))},B.\u0275prov=j.Yz7({token:B,factory:B.\u0275fac})},76869:(te,M,t)=>{"use strict";t.d(M,{$:()=>h});var n=t(47775),e=t(33276),p=t(2316);class h{constructor(i,l){this.$state=i,this.apiV3Service=l}create(i){if(!i.href)throw new Error("Expected only queries that are created since an href is required");return this.apiV3Service.views.post({_links:{query:{href:i.href}}},this.viewType)}get viewType(){if(this.$state.includes("work-packages"))return"work_packages_table";if(this.$state.includes("team_planner"))return"team_planner";if(this.$state.includes("bim"))return"bim";if(this.$state.includes("calendar"))return"work_packages_calendar";throw new Error("Not on a path defined for query views")}}h.\u0275fac=function(i){return new(i||h)(p.LFG(n.StateService),p.LFG(e.T))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},74478:(te,M,t)=>{"use strict";t.d(M,{f:()=>O});var n=t(87853),e=t(7493),p=t(43440),h=t(84897),c=t(53466),i=t(95846),l=t(2888),r=t(20066),d=t(82271),f=t(71562),a=t(82763),m=t(81691),v=t(99676),C=t(40533),u=t(73165),k=t(61083),x=t(74647),b=t(41195),y=t(33276),P=t(79174),E=t(81539),T=t(2316);class O{constructor(Z,j,B,J,R,F,Y,X,K,ie,H,ee,ce,se,re,Me,Ae,Ye,ze,Xe){this.states=Z,this.querySpace=j,this.wpTableColumns=B,this.wpTableGroupBy=J,this.wpTableGroupFold=R,this.wpTableSortBy=F,this.wpTableFilters=Y,this.wpTableSum=X,this.wpTableTimeline=K,this.wpTableHierarchies=ie,this.wpTableHighlighting=H,this.wpTableRelationColumns=ee,this.wpTablePagination=ce,this.wpTableOrder=se,this.wpTableAdditionalElements=re,this.apiV3Service=Me,this.wpListChecksumService=Ae,this.authorisationService=Ye,this.wpDisplayRepresentation=ze,this.wpIncludeSubprojects=Xe}initialize(Z,j){this.clearStates(),this.querySpace.query.putValue(Z),this.initializeFromQuery(Z,j);const B=this.querySpace.queryForm.value;B&&this.updateStatesFromForm(Z,B),this.updateQuerySpace(Z,j),this.updateChecksum(Z,j)}updateStatesFromForm(Z,j){const B=j.schema;_.each(B.filtersSchemas.elements,J=>{this.states.schemas.get(J.href).putValue(J)}),this.wpTableFilters.initializeFilters(Z,B),this.querySpace.queryForm.putValue(j),this.querySpace.available.columns.putValue(B.columns.allowedValues),this.querySpace.available.sortBy.putValue(B.sortBy.allowedValues),this.querySpace.available.groupBy.putValue(B.groupBy.allowedValues),this.querySpace.available.displayRepresentation.putValue(B.displayRepresentation.allowedValues)}updateQuerySpace(Z,j){this.querySpace.additionalRequiredWorkPackages.clear("Clearing additional WPs before updating rows"),this.querySpace.tableRendered.clear("Clearing rendered data before upgrading query space"),j.schemas&&_.each(j.schemas.elements,B=>{this.states.schemas.get(B.href).putValue(B)}),this.querySpace.query.putValue(Z),this.authorisationService.initModelAuth("work_packages",j.$links),j.elements.forEach(B=>this.apiV3Service.work_packages.cache.updateWorkPackage(B,!0)),this.querySpace.results.putValue(j),this.querySpace.groups.putValue(j.groups),this.wpTablePagination.initialize(Z,j),this.wpTableRelationColumns.initialize(Z,j),this.wpTableAdditionalElements.initialize(Z,j),this.wpTableOrder.initialize(Z,j),this.wpDisplayRepresentation.initialize(Z,j),this.wpIncludeSubprojects.initialize(Z,j),this.querySpace.additionalRequiredWorkPackages.values$().pipe((0,c.q)(1)).subscribe(()=>this.querySpace.initialized.putValue(null))}updateChecksum(Z,j){this.wpListChecksumService.updateIfDifferent(this.querySpace.query.value,this.wpTablePagination.current),this.authorisationService.initModelAuth("work_packages",j.$links)}initializeFromQuery(Z,j){this.querySpace.query.putValue(Z),this.wpTableSum.initialize(Z),this.wpTableColumns.initialize(Z,j),this.wpTableSortBy.initialize(Z,j),this.wpTableGroupBy.initialize(Z,j),this.wpTableGroupFold.initialize(Z,j),this.wpTableTimeline.initialize(Z,j),this.wpTableHierarchies.initialize(Z,j),this.wpTableHighlighting.initialize(Z,j),this.wpDisplayRepresentation.initialize(Z,j),this.wpIncludeSubprojects.initialize(Z,j),this.authorisationService.initModelAuth("query",Z.$links),this.authorisationService.initModelAuth("work_packages",j.$links)}applyToQuery(Z){this.wpTableFilters.applyToQuery(Z),this.wpTableSum.applyToQuery(Z),this.wpTableColumns.applyToQuery(Z),this.wpTableSortBy.applyToQuery(Z),this.wpTableGroupBy.applyToQuery(Z),this.wpTableGroupFold.applyToQuery(Z),this.wpTableTimeline.applyToQuery(Z),this.wpTableHighlighting.applyToQuery(Z),this.wpTableHierarchies.applyToQuery(Z),this.wpTableOrder.applyToQuery(Z),this.wpDisplayRepresentation.applyToQuery(Z),this.wpIncludeSubprojects.applyToQuery(Z)}clearStates(){const Z="Clearing states before re-initialization.";this.querySpace.initialized.clear(Z),this.querySpace.query.clear(Z),this.querySpace.results.clear(Z),this.querySpace.groups.clear(Z),this.querySpace.additionalRequiredWorkPackages.clear(Z),this.wpTableFilters.clear(Z),this.wpTableColumns.clear(Z),this.wpTableSortBy.clear(Z),this.wpTableGroupBy.clear(Z),this.wpTableGroupFold.clear(Z),this.wpDisplayRepresentation.clear(Z),this.wpIncludeSubprojects.clear(Z),this.wpTableSum.clear(Z),this.querySpace.tableRendered.clear(Z)}}O.\u0275fac=function(Z){return new(Z||O)(T.LFG(n.G),T.LFG(p.q),T.LFG(f.i),T.LFG(k.w),T.LFG(P.q),T.LFG(a.q),T.LFG(x.Z),T.LFG(d.X),T.LFG(u.W),T.LFG(v.Y),T.LFG(h.B),T.LFG(b.a),T.LFG(C.S),T.LFG(i.M),T.LFG(m.G),T.LFG(y.T),T.LFG(E.Y),T.LFG(e.g),T.LFG(l.ld),T.LFG(r.F))},O.\u0275prov=T.Yz7({token:O,factory:O.\u0275fac})},39410:(te,M,t)=>{"use strict";t.d(M,{I:()=>y});var n=t(47775),e=t(70233),p=t(87853),h=t(18511),c=t(96617),i=t(74647),l=t(48451),r=t(61342),d=t(62964),f=t(97973),m=t(26942),v=t(70482),C=t(33276),u=t(57810),k=t(63829),x=t(8849),b=t(2316);class y extends m.N{constructor(E,T,O,I,Z,j,B,J,R,F,Y,X,K){super(),this.injector=E,this.$transition=T,this.$state=O,this.I18n=I,this.titleService=Z,this.notificationService=j,this.states=B,this.wpCreate=J,this.wpViewFocus=R,this.wpTableFilters=F,this.pathHelper=Y,this.apiV3Service=X,this.cdRef=K,this.successState=(0,v.W)(this.$state),this.cancelState=this.$state.current.data.baseRoute,this.copying=!1,this.stateParams=this.$transition.params("to"),this.text={button_settings:this.I18n.t("js.button_settings")},this.destroyed=!1}ngOnInit(){this.closeEditFormWhenNewWorkPackageSaved(),this.showForm()}ngOnDestroy(){super.ngOnDestroy()}switchToFullscreen(){this.$state.go("work-packages.new",this.$state.params)}onSaved(E){var T;const{savedResource:O,isInitial:I}=E;null===(T=this.editForm)||void 0===T||T.cancel(!1),this.successState&&this.$state.go(this.successState,{workPackageId:O.id}).then(()=>{this.wpViewFocus.updateFocus(O.id),this.notificationService.showSave(O,I)})}showForm(){this.createdWorkPackage().then(E=>{this.change=E,this.newWorkPackage=E.pristineResource,this.cdRef.detectChanges(),this.setTitle(),this.stateParams.parent_id&&E.setValue("parent",{href:this.apiV3Service.work_packages.id(this.stateParams.parent_id).path}),this.stateParams.parent_id&&this.apiV3Service.work_packages.id(this.stateParams.parent_id).get().pipe(this.untilDestroyed()).subscribe(T=>{this.parentWorkPackage=T,this.cdRef.detectChanges()})}).catch(E=>{E instanceof x.o&&"urn:openproject-org:api:v3:errors:MissingPermission"===E.errorIdentifier&&(this.apiV3Service.root.get().subscribe(T=>{if(!T.user){const O=f(this.pathHelper.loginPath());O.search({back_url:O}),window.location.href=O.toString()}}),this.notificationService.handleRawError(E))})}setTitle(){this.titleService.setFirstPart(this.I18n.t("js.work_packages.create.title"))}cancelAndBackToList(){this.wpCreate.cancelCreation(),this.$state.go(this.cancelState,this.$state.params)}createdWorkPackage(){const E=this.stateParams.defaults||{};E._links=E._links||{};const T=this.stateParams.type?parseInt(this.stateParams.type):void 0,O=this.stateParams.parent_id?parseInt(this.stateParams.parent_id):void 0,I=this.stateParams.projectPath;return T&&(E._links.type={href:this.apiV3Service.types.id(T).path}),O&&(E._links.parent={href:this.apiV3Service.work_packages.id(O).path}),this.wpCreate.createOrContinueWorkPackage(I,T,E)}closeEditFormWhenNewWorkPackageSaved(){this.wpCreate.onNewWorkPackage().pipe((0,h.o)(()=>!this.componentDestroyed)).subscribe(E=>{this.onSaved({savedResource:E,isInitial:!0})})}}y.\u0275fac=function(E){return new(E||y)(b.Y36(b.zs3),b.Y36(n.Transition),b.Y36(n.StateService),b.Y36(c.D),b.Y36(u.V),b.Y36(d.q),b.Y36(p.G),b.Y36(k.P),b.Y36(l.o),b.Y36(i.Z),b.Y36(e.j),b.Y36(C.T),b.Y36(b.sBO))},y.\u0275dir=b.lG2({type:y,viewQuery:function(E,T){if(1&E&&b.Gf(r.n,5),2&E){let O;b.iGM(O=b.CRH())&&(T.editForm=O.first)}},features:[b.qOj]})},63829:(te,M,t)=>{"use strict";t.d(M,{P:()=>b});var n=t(79441),e=t(53448),p=t(97979),h=t(12703),c=t(9170),i=t(43440),l=t(1403),r=t(7493),d=t(26942),f=t(33276),a=t(80044),m=t(10190),v=t(44022),C=t(91923),u=t(88826),k=t(2316);const x="/api/v3/work_packages/new";class b extends d.N{constructor(P,E,T,O,I,Z,j,B,J,R){super(),this.injector=P,this.hooks=E,this.apiV3Service=T,this.halResourceService=O,this.querySpace=I,this.authorisationService=Z,this.halEditing=j,this.schemaCache=B,this.halEvents=J,this.attachmentsService=R,this.newWorkPackageCreatedSubject=new n.xQ,this.halEditing.committedChanges.pipe(this.untilDestroyed(),(0,c.h)(F=>"WorkPackage"===F.resource._type&&F.wasNew)).subscribe(F=>{this.newWorkPackageCreated(F.resource)}),this.halEditing.changes$(x).pipe(this.untilDestroyed(),(0,c.h)(F=>!F)).subscribe(()=>{this.reset()})}newWorkPackageCreated(P){this.reset(),this.newWorkPackageCreatedSubject.next(P)}onNewWorkPackage(){return this.newWorkPackageCreatedSubject.asObservable()}createNewWorkPackage(P,E){return this.apiV3Service.withOptionalProject(P).work_packages.form.forPayload(E).toPromise().then(T=>this.fromCreateForm(T))}fromCreateForm(P){const E=this.initializeNewResource(P),T=this.halEditing.edit(E,P);return this.hooks.call("workPackageNewInitialization",T),T}copyWorkPackage(P){const E=P.pristineResource.$source;return this.apiV3Service.work_packages.form.post(E).toPromise().then(T=>this.fromCreateForm(T))}copyFrom(P){const E=this.initializeNewResource(P);return this.halEditing.edit(E,P)}getEmptyForm(P){return this.form||(this.form=this.apiV3Service.withOptionalProject(P).work_packages.form.post({}).toPromise()),this.form}cancelCreation(){this.halEditing.stopEditing({href:x}),this.reset()}changesetUpdates$(){return this.halEditing.state(x).values$()}createOrContinueWorkPackage(P,E,T){let O=this.continueExistingEdit(E);return O||(O=this.createNewWithDefaults(P,T)),O.then(I=>(this.authorisationService.initModelAuth("work_package",I.pristineResource),this.halEditing.updateValue(x,I),this.apiV3Service.work_packages.cache.updateWorkPackage(I.pristineResource,!0),I))}reset(){this.apiV3Service.work_packages.cache.clearSome("new"),this.attachmentsService.clear("new"),this.form=void 0}continueExistingEdit(P){const E=this.halEditing.state(x).value;if(void 0!==E){const T=E.projectedResource.type,O=!E.isEmpty(),I=!T&&!P,Z=P&&T&&(0,m.Z)(T.href)===P.toString();if(O&&(I||Z))return Promise.resolve(E)}return null}createNewWithDefaults(P,E){return this.withFiltersPayload(P,E).then(T=>{const O=_.merge({_links:{}},T,E);return this.createNewWorkPackage(P,O).then(I=>{if(!I)throw new Error("No new work package was created");return this.defaultsFromFilters(I,E),I})})}defaultsFromFilters(P,E){const T=this.querySpace.query.value;if(T){const O=(null==E?void 0:E._links)?Object.keys(E._links):[];new p.R(this.injector,T.filters,O).applyDefaultsFromFilters(P)}}withFiltersPayload(P,E){const T={_links:{}};return this.defaultsFromFilters(T,E),Object.keys(T).length>1||Object.keys(T._links).length>0?this.apiV3Service.withOptionalProject(P).work_packages.form.forTypePayload(E||{_links:{}}).toPromise().then(I=>(this.toApiPayload(T,I.schema),T)):Promise.resolve(T)}toApiPayload(P,E){const T=[];Object.keys(E.$source).forEach(O=>{["Integer","Float","Date","DateTime","Duration","Formattable","Boolean","String","Text",void 0].includes(E.$source[O].type)||T.push(O)}),T.forEach(O=>{const I=P[O];void 0===I||(I instanceof a.X?P._links[O]={href:I.$links.self.href}:P._links[O]=I||{href:null}),delete P[O]})}initializeNewResource(P){const E=P.payload.$plain();E._links.schema={href:"new"};const T=this.halResourceService.createHalResourceOfType("WorkPackage",E);return T.$source.id="new",T._type="WorkPackage",T.__initialized_at=Date.now(),T.update=T.$links.update=P.$links.self,T.updateImmediately=T.$links.updateImmediately=O=>this.apiV3Service.work_packages.post(O).toPromise(),this.schemaCache.update(T,P.schema),T}}b.\u0275fac=function(P){return new(P||b)(k.LFG(k.zs3),k.LFG(e.$),k.LFG(f.T),k.LFG(C.u),k.LFG(i.q),k.LFG(r.g),k.LFG(h.l),k.LFG(v.y),k.LFG(l.J),k.LFG(u.v))},b.\u0275prov=k.Yz7({token:b,factory:b.\u0275fac})},19496:(te,M,t)=>{"use strict";t.d(M,{v:()=>m});var n=t(39410),e=t(2316),p=t(54364),h=t(61342),c=t(92092),i=t(11266),l=t(8643),r=t(77180),d=t(66979);const f=function(){return["status","type"]};function a(v,C){if(1&v){const u=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"edit-form",2),e.NdJ("onSaved",function(x){return e.CHM(u),e.oxw().onSaved(x)}),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e._UZ(4,"wp-type-status",5),e.qZA(),e.TgZ(5,"ul",6),e.TgZ(6,"li",7),e._UZ(7,"zen-mode-toggle-button"),e.qZA(),e.TgZ(8,"li",7),e.TgZ(9,"button",8),e._UZ(10,"i",9),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e._UZ(11,"wp-single-view",10),e.TgZ(12,"wp-edit-actions-bar",11),e.NdJ("onCancel",function(){return e.CHM(u),e.oxw().cancelAndBackToList()}),e.qZA(),e.qZA(),e.qZA()}if(2&v){const u=e.oxw();e.xp6(1),e.Q6J("resource",u.newWorkPackage)("skippedFields",e.DdM(7,f))("inEditMode",!0),e.xp6(3),e.Q6J("workPackage",u.newWorkPackage),e.xp6(5),e.uIk("title",u.text.button_settings),e.xp6(2),e.Q6J("workPackage",u.newWorkPackage)("showProject",u.copying)}}class m extends n.I{constructor(){super(...arguments),this.successState=this.$state.current.data.successState}}m.\u0275fac=function(){let v;return function(u){return(v||(v=e.n5z(m)))(u||m)}}(),m.\u0275cmp=e.Xpm({type:m,selectors:[["wp-new-full-view"]],hostAttrs:[1,"work-packages-page--ui-view"],features:[e.qOj],decls:1,vars:1,consts:[["class","work-package--new-state work-packages--new work-packages--show-view toolbar-container",4,"ngIf"],[1,"work-package--new-state","work-packages--new","work-packages--show-view","toolbar-container"],[3,"resource","skippedFields","inEditMode","onSaved"],[1,"toolbar"],[1,"title-container"],[3,"workPackage"],[1,"toolbar-items","hide-when-print"],[1,"toolbar-item","hidden-for-mobile"],["id","create-wp-menu-button","wpCreateSettingsMenu","",1,"button","last","work-packages-settings-button","toolbar-icon"],[1,"button--icon","icon-show-more"],[3,"workPackage","showProject"],[3,"onCancel"]],template:function(C,u){1&C&&e.YNc(0,a,13,8,"div",0),2&C&&e.Q6J("ngIf",u.newWorkPackage)},directives:[p.O5,h.n,c.E,i.a,l.Y,r.G,d.Y],encapsulation:2,changeDetection:0})},70319:(te,M,t)=>{"use strict";t.d(M,{L:()=>n,q:()=>e});const n={PROPERTY:"QueryColumn::Property",RELATION_OF_TYPE:"QueryColumn::RelationOfType",RELATION_TO_TYPE:"QueryColumn::RelationToType"};function e(p){return[n.RELATION_TO_TYPE,n.RELATION_OF_TYPE].indexOf(p._type)>=0}},19866:(te,M,t)=>{"use strict";t.d(M,{r:()=>p});var n=t(44022),e=t(2316);class p{constructor(c){this.schemaCache=c}getFilterSchema(c,i){const l=i.$embedded.schema.filtersSchemas.elements;return _.find(l,r=>r.allowedFilterValue.href===c.filter.href)}mapSchemasIntoFilters(c,i){c.filters.forEach(l=>{const r=this.getFilterSchema(l,i);l.$links.schema=r.$links.self,this.schemaCache.update(l,r)})}setSchemas(c){c.elements.forEach(i=>{this.schemaCache.updateValue(i.$links.self.href,i)})}}p.\u0275fac=function(c){return new(c||p)(e.LFG(n.y))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac})},91654:(te,M,t)=>{"use strict";t.d(M,{E:()=>i});var n=t(81539),e=t(61043),p=t(47775),h=t(79441),c=t(2316);class i{constructor(r){this.injector=r,this.wpListChecksumService=this.injector.get(n.Y),this.wpListService=this.injector.get(e.Z),this.$transitions=this.injector.get(p.TransitionService),this.observe$=new h.xQ,this.listenForQueryParamsChanged()}listenForQueryParamsChanged(){return this.queryChangeListener=this.$transitions.onSuccess({},r=>{const d=r.options(),f=r.params("to"),a=this.wpListService.getCurrentQueryProps(f),m=f.query_id?f.query_id.toString():null;return!!(d.reload||d.custom&&!1===d.custom.notify)||this.wpListChecksumService.executeIfOutdated(m,a,()=>{this.observe$.next(a)})})}removeQueryChangeListener(){this.queryChangeListener()}}i.\u0275fac=function(r){return new(r||i)(c.LFG(c.zs3))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac})},55977:(te,M,t)=>{"use strict";t.d(M,{Z:()=>i});var n=t(10190),e=t(48934),p=t(26269),h=t(68853),c=t(2316);class i{constructor(r){this.paginationService=r}buildQueryString(r){if(!r)return;const d=[];return _.each(r,(f,a)=>{!f||(Array.isArray(f)||(f=[f]),_.each(f,m=>{null!==m&&"object"==typeof m&&(m=JSON.stringify(m)),d.push(`${encodeURIComponent(a)}=${encodeURIComponent(m)}`)}))}),d.join("&")}encodeQueryJsonParams(r,d){const f=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({c:r.columns.map(a=>a.id),hi:!!r.showHierarchies,g:_.get(r.groupBy,"id",""),dr:r.displayRepresentation,is:r.includeSubprojects},this.encodeSums(r)),this.encodeTimelineVisible(r)),this.encodeHighlightingMode(r)),this.encodeHighlightedAttributes(r)),this.encodeSortBy(r)),this.encodeFilters(r.filters));return"function"==typeof d?JSON.stringify(d(f)):"object"==typeof d?JSON.stringify(_.merge(f,d)):JSON.stringify(f)}encodeSums(r){return r.sums?{s:r.sums}:{}}encodeHighlightingMode(r){return r.highlightingMode&&((0,e.Z)(r)||"inline"!==r.highlightingMode)?{hl:r.highlightingMode}:{}}encodeHighlightedAttributes(r){return"inline"===r.highlightingMode&&Array.isArray(r.highlightedAttributes)&&r.highlightedAttributes.length>0?{hla:r.highlightedAttributes.map(d=>d.id)}:{}}encodeSortBy(r){return r.sortBy?{t:r.sortBy.map(d=>d.id.replace("-",":")).join()}:{}}encodeFilters(r){return r&&r.length>0?{f:r.map(f=>({n:f.id,o:f.operator.id,v:f.values.map(a=>this.queryFilterValueToParam(a))}))}:{f:[]}}encodeTimelineVisible(r){const d={};return r.timelineVisible?(d.tv=r.timelineVisible,_.isEmpty(r.timelineLabels)||(d.tll=JSON.stringify(r.timelineLabels)),d.tzl=r.timelineZoomLevel):d.tv=!1,d}buildV3GetQueryFromJsonParams(r){const d={pageSize:this.paginationService.getPerPage()};if(!r)return d;const f=JSON.parse(r);if(f.c&&(d["columns[]"]=f.c.map(a=>a)),f.s&&(d.showSums=f.s),d.timelineVisible=f.tv,f.tv&&(f.tll&&(d.timelineLabels=f.tll),f.tzl&&(d.timelineZoomLevel=f.tzl)),f.dr&&(d.displayRepresentation=f.dr),void 0!==f.is&&(d.includeSubprojects=f.is),f.hl&&(d.highlightingMode=f.hl),f.hla&&(d["highlightedAttributes[]"]=f.hla.map(a=>a)),void 0!==f.hi&&(d.showHierarchies=f.hi),d.groupBy=_.get(f,"g",""),f.f){const a=f.f.map(m=>{const v={operator:decodeURIComponent(m.o)};if(m.v){const u=Array.isArray(m.v)?m.v:[m.v];_.extend(v,{values:u})}const C={};return C[m.n]=v,C});d.filters=JSON.stringify(a)}return f.t&&(d.sortBy=JSON.stringify(f.t.split(",").map(a=>a.split(":")))),f.pa&&(d.offset=f.pa),f.pp&&(d.pageSize=f.pp),d}buildV3GetQueryFromQueryResource(r,d={},f={}){const a={};return a["columns[]"]=this.buildV3GetColumnsFromQueryResource(r),a.showSums=r.sums,a.timelineVisible=!!r.timelineVisible,r.timelineVisible&&(a.timelineZoomLevel=r.timelineZoomLevel,a.timelineLabels=JSON.stringify(r.timelineLabels)),r.highlightingMode&&(a.highlightingMode=r.highlightingMode),r.highlightedAttributes&&"inline"===r.highlightingMode&&(a["highlightedAttributes[]"]=r.highlightedAttributes.map(m=>m.href)),r.displayRepresentation&&(a.displayRepresentation=r.displayRepresentation),a.includeSubprojects=!!r.includeSubprojects,a.showHierarchies=!!r.showHierarchies,a.groupBy=_.get(r.groupBy,"id",""),a.filters=this.buildV3GetFiltersAsJson(r.filters,f),a.sortBy=this.buildV3GetSortByFromQuery(r),_.extend(d,a)}queryFilterValueToParam(r){if("boolean"==typeof r)return r?"t":"f";if(!r)return"";const d=r;return d.id?d.id.toString():d.href?d.href.split("/").pop():r.toString()}buildV3GetColumnsFromQueryResource(r){return r.columns?r.columns.map(d=>d.id||(0,n.Z)(d.href)):r._links.columns?r._links.columns.map(d=>{const f=d.href;return this.idFromHref(f)}):void 0}buildV3GetFilters(r,d={}){return r.map(a=>{const m=this.buildV3GetFilterIdFromFilter(a),v=this.buildV3GetOperatorIdFromFilter(a),C=this.buildV3GetValuesFromFilter(a).map(k=>(_.each(d,(x,b)=>{k=k.replace(`{${b}}`,x)}),k)),u={};return u[m]={operator:v,values:C},u})}filterBuilderFrom(r){const d=new p.qM;return r.forEach(f=>{const a=this.buildV3GetFilterIdFromFilter(f),m=this.buildV3GetOperatorIdFromFilter(f),v=this.buildV3GetValuesFromFilter(f);d.add(a,m,v)}),d}buildV3GetFiltersAsJson(r,d={}){return JSON.stringify(this.buildV3GetFilters(r,d))}buildV3GetFilterIdFromFilter(r){const d=r.filter?r.filter.href:r._links.filter.href;return this.idFromHref(d)}buildV3GetValuesFromFilter(r){return r.values?_.map(r.values,d=>this.queryFilterValueToParam(d)):_.map(r._links.values,d=>this.idFromHref(d.href))}buildV3GetOperatorIdFromFilter(r){if(r.operator)return r.operator.id||(0,n.Z)(r.operator.href);const{href:d}=r._links.operator;return this.idFromHref(d)}buildV3GetSortByFromQuery(r){const f=(r.sortBy?r.sortBy:r._links.sortBy).map(a=>{if(a.id)return a.id;const m=a.href;return this.idFromHref(m)});return JSON.stringify(f.map(a=>a.split("-")))}idFromHref(r){const d=r.substring(r.lastIndexOf("/")+1,r.length);return decodeURIComponent(d)}}i.\u0275fac=function(r){return new(r||i)(c.LFG(h.N))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})},85388:(te,M,t)=>{"use strict";t.d(M,{j:()=>r});var n=t(41945),e=t(8403),p=t(5602),h=t(44022),c=t(81134),i=t(10190),l=t(2316);class r extends e.m{constructor(f,a,m){super(f),this.injector=f,this.wpRelationsHierarchyService=a,this.schemaCache=m,this.referenceComponentClass=p.A,this.relationType="children",this.referenceTarget=null,this.buttonTexts={reference:this.I18n.t("js.relation_buttons.add_existing_child"),create:this.I18n.t("js.relation_buttons.add_new_child")}}add(f,a){return this.wpRelationsHierarchyService.addExistingChildWp(f,a)}remove(f,a){return this.wpRelationsHierarchyService.removeChild(a)}get canAdd(){return this.referenceTarget&&this.canAddChild?this.canCreateWorkPackages((0,i.Z)(this.referenceTarget.project.href)):(0,c.of)(!1)}get canReference(){return(0,c.of)(!!this.referenceTarget&&this.canAddChild)}get canAddChild(){var f;return!(!this.schema||this.schema.isMilestone||!(null===(f=this.referenceTarget)||void 0===f?void 0:f.changeParent))}get schema(){return this.referenceTarget&&this.schemaCache.of(this.referenceTarget)}}r.\u0275fac=function(f){return new(f||r)(l.LFG(l.zs3),l.LFG(n.O),l.LFG(h.y))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac})},74012:(te,M,t)=>{"use strict";t.d(M,{u:()=>E});var n=t(96617),e=t(70233),h=(t(24897),t(55977)),c=t(41945),i=t(23893),l=t(8403),r=t(97248),d=t(85388),f=t(9170),m=(t(17577),t(1403)),v=t(33276),C=t(10190),u=t(2316),k=t(54364),x=t(166);function b(T,O){if(1&T&&(u.TgZ(0,"div",4),u.TgZ(1,"div",5),u._UZ(2,"h3",6),u.qZA(),u.qZA()),2&T){const I=u.oxw(2);u.xp6(2),u.Q6J("textContent",I.group.name)}}const y=function(T){return{actionsColumnEnabled:!0,hierarchyToggleEnabled:!1,inlineCreateEnabled:!0,compactTableStyle:!0,columnMenuEnabled:!1,contextMenuEnabled:!1,projectIdentifier:T,projectContext:!1}};function P(T,O){if(1&T){const I=u.EpF();u.ynx(0),u.YNc(1,b,3,1,"div",1),u.TgZ(2,"wp-embedded-table",2,3),u.NdJ("onQueryLoaded",function(j){return u.CHM(I),u.oxw().handleQueryLoaded(j)}),u.qZA(),u.BQk()}if(2&T){const I=u.oxw();u.xp6(1),u.Q6J("ngIf",I.group),u.xp6(1),u.Q6J("initialLoadingIndicator",!1)("queryProps",I.queryProps)("tableActions",I.tableActions)("configuration",u.VKq(5,y,I.idFromLink(I.workPackage.project.href)))}}class E extends r.y{constructor(O,I,Z,j,B,J,R){super(J),this.wpRelationsHierarchyService=O,this.PathHelper=I,this.wpInlineCreate=Z,this.halEvents=j,this.apiV3Service=B,this.queryUrlParamsHelper=J,this.I18n=R,this.addExistingChildEnabled=!1,this.idFromLink=C.Z,this.tableActions=[i.g.factoryFor("remove-child-action",this.I18n.t("js.relation_buttons.remove_child"),F=>{this.embeddedTable&&(this.embeddedTable.loadingIndicator=this.wpRelationsHierarchyService.removeChild(F))},F=>!!F.changeParent)]}ngOnInit(){this.wpInlineCreate.referenceTarget=this.workPackage,this.queryProps=this.buildQueryProps(),this.wpInlineCreate.newInlineWorkPackageCreated.pipe(this.untilDestroyed()).subscribe(O=>{this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:O,relationType:"child"})}),this.apiV3Service.work_packages.id(this.workPackage).observe().pipe((0,f.h)(()=>{var O;return!!(null===(O=this.embeddedTable)||void 0===O?void 0:O.isInitialized)}),this.untilDestroyed()).subscribe(()=>this.refreshTable())}}E.\u0275fac=function(O){return new(O||E)(u.Y36(c.O),u.Y36(e.j),u.Y36(l.m),u.Y36(m.J),u.Y36(v.T),u.Y36(h.Z),u.Y36(n.D))},E.\u0275cmp=u.Xpm({type:E,selectors:[["wp-children-query"]],inputs:{workPackage:"workPackage",query:"query",group:"group",addExistingChildEnabled:"addExistingChildEnabled"},features:[u._Bn([{provide:l.m,useClass:d.j}]),u.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","attributes-group--header",4,"ngIf"],[3,"initialLoadingIndicator","queryProps","tableActions","configuration","onQueryLoaded"],["embeddedTable",""],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"]],template:function(O,I){1&O&&u.YNc(0,P,4,7,"ng-container",0),2&O&&u.Q6J("ngIf",!I.hidden)},directives:[k.O5,x.Z],encapsulation:2})},5602:(te,M,t)=>{"use strict";t.d(M,{A:()=>C});var n=t(96617),e=t(8403),p=t(84366),h=t(53457),c=t(55977),i=t(69057),l=t(1403),r=t(33276),d=t(62964),f=t(43440),a=t(2316),m=t(11950),v=t(2775);class C{constructor(k,x,b,y,P,E,T,O,I){this.parent=k,this.wpInlineCreate=x,this.apiV3Service=b,this.wpRelations=y,this.notificationService=P,this.halEvents=E,this.urlParamsHelper=T,this.querySpace=O,this.I18n=I,this.isDisabled=!1,this.queryFilters=this.buildQueryFilters(),this.text={abort:this.I18n.t("js.relation_buttons.abort")}}addExisting(){if(_.isNil(this.selectedWpId))return;const k=this.selectedWpId;this.isDisabled=!0,this.wpInlineCreate.add(this.workPackage,k).then(()=>{this.apiV3Service.work_packages.id(this.workPackage).refresh(),this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:k,relationType:this.relationType}),this.isDisabled=!1,this.wpInlineCreate.newInlineWorkPackageReferenced.next(k),this.cancel()}).catch(x=>{this.notificationService.handleRawError(x,this.workPackage),this.isDisabled=!1,this.cancel()})}onSelected(k){k&&(this.selectedWpId=k.id,this.addExisting())}get relationType(){return this.wpInlineCreate.relationType}get workPackage(){return this.wpInlineCreate.referenceTarget}cancel(){this.parent.resetRow()}buildQueryFilters(){const k=this.querySpace.query.value;if(!k)return[];const x=i.d.RELATION_TYPES(!0),b=k.filters.filter(y=>{const P=this.urlParamsHelper.buildV3GetFilterIdFromFilter(y);return-1===x.indexOf(P)});return this.urlParamsHelper.buildV3GetFilters(b)}}C.\u0275fac=function(k){return new(k||C)(a.Y36(p.I),a.Y36(e.m),a.Y36(r.T),a.Y36(h.V),a.Y36(d.q),a.Y36(l.J),a.Y36(c.Z),a.Y36(f.q),a.Y36(n.D))},C.\u0275cmp=a.Xpm({type:C,selectors:[["ng-component"]],decls:7,vars:4,consts:[["data-indicator-name","relationAddChild",1,"loading-indicator--location"],[1,"wp-relations-create--form","wp-relations--add-form"],[1,"wp-relations-input-section"],["hiddenOverflowContainer",".work-packages-full-view--split-left",3,"workPackage","additionalFilters","filterCandidatesFor","onSelected"],[1,"wp-relations-controls-section","relation-row"],["type","button",1,"spot-link","wp-create-relation--cancel",3,"click"],["icon-classes","icon-remove icon-no-color",3,"icon-title"]],template:function(k,x){1&k&&(a.TgZ(0,"div",0),a.TgZ(1,"div",1),a.TgZ(2,"div",2),a.TgZ(3,"wp-relations-autocomplete",3),a.NdJ("onSelected",function(y){return x.onSelected(y)}),a.qZA(),a.qZA(),a.TgZ(4,"div",4),a.TgZ(5,"button",5),a.NdJ("click",function(){return x.cancel()}),a._UZ(6,"op-icon",6),a.qZA(),a.qZA(),a.qZA(),a.qZA()),2&k&&(a.xp6(3),a.Q6J("workPackage",x.workPackage)("additionalFilters",x.queryFilters)("filterCandidatesFor",x.relationType),a.xp6(3),a.Q6J("icon-title",x.text.abort))},directives:[m.t,v.o],encapsulation:2})},32869:(te,M,t)=>{"use strict";t.d(M,{x:()=>d});var n=t(3786),e=t(8403),p=t(5602),h=t(53457),c=t(29161),i=t(81134),l=t(10190),r=t(2316);class d extends e.m{constructor(a){super(a),this.injector=a,this.referenceComponentClass=p.A,this.relationType="",this.referenceTarget=null,this.buttonTexts={reference:this.I18n.t("js.relation_buttons.add_existing"),create:this.I18n.t("js.relation_buttons.create_new")}}add(a,m){return this.wpRelations.addCommonRelation(m,this.relationType,a.id)}remove(a,m){const v=this.wpRelations.find(m,a,this.relationType);return void 0!==v?this.wpRelations.removeRelation(v):Promise.reject()}get canAdd(){var a;return(null===(a=this.referenceTarget)||void 0===a?void 0:a.addRelation)?this.canCreateWorkPackages((0,l.Z)(this.referenceTarget.project.href)):(0,i.of)(!1)}get canReference(){return this.canAdd}}d.\u0275fac=function(a){return new(a||d)(r.LFG(r.zs3))},d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac}),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.V)],d.prototype,"wpRelations",void 0)},97248:(te,M,t)=>{"use strict";t.d(M,{y:()=>l});t(166);var e=t(17577),p=t(55977),h=t(26942),c=t(2316);const i=["embeddedTable"];class l extends h.N{constructor(d){super(),this.queryUrlParamsHelper=d,this.hidden=!1}refreshTable(){var d;(null===(d=this.embeddedTable)||void 0===d?void 0:d.isInitialized)&&this.embeddedTable.loadQuery(!0,!1)}handleQueryLoaded(d){if(!(this.query instanceof e.P))return;const f=this.projectValuesCount(this.query),a=this.projectValuesCount(d);null!==f&&null===a&&(this.hidden=!0),f&&a&&f>0&&0===a&&(this.hidden=!0)}projectValuesCount(d){const f=d.filters.find(a=>"project"===a.id);return f?f.values.length:null}buildQueryProps(){return this.query instanceof e.P?this.queryUrlParamsHelper.buildV3GetQueryFromQueryResource(this.query,{valid_subset:!0},{id:this.workPackage.id}):this.query}}l.\u0275fac=function(d){return new(d||l)(c.Y36(p.Z))},l.\u0275dir=c.lG2({type:l,viewQuery:function(d,f){if(1&d&&c.Gf(i,5),2&d){let a;c.iGM(a=c.CRH())&&(f.embeddedTable=a.first)}},features:[c.qOj]})},11950:(te,M,t)=>{"use strict";t.d(M,{t:()=>u});var n=t(2316),e=t(96617),h=(t(24897),t(81134)),c=t(30400),i=t(33927),l=t(18293),r=t(43440),d=t(70233),f=t(65146),a=t(91923),m=t(44022),v=t(62964),C=t(91593);class u{constructor(x,b,y,P,E,T,O,I,Z){this.querySpace=x,this.pathHelper=b,this.notificationService=y,this.CurrentProject=P,this.halResourceService=E,this.schemaCacheService=T,this.cdRef=O,this.ngZone=I,this.I18n=Z,this.text={placeholder:this.I18n.t("js.relations_autocomplete.placeholder")},this.inputPlaceholder=this.text.placeholder,this.additionalFilters=[],this.hiddenOverflowContainer="body",this.onCancel=new n.vpe,this.onSelected=new n.vpe,this.onEmptySelected=new n.vpe,this.getAutocompleterData=j=>null===j||0===j.length?(0,h.of)([]):(0,c.D)(this.workPackage.availableRelationCandidates.$link.$fetch({query:j,filters:JSON.stringify(this.additionalFilters),type:this.filterCandidatesFor||this.selectedRelationType,sortBy:JSON.stringify([["typeahead","asc"]])})).pipe((0,i.U)(B=>B.elements),(0,l.K)(B=>(this.notificationService.handleRawError(B),(0,h.of)([])))),this.autocompleterOptions={resource:"work_packages",getOptionsFn:this.getAutocompleterData},this.appendToContainer="body"}reset(){this.cancel()}cancel(){this.onCancel.emit()}onWorkPackageSelected(x){x&&this.schemaCacheService.ensureLoaded(x).then(()=>{this.onSelected.emit(x),this.ngSelectComponent.ngSelectInstance.close()})}onOpen(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.ngSelectComponent.repositionDropdown(),jQuery(this.hiddenOverflowContainer).one("scroll",()=>{this.ngSelectComponent.closeSelect()})},25)})}}u.\u0275fac=function(x){return new(x||u)(n.Y36(r.q),n.Y36(d.j),n.Y36(v.q),n.Y36(f.R),n.Y36(a.u),n.Y36(m.y),n.Y36(n.sBO),n.Y36(n.R0b),n.Y36(e.D))},u.\u0275cmp=n.Xpm({type:u,selectors:[["wp-relations-autocomplete"]],viewQuery:function(x,b){if(1&x&&n.Gf(C.s,7),2&x){let y;n.iGM(y=n.CRH())&&(b.ngSelectComponent=y.first)}},hostBindings:function(x,b){1&x&&n.NdJ("keydown.escape",function(){return b.reset()})},inputs:{inputPlaceholder:"inputPlaceholder",workPackage:"workPackage",selectedRelationType:"selectedRelationType",filterCandidatesFor:"filterCandidatesFor",additionalFilters:"additionalFilters",hiddenOverflowContainer:"hiddenOverflowContainer"},outputs:{onCancel:"onCancel",onSelected:"onSelected",onEmptySelected:"onEmptySelected"},decls:1,vars:6,consts:[["classes","wp-relations-autocomplete","data-qa-selector","wp-relations-autocomplete",3,"appendTo","placeholder","typeToSearchText","resource","defaultData","getOptionsFn","open","change"]],template:function(x,b){1&x&&(n.TgZ(0,"op-autocompleter",0),n.NdJ("open",function(){return b.onOpen()})("change",function(P){return b.onWorkPackageSelected(P)}),n.qZA()),2&x&&n.Q6J("appendTo",b.appendToContainer)("placeholder",b.inputPlaceholder)("typeToSearchText",b.inputPlaceholder)("resource",b.autocompleterOptions.resource)("defaultData",!1)("getOptionsFn",b.autocompleterOptions.getOptionsFn)},directives:[C.s],styles:[".wp-relations-autocomplete{border:none}.wp-relations-autocomplete .ng-clear-wrapper{display:none}\n"],encapsulation:2})},41945:(te,M,t)=>{"use strict";t.d(M,{O:()=>r});var n=t(87853),e=t(47775),p=t(70233),h=t(62964),c=t(33276),i=t(1403),l=t(2316);class r{constructor(f,a,m,v,C,u){this.$state=f,this.states=a,this.halEvents=m,this.notificationService=v,this.pathHelper=C,this.apiV3Service=u}changeParent(f,a){const m={lockVersion:f.lockVersion};return m._links=a?{parent:{href:this.apiV3Service.work_packages.id(a).path}}:{parent:{href:null}},f.changeParent(m).then(v=>(this.apiV3Service.work_packages.cache.updateWorkPackage(v),this.notificationService.showSave(v),this.halEvents.push(f,{eventType:"association",relatedWorkPackage:a,relationType:"parent"}),v)).catch(v=>(this.notificationService.handleRawError(v,f),Promise.reject(v)))}removeParent(f){return this.changeParent(f,null)}addExistingChildWp(f,a){return this.apiV3Service.work_packages.id(a).get().toPromise().then(m=>this.changeParent(m,f.id).then(v=>(this.apiV3Service.work_packages.id(f).refresh(),this.halEvents.push(f,{eventType:"association",relatedWorkPackage:m.id,relationType:"child"}),v)))}addNewChildWp(f,a){a.project.$load().then(()=>{const m=[`${f}.new`,{parent_id:a.id}];this.$state.includes("work-packages.show")&&(m[0]="work-packages.new"),this.$state.go(...m)})}removeChild(f){return f.$load().then(()=>{const a=f.parent;return f.changeParent({_links:{parent:{href:null}},lockVersion:f.lockVersion}).then(m=>{a&&this.apiV3Service.work_packages.id(a).refresh().then(v=>{this.halEvents.push(v,{eventType:"association",relatedWorkPackage:null,relationType:"child"})}),this.apiV3Service.work_packages.cache.updateWorkPackage(m)}).catch(m=>(this.notificationService.handleRawError(m,f),Promise.reject(m)))})}}r.\u0275fac=function(f){return new(f||r)(l.LFG(e.StateService),l.LFG(n.G),l.LFG(i.J),l.LFG(h.q),l.LFG(p.j),l.LFG(c.T))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac})},53457:(te,M,t)=>{"use strict";t.d(M,{V:()=>f});var n=t(70233),e=t(14808),p=t(91923),h=t(33276),c=t(79175),i=t(53466),l=t(33927),r=t(2316);class d extends e.Ui{constructor(){super(),this.name="WP-Relations",this.relations=(0,e.r9)(),this.initializeMembers()}}class f extends c.r{constructor(m,v,C){super((new d).relations),this.PathHelper=m,this.apiV3Service=v,this.halResource=C}require(m,v=!1){return this.requireAndStream(m,v).pipe((0,i.q)(1)).toPromise()}requireAndStream(m,v=!1){return(this.stale(m)||v)&&this.clearAndLoad(m,this.load(m)),this.state(m).values$()}load(m){return this.apiV3Service.work_packages.id(m).relations.get().pipe((0,l.U)(v=>this.relationsStateValue(m,v.elements)))}requireAll(m){return new Promise((v,C)=>{this.apiV3Service.relations.loadInvolved(m).toPromise().then(u=>{this.clearSome(...m),this.accumulateRelationsFromInvolved(m,u),v(void 0)}).catch(C)})}find(m,v,C){const u=this.state(m.id).value;if(u)return _.find(u,k=>{const x=k.denormalized(m);return x.target.id===v.id&&x.relationType===C})}removeRelation(m){return m.delete().then(()=>{this.removeFromStates(m)})}updateRelationType(m,v,C,u){const k={_links:{from:{href:m.href},to:{href:v.href}},type:u};return this.updateRelation(C,k)}updateRelation(m,v){return m.updateImmediately(v).then(C=>(this.insertIntoStates(C),C))}addCommonRelation(m,v,C){const u={_links:{from:{href:this.apiV3Service.work_packages.id(m).toString()},to:{href:this.apiV3Service.work_packages.id(C).toString()}},type:v},k=this.apiV3Service.work_packages.id(m).relations.toString();return this.halResource.post(k,u).toPromise().then(x=>(this.insertIntoStates(x),x))}insertIntoStates(m){_.values(m.ids).forEach(v=>{this.multiState.get(v).doModify(C=>(C[m.id]=m,C),()=>{const C={};return C[m.id]=m,C})})}removeFromStates(m){_.values(m.ids).forEach(v=>{this.multiState.get(v).doModify(C=>(delete C[m.id],C),()=>({}))})}relationsStateValue(m,v){return _.keyBy(v,C=>C.id)}accumulateRelationsFromInvolved(m,v){m.forEach(C=>{const u=v.filter(x=>x.isInvolved(C)),k=this.relationsStateValue(C,u);this.updateValue(C,k)})}}f.\u0275fac=function(m){return new(m||f)(r.LFG(n.j),r.LFG(h.T),r.LFG(p.u))},f.\u0275prov=r.Yz7({token:f,factory:f.\u0275fac})},54892:(te,M,t)=>{"use strict";t.d(M,{a:()=>i});var n=t(12877),e=t(61289),p=t(70692);class h{constructor(r,d,f,a,m){this.timezoneService=r,this.isReversed=d,this.activities=f,this.activity=a,this.index=m,this.date=this.activityDate(this.activity),this.dateOfPrevious=this.index>0?this.activityDate(this.activities[this.index-1]):void 0,this.isNextDate=this.date!==this.dateOfPrevious}number(r=!1){return this.orderedIndex(this.index,r)}get href(){return this.activity.href}get identifier(){return`${this.href}-${this.version}-${this.updatedAt}`}get version(){return this.activity.version}get updatedAt(){return this.activity.updatedAt}isInitial(r=!1){let d=this.number(r);if(0!==this.activity._type.indexOf("Activity"))return!1;if(1===d)return!0;for(;--d>0;){const f=this.orderedIndex(d,r)-1,a=this.activities[f];if(!_.isNil(a)&&0===a._type.indexOf("Activity"))return!1}return!0}activityDate(r){return moment(r.createdAt).format("LL")}orderedIndex(r,d=!1){return d||this.isReversed?this.activities.length-r:r+1}}var c=t(2316);class i extends e.N{constructor(r,d){super(),this.ConfigurationService=r,this.timezoneService=d}get order(){return this.isReversed?"desc":"asc"}get isReversed(){return!!this.ConfigurationService.commentsSortedInDescendingOrder()}load(r){const d=[],f=[],a=function(m){d.push(m.elements)};return f.push(r.activities.$update().then(a)),r.revisions&&f.push(r.revisions.$update().then(a)),Promise.all(f).then(()=>this.sortedActivityList(d))}sortedActivityList(r,d="createdAt"){const f=_.sortBy(_.flatten(r),d);return this.isReversed?f.reverse():f}info(r,d,f){return new h(this.timezoneService,this.isReversed,r,d,f)}}i.\u0275fac=function(r){return new(r||i)(c.LFG(n.e),c.LFG(p.B))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac})},84109:(te,M,t)=>{"use strict";t.d(M,{p:()=>c});var n=t(47775),e=t(84224),p=t(70482),h=t(2316);class c{constructor(l,r,d){this.$state=l,this.uiRouterGlobals=r,this.$transitions=d,this.currentTab="overview",this.subject=new e.t(1),this.updateTabs(),d.onSuccess({},f=>{this.updateTabs(f.params("to").tabIdentifier)})}get observable(){return this.subject}get lastActiveTab(){return this.isCurrentState("show")?this.currentShowTab:this.currentDetailsTab}goCurrentShowState(l={}){this.$state.go("work-packages.show.tabs",Object.assign(Object.assign(Object.assign({},this.uiRouterGlobals.params),l),{tabIdentifier:this.currentShowTab}))}goCurrentDetailsState(l={}){const r=(0,p.W)(this.$state);this.$state.go(`${r}.tabs`,Object.assign(Object.assign(Object.assign({},this.uiRouterGlobals.params),l),{tabIdentifier:this.currentDetailsTab}))}isDetailsState(l){return!!l&&l.includes(".details")}get currentShowTab(){return"overview"===this.currentTab?"activity":this.currentTab}get currentDetailsTab(){return this.currentTab}get currentTabIdentifier(){return this.uiRouterGlobals.params.tabIdentifier}notify(){this.subject.next({active:this.lastActiveTab,show:this.currentShowTab,details:this.currentDetailsTab})}updateTab(l){this.isCurrentState(l)&&(this.currentTab=this.uiRouterGlobals.params.tabIdentifier,this.notify())}isCurrentState(l){return"show"===l?this.$state.includes("work-packages.show.*"):"details"===l&&this.$state.includes("**.details.*")}updateTabs(l){if(this.isCurrentState("show")&&"activity"===l)return this.currentTab="overview",this.notify();this.updateTab("show"),this.updateTab("details")}}c.\u0275fac=function(l){return new(l||c)(h.LFG(n.StateService),h.LFG(n.UIRouterGlobals),h.LFG(n.TransitionService))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"})},18236:(te,M,t)=>{"use strict";t.d(M,{h:()=>C});var n=t(47775),e=t(86469),p=t(96617),h=t(84939),c=t(70233),i=t(43682),l=t(62964),r=t(26942),d=t(33276),f=t(2316);function a(u,k){if(1&u&&(f.TgZ(0,"div",8),f.TgZ(1,"div",9),f._UZ(2,"p",10),f.qZA(),f.qZA()),2&u){const x=f.oxw();f.xp6(2),f.Q6J("textContent",x.text.loadingError)}}function m(u,k){if(1&u&&f._UZ(0,"op-wp-watcher-entry",11),2&u){const x=k.$implicit;f.Q6J("watcher",x)}}const v=function(u){return{"-read-only":u}};class C extends r.N{constructor(k,x,b,y,P,E,T,O,I){super(),this.I18n=k,this.elementRef=x,this.wpWatchersService=b,this.$transition=y,this.notificationService=P,this.loadingIndicator=E,this.cdRef=T,this.pathHelper=O,this.apiV3Service=I,this.trackByHref=i.u9,this.error=!1,this.noResults=!1,this.allowedToView=!1,this.allowedToAdd=!1,this.allowedToRemove=!1,this.watching=[],this.text={loading:this.I18n.t("js.watchers.label_loading"),loadingError:this.I18n.t("js.watchers.label_error_loading"),autocomplete:{placeholder:this.I18n.t("js.watchers.typeahead_placeholder")}}}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.workPackageId=this.$transition.params("to").workPackageId,this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(k=>{this.workPackage=k,this.loadCurrentWatchers()}),this.availableWatchersPath=this.apiV3Service.work_packages.id(this.workPackageId).available_watchers.path}loadCurrentWatchers(){this.error=!1,this.allowedToView=!!this.workPackage.watchers,this.allowedToAdd=!!this.workPackage.addWatcher,this.allowedToRemove=!!this.workPackage.removeWatcher,this.allowedToView?this.wpWatchersService.require(this.workPackage).then(k=>{this.watching=k,this.cdRef.detectChanges()}).catch(k=>{this.notificationService.showError(k,this.workPackage)}):this.error=!0}set loadingPromise(k){this.loadingIndicator.wpDetails.promise=k}addWatcher(k){this.loadingPromise=this.workPackage.addWatcher.$link.$fetch({user:{href:k.href}}).then(()=>{this.wpWatchersService.require(this.workPackage,!0),this.apiV3Service.work_packages.id(this.workPackage).refresh(),this.cdRef.detectChanges()}).catch(x=>this.notificationService.showError(x,this.workPackage))}removeWatcher(k){this.workPackage.removeWatcher.$link.$prepare({user_id:k.id})().then(()=>{_.remove(this.watching,x=>x.href===k.href),this.wpWatchersService.require(this.workPackage,!0),this.apiV3Service.work_packages.id(this.workPackage).refresh(),this.cdRef.detectChanges()}).catch(x=>this.notificationService.showError(x,this.workPackage))}}C.\u0275fac=function(k){return new(k||C)(f.Y36(p.D),f.Y36(f.SBq),f.Y36(h.W),f.Y36(n.Transition),f.Y36(l.q),f.Y36(e.vt),f.Y36(f.sBO),f.Y36(c.j),f.Y36(d.T))},C.\u0275cmp=f.Xpm({type:C,selectors:[["wp-watchers-tab"]],features:[f.qOj],decls:8,vars:10,consts:[["id","detail-panel-watchers"],["class","op-toast -error",4,"ngIf"],[3,"hidden"],[1,"work-package--watchers","form--selected-value--list",3,"ngClass"],[3,"watcher",4,"ngFor","ngForOf","ngForTrackBy"],[1,"work-package--watchers-lookup","hide-when-print",3,"hidden"],["name","watcherForm","novalidate",""],["appendTo","body",1,"wp-watcher--autocomplete",3,"clearAfterSelection","url","valueChange"],[1,"op-toast","-error"],[1,"op-toast--content"],[3,"textContent"],[3,"watcher"]],template:function(k,x){1&k&&(f.TgZ(0,"div",0),f.YNc(1,a,3,1,"div",1),f.TgZ(2,"div",2),f.TgZ(3,"div",3),f.YNc(4,m,1,1,"op-wp-watcher-entry",4),f.qZA(),f.TgZ(5,"div",5),f.TgZ(6,"form",6),f.TgZ(7,"op-user-autocompleter",7),f.NdJ("valueChange",function(y){return x.addWatcher(y)}),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA()),2&k&&(f.xp6(1),f.Q6J("ngIf",x.error),f.xp6(1),f.Q6J("hidden",x.error),f.xp6(1),f.Q6J("ngClass",f.VKq(8,v,!x.allowedToRemove)),f.xp6(1),f.Q6J("ngForOf",x.watching)("ngForTrackBy",x.trackByHref),f.xp6(1),f.Q6J("hidden",!x.allowedToAdd),f.xp6(2),f.Q6J("clearAfterSelection",!0)("url",x.availableWatchersPath))},encapsulation:2,changeDetection:0})},84939:(te,M,t)=>{"use strict";t.d(M,{W:()=>p});var n=t(61289),e=t(2316);class p extends n.N{load(c){return c.watchers.$update().then(i=>i.elements)}}p.\u0275fac=function(){let h;return function(i){return(h||(h=e.n5z(p)))(i||p)}}(),p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac})},61289:(te,M,t)=>{"use strict";t.d(M,{N:()=>c});var n=t(14808),e=t(53466),p=t(81134);t(19100).hi;class c{constructor(){this.cacheDurationInSeconds=120,this.cache={id:null,state:(0,n.qH)()}}requireAndStream(l,r=!1){const d=l.id,{state:f}=this.cache;return(r||this.cache.id!==d)&&f.clear(),this.isCached(d)?(0,p.of)(f.value):(this.cache.id=d,this.cache.state.putFromPromiseIfPristine(()=>this.load(l)),this.cache.state.values$())}require(l,r=!1){return this.requireAndStream(l,r).pipe((0,e.q)(1)).toPromise()}clear(l){this.cache.id===l&&this.cache.state.clear()}isCached(l){const{state:r}=this.cache;return this.cache.id===l&&r.hasValue()&&!r.isValueOlderThan(1e3*this.cacheDurationInSeconds)}}},77180:(te,M,t)=>{"use strict";t.d(M,{G:()=>mt});var n=t(47775),e=t(96617),p=t(70233),h=t(83720),c=t(33927),l=(t(24897),t(12703)),r=t(60874),d=t(17577),f=t(53448),a=t(79441),m=t(68197),v=t(1056),C=t(91923),u=t(10190),k=t(84699),x=t(26942),b=t(65146),y=t(87853),P=t(44022),E=t(3352),T=t(2316),O=t(54364),I=t(33276),j=(t(53407),t(1403)),B=t(62964),J=t(54892);class R{constructor(Fe,Te,tt,ut,Yt,It,Nt){this.halResourceService=Fe,this.apiV3Service=Te,this.wpSchemaCacheService=tt,this.wpActivity=ut,this.notificationService=Yt,this.halEditing=It,this.halEvents=Nt}fetchAction(){null!==this.action.href&&this.halResourceService.get(this.action.href).toPromise().then(Fe=>{this.action=Fe})}get change(){return this.halEditing.changeFor(this.workPackage)}update(){if(null===this.action.href)return;const Fe={lockVersion:this.workPackage.lockVersion,_links:{workPackage:{href:this.workPackage.href}}};this.change.inFlight=!0,this.halResourceService.post(`${this.action.href}/execute`,Fe).subscribe(Te=>{this.notificationService.showSave(Te,!1),this.workPackage=Te,this.wpActivity.clear(this.workPackage.id),this.apiV3Service.work_packages.cache.updateWorkPackage(Te).then(()=>{this.halEditing.stopEditing(Te),this.halEvents.push(Te,{eventType:"updated"}),this.change.inFlight=!1})},Te=>{this.notificationService.handleRawError(Te,this.workPackage),this.change.inFlight=!1})}onMouseEnter(){this.fetchAction()}}function F(Ue,Fe){if(1&Ue&&T._UZ(0,"wp-custom-action",1),2&Ue){const Te=Fe.$implicit,tt=T.oxw();T.Q6J("workPackage",tt.workPackage)("action",Te)}}R.\u0275fac=function(Fe){return new(Fe||R)(T.Y36(C.u),T.Y36(I.T),T.Y36(P.y),T.Y36(J.a),T.Y36(B.q),T.Y36(l.l),T.Y36(j.J))},R.\u0275cmp=T.Xpm({type:R,selectors:[["wp-custom-action"]],hostBindings:function(Fe,Te){1&Fe&&T.NdJ("mouseenter",function(){return Te.onMouseEnter()})},inputs:{workPackage:"workPackage",action:"action"},decls:2,vars:3,consts:[[1,"custom-action--button","button","-narrow","hide-when-print",3,"title","disabled","click"]],template:function(Fe,Te){1&Fe&&(T.TgZ(0,"button",0),T.NdJ("click",function(){return Te.update()}),T._uU(1),T.qZA()),2&Fe&&(T.s9C("title",Te.action.description?Te.action.description:Te.action.name),T.Q6J("disabled",Te.change.inFlight),T.xp6(1),T.hij(" ",Te.action.name,"\n"))},encapsulation:2,changeDetection:0});class Y extends x.N{constructor(Fe,Te){super(),this.apiV3Service=Fe,this.cdRef=Te,this.actions=[]}ngOnInit(){this.apiV3Service.work_packages.id(this.workPackage.id).requireAndStream().pipe(this.untilDestroyed()).subscribe(Fe=>{this.actions=Fe.customActions?[...Fe.customActions]:[],this.cdRef.detectChanges()})}}Y.\u0275fac=function(Fe){return new(Fe||Y)(T.Y36(I.T),T.Y36(T.sBO))},Y.\u0275cmp=T.Xpm({type:Y,selectors:[["wp-custom-actions"]],inputs:{workPackage:"workPackage"},features:[T.qOj],decls:1,vars:1,consts:[["class","custom-action",3,"workPackage","action",4,"ngFor","ngForOf"],[1,"custom-action",3,"workPackage","action"]],template:function(Fe,Te){1&Fe&&T.YNc(0,F,1,2,"wp-custom-action",0),2&Fe&&T.Q6J("ngForOf",Te.actions)},directives:[O.sg,R],encapsulation:2,changeDetection:0});var X=t(54262),K=t(96418),ie=t(83845),H=t(65532),ee=t(21501),ce=t(35403),se=t(32853),re=t(97047),Me=t(2775),Ae=t(84906);function Ye(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",17),T._UZ(1,"op-editable-attribute-field",18),T.qZA()),2&Ue){const Te=T.oxw(2);T.xp6(1),T.Q6J("resource",Te.workPackage)("wrapperClasses","-no-label")("fieldName","subject")}}function ze(Ue,Fe){if(1&Ue&&T._UZ(0,"wp-status-button",19),2&Ue){const Te=T.oxw(2);T.Q6J("workPackage",Te.workPackage)}}function Xe(Ue,Fe){1&Ue&&T._UZ(0,"attribute-help-text",20),2&Ue&&T.Q6J("attribute","status")("attributeScope","WorkPackage")}function it(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",21),T._UZ(1,"span",22),T._uU(2,": "),T._UZ(3,"span",22),T.TgZ(4,"span"),T._uU(5,"\xa0"),T.qZA(),T._UZ(6,"op-user-link",23),T.TgZ(7,"span"),T._uU(8,".\xa0"),T.qZA(),T._UZ(9,"span",22),T.TgZ(10,"span"),T._uU(11,"\xa0"),T.qZA(),T._UZ(12,"op-date-time",24),T.TgZ(13,"span"),T._uU(14,"."),T.qZA(),T.qZA()),2&Ue){const Te=T.oxw(2);T.xp6(1),T.Q6J("textContent",Te.idLabel),T.xp6(2),T.Q6J("textContent",Te.text.infoRow.createdBy),T.xp6(3),T.Q6J("user",Te.workPackage.author),T.xp6(3),T.Q6J("textContent",Te.text.infoRow.lastUpdatedOn),T.xp6(3),T.Q6J("dateTimeValue",Te.workPackage.updatedAt)}}function at(Ue,Fe){1&Ue&&(T.TgZ(0,"span",34),T._uU(1,"*"),T.qZA())}const lt=function(Ue){return{"-span-all-columns":Ue}};function dt(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",28),T.TgZ(1,"div",29),T.TgZ(2,"wp-replacement-label",30),T._uU(3),T.YNc(4,at,2,0,"span",31),T.qZA(),T._UZ(5,"attribute-help-text",20),T.qZA(),T.TgZ(6,"div",32),T._UZ(7,"op-editable-attribute-field",33),T.qZA(),T.qZA()),2&Ue){const Te=Fe.$implicit,tt=T.oxw(3);T.Q6J("ngClass",T.VKq(8,lt,Te.spanAll)),T.xp6(2),T.Q6J("fieldName",Te.name),T.xp6(1),T.hij(" ",Te.label," "),T.xp6(1),T.Q6J("ngIf",Te.field.required&&Te.field.writable),T.xp6(1),T.Q6J("attribute",Te.name)("attributeScope","WorkPackage"),T.xp6(2),T.Q6J("resource",tt.workPackage)("fieldName",Te.name)}}function de(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",25),T.TgZ(1,"div"),T._UZ(2,"p",26),T.YNc(3,dt,8,10,"div",27),T.qZA(),T.qZA()),2&Ue){const Te=T.oxw(2);T.xp6(2),T.Q6J("textContent",Te.text.project.required),T.xp6(1),T.Q6J("ngForOf",Te.projectContext.field)("ngForTrackBy",Te.trackByName)}}function oe(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",35),T.TgZ(1,"div"),T.TgZ(2,"p"),T._UZ(3,"span",36),T._UZ(4,"br"),T._UZ(5,"a",37),T.qZA(),T.qZA(),T.qZA()),2&Ue){const Te=T.oxw(2);T.xp6(3),T.Q6J("innerHTML",Te.projectContextText,T.oJD),T.xp6(2),T.Q6J("textContent",Te.text.project.switchTo),T.uIk("href",Te.projectContext.href,T.LSH)}}const D=function(Ue){return{workPackage:Ue}};function G(Ue,Fe){if(1&Ue&&(T.ynx(0),T._UZ(1,"ndc-dynamic",38),T.BQk()),2&Ue){const Te=Fe.$implicit,tt=T.oxw(2);T.xp6(1),T.Q6J("ndcDynamicComponent",Te)("ndcDynamicInputs",T.VKq(2,D,tt.workPackage))}}const V=function(Ue,Fe,Te){return{workPackage:Ue,group:Fe,query:Te}};function me(Ue,Fe){if(1&Ue&&(T.ynx(0,42),T._UZ(1,"ndc-dynamic",38),T.BQk()),2&Ue){const Te=T.oxw().$implicit,tt=T.oxw(2);T.xp6(1),T.Q6J("ndcDynamicComponent",tt.attributeGroupComponent(Te))("ndcDynamicInputs",T.kEZ(2,V,tt.workPackage,Te,Te.query))}}const $=function(Ue,Fe){return{workPackage:Ue,group:Fe}};function Se(Ue,Fe){if(1&Ue&&(T.ynx(0),T.TgZ(1,"div",43),T.TgZ(2,"div",44),T._UZ(3,"h3",45),T.qZA(),T.qZA(),T._UZ(4,"ndc-dynamic",46),T.BQk()),2&Ue){const Te=T.oxw().$implicit,tt=T.oxw(2);T.xp6(3),T.Q6J("textContent",Te.name),T.xp6(1),T.Q6J("ndcDynamicComponent",tt.attributeGroupComponent(Te))("ndcDynamicInjector",tt.injector)("ndcDynamicInputs",T.WLB(4,$,tt.workPackage,Te))}}function ot(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",39),T.YNc(1,me,2,6,"ng-container",40),T.YNc(2,Se,5,7,"ng-container",41),T.qZA()),2&Ue){const Te=Fe.$implicit,tt=T.oxw(2);T.Q6J("hidden",tt.shouldHideGroup(Te))("ngClass","__overflowing_"+Te.id),T.uIk("data-group-name",Te.name)("data-overflowing-identifier",".__overflowing_"+Te.id),T.xp6(1),T.Q6J("ngIf",Te.isolated),T.xp6(1),T.Q6J("ngIf",!Te.isolated)}}const st=function(Ue){return{"work-package--single-view_with-columns":Ue}};function he(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",3),T.YNc(1,Ye,2,3,"div",4),T.TgZ(2,"div",5),T.YNc(3,ze,1,1,"wp-status-button",6),T.YNc(4,Xe,1,2,"attribute-help-text",7),T.YNc(5,it,15,5,"div",8),T._UZ(6,"wp-custom-actions",9),T.qZA(),T.YNc(7,de,4,3,"div",10),T.YNc(8,oe,6,3,"div",11),T.YNc(9,G,2,4,"ng-container",12),T.TgZ(10,"div",13),T.TgZ(11,"div",14),T._UZ(12,"op-editable-attribute-field",15),T.qZA(),T.qZA(),T.YNc(13,ot,3,6,"div",16),T.qZA()),2&Ue){const Te=T.oxw();T.Q6J("ngClass",T.VKq(15,st,Te.showTwoColumnLayout())),T.xp6(1),T.Q6J("ngIf",Te.isNewResource),T.xp6(2),T.Q6J("ngIf",!Te.isNewResource),T.xp6(1),T.Q6J("ngIf",!Te.isNewResource),T.xp6(1),T.Q6J("ngIf",!Te.isNewResource),T.xp6(1),T.Q6J("workPackage",Te.workPackage),T.xp6(1),T.Q6J("ngIf",Te.projectContext&&Te.projectContext.field),T.xp6(1),T.Q6J("ngIf",!Te.isNewResource&&Te.projectContext&&!Te.projectContext.matches),T.xp6(1),T.Q6J("ngForOf",Te.prependedAttributeGroupComponents()),T.xp6(3),T.Q6J("fieldName","description")("resource",Te.workPackage)("isDropTarget",!0)("wrapperClasses","-no-label"),T.xp6(1),T.Q6J("ngForOf",Te.groupedFields)("ngForTrackBy",Te.trackByName)}}const ye=function(Ue){return{resource:Ue}};function xe(Ue,Fe){if(1&Ue&&T._UZ(0,"ndc-dynamic",38),2&Ue){const Te=T.oxw(2);T.Q6J("ndcDynamicComponent",Te.attachmentUploadComponent())("ndcDynamicInputs",T.VKq(2,ye,Te.workPackage))}}function De(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",47),T.TgZ(1,"div",48),T.TgZ(2,"div",43),T.TgZ(3,"div",44),T._UZ(4,"h3",45),T.qZA(),T.qZA(),T._UZ(5,"ndc-dynamic",38),T.YNc(6,xe,1,4,"ndc-dynamic",49),T.qZA(),T.qZA()),2&Ue){const Te=T.oxw();T.xp6(4),T.Q6J("textContent",Te.text.attachments.label),T.xp6(1),T.Q6J("ndcDynamicComponent",Te.attachmentListComponent())("ndcDynamicInputs",T.VKq(4,ye,Te.workPackage)),T.xp6(1),T.Q6J("ngIf",Te.workPackage.canAddAttachments)}}const Qe=function(Ue){return{workPackageId:Ue,tabIdentifier:"files"}};function Ve(Ue,Fe){if(1&Ue&&(T.TgZ(0,"div",50),T.TgZ(1,"div",51),T.TgZ(2,"div",43),T.TgZ(3,"div",44),T._UZ(4,"h3",45),T.qZA(),T.qZA(),T.TgZ(5,"div",52),T._UZ(6,"op-icon",53),T._UZ(7,"span",22),T._UZ(8,"a",54),T.qZA(),T.qZA(),T.qZA()),2&Ue){const Te=T.oxw();T.xp6(4),T.Q6J("textContent",Te.text.files.label),T.xp6(3),T.Q6J("textContent",Te.text.files.migration_help),T.xp6(1),T.Q6J("textContent",Te.text.files.label)("uiSref",Te.uiSelfRef)("uiParams",T.VKq(5,Qe,Te.workPackage.id))}}class mt extends x.N{constructor(Fe,Te,tt,ut,Yt,It,Nt,wt,zt,Kt,ei,Rt,Mt,Ot){super(),this.I18n=Fe,this.currentProject=Te,this.PathHelper=tt,this.$state=ut,this.states=Yt,this.halEditing=It,this.halResourceService=Nt,this.displayFieldService=wt,this.schemaCache=zt,this.hook=Kt,this.injector=ei,this.cdRef=Rt,this.elementRef=Mt,this.browserDetector=Ot,this.showProject=!1,this.groupedFields=[],this.resourceContextChange=new a.xQ,this.text={attachments:{label:this.I18n.t("js.label_attachments")},files:{label:this.I18n.t("js.work_packages.tabs.files"),migration_help:this.I18n.t("js.work_packages.tabs.files_tab_migration_help")},project:{required:this.I18n.t("js.project.required_outside_context"),context:this.I18n.t("js.project.context"),switchTo:this.I18n.t("js.project.click_to_switch_context")},fields:{description:this.I18n.t("js.work_packages.properties.description")},infoRow:{createdBy:this.I18n.t("js.label_created_by"),lastUpdatedOn:this.I18n.t("js.label_last_updated_on")}},this.firstTimeFocused=!1}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.isNewResource=(0,k.Z)(this.workPackage),this.uiSelfRef=this.$state.$current.name;const Fe=this.halEditing.changeFor(this.workPackage);this.resourceContextChange.next(this.contextFrom(Fe.projectedResource)),this.refresh(Fe),this.resourceContextChange.pipe(this.untilDestroyed(),(0,h.x)((Te,tt)=>_.isEqual(Te,tt)),(0,c.U)(()=>this.halEditing.changeFor(this.workPackage))).subscribe(Te=>this.refresh(Te)),this.halEditing.temporaryEditResource(this.workPackage).values$().pipe(this.untilDestroyed()).subscribe(Te=>{this.resourceContextChange.next(this.contextFrom(Te))})}refresh(Fe){const Te=(0,k.Z)(this.workPackage),tt=Fe.projectedResource;tt.project?this.projectContext={href:this.PathHelper.projectWorkPackagePath((0,u.Z)(tt.project.href),this.workPackage.id),matches:tt.project.href===this.currentProject.apiv3Path}:this.projectContext={matches:!1,href:null},Te&&!this.currentProject.inProjectContext&&(this.projectContext.field=this.getFields(Fe,["project"]));const ut=this.schema(tt)._attributeGroups;this.groupedFields=this.rebuildGroupedFields(Fe,ut),this.cdRef.detectChanges()}shouldHideGroup(Fe){const Te=0===Fe.members.length,tt=(0,k.Z)(this.workPackage)&&!!Fe.query;return Te||tt}trackByName(Fe,Te){return Te.name}prependedAttributeGroupComponents(){return this.hook.call("prependedAttributeGroups",this.workPackage)}attributeGroupComponent(Fe){return this.hook.call("attributeGroupComponent",Fe,this.workPackage).pop()||null}attachmentListComponent(){return this.hook.call("workPackageAttachmentListComponent",this.workPackage).pop()||null}attachmentUploadComponent(){return this.hook.call("workPackageAttachmentUploadComponent",this.workPackage).pop()||null}get idLabel(){return`#${this.workPackage.id||""}`}get projectContextText(){const Fe=(0,u.Z)(this.workPackage.project.href),tt=`<a href="${this.PathHelper.projectPath(Fe)}">${this.workPackage.project.name}<a>`;return this.I18n.t("js.project.work_package_belongs_to",{projectname:tt})}showTwoColumnLayout(){return this.$element[0].getBoundingClientRect().width>750}rebuildGroupedFields(Fe,Te){return Te?Te.map(tt=>{const ut=this.getAttributesGroupId(tt);return"WorkPackageFormAttributeGroup"===tt._type?{name:tt.name,id:ut||(0,m.O)(16),members:this.getFields(Fe,tt.attributes),type:tt._type,isolated:!1}:{name:tt.name,id:ut||(0,m.O)(16),query:this.halResourceService.createHalResourceOfClass(d.P,tt._embedded.query),relationType:tt.relationType,members:[tt._embedded.query],type:tt._type,isolated:!0}}):[]}getFields(Fe,Te){const tt=[];return Te.forEach(ut=>{if("date"===ut)return void tt.push(this.getDateField(Fe));if(!Fe.schema.ofProperty(ut))return void(0,E.qu)("Unknown field for current schema",ut);const Yt=this.displayField(Fe,ut);tt.push({name:ut,label:Yt.label,multiple:!1,spanAll:Yt.isFormattable,field:Yt})}),tt}getDateField(Fe){const Te={name:"",label:this.I18n.t("js.work_packages.properties.date"),spanAll:!1,multiple:!1};return Fe.schema.ofProperty("date")?(Te.field=this.displayField(Fe,"date"),Te.name="date"):(Te.field=this.displayField(Fe,"combinedDate"),Te.name="combinedDate"),Te}contextFrom(Fe){const Te=this.schema(Fe);let tt;const ut=Fe.project&&Fe.project.href;return tt=Te.baseSchema?Te.baseSchema.href:Te.href,{isNew:Fe.isNew,schema:tt,project:ut}}displayField(Fe,Te){return this.displayFieldService.getField(Fe.projectedResource,Te,Fe.schema.ofProperty(Te),{container:"single-view",injector:this.injector,options:{}})}getAttributesGroupId(Fe){const Te=this.$element.find(`[data-group-name='${Fe.name}']`).data("overflowingIdentifier");return Te?Te.replace(".__overflowing_",""):""}schema(Fe){return this.halEditing.typedState(Fe).hasValue()?this.halEditing.typedState(this.workPackage).value.schema:this.schemaCache.of(Fe)}}mt.\u0275fac=function(Fe){return new(Fe||mt)(T.Y36(e.D),T.Y36(b.R),T.Y36(p.j),T.Y36(n.StateService),T.Y36(y.G),T.Y36(l.l),T.Y36(C.u),T.Y36(r.i),T.Y36(P.y),T.Y36(f.$),T.Y36(T.zs3),T.Y36(T.sBO),T.Y36(T.SBq),T.Y36(v.o))},mt.\u0275cmp=T.Xpm({type:mt,selectors:[["wp-single-view"]],inputs:{workPackage:"workPackage",showProject:"showProject"},features:[T.qOj],decls:3,vars:3,consts:[["class","work-package--single-view","data-selector","wp-single-view",3,"ngClass",4,"ngIf"],["class","work-packages--attachments attributes-group",4,"ngIf"],["class","work-packages--files attributes-group",4,"ngIf"],["data-selector","wp-single-view",1,"work-package--single-view",3,"ngClass"],["class","wp-new--subject-wrapper",4,"ngIf"],[1,"wp-info-wrapper"],[3,"workPackage",4,"ngIf"],[3,"attribute","attributeScope",4,"ngIf"],["class","work-packages--info-row",4,"ngIf"],[1,"custom-actions",3,"workPackage"],["class","attributes-group -project-context __overflowing_element_container __overflowing_project_context","data-overflowing-identifier",".__overflowing_project_context",4,"ngIf"],["class","attributes-group -project-context hide-when-print",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"attributes-group","description-group"],[1,"single-attribute","work-packages--details--description"],[3,"fieldName","resource","isDropTarget","wrapperClasses"],["class","attributes-group __overflowing_element_container",3,"hidden","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"wp-new--subject-wrapper"],[3,"resource","wrapperClasses","fieldName"],[3,"workPackage"],[3,"attribute","attributeScope"],[1,"work-packages--info-row"],[3,"textContent"],[1,"user-link",3,"user"],[3,"dateTimeValue"],["data-overflowing-identifier",".__overflowing_project_context",1,"attributes-group","-project-context","__overflowing_element_container","__overflowing_project_context"],[1,"wp-project-context--warning",3,"textContent"],["class","attributes-key-value",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"attributes-key-value",3,"ngClass"],[1,"attributes-key-value--key"],[3,"fieldName"],["class","required",4,"ngIf"],[1,"attributes-key-value--value-container"],[3,"resource","fieldName"],[1,"required"],[1,"attributes-group","-project-context","hide-when-print"],[3,"innerHTML"],[1,"project-context--switch-link",3,"textContent"],[3,"ndcDynamicComponent","ndcDynamicInputs"],[1,"attributes-group","__overflowing_element_container",3,"hidden","ngClass"],["wp-isolated-query-space","",4,"ngIf"],[4,"ngIf"],["wp-isolated-query-space",""],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],[3,"ndcDynamicComponent","ndcDynamicInjector","ndcDynamicInputs"],[1,"work-packages--attachments","attributes-group"],[1,"work-packages--attachments-container"],[3,"ndcDynamicComponent","ndcDynamicInputs",4,"ngIf"],[1,"work-packages--files","attributes-group"],[1,"work-packages--files-container"],[1,"attributes-group--icon-indented-text"],["icon-classes","icon-info1"],[3,"textContent","uiSref","uiParams"]],template:function(Fe,Te){1&Fe&&(T.YNc(0,he,14,17,"div",0),T.YNc(1,De,7,6,"div",1),T.YNc(2,Ve,9,7,"div",2)),2&Fe&&(T.Q6J("ngIf",Te.workPackage),T.xp6(1),T.Q6J("ngIf",Te.isNewResource),T.xp6(1),T.Q6J("ngIf",!Te.isNewResource))},directives:[O.O5,O.mk,Y,O.sg,X.k,K.f,ie.y,H.F,ee.F,ce.L,se.B5,se.oc,re.A,Me.o,Ae.AnchorUISref,Ae.UISref],encapsulation:2,changeDetection:0})},46669:(te,M,t)=>{"use strict";t.d(M,{x:()=>f});var n=t(47775),p=(t(24897),t(68197)),h=t(26942),c=t(33276),i=t(2316),l=t(54364),r=t(54262);function d(a,m){if(1&a&&(i.TgZ(0,"div",1),i.TgZ(1,"div",2),i._UZ(2,"op-editable-attribute-field",3),i.qZA(),i.TgZ(3,"div",4),i._UZ(4,"op-editable-attribute-field",3),i.qZA(),i.qZA()),2&a){const v=i.oxw();i.Q6J("ngClass","__overflowing_"+v.uniqueElementIdentifier),i.uIk("data-overflowing-identifier",".__overflowing_"+v.uniqueElementIdentifier),i.xp6(2),i.Q6J("resource",v.workPackage)("wrapperClasses","work-packages--type-selector work-packages--subject-element -no-label")("fieldName","type"),i.xp6(2),i.Q6J("resource",v.workPackage)("wrapperClasses","work-packages--details--subject work-packages--subject-element -no-label")("fieldName","subject")}}class f extends h.N{constructor(m,v){super(),this.uiRouterGlobals=m,this.apiV3Service=v,this.uniqueElementIdentifier=`work-packages--subject-type-row-${(0,p.O)(16)}`}ngOnInit(){this.workPackage||this.apiV3Service.work_packages.id(this.uiRouterGlobals.params.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(m=>{this.workPackage=m})}}f.\u0275fac=function(m){return new(m||f)(i.Y36(n.UIRouterGlobals),i.Y36(c.T))},f.\u0275cmp=i.Xpm({type:f,selectors:[["wp-subject"]],inputs:{workPackage:"workPackage"},features:[i.qOj],decls:1,vars:1,consts:[["class","work-packages--subject-type-row __overflowing_element_container",3,"ngClass",4,"ngIf"],[1,"work-packages--subject-type-row","__overflowing_element_container",3,"ngClass"],[1,"work-packages--type-selector","work-packages--subject-element"],[3,"resource","wrapperClasses","fieldName"],[1,"work-packages--details--subject","work-packages--subject-element"]],template:function(m,v){1&m&&i.YNc(0,d,5,8,"div",0),2&m&&i.Q6J("ngIf",v.workPackage)},directives:[l.O5,l.mk,r.k],encapsulation:2})},61736:(te,M,t)=>{"use strict";t.d(M,{M:()=>e});var n=t(40912);class e{constructor(h,c,i,l,r){this.availableTabs=h,this.outletElement=c,this.componentFactoryResolver=i,this.appRef=l,this.injector=r,this.activeTabs={},this.currentTab=null}get activeComponents(){return _.values(this.activeTabs).map(c=>c.componentRef.instance)}switchTo(h){if(void 0!==h.disable)return;this.detach();const c=this.activateInstance(h);this.outletElement.innerHTML="",this.outletElement.appendChild(this._getComponentRootNode(c.componentRef)),this.outletElement.dataset.tabName=h.name,this.currentTab=c}detach(){const h=this.currentTab;null!==h&&(h.portal.setAttachedHost(null),this.currentTab=null)}dispose(){_.each(this.activeTabs,h=>h.dispose()),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}activateInstance(h){return this.activeTabs[h.name]||(this.activeTabs[h.name]=this.createComponent(h)),this.activeTabs[h.name]||null}createComponent(h){const i=this.componentFactoryResolver.resolveComponentFactory(h.componentClass).create(this.injector),l=new n.C5(h.componentClass,null,this.injector);return this.appRef.attachView(i.hostView),Object.assign(Object.assign({},h),{portal:l,componentRef:i,dispose:()=>{this.appRef.detachView(i.hostView),i.destroy()}})}_getComponentRootNode(h){return h.hostView.rootNodes[0]}}},57119:(te,M,t)=>{"use strict";t.d(M,{c:()=>E,Q:()=>T});var n=t(2316),e=t(12877),p=t(71562),h=t(71444),c=t(61736),i=t(74478),l=t(43440),r=t(86469),d=t(96617),f=t(77355),a=t(60312),m=t(62964),v=t(33276),C=t(54364),u=t(32853),k=t(90590);const x=["tabContentOutlet"];function b(O,I){1&O&&n.GkF(0)}function y(O,I){if(1&O&&(n.ynx(0),n.YNc(1,b,1,0,"ng-container",12),n.BQk()),2&O){const Z=n.oxw();n.xp6(1),n.Q6J("ngComponentOutlet",Z.prependModalComponent)("ngComponentOutletInjector",Z.injector)}}function P(O,I){if(1&O){const Z=n.EpF();n.TgZ(0,"op-scrollable-tabs",13),n.NdJ("tabSelected",function(B){return n.CHM(Z),n.oxw().switchTo(B)}),n.qZA()}if(2&O){const Z=n.oxw();n.Q6J("tabs",Z.availableTabs)("currentTabId",null==Z.tabPortalHost.currentTab?null:Z.tabPortalHost.currentTab.id)}}const E=new n.OlP("WpTableConfigurationModalPrependComponent");class T extends a.T{constructor(I,Z,j,B,J,R,F,Y,X,K,ie,H,ee,ce,se){super(I,ee,se),this.locals=I,this.prependModalComponent=Z,this.I18n=j,this.injector=B,this.appRef=J,this.componentFactoryResolver=R,this.loadingIndicator=F,this.querySpace=Y,this.wpStatesInitialization=X,this.apiV3Service=K,this.notificationService=ie,this.wpTableColumns=H,this.cdRef=ee,this.ConfigurationService=ce,this.elementRef=se,this.text={title:this.I18n.t("js.work_packages.table_configuration.modal_title"),closePopup:this.I18n.t("js.close_popup_title"),columnsLabel:this.I18n.t("js.label_columns"),selectedColumns:this.I18n.t("js.description_selected_columns"),multiSelectLabel:this.I18n.t("js.work_packages.label_column_multiselect"),applyButton:this.I18n.t("js.modals.button_apply"),cancelButton:this.I18n.t("js.modals.button_cancel"),upsaleRelationColumns:this.I18n.t("js.modals.upsale_relation_columns"),upsaleRelationColumnsLink:this.I18n.t("js.modals.upsale_relation_columns_link")},this.onDataUpdated=new n.vpe,this.selectedColumnMap={},this.wpTableConfigurationService=this.injector.get(h.p,new h.p(this.I18n))}ngOnInit(){this.$element=this.elementRef.nativeElement,this.tabPortalHost=new c.M(this.wpTableConfigurationService.tabs,this.tabContentOutlet.nativeElement,this.componentFactoryResolver,this.appRef,this.injector),this.loadingIndicator.indicator("modal").promise=this.loadForm().then(()=>{const I=this.locals.initialTab,Z=this.availableTabs.find(j=>j.id===I);this.switchTo(Z||this.availableTabs[0]),this.cdRef.detectChanges()})}ngOnDestroy(){this.onDataUpdated.complete(),this.tabPortalHost.dispose()}get availableTabs(){return this.tabPortalHost.availableTabs}get currentTab(){return this.tabPortalHost.currentTab}switchTo(I){this.tabPortalHost.switchTo(I)}saveChanges(){this.tabPortalHost.activeComponents.forEach(I=>{I.onSave()}),this.onDataUpdated.emit(),this.service.close()}onClose(){return this.afterFocusOn.focus(),!0}get afterFocusOn(){return this.$element}loadForm(){const I=this.querySpace.query.value;return this.apiV3Service.queries.form.load(I).toPromise().then(([Z,j])=>(this.wpStatesInitialization.updateStatesFromForm(I,Z),Z)).catch(Z=>this.notificationService.handleRawError(Z))}}T.\u0275fac=function(I){return new(I||T)(n.Y36(f.E),n.Y36(E,8),n.Y36(d.D),n.Y36(n.zs3),n.Y36(n.z2F),n.Y36(n._Vd),n.Y36(r.vt),n.Y36(l.q),n.Y36(i.f),n.Y36(v.T),n.Y36(m.q),n.Y36(p.i),n.Y36(n.sBO),n.Y36(e.e),n.Y36(n.SBq))},T.\u0275cmp=n.Xpm({type:T,selectors:[["ng-component"]],viewQuery:function(I,Z){if(1&I&&n.Gf(x,7),2&I){let j;n.iGM(j=n.CRH())&&(Z.tabContentOutlet=j.first)}},features:[n.qOj],decls:13,vars:5,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_wide","wp-table--configuration-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[4,"ngIf"],[3,"tabs","currentTabId","tabSelected",4,"ngIf"],[1,"tab-content"],["tabContentOutlet",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","spot-modal-wp-table-configuration-save-button",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"tabs","currentTabId","tabSelected"]],template:function(I,Z){1&I&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n._uU(2),n.qZA(),n._UZ(3,"div",2),n.TgZ(4,"div",3),n.YNc(5,y,2,2,"ng-container",4),n.YNc(6,P,1,2,"op-scrollable-tabs",5),n._UZ(7,"div",6,7),n.qZA(),n.TgZ(9,"div",8),n.TgZ(10,"div",9),n.TgZ(11,"button",10),n.NdJ("click",function(B){return Z.closeMe(B)}),n.qZA(),n.TgZ(12,"button",11),n.NdJ("click",function(){return Z.saveChanges()}),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&I&&(n.xp6(2),n.Oqu(Z.text.title),n.xp6(3),n.Q6J("ngIf",!!Z.prependModalComponent),n.xp6(1),n.Q6J("ngIf",Z.tabPortalHost),n.xp6(5),n.Q6J("textContent",Z.text.cancelButton),n.xp6(1),n.Q6J("textContent",Z.text.applyButton))},directives:[C.O5,C.$G,u.dw,k.P],encapsulation:2})},71444:(te,M,t)=>{"use strict";t.d(M,{p:()=>oe});var n=t(96617),e=t(61083),p=t(99676),h=t(82271),c=t(2316),i=t(1707),l=t(2775),r=t(54364);function d(D,G){if(1&D&&c._UZ(0,"span",6),2&D){const V=c.oxw();c.Q6J("textContent",V.text.display_mode.hierarchy_hint)}}function f(D,G){if(1&D&&c._UZ(0,"option",15),2&D){const V=G.$implicit,me=c.oxw();c.Q6J("textContent",V.name)("selected",me.currentGroup&&me.currentGroup.href===V.href)("value",V.href)}}class a{constructor(G,V,me,$,Se){this.injector=G,this.I18n=V,this.wpTableGroupBy=me,this.wpTableHierarchies=$,this.wpTableSums=Se,this.displayMode="default",this.availableGroups=[],this.displaySums=!1,this.text={choose_mode:this.I18n.t("js.work_packages.table_configuration.choose_display_mode"),label_group_by:this.I18n.t("js.label_group_by"),title:this.I18n.t("js.label_group_by"),placeholder:this.I18n.t("js.placeholders.default"),please_select:this.I18n.t("js.placeholders.selection"),default:`\u2014 ${this.I18n.t("js.work_packages.table_configuration.default")}`,display_sums:this.I18n.t("js.work_packages.query.display_sums"),display_sums_hint:`\u2014 ${this.I18n.t("js.work_packages.table_configuration.display_sums_hint")}`,display_mode:{default:this.I18n.t("js.work_packages.table_configuration.default_mode"),grouped:this.I18n.t("js.work_packages.table_configuration.grouped_mode"),hierarchy:this.I18n.t("js.work_packages.table_configuration.hierarchy_mode"),hierarchy_hint:`\u2014 ${this.I18n.t("js.work_packages.table_configuration.hierarchy_hint")}`}}}onSave(){this.wpTableHierarchies.setEnabled("hierarchy"===this.displayMode);const G="grouped"===this.displayMode?this.currentGroup:null;this.wpTableGroupBy.update(G),this.wpTableSums.setEnabled(this.displaySums)}updateGroup(G){this.displayMode="grouped",this.currentGroup=_.find(this.availableGroups,V=>V.href===G)||null}ngOnInit(){this.wpTableHierarchies.isEnabled?this.displayMode="hierarchy":this.wpTableGroupBy.current&&(this.displayMode="grouped"),this.displaySums=this.wpTableSums.current,this.wpTableGroupBy.onReady().then(()=>{this.availableGroups=_.sortBy(this.wpTableGroupBy.available,"name"),this.currentGroup=this.wpTableGroupBy.current})}}a.\u0275fac=function(G){return new(G||a)(c.Y36(c.zs3),c.Y36(n.D),c.Y36(e.w),c.Y36(p.Y),c.Y36(h.X))},a.\u0275cmp=c.Xpm({type:a,selectors:[["ng-component"]],decls:39,vars:16,consts:[[3,"textContent"],[1,"form--field","-full-width"],[1,"form--field-container"],[1,"option-label"],["type","radio","value","default","name","display_mode_switch",3,"ngModel","ngModelChange"],["icon-classes","icon-no-hierarchy"],[1,"form--inline-instructions",3,"textContent"],["type","radio","value","hierarchy","name","display_mode_switch",3,"ngModel","ngModelChange"],["icon-classes","icon-hierarchy"],["class","form--inline-instructions",3,"textContent",4,"ngIf"],["type","radio","value","grouped","name","display_mode_switch",3,"ngModel","ngModelChange"],["icon-classes","icon-group-by"],["id","selected_grouping","name","selected_grouping",1,"form--select","form--inline-select",3,"change"],[3,"textContent","selected","value",4,"ngFor","ngForOf"],["type","checkbox","name","display_sums_switch",3,"checked","change"],[3,"textContent","selected","value"]],template:function(G,V){1&G&&(c.TgZ(0,"div"),c.TgZ(1,"form"),c._UZ(2,"p",0),c.TgZ(3,"div",1),c.TgZ(4,"div",2),c.TgZ(5,"label",3),c.TgZ(6,"input",4),c.NdJ("ngModelChange",function($){return V.displayMode=$}),c.qZA(),c._UZ(7,"op-icon",5),c._uU(8," "),c._UZ(9,"span",0),c._uU(10," "),c._UZ(11,"span",6),c.qZA(),c.qZA(),c.qZA(),c.TgZ(12,"div",1),c.TgZ(13,"div",2),c.TgZ(14,"label",3),c.TgZ(15,"input",7),c.NdJ("ngModelChange",function($){return V.displayMode=$}),c.qZA(),c._UZ(16,"op-icon",8),c._uU(17," "),c._UZ(18,"span",0),c._uU(19," "),c.YNc(20,d,1,1,"span",9),c.qZA(),c.qZA(),c.qZA(),c.TgZ(21,"div",1),c.TgZ(22,"div",2),c.TgZ(23,"label",3),c.TgZ(24,"input",10),c.NdJ("ngModelChange",function($){return V.displayMode=$}),c.qZA(),c._UZ(25,"op-icon",11),c._uU(26," "),c._UZ(27,"span",0),c._uU(28," "),c.TgZ(29,"select",12),c.NdJ("change",function($){return V.updateGroup($.target.value)}),c.YNc(30,f,1,3,"option",13),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c._UZ(31,"hr"),c.TgZ(32,"div"),c.TgZ(33,"div",1),c.TgZ(34,"div",2),c.TgZ(35,"label",3),c.TgZ(36,"input",14),c.NdJ("change",function(){return V.displaySums=!V.displaySums}),c.qZA(),c._uU(37),c._UZ(38,"span",6),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&G&&(c.xp6(2),c.Q6J("textContent",V.text.choose_mode),c.xp6(4),c.Q6J("ngModel",V.displayMode),c.xp6(1),c.uIk("icon-title",V.text.display_mode.default),c.xp6(2),c.Q6J("textContent",V.text.display_mode.default),c.xp6(2),c.Q6J("textContent",V.text.default),c.xp6(4),c.Q6J("ngModel",V.displayMode),c.xp6(1),c.uIk("icon-title",V.text.display_mode.hierarchy),c.xp6(2),c.Q6J("textContent",V.text.display_mode.hierarchy),c.xp6(2),c.Q6J("ngIf","hierarchy"===V.displayMode),c.xp6(4),c.Q6J("ngModel",V.displayMode),c.xp6(1),c.uIk("icon-title",V.text.label_group_by),c.xp6(2),c.Q6J("textContent",V.text.label_group_by),c.xp6(3),c.Q6J("ngForOf",V.availableGroups),c.xp6(6),c.Q6J("checked",V.displaySums),c.xp6(1),c.hij(" ",V.text.display_sums," "),c.xp6(1),c.Q6J("textContent",V.text.display_sums_hint))},directives:[i._Y,i.JL,i.F,i._,i.Fj,i.JJ,i.On,l.o,r.O5,r.sg,i.YN,i.Kr],encapsulation:2});var m=t(12877),v=t(71562),C=t(73881),u=t(27779),k=t(29212),x=t(8158);function b(D,G){if(1&D&&c._UZ(0,"op-enterprise-banner",5),2&D){const V=c.oxw();c.Q6J("linkMessage",V.text.upsaleCheckOutLink)("textMessage",V.text.upsaleRelationColumns)("moreInfoLink",V.text.moreInfoLink)}}class y{constructor(G,V,me,$,Se){this.injector=G,this.I18n=V,this.wpTableColumns=me,this.ConfigurationService=$,this.bannerService=Se,this.availableColumnsOptions=this.wpTableColumns.all.map(ot=>this.column2Like(ot)),this.availableColumns=this.wpTableColumns.all,this.availableColumnsMap=_.keyBy(this.availableColumns,ot=>ot.id),this.selectedColumns=this.wpTableColumns.getColumns().map(ot=>this.column2Like(ot)),this.selectedColumnMap={},this.eeShowBanners=!1,this.text={columnsHelp:this.I18n.t("js.work_packages.table_configuration.columns_help_text"),columnsLabel:this.I18n.t("js.label_columns"),selectedColumns:this.I18n.t("js.description_selected_columns"),multiSelectLabel:this.I18n.t("js.work_packages.label_column_multiselect"),upsaleRelationColumns:this.I18n.t("js.work_packages.table_configuration.upsale.relation_columns"),upsaleCheckOutLink:this.I18n.t("js.work_packages.table_configuration.upsale.check_out_link"),moreInfoLink:u.rj.website}}onSave(){this.wpTableColumns.setColumnsById(this.selectedColumns.map(G=>G.id))}ngOnInit(){this.eeShowBanners=this.bannerService.eeShowBanners,this.selectedColumns.forEach(G=>{this.selectedColumnMap[G.id]=!0})}column2Like(G){return{id:G.id,name:G.name}}updateSelected(G){this.selectedColumns=G}}y.\u0275fac=function(G){return new(G||y)(c.Y36(c.zs3),c.Y36(n.D),c.Y36(v.i),c.Y36(m.e),c.Y36(C.j))},y.\u0275cmp=c.Xpm({type:y,selectors:[["ng-component"]],decls:5,vars:5,consts:[[1,"columns-modal--content"],[1,"hidden-for-sighted",3,"textContent"],[3,"options","selected","onChange"],[1,"form--inline-instructions",3,"textContent"],["class","ee-relation-columns-upsale","opReferrer","wp-list-columns#relations",3,"linkMessage","textMessage","moreInfoLink",4,"ngIf"],["opReferrer","wp-list-columns#relations",1,"ee-relation-columns-upsale",3,"linkMessage","textMessage","moreInfoLink"]],template:function(G,V){1&G&&(c.TgZ(0,"div",0),c._UZ(1,"label",1),c.TgZ(2,"draggable-autocompleter",2),c.NdJ("onChange",function($){return V.updateSelected($)}),c.qZA(),c._UZ(3,"p",3),c.qZA(),c.YNc(4,b,1,3,"op-enterprise-banner",4)),2&G&&(c.xp6(1),c.Q6J("textContent",V.text.selectedColumns),c.xp6(1),c.Q6J("options",V.availableColumnsOptions)("selected",V.selectedColumns),c.xp6(1),c.Q6J("textContent",V.text.columnsHelp),c.xp6(1),c.Q6J("ngIf",V.eeShowBanners))},directives:[k.i,r.O5,x.P],encapsulation:2});var P=t(78434),E=t(74647),T=t(32557);function O(D,G){if(1&D){const V=c.EpF();c.TgZ(0,"op-query-filters",1),c.NdJ("filtersChanged",function($){c.CHM(V);return c.oxw().filters=$}),c.qZA()}if(2&D){const V=c.oxw();c.Q6J("filters",V.filters)}}class I{constructor(G,V,me,$,Se){this.injector=G,this.I18n=V,this.wpTableFilters=me,this.wpFiltersService=$,this.bannerService=Se,this.filters=[],this.eeShowBanners=!1,this.text={columnsLabel:this.I18n.t("js.label_columns"),selectedColumns:this.I18n.t("js.description_selected_columns"),multiSelectLabel:this.I18n.t("js.work_packages.label_column_multiselect"),upsaleRelationColumns:this.I18n.t("js.modals.upsale_relation_columns"),upsaleRelationColumnsLink:this.I18n.t("js.modals.upsale_relation_columns_link")}}ngOnInit(){this.eeShowBanners=this.bannerService.eeShowBanners,this.wpTableFilters.onReady().then(()=>this.filters=this.wpTableFilters.current),this.wpTableFilters.changes$().subscribe(G=>{this.filters=this.wpTableFilters.current})}onSave(){this.filters&&this.wpTableFilters.replaceIfComplete(this.filters)}}I.\u0275fac=function(G){return new(G||I)(c.Y36(c.zs3),c.Y36(n.D),c.Y36(E.Z),c.Y36(P.U),c.Y36(C.j))},I.\u0275cmp=c.Xpm({type:I,selectors:[["wp-table-config-filters-tab"]],decls:1,vars:1,consts:[[3,"filters","filtersChanged",4,"ngIf"],[3,"filters","filtersChanged"]],template:function(G,V){1&G&&c.YNc(0,O,1,1,"op-query-filters",0),2&G&&c.Q6J("ngIf",!!V.filters)},directives:[r.O5,T.H],encapsulation:2});var Z=t(82763),j=t(15893);function B(D,G){if(1&D&&c._UZ(0,"option",18),2&D){const V=c.oxw().$implicit;c.Q6J("textContent",V.column.name)("value",V.column.href)}}function J(D,G){if(1&D&&c._UZ(0,"option",19),2&D){const V=G.$implicit;c.Q6J("textContent",V.name)("value",V.href)}}function R(D,G){if(1&D){const V=c.EpF();c.TgZ(0,"label",5),c.TgZ(1,"input",20),c.NdJ("ngModelChange",function($){c.CHM(V);return c.oxw().$implicit.direction=$}),c.qZA(),c._uU(2),c.qZA()}if(2&D){const V=G.$implicit,me=c.oxw(),$=me.index,Se=me.$implicit;c.xp6(1),c.MGl("name","modal-sorting-attribute-",$,"--sort-direction"),c.Q6J("ngModel",Se.direction)("value",V.href)("textContent",V.name),c.xp6(1),c.hij(" ",V.name," ")}}function F(D,G){if(1&D){const V=c.EpF();c.TgZ(0,"div"),c.TgZ(1,"div",3),c._UZ(2,"label",11),c.TgZ(3,"div",4),c.TgZ(4,"div",12),c.TgZ(5,"select",13),c.NdJ("change",function($){const ot=c.CHM(V).$implicit;return c.oxw(2).updateSelection(ot,$.target.value)}),c.YNc(6,B,1,2,"option",14),c._UZ(7,"option",15),c.YNc(8,J,1,2,"option",16),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(9,"div",3),c.TgZ(10,"div",4),c.YNc(11,R,3,5,"label",17),c.qZA(),c.qZA(),c.qZA()}if(2&D){const V=G.$implicit,me=G.index,$=c.oxw(2);c.Gre("form--row modal-sorting-row-",me,""),c.xp6(2),c.MGl("for","modal-sorting-attribute-",me,""),c.Q6J("textContent",$.text["sort_criteria_"+me]),c.xp6(3),c.MGl("id","modal-sorting-attribute-",me,""),c.MGl("name","modal-sorting-attribute-",me,""),c.xp6(1),c.Q6J("ngIf",!!V.column.href),c.xp6(1),c.Q6J("textContent",$.emptyColumn.name)("value",$.emptyColumn.href)("selected",!V.column.href),c.xp6(1),c.Q6J("ngForOf",$.availableColumns),c.xp6(3),c.Q6J("ngForOf",$.availableDirections)}}function Y(D,G){if(1&D&&(c.ynx(0),c.YNc(1,F,12,13,"div",10),c.BQk()),2&D){const V=c.oxw();c.xp6(1),c.Q6J("ngForOf",V.sortationObjects)}}class X{constructor(G,V){this.column=G,this.direction=V}}class K{constructor(G,V,me){this.injector=G,this.I18n=V,this.wpTableSortBy=me,this.text={title:this.I18n.t("js.label_sort_by"),placeholder:this.I18n.t("js.placeholders.default"),sort_criteria_1:this.I18n.t("js.filter.sorting.criteria.one"),sort_criteria_2:this.I18n.t("js.filter.sorting.criteria.two"),sort_criteria_3:this.I18n.t("js.filter.sorting.criteria.three"),sorting_mode:{description:this.I18n.t("js.work_packages.table_configuration.sorting_mode.description"),automatic:this.I18n.t("js.work_packages.table_configuration.sorting_mode.automatic"),manually:this.I18n.t("js.work_packages.table_configuration.sorting_mode.manually"),warning:this.I18n.t("js.work_packages.table_configuration.sorting_mode.warning")}},this.availableDirections=[{href:j.S9,name:this.I18n.t("js.label_ascending")},{href:j.iV,name:this.I18n.t("js.label_descending")}],this.availableColumns=[],this.allColumns=[],this.sortationObjects=[],this.emptyColumn={name:this.text.placeholder,href:null},this.sortingMode="automatic"}onSave(){let G;G="automatic"===this.sortingMode?this.sortationObjects.filter(V=>null!==V.column):[new X(this.manualSortColumn,j.S9)],G=G.map(V=>this.getMatchingSort(V.column.href,V.direction)),this.wpTableSortBy.update(_.compact(G))}ngOnInit(){this.wpTableSortBy.onReadyWithAvailable().subscribe(()=>{const G=this.wpTableSortBy.available.filter(V=>!V.column.href.endsWith("/parent")).map(V=>({name:V.column.name,href:V.column.href}));this.allColumns=_.uniqBy(G,"href"),this.getManualSortingOption(),_.each(this.wpTableSortBy.current,V=>{V.column.href.endsWith("/parent")||(this.sortationObjects.push(new X({name:V.column.name,href:V.column.href},V.direction.href)),V.column.href===this.manualSortColumn.href&&this.updateSortingMode("manual"))}),this.updateUsedColumns(),this.fillUpSortElements()})}updateSelection(G,V){G.column=_.find(this.allColumns,me=>me.href===V)||this.emptyColumn,this.updateUsedColumns()}updateUsedColumns(){const G=this.sortationObjects.filter(V=>null!==V.column).map(V=>V.column);this.availableColumns=_.sortBy(_.differenceBy(this.allColumns,G,"href"),"name")}updateSortingMode(G){this.sortingMode=G}getMatchingSort(G,V){return _.find(this.wpTableSortBy.available,me=>me.column.href===G&&me.direction.href===V)}fillUpSortElements(){for(;this.sortationObjects.length<3;)this.sortationObjects.push(new X(this.emptyColumn,j.S9))}getManualSortingOption(){this.manualSortColumn=this.allColumns.find(G=>G.href.endsWith("/manualSorting")),this.allColumns.splice(this.allColumns.indexOf(this.manualSortColumn),1)}}K.\u0275fac=function(G){return new(G||K)(c.Y36(c.zs3),c.Y36(n.D),c.Y36(Z.q))},K.\u0275cmp=c.Xpm({type:K,selectors:[["ng-component"]],decls:16,vars:7,consts:[["name","modalSortingForm"],["id","modal-sorting","data-indicator-name","sorting-modal",1,"modal-content-container","loading-indicator--location"],[3,"textContent"],[1,"form--field","-full-width"],[1,"form--field-container"],[1,"option-label"],["type","radio","name","sorting_mode_switch","value","manual",3,"ngModel","ngModelChange","change"],["type","radio","name","sorting_mode_switch","value","automatic",3,"ngModel","ngModelChange","change"],[1,"form--field-instructions"],[4,"ngIf"],[3,"class",4,"ngFor","ngForOf"],[1,"form--label","hidden-for-sighted",3,"for","textContent"],[1,"form--select-container"],[1,"form--select",3,"id","name","change"],["selected","",3,"textContent","value",4,"ngIf"],[3,"textContent","value","selected"],[3,"textContent","value",4,"ngFor","ngForOf"],["class","option-label",4,"ngFor","ngForOf"],["selected","",3,"textContent","value"],[3,"textContent","value"],["type","radio",3,"ngModel","value","textContent","name","ngModelChange"]],template:function(G,V){1&G&&(c.TgZ(0,"form",0),c.TgZ(1,"div",1),c._UZ(2,"p",2),c.TgZ(3,"div",3),c.TgZ(4,"div",4),c.TgZ(5,"label",5),c.TgZ(6,"input",6),c.NdJ("ngModelChange",function($){return V.sortingMode=$})("change",function($){return V.updateSortingMode($.target.value)}),c.qZA(),c._uU(7),c.qZA(),c.qZA(),c.qZA(),c.TgZ(8,"div",3),c.TgZ(9,"div",4),c.TgZ(10,"label",5),c.TgZ(11,"input",7),c.NdJ("ngModelChange",function($){return V.sortingMode=$})("change",function($){return V.updateSortingMode($.target.value)}),c.qZA(),c._uU(12),c.qZA(),c.qZA(),c.TgZ(13,"div",8),c._uU(14),c.qZA(),c.qZA(),c.YNc(15,Y,2,1,"ng-container",9),c.qZA(),c.qZA()),2&G&&(c.xp6(2),c.Q6J("textContent",V.text.sorting_mode.description),c.xp6(4),c.Q6J("ngModel",V.sortingMode),c.xp6(1),c.hij(" ",V.text.sorting_mode.manually," "),c.xp6(4),c.Q6J("ngModel",V.sortingMode),c.xp6(1),c.hij(" ",V.text.sorting_mode.automatic," "),c.xp6(2),c.hij(" ",V.text.sorting_mode.warning," "),c.xp6(1),c.Q6J("ngIf","automatic"===V.sortingMode))},directives:[i._Y,i.JL,i.F,i._,i.Fj,i.JJ,i.On,r.O5,r.sg,i.YN,i.Kr],encapsulation:2});var ie=t(73165),H=t(42529);function ee(D,G){if(1&D&&c._UZ(0,"option",15),2&D){const V=G.$implicit,me=c.oxw(2);c.Q6J("textContent",me.text.zoom[V])("value",V)("selected",me.zoomLevel===V)}}function ce(D,G){if(1&D&&c._UZ(0,"option",15),2&D){const V=G.$implicit,me=c.oxw().$implicit,$=c.oxw(2);c.Q6J("textContent",V.name)("value",V.id)("selected",$.labels[me]===V.id)}}function se(D,G){if(1&D){const V=c.EpF();c.TgZ(0,"div",16),c.TgZ(1,"div",1),c.TgZ(2,"label",17),c._uU(3),c.qZA(),c.TgZ(4,"div",3),c.TgZ(5,"div",18),c.TgZ(6,"select",19),c.NdJ("change",function($){const ot=c.CHM(V).$implicit;return c.oxw(2).updateLabels(ot,$.target.value)}),c.YNc(7,ce,1,3,"option",13),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&D){const V=G.$implicit,me=c.oxw(2);c.xp6(2),c.MGl("for","modal-timelines-label-",V,""),c.xp6(1),c.hij(" ",me.text.labels[V]," "),c.xp6(3),c.MGl("id","modal-timelines-label-",V,""),c.xp6(1),c.Q6J("ngForOf",me.availableAttributes)}}function re(D,G){if(1&D){const V=c.EpF();c.ynx(0),c.TgZ(1,"fieldset",8),c._UZ(2,"legend",9),c._UZ(3,"p",10),c.TgZ(4,"div",1),c.TgZ(5,"div",3),c.TgZ(6,"div",11),c.TgZ(7,"select",12),c.NdJ("change",function($){c.CHM(V);return c.oxw().zoomLevel=$.target.value}),c.YNc(8,ee,1,3,"option",13),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(9,"fieldset",8),c._UZ(10,"legend",9),c._UZ(11,"p",10),c.YNc(12,se,8,4,"div",14),c.qZA(),c.BQk()}if(2&D){const V=c.oxw();c.xp6(2),c.Q6J("textContent",V.text.zoom.level),c.xp6(1),c.Q6J("textContent",V.text.zoom.description),c.xp6(4),c.uIk("disabled",!0===V.autoZoom?"disabled":void 0),c.xp6(1),c.Q6J("ngForOf",V.availableZoomLevels),c.xp6(2),c.Q6J("textContent",V.text.labels.title),c.xp6(1),c.Q6J("textContent",V.text.labels.description),c.xp6(1),c.Q6J("ngForOf",V.availableLabels)}}class Me{constructor(G,V,me,$){this.injector=G,this.I18n=V,this.wpTableTimeline=me,this.wpTableColumns=$,this.timelineVisible=!1,this.availableZoomLevels=["auto",...H.$r],this.text={title:this.I18n.t("js.timelines.gantt_chart"),display_timelines:this.I18n.t("js.timelines.button_activate"),display_timelines_hint:this.I18n.t("js.work_packages.table_configuration.show_timeline_hint"),zoom:{level:this.I18n.t("js.tl_toolbar.zooms"),description:this.I18n.t("js.timelines.zoom.description"),days:this.I18n.t("js.timelines.zoom.days"),weeks:this.I18n.t("js.timelines.zoom.weeks"),months:this.I18n.t("js.timelines.zoom.months"),quarters:this.I18n.t("js.timelines.zoom.quarters"),years:this.I18n.t("js.timelines.zoom.years"),auto:this.I18n.t("js.timelines.zoom.auto")},labels:{title:this.I18n.t("js.timelines.labels.title"),description:this.I18n.t("js.timelines.labels.description"),bar:this.I18n.t("js.timelines.labels.bar"),none:this.I18n.t("js.timelines.filter.noneSelection"),left:this.I18n.t("js.timelines.labels.left"),right:this.I18n.t("js.timelines.labels.right"),farRight:this.I18n.t("js.timelines.labels.farRight")}}}onSave(){this.wpTableTimeline.update(Object.assign(Object.assign({},this.wpTableTimeline.current),{visible:this.timelineVisible,labels:this.labels,zoomLevel:this.zoomLevel}))}updateLabels(G,V){""===V&&(V=null),this.labels[G]=V}ngOnInit(){this.timelineVisible=this.wpTableTimeline.isVisible,this.zoomLevel=this.wpTableTimeline.zoomLevel;const{labels:G}=this.wpTableTimeline;this.labels=_.clone(G),this.availableLabels=Object.keys(this.labels);const V=this.wpTableColumns.allPropertyColumns.sort((me,$)=>me.name.localeCompare($.name));this.availableAttributes=[{id:"",name:this.text.labels.none}].concat(V)}}Me.\u0275fac=function(G){return new(G||Me)(c.Y36(c.zs3),c.Y36(n.D),c.Y36(ie.W),c.Y36(v.i))},Me.\u0275cmp=c.Xpm({type:Me,selectors:[["ng-component"]],decls:9,vars:4,consts:[[1,"form"],[1,"form--field"],["for","display_timelines_switch",1,"form--label",3,"textContent"],[1,"form--field-container"],[1,"form--check-box-container"],["type","checkbox","id","display_timelines_switch","name","display_timelines_switch",3,"checked","change"],[1,"form--field-instructions",3,"textContent"],[4,"ngIf"],[1,"form--fieldset"],[1,"form--fieldset-legend",3,"textContent"],[3,"textContent"],[1,"form--text-select-container","-slim"],["id","modal-timelines-zoomlevel",1,"form--select",3,"change"],[3,"textContent","value","selected",4,"ngFor","ngForOf"],["class","form--row",4,"ngFor","ngForOf"],[3,"textContent","value","selected"],[1,"form--row"],[1,"form--label",3,"for"],[1,"form--select-container"],[1,"form--select",3,"id","change"]],template:function(G,V){1&G&&(c.TgZ(0,"div"),c.TgZ(1,"form",0),c.TgZ(2,"div",1),c._UZ(3,"label",2),c.TgZ(4,"div",3),c.TgZ(5,"div",4),c.TgZ(6,"input",5),c.NdJ("change",function(){return V.timelineVisible=!V.timelineVisible}),c.qZA(),c.qZA(),c.qZA(),c._UZ(7,"p",6),c.qZA(),c.YNc(8,re,13,7,"ng-container",7),c.qZA(),c.qZA()),2&G&&(c.xp6(3),c.Q6J("textContent",V.text.display_timelines),c.xp6(3),c.Q6J("checked",V.timelineVisible),c.xp6(1),c.Q6J("textContent",V.text.display_timelines_hint),c.xp6(1),c.Q6J("ngIf",V.timelineVisible))},directives:[i._Y,i.JL,i.F,r.O5,r.sg,i.YN,i.Kr],encapsulation:2});var Ae=t(84897),Ye=t(43440),ze=t(87853),Xe=t(36868);const it=["highlightedAttributesNgSelect"],at=["rowHighlightNgSelect"];function lt(D,G){if(1&D&&c._UZ(0,"op-enterprise-banner",2),2&D){const V=c.oxw();c.Q6J("linkMessage",V.text.upsaleCheckOutLink)("textMessage",V.text.upsaleAttributeHighlighting)("moreInfoLink",V.text.more_info_link)}}function dt(D,G){if(1&D){const V=c.EpF();c.TgZ(0,"form"),c._UZ(1,"p",3),c.TgZ(2,"div",4),c.TgZ(3,"label",5),c.TgZ(4,"input",6),c.NdJ("ngModelChange",function($){c.CHM(V);return c.oxw().highlightingMode=$})("change",function($){return c.CHM(V),c.oxw().updateMode($.target.value)}),c.qZA(),c._UZ(5,"span",3),c._uU(6,"\xa0 "),c.qZA(),c.TgZ(7,"div",7),c.TgZ(8,"div",8),c.TgZ(9,"ng-select",9,10),c.NdJ("ngModelChange",function($){c.CHM(V);return c.oxw().selectedAttributes=$})("open",function(){c.CHM(V);const $=c.MAs(10);return c.oxw().onOpen($)})("change",function($){return c.CHM(V),c.oxw().updateHighlightingAttributes($)}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(11,"div",4),c.TgZ(12,"label",5),c.TgZ(13,"input",11),c.NdJ("ngModelChange",function($){c.CHM(V);return c.oxw().entireRowMode=$})("change",function(){return c.CHM(V),c.oxw().updateMode("entire-row")}),c.qZA(),c._UZ(14,"span",3),c.qZA(),c.TgZ(15,"div",7),c.TgZ(16,"div",8),c.TgZ(17,"ng-select",12,13),c.NdJ("ngModelChange",function($){c.CHM(V);return c.oxw().lastEntireRowAttribute=$})("open",function(){c.CHM(V);const $=c.MAs(18);return c.oxw().onOpen($)})("change",function($){return c.CHM(V),c.oxw().updateMode($.value)}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(19,"div",4),c.TgZ(20,"label",5),c.TgZ(21,"input",14),c.NdJ("ngModelChange",function($){c.CHM(V);return c.oxw().highlightingMode=$})("change",function($){return c.CHM(V),c.oxw().updateMode($.target.value)}),c.qZA(),c._UZ(22,"span",3),c.qZA(),c.qZA(),c.qZA()}if(2&D){const V=c.oxw();c.xp6(1),c.Q6J("textContent",V.text.highlighting_mode.description),c.xp6(3),c.Q6J("ngModel",V.highlightingMode),c.uIk("disabled",V.disabledValue(V.eeShowBanners)),c.xp6(1),c.Q6J("textContent",V.text.highlighting_mode.inline),c.xp6(4),c.Q6J("items",V.availableInlineHighlightedAttributes)("ngModel",V.selectedAttributes)("multiple",!0)("disabled","inline"!==V.highlightingMode)("clearable",!1)("closeOnSelect",!1),c.xp6(4),c.Q6J("ngModel",V.entireRowMode)("value",!0),c.uIk("disabled",V.disabledValue(V.eeShowBanners)),c.xp6(1),c.Q6J("textContent",V.text.highlighting_mode.entire_row_by),c.xp6(3),c.Q6J("items",V.availableRowHighlightedAttributes)("ngModel",V.lastEntireRowAttribute)("disabled",V.disabledValue(V.eeShowBanners))("clearable",!1),c.xp6(4),c.Q6J("ngModel",V.highlightingMode),c.uIk("disabled",V.disabledValue(V.eeShowBanners)),c.xp6(1),c.Q6J("textContent",V.text.highlighting_mode.none)}}class de{constructor(G,V,me,$,Se,ot){this.injector=G,this.I18n=V,this.states=me,this.querySpace=$,this.Banners=Se,this.wpTableHighlight=ot,this.highlightingMode="inline",this.entireRowMode=!1,this.lastEntireRowAttribute="status",this.eeShowBanners=!1,this.availableInlineHighlightedAttributes=[],this.selectedAttributes=[],this.availableRowHighlightedAttributes=[],this.text={title:this.I18n.t("js.work_packages.table_configuration.highlighting"),highlighting_mode:{description:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.description"),none:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.none"),inline:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.inline"),inline_all_attributes:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.inline_all"),status:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.status"),type:this.I18n.t("js.work_packages.properties.type"),priority:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.priority"),entire_row_by:this.I18n.t("js.work_packages.table_configuration.highlighting_mode.entire_row_by")},upsaleAttributeHighlighting:this.I18n.t("js.work_packages.table_configuration.upsale.attribute_highlighting"),upsaleCheckOutLink:this.I18n.t("js.work_packages.table_configuration.upsale.check_out_link"),more_info_link:u.rj.tableHighlighting}}ngOnInit(){this.availableInlineHighlightedAttributes=this.availableHighlightedAttributes,this.availableRowHighlightedAttributes=[{name:this.text.highlighting_mode.status,value:"status"},{name:this.text.highlighting_mode.priority,value:"priority"}],this.setSelectedValues(),this.eeShowBanners=this.Banners.eeShowBanners,this.updateMode(this.wpTableHighlight.current.mode),this.eeShowBanners&&this.updateMode("none")}onSave(){const G=this.highlightingMode;this.wpTableHighlight.update({mode:G,selectedAttributes:this.selectedAttributes})}updateMode(G){this.highlightingMode="entire-row"===G?this.lastEntireRowAttribute:G,-1!==["status","priority"].indexOf(this.highlightingMode)?(this.lastEntireRowAttribute=this.highlightingMode,this.entireRowMode=!0):this.entireRowMode=!1}updateHighlightingAttributes(G){this.selectedAttributes=G}disabledValue(G){return G?"disabled":null}get availableHighlightedAttributes(){const{schema:G}=this.querySpace.queryForm.value;return G.highlightedAttributes.allowedValues}onOpen(G){setTimeout(()=>{G.dropdownPanel&&G.dropdownPanel._updatePosition()},25)}setSelectedValues(){const G=this.wpTableHighlight.current.selectedAttributes;G&&(this.selectedAttributes=G)}}de.\u0275fac=function(G){return new(G||de)(c.Y36(c.zs3),c.Y36(n.D),c.Y36(ze.G),c.Y36(Ye.q),c.Y36(C.j),c.Y36(Ae.B))},de.\u0275cmp=c.Xpm({type:de,selectors:[["ng-component"]],viewQuery:function(G,V){if(1&G&&(c.Gf(it,5),c.Gf(at,5)),2&G){let me;c.iGM(me=c.CRH())&&(V.highlightedAttributesNgSelect=me.first),c.iGM(me=c.CRH())&&(V.rowHighlightNgSelect=me.first)}},decls:3,vars:2,consts:[["class","ee-attribute-highlighting-upsale","opReferrer","wp-attribute-highlighting#attribute-highlighting",3,"linkMessage","textMessage","moreInfoLink",4,"ngIf"],[4,"ngIf"],["opReferrer","wp-attribute-highlighting#attribute-highlighting",1,"ee-attribute-highlighting-upsale",3,"linkMessage","textMessage","moreInfoLink"],[3,"textContent"],[1,"form--field"],[1,"form--label"],["type","radio","value","inline","name","highlighting_mode_switch",3,"ngModel","ngModelChange","change"],[1,"form--field-container"],[1,"form--select-container"],["bindLabel","name","name","highlighting_attributes","appendTo","body",1,"form--select-field","-multi-select",3,"items","ngModel","multiple","disabled","clearable","closeOnSelect","ngModelChange","open","change"],["highlightedAttributesNgSelect",""],["type","radio","name","entire_row_switch",3,"ngModel","value","ngModelChange","change"],["bindLabel","name","bindValue","value","name","selected_attribute","appendTo","body","id","selected_attribute",1,"form--select-field",3,"items","ngModel","disabled","clearable","ngModelChange","open","change"],["rowHighlightNgSelect",""],["type","radio","value","none","name","highlighting_mode_switch",3,"ngModel","ngModelChange","change"]],template:function(G,V){1&G&&(c.TgZ(0,"div"),c.YNc(1,lt,1,3,"op-enterprise-banner",0),c.YNc(2,dt,23,21,"form",1),c.qZA()),2&G&&(c.xp6(1),c.Q6J("ngIf",V.eeShowBanners),c.xp6(1),c.Q6J("ngIf",!V.eeShowBanners))},directives:[r.O5,x.P,i._Y,i.JL,i.F,i._,i.Fj,i.JJ,i.On,Xe.w9],encapsulation:2,changeDetection:0});class oe{constructor(G){this.I18n=G,this._tabs=[{id:"columns",name:this.I18n.t("js.label_columns"),componentClass:y},{id:"filters",name:this.I18n.t("js.work_packages.query.filters"),componentClass:I},{id:"sort-by",name:this.I18n.t("js.label_sort_by"),componentClass:K},{id:"display-settings",name:this.I18n.t("js.work_packages.table_configuration.display_settings"),componentClass:a},{id:"highlighting",name:this.I18n.t("js.work_packages.table_configuration.highlighting"),componentClass:de},{id:"timelines",name:this.I18n.t("js.timelines.gantt_chart"),componentClass:Me}]}get tabs(){return this._tabs}}oe.\u0275fac=function(G){return new(G||oe)(c.LFG(n.D))},oe.\u0275prov=c.Yz7({token:oe,factory:oe.\u0275fac})},77591:(te,M,t)=>{"use strict";t.d(M,{j:()=>r});var n=t(70233),e=t(55977),p=t(53448),h=t(73165),c=t(16793),i=t(2888),l=t(2316);class r{constructor(f,a,m,v,C,u){this.HookService=f,this.UrlParamsHelper=a,this.wpViewRepresentation=m,this.wpViewTimeline=v,this.wpViewIndent=C,this.PathHelper=u,this.BULK_ACTIONS=[{text:I18n.t("js.work_packages.bulk_actions.edit"),key:"edit",link:"update",href:`${this.PathHelper.staticBase}/work_packages/bulk/edit`},{text:I18n.t("js.work_packages.bulk_actions.move"),key:"move",link:"move",href:`${this.PathHelper.staticBase}/work_packages/move/new`},{text:I18n.t("js.work_packages.bulk_actions.copy"),key:"copy",link:"copy",href:`${this.PathHelper.staticBase}/work_packages/move/new?copy=true`},{text:I18n.t("js.work_packages.bulk_actions.delete"),key:"delete",link:"delete",href:`${this.PathHelper.staticBase}/work_packages/bulk?_method=delete`}]}getPermittedActionLinks(f,a,m){const v=[];let C=this.getAllowedActions(f,a);return C=C.concat(this.getAllowedParentActions(f)),C=C.concat(this.getAllowedRelationActions(f,m)),_.each(C,u=>{v.push({key:u.key,text:u.text,icon:u.icon,link:u.link?f[u.link].href:void 0})}),v}getIntersectOfPermittedActions(f){const a=[],m=this.BULK_ACTIONS.concat(this.HookService.call("workPackageBulkContextMenu")),v=_.filter(m,C=>_.every(f,u=>this.isActionAllowed(u,C)));return _.each(v,C=>{a.push({key:C.key,text:C.text,icon:C.icon,link:this.getBulkActionLink(C,f)})}),a}getBulkActionLink(f,a){const m={"ids[]":a.map(x=>x.id)},v=this.UrlParamsHelper.buildQueryString(m),C=f.href.split("?");return`${C.shift()}?${C.concat(new Array(v)).join("&")}`}isActionAllowed(f,a){return _.filter(this.getAllowedActions(f,[a]),m=>m===a).length>=1}getAllowedActions(f,a){const m=[];return _.each(a,v=>{v.link&&f.hasOwnProperty(v.link)&&(v.text=v.text||I18n.t(`js.button_${v.key}`),m.push(v))}),_.each(this.HookService.call("workPackageTableContextMenu"),v=>{if(f.hasOwnProperty(v.link)){const C=v.indexBy?v.indexBy(m):m.length;m.splice(C,0,v)}}),m}getAllowedParentActions(f){const a=[];return this.wpViewRepresentation.isList?(this.wpViewIndent.canOutdent(f)&&a.push({key:"hierarchy-outdent",icon:"icon-paragraph-left",text:I18n.t("js.relation_buttons.hierarchy_outdent")}),this.wpViewIndent.canIndent(f)&&a.push({key:"hierarchy-indent",icon:"icon-paragraph-right",text:I18n.t("js.relation_buttons.hierarchy_indent")}),a):[]}getAllowedRelationActions(f,a){const m=[];return!!f.addRelation&&this.wpViewTimeline.isVisible&&(m.push({key:"relation-precedes",text:I18n.t("js.relation_buttons.add_predecessor"),link:"addRelation"}),m.push({key:"relation-follows",text:I18n.t("js.relation_buttons.add_follower"),link:"addRelation"})),!!f.addChild&&a&&m.push({key:"relation-new-child",text:I18n.t("js.relation_buttons.add_new_child"),link:"addChild"}),m}getPermittedActions(f,a,m){return 1===f.length?this.getPermittedActionLinks(f[0],a,m):this.getIntersectOfPermittedActions(f)}}r.\u0275fac=function(f){return new(f||r)(l.LFG(p.$),l.LFG(e.Z),l.LFG(i.ld),l.LFG(h.W),l.LFG(c.f),l.LFG(n.j))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac})},16451:(te,M,t)=>{"use strict";t.d(M,{B:()=>P});var n=t(43440);class e{constructor(T,O){this.querySpace=T,this.injector=O}get applies(){return!0}onNewOrder(T){}canPickup(T){return!0}handleDrop(T,O){return Promise.resolve(void 0)}changeShadowElement(T,O=!1){return O?T.classList.remove("-dragged"):T.classList.add("-dragged"),!0}}var p=t(3786),h=t(99676),c=t(41945),i=t(32030),l=t(99919),r=t(29161),d=t(33276);class f extends e{get applies(){return this.wpTableHierarchies.isEnabled}canPickup(T){return!!T.changeParent}handleDrop(T,O){return this.determineParent(O).then(I=>this.relationHierarchyService.changeParent(T,I))}determineParent(T){let O=T.previousElementSibling;const I=T.nextElementSibling;let Z=null;if(null!==O&&this.droppedIntoGroup(T,O,I)){if(O.className.indexOf((0,l.gx)())>=0){const J=this.findRelationRowRoot(O);if(null==J)return Promise.resolve(null);O=J}const B=O.dataset.workPackageId;if(this.isHiearchyRoot(O,B)){if((0,l._D)(I))return this.determineParent(O);Z=B}else Z=this.loadParentOfWP(B)}return Promise.resolve(Z)}findRelationRowRoot(T){let O=T.previousElementSibling;for(;null!==O;){if(O.className.indexOf((0,l.gx)())<0)return O;O=O.previousElementSibling}return null}droppedIntoGroup(T,O,I){const Z=O.className.indexOf((0,i.oQ)(""))>=0,j=O.className.indexOf((0,i.MO)(""))>=0;let B;if(Z||j){const J=Array.from(T.classList).filter(ie=>ie.includes("__hierarchy-group-"))||[],R=Array.from(O.classList).filter(ie=>ie.includes("__hierarchy-group-"))||[],F=I&&Array.from(I.classList).filter(ie=>ie.includes("__hierarchy-group-"))||[],Y=O.dataset.workPackageId,X=!F.some(ie=>R.includes(ie))&&!F.includes((0,i.oQ)(Y)),K=J.some(ie=>R.includes(ie))||J.includes((0,i.oQ)(Y));B=X&&!K}return!B&&Z||j}isHiearchyRoot(T,O){return T.classList.contains((0,i.MO)(O))}loadParentOfWP(T){return this.apiV3Service.work_packages.id(T).get().toPromise().then(O=>{var I;return Promise.resolve((null===(I=O.parent)||void 0===I?void 0:I.id)||null)})}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",h.Y)],f.prototype,"wpTableHierarchies",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",c.O)],f.prototype,"relationHierarchyService",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",d.T)],f.prototype,"apiV3Service",void 0);var a=t(61083),m=t(12703),v=t(68130),C=t(67749),u=t(67727),k=t(1403),x=t(44022);class b extends e{get applies(){return this.wpTableGroupBy.isEnabled}canPickup(T){const O=this.groupedAttribute;return null!==O&&this.schemaCache.of(T).isAttributeEditable(O)}handleDrop(T,O){const I=this.halEditing.changeFor(T),Z=this.getValueForGroup(O);return I.projectedResource[this.groupedAttribute]=Z,this.halEditing.save(I).then(j=>this.halEvents.push(j.resource,{eventType:"updated"})).catch(j=>this.halNotification.handleRawError(j,T))}getValueForGroup(T){const O=(0,l.hK)(T,`.${v.u}`),I=this.groups.find(Z=>(0,C.M4)(Z)===O.dataset.groupIdentifier);if(!I)return null;if(I._links&&I._links.valueLink){const Z=I._links.valueLink;return 1===Z.length?Z[0]:Z}return I.value}get groupedAttribute(){const{current:T}=this.wpTableGroupBy;return T?T.id:null}get groups(){return this.querySpace.groups.value||[]}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",a.w)],b.prototype,"wpTableGroupBy",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",m.l)],b.prototype,"halEditing",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",k.J)],b.prototype,"halEvents",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",u.W)],b.prototype,"halNotification",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",x.y)],b.prototype,"schemaCache",void 0);var y=t(2316);class P{constructor(){this.register=[f,b]}add(T){this.register.push(T)}get(T){const O=T.get(n.q);return this.register.map(Z=>new Z(O,T)).find(Z=>Z.applies)||new e(O,T)}}P.\u0275fac=function(T){return new(T||P)},P.\u0275prov=y.Yz7({token:P,factory:P.\u0275fac})},166:(te,M,t)=>{"use strict";t.d(M,{Z:()=>ee});var n=t(3786),e=t(2316),p=t(73165),h=t(40533),c=t(93903),i=t(57119),l=t(77355),r=t(45338),d=t(86469),f=t(55977),a=t(96617),m=t(43440),v=t(34520),C=t(29161),u=t(33276),k=t(65146),x=t(74478);class b extends v._{constructor(){super(...arguments),this.uniqueEmbeddedTableName=`embedded-table-${Date.now()}`,this.initialLoadingIndicator=!0,this.renderTable=!1,this.showTablePagination=!1,this.error=null,this.initialized=!1}ngOnInit(){this.configuration=new r.O(this.providedConfiguration),this.configuration.isEmbedded=!0,this.initialized=!0,super.ngOnInit()}ngAfterViewInit(){this.loadQuery(!0,!1)}ngOnChanges(se){this.initialized&&(se.queryId||se.queryProps)&&this.loadQuery(this.initialLoadingIndicator,!1)}get projectIdentifier(){return this.configuration.projectContext?this.currentProject.identifier||void 0:this.configuration.projectIdentifier||void 0}buildQueryProps(){const se=this.querySpace.query.value;return this.wpStatesInitialization.applyToQuery(se),this.urlParamsHelper.buildV3GetQueryFromQueryResource(se)}buildUrlParams(){const se=this.querySpace.query.value;return this.wpStatesInitialization.applyToQuery(se),this.urlParamsHelper.encodeQueryJsonParams(se)}setLoaded(){this.renderTable=this.configuration.tableVisible,this.cdRef.detectChanges()}refresh(se=!0,re=!1){const Me=this.querySpace.query.value,Ae=this.wpTablePagination.paginationObject;re&&(Ae.offset=1);const Ye=this.urlParamsHelper.buildV3GetQueryFromQueryResource(Me,Ae),ze=this.wpListService.loadQueryFromExisting(Me,Ye,this.queryProjectScope).toPromise().then(Xe=>this.wpStatesInitialization.updateQuerySpace(Xe,Xe.results));return se&&(this.loadingIndicator=ze),ze}get isInitialized(){return!!this.configuration}set loadingIndicator(se){this.configuration.tableVisible&&(this.loadingIndicatorService.indicator(this.uniqueEmbeddedTableName).promise=se)}get queryProjectScope(){if(this.configuration.projectContext)return this.projectIdentifier}initializeStates(se){this.wpStatesInitialization.clearStates(),this.wpStatesInitialization.initializeFromQuery(se,se.results),this.wpStatesInitialization.updateQuerySpace(se,se.results)}}b.\u0275fac=function(){let ce;return function(re){return(ce||(ce=e.n5z(b)))(re||b)}}(),b.\u0275dir=e.lG2({type:b,inputs:{providedConfiguration:["configuration","providedConfiguration"],uniqueEmbeddedTableName:"uniqueEmbeddedTableName",initialLoadingIndicator:"initialLoadingIndicator"},features:[e.qOj,e.TTD]}),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",u.T)],b.prototype,"apiV3Service",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",m.q)],b.prototype,"querySpace",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",a.D)],b.prototype,"I18n",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",f.Z)],b.prototype,"urlParamsHelper",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",d.vt)],b.prototype,"loadingIndicatorService",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",x.f)],b.prototype,"wpStatesInitialization",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",k.R)],b.prototype,"currentProject",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",e.sBO)],b.prototype,"cdRef",void 0);var y=t(33927),P=t(83720),E=t(17163),T=t(53466),O=t(84109),I=t(54364),Z=t(2770),j=t(77434),B=t(18942),J=t(88923);function R(ce,se){if(1&ce&&e._UZ(0,"op-filter-container",10),2&ce){const re=e.oxw(3);e.Q6J("showFilterButton",re.configuration.showFilterButton)("filterButtonText",re.configuration.filterButtonText)}}function F(ce,se){if(1&ce){const re=e.EpF();e.TgZ(0,"wp-table",11),e.NdJ("itemClicked",function(Ae){return e.CHM(re),e.oxw(3).handleWorkPackageClicked(Ae)})("stateLinkClicked",function(Ae){return e.CHM(re),e.oxw(3).openStateLink(Ae)}),e.qZA()}if(2&ce){const re=e.oxw(3);e.Q6J("projectIdentifier",re.projectIdentifier)("configuration",re.configuration)}}function Y(ce,se){if(1&ce){const re=e.EpF();e.TgZ(0,"wp-grid",12),e.NdJ("itemClicked",function(Ae){return e.CHM(re),e.oxw(3).handleWorkPackageClicked(Ae)})("stateLinkClicked",function(Ae){return e.CHM(re),e.oxw(3).openStateLink(Ae)}),e.qZA()}if(2&ce){const re=e.oxw(3);e.Q6J("configuration",re.configuration)}}function X(ce,se){if(1&ce&&(e.ynx(0),e.YNc(1,R,1,2,"op-filter-container",4),e.YNc(2,F,1,2,"wp-table",5),e.TgZ(3,"div",6),e.YNc(4,Y,1,1,"wp-grid",7),e.qZA(),e.TgZ(5,"div",8),e._UZ(6,"wp-table-pagination",9),e.qZA(),e.BQk()),2&ce){const re=e.oxw(2);e.xp6(1),e.Q6J("ngIf",re.configuration.withFilters),e.xp6(1),e.Q6J("ngIf",!re.configuration.isCardView),e.xp6(2),e.Q6J("ngIf",re.configuration.isCardView),e.xp6(2),e.Q6J("hideForSinglePageResults",!0)}}function K(ce,se){if(1&ce&&(e.TgZ(0,"div",13),e._UZ(1,"span",14),e.qZA()),2&ce){const re=e.oxw(2);e.xp6(1),e.Q6J("textContent",re.error.message||re.error)}}const ie=function(ce,se,re){return{"-hierarchy-disabled":ce,"-compact-tables":se,"-external-height":re}};function H(ce,se){if(1&ce&&(e.TgZ(0,"div",1),e.YNc(1,X,7,4,"ng-container",2),e.YNc(2,K,2,1,"div",3),e.qZA()),2&ce){const re=e.oxw();e.Q6J("ngClass",e.kEZ(4,ie,!re.configuration.hierarchyToggleEnabled,re.configuration.compactTableStyle,re.externalHeight)),e.uIk("data-indicator-name",re.uniqueEmbeddedTableName),e.xp6(1),e.Q6J("ngIf",re.renderTable),e.xp6(1),e.Q6J("ngIf",re.error)}}class ee extends b{constructor(){super(...arguments),this.queryProps={},this.tableActions=[],this.externalHeight=!1,this.onError=new e.vpe,this.onQueryLoaded=new e.vpe}ngOnInit(){super.ngOnInit(),this.loadedQuery=this.querySpace.query.value}ngAfterViewInit(){super.ngAfterViewInit(),this.tableActions&&this.tableActionsService.setActions(...this.tableActions),this.wpTablePagination.updates$().pipe((0,y.U)(se=>[se.page,se.perPage]),(0,P.x)(),this.untilDestroyed(),(0,E.M)(this.querySpace.query.values$())).subscribe(([se,re])=>{const Me=this.wpTablePagination.paginationObject,Ae=this.urlParamsHelper.buildV3GetQueryFromQueryResource(re,Me);this.loadingIndicator=this.wpListService.loadQueryFromExisting(re,Ae,this.queryProjectScope).toPromise().then(Ye=>this.initializeStates(Ye))})}openConfigurationModal(se){return(0,n.mG)(this,void 0,void 0,function*(){yield this.querySpace.query.valuesPromise(),this.opModalService.show(i.Q,this.injector).subscribe(re=>re.onDataUpdated.subscribe(se))})}initializeStates(se){this.loadForm(se),super.initializeStates(se),this.querySpace.initialized.values$().pipe((0,T.q)(1)).subscribe(()=>{this.showTablePagination=se.results.total>se.results.count,this.setLoaded(),this.wpTableTimeline.isVisible&&(this.configuration=Object.assign(Object.assign({},this.configuration),{compactTableStyle:!1}))})}loadForm(se){return this.formPromise?this.formPromise:this.formPromise=this.apiv3Service.withOptionalProject(this.projectIdentifier).queries.form.load(se).toPromise().then(([re,Me])=>(this.wpStatesInitialization.updateStatesFromForm(se,re),re)).catch(()=>this.formPromise=void 0)}loadQuery(se=!0,re=!1){if(this.formPromise=void 0,this.loadedQuery){const Ae=this.loadedQuery;return this.loadedQuery=void 0,this.initializeStates(Ae),Promise.resolve(this.loadedQuery)}this.configuration.tableVisible||(this.queryProps.pageSize=1),re&&(this.queryProps.page=1),this.error=null;const Me=this.apiv3Service.queries.find(this.queryProps,this.queryId,this.queryProjectScope).toPromise().then(Ae=>(this.initializeStates(Ae),this.onQueryLoaded.emit(Ae),Ae)).catch(Ae=>{this.error=this.I18n.t("js.error.embedded_table_loading",{message:_.get(Ae,"message",Ae)}),this.onError.emit(Ae)});return se&&(this.loadingIndicator=Me),Me}handleWorkPackageClicked(se){se.double&&this.$state.go("work-packages.show",{workPackageId:se.workPackageId})}openStateLink(se){const re={workPackageId:se.workPackageId,focus:!0};"split"===se.requestedState?this.keepTab.goCurrentDetailsState(re):this.keepTab.goCurrentShowState(re)}}ee.\u0275fac=function(){let ce;return function(re){return(ce||(ce=e.n5z(ee)))(re||ee)}}(),ee.\u0275cmp=e.Xpm({type:ee,selectors:[["wp-embedded-table"]],inputs:{queryId:"queryId",queryProps:"queryProps",tableActions:"tableActions",externalHeight:"externalHeight"},outputs:{onError:"onError",onQueryLoaded:"onQueryLoaded"},features:[e.qOj],decls:1,vars:1,consts:[["class","work-packages-embedded-view--container loading-indicator--location",3,"ngClass",4,"ngIf"],[1,"work-packages-embedded-view--container","loading-indicator--location",3,"ngClass"],[4,"ngIf"],["class","op-toast -error",4,"ngIf"],[3,"showFilterButton","filterButtonText",4,"ngIf"],["class","work-packages-split-view--tabletimeline-content",3,"projectIdentifier","configuration","itemClicked","stateLinkClicked",4,"ngIf"],[1,"work-packages-embedded-view--grid-view"],[3,"configuration","itemClicked","stateLinkClicked",4,"ngIf"],[1,"work-packages-split-view--tabletimeline-footer","hide-when-print"],[3,"hideForSinglePageResults"],[3,"showFilterButton","filterButtonText"],[1,"work-packages-split-view--tabletimeline-content",3,"projectIdentifier","configuration","itemClicked","stateLinkClicked"],[3,"configuration","itemClicked","stateLinkClicked"],[1,"op-toast","-error"],[3,"textContent"]],template:function(se,re){1&se&&e.YNc(0,H,3,8,"div",0),2&se&&e.Q6J("ngIf",re.configuration)},directives:[I.O5,I.mk,Z.v,j.J,B.c,J.b],encapsulation:2}),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",u.T)],ee.prototype,"apiv3Service",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",l.S)],ee.prototype,"opModalService",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",c.j)],ee.prototype,"tableActionsService",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",p.W)],ee.prototype,"wpTableTimeline",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",h.S)],ee.prototype,"wpTablePagination",void 0),(0,n.gn)([(0,C.W)(),(0,n.w6)("design:type",O.p)],ee.prototype,"keepTab",void 0)},62016:(te,M,t)=>{"use strict";t.d(M,{O:()=>f});var n=t(166),e=t(71444),p=t(628),h=t(37605),c=t(55977),i=t(2316),l=t(97047);const r=["embeddedTableForConfiguration"],d=function(){return{tableVisible:!1}};class f{constructor(m,v,C){this.locals=m,this.urlParamsHelper=v,this.cdRef=C}ngOnInit(){this.locals.urlParams?this.queryProps=this.urlParamsHelper.buildV3GetQueryFromJsonParams(this.locals.currentQuery):this.queryProps=this.locals.currentQuery}ngAfterViewInit(){setTimeout(()=>{this.embeddedTable.openConfigurationModal(()=>{this.service.detach(),this.locals.urlParams?this.locals.callback(this.embeddedTable.buildUrlParams()):this.locals.callback(this.embeddedTable.buildQueryProps())}),this.cdRef.detectChanges()})}get service(){return this.locals.service}}f.\u0275fac=function(m){return new(m||f)(i.Y36(h.J),i.Y36(c.Z),i.Y36(i.sBO))},f.\u0275cmp=i.Xpm({type:f,selectors:[["ng-component"]],viewQuery:function(m,v){if(1&m&&i.Gf(r,7),2&m){let C;i.iGM(C=i.CRH())&&(v.embeddedTable=C.first)}},features:[i._Bn([[{provide:e.p,useClass:p.P}]])],decls:3,vars:3,consts:[["wp-isolated-query-space",""],[3,"queryProps","configuration"],["embeddedTableForConfiguration",""]],template:function(m,v){1&m&&(i.ynx(0,0),i._UZ(1,"wp-embedded-table",1,2),i.BQk()),2&m&&(i.xp6(1),i.Q6J("queryProps",v.queryProps)("configuration",i.DdM(2,d)))},directives:[l.A,n.Z],encapsulation:2})},37605:(te,M,t)=>{"use strict";t.d(M,{J:()=>e});const e=new(t(2316).OlP)("OpQueryConfigurationLocalsToken")},5275:(te,M,t)=>{"use strict";t.d(M,{W:()=>l});var n=t(40912),e=t(47775),p=t(7101),h=t(62016),c=t(37605),i=t(2316);class l{constructor(d,f,a,m,v){this.componentFactoryResolver=d,this.FocusHelper=f,this.appRef=a,this.$transitions=m,this.injector=v}get bodyPortalHost(){if(!this._portalHostElement){const d=this._portalHostElement=document.createElement("div");d.classList.add("op-external-query-configuration--container"),document.body.appendChild(d),this._bodyPortalHost=new n.u0(d,this.componentFactoryResolver,this.appRef,this.injector)}return this._bodyPortalHost}show(d){this.detach();const f=new n.C5(this.externalQueryConfigurationComponent(),null,this.injectorFor(d));this.bodyPortalHost.attach(f),this._portalHostElement.style.display="block"}detach(){this.bodyPortalHost.hasAttached()&&(this.bodyPortalHost.detach(),this._portalHostElement.style.display="none")}injectorFor(d){const f=new WeakMap;return d.service=this,f.set(c.J,d),new n.nK(this.injector,f)}externalQueryConfigurationComponent(){return h.O}}l.\u0275fac=function(d){return new(d||l)(i.LFG(i._Vd),i.LFG(p.i),i.LFG(i.z2F),i.LFG(e.TransitionService),i.LFG(i.zs3))},l.\u0275prov=i.Yz7({token:l,factory:l.\u0275fac})},74961:(te,M,t)=>{"use strict";t.d(M,{Q:()=>y});var n=t(5275),e=t(71444),p=t(628),h=t(12877),c=t(96617),i=t(74647),l=t(44022),r=t(2316),d=t(1707),f=t(54364);function a(P,E){if(1&P&&r._UZ(0,"option",4),2&P){const T=E.$implicit,O=r.oxw();r.Q6J("textContent",O.text[T.id])("ngValue",T)}}class m{constructor(E,T,O,I,Z){this.injector=E,this.I18n=T,this.wpTableFilters=O,this.ConfigurationService=I,this.schemaCache=Z,this.relationFilterIds=["parent","precedes","follows","relates","duplicates","duplicated","blocks","blocked","partof","includes","requires","required"],this.availableRelationFilters=[],this.selectedRelationFilter=void 0,this.text={filter_work_packages_by_relation_type:this.I18n.t("js.work_packages.table_configuration.relation_filters.filter_work_packages_by_relation_type"),please_select:this.I18n.t("js.placeholders.selection"),parent:this.I18n.t("js.relation_labels.children"),precedes:this.I18n.t("js.relation_labels.follows"),follows:this.I18n.t("js.relation_labels.precedes"),relates:this.I18n.t("js.relation_labels.relates"),duplicates:this.I18n.t("js.relation_labels.duplicated"),duplicated:this.I18n.t("js.relation_labels.duplicates"),blocks:this.I18n.t("js.relation_labels.blocked"),blocked:this.I18n.t("js.relation_labels.blocks"),requires:this.I18n.t("js.relation_labels.required"),required:this.I18n.t("js.relation_labels.requires"),partof:this.I18n.t("js.relation_labels.includes"),includes:this.I18n.t("js.relation_labels.partof")}}ngOnInit(){const E=this;this.wpTableFilters.onReady().then(()=>{E.availableRelationFilters=E.relationFiltersOf(E.wpTableFilters.availableFilters),E.setSelectedRelationFilter()})}setSelectedRelationFilter(){const E=this.relationFiltersOf(this.wpTableFilters.current);E.length>0?this.selectedRelationFilter=_.find(this.availableRelationFilters,{id:E[0].id}):this.selectedRelationFilter=this.availableRelationFilters[0],this.onRelationFilterSelected()}onRelationFilterSelected(){this.selectedRelationFilter&&(this.removeRelationFiltersFromCurrentState(),this.addFilterToCurrentState(this.selectedRelationFilter))}removeRelationFiltersFromCurrentState(){const E=this.relationFiltersOf(this.wpTableFilters.current);this.wpTableFilters.remove(...E)}relationFiltersOf(E){return _.filter(E,T=>_.includes(this.relationFilterIds,T.id))}addFilterToCurrentState(E){const T=this.wpTableFilters.instantiate(E),O=this.getOperatorForId(T,"=");T.operator=O,T.values=[{href:"/api/v3/work_packages/{id}"}],this.wpTableFilters.add(T)}getOperatorForId(E,T){return _.find(this.schemaCache.of(E).availableOperators,{id:T})}compareRelationFilters(E,T){return E&&T?E.id===T.id:E===T}}m.\u0275fac=function(E){return new(E||m)(r.Y36(r.zs3),r.Y36(c.D),r.Y36(i.Z),r.Y36(h.e),r.Y36(l.y))},m.\u0275cmp=r.Xpm({type:m,selectors:[["wp-table-configuration-relation-selector"]],decls:6,vars:4,consts:[[1,"relation-filter-selector"],[3,"textContent"],["id","",1,"form--select","form--inline-select",3,"ngModel","compareWith","ngModelChange"],[3,"textContent","ngValue",4,"ngFor","ngForOf"],[3,"textContent","ngValue"]],template:function(E,T){1&E&&(r.TgZ(0,"div",0),r.TgZ(1,"h5"),r._UZ(2,"span",1),r._uU(3," "),r.TgZ(4,"select",2),r.NdJ("ngModelChange",function(I){return T.selectedRelationFilter=I})("ngModelChange",function(){return T.onRelationFilterSelected()}),r.YNc(5,a,1,2,"option",3),r.qZA(),r.qZA(),r.qZA()),2&E&&(r.xp6(2),r.Q6J("textContent",T.text.filter_work_packages_by_relation_type),r.xp6(2),r.Q6J("ngModel",T.selectedRelationFilter)("compareWith",T.compareRelationFilters),r.xp6(1),r.Q6J("ngForOf",T.availableRelationFilters))},directives:[d.EJ,d.JJ,d.On,f.sg,d.YN,d.Kr],encapsulation:2});var v=t(57119),C=t(62016),u=t(97047),k=t(166);const x=function(){return{tableVisible:!1}};class b extends C.O{}b.\u0275fac=function(){let P;return function(T){return(P||(P=r.n5z(b)))(T||b)}}(),b.\u0275cmp=r.Xpm({type:b,selectors:[["ng-component"]],features:[r._Bn([[{provide:e.p,useClass:p.P}],{provide:v.c,useValue:m}]),r.qOj],decls:3,vars:3,consts:[["wp-isolated-query-space",""],[3,"queryProps","configuration"],["embeddedTableForConfiguration",""]],template:function(E,T){1&E&&(r.ynx(0,0),r._UZ(1,"wp-embedded-table",1,2),r.BQk()),2&E&&(r.xp6(1),r.Q6J("queryProps",T.queryProps)("configuration",r.DdM(2,x)))},directives:[u.A,k.Z],encapsulation:2});class y extends n.W{externalQueryConfigurationComponent(){return b}}y.\u0275fac=function(){let P;return function(T){return(P||(P=r.n5z(y)))(T||y)}}(),y.\u0275prov=r.Yz7({token:y,factory:y.\u0275fac})},628:(te,M,t)=>{"use strict";t.d(M,{P:()=>c});var n=t(96617),e=t(71444),p=t(37605),h=t(2316);class c extends e.p{constructor(l,r){super(r),this.locals=l,this.I18n=r}get tabs(){const l=this.locals.disabledTabs||{};return this._tabs.map(r=>{const d=l[r.id];return null!=d&&(r.disable=d),r})}}c.\u0275fac=function(l){return new(l||c)(h.LFG(p.J),h.LFG(n.D))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac})},23893:(te,M,t)=>{"use strict";t.d(M,{g:()=>p});var n=t(85003),e=t(65978);class p extends n.z9{constructor(c,i,l,r,d,f){super(c,i),this.injector=c,this.workPackage=i,this.identifier=l,this.title=r,this.applicable=d,this.onClick=f}static factoryFor(c,i,l,r=(()=>!0)){return(d,f)=>new p(d,f,c,i,r,l)}buildElement(){if(!this.applicable(this.workPackage))return null;const c=document.createElement("a");return c.title=this.title,c.href="#",c.classList.add(n.gK,"wp-table-action--unlink"),c.dataset.workPackageId=this.workPackage.id,c.appendChild((0,e.c)("icon","icon-close")),jQuery(c).click(i=>{i.preventDefault(),this.onClick(this.workPackage)}),c}}},85003:(te,M,t)=>{"use strict";t.d(M,{oE:()=>h,K$:()=>c,E4:()=>i,gK:()=>l,z9:()=>r});var n=t(3786),e=t(96617),p=t(29161);const h="wp-table--context-menu-td",c="wp-table--context-menu-span",i="wp-table-context-menu-link",l="wp-table-context-menu-icon";class r{constructor(f,a){this.injector=f,this.workPackage=a}}(0,n.gn)([(0,p.W)(),(0,n.w6)("design:type",e.D)],r.prototype,"I18n",void 0)},93903:(te,M,t)=>{"use strict";t.d(M,{j:()=>f});var n=t(85003),e=t(65978),p=t(84109),h=t(20506),c=t(47775);class l extends n.z9{constructor(){super(...arguments),this.identifier="open-details-action",this.uiStatebuilder=new h.mE(this.injector.get(c.StateService),this.injector.get(p.p)),this.text={button:this.I18n.t("js.button_open_details")}}buildElement(){const m=this.uiStatebuilder.linkToDetails(this.workPackage.id,this.text.button,"");return m.classList.add("wp-table--details-link",n.gK,"hidden-for-mobile"),m.appendChild((0,e.c)("icon","icon-info2")),m}}class r extends n.z9{constructor(){super(...arguments),this.identifier="open-context-menu-action",this.text={linkTitle:this.I18n.t("js.label_open_context_menu")}}buildElement(){const m=document.createElement("a");return m.href="#",m.classList.add(n.E4,n.gK),m.title=this.text.linkTitle,m.appendChild((0,e.c)("icon","icon-show-more-horizontal")),m}}var d=t(2316);class f{constructor(m){this.injector=m,this.actions=[(v,C)=>new l(v,C),(v,C)=>new r(v,C)]}setActions(...m){this.actions=m}render(m){const v=this.actions.map(C=>C(this.injector,m).buildElement());return _.compact(v)}}f.\u0275fac=function(m){return new(m||f)(d.LFG(d.zs3))},f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac})},2770:(te,M,t)=>{"use strict";t.d(M,{v:()=>dt});var n=t(96617),e=t(40533),p=t(82763),h=t(43440),c=t(61486),i=t(2316),l=t(26942),r=t(14359),d=t(68853),f=t(54364),a=t(2775);function v(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"li",15),i.TgZ(1,"button",16),i.NdJ("click",function(){const me=i.CHM(D).$implicit;return i.oxw(3).showPage(me)}),i.qZA(),i.qZA()}if(2&de){const D=oe.$implicit;i.xp6(1),i.Q6J("textContent",D)}}function C(de,oe){if(1&de&&(i.ynx(0),i.YNc(1,v,2,1,"li",13),i.TgZ(2,"li",14),i._uU(3,"\u2026"),i.qZA(),i.BQk()),2&de){const D=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",D.prePageNumbers)}}function u(de,oe){if(1&de&&(i.TgZ(0,"em"),i._uU(1),i.qZA()),2&de){const D=i.oxw().$implicit;i.xp6(1),i.Oqu(D)}}function k(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"button",16),i.NdJ("click",function(){i.CHM(D);const V=i.oxw().$implicit;return i.oxw(3).showPage(V)}),i.qZA()}if(2&de){const D=i.oxw().$implicit;i.Q6J("textContent",D)}}const x=function(de){return{"op-pagination--item_current":de}};function b(de,oe){if(1&de&&(i.TgZ(0,"li",19),i.YNc(1,u,2,1,"em",6),i.YNc(2,k,1,1,"button",20),i.qZA()),2&de){const D=oe.$implicit,G=i.oxw(3);i.Q6J("ngClass",i.VKq(3,x,D==G.pagination.page)),i.xp6(1),i.Q6J("ngIf",D==G.pagination.page),i.xp6(1),i.Q6J("ngIf",D!=G.pagination.page)}}function y(de,oe){1&de&&(i.TgZ(0,"li",14),i._uU(1,"\u2026"),i.qZA())}function P(de,oe){if(1&de&&(i.ynx(0),i.YNc(1,b,3,5,"li",17),i.YNc(2,y,2,0,"li",18),i.BQk()),2&de){const D=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",D.pageNumbers),i.xp6(1),i.Q6J("ngIf",D.postPageNumbers.length)}}function E(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"li",15),i.TgZ(1,"button",16),i.NdJ("click",function(){const me=i.CHM(D).$implicit;return i.oxw(3).showPage(me)}),i.qZA(),i.qZA()}if(2&de){const D=oe.$implicit;i.xp6(1),i.Q6J("textContent",D)}}function T(de,oe){if(1&de&&(i.ynx(0),i.YNc(1,E,2,1,"li",13),i.BQk()),2&de){const D=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",D.postPageNumbers)}}function O(de,oe){if(1&de&&i._UZ(0,"span",21),2&de){const D=i.oxw(2);i.Q6J("textContent",D.text.no_other_page)}}function I(de,oe){if(1&de&&(i.TgZ(0,"li",22),i._UZ(1,"op-icon",23),i._UZ(2,"span",9),i.qZA()),2&de){const D=i.oxw(2);i.xp6(2),i.Q6J("textContent",D.infoText)}}function Z(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"span"),i.TgZ(1,"button",27),i.NdJ("click",function(){i.CHM(D);const V=i.oxw().$implicit;return i.oxw(3).selectPerPage(V)}),i.qZA(),i.qZA()}if(2&de){const D=i.oxw().$implicit;i.xp6(1),i.Q6J("textContent",D)}}function j(de,oe){if(1&de&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&de){const D=i.oxw().$implicit;i.xp6(1),i.Oqu(D)}}function B(de,oe){if(1&de&&(i.TgZ(0,"li",19),i.YNc(1,Z,2,1,"span",6),i.YNc(2,j,2,1,"span",6),i.qZA()),2&de){const D=oe.$implicit,G=i.oxw(3);i.Q6J("ngClass",i.VKq(3,x,D==G.pagination.perPage)),i.xp6(1),i.Q6J("ngIf",D!=G.pagination.perPage),i.xp6(1),i.Q6J("ngIf",D==G.pagination.perPage)}}function J(de,oe){if(1&de&&(i.TgZ(0,"div",24),i.TgZ(1,"ul",25),i._UZ(2,"li",26),i.YNc(3,B,3,5,"li",17),i.qZA(),i.qZA()),2&de){const D=i.oxw(2);i.xp6(2),i.s9C("title",D.text.per_page),i.Q6J("textContent",D.text.per_page),i.xp6(1),i.Q6J("ngForOf",D.perPageOptions)}}function R(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"div",1),i.TgZ(1,"nav",2),i.TgZ(2,"ul",3),i.TgZ(3,"li",4),i.TgZ(4,"button",5),i.NdJ("click",function(){i.CHM(D);const V=i.oxw();return V.showPage(V.pagination.page-1)}),i._uU(5," < "),i.qZA(),i.qZA(),i.YNc(6,C,4,1,"ng-container",6),i.YNc(7,P,3,2,"ng-container",6),i.YNc(8,T,2,1,"ng-container",6),i.TgZ(9,"li",4),i.TgZ(10,"button",7),i.NdJ("click",function(){i.CHM(D);const V=i.oxw();return V.showPage(V.pagination.page+1)}),i._uU(11," > "),i.qZA(),i.qZA(),i.TgZ(12,"li",8),i._UZ(13,"span",9),i.YNc(14,O,1,1,"span",10),i.qZA(),i.YNc(15,I,3,1,"li",11),i.qZA(),i.qZA(),i.YNc(16,J,4,3,"div",12),i.qZA()}if(2&de){const D=i.oxw();i.xp6(3),i.Q6J("hidden",1==D.pagination.page||!D.showPageSelections),i.xp6(1),i.uIk("aria-label",D.text.label_previous),i.xp6(2),i.Q6J("ngIf",D.prePageNumbers.length>0),i.xp6(1),i.Q6J("ngIf",D.pageNumbers.length>1),i.xp6(1),i.Q6J("ngIf",D.postPageNumbers.length),i.xp6(1),i.Q6J("hidden",!(D.pagination.total&&D.pagination.page<D.pageNumbers[D.pageNumbers.length-1])),i.xp6(1),i.uIk("aria-label",D.text.label_next),i.xp6(3),i.Q6J("textContent",D.currentRange),i.xp6(1),i.Q6J("ngIf",1===D.pageNumbers.length),i.xp6(1),i.Q6J("ngIf",D.infoText),i.xp6(1),i.Q6J("ngIf",D.showPerPageOptions())}}class F extends l.N{constructor(oe,D,G){super(),this.paginationService=oe,this.cdRef=D,this.I18n=G,this.hideForSinglePageResults=!1,this.showPerPage=!0,this.showPageSelections=!0,this.updateResults=new i.vpe,this.text={label_previous:this.I18n.t("js.pagination.pages.previous"),label_next:this.I18n.t("js.pagination.pages.next"),per_page:this.I18n.t("js.label_per_page"),no_other_page:this.I18n.t("js.pagination.no_other_page")},this.currentRange="",this.pageNumbers=[],this.postPageNumbers=[],this.prePageNumbers=[],this.perPageOptions=[]}ngOnInit(){this.paginationService.loadPaginationOptions().then(oe=>{this.perPageOptions=oe.perPageOptions,this.pagination=new r.M(1,parseInt(this.totalEntries),oe.perPage),this.cdRef.detectChanges()})}update(){this.updateCurrentRangeLabel(),this.updatePageNumbers(),this.cdRef.detectChanges()}selectPerPage(oe){this.pagination.perPage=oe,this.paginationService.setPerPage(oe),this.showPage(1)}showPage(oe){this.pagination.page=oe,this.updateCurrentRangeLabel(),this.updatePageNumbers(),this.onUpdatedPage(),this.cdRef.detectChanges()}onUpdatedPage(){this.updateResults.emit(this.pagination)}get isVisible(){return!this.hideForSinglePageResults||this.pagination.total>this.pagination.perPage}updateCurrentRangeLabel(){if(this.pagination.total){const oe=this.pagination.total,D=this.pagination.getLowerPageBound(),G=this.pagination.getUpperPageBound(this.pagination.total);this.currentRange=`(${D}\xa0-\xa0${G}/${oe})`}else this.currentRange="(0 - 0/0)"}updatePageNumbers(){if(!this.showPageSelections)return this.pageNumbers=[],void(this.postPageNumbers=[]);const oe=this.paginationService.getMaxVisiblePageOptions(),D=this.paginationService.getOptionsTruncationSize(),G=[],{perPage:V}=this.pagination,me=this.pagination.page;if(V){for(let Se=1;Se<=Math.ceil(this.pagination.total/V);Se++)G.push(Se);const $=me-2*D;$>=0&&$<=1?this.postPageNumbers=this.truncatePageNums(G,G.length>=oe+2*D,oe+D,G.length,0):(this.prePageNumbers=this.truncatePageNums(G,me>=oe,0,Math.min(me-Math.ceil(oe/2),G.length-oe),D),this.postPageNumbers=this.truncatePageNums(G,G.length>=oe+2*D,oe,G.length,0))}this.pageNumbers=G}showPerPageOptions(){return this.showPerPage&&this.perPageOptions.length>0&&this.pagination.total>this.perPageOptions[0]}truncatePageNums(oe,D,G,V,me){if(D){const $=this.paginationService.getOptionsTruncationSize(),Se=oe.splice(G,V);return Se.length>=2*$&&Se.splice(me,Se.length-$),Se}return[]}}function Y(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"li",15),i.TgZ(1,"button",16),i.NdJ("click",function(){const me=i.CHM(D).$implicit;return i.oxw(3).showPage(me)}),i.qZA(),i.qZA()}if(2&de){const D=oe.$implicit;i.xp6(1),i.Q6J("textContent",D)}}function X(de,oe){if(1&de&&(i.ynx(0),i.YNc(1,Y,2,1,"li",13),i.TgZ(2,"li",14),i._uU(3,"\u2026"),i.qZA(),i.BQk()),2&de){const D=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",D.prePageNumbers)}}function K(de,oe){if(1&de&&(i.TgZ(0,"em"),i._uU(1),i.qZA()),2&de){const D=i.oxw().$implicit;i.xp6(1),i.Oqu(D)}}function ie(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"button",16),i.NdJ("click",function(){i.CHM(D);const V=i.oxw().$implicit;return i.oxw(3).showPage(V)}),i.qZA()}if(2&de){const D=i.oxw().$implicit;i.Q6J("textContent",D)}}F.\u0275fac=function(oe){return new(oe||F)(i.Y36(d.N),i.Y36(i.sBO),i.Y36(n.D))},F.\u0275cmp=i.Xpm({type:F,selectors:[["","tablePagination",""]],inputs:{totalEntries:"totalEntries",hideForSinglePageResults:"hideForSinglePageResults",showPerPage:"showPerPage",showPageSelections:"showPageSelections",infoText:"infoText"},outputs:{updateResults:"updateResults"},features:[i.qOj],attrs:["tablePagination",""],decls:1,vars:1,consts:[["class","op-pagination",4,"ngIf"],[1,"op-pagination"],[1,"op-pagination--pages"],[1,"op-pagination--items","op-pagination--items_start"],[1,"op-pagination--item",3,"hidden"],["type","button","rel","prev start",1,"op-pagination--item-link","op-pagination--item-link_prev",3,"click"],[4,"ngIf"],["type","button","rel","next",1,"op-pagination--item-link","op-pagination--item-link_next",3,"click"],[1,"op-pagination--range"],[3,"textContent"],["id","op-pagination-empty-text","tabindex","0","class","hidden-for-sighted",3,"textContent",4,"ngIf"],["class","op-pagination--info",4,"ngIf"],["class","op-pagination--options",4,"ngIf"],["class","op-pagination--item",4,"ngFor","ngForOf"],[1,"op-pagination--space"],[1,"op-pagination--item"],["type","button","rel","next",1,"op-pagination--item-link",3,"textContent","click"],["class","op-pagination--item",3,"ngClass",4,"ngFor","ngForOf"],["class","op-pagination--space",4,"ngIf"],[1,"op-pagination--item",3,"ngClass"],["class","op-pagination--item-link","type","button","rel","next",3,"textContent","click",4,"ngIf"],["id","op-pagination-empty-text","tabindex","0",1,"hidden-for-sighted",3,"textContent"],[1,"op-pagination--info"],["icon-classes","icon-info1 icon-context"],[1,"op-pagination--options"],[1,"op-pagination--items","op-pagination--items_end"],[1,"op-pagination--label",3,"textContent","title"],["type","button",1,"op-pagination--item-link",3,"textContent","click"]],template:function(oe,D){1&oe&&i.YNc(0,R,17,11,"div",0),2&oe&&i.Q6J("ngIf",D.pagination&&D.isVisible&&D.pagination.total)},directives:[f.O5,f.sg,f.mk,a.o],encapsulation:2,changeDetection:0});const H=function(de){return{"op-pagination--item_current":de}};function ee(de,oe){if(1&de&&(i.TgZ(0,"li",19),i.YNc(1,K,2,1,"em",6),i.YNc(2,ie,1,1,"button",20),i.qZA()),2&de){const D=oe.$implicit,G=i.oxw(3);i.Q6J("ngClass",i.VKq(3,H,D==G.pagination.page)),i.xp6(1),i.Q6J("ngIf",D==G.pagination.page),i.xp6(1),i.Q6J("ngIf",D!=G.pagination.page)}}function ce(de,oe){1&de&&(i.TgZ(0,"li",14),i._uU(1,"\u2026"),i.qZA())}function se(de,oe){if(1&de&&(i.ynx(0),i.YNc(1,ee,3,5,"li",17),i.YNc(2,ce,2,0,"li",18),i.BQk()),2&de){const D=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",D.pageNumbers),i.xp6(1),i.Q6J("ngIf",D.postPageNumbers.length)}}function re(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"li",15),i.TgZ(1,"button",16),i.NdJ("click",function(){const me=i.CHM(D).$implicit;return i.oxw(3).showPage(me)}),i.qZA(),i.qZA()}if(2&de){const D=oe.$implicit;i.xp6(1),i.Q6J("textContent",D)}}function Me(de,oe){if(1&de&&(i.ynx(0),i.YNc(1,re,2,1,"li",13),i.BQk()),2&de){const D=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",D.postPageNumbers)}}function Ae(de,oe){if(1&de&&i._UZ(0,"span",21),2&de){const D=i.oxw(2);i.Q6J("textContent",D.text.no_other_page)}}function Ye(de,oe){if(1&de&&(i.TgZ(0,"li",22),i._UZ(1,"op-icon",23),i._UZ(2,"span",9),i.qZA()),2&de){const D=i.oxw(2);i.xp6(2),i.Q6J("textContent",D.infoText)}}function ze(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"span"),i.TgZ(1,"button",27),i.NdJ("click",function(){i.CHM(D);const V=i.oxw().$implicit;return i.oxw(3).selectPerPage(V)}),i.qZA(),i.qZA()}if(2&de){const D=i.oxw().$implicit;i.xp6(1),i.Q6J("textContent",D)}}function Xe(de,oe){if(1&de&&(i.TgZ(0,"span"),i._uU(1),i.qZA()),2&de){const D=i.oxw().$implicit;i.xp6(1),i.Oqu(D)}}function it(de,oe){if(1&de&&(i.TgZ(0,"li",19),i.YNc(1,ze,2,1,"span",6),i.YNc(2,Xe,2,1,"span",6),i.qZA()),2&de){const D=oe.$implicit,G=i.oxw(3);i.Q6J("ngClass",i.VKq(3,H,D==G.pagination.perPage)),i.xp6(1),i.Q6J("ngIf",D!=G.pagination.perPage),i.xp6(1),i.Q6J("ngIf",D==G.pagination.perPage)}}function at(de,oe){if(1&de&&(i.TgZ(0,"div",24),i.TgZ(1,"ul",25),i._UZ(2,"li",26),i.YNc(3,it,3,5,"li",17),i.qZA(),i.qZA()),2&de){const D=i.oxw(2);i.xp6(2),i.s9C("title",D.text.per_page),i.Q6J("textContent",D.text.per_page),i.xp6(1),i.Q6J("ngForOf",D.perPageOptions)}}function lt(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"div",1),i.TgZ(1,"nav",2),i.TgZ(2,"ul",3),i.TgZ(3,"li",4),i.TgZ(4,"button",5),i.NdJ("click",function(){i.CHM(D);const V=i.oxw();return V.showPage(V.pagination.page-1)}),i._uU(5," < "),i.qZA(),i.qZA(),i.YNc(6,X,4,1,"ng-container",6),i.YNc(7,se,3,2,"ng-container",6),i.YNc(8,Me,2,1,"ng-container",6),i.TgZ(9,"li",4),i.TgZ(10,"button",7),i.NdJ("click",function(){i.CHM(D);const V=i.oxw();return V.showPage(V.pagination.page+1)}),i._uU(11," > "),i.qZA(),i.qZA(),i.TgZ(12,"li",8),i._UZ(13,"span",9),i.YNc(14,Ae,1,1,"span",10),i.qZA(),i.YNc(15,Ye,3,1,"li",11),i.qZA(),i.qZA(),i.YNc(16,at,4,3,"div",12),i.qZA()}if(2&de){const D=i.oxw();i.xp6(3),i.Q6J("hidden",1==D.pagination.page||!D.showPageSelections),i.xp6(1),i.uIk("aria-label",D.text.label_previous),i.xp6(2),i.Q6J("ngIf",D.prePageNumbers.length>0),i.xp6(1),i.Q6J("ngIf",D.pageNumbers.length>1),i.xp6(1),i.Q6J("ngIf",D.postPageNumbers.length),i.xp6(1),i.Q6J("hidden",!(D.pagination.total&&D.pagination.page<D.pageNumbers[D.pageNumbers.length-1])),i.xp6(1),i.uIk("aria-label",D.text.label_next),i.xp6(3),i.Q6J("textContent",D.currentRange),i.xp6(1),i.Q6J("ngIf",1===D.pageNumbers.length),i.xp6(1),i.Q6J("ngIf",D.infoText),i.xp6(1),i.Q6J("ngIf",D.showPerPageOptions())}}class dt extends F{constructor(oe,D,G,V,me,$){super(oe,D,$),this.paginationService=oe,this.cdRef=D,this.wpTablePagination=G,this.querySpace=V,this.wpTableSortBy=me,this.I18n=$}ngOnInit(){this.paginationService.loadPaginationOptions().then(oe=>{this.perPageOptions=oe.perPageOptions,this.cdRef.detectChanges()}),this.wpTablePagination.live$().pipe(this.untilDestroyed()).subscribe(oe=>{this.pagination=oe.current,this.update()}),(0,c.aj)([this.querySpace.query.values$(),this.wpTableSortBy.live$()]).pipe(this.untilDestroyed()).subscribe(([oe,D])=>{this.showPerPage=this.showPageSelections=!this.isManualSortingMode,this.infoText=this.paginationInfoText(oe.results),this.update()})}selectPerPage(oe){this.paginationService.setPerPage(oe),this.wpTablePagination.updateFromObject({page:1,perPage:oe})}showPage(oe){this.wpTablePagination.updateFromObject({page:oe})}get isManualSortingMode(){return this.wpTableSortBy.isManualSortingMode}paginationInfoText(oe){if(this.isManualSortingMode&&oe.count<oe.total)return I18n.t("js.work_packages.limited_results",{count:oe.count})}}dt.\u0275fac=function(oe){return new(oe||dt)(i.Y36(d.N),i.Y36(i.sBO),i.Y36(e.S),i.Y36(h.q),i.Y36(p.q),i.Y36(n.D))},dt.\u0275cmp=i.Xpm({type:dt,selectors:[["wp-table-pagination"]],features:[i.qOj],decls:1,vars:1,consts:[["class","op-pagination",4,"ngIf"],[1,"op-pagination"],[1,"op-pagination--pages"],[1,"op-pagination--items","op-pagination--items_start"],[1,"op-pagination--item",3,"hidden"],["type","button","rel","prev start",1,"op-pagination--item-link","op-pagination--item-link_prev",3,"click"],[4,"ngIf"],["type","button","rel","next",1,"op-pagination--item-link","op-pagination--item-link_next",3,"click"],[1,"op-pagination--range"],[3,"textContent"],["id","op-pagination-empty-text","tabindex","0","class","hidden-for-sighted",3,"textContent",4,"ngIf"],["class","op-pagination--info",4,"ngIf"],["class","op-pagination--options",4,"ngIf"],["class","op-pagination--item",4,"ngFor","ngForOf"],[1,"op-pagination--space"],[1,"op-pagination--item"],["type","button","rel","next",1,"op-pagination--item-link",3,"textContent","click"],["class","op-pagination--item",3,"ngClass",4,"ngFor","ngForOf"],["class","op-pagination--space",4,"ngIf"],[1,"op-pagination--item",3,"ngClass"],["class","op-pagination--item-link","type","button","rel","next",3,"textContent","click",4,"ngIf"],["id","op-pagination-empty-text","tabindex","0",1,"hidden-for-sighted",3,"textContent"],[1,"op-pagination--info"],["icon-classes","icon-info1 icon-context"],[1,"op-pagination--options"],[1,"op-pagination--items","op-pagination--items_end"],[1,"op-pagination--label",3,"textContent","title"],["type","button",1,"op-pagination--item-link",3,"textContent","click"]],template:function(oe,D){1&oe&&i.YNc(0,lt,17,11,"div",0),2&oe&&i.Q6J("ngIf",D.pagination&&D.isVisible&&D.pagination.total)},directives:[f.O5,f.sg,f.mk,a.o],encapsulation:2,changeDetection:0})},42529:(te,M,t)=>{"use strict";t.d(M,{mN:()=>p,PY:()=>h,oo:()=>c,LT:()=>i,bz:()=>l,eY:()=>r,$r:()=>f,GC:()=>a,g5:()=>m,O6:()=>v,lW:()=>C,jr:()=>u,kv:()=>k,Nm:()=>x});var n=t(2281);const p="timeline-element",h="timeline-element--bg",c="wp-timeline--grid-element",i="selection-start",l="wp-timeline--header-element",r="wp-timeline-header";class d{constructor(){this.zoomLevel="days"}}const f=["days","weeks","months","quarters","years"];function a(b){switch(b){case"days":return 30;case"weeks":return 15;case"months":return 6;case"quarters":return 2;case"years":return.5}throw new Error(`invalid zoom level: ${b}`)}const m=120;class v{constructor(){this.now=n({hour:0,minute:0,seconds:0}),this.dateDisplayStart=n({hour:0,minute:0,seconds:0}),this.dateDisplayEnd=this.dateDisplayStart.clone().add(1,"day"),this.settings=new d,this.activeSelectionMode=null,this.selectionModeStart=null}get pixelPerDay(){return a(this.settings.zoomLevel)}get maxWidthInPx(){return this.maxSteps*this.pixelPerDay}get maxSteps(){return this.dateDisplayEnd.diff(this.dateDisplayStart,"days")}get dayCountForMarginLeft(){return Math.ceil(m/this.pixelPerDay)}}function C(b,y){return y*b.pixelPerDay}function u(b,y){return`${C(b,y)}px`}function k(b,y,P,E){const T=[],O=[],I=P.clone().startOf(y),Z=E.clone().endOf(y);for(;I.isBefore(Z);){const R=n.max(I,P).clone(),F=n.min(I.clone().endOf(y),E).clone();I.add(1,y);const Y=b.visibleViewportAtCalculationTime;R.isSameOrAfter(Y[0])&&R.isSameOrBefore(Y[1])||F.isSameOrAfter(Y[0])&&F.isSameOrBefore(Y[1])?T.push([R,F]):O.push([R,F])}const j=O.splice(0,1)[0],B=O.pop();return{inViewportAndBoundaries:_.concat([j].filter(R=>!_.isNil(R)),T,[B].filter(R=>!_.isNil(R))),rest:O}}function x(b,y,P){let E=n(),T=n();return b.forEach(I=>{const Z=I.workPackageId;if(!Z)return;const B=y.get(Z).value;if(!B)return;const J=B.startDate?B.startDate:B.date;J&&n(J).isBefore(E)&&(E=n(J));const R=B.dueDate?B.dueDate:B.date;R&&n(R).isAfter(T)&&(T=n(R))}),T.diff(E,"days")+1}},45338:(te,M,t)=>{"use strict";t.d(M,{O:()=>n});class n{constructor(p){this.tableVisible=!0,this.compactTableStyle=!1,this.actionsColumnEnabled=!0,this.contextMenuEnabled=!0,this.columnMenuEnabled=!0,this.projectContext=!0,this.projectIdentifier=null,this.inlineCreateEnabled=!0,this.hierarchyToggleEnabled=!0,this.dragAndDropEnabled=!1,this.isEmbedded=!1,this.isCardView=!1,this.withFilters=!1,this.filtersExpanded=!1,this.showFilterButton=!1,this.filterButtonText=I18n.t("js.button_filter"),_.each(p,(h,c)=>{this[c]=h})}}},9822:(te,M,t)=>{"use strict";t.d(M,{UX:()=>e,e9:()=>r});const e=".work-packages-tabletimeline--timeline-side",p=".scroll-sync";function i(d){if(0===d)return d;let f=15;return d<0&&(f*=-1),f}function l(d,f,a){const m=d.target,v=d.originalEvent;let[C,u]=function(d){let f=d.deltaX,a=d.deltaY;return d.shiftKey&&(f=a,a=0),[f,a]}(v);0!==u&&(C=i(C),u=i(u),window.requestAnimationFrame(()=>{f[0].scrollTop=f[0].scrollTop+u,a[0].scrollTop=f[0].scrollTop+u,m.scrollLeft+=C}))}function r(d){const f=jQuery(d).find(".work-packages-tabletimeline--table-side"),a=jQuery(d).find(e);return m=>{let v=!1,C=!1;m?(f.on(`wheel${p}`,u=>{l(u,f,a)}),f.on(`scroll${p}`,u=>{v=!0,C||(a[0].scrollTop=u.target.scrollTop),v&&C&&(v=!1,C=!1)}),a.on(`wheel${p}`,u=>{l(u,f,a)}),a.on(`scroll${p}`,u=>{C=!0,v||(f[0].scrollTop=u.target.scrollTop),v&&C&&(v=!1,C=!1)})):f.off(p)}}},18942:(te,M,t)=>{"use strict";t.d(M,{c:()=>bi});var n=t(2316),e=t(96617),p=t(3786),h=t(22663),c=t(83720),i=t(43440),l=t(84897),r=t(29161);class d{constructor(Oe,Pe){this.injector=Oe,this.wpTableHighlighting.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,c.x)()).subscribe(()=>Pe.redrawTable())}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",l.B)],d.prototype,"wpTableHighlighting",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],d.prototype,"querySpace",void 0);var f=t(53466),a=t(8403),m=t(67727),v=t(82763),C=t(16451),u=t(87853),k=t(21680),x=t(45237),b=t(68354),y=t(95846),P=t(1056),E=t(61043),T=t(33276),O=t(99919),I=t(32030);class Z{constructor(Oe,Pe){this.injector=Oe,this.table=Pe,null!==this.dragService&&(this.inlineCreateService.newInlineWorkPackageCreated.pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(ve=>(0,p.mG)(this,void 0,void 0,function*(){const pe=yield this.wpTableOrder.add(this.currentOrder,ve);this.updateRenderedOrder(pe)})),this.querySpace.stopAllSubscriptions.pipe((0,f.q)(1)).subscribe(()=>{this.dragService.remove(this.table.tbody)}),this.dragService.register({dragContainer:this.table.tbody,scrollContainers:[this.table.scrollContainer],accepts:()=>!0,moves:(ve,pe,ue)=>{if(!ue.classList.contains("wp-table--drag-and-drop-handle"))return!1;const Ze=ve.dataset.workPackageId,Ge=this.states.workPackages.get(Ze).value;return!!Ge&&this.actionService.canPickup(Ge)},onMoved:(ve,pe,ue,Ze)=>(0,p.mG)(this,void 0,void 0,function*(){const Ge=ve.dataset.workPackageId;let ft;try{const Pt=yield this.apiV3Service.work_packages.id(Ge).get().toPromise();if((0,O._D)(Ze)){const At=Array.from(Ze.classList).find(ai=>ai.includes((0,I.xU)())).replace((0,I.xU)(),""),vt=ue.getElementsByClassName((0,I.xU)(At)),mi=vt[vt.length-1];ft=this.findRowIndex(mi)}else ft=this.findRowIndex(ve);const yt=yield this.wpTableOrder.move(this.currentOrder,Ge,ft);yield this.actionService.handleDrop(Pt,ve),this.updateRenderedOrder(yt),this.actionService.onNewOrder(yt);const Lt=this.querySpace.query.value;Lt&&this.wpTableSortBy.switchToManualSorting(Lt)&&(yield this.wpListService.createOrSave(Lt))}catch(Pt){this.halNotification.handleRawError(Pt),this.actionService.changeShadowElement(ve,!0),(0,b.d)(ve,ve.dataset.sourceIndex||-1,ue)}}),onRemoved:ve=>{const pe=ve.dataset.workPackageId,ue=this.wpTableOrder.remove(this.currentOrder,pe);this.updateRenderedOrder(ue)},onAdded:ve=>(0,p.mG)(this,void 0,void 0,function*(){const pe=ve.dataset.workPackageId,ue=yield this.apiV3Service.work_packages.id(pe).get().toPromise(),Ze=this.findRowIndex(ve);return this.actionService.handleDrop(ue,ve).then(()=>(0,p.mG)(this,void 0,void 0,function*(){const Ge=yield this.wpTableOrder.add(this.currentOrder,pe,Ze);return this.updateRenderedOrder(Ge),this.actionService.onNewOrder(Ge),!0})).catch(()=>!1)}),onCloned:(ve,pe)=>(0,p.mG)(this,void 0,void 0,function*(){const ue=pe.dataset.workPackageId,Ze=yield this.apiV3Service.work_packages.id(ue).get().toPromise(),Ge=ve.children.length,ft=document.createElement("td");ft.textContent=Ze.subjectWithId(),ft.colSpan=Ge,ft.classList.add("wp-table--cell-td","subject"),ve.style.maxWidth="500px",ve.innerHTML=ft.outerHTML}),onShadowInserted:ve=>{this.browserDetector.isEdge||this.actionService.changeShadowElement(ve)},onCancel:ve=>{this.browserDetector.isEdge||this.actionService.changeShadowElement(ve,!0)}}))}updateRenderedOrder(Oe){return(0,p.mG)(this,void 0,void 0,function*(){Oe=_.uniq(Oe);const Pe=yield Promise.all(Oe.map(ve=>this.apiV3Service.work_packages.id(ve).get().toPromise()));this.table.initialSetup(Pe)})}get actionService(){return this.dragActionRegistry.get(this.injector)}get currentOrder(){return this.currentRenderedOrder.map(Oe=>Oe.workPackageId)}get currentRenderedOrder(){return this.querySpace.renderedWorkPackages.getValueOr([])}findRowIndex(Oe){return Array.from(this.table.tbody.getElementsByClassName(k.S)).indexOf(Oe)||0}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",u.G)],Z.prototype,"states",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],Z.prototype,"querySpace",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",a.m)],Z.prototype,"inlineCreateService",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",m.W)],Z.prototype,"halNotification",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",v.q)],Z.prototype,"wpTableSortBy",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",y.M)],Z.prototype,"wpTableOrder",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",P.o)],Z.prototype,"browserDetector",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",T.T)],Z.prototype,"apiV3Service",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",E.Z)],Z.prototype,"wpListService",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",C.B)],Z.prototype,"dragActionRegistry",void 0),(0,p.gn)([(0,r.W)(x.j,null),(0,p.w6)("design:type",Object)],Z.prototype,"dragService",void 0);var j=t(55236),B=t(79174);class J{constructor(Oe,Pe){this.injector=Oe,this.workPackageViewCollapsedGroupsService.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,c.x)()).subscribe(ve=>Pe.setGroupsCollapseState(ve.state))}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",B.q)],J.prototype,"workPackageViewCollapsedGroupsService",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],J.prototype,"querySpace",void 0);var R=t(7812),F=t(12703),Y=t(88837),X=t(3352),K=t(52787);class ie extends K.X{constructor(Oe){super(),this.injector=Oe}get EVENT(){return"click.table.cell, keydown.table.cell"}get SELECTOR(){return`.${R.OZ}.${R.c0}`}eventScope(Oe){return jQuery(Oe.workPackageTable.tableAndTimelineContainer)}processEvent(Oe,Pe){(0,X.qu)("Starting editing on cell: ",Pe.target),Pe.preventDefault();const ve=jQuery(Pe.target).closest(`.${R.OZ}`),pe=ve.data("fieldName");if(!pe)return(0,X.qu)("Click handled by cell not a field? ",Pe.target),!0;const ue=ve.closest(`.${k.S}`),Ze=ue.data("workPackageId"),Ge=this.states.workPackages.get(Ze).value,ft=ue.data("classIdentifier"),Pt=Oe.editing.startEditing(Ge,ft),yt=(0,Y.b)(Pe);return Pt.activate(pe).then(Lt=>{Lt.$onUserActivate.next(),Lt.focus(yt)}).catch(()=>ve.addClass(R.n5)),!1}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",u.G)],ie.prototype,"states",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",F.l)],ie.prototype,"halEditing",void 0);var H=t(41195),ee=t(33791);class ce extends K.X{constructor(Oe){super(),this.injector=Oe}get EVENT(){return"click.table.relationsCell, keydown.table.relationsCell"}get SELECTOR(){return`.${ee._M}`}eventScope(Oe){return jQuery(Oe.workPackageTable.tableAndTimelineContainer)}processEvent(Oe,Pe){(0,X.qu)("Handled click on relation cell %o",Pe.target),Pe.preventDefault();const pe=jQuery(Pe.target).closest(`.${ee.OR}`).data("columnId"),Ze=jQuery(Pe.target).closest(`.${k.S}`).data("workPackageId");return this.wpTableRelationColumns.getExpandFor(Ze)===pe?this.wpTableRelationColumns.collapse(Ze):this.wpTableRelationColumns.setExpandFor(Ze,pe),!1}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",H.a)],ce.prototype,"wpTableRelationColumns",void 0);var se=t(85003),re=t(20506),Me=t(20342),Ae=t(99794),Ye=t(16793);class ze extends Ae.X{constructor(Oe,Pe,ve,pe={},ue){super(Oe,Pe,ve,pe,!0),this.injector=Oe,this.workPackageId=Pe,this.$element=ve,this.additionalPositionArgs=pe,this.table=ue}triggerContextMenuAction(Oe){switch(Oe.key){case"relation-precedes":this.table.timelineController.startAddRelationPredecessor(this.workPackage);break;case"relation-follows":this.table.timelineController.startAddRelationFollower(this.workPackage);break;case"hierarchy-indent":this.wpViewIndentation.indent(this.workPackage);break;case"hierarchy-outdent":this.wpViewIndentation.outdent(this.workPackage);break;default:super.triggerContextMenuAction(Oe)}}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",Ye.f)],ze.prototype,"wpViewIndentation",void 0);class Xe{constructor(Oe){this.injector=Oe}get rowSelector(){return`.${k.S}`}eventScope(Oe){return jQuery(Oe.workPackageTable.tableAndTimelineContainer)}openContextMenu(Oe,Pe,ve,pe){const ue=new ze(this.injector,ve,jQuery(Pe.target),pe,Oe);this.opContextMenu.show(ue,Pe)}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",Me.$)],Xe.prototype,"opContextMenu",void 0);class it extends Xe{constructor(Oe){super(Oe),this.injector=Oe}get EVENT(){return"click.table.contextmenu"}get SELECTOR(){return`.${se.E4}`}handleEvent(Oe,Pe){const ve=jQuery(Pe.target);if(ve.closest(`.${re.yF}`).length)return(0,X.qu)("Allowing original context menu on state link"),!0;Pe.preventDefault(),Pe.stopPropagation();const ue=ve.closest(this.rowSelector).data("workPackageId");return ue&&this.openContextMenu(Oe.workPackageTable,Pe,ue),!1}}var at=t(33406);class lt extends Xe{constructor(Oe){super(Oe),this.injector=Oe}get EVENT(){return"keydown.table.contextmenu"}get SELECTOR(){return this.rowSelector}handleEvent(Oe,Pe){if(!Oe.workPackageTable.configuration.contextMenuEnabled)return!1;const ve=jQuery(Pe.target);if(Pe.keyCode!==at.m.F10||!Pe.shiftKey||!Pe.altKey)return!0;Pe.preventDefault(),Pe.stopPropagation();const ue=ve.closest(this.SELECTOR).data("workPackageId"),Ze={my:"left top",at:"left bottom",of:ve};return super.openContextMenu(Oe.workPackageTable,Pe,ue,Ze),!1}}var dt=t(60914),de=t(77850);class oe extends Xe{constructor(Oe){super(Oe),this.injector=Oe}get EVENT(){return"contextmenu.table.rightclick"}get SELECTOR(){return`.${k.S},.${de.j}`}eventScope(Oe){return jQuery(Oe.workPackageTable.tableAndTimelineContainer)}handleEvent(Oe,Pe){if(!Oe.workPackageTable.configuration.contextMenuEnabled)return!1;const ve=jQuery(Pe.target);if(ve.closest(`.${re.yF}`).length)return(0,X.qu)("Allowing original context menu on state link"),!0;Pe.preventDefault(),Pe.stopPropagation();const ue=ve.closest(this.SELECTOR).data("workPackageId");if(ue){const[Ze]=Oe.workPackageTable.findRenderedRow(ue);this.wpTableSelection.isSelected(ue)||this.wpTableSelection.setSelection(ue,Ze),this.openContextMenu(Oe.workPackageTable,Pe,ue)}return!1}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",dt.J)],oe.prototype,"wpTableSelection",void 0);var D=t(47775),G=t(48451),V=t(91260),me=t(84109);class ${constructor(Oe){this.injector=Oe}get EVENT(){return"click.table.row"}get SELECTOR(){return`.${k.S}`}eventScope(Oe){return jQuery(Oe.workPackageTable.tbody)}handleEvent(Oe,Pe){const ve=jQuery(Pe.target);if(ve.is("a")||ve.parent().is("a"))return!0;if(ve.hasClass(`${R.OZ}`)||ve.hasClass(`${V.as}`))return(0,X.qu)("Skipping click on inner cell"),!0;const pe=ve.closest(this.SELECTOR),ue=pe.data("workPackageId"),Ze=pe.data("classIdentifier");if(!ue)return!0;const[Ge,ft]=Oe.workPackageTable.findRenderedRow(Ze);return Pe.ctrlKey||Pe.metaKey||Pe.shiftKey||(this.wpTableSelection.setSelection(ue,Ge),Oe.itemClicked.emit({workPackageId:ue,double:!1})),Pe.shiftKey&&this.wpTableSelection.setMultiSelectionFrom(Oe.workPackageTable.renderedRows,ue,Ge),(Pe.ctrlKey||Pe.metaKey)&&this.wpTableSelection.toggleRow(ue),Oe.selectionChanged.emit(this.wpTableSelection.getSelectedWorkPackageIds()),this.wpTableFocus.updateFocus(ue),!1}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",D.StateService)],$.prototype,"$state",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",u.G)],$.prototype,"states",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",me.p)],$.prototype,"keepTab",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",dt.J)],$.prototype,"wpTableSelection",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",G.o)],$.prototype,"wpTableFocus",void 0);var Se=t(67325),ot=t(88156);class st{constructor(Oe){this.injector=Oe}get EVENT(){return"dblclick.table.row"}get SELECTOR(){return`.${ot.Nm}`}eventScope(Oe){return jQuery(Oe.workPackageTable.tbody)}handleEvent(Oe,Pe){const ve=jQuery(Pe.target);if((0,Se.F)(Pe))return!0;if(ve.hasClass(`${R.OZ}`)||ve.hasClass(`${V.as}`))return(0,X.qu)("Skipping click on inner cell"),!0;const ue=ve.closest(this.SELECTOR).closest(`.${k.S}`).data("workPackageId");return!(!ve.is("a")&&!ve.parent().is("a"))||(this.wpTableFocus.updateFocus(ue),Oe.itemClicked.emit({workPackageId:ue,double:!0}),!1)}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",D.StateService)],st.prototype,"$state",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",u.G)],st.prototype,"states",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",dt.J)],st.prototype,"wpTableSelection",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",G.o)],st.prototype,"wpTableFocus",void 0);var he=t(68130);class ye{constructor(Oe){this.injector=Oe}get EVENT(){return"click.table.groupheader"}get SELECTOR(){return`.${he.u} .expander`}eventScope(Oe){return jQuery(Oe.workPackageTable.tbody)}handleEvent(Oe,Pe){Pe.preventDefault(),Pe.stopPropagation();const pe=jQuery(Pe.target).parents(`.${he.u}`).data("groupIdentifier");this.workPackageViewCollapsedGroupsService.toggleGroupCollapseState(pe)}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],ye.prototype,"querySpace",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",B.q)],ye.prototype,"workPackageViewCollapsedGroupsService",void 0);var xe=t(99676);class De extends K.X{constructor(Oe){super(),this.injector=Oe}get EVENT(){return"click.table.hierarchy"}get SELECTOR(){return".wp-table--hierarchy-indicator"}eventScope(Oe){return jQuery(Oe.workPackageTable.tbody)}processEvent(Oe,Pe){const ue=jQuery(Pe.target).closest(`.${k.S}`).data("workPackageId");return this.wpTableHierarchies.toggle(ue),Pe.stopImmediatePropagation(),Pe.preventDefault(),!1}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",u.G)],De.prototype,"states",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",xe.Y)],De.prototype,"wpTableHierarchies",void 0);class Qe{constructor(Oe){this.injector=Oe}get EVENT(){return"click.table.wpLink"}get SELECTOR(){return`.${re.yF}`}eventScope(Oe){return jQuery(Oe.workPackageTable.tableAndTimelineContainer)}handleEvent(Oe,Pe){if(Pe.shiftKey||Pe.ctrlKey||Pe.metaKey||Pe.altKey)return!0;const ve=jQuery(Pe.target),pe=ve.closest(this.SELECTOR),ue=pe.data("wpState"),Ze=pe.data("workPackageId");ve.closest("a").blur();const ft=ve.closest(`.${k.S}`).data("classIdentifier"),[Pt,yt]=Oe.workPackageTable.findRenderedRow(ft);return this.wpTableSelection.setSelection(Ze,Pt),Oe.stateLinkClicked.emit({workPackageId:Ze,requestedState:ue}),Pe.preventDefault(),Pe.stopPropagation(),!1}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",D.StateService)],Qe.prototype,"$state",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",me.p)],Qe.prototype,"keepTab",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",u.G)],Qe.prototype,"states",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",dt.J)],Qe.prototype,"wpTableSelection",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",G.o)],Qe.prototype,"wpTableFocus",void 0);var Ve=t(71562);class nt{constructor(Oe,Pe){this.injector=Oe,this.table=Pe,this.wpTableColumns.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(()=>{if(Pe.originalRows.length>0){const ve=performance.now();Pe.redrawTable();const pe=performance.now();(0,X.qu)(`column redraw took ${pe-ve} milliseconds.`)}})}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],nt.prototype,"querySpace",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",Ve.i)],nt.prototype,"wpTableColumns",void 0);var mt=t(33927),Ue=t(9170),Fe=t(67362);class Te{constructor(Oe,Pe){this.injector=Oe,this.wpTableHierarchies.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,mt.U)(pe=>pe.isVisible),(0,c.x)()).subscribe(()=>{this.wpTableHierarchies.isEnabled||Pe.redrawTableAndTimeline()});let ve=this.wpTableHierarchies.isEnabled;this.wpTableHierarchies.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions),(0,Ue.h)(()=>this.querySpace.tableRendered.hasValue())).subscribe(pe=>{pe.isVisible===ve&&this.renderHierarchyState(pe),ve=pe.isVisible})}renderHierarchyState(Oe){const Pe=this.querySpace.tableRendered.value;jQuery('[class^="__hierarchy-group-"]').removeClass((pe,ue)=>(ue.match(/__collapsed-group-\d+/g)||[]).join(" "));const ve={};_.each(Oe.collapsed,(pe,ue)=>{jQuery(`.${(0,I.MO)(ue)} .wp-table--hierarchy-indicator`).toggleClass(Fe.YZ,pe);const Ze=document.querySelector(`.wp-timeline-cell.__hierarchy-root-${ue}`);Ze&&(pe?Ze.classList.add("__hierarchy-root-collapsed"):Ze.classList.remove("__hierarchy-root-collapsed"));const Ge=jQuery(`.${(0,I.oQ)(ue)}`);Ge.toggleClass((0,I.xU)(ue),pe),Ge.filter(`.${k.S}`).each((ft,Pt)=>{const yt=jQuery(Pt).index();ve[yt]||(Pe[yt].hidden=pe,ve[yt]=pe)})}),Oe.last&&(0,O.Ui)(Oe.last),this.querySpace.tableRendered.putValue(Pe,"Updated hidden state of rows after hierarchy change.")}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",xe.Y)],Te.prototype,"wpTableHierarchies",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],Te.prototype,"querySpace",void 0);class tt{constructor(Oe,Pe){this.injector=Oe,this.wpTableRelationColumns.updates$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(()=>{Pe.redrawTableAndTimeline()})}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",H.a)],tt.prototype,"wpTableRelationColumns",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],tt.prototype,"querySpace",void 0);class ut{constructor(Oe,Pe){this.injector=Oe,this.table=Pe,this.querySpace.initialized.values$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(()=>{let ve;ve=this.wpTableSortBy.isManualSortingMode?this.wpTableOrder.orderedWorkPackages():this.querySpace.results.value.elements,Pe.initialSetup(ve)}),this.states.workPackages.observeChange().pipe((0,h.R)(this.querySpace.stopAllSubscriptions.asObservable()),(0,Ue.h)(()=>{const ve=this.querySpace.tableRendered.getValueOr([]);return ve&&ve.length>0})).subscribe(([ve,pe])=>{void 0!==pe&&this.table.refreshRows(pe)})}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],ut.prototype,"querySpace",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",v.q)],ut.prototype,"wpTableSortBy",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",y.M)],ut.prototype,"wpTableOrder",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",u.G)],ut.prototype,"states",void 0);var Yt=t(7101);class It{constructor(Oe,Pe){this.injector=Oe,this.table=Pe,this.querySpace.tableRendered.values$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(()=>{this.wpTableFocus.ifShouldFocus(ve=>{const pe=(0,O.Fb)(ve);pe.length&&((0,O.Ui)(ve),this.FocusHelper.focus(pe[0]))})}),this.wpTableSelection.live$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(ve=>{this.renderSelectionState(ve)}),this.wpTableSelection.registerSelectAllListener(()=>Pe.renderedRows),this.wpTableSelection.registerDeselectAllListener()}renderSelectionState(Oe){const Pe=jQuery(this.table.tableAndTimelineContainer);Pe.find(`.${k.S}.${re.HZ}`).removeClass(re.HZ),_.each(Oe.selected,(ve,pe)=>{Pe.find(`.${k.S}[data-work-package-id="${pe}"]`).toggleClass(re.HZ,ve)})}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",dt.J)],It.prototype,"wpTableSelection",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",G.o)],It.prototype,"wpTableFocus",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],It.prototype,"querySpace",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",Yt.i)],It.prototype,"FocusHelper",void 0);var Nt=t(73165);class wt{constructor(Oe,Pe){this.injector=Oe,this.table=Pe,this.wpTableTimeline.live$().pipe((0,h.R)(this.querySpace.stopAllSubscriptions)).subscribe(ve=>{this.renderVisibility(ve.visible)})}renderVisibility(Oe){const Pe=jQuery(this.table.tableAndTimelineContainer).parent();Pe.find(".work-packages-tabletimeline--timeline-side").toggle(Oe),Pe.find(".work-packages-tabletimeline--table-side").toggleClass("-timeline-visible",Oe)}}(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",i.q)],wt.prototype,"querySpace",void 0),(0,p.gn)([(0,r.W)(),(0,p.w6)("design:type",Nt.W)],wt.prototype,"wpTableTimeline",void 0);class zt extends j.A{constructor(){super(...arguments),this.eventHandlers=[()=>new De(this.injector),()=>new ie(this.injector),()=>new Qe(this.injector),()=>new $(this.injector),()=>new st(this.injector),()=>new ye(this.injector),()=>new oe(this.injector),()=>new it(this.injector),()=>new lt(this.injector),()=>new ce(this.injector)],this.stateTransformers=[It,ut,nt,J,wt,Te,tt,d,Z]}attachTo(Oe){this.stateTransformers.map(Pe=>new Pe(this.injector,Oe.workPackageTable)),super.attachTo(Oe)}}var Kt=t(61486),ei=t(43682),Rt=t(61083),Mt=t(9822);const Ot="row-hovered";class St{constructor(Oe){this.tableAndTimeline=Oe,this.lastHoveredElement=null,this.eventListener=Pe=>{const ve=Pe.target;ve&&ve!==this.lastHoveredElement&&this.handleHover(ve),this.lastHoveredElement=ve}}activate(){window.addEventListener("mousemove",this.eventListener,{passive:!0})}deactivate(){window.removeEventListener("mousemove",this.eventListener),this.removeAllHoverClasses()}locateHoveredTableRow(Oe){const Pe=Oe.closest("tr");return 0===Pe.length?null:Pe[0]}locateHoveredTimelineRow(Oe){const Pe=Oe.closest("div.wp-timeline-cell");return 0===Pe.length?null:Pe[0]}handleHover(Oe){const Pe=jQuery(Oe),ve=this.locateHoveredTableRow(Pe),pe=this.locateHoveredTimelineRow(Pe);null!==ve||null!==pe?this.removeOldAndAddNewHoverClass(ve,pe):this.removeAllHoverClasses()}extractWorkPackageId(Oe){return parseInt(Oe.getAttribute("data-work-package-id"))}removeOldAndAddNewHoverClass(Oe,Pe){const ve=null!==Oe?Oe:Pe,pe=this.extractWorkPackageId(ve),ue=this.tableAndTimeline.find(`tr.wp-row-${pe}`).first(),Ze=this.tableAndTimeline.find(`div.wp-row-${pe}`).length?this.tableAndTimeline.find(`div.wp-row-${pe}`).first():this.tableAndTimeline.find(`div.wp-ancestor-row-${pe}`).first();requestAnimationFrame(()=>{this.removeAllHoverClasses(),Ze.addClass(Ot),ue.addClass(Ot)})}removeAllHoverClasses(){this.tableAndTimeline.find(`.${Ot}`).removeClass(Ot)}}var ti=t(55054),Tt=t(26942),qt=t(82271),Qt=t(45338);function Gt(Ke,Oe){1&Ke&&n._UZ(0,"col")}function ii(Ke,Oe){1&Ke&&n._UZ(0,"col",19)}function Jt(Ke,Oe){1&Ke&&n._UZ(0,"col",19)}function Ce(Ke,Oe){1&Ke&&n._UZ(0,"col")}function N(Ke,Oe){1&Ke&&n._UZ(0,"op-icon",23)}function Q(Ke,Oe){if(1&Ke&&(n.TgZ(0,"th",20),n.TgZ(1,"div",21),n.YNc(2,N,1,0,"op-icon",22),n.qZA(),n.qZA()),2&Ke){const Pe=n.oxw(2);n.xp6(2),n.Q6J("ngIf",Pe.manualSortEnabled)}}const je=function(Ke){return{"-max":Ke}};function Ee(Ke,Oe){if(1&Ke&&(n.TgZ(0,"th",24),n._UZ(1,"sortHeader",25),n.qZA()),2&Ke){const Pe=Oe.$implicit,ve=n.oxw(2);n.Q6J("ngClass",n.VKq(6,je,"subject"===Pe.id)),n.xp6(1),n.Q6J("headerColumn",Pe)("locale",Pe.custom_field&&Pe.custom_field.name_locale||ve.locale)("table",ve.workPackageTable)("opColumnsContextMenu-column",Pe)("opColumnsContextMenu-table",ve.workPackageTable)}}function ht(Ke,Oe){1&Ke&&(n.TgZ(0,"div",28),n._UZ(1,"wp-table-config-menu"),n.qZA())}function kt(Ke,Oe){if(1&Ke&&(n.TgZ(0,"th",26),n.YNc(1,ht,2,0,"div",27),n.qZA()),2&Ke){const Pe=n.oxw(2);n.xp6(1),n.Q6J("ngIf",Pe.configuration.columnMenuEnabled)}}function si(Ke,Oe){if(1&Ke&&(n.TgZ(0,"tbody",29),n.TgZ(1,"tr",30),n.TgZ(2,"td"),n.TgZ(3,"span"),n._UZ(4,"op-icon",31),n.TgZ(5,"span"),n.TgZ(6,"strong"),n._uU(7),n.qZA(),n._uU(8),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.qZA()),2&Ke){const Pe=n.oxw(2);n.xp6(2),n.uIk("colspan",Pe.columns.length+2),n.xp6(5),n.Oqu(Pe.text.noResults.title),n.xp6(1),n.hij(" ",Pe.text.noResults.description," ")}}function Wt(Ke,Oe){if(1&Ke){const Pe=n.EpF();n.TgZ(0,"tbody",32),n.NdJ("wp-inline-create--showing",function(pe){n.CHM(Pe);return n.oxw(2).inlineCreateVisible=pe}),n.qZA()}if(2&Ke){const Pe=n.oxw(2);n.Q6J("wp-inline-create--table",Pe.workPackageTable)("wp-inline-create--project-identifier",Pe.projectIdentifier)}}function ri(Ke,Oe){1&Ke&&(n.TgZ(0,"div",33),n._UZ(1,"wp-resizer",34),n.qZA()),2&Ke&&(n.xp6(1),n.Q6J("elementClass","work-packages-tabletimeline--timeline-side")("resizeEvent","wp-resize.timeline")("localStorageKey","openProject-timelineFlexBasis"))}const ni=function(){return[]},Qi=function(Ke,Oe){return{"-single-margin":Ke,"-double-margin":Oe}};function _i(Ke,Oe){if(1&Ke&&(n.TgZ(0,"div",1),n.TgZ(1,"div",2),n.TgZ(2,"table",3),n.TgZ(3,"colgroup"),n.YNc(4,Gt,1,0,"col",4),n.YNc(5,ii,1,0,"col",5),n.YNc(6,Jt,1,0,"col",6),n.YNc(7,Ce,1,0,"col",4),n.qZA(),n.TgZ(8,"caption",7),n.TgZ(9,"span"),n._uU(10),n.qZA(),n._UZ(11,"span",8),n.TgZ(12,"span"),n._uU(13),n.qZA(),n.qZA(),n.TgZ(14,"thead",9),n.TgZ(15,"tr"),n.YNc(16,Q,3,1,"th",10),n.YNc(17,Ee,2,8,"th",11),n.YNc(18,kt,2,1,"th",12),n.qZA(),n.qZA(),n.YNc(19,si,9,3,"tbody",13),n._UZ(20,"tbody",14),n.TgZ(21,"tbody"),n._UZ(22,"tr",15),n.qZA(),n.YNc(23,Wt,1,2,"tbody",16),n.qZA(),n.qZA(),n.YNc(24,ri,2,3,"div",17),n.TgZ(25,"div",18),n._UZ(26,"wp-timeline-container"),n.qZA(),n.qZA()),2&Ke){const Pe=n.oxw();n.xp6(4),n.Q6J("ngIf",Pe.configuration.dragAndDropEnabled),n.xp6(1),n.Q6J("ngForOf",n.DdM(15,ni).constructor(Pe.columns.length)),n.xp6(1),n.Q6J("ngIf",Pe.configuration.columnMenuEnabled),n.xp6(1),n.Q6J("ngIf",!Pe.configuration.columnMenuEnabled),n.xp6(3),n.Oqu(Pe.text.tableSummary),n.xp6(3),n.Oqu(Pe.text.tableSummaryHints),n.xp6(3),n.Q6J("ngIf",Pe.configuration.dragAndDropEnabled),n.xp6(1),n.Q6J("ngForOf",Pe.columns)("ngForTrackBy",Pe.trackByHref),n.xp6(1),n.Q6J("ngIf",Pe.configuration.columnMenuEnabled||Pe.configuration.actionsColumnEnabled),n.xp6(1),n.Q6J("ngIf",!Pe.isEmbedded&&Pe.query&&0===Pe.results.count),n.xp6(3),n.Q6J("wpTableSumsRow-table",Pe.workPackageTable),n.xp6(1),n.Q6J("ngIf",Pe.tableElement&&Pe.configuration.inlineCreateEnabled),n.xp6(1),n.Q6J("ngIf",!Pe.configuration.isEmbedded),n.xp6(1),n.Q6J("ngClass",n.WLB(16,Qi,(Pe.sumVisible||Pe.inlineCreateVisible)&&!(Pe.sumVisible&&Pe.inlineCreateVisible),Pe.sumVisible&&Pe.inlineCreateVisible))}}class bi extends Tt.N{constructor(Oe,Pe,ve,pe,ue,Ze,Ge,ft,Pt,yt,Lt,Xt){super(),this.elementRef=Oe,this.injector=Pe,this.states=ve,this.querySpace=pe,this.I18n=ue,this.cdRef=Ze,this.zone=Ge,this.wpTableGroupBy=ft,this.wpTableTimeline=Pt,this.wpTableColumns=yt,this.wpTableSortBy=Lt,this.wpTableSums=Xt,this.selectionChanged=new n.vpe,this.itemClicked=new n.vpe,this.stateLinkClicked=new n.vpe,this.trackByHref=ei.u9,this.limitedResults=!1,this.inlineCreateVisible=!1,this.sumVisible=!1}ngOnInit(){this.configuration=new Qt.O(this.configurationObject),this.$element=jQuery(this.elementRef.nativeElement),this.querySpace.stopAllSubscriptions.next(),this.locale=I18n.locale,this.text={cancel:I18n.t("js.button_cancel"),noResults:{title:I18n.t("js.work_packages.no_results.title"),description:I18n.t("js.work_packages.no_results.description")},limitedResults:(Pe,ve)=>I18n.t("js.work_packages.limited_results",{count:Pe,total:ve}),tableSummary:I18n.t("js.work_packages.table.summary"),tableSummaryHints:[I18n.t("js.work_packages.table.text_inline_edit"),I18n.t("js.work_packages.table.text_select_hint"),I18n.t("js.work_packages.table.text_sort_hint")].join(" ")},(0,Kt.aj)([this.querySpace.results.values$(),this.wpTableGroupBy.live$(),this.wpTableColumns.live$(),this.wpTableTimeline.live$(),this.wpTableSortBy.live$(),this.wpTableSums.live$()]).pipe(this.untilDestroyed()).subscribe(([Pe,ve,pe,ue,Ze,Ge])=>{this.query=this.querySpace.query.value,this.results=Pe,this.sumVisible=Ge,this.groupBy=ve,this.columns=pe,this.numTableColumns=this.columns.length+2,this.scrollSyncUpdate&&this.timelineVisible!==ue.visible&&this.scrollSyncUpdate(ue.visible),this.timelineVisible=ue.visible,this.manualSortEnabled=this.wpTableSortBy.isManualSortingMode,this.limitedResults=this.manualSortEnabled&&Pe.total>Pe.count,this.cdRef.detectChanges()}),this.cdRef.detectChanges()}ngOnDestroy(){super.ngOnDestroy(),this.wpTableHoverSync.deactivate()}registerTimeline(Oe,Pe){const ve=this.$element.find(".work-package--results-tbody"),pe=this.$element.find(".work-package-table--container")[0];this.workPackageTable=new ti.t(this.injector,this.$element[0],pe,ve[0],Pe,Oe,this.configuration),this.tbody=ve,Oe.workPackageTable=this.workPackageTable,new zt(this.injector).attachTo(this);const ue=this.getTableAndTimelineElement();this.tableElement=ue[0],this.timeline=ue[1],this.wpTableHoverSync=new St(this.$element),this.wpTableHoverSync.activate(),this.scrollSyncUpdate=(0,Mt.e9)(this.$element),this.scrollSyncUpdate(this.timelineVisible),this.cdRef.detectChanges()}get isEmbedded(){return this.configuration.isEmbedded}getTableAndTimelineElement(){const Oe=this.$element.find(".work-packages-tabletimeline--table-side"),Pe=this.$element.find(".work-packages-tabletimeline--timeline-side");if(0===Pe.length||0===Oe.length)throw new Error("invalid state");return[Oe[0],Pe[0]]}}bi.\u0275fac=function(Oe){return new(Oe||bi)(n.Y36(n.SBq),n.Y36(n.zs3),n.Y36(u.G),n.Y36(i.q),n.Y36(e.D),n.Y36(n.sBO),n.Y36(n.R0b),n.Y36(Rt.w),n.Y36(Nt.W),n.Y36(Ve.i),n.Y36(v.q),n.Y36(qt.X))},bi.\u0275cmp=n.Xpm({type:bi,selectors:[["wp-table"]],inputs:{projectIdentifier:"projectIdentifier",configurationObject:["configuration","configurationObject"]},outputs:{selectionChanged:"selectionChanged",itemClicked:"itemClicked",stateLinkClicked:"stateLinkClicked"},features:[n.qOj],decls:1,vars:1,consts:[["class","work-packages-split-view--tabletimeline-content",4,"ngIf"],[1,"work-packages-split-view--tabletimeline-content"],[1,"work-packages-tabletimeline--table-side","work-package-table--container","__hidden_overflow_container"],[1,"keyboard-accessible-list","generic-table","work-package-table"],[4,"ngIf"],["opHighlightCol","",4,"ngFor","ngForOf"],["opHighlightCol","",4,"ngIf"],[1,"hidden-for-sighted"],["id","wp-table-sort-summary"],[1,"-sticky"],["class","wp-table--manual-sort-th -short hide-when-print",4,"ngIf"],["class","wp-table--table-header",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["class","wp-table--configuration-modal--trigger wp-table--context-menu-th -short hide-when-print",4,"ngIf"],["class","work-package--empty-tbody",4,"ngIf"],[1,"results-tbody","work-package--results-tbody"],["wpTableSumsRow","",1,"wp-table--sums-row","wp-table--row",3,"wpTableSumsRow-table"],["wpInlineCreate","",3,"wp-inline-create--table","wp-inline-create--project-identifier","wp-inline-create--showing",4,"ngIf"],["class","work-packages--tabletimeline--timeline--resizer hidden-for-mobile hide-when-print",4,"ngIf"],[1,"work-packages-tabletimeline--timeline-side",3,"ngClass"],["opHighlightCol",""],[1,"wp-table--manual-sort-th","-short","hide-when-print"],[1,"generic-table--empty-header"],["icon-classes","icon-sort-by",4,"ngIf"],["icon-classes","icon-sort-by"],[1,"wp-table--table-header",3,"ngClass"],["opColumnsContextMenu","",3,"headerColumn","locale","table","opColumnsContextMenu-column","opColumnsContextMenu-table"],[1,"wp-table--configuration-modal--trigger","wp-table--context-menu-th","-short","hide-when-print"],["class","generic-table--sort-header-outer",4,"ngIf"],[1,"generic-table--sort-header-outer"],[1,"work-package--empty-tbody"],["id","empty-row-notification"],["icon-classes","icon-info1 icon-context"],["wpInlineCreate","",3,"wp-inline-create--table","wp-inline-create--project-identifier","wp-inline-create--showing"],[1,"work-packages--tabletimeline--timeline--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","resizeEvent","localStorageKey"]],template:function(Oe,Pe){1&Oe&&n.YNc(0,_i,27,19,"div",0),2&Oe&&n.Q6J("ngIf",Pe.query)},styles:[".wp-table--drag-and-drop-handle:hover{cursor:move}\n"],encapsulation:2,changeDetection:0})},38421:(te,M,t)=>{"use strict";t.d(M,{t:()=>a});var n=t(47775),e=t(96617),p=t(33276),h=t(33927),c=t(58312),i=t(2316),l=t(54364),r=t(32853);function d(m,v){if(1&m&&i._UZ(0,"ndc-dynamic",2),2&m){const C=i.oxw().ngIf;i.Q6J("ndcDynamicComponent",null==C||null==C.tab?null:C.tab.component)("ndcDynamicInputs",C)}}function f(m,v){if(1&m&&(i.ynx(0),i.YNc(1,d,1,2,"ndc-dynamic",1),i.BQk()),2&m){const C=v.ngIf;i.xp6(1),i.Q6J("ngIf",C.workPackage&&C.tab)}}class a{constructor(v,C,u,k){this.I18n=v,this.uiRouterGlobals=C,this.apiV3Service=u,this.wpTabsService=k}get workPackageId(){const{workPackageId:v}=this.uiRouterGlobals.params;return v}ngOnInit(){this.ndcDynamicInputs$=this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe((0,h.U)(v=>({workPackage:v,tab:this.findTab(v)})))}findTab(v){const{tabIdentifier:C}=this.uiRouterGlobals.params;return this.wpTabsService.getTab(C,v)}}a.\u0275fac=function(v){return new(v||a)(i.Y36(e.D),i.Y36(n.UIRouterGlobals),i.Y36(p.T),i.Y36(c.o))},a.\u0275cmp=i.Xpm({type:a,selectors:[["op-wp-tab"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ndcDynamicComponent","ndcDynamicInputs",4,"ngIf"],[3,"ndcDynamicComponent","ndcDynamicInputs"]],template:function(v,C){1&v&&(i.YNc(0,f,2,1,"ng-container",0),i.ALo(1,"async")),2&v&&i.Q6J("ngIf",i.lcZ(1,1,C.ndcDynamicInputs$))},directives:[l.O5,r.B5,r.oc],pipes:[l.Ov],encapsulation:2})},70971:(te,M,t)=>{"use strict";t.d(M,{e:()=>a});var n=t(84109),e=t(47775),p=t(96617),h=t(58312),i=(t(24897),t(2316)),l=t(90590),r=t(54364),d=t(2775);function f(m,v){if(1&m){const C=i.EpF();i.ynx(0,2),i.TgZ(1,"li",3),i.TgZ(2,"button",4),i.NdJ("click",function(){return i.CHM(C),i.oxw().switchToFullscreen()}),i._UZ(3,"op-icon",5),i.qZA(),i.qZA(),i.TgZ(4,"li",3),i.TgZ(5,"button",6),i.NdJ("click",function(){return i.CHM(C),i.oxw().close()}),i._UZ(6,"op-icon",7),i.qZA(),i.qZA(),i.BQk()}if(2&m){const C=i.oxw();i.xp6(2),i.Q6J("title",C.text.details.goToFullScreen),i.xp6(3),i.Q6J("title",C.text.details.close)}}class a{constructor(v,C,u,k,x,b){this.wpTabsService=v,this.I18n=C,this.injector=u,this.$state=k,this.uiRouterGlobals=x,this.keepTab=b,this.canViewWatchers=!1,this.text={details:{close:this.I18n.t("js.button_close_details"),goToFullScreen:this.I18n.t("js.button_show_fullscreen")}}}ngOnInit(){this.uiSrefBase="split"===this.view?"":"work-packages.show",this.canViewWatchers=!(!this.workPackage||!this.workPackage.watchers),this.tabs=this.getDisplayableTabs()}getDisplayableTabs(){return this.wpTabsService.getDisplayableTabs(this.workPackage).map(v=>Object.assign(Object.assign({},v),{route:`${this.uiSrefBase}.tabs`,routeParams:{workPackageId:this.workPackage.id,tabIdentifier:v.id}}))}switchToFullscreen(){this.keepTab.goCurrentShowState()}close(){this.$state.go(this.uiRouterGlobals.current.data.baseRoute,this.uiRouterGlobals.params)}}a.\u0275fac=function(v){return new(v||a)(i.Y36(h.o),i.Y36(p.D),i.Y36(i.zs3),i.Y36(e.StateService),i.Y36(e.UIRouterGlobals),i.Y36(n.p))},a.\u0275cmp=i.Xpm({type:a,selectors:[["op-wp-tabs"]],inputs:{workPackage:"workPackage",view:"view"},decls:2,vars:2,consts:[[1,"op-work-package-tabs",3,"tabs"],["slot","actions",4,"ngIf"],["slot","actions"],[1,"tab-icon"],["type","button",1,"spot-link","work-packages--details-fullscreen-icon",3,"title","click"],["icon-classes","icon-context icon-no-color icon-to-fullscreen"],["type","button",1,"spot-link","work-packages--details-close-icon",3,"title","click"],["icon-classes","icon-context icon-no-color icon-close"]],template:function(v,C){1&v&&(i.TgZ(0,"op-scrollable-tabs",0),i.YNc(1,f,7,2,"ng-container",1),i.qZA()),2&v&&(i.Q6J("tabs",C.tabs),i.xp6(1),i.Q6J("ngIf","split"===C.view))},directives:[l.P,r.O5,d.o],styles:["[_nghost-%COMP%]{width:100%;max-width:100%;overflow:hidden}"],changeDetection:0})},58312:(te,M,t)=>{"use strict";t.d(M,{o:()=>Sn});var n=t(30400),e=t(47775),p=t(96617),h=t(26942),c=t(33276),i=t(2316),l=t(54364),d=(t(24897),t(90490)),f=t(22663),a=t(53466),m=t(38519),v=t(53457),C=t(70233),u=t(41945),k=t(97047),x=t(74012);class b extends h.N{constructor(z,L,ke,Le){super(),this.wpRelationsHierarchyService=z,this.apiV3Service=L,this.PathHelper=ke,this.I18n=Le,this.showEditForm=!1,this.text={parentHeadline:this.I18n.t("js.relations_hierarchy.parent_headline"),childrenHeadline:this.I18n.t("js.relations_hierarchy.children_headline")}}ngOnInit(){this.workPackagePath=this.PathHelper.workPackagePath(this.workPackage.id),this.canModifyHierarchy=!!this.workPackage.changeParent,this.canAddRelation=!!this.workPackage.addRelation,this.childrenQueryProps={filters:JSON.stringify([{parent:{operator:"=",values:[this.workPackage.id]}}]),"columns[]":["id","type","subject","status"],showHierarchies:!1},this.apiV3Service.work_packages.id(this.workPackage).requireAndStream().pipe(this.untilDestroyed()).subscribe(z=>{var L,ke;this.workPackage=z;const Le=null===(ke=null===(L=this.workPackage.parent)||void 0===L?void 0:L.id)||void 0===ke?void 0:ke.toString();Le&&this.apiV3Service.work_packages.id(Le).get().pipe((0,a.q)(1)).subscribe(gt=>{this.workPackage.parent=gt})})}}b.\u0275fac=function(z){return new(z||b)(i.Y36(u.O),i.Y36(c.T),i.Y36(C.j),i.Y36(p.D))},b.\u0275cmp=i.Xpm({type:b,selectors:[["wp-relations-hierarchy"]],inputs:{workPackage:"workPackage",relationType:"relationType"},features:[i.qOj],decls:6,vars:4,consts:[[1,"wp-relations-hierarchy-section","wp-relations--children"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],["wp-isolated-query-space",""],[3,"workPackage","addExistingChildEnabled","query"]],template:function(z,L){1&z&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"div",2),i._UZ(3,"h3",3),i.qZA(),i.qZA(),i.ynx(4,4),i._UZ(5,"wp-children-query",5),i.BQk(),i.qZA()),2&z&&(i.xp6(3),i.Q6J("textContent",L.text.childrenHeadline),i.xp6(2),i.Q6J("workPackage",L.workPackage)("addExistingChildEnabled",!0)("query",L.childrenQueryProps))},directives:[k.A,x.u],encapsulation:2});var y=t(1403),P=t(62964),E=t(69057),T=t(50076),O=t(51017),I=t(2775),Z=t(1707),j=t(84312),B=t(84906),J=t(61342),R=t(54262),F=t(82140);const Y=["relationDescriptionTextarea"];function X(ae,z){if(1&ae&&i._UZ(0,"span",18),2&ae){const L=i.oxw(3);i.Q6J("textContent",L.normalizedRelationType)}}function K(ae,z){if(1&ae&&i._UZ(0,"span",19),2&ae){const L=i.oxw(3);i.Q6J("ngClass",L.highlightingClassForWpType())("textContent",L.relatedWorkPackage.type.name)}}function ie(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",14),i.NdJ("click",function(){return i.CHM(L),i.oxw(2).activateRelationTypeEdit()}),i.YNc(1,X,1,1,"span",15),i.YNc(2,K,1,2,"span",16),i._UZ(3,"span",17),i.qZA()}if(2&ae){const L=i.oxw(2);i.xp6(1),i.Q6J("ngIf",L.groupByWorkPackageType),i.xp6(1),i.Q6J("ngIf",!L.groupByWorkPackageType),i.xp6(1),i.Q6J("textContent",L.text.updateRelation)}}function H(ae,z){if(1&ae&&i._UZ(0,"option",23),2&ae){const L=z.$implicit;i.Q6J("textContent",L.label)("ngValue",L)}}function ee(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",20),i.TgZ(1,"select",21),i.NdJ("ngModelChange",function(Le){i.CHM(L);return i.oxw(2).selectedRelationType=Le})("change",function(){return i.CHM(L),i.oxw(2).saveRelationType()})("keydown.escape",function(Le){return i.CHM(L),i.oxw(2).cancelRelationTypeEditOnEscape(Le)}),i.YNc(2,H,1,2,"option",22),i.qZA(),i.qZA()}if(2&ae){const L=i.oxw(2);i.xp6(1),i.Q6J("ngModel",L.selectedRelationType),i.xp6(1),i.Q6J("ngForOf",L.availableRelationTypes)}}const ce=function(ae){return{workPackageId:ae,tabIdentifier:"relations"}};function se(ae,z){if(1&ae&&(i.TgZ(0,"div",24),i._UZ(1,"a",25),i.qZA()),2&ae){const L=i.oxw(2);i.xp6(1),i.Q6J("uiParams",i.VKq(3,ce,L.relatedWorkPackage.id))("textContent",L.relatedWorkPackage.subjectWithId()),i.uIk("aria-label",L.normalizedRelationType+" "+L.relatedWorkPackage.subjectWithId())}}function re(ae,z){if(1&ae&&(i.TgZ(0,"edit-form",26),i._UZ(1,"op-editable-attribute-field",27),i.qZA()),2&ae){const L=i.oxw(2);i.Q6J("resource",L.relatedWorkPackage),i.xp6(1),i.Q6J("resource",L.relatedWorkPackage)}}const Me=function(ae){return{"-visible":ae}};function Ae(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",28),i.NdJ("click",function(){return i.CHM(L),i.oxw(2).removeRelation()}),i._UZ(1,"op-icon",29),i.qZA()}if(2&ae){const L=i.oxw(2);i.Q6J("ngClass",i.VKq(3,Me,L.showDescriptionInfo))("title",L.text.removeButton),i.xp6(1),i.Q6J("icon-title",L.text.removeButton)}}function Ye(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",33),i.NdJ("click",function(){return i.CHM(L),i.oxw(3).startDescriptionEdit()}),i.qZA()}if(2&ae){const L=i.oxw(3);i.ekj("-placeholder",!L.relation.description),i.Q6J("textContent",L.relation.description||L.text.placeholder.description)}}function ze(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",34),i.TgZ(1,"textarea",35,36),i.NdJ("keyup",function(Le){return i.CHM(L),i.oxw(3).handleDescriptionKey(Le)})("ngModelChange",function(Le){i.CHM(L);return i.oxw(3).userInputs.newRelationText=Le}),i.qZA(),i.TgZ(3,"edit-field-controls",37),i.NdJ("onSave",function(){return i.CHM(L),i.oxw(3).saveDescription()})("onCancel",function(){return i.CHM(L),i.oxw(3).cancelDescriptionEdit()}),i.qZA(),i.qZA()}if(2&ae){const L=i.oxw(3);i.xp6(1),i.Q6J("ngModel",L.userInputs.newRelationText),i.xp6(2),i.Q6J("fieldController",L.fieldController)("saveTitle",L.text.save)("cancelTitle",L.text.cancel)}}function Xe(ae,z){if(1&ae&&(i.TgZ(0,"div",30),i.YNc(1,Ye,1,3,"button",31),i.YNc(2,ze,4,4,"div",32),i.qZA()),2&ae){const L=i.oxw(2);i.xp6(1),i.Q6J("ngIf",!L.userInputs.showDescriptionEditForm),i.xp6(1),i.Q6J("ngIf",L.userInputs.showDescriptionEditForm)}}function it(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",1),i.TgZ(1,"div",2),i.TgZ(2,"div",3),i.YNc(3,ie,4,3,"button",4),i.YNc(4,ee,3,2,"div",5),i.qZA(),i.YNc(5,se,2,5,"div",6),i.TgZ(6,"div",7),i.YNc(7,re,2,2,"edit-form",8),i.qZA(),i.TgZ(8,"div",9),i.TgZ(9,"button",10),i.NdJ("click",function(){i.CHM(L);const Le=i.oxw();return Le.userInputs.showRelationInfo=!Le.userInputs.showRelationInfo}),i._UZ(10,"op-icon",11),i.qZA(),i.YNc(11,Ae,2,5,"button",12),i.qZA(),i.qZA(),i.YNc(12,Xe,3,2,"div",13),i.qZA()}if(2&ae){const L=i.oxw();i.Gre("relation-row relation-row-",L.relatedWorkPackage.id,""),i.xp6(3),i.Q6J("ngIf",!L.userInputs.showRelationTypesForm),i.xp6(1),i.Q6J("ngIf",L.userInputs.showRelationTypesForm),i.xp6(1),i.Q6J("ngIf",L.relatedWorkPackage),i.xp6(2),i.Q6J("ngIf",L.relatedWorkPackage),i.xp6(2),i.Q6J("ngClass",i.VKq(12,Me,L.showDescriptionInfo))("title",L.text.description_label),i.xp6(1),i.Q6J("icon-title",L.text.toggleDescription),i.xp6(1),i.Q6J("ngIf",!!L.relation.delete),i.xp6(1),i.Q6J("ngIf",L.userInputs.showRelationInfo)}}class at extends h.N{constructor(z,L,ke,Le,gt,jt,bt){super(),this.apiV3Service=z,this.notificationService=L,this.wpRelations=ke,this.halEvents=Le,this.I18n=gt,this.cdRef=jt,this.PathHelper=bt,this.showRelationInfo=!1,this.showEditForm=!1,this.userInputs={newRelationText:"",showDescriptionEditForm:!1,showRelationTypesForm:!1,showRelationInfo:!1},this.fieldController={handler:{active:!0},required:!1},this.text={cancel:this.I18n.t("js.button_cancel"),save:this.I18n.t("js.button_save"),removeButton:this.I18n.t("js.relation_buttons.remove"),description_label:this.I18n.t("js.relation_buttons.update_description"),toggleDescription:this.I18n.t("js.relation_buttons.toggle_description"),updateRelation:this.I18n.t("js.relation_buttons.update_relation"),placeholder:{description:this.I18n.t("js.placeholders.relation_description")}}}ngOnInit(){this.relation=this.relatedWorkPackage.relatedBy,this.userInputs.newRelationText=this.relation.description||"",this.availableRelationTypes=E.d.LOCALIZED_RELATION_TYPES(!1),this.selectedRelationType=_.find(this.availableRelationTypes,{name:this.relation.normalizedType(this.workPackage)}),this.apiV3Service.work_packages.id(this.relatedWorkPackage).requireAndStream().pipe(this.untilDestroyed()).subscribe(z=>{this.relatedWorkPackage=z})}get normalizedRelationType(){const z=this.relation.normalizedType(this.workPackage);return this.I18n.t(`js.relation_labels.${z}`)}get relationReady(){return this.relatedWorkPackage&&this.relatedWorkPackage.$loaded}startDescriptionEdit(){this.userInputs.showDescriptionEditForm=!0,setTimeout(()=>{const z=jQuery(this.relationDescriptionTextarea.nativeElement),L=z.val().length;z.focus(),z.prop("selectionStart",L),z.prop("selectionEnd",L)})}handleDescriptionKey(z){27===z.which&&this.cancelDescriptionEdit()}cancelDescriptionEdit(){this.userInputs.showDescriptionEditForm=!1,this.userInputs.newRelationText=this.relation.description||""}saveDescription(){this.wpRelations.updateRelation(this.relation,{description:this.userInputs.newRelationText}).then(z=>{this.relation=z,this.relatedWorkPackage.relatedBy=z,this.userInputs.showDescriptionEditForm=!1,this.notificationService.showSave(this.relatedWorkPackage),this.cdRef.detectChanges()})}get showDescriptionInfo(){return this.userInputs.showRelationInfo||this.relation.description}activateRelationTypeEdit(){this.groupByWorkPackageType&&(this.userInputs.showRelationTypesForm=!0)}cancelRelationTypeEditOnEscape(z){this.userInputs.showRelationTypesForm=!1}saveRelationType(){this.wpRelations.updateRelationType(this.workPackage,this.relatedWorkPackage,this.relation,this.selectedRelationType.name).then(z=>{this.notificationService.showSave(this.relatedWorkPackage),this.relatedWorkPackage.relatedBy=z,this.relation=z,this.userInputs.showRelationTypesForm=!1,this.cdRef.detectChanges()}).catch(z=>this.notificationService.handleRawError(z,this.workPackage))}toggleUserDescriptionForm(){this.userInputs.showDescriptionEditForm=!this.userInputs.showDescriptionEditForm}removeRelation(){this.wpRelations.removeRelation(this.relation).then(()=>{this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:null,relationType:this.relation.normalizedType(this.workPackage)}),this.apiV3Service.work_packages.cache.updateWorkPackage(this.relatedWorkPackage),this.notificationService.showSave(this.relatedWorkPackage)}).catch(z=>this.notificationService.handleRawError(z,this.relatedWorkPackage))}highlightingClassForWpType(){return T.Z.inlineClass("type",this.relatedWorkPackage.type.id)}}at.\u0275fac=function(z){return new(z||at)(i.Y36(c.T),i.Y36(P.q),i.Y36(v.V),i.Y36(y.J),i.Y36(p.D),i.Y36(i.sBO),i.Y36(C.j))},at.\u0275cmp=i.Xpm({type:at,selectors:[["wp-relation-row"]],viewQuery:function(z,L){if(1&z&&i.Gf(Y,5),2&z){let ke;i.iGM(ke=i.CRH())&&(L.relationDescriptionTextarea=ke.first)}},inputs:{workPackage:"workPackage",relatedWorkPackage:"relatedWorkPackage",groupByWorkPackageType:"groupByWorkPackageType"},features:[i.qOj],decls:1,vars:1,consts:[["opFocusWithin",".wp-relations-controls-section button",3,"class",4,"ngIf"],["opFocusWithin",".wp-relations-controls-section button"],[1,"grid-block","hierarchy-item"],[1,"grid-content","medium-2","collapse"],["type","button","class","relation-row--type",3,"click",4,"ngIf"],["class","inline-edit--container inplace-edit",4,"ngIf"],["class","grid-content medium-5 collapse",4,"ngIf"],[1,"grid-content","medium-3","collapse","wp-relations-status-field"],[3,"resource",4,"ngIf"],["ng-class","{'-expanded': userInputs.showRelationInfo }",1,"grid-content","medium-2","collapse","wp-relations-controls-section"],["type","button",1,"spot-link","wp-relations--description-btn",3,"ngClass","title","click"],["icon-classes","icon-info1 icon-no-color -padded wp-relations--icon wp-relations--description-icon",3,"icon-title"],["type","button","class","spot-link relation-row--remove-btn",3,"ngClass","title","click",4,"ngIf"],["class","grid-block hierarchy-item description-container",4,"ngIf"],["type","button",1,"relation-row--type",3,"click"],[3,"textContent",4,"ngIf"],[3,"ngClass","textContent",4,"ngIf"],[1,"hidden-for-sighted",3,"textContent"],[3,"textContent"],[3,"ngClass","textContent"],[1,"inline-edit--container","inplace-edit"],["role","listbox","opAutofocus","",1,"inline-edit--field","form--select",3,"ngModel","ngModelChange","change","keydown.escape"],[3,"textContent","ngValue",4,"ngFor","ngForOf"],[3,"textContent","ngValue"],[1,"grid-content","medium-5","collapse"],["uiSref","work-packages.show.tabs",1,"wp-relations--subject-field",3,"uiParams","textContent"],[3,"resource"],["fieldName","status",3,"resource"],["type","button",1,"spot-link","relation-row--remove-btn",3,"ngClass","title","click"],["icon-classes","icon-remove icon-no-color -padded wp-relations--icon",3,"icon-title"],[1,"grid-block","hierarchy-item","description-container"],["type","button","class","wp-relation--description-read-value",3,"-placeholder","textContent","click",4,"ngIf"],["class","wp-relation--description-wrapper textarea-wrapper",4,"ngIf"],["type","button",1,"wp-relation--description-read-value",3,"textContent","click"],[1,"wp-relation--description-wrapper","textarea-wrapper"],["autofocus","","name","description",1,"wp-relation--description-textarea",3,"ngModel","keyup","ngModelChange"],["relationDescriptionTextarea",""],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel"]],template:function(z,L){1&z&&i.YNc(0,it,13,14,"div",0),2&z&&i.Q6J("ngIf",L.workPackage&&L.relatedWorkPackage)},directives:[l.O5,O.N,l.mk,I.o,Z.EJ,j.U,Z.JJ,Z.On,l.sg,Z.YN,Z.Kr,B.AnchorUISref,B.UISref,J.n,R.k,Z.Fj,F.e],encapsulation:2});const lt=["wpRelationGroupByToggler"];function dt(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",5),i.TgZ(1,"button",6,7),i.NdJ("click",function(){return i.CHM(L),i.oxw().toggleButton()}),i._UZ(3,"span",8),i.qZA(),i.qZA()}if(2&ae){const L=i.oxw();i.xp6(3),i.Q6J("textContent",L.togglerText)}}function de(ae,z){if(1&ae&&i._UZ(0,"wp-relation-row",11),2&ae){const L=z.$implicit,ke=i.oxw(2);i.Q6J("workPackage",ke.workPackage)("groupByWorkPackageType",ke.groupByWorkPackageType)("relatedWorkPackage",L)}}function oe(ae,z){if(1&ae&&(i.TgZ(0,"div",9),i.YNc(1,de,1,3,"wp-relation-row",10),i.qZA()),2&ae){const L=i.oxw();i.xp6(1),i.Q6J("ngForOf",L.relatedWorkPackages)}}class D{constructor(z){this.I18n=z,this.className=!0,this.onToggleGroupBy=new i.vpe,this.text={groupByType:this.I18n.t("js.relation_buttons.group_by_wp_type"),groupByRelation:this.I18n.t("js.relation_buttons.group_by_relation_type")}}get togglerText(){return this.groupByWorkPackageType?this.text.groupByRelation:this.text.groupByType}toggleButton(){this.onToggleGroupBy.emit(),setTimeout(()=>{this.toggleElement.nativeElement.focus()},20)}}D.\u0275fac=function(z){return new(z||D)(i.Y36(p.D))},D.\u0275cmp=i.Xpm({type:D,selectors:[["wp-relations-group"]],viewQuery:function(z,L){if(1&z&&i.Gf(lt,5),2&z){let ke;i.iGM(ke=i.CRH())&&(L.toggleElement=ke.first)}},hostVars:2,hostBindings:function(z,L){2&z&&i.ekj("attributes-group",L.className)},inputs:{relatedWorkPackages:"relatedWorkPackages",workPackage:"workPackage",header:"header",firstGroup:"firstGroup",groupByWorkPackageType:"groupByWorkPackageType"},outputs:{onToggleGroupBy:"onToggleGroupBy"},decls:5,vars:3,consts:[[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text","relation-group--header",3,"textContent"],["class","attributes-group--header-toggle",4,"ngIf"],["class","content",4,"ngIf"],[1,"attributes-group--header-toggle"],["id","wp-relation-group-by-toggle","type","button",1,"button","-small","-transparent","-with-icon","icon-group-by","icon-small","hide-when-print",3,"click"],["wpRelationGroupByToggler",""],[3,"textContent"],[1,"content"],[3,"workPackage","groupByWorkPackageType","relatedWorkPackage",4,"ngFor","ngForOf"],[3,"workPackage","groupByWorkPackageType","relatedWorkPackage"]],template:function(z,L){1&z&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i._UZ(2,"h3",2),i.qZA(),i.YNc(3,dt,4,1,"div",3),i.qZA(),i.YNc(4,oe,2,1,"div",4)),2&z&&(i.xp6(2),i.Q6J("textContent",L.header),i.xp6(1),i.Q6J("ngIf",L.firstGroup),i.xp6(1),i.Q6J("ngIf",L.relatedWorkPackages))},directives:[l.O5,l.sg,at],encapsulation:2});var G=t(11950);function V(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",4),i.TgZ(1,"div",5),i.TgZ(2,"div",6),i.TgZ(3,"button",7),i.NdJ("click",function(){return i.CHM(L),i.oxw().toggleRelationsCreateForm()}),i._UZ(4,"span",8),i._UZ(5,"span",9),i.qZA(),i.qZA(),i.qZA(),i.qZA()}if(2&ae){const L=i.oxw();i.xp6(5),i.Q6J("textContent",L.text.addNewRelation)}}function me(ae,z){if(1&ae&&i._UZ(0,"option",20),2&ae){const L=z.$implicit;i.Q6J("textContent",L.label)("value",L.name)}}function $(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",10),i.TgZ(1,"div",11),i._UZ(2,"label",12),i.TgZ(3,"select",13),i.NdJ("ngModelChange",function(Le){i.CHM(L);return i.oxw().selectedRelationType=Le}),i.YNc(4,me,1,2,"option",14),i.qZA(),i.qZA(),i.TgZ(5,"div",15),i.TgZ(6,"wp-relations-autocomplete",16),i.NdJ("onSelected",function(Le){return i.CHM(L),i.oxw().onSelected(Le)})("onCancel",function(){return i.CHM(L),i.oxw().toggleRelationsCreateForm()}),i.qZA(),i.qZA(),i.TgZ(7,"div",17),i.TgZ(8,"button",18),i.NdJ("click",function(){return i.CHM(L),i.oxw().toggleRelationsCreateForm()}),i._UZ(9,"op-icon",19),i.qZA(),i.qZA(),i.qZA()}if(2&ae){const L=i.oxw();i.xp6(2),i.Q6J("textContent",L.text.relationType),i.xp6(1),i.Q6J("ngModel",L.selectedRelationType),i.xp6(1),i.Q6J("ngForOf",L.relationTypes),i.xp6(2),i.Q6J("workPackage",L.workPackage)("hiddenOverflowContainer",".work-packages-tab-view--overflow")("selectedRelationType",L.selectedRelationType),i.xp6(3),i.Q6J("icon-title",L.text.abort)}}class Se{constructor(z,L,ke,Le){this.I18n=z,this.wpRelations=L,this.notificationService=ke,this.halEvents=Le,this.showRelationsCreateForm=!1,this.selectedRelationType=E.d.DEFAULT(),this.relationTypes=E.d.LOCALIZED_RELATION_TYPES(!1),this.isDisabled=!1,this.text={abort:this.I18n.t("js.relation_buttons.abort"),relationType:this.I18n.t("js.relation_buttons.relation_type"),addNewRelation:this.I18n.t("js.relation_buttons.add_new_relation")}}createRelation(){!this.selectedRelationType||!this.selectedWpId||(this.isDisabled=!0,this.createCommonRelation().catch(()=>this.isDisabled=!1).then(()=>this.isDisabled=!1))}onSelected(z){z&&(this.selectedWpId=z.id,this.createCommonRelation())}createCommonRelation(){return this.wpRelations.addCommonRelation(this.workPackage.id,this.selectedRelationType,this.selectedWpId).then(z=>{this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:z.id,relationType:this.selectedRelationType}),this.notificationService.showSave(this.workPackage),this.toggleRelationsCreateForm()}).catch(z=>{this.notificationService.handleRawError(z,this.workPackage),this.toggleRelationsCreateForm()})}toggleRelationsCreateForm(){this.showRelationsCreateForm=!this.showRelationsCreateForm,this.selectedWpId=""}}function ot(ae,z){if(1&ae&&(i.TgZ(0,"div",5),i.TgZ(1,"div",6),i._UZ(2,"h3",7),i.qZA(),i.qZA()),2&ae){const L=i.oxw();i.xp6(2),i.Q6J("textContent",L.text.relations_header)}}function st(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"wp-relations-group",8),i.NdJ("onToggleGroupBy",function(){return i.CHM(L),i.oxw().toggleGroupBy()}),i.qZA()}if(2&ae){const L=z.$implicit,ke=z.first,Le=i.oxw();i.Q6J("header",L)("groupByWorkPackageType",Le.groupByWorkPackageType)("firstGroup",ke)("relatedWorkPackages",Le.relationGroups[L])("workPackage",Le.workPackage)}}function he(ae,z){if(1&ae&&i._UZ(0,"wp-relations-create",4),2&ae){const L=i.oxw();i.Q6J("workPackage",L.workPackage)}}Se.\u0275fac=function(z){return new(z||Se)(i.Y36(p.D),i.Y36(v.V),i.Y36(P.q),i.Y36(y.J))},Se.\u0275cmp=i.Xpm({type:Se,selectors:[["wp-relations-create"]],inputs:{workPackage:"workPackage"},decls:4,vars:2,consts:[[1,"wp-relations-create"],["class","wp-relations-create-button hide-when-print",4,"ngIf"],["data-indicator-name","relationAddDynamic",1,"loading-indicator--location"],["class","v-align wp-relations-create--form",4,"ngIf"],[1,"wp-relations-create-button","hide-when-print"],[1,"grid-block"],[1,"grid-content","collapse"],["type","button","opAutofocus","","id","relation--add-relation",1,"spot-link","wp-inline-create--add-link",3,"click"],[1,"spot-icon","spot-icon_add"],[3,"textContent"],[1,"v-align","wp-relations-create--form"],[1,"grid-content","collapse","medium-3"],["for","relation-type--select",1,"hidden-for-sighted",3,"textContent"],["id","relation-type--select","role","listbox","opAutoFocus","",1,"form--select","relationTypeSelect",3,"ngModel","ngModelChange"],[3,"textContent","value",4,"ngFor","ngForOf"],[1,"grid-content","medium-8"],[3,"workPackage","hiddenOverflowContainer","selectedRelationType","onSelected","onCancel"],[1,"grid-content","medium-1","collapse","wp-relations-controls-section","relation-row"],["type","button",1,"spot-link","wp-create-relation--cancel",3,"click"],["icon-classes","icon-remove icon-no-color -padded",3,"icon-title"],[3,"textContent","value"]],template:function(z,L){1&z&&(i.TgZ(0,"div",0),i.YNc(1,V,6,1,"div",1),i.TgZ(2,"div",2),i.YNc(3,$,10,7,"div",3),i.qZA(),i.qZA()),2&z&&(i.xp6(1),i.Q6J("ngIf",!L.showRelationsCreateForm),i.xp6(2),i.Q6J("ngIf",L.showRelationsCreateForm))},directives:[l.O5,j.U,Z.EJ,Z.JJ,Z.On,l.sg,G.t,I.o,Z.YN,Z.Kr],encapsulation:2});class ye extends h.N{constructor(z,L,ke,Le){super(),this.I18n=z,this.wpRelations=L,this.cdRef=ke,this.apiV3Service=Le,this.relationGroups={},this.relationGroupKeys=[],this.relationsPresent=!1,this.groupByWorkPackageType=!1,this.text={relations_header:this.I18n.t("js.work_packages.tabs.relations")},this.currentRelations=[]}ngOnInit(){this.canAddRelation=!!this.workPackage.addRelation,this.wpRelations.state(this.workPackage.id).values$().pipe((0,f.R)((0,m.J6)(this))).subscribe(z=>{this.loadedRelations(z)}),this.wpRelations.require(this.workPackage.id),this.apiV3Service.work_packages.id(this.workPackage).requireAndStream().pipe((0,f.R)((0,m.J6)(this))).subscribe(z=>{this.workPackage=z})}getRelatedWorkPackages(z){const L=z.map(ke=>this.apiV3Service.work_packages.id(ke).get());return(0,d.$R)(...L)}getRelatedWorkPackageId(z){const L=z.ids;return z.to.href===this.workPackage.href?L.from:L.to}toggleGroupBy(){this.groupByWorkPackageType=!this.groupByWorkPackageType,this.buildRelationGroups()}buildRelationGroups(){_.isNil(this.currentRelations)||(this.relationGroups=_.groupBy(this.currentRelations,z=>{if(this.groupByWorkPackageType)return z.type.name;const L=z.relatedBy.normalizedType(this.workPackage);return this.I18n.t(`js.relation_labels.${L}`)}),this.relationGroupKeys=_.keys(this.relationGroups),this.relationsPresent=_.size(this.relationGroups)>0,this.cdRef.detectChanges())}loadedRelations(z){const L=[],ke=[];if(0===_.size(z))return this.currentRelations=[],this.buildRelationGroups();_.each(z,Le=>{const gt=this.getRelatedWorkPackageId(Le);L.push(gt),ke[gt]=Le}),this.getRelatedWorkPackages(L).pipe((0,a.q)(1)).subscribe(Le=>{this.currentRelations=Le.map(gt=>(gt.relatedBy=ke[gt.id],gt)),this.buildRelationGroups()})}}function xe(ae,z){if(1&ae&&(i.TgZ(0,"div",1),i.TgZ(1,"div",2),i._UZ(2,"wp-relations",3),i.qZA(),i.qZA()),2&ae){const L=i.oxw();i.xp6(2),i.Q6J("workPackage",L.workPackage)}}ye.\u0275fac=function(z){return new(z||ye)(i.Y36(p.D),i.Y36(v.V),i.Y36(i.sBO),i.Y36(c.T))},ye.\u0275cmp=i.Xpm({type:ye,selectors:[["wp-relations"]],inputs:{workPackage:"workPackage"},features:[i.qOj],decls:5,vars:4,consts:[["data-indicator-name","relation-groups",1,"loading-indicator--location"],["class","attributes-group--header",4,"ngIf"],[3,"header","groupByWorkPackageType","firstGroup","relatedWorkPackages","workPackage","onToggleGroupBy",4,"ngFor","ngForOf"],[3,"workPackage",4,"ngIf"],[3,"workPackage"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"],[3,"header","groupByWorkPackageType","firstGroup","relatedWorkPackages","workPackage","onToggleGroupBy"]],template:function(z,L){1&z&&(i.TgZ(0,"div",0),i.YNc(1,ot,3,1,"div",1),i.YNc(2,st,1,5,"wp-relations-group",2),i.YNc(3,he,1,1,"wp-relations-create",3),i._UZ(4,"wp-relations-hierarchy",4),i.qZA()),2&z&&(i.xp6(1),i.Q6J("ngIf",!L.relationsPresent),i.xp6(1),i.Q6J("ngForOf",L.relationGroupKeys),i.xp6(1),i.Q6J("ngIf",L.canAddRelation),i.xp6(1),i.Q6J("workPackage",L.workPackage))},directives:[l.O5,l.sg,b,D,Se],encapsulation:2,changeDetection:0});class De extends h.N{constructor(z,L,ke){super(),this.I18n=z,this.$transition=L,this.apiV3Service=ke}ngOnInit(){const z=this.workPackageId||this.$transition.params("to").workPackageId;this.apiV3Service.work_packages.id(z).requireAndStream().pipe(this.untilDestroyed()).subscribe(L=>{this.workPackageId=L.id,this.workPackage=L})}}De.\u0275fac=function(z){return new(z||De)(i.Y36(p.D),i.Y36(e.Transition),i.Y36(c.T))},De.\u0275cmp=i.Xpm({type:De,selectors:[["wp-relations-tab"]],inputs:{workPackageId:"workPackageId"},features:[i.qOj],decls:1,vars:1,consts:[["class","detail-panel-description detail-panel--relations detail-panel--autocomplete-target",4,"ngIf"],[1,"detail-panel-description","detail-panel--relations","detail-panel--autocomplete-target"],[1,"detail-panel-description-content"],[3,"workPackage"]],template:function(z,L){1&z&&i.YNc(0,xe,3,1,"div",0),2&z&&i.Q6J("ngIf",L.workPackage)},directives:[l.O5,ye],encapsulation:2});var Qe=t(77180),Ve=t(83720),nt=t(33927),mt=t(23896),Ue=t(54892),Fe=t(82123),Te=t(1056);class tt extends h.N{constructor(z,L,ke,Le,gt,jt,bt,on){super(),this.apiV3Service=z,this.I18n=L,this.cdRef=ke,this.uiRouterGlobals=Le,this.wpActivity=gt,this.storeService=jt,this.browserDetector=bt,this.wpSingleViewService=on,this.unfilteredActivities=[],this.visibleActivities=[],this.onlyComments=!1,this.text={commentsOnly:this.I18n.t("js.label_activity_show_only_comments"),showAll:this.I18n.t("js.label_activity_show_all")},this.additionalScrollMargin=200,this.initialized=!1,this.comingFromNotifications=!1,this.reverse=gt.isReversed,this.togglerText=this.text.commentsOnly;const An=Le.successfulTransitions.peekTail().from().name,Xn=/^notifications/.test(An),Bi=""===An&&this.browserDetector.isMobile;(Xn||Bi)&&(this.comingFromNotifications=!0)}ngOnInit(){this.initialized=!1,this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(z=>{this.workPackage=z,this.reloadActivities()}),this.wpSingleViewService.selectNotificationsCount$.pipe(this.untilDestroyed(),(0,Ve.x)()).subscribe(()=>{this.reloadActivities()})}scrollIfNotificationPresent(){this.storeService.hasNotifications$.pipe((0,mt.take)(1)).subscribe(z=>{z&&this.scrollToUnreadNotification()})}reloadActivities(){this.wpActivity.require(this.workPackage,!0).then(z=>{this.updateActivities(z),this.cdRef.detectChanges(),this.initialized||(this.initialized=!0,this.scrollIfNotificationPresent())})}updateActivities(z){this.unfilteredActivities=z;const L=this.getVisibleActivities();this.visibleActivities=L.map((ke,Le)=>this.info(ke,Le)),this.showToggler=this.shouldShowToggler()}shouldShowToggler(){const z=this.unfilteredActivities.length,L=this.getActivitiesWithComments().length;return z>1&&L>0&&L<this.unfilteredActivities.length}getVisibleActivities(){return this.onlyComments?this.getActivitiesWithComments():this.unfilteredActivities}getActivitiesWithComments(){return this.unfilteredActivities.filter(z=>!!_.get(z,"comment.html"))}hasUnreadNotification(z){return this.storeService.selectNotifications$.pipe((0,nt.U)(L=>!!L.find(ke=>{var Le;return(null===(Le=ke._links.activity)||void 0===Le?void 0:Le.href)===z})))}scrollToUnreadNotification(){const z=document.querySelectorAll("[data-notification-selector='notification-activity']");if(window.location.href.indexOf("activity#")>-1||0===z.length)return;const L=z[this.reverse?z.length-1:0],ke=document.querySelectorAll("[data-notification-selector='notification-scroll-container']")[0],Le=L.offsetTop-ke.offsetTop-this.additionalScrollMargin;ke.scrollTop=Le,this.comingFromNotifications&&ke.scrollIntoView(!0)}toggleComments(){this.onlyComments=!this.onlyComments,this.updateActivities(this.unfilteredActivities),this.onlyComments?this.togglerText=this.text.showAll:this.togglerText=this.text.commentsOnly}info(z,L){return this.wpActivity.info(this.unfilteredActivities,z,L)}}tt.\u0275fac=function(z){return new(z||tt)(i.Y36(c.T),i.Y36(p.D),i.Y36(i.sBO),i.Y36(e.UIRouterGlobals),i.Y36(Ue.a),i.Y36(Fe.O),i.Y36(Te.o),i.Y36(Fe.O))},tt.\u0275dir=i.lG2({type:tt,features:[i.qOj]});var ut=t(43682),Yt=t(3786),It=t(86469),Nt=t(12877),wt=t(36293),zt=t(86029),Kt=t(79441),ei=t(55749);class Rt extends zt.k{constructor(z,L){super(),this.elementRef=z,this.injector=L,this.fieldName="comment",this.handler=this,this.active=!1,this.inEditMode=!1,this.inFlight=!1,this.onDestroy=new Kt.xQ}ngOnInit(){this.change=new ei.G(this.workPackage)}reset(z="",L=!1){z.length>0&&(z+="\n"),this.change.setValue("comment",{raw:z,isPrivate:L})}get schema(){return{name:I18n.t("js.label_comment"),writable:!0,required:!1,type:"_comment",hasDefault:!1}}get rawComment(){return _.get(this.commentValue,"raw","")}get commentValue(){return this.change.value("comment")}handleUserCancel(){this.deactivate(!0)}activate(z,L){this.active=!0,this.reset(z,L)}deactivate(z){this.active=!1,this.onDestroy.next(),this.onDestroy.complete()}focus(){const z=this.elementRef.nativeElement.querySelector(".inplace-editing--trigger-container");z&&z.focus()}onFocusOut(){}handleUserKeydown(z,L){}isChanged(){return!1}stopPropagation(z){return!1}}Rt.\u0275fac=function(z){return new(z||Rt)(i.Y36(i.SBq),i.Y36(i.zs3))},Rt.\u0275dir=i.lG2({type:Rt,features:[i.qOj]});var Mt=t(82267),Ot=t(8849),St=t(92058);const ti=["commentContainer"];function Tt(ae,z){if(1&ae&&i.GkF(0,4),2&ae){const L=i.oxw();i.Q6J("ngTemplateOutlet",L.template)}}function qt(ae,z){if(1&ae&&i._UZ(0,"edit-form-portal",10),2&ae){const L=i.oxw(2);i.Q6J("schemaInput",L.schema)("changeInput",L.change)("editFieldHandler",L.handler)}}function Qt(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",11),i.NdJ("dragover",function(Le){return i.CHM(L),i.oxw(2).startDragOverActivation(Le)})("dragenter",function(Le){return i.CHM(L),i.oxw(2).startDragOverActivation(Le)}),i.TgZ(1,"button",12),i.NdJ("click",function(){return i.CHM(L),i.oxw(2).activate()}),i._UZ(2,"span",13),i._UZ(3,"op-icon",14),i.qZA(),i.qZA()}if(2&ae){const L=i.oxw(2);i.xp6(1),i.Q6J("title",L.text.editTitle),i.xp6(1),i.Q6J("textContent",L.text.placeholder),i.xp6(1),i.Q6J("icon-title",L.text.editTitle)}}const Gt=function(ae){return{"work-packages--activity--add-comment_top":ae}};function ii(ae,z){if(1&ae&&(i.TgZ(0,"div",5,6),i.TgZ(2,"div",7),i.YNc(3,qt,1,3,"edit-form-portal",8),i.YNc(4,Qt,4,3,"div",9),i.qZA(),i.qZA()),2&ae){const L=i.oxw();i.Q6J("ngClass",i.VKq(3,Gt,L.showAbove)),i.xp6(3),i.Q6J("ngIf",L.active),i.xp6(1),i.Q6J("ngIf",!L.active)}}function Jt(ae,z){if(1&ae&&i.GkF(0,4),2&ae){const L=i.oxw();i.Q6J("ngTemplateOutlet",L.template)}}class Ce extends Rt{constructor(z,L,ke,Le,gt,jt,bt,on,An,Xn,Bi){super(z,L),this.elementRef=z,this.injector=L,this.commentService=ke,this.wpLinkedActivities=Le,this.ConfigurationService=gt,this.loadingIndicator=jt,this.apiV3Service=bt,this.workPackageNotificationService=on,this.toastService=An,this.cdRef=Xn,this.I18n=Bi,this.text={editTitle:this.I18n.t("js.label_add_comment_title"),addComment:this.I18n.t("js.label_add_comment"),cancelTitle:this.I18n.t("js.label_cancel_comment"),placeholder:this.I18n.t("js.label_add_comment_title")},this.fieldLabel=this.text.editTitle,this.inFlight=!1,this.htmlId="wp-comment-field"}ngOnInit(){super.ngOnInit(),this.canAddComment=!!this.workPackage.addComment||!!this.workPackage.privateComment,this.showAbove=this.ConfigurationService.commentsSortedInDescendingOrder(),this.commentService.quoteEvents.pipe(this.untilDestroyed()).subscribe(z=>{this.activate(z),this.commentContainer.nativeElement.scrollIntoView()})}startDragOverActivation(z){return!!this.active||(this.activate(),z.preventDefault(),!1)}activate(z){super.activate(z),this.showAbove||this.scrollToBottom(),this.cdRef.detectChanges()}deactivate(z){z&&this.focus(),this.active=!1,this.cdRef.detectChanges()}handleUserSubmit(){return(0,Yt.mG)(this,void 0,void 0,function*(){if(this.inFlight||!this.rawComment)return Promise.resolve();this.inFlight=!0,yield this.onSubmit();const z=this.loadingIndicator.wpDetails;return z.promise=this.commentService.createComment(this.workPackage,this.commentValue).then(()=>{this.active=!1,this.toastService.addSuccess(this.I18n.t("js.work_packages.comment_added")),this.wpLinkedActivities.require(this.workPackage,!0),this.apiV3Service.work_packages.id(this.workPackage.id).refresh(),this.inFlight=!1,this.deactivate(!0)}).catch(L=>{this.inFlight=!1,L instanceof Ot.o?this.workPackageNotificationService.showError(L.resource,this.workPackage):this.toastService.addError(this.I18n.t("js.work_packages.comment_send_failed"))}),z.promise})}scrollToBottom(){const z=jQuery(this.elementRef.nativeElement).scrollParent()[0];z&&setTimeout(()=>{z.scrollTop=z.scrollHeight},400)}setErrors(z){}}Ce.\u0275fac=function(z){return new(z||Ce)(i.Y36(i.SBq),i.Y36(i.zs3),i.Y36(Mt.O),i.Y36(Ue.a),i.Y36(Nt.e),i.Y36(It.vt),i.Y36(c.T),i.Y36(P.q),i.Y36(wt.kl),i.Y36(i.sBO),i.Y36(p.D))},Ce.\u0275cmp=i.Xpm({type:Ce,selectors:[["work-package-comment"]],contentQueries:function(z,L,ke){if(1&z&&i.Suo(ke,i.Rgc,5),2&z){let Le;i.iGM(Le=i.CRH())&&(L.template=Le.first)}},viewQuery:function(z,L){if(1&z&&i.Gf(ti,5),2&z){let ke;i.iGM(ke=i.CRH())&&(L.commentContainer=ke.first)}},inputs:{workPackage:"workPackage"},features:[i.qOj],decls:5,vars:3,consts:[["id","work-package-activites-container"],["id","work-package-comment-container"],[3,"ngTemplateOutlet",4,"ngIf"],["class","work-package--details--long-field work-packages--activity--add-comment hide-when-print",3,"ngClass",4,"ngIf"],[3,"ngTemplateOutlet"],[1,"work-package--details--long-field","work-packages--activity--add-comment","hide-when-print",3,"ngClass"],["commentContainer",""],[1,"inline-edit--container","inplace-edit"],[3,"schemaInput","changeInput","editFieldHandler",4,"ngIf"],[3,"dragover","dragenter",4,"ngIf"],[3,"schemaInput","changeInput","editFieldHandler"],[3,"dragover","dragenter"],[1,"work-package-comment","inline-edit--display-field",3,"title","click"],[1,"work-package-comment--text",3,"textContent"],["icon-classes","icon-edit",1,"work-package-comment--icon",3,"icon-title"]],template:function(z,L){1&z&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.YNc(2,Tt,1,1,"ng-container",2),i.YNc(3,ii,5,5,"div",3),i.YNc(4,Jt,1,1,"ng-container",2),i.qZA(),i.qZA()),2&z&&(i.xp6(2),i.Q6J("ngIf",!L.showAbove),i.xp6(1),i.Q6J("ngIf",L.canAddComment),i.xp6(1),i.Q6J("ngIf",L.showAbove))},directives:[l.O5,l.tP,l.mk,St.m,I.o],encapsulation:2,changeDetection:0});var N=t(10190),Q=t(70692);const je=function(ae,z){return{workPackageId:ae,"#":z}};class Ee{ngOnInit(){this.activityHtmlId=`activity-${this.activityNo}`,this.activityLabel=`#${this.activityNo}`}}Ee.\u0275fac=function(z){return new(z||Ee)},Ee.\u0275cmp=i.Xpm({type:Ee,selectors:[["activity-link"]],inputs:{workPackage:"workPackage",activityNo:"activityNo"},decls:1,vars:6,consts:[["uiSref","work-packages.show",3,"id","textContent","uiParams"]],template:function(z,L){1&z&&i._UZ(0,"a",0),2&z&&(i.MGl("id","",L.activityHtmlId,"-link"),i.Q6J("textContent",L.activityLabel)("uiParams",i.WLB(3,je,L.workPackage.id,L.activityHtmlId)))},directives:[B.AnchorUISref,B.UISref],encapsulation:2});var kt=t(3742);function si(ae,z){1&ae&&i._UZ(0,"span",11)}function Wt(ae,z){if(1&ae&&i._UZ(0,"op-principal",12),2&ae){const L=i.oxw(2);i.Q6J("principal",L.activity.author)("hideName",!0)}}const ri=function(ae){return{name:ae}};function ni(ae,z){if(1&ae&&i._UZ(0,"op-principal",12),2&ae){const L=i.oxw(2);i.Q6J("principal",i.VKq(2,ri,L.userName))("hideName",!0)}}function Qi(ae,z){if(1&ae&&(i.TgZ(0,"span",13),i._UZ(1,"a",14),i.qZA()),2&ae){const L=i.oxw(2);i.xp6(1),i.Q6J("textContent",L.userName),i.uIk("href",L.userPath,i.LSH)("aria-label",L.userLabel)}}function _i(ae,z){if(1&ae&&i._UZ(0,"span",15),2&ae){const L=i.oxw(2);i.Q6J("textContent",L.userName)}}function bi(ae,z){if(1&ae&&(i.TgZ(0,"div",1),i.TgZ(1,"div",2),i.YNc(2,si,1,0,"span",3),i._UZ(3,"activity-link",4),i.qZA(),i.YNc(4,Wt,1,2,"op-principal",5),i.YNc(5,ni,1,4,"op-principal",5),i.YNc(6,Qi,2,3,"span",6),i.YNc(7,_i,1,1,"span",7),i._uU(8,"\xa0 "),i._UZ(9,"span",8),i.TgZ(10,"span",9),i._UZ(11,"span",10),i.qZA(),i.qZA()),2&ae){const L=i.oxw();i.uIk("data-notification-selector",L.hasUnreadNotification?"notification-activity":null),i.xp6(2),i.Q6J("ngIf",L.hasUnreadNotification),i.xp6(1),i.Q6J("workPackage",L.workPackage)("activityNo",L.activityNo),i.xp6(1),i.Q6J("ngIf",L.activity.author),i.xp6(1),i.Q6J("ngIf",!L.activity.author&&L.userName),i.xp6(1),i.Q6J("ngIf",L.userActive),i.xp6(1),i.Q6J("ngIf",!L.userActive),i.xp6(2),i.Q6J("innerHtml",L.revisionLink,i.oJD),i.xp6(2),i.Q6J("innerHtml",L.message,i.oJD)}}class Ke{constructor(z,L,ke,Le){this.I18n=z,this.timezoneService=L,this.cdRef=ke,this.apiV3Service=Le}ngOnInit(){this.loadAuthor(),this.project=this.workPackage.project,this.revision=this.activity.identifier,this.message=this.activity.message.html;const z=this.activity.showRevision.$link.href,L=this.activity.formattedIdentifier,ke=document.createElement("a");ke.href=z,ke.title=this.revision,ke.textContent=this.I18n.t("js.label_committed_link",{revision_identifier:L}),this.revisionLink=this.I18n.t("js.label_committed_at",{committed_revision_link:ke.outerHTML,date:this.timezoneService.formattedDatetime(this.activity.createdAt)})}loadAuthor(){void 0===this.activity.author?this.userName=this.activity.authorName:this.apiV3Service.users.id((0,N.Z)(this.activity.author.href)).get().subscribe(z=>{this.userId=z.id,this.userName=z.name,this.userActive=z.isActive,this.userAvatar=z.avatar,this.userPath=z.showUser.href,this.userLabel=this.I18n.t("js.label_author",{user:this.userName}),this.cdRef.detectChanges()})}}Ke.\u0275fac=function(z){return new(z||Ke)(i.Y36(p.D),i.Y36(Q.B),i.Y36(i.sBO),i.Y36(c.T))},Ke.\u0275cmp=i.Xpm({type:Ke,selectors:[["revision-activity"]],inputs:{workPackage:"workPackage",activity:"activity",activityNo:"activityNo",hasUnreadNotification:"hasUnreadNotification"},decls:1,vars:1,consts:[["class","work-package-details-activities-activity-contents",4,"ngIf"],[1,"work-package-details-activities-activity-contents"],[1,"comments-number"],["class","comments-number--bubble op-bubble op-bubble_mini","data-qa-selector","revision-activity-bubble",4,"ngIf"],[1,"comments-number--link",3,"workPackage","activityNo"],[3,"principal","hideName",4,"ngIf"],["class","user",4,"ngIf"],["class","user",3,"textContent",4,"ngIf"],[1,"revision-activity--revision-link","date",3,"innerHtml"],[1,"user-comment","wiki"],[1,"message",3,"innerHtml"],["data-qa-selector","revision-activity-bubble",1,"comments-number--bubble","op-bubble","op-bubble_mini"],[3,"principal","hideName"],[1,"user"],[3,"textContent"],[1,"user",3,"textContent"]],template:function(z,L){1&z&&i.YNc(0,bi,12,10,"div",0),2&z&&i.Q6J("ngIf",L.workPackage)},directives:[l.O5,Ee,kt.N],encapsulation:2,changeDetection:0});var Oe=t(7493),ve=(t(80044),t(71570)),pe=t(65532),ue=t(21501),Ze=t(80261);class Ge{constructor(z,L,ke){this.domSanitizer=z,this.elementRef=L,this.appRef=ke,this.dynamicBootstrapper=Ze.Z}set HTML(z){this.innerHtml=this.domSanitizer.bypassSecurityTrustHtml(z),this.dynamicBootstrapper.bootstrapOptionalEmbeddable(this.appRef,this.elementRef.nativeElement)}}function ft(ae,z){if(1&ae&&i._UZ(0,"op-principal",18),2&ae){const L=i.oxw(2);i.Q6J("principal",L.user)("hideName",!0)}}function Pt(ae,z){1&ae&&i._UZ(0,"span",19)}function yt(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",20),i.NdJ("click",function(){return i.CHM(L),i.oxw(2).quoteComment()}),i._UZ(1,"op-icon",21),i.qZA()}if(2&ae){const L=i.oxw(2);i.Q6J("title",L.text.quote_comment)}}function Lt(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",22),i.NdJ("click",function(){return i.CHM(L),i.oxw(2).activate()}),i._UZ(1,"op-icon",23),i.qZA()}if(2&ae){const L=i.oxw(2);i.Q6J("ngClass","edit-activity--"+L.activityNo)("title",L.text.edit_comment)}}function Xt(ae,z){if(1&ae&&i._UZ(0,"img",24),2&ae){const L=i.oxw(2);i.Q6J("src",L.bcfSnapshotUrl,i.LSH)}}function At(ae,z){if(1&ae&&(i.TgZ(0,"div",25),i.TgZ(1,"div",26),i._UZ(2,"edit-form-portal",27),i.qZA(),i.qZA()),2&ae){const L=i.oxw(2);i.xp6(2),i.Q6J("changeInput",L.change)("schemaInput",L.schema)("editFieldHandler",L.handler)}}function vt(ae,z){if(1&ae&&i._UZ(0,"op-dynamic-bootstrap",28),2&ae){const L=i.oxw(2);i.Q6J("HTML",L.postedComment)}}function mi(ae,z){if(1&ae&&(i.TgZ(0,"li"),i._UZ(1,"span",31),i.qZA()),2&ae){const L=z.$implicit;i.xp6(1),i.Q6J("innerHtml",L,i.oJD)}}function ai(ae,z){if(1&ae&&(i.TgZ(0,"ul",29),i.YNc(1,mi,2,1,"li",30),i.qZA()),2&ae){const L=i.oxw(2);i.xp6(1),i.Q6J("ngForOf",L.details)}}function dn(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",1),i.NdJ("mouseenter",function(){return i.CHM(L),i.oxw().focus()})("mouseleave",function(){return i.CHM(L),i.oxw().blur()}),i.TgZ(1,"div",2),i.YNc(2,ft,1,2,"op-principal",3),i.TgZ(3,"div"),i._UZ(4,"op-user-link",4),i.TgZ(5,"span",5),i._uU(6),i._UZ(7,"op-date-time",6),i.qZA(),i.qZA(),i.qZA(),i.TgZ(8,"div",7),i.YNc(9,Pt,1,0,"span",8),i._UZ(10,"activity-link",9),i.TgZ(11,"div",10),i.YNc(12,yt,2,1,"button",11),i.YNc(13,Lt,2,2,"button",12),i.qZA(),i.qZA(),i.YNc(14,Xt,1,1,"img",13),i.TgZ(15,"div",14),i.YNc(16,At,3,3,"div",15),i.YNc(17,vt,1,1,"op-dynamic-bootstrap",16),i.YNc(18,ai,2,1,"ul",17),i.qZA(),i.qZA()}if(2&ae){const L=i.oxw();i.Q6J("ngClass",L.isPrivate),i.uIk("data-notification-selector",L.hasUnreadNotification?"notification-activity":null),i.xp6(2),i.Q6J("ngIf",L.userName),i.xp6(2),i.Q6J("user",L.user),i.xp6(2),i.hij(" ",L.isInitial?L.text.label_created_on:L.text.label_updated_on," "),i.xp6(1),i.Q6J("dateTimeValue",L.activity.createdAt),i.xp6(2),i.Q6J("ngIf",L.hasUnreadNotification),i.xp6(1),i.Q6J("workPackage",L.workPackage)("activityNo",L.activityNo),i.xp6(1),i.Q6J("hidden",L.shouldHideIcons()),i.xp6(1),i.Q6J("ngIf",L.userCanQuote),i.xp6(1),i.Q6J("ngIf",L.userCanEdit),i.xp6(1),i.Q6J("ngIf",L.bcfSnapshotUrl),i.xp6(2),i.Q6J("ngIf",L.active),i.xp6(1),i.Q6J("ngIf",!L.active&&(L.isComment||L.isBcfComment)),i.xp6(1),i.Q6J("ngIf",!L.isInitial)}}Ge.\u0275fac=function(z){return new(z||Ge)(i.Y36(ve.H7),i.Y36(i.SBq),i.Y36(i.z2F))},Ge.\u0275cmp=i.Xpm({type:Ge,selectors:[["op-dynamic-bootstrap"]],inputs:{HTML:"HTML"},decls:1,vars:1,consts:[[1,"op-uc-container",3,"innerHtml"]],template:function(z,L){1&z&&i._UZ(0,"div",0),2&z&&i.Q6J("innerHtml",L.innerHtml,i.oJD)},encapsulation:2});class Zi extends Rt{constructor(z,L,ke,Le,gt,jt,bt,on,An,Xn,Bi,Ar,jr){super(z,L),this.elementRef=z,this.injector=L,this.sanitization=ke,this.PathHelper=Le,this.wpLinkedActivities=gt,this.commentService=jt,this.ConfigurationService=bt,this.apiV3Service=on,this.cdRef=An,this.I18n=Xn,this.ngZone=Bi,this.authorisation=Ar,this.appRef=jr,this.userCanEdit=!1,this.userCanQuote=!1,this.details=[],this.focused=!1,this.text={label_created_on:this.I18n.t("js.label_created_on"),label_updated_on:this.I18n.t("js.label_updated_on"),quote_comment:this.I18n.t("js.label_quote_comment"),edit_comment:this.I18n.t("js.label_edit_comment")}}get canPrivateComment(){return this.activity.comment.isPublic||this.authorisation.can("work_package","privateComment")}ngOnInit(){super.ngOnInit(),this.htmlId=`user_activity_edit_field_${this.activityNo}`,this.updateCommentText(),this.isComment="Activity::Comment"===this.activity._type,this.isBcfComment="Activity::BcfComment"===this.activity._type,this.isPrivate=this.activity.comment.isPublic?"":"op-user-activity--private",this.$element=jQuery(this.elementRef.nativeElement),this.reset(),this.userCanEdit=!!this.activity.update,this.userCanQuote=!!this.workPackage.addComment||!!this.workPackage.privateComment,this.$element.bind("focusin",this.focus.bind(this)),this.$element.bind("focusout",this.blur.bind(this)),_.each(this.activity.details,z=>{this.details.push(z.html)}),this.apiV3Service.users.id((0,N.Z)(this.activity.user.href)).get().subscribe(z=>{this.user=z,this.userId=z.id,this.userName=z.name,this.userAvatar=z.avatar,this.cdRef.detectChanges()}),window.location.hash===`#activity-${this.activityNo}`&&this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.elementRef.nativeElement.scrollIntoView(!0)})})}shouldHideIcons(){return!((this.isComment||this.isBcfComment)&&this.focussing())}activate(){super.activate(this.activity.comment.raw,this.activity.comment.isPublic),this.cdRef.detectChanges()}handleUserSubmit(){return this.inFlight||!this.rawComment?Promise.resolve():this.updateComment()}quoteComment(){this.commentService.quoteEvents.next(this.quotedText(this.activity.comment.raw))}get bcfSnapshotUrl(){return _.get(this.activity,"bcfViewpoints[0]")?`${_.get(this.activity,"bcfViewpoints[0]").href}/snapshot`:null}updateComment(){return(0,Yt.mG)(this,void 0,void 0,function*(){return this.inFlight=!0,yield this.onSubmit(),this.commentService.updateComment(this.activity,this.rawComment||"",this.commentValue.isPrivate).then(z=>{this.activity=z,this.updateCommentText(),this.wpLinkedActivities.require(this.workPackage,!0),this.apiV3Service.work_packages.cache.updateWorkPackage(this.workPackage)}).finally(()=>{this.deactivate(!0),this.inFlight=!1})})}focusEditIcon(){jQuery(`.edit-activity--${this.activityNo} a`).focus()}focus(){this.focused=!0,this.cdRef.detectChanges()}blur(){this.focused=!1,this.cdRef.detectChanges()}focussing(){return this.focused}setErrors(z){}quotedText(z){const L=z.split("\n").map(ke=>`\n> ${ke}`).join("");return`${this.userName} wrote:\n${L}`}deactivate(z){super.deactivate(z),z&&this.focusEditIcon()}updateCommentText(){this.postedComment=this.activity.comment.html}}function Ut(ae,z){if(1&ae&&i._UZ(0,"revision-activity",4),2&ae){const L=i.oxw();i.Q6J("workPackage",L.workPackage)("activity",L.activity)("activityNo",L.activityNo)("hasUnreadNotification",L.hasUnreadNotification)}}function ci(ae,z){if(1&ae&&i._UZ(0,"user-activity",5),2&ae){const L=i.oxw();i.Q6J("workPackage",L.workPackage)("activity",L.activity)("activityNo",L.activityNo)("isInitial",L.isInitial)("hasUnreadNotification",L.hasUnreadNotification)}}Zi.\u0275fac=function(z){return new(z||Zi)(i.Y36(i.SBq),i.Y36(i.zs3),i.Y36(ve.H7),i.Y36(C.j),i.Y36(Ue.a),i.Y36(Mt.O),i.Y36(Nt.e),i.Y36(c.T),i.Y36(i.sBO),i.Y36(p.D),i.Y36(i.R0b),i.Y36(Oe.g),i.Y36(i.z2F))},Zi.\u0275cmp=i.Xpm({type:Zi,selectors:[["user-activity"]],inputs:{workPackage:"workPackage",activity:"activity",activityNo:"activityNo",isInitial:"isInitial",hasUnreadNotification:"hasUnreadNotification"},features:[i.qOj],decls:1,vars:1,consts:[["class","op-user-activity work-package-details-activities-activity-contents",3,"ngClass","mouseenter","mouseleave",4,"ngIf"],[1,"op-user-activity","work-package-details-activities-activity-contents",3,"ngClass","mouseenter","mouseleave"],[1,"op-user-activity--user-line"],["class","op-user-activity--avatar",3,"principal","hideName",4,"ngIf"],[1,"op-user-activity--user-name",3,"user"],[1,"op-user-activity--date"],[3,"dateTimeValue"],[1,"comments-number"],["class","comments-number--bubble op-bubble op-bubble_mini","data-qa-selector","user-activity-bubble",4,"ngIf"],[1,"comments-number--link",3,"workPackage","activityNo"],[1,"comments-icons",3,"hidden"],["type","button","class","spot-link",3,"title","click",4,"ngIf"],["type","button","class","spot-link",3,"ngClass","title","click",4,"ngIf"],["class","activity-thumbnail",3,"src",4,"ngIf"],[1,"user-comment"],["class","inplace-edit",4,"ngIf"],["class","message",3,"HTML",4,"ngIf"],["class","work-package-details-activities-messages",4,"ngIf"],[1,"op-user-activity--avatar",3,"principal","hideName"],["data-qa-selector","user-activity-bubble",1,"comments-number--bubble","op-bubble","op-bubble_mini"],["type","button",1,"spot-link",3,"title","click"],["icon-classes","action-icon icon-quote"],["type","button",1,"spot-link",3,"ngClass","title","click"],["icon-classes","action-icon icon-edit"],[1,"activity-thumbnail",3,"src"],[1,"inplace-edit"],[1,"user-comment--form","inplace-edit--write-value"],[3,"changeInput","schemaInput","editFieldHandler"],[1,"message",3,"HTML"],[1,"work-package-details-activities-messages"],[4,"ngFor","ngForOf"],[1,"message",3,"innerHtml"]],template:function(z,L){1&z&&i.YNc(0,dn,19,16,"div",0),2&z&&i.Q6J("ngIf",L.workPackage&&L.canPrivateComment)},directives:[l.O5,l.mk,pe.F,ue.F,Ee,kt.N,I.o,St.m,Ge,l.sg],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-user-activity--user-line[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:50px;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis}.op-user-activity--user-name[_ngcontent-%COMP%]{display:block;font-weight:bold;line-height:16px;margin-bottom:3px}.op-user-activity--date[_ngcontent-%COMP%]{display:block;font-size:.8rem;color:#555}.op-user-activity--avatar[_ngcontent-%COMP%]{flex-shrink:0;margin-right:.5rem}.op-user-activity--private[_ngcontent-%COMP%]{background-color:#e6e6e6;padding:5px}"],changeDetection:0});class pi{constructor(z,L){this.PathHelper=z,this.I18n=L}ngOnInit(){this.projectId=(0,N.Z)(this.workPackage.project.href),this.activityType=this.activity._type}}function wi(ae,z){if(1&ae&&(i.TgZ(0,"div",3),i._UZ(1,"activity-entry",4),i.ALo(2,"async"),i.qZA()),2&ae){const L=z.$implicit,ke=i.oxw(2);i.xp6(1),i.Q6J("workPackage",ke.workPackage)("activity",L.activity)("activityNo",L.number(L.isReversed))("hasUnreadNotification",i.lcZ(2,5,ke.hasUnreadNotification(L.href)))("isInitial",L.isInitial())}}function gi(ae,z){if(1&ae&&(i.TgZ(0,"div",1),i.YNc(1,wi,3,7,"div",2),i.qZA()),2&ae){const L=i.oxw();i.xp6(1),i.Q6J("ngForOf",L.latestActivityInfo)("ngForTrackBy",L.trackByIdentifier)}}pi.\u0275fac=function(z){return new(z||pi)(i.Y36(C.j),i.Y36(p.D))},pi.\u0275cmp=i.Xpm({type:pi,selectors:[["activity-entry"]],inputs:{workPackage:"workPackage",activity:"activity",activityNo:"activityNo",isInitial:"isInitial",hasUnreadNotification:"hasUnreadNotification"},decls:4,vars:4,consts:[[3,"id"],[3,"ngSwitch"],[3,"workPackage","activity","activityNo","hasUnreadNotification",4,"ngSwitchCase"],[3,"workPackage","activity","activityNo","isInitial","hasUnreadNotification",4,"ngSwitchDefault"],[3,"workPackage","activity","activityNo","hasUnreadNotification"],[3,"workPackage","activity","activityNo","isInitial","hasUnreadNotification"]],template:function(z,L){1&z&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.YNc(2,Ut,1,4,"revision-activity",2),i.YNc(3,ci,1,5,"user-activity",3),i.qZA(),i.qZA()),2&z&&(i.MGl("id","activity-",L.activityNo,""),i.uIk("data-qa-activity-number",L.activityNo),i.xp6(1),i.Q6J("ngSwitch",L.activityType),i.xp6(1),i.Q6J("ngSwitchCase","Revision"))},directives:[l.RF,l.n9,l.ED,Ke,Zi],encapsulation:2});class Ii extends tt{constructor(){super(...arguments),this.latestActivityInfo=[],this.trackByIdentifier=(0,ut.AT)("identifier")}ngOnInit(){this.workPackageId=this.workPackage.id,super.ngOnInit()}shouldShowToggler(){return!1}updateActivities(z){super.updateActivities(z),this.latestActivityInfo=this.latestActivities()}latestActivities(z=3){if(this.reverse)return this.unfilteredActivities.slice(0,z).map((gt,jt)=>this.info(gt,jt));const L=this.unfilteredActivities.slice(-z),ke=this.unfilteredActivities.length-L.length;return L.map((Le,gt)=>this.info(Le,ke+gt))}}function Di(ae,z){if(1&ae&&i._UZ(0,"wp-single-view",2),2&ae){const L=i.oxw();i.Q6J("workPackage",L.workPackage)}}function Qn(ae,z){if(1&ae&&(i.TgZ(0,"div",3),i.TgZ(1,"div",4),i.TgZ(2,"div",5),i._UZ(3,"h3",6),i.qZA(),i.qZA(),i._UZ(4,"newest-activity-on-overview",2),i.qZA()),2&ae){const L=i.oxw();i.xp6(3),i.Q6J("textContent",L.tabName),i.xp6(1),i.Q6J("workPackage",L.workPackage)}}Ii.\u0275fac=function(){let ae;return function(L){return(ae||(ae=i.n5z(Ii)))(L||Ii)}}(),Ii.\u0275cmp=i.Xpm({type:Ii,selectors:[["newest-activity-on-overview"]],inputs:{workPackage:"workPackage"},features:[i.qOj],decls:2,vars:1,consts:[[3,"workPackage"],[1,"work-package-details-activities-list"],["class","work-package-details-activities-activity",4,"ngFor","ngForOf","ngForTrackBy"],[1,"work-package-details-activities-activity"],[3,"workPackage","activity","activityNo","hasUnreadNotification","isInitial"]],template:function(z,L){1&z&&(i.TgZ(0,"work-package-comment",0),i.YNc(1,gi,2,2,"ng-template"),i.qZA()),2&z&&i.Q6J("workPackage",L.workPackage)},directives:[Ce,l.sg,pi],pipes:[l.Ov],encapsulation:2,changeDetection:0});class Ji extends h.N{constructor(z,L,ke){super(),this.I18n=z,this.$state=L,this.apiV3Service=ke,this.tabName=this.I18n.t("js.label_latest_activity"),this.workPackageId=this.$state.params.workPackageId,this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(Le=>this.workPackage=Le)}}function bn(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",11),i.NdJ("click",function(){return i.CHM(L),i.oxw(5).toggleComments()}),i.qZA()}if(2&ae){const L=i.oxw(5);i.Q6J("textContent",L.togglerText)}}Ji.\u0275fac=function(z){return new(z||Ji)(i.Y36(p.D),i.Y36(e.StateService),i.Y36(c.T))},Ji.\u0275cmp=i.Xpm({type:Ji,selectors:[["wp-overview-tab"]],features:[i.qOj],decls:2,vars:2,consts:[[3,"workPackage",4,"ngIf"],["class","attributes-group",4,"ngIf"],[3,"workPackage"],[1,"attributes-group"],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"]],template:function(z,L){1&z&&(i.YNc(0,Di,1,1,"wp-single-view",0),i.YNc(1,Qn,5,2,"div",1)),2&z&&(i.Q6J("ngIf",L.workPackage),i.xp6(1),i.Q6J("ngIf",L.workPackage))},directives:[l.O5,Qe.G,Ii],encapsulation:2});const wn=function(ae){return{"-with-toggler":ae}};function Yi(ae,z){if(1&ae&&(i.TgZ(0,"h3",8),i._UZ(1,"span",9),i.YNc(2,bn,1,1,"button",10),i.qZA()),2&ae){const L=i.oxw(),ke=L.first,Le=L.$implicit,gt=i.oxw(3);i.Q6J("ngClass",i.VKq(3,wn,ke&&gt.showToggler)),i.xp6(1),i.Q6J("textContent",Le.date),i.xp6(1),i.Q6J("ngIf",ke&&gt.showToggler)}}function Jn(ae,z){if(1&ae&&(i.TgZ(0,"div",5),i.YNc(1,Yi,3,5,"h3",6),i._UZ(2,"activity-entry",7),i.ALo(3,"async"),i.qZA()),2&ae){const L=z.$implicit,ke=z.first,Le=i.oxw(3);i.xp6(1),i.Q6J("ngIf",ke||L.isNextDate),i.xp6(1),i.Q6J("workPackage",Le.workPackage)("activity",L.activity)("activityNo",L.number(L.isReversed))("hasUnreadNotification",i.lcZ(3,6,Le.hasUnreadNotification(L.href)))("isInitial",L.isInitial())}}function Yn(ae,z){if(1&ae&&(i.TgZ(0,"div",2),i.TgZ(1,"div",3),i.YNc(2,Jn,4,8,"div",4),i.qZA(),i.qZA()),2&ae){const L=i.oxw(2);i.xp6(2),i.Q6J("ngForOf",L.visibleActivities)("ngForTrackBy",L.trackByIdentifier)}}function $n(ae,z){if(1&ae&&(i.TgZ(0,"work-package-comment",1),i.YNc(1,Yn,3,2,"ng-template"),i.qZA()),2&ae){const L=i.oxw();i.Q6J("workPackage",L.workPackage)}}class fi extends tt{constructor(){super(...arguments),this.tabName=this.I18n.t("js.work_packages.tabs.activity"),this.trackByIdentifier=(0,ut.AT)("identifier")}ngOnInit(){const{workPackageId:z}=this.uiRouterGlobals.params;this.workPackageId=z,super.ngOnInit()}}fi.\u0275fac=function(){let ae;return function(L){return(ae||(ae=i.n5z(fi)))(L||fi)}}(),fi.\u0275cmp=i.Xpm({type:fi,selectors:[["wp-activity-tab"]],features:[i.qOj],decls:1,vars:1,consts:[[3,"workPackage",4,"ngIf"],[3,"workPackage"],[1,"detail-activity"],[1,"work-package-details-activities-list"],["class","work-package-details-activities-activity",4,"ngFor","ngForOf","ngForTrackBy"],[1,"work-package-details-activities-activity"],["class","activity-date",3,"ngClass",4,"ngIf"],[3,"workPackage","activity","activityNo","hasUnreadNotification","isInitial"],[1,"activity-date",3,"ngClass"],[1,"activity-date--label",3,"textContent"],["type","button","class","activity-comments--toggler button -small -transparent -with-icon icon-filter icon-small hide-when-print",3,"textContent","click",4,"ngIf"],["type","button",1,"activity-comments--toggler","button","-small","-transparent","-with-icon","icon-filter","icon-small","hide-when-print",3,"textContent","click"]],template:function(z,L){1&z&&i.YNc(0,$n,2,1,"work-package-comment",0),2&z&&i.Q6J("ngIf",L.workPackage)},directives:[l.O5,Ce,l.sg,pi,l.mk],pipes:[l.Ov],encapsulation:2,changeDetection:0});var li=t(18236),pn=t(61486),Si=t(18293),vi=t(53448),ui=t(96905),$i=t(4018),$t=t(44040),Vn=t(74603),Ai=t(14274),qi=t(76491),Hn=t(659),xi=t(92144);const Tn="urn:openproject-org:api:v3:storages:Nextcloud",kn="urn:openproject-org:api:v3:storages:authorization:Connected";var un=t(84699);class Mi{constructor(z,L){this.label=z,this.action=L}}class hi{constructor(z,L,ke,Le){this.iconClass=z,this.header=L,this.content=ke,this.buttons=Le}}var hn=t(77355),Li=t(60312),Xi=t(82187);class _n{constructor(z){this.crumbs=z}}var En=t(6536);function Ri(ae){return"application/x-op-directory"===ae}class Kn{constructor(z,L,ke,Le,gt,jt,bt){this.timezoneService=z,this.storageFile=L,this.disabled=ke,this.isFirst=Le,this.selected=gt,this.changeSelection=jt,this.enterDirectory=bt}get name(){return this.storageFile.name}get mimeType(){return this.storageFile.mimeType}get createdByName(){return this.storageFile.createdByName}get timestamp(){return this.storageFile.lastModifiedAt?this.timezoneService.parseDatetime(this.storageFile.lastModifiedAt).fromNow():void 0}get icon(){return(0,En.g)(this.storageFile.mimeType)}get isDirectory(){return Ri(this.storageFile.mimeType)}}const en={[Tn]:"nextcloud-circle",default:"ticket"};function tn(ae,z){if(1&ae&&i._UZ(0,"span"),2&ae){const L=i.oxw(2).$implicit;i.Gre("spot-icon spot-icon_",L.icon,"")}}const On=function(ae,z,L){return{"spot-breadcrumbs--crumb_root":ae,"spot-breadcrumbs--crumb_parent":z,"spot-breadcrumbs--crumb_grandparent":L}};function Mn(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"div",4),i.TgZ(1,"button",5),i.NdJ("click",function(){return i.CHM(L),i.oxw().$implicit.navigate()}),i.YNc(2,tn,1,3,"span",6),i._UZ(3,"span",7),i._UZ(4,"span",8),i.qZA(),i._UZ(5,"span",9),i.qZA()}if(2&ae){const L=i.oxw(),ke=L.first,Le=L.index,gt=L.$implicit,jt=i.oxw();i.Q6J("ngClass",i.kEZ(4,On,ke,Le===jt.content.crumbs.length-2,Le===jt.content.crumbs.length-3)),i.xp6(1),i.Q6J("title",gt.text),i.xp6(1),i.Q6J("ngIf",gt.icon),i.xp6(1),i.Q6J("textContent",gt.text)}}function Ti(ae,z){1&ae&&(i.TgZ(0,"div",10),i._UZ(1,"span",9),i.qZA())}function We(ae,z){if(1&ae&&i._UZ(0,"span"),2&ae){const L=i.oxw(2).$implicit;i.Gre("spot-icon spot-icon_",L.icon,"")}}function W(ae,z){if(1&ae&&(i.TgZ(0,"div",11),i.YNc(1,We,1,3,"span",6),i._UZ(2,"span",12),i.qZA()),2&ae){const L=i.oxw().$implicit;i.xp6(1),i.Q6J("ngIf",L.icon),i.xp6(1),i.Q6J("textContent",L.text)}}function q(ae,z){if(1&ae&&(i.ynx(0),i.YNc(1,Mn,6,8,"div",1),i.YNc(2,Ti,2,0,"div",2),i.YNc(3,W,3,2,"div",3),i.BQk()),2&ae){const L=z.index,ke=z.last,Le=z.first,gt=i.oxw();i.xp6(1),i.Q6J("ngIf",Le&&!ke||L===gt.content.crumbs.length-2||L===gt.content.crumbs.length-3),i.xp6(1),i.Q6J("ngIf",1===L&&gt.content.crumbs.length>4),i.xp6(1),i.Q6J("ngIf",ke)}}class le{constructor(){this.className=!0}}le.\u0275fac=function(z){return new(z||le)},le.\u0275cmp=i.Xpm({type:le,selectors:[["spot-breadcrumbs"]],hostVars:2,hostBindings:function(z,L){2&z&&i.ekj("spot-breadcrumbs",L.className)},inputs:{content:"content"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["class","spot-breadcrumbs--crumb","data-qa-selector","op-breadcrumb",3,"ngClass",4,"ngIf"],["class","spot-breadcrumbs--crumb spot-breadcrumbs--crumb_collapsed",4,"ngIf"],["class","spot-breadcrumbs--crumb spot-breadcrumbs--crumb_last","data-qa-selector","op-breadcrumb",4,"ngIf"],["data-qa-selector","op-breadcrumb",1,"spot-breadcrumbs--crumb",3,"ngClass"],["type","button",1,"spot-link","spot-breadcrumbs--crumb-action-item",3,"title","click"],[3,"class",4,"ngIf"],[1,"spot-breadcrumbs--crumb-action-item-text",3,"textContent"],[1,"spot-breadcrumbs--crumb-action-item-dots"],[1,"spot-breadcrumbs--crumb-divider","spot-icon","spot-icon_arrow-right5"],[1,"spot-breadcrumbs--crumb","spot-breadcrumbs--crumb_collapsed"],["data-qa-selector","op-breadcrumb",1,"spot-breadcrumbs--crumb","spot-breadcrumbs--crumb_last"],[1,"spot-breadcrumbs--crumb-action-item",3,"textContent"]],template:function(z,L){1&z&&i.YNc(0,q,4,3,"ng-container",0),2&z&&i.Q6J("ngForOf",L.content.crumbs)},directives:[l.sg,l.O5,l.mk],encapsulation:2,changeDetection:0});var be=t(1706),Re=t(48705),Be=t(1476);function He(ae,z){if(1&ae&&i._UZ(0,"span",9),2&ae){const L=i.oxw();i.Q6J("textContent",L.content.timestamp)}}function _t(ae,z){if(1&ae&&i._UZ(0,"op-principal",10),2&ae){const L=i.oxw();i.Q6J("principal",L.principal)("hideName",!0)("size","mini")("link",!1)}}function qe(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",11),i.NdJ("click",function(){return i.CHM(L),i.oxw().content.enterDirectory()}),i._UZ(1,"span",12),i.qZA()}}const pt=function(ae){return{"spot-list--item-action_disabled":ae}};class Bt{constructor(z){this.i18n=z,this.text={alreadyLinkedFile:this.i18n.t("js.storages.file_links.already_linked_file"),alreadyLinkedDirectory:this.i18n.t("js.storages.file_links.already_linked_directory")}}get principal(){return this.content.createdByName?{name:this.content.createdByName,href:"/external_users/1"}:{name:"Not Available",href:"/placeholder_users/1"}}get tooltip(){return this.content.isDirectory?this.text.alreadyLinkedDirectory:this.text.alreadyLinkedFile}get getTooltipAlignment(){return this.content.isFirst?be.Z.BottomLeft:be.Z.TopLeft}}Bt.\u0275fac=function(z){return new(z||Bt)(i.Y36(p.D))},Bt.\u0275cmp=i.Xpm({type:Bt,selectors:[["","op-storage-file-list-item",""]],inputs:{content:"content"},attrs:["op-storage-file-list-item",""],decls:11,vars:17,consts:[[3,"alignment","disabled"],["slot","body",1,"spot-body-small"],["slot","trigger","data-qa-selector","op-files-picker-modal--list-item",1,"spot-list--item-action",3,"ngClass"],[3,"checked","disabled","checkedChange"],[1,"spot-list--item-title","op-file-list--item-title",3,"title"],[3,"textContent"],["class","op-file-list--item-text",3,"textContent",4,"ngIf"],["class","op-file-list--item-avatar",3,"principal","hideName","size","link",4,"ngIf"],["class","spot-link op-file-list--item-button","data-qa-selector","op-files-picker-modal--list-item-caret",3,"click",4,"ngIf"],[1,"op-file-list--item-text",3,"textContent"],[1,"op-file-list--item-avatar",3,"principal","hideName","size","link"],["data-qa-selector","op-files-picker-modal--list-item-caret",1,"spot-link","op-file-list--item-button",3,"click"],[1,"spot-icon","spot-icon_arrow-right2"]],template:function(z,L){1&z&&(i.TgZ(0,"spot-tooltip",0),i.TgZ(1,"p",1),i._uU(2),i.qZA(),i.TgZ(3,"label",2),i.TgZ(4,"spot-checkbox",3),i.NdJ("checkedChange",function(){return L.content.changeSelection()}),i.qZA(),i.TgZ(5,"div",4),i._UZ(6,"span"),i._UZ(7,"span",5),i.qZA(),i.YNc(8,He,1,1,"span",6),i.YNc(9,_t,1,4,"op-principal",7),i.YNc(10,qe,2,0,"button",8),i.qZA(),i.qZA()),2&z&&(i.Q6J("alignment",L.getTooltipAlignment)("disabled",!L.content.disabled),i.xp6(2),i.Oqu(L.tooltip),i.xp6(1),i.Q6J("ngClass",i.VKq(15,pt,L.content.disabled)),i.xp6(1),i.Q6J("checked",L.content.disabled||L.content.selected)("disabled",L.content.disabled),i.xp6(1),i.Q6J("title",L.content.name),i.xp6(1),i.MT6("spot-icon spot-icon_",L.content.icon.icon," op-files-tab--icon op-files-tab--icon_",L.content.icon.clazz,""),i.xp6(1),i.Q6J("textContent",L.content.name),i.xp6(1),i.Q6J("ngIf",!L.content.isDirectory),i.xp6(1),i.Q6J("ngIf",!L.content.isDirectory),i.xp6(1),i.Q6J("ngIf",L.content.isDirectory))},directives:[Re.s,l.mk,Be.B,l.O5,kt.N],encapsulation:2,changeDetection:0});var Ft=t(70099);class Ct{}Ct.\u0275fac=function(z){return new(z||Ct)},Ct.\u0275cmp=i.Xpm({type:Ct,selectors:[["op-loading-file-list"]],decls:6,vars:0,consts:[["viewBox","0 0 960 186"],["x","0","y","4","width","100%","height","32","rx","1"],["x","0","y","40","width","100%","height","32","rx","1"],["x","0","y","76","width","100%","height","32","rx","1"],["x","0","y","112","width","100%","height","32","rx","1"],["x","0","y","148","width","100%","height","32","rx","1"]],template:function(z,L){1&z&&(i.TgZ(0,"op-content-loader",0),i.O4$(),i._UZ(1,"rect",1),i._UZ(2,"rect",2),i._UZ(3,"rect",3),i._UZ(4,"rect",4),i._UZ(5,"rect",5),i.qZA())},directives:[Ft.V],encapsulation:2,changeDetection:0});class xt{transform(z){return z.sort((L,ke)=>Ri(L.mimeType)&&Ri(ke.mimeType)?L.name.localeCompare(ke.name):Ri(L.mimeType)?-1:Ri(ke.mimeType)?1:L.name.localeCompare(ke.name))}}function oi(ae,z){if(1&ae&&i._UZ(0,"li",21),2&ae){const L=z.$implicit;i.Q6J("content",L)}}function nn(ae,z){if(1&ae&&(i.ynx(0),i.TgZ(1,"ul",19),i.YNc(2,oi,1,1,"li",20),i.ALo(3,"sortFiles"),i.ALo(4,"async"),i.qZA(),i.BQk()),2&ae){const L=i.oxw();i.xp6(2),i.Q6J("ngForOf",i.lcZ(3,1,i.lcZ(4,3,L.listItems$)))}}function Gn(ae,z){1&ae&&i._UZ(0,"op-loading-file-list",22)}xt.\u0275fac=function(z){return new(z||xt)},xt.\u0275pipe=i.Yjl({name:"sortFiles",type:xt,pure:!0});const Fi=function(ae){return{"-highlight":ae}};class ge extends Li.T{constructor(z,L,ke,Le,gt,jt,bt){super(z,ke,L),this.locals=z,this.elementRef=L,this.cdRef=ke,this.i18n=Le,this.timezoneService=gt,this.fileLinksResourceService=jt,this.storageFilesResourceService=bt,this.loading$=new qi.X(!0),this.text={header:this.i18n.t("js.storages.file_links.select"),buttons:{openStorage:()=>this.i18n.t("js.storages.open_storage",{storageType:this.locals.storageTypeName}),submit:()=>this.i18n.t("js.storages.file_links.selection_any",{number:this.selectedFileCount}),submitEmptySelection:this.i18n.t("js.storages.file_links.selection_none"),cancel:this.i18n.t("js.button_cancel"),selectAll:this.i18n.t("js.storages.file_links.select_all")}},this.selection=new Set,this.fileMap={},this.storageFiles$=new qi.X([])}get selectedFileCount(){return this.selection.size}get storageLink(){return this.locals.storageLink}ngOnInit(){var ae;super.ngOnInit(),this.breadcrumbs=new _n([{text:this.locals.storageName,icon:(ae=this.locals.storageType,ae&&en[ae]?en[ae]:en.default),navigate:()=>this.changeLevel(null,this.breadcrumbs.crumbs.slice(0,1))}]),this.listItems$=this.storageFiles$.pipe((0,nt.U)(z=>z.map((L,ke)=>this.storageFileToListItem(L,ke)))),this.storageFilesResourceService.files(this.makeFilesCollectionLink(null)).pipe((0,a.q)(1)).subscribe(z=>{this.storageFiles$.next(z),this.loading$.next(!1)})}ngOnDestroy(){super.ngOnDestroy(),this.storageFilesResourceService.reset()}openStorageLocation(){window.open(this.locals.storageLocation,"_blank")}createSelectedFileLinks(){const z=Array.from(this.selection).map(L=>this.fileMap[L]);this.fileLinksResourceService.addFileLinks(this.locals.collectionKey,this.locals.addFileLinksHref,this.storageLink,z),this.service.close()}selectAllOfCurrentLevel(){this.storageFiles$.pipe((0,a.q)(1)).subscribe(z=>{z.forEach(L=>{const ke=L.id;!this.selection.has(ke)&&!this.isAlreadyLinked(L)&&(this.selection.add(ke),this.fileMap[ke]=L)}),this.storageFiles$.next(z)})}changeSelection(z){const L=z.id;this.selection.has(L)?this.selection.delete(L):(this.selection.add(L),this.fileMap[L]=z)}changeLevel(z,L){this.cancelCurrentLoading(),this.loading$.next(!0),this.breadcrumbs=new _n(L),this.loadingSubscription=this.storageFilesResourceService.files(this.makeFilesCollectionLink(z)).pipe((0,a.q)(1)).subscribe(ke=>{this.storageFiles$.next(ke),this.loading$.next(!1)})}cancelCurrentLoading(){this.loadingSubscription&&this.loadingSubscription.unsubscribe()}makeFilesCollectionLink(z){let L="";return null!==z&&(L=`?parent=${z}`),{href:`${this.storageLink.href}/files${L}`,title:"Storage files"}}storageFileToListItem(z,L){const ke=Ri(z.mimeType)?()=>{const Le=this.breadcrumbs.crumbs,gt=Le.length+1,jt={text:z.name,navigate:()=>this.changeLevel(z.location,this.breadcrumbs.crumbs.slice(0,gt))};this.changeLevel(z.location,Le.concat(jt))}:void 0;return new Kn(this.timezoneService,z,this.isAlreadyLinked(z),0===L,this.selection.has(z.id),()=>{this.changeSelection(z)},ke)}isAlreadyLinked(z){return!!this.locals.fileLinks.find(Le=>Le.originData.id===z.id)}}ge.\u0275fac=function(z){return new(z||ge)(i.Y36(hn.E),i.Y36(i.SBq),i.Y36(i.sBO),i.Y36(p.D),i.Y36(Q.B),i.Y36(xi.s),i.Y36(Xi.X))},ge.\u0275cmp=i.Xpm({type:ge,selectors:[["ng-component"]],features:[i.qOj],decls:26,vars:14,consts:[["data-qa-selector","op-files-picker-modal",1,"spot-modal","spot-modal_wide"],[1,"spot-modal--header"],[1,"spot-modal--header-title"],["type","button",1,"button","button_no-margin",3,"click"],[1,"spot-icon","spot-icon_external-link"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[3,"content"],[4,"ngIf","ngIfElse"],["loadingTemplate",""],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["type","button","data-qa-selector","op-files-picker-modal--select-all",1,"spot-link","spot-action-bar--action",3,"click"],[1,"spot-icon","spot-icon_select-all"],[3,"textContent"],[1,"spot-action-bar--right"],["type","button",1,"button","spot-action-bar--action",3,"textContent","click"],["type","button","data-qa-selector","op-files-picker-modal--confirm",1,"button","spot-action-bar--action",3,"ngClass","disabled","click"],[1,"spot-icon","spot-icon_add-link"],["data-qa-selector","op-files-picker-modal--file-list",1,"spot-list","spot-list_compact","op-file-list"],["class","spot-list--item op-file-list--item","data-qa-selector","op-file-list--item","op-storage-file-list-item","",3,"content",4,"ngFor","ngForOf"],["data-qa-selector","op-file-list--item","op-storage-file-list-item","",1,"spot-list--item","op-file-list--item",3,"content"],[1,"spot-list"]],template:function(z,L){if(1&z&&(i.TgZ(0,"div",0),i.TgZ(1,"div",1),i.TgZ(2,"span",2),i._uU(3),i.qZA(),i.TgZ(4,"button",3),i.NdJ("click",function(){return L.openStorageLocation()}),i.TgZ(5,"span"),i._uU(6),i.qZA(),i._UZ(7,"span",4),i.qZA(),i.qZA(),i._UZ(8,"div",5),i.TgZ(9,"div",6),i._UZ(10,"spot-breadcrumbs",7),i.YNc(11,nn,5,5,"ng-container",8),i.ALo(12,"async"),i.YNc(13,Gn,1,0,"ng-template",null,9,i.W1O),i.qZA(),i.TgZ(15,"div",10),i.TgZ(16,"div",11),i.TgZ(17,"button",12),i.NdJ("click",function(){return L.selectAllOfCurrentLevel()}),i._UZ(18,"span",13),i._UZ(19,"span",14),i.qZA(),i.qZA(),i.TgZ(20,"div",15),i.TgZ(21,"button",16),i.NdJ("click",function(){return L.closeMe()}),i.qZA(),i.TgZ(22,"button",17),i.NdJ("click",function(){return L.createSelectedFileLinks()}),i._UZ(23,"span",18),i.TgZ(24,"span"),i._uU(25),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.qZA()),2&z){const ke=i.MAs(14);i.xp6(3),i.Oqu(L.text.header),i.xp6(3),i.Oqu(L.text.buttons.openStorage()),i.xp6(4),i.Q6J("content",L.breadcrumbs),i.xp6(1),i.Q6J("ngIf",!1===i.lcZ(12,10,L.loading$))("ngIfElse",ke),i.xp6(8),i.Q6J("textContent",L.text.buttons.selectAll),i.xp6(2),i.Q6J("textContent",L.text.buttons.cancel),i.xp6(1),i.Q6J("ngClass",i.VKq(12,Fi,L.selectedFileCount>0))("disabled",0===L.selectedFileCount),i.xp6(3),i.Oqu(L.selectedFileCount>0?L.text.buttons.submit():L.text.buttons.submitEmptySelection)}},directives:[le,l.O5,l.mk,l.sg,Bt,Ct],pipes:[l.Ov,xt],encapsulation:2,changeDetection:0});var U=t(25502);function A(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",6),i.NdJ("click",function(){return i.CHM(L).$implicit.action()}),i.TgZ(1,"op-icon",7),i._UZ(2,"i",8),i.qZA(),i.TgZ(3,"span",9),i._uU(4),i.qZA(),i.qZA()}if(2&ae){const L=z.$implicit;i.xp6(4),i.Oqu(L.label)}}class _e{}_e.\u0275fac=function(z){return new(z||_e)},_e.\u0275cmp=i.Xpm({type:_e,selectors:[["op-storage-information"]],inputs:{viewModel:"viewModel"},decls:8,vars:6,consts:[[1,"text-box"],[1,"text-box-header"],[3,"textContent"],[1,"text-box-content"],[1,"button-box"],["class","button op-files-tab--storage-info-box-button",3,"click",4,"ngFor","ngForOf"],[1,"button","op-files-tab--storage-info-box-button",3,"click"],["icon-classes","button--icon spot-icon spot-icon_external-link",1,"op-icon--wrapper"],[1,"button--icon","spot-icon","spot-icon_external-link"],[1,"button--text"]],template:function(z,L){1&z&&(i._UZ(0,"span"),i.TgZ(1,"div",0),i.TgZ(2,"div",1),i._UZ(3,"span",2),i.qZA(),i.TgZ(4,"div",3),i._UZ(5,"span",2),i.qZA(),i.qZA(),i.TgZ(6,"div",4),i.YNc(7,A,5,1,"button",5),i.qZA()),2&z&&(i.Gre("spot-icon spot-icon_",L.viewModel.iconClass," op-files-tab--storage-info-box-icon"),i.xp6(3),i.Q6J("textContent",L.viewModel.header),i.xp6(2),i.Q6J("textContent",L.viewModel.content),i.xp6(2),i.Q6J("ngForOf",L.viewModel.buttons))},directives:[l.sg,I.o],encapsulation:2,changeDetection:0});var we=t(32782),Je=t(84335);const rt=["avatar"];function Et(ae,z){if(1&ae&&(i.TgZ(0,"a",16),i._UZ(1,"span",17),i.qZA()),2&ae){const L=i.oxw(2);i.Q6J("title",L.text.title.downloadFileLink)("href",L.fileLink._links.staticOriginDownload.href,i.LSH)}}function di(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",18),i.NdJ("click",function(){return i.CHM(L),i.oxw(2).confirmRemoveFileLink()}),i._UZ(1,"span",19),i.qZA()}if(2&ae){const L=i.oxw(2);i.Q6J("title",L.text.title.removeFileLink)}}function Ei(ae,z){if(1&ae&&(i.TgZ(0,"div",11),i.YNc(1,Et,2,2,"a",12),i.TgZ(2,"a",13),i._UZ(3,"span",14),i.qZA(),i.YNc(4,di,2,1,"button",15),i.qZA()),2&ae){const L=i.oxw();i.xp6(1),i.Q6J("ngIf",L.downloadAllowed),i.xp6(1),i.Q6J("title",L.text.title.openFileLocation)("href",L.fileLink._links.staticOriginOpenLocation.href,i.LSH),i.xp6(2),i.Q6J("ngIf",L.allowEditing)}}function Ui(ae,z){if(1&ae&&(i.TgZ(0,"div",20),i._UZ(1,"span",21),i._UZ(2,"span",5),i.qZA()),2&ae){const L=i.oxw();i.xp6(2),i.Q6J("textContent",L.text.floatingText.noViewPermission)}}const Hi=function(ae){return{"spot-list--item-floating-wrapper_disabled op-file-list--item-floating-wrapper__disabled":ae}},xr=function(ae,z){return{"spot-list--item-action_disabled":ae,"op-file-list--item-action_view-not-allowed":z}};class qn{constructor(z,L,ke,Le){this.i18n=z,this.timezoneService=L,this.confirmDialogService=ke,this.principalRendererService=Le,this.allowEditing=!1,this.disabled=!0,this.removeFileLink=new i.vpe,this.tooltipAllignment=be.Z.TopLeft,this.text={title:{openFile:this.i18n.t("js.storages.file_links.open"),openFileLocation:this.i18n.t("js.storages.file_links.open_location"),removeFileLink:this.i18n.t("js.storages.file_links.remove"),downloadFileLink:""},floatingText:{noViewPermission:this.i18n.t("js.storages.file_links.no_permission")},removalTitle:this.i18n.t("js.storages.file_links.remove"),removalButtonLabel:this.i18n.t("js.storages.file_links.remove_short"),removalConfirmation:this.i18n.t("js.storages.file_links.remove_confirmation"),notAllowdTooltipText:this.i18n.t("js.storages.file_links.not_allowed_tooltip")}}get originData(){return this.fileLink.originData}ngOnInit(){this.originData.lastModifiedAt&&(this.infoTimestampText=this.timezoneService.parseDatetime(this.originData.lastModifiedAt).fromNow()),this.fileLinkIcon=(0,En.g)(this.originData.mimeType),this.downloadAllowed=!Ri(this.originData.mimeType),this.text.title.downloadFileLink=this.i18n.t("js.storages.file_links.download",{fileName:this.fileLink.originData.name}),this.viewAllowed=!this.fileLink._links.permission||"urn:openproject-org:api:v3:file-links:permission:View"===this.fileLink._links.permission.href}ngAfterViewInit(){this.originData.lastModifiedByName?this.principalRendererService.render(this.avatar.nativeElement,{name:this.originData.lastModifiedByName,href:"/external_users/1"},{hide:!0,link:!1},{hide:!1,size:"mini"}):this.principalRendererService.render(this.avatar.nativeElement,{name:"Not Available",href:"/placeholder_users/1"},{hide:!0,link:!1},{hide:!1,size:"mini"})}confirmRemoveFileLink(){const z={text:{text:this.text.removalConfirmation,title:this.text.removalTitle,button_continue:this.text.removalButtonLabel},icon:{continue:"remove-link"}};this.confirmDialogService.confirm(z).then(()=>{this.removeFileLink.emit()}).catch(()=>{})}}function Er(ae,z){if(1&ae&&i._UZ(0,"op-storage-information",5),2&ae){const L=z.$implicit;i.Q6J("viewModel",L)}}function as(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"li",6),i.NdJ("removeFileLink",function(){const gt=i.CHM(L).$implicit;return i.oxw(2).removeFileLink(gt)}),i.ALo(1,"async"),i.qZA()}if(2&ae){const L=z.$implicit,ke=i.oxw(2);i.Q6J("fileLink",L)("disabled",ke.disabled)("allowEditing",i.lcZ(1,3,ke.allowEditing$))}}function In(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"button",12),i.NdJ("click",function(){return i.CHM(L),i.oxw(3).openLinkFilesDialog()}),i._UZ(1,"span",13),i._UZ(2,"span",10),i.qZA()}if(2&ae){const L=i.oxw(3);i.xp6(2),i.Q6J("textContent",L.text.actions.linkExisting)}}function Or(ae,z){if(1&ae){const L=i.EpF();i.TgZ(0,"p",7),i.TgZ(1,"button",8),i.NdJ("click",function(){return i.CHM(L),i.oxw(2).openStorageLocation()}),i._UZ(2,"span",9),i._UZ(3,"span",10),i.qZA(),i.YNc(4,In,3,1,"button",11),i.qZA()}if(2&ae){const L=i.oxw(2);i.xp6(3),i.Q6J("textContent",L.text.actions.linkFile(L.storageType)),i.xp6(1),i.Q6J("ngIf",L.storageFileLinkingEnabled)}}function Mr(ae,z){if(1&ae&&(i.ynx(0),i.YNc(1,Er,1,1,"op-storage-information",1),i.ALo(2,"async"),i.TgZ(3,"ul",2),i.YNc(4,as,2,5,"li",3),i.ALo(5,"async"),i.qZA(),i.YNc(6,Or,5,2,"p",4),i.ALo(7,"async"),i.ALo(8,"async"),i.BQk()),2&ae){const L=i.oxw();i.xp6(1),i.Q6J("ngForOf",i.lcZ(2,3,L.storageInformation)),i.xp6(3),i.Q6J("ngForOf",i.lcZ(5,5,L.fileLinks$)),i.xp6(2),i.Q6J("ngIf",i.lcZ(7,7,L.showLinkFilesAction)&&i.lcZ(8,9,L.allowEditing$))}}qn.\u0275fac=function(z){return new(z||qn)(i.Y36(p.D),i.Y36(Q.B),i.Y36(Je.D),i.Y36(we.C))},qn.\u0275cmp=i.Xpm({type:qn,selectors:[["","op-file-link-list-item",""]],viewQuery:function(z,L){if(1&z&&i.Gf(rt,5),2&z){let ke;i.iGM(ke=i.CRH())&&(L.avatar=ke.first)}},inputs:{fileLink:"fileLink",allowEditing:"allowEditing",disabled:"disabled"},outputs:{removeFileLink:"removeFileLink"},attrs:["op-file-link-list-item",""],decls:13,vars:21,consts:[[1,"spot-list--item-floating-wrapper","op-file-list--item-floating-wrapper",3,"disabled","alignment","ngClass"],["slot","body",1,"spot-body-small"],["slot","trigger"],["target","_blank",1,"spot-list--item-action","spot-list--item-action_link","op-file-list--item-action",3,"ngClass","href","title"],[1,"spot-list--item-title","op-file-list--item-title",3,"title"],[3,"textContent"],[1,"op-file-list--item-text",3,"textContent"],[1,"op-file-list--item-avatar"],["avatar",""],["class","spot-list--item-floating-actions op-file-list--item-floating-actions hidden-for-mobile",4,"ngIf"],["class","spot-list--item-floating-actions op-file-list--item-floating-text hidden-for-mobile",4,"ngIf"],[1,"spot-list--item-floating-actions","op-file-list--item-floating-actions","hidden-for-mobile"],["class","spot-link",3,"title","href",4,"ngIf"],["target","_blank",1,"spot-link",3,"title","href"],[1,"spot-icon","spot-icon_folder-open"],["class","spot-link",3,"title","click",4,"ngIf"],[1,"spot-link",3,"title","href"],[1,"spot-icon","spot-icon_download-arrow"],[1,"spot-link",3,"title","click"],[1,"spot-icon","spot-icon_remove-link"],[1,"spot-list--item-floating-actions","op-file-list--item-floating-text","hidden-for-mobile"],[1,"spot-icon","spot-icon_info2","op-files-tab--icon","op-file-list--item-floating-text-icon"]],template:function(z,L){1&z&&(i.TgZ(0,"spot-tooltip",0),i.TgZ(1,"p",1),i._uU(2),i.qZA(),i.ynx(3,2),i.TgZ(4,"a",3),i.TgZ(5,"div",4),i._UZ(6,"span"),i._UZ(7,"span",5),i.qZA(),i._UZ(8,"span",6),i._UZ(9,"div",7,8),i.qZA(),i.YNc(11,Ei,5,4,"div",9),i.YNc(12,Ui,3,1,"div",10),i.BQk(),i.qZA()),2&z&&(i.Q6J("disabled",!L.disabled)("alignment",L.tooltipAllignment)("ngClass",i.VKq(16,Hi,L.disabled)),i.xp6(2),i.Oqu(L.text.notAllowdTooltipText),i.xp6(2),i.Q6J("ngClass",i.WLB(18,xr,L.disabled,!L.viewAllowed))("href",L.fileLink._links.staticOriginOpen.href,i.LSH)("title",L.fileLink.originData.name),i.xp6(1),i.Q6J("title",L.fileLink.originData.name),i.xp6(1),i.MT6("spot-icon spot-icon_",L.fileLinkIcon.icon," op-files-tab--icon op-files-tab--icon_",L.fileLinkIcon.clazz,""),i.xp6(1),i.Q6J("textContent",L.fileLink.originData.name),i.xp6(1),i.Q6J("textContent",L.infoTimestampText),i.xp6(3),i.Q6J("ngIf",!L.disabled&&L.viewAllowed),i.xp6(1),i.Q6J("ngIf",!L.disabled&&!L.viewAllowed))},directives:[Re.s,l.mk,l.O5],encapsulation:2,changeDetection:0});class mn extends h.N{constructor(z,L,ke,Le,gt,jt){super(),this.i18n=z,this.cookieService=L,this.opModalService=ke,this.currentUserService=Le,this.configurationService=gt,this.fileLinkResourceService=jt,this.disabled=!1,this.storageInformation=new qi.X([]),this.showLinkFilesAction=new qi.X(!1),this.isLoggedIn=!1,this.storageTypeMap={},this.text={infoBox:{emptyStorageHeader:bt=>this.i18n.t("js.storages.link_files_in_storage",{storageType:bt}),emptyStorageContent:bt=>this.i18n.t("js.storages.information.no_file_links",{storageType:bt}),emptyStorageButton:bt=>this.i18n.t("js.storages.open_storage",{storageType:bt}),fileLinkErrorHeader:this.i18n.t("js.storages.information.live_data_error"),fileLinkErrorContent:bt=>this.i18n.t("js.storages.information.live_data_error_description",{storageType:bt}),connectionErrorHeader:bt=>this.i18n.t("js.storages.no_connection",{storageType:bt}),connectionErrorContent:bt=>this.i18n.t("js.storages.information.connection_error",{storageType:bt}),authorizationFailureHeader:bt=>this.i18n.t("js.storages.login_to",{storageType:bt}),authorizationFailureContent:bt=>this.i18n.t("js.storages.information.not_logged_in",{storageType:bt}),loginButton:bt=>this.i18n.t("js.storages.login",{storageType:bt})},actions:{linkFile:bt=>this.i18n.t("js.storages.link_files_in_storage",{storageType:bt}),linkExisting:this.i18n.t("js.storages.link_existing_files")}}}get storageFileLinkingEnabled(){return this.configurationService.activeFeatureFlags.includes("storageFileLinking")}get storageFilesLocation(){return this.storage._links.open.href}ngOnInit(){this.initializeStorageTypes(),this.storageType=this.storageTypeMap[this.storage._links.type.href],this.disabled=this.storage._links.authorizationState.href!==kn,this.fileLinks$=this.fileLinkResourceService.collection(this.collectionKey),this.currentUserService.isLoggedIn$.pipe(this.untilDestroyed()).subscribe(z=>{this.isLoggedIn=z}),this.fileLinks$.pipe(this.untilDestroyed()).subscribe(z=>{(0,un.Z)(this.resource)&&(this.resource.fileLinks={elements:z.map(L=>{var ke;return null===(ke=L._links)||void 0===ke?void 0:ke.self})}),this.storageInformation.next(this.instantiateStorageInformation(z)),this.showLinkFilesAction.next(!this.disabled&&z.length>0)}),this.allowEditing$=this.currentUserService.hasCapabilities$("file_links/manage",this.resource.project.id)}removeFileLink(z){this.fileLinkResourceService.remove(this.collectionKey,z)}openStorageLocation(){window.open(this.storageFilesLocation,"_blank")}openLinkFilesDialog(){this.fileLinks$.pipe((0,a.q)(1)).subscribe(z=>{const L={storageType:this.storage._links.type.href,storageTypeName:this.storageType,storageName:this.storage.name,storageLocation:this.storageFilesLocation,storageLink:this.storage._links.self,addFileLinksHref:this.resource.$links.addFileLink.href,collectionKey:this.collectionKey,fileLinks:z};this.opModalService.show(ge,"global",L)})}instantiateStorageInformation(z){if(!this.isLoggedIn)return[];switch(this.storage._links.authorizationState.href){case"urn:openproject-org:api:v3:storages:authorization:FailedAuthorization":return[this.failedAuthorizationInformation];case"urn:openproject-org:api:v3:storages:authorization:Error":return[this.authorizationErrorInformation];case kn:return 0===z.length?[this.emptyStorageInformation]:z.filter(L=>{var ke;return"urn:openproject-org:api:v3:file-links:permission:Error"===(null===(ke=L._links.permission)||void 0===ke?void 0:ke.href)}).length>0?(this.disabled=!0,[this.fileLinkErrorInformation]):[];default:return[]}}get failedAuthorizationInformation(){return new hi("import",this.text.infoBox.authorizationFailureHeader(this.storageType),this.text.infoBox.authorizationFailureContent(this.storageType),[new Mi(this.text.infoBox.loginButton(this.storageType),()=>{if(!this.storage._links.authorize)throw new Error("Authorize link is missing!");{const z=(0,Hn.Z)();this.setAuthorizationCallbackCookie(z),window.location.href=mn.authorizationFailureActionUrl(this.storage._links.authorize.href,z)}})])}get authorizationErrorInformation(){return new hi("remove-link",this.text.infoBox.connectionErrorHeader(this.storageType),this.text.infoBox.connectionErrorContent(this.storageType),[])}get emptyStorageInformation(){return new hi("add-link",this.text.infoBox.emptyStorageHeader(this.storageType),this.text.infoBox.emptyStorageContent(this.storageType),[new Mi(this.text.infoBox.emptyStorageButton(this.storageType),()=>{window.open(this.storageFilesLocation,"_blank")})])}get fileLinkErrorInformation(){return new hi("error",this.text.infoBox.fileLinkErrorHeader,this.text.infoBox.fileLinkErrorContent(this.storageType),[])}get collectionKey(){return(0,un.Z)(this.resource)?"new":this.fileLinkSelfLink}get fileLinkSelfLink(){return`${this.resource.fileLinks.href}?filters=[{"storage":{"operator":"=","values":["${this.storage.id}"]}}]`}setAuthorizationCallbackCookie(z){this.cookieService.set(`oauth_state_${z}`,window.location.href,{path:"/"})}static authorizationFailureActionUrl(z,L){return`${z}&state=${L}`}initializeStorageTypes(){this.storageTypeMap[Tn]=this.i18n.t("js.storages.types.nextcloud")}}function Dn(ae,z){if(1&ae&&(i.TgZ(0,"div",5),i._UZ(1,"span",6),i._UZ(2,"span",7),i.qZA()),2&ae){const L=i.oxw();i.xp6(2),i.Q6J("textContent",L.text.attachments.label)}}function Ir(ae,z){if(1&ae&&(i.TgZ(0,"section",8),i.TgZ(1,"div",5),i._UZ(2,"span",9),i._UZ(3,"span",7),i.qZA(),i._UZ(4,"op-file-link-list",10),i.qZA()),2&ae){const L=z.$implicit,ke=i.oxw();i.xp6(3),i.Q6J("textContent",L.name),i.xp6(1),i.Q6J("resource",ke.workPackage)("storage",L)}}mn.\u0275fac=function(z){return new(z||mn)(i.Y36(p.D),i.Y36(U.N),i.Y36(hn.S),i.Y36(ui.S),i.Y36(Nt.e),i.Y36(xi.s))},mn.\u0275cmp=i.Xpm({type:mn,selectors:[["op-file-link-list"]],inputs:{resource:"resource",storage:"storage"},features:[i.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","op-files-tab--storage-info-box","data-qa-selector","op-files-tab--storage-information",3,"viewModel",4,"ngFor","ngForOf"],["data-qa-selector","file-list",1,"spot-list","spot-list_compact","op-file-list"],["class","spot-list--item op-file-list--item","data-qa-selector","file-list--item","op-file-link-list-item","",3,"fileLink","disabled","allowEditing","removeFileLink",4,"ngFor","ngForOf"],["class","spot-body-small op-file-list--actions",4,"ngIf"],["data-qa-selector","op-files-tab--storage-information",1,"op-files-tab--storage-info-box",3,"viewModel"],["data-qa-selector","file-list--item","op-file-link-list-item","",1,"spot-list--item","op-file-list--item",3,"fileLink","disabled","allowEditing","removeFileLink"],[1,"spot-body-small","op-file-list--actions"],["type","button",1,"spot-link","op-file-list--action-button",3,"click"],[1,"spot-icon","spot-icon_external-link"],[3,"textContent"],["type","button","class","spot-link op-file-list--action-button","data-qa-selector","op-file-list--link-existing-file-button",3,"click",4,"ngIf"],["type","button","data-qa-selector","op-file-list--link-existing-file-button",1,"spot-link","op-file-list--action-button",3,"click"],[1,"spot-icon","spot-icon_add-link"]],template:function(z,L){1&z&&i.YNc(0,Mr,9,11,"ng-container",0),2&z&&i.Q6J("ngIf",L.resource)},directives:[l.O5,l.sg,_e,qn],pipes:[l.Ov],encapsulation:2,changeDetection:0});const gn=function(ae){return{"op-tab-content--tab-section_no-header":ae}};class Oi{constructor(z,L,ke,Le,gt,jt,bt){this.i18n=z,this.hook=L,this.currentUserService=ke,this.projectsResourceService=Le,this.storagesResourceService=gt,this.apiV3=jt,this.toast=bt,this.text={attachments:{label:this.i18n.t("js.label_attachments")},file_links:{label:this.i18n.t("js.label_nextcloud")}}}ngOnInit(){const z=this.workPackage.project;if(null===z.id)return;const L=this.currentUserService.hasCapabilities$("file_links/view",z.id);this.storages$=this.storagesResourceService.collection(z.href).pipe((0,Si.K)(ke=>{throw this.toast.addError(ke),ke})),this.showAttachmentHeader$=(0,pn.aj)([this.storages$,L]).pipe((0,nt.U)(([ke,Le])=>ke.length>0&&Le))}}Oi.\u0275fac=function(z){return new(z||Oi)(i.Y36(p.D),i.Y36(vi.$),i.Y36(ui.S),i.Y36($t.D),i.Y36($i.l),i.Y36(c.T),i.Y36(wt.kl))},Oi.\u0275cmp=i.Xpm({type:Oi,selectors:[["op-files-tab"]],decls:9,vars:13,consts:[[1,"op-tab-content--container","op-files-tab"],["data-qa-selector","op-tab-content--tab-section",1,"op-tab-content--tab-section",3,"ngClass"],["class","op-tab-content--header",4,"ngIf"],[3,"resource"],["data-qa-selector","op-tab-content--tab-section","class","op-tab-content--tab-section",4,"ngFor","ngForOf"],[1,"op-tab-content--header"],[1,"spot-icon","spot-icon_attachment","op-files-tab--icon","op-files-tab--icon_clip"],[1,"op-tab-content--header-text",3,"textContent"],["data-qa-selector","op-tab-content--tab-section",1,"op-tab-content--tab-section"],[1,"spot-icon","spot-icon_nextcloud-circle","op-files-tab--icon","op-files-tab--icon_nextcloud"],[3,"resource","storage"]],template:function(z,L){1&z&&(i.TgZ(0,"div",0),i.TgZ(1,"section",1),i.ALo(2,"async"),i.YNc(3,Dn,3,1,"div",2),i.ALo(4,"async"),i._UZ(5,"op-attachment-list",3),i._UZ(6,"op-attachments-upload",3),i.qZA(),i.YNc(7,Ir,5,3,"section",4),i.ALo(8,"async"),i.qZA()),2&z&&(i.xp6(1),i.Q6J("ngClass",i.VKq(11,gn,!1===i.lcZ(2,5,L.showAttachmentHeader$))),i.xp6(2),i.Q6J("ngIf",i.lcZ(4,7,L.showAttachmentHeader$)),i.xp6(2),i.Q6J("resource",L.workPackage),i.xp6(1),i.Q6J("resource",L.workPackage),i.xp6(1),i.Q6J("ngForOf",i.lcZ(8,9,L.storages$)))},directives:[l.mk,l.O5,Vn.c,Ai.s,l.sg,mn],pipes:[l.Ov],encapsulation:2,changeDetection:0});var Dr=t(84939);function vr(ae,z){return z.get(Dr.W).requireAndStream(ae).pipe((0,nt.U)(ke=>ke.length))}function Vt(ae,z){const L=z.get(v.V),ke=z.get(c.T),Le=ae.id.toString();return L.require(Le),(0,pn.aj)([L.state(Le.toString()).values$(),ke.work_packages.id(Le).requireAndStream()]).pipe((0,nt.U)(([gt,jt])=>_.size(gt)+_.size(jt.children)))}function yr(ae,z){return z.get(Fe.O).nonDateAlertNotificationsCount$}var fn=t(88826);function Sr(ae,z){var L;const ke=z.get(fn.v),Le=z.get(xi.s);return(0,pn.aj)([ke.collection(ae.$links.attachments.href||""),Le.collection((null===(L=ae.$links.fileLinks)||void 0===L?void 0:L.href)||"")]).pipe((0,nt.U)(([gt,jt])=>gt.length+jt.length))}class Sn{constructor(z,L,ke){this.$state=z,this.I18n=L,this.injector=ke,this.registeredTabs=this.buildDefaultTabs()}get tabs(){return[...this.registeredTabs]}register(...z){this.registeredTabs=[...this.registeredTabs,...z]}patchTabCondition(z,L){const ke=this.registeredTabs.find(Le=>Le.id===z);ke&&(ke.displayable=L)}getDisplayableTabs(z){return this.tabs.filter(L=>!L.displayable||L.displayable(z,this.$state)).map(L=>Object.assign(Object.assign({},L),{counter:L.count?ke=>L.count(z,ke||this.injector):ke=>(0,n.D)([0])}))}getTab(z,L){return this.getDisplayableTabs(L).find(({id:ke})=>ke===z)}buildDefaultTabs(){return[{component:Ji,name:this.I18n.t("js.work_packages.tabs.overview"),id:"overview",displayable:(z,L)=>L.includes("**.details.*")},{id:"activity",component:fi,name:I18n.t("js.work_packages.tabs.activity"),count:yr,showCountAsBubble:!0},{id:"files",component:Oi,name:I18n.t("js.work_packages.tabs.files"),count:Sr},{id:"relations",component:De,name:I18n.t("js.work_packages.tabs.relations"),count:Vt},{id:"watchers",component:li.h,name:I18n.t("js.work_packages.tabs.watchers"),displayable:z=>!!z.watchers,count:vr}]}}Sn.\u0275fac=function(z){return new(z||Sn)(i.LFG(e.StateService),i.LFG(p.D),i.LFG(i.zs3))},Sn.\u0275prov=i.Yz7({token:Sn,factory:Sn.\u0275fac,providedIn:"root"})},92092:(te,M,t)=>{"use strict";t.d(M,{E:()=>l});t(24897);var e=t(2316),p=t(54364),h=t(54262);const c=function(){return{colorize:!1}};function i(r,d){if(1&r&&(e.TgZ(0,"div",1),e.TgZ(1,"div",2),e._UZ(2,"op-editable-attribute-field",3),e.qZA(),e.TgZ(3,"div",4),e._UZ(4,"op-editable-attribute-field",5),e.qZA(),e.qZA()),2&r){const f=e.oxw();e.xp6(2),e.Q6J("resource",f.workPackage)("displayFieldOptions",e.DdM(7,c))("wrapperClasses","wp-new-top-row--status -no-label")("fieldName","status"),e.xp6(2),e.Q6J("resource",f.workPackage)("wrapperClasses","wp-new-top-row--type -no-label")("fieldName","type")}}class l{}l.\u0275fac=function(d){return new(d||l)},l.\u0275cmp=e.Xpm({type:l,selectors:[["wp-type-status"]],inputs:{workPackage:"workPackage"},decls:1,vars:1,consts:[["class","wp-new-top-row",4,"ngIf"],[1,"wp-new-top-row"],[1,"work-packages--status-selector","wp-new-top-row--element"],[3,"resource","displayFieldOptions","wrapperClasses","fieldName"],[1,"work-packages--type-selector","wp-new-top-row--element"],[3,"resource","wrapperClasses","fieldName"]],template:function(d,f){1&d&&e.YNc(0,i,5,8,"div",0),2&d&&e.Q6J("ngIf",f.workPackage)},directives:[p.O5,h.k],encapsulation:2})},73905:(te,M,t)=>{"use strict";t.d(M,{u:()=>a});t(24897);var e=t(96617),p=t(84939),h=t(26942),c=t(33276),i=t(2316),l=t(54364),r=t(2775);function d(m,v){if(1&m&&i._UZ(0,"span",4),2&m){const C=i.oxw(2);i.Q6J("textContent",C.buttonText)}}function f(m,v){if(1&m){const C=i.EpF();i.TgZ(0,"button",1),i.NdJ("click",function(){return i.CHM(C),i.oxw().toggleWatch()}),i._UZ(1,"op-icon",2),i.YNc(2,d,1,1,"span",3),i.qZA()}if(2&m){const C=i.oxw();i.Q6J("disabled",C.disabled)("ngClass",C.buttonClass)("id",C.buttonId),i.uIk("title",C.buttonTitle),i.xp6(1),i.MGl("icon-classes","button--icon ",C.watchIconClass,""),i.xp6(1),i.Q6J("ngIf",C.showText)}}class a extends h.N{constructor(v,C,u,k){super(),this.I18n=v,this.wpWatchersService=C,this.apiV3Service=u,this.cdRef=k,this.showText=!1,this.disabled=!1}ngOnInit(){this.apiV3Service.work_packages.id(this.workPackage).requireAndStream().pipe(this.untilDestroyed()).subscribe(v=>{this.workPackage=v,this.setWatchStatus(),this.cdRef.detectChanges()})}get isWatched(){return this.workPackage.hasOwnProperty("unwatch")}get displayWatchButton(){return this.isWatched||this.workPackage.hasOwnProperty("watch")}toggleWatch(){const v=this.nextStateLink();v(v.$link.payload).then(()=>{this.wpWatchersService.clear(this.workPackage.id),this.apiV3Service.work_packages.id(this.workPackage).refresh()})}nextStateLink(){const v=this.isWatched?"unwatch":"watch";return this.workPackage[v]}setWatchStatus(){this.isWatched?(this.buttonTitle=this.I18n.t("js.label_unwatch_work_package"),this.buttonText=this.I18n.t("js.label_unwatch"),this.buttonClass="-active",this.buttonId="unwatch-button",this.watchIconClass="icon-watched"):(this.buttonTitle=this.I18n.t("js.label_watch_work_package"),this.buttonText=this.I18n.t("js.label_watch"),this.buttonClass="",this.buttonId="watch-button",this.watchIconClass="icon-unwatched")}}a.\u0275fac=function(v){return new(v||a)(i.Y36(e.D),i.Y36(p.W),i.Y36(c.T),i.Y36(i.sBO))},a.\u0275cmp=i.Xpm({type:a,selectors:[["wp-watcher-button"]],inputs:{workPackage:"workPackage",showText:"showText",disabled:"disabled"},features:[i.qOj],decls:1,vars:1,consts:[["class","button toolbar-icon",3,"disabled","ngClass","id","click",4,"ngIf"],[1,"button","toolbar-icon",3,"disabled","ngClass","id","click"],[3,"icon-classes"],["class","button--text",3,"textContent",4,"ngIf"],[1,"button--text",3,"textContent"]],template:function(v,C){1&v&&i.YNc(0,f,3,6,"button",0),2&v&&i.Q6J("ngIf",C.displayWatchButton)},directives:[l.O5,l.mk,r.o],encapsulation:2,changeDetection:0})},43440:(te,M,t)=>{"use strict";t.d(M,{q:()=>c});var n=t(14808),e=t(79441),p=t(33927),h=t(2316);class c extends n.Ui{constructor(){super(...arguments),this.name="IsolatedQuerySpace",this.query=(0,n.qH)(),this.queryForm=(0,n.qH)(),this.results=(0,n.qH)(),this.groups=(0,n.qH)(),this.columns=(0,n.qH)(),this.collapsedGroups=(0,n.qH)(),this.tableRendered=(0,n.qH)(),this.timelineRendered=new e.xQ,this.renderedWorkPackages=(0,n.sY)(this.tableRendered,l=>l.pipe((0,p.U)(r=>r.filter(d=>!!d.workPackageId)))),this.renderedWorkPackageIds=(0,n.sY)(this.renderedWorkPackages,l=>l.pipe((0,p.U)(r=>r.map(d=>d.workPackageId.toString())))),this.stopAllSubscriptions=new e.xQ,this.additionalRequiredWorkPackages=(0,n.qH)(),this.initialized=(0,n.qH)(),this.available={columns:(0,n.qH)(),sortBy:(0,n.qH)(),groupBy:(0,n.qH)(),filters:(0,n.qH)(),displayRepresentation:(0,n.qH)()}}}c.\u0275fac=function(){let i;return function(r){return(i||(i=h.n5z(c)))(r||c)}}(),c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac})},97047:(te,M,t)=>{"use strict";t.d(M,{A:()=>Ae});var n=t(43440),e=t(93903),p=t(41195),h=t(40533),c=t(61083),i=t(99676),l=t(82763),r=t(71562),d=t(74647),f=t(73165),a=t(60914),m=t(82271),v=t(81691),C=t(84897),u=t(63829),k=t(74478),x=t(48451),b=t(12703),y=t(61043),P=t(41945),E=t(78434),T=t(77591),O=t(8403),I=t(85388),Z=t(32869),j=t(81539),B=t(3352),J=t(16451),R=t(95846),F=t(64538),Y=t(11337),X=t(2888),K=t(20066),ie=t(16793),H=t(67727),ee=t(62964),ce=t(46709),se=t(79174),re=t(56686),Me=t(2316);class Ae{constructor(ze,Xe,it){this.elementRef=ze,this.querySpace=Xe,this.injector=it,(0,B.qu)("Opening isolated query space %O in %O",it,ze.nativeElement)}}Ae.\u0275fac=function(ze){return new(ze||Ae)(Me.Y36(Me.SBq),Me.Y36(n.q),Me.Y36(Me.zs3))},Ae.\u0275dir=Me.lG2({type:Ae,selectors:[["","wp-isolated-query-space",""]],features:[Me._Bn([{provide:H.W,useExisting:ee.q},n.q,e.j,j.Y,y.Z,p.a,h.S,c.w,se.q,i.Y,l.q,r.i,d.Z,f.W,a.J,m.X,v.G,x.o,C.B,X.ld,K.F,R.M,ie.f,F.h,re.h,P.O,E.U,T.j,O.m,I.j,Z.x,Y.c,b.l,ce.f,u.P,k.f,J.B])]})},7794:(te,M,t)=>{"use strict";t.d(M,{H:()=>Ti});var n=t(21757),e=t(2246),p=t(55811),h=t(53448),c=t(96617),i=t(36293),l=t(2281),r=t(22663),d=t(9170),f=t(14808),a=t(3786),m=t(87853),v=t(12703),C=t(29161),u=t(7812),k=t(50076),x=t(73165),b=t(44022),y=t(52377);class P{constructor(W,q,le,be,Re,Be,$e){this.center=W,this.left=q,this.leftHover=le,this.right=be,this.rightHover=Re,this.farRight=Be,this.withAlternativeLabels=$e}}var E=t(42529);const T="labelLeft",O="containerRight",I="labelRight",Z="labelHoverLeft",j="labelHoverRight",B="-label-style",J="labelFarRight",R="show-on-hover",F="hide-on-hover",Y="leftHandle",X="rightHandle";class ie{constructor(W,q){this.injector=W,this.workPackageTimeline=q,this.text={label_children_derived_duration:this.I18n.t("js.label_children_derived_duration")},this.fieldRenderer=new u.uA(this.injector,"timeline"),this.ganttChartRowHeight=+getComputedStyle(document.documentElement).getPropertyValue("--table-timeline--row-height").replace("px","")}get type(){return"bar"}canMoveDates(W){const q=this.schemaCache.of(W);return q.startDate.writable&&q.dueDate.writable&&q.isAttributeEditable("startDate")}isEmpty(W){const q=l(W.startDate),le=l(W.dueDate);return _.isNaN(q.valueOf())&&_.isNaN(le.valueOf())}displayPlaceholderUnderCursor(W,q){const[le,be]=this.cursorDateAndDayOffset(W,q),Be=this.displayDurationForDate(q,le)*q.viewParams.pixelPerDay||30,$e=document.createElement("div");return $e.style.pointerEvents="none",$e.style.position="absolute",$e.style.height="1em",$e.style.width=`${Be}px`,$e.style.zIndex="9999",$e.style.left=be*q.viewParams.pixelPerDay+"px",this.applyTypeColor(q,$e),$e}assignDateValues(W,q,le){this.assignDate(W,"startDate",le.startDate),this.assignDate(W,"dueDate",le.dueDate),this.updateLabels(!0,q,W)}onDaysMoved(W,q,le,be){const Re=W.pristineResource.startDate,Be=W.pristineResource.dueDate,$e=l().format("YYYY-MM-DD"),He=l(W.projectedResource.startDate),_t=l(W.projectedResource.dueDate),qe={};return"left"===be?qe.startDate=l(Re||Be).add(le,"days"):"right"===be?qe.dueDate=l(Be||$e).add(le,"days"):"both"===be?(Re&&(qe.startDate=l(Re).add(le,"days")),Be&&(qe.dueDate=l(Be).add(le,"days"))):"dragright"===be&&(qe.dueDate=He.clone().add(le,"days")),"both"!==be&&(void 0!==qe.startDate&&qe.startDate.isAfter(_t)?qe.startDate=_t:void 0!==qe.dueDate&&qe.dueDate.isBefore(He)&&(qe.dueDate=He)),qe}onMouseDown(W,q,le,be){if(le.viewParams.activeSelectionMode)return le.viewParams.activeSelectionMode(le.workPackage),W.preventDefault(),this.mouseDirection="both","both";const Re=le.change.projectedResource;let Be;if(jQuery(W.target).hasClass(Y)?(Be="left",this.mouseDirection="left",this.mouseDownCursorType="col-resize",null===Re.startDate&&(Re.startDate=Re.dueDate)):jQuery(W.target).hasClass(X)||q?(Be="right",this.mouseDirection="right",this.mouseDownCursorType="col-resize"):(Be="both",this.mouseDirection="both",this.mouseDownCursorType="ew-resize"),this.workPackageTimeline.forceCursor(this.mouseDownCursorType),q){const $e=this.cursorDateAndDayOffset(W,le)[0],He=this.displayDurationForDate(le,$e)-1;Re.startDate=q,Re.dueDate=l(q).add(He,"days").format("YYYY-MM-DD"),Be="dragright",this.mouseDirection="dragright"}return this.updateLabels(!0,be,le.change),Be}onMouseDownEnd(W,q){this.mouseDownCursorType="",this.workPackageTimeline.forceCursor(this.mouseDownCursorType),this.updateLabels(!1,W,q)}update(W,q,le){const{change:be}=le,Re=W.querySelector(`.${E.PY}`);let Be=l(be.projectedResource.startDate),$e=l(be.projectedResource.dueDate);return _.isNaN(Be.valueOf())&&_.isNaN($e.valueOf())?W.style.visibility="hidden":W.style.visibility="visible",_.isNaN($e.valueOf())&&!_.isNaN(Be.valueOf())&&($e=l(),Re.style.backgroundImage="linear-gradient(90deg, rgba(255,255,255,0) 0%, #F1F1F1 100%)"),_.isNaN(Be.valueOf())&&!_.isNaN($e.valueOf())&&(Be=$e.clone(),Re.style.backgroundImage="linear-gradient(90deg, #F1F1F1 0%, rgba(255,255,255,0) 80%)"),this.setElementPositionAndSize(W,le,Be,$e),q&&this.updateLabels(!1,q,be),this.checkForActiveSelectionMode(le,Re),this.checkForSpecialDisplaySituations(le,Re),this.applyTypeColor(le,Re),!0}cursorDateAndDayOffset(W,q){const le=Math.floor(W.offsetX/q.viewParams.pixelPerDay);return[q.viewParams.dateDisplayStart.clone().add(le,"days"),le]}checkForActiveSelectionMode(W,q){W.viewParams.activeSelectionMode&&(q.style.backgroundImage="",W.viewParams.selectionModeStart===`${W.workPackage.id}`&&(jQuery(q).addClass(E.LT),q.style.background="none"))}displayDurationForDate(W,q){const{workPackage:le}=W;let be=Number(l.duration(le.duration||"P1D").asDays().toFixed(0));if(le.ignoreNonWorkingDays)return be;const{dateDisplayEnd:Re}=W.viewParams;let Be=0;for(;Be<be;Be++){const $e=q.clone().add(Be,"days");if($e>Re)break;this.weekdayService.isNonWorkingDay($e.toDate())&&(be+=1)}return Be}getMarginLeftOfLeftSide(W){const q=W.change.projectedResource;let le=l(q.startDate);const be=l(q.dueDate);le=_.isNaN(le.valueOf())?be.clone():le;const Re=le.diff(W.viewParams.dateDisplayStart,"days");return(0,E.lW)(W.viewParams,Re)}getMarginLeftOfRightSide(W){const q=W.change.projectedResource;let le=l(q.startDate),be=l(q.dueDate);le=_.isNaN(le.valueOf())?be.clone():le,be=_.isNaN(be.valueOf())?le.clone():be;const Re=le.diff(W.viewParams.dateDisplayStart,"days"),Be=be.diff(le,"days")+1;return(0,E.lW)(W.viewParams,Re+Be)}getPaddingLeftForIncomingRelationLines(W){return W.viewParams.pixelPerDay/8}getPaddingRightForOutgoingRelationLines(W){return 0}render(W){const q=document.createElement("div"),le=document.createElement("div"),be=document.createElement("div"),Re=document.createElement("div");return q.className=`${E.mN} ${this.type}`,le.className=E.PY,be.className=Y,Re.className=X,q.appendChild(le),q.appendChild(be),q.appendChild(Re),q}createAndAddLabels(W,q){const le=document.createElement("div");le.classList.add("bar-label"),this.applyTypeColor(W,le),q.appendChild(le);const be=document.createElement("div");be.classList.add(T,F),q.appendChild(be);const Re=document.createElement("div");Re.classList.add(O),q.appendChild(Re);const Be=document.createElement("div");Be.classList.add(I,F),Re.appendChild(Be);const $e=document.createElement("div");$e.classList.add(J,F),Re.appendChild($e);const He=document.createElement("div");He.classList.add(Z,R,B),q.appendChild(He);const _t=document.createElement("div");_t.classList.add(j,R,B),q.appendChild(_t);const qe=new P(le,be,He,Be,_t,$e);return this.updateLabels(!1,qe,W.change),qe}applyTypeColor(W,q){const le=W.workPackage,{type:be}=le,Re=W.viewParams.activeSelectionMode,{id:Be}=be;Re?q.classList.remove(k.Z.backgroundClass("type",Be)):q.classList.add(k.Z.backgroundClass("type",Be))}assignDate(W,q,le){le&&(W.projectedResource[q]=le.format("YYYY-MM-DD"))}setElementPositionAndSize(W,q,le,be){const{viewParams:Re}=q,Be=le.diff(Re.dateDisplayStart,"days");W.style.left=(0,E.jr)(Re,Be);const $e=be.diff(le,"days")+1;if(W.style.width=(0,E.jr)(Re,$e),!_.isNaN(le.valueOf())||!_.isNaN(be.valueOf())){const He=_.max([q.viewParams.pixelPerDay,2]);W.style.minWidth=`${He}px`}}cursorOrDatesAreNonWorking(W,q,le){if(q.workPackage.ignoreNonWorkingDays)return!1;const be=W instanceof MouseEvent?[this.cursorDateAndDayOffset(W,q)[0]]:W;return!(!q.workPackage.ignoreNonWorkingDays&&"both"===le&&this.weekdayService.isNonWorkingDay(be[be.length-1].toDate()))&&be.some(Re=>this.weekdayService.isNonWorkingDay(Re.toDate()))}checkForSpecialDisplaySituations(W,q){const le=W.workPackage,be=q.parentElement.parentElement,Re=W.viewParams.activeSelectionMode;if(le.isLeaf||Re||le.scheduleManually?q.classList.remove("-readonly"):q.classList.add("-readonly"),le.derivedStartDate&&le.derivedDueDate){const _t=l(le.derivedStartDate),qe=l(le.derivedDueDate),pt=l(W.change.projectedResource.startDate),Bt=l(W.change.projectedResource.dueDate),Ft=be.querySelector(".children-duration-bar"),Ct=document.createElement("div"),xt=document.createElement("div"),oi=document.querySelectorAll(`.wp-timeline-cell.__hierarchy-group-${le.id}:not([class*='__collapsed-group'])`).length||0;Ct.classList.add("children-duration-bar","-clamp-style"),Ct.title=this.text.label_children_derived_duration,xt.classList.add("children-duration-hover-container"),xt.style.height=this.ganttChartRowHeight*oi+10+"px",(_t.isBefore(pt)||qe.isAfter(Bt))&&Ct.classList.add("-duration-overflow"),this.setElementPositionAndSize(Ct,W,_t,qe),Ft&&Ft.remove(),Ct.appendChild(xt),be.appendChild(Ct)}const{startDate:Be,dueDate:$e}=W.change.projectedResource;this.cursorOrDatesAreNonWorking([l(Be),l($e)],W,this.mouseDirection)?this.workPackageTimeline.forceCursor("not-allowed"):this.workPackageTimeline.forceCursor(this.mouseDownCursorType)}updateLabels(W,q,le){const be=this.wpTableTimeline.getNormalizedLabels(le.projectedResource);W||(this.renderLabel(le,q,"left",be.left),this.renderLabel(le,q,"right",be.right),this.renderLabel(le,q,"farRight",be.farRight)),this.renderHoverLabels(q,le)}renderHoverLabels(W,q){this.renderLabel(q,W,"leftHover","startDate"),this.renderLabel(q,W,"rightHover","dueDate")}renderLabel(W,q,le,be){const Re=q[le];if(!Re)return;if(Re.innerHTML="",null===be)return void Re.classList.remove("not-empty");const[Be,$e]=this.fieldRenderer.renderFieldValue(W.projectedResource,be,W);Re&&Be&&$e?($e.classList.add("label-content"),Re.appendChild($e),Re.classList.add("not-empty")):Re&&Re.classList.remove("not-empty")}isParentWithVisibleChildren(W){if(!this.workPackageTimeline.inHierarchyMode)return!1;const q=this.workPackageTimeline.workPackageTable.lastRenderPass;return!!q&&!!q.parentsWithVisibleChildren[W.id]}}(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",x.W)],ie.prototype,"wpTableTimeline",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",y.u)],ie.prototype,"weekdayService",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",b.y)],ie.prototype,"schemaCache",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",c.D)],ie.prototype,"I18n",void 0);class H extends ie{get type(){return"milestone"}isEmpty(W){const q=l(W.date);return _.isNaN(q.valueOf())}canMoveDates(W){const q=this.schemaCache.of(W);return q.date.writable&&q.isAttributeEditable("date")}displayPlaceholderUnderCursor(W,q){const le=Math.floor(W.offsetX/q.viewParams.pixelPerDay),be=document.createElement("div");be.className="timeline-element milestone",be.style.pointerEvents="none",be.style.height="1em",be.style.width="1em",be.style.left=le*q.viewParams.pixelPerDay+"px";const Re=document.createElement("div");return Re.className="diamond",Re.style.left="0.5em",Re.style.height="1em",Re.style.width="1em",be.appendChild(Re),this.applyTypeColor(q,Re),be}assignDateValues(W,q,le){this.assignDate(W,"date",le.date),this.updateLabels(!0,q,W)}onDaysMoved(W,q,le,be){const Re=W.pristineResource.date,Be={};return Re&&(Be.date=l(Re).add(le,"days")),Be}onMouseDown(W,q,le,be){if(le.viewParams.activeSelectionMode)return le.viewParams.activeSelectionMode(le.workPackage),W.preventDefault(),"both";let Re="both";return this.workPackageTimeline.forceCursor("ew-resize"),q?(le.change.projectedResource.date=q,Re="create",Re):(this.updateLabels(!0,be,le.change),Re)}update(W,q,le){const{viewParams:be}=le,Re=l(le.change.projectedResource.date);if(_.isNaN(Re.valueOf()))return!1;const Be=jQuery(".diamond",W)[0];Be.style.width="15px",Be.style.height="15px",Be.style.width="15px",Be.style.height="15px",Be.style.marginLeft=le.viewParams.pixelPerDay/2-7.5+"px",this.applyTypeColor(le,Be);const $e=Re.diff(be.dateDisplayStart,"days");return W.style.left=`${(0,E.lW)(be,$e)}px`,q&&this.updateLabels(!1,q,le.change),this.checkForActiveSelectionMode(le,Be),!0}getMarginLeftOfLeftSide(W){const{change:q}=W,be=l(q.projectedResource.date).diff(W.viewParams.dateDisplayStart,"days");return(0,E.lW)(W.viewParams,be)}getMarginLeftOfRightSide(W){return this.getMarginLeftOfLeftSide(W)+W.viewParams.pixelPerDay}getPaddingLeftForIncomingRelationLines(W){return W.viewParams.pixelPerDay/2-1}getPaddingRightForOutgoingRelationLines(W){return 7.5}render(W){const q=document.createElement("div");q.className=`${E.mN} ${this.type}`;const le=document.createElement("div");return le.className="diamond",q.appendChild(le),q}createAndAddLabels(W,q){const le=document.createElement("div");le.classList.add(T,F),q.appendChild(le);const be=document.createElement("div");be.classList.add(O),q.appendChild(be);const Re=document.createElement("div");Re.classList.add(I,F),be.appendChild(Re);const Be=document.createElement("div");Be.classList.add(J,F),be.appendChild(Be);const $e=document.createElement("div");$e.classList.add(j,R,B),q.appendChild($e);const He=document.createElement("div");He.classList.add(Z,R,B),q.appendChild(He);const _t=new P(null,le,He,Re,$e,Be,W.withAlternativeLabels);return this.updateLabels(!1,_t,W.change),_t}renderHoverLabels(W,q){W.withAlternativeLabels?(this.renderLabel(q,W,"leftHover","date"),this.renderLabel(q,W,"rightHover","subject")):this.renderLabel(q,W,"rightHover","date")}updateLabels(W,q,le){const be=this.wpTableTimeline.getNormalizedLabels(le.projectedResource);W||(q.withAlternativeLabels?this.renderLabel(le,q,"right","subject"):"startDate"===be.left&&"dueDate"===be.right?(this.renderLabel(le,q,"left",null),this.renderLabel(le,q,"right","date")):(this.renderLabel(le,q,"left",be.left),this.renderLabel(le,q,"right",be.right)),this.renderLabel(le,q,"farRight",be.farRight)),this.renderHoverLabels(q,le)}renderLabel(W,q,le,be){("startDate"===be||"dueDate"===be)&&(be="date"),super.renderLabel(W,q,le,be)}}var ee=t(86469),ce=t(1403),se=t(62964),re=t(43440),Me=t(33406),Ae=t(53466),Ye=t(33276);function ze(We,W,q,le,be,Re,Be,$e,He,_t,qe,pt){let Ft,Bt=null;pt.change=le.changeFor(pt.workPackage);const Ct=jQuery("body");function xt(Je,rt,ct){const Et=qe.onDaysMoved(pt.change,Je,rt,ct);qe.assignDateValues(pt.change,_t,Et),qe.update(He,_t,pt)}function oi(Je){const rt=q.getAbsoluteLeftCoordinates(),ct=Je.clientX-rt;return Math.floor(ct/pt.viewParams.pixelPerDay)}function Fi(Je){Je.originalEvent.keyCode===Me.m.ESCAPE&&A(null,!0)}function ge(Je){const rt=pt.workPackage;qe.isEmpty(rt)&&(null==Ft||Ft.remove(),Ft=qe.displayPlaceholderUnderCursor(Je,pt),(rt.isLeaf||rt.scheduleManually)&&qe.canMoveDates(rt)&&!qe.cursorOrDatesAreNonWorking(Je,pt)?($e.style.cursor="",$e.appendChild(Ft),$e.onmouseleave=()=>{Ft.remove()},$e.onmousedown=Et=>{if(Ft.remove(),Et.preventDefault(),qe.cursorOrDatesAreNonWorking(Et,pt))return;He.style.pointerEvents="none";const[di,Ei]=qe.cursorDateAndDayOffset(Et,pt),Ui=di.format("YYYY-MM-DD"),Hi=qe.onMouseDown(Et,Ui,pt,_t);qe.update(He,_t,pt),"create"!==Hi?(Ct.on("mousemove.emptytimelinecell",function(Je,rt){return ct=>{Ft.remove();const Et=Math.abs($e.getBoundingClientRect().x-ct.clientX),di=Math.floor(Et/pt.viewParams.pixelPerDay);xt(pt.viewParams.dateDisplayStart.clone().add(di,"days"),di-Je,rt)}}(Ei,Hi)),Ct.on("mouseup.emptytimelinecell",()=>A(Hi,!1)),$e.onmouseup=()=>{A(Hi,!1)},Ct.on("keyup.timelinecell",Fi)):A(Hi,!1)}):$e.style.cursor="not-allowed")}function A(Je,rt){const ct=pt.change;q.disableViewParamsCalculation=!1,$e.onmousemove=ge,$e.onmousedown=()=>{},$e.onmouseleave=()=>{},$e.onmouseup=()=>{},He.style.pointerEvents="auto",Ct.off(".timelinecell"),Ct.off(".emptytimelinecell"),q.resetCursor(),Bt=null;const{startDate:Et,dueDate:di}=ct.projectedResource,Ei=qe.cursorOrDatesAreNonWorking([l(Et),l(di)],pt,Je);if(rt||ct.isEmpty()||Ei)return void _e();const Ui=ct.pristineResource.duration;"both"===Je&&Ui&&(ct.clearValue("dueDate"),ct.setValue("duration",Ui)),function(Je){const rt=We.get(Ye.T),ct=We.get(re.q),Et=l().toISOString();return Be.table.promise=le.save(Je).then(di=>{Re.showSave(di.resource);const Ei=_.map(ct.tableRendered.value,Ui=>Ui.workPackageId);return rt.work_packages.filterUpdatedSince(Ei,Et).get().toPromise().then(()=>(be.push(di.resource,{eventType:"updated"}),ct.timelineRendered.pipe((0,Ae.q)(1)).toPromise()))})}(pt.change).then(()=>{pt.change.clear(),qe.onMouseDownEnd(_t,pt.change)}).catch(Hi=>{Re.handleRawError(Hi,pt.workPackage),_e()})}function _e(){pt.change.clear(),qe.update(He,_t,pt),qe.onMouseDownEnd(_t,pt.change),q.refreshView()}He.onmousedown=Je=>{1===Je.which&&function(Je){Je.preventDefault();const rt="active-drag";if(He.classList.add(rt),Ct.on("mouseup.timelinecell",()=>He.classList.remove(rt)),q.disableViewParamsCalculation=!0,Bt=oi(Je),!pt.workPackage.isLeaf&&!pt.viewParams.activeSelectionMode&&!pt.workPackage.scheduleManually)return;const ct=qe.onMouseDown(Je,null,pt,_t);Ct.on("mousemove.timelinecell",function(Je){return rt=>{const ct=oi(rt.originalEvent)-Bt,Et=Math.floor(rt.offsetX/pt.viewParams.pixelPerDay);xt(pt.viewParams.dateDisplayStart.clone().add(Et,"days"),ct,Je)}}(ct)),Ct.on("keyup.timelinecell",Fi),Ct.on("mouseup.timelinecell",()=>A(ct,!1))}(Je)},$e.onmousemove=ge}class Xe{constructor(W,q,le,be,Re,Be){this.injector=W,this.workPackageTimeline=q,this.renderers=le,this.latestRenderInfo=be,this.classIdentifier=Re,this.workPackageId=Be,this.wpElement=null}getMarginLeftOfLeftSide(){return this.cellRenderer(this.latestRenderInfo.workPackage).getMarginLeftOfLeftSide(this.latestRenderInfo)}getMarginLeftOfRightSide(){return this.cellRenderer(this.latestRenderInfo.workPackage).getMarginLeftOfRightSide(this.latestRenderInfo)}getPaddingLeftForIncomingRelationLines(){return this.cellRenderer(this.latestRenderInfo.workPackage).getPaddingLeftForIncomingRelationLines(this.latestRenderInfo)}getPaddingRightForOutgoingRelationLines(){return this.cellRenderer(this.latestRenderInfo.workPackage).getPaddingRightForOutgoingRelationLines(this.latestRenderInfo)}canConnectRelations(){const W=this.latestRenderInfo.workPackage;return this.schemaCache.of(W).isMilestone?!_.isNil(W.date):!_.isNil(W.startDate)||!_.isNil(W.dueDate)}clear(){this.cellElement.html(""),this.wpElement=null}get cellContainer(){return this.workPackageTimeline.timelineBody}get cellElement(){return this.cellContainer.find(`.${this.classIdentifier}`)}lazyInit(W,q){const le=this.workPackageTimeline.timelineBody[0],be=this.cellElement;return be.length?(null!==this.wpElement&&le.contains(this.wpElement)&&this.elementShape===W.type||(q.isDuplicatedCell||this.clear(),this.wpElement=W.render(q),this.labels=W.createAndAddLabels(q,this.wpElement),this.elementShape=W.type,be.append(this.wpElement),W.canMoveDates(q.workPackage)&&(this.wpElement.classList.add("-editable"),ze(this.injector,0,this.workPackageTimeline,this.halEditing,this.halEvents,this.notificationService,this.loadingIndicator,be[0],this.wpElement,this.labels,W,q))),Promise.resolve()):Promise.reject("uninitialized")}cellRenderer(W){return this.schemaCache.of(W).isMilestone?this.renderers.milestone:this.renderers.generic}refreshView(W){this.latestRenderInfo=W;const q=this.cellRenderer(W.workPackage);this.lazyInit(q,W).then(()=>{q.update(this.wpElement,this.labels,W)||this.clear()}).catch(()=>null)}}(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",v.l)],Xe.prototype,"halEditing",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",ce.J)],Xe.prototype,"halEvents",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",se.q)],Xe.prototype,"notificationService",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",m.G)],Xe.prototype,"states",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",ee.vt)],Xe.prototype,"loadingIndicator",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",b.y)],Xe.prototype,"schemaCache",void 0);class it{constructor(W,q){this.injector=W,this.wpTimeline=q,this.cells={},this.cellRenderers={milestone:new H(this.injector,q),generic:new ie(this.injector,q)}}hasCell(W){return this.getCellsFor(W).length>0}getCellsFor(W){return _.filter(this.cells,q=>q.workPackageId===W)||[]}refreshAllCells(){this.synchronizeCells(),_.each(this.cells,W=>this.refreshSingleCell(W))}refreshCellsFor(W){_.each(this.getCellsFor(W),q=>this.refreshSingleCell(q))}refreshSingleCell(W,q,le){const be=this.renderInfoFor(W.workPackageId,q,le);be.workPackage&&W.refreshView(be)}synchronizeCells(){const W=Object.keys(this.cells),q=[];_.each(this.wpTimeline.workPackageIdOrder,le=>{const be=le.workPackageId;if(!be||this.states.workPackages.get(be).isPristine())return;const Be=le.classIdentifier;this.cells[Be]||(this.cells[Be]=this.buildCell(Be,be.toString())),q.push(Be)}),_.difference(W,q).forEach(le=>{this.cells[le].clear(),delete this.cells[le]})}buildCell(W,q){return new Xe(this.injector,this.wpTimeline,this.cellRenderers,this.renderInfoFor(q),W,q)}renderInfoFor(W,q,le){const be=this.states.workPackages.get(W).value;return{viewParams:this.wpTimeline.viewParameters,workPackage:be,change:this.halEditing.changeFor(be),isDuplicatedCell:q,withAlternativeLabels:le}}buildCellsAndRenderOnRow(W,q,le){const be=W.map(Re=>this.buildCell(q,Re));return be.forEach(Re=>this.refreshSingleCell(Re,le,!0)),be}}(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",m.G)],it.prototype,"states",void 0),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",v.l)],it.prototype,"halEditing",void 0);var at=t(53457),lt=t(99676),dt=t(9822),de=t(3352),oe=t(61486),D=t(26942),G=t(18942),V=t(67749),me=t(79174),$=t(2316);class Se extends D.N{constructor(W,q,le,be,Re,Be,$e,He,_t,qe,pt,Bt,Ft,Ct){super(),this.injector=W,this.elementRef=q,this.states=le,this.wpTableComponent=be,this.toastService=Re,this.wpTableTimeline=Be,this.notificationService=$e,this.wpRelations=He,this.wpTableHierarchies=_t,this.halEvents=qe,this.querySpace=pt,this.I18n=Bt,this.workPackageViewCollapsedGroupsService=Ft,this.weekdaysService=Ct,this._viewParameters=new E.O6,this.disableViewParamsCalculation=!1,this.workPackageIdOrder=[],this.renderers={},this.cellsRenderer=new it(this.injector,this),this.selectionParams={notification:null},this.refreshRequest=(0,f.qH)(),this.collapsedGroupsCellsMap={},this.orderedRows=[]}get commonPipes(){return W=>W.pipe(this.untilDestroyed(),(0,r.R)(this.querySpace.stopAllSubscriptions),(0,d.h)(()=>this.initialized&&this.wpTableTimeline.isVisible))}get workPackagesWithGroupHeaderCell(){const q=this.querySpace.results.value.elements.filter(be=>this.shouldBeShownInCollapsedGroupHeaders(be)).map(be=>be.id);return this.orderedRows.filter(be=>q.includes(be.workPackageId)&&!this.workPackageIdOrder.includes(be))}ngAfterViewInit(){this.$element=jQuery(this.elementRef.nativeElement),this.text={selectionMode:this.I18n.t("js.timelines.selection_mode.notification")},this.outerContainer=this.$element.find(".wp-table-timeline--outer"),this.timelineBody=this.$element.find(".wp-table-timeline--body"),this.wpTableComponent.registerTimeline(this,this.timelineBody[0]),window.addEventListener("wp-resize.timeline",()=>this.refreshRequest.putValue(void 0)),(0,oe.aj)([this.querySpace.tableRendered.values$(),this.refreshRequest.changes$(),this.wpTableTimeline.live$(),this.weekdaysService.loadWeekdays()]).pipe(this.commonPipes).subscribe(([W])=>{this.workPackageIdOrder=W.filter(q=>!q.hidden),this.orderedRows=W,this.refreshView()}),this.setupManageCollapsedGroupHeaderCells()}workPackageCells(W){return this.cellsRenderer.getCellsFor(W)}workPackageIndex(W){return this.workPackageIdOrder.findIndex(q=>q.classIdentifier===W)}onRefreshRequested(W,q){this.renderers[W]=q}getAbsoluteLeftCoordinates(){return this.$element.offset().left}getParentScrollContainer(){return this.outerContainer.closest(dt.UX)[0]}get viewParameters(){return this._viewParameters}get inHierarchyMode(){return this.wpTableHierarchies.isEnabled}get initialized(){return this.workPackageTable&&this.querySpace.tableRendered.hasValue()}refreshView(){this.wpTableTimeline.isVisible?(this.wpTableTimeline.isAutoZoom()?this.applyAutoZoomLevel():(this._viewParameters.settings.zoomLevel=this.wpTableTimeline.zoomLevel,this.wpTableTimeline.appliedZoomLevel=this.wpTableTimeline.zoomLevel),(0,de.IN)("refreshView() in timeline container",()=>{this.outerContainer.css("width","auto"),this.calculateViewParams(this._viewParameters),this.cellsRenderer.refreshAllCells(),_.each(this.renderers,(q,le)=>{(0,de.qu)(`Refreshing timeline member ${le}`),q(this._viewParameters)}),this.refreshCollapsedGroupsHeaderCells(this.collapsedGroupsCellsMap,this.cellsRenderer);const W=this.$element.find(E.eY)[0].scrollWidth;this.outerContainer.width(W),setTimeout(()=>{this.querySpace.timelineRendered.next(null)})})):(0,de.qu)("refreshView() requested, but TL is invisible.")}startAddRelationPredecessor(W){this.activateSelectionMode(W.id,q=>{this.wpRelations.addCommonRelation(W.id,"follows",q.id).then(()=>{this.halEvents.push(W,{eventType:"association",relatedWorkPackage:q.id,relationType:"follows"})}).catch(le=>this.notificationService.handleRawError(le,q))})}startAddRelationFollower(W){this.activateSelectionMode(W.id,q=>{this.wpRelations.addCommonRelation(W.id,"precedes",q.id).then(()=>{this.halEvents.push(W,{eventType:"association",relatedWorkPackage:q.id,relationType:"precedes"})}).catch(le=>this.notificationService.handleRawError(le,q))})}getFirstDayInViewport(){const W=this.getParentScrollContainer(),{scrollLeft:q}=W,le=Math.floor(q/this.viewParameters.pixelPerDay);return this.viewParameters.dateDisplayStart.clone().add(le,"days")}getLastDayInViewport(){const W=this.getParentScrollContainer(),{scrollLeft:q}=W,be=q+W.offsetWidth,Re=Math.ceil(be/this.viewParameters.pixelPerDay)+1;return this.viewParameters.dateDisplayStart.clone().add(Re,"days")}forceCursor(W){jQuery(`.${E.mN}`).css("cursor",W),jQuery(".wp-timeline-cell").css("cursor",W),jQuery(".hascontextmenu").css("cursor",W),jQuery(".leftHandle").css("cursor",W),jQuery(".rightHandle").css("cursor",W)}resetCursor(){jQuery(`.${E.mN}`).css("cursor",""),jQuery(".wp-timeline-cell").css("cursor",""),jQuery(".hascontextmenu").css("cursor",""),jQuery(".leftHandle").css("cursor",""),jQuery(".rightHandle").css("cursor","")}resetSelectionMode(){this._viewParameters.activeSelectionMode=null,this._viewParameters.selectionModeStart=null,this.selectionParams.notification&&this.toastService.remove(this.selectionParams.notification),Mousetrap.unbind("esc"),this.$element.removeClass("active-selection-mode"),jQuery(`.${E.LT}`).removeClass(E.LT),this.refreshView()}activateSelectionMode(W,q){W=W.toString(),this._viewParameters.activeSelectionMode=le=>{q(le),this.resetSelectionMode()},this._viewParameters.selectionModeStart=W,Mousetrap.bind("esc",()=>this.resetSelectionMode()),this.selectionParams.notification=this.toastService.addNotice(this.text.selectionMode),this.$element.addClass("active-selection-mode"),this.refreshView()}calculateViewParams(W){if(this.disableViewParamsCalculation)return!1;const q=new E.O6;let le=!1;this.getWorkPackagesToCalculateTimelineWidthFrom().forEach(pt=>{const Bt=pt.workPackageId;if(!Bt)return;const Ct=this.states.workPackages.get(Bt).value;if(!Ct)return;const xt=Ct.startDate?l(Ct.startDate):W.now,oi=Ct.dueDate?l(Ct.dueDate):W.now,nn=Ct.date?l(Ct.date):W.now;q.dateDisplayStart=l.min(q.dateDisplayStart,W.now,xt,nn).clone(),q.dateDisplayEnd=l.max(q.dateDisplayEnd,W.now,oi,nn).clone()}),q.dateDisplayStart.subtract(W.dayCountForMarginLeft,"days");const Re=this.$element.children().width(),{pixelPerDay:Be}=W,$e=Math.ceil(Re/Be*1.5);q.dateDisplayEnd.add($e,"days"),q.dateDisplayStart.isSame(this._viewParameters.dateDisplayStart)||(le=!0,this._viewParameters.dateDisplayStart=q.dateDisplayStart),q.dateDisplayEnd.isSame(this._viewParameters.dateDisplayEnd)||(le=!0,this._viewParameters.dateDisplayEnd=q.dateDisplayEnd);const qe=[this.getFirstDayInViewport(),this.getLastDayInViewport()];return this._viewParameters.visibleViewportAtCalculationTime=qe,le}applyAutoZoomLevel(){if(0===this.workPackageIdOrder.length)return;const W=this.getWorkPackagesToCalculateTimelineWidthFrom(),q=(0,E.Nm)(W,this.states.workPackages,this._viewParameters),le=this.$element.parent().width()-2*E.g5;for(const be of E.$r){if(le/(0,E.GC)(be)>=q||be===_.last(E.$r))return this._viewParameters.settings.zoomLevel!==be&&(this._viewParameters.settings.zoomLevel=be,this.wpTableComponent.timeline.scrollLeft=0),void(this.wpTableTimeline.appliedZoomLevel=be)}}setupManageCollapsedGroupHeaderCells(){this.workPackageViewCollapsedGroupsService.updates$().pipe(this.commonPipes).subscribe(W=>{this.manageCollapsedGroupHeaderCells(W,this.querySpace.results.value.elements,this.collapsedGroupsCellsMap)})}manageCollapsedGroupHeaderCells(W,q,le){const be=W.allGroupsChanged,Re=W.state,Be=Object.keys(Re);let $e=[];if(Be.length){if(be)$e=Be.filter(He=>this.shouldManageCollapsedGroupHeaderCells(He,W));else{const He=W.lastChangedGroup;this.shouldManageCollapsedGroupHeaderCells(He,W)&&($e=[He])}$e.forEach(He=>{Re[He]?this.createCollapsedGroupHeaderCells(He,q,le):this.removeCollapsedGroupHeaderCells(He,le)})}}shouldManageCollapsedGroupHeaderCells(W,q){const le=(0,V.dF)(W);return this.workPackageViewCollapsedGroupsService.groupTypesWithHeaderCellsWhenCollapsed.includes(le)&&this.workPackageViewCollapsedGroupsService.groupTypesWithHeaderCellsWhenCollapsed.includes(q.groupedBy)}createCollapsedGroupHeaderCells(W,q,le){this.removeCollapsedGroupHeaderCells(W,le);const be=(0,V.yD)(W),Re=(0,V.dF)(W),He=q.filter(_t=>_t[Re].id===be).filter(_t=>this.shouldBeShownInCollapsedGroupHeaders(_t)&&(_t.date||_t.startDate)).map(_t=>_t.id);this.collapsedGroupsCellsMap[W]=this.cellsRenderer.buildCellsAndRenderOnRow(He,`group-${W}-timeline`,!0)}removeCollapsedGroupHeaderCells(W,q){q[W]&&(q[W].forEach(le=>le.clear()),q[W]=[])}refreshCollapsedGroupsHeaderCells(W,q){Object.keys(W).forEach(le=>{W[le].forEach(Re=>q.refreshSingleCell(Re,!1,!0))})}shouldBeShownInCollapsedGroupHeaders(W){return this.workPackageViewCollapsedGroupsService.wpTypesToShowInCollapsedGroupHeaders.some(q=>q(W))}getWorkPackagesToCalculateTimelineWidthFrom(){return[...this.workPackageIdOrder,...this.workPackagesWithGroupHeaderCell]}}Se.\u0275fac=function(W){return new(W||Se)($.Y36($.zs3),$.Y36($.SBq),$.Y36(m.G),$.Y36(G.c),$.Y36(i.kl),$.Y36(x.W),$.Y36(se.q),$.Y36(at.V),$.Y36(lt.Y),$.Y36(ce.J),$.Y36(re.q),$.Y36(c.D),$.Y36(me.q),$.Y36(y.u))},Se.\u0275cmp=$.Xpm({type:Se,selectors:[["wp-timeline-container"]],features:[$.qOj],decls:7,vars:0,consts:[[1,"wp-table-timeline--outer"],[1,"wp-table-timeline--container"],[1,"wp-table-timeline--body"]],template:function(W,q){1&W&&($.TgZ(0,"div",0),$.TgZ(1,"div",1),$._UZ(2,"wp-timeline-header"),$._UZ(3,"wp-timeline-static-elements"),$._UZ(4,"wp-timeline-grid"),$._UZ(5,"wp-timeline-relations"),$._UZ(6,"div",2),$.qZA(),$.qZA())},encapsulation:2});var ot=t(84366),st=t(55548),he=t(20342),ye=t(77355),xe=t(71562),De=t(61083),Qe=t(82763),nt=(t(55054),t(57119)),mt=t(15893),Ue=t(84335);class Fe extends st.n{constructor(W,q,le,be,Re,Be,$e,He,_t,qe){super(W,q),this.elementRef=W,this.opContextMenu=q,this.wpTableColumns=le,this.wpTableSortBy=be,this.wpTableGroupBy=Re,this.wpTableHierarchies=Be,this.opModalService=$e,this.injector=He,this.I18n=_t,this.confirmDialog=qe,this.text={confirmDelete:{text:this.I18n.t("js.work_packages.table_configuration.sorting_mode.warning"),title:this.I18n.t("js.modals.form_submit.title")}}}open(W){!this.table.configuration.columnMenuEnabled||(this.buildItems(),this.opContextMenu.show(this,W))}get locals(){return{showAnchorRight:this.column&&"id"!==this.column.id,contextMenuId:"column-context-menu",items:this.items}}positionArgs(W){const q={of:this.$element.find(".generic-table--sort-header-outer")},le=super.positionArgs(W);return _.assign(le,q),le}get afterFocusOn(){return this.$element.find(`#${this.column.id}`)}buildItems(){const W=this.column;this.items=[{hidden:!this.wpTableSortBy.isSortable(W),linkText:this.I18n.t("js.work_packages.query.sort_descending"),icon:"icon-sort-descending",onClick:q=>this.wpTableSortBy.isManualSortingMode?(this.confirmDialog.confirm({text:this.text.confirmDelete}).then(()=>(this.wpTableSortBy.setAsSingleSortCriteria(W,mt.iV),!0)),!1):(this.wpTableSortBy.addSortCriteria(W,mt.iV),!0)},{hidden:!this.wpTableSortBy.isSortable(W),linkText:this.I18n.t("js.work_packages.query.sort_ascending"),icon:"icon-sort-ascending",onClick:q=>this.wpTableSortBy.isManualSortingMode?(this.confirmDialog.confirm({text:this.text.confirmDelete}).then(()=>(this.wpTableSortBy.setAsSingleSortCriteria(W,mt.S9),!0)),!1):(this.wpTableSortBy.addSortCriteria(W,mt.S9),!0)},{hidden:!this.wpTableGroupBy.isGroupable(W)||this.wpTableGroupBy.isCurrentlyGroupedBy(W),linkText:this.I18n.t("js.work_packages.query.group"),icon:"icon-group-by",onClick:()=>(this.wpTableHierarchies.isEnabled&&this.wpTableHierarchies.setEnabled(!1),this.wpTableGroupBy.setBy(W),!0)},{hidden:this.wpTableColumns.isFirst(W),linkText:this.I18n.t("js.work_packages.query.move_column_left"),icon:"icon-column-left",onClick:()=>(this.wpTableColumns.shift(W,-1),!0)},{hidden:this.wpTableColumns.isLast(W),linkText:this.I18n.t("js.work_packages.query.move_column_right"),icon:"icon-column-right",onClick:()=>(this.wpTableColumns.shift(W,1),!0)},{linkText:this.I18n.t("js.work_packages.query.hide_column"),icon:"icon-delete",onClick:()=>{const q=this.wpTableColumns.previous(W)||this.wpTableColumns.next(W);return this.wpTableColumns.removeColumn(W),setTimeout(()=>{q&&jQuery(`#${q.id}`).focus()}),!0}},{linkText:this.I18n.t("js.work_packages.query.insert_columns"),icon:"icon-columns",onClick:()=>(this.opModalService.show(nt.Q,this.injector,{initialTab:"columns"}),!0)}]}}Fe.\u0275fac=function(W){return new(W||Fe)($.Y36($.SBq),$.Y36(he.$),$.Y36(xe.i),$.Y36(Qe.q),$.Y36(De.w),$.Y36(lt.Y),$.Y36(ye.S),$.Y36($.zs3),$.Y36(c.D),$.Y36(Ue.D))},Fe.\u0275dir=$.lG2({type:Fe,selectors:[["","opColumnsContextMenu",""]],inputs:{column:["opColumnsContextMenu-column","column"],table:["opColumnsContextMenu-table","table"]},features:[$.qOj]});class Te{constructor(W,q,le,be){this.I18n=q,this.wpTimelineService=le,this.workPackageTimelineTableController=be,this.$element=jQuery(W.nativeElement)}ngOnInit(){this.workPackageTimelineTableController.onRefreshRequested("header",W=>this.refreshView(W))}refreshView(W){this.innerHeader=this.$element.find(".wp-table-timeline--header-inner"),this.renderLabels(W)}renderLabels(W){switch(this.innerHeader.empty(),this.innerHeader.attr("data-current-zoom-level",this.wpTimelineService.zoomLevel),W.settings.zoomLevel){case"days":this.renderLabelsDays(W);break;case"weeks":this.renderLabelsWeeks(W);break;case"months":this.renderLabelsMonths(W);break;case"quarters":this.renderLabelsQuarters(W);break;case"years":this.renderLabelsYears(W);break;default:return}this.activeZoomLevel=W.settings.zoomLevel}renderLabelsDays(W){this.renderTimeSlices(W,"month",0,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("MMM YYYY"),le.classList.add("wp-timeline--header-top-bold-element"),le.style.height="13px"}),this.renderTimeSlices(W,"week",13,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("ww"),le.classList.add("-top-border"),le.style.height="32px"}),this.renderTimeSlices(W,"day",23,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("D"),le.classList.add("-top-border"),le.style.height="22px"}),this.renderTimeSlices(W,"day",33,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("dd"),le.classList.add("wp-timeline--header-day-element")})}renderLabelsWeeks(W){this.renderTimeSlices(W,"month",0,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("MMM YYYY"),le.classList.add("wp-timeline--header-top-bold-element")}),this.renderTimeSlices(W,"week",15,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("ww"),le.classList.add("-top-border"),le.style.height="22px"}),this.renderTimeSlices(W,"day",25,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("D"),le.classList.add("wp-timeline--header-middle-element")})}renderLabelsMonths(W){this.renderTimeSlices(W,"year",0,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("YYYY"),le.classList.add("wp-timeline--header-top-bold-element")}),this.renderTimeSlices(W,"month",15,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("MMM"),le.classList.add("-top-border"),le.style.height="30px"}),this.renderTimeSlices(W,"week",25,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("ww"),le.classList.add("wp-timeline--header-middle-element")})}renderLabelsQuarters(W){this.renderTimeSlices(W,"year",0,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--header-top-bold-element"),le.innerHTML=q.format("YYYY")}),this.renderTimeSlices(W,"quarter",15,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=this.I18n.t("js.timelines.quarter_label",{quarter_number:q.format("Q")}),le.classList.add("-top-border"),le.style.height="30px"}),this.renderTimeSlices(W,"month",25,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("MMM"),le.classList.add("wp-timeline--header-middle-element")})}renderLabelsYears(W){this.renderTimeSlices(W,"year",0,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("YYYY"),le.classList.add("wp-timeline--header-top-bold-element")}),this.renderTimeSlices(W,"quarter",15,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=this.I18n.t("js.timelines.quarter_label",{quarter_number:q.format("Q")}),le.classList.add("-top-border"),le.style.height="30px"}),this.renderTimeSlices(W,"month",25,W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.innerHTML=q.format("M"),le.classList.add("wp-timeline--header-middle-element")})}renderTimeSlices(W,q,le,be,Re,Be){const{inViewportAndBoundaries:$e,rest:He}=(0,E.kv)(W,q,be,Re);for(const[_t,qe]of $e){const pt=this.addLabelCell();pt.style.top=`${le}px`,pt.style.left=(0,E.jr)(W,_t.diff(be,"days")),pt.style.width=(0,E.jr)(W,qe.diff(_t,"days")+1),Be(_t,pt)}setTimeout(()=>{for(const[_t,qe]of He){const pt=this.addLabelCell();pt.style.top=`${le}px`,pt.style.left=(0,E.jr)(W,_t.diff(be,"days")),pt.style.width=(0,E.jr)(W,qe.diff(_t,"days")+1),Be(_t,pt)}},0)}addLabelCell(){const W=document.createElement("div");return W.className=E.bz,this.innerHeader.append(W),W}}Te.\u0275fac=function(W){return new(W||Te)($.Y36($.SBq),$.Y36(c.D),$.Y36(x.W),$.Y36(Se))},Te.\u0275cmp=$.Xpm({type:Te,selectors:[["wp-timeline-header"]],decls:2,vars:0,consts:[[1,"wp-table-timeline--header"],[1,"wp-table-timeline--header-inner"]],template:function(W,q){1&W&&($.TgZ(0,"div",0),$._UZ(1,"div",1),$.qZA())},encapsulation:2});var tt=t(33927);function ut(We){return`__tl-relation-${We}`}class Yt{constructor(W,q){this.belongsToId=W,this.relation=q}get classNames(){return[ut(this.relation.ids.from),ut(this.relation.ids.to)]}}const Nt="relation-line";function wt(We,W,q,le,be,Re,Be,$e){const He=document.createElement("div");return He.classList.add(E.mN,Nt,...W),He.style.top=`${40*q+le}px`,He.style.left=`${be}px`,He.style.width=`${Re}px`,He.style.height=`${Be}px`,He}class zt extends D.N{constructor(W,q,le,be,Re,Be){super(),this.injector=W,this.elementRef=q,this.states=le,this.workPackageTimelineTableController=be,this.wpTableTimeline=Re,this.wpRelations=Be,this.workPackagesWithRelations={}}ngOnInit(){const W=jQuery(this.elementRef.nativeElement);this.container=W.find(".wp-table-timeline--relations"),this.workPackageTimelineTableController.onRefreshRequested("relations",q=>this.refreshView()),this.setupRelationSubscription()}refreshView(){this.update()}get workPackageIdOrder(){return this.workPackageTimelineTableController.workPackageIdOrder}setupRelationSubscription(){(0,oe.aj)([this.querySpace.renderedWorkPackages.values$(),this.wpTableTimeline.live$()]).pipe((0,d.h)(([W,q])=>q.visible),this.untilDestroyed(),(0,tt.U)(([W,q])=>W)).subscribe(W=>{const q=_.compact(W.map(le=>le.workPackageId));this.wpRelations.requireAll(q),q.forEach(le=>{const be=this.wpRelations.state(le);this.workPackagesWithRelations[le]=be,be.values$().pipe((0,Ae.q)(1)).subscribe(()=>{this.renderWorkPackagesRelations([le])})})}),this.states.workPackages.observeChange().pipe(this.untilDestroyed(),(0,d.h)(()=>this.wpTableTimeline.isVisible)).subscribe(([W])=>{this.renderWorkPackagesRelations([W])})}renderWorkPackagesRelations(W){W.forEach(q=>{const le=this.workPackagesWithRelations[q];if(_.isNil(le))return;this.removeRelationElementsForWorkPackage(q);const be=_.values(le.value);_.values(be).forEach(Be=>{if("precedes"!==Be.type&&"follows"!==Be.type)return;const $e=new Yt(Be.ids.from,Be);this.renderElement(this.workPackageTimelineTableController.viewParameters,$e)})})}update(){this.removeAllVisibleElements(),this.renderElements()}removeRelationElementsForWorkPackage(W){const q=ut(W);this.container.find(`.${q}`).remove()}removeAllVisibleElements(){this.container.find(`.${Nt}`).remove()}renderElements(){const W=_.keys(this.workPackagesWithRelations);this.renderWorkPackagesRelations(W)}renderElement(W,q){const le=q.relation.ids,be=this.workPackageTimelineTableController.workPackageCells(le.to),Re=this.workPackageTimelineTableController.workPackageCells(le.from);0===be.length||0===Re.length||be.forEach(Be=>{const $e=this.workPackageTimelineTableController.workPackageIndex(Be.classIdentifier);Re.forEach(He=>{const _t=this.workPackageTimelineTableController.workPackageIndex(He.classIdentifier);this.renderRelation(W,q,$e,_t,Be,He)})})}renderRelation(W,q,le,be,Re,Be){const $e=this.workPackageIdOrder[le],He=this.workPackageIdOrder[be];if(!$e||!He||$e.hidden||He.hidden||!Re.canConnectRelations()||!Be.canConnectRelations())return;const _t=Re.getMarginLeftOfRightSide()-Re.getPaddingRightForOutgoingRelationLines(),qe=Be.getMarginLeftOfLeftSide()+Be.getPaddingLeftForIncomingRelationLines(),pt=le<be?"toDown":"toUp",Bt=qe>_t?"toRight":qe<_t?"toLeft":"beneath";if(!Re)return;const Ft=Re.getPaddingRightForOutgoingRelationLines(),Ct=Be.getPaddingLeftForIncomingRelationLines()+(Ft>0?Ft:0);this.container.append(wt(0,q.classNames,le,19,_t,Ct,1));const xt=_t+Ct,oi=Math.abs(be-le);"toDown"===pt?"toRight"===Bt||"beneath"===Bt?this.container.append(wt(0,q.classNames,le,19,xt,1,40*oi)):"toLeft"===Bt&&this.container.append(wt(0,q.classNames,le,19,xt,1,40*oi-10)):"toUp"===pt&&this.container.append(wt(0,q.classNames,be,30,xt,1,40*oi-10)),"toRight"===Bt?"toDown"===pt?this.container.append(wt(0,q.classNames,be,19,xt,qe-xt,1)):"toUp"===pt&&(this.container.append(wt(0,q.classNames,be,20,xt,1,10)),this.container.append(wt(0,q.classNames,be,20,xt,qe-xt,1))):"toLeft"===Bt&&("toDown"===pt?(this.container.append(wt(0,q.classNames,be,0,xt,1,8)),this.container.append(wt(0,q.classNames,be,8,qe,xt-qe,1)),this.container.append(wt(0,q.classNames,be,8,qe,1,11))):"toUp"===pt&&(this.container.append(wt(0,q.classNames,be,30,qe+1,xt-qe,1)),this.container.append(wt(0,q.classNames,be,19,qe+1,1,11))))}}zt.\u0275fac=function(W){return new(W||zt)($.Y36($.zs3),$.Y36($.SBq),$.Y36(m.G),$.Y36(Se),$.Y36(x.W),$.Y36(at.V))},zt.\u0275cmp=$.Xpm({type:zt,selectors:[["wp-timeline-relations"]],features:[$.qOj],decls:1,vars:0,consts:[[1,"wp-table-timeline--relations"]],template:function(W,q){1&W&&$._UZ(0,"div",0)},encapsulation:2}),(0,a.gn)([(0,C.W)(),(0,a.w6)("design:type",re.q)],zt.prototype,"querySpace",void 0);const Kt="wp-timeline--static-element";class Rt extends class{constructor(){}render(W){const q=document.createElement("div");return q.id=this.identifier,q.classList.add(...this.classNames),this.finishElement(q,W)}get classNames(){return[Kt]}}{finishElement(W,q){const le=q.now.diff(q.dateDisplayStart,"days"),be=l().hour()/24;return W.style.left=(0,E.jr)(q,le+be),W}get identifier(){return"wp-timeline-static-element-today-line"}}class Mt{constructor(W,q,le){this.states=q,this.workPackageTimelineTableController=le,this.$element=W.nativeElement,this.elements=[new Rt]}ngOnInit(){this.container=this.$element.querySelector(".wp-table-timeline--static-elements"),this.workPackageTimelineTableController.onRefreshRequested("static elements",W=>this.update(W))}update(W){this.removeAllVisibleElements(),this.renderElements(W)}removeAllVisibleElements(){this.container.querySelectorAll(`.${Kt}`).forEach(W=>W.remove())}renderElements(W){for(const q of this.elements)this.container.appendChild(q.render(W))}}Mt.\u0275fac=function(W){return new(W||Mt)($.Y36($.SBq),$.Y36(m.G),$.Y36(Se))},Mt.\u0275cmp=$.Xpm({type:Mt,selectors:[["wp-timeline-static-elements"]],decls:1,vars:0,consts:[[1,"wp-table-timeline--static-elements"]],template:function(W,q){1&W&&$._UZ(0,"div",0)},encapsulation:2});class Ot{constructor(W,q,le){this.elementRef=W,this.wpTimeline=q,this.weekdaysService=le}ngAfterViewInit(){const W=jQuery(this.elementRef.nativeElement);this.gridContainer=W.find(".wp-table-timeline--grid"),this.wpTimeline.onRefreshRequested("grid",q=>this.refreshView(q))}refreshView(W){this.renderLabels(W)}renderLabels(W){switch(this.gridContainer.empty(),W.settings.zoomLevel){case"days":this.renderLabelsDays(W);break;case"weeks":this.renderLabelsWeeks(W);break;case"months":this.renderLabelsMonths(W);break;case"quarters":this.renderLabelsQuarters(W);break;case"years":this.renderLabelsYears(W);break;default:return}this.activeZoomLevel=W.settings.zoomLevel}renderLabelsDays(W){this.renderTimeSlices(W,"day",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.style.paddingTop="1px",this.checkForNonWorkingDayHighlight(q,le)}),this.renderTimeSlices(W,"year",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--grid-element_highlight"),le.style.zIndex="2"})}renderLabelsWeeks(W){this.renderTimeSlices(W,"day",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{this.checkForNonWorkingDayHighlight(q,le)}),this.renderTimeSlices(W,"week",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--grid-element_highlight")}),this.renderTimeSlices(W,"year",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--grid-element_highlight"),le.style.zIndex="2"})}renderLabelsMonths(W){this.renderTimeSlices(W,"week",W.dateDisplayStart,W.dateDisplayEnd,()=>{}),this.renderTimeSlices(W,"month",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--grid-element_highlight")}),this.renderTimeSlices(W,"year",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--grid-element_highlight"),le.style.zIndex="2"})}renderLabelsQuarters(W){this.renderTimeSlices(W,"month",W.dateDisplayStart,W.dateDisplayEnd,()=>{}),this.renderTimeSlices(W,"quarter",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--grid-element_highlight")}),this.renderTimeSlices(W,"year",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--grid-element_highlight"),le.style.zIndex="2"})}renderLabelsYears(W){this.renderTimeSlices(W,"month",W.dateDisplayStart,W.dateDisplayEnd,()=>{}),this.renderTimeSlices(W,"year",W.dateDisplayStart,W.dateDisplayEnd,(q,le)=>{le.classList.add("wp-timeline--grid-element_highlight")})}renderTimeSlices(W,q,le,be,Re){const{inViewportAndBoundaries:Be,rest:$e}=(0,E.kv)(W,q,le,be);for(const[He,_t]of Be){const qe=document.createElement("div");qe.classList.add(E.mN,E.oo),qe.style.left=(0,E.jr)(W,He.diff(le,"days")),qe.style.width=(0,E.jr)(W,_t.diff(He,"days")+1),this.gridContainer[0].appendChild(qe),Re(He,qe)}setTimeout(()=>{for(const[He,_t]of $e){const qe=document.createElement("div");qe.classList.add(E.mN,E.oo),qe.style.left=(0,E.jr)(W,He.diff(le,"days")),qe.style.width=(0,E.jr)(W,_t.diff(He,"days")+1),this.gridContainer[0].appendChild(qe),Re(He,qe)}},0)}checkForNonWorkingDayHighlight(W,q){const le=W.toDate();this.weekdaysService.isNonWorkingDay(le)&&(q.classList.add("wp-timeline--non-working-day"),q.dataset.qaSelector=`wp-timeline--non-working-day_${le.getDate()}-${le.getMonth()+1}-${le.getFullYear()}`)}}Ot.\u0275fac=function(W){return new(W||Ot)($.Y36($.SBq),$.Y36(Se),$.Y36(y.u))},Ot.\u0275cmp=$.Xpm({type:Ot,selectors:[["wp-timeline-grid"]],decls:1,vars:0,consts:[[1,"wp-table-timeline--grid"]],template:function(W,q){1&W&&$._UZ(0,"div",0)},encapsulation:2});var St=t(31283),ti=t(18236),qt=(t(84481),t(51017)),Qt=t(3742),Gt=t(2775);class ii{constructor(W,q){this.I18n=W,this.panelCtrl=q}ngOnInit(){this.text={remove:this.I18n.t("js.label_remove_watcher",{name:this.watcher.name})}}remove(){this.panelCtrl.removeWatcher(this.watcher)}}ii.\u0275fac=function(W){return new(W||ii)($.Y36(c.D),$.Y36(ti.h))},ii.\u0275cmp=$.Xpm({type:ii,selectors:[["op-wp-watcher-entry"]],inputs:{watcher:"watcher"},decls:5,vars:3,consts:[["opFocusWithin","button",1,"op-wp-watcher","form--selected-value--container"],[1,"op-wp-watcher--form","form--selected-value"],["size","mini","data-qa-selector","op-wp-watcher-name",3,"principal","link"],["type","button",1,"spot-link","form--selected-value--remover",3,"title","click"],["icon-classes","icon-remove"]],template:function(W,q){1&W&&($.TgZ(0,"div",0),$.TgZ(1,"span",1),$._UZ(2,"op-principal",2),$.qZA(),$.TgZ(3,"button",3),$.NdJ("click",function(){return q.remove()}),$._UZ(4,"op-icon",4),$.qZA(),$.qZA()),2&W&&($.xp6(2),$.Q6J("principal",q.watcher)("link",!0),$.xp6(1),$.Q6J("title",q.text.remove))},directives:[qt.N,Qt.N,Gt.o],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-watcher--form[_ngcontent-%COMP%]{display:inline-block;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}"],changeDetection:0});var Jt=t(97779),Ce=t(82271),N=t(72184);class Q{constructor(W,q,le,be,Re,Be,$e,He){this.injector=W,this.elementRef=q,this.querySpace=le,this.states=be,this.schemaCache=Re,this.wpTableColumns=Be,this.wpTableSums=$e,this.I18n=He,this.isHidden=!0,this.text={sum:He.t("js.label_total_sum")}}ngAfterViewInit(){this.element=this.elementRef.nativeElement,(0,oe.aj)([this.wpTableColumns.live$(),this.wpTableSums.live$(),this.querySpace.results.values$()]).pipe((0,r.R)(this.querySpace.stopAllSubscriptions)).subscribe(([W,q,le])=>{this.isHidden=!q,q&&le.sumsSchema?this.schemaCache.ensureLoaded(le.sumsSchema.href).then(be=>{this.refresh(W,le,be)}):this.clear()})}clear(){this.element.innerHTML=""}refresh(W,q,le){this.clear(),this.render(W,q,le)}render(W,q,le){this.groupSumsBuilder=new N.L(this.injector,this.workPackageTable),this.groupSumsBuilder.text=this.text,this.groupSumsBuilder.renderColumns(q.totalSums,this.element)}}Q.\u0275fac=function(W){return new(W||Q)($.Y36($.zs3),$.Y36($.SBq),$.Y36(re.q),$.Y36(m.G),$.Y36(b.y),$.Y36(xe.i),$.Y36(Ce.X),$.Y36(c.D))},Q.\u0275dir=$.lG2({type:Q,selectors:[["","wpTableSumsRow",""]],hostVars:2,hostBindings:function(W,q){2&W&&$.ekj("-hidden",q.isHidden)},inputs:{workPackageTable:["wpTableSumsRow-table","workPackageTable"]}});var je=t(5275),Ee=t(74961),ht=t(97354),kt=t(84939),si=t(54892),Wt=t(74012),ri=t(70233),Qi=(t(24897),t(55977)),_i=t(23893),bi=t(8403),Ke=t(97248),Oe=t(32869),ve=(t(17577),t(10190)),pe=t(54364),ue=t(166);function Ze(We,W){if(1&We&&($.TgZ(0,"div",4),$.TgZ(1,"div",5),$._UZ(2,"h3",6),$.qZA(),$.qZA()),2&We){const q=$.oxw(2);$.xp6(2),$.Q6J("textContent",q.group.name)}}const Ge=function(We){return{actionsColumnEnabled:!0,hierarchyToggleEnabled:!1,inlineCreateEnabled:!0,compactTableStyle:!0,columnMenuEnabled:!1,contextMenuEnabled:!1,projectIdentifier:We,projectContext:!1}};function ft(We,W){if(1&We){const q=$.EpF();$.ynx(0),$.YNc(1,Ze,3,1,"div",1),$.TgZ(2,"wp-embedded-table",2,3),$.NdJ("onQueryLoaded",function(be){return $.CHM(q),$.oxw().handleQueryLoaded(be)}),$.qZA(),$.BQk()}if(2&We){const q=$.oxw();$.xp6(1),$.Q6J("ngIf",q.group),$.xp6(1),$.Q6J("initialLoadingIndicator",!1)("queryProps",q.queryProps)("tableActions",q.tableActions)("configuration",$.VKq(5,Ge,q.idFromLink(q.workPackage.project.href)))}}class Pt extends Ke.y{constructor(W,q,le,be,Re,Be,$e){super(Re),this.PathHelper=W,this.wpInlineCreate=q,this.wpRelations=le,this.halEvents=be,this.queryUrlParamsHelper=Re,this.notificationService=Be,this.I18n=$e,this.tableActions=[_i.g.factoryFor("remove-relation-action",this.I18n.t("js.relation_buttons.remove"),He=>{!this.embeddedTable||(this.embeddedTable.loadingIndicator=this.wpRelations.require(He.id).then(()=>this.wpInlineCreate.remove(this.workPackage,He)).then(()=>this.refreshTable()).catch(_t=>this.notificationService.handleRawError(_t,this.workPackage)))},He=>!!He.changeParent)],this.idFromLink=ve.Z}ngOnInit(){const W=this.getRelationTypeFromQuery();this.wpInlineCreate.referenceTarget=this.workPackage,this.wpInlineCreate.relationType=W,this.queryProps=this.buildQueryProps(),this.wpInlineCreate.newInlineWorkPackageCreated.pipe(this.untilDestroyed()).subscribe(q=>this.addRelation(q)),this.wpRelations.observe(this.workPackage.id).pipe((0,d.h)(q=>!_.isEmpty(q)),this.untilDestroyed()).subscribe(()=>this.refreshTable())}addRelation(W){this.wpInlineCreate.add(this.workPackage,W).then(()=>{this.halEvents.push(this.workPackage,{eventType:"association",relatedWorkPackage:W,relationType:this.getRelationTypeFromQuery()})}).catch(q=>this.notificationService.handleRawError(q,this.workPackage))}getRelationTypeFromQuery(){return this.group.relationType}}Pt.\u0275fac=function(W){return new(W||Pt)($.Y36(ri.j),$.Y36(bi.m),$.Y36(at.V),$.Y36(ce.J),$.Y36(Qi.Z),$.Y36(se.q),$.Y36(c.D))},Pt.\u0275cmp=$.Xpm({type:Pt,selectors:[["wp-relation-query"]],inputs:{workPackage:"workPackage",query:"query",group:"group"},features:[$._Bn([{provide:bi.m,useClass:Oe.x}]),$.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","attributes-group--header",4,"ngIf"],[3,"initialLoadingIndicator","queryProps","tableActions","configuration","onQueryLoaded"],["embeddedTable",""],[1,"attributes-group--header"],[1,"attributes-group--header-container"],[1,"attributes-group--header-text",3,"textContent"]],template:function(W,q){1&W&&$.YNc(0,ft,4,7,"ng-container",0),2&W&&$.Q6J("ngIf",!q.hidden)},directives:[pe.O5,ue.Z],encapsulation:2});var yt=t(19866),Lt=t(91488),Xt=t(70795);class At{constructor(W,q,le,be){this.I18n=W,this.injector=q,this.opModalService=le,this.opContextMenu=be,this.text={configureTable:this.I18n.t("js.toolbar.settings.configure_view")}}openTableConfigurationModal(){this.opContextMenu.close(),this.opModalService.show(nt.Q,this.injector)}}At.\u0275fac=function(W){return new(W||At)($.Y36(c.D),$.Y36($.zs3),$.Y36(ye.S),$.Y36(he.$))},At.\u0275cmp=$.Xpm({type:At,selectors:[["wp-table-config-menu"]],decls:2,vars:1,consts:[["type","button",1,"spot-link","wp-table--columns-selection",3,"title","click"],["icon-classes","icon-button icon-small icon-no-color icon-settings"]],template:function(W,q){1&W&&($.TgZ(0,"button",0),$.NdJ("click",function(){return q.openTableConfigurationModal()}),$._UZ(1,"op-icon",1),$.qZA()),2&W&&$.Q6J("title",q.text.configureTable)},directives:[Gt.o],encapsulation:2});var vt=t(71718),mi=t(55749),ai=t(37409),dn=t(74990),Zi=t(84906),Ut=t(32853),ci=t(5282),pi=t(53875);class wi{}wi.\u0275fac=function(W){return new(W||wi)},wi.\u0275mod=$.oAB({type:wi}),wi.\u0275inj=$.cJS({imports:[[pe.ez,Zi.UIRouterModule,Ut.wA,ci.l,pi.Q]]});var gi=t(45755),Ii=t(87947),Qn=(t(77180),t(61342)),Ji=t(35403),bn=t(83845),wn=t(54262);function Yi(We,W){1&We&&($.TgZ(0,"span",9),$._uU(1," *"),$.qZA())}function Jn(We,W){if(1&We&&($.TgZ(0,"div",5),$.TgZ(1,"wp-replacement-label",6),$._uU(2),$.YNc(3,Yi,2,0,"span",7),$.qZA(),$._UZ(4,"attribute-help-text",8),$.qZA()),2&We){const q=$.oxw(2).$implicit;$.xp6(1),$.Q6J("fieldName",q.name),$.xp6(1),$.hij(" ",q.label," "),$.xp6(1),$.Q6J("ngIf",q.field.required&&q.field.writable),$.xp6(1),$.Q6J("attribute",q.name)("attributeScope","WorkPackage")}}const Yn=function(We){return{"wp-edit-formattable-field":We}};function $n(We,W){if(1&We&&($.TgZ(0,"div",10),$._UZ(1,"op-editable-attribute-field",11),$.qZA()),2&We){const q=$.oxw(2).$implicit,le=$.oxw();$.xp6(1),$.Q6J("ngClass",$.VKq(4,Yn,q.field.isFormattable))("resource",le.workPackage)("isDropTarget",q.field.isFormattable)("fieldName",le.fieldName(q.name))}}function fi(We,W){if(1&We&&($.YNc(0,Jn,5,5,"div",3),$.YNc(1,$n,2,6,"div",4)),2&We){const q=$.oxw().$implicit;$.Q6J("ngIf",!q.multiple&&q.field),$.xp6(1),$.Q6J("ngIf",!q.multiple&&q.field)}}const li=function(We){return{"wp-attribute-group--attribute_span-all":We}};function pn(We,W){if(1&We&&($.TgZ(0,"div",1),$.YNc(1,fi,2,2,"ng-template",2),$.qZA()),2&We){const q=W.$implicit,le=$.oxw();$.Q6J("ngClass",$.VKq(2,li,q.spanAll)),$.xp6(1),$.Q6J("ngIf",!le.shouldHideField(q))}}class Si extends D.N{constructor(W,q,le){super(),this.I18n=W,this.wpEditForm=q,this.injector=le,this.className=!0}trackByName(W,q){return q.name}shouldHideField(W){const q=W.field||W.fields[0];return this.wpEditForm.editMode&&!q.writable}fieldName(W){return"startDate"===W?"combinedDate":W}}Si.\u0275fac=function(W){return new(W||Si)($.Y36(c.D),$.Y36(Qn.n),$.Y36($.zs3))},Si.\u0275cmp=$.Xpm({type:Si,selectors:[["wp-attribute-group"]],hostVars:2,hostBindings:function(W,q){2&W&&$.ekj("wp-attribute-group",q.className)},inputs:{workPackage:"workPackage",group:"group"},features:[$.qOj],decls:1,vars:2,consts:[["class","wp-attribute-group--attribute attributes-key-value",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"wp-attribute-group--attribute","attributes-key-value",3,"ngClass"],[3,"ngIf"],["class","attributes-key-value--key",4,"ngIf"],["class","attributes-key-value--value-container",4,"ngIf"],[1,"attributes-key-value--key"],[3,"fieldName"],["class","required",4,"ngIf"],[3,"attribute","attributeScope"],[1,"required"],[1,"attributes-key-value--value-container"],[3,"ngClass","resource","isDropTarget","fieldName"]],template:function(W,q){1&W&&$.YNc(0,pn,2,4,"div",0),2&W&&$.Q6J("ngForOf",q.group.members)("ngForTrackBy",q.trackByName)},directives:[pe.sg,pe.mk,pe.O5,Ji.L,bn.y,wn.k],styles:[".cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.wp-attribute-group{display:flex;flex-direction:row;flex-wrap:wrap;margin:0 -1.5rem;width:calc(100% + 3rem)}.wp-attribute-group--attribute{flex-basis:calc(100% - 3rem);flex-grow:0;flex-shrink:0;margin:0 1.5rem}@media screen and (min-width: 92rem),print{.wp-attribute-group--attribute{flex-basis:calc(50% - 3rem)}}.wp-attribute-group--attribute_span-all{flex-basis:calc(100% - 3rem)}\n"],encapsulation:2});var vi=t(94232);class ui extends vi.W{setValue(W,q){super.setValue(W,q),"workPackage"===W&&this.updateForm()}buildPayloadFromChanges(){const W=super.buildPayloadFromChanges();return delete W._links.project,W}}var $i=t(14274),$t=t(74603),Vn=t(76869),Ai=t(84699),qi=t(25502),Hn=t(5060);class xi{}xi.\u0275fac=function(W){return new(W||xi)},xi.\u0275mod=$.oAB({type:xi}),xi.\u0275inj=$.cJS({providers:[qi.N],imports:[[pe.ez,pi.Q,Hn.s,n.H]]});var Tn=t(92144),kn=t(4018),Pn=t(82187),zn=t(81979),ji=t(41195);function Wi(We,W){if(1&We){const q=$.EpF();$.TgZ(0,"span",9),$.NdJ("click",function(be){return $.CHM(q),$.oxw(2).toggleHierarchy(be)}),$._UZ(1,"op-icon",10),$.qZA()}if(2&We){const q=$.oxw(2);$.uIk("title",q.text.toggleHierarchy),$.xp6(1),$.MGl("icon-classes","icon ",q.hierarchyIcon,"")}}const xn=function(We,W){return[We,W]};function un(We,W){if(1&We&&($.TgZ(0,"a",11),$._uU(1),$.qZA()),2&We){const q=$.oxw(2);$.s9C("lang",q.locale),$.s9C("id",q.headerColumn.id),$.Q6J("ngClass",$.WLB(4,xn,q.directionClass&&"sort",q.directionClass)),$.xp6(1),$.Oqu(q.headerColumn.name)}}function Mi(We,W){if(1&We&&($.TgZ(0,"a"),$._uU(1),$.qZA()),2&We){const q=$.oxw(2);$.xp6(1),$.Oqu(q.headerColumn.name)}}function hi(We,W){if(1&We&&$._UZ(0,"op-icon",12),2&We){const q=$.oxw(2);$.s9C("icon-title",q.text.openMenu)}}function hn(We,W){if(1&We&&($.TgZ(0,"span",4),$.YNc(1,Wi,2,2,"span",5),$.YNc(2,un,2,7,"a",6),$.YNc(3,Mi,2,1,"a",7),$.YNc(4,hi,1,1,"op-icon",8),$.qZA()),2&We){const q=$.oxw();$.xp6(1),$.Q6J("ngIf",q.displayHierarchyIcon),$.xp6(1),$.Q6J("ngIf",q.sortable),$.xp6(1),$.Q6J("ngIf",!q.sortable),$.xp6(1),$.Q6J("ngIf",q.displayDropdownIcon)}}function Li(We,W){if(1&We&&$._UZ(0,"op-icon",12),2&We){const q=$.oxw(2);$.s9C("icon-title",q.text.openMenu)}}function Xi(We,W){if(1&We&&($.TgZ(0,"span",4),$.TgZ(1,"a"),$._UZ(2,"op-icon",13),$._uU(3),$.qZA(),$.YNc(4,Li,1,1,"op-icon",8),$.qZA()),2&We){const q=$.oxw();$.xp6(1),$.uIk("title",q.headerColumn.name),$.xp6(2),$.hij(" ",q.columnName," "),$.xp6(1),$.Q6J("ngIf",q.displayDropdownIcon)}}function _n(We,W){if(1&We&&$._UZ(0,"span",14),2&We){const q=$.oxw();$.uIk("title",q.text.sortColumn)}}function En(We,W){if(1&We&&($.TgZ(0,"a",11),$._uU(1),$.qZA()),2&We){const q=$.oxw(2);$.s9C("lang",q.locale),$.s9C("id",q.headerColumn.id),$.Q6J("ngClass",$.WLB(4,xn,q.directionClass&&"sort",q.directionClass)),$.xp6(1),$.Oqu(q.headerColumn.name)}}function Ri(We,W){if(1&We&&($.TgZ(0,"a"),$._uU(1),$.qZA()),2&We){const q=$.oxw(2);$.xp6(1),$.Oqu(q.headerColumn.name)}}function Kn(We,W){if(1&We&&$._UZ(0,"op-icon",12),2&We){const q=$.oxw(2);$.s9C("icon-title",q.text.openMenu)}}function en(We,W){if(1&We&&($.TgZ(0,"span",4),$.YNc(1,En,2,7,"a",6),$.YNc(2,Ri,2,1,"a",7),$.YNc(3,Kn,1,1,"op-icon",8),$.qZA()),2&We){const q=$.oxw();$.xp6(1),$.Q6J("ngIf",q.sortable),$.xp6(1),$.Q6J("ngIf",!q.sortable),$.xp6(1),$.Q6J("ngIf",q.displayDropdownIcon)}}class Vi extends D.N{constructor(W,q,le,be,Re,Be,$e){super(),this.wpTableHierarchies=W,this.wpTableSortBy=q,this.wpTableGroupBy=le,this.wpTableRelationColumns=be,this.elementRef=Re,this.cdRef=Be,this.I18n=$e,this.text={toggleHierarchy:this.I18n.t("js.work_packages.hierarchy.show"),openMenu:this.I18n.t("js.label_open_menu"),sortColumn:"Sorting column"}}ngAfterViewInit(){setTimeout(()=>this.initialize())}initialize(){this.element=jQuery(this.elementRef.nativeElement),(0,oe.aj)([this.wpTableSortBy.onReadyWithAvailable(),this.wpTableSortBy.live$()]).pipe(this.untilDestroyed()).subscribe(()=>{const W=this.wpTableSortBy.current[0];W&&this.headerColumn.href===W.column.href?this.currentSortDirection=W.direction:this.currentSortDirection=null,this.setActiveColumnClass(),this.sortable=this.wpTableSortBy.isSortable(this.headerColumn),this.directionClass=this.getDirectionClass(),this.cdRef.detectChanges()}),this.isHierarchyColumn="subject"===this.headerColumn.id,"sortHandle"===this.headerColumn.id&&(this.columnType="sort"),this.isHierarchyColumn?this.columnType="hierarchy":"toType"===this.wpTableRelationColumns.relationColumnType(this.headerColumn)?(this.columnType="relation",this.columnName=this.headerColumn.type.name):"ofType"===this.wpTableRelationColumns.relationColumnType(this.headerColumn)&&(this.columnType="relation",this.columnName=I18n.t(`js.relation_labels.${this.headerColumn.relationType}`)),this.isHierarchyColumn&&(this.hierarchyIcon="icon-hierarchy",this.isHierarchyDisabled=this.wpTableGroupBy.isEnabled,this.wpTableGroupBy.live$().pipe(this.untilDestroyed()).subscribe(()=>{this.isHierarchyDisabled=this.wpTableGroupBy.isEnabled,this.cdRef.detectChanges()}),this.wpTableHierarchies.live$().pipe(this.untilDestroyed()).subscribe(()=>{this.setHierarchyIcon(),this.cdRef.detectChanges()}),this.setHierarchyIcon()),this.cdRef.detectChanges()}get displayDropdownIcon(){return this.table&&this.table.configuration.columnMenuEnabled}get displayHierarchyIcon(){return this.table&&this.table.configuration.hierarchyToggleEnabled}toggleHierarchy(W){return this.wpTableHierarchies.toggleState()&&this.wpTableGroupBy.disable(),this.setHierarchyIcon(),W.stopPropagation(),!1}setHierarchyIcon(){this.wpTableHierarchies.isEnabled?(this.text.toggleHierarchy=I18n.t("js.work_packages.hierarchy.hide"),this.hierarchyIcon="icon-hierarchy"):(this.text.toggleHierarchy=I18n.t("js.work_packages.hierarchy.show"),this.hierarchyIcon="icon-no-hierarchy")}getDirectionClass(){if(!this.currentSortDirection)return"";switch(this.currentSortDirection.href){case mt.S9:return"asc";case mt.iV:return"desc";default:return""}}setActiveColumnClass(){this.element.toggleClass("active-column",!!this.currentSortDirection)}}Vi.\u0275fac=function(W){return new(W||Vi)($.Y36(lt.Y),$.Y36(Qe.q),$.Y36(De.w),$.Y36(ji.a),$.Y36($.SBq),$.Y36($.sBO),$.Y36(c.D))},Vi.\u0275cmp=$.Xpm({type:Vi,selectors:[["sortHeader"]],inputs:{headerColumn:"headerColumn",locale:"locale",table:"table"},features:[$.qOj],decls:5,vars:4,consts:[[1,"generic-table--sort-header-outer",3,"ngSwitch"],["class","generic-table--sort-header",4,"ngSwitchCase"],["class","draggable-table--sort-header",4,"ngSwitchCase"],["class","generic-table--sort-header",4,"ngSwitchDefault"],[1,"generic-table--sort-header"],["class","hierarchy-header--icon","tabindex","-1","aria-hidden","true",3,"click",4,"ngIf"],["href","#","lang-attribute","",3,"ngClass","lang","id",4,"ngIf"],[4,"ngIf"],["icon-classes","dropdown-indicator icon-small icon-pulldown",3,"icon-title",4,"ngIf"],["tabindex","-1","aria-hidden","true",1,"hierarchy-header--icon",3,"click"],[3,"icon-classes"],["href","#","lang-attribute","",3,"ngClass","lang","id"],["icon-classes","dropdown-indicator icon-small icon-pulldown",3,"icon-title"],["icon-classes","icon-context icon-relations relations-header--icon"],[1,"draggable-table--sort-header"]],template:function(W,q){1&W&&($.TgZ(0,"div",0),$.YNc(1,hn,5,4,"span",1),$.YNc(2,Xi,5,3,"span",1),$.YNc(3,_n,1,1,"span",2),$.YNc(4,en,4,3,"span",3),$.qZA()),2&W&&($.Q6J("ngSwitch",q.columnType),$.xp6(1),$.Q6J("ngSwitchCase","hierarchy"),$.xp6(1),$.Q6J("ngSwitchCase","relation"),$.xp6(1),$.Q6J("ngSwitchCase","sort"))},directives:[pe.RF,pe.n9,pe.ED,pe.O5,Gt.o,pe.mk],encapsulation:2});var tn=t(1707),On=t(90127),Mn=t(55216);class Ti{constructor(W){Ti.bootstrapAttributeGroups(W)}static bootstrapAttributeGroups(W){if(this.bootstrapAttributeGroupsCalled)return;this.bootstrapAttributeGroupsCalled=!0;const q=W.get(h.$);q.register("attributeGroupComponent",(le,be)=>"WorkPackageFormAttributeGroup"===le.type?Si:(0,Ai.Z)(be)||"WorkPackageFormChildrenQueryGroup"!==le.type?(0,Ai.Z)(be)||"WorkPackageFormRelationQueryGroup"!==le.type?null:Pt:Wt.u),q.register("workPackageAttachmentUploadComponent",()=>$i.s),q.register("workPackageAttachmentListComponent",()=>$t.c),q.register("halResourceChangesetClass",le=>{switch(le._type){case"WorkPackage":return mi.G;case"TimeEntry":return ui;default:return null}})}}Ti.bootstrapAttributeGroupsCalled=!1,Ti.\u0275fac=function(W){return new(W||Ti)($.LFG($.zs3))},Ti.\u0275mod=$.oAB({type:Ti}),Ti.\u0275inj=$.cJS({providers:[se.q,je.W,Ee.Q,b.y,yt.r,ht.R,at.V,si.a,at.V,kt.W,Vn.$,ce.J,Tn.s,Pn.X,kn.l],imports:[[n.H,e.E,Jt.$,St.Z,Xt.w,vt.OpenprojectProjectsModule,p.K,dn.C,wi,gi.i,ci.l,xi]]}),$.B6R(G.c,[pe.O5,pe.sg,zn.K,Gt.o,pe.mk,Vi,Fe,At,Q,ot.I,Ii.H,Se],[]),$.B6R(Se,[Te,Mt,Ot,zt],[]),$.B6R(ti.h,[pe.O5,pe.mk,pe.sg,ii,tn._Y,tn.JL,tn.F,On.U],[]),$.B6R(Lt.x,[pe.mk,pe.O5,Ut.B5,Ut.oc,pe.sg,ai.P,Mn.S],[])},57973:(te,M,t)=>{"use strict";t.d(M,{r:()=>j});var n=t(3786),e=t(57810),p=t(34520),h=t(53466),c=t(67727),i=t(62964),l=t(91654),r=t(29161),d=t(96617),f=t(77355),a=t(83635),m=t(77434),v=t(48934),C=t(47775),u=t(2316),k=t(54364),x=t(77616),b=t(84906),y=t(81628),P=t(32853);function E(B,J){if(1&B&&u._UZ(0,"op-back-button",11),2&B){const R=u.oxw();u.Q6J("customBackMethod",R.backButtonCallback)}}function T(B,J){if(1&B&&(u.TgZ(0,"li",15),u._UZ(1,"ndc-dynamic",16),u.qZA()),2&B){const R=u.oxw().$implicit,F=u.oxw(2);u.Q6J("ngClass",R.containerClasses),u.xp6(1),u.Q6J("ndcDynamicComponent",R.component)("ndcDynamicInputs",R.inputs)("ndcDynamicInjector",F.injector)("ndcDynamicOutputs",R.outputs)}}function O(B,J){if(1&B&&(u.ynx(0),u.YNc(1,T,2,5,"li",14),u.BQk()),2&B){const R=J.$implicit;u.xp6(1),u.Q6J("ngIf",!R.show||R.show())}}function I(B,J){if(1&B&&(u.TgZ(0,"ul",12),u.YNc(1,O,2,1,"ng-container",13),u.qZA()),2&B){const R=u.oxw();u.xp6(1),u.Q6J("ngForOf",R.toolbarButtonComponents)}}function Z(B,J){if(1&B&&u._UZ(0,"ndc-dynamic",17),2&B){const R=u.oxw();u.Q6J("ndcDynamicComponent",R.filterContainerDefinition.component)("ndcDynamicInputs",R.filterContainerDefinition.inputs)("ndcDynamicOutputs",R.filterContainerDefinition.outputs)("ndcDynamicInjector",R.injector)}}class j extends p._{constructor(){super(...arguments),this.text={jump_to_pagination:this.I18n.t("js.work_packages.jump_marks.pagination"),text_jump_to_pagination:this.I18n.t("js.work_packages.jump_marks.label_pagination")},this.showToolbar=!1,this.toolbarButtonComponents=[],this.filterAllowed=!0,this.currentPartition="-split",this.filterContainerDefinition={component:m.J},this.inviteModal=a.E}ngOnInit(){super.ngOnInit(),this.showToolbarSaveButton=!!this.$state.params.query_props,this.setPartition(this.$state.current),this.removeTransitionSubscription=this.$transitions.onSuccess({},J=>{const R=J.params("to"),F=J.to();this.showToolbarSaveButton=!!R.query_props,this.setPartition(F);const Y=this.querySpace.query.value;Y&&this.shouldUpdateHtmlTitle()&&this.titleService.setFirstPart(this.queryTitle(Y)),this.cdRef.detectChanges()}),this.loadInitialQuery(),this.setupInformationLoadedListener(),this.queryParamListener.observe$.pipe(this.untilDestroyed()).subscribe(()=>{this.currentQuery=void 0,this.refresh(!0,!0)}),this.querySpace.query.values$().pipe(this.untilDestroyed()).subscribe(J=>{this.updateTitle(J),this.currentQuery=J})}setPartition(J){this.currentPartition=J.data&&J.data.partition?J.data.partition:"-split"}setupInformationLoadedListener(){this.querySpace.initialized.values$().pipe((0,h.q)(1)).subscribe(()=>{this.showToolbar=!0,this.cdRef.detectChanges()})}ngOnDestroy(){super.ngOnDestroy(),this.removeTransitionSubscription(),this.queryParamListener.removeQueryChangeListener()}changeChangesFromTitle(J){this.currentQuery&&(0,v.Z)(this.currentQuery)?this.updateTitleName(J):this.wpListService.create(this.currentQuery,J).finally(()=>{this.toolbarDisabled=!1})}updateTitleName(J){this.toolbarDisabled=!0,this.currentQuery.name=J,this.wpListService.save(this.currentQuery).finally(()=>{this.toolbarDisabled=!1})}updateTitle(J){!J||(this.selectedTitle=this.queryTitle(J),this.titleEditingEnabled=this.authorisationService.can("query","updateImmediately"),this.shouldUpdateHtmlTitle()&&this.titleService.setFirstPart(this.selectedTitle))}refresh(J=!1,R=!1){let F=this.loadQuery(R);return J?(F=F.then(Y=>(this.wpStatesInitialization.initialize(Y,Y.results),this.additionalLoadingTime().then(()=>Y))),this.loadingIndicator=F):F=F.then(Y=>(this.wpStatesInitialization.initialize(Y,Y.results),Y)),F}openInviteUserModal(){this.opModalService.show(this.inviteModal,"global")}loadQuery(J=!1){let R;const F=this.currentQuery;if(J||!F)R=this.loadFirstPage();else{const Y=this.wpListService.getPaginationInfo();R=this.wpListService.loadQueryFromExisting(F,Y,this.projectIdentifier).toPromise()}return R}loadFirstPage(){return this.currentQuery?this.wpListService.reloadQuery(this.currentQuery,this.projectIdentifier).toPromise():this.wpListService.loadCurrentQueryFromParams(this.projectIdentifier)}additionalLoadingTime(){return Promise.resolve()}set loadingIndicator(J){this.loadingIndicatorService.table.promise=J}shouldUpdateHtmlTitle(){return!0}staticQueryName(J){return this.opStaticQueries.getStaticName(J)}loadInitialQuery(){const J=!this.querySpace.initialized.hasValue();this.loadingIndicator=this.loadQuery(J)}queryTitle(J){return(0,v.Z)(J)?J.name:this.staticQueryName(J)}}j.\u0275fac=function(){let B;return function(R){return(B||(B=u.n5z(j)))(R||j)}}(),j.\u0275cmp=u.Xpm({type:j,selectors:[["ng-component"]],features:[u._Bn([{provide:c.W,useClass:i.q},l.E]),u.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(J,R){1&J&&(u.TgZ(0,"div",0),u.TgZ(1,"div",1),u.TgZ(2,"div",2),u.YNc(3,E,1,1,"op-back-button",3),u.TgZ(4,"editable-toolbar-title",4),u.NdJ("onSave",function(Y){return R.changeChangesFromTitle(Y)})("onEmptySubmit",function(){return R.updateTitleName("")}),u.qZA(),u.YNc(5,I,2,1,"ul",5),u.qZA(),u.qZA(),u.TgZ(6,"div",6),u.YNc(7,Z,1,4,"ndc-dynamic",7),u.qZA(),u.TgZ(8,"div",8),u._UZ(9,"div",9),u._UZ(10,"div",10),u.qZA(),u.qZA()),2&J&&(u.Q6J("ngClass",R.currentPartition),u.xp6(3),u.Q6J("ngIf",R.backButtonCallback),u.xp6(1),u.Q6J("title",R.selectedTitle)("inFlight",R.toolbarDisabled)("showSaveCondition",R.showToolbarSaveButton)("editable",R.titleEditingEnabled),u.xp6(1),u.Q6J("ngIf",R.showToolbar),u.xp6(2),u.Q6J("ngIf",R.filterContainerDefinition))},directives:[k.mk,k.O5,x.s5,b.UIView,y.W,k.sg,P.B5,P.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}"],changeDetection:0}),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",d.D)],j.prototype,"I18n",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",e.V)],j.prototype,"titleService",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",l.E)],j.prototype,"queryParamListener",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",f.S)],j.prototype,"opModalService",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",C.UIRouterGlobals)],j.prototype,"uiRouterGlobals",void 0)},70482:(te,M,t)=>{"use strict";function n(e,p="details"){return`${e.current.data.baseRoute||""}.${p}`}t.d(M,{W:()=>n})},46430:(te,M,t)=>{"use strict";t.d(M,{Z:()=>x});var n=t(39410),e=t(2316),p=t(54364),h=t(61342),c=t(92092),i=t(77180),l=t(66979),r=t(87947);const d=function(){return["status","type"]};function f(b,y){if(1&b){const P=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"edit-form",2),e.NdJ("onSaved",function(T){return e.CHM(P),e.oxw().onSaved(T)}),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e._UZ(4,"wp-type-status",5),e.TgZ(5,"div",6),e.TgZ(6,"a",7),e.NdJ("click",function(){return e.CHM(P),e.oxw().switchToFullscreen()}),e._UZ(7,"span",8),e.qZA(),e.qZA(),e.qZA(),e._UZ(8,"wp-single-view",9),e.qZA(),e.TgZ(9,"div",10),e.TgZ(10,"wp-edit-actions-bar",11),e.NdJ("onCancel",function(){return e.CHM(P),e.oxw().cancelAndBackToList()}),e.qZA(),e.qZA(),e.TgZ(11,"div",12),e._UZ(12,"wp-resizer",13),e.qZA(),e.qZA(),e.qZA()}if(2&b){const P=e.oxw();e.xp6(1),e.Q6J("resource",P.newWorkPackage)("skippedFields",e.DdM(8,d))("inEditMode",!0),e.xp6(3),e.Q6J("workPackage",P.newWorkPackage),e.xp6(4),e.Q6J("workPackage",P.newWorkPackage)("showProject",P.copying),e.xp6(4),e.Q6J("elementClass","work-packages-partitioned-page--content-right")("localStorageKey","openProject-splitViewFlexBasis")}}class a extends n.I{}a.\u0275fac=function(){let b;return function(P){return(b||(b=e.n5z(a)))(P||a)}}(),a.\u0275cmp=e.Xpm({type:a,selectors:[["wp-new-split-view"]],features:[e.qOj],decls:1,vars:1,consts:[["class","work-packages--details work-packages--new",4,"ngIf"],[1,"work-packages--details","work-packages--new"],[3,"resource","skippedFields","inEditMode","onSaved"],[1,"work-packages--details-content","-create-mode"],[1,"work-packages--new-details-header"],[3,"workPackage"],[1,"wp--details--switch-fullscreen-wrapper"],[1,"work-packages-show-view-button","wp--details--switch-fullscreen",3,"click"],[1,"icon-context","icon-to-fullscreen"],[3,"workPackage","showProject"],[1,"work-packages--details-toolbar-container"],[3,"onCancel"],[1,"work-packages--details--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"]],template:function(y,P){1&y&&e.YNc(0,f,13,9,"div",0),2&y&&e.Q6J("ngIf",P.newWorkPackage)},directives:[p.O5,h.n,c.E,i.G,l.Y,r.H],encapsulation:2,changeDetection:0});var m=t(38421),v=t(98722);const C=function(){return["status","type"]};function u(b,y){if(1&b){const P=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"edit-form",2),e.NdJ("onSaved",function(T){return e.CHM(P),e.oxw().onSaved(T)}),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e._UZ(4,"wp-type-status",5),e.TgZ(5,"div",6),e.TgZ(6,"a",7),e.NdJ("click",function(){return e.CHM(P),e.oxw().switchToFullscreen()}),e._UZ(7,"span",8),e.qZA(),e.qZA(),e.qZA(),e._UZ(8,"wp-single-view",9),e.qZA(),e.TgZ(9,"div",10),e.TgZ(10,"wp-edit-actions-bar",11),e.NdJ("onCancel",function(){return e.CHM(P),e.oxw().cancelAndBackToList()}),e.qZA(),e.qZA(),e.TgZ(11,"div",12),e._UZ(12,"wp-resizer",13),e.qZA(),e.qZA(),e.qZA()}if(2&b){const P=e.oxw();e.xp6(1),e.Q6J("resource",P.newWorkPackage)("skippedFields",e.DdM(8,C))("inEditMode",!0),e.xp6(3),e.Q6J("workPackage",P.newWorkPackage),e.xp6(4),e.Q6J("workPackage",P.newWorkPackage)("showProject",P.copying),e.xp6(4),e.Q6J("elementClass","work-packages-partitioned-page--content-right")("localStorageKey","openProject-splitViewFlexBasis")}}class k extends v.H{}function x(b,y,P,E=a,T,O=!0,I=b){return[{name:`${I}.details`,url:"/details/{workPackageId:[0-9]+}",redirectTo:B=>{const J=B.params("to");return{state:`${I}.details.tabs`,params:Object.assign(Object.assign({},J),{tabIdentifier:"overview"})}},reloadOnSearch:!1,data:{bodyClasses:"router--work-packages-partitioned-split-view-details",menuItem:y,baseRoute:b,newRoute:`${I}.new`,partition:T?"-left-only":"-split",mobileAlternative:O?"work-packages.show":void 0},views:T?{"content-left@^.^":{component:P}}:{"content-right@^.^":{component:P}}},{name:`${I}.details.tabs`,url:"/:tabIdentifier",component:m.t,data:{baseRoute:b,menuItem:y,parent:`${I}.details`,mobileAlternative:O?"work-packages.show":void 0}},{name:`${I}.new`,url:"/create_new?{type:[0-9]+}&{parent_id:[0-9]+}",reloadOnSearch:!1,params:{defaults:{value:null}},data:{partition:"-split",allowMovingInEditMode:!0,bodyClasses:"router--work-packages-partitioned-split-view-new",baseRoute:b,parent:b,mobileAlternative:O?"work-packages.show":void 0},views:{"content-right@^.^":{component:E}}},{name:`${I}.copy`,url:"/details/{copiedFromWorkPackageId:[0-9]+}/copy",views:{"content-right@^.^":{component:k}},reloadOnSearch:!1,data:{baseRoute:b,parent:b,allowMovingInEditMode:!0,bodyClasses:"router--work-packages-partitioned-split-view",menuItem:y,partition:"-split",mobileAlternative:O?"work-packages.show":void 0}}]}k.\u0275fac=function(){let b;return function(P){return(b||(b=e.n5z(k)))(P||k)}}(),k.\u0275cmp=e.Xpm({type:k,selectors:[["wp-copy-split-view"]],features:[e.qOj],decls:1,vars:1,consts:[["class","work-packages--details work-packages--new",4,"ngIf"],[1,"work-packages--details","work-packages--new"],[3,"resource","skippedFields","inEditMode","onSaved"],[1,"work-packages--details-content","-create-mode"],[1,"work-packages--new-details-header"],[3,"workPackage"],[1,"wp--details--switch-fullscreen-wrapper"],[1,"work-packages-show-view-button","wp--details--switch-fullscreen",3,"click"],[1,"icon-context","icon-to-fullscreen"],[3,"workPackage","showProject"],[1,"work-packages--details-toolbar-container"],[3,"onCancel"],[1,"work-packages--details--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"]],template:function(y,P){1&y&&e.YNc(0,u,13,9,"div",0),2&y&&e.Q6J("ngIf",P.newWorkPackage)},directives:[p.O5,h.n,c.E,i.G,l.Y,r.H],encapsulation:2,changeDetection:0})},1813:(te,M,t)=>{"use strict";t.d(M,{p:()=>l});var n=t(58034),e=t(2316);class p extends n.a{blockedTransition(d){const f=d.to(),a=d.from(),m=d.params("from"),v=d.params("to");return a.name&&/\.(new|copy)$/.exec(a.name)?!(f.data&&f.data.allowMovingInEditMode):void 0===v.workPackageId||v.workPackageId!==m.workPackageId}}p.\u0275fac=function(){let r;return function(f){return(r||(r=e.n5z(p)))(f||p)}}(),p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac});var h=t(97047),c=t(84906);class l{}l.\u0275fac=function(d){return new(d||l)},l.\u0275cmp=e.Xpm({type:l,selectors:[["work-packages-base"]],features:[e._Bn([{provide:n.a,useClass:p}])],decls:2,vars:0,consts:[["wp-isolated-query-space","",1,"work-packages-page--ui-view"]],template:function(d,f){1&d&&(e.TgZ(0,"div",0),e._UZ(1,"ui-view"),e.qZA())},directives:[h.A,c.UIView],encapsulation:2})},73648:(te,M,t)=>{"use strict";t.d(M,{o:()=>Z});var n=t(53466),e=t(64538),p=t(45237),h=t(2888),c=t(67727),i=t(62964),l=t(96617),r=t(43440),d=t(53916),f=t(65146),a=t(74647),m=t(26942),v=t(47775),C=t(84109),u=t(2316),k=t(54364),x=t(18942),b=t(88923),y=t(2770);function P(j,B){1&j&&u._UZ(0,"div",4)}function E(j,B){if(1&j){const J=u.EpF();u.TgZ(0,"wp-table",5),u.NdJ("itemClicked",function(F){return u.CHM(J),u.oxw().handleWorkPackageClicked(F)})("stateLinkClicked",function(F){return u.CHM(J),u.oxw().openStateLink(F)}),u.qZA()}if(2&j){const J=u.oxw();u.Q6J("projectIdentifier",J.CurrentProject.identifier)("configuration",J.wpTableConfiguration)}}const T=function(j){return{"-with-resizer":j}};function O(j,B){if(1&j){const J=u.EpF();u.TgZ(0,"div",6),u.TgZ(1,"wp-grid",7),u.NdJ("itemClicked",function(F){return u.CHM(J),u.oxw().handleWorkPackageCardClicked(F)})("stateLinkClicked",function(F){return u.CHM(J),u.oxw().openStateLink(F)}),u.qZA(),u.qZA()}if(2&j){const J=u.oxw();u.Q6J("ngClass",u.VKq(3,T,J.showResizerInCardView())),u.xp6(1),u.Q6J("configuration",J.wpTableConfiguration)("showResizer",J.showResizerInCardView())}}function I(j,B){1&j&&(u.TgZ(0,"div",8),u._UZ(1,"wp-table-pagination"),u.qZA())}class Z extends m.N{constructor(B,J,R,F,Y,X,K,ie,H,ee,ce,se){super(),this.I18n=B,this.injector=J,this.$state=R,this.keepTab=F,this.querySpace=Y,this.wpViewFilters=X,this.deviceService=K,this.CurrentProject=ie,this.wpDisplayRepresentation=H,this.cdRef=ee,this.elementRef=ce,this.ngZone=se,this.text={jump_to_pagination:this.I18n.t("js.work_packages.jump_marks.pagination"),text_jump_to_pagination:this.I18n.t("js.work_packages.jump_marks.label_pagination"),button_settings:this.I18n.t("js.button_settings")},this.showTableView=!0,this.tableInformationLoaded=!1,this.noResults=!1,this.showResultOverlay$=this.wpViewFilters.incomplete$,this.wpTableConfiguration={dragAndDropEnabled:!0}}ngOnInit(){this.setupInformationLoadedListener(),this.querySpace.query.values$().pipe(this.untilDestroyed()).subscribe(B=>{this.updateViewRepresentation(B),this.noResults=0===B.results.total,this.cdRef.detectChanges()}),this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{const B=this.elementRef.nativeElement.querySelector(".wp-table--row.-checked"),J=this.elementRef.nativeElement.querySelector('[data-qa-selector="op-wp-single-card"].-checked');B&&B.previousSibling&&B.previousSibling.scrollIntoView({block:"start"}),J&&J.scrollIntoView({block:"start"})},0)})}setupInformationLoadedListener(){this.querySpace.initialized.values$().pipe((0,n.q)(1)).subscribe(()=>{this.tableInformationLoaded=!0,this.cdRef.detectChanges()})}showResizerInCardView(){return!1}updateViewRepresentation(B){this.showTableView=!(this.deviceService.isMobile||this.wpDisplayRepresentation.valueFromQuery(B)===h.he)}handleWorkPackageClicked(B){B.double&&this.openInFullView(B.workPackageId)}openStateLink(B){const J={workPackageId:B.workPackageId,focus:!0};"split"===B.requestedState?this.keepTab.goCurrentDetailsState(J):this.keepTab.goCurrentShowState(J)}handleWorkPackageCardClicked(B){this.deviceService.isMobile?this.openInFullView(B.workPackageId):this.handleWorkPackageClicked(B)}openInFullView(B){this.$state.go("work-packages.show",{workPackageId:B})}}Z.\u0275fac=function(B){return new(B||Z)(u.Y36(l.D),u.Y36(u.zs3),u.Y36(v.StateService),u.Y36(C.p),u.Y36(r.q),u.Y36(a.Z),u.Y36(d.U),u.Y36(f.R),u.Y36(h.ld),u.Y36(u.sBO),u.Y36(u.SBq),u.Y36(u.R0b))},Z.\u0275cmp=u.Xpm({type:Z,selectors:[["wp-list-view"]],hostAttrs:[1,"op-wp-list-view","work-packages-split-view--tabletimeline-side"],features:[u._Bn([{provide:c.W,useClass:i.q},p.j,e.h]),u.qOj],decls:5,vars:6,consts:[["class","op-wp-list-view--result-overlay",4,"ngIf"],["class","work-packages-split-view--tabletimeline-content",3,"projectIdentifier","configuration","itemClicked","stateLinkClicked",4,"ngIf"],["class","op-wp-list-view--card-view-container",3,"ngClass",4,"ngIf"],["class","work-packages-split-view--tabletimeline-footer hide-when-print",4,"ngIf"],[1,"op-wp-list-view--result-overlay"],[1,"work-packages-split-view--tabletimeline-content",3,"projectIdentifier","configuration","itemClicked","stateLinkClicked"],[1,"op-wp-list-view--card-view-container",3,"ngClass"],["resizerClass","work-packages-partitioned-page--content-right","resizerStorageKey","openProject-splitViewFlexBasis",3,"configuration","showResizer","itemClicked","stateLinkClicked"],[1,"work-packages-split-view--tabletimeline-footer","hide-when-print"]],template:function(B,J){1&B&&(u.YNc(0,P,1,0,"div",0),u.ALo(1,"async"),u.YNc(2,E,1,2,"wp-table",1),u.YNc(3,O,2,5,"div",2),u.YNc(4,I,2,0,"div",3)),2&B&&(u.Q6J("ngIf",u.lcZ(1,4,J.showResultOverlay$)&&J.showTableView),u.xp6(2),u.Q6J("ngIf",J.tableInformationLoaded&&J.showTableView),u.xp6(1),u.Q6J("ngIf",!J.showTableView),u.xp6(1),u.Q6J("ngIf",J.tableInformationLoaded))},directives:[k.O5,x.c,k.mk,b.b,y.v],pipes:[k.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-list-view--result-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;z-index:900;background-color:#fff;opacity:.5}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]{width:100%;overflow:auto;padding-bottom:5px;scrollbar-color:transparent transparent;scrollbar-width:thin}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.op-wp-list-view--card-view-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}@media screen and (min-width: 679px){.op-wp-list-view--card-view-container.-with-resizer[_ngcontent-%COMP%]{padding-left:10px}}@media screen and (max-width: 679px){.op-wp-list-view--card-view-container[_ngcontent-%COMP%]{min-width:calc(100vw + 10px)}}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]{display:flex;flex:1 1 100%;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}@media screen and (min-width: 679px){.work-packages-split-view--tabletimeline-container.-with-resizer[_ngcontent-%COMP%]{padding-left:10px}}@media screen and (max-width: 679px){.work-packages-split-view--tabletimeline-container[_ngcontent-%COMP%]{min-width:calc(100vw + 10px)}}"],changeDetection:0})},85603:(te,M,t)=>{"use strict";t.d(M,{o:()=>H});var n=t(47775),e=t(48451),p=t(87853),h=t(84732),c=t(84109),i=t(60914),l=t(1818),r=t(67727),d=t(62964),f=t(57014),a=t(82123),m=t(2316),v=t(54364),C=t(70971),u=t(87947),k=t(84312),x=t(61342),b=t(5262),y=t(46669),P=t(84906),E=t(81628),T=t(12703),O=t(96617),Z=(t(24897),t(73905)),j=t(74565),B=t(2775),J=t(31021);function R(ee,ce){if(1&ee&&m._UZ(0,"op-work-package-mark-notification-button",6),2&ee){const se=m.oxw();m.Q6J("workPackage",se.workPackage)("showWithText",!0)}}class F{constructor(ce,se){this.I18n=ce,this.halEditing=se,this.text={button_more:this.I18n.t("js.button_more")}}}function Y(ee,ce){if(1&ee&&m._UZ(0,"op-back-button",17),2&ee){const se=m.oxw(3);m.Q6J("customBackMethod",se.backToList.bind(se))}}function X(ee,ce){if(1&ee&&(m.TgZ(0,"div",7),m._UZ(1,"span",8),m.TgZ(2,"edit-form",9),m.TgZ(3,"div",10),m.TgZ(4,"div",11),m._UZ(5,"wp-breadcrumb",12),m.TgZ(6,"div",13),m.YNc(7,Y,1,1,"op-back-button",14),m._UZ(8,"wp-subject",15),m.qZA(),m.qZA(),m.qZA(),m._UZ(9,"div",16),m.qZA(),m.qZA()),2&ee){const se=m.oxw(2);m.xp6(1),m.Q6J("opAutofocus",se.shouldFocus)("textContent",se.focusAnchorLabel),m.xp6(1),m.Q6J("resource",se.workPackage),m.xp6(3),m.Q6J("workPackage",se.workPackage),m.xp6(2),m.Q6J("ngIf",se.showBackButton())}}function K(ee,ce){if(1&ee&&(m.TgZ(0,"div",18),m._UZ(1,"wp-details-toolbar",19),m.ALo(2,"async"),m.qZA()),2&ee){const se=m.oxw(2);m.xp6(1),m.Q6J("workPackage",se.workPackage)("displayNotificationsButton",m.lcZ(2,2,se.displayNotificationsButton$))}}function ie(ee,ce){if(1&ee&&(m.TgZ(0,"div",1),m._UZ(1,"op-wp-tabs",2),m.YNc(2,X,10,5,"div",3),m.YNc(3,K,3,4,"div",4),m.TgZ(4,"div",5),m._UZ(5,"wp-resizer",6),m.qZA(),m.qZA()),2&ee){const se=m.oxw();m.xp6(1),m.Q6J("workPackage",se.workPackage)("view","split"),m.xp6(1),m.Q6J("ngIf",se.workPackage),m.xp6(1),m.Q6J("ngIf",se.workPackage),m.xp6(2),m.Q6J("elementClass","work-packages-partitioned-page--content-right")("localStorageKey","openProject-splitViewFlexBasis")}}F.\u0275fac=function(ce){return new(ce||F)(m.Y36(O.D),m.Y36(T.l))},F.\u0275cmp=m.Xpm({type:F,selectors:[["wp-details-toolbar"]],inputs:{workPackage:"workPackage",displayNotificationsButton:"displayNotificationsButton"},decls:6,vars:6,consts:[[1,"work-packages--details-toolbar"],[3,"workPackage","showText"],["data-qa-selector","mark-notification-read-button",3,"workPackage","showWithText",4,"ngIf"],["wpSingleContextMenu","",1,"button","dropdown-relative",3,"wpSingleContextMenu-workPackage"],[1,"button--text",3,"textContent"],["icon-classes","button--dropdown-indicator"],["data-qa-selector","mark-notification-read-button",3,"workPackage","showWithText"]],template:function(ce,se){1&ce&&(m.TgZ(0,"div",0),m._UZ(1,"wp-watcher-button",1),m.YNc(2,R,1,2,"op-work-package-mark-notification-button",2),m.TgZ(3,"button",3),m._UZ(4,"span",4),m._UZ(5,"op-icon",5),m.qZA(),m.qZA()),2&ce&&(m.xp6(1),m.Q6J("workPackage",se.workPackage)("showText",!0),m.xp6(1),m.Q6J("ngIf",se.displayNotificationsButton),m.xp6(1),m.Q6J("wpSingleContextMenu-workPackage",se.workPackage),m.uIk("accesskey",7),m.xp6(1),m.Q6J("textContent",se.text.button_more))},directives:[Z.u,v.O5,j.B,B.o,J.q],encapsulation:2});class H extends l.e{constructor(ce,se,re,Me,Ae,Ye,ze,Xe){super(ce,ze.params.workPackageId),this.injector=ce,this.states=se,this.firstRoute=re,this.keepTab=Me,this.wpTableSelection=Ae,this.wpTableFocus=Ye,this.$state=ze,this.backRouting=Xe,this.baseRoute=this.$state.current.data.baseRoute}ngOnInit(){this.observeWorkPackage();const ce=this.$state.params.workPackageId;if(this.wpTableFocus.focusedWorkPackage)this.wpTableFocus.updateFocus(ce,!1);else{const re=this.firstRoute.name===`${this.baseRoute}.details.overview`,Me=this.firstRoute.params&&ce===this.firstRoute.params.workPackageI;this.wpTableFocus.updateFocus(ce,re&&Me)}this.wpTableSelection.isEmpty&&this.wpTableSelection.setRowState(ce,!0),this.wpTableFocus.whenChanged().pipe(this.untilDestroyed()).subscribe(re=>{ce.toString()!==re.toString()&&this.$state.includes(`${this.baseRoute}.details`)&&this.$state.go(this.$state.current.name,{workPackageId:re,focus:!1})})}get shouldFocus(){return!0===this.$state.params.focus}showBackButton(){return this.baseRoute.includes("bim")}backToList(){this.backRouting.goToBaseState()}handleLoadingError(ce){const se=this.notificationService.retrieveErrorMessage(ce);this.$state.go(this.baseRoute,{flash_message:{type:"error",message:se}})}}H.\u0275fac=function(ce){return new(ce||H)(m.Y36(m.zs3),m.Y36(p.G),m.Y36(h.p),m.Y36(c.p),m.Y36(i.J),m.Y36(e.o),m.Y36(n.StateService),m.Y36(f.Y))},H.\u0275cmp=m.Xpm({type:H,selectors:[["op-wp-split-view"]],features:[m._Bn([a.O,{provide:r.W,useClass:d.q}]),m.qOj],decls:1,vars:1,consts:[["class","work-packages--details loading-indicator--location","data-indicator-name","wpDetails",4,"ngIf"],["data-indicator-name","wpDetails",1,"work-packages--details","loading-indicator--location"],[3,"workPackage","view"],["class","work-packages--details-content work-packages-tab-view--overflow",4,"ngIf"],["class","work-packages--details-toolbar-container",4,"ngIf"],[1,"work-packages--details--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"],[1,"work-packages--details-content","work-packages-tab-view--overflow"],["tabindex","-1",1,"hidden-for-sighted",3,"opAutofocus","textContent"],[1,"work-packages--details-form",3,"resource"],[1,"work-packages--details-header"],[1,"work-packages--details-header-left"],[1,"work-packages--breadcrumb",3,"workPackage"],[1,"wp-show--header-container"],["linkClass","work-packages-back-button",3,"customBackMethod",4,"ngIf"],[1,"subject-header"],["data-notification-selector","notification-scroll-container","ui-view","",1,"work-package-details-tab"],["linkClass","work-packages-back-button",3,"customBackMethod"],[1,"work-packages--details-toolbar-container"],[3,"workPackage","displayNotificationsButton"]],template:function(ce,se){1&ce&&m.YNc(0,ie,6,6,"div",0),2&ce&&m.Q6J("ngIf",se.workPackage)},directives:[v.O5,C.e,u.H,k.U,x.n,b.f,y.x,P.UIView,E.W,F],pipes:[v.Ov],encapsulation:2,changeDetection:0})},55236:(te,M,t)=>{"use strict";t.d(M,{m:()=>e,A:()=>p});const e=new(t(2316).OlP)("CardEventHandler");class p{constructor(c){this.injector=c}attachTo(c){this.eventHandlers.map(i=>{const l=i(c);return l.eventScope(c).on(l.EVENT,l.SELECTOR,d=>{l.handleEvent(c,d)}),l})}}},82123:(te,M,t)=>{"use strict";t.d(M,{O:()=>k});var n=t(3786),e=t(19100);let h=class extends e.yh{constructor(){super({notifications:{filters:[]}})}};h=(0,n.gn)([(0,e.yC)({name:"wp-single-view"}),(0,n.w6)("design:paramtypes",[])],h);var c=t(9170),i=t(79902),l=t(33927),r=t(53466),d=t(31909),f=t(78509),a=t(60419),m=t(44838),v=t(96905),C=t(96725),u=t(2316);let k=class{constructor(b,y,P){this.actions$=b,this.currentUser$=y,this.resourceService=P,this.id="WorkPackage Activity Store",this.store=new h,this.query=new e.AE(this.store),this.selectNotifications$=this.query.select(E=>E.notifications.filters).pipe((0,c.h)(E=>E.length>0),(0,i.w)(E=>this.resourceService.collection((0,C.ZU)({filters:E})))),this.selectNotificationsCount$=this.selectNotifications$.pipe((0,l.U)(E=>E.length)),this.nonDateAlertNotificationsCount$=this.selectNotifications$.pipe((0,l.U)(E=>E.filter(T=>"dateAlert"!==T.reason)),(0,l.U)(E=>E.length)),this.hasNotifications$=this.selectNotificationsCount$.pipe((0,l.U)(E=>E>0))}get params(){return{filters:this.query.getValue().notifications.filters}}setFilters(b){const y=[["readIAN","=",!1],["resourceId","=",[b]],["resourceType","=",["WorkPackage"]]];this.store.update(({notifications:P})=>({notifications:Object.assign(Object.assign({},P),{filters:y})})),this.reload()}markAllAsRead(){const b=(0,C.ZU)({filters:this.store.getValue().notifications.filters});this.resourceService.collection(b).pipe((0,r.q)(1)).subscribe(y=>{this.actions$.dispatch((0,f.L5)({origin:this.id,notifications:y.map(P=>P.id)}))})}reload(){this.currentUser$.isLoggedIn$.pipe((0,r.q)(1),(0,c.h)(b=>b),(0,i.w)(()=>this.resourceService.fetchCollection(this.params))).subscribe()}reloadOnNotificationRead(){this.reload()}reloadOnCenterUpdate(){this.reload()}};k.\u0275fac=function(b){return new(b||k)(u.LFG(a.b),u.LFG(v.S),u.LFG(d.W))},k.\u0275prov=u.Yz7({token:k,factory:k.\u0275fac}),(0,n.gn)([(0,m.B)(f.A6),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],k.prototype,"reloadOnNotificationRead",null),(0,n.gn)([(0,m.B)(f.$v),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],k.prototype,"reloadOnCenterUpdate",null),k=(0,n.gn)([m.b,(0,n.w6)("design:paramtypes",[a.b,v.S,d.W])],k)},81691:(te,M,t)=>{"use strict";t.d(M,{G:()=>f});var n=t(43440),e=t(53457),p=t(62964),h=t(44022),c=t(33276),i=t(91923),l=t(99676),r=t(71562),d=t(2316);class f{constructor(m,v,C,u,k,x,b,y){this.querySpace=m,this.wpTableHierarchies=v,this.wpTableColumns=C,this.notificationService=u,this.halResourceService=k,this.apiV3Service=x,this.schemaCache=b,this.wpRelations=y}initialize(m,v){const C=v.elements;Promise.all([this.requireInvolvedRelations(C.map(u=>u.id)),this.requireHierarchyElements(C),this.requireSumsSchema(v)]).then(u=>{this.loadAdditional(_.flatten(u))})}loadAdditional(m){this.apiV3Service.work_packages.requireAll(m).then(()=>{this.querySpace.additionalRequiredWorkPackages.putValue(null,"All required work packages are loaded")}).catch(v=>{this.querySpace.additionalRequiredWorkPackages.putValue(null,"Failure loading required work packages"),this.notificationService.handleRawError(v)})}requireInvolvedRelations(m){return this.wpTableColumns.hasRelationColumns()?this.wpRelations.requireAll(m).then(()=>{const v=this.getInvolvedWorkPackages(m.map(C=>this.wpRelations.state(C).value));return _.flatten(v)}):Promise.resolve([])}requireHierarchyElements(m){if(!this.wpTableHierarchies.isEnabled)return Promise.resolve([]);const v=_.flatten(m.map(C=>C.ancestorIds));return Promise.resolve(v)}getInvolvedWorkPackages(m){const v=[];return _.each(m,C=>{_.each(C,u=>{v.push(u.ids.from,u.ids.to)})}),v}requireSumsSchema(m){return m.sumsSchema?this.schemaCache.ensureLoaded(m.sumsSchema.href).then(()=>[]):Promise.resolve([])}}f.\u0275fac=function(m){return new(m||f)(d.LFG(n.q),d.LFG(l.Y),d.LFG(r.i),d.LFG(p.q),d.LFG(i.u),d.LFG(c.T),d.LFG(h.y),d.LFG(e.V))},f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac})},54592:(te,M,t)=>{"use strict";t.d(M,{H:()=>r,q:()=>d});var n=t(43440),e=t(14808),p=t(53466),h=t(67202),c=t(33927),i=t(89919),l=t(2316);class r{constructor(a){this.querySpace=a,this.updatesState=(0,e.qH)(),this.pristineState=(0,e.qH)()}initialize(a,m,v){const C=this.valueFromQuery(a,m);this.pristineState.putValue(C)}update(a){this.updatesState.putValue(a)}clear(a){this.pristineState.clear(a),this.updatesState.clear(a)}live$(){return(0,i.T)(this.pristineState.values$(),this.updatesState.values$())}pristine$(){return this.pristineState.values$()}updates$(){return this.updatesState.values$()}changes$(){return this.updatesState.changes$()}onReady(){return this.pristineState.values$().pipe((0,p.q)(1),(0,h.h)(null)).toPromise()}get lastUpdatedState(){const a=(0,e.$e)(this.pristineState,this.updatesState);return(0,e.eS)(a,m=>m.pipe((0,c.U)(([v,C])=>void 0===C?v:C)))}set current(a){a?this.updatesState.putValue(a):this.updatesState.clear()}get current(){return this.lastUpdatedState.value}}r.\u0275fac=function(a){return new(a||r)(l.LFG(n.q))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac});class d extends r{}d.\u0275fac=function(){let f;return function(m){return(f||(f=l.n5z(d)))(m||d)}}(),d.\u0275prov=l.Yz7({token:d,factory:d.\u0275fac})},79174:(te,M,t)=>{"use strict";t.d(M,{q:()=>l});var n=t(61083),e=t(43440),p=t(53466),h=t(44022),c=t(54592),i=t(2316);class l extends c.H{constructor(d,f,a){super(d),this.querySpace=d,this.workPackageViewGroupByService=f,this.schemaCacheService=a,this.groupTypesWithHeaderCellsWhenCollapsed=["project"],this.isMilestone=m=>{var v;return null===(v=this.schemaCacheService.of(m))||void 0===v?void 0:v.isMilestone},this.wpTypesToShowInCollapsedGroupHeaders=[this.isMilestone]}get config(){return this.updatesState.getValueOr(this.getDefaultState())}get currentGroups(){return this.querySpace.groups.value}get allGroupsAreCollapsed(){return this.config.allGroupsAreCollapsed}get allGroupsAreExpanded(){return this.config.allGroupsAreExpanded}get currentGroupedBy(){return this.workPackageViewGroupByService.current}getDefaultState(){var d;return Object.assign({state:this.querySpace.collapsedGroups.value||{},allGroupsChanged:!1,lastChangedGroup:null,groupedBy:(null===(d=this.currentGroupedBy)||void 0===d?void 0:d.id)||null},this.getAllGroupsCollapsedState(this.currentGroups,this.querySpace.collapsedGroups.value))}toggleGroupCollapseState(d){const f=!this.config.state[d],a=Object.assign(Object.assign({},this.config.state),{[d]:f}),m=Object.assign(Object.assign(Object.assign({},this.config),{state:a,lastChangedGroup:d}),this.getAllGroupsCollapsedState(this.currentGroups,a));this.update(m)}setAllGroupsCollapseStateTo(d){const f=this.currentGroups.reduce((m,v)=>Object.assign(Object.assign({},m),{[v.identifier]:d}),{}),a=Object.assign(Object.assign({},this.config),{state:Object.assign(Object.assign({},this.config.state),f),lastChangedGroup:null,allGroupsAreCollapsed:d,allGroupsAreExpanded:!d,allGroupsChanged:!0});this.update(a)}getAllGroupsCollapsedState(d,f){let a=!1,m=!0;if(f&&(null==d?void 0:d.length)){const v=d[0].identifier,C=f[v],u=d.every(k=>null!=f[k.identifier]&&f[k.identifier]===f[v]);a=u&&C,m=u&&!C}return{allGroupsAreCollapsed:a,allGroupsAreExpanded:m}}initialize(d,f,a){this.querySpace.tableRendered.values$().pipe((0,p.q)(1)).subscribe(()=>this.update(Object.assign(Object.assign({},this.config),{allGroupsChanged:!0})))}valueFromQuery(d,f){return this.getDefaultState()}applyToQuery(d){}}l.\u0275fac=function(d){return new(d||l)(i.LFG(e.q),i.LFG(n.w),i.LFG(h.y))},l.\u0275prov=i.Yz7({token:l,factory:l.\u0275fac})},71562:(te,M,t)=>{"use strict";t.d(M,{i:()=>f});var n=t(43440),e=t(87853),p=t(70319),h=t(14808),c=t(53466),i=t(67202),l=t(91720),r=t(54592),d=t(2316);class f extends r.q{constructor(m,v){super(v),this.states=m,this.querySpace=v}initialize(m,v,C){super.initialize(m,v,C)}valueFromQuery(m){return[...m.columns]}hasChanged(m){return!this.isCurrentlyEqualTo(m.columns)}isCurrentlyEqualTo(m){const v=C=>C.map(u=>u.href);return _.isEqual(v(m),v(this.getColumns()))}applyToQuery(m){const v=this.getColumns(),C=m.columns.map(x=>x.id),u=v.map(x=>x.id);return m.columns=(0,l.FQ)(v),!(0===_.difference(u,C).length)&&this.hasRelationColumns()}hasRelationColumns(){const m=[p.L.RELATION_OF_TYPE,p.L.RELATION_TO_TYPE];return!!_.find(this.getColumns(),v=>m.indexOf(v._type)>=0)}getColumns(){return[...this.current]}index(m){return _.findIndex(this.getColumns(),v=>v.id===m)}findById(m){return _.find(this.getColumns(),v=>v.id===m)}previous(m){const v=this.index(m.id);return v<=0?null:this.getColumns()[v-1]}next(m){const v=this.index(m.id);return-1===v||this.isLast(m)?null:this.getColumns()[v+1]}isFirst(m){return 0===this.index(m.id)}isLast(m){return this.index(m.id)===this.columnCount-1}setColumns(m){this.isCurrentlyEqualTo(m)||this.update(m)}setColumnsById(m){const v=m.map(C=>_.find(this.all,u=>u.id===C));this.setColumns(_.compact(v))}moveColumn(m,v){const C=this.getColumns();v>=C.length&&(v=C.length-1),v<0&&(v=0);const u=C[m];C.splice(m,1),C.splice(v,0,u),this.setColumns(C)}shift(m,v){const C=this.index(m.id);-1!==C&&this.moveColumn(C,C+v)}addColumn(m,v){const C=this.getColumns();if(void 0===v&&(v=C.length),-1===this.index(m)){const u=_.find(this.all,k=>k.id===m);if(!u)throw new Error("Column with provided name is not found");C.splice(v,0,u),this.setColumns(C)}}removeColumn(m){const v=this.index(m.id);if(-1!==v){const C=this.getColumns();C.splice(v,1),this.setColumns(C)}}get current(){return this.lastUpdatedState.getValueOr([])}get availableState(){return this.querySpace.available.columns}get columnCount(){return this.getColumns().length}get all(){return this.availableState.getValueOr([])}get allPropertyColumns(){return this.all.filter(m=>m._type===p.L.PROPERTY)}get unused(){return _.differenceBy(this.all,this.getColumns(),"$href")}onReady(){return(0,h.$e)(this.pristineState,this.availableState).values$().pipe((0,c.q)(1),(0,i.h)(null)).toPromise()}}f.\u0275fac=function(m){return new(m||f)(d.LFG(e.G),d.LFG(n.q))},f.\u0275prov=d.Yz7({token:f,factory:f.\u0275fac})},2888:(te,M,t)=>{"use strict";t.d(M,{M5:()=>c,he:()=>i,ld:()=>l});var n=t(87853),e=t(43440),p=t(54592),h=t(2316);const c="list",i="card";class l extends p.q{constructor(d,f){super(f),this.states=d,this.querySpace=f}hasChanged(d){return this.current!==d.displayRepresentation}valueFromQuery(d){return d.displayRepresentation||null}applyToQuery(d){const{current:f}=this;return d.displayRepresentation=null===f?void 0:f,!1}get current(){return this.lastUpdatedState.getValueOr(null)}get isList(){const{current:d}=this;return!d||d===c}get isCards(){return this.current===i}setDisplayRepresentation(d){this.update(d)}}l.\u0275fac=function(d){return new(d||l)(h.LFG(n.G),h.LFG(e.q))},l.\u0275prov=h.Yz7({token:l,factory:l.\u0275fac})},74647:(te,M,t)=>{"use strict";t.d(M,{Z:()=>a});var n=t(43440),e=t(14808),p=t(87853),h=t(53466),c=t(67202),i=t(63085),l=t(91720),r=t(63588),d=t(54592),f=t(2316);class a extends d.q{constructor(v,C){super(C),this.states=v,this.querySpace=C,this.hidden=["datesInterval","precedes","follows","relates","duplicates","duplicated","blocks","blocked","partof","includes","requires","required","search","subjectOrId","subjectOr","manualSort","typeahead"],this.incomplete=(0,e.qH)(!1)}initializeFilters(v,C){const u=(0,l.FQ)(v.filters);this.availableState.putValue(C.filtersSchemas.elements),this.pristineState.putValue(u)}get isEmpty(){const{value:v}=this.lastUpdatedState;return!v||0===v.length}get availableState(){return this.querySpace.available.filters}get incomplete$(){return this.incomplete.values$()}add(v){this.updatesState.putValue([...this.rawFilters,v])}replace(v,C){const u=this.instantiate(v),k=[...this.rawFilters];C(u);const x=this.findIndex(v);-1===x?k.push(u):k.splice(x,1,u),this.update(k)}modify(v,C){const u=this.findIndex(v);if(-1===u)return!1;const k=[...this.rawFilters];return C(k[u]),this.update(k),!0}instantiate(v){const C=v instanceof r.e?v.id:v;return _.find(this.availableSchemas,k=>k.filter.allowedValues[0].id===C).getFilter()}remove(...v){const C=k=>k instanceof i.L?k.id:k,u=new Set(v.map(C));this.update(this.rawFilters.filter(k=>!u.has(C(k))))}remainingVisibleFilters(v=this.current){return this.remainingFilters(v).filter(C=>-1===this.hidden.indexOf(C.id))}get availableFilters(){return this.availableSchemas.map(v=>v.allowedFilterValue)}get availableSchemas(){return this.availableState.getValueOr([])}isComplete(v){return _.every(v,C=>C.isCompletelyDefined())}hasChanged(v){const C=u=>u.map(k=>k.$source);return!_.isEqual(C(v.filters),C(this.rawFilters))}valueFromQuery(v){}update(v){super.update(v),this.incomplete.putValue(!1)}find(v){const C=this.findIndex(v);if(-1!==C)return this.rawFilters[C]}findIndex(v){return _.findIndex(this.current,C=>C.id===v)}applyToQuery(v){return v.filters=this.cloneFilters(),!0}get current(){return[...this.rawFilters]}cloneFilters(){return(0,l.FQ)(this.rawFilters)}get rawFilters(){return this.lastUpdatedState.value||[]}get currentlyVisibleFilters(){const v=new Set(this.hidden);return v.delete("search"),_.reject(this.current,C=>v.has(C.id))}replaceIfComplete(v){this.isComplete(v)?this.update(v):this.incomplete.putValue(!0)}onReady(){return(0,e.$e)(this.pristineState,this.availableState).values$().pipe((0,h.q)(1),(0,c.h)(null)).toPromise()}remainingFilters(v=this.rawFilters){return _.differenceBy(this.availableFilters,v,C=>C.id)}isAvailable(v){return!!this.availableFilters.find(C=>C.id===v.id)}}a.\u0275fac=function(v){return new(v||a)(f.LFG(p.G),f.LFG(n.q))},a.\u0275prov=f.Yz7({token:a,factory:a.\u0275fac})},48451:(te,M,t)=>{"use strict";t.d(M,{o:()=>l});var n=t(43440),e=t(33927),p=t(83720),h=t(60914),c=t(54592),i=t(2316);class l extends c.H{constructor(d,f){super(d),this.querySpace=d,this.wpTableSelection=f}isFocused(d){return this.focusedWorkPackage===d}ifShouldFocus(d){const f=this.current;f&&f.focusAfterRender&&(d(f.workPackageId),f.focusAfterRender=!1,this.update(f))}get focusedWorkPackage(){const d=this.current;if(d)return d.workPackageId;const f=this.querySpace.results.value;return f&&f.elements.length>0?f.elements[0].id.toString():null}whenChanged(){return this.live$().pipe((0,e.U)(d=>d.workPackageId),(0,p.x)())}updateFocus(d,f=!1){this.wpTableSelection.isEmpty&&this.wpTableSelection.setRowState(d,!0),this.update({workPackageId:d,focusAfterRender:f})}valueFromQuery(d,f){}}l.\u0275fac=function(d){return new(d||l)(i.LFG(n.q),i.LFG(h.J))},l.\u0275prov=i.Yz7({token:l,factory:l.\u0275fac})},61083:(te,M,t)=>{"use strict";t.d(M,{w:()=>c});var n=t(87853),e=t(43440),p=t(54592),h=t(2316);class c extends p.q{constructor(l,r){super(r),this.states=l,this.querySpace=r}valueFromQuery(l){return l.groupBy||null}hasChanged(l){const r=d=>d?d.href:null;return!_.isEqual(r(l.groupBy),r(this.current))}applyToQuery(l){const{current:r}=this;return l.groupBy=null===r?void 0:r,!0}isGroupable(l){return!!_.find(this.available,r=>r.id===l.id)}disable(){this.update(null)}setBy(l){const r=_.find(this.available,d=>d.id===l.id);r&&this.update(r)}get current(){return this.lastUpdatedState.getValueOr(null)}get availableState(){return this.querySpace.available.groupBy}get isEnabled(){return!!this.current}get available(){return this.availableState.getValueOr([])}isCurrentlyGroupedBy(l){const r=this.current;return!(!r||r.id!==l.id)}}c.\u0275fac=function(l){return new(l||c)(h.LFG(n.G),h.LFG(e.q))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac})},16793:(te,M,t)=>{"use strict";t.d(M,{f:()=>d});var n=t(3786),e=t(99676),p=t(43440),h=t(41945),c=t(87853),i=t(2888),l=t(33276),r=t(2316);class d{constructor(a,m,v,C,u,k){this.wpViewHierarchies=a,this.wpDisplayRepresentation=m,this.states=v,this.wpRelationHierarchy=C,this.apiV3Service=u,this.querySpace=k}get applicable(){return this.wpViewHierarchies.isEnabled&&this.wpDisplayRepresentation.isList}canIndent(a){if(!a.changeParent||!this.applicable)return!1;const m=this.renderedWorkPackageIds,v=m.indexOf(a.id);if(0===v)return!1;const C=a.ancestorIds,u=C.length;if(0===u)return!0;const k=C[u-1];return m[v-1]!==k}canOutdent(a){return!(!a.changeParent||!this.applicable)&&!!a.parent}indent(a){return(0,n.mG)(this,void 0,void 0,function*(){if(!this.canIndent(a))return Promise.reject();const m=this.renderedWorkPackageIds,v=m.indexOf(a.id),C=m[v-1];let u=C;const k=yield this.apiV3Service.work_packages.id(C).get().toPromise(),x=_.difference(k.ancestorIds,a.ancestorIds);return x&&x.length>0&&(u=x[0]),this.wpRelationHierarchy.changeParent(a,u)})}outdent(a){if(!this.canOutdent(a))return Promise.reject();let m=null;const{ancestorIds:v}=a,C=v.length;return C>1&&(m=v[C-2]),this.wpRelationHierarchy.changeParent(a,m)}get renderedWorkPackageIds(){return this.querySpace.renderedWorkPackageIds.getValueOr([])}}d.\u0275fac=function(a){return new(a||d)(r.LFG(e.Y),r.LFG(i.ld),r.LFG(c.G),r.LFG(h.O),r.LFG(l.T),r.LFG(p.q))},d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac})},99676:(te,M,t)=>{"use strict";t.d(M,{Y:()=>h});class n{constructor(i){this.isVisible=!1,this.last=null,this.collapsed={},this.isVisible=i}}var e=t(54592),p=t(2316);class h extends e.q{valueFromQuery(i){const l=new n(i.showHierarchies),{current:r}=this;return r&&(l.collapsed=r.collapsed),l}hasChanged(i){return i.showHierarchies!==this.isEnabled}applyToQuery(i){return i.showHierarchies=this.isEnabled,this.isEnabled}get isEnabled(){return!(!this.current||!this.current.isVisible)}setEnabled(i=!0){const l=Object.assign(Object.assign({},this.current),{isVisible:i,last:null});this.update(l)}toggleState(){return this.setEnabled(!this.isEnabled),this.isEnabled}collapsed(i){return this.current.collapsed[i]}collapse(i){this.setState(i,!0)}expand(i){this.setState(i,!1)}toggle(i){this.setState(i,!this.collapsed(i))}setState(i,l){const r=Object.assign(Object.assign({},this.current),{last:i});r.collapsed[i]=l,this.update(r)}get current(){const i=this.lastUpdatedState.value;return void 0===i?this.initialState:(i.collapsed||(i.collapsed={}),i)}get initialState(){return new n(!1)}}h.\u0275fac=function(){let c;return function(l){return(c||(c=p.n5z(h)))(l||h)}}(),h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},84897:(te,M,t)=>{"use strict";t.d(M,{B:()=>i});var n=t(43440),e=t(87853),p=t(73881),h=t(54592),c=t(2316);class i extends h.q{constructor(r,d,f){super(f),this.states=r,this.Banners=d,this.querySpace=f}initialize(r,d,f){super.initialize(r,d,f)}shouldHighlightInline(r){return!(!this.isInline||this.Banners.eeShowBanners)&&(void 0===this.current.selectedAttributes||this.current.selectedAttributes===[]||!!_.find(this.current.selectedAttributes,d=>d.id===r))}get current(){const r=this.lastUpdatedState.getValueOr({mode:"inline"});return this.filteredValue(r)}get isInline(){return"inline"===this.current.mode}get isDisabled(){return"none"===this.current.mode}update(r){super.update(this.filteredValue(r))}valueFromQuery(r){const d={mode:r.highlightingMode||"inline",selectedAttributes:r.highlightedAttributes};return this.filteredValue(d)}hasChanged(r){return r.highlightingMode!==this.current.mode||!_.isEqual(r.highlightedAttributes,this.current.selectedAttributes)}applyToQuery(r){const{current:d}=this;return r.highlightingMode=d.mode,r.highlightedAttributes=d.selectedAttributes,!1}filteredValue(r){return _.isEmpty(r.selectedAttributes)&&(r.selectedAttributes=void 0),this.Banners.conditional(()=>{r.mode="none",r.selectedAttributes=void 0}),r}}i.\u0275fac=function(r){return new(r||i)(c.LFG(e.G),c.LFG(p.j),c.LFG(n.q))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac})},20066:(te,M,t)=>{"use strict";t.d(M,{F:()=>c});var n=t(87853),e=t(43440),p=t(54592),h=t(2316);class c extends p.q{constructor(l,r){super(r),this.states=l,this.querySpace=r}hasChanged(l){return this.current!==l.includeSubprojects}valueFromQuery(l){return l.includeSubprojects||!1}applyToQuery(l){const{current:r}=this;return l.includeSubprojects=r,!0}get current(){return this.lastUpdatedState.getValueOr(!1)}setIncludeSubprojects(l){this.update(l)}}c.\u0275fac=function(l){return new(l||c)(h.LFG(n.G),h.LFG(e.q))},c.\u0275prov=h.Yz7({token:c,factory:c.\u0275fac})},95846:(te,M,t)=>{"use strict";t.d(M,{M:()=>Y});var n=t(3786),e=t(53466),p=t(87853),h=t(43440),c=t(70233),i=t(48934),l=t(3352);const r=-2147483647,d=2147483647,a=16384;function m(X,K,ie){return void 0===X[ie]?K[ie]:X[ie]}function v(X,K,ie,H){return m(X,ie,K[H])}function P(X,K,ie,H){const ee=K.length;let ce=ie,se=H,re=Math.floor((se-ce)/(ee-1));if(re<1){if(se+ee<=d)se+=ee;else{if(!(ce-ee>=r))throw new Error("Elements cannot be moved further and no space is left. Too many elements");ce-=ee}re=Math.floor((se-ce)/(ee-1))}const Me=Object.assign({},X);for(let Ae=0;Ae<ee;Ae+=1){Me[K[Ae]]=ce+Ae*re}return Me}function E(X,K,ie){const H=function(X,K,ie){return m(X,ie,K[0]||"")||0}(X,K,ie),ee=function(X,K,ie){for(let H=K.length-1;H>=0;H-=1){const ce=m(X,ie,K[H]);if(void 0!==ce)return ce}return 0}(X,K,ie);return P(X,K,H,ee)}function T(X,K,ie,H,ee){const ce={};if(X.length<=1&&void 0===K[ie])return Object.assign(Object.assign({},ce),{[ie]:0});const se=function(X,K,ie,H,ee,ce){if(null===ee)return X;const se=v(X,K,ie,H),re=K[ee],Me=v(X,K,ie,ee);return void 0===se||void 0===Me?X:Object.assign(Object.assign({},X),{[`${ce}`]:Me,[`${re}`]:se})}(ce,X,K,H,ee,ie);if(null!==ee&&1===Math.abs(ee-H)&&ce!==se)return se;if(0===H)return function(X,K,ie,H,ee){const ce=v(X,K,ie,H+1);return void 0===ce?Object.assign(Object.assign({},X),{[ee]:0}):Object.assign(Object.assign({},X),{[ee]:ce-a/2})}(se,X,K,H,ie);const{delta:re,predecessorPosition:Me}=function(X,K,ie,H){let ee=0-a;const ce=Object.assign({},X);for(let se=0;se<H;se+=1){const re=K[se],Me=ie[re];void 0===Me?(ce[re]=ee+a,ee=ce[re]):ee=Me}return{predecessorPosition:ee,delta:ce}}(se,X,K,H);if(Me>=d)return(0,l.qu)("Predecessor position is at max order, need to reorder"),E(re,X,K);const Ae=v(re,X,K,H+1);if(void 0===Ae)return Object.assign(Object.assign({},re),{[ie]:Me+a/2});if(Ae>=d)return(0,l.qu)("Successor position is at max order, need to reorder"),E(re,X,K);const Ye=Math.floor((Ae-Me)/2);return Ye<1?((0,l.qu)("Cannot insert at optimal position, no space left. Need to reorder"),E(re,X,K)):Object.assign(Object.assign({},re),{[ie]:Me+Ye})}function I(X,K){const ie={},[H,ee]=function(X,K,ie){let H=d,ee=r,ce=!1;for(let se=K.length-1;se>=0;se-=1){const Me=m(X,ie,K[se]);void 0!==Me&&(H=Math.min(Me,H),ee=Math.max(Me,ee),ce=!0)}return ce&&H!==ee?[H,ee]:[0,K.length*a]}(ie,X,K);return P(ie,X,H,ee)}var j=t(82763),B=t(64538),J=t(33276),R=t(54592),F=t(2316);class Y extends R.q{constructor(K,ie,H,ee,ce,se){super(K),this.querySpace=K,this.apiV3Service=ie,this.states=H,this.causedUpdates=ee,this.wpTableSortBy=ce,this.pathHelper=se}initialize(K,ie,H){return!(0,i.Z)(K)&&this.positions.hasValue()&&this.applyToQuery(K),this.wpTableSortBy.isManualSortingMode?this.withLoadedPositions():Promise.resolve()}move(K,ie,H){return(0,n.mG)(this,void 0,void 0,function*(){const ee=K.findIndex(ce=>ce===ie);return K.splice(ee,1),K.splice(H,0,ie),yield this.assignPosition(K,ie,H,ee),K})}remove(K,ie){return _.remove(K,H=>H===ie),this.update({[ie]:-1}),K}add(K,ie,H=-1){return(0,n.mG)(this,void 0,void 0,function*(){return-1===H?(K.push(ie),H=K.length-1):K.splice(H,0,ie),yield this.assignPosition(K,ie,H),K})}get applicable(){return(0,i.Z)(this.currentQuery)}get currentQuery(){return this.querySpace.query.value}assignPosition(K,ie,H,ee=null){return(0,n.mG)(this,void 0,void 0,function*(){const ce=yield this.withLoadedPositions(),se=function(X,K,ie,H,ee){return function(X,K,ie){let H;for(let ee=0,ce=X.length;ee<ce;ee+=1){const re=K[X[ee]];if(ee!==ie){if(void 0===H||void 0===re){H=re;continue}if(re<H)return!1}}return!0}(X,K,H)?T(X,K,ie,H,ee):I(X,K)}(K,ce,ie,H,ee);yield this.update(se)})}get positions(){return this.updatesState}update(K){return(0,n.mG)(this,void 0,void 0,function*(){const ie=this.positions.getValueOr({});if(this.positions.putValue(Object.assign(Object.assign({},ie),K)),(0,i.Z)(this.currentQuery)){const H=yield this.apiV3Service.queries.id(this.currentQuery).order.update(K);this.currentQuery.updatedAt=H,this.causedUpdates.add(this.currentQuery)}this.applyToQuery(this.currentQuery),this.querySpace.query.putValue(this.currentQuery)})}withLoadedPositions(){if((0,i.Z)(this.currentQuery)){const{value:K}=this.positions;(K==={}||this.positions.isValueOlderThan(6e4))&&this.positions.clear("Clearing old positions value"),this.positions.putFromPromiseIfPristine(()=>this.apiV3Service.queries.id(this.currentQuery).order.get())}else this.positions.isPristine()&&this.positions.putValue({});return this.positions.values$().pipe((0,e.q)(1)).toPromise()}valueFromQuery(K){}orderedWorkPackages(){const K=this.querySpace.results.value.elements.map(H=>this.states.workPackages.get(H.id).getValueOr(H));if((0,i.Z)(this.currentQuery)||this.positions.isPristine())return K;const ie=this.positions.value;return _.sortBy(K,H=>{const ee=ie[H.id];return void 0!==ee?ee:d})}applyToQuery(K){return K.orderedWorkPackages=this.positions.getValueOr({}),!1}hasChanged(K){return!1}}Y.\u0275fac=function(K){return new(K||Y)(F.LFG(h.q),F.LFG(J.T),F.LFG(p.G),F.LFG(B.h),F.LFG(j.q),F.LFG(c.j))},Y.\u0275prov=F.Yz7({token:Y,factory:Y.\u0275fac})},40533:(te,M,t)=>{"use strict";t.d(M,{S:()=>l});var n=t(43440),e=t(14359);class p{constructor(d){this.current=new e.M(d.offset,d.total,d.pageSize)}get page(){return this.current.page}set page(d){this.current.page=d}get perPage(){return this.current.perPage}set perPage(d){this.current.perPage=d}get total(){return this.current.total}set total(d){this.current.total=d}}var h=t(54592),c=t(68853),i=t(2316);class l extends h.H{constructor(d,f){super(d),this.paginationService=f}get paginationObject(){return this.current?{pageSize:this.current.perPage,offset:this.current.page}:{pageSize:this.paginationService.getCachedPerPage([]),offset:1}}valueFromQuery(d,f){return new p(f)}updateFromObject(d){const f=this.current;d.page&&(f.page=d.page),d.perPage&&(f.perPage=d.perPage),d.total&&(f.total=d.total),this.updatesState.putValue(f)}updateFromResults(d){const f={page:d.offset,perPage:d.pageSize,total:d.total,count:d.count};this.updateFromObject(f)}get current(){return this.lastUpdatedState.value}}l.\u0275fac=function(d){return new(d||l)(i.LFG(n.q),i.LFG(c.N))},l.\u0275prov=i.Yz7({token:l,factory:l.\u0275fac})},41195:(te,M,t)=>{"use strict";t.d(M,{a:()=>d});var n=t(43440),e=t(53457),p=t(70319),h=t(33276),c=t(91923),i=t(54592),l=t(71562),r=t(2316);class d extends i.H{constructor(a,m,v,C,u){super(a),this.querySpace=a,this.wpTableColumns=m,this.halResourceService=v,this.apiV3Service=C,this.wpRelations=u}valueFromQuery(a){return this.current}relationsToExtendFor(a,m,v){if(!this.wpTableColumns.hasRelationColumns()||!this.lastUpdatedState.hasValue()||_.isNil(m))return;const C=this.getExpandFor(a.id);if(void 0===C)return;const u=this.wpTableColumns.findById(C),k=this.relationColumnType(u);null!==k&&_.each(this.relationsForColumn(a,m,u),x=>v(x,u,k))}relationsForColumn(a,m,v){if(_.isNil(m))return[];const C=this.relationColumnType(v);if("toType"===C){const u=v.type.href;return _.filter(m,k=>{const x=k.denormalized(a),b=this.apiV3Service.work_packages.cache.state(x.targetId).value;return _.get(b,"type.href")===u})}if("ofType"===C){const{relationType:u}=v;return _.filter(m,k=>k.denormalized(a).relationType===u)}return[]}relationColumnType(a){switch(a._type){case p.L.RELATION_TO_TYPE:return"toType";case p.L.RELATION_OF_TYPE:return"ofType";default:return null}}getExpandFor(a){return this.current[a]}setExpandFor(a,m){const v=Object.assign({},this.current);v[a]=m,this.update(v)}collapse(a){const m=Object.assign({},this.current);delete m[a],this.update(m)}get current(){return this.lastUpdatedState.getValueOr({})}}d.\u0275fac=function(a){return new(a||d)(r.LFG(n.q),r.LFG(l.i),r.LFG(c.u),r.LFG(h.T),r.LFG(e.V))},d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac})},60914:(te,M,t)=>{"use strict";t.d(M,{J:()=>i});var n=t(43440),e=t(87853),p=t(20342),h=t(54592),c=t(2316);class i extends h.H{constructor(r,d,f){super(r),this.querySpace=r,this.states=d,this.opContextMenu=f,this.reset()}ngOnDestroy(){Mousetrap.unbind(["command+d","ctrl+d"]),Mousetrap.unbind(["command+a","ctrl+a"])}initializeSelection(r){const d={selected:{},activeRowIndex:null};r.forEach(f=>d.selected[f]=!0),this.updatesState.clear(),this.pristineState.putValue(d)}isSelected(r){var d;return!!(null===(d=this.current)||void 0===d?void 0:d.selected[r])}selectAll(r){const d=this._emptyState;r.forEach(f=>{f.workPackageId&&(d.selected[f.workPackageId]=!0)}),this.update(d)}getSelectedWorkPackages(){const r=this.states.workPackages;return this.getSelectedWorkPackageIds().map(d=>r.get(d).value)}getSelectedWorkPackageIds(){var r;const d=[];return _.each(null===(r=this.current)||void 0===r?void 0:r.selected,(f,a)=>{f&&d.push(a)}),d}reset(){this.update(this._emptyState)}get isEmpty(){return 0===this.selectionCount}get selectionCount(){var r;return _.size(null===(r=this.current)||void 0===r?void 0:r.selected)}toggleRow(r){var d;const f=null===(d=this.current)||void 0===d?void 0:d.selected[r];this.setRowState(r,!f)}setRowState(r,d){const f=this.current||this._emptyState;f.selected[r]=d,this.update(f)}setSelection(r,d){const f=this._emptyState;f.selected[r]=!0,f.activeRowIndex=d,this.update(f)}setMultiSelectionFrom(r,d,f){const a=this.current||this._emptyState;if(0===this.selectionCount||null===a.activeRowIndex)a.selected[d]=!0,a.activeRowIndex=f;else{const m=Math.min(f,a.activeRowIndex),v=Math.max(f,a.activeRowIndex);r.forEach((C,u)=>{C.workPackageId&&(a.selected[C.workPackageId]=u>=m&&u<=v)})}this.update(a)}registerSelectAllListener(r){Mousetrap.bind(["command+a","ctrl+a"],d=>(this.selectAll(r()),d.preventDefault(),this.opContextMenu.close(),!1))}registerDeselectAllListener(){Mousetrap.bind(["command+d","ctrl+d"],r=>(this.reset(),r.preventDefault(),this.opContextMenu.close(),!1))}get _emptyState(){return{selected:{},activeRowIndex:null}}valueFromQuery(r,d){}}i.\u0275fac=function(r){return new(r||i)(c.LFG(n.q),c.LFG(e.G),c.LFG(p.$))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac})},82763:(te,M,t)=>{"use strict";t.d(M,{q:()=>r});var n=t(14808),e=t(67202),p=t(43440),h=t(87853),c=t(70233),i=t(54592),l=t(2316);class r extends i.q{constructor(f,a,m){super(a),this.states=f,this.querySpace=a,this.pathHelper=m}valueFromQuery(f){return[...f.sortBy]}onReadyWithAvailable(){return(0,n.$e)(this.pristineState,this.querySpace.available.sortBy).values$().pipe((0,e.h)(null))}hasChanged(f){const a=m=>m.map(v=>v.href);return!_.isEqual(a(f.sortBy),a(this.current))}applyToQuery(f){const a=this.isManuallySorted(f.sortBy);return f.sortBy=[...this.current],!(a&&this.isManualSortingMode)}isSortable(f){return!!_.find(this.available,a=>a.column.href===f.href)}addSortCriteria(f,a){const m=this.findAvailableDirection(f,a);m&&this.add(m)}setAsSingleSortCriteria(f,a){const m=this.findAvailableDirection(f,a);m&&this.update([m])}findAvailableDirection(f,a){return _.find(this.available,m=>m.column.href===f.href&&m.direction.href===a)}add(f){const a=_.uniqBy([f,...this.current],m=>m.column.href).slice(0,3);this.update(a)}get isManualSortingMode(){return this.isManuallySorted(this.current)}switchToManualSorting(f){const{manualSortObject:a}=this;return!(!a||this.isManualSortingMode)&&(f.setSortBy([a]),!0)}get current(){return this.lastUpdatedState.getValueOr([])}get availableState(){return this.querySpace.available.sortBy}get available(){return this.availableState.getValueOr([])}isManuallySorted(f){return!!(f&&f.length>0)&&f[0].column.href.endsWith("/manualSorting")}get manualSortObject(){return _.find(this.available,f=>f.column.href.endsWith("/manualSorting"))}}r.\u0275fac=function(f){return new(f||r)(l.LFG(h.G),l.LFG(p.q),l.LFG(c.j))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac})},82271:(te,M,t)=>{"use strict";t.d(M,{X:()=>h});var n=t(43440),e=t(54592),p=t(2316);class h extends e.q{constructor(i){super(i)}valueFromQuery(i){return!!i.sums}initialize(i){this.pristineState.putValue(!!i.sums)}hasChanged(i){return i.sums!==this.isEnabled}applyToQuery(i){return i.sums=this.isEnabled,!0}toggle(){this.updatesState.putValue(!this.current)}setEnabled(i){this.updatesState.putValue(i)}get isEnabled(){return this.current}get current(){return this.lastUpdatedState.getValueOr(!1)}}h.\u0275fac=function(i){return new(i||h)(p.LFG(n.q))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},73165:(te,M,t)=>{"use strict";t.d(M,{W:()=>i});var n=t(43440),e=t(14808),p=t(42529),h=t(54592),c=t(2316);class i extends h.q{constructor(r){super(r),this.querySpace=r,this.appliedZoomLevel$=(0,e.qH)("auto")}valueFromQuery(r){return Object.assign(Object.assign({},this.defaultState),{visible:r.timelineVisible,zoomLevel:r.timelineZoomLevel,labels:r.timelineLabels})}set appliedZoomLevel(r){this.appliedZoomLevel$.putValue(r)}get appliedZoomLevel(){return this.appliedZoomLevel$.value}hasChanged(r){const d=this.isVisible!==r.timelineVisible,f=this.zoomLevel!==r.timelineZoomLevel,a=!_.isEqual(this.current.labels,r.timelineLabels);return d||f||a}applyToQuery(r){return r.timelineVisible=this.isVisible,r.timelineZoomLevel=this.zoomLevel,r.timelineLabels=this.current.labels,!1}toggle(){const r=this.current;this.setVisible(!r.visible)}setVisible(r){this.updatesState.putValue(Object.assign(Object.assign({},this.current),{visible:r}))}get isVisible(){return this.current.visible}get zoomLevel(){return this.current.zoomLevel}get labels(){return _.isEmpty(this.current.labels)?this.defaultLabels:this.current.labels}updateLabels(r){this.modify({labels:r})}getNormalizedLabels(r){const d=this.defaultLabels;return _.each(this.current.labels,(f,a)=>{const m=a;d[m]=""===f?null:f}),d}setZoomLevel(r){this.modify({zoomLevel:r})}updateZoomWithDelta(r){const d=this.current.zoomLevel;if("auto"!==d)return this.applyZoomLevel(d,r);const f=this.appliedZoomLevel;if(f&&"auto"!==f)this.applyZoomLevel(f,r);else{const a=r<0?"days":"years";this.setZoomLevel(a)}}isAutoZoom(){return"auto"===this.current.zoomLevel}enableAutozoom(){this.modify({zoomLevel:"auto"})}get current(){return this.lastUpdatedState.getValueOr(this.defaultState)}modify(r){this.update(Object.assign(Object.assign({},this.current),r))}applyZoomLevel(r,d){let f=p.$r.indexOf(r);f+=d,f>=0&&f<p.$r.length&&this.setZoomLevel(p.$r[f])}get defaultLabels(){return{left:"",right:"",farRight:"subject"}}get defaultState(){return{zoomLevel:"auto",visible:!1,labels:this.defaultLabels}}}i.\u0275fac=function(r){return new(r||i)(c.LFG(n.q))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac})},1818:(te,M,t)=>{"use strict";t.d(M,{e:()=>O});var n=t(3786),e=t(2316),p=t(96617),h=t(70233),c=t(48451),i=t(57810),l=t(7493),r=t(87853),d=t(84109),f=t(12703),a=t(62964),m=t(29161),v=t(26942),C=t(33276),u=t(53448),k=t(82123),x=t(60419),b=t(88826),y=t(4018),P=t(92144),E=t(44040),T=t(36293);class O extends v.N{constructor(Z,j){super(),this.injector=Z,this.workPackageId=j,this.text={},this.initializeTexts()}observeWorkPackage(){this.apiV3Service.work_packages.id(this.workPackageId).requireAndStream().pipe(this.untilDestroyed()).subscribe(Z=>{this.workPackage?this.workPackage=Z:(this.workPackage=Z,this.init()),this.cdRef.detectChanges()},Z=>{this.handleLoadingError(Z)})}initializeTexts(){this.text.tabs={},["overview","activity","relations","watchers"].forEach(Z=>{this.text.tabs[Z]=this.I18n.t(`js.work_packages.tabs.${Z}`)})}init(){this.apiV3Service.projects.id(this.workPackage.project).requireAndStream().subscribe(()=>{this.projectIdentifier=this.workPackage.project.identifier,this.cdRef.detectChanges()}),this.projectsResourceService.update(this.workPackage.$links.project.href).subscribe(()=>{},j=>{this.toastService.addError(j)}),this.displayNotificationsButton$=this.storeService.hasNotifications$,this.storeService.setFilters(this.workPackage.id),this.authorisationService.initModelAuth("work_package",this.workPackage.$links),this.titleService.setFirstPart(this.workPackage.subjectWithType(20)),this.showStaticPagePath=this.PathHelper.workPackagePath(this.workPackageId);const Z=this.workPackage.attachments;this.attachmentsResourceService.fetchAttachments(Z.href).subscribe(),this.workPackage.$links.fileLinks&&this.fileLinkResourceService.updateCollectionsForWorkPackage(this.workPackage.$links.fileLinks.href),this.projectsResourceService.lookup(this.workPackage.project.id).pipe(this.untilDestroyed()).subscribe(j=>{j._links.storages&&this.storages.updateCollection(j._links.self.href,j._links.storages)}),this.keepTab.observable.pipe(this.untilDestroyed()).subscribe(j=>{this.updateFocusAnchorLabel(j.active)})}handleLoadingError(Z){this.notificationService.handleRawError(Z)}updateFocusAnchorLabel(Z){return this.focusAnchorLabel=this.I18n.t("js.label_work_package_details_you_are_here",{tab:this.I18n.t(`js.work_packages.tabs.${Z}`),type:this.workPackage.type.name,subject:this.workPackage.subject}),this.focusAnchorLabel}}(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",r.G)],O.prototype,"states",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",p.D)],O.prototype,"I18n",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",d.p)],O.prototype,"keepTab",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",h.j)],O.prototype,"PathHelper",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",f.l)],O.prototype,"halEditing",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",c.o)],O.prototype,"wpTableFocus",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",a.q)],O.prototype,"notificationService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",l.g)],O.prototype,"authorisationService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",b.v)],O.prototype,"attachmentsResourceService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",P.s)],O.prototype,"fileLinkResourceService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",E.D)],O.prototype,"projectsResourceService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",y.l)],O.prototype,"storages",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",T.kl)],O.prototype,"toastService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",e.sBO)],O.prototype,"cdRef",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",i.V)],O.prototype,"titleService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",C.T)],O.prototype,"apiV3Service",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",u.$)],O.prototype,"hooks",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",x.b)],O.prototype,"actions$",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",k.O)],O.prototype,"storeService",void 0)},34520:(te,M,t)=>{"use strict";t.d(M,{_:()=>K});var n=t(3786),e=t(2316),p=t(47775),h=t(7493),c=t(43440),i=t(17163),l=t(9170),r=t(53466),d=t(86469),f=t(96617),a=t(75867),m=t(84897),v=t(87853),C=t(71562),u=t(82763),k=t(61083),x=t(74647),b=t(82271),y=t(73165),P=t(99676),E=t(40533),T=t(61043),O=t(81539),I=t(74478),Z=t(95846),j=t(2888),B=t(20066),J=t(1403),R=t(53916),F=t(29161),Y=t(65146),X=t(26942);class K extends X.N{constructor(H){super(),this.injector=H,this.queryLoaded=!1,this.destroyed=!1}ngOnInit(){this.setupQueryObservers(),this.setupRefreshObserver(),this.setupQueryLoadedListener()}setupQueryObservers(){this.wpTablePagination.updates$().pipe(this.untilDestroyed(),(0,i.M)(this.querySpace.query.values$())).subscribe(([H,ee])=>{this.wpListChecksumService.isQueryOutdated(ee,H)&&(this.wpListChecksumService.update(ee,H),this.refresh(!0,!1))}),this.setupChangeObserver(this.wpTableFilters,!0),this.setupChangeObserver(this.wpTableGroupBy),this.setupChangeObserver(this.wpTableSortBy),this.setupChangeObserver(this.wpTableSum),this.setupChangeObserver(this.wpTableTimeline),this.setupChangeObserver(this.wpTableHierarchies),this.setupChangeObserver(this.wpTableColumns),this.setupChangeObserver(this.wpTableHighlighting),this.setupChangeObserver(this.wpTableOrder),this.setupChangeObserver(this.wpDisplayRepresentation),this.setupChangeObserver(this.wpIncludeSubprojects)}setupChangeObserver(H,ee=!1){const ce=this.querySpace.query;H.updates$().pipe(this.untilDestroyed(),(0,l.h)(()=>ce.hasValue()&&H.hasChanged(ce.value))).subscribe(()=>{const se=ce.value,re=H.applyToQuery(se);this.querySpace.query.putValue(se),this.wpListChecksumService.updateIfDifferent(se,this.wpTablePagination.current).then(()=>{re&&this.refresh(!0,ee)})})}get projectIdentifier(){return this.currentProject.identifier||void 0}setupRefreshObserver(){this.halEvents.aggregated$("WorkPackage").pipe(this.untilDestroyed(),(0,l.h)(H=>this.filterRefreshEvents(H))).subscribe(H=>{this.refresh(!1,!1)})}filterRefreshEvents(H){var ee;const ce=this.querySpace.renderedWorkPackageIds.value||(null===(ee=this.querySpace.results.value)||void 0===ee?void 0:ee.elements.map(re=>re.id))||[],se=new Set(ce);for(let re=0;re<H.length;re++){const Me=H[re];if(se.has(Me.id)||"created"===Me.eventType)return!0}return!1}setupQueryLoadedListener(){this.querySpace.initialized.values$().pipe((0,r.q)(1),(0,l.h)(()=>!this.componentDestroyed)).subscribe(()=>{this.queryLoaded=!0,this.cdRef.detectChanges()})}}K.\u0275fac=function(H){return new(H||K)(e.Y36(e.zs3))},K.\u0275dir=e.lG2({type:K,features:[e.qOj]}),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",p.StateService)],K.prototype,"$state",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",v.G)],K.prototype,"states",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",c.q)],K.prototype,"querySpace",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",h.g)],K.prototype,"authorisationService",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",C.i)],K.prototype,"wpTableColumns",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",m.B)],K.prototype,"wpTableHighlighting",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",u.q)],K.prototype,"wpTableSortBy",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",k.w)],K.prototype,"wpTableGroupBy",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",x.Z)],K.prototype,"wpTableFilters",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",b.X)],K.prototype,"wpTableSum",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",y.W)],K.prototype,"wpTableTimeline",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",P.Y)],K.prototype,"wpTableHierarchies",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",E.S)],K.prototype,"wpTablePagination",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",Z.M)],K.prototype,"wpTableOrder",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",T.Z)],K.prototype,"wpListService",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",O.Y)],K.prototype,"wpListChecksumService",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",d.vt)],K.prototype,"loadingIndicatorService",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",p.TransitionService)],K.prototype,"$transitions",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",f.D)],K.prototype,"I18n",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",a.p)],K.prototype,"opStaticQueries",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",I.f)],K.prototype,"wpStatesInitialization",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",e.sBO)],K.prototype,"cdRef",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",j.ld)],K.prototype,"wpDisplayRepresentation",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",B.F)],K.prototype,"wpIncludeSubprojects",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",J.J)],K.prototype,"halEvents",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",R.U)],K.prototype,"deviceService",void 0),(0,n.gn)([(0,F.W)(),(0,n.w6)("design:type",Y.R)],K.prototype,"currentProject",void 0)},62964:(te,M,t)=>{"use strict";t.d(M,{q:()=>h});var n=t(67727),e=t(33276),p=t(2316);class h extends n.W{constructor(i,l){super(i),this.injector=i,this.apiV3Service=l}showSave(i,l=!1){const r={message:this.I18n.t("js.notice_successful_"+(l?"create":"update"))};this.addWorkPackageFullscreenLink(r,i),this.ToastService.addSuccess(r)}showCustomError(i,l){return"urn:openproject-org:api:v3:errors:UpdateConflict"===i.errorIdentifier?(this.ToastService.addError({message:i.message,type:"error",link:{text:this.I18n.t("js.hal.error.update_conflict_refresh"),target:()=>this.apiV3Service.work_packages.id(l).refresh()}}),!0):super.showCustomError(i,l)}addWorkPackageFullscreenLink(i,l){this.$state.includes("work-packages.show")||(i.link={target:()=>this.$state.go("work-packages.show.tabs",{tabIdentifier:"activity",workPackageId:l.id}),text:this.I18n.t("js.work_packages.message_successful_show_in_fullscreen")})}}h.\u0275fac=function(i){return new(i||h)(p.LFG(p.zs3),p.LFG(e.T))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},56686:(te,M,t)=>{"use strict";t.d(M,{h:()=>d});var n=t(47775),e=t(70233),p=t(55977),h=t(36293),c=t(96617),i=t(1403),l=t(2316),r=t(53882);class d{constructor(a,m,v,C,u,k,x){this.http=a,this.$state=m,this.PathHelper=v,this.UrlParamsHelper=C,this.toastService=u,this.I18n=k,this.halEvents=x,this.text={successful_delete:this.I18n.t("js.work_packages.message_successful_bulk_delete")}}performBulkDelete(a,m){const v={"ids[]":a},C=this.http.delete(this.PathHelper.workPackagesBulkDeletePath(),{params:v,withCredentials:!0}).toPromise();return m&&C.then(()=>{this.toastService.addSuccess(this.text.successful_delete),a.forEach(u=>this.halEvents.push({_type:"WorkPackage",id:u},{eventType:"deleted"})),this.$state.includes("**.list.details.**")&&a.indexOf(this.$state.params.workPackageId)>-1&&this.$state.go("work-packages.partitioned.list",this.$state.params)}).catch(()=>{const u=this.UrlParamsHelper.buildQueryString(v);window.location.href=`${this.PathHelper.workPackagesBulkDeletePath()}?${u}`}),C}}d.\u0275fac=function(a){return new(a||d)(l.LFG(r.eN),l.LFG(n.StateService),l.LFG(e.j),l.LFG(p.Z),l.LFG(h.kl),l.LFG(c.D),l.LFG(i.J))},d.\u0275prov=l.Yz7({token:d,factory:d.\u0275fac})},74603:(te,M,t)=>{"use strict";t.d(M,{c:()=>J});var n=t(33927),e=t(98636),h=(t(80044),t(70692)),c=t(26942),i=t(88826),l=t(84699),r=t(2316),d=t(54364),f=t(76491),a=t(61486),m=t(20088),v=t(83720),C=t(96617),u=t(70233),k=t(96457),x=t(32782),b=t(10190),y=t(6536),P=t(84335);const E=["avatar"];function O(R,F){if(1&R){const Y=r.EpF();r.TgZ(0,"div",9),r.TgZ(1,"button",10),r.NdJ("click",function(){return r.CHM(Y),r.oxw().confirmRemoveAttachment()}),r._UZ(2,"span",11),r.qZA(),r.qZA()}if(2&R){const Y=r.oxw();r.xp6(1),r.Q6J("title",Y.deleteIconTitle)}}class I extends c.N{constructor(F,Y,X,K,ie,H){super(),this.I18n=F,this.pathHelper=Y,this.timezoneService=X,this.confirmDialogService=K,this.principalsResourceService=ie,this.principalRendererService=H,this.removeAttachment=new r.vpe,this.text={dragHint:this.I18n.t("js.attachments.draggable_hint"),deleteTitle:this.I18n.t("js.attachments.delete"),deleteConfirmation:this.I18n.t("js.attachments.delete_confirmation"),removeFile:ee=>this.I18n.t("js.label_remove_file",ee)},this.viewInitialized$=new f.X(!1)}get deleteIconTitle(){return this.text.removeFile({fileName:this.attachment.fileName})}ngOnInit(){this.fileIcon=(0,y.g)(this.attachment.contentType);const F=(0,b.Z)(this.attachment._links.author.href);this.principalsResourceService.exists(F)||this.principalsResourceService.fetchUser(F).subscribe(),this.timestampText=this.timezoneService.parseDatetime(this.attachment.createdAt).fromNow(),this.author$=this.principalsResourceService.lookup(F).pipe((0,m.P)()),(0,a.aj)([this.author$,this.viewInitialized$.pipe((0,v.x)())]).pipe(this.untilDestroyed()).subscribe(([Y,X])=>{!X||this.principalRendererService.render(this.avatar.nativeElement,Y,{hide:!0,link:!1},{hide:!1,size:"mini"})})}ngAfterViewInit(){this.viewInitialized$.next(!0)}setDragData(F){const Y=this.downloadPath,X=this.draggableHTML(Y);null!=F.dataTransfer&&(F.dataTransfer.setData("text/plain",Y),F.dataTransfer.setData("text/html",X.outerHTML),F.dataTransfer.setData("text/uri-list",Y),F.dataTransfer.setDragImage(X,0,0))}draggableHTML(F){let Y;return this.isImage?(Y=document.createElement("img"),Y.src=F,Y.textContent=this.attachment.fileName):(Y=document.createElement("a"),Y.href=F,Y.textContent=this.attachment.fileName),Y}get downloadPath(){return this.pathHelper.attachmentDownloadPath(String(this.attachment.id),this.attachment.fileName)}get isImage(){const F=this.attachment.fileName.split(".").pop()||"";return I.imageFileExtensions.indexOf(F.toLowerCase())>-1}confirmRemoveAttachment(){const F={text:{text:this.text.deleteConfirmation,title:this.text.deleteTitle,button_continue:this.text.deleteTitle},icon:{continue:"delete"},dangerHighlighting:!0};this.confirmDialogService.confirm(F).then(()=>{this.removeAttachment.emit()}).catch(()=>{})}}function Z(R,F){if(1&R){const Y=r.EpF();r.TgZ(0,"li",4),r.NdJ("removeAttachment",function(){const ie=r.CHM(Y).$implicit;return r.oxw(3).removeAttachment(ie)}),r.qZA()}if(2&R){const Y=F.$implicit,X=F.index;r.Q6J("attachment",Y)("index",X)}}function j(R,F){if(1&R&&(r.TgZ(0,"ul",2),r.YNc(1,Z,1,2,"li",3),r.qZA()),2&R){const Y=r.oxw().ngIf;r.xp6(1),r.Q6J("ngForOf",Y)}}function B(R,F){if(1&R&&(r.TgZ(0,"div"),r.YNc(1,j,2,1,"ul",1),r.qZA()),2&R){const Y=F.ngIf;r.xp6(1),r.Q6J("ngIf",Y.length>0)}}I.imageFileExtensions=["jpeg","jpg","gif","bmp","png"],I.\u0275fac=function(F){return new(F||I)(r.Y36(C.D),r.Y36(u.j),r.Y36(h.B),r.Y36(P.D),r.Y36(k.P),r.Y36(x.C))},I.\u0275cmp=r.Xpm({type:I,selectors:[["","op-attachment-list-item",""]],viewQuery:function(F,Y){if(1&F&&r.Gf(E,5),2&F){let X;r.iGM(X=r.CRH())&&(Y.avatar=X.first)}},inputs:{attachment:"attachment",index:"index"},outputs:{removeAttachment:"removeAttachment"},features:[r.qOj],attrs:["op-attachment-list-item",""],decls:10,vars:11,consts:[[1,"spot-list--item-floating-wrapper","op-file-list--item-floating-wrapper"],["target","_blank",1,"spot-list--item-action","spot-list--item-action_link","op-file-list--item-action",3,"href","dragstart"],["data-qa-selector","op-files-tab--file-list-item-title",1,"spot-list--item-title","op-file-list--item-title",3,"title"],[3,"textContent"],[1,"op-file-list--item-text",3,"textContent"],[1,"op-file-list--item-avatar"],["avatar",""],["class","spot-list--item-floating-actions op-file-list--item-floating-actions hidden-for-mobile",4,"ngIf"],["type","hidden",3,"name","value"],[1,"spot-list--item-floating-actions","op-file-list--item-floating-actions","hidden-for-mobile"],["type","button",1,"spot-link",3,"title","click"],[1,"spot-icon","spot-icon_delete"]],template:function(F,Y){1&F&&(r.TgZ(0,"div",0),r.TgZ(1,"a",1),r.NdJ("dragstart",function(K){return Y.setDragData(K)}),r.TgZ(2,"div",2),r._UZ(3,"span"),r._UZ(4,"span",3),r.qZA(),r._UZ(5,"span",4),r._UZ(6,"div",5,6),r.qZA(),r.YNc(8,O,3,1,"div",7),r.qZA(),r._UZ(9,"input",8)),2&F&&(r.xp6(1),r.Q6J("href",Y.attachment._links.staticDownloadLocation.href,r.LSH),r.xp6(1),r.Q6J("title",Y.attachment.fileName),r.xp6(1),r.MT6("spot-icon spot-icon_",Y.fileIcon.icon," op-files-tab--icon op-files-tab--icon_",Y.fileIcon.clazz,""),r.xp6(1),r.Q6J("textContent",Y.attachment.fileName),r.xp6(1),r.Q6J("textContent",Y.timestampText),r.xp6(3),r.Q6J("ngIf",!!Y.attachment._links.delete),r.xp6(1),r.MGl("name","attachments[",Y.index,"][id]"),r.s9C("value",Y.attachment.id))},directives:[d.O5],encapsulation:2,changeDetection:0});class J extends c.N{constructor(F,Y){super(),this.timezoneService=F,this.attachmentsResourceService=Y}get attachmentsSelfLink(){return this.resource.attachments.href}get collectionKey(){return(0,l.Z)(this.resource)?"new":this.attachmentsSelfLink}ngOnInit(){(0,l.Z)(this.resource)||this.attachmentsResourceService.requireCollection(this.attachmentsSelfLink);const F=(Y,X)=>{const K=this.timezoneService.parseDatetime(X.createdAt),ie=this.timezoneService.parseDatetime(Y.createdAt);return K.isBefore(ie)?-1:1};this.$attachments=this.attachmentsResourceService.collection(this.collectionKey).pipe(this.untilDestroyed(),(0,n.U)(Y=>Y.sort(F)),(0,e.b)(Y=>{(0,l.Z)(this.resource)&&(this.resource.attachments={elements:Y.map(X=>X._links.self)})}))}removeAttachment(F){this.attachmentsResourceService.removeAttachment(this.collectionKey,F).subscribe()}}J.\u0275fac=function(F){return new(F||J)(r.Y36(h.B),r.Y36(i.v))},J.\u0275cmp=r.Xpm({type:J,selectors:[["op-attachment-list"]],inputs:{resource:"resource"},features:[r.qOj],decls:2,vars:3,consts:[[4,"ngIf"],["class","spot-list spot-list_compact op-file-list",4,"ngIf"],[1,"spot-list","spot-list_compact","op-file-list"],["op-attachment-list-item","","class","spot-list--item op-file-list--item","data-qa-selector","op-attachment-list-item",3,"attachment","index","removeAttachment",4,"ngFor","ngForOf"],["op-attachment-list-item","","data-qa-selector","op-attachment-list-item",1,"spot-list--item","op-file-list--item",3,"attachment","index","removeAttachment"]],template:function(F,Y){1&F&&(r.YNc(0,B,2,1,"div",0),r.ALo(1,"async")),2&F&&r.Q6J("ngIf",r.lcZ(1,1,Y.resource&&Y.$attachments))},directives:[d.O5,d.sg,I],pipes:[d.Ov],encapsulation:2,changeDetection:0})},14274:(te,M,t)=>{"use strict";t.d(M,{s:()=>m});var n=t(96617),e=t(12877),h=(t(80044),t(91923)),c=t(36293),i=t(88826),l=t(2316),r=t(54364),d=t(2775);const f=["hiddenFileInput"];function a(v,C){if(1&v){const u=l.EpF();l.TgZ(0,"div",1),l.NdJ("drop",function(x){return l.CHM(u),l.oxw().onDropFiles(x)})("dragover",function(x){return l.CHM(u),l.oxw().onDragOver(x)})("dragleave",function(x){return l.CHM(u),l.oxw().onDragLeave(x)}),l.TgZ(1,"input",2,3),l.NdJ("change",function(){return l.CHM(u),l.oxw().onFilePickerChanged()}),l.qZA(),l.TgZ(3,"button",4),l.NdJ("click",function(x){return l.CHM(u),l.oxw().triggerFileInput(x)}),l.TgZ(4,"span",5),l._UZ(5,"op-icon",6),l.TgZ(6,"label",7),l._uU(7),l._UZ(8,"br"),l._uU(9),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&v){const u=l.oxw();l.uIk("aria-label",u.text.uploadLabel),l.xp6(3),l.ekj("-dragging",u.draggingOver),l.xp6(4),l.hij(" ",u.text.dropFiles," "),l.xp6(2),l.hij(" ",u.text.dropFilesHint," ")}}class m{constructor(C,u,k,x,b,y){this.I18n=C,this.attachmentsResourceService=u,this.configurationService=k,this.toastService=x,this.elementRef=b,this.halResourceService=y,this.draggingOver=!1,this.text={uploadLabel:this.I18n.t("js.label_add_attachments"),dropFiles:this.I18n.t("js.label_drop_files"),dropFilesHint:this.I18n.t("js.label_drop_files_hint"),foldersWarning:this.I18n.t("js.label_drop_folders_hint")}}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.configurationService.initialized.then(()=>{this.maxFileSize=this.configurationService.maximumAttachmentFileSize})}triggerFileInput(C){return this.filePicker.nativeElement.click(),C.preventDefault(),C.stopPropagation(),!1}onDropFiles(C){if(null===C.dataTransfer)return;C.dataTransfer.dropEffect="copy",C.preventDefault(),C.stopPropagation();const u=C.dataTransfer.files,k=u?u.length:0,x=[];for(let b=0;b<k;b++)x.push(u[b]);this.uploadFiles(x),this.draggingOver=!1}onDragOver(C){null!==C.dataTransfer&&m.containsFiles(C.dataTransfer)&&(C.dataTransfer.dropEffect="copy",this.draggingOver=!0),C.preventDefault(),C.stopPropagation()}onDragLeave(C){this.draggingOver=!1,C.preventDefault(),C.stopPropagation()}onFilePickerChanged(){const C=this.filePicker.nativeElement.files;if(null===C)return;const u=Array.from(C);this.uploadFiles(u)}static containsFiles(C){return C.types.indexOf("Files")>=0}uploadFiles(C){let u=C||[];const k=C.length;u=this.filterFolders(u),0!==u.length?this.attachmentsResourceService.attachFiles(this.resource,u).subscribe():k>0&&this.toastService.addNotice(this.text.foldersWarning)}filterFolders(C){return C.filter(u=>""!==u.type||(0!==u.size&&4096!==u.size||(console.warn(`Skipping file because of file size (${u.size}) %O`,u),!1)))}}m.\u0275fac=function(C){return new(C||m)(l.Y36(n.D),l.Y36(i.v),l.Y36(e.e),l.Y36(c.kl),l.Y36(l.SBq),l.Y36(h.u))},m.\u0275cmp=l.Xpm({type:m,selectors:[["op-attachments-upload"]],viewQuery:function(C,u){if(1&C&&l.Gf(f,5),2&C){let k;l.iGM(k=l.CRH())&&(u.filePicker=k.first)}},inputs:{resource:"resource"},decls:1,vars:1,consts:[["class","wp-attachment-upload hide-when-print op-files-tab--file-upload",3,"drop","dragover","dragleave",4,"ngIf"],[1,"wp-attachment-upload","hide-when-print","op-files-tab--file-upload",3,"drop","dragover","dragleave"],["type","file","id","attachment_files","name","attachment_files","hidden","","multiple","",3,"change"],["hiddenFileInput",""],["type","button",1,"work-package--attachments--drop-box",3,"click"],[1,"work-package--attachments--label"],["icon-classes","icon-attachment"],["for","attachment_files"]],template:function(C,u){1&C&&l.YNc(0,a,10,5,"div",0),2&C&&l.Q6J("ngIf",u.resource.canAddAttachments)},directives:[r.O5,d.o],encapsulation:2,changeDetection:0})},41689:(te,M,t)=>{"use strict";t.d(M,{e:()=>C,t:()=>u});t(80044);var e=t(91923),p=t(96617),h=t(87853),c=t(9170),i=t(26942),l=t(2316),r=t(54364),d=t(74603),f=t(14274);function a(k,x){if(1&k&&l._UZ(0,"op-attachment-list",6),2&k){const b=l.oxw(2);l.Q6J("resource",b.resource)}}function m(k,x){if(1&k&&l._UZ(0,"op-attachments-upload",7),2&k){const b=l.oxw(2);l.Q6J("resource",b.resource)}}function v(k,x){if(1&k&&(l.TgZ(0,"fieldset",1),l.TgZ(1,"legend",2),l._uU(2),l.qZA(),l.TgZ(3,"div",3),l.YNc(4,a,1,1,"op-attachment-list",4),l.YNc(5,m,1,1,"op-attachments-upload",5),l.qZA(),l.qZA()),2&k){const b=l.oxw();l.xp6(2),l.hij(" ",b.text.attachments," "),l.xp6(2),l.Q6J("ngIf",b.resource.attachments),l.xp6(1),l.Q6J("ngIf",b.allowUploading)}}const C="attachments";class u extends i.N{constructor(x,b,y,P){super(),this.elementRef=x,this.I18n=b,this.states=y,this.halResourceService=P,this.text={attachments:this.I18n.t("js.label_attachments")}}ngOnInit(){if(this.$element=jQuery(this.elementRef.nativeElement),!this.resource){const x=this.$element.data("resource");this.resource=this.halResourceService.createHalResource(x,!0)}this.allowUploading=this.$element.data("allow-uploading"),void 0!==this.$element.data("destroy-immediately")?this.destroyImmediately=this.$element.data("destroy-immediately"):this.destroyImmediately=!0,this.setupResourceUpdateListener()}setupResourceUpdateListener(){this.states.forResource(this.resource).changes$().pipe(this.untilDestroyed(),(0,c.h)(x=>!!x)).subscribe(x=>{this.resource=x||this.resource})}showAttachments(){return this.allowUploading||_.get(this.resource,"attachments.count",0)>0}}u.\u0275fac=function(x){return new(x||u)(l.Y36(l.SBq),l.Y36(p.D),l.Y36(h.G),l.Y36(e.u))},u.\u0275cmp=l.Xpm({type:u,selectors:[["attachments"]],inputs:{resource:"resource"},features:[l.qOj],decls:1,vars:1,consts:[["class","form--fieldset",4,"ngIf"],[1,"form--fieldset"],[1,"form--fieldset-legend"],["id","attachments_fields"],[3,"resource",4,"ngIf"],["class","hide-when-print",3,"resource",4,"ngIf"],[3,"resource"],[1,"hide-when-print",3,"resource"]],template:function(x,b){1&x&&l.YNc(0,v,6,3,"fieldset",0),2&x&&l.Q6J("ngIf",b.showAttachments())},directives:[r.O5,d.c,f.s],encapsulation:2})},31283:(te,M,t)=>{"use strict";t.d(M,{Z:()=>h});var n=t(54364),e=t(53875),p=t(2316);class h{}h.\u0275fac=function(i){return new(i||h)},h.\u0275mod=p.oAB({type:h}),h.\u0275inj=p.cJS({imports:[[n.ez,e.Q]]})},83845:(te,M,t)=>{"use strict";t.d(M,{y:()=>y,w:()=>b});var n=t(96617),e=t(77355),p=t(45410),h=t(14808),c=t(33276),i=t(53466),l=t(2316);class r{constructor(E){this.apiV3Service=E,this.helpTexts=(0,h.qH)()}require(E,T){return this.load(),new Promise((O,I)=>{this.helpTexts.valuesPromise().then(()=>O(this.find(E,T)))})}requireById(E){return this.load(),this.helpTexts.values$().pipe((0,i.q)(1)).toPromise().then(()=>{const T=this.helpTexts.getValueOr([]);return _.find(T,O=>{var I;return(null===(I=O.id)||void 0===I?void 0:I.toString())===E.toString()})})}load(){this.helpTexts.putFromPromiseIfPristine(()=>this.apiV3Service.help_texts.get().toPromise().then(E=>E.elements))}find(E,T){const O=this.helpTexts.getValueOr([]);return _.find(O,I=>I.scope===T&&I.attribute===E)}}r.\u0275fac=function(E){return new(E||r)(l.LFG(c.T))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"});var d=t(60312),f=t(54364),a=t(41689),m=t(2775);function v(P,E){if(1&P&&l._UZ(0,"attachments",11),2&P){const T=l.oxw();l.Q6J("resource",T.helpText)}}function C(P,E){if(1&P&&(l.TgZ(0,"a",12),l._UZ(1,"op-icon",13),l._UZ(2,"span",14),l.qZA()),2&P){const T=l.oxw();l.uIk("href",T.helpTextLink,l.LSH)("title",T.text.edit),l.xp6(2),l.Q6J("textContent",T.text.edit)}}class u extends d.T{constructor(E,T,O,I){super(E,O,I),this.locals=E,this.I18n=T,this.cdRef=O,this.elementRef=I,this.text={edit:this.I18n.t("js.button_edit"),close:this.I18n.t("js.button_close")},this.helpText=this.locals.helpText}ngOnInit(){super.ngOnInit(),this.helpText.attachments.$load().then(()=>this.cdRef.detectChanges())}get helpTextLink(){return this.helpText.editText?this.helpText.editText.$link.href:""}}function k(P,E){if(1&P&&l._UZ(0,"span",4),2&P){const T=l.oxw(2);l.Q6J("textContent",T.additionalLabel)}}function x(P,E){if(1&P){const T=l.EpF();l.TgZ(0,"div",1),l.NdJ("click",function(I){return l.CHM(T),l.oxw().handleClick(I)})("keydown.enter",function(I){return l.CHM(T),l.oxw().handleClick(I)})("keydown.space",function(I){return l.CHM(T),l.oxw().handleClick(I)}),l.YNc(1,k,1,1,"span",2),l._UZ(2,"op-icon",3),l.qZA()}if(2&P){const T=l.oxw();l.Q6J("title",T.text.open_dialog),l.uIk("data-qa-help-text-for",T.attribute),l.xp6(1),l.Q6J("ngIf",T.additionalLabel)}}u.\u0275fac=function(E){return new(E||u)(l.Y36(e.E),l.Y36(n.D),l.Y36(l.sBO),l.Y36(l.SBq))},u.\u0275cmp=l.Xpm({type:u,selectors:[["ng-component"]],features:[l.qOj],decls:12,vars:5,consts:[["data-indicator-name","modal",1,"spot-modal","attribute-help-text--modal","loading-indicator--location"],["data-qa-selector","attribute-help-text--header",1,"spot-modal--header"],[1,"spot-icon","spot-icon_help1"],[1,"attribute-help-text--header-text",3,"textContent"],[1,"spot-modal--body","spot-container"],[1,"op-uc-container","op-uc-container__no-permalinks",3,"innerHtml"],["data-allow-uploading","false",3,"resource",4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","spot-action-bar--action","spot-modal--cancel-button",3,"click"],["class","help-text--edit-button button spot-action-bar--action",4,"ngIf"],["data-allow-uploading","false",3,"resource"],[1,"help-text--edit-button","button","spot-action-bar--action"],["icon-classes","button--icon icon-edit"],[1,"button--text",3,"textContent"]],template:function(E,T){1&E&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l._UZ(2,"span",2),l._UZ(3,"span",3),l.qZA(),l.TgZ(4,"div",4),l._UZ(5,"div",5),l.YNc(6,v,1,1,"attachments",6),l.qZA(),l.TgZ(7,"div",7),l.TgZ(8,"div",8),l.TgZ(9,"button",9),l.NdJ("click",function(){return T.closeMe()}),l._uU(10),l.qZA(),l.YNc(11,C,3,3,"a",10),l.qZA(),l.qZA(),l.qZA()),2&E&&(l.xp6(3),l.Q6J("textContent",T.helpText.attributeCaption),l.xp6(2),l.Q6J("innerHtml",T.helpText.helpText.html,l.oJD),l.xp6(1),l.Q6J("ngIf",T.helpText&&T.helpText.attachments.elements.length>0),l.xp6(4),l.hij(" ",T.text.close," "),l.xp6(1),l.Q6J("ngIf",T.helpText.editText))},directives:[f.O5,a.t,m.o],encapsulation:2,changeDetection:0});const b="attribute-help-text";class y{constructor(E,T,O,I,Z,j){this.elementRef=E,this.attributeHelpTexts=T,this.opModalService=O,this.cdRef=I,this.injector=Z,this.I18n=j,this.exists=!1,this.text={open_dialog:this.I18n.t("js.help_texts.show_modal"),edit:this.I18n.t("js.button_edit"),close:this.I18n.t("js.button_close")},(0,p.E)(this)}ngOnInit(){this.helpTextId?this.exists=!0:this.load().then(E=>(this.exists=!!E,this.cdRef.detectChanges(),E))}handleClick(E){this.load().then(T=>{this.opModalService.show(u,this.injector,{helpText:T})}),E.preventDefault()}load(){return this.helpTextId?this.attributeHelpTexts.requireById(this.helpTextId):this.attributeHelpTexts.require(this.attribute,this.attributeScope)}}y.\u0275fac=function(E){return new(E||y)(l.Y36(l.SBq),l.Y36(r),l.Y36(e.S),l.Y36(l.sBO),l.Y36(l.zs3),l.Y36(n.D))},y.\u0275cmp=l.Xpm({type:y,selectors:[["attribute-help-text"]],inputs:{attribute:"attribute",additionalLabel:"additionalLabel",attributeScope:"attributeScope",helpTextId:"helpTextId"},decls:1,vars:1,consts:[["class","spot-link help-text--entry","role","button","tabindex","0",3,"title","click","keydown.enter","keydown.space",4,"ngIf"],["role","button","tabindex","0",1,"spot-link","help-text--entry",3,"title","click","keydown.enter","keydown.space"],[3,"textContent",4,"ngIf"],["icon-classes","icon3 icon-help1"],[3,"textContent"]],template:function(E,T){1&E&&l.YNc(0,x,3,3,"div",0),2&E&&l.Q6J("ngIf",T.exists)},directives:[f.O5,m.o],encapsulation:2,changeDetection:0})},71858:(te,M,t)=>{"use strict";t.d(M,{a:()=>i});var n=t(54364),e=t(55811),p=t(31283),h=t(53875),c=t(2316);class i{}i.\u0275fac=function(r){return new(r||i)},i.\u0275mod=c.oAB({type:i}),i.\u0275inj=c.cJS({providers:[],imports:[[n.ez,e.K,p.Z,h.Q]]})},7301:(te,M,t)=>{"use strict";t.d(M,{$:()=>f,r:()=>a});var n=t(36868),e=t(96617),p=t(2316),h=t(54364),c=t(5443),i=t(1707);function l(m,v){if(1&m){const C=p.EpF();p.TgZ(0,"op-project-autocompleter",2),p.NdJ("valueChange",function(k){return p.CHM(C),p.oxw().updateProjectSelection(k)}),p.qZA()}if(2&m){const C=p.oxw();p.Q6J("value",C.currentProjectSelection)("multiple",C.multiselect)("labelForId",C.labelForId)}}function r(m,v){if(1&m&&p._uU(0),2&m){const C=v.item;p.hij(" ",C.label," ")}}function d(m,v){if(1&m){const C=p.EpF();p.TgZ(0,"ng-select",3),p.NdJ("ngModelChange",function(k){return p.CHM(C),p.oxw().updateSelection(k)}),p.YNc(1,r,1,1,"ng-template",4),p.qZA()}if(2&m){const C=p.oxw();p.Q6J("items",C.options)("labelForId",C.labelForId)("multiple",C.multiselect)("virtualScroll",!0)("ngModel",C.selected)("placeholder",C.text.placeholder)}}const f="autocomplete-select-decoration";class a{constructor(v,C){this.elementRef=v,this.I18n=C,this.multiselect=!1,this.text={placeholder:this.I18n.t("js.placeholders.selection")}}ngOnInit(){const v=this.elementRef.nativeElement;this.multiselect="true"===v.dataset.multiselect,this.labelForId=v.dataset.inputId,this.key=v.dataset.key,this.syncInputFieldName=v.dataset.inputName,this.multiselect&&(this.syncInputFieldName+="[]");const C=JSON.parse(v.dataset.options);this.setInitialSelection(C),this.isProjectField()&&this.setInitialProjectSelection(),this.multiselect||(this.selected=this.selected[0]),this.options=C,v.parentElement.hidden=!1}setInitialSelection(v){this.updateSelection(v.filter(C=>C.selected))}updateSelection(v){this.selected=v,v=_.castArray(v),this.removeCurrentSyncedFields(),v.forEach(C=>{this.createSyncedField(C.value)})}createSyncedField(v){jQuery(this.elementRef.nativeElement).parent().append(`<input type="hidden" name="${this.syncInputFieldName||""}" value="${v}" />`)}removeCurrentSyncedFields(){jQuery(this.elementRef.nativeElement).parent().find(`input[name="${this.syncInputFieldName}"]`).remove()}updateProjectSelection(v){const C=(v=_.castArray(v)).map(u=>({label:u.name,value:u.id.toString(),selected:!0}));this.updateSelection(C)}setInitialProjectSelection(){const v=_.castArray(this.selected);0!==v.length&&(this.multiselect?this.currentProjectSelection=v.map(C=>({id:C.value,name:C.label})):this.currentProjectSelection={id:v[0].value,name:v[0].label})}isProjectField(){return"project"===this.key}}a.\u0275fac=function(v){return new(v||a)(p.Y36(p.SBq),p.Y36(e.D))},a.\u0275cmp=p.Xpm({type:a,selectors:[["autocomplete-select-decoration"]],viewQuery:function(v,C){if(1&v&&p.Gf(n.w9,5),2&v){let u;p.iGM(u=p.CRH())&&(C.ngSelectComponent=u.first)}},decls:2,vars:2,consts:[["appendTo","body",3,"value","multiple","labelForId","valueChange",4,"ngIf"],["bindLabel","label","appendTo","body",3,"items","labelForId","multiple","virtualScroll","ngModel","placeholder","ngModelChange",4,"ngIf"],["appendTo","body",3,"value","multiple","labelForId","valueChange"],["bindLabel","label","appendTo","body",3,"items","labelForId","multiple","virtualScroll","ngModel","placeholder","ngModelChange"],["ng-option-tmp",""]],template:function(v,C){1&v&&(p.YNc(0,l,1,3,"op-project-autocompleter",0),p.YNc(1,d,2,6,"ng-select",1)),2&v&&(p.Q6J("ngIf",C.isProjectField()),p.xp6(1),p.Q6J("ngIf",!C.isProjectField()))},directives:[h.O5,c.F,n.w9,i.JJ,i.On,n.Z2],encapsulation:2})},44265:(te,M,t)=>{"use strict";t.d(M,{q:()=>e});var n=t(2316);class e{}e.\u0275fac=function(h){return new(h||e)},e.\u0275dir=n.lG2({type:e,selectors:[["","op-autocompleter-footer-tmp",""]]})},66220:(te,M,t)=>{"use strict";t.d(M,{c:()=>u});var n=t(3786),e=t(2316),p=t(36868),h=t(96617),c=t(65146),i=t(70233),r=(t(80044),t(26942)),d=t(29161),f=t(43682),a=t(1707),m=t(54364);function v(k,x){if(1&k&&(e._UZ(0,"b",4),e._uU(1)),2&k){const b=x.searchTerm,y=e.oxw();e.Q6J("textContent",y.text.add_new_action),e.xp6(1),e.hij(": ",b," ")}}function C(k,x){if(1&k&&e._UZ(0,"span",5),2&k){const b=x.item,y=x.searchTerm;e.Q6J("ngOptionHighlight",y)("textContent",b.name)}}class u extends r.N{constructor(x){super(),this.injector=x,this.required=!1,this.disabled=!1,this.finishedLoading=!1,this.id="",this.classes="",this.hideSelected=!1,this.onChange=new e.vpe,this.onKeydown=new e.vpe,this.onOpen=new e.vpe,this.onClose=new e.vpe,this.onAfterViewInit=new e.vpe,this.onAddNew=new e.vpe,this.compareByHref=f.U5,this.text={},this.createAllowed=!1,this._openDirectly=!1,this.text.add_new_action=this.I18n.t("js.label_create")}ngAfterViewInit(){this.onAfterViewInit.emit(this)}openSelect(){this.ngSelectComponent&&(this.ngSelectComponent.open(),this.openDirectly=!1)}closeSelect(){this.ngSelectComponent&&this.ngSelectComponent.close()}changeModel(x){this.onChange.emit(x)}opened(){setTimeout(()=>{const x=this.ngSelectComponent;this.appendTo&&x&&x.dropdownPanel&&x.dropdownPanel._updatePosition()},25),this.onOpen.emit()}closed(){this.openDirectly=!1,this.onClose.emit()}keyPressed(x){this.onKeydown.emit(x)}get openDirectly(){return this._openDirectly}set openDirectly(x){this._openDirectly=x,x&&this.openSelect()}focusInputField(){this.ngSelectComponent&&this.ngSelectComponent.focus()}}u.\u0275fac=function(x){return new(x||u)(e.Y36(e.zs3))},u.\u0275cmp=e.Xpm({type:u,selectors:[["create-autocompleter"]],viewQuery:function(x,b){if(1&x&&e.Gf(p.w9,5),2&x){let y;e.iGM(y=e.CRH())&&(b.ngSelectComponent=y.first)}},inputs:{availableValues:"availableValues",appendTo:"appendTo",resource:"resource",model:"model",required:"required",disabled:"disabled",finishedLoading:"finishedLoading",id:"id",classes:"classes",typeahead:"typeahead",hideSelected:"hideSelected"},outputs:{onChange:"onChange",onKeydown:"onKeydown",onOpen:"onOpen",onClose:"onClose",onAfterViewInit:"onAfterViewInit",onAddNew:"onAddNew"},features:[e.qOj],decls:4,vars:15,consts:[["bindLabel","name",3,"ngModel","items","ngClass","addTag","virtualScroll","required","clearable","disabled","typeahead","clearOnBackspace","clearSearchOnAdd","appendTo","hideSelected","compareWith","id","ngModelChange","change","open","close","keydown"],["ngSelectComponent",""],["ng-tag-tmp",""],["ng-option-tmp",""],[3,"textContent"],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight","textContent"]],template:function(x,b){1&x&&(e.TgZ(0,"ng-select",0,1),e.NdJ("ngModelChange",function(P){return b.model=P})("change",function(P){return b.changeModel(P)})("open",function(){return b.opened()})("close",function(){return b.closed()})("keydown",function(P){return b.keyPressed(P)}),e.YNc(2,v,2,2,"ng-template",2),e.YNc(3,C,1,2,"ng-template",3),e.qZA()),2&x&&e.Q6J("ngModel",b.model)("items",b.availableValues)("ngClass",b.classes)("addTag",b.createAllowed)("virtualScroll",!0)("required",b.required)("clearable",!b.required)("disabled",b.disabled)("typeahead",b.typeahead)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("appendTo",b.appendTo)("hideSelected",b.hideSelected)("compareWith",b.compareByHref)("id",b.id)},directives:[p.w9,a.JJ,a.On,m.mk,a.Q7,p.N6,p.Z2],styles:[".button.-tiny[_ngcontent-%COMP%]{margin:0}"]}),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",h.D)],u.prototype,"I18n",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",e.sBO)],u.prototype,"cdRef",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",c.R)],u.prototype,"currentProject",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",i.j)],u.prototype,"pathHelper",void 0)},29212:(te,M,t)=>{"use strict";t.d(M,{i:()=>m});var n=t(2316),e=t(96617),p=t(35900),h=t(26942),c=t(89919),i=t(87873),l=t(82503),r=t(54364),d=t(36868);const f=["ngSelectComponent"];function a(v,C){if(1&v){const u=n.EpF();n.TgZ(0,"div",5),n._UZ(1,"span",6),n.TgZ(2,"a",7),n.NdJ("click",function(){const b=n.CHM(u).$implicit;return n.oxw().remove(b)}),n.qZA(),n.qZA()}if(2&v){const u=C.$implicit;n.xp6(1),n.Q6J("textContent",u.name)}}class m extends h.N{constructor(C,u){super(),this.I18n=C,this.dragula=u,this.autofocus=!0,this._selected=[],this.onChange=new n.vpe,this.availableOptions=[],this.text={placeholder:this.I18n.t("js.label_add_columns")}}ngOnInit(){this.updateAvailableOptions(),this.columnsGroup=this.dragula.createGroup("columns",{}),this.dragula.drag("columns").pipe(this.untilDestroyed()).subscribe(()=>(0,i.h)("move","important")),(0,c.T)(this.dragula.drop("columns"),this.dragula.cancel("columns")).pipe(this.untilDestroyed()).subscribe(()=>(0,i.h)("auto"));const C=this;this.autoscroll=new p.x([document.getElementById("content-wrapper")],{margin:25,maxSpeed:10,scrollWhenOutside:!0,autoScroll(){return this.down&&C.columnsGroup.drake.dragging}})}ngAfterViewInit(){this.autofocus&&this.ngSelectComponent.focus()}ngOnDestroy(){super.ngOnDestroy(),this.dragula.destroy("columns")}select(C){!C||(this.selected=[...this.selected,C],this.ngSelectComponent.clearModel())}remove(C){this.selected=this.selected.filter(u=>u.id!==C.id)}get selected(){return this._selected}set selected(C){this._selected=C,this.updateAvailableOptions(),this.onChange.emit(this.selected)}opened(){setTimeout(()=>{const C=this.ngSelectComponent;C&&C.dropdownPanel&&C.dropdownPanel._updatePosition()},25)}updateAvailableOptions(){this.availableOptions=this.options.filter(C=>!this.selected.find(u=>u.id===C.id))}}m.\u0275fac=function(C){return new(C||m)(n.Y36(e.D),n.Y36(l.pQ))},m.\u0275cmp=n.Xpm({type:m,selectors:[["draggable-autocompleter"]],viewQuery:function(C,u){if(1&C&&n.Gf(f,5),2&C){let k;n.iGM(k=n.CRH())&&(u.ngSelectComponent=k.first)}},inputs:{options:"options",autofocus:"autofocus",_selected:["selected","_selected"]},outputs:{onChange:"onChange"},features:[n.qOj],decls:5,vars:8,consts:[[1,"op-draggable-autocomplete"],["dragula","columns",1,"op-draggable-autocomplete--selected",3,"dragulaModel","dragulaModelChange"],["class","op-draggable-autocomplete--item",4,"ngFor","ngForOf"],["ngClass","op-draggable-autocomplete--input","bindLabel","name","appendTo","body",3,"items","multiple","virtualScroll","placeholder","clearSearchOnAdd","closeOnSelect","open","change"],["ngSelectComponent",""],[1,"op-draggable-autocomplete--item"],[1,"op-draggable-autocomplete--item-text",3,"textContent"],[1,"op-draggable-autocomplete--remove-item","icon-remove",3,"click"]],template:function(C,u){1&C&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.NdJ("dragulaModelChange",function(x){return u.selected=x}),n.YNc(2,a,3,1,"div",2),n.qZA(),n.TgZ(3,"ng-select",3,4),n.NdJ("open",function(){return u.opened()})("change",function(x){return u.select(x)}),n.qZA(),n.qZA()),2&C&&(n.xp6(1),n.Q6J("dragulaModel",u.selected),n.xp6(1),n.Q6J("ngForOf",u.selected),n.xp6(1),n.Q6J("items",u.availableOptions)("multiple",!1)("virtualScroll",!0)("placeholder",u.text.placeholder)("clearSearchOnAdd",!0)("closeOnSelect",!0))},directives:[l.sW,r.sg,d.w9,r.mk],styles:[".op-draggable-autocomplete--selected[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding-bottom:1rem}.op-draggable-autocomplete--item[_ngcontent-%COMP%]{padding:5px;margin-right:5px;margin-bottom:5px;min-width:50px;border:1px solid #ddd;background:#F8F8F8;cursor:move;font-size:14px;display:flex;align-items:center;justify-content:space-between}.op-draggable-autocomplete--remove-item[_ngcontent-%COMP%]{font-size:8px;color:#999;padding-left:5px}"],changeDetection:0})},17208:(te,M,t)=>{"use strict";t.d(M,{S:()=>e});var n=t(2316);class e{}e.\u0275fac=function(h){return new(h||e)},e.\u0275dir=n.lG2({type:e,selectors:[["","op-autocompleter-header-tmp",""]]})},28830:(te,M,t)=>{"use strict";t.d(M,{v:()=>e});var n=t(2316);class e{}e.\u0275fac=function(h){return new(h||e)},e.\u0275dir=n.lG2({type:e,selectors:[["","op-autocompleter-label-tmp",""]]})},80104:(te,M,t)=>{"use strict";t.d(M,{u:()=>e});var n=t(2316);class e{}e.\u0275fac=function(h){return new(h||e)},e.\u0275dir=n.lG2({type:e,selectors:[["","op-autocompleter-option-tmp",""]]})},91593:(te,M,t)=>{"use strict";t.d(M,{s:()=>dt});var n=t(2316),e=t(76491),p=t(79441),h=t(89919),c=t(81134),i=t(90425),l=t(9170),r=t(83720),d=t(80639),f=t(98636),a=t(79902),m=t(50076),v=t(26942),C=t(96617),u=t(44265),k=t(26269),x=t(33927),b=t(33276);class y extends v.N{constructor(oe){super(),this.apiV3Service=oe}loadAvailable(oe,D,G,V){const me=this.createFilters(null!=G?G:[],oe,V);return this.apiV3Service[D].filtered(me).get().pipe((0,x.U)(Se=>Se.elements))}createFilters(oe,D,G){const V=new k.qM;for(const me of oe)V.add(me.name,me.operator,me.values);return D&&V.add(null!=G?G:"","**",[D]),V}loadData(oe,D,G,V){return this.loadAvailable(oe,D,G,V)}}y.\u0275fac=function(oe){return new(oe||y)(n.LFG(b.T))},y.\u0275prov=n.Yz7({token:y,factory:y.\u0275fac});var P=t(17208),E=t(28830),T=t(80104),O=t(36868),I=t(1707),Z=t(54364),j=t(3742);const B=["ngSelectInstance"],J=function(de,oe,D){return{$implicit:de,search:oe,index:D}};function R(de,oe){if(1&de&&n.GkF(0,9),2&de){const D=oe.item,G=oe.index,V=oe.searchTerm,me=n.oxw(2);n.Q6J("ngTemplateOutlet",me.headerTemplate)("ngTemplateOutletContext",n.kEZ(2,J,D,V,G))}}function F(de,oe){1&de&&n.YNc(0,R,1,6,"ng-template",8)}const Y=function(de,oe,D,G){return{$implicit:de,search:oe,index:D,clear:G}};function X(de,oe){if(1&de&&n.GkF(0,9),2&de){const D=oe.item,G=oe.index,V=oe.searchTerm,me=oe.clear,$=n.oxw(2),Se=n.MAs(12);n.Q6J("ngTemplateOutlet",$.labelTemplate||Se)("ngTemplateOutletContext",n.l5B(2,Y,D,V,G,me))}}function K(de,oe){1&de&&n.YNc(0,X,1,7,"ng-template",10)}function ie(de,oe){if(1&de&&n.GkF(0,9),2&de){const D=oe.item,G=oe.index,V=oe.searchTerm,me=n.oxw(),$=n.MAs(10);n.Q6J("ngTemplateOutlet",me.optionTemplate||$)("ngTemplateOutletContext",n.kEZ(2,J,D,V,G))}}function H(de,oe){if(1&de&&n.GkF(0,9),2&de){const D=oe.item,G=oe.index,V=oe.searchTerm,me=n.oxw(2);n.Q6J("ngTemplateOutlet",me.footerTemplate)("ngTemplateOutletContext",n.kEZ(2,J,D,V,G))}}function ee(de,oe){1&de&&n.YNc(0,H,1,6,"ng-template",11)}function ce(de,oe){if(1&de&&n._UZ(0,"op-principal",22),2&de){const D=n.oxw(2).$implicit;n.Q6J("principal",D.author)("hideName",!0)}}function se(de,oe){if(1&de&&n._UZ(0,"span",23),2&de){const D=n.oxw(2).$implicit,G=n.oxw();n.MGl("textContent","",D.type.name," "),n.Q6J("ngClass",G.highlighting("type",D.type.id))}}function re(de,oe){if(1&de&&(n.ynx(0),n.TgZ(1,"div",13),n.YNc(2,ce,1,2,"op-principal",14),n.TgZ(3,"span",15),n.YNc(4,se,1,2,"span",16),n._UZ(5,"span",17),n.qZA(),n.TgZ(6,"div",18),n._UZ(7,"span",19),n.TgZ(8,"span",20),n._uU(9),n.qZA(),n._UZ(10,"span",21),n.qZA(),n.qZA(),n.BQk()),2&de){const D=n.oxw(),G=D.$implicit,V=D.search,me=n.oxw();n.xp6(2),n.Q6J("ngIf",G.author&&G.author.href),n.xp6(2),n.Q6J("ngIf",G.type),n.xp6(1),n.Q6J("ngOptionHighlight",V)("textContent",G.subject),n.xp6(2),n.Q6J("ngOptionHighlight",V)("textContent",null==G.project?null:G.project.name),n.xp6(1),n.Q6J("ngOptionHighlight",V),n.xp6(1),n.hij("#",G.id,""),n.xp6(1),n.Q6J("textContent",null==G.status?null:G.status.name)("ngClass",me.highlighting("status",null==G.status?null:G.status.id))}}function Me(de,oe){if(1&de&&n._UZ(0,"op-principal",27),2&de){const D=n.oxw(2).$implicit;n.Q6J("principal",D)("hideName",!0)}}function Ae(de,oe){if(1&de&&(n.ynx(0),n.TgZ(1,"div",24),n.YNc(2,Me,1,2,"op-principal",25),n.TgZ(3,"span",26),n._uU(4),n.qZA(),n.qZA(),n.BQk()),2&de){const D=n.oxw(),G=D.$implicit,V=D.search;n.xp6(2),n.Q6J("ngIf",G&&G.href),n.xp6(1),n.Q6J("ngOptionHighlight",V),n.xp6(1),n.Oqu(G.name)}}function Ye(de,oe){if(1&de&&(n.ynx(0),n.TgZ(1,"span",28),n._uU(2),n.qZA(),n.BQk()),2&de){const D=n.oxw(),G=D.search,V=D.$implicit;n.xp6(1),n.Q6J("ngOptionHighlight",G),n.xp6(1),n.Oqu(V.name)}}function ze(de,oe){if(1&de&&(n.YNc(0,re,11,10,"ng-container",12),n.YNc(1,Ae,5,3,"ng-container",12),n.YNc(2,Ye,3,2,"ng-container",12)),2&de){const D=n.oxw();n.Q6J("ngSwitchCase","work_packages"===D.resource||"parent-child"===D.resource),n.xp6(1),n.Q6J("ngSwitchCase","user"===D.resource||"assignee"===D.resource),n.xp6(1),n.Q6J("ngSwitchCase","subproject"===D.resource||"version"===D.resource||"status"===D.resource||"default"===D.resource||!D.resource)}}function Xe(de,oe){if(1&de&&(n.TgZ(0,"span",30),n._uU(1),n.qZA()),2&de){const D=n.oxw(2),G=D.search,V=D.$implicit;n.Q6J("ngOptionHighlight",G),n.xp6(1),n.lnq(" ",null==V.type?null:V.type.name," #",V.id," ",V.subject||V.name," ")}}function it(de,oe){if(1&de&&(n.ynx(0),n.YNc(1,Xe,2,4,"span",29),n.BQk()),2&de){const D=n.oxw().$implicit;n.xp6(1),n.Q6J("ngIf",D.id)}}function at(de,oe){if(1&de){const D=n.EpF();n.ynx(0),n.TgZ(1,"span",31),n.NdJ("click",function(){n.CHM(D);const V=n.oxw(),me=V.$implicit;return V.clear(me)}),n._uU(2,"\xd7"),n.qZA(),n.TgZ(3,"span",30),n._uU(4),n.qZA(),n.BQk()}if(2&de){const D=n.oxw(),G=D.search,V=D.$implicit;n.xp6(3),n.Q6J("ngOptionHighlight",G),n.xp6(1),n.Oqu(V.name)}}function lt(de,oe){if(1&de&&(n.YNc(0,it,2,1,"ng-container",3),n.YNc(1,at,5,2,"ng-container",3)),2&de){const D=n.oxw();n.Q6J("ngIf","work_packages"===D.resource),n.xp6(1),n.Q6J("ngIf","work_packages"!==D.resource)}}class dt extends v.N{constructor(oe,D,G,V){super(),this.opAutocompleterService=oe,this.cdRef=D,this.ngZone=G,this.I18n=V,this.className=!0,this.filters=[],this.searchKey="",this.defaultData=!1,this.focusDirectly=!0,this.fetchDataDirectly=!1,this.labelRequired=!0,this.required=!1,this.searchable=!0,this.clearable=!0,this.addTag=!1,this.id="",this.items$=new e.X(null),this.clearSearchOnAdd=!0,this.multiple=!1,this.openDirectly=!1,this.markFirst=!0,this.placeholder=this.I18n.t("js.autocompleter.placeholder"),this.notFoundText=this.I18n.t("js.autocompleter.notFoundText"),this.typeToSearchText=this.I18n.t("js.autocompleter.typeToSearchText"),this.loadingText=this.I18n.t("js.ajax.loading"),this.dropdownPosition="auto",this.closeOnSelect=!0,this.hideSelected=!1,this.selectOnTab=!1,this.openOnEnter=!0,this.bufferAmount=4,this.selectableGroup=!1,this.selectableGroupAsModel=!0,this.trackByFn=null,this.compareWith=(me,$)=>me===$,this.clearOnBackspace=!0,this.labelForId=null,this.inputAttrs={},this.readonly=!1,this.searchWhileComposing=!0,this.minTermLength=0,this.editableSearchTerm=!1,this.keyDownFn=()=>!0,this.typeahead=null,this.open=new n.vpe,this.close=new n.vpe,this.change=new n.vpe,this.focus=new n.vpe,this.blur=new n.vpe,this.search=new n.vpe,this.keydown=new n.vpe,this.clear=new n.vpe,this.add=new n.vpe,this.remove=new n.vpe,this.scroll=new n.vpe,this.scrollToEnd=new n.vpe,this.loading$=new p.xQ}ngOnInit(){(this.getOptionsFn||this.defaultData)&&(this.typeahead=new e.X(""))}ngOnChanges(oe){oe.items&&this.items$.next(oe.items.currentValue)}ngAfterViewInit(){!this.ngSelectInstance||this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{var oe;this.results$=(0,h.T)(this.items$,this.autocompleteInputStream()),this.fetchDataDirectly&&(null===(oe=this.typeahead)||void 0===oe||oe.next("")),this.openDirectly?(this.ngSelectInstance.open(),this.ngSelectInstance.focus()):this.focusDirectly&&this.ngSelectInstance.focus()},25)})}repositionDropdown(){this.ngSelectInstance&&setTimeout(()=>{this.cdRef.detectChanges();const oe=this.ngSelectInstance;this.appendTo&&oe&&oe.dropdownPanel&&oe.dropdownPanel._updatePosition()},25)}opened(){var oe;null===(oe=this.typeahead)||void 0===oe||oe.next(""),this.repositionDropdown(),this.open.emit()}getOptionsItems(oe){var D;return(0,c.of)(null===(D=this.items)||void 0===D?void 0:D.filter(G=>G.name.includes(oe)))}closeSelect(){var oe;null===(oe=this.ngSelectInstance)||void 0===oe||oe.close()}openSelect(){var oe;null===(oe=this.ngSelectInstance)||void 0===oe||oe.open()}focusSelect(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.ngSelectInstance.focus()},25)})}closed(){this.close.emit()}changed(oe){this.change.emit(oe)}searched(oe){this.search.emit(oe)}blured(oe){this.blur.emit(oe)}focused(oe){this.focus.emit(oe)}cleared(oe){this.clear.emit(oe)}keydowned(oe){this.keydown.emit(oe)}added(oe){this.add.emit(oe)}removed(oe){this.remove.emit(oe)}scrolled(oe){this.scroll.emit(oe)}scrolledToEnd(oe){this.scrollToEnd.emit(oe)}highlighting(oe,D){return m.Z.inlineClass(oe,D)}autocompleteInputStream(){return this.typeahead?this.typeahead.pipe((0,l.h)(()=>!(!this.defaultData&&!this.getOptionsFn)),(0,r.x)(),(0,d.b)(250),(0,f.b)(()=>this.loading$.next(!0)),(0,a.w)(oe=>this.defaultData?this.opAutocompleterService.loadData(oe,this.resource,this.filters,this.searchKey):this.getOptionsFn?this.getOptionsFn(oe):i.C),(0,f.b)(()=>this.loading$.next(!1),()=>this.loading$.next(!1))):i.C}}dt.\u0275fac=function(oe){return new(oe||dt)(n.Y36(y),n.Y36(n.sBO),n.Y36(n.R0b),n.Y36(C.D))},dt.\u0275cmp=n.Xpm({type:dt,selectors:[["op-autocompleter"]],contentQueries:function(oe,D,G){if(1&oe&&(n.Suo(G,T.u,5,n.Rgc),n.Suo(G,E.v,5,n.Rgc),n.Suo(G,P.S,5,n.Rgc),n.Suo(G,u.q,5,n.Rgc)),2&oe){let V;n.iGM(V=n.CRH())&&(D.optionTemplate=V.first),n.iGM(V=n.CRH())&&(D.labelTemplate=V.first),n.iGM(V=n.CRH())&&(D.headerTemplate=V.first),n.iGM(V=n.CRH())&&(D.footerTemplate=V.first)}},viewQuery:function(oe,D){if(1&oe&&n.Gf(B,5),2&oe){let G;n.iGM(G=n.CRH())&&(D.ngSelectInstance=G.first)}},hostVars:2,hostBindings:function(oe,D){2&oe&&n.ekj("op-autocompleter",D.className)},inputs:{filters:"filters",resource:"resource",model:"model",searchKey:"searchKey",defaultData:"defaultData",focusDirectly:"focusDirectly",fetchDataDirectly:"fetchDataDirectly",labelRequired:"labelRequired",name:"name",required:"required",disabled:"disabled",searchable:"searchable",clearable:"clearable",addTag:"addTag",id:"id",accesskey:"accesskey",items:"items",clearSearchOnAdd:"clearSearchOnAdd",classes:"classes",multiple:"multiple",openDirectly:"openDirectly",bindLabel:"bindLabel",bindValue:"bindValue",markFirst:"markFirst",placeholder:"placeholder",notFoundText:"notFoundText",typeToSearchText:"typeToSearchText",addTagText:"addTagText",loadingText:"loadingText",clearAllText:"clearAllText",appearance:"appearance",dropdownPosition:"dropdownPosition",appendTo:"appendTo",closeOnSelect:"closeOnSelect",hideSelected:"hideSelected",selectOnTab:"selectOnTab",openOnEnter:"openOnEnter",maxSelectedItems:"maxSelectedItems",groupBy:"groupBy",groupValue:"groupValue",bufferAmount:"bufferAmount",virtualScroll:"virtualScroll",selectableGroup:"selectableGroup",selectableGroupAsModel:"selectableGroupAsModel",searchFn:"searchFn",trackByFn:"trackByFn",compareWith:"compareWith",clearOnBackspace:"clearOnBackspace",labelForId:"labelForId",inputAttrs:"inputAttrs",tabIndex:"tabIndex",readonly:"readonly",searchWhileComposing:"searchWhileComposing",minTermLength:"minTermLength",editableSearchTerm:"editableSearchTerm",keyDownFn:"keyDownFn",typeahead:"typeahead",getOptionsFn:"getOptionsFn"},outputs:{open:"open",close:"close",change:"change",focus:"focus",blur:"blur",search:"search",keydown:"keydown",clear:"clear",add:"add",remove:"remove",scroll:"scroll",scrollToEnd:"scrollToEnd"},features:[n._Bn([y]),n.qOj,n.TTD],decls:13,vars:58,consts:[[1,"inline-label"],[3,"ngModel","items","ngClass","typeahead","clearOnBackspace","clearSearchOnAdd","hideSelected","appendTo","multiple","loading","addTag","virtualScroll","required","clearable","closeOnSelect","openOnEnter","disabled","name","id","bindLabel","bindValue","markFirst","notFoundText","typeToSearchText","addTagText","loadingText","clearAllText","appearance","dropdownPosition","selectOnTab","maxSelectedItems","placeholder","groupBy","groupValue","bufferAmount","selectableGroup","searchable","selectableGroupAsModel","trackByFn","compareWith","searchFn","labelForId","inputAttrs","tabIndex","readonly","searchWhileComposing","minTermLength","editableSearchTerm","keyDownFn","ngModelChange","change","open","close","blur","focus","clear","keydown","search","scroll","scrollToEnd","add","remove"],["ngSelectInstance",""],[4,"ngIf"],["ng-option-tmp",""],[3,"ngSwitch"],["defaultOption",""],["defaultLabel",""],["ng-header-tmp",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["ng-label-tmp",""],["ng-footer-tmp",""],[4,"ngSwitchCase"],[1,"op-autocompleter--option-wrapper"],["class","op-autocompleter--option-principal",3,"principal","hideName",4,"ngIf"],["data-qa-selector","op-autocompleter-item-subject",1,"op-autocompleter--wp-subject"],[3,"ngClass","textContent",4,"ngIf"],[3,"ngOptionHighlight","textContent"],[1,"op-autocompleter--wp-content"],[1,"op-autocompleter--wp-project",3,"ngOptionHighlight","textContent"],[1,"op-autocompleter--wp-id",3,"ngOptionHighlight"],[1,"op-autocompleter--wp-status",3,"textContent","ngClass"],[1,"op-autocompleter--option-principal",3,"principal","hideName"],[3,"ngClass","textContent"],[1,"op-autocompleter--option-principal-wrapper"],["class","op-autocompleter--option-principal-avatar","size","mini",3,"principal","hideName",4,"ngIf"],[1,"ellipsis",3,"ngOptionHighlight"],["size","mini",1,"op-autocompleter--option-principal-avatar",3,"principal","hideName"],[3,"ngOptionHighlight"],["class","ng-value-label",3,"ngOptionHighlight",4,"ngIf"],[1,"ng-value-label",3,"ngOptionHighlight"],[1,"ng-value-icon","left",3,"click"]],template:function(oe,D){1&oe&&(n.TgZ(0,"div",0),n.TgZ(1,"ng-select",1,2),n.NdJ("ngModelChange",function(V){return D.model=V})("change",function(V){return D.changed(V)})("open",function(){return D.opened()})("close",function(){return D.closed()})("blur",function(V){return D.blured(V)})("focus",function(V){return D.focused(V)})("clear",function(V){return D.cleared(V)})("keydown",function(V){return D.keydowned(V)})("search",function(V){return D.searched(V)})("scroll",function(V){return D.scrolled(V)})("scrollToEnd",function(V){return D.scrolledToEnd(V)})("add",function(V){return D.added(V)})("remove",function(V){return D.removed(V)}),n.ALo(3,"async"),n.ALo(4,"async"),n.YNc(5,F,1,0,void 0,3),n.YNc(6,K,1,0,void 0,3),n.YNc(7,ie,1,6,"ng-template",4),n.YNc(8,ee,1,0,void 0,3),n.qZA(),n.qZA(),n.YNc(9,ze,3,3,"ng-template",5,6,n.W1O),n.YNc(11,lt,2,2,"ng-template",null,7,n.W1O)),2&oe&&(n.xp6(1),n.Q6J("ngModel",D.model)("items",n.lcZ(3,54,D.results$))("ngClass",D.classes)("typeahead",D.typeahead)("clearOnBackspace",D.clearOnBackspace)("clearSearchOnAdd",D.clearSearchOnAdd)("hideSelected",D.hideSelected)("appendTo",D.appendTo)("multiple",D.multiple)("loading",n.lcZ(4,56,D.loading$))("addTag",D.addTag)("virtualScroll",D.virtualScroll)("required",D.required)("clearable",D.clearable)("closeOnSelect",D.closeOnSelect)("openOnEnter",D.openOnEnter)("disabled",D.disabled)("name",D.name)("id",D.id)("bindLabel",D.bindLabel)("bindValue",D.bindValue)("markFirst",D.markFirst)("notFoundText",D.notFoundText)("typeToSearchText",D.typeToSearchText)("addTagText",D.addTagText)("loadingText",D.loadingText)("clearAllText",D.clearAllText)("appearance",D.appearance)("dropdownPosition",D.dropdownPosition)("selectOnTab",D.selectOnTab)("maxSelectedItems",D.maxSelectedItems)("placeholder",D.placeholder)("groupBy",D.groupBy)("groupValue",D.groupValue)("bufferAmount",D.bufferAmount)("selectableGroup",D.selectableGroup)("searchable",D.searchable)("selectableGroupAsModel",D.selectableGroupAsModel)("trackByFn",D.trackByFn)("compareWith",D.compareWith)("searchFn",D.searchFn)("labelForId",D.labelForId)("inputAttrs",D.inputAttrs)("tabIndex",D.tabIndex)("readonly",D.readonly)("searchWhileComposing",D.searchWhileComposing)("minTermLength",D.minTermLength)("editableSearchTerm",D.editableSearchTerm)("keyDownFn",D.keyDownFn),n.uIk("accesskey",D.accesskey||void 0),n.xp6(4),n.Q6J("ngIf",D.headerTemplate),n.xp6(1),n.Q6J("ngIf",D.labelRequired),n.xp6(2),n.Q6J("ngIf",D.footerTemplate),n.xp6(1),n.Q6J("ngSwitch",!0))},directives:[O.w9,I.JJ,I.On,Z.mk,I.Q7,Z.O5,O.Z2,Z.RF,O.A3,Z.tP,O.bb,O.x0,Z.n9,j.N],pipes:[Z.Ov],styles:['.op-autocompleter--option-wrapper[_ngcontent-%COMP%]{padding:5px;line-height:15px;min-height:25px;word-break:break-word;display:grid;grid-template-columns:auto 1fr;grid-template-rows:1fr 1fr}.op-autocompleter--option-principal[_ngcontent-%COMP%]{margin-right:5px;float:left;grid-column-start:1;grid-column-end:2;grid-row-start:1;grid-row-end:3}.op-autocompleter--wp-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto;grid-template-areas:"project idlink status";font-size:.8rem;padding:1px 0 5px}.op-autocompleter--wp-project[_ngcontent-%COMP%]{grid-area:project;display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.op-autocompleter--wp-id[_ngcontent-%COMP%]{grid-area:idlink;place-self:right;font-style:italic;margin:0 .5rem;text-align:center}.op-autocompleter--wp-status[_ngcontent-%COMP%]{grid-area:status;overflow:hidden;font-style:italic}.op-autocompleter--wp-subject[_ngcontent-%COMP%]{font-weight:bold;display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.op-autocompleter--option-principal-wrapper[_ngcontent-%COMP%]{display:flex;overflow:hidden}'],changeDetection:0})},74990:(te,M,t)=>{"use strict";t.d(M,{C:()=>Z});var n=t(36868),e=t(1707),p=t(32853),h=t(54364),c=t(82503),i=t(6894),l=t(32824),r=t(29212),d=t(87064),f=t(61598),a=t(50166),m=t(7301),v=t(54622),C=t(90127),u=t(5443),k=t(91593),x=t(80104),b=t(28830),y=t(17208),P=t(66220),E=t(44265),T=t(93713),O=t(2316);const I=[P.c,v.y,f.e,a.R,r.i,C.U,u.F,d.O,m.r,k.s,x.u,b.v,y.S,E.q,T.U];class Z{}Z.\u0275fac=function(B){return new(B||Z)},Z.\u0275mod=O.oAB({type:Z}),Z.\u0275inj=O.cJS({imports:[[h.ez,n.A0,c.qE,e.u5,e.UX,p.wA.withComponents(I),l.j,i.Y]]})},5443:(te,M,t)=>{"use strict";t.d(M,{F:()=>R,B:()=>J});var n=t(2316),e=t(1707),p=t(33927),h=t(91923),c=t(70233),i=t(96617),l=t(67727),r=t(33276),d=t(73726),f=t(45410);const a=(F,Y=0)=>F.reduce((X,K)=>[...X,Object.assign(Object.assign({},K),{numberOfAncestors:Y,ancestors:[]}),...a(K.children,Y+1)],[]);var m=t(23237),v=t(10190);const C=(F,Y,X)=>{if(!X.length)return[...F,Object.assign(Object.assign({},Y),{children:[]})];const K=X[0],ie=F.find(H=>H.href===K.href);return ie?F.map(H=>H===ie?Object.assign(Object.assign({},H),{children:C(H.children,Y,X.slice(1))}):Object.assign({},H)):[...F,{id:(0,v.Z)(K.href),name:K.title,href:K.href,disabled:!0,children:C([],Y,X.slice(1))}]},k=F=>F.map(Y=>Object.assign(Object.assign({},Y),{children:k(Y.children)})).sort((Y,X)=>Y.name.localeCompare(X.name));var x=t(53882),b=t(91593),y=t(36868),P=t(80104),E=t(54364),T=t(93713);const O=["hiddenInput"];function I(F,Y){if(1&F&&(n.TgZ(0,"span",5),n._uU(1),n.qZA()),2&F){const X=Y.$implicit;n.xp6(1),n.Oqu(X.name)}}const Z=function(F){return{"padding-left.px":F}};function j(F,Y){if(1&F&&(n.TgZ(0,"div",8),n._uU(1),n.qZA()),2&F){const X=n.oxw().$implicit;n.Q6J("title",X.disabledReason)("ngStyle",n.VKq(3,Z,16*X.numberOfAncestors)),n.xp6(1),n.Oqu(X.disabledReason)}}function B(F,Y){if(1&F&&(n.TgZ(0,"div",6),n._uU(1),n.qZA(),n.YNc(2,j,2,5,"div",7)),2&F){const X=Y.$implicit,K=Y.search;n.Q6J("title",X.name)("ngStyle",n.VKq(5,Z,16*X.numberOfAncestors))("opSearchHighlight",K),n.xp6(1),n.Oqu(X.name),n.xp6(1),n.Q6J("ngIf",X.disabled&&X.disabledReason)}}const J="op-project-autocompleter";class R{constructor(Y,X,K,ie,H,ee,ce,se){this.elementRef=Y,this.halResourceService=X,this.I18n=K,this.halNotification=ie,this.http=H,this.pathHelper=ee,this.apiV3Service=ce,this.injector=se,this.className=!0,this.projectTracker=re=>re.href||re.id,this.url=this.apiV3Service.projects.path,this.name="",this.focusDirectly=!1,this.openDirectly=!1,this.multiple=!1,this.dropdownPosition="auto",this.labelForId="",this.apiFilters=[],this.appendTo="",this.isInlineContext=!1,this.mapResultsFn=re=>re,this._value=null,this.valueChange=new n.vpe,this.cancel=new n.vpe,this.onChange=re=>{},this.onTouched=re=>{},(0,f.E)(this)}get inlineClass(){return this.isInlineContext}get value(){return this._value}set value(Y){this._value=Y,this.onChange(Y),this.valueChange.emit(Y),this.onTouched(Y),setTimeout(()=>{var X;null===(X=this.hiddenInput.nativeElement)||void 0===X||X.dispatchEvent(new Event("change"))},100)}get plainValue(){var Y,X;return(Array.isArray(this.value)?null===(Y=this.value)||void 0===Y?void 0:Y.map(K=>K.id):null===(X=this.value)||void 0===X?void 0:X.id)||""}getAvailableProjects(Y){return(0,m.rP)(X=>{const K=[...this.apiFilters];Y.length&&K.push(["typeahead","**",[Y]]);const ie=new URL(this.url,window.location.origin),H=Object.assign({filters:K,select:["elements/id","elements/name","elements/identifier","elements/self","elements/ancestors","total","count","pageSize"]},X),ee=`${(0,d.g)(H)}&${ie.searchParams.toString()}`;return ie.search="",this.http.get(ie.toString()+ee)}).pipe((0,p.U)(X=>X.map(K=>({id:K.id,href:K._links.self.href,name:K.name,disabled:!1,ancestors:K._links.ancestors,children:[]}))),(0,p.U)(this.mapResultsFn),(0,p.U)(X=>X.sort((K,ie)=>K.ancestors.length-ie.ancestors.length)),(0,p.U)(X=>X.reduce((Y,X)=>C(Y,X,X.ancestors),[])),(0,p.U)(X=>k(X)),(0,p.U)(X=>a(X)))}writeValue(Y){this.value=Y}registerOnChange(Y){this.onChange=Y}registerOnTouched(Y){this.onTouched=Y}}R.\u0275fac=function(Y){return new(Y||R)(n.Y36(n.SBq),n.Y36(h.u),n.Y36(i.D),n.Y36(l.W),n.Y36(x.eN),n.Y36(c.j),n.Y36(r.T),n.Y36(n.zs3))},R.\u0275cmp=n.Xpm({type:R,selectors:[["op-project-autocompleter"]],viewQuery:function(Y,X){if(1&Y&&n.Gf(O,5),2&Y){let K;n.iGM(K=n.CRH())&&(X.hiddenInput=K.first)}},hostVars:4,hostBindings:function(Y,X){2&Y&&n.ekj("op-project-autocompleter",X.className)("op-project-autocompleter_inline",X.inlineClass)},inputs:{url:"url",name:"name",focusDirectly:"focusDirectly",openDirectly:"openDirectly",multiple:"multiple",dropdownPosition:"dropdownPosition",labelForId:"labelForId",apiFilters:"apiFilters",appendTo:"appendTo",isInlineContext:"isInlineContext",mapResultsFn:"mapResultsFn",_value:["value","_value"]},outputs:{valueChange:"valueChange",cancel:"cancel"},features:[n._Bn([{provide:e.JU,useExisting:(0,n.Gpc)(()=>R),multi:!0}])],decls:5,vars:11,consts:[[3,"model","getOptionsFn","trackByFn","multiple","focusDirectly","openDirectly","labelForId","dropdownPosition","appendTo","change","keydown.escape"],["ng-label-tmp",""],["op-autocompleter-option-tmp",""],["type","hidden",3,"name","value"],["hiddenInput",""],[1,"ng-value-label"],[1,"ng-option-label","ellipsis",3,"title","ngStyle","opSearchHighlight"],["class","ng-option-label ellipsis",3,"title","ngStyle",4,"ngIf"],[1,"ng-option-label","ellipsis",3,"title","ngStyle"]],template:function(Y,X){1&Y&&(n.TgZ(0,"op-autocompleter",0),n.NdJ("change",function(ie){return X.writeValue(ie)})("keydown.escape",function(){return X.cancel.emit()}),n.YNc(1,I,2,1,"ng-template",1),n.YNc(2,B,3,7,"ng-template",2),n.qZA(),n._UZ(3,"input",3,4)),2&Y&&(n.Q6J("model",X.value)("getOptionsFn",X.getAvailableProjects.bind(X))("trackByFn",X.projectTracker)("multiple",X.multiple)("focusDirectly",X.focusDirectly)("openDirectly",X.openDirectly)("labelForId",X.labelForId)("dropdownPosition",X.dropdownPosition)("appendTo",X.appendTo),n.xp6(3),n.Q6J("name",X.name)("value",X.plainValue))},directives:[b.s,y.bb,P.u,E.PC,T.U,E.O5],styles:[".cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-project-autocompleter,.op-project-autocompleter>*{width:100%;display:flex}.op-project-autocompleter_inline .op-autocompleter{display:inline}.op-project-autocompleter .ng-dropdown-panel .ng-dropdown-panel-items .ng-option.ng-option-disabled{cursor:default;color:#878787}\n"],encapsulation:2,changeDetection:0})},50166:(te,M,t)=>{"use strict";t.d(M,{R:()=>l});var n=t(2316),e=t(61598),p=t(91593),h=t(54364),c=t(17208);function i(r,d){if(1&r){const f=n.EpF();n.TgZ(0,"div",2),n.TgZ(1,"div",3),n.TgZ(2,"ul",4),n.TgZ(3,"li",5),n.NdJ("click",function(){return n.CHM(f),n.oxw().setMode("all")}),n._UZ(4,"a",6),n.qZA(),n.TgZ(5,"li",5),n.NdJ("click",function(){return n.CHM(f),n.oxw().setMode("recent")}),n._UZ(6,"a",6),n.qZA(),n.qZA(),n.qZA(),n.qZA()}if(2&r){const f=n.oxw();n.xp6(4),n.ekj("op-tab-row--link_selected","all"===f.mode),n.Q6J("textContent",f.text.all),n.xp6(2),n.ekj("op-tab-row--link_selected","recent"===f.mode),n.Q6J("textContent",f.text.recent)}}class l extends e.e{constructor(d){super(d),this.injector=d,this.modeSwitch=new n.vpe,this.mode="all",this.text.all=this.I18n.t("js.label_all"),this.text.recent=this.I18n.t("js.label_recent")}setMode(d){d!==this.mode&&this.modeSwitch.emit(d),this.mode=d}}l.\u0275fac=function(d){return new(d||l)(n.Y36(n.zs3))},l.\u0275cmp=n.Xpm({type:l,selectors:[["te-work-package-autocompleter"]],outputs:{modeSwitch:"modeSwitch"},features:[n.qOj],decls:2,vars:13,consts:[["resource","work_packages",3,"model","items","ngClass","addTag","virtualScroll","required","clearable","disabled","clearOnBackspace","typeahead","appendTo","hideSelected","id","change","open","close","keydown"],["op-autocompleter-header-tmp",""],[1,"scrollable-tabs"],[1,"op-scrollable-tabs--tab-container"],[1,"op-tab-row"],[1,"op-tab-row--tab",3,"click"],["href","#",1,"op-tab-row--link",3,"textContent"]],template:function(d,f){1&d&&(n.TgZ(0,"op-autocompleter",0),n.NdJ("change",function(m){return f.changeModel(m)})("open",function(){return f.opened()})("close",function(){return f.closed()})("keydown",function(m){return f.keyPressed(m)}),n.YNc(1,i,7,6,"ng-template",1),n.qZA()),2&d&&n.Q6J("model",f.model)("items",f.availableValues)("ngClass",f.classes)("addTag",f.createAllowed)("virtualScroll",!0)("required",f.required)("clearable",!f.required)("disabled",f.disabled)("clearOnBackspace",!1)("typeahead",f.typeahead)("appendTo",f.appendTo)("hideSelected",f.hideSelected)("id",f.id)},directives:[p.s,h.mk,c.S],styles:[".ng-dropdown-panel .ng-dropdown-header{padding-bottom:0}\n"],encapsulation:2})},90127:(te,M,t)=>{"use strict";t.d(M,{U:()=>K,X:()=>X});var n=t(2316),e=t(91923),p=t(70233),h=t(96617),c=t(9170),i=t(33927),l=t(67727),r=t(36868),d=t(33276),f=t(26269),a=t(45410),m=t(1707),v=t(90044),C=t(2308),u=t(26942),k=t(91593),x=t(80104),b=t(54364),y=t(93713),P=t(3742),E=t(44265),T=t(96905),O=t(65146),I=t(2775);function Z(ie,H){if(1&ie){const ee=n.EpF();n.TgZ(0,"button",1),n.NdJ("click",function(se){return n.CHM(ee),n.oxw().onAddNewClick(se)}),n.TgZ(1,"span",2),n._UZ(2,"op-icon",3),n._uU(3),n.qZA(),n.qZA()}if(2&ie){const ee=n.oxw();n.xp6(3),n.hij(" ",ee.text.button," ")}}class j{constructor(H,ee,ce,se,re){this.I18n=H,this.opInviteUserModalService=ee,this.currentProjectService=ce,this.currentUserService=se,this.autocompleter=re,this.text={button:this.I18n.t("js.invite_user_modal.invite")}}ngOnInit(){this.projectId=this.projectId||this.currentProjectService.id,this.canInviteUsersToProject$=this.currentUserService.hasCapabilities$("memberships/create",this.projectId||null)}onAddNewClick(H){H.stopPropagation(),this.opInviteUserModalService.open(this.projectId),this.autocompleter.closeSelect()}}j.\u0275fac=function(H){return new(H||j)(n.Y36(h.D),n.Y36(C.j),n.Y36(O.R),n.Y36(T.S),n.Y36(k.s))},j.\u0275cmp=n.Xpm({type:j,selectors:[["op-invite-user-button"]],inputs:{projectId:"projectId"},decls:2,vars:3,consts:[["class","op-select-footer--label","type","button",3,"click",4,"ngIf"],["type","button",1,"op-select-footer--label",3,"click"],[1,"icon-context"],["icon-classes","icon-user-plus icon-context"]],template:function(H,ee){1&H&&(n.YNc(0,Z,4,1,"button",0),n.ALo(1,"async")),2&H&&n.Q6J("ngIf",n.lcZ(1,1,ee.canInviteUsersToProject$))},directives:[b.O5,I.o],pipes:[b.Ov],styles:[""]});const B=["hiddenInput"];function J(ie,H){if(1&ie&&n._UZ(0,"op-principal",7),2&ie){const ee=n.oxw().$implicit;n.Q6J("principal",ee)("hideName",!0)}}function R(ie,H){if(1&ie&&(n.YNc(0,J,1,2,"op-principal",5),n.TgZ(1,"span",6),n._uU(2),n.qZA()),2&ie){const ee=H.$implicit,ce=H.search;n.Q6J("ngIf",ee&&ee.href),n.xp6(1),n.Q6J("opSearchHighlight",ce),n.xp6(1),n.hij(" ",ee.name," ")}}function F(ie,H){if(1&ie&&n._UZ(0,"op-invite-user-button",9),2&ie){const ee=n.oxw(2);n.Q6J("projectId",ee.inviteUserToProject)}}function Y(ie,H){1&ie&&n.YNc(0,F,1,1,"ng-template",8)}const X="op-user-autocompleter";class K extends u.N{constructor(H,ee,ce,se,re,Me,Ae,Ye){super(),this.elementRef=H,this.halResourceService=ee,this.I18n=ce,this.halNotification=se,this.pathHelper=re,this.apiV3Service=Me,this.injector=Ae,this.opInviteUserModalService=Ye,this.userTracker=ze=>ze.href||ze.id,this.clearAfterSelection=!1,this.name="",this.url=this.apiV3Service.users.path,this.labelForId="",this.appendTo="",this.multiple=!1,this.openDirectly=!1,this.focusDirectly=!1,this._value=null,this.additionalFilters=[],this.inputFilters=new f.qM,this.valueChange=new n.vpe,this.cancel=new n.vpe,this.userInvited=new n.vpe,this.onChange=ze=>{},this.onTouched=ze=>{},(0,a.E)(this)}get value(){return this._value}set value(H){this._value=H,this.onChange(H),this.valueChange.emit(H),this.onTouched(H),setTimeout(()=>{var ee;null===(ee=this.hiddenInput.nativeElement)||void 0===ee||ee.dispatchEvent(new Event("change"))},100)}get plainValue(){var H,ee;return(Array.isArray(this.value)?null===(H=this.value)||void 0===H?void 0:H.map(ce=>ce.id):null===(ee=this.value)||void 0===ee?void 0:ee.id)||""}ngOnInit(){this.additionalFilters.forEach(H=>this.inputFilters.add(H.selector,H.operator,H.values)),this.opInviteUserModalService.close.pipe(this.untilDestroyed(),(0,c.h)(H=>!!H)).subscribe(H=>{this.userInvited.emit(H)})}getAvailableUsers(H){const ee=this.inputFilters.clone();(null==H?void 0:H.length)&&ee.add("name","~",[H]);const ce=(0,v.d)(this.url,ee);return this.halResourceService.get(ce.toString(),{pageSize:-1}).pipe((0,i.U)(se=>se.elements.map(re=>({name:re.name,id:re.id,href:re.href,avatar:re.avatar}))))}writeValue(H){this.value=H}registerOnChange(H){this.onChange=H}registerOnTouched(H){this.onTouched=H}}K.\u0275fac=function(H){return new(H||K)(n.Y36(n.SBq),n.Y36(e.u),n.Y36(h.D),n.Y36(l.W),n.Y36(p.j),n.Y36(d.T),n.Y36(n.zs3),n.Y36(C.j))},K.\u0275cmp=n.Xpm({type:K,selectors:[["op-user-autocompleter"]],viewQuery:function(H,ee){if(1&H&&(n.Gf(r.w9,7),n.Gf(B,5)),2&H){let ce;n.iGM(ce=n.CRH())&&(ee.ngSelectComponent=ce.first),n.iGM(ce=n.CRH())&&(ee.hiddenInput=ce.first)}},inputs:{clearAfterSelection:"clearAfterSelection",name:"name",url:"url",labelForId:"labelForId",appendTo:"appendTo",multiple:"multiple",openDirectly:"openDirectly",focusDirectly:"focusDirectly",_value:["value","_value"],inviteUserToProject:"inviteUserToProject",additionalFilters:"additionalFilters"},outputs:{valueChange:"valueChange",cancel:"cancel",userInvited:"userInvited"},features:[n._Bn([{provide:m.JU,useExisting:(0,n.Gpc)(()=>K),multi:!0},C.j]),n.qOj],decls:5,vars:12,consts:[[3,"model","openDirectly","getOptionsFn","trackByFn","multiple","labelForId","appendTo","focusDirectly","change","keydown.escape"],["op-autocompleter-option-tmp",""],[4,"ngIf"],["type","hidden",3,"name","value"],["hiddenInput",""],["size","mini",3,"principal","hideName",4,"ngIf"],[3,"opSearchHighlight"],["size","mini",3,"principal","hideName"],["op-autocompleter-footer-tmp",""],[1,"op-select-footer",3,"projectId"]],template:function(H,ee){1&H&&(n.TgZ(0,"op-autocompleter",0),n.NdJ("change",function(se){return ee.writeValue(se)})("keydown.escape",function(){return ee.cancel.emit()}),n.YNc(1,R,3,3,"ng-template",1),n.YNc(2,Y,1,0,void 0,2),n.qZA(),n._UZ(3,"input",3,4)),2&H&&(n.Q6J("model",ee.value)("openDirectly",!0)("getOptionsFn",ee.getAvailableUsers.bind(ee))("trackByFn",ee.userTracker)("multiple",ee.multiple)("labelForId",ee.labelForId)("appendTo",ee.appendTo)("openDirectly",ee.openDirectly)("focusDirectly",ee.focusDirectly),n.xp6(2),n.Q6J("ngIf",ee.inviteUserToProject),n.xp6(1),n.Q6J("name",ee.name)("value",ee.plainValue))},directives:[k.s,x.u,b.O5,y.U,P.N,E.q,j],encapsulation:2,changeDetection:0})},54622:(te,M,t)=>{"use strict";t.d(M,{y:()=>v});var n=t(2316),e=t(65146),p=t(66220),h=t(33276),c=t(67727),i=t(96617),l=t(70233),r=t(36868),d=t(1707),f=t(54364);function a(C,u){if(1&C&&(n._UZ(0,"b",4),n._uU(1)),2&C){const k=u.searchTerm,x=n.oxw();n.Q6J("textContent",x.text.add_new_action),n.xp6(1),n.hij(": ",k," ")}}function m(C,u){if(1&C&&n._UZ(0,"span",5),2&C){const k=u.item,x=u.searchTerm;n.Q6J("ngOptionHighlight",x)("textContent",k.name)}}class v extends p.c{constructor(u,k,x,b,y,P,E){super(u),this.injector=u,this.I18n=k,this.currentProject=x,this.cdRef=b,this.pathHelper=y,this.apiV3Service=P,this.halNotification=E,this.onCreate=new n.vpe}ngAfterViewInit(){super.ngAfterViewInit(),this.canCreateNewActionElements().then(u=>{u&&(this.createAllowed=k=>this.createNewVersion(k),this.cdRef.detectChanges())})}canCreateNewActionElements(){return this.currentProject.id?this.apiV3Service.versions.available_projects.exists(this.currentProject.id).toPromise().catch(()=>!1):Promise.resolve(!1)}createNewVersion(u){this.apiV3Service.versions.post(this.getVersionPayload(u)).subscribe(k=>this.onCreate.emit(k),k=>{this.closeSelect(),this.halNotification.handleRawError(k)})}getVersionPayload(u){const k={};return k.name=u,k._links={definingProject:{href:this.apiV3Service.projects.id(this.currentProject.id).path}},k}}v.\u0275fac=function(u){return new(u||v)(n.Y36(n.zs3),n.Y36(i.D),n.Y36(e.R),n.Y36(n.sBO),n.Y36(l.j),n.Y36(h.T),n.Y36(c.W))},v.\u0275cmp=n.Xpm({type:v,selectors:[["version-autocompleter"]],outputs:{onCreate:"onCreate"},features:[n.qOj],decls:4,vars:15,consts:[["bindLabel","name",3,"ngModel","items","ngClass","addTag","virtualScroll","required","clearable","disabled","typeahead","clearOnBackspace","clearSearchOnAdd","appendTo","hideSelected","compareWith","id","ngModelChange","change","open","close","keydown"],["ngSelectComponent",""],["ng-tag-tmp",""],["ng-option-tmp",""],[3,"textContent"],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight","textContent"]],template:function(u,k){1&u&&(n.TgZ(0,"ng-select",0,1),n.NdJ("ngModelChange",function(b){return k.model=b})("change",function(b){return k.changeModel(b)})("open",function(){return k.opened()})("close",function(){return k.closed()})("keydown",function(b){return k.keyPressed(b)}),n.YNc(2,a,2,2,"ng-template",2),n.YNc(3,m,1,2,"ng-template",3),n.qZA()),2&u&&n.Q6J("ngModel",k.model)("items",k.availableValues)("ngClass",k.classes)("addTag",k.createAllowed)("virtualScroll",!0)("required",k.required)("clearable",!k.required)("disabled",k.disabled)("typeahead",k.typeahead)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("appendTo",k.appendTo)("hideSelected",k.hideSelected)("compareWith",k.compareByHref)("id",k.id)},directives:[r.w9,d.JJ,d.On,f.mk,d.Q7,r.N6,r.Z2],encapsulation:2})},61598:(te,M,t)=>{"use strict";t.d(M,{e:()=>r});var n=t(66220),e=t(2316),p=t(36868),h=t(1707),c=t(54364);function i(d,f){if(1&d&&(e._UZ(0,"b",4),e._uU(1)),2&d){const a=f.searchTerm,m=e.oxw();e.Q6J("textContent",m.text.add_new_action),e.xp6(1),e.hij(": ",a," ")}}function l(d,f){if(1&d&&e._UZ(0,"span",5),2&d){const a=f.item,m=f.searchTerm;e.Q6J("ngOptionHighlight",m)("textContent",a.name)}}class r extends n.c{}r.\u0275fac=function(){let d;return function(a){return(d||(d=e.n5z(r)))(a||r)}}(),r.\u0275cmp=e.Xpm({type:r,selectors:[["wp-autocompleter"]],features:[e.qOj],decls:4,vars:15,consts:[["bindLabel","name",3,"ngModel","items","ngClass","addTag","virtualScroll","required","clearable","disabled","typeahead","clearOnBackspace","clearSearchOnAdd","appendTo","hideSelected","compareWith","id","ngModelChange","change","open","close","keydown"],["ngSelectComponent",""],["ng-tag-tmp",""],["ng-option-tmp",""],[3,"textContent"],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight","textContent"]],template:function(f,a){1&f&&(e.TgZ(0,"ng-select",0,1),e.NdJ("ngModelChange",function(v){return a.model=v})("change",function(v){return a.changeModel(v)})("open",function(){return a.opened()})("close",function(){return a.closed()})("keydown",function(v){return a.keyPressed(v)}),e.YNc(2,i,2,2,"ng-template",2),e.YNc(3,l,1,2,"ng-template",3),e.qZA()),2&f&&e.Q6J("ngModel",a.model)("items",a.availableValues)("ngClass",a.classes)("addTag",a.createAllowed)("virtualScroll",!0)("required",a.required)("clearable",!a.required)("disabled",a.disabled)("typeahead",a.typeahead)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("appendTo",a.appendTo)("hideSelected",a.hideSelected)("compareWith",a.compareByHref)("id",a.id)},directives:[p.w9,h.JJ,h.On,c.mk,h.Q7,p.N6,p.Z2],encapsulation:2})},87064:(te,M,t)=>{"use strict";t.d(M,{w:()=>d,O:()=>f});var n=t(50076),e=t(96617),p=t(2316),h=t(36868),c=t(1707),i=t(54364);function l(a,m){if(1&a&&(p.TgZ(0,"span",3),p._uU(1),p.qZA()),2&a){const v=m.item,C=p.oxw();p.Q6J("ngClass",C.highlightColor(v)),p.xp6(1),p.Oqu(v.name)}}function r(a,m){if(1&a&&(p.TgZ(0,"span",3),p._uU(1),p.qZA()),2&a){const v=m.item,C=p.oxw();p.Q6J("ngClass",C.highlightColor(v)),p.xp6(1),p.Oqu(v.name)}}const d="colors-autocompleter";class f{constructor(m,v){this.elementRef=m,this.I18n=v,this.highlightTextInline=!1}ngOnInit(){this.setColorOptions(),this.updateInputField=document.getElementsByName(this.elementRef.nativeElement.dataset.updateInput)[0],this.highlightTextInline=JSON.parse(this.elementRef.nativeElement.dataset.highlightTextInline)}onModelChange(m){m&&this.updateInputField&&(this.updateInputField.value=m.value)}setColorOptions(){this.options=JSON.parse(this.elementRef.nativeElement.dataset.colors),this.options.unshift({name:this.I18n.t("js.label_no_color"),value:""}),this.selectedOption=this.options.find(m=>!0===m.selected),this.selectedOption?this.selectedOption=this.selectedOption.value:(this.selectedColorId=this.elementRef.nativeElement.dataset.selectedColor,this.selectedOption=this.selectedColorId?this.selectedColorId:"")}highlightColor(m){if(""===m.value)return;let v;return v=this.highlightTextInline?"__hl_inline_type_ ":"__hl_inline_ ",v+n.Z.colorClass(this.highlightTextInline,m.value)}}f.\u0275fac=function(m){return new(m||f)(p.Y36(p.SBq),p.Y36(e.D))},f.\u0275cmp=p.Xpm({type:f,selectors:[["colors-autocompleter"]],decls:3,vars:4,consts:[["bindLabel","name","bindValue","value","appendTo","body",3,"items","virtualScroll","ngModel","clearable","ngModelChange","change"],["ng-label-tmp",""],["ng-option-tmp",""],[3,"ngClass"]],template:function(m,v){1&m&&(p.TgZ(0,"ng-select",0),p.NdJ("ngModelChange",function(u){return v.selectedOption=u})("change",function(u){return v.onModelChange(u)}),p.YNc(1,l,2,2,"ng-template",1),p.YNc(2,r,2,2,"ng-template",2),p.qZA()),2&m&&p.Q6J("items",v.options)("virtualScroll",!0)("ngModel",v.selectedOption)("clearable",!1)},directives:[h.w9,c.JJ,c.On,h.bb,h.Z2,i.mk],encapsulation:2})},52167:(te,M,t)=>{"use strict";t.d(M,{c:()=>e});var n=t(2316);class e{toHsl(h){return`hsl(${this.valueHash(h)}, 50%, 50%)`}toHsla(h,c){return`hsla(${this.valueHash(h)}, 50%, 50%, ${c}%)`}valueHash(h){let c=0;for(let i=0;i<h.length;i++)c=h.charCodeAt(i)+((c<<5)-c);return c%360}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},45410:(te,M,t)=>{"use strict";t.d(M,{E:()=>p});t(43887);function p(h){const c=h.constructor,i=Object.keys(c).find(d=>"object"==typeof c[d].declaredInputs);if(!i)return void console.warn("Could not find declared inputs for component");const r=c[i].declaredInputs;Object.keys(r).forEach(d=>{const f=r[d],{dataset:a}=h.elementRef.nativeElement;if(a[d])try{h[f]=JSON.parse(a[d]||"")}catch(m){throw console.error("Couldn't parse input: ",d,h.elementRef.nativeElement.dataset),console.error("\nMake sure to make all data attributes you want to use as input JSON parseable.\nThis means that plain strings have to be wrapped in double quotes, and the attribute value is easiest to set with single quotes.\nAn example:\n\n<op-example example-input='\"myString\"'></op-example>\n"),m}})}},21501:(te,M,t)=>{"use strict";t.d(M,{F:()=>p});var n=t(70692),e=t(2316);class p{constructor(c){this.timezoneService=c}ngOnInit(){const c=this.timezoneService.formattedDatetimeComponents(this.dateTimeValue);this.date=c[0],this.time=c[1]}}p.\u0275fac=function(c){return new(c||p)(e.Y36(n.B))},p.\u0275cmp=e.Xpm({type:p,selectors:[["op-date-time"]],inputs:{dateTimeValue:"dateTimeValue"},decls:5,vars:4,consts:[[3,"title"],[3,"textContent"]],template:function(c,i){1&c&&(e.TgZ(0,"span",0),e._UZ(1,"span",1),e.TgZ(2,"span"),e._uU(3,"\xa0"),e.qZA(),e._UZ(4,"span",1),e.qZA()),2&c&&(e.hYB("title","",i.date," ",i.time,""),e.xp6(1),e.Q6J("textContent",i.date),e.xp6(3),e.Q6J("textContent",i.time))},encapsulation:2})},98377:(te,M,t)=>{"use strict";t.d(M,{r:()=>I});var n=t(2316),e=t(66586),p=t(96617),h=t(70233),c=t(71435),i=t(18293),l=t(36293),r=t(3786),d=t(81134),f=t(33927),a=t(53882);class m{constructor(j){this._httpClient=j}submit$(j,B,J,R,F){const Y=this.formatModelToSubmit(j.getRawValue(),F),X=J?"patch":R||"post",K=J?`${B}/${J}`:B;return this._httpClient[X](K,Y,{withCredentials:!0,responseType:"json"}).pipe((0,i.K)(ie=>{throw 422==ie.status&&this.handleBackendFormValidationErrors(ie,j),ie}))}validateForm$(j,B,J){const R=this.formatModelToSubmit(j.value,J);return this._httpClient.post(`${B}/form`,R,{withCredentials:!0,responseType:"json"}).pipe((0,f.U)(F=>{var Y;return this.getFormattedErrors(Object.values(null===(Y=null==F?void 0:F._embedded)||void 0===Y?void 0:Y.validationErrors))}),(0,f.U)(F=>this.setFormValidationErrors(F,j)))}formatModelToSubmit(j,B={}){let{_links:J}=j,R=(0,r._T)(j,["_links"]);const F=J||Object.keys(B).filter(X=>{var K,ie;return!!(null===(K=B[X])||void 0===K?void 0:K.type)&&"_links"===(null===(ie=B[X])||void 0===ie?void 0:ie.location)}).reduce((X,K)=>{const ie=R,H=K;ie[H];return R=(0,r._T)(ie,["symbol"==typeof H?H:H+""]),Object.assign(Object.assign({},X),{[K]:j[K]})},{}),Y=Object.keys(F).reduce((X,K)=>{var ie,H;const ee=F[K],ce=Array.isArray(ee)?ee.map(se=>{var re,Me;return{href:(null==se?void 0:se.href)||(null===(Me=null===(re=null==se?void 0:se._links)||void 0===re?void 0:re.self)||void 0===Me?void 0:Me.href)||null}}):{href:(null==ee?void 0:ee.href)||(null===(H=null===(ie=null==ee?void 0:ee._links)||void 0===ie?void 0:ie.self)||void 0===H?void 0:H.href)||null};return Object.assign(Object.assign({},X),{[K]:ce})},{});return Object.assign(Object.assign({},R),{_links:Y})}formatModelToEdit(j={}){const{_links:B,_meta:J}=j,R=(0,r._T)(j,["_links","_meta"]),F=Object.keys(R).filter(X=>this.isValue(R[X])).reduce((X,K)=>Object.assign(Object.assign({},X),{[K]:R[K]}),{});return Object.assign(Object.assign(Object.assign({},F),{_meta:J}),this.getFormattedResourcesModel(B))}handleBackendFormValidationErrors(j,B){var J,R,F,Y;const X=(null===(R=null===(J=null==j?void 0:j.error)||void 0===J?void 0:J._embedded)||void 0===R?void 0:R.errors)?null===(Y=null===(F=null==j?void 0:j.error)||void 0===F?void 0:F._embedded)||void 0===Y?void 0:Y.errors:[j.error],K=this.getFormattedErrors(X);this.setFormValidationErrors(K,B)}setFormValidationErrors(j,B){j.forEach(J=>{var R;const F=B.get(J.key)||(null===(R=B.get("_links"))||void 0===R?void 0:R.get(J.key));null==F||F.setErrors({[J.key]:{message:J.message}})})}getAllFormValidationErrors(j,B){const J=Object.values(j),R=Array.isArray(B)?B:[B];return this.getFormattedErrors(J).filter(Y=>!B||R.includes(Y.key)).reduce((Y,{key:X,message:K})=>Object.assign(Object.assign({},Y),{[X]:{message:K}}),{})}getFormattedErrors(j){return j.map(J=>({key:J._embedded.details.attribute,message:J.message}))}getFormattedResourcesModel(j={}){return Object.keys(j).reduce((B,J)=>{const R=j[J],F=Array.isArray(R)?R.map(Y=>Object.assign(Object.assign({},Y),{name:(null==Y?void 0:Y.name)||(null==Y?void 0:Y.title)})):Object.assign(Object.assign({},R),{name:(null==R?void 0:R.name)||(null==R?void 0:R.title)});return B=Object.assign(Object.assign({},B),this.isValue(F)&&{[J]:F})},{})}isValue(j){return![null,void 0,""].includes(j)}}m.\u0275fac=function(j){return new(j||m)(n.LFG(a.eN))},m.\u0275prov=n.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"});class C{constructor(j,B,J){this.httpClient=j,this.I18n=B,this.formsService=J,this.selectDefaultValue={name:"-",_links:{self:{href:null}}},this.inputsCatalogue=[{config:{type:"textInput",templateOptions:{type:"text"}},useForFields:["String"]},{config:{type:"textInput",templateOptions:{type:"password"}},useForFields:["Password"]},{config:{type:"integerInput",templateOptions:{type:"number",locale:this.I18n.locale}},useForFields:["Integer","Float"]},{config:{type:"booleanInput",templateOptions:{type:"checkbox"}},useForFields:["Boolean"]},{config:{type:"dateInput"},useForFields:["Date","DateTime"]},{config:{type:"userInput"},useForFields:["User"]},{config:{type:"formattableInput",className:"",templateOptions:{editorType:"full",noWrapLabel:!0}},useForFields:["Formattable"]},{config:{type:"selectInput",defaultValue:this.selectDefaultValue,templateOptions:{locale:this.I18n.locale,bindLabel:"name",searchable:!0,virtualScroll:!0,clearOnBackspace:!1,clearSearchOnAdd:!1,hideSelected:!1,text:{add_new_action:this.I18n.t("js.label_create")}},expressionProperties:{"templateOptions.clearable":(R,F,Y)=>{var X;return!(null===(X=Y.templateOptions)||void 0===X?void 0:X.required)}}},useForFields:["Priority","Status","Type","Version","TimeEntriesActivity","Category","CustomOption"]},{config:{type:"projectInput",defaultValue:this.selectDefaultValue,templateOptions:{locale:this.I18n.locale,bindLabel:"name"},expressionProperties:{"templateOptions.clearable":(R,F,Y)=>{var X;return!(null===(X=Y.templateOptions)||void 0===X?void 0:X.required)}}},useForFields:["Project"]},{config:{type:"selectProjectStatusInput",defaultValue:this.selectDefaultValue,templateOptions:{locale:this.I18n.locale,bindLabel:"name",searchable:!0},expressionProperties:{"templateOptions.clearable":(R,F,Y)=>{var X;return!(null===(X=Y.templateOptions)||void 0===X?void 0:X.required)}}},useForFields:["ProjectStatus"]}]}getConfig(j,B){var J;const R=null===(J=j._attributeGroups)||void 0===J?void 0:J.map(K=>({name:K.name,fieldsFilter:ie=>{var H,ee;return null===(H=K.attributes)||void 0===H?void 0:H.includes(null===(ee=ie.templateOptions)||void 0===ee?void 0:ee.property)}})),Y=this.getFieldsSchemasWithKey(j).map(K=>this.getFormlyFieldConfig(K,B)).filter(K=>null!==K);return this.getFormlyFormWithFieldGroups(R,Y)}getModel(j){return this.formsService.formatModelToEdit(j)}getFormlyFormWithFieldGroups(j=[],B=[]){return[...(B=B.reduce((F,Y)=>Y.fieldGroup?[...F,...Y.fieldGroup]:[...F,Y],[])).filter(F=>j.every(Y=>!Y.fieldsFilter||!Y.fieldsFilter(F))),...this.getDynamicFormFieldGroups(j,B)]}getFieldsSchemasWithKey(j){return Object.keys(j).map(B=>Object.assign(Object.assign({},j[B]),{key:this.getAttributeKey(j[B],B)})).filter(B=>this.isFieldSchema(B)&&B.writable)}getAttributeKey(j,B){switch(j.location){case"_meta":return`${j.location}.${B}`;default:return B}}isFieldSchema(j){return!!(null==j?void 0:j.type)}getFormlyFieldConfig(j,B){var J,R;const{key:F,name:Y,required:X,hasDefault:K,minLength:ie,maxLength:H}=j,ee=this.getFieldTypeConfig(j);if(!ee)return null;const{templateOptions:ce}=ee,se=(0,r._T)(ee,["templateOptions"]),re=this.getFieldProperty(F),Me=re&&(B[re]||B._links&&B._links[re]),Ae=this.getFieldOptions(j,Me);return Object.assign(Object.assign({},se),{key:F,wrappers:["op-dynamic-field-wrapper"],className:`op-form--field ${(null==se?void 0:se.className)||""}`,templateOptions:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({property:re,required:X,label:Y,hasDefault:K},null!=Me&&{payloadValue:Me}),ie&&{minLength:ie}),H&&{maxLength:H}),ce),Ae&&{options:Ae}),{allowedValuesHref:null===(R=null===(J=null==j?void 0:j._links)||void 0===J?void 0:J.allowedValues)||void 0===R?void 0:R.href})})}getFieldTypeConfig(j){var B;const J=j.type.replace("[]",""),R=this.inputsCatalogue.find(X=>X.useForFields.includes(J));if(!R)return console.warn(`Could not find a input definition for a field with the following type: ${J}. The full field configuration is`,j),null;const F=R.config;let Y;return"integerInput"===F.type||"selectInput"===F.type||"selectProjectStatusInput"===F.type||"userInput"===F.type?Y={className:j.name,templateOptions:Object.assign(Object.assign({},F.templateOptions),this.isMultiSelectField(j)&&{multiple:!0})}:"formattableInput"===F.type&&(Y={templateOptions:Object.assign(Object.assign({},F.templateOptions),{rtl:null===(B=j.options)||void 0===B?void 0:B.rtl,name:j.name})}),Object.assign(Object.assign({},F),Y)}getFieldOptions(j,B){var J,R,F,Y,X;const K=(null===(J=j._embedded)||void 0===J?void 0:J.allowedValues)||(null===(R=j._links)||void 0===R?void 0:R.allowedValues);let ie;if(K){if(Array.isArray(K)){const H=(null===(X=null===(Y=null===(F=K[0])||void 0===F?void 0:F._links)||void 0===Y?void 0:Y.self)||void 0===X?void 0:X.title)?this.formatAllowedValues(K):K;ie=(0,d.of)(H)}else K.href&&(ie=this.httpClient.get(function(Z,j){const B=new URL(Z,window.location.origin);return Object.keys(j).forEach(J=>{B.searchParams.set(J,j[J])}),B.pathname+B.search}(K.href,{pageSize:"-1"})).pipe((0,f.U)(H=>H._embedded.elements),(0,f.U)(H=>this.formatAllowedValues(H))));return null==ie?void 0:ie.pipe((0,f.U)(H=>this.prependCurrentValue(H,B)),(0,f.U)(H=>this.prependDefaultValue(H,j)))}}formatAllowedValues(j){return j.map(B=>{var J,R;return Object.assign(Object.assign({},B),{name:null===(R=null===(J=B._links)||void 0===J?void 0:J.self)||void 0===R?void 0:R.title})})}getFieldProperty(j){return j.split(".").pop()}getDynamicFormFieldGroups(j=[],B=[]){return j.reduce((J,R)=>{var F;let Y=this.getDefaultFieldGroupSettings(R,B);return R.settings&&(Y=Object.assign(Object.assign({},Y),{templateOptions:Object.assign(Object.assign({},Y.templateOptions),R.settings.templateOptions&&R.settings.templateOptions),expressionProperties:Object.assign(Object.assign({},Y.expressionProperties),R.settings.expressionProperties&&R.settings.expressionProperties)})),(null===(F=null==Y?void 0:Y.fieldGroup)||void 0===F?void 0:F.length)&&(J=[...J,Y]),J},[])}getDefaultFieldGroupSettings(j,B){return{wrappers:["op-dynamic-field-group-wrapper"],fieldGroupClassName:"op-form--fieldset",templateOptions:{label:j.name,isFieldGroup:!0,collapsibleFieldGroups:!0,collapsibleFieldGroupsCollapsed:!0},fieldGroup:this.getGroupFields(j,B),expressionProperties:{"templateOptions.collapsibleFieldGroupsCollapsed":this.collapsibleFieldGroupsCollapsedExpressionProperty}}}getGroupFields(j,B){return B.filter(J=>!(!J.key||!this.getFieldProperty(J.key))&&(!j.fieldsFilter||j.fieldsFilter(J)))}collapsibleFieldGroupsCollapsedExpressionProperty(j,B,J){var R,F,Y;return!("formly-group"!==J.type||!(null===(R=J.templateOptions)||void 0===R?void 0:R.collapsibleFieldGroups)||!(null===(F=J.templateOptions)||void 0===F?void 0:F.collapsibleFieldGroupsCollapsed))&&!(null===(Y=J.fieldGroup)||void 0===Y?void 0:Y.some(X=>{var K,ie,H;return(null===(K=X.formControl)||void 0===K?void 0:K.errors)&&!X.hide&&(null===(H=null===(ie=J.options)||void 0===ie?void 0:ie.parentForm)||void 0===H?void 0:H.submitted)}))}prependCurrentValue(j,B){return!(null==B?void 0:B.href)||j.some(J=>{var R,F;return(null===(F=null===(R=null==J?void 0:J._links)||void 0===R?void 0:R.self)||void 0===F?void 0:F.href)===B.href})?j:[{name:B.title,_links:{self:B}},...j]}prependDefaultValue(j,B){return B.required||this.isMultiSelectField(B)?j:[this.selectDefaultValue,...j]}isMultiSelectField(j){var B;return null===(B=null==j?void 0:j.type)||void 0===B?void 0:B.startsWith("[]")}}C.\u0275fac=function(j){return new(j||C)(n.LFG(a.eN),n.LFG(p.D),n.LFG(m))},C.\u0275prov=n.Yz7({token:C,factory:C.\u0275fac});var u=t(26942),k=t(84335),x=t(1707);class b{constructor(j,B,J){this._httpClient=j,this._dynamicFieldsService=B,this._formsService=J}registerForm(j){this.dynamicForm=j}getSettingsFromBackend$(j,B,J={}){const R=B?`/${B}`:"",F=(null==j?void 0:j.endsWith("/form"))?"":"/form",Y=`${j}${R}${F}`;return this._httpClient.post(Y,J,{withCredentials:!0,responseType:"json"}).pipe((0,f.U)(X=>this.getSettings(X)))}getSettings(j){var B,J;this.formSchema=null===(B=j._embedded)||void 0===B?void 0:B.schema;const R=null===(J=j._embedded)||void 0===J?void 0:J.payload;return{form:new x.cw({}),fields:this._dynamicFieldsService.getConfig(this.formSchema,R),model:this._dynamicFieldsService.getModel(R)}}formatModelToEdit(j){return this._formsService.formatModelToEdit(j)}validateForm$(j,B){return this._formsService.validateForm$(j,B,this.formSchema)}submit$(j,B,J,R){return this._formsService.submit$(j,B,J,R,this.formSchema)}}b.\u0275fac=function(j){return new(j||b)(n.LFG(a.eN),n.LFG(C),n.LFG(m))},b.\u0275prov=n.Yz7({token:b,factory:b.\u0275fac});var y=t(10190),P=t(54364);function E(Z,j){if(1&Z){const B=n.EpF();n.TgZ(0,"div",5),n.TgZ(1,"button",6),n._uU(2),n.qZA(),n.TgZ(3,"button",7),n.NdJ("click",function(){return n.CHM(B),n.oxw(2).handleCancel()}),n._uU(4),n.qZA(),n.qZA()}if(2&Z){const B=n.oxw(2);n.xp6(1),n.Q6J("disabled",B.inFlight),n.xp6(1),n.hij(" ",B.text.save," "),n.xp6(2),n.hij(" ",B.text.cancel," ")}}function T(Z,j){if(1&Z){const B=n.EpF();n.TgZ(0,"form",2),n.NdJ("submit",function(){n.CHM(B);const R=n.oxw();return R.submitForm(R.form)}),n.TgZ(1,"formly-form",3),n.NdJ("modelChange",function(R){return n.CHM(B),n.oxw().onModelChange(R)}),n.qZA(),n.YNc(2,E,5,3,"div",4),n.qZA()}if(2&Z){const B=n.oxw();n.Q6J("formGroup",B.form),n.xp6(1),n.Q6J("form",B.form)("model",B.innerModel)("fields",B.fields),n.xp6(1),n.Q6J("ngIf",B.handleSubmit)}}function O(Z,j){if(1&Z){const B=n.EpF();n.TgZ(0,"formly-form",8),n.NdJ("modelChange",function(R){return n.CHM(B),n.oxw().onModelChange(R)}),n.qZA()}if(2&Z){const B=n.oxw();n.Q6J("form",B.form)("model",B.innerModel)("fields",B.fields)}}class I extends u.N{constructor(j,B,J,R,F,Y,X){super(),this.dynamicFormService=j,this.dynamicFieldsService=B,this.I18n=J,this.pathHelperService=R,this.toastService=F,this.changeDetectorRef=Y,this.confirmDialogService=X,this.formHttpMethod="post",this.initialPayload={},this.showNotifications=!0,this.showValidationErrorsOn="submit",this.handleSubmit=!0,this.modelChange=new n.vpe,this.submitted=new n.vpe,this.errored=new n.vpe,this.text={save:this.I18n.t("js.button_save"),cancel:this.I18n.t("js.button_cancel"),load_error_message:this.I18n.t("js.forms.load_error_message"),successful_update:this.I18n.t("js.notice_successful_update"),successful_create:this.I18n.t("js.notice_successful_create"),job_started:this.I18n.t("js.notice_job_started")},this.noSettingsSourceErrorMessage="DynamicFormComponent needs a settings, formUrl or resourcePath @Input\n  in order to fetch its setting. Please provide one.",this.noPathToSubmitToError="DynamicForm needs a resourcePath or formUrl @Input in order to be submitted \n  and validated. Please provide one."}set model(j){if(!this.innerModel&&!j)return;const B=this.dynamicFormService.formatModelToEdit(j);this.form.patchValue(B)}get model(){return this.form.getRawValue()}set dynamicForm(j){this.dynamicFormService.registerForm(j)}setDisabledState(j){j?this.form.disable():this.form.enable()}ngOnChanges(j){(j.settings||j.resourcePath||j.resourceId||j.formUrl||j.formHttpMethod||j.dynamicFormGroup||j.initialPayload||j.fieldsSettingsPipe||j.fieldGroups)&&this.initializeDynamicForm(this.settings,this.resourcePath,this.resourceId,this.formUrl,this.initialPayload)}onModelChange(j){this.modelChange.emit(j)}submitForm(j){if(this.handleSubmit){if(!this.formEndpoint)throw new Error(this.noPathToSubmitToError);this.inFlight=!0,this.dynamicFormService.submit$(j,this.formEndpoint,this.resourceId,this.formHttpMethod).pipe((0,c.x)(()=>this.inFlight=!1)).subscribe(B=>{this.submitted.emit(B),this.showNotifications&&this.showSuccessNotification(B)},B=>{var J;this.errored.emit((null==B?void 0:B.error)||B),this.showNotifications&&this.toastService.addError((null===(J=null==B?void 0:B.error)||void 0===J?void 0:J.message)||(null==B?void 0:B.message))})}}validateForm(){if(!this.formEndpoint)throw new Error(this.noPathToSubmitToError);return this.dynamicFormService.validateForm$(this.form,this.formEndpoint)}handleCancel(){this.form.dirty?this.confirmDialogService.confirm({text:{title:this.I18n.t("js.text_are_you_sure"),text:this.I18n.t("js.text_data_lost")}}).then(()=>{this.goBack()}).catch(()=>{}):this.goBack()}goBack(){window.history.back()}initializeDynamicForm(j,B,J,R,F){const Y=this.getFormEndPoint(R,B);if(!Y)throw new Error(this.noSettingsSourceErrorMessage);Y!==this.formEndpoint&&(this.formEndpoint=Y),j?this.setupDynamicFormFromSettings(j):this.setupDynamicFormFromBackend(this.formEndpoint,J,F)}getFormEndPoint(j,B){return j?j.endsWith("/form")?j.replace("/form",""):j:B||""}setupDynamicFormFromBackend(j,B,J){this.dynamicFormService.getSettingsFromBackend$(j,B,J).pipe((0,i.K)(R=>{throw this.toastService.addError(this.text.load_error_message),R})).subscribe(R=>this.setupDynamicForm(R))}setupDynamicFormFromSettings(j){const B={_embedded:{payload:null==j?void 0:j.payload,schema:null==j?void 0:j.schema}},J=this.dynamicFormService.getSettings(B);this.setupDynamicForm(J)}setupDynamicForm({fields:j,model:B,form:J}){this.fieldsSettingsPipe&&(j=this.fieldsSettingsPipe(j)),this.fieldGroups&&(j=this.dynamicFieldsService.getFormlyFormWithFieldGroups(this.fieldGroups,j));const R=this.resourceId||(0,y.Z)(this.resourcePath||null);B.id=R,this.fields=j,this.innerModel=B,this.form=this.dynamicFormGroup||J,this.changeDetectorRef.detectChanges()}showSuccessNotification(j){const B=(()=>{var J;return(null==j?void 0:j.jobId)?`${(null===(J=null==j?void 0:j.payload)||void 0===J?void 0:J.title)||""} ${this.text.job_started}`:"patch"===this.formHttpMethod?this.text.successful_update:this.text.successful_create})();this.toastService.addSuccess(B)}}I.\u0275fac=function(j){return new(j||I)(n.Y36(b),n.Y36(C),n.Y36(p.D),n.Y36(h.j),n.Y36(l.kl),n.Y36(n.sBO),n.Y36(k.D))},I.\u0275cmp=n.Xpm({type:I,selectors:[["op-dynamic-form"]],viewQuery:function(j,B){if(1&j&&n.Gf(e.T7,5),2&j){let J;n.iGM(J=n.CRH())&&(B.dynamicForm=J.first)}},inputs:{formUrl:"formUrl",formHttpMethod:"formHttpMethod",resourcePath:"resourcePath",resourceId:"resourceId",settings:"settings",dynamicFormGroup:"dynamicFormGroup",initialPayload:"initialPayload",model:"model",fieldsSettingsPipe:"fieldsSettingsPipe",fieldGroups:"fieldGroups",showNotifications:"showNotifications",showValidationErrorsOn:"showValidationErrorsOn",handleSubmit:"handleSubmit",helpTextAttributeScope:"helpTextAttributeScope"},outputs:{modelChange:"modelChange",submitted:"submitted",errored:"errored"},features:[n._Bn([b,C]),n.qOj,n.TTD],decls:2,vars:2,consts:[["data-qa","op-form--container","class","op-form",3,"formGroup","submit",4,"ngIf"],["data-qa","op-form--container","class","op-form--fieldset",3,"form","model","fields","modelChange",4,"ngIf"],["data-qa","op-form--container",1,"op-form",3,"formGroup","submit"],[1,"op-form--fieldset",3,"form","model","fields","modelChange"],["class","op-form--submit",4,"ngIf"],[1,"op-form--submit"],["type","submit",1,"button","-highlight",3,"disabled"],["type","button",1,"button",3,"click"],["data-qa","op-form--container",1,"op-form--fieldset",3,"form","model","fields","modelChange"]],template:function(j,B){1&j&&(n.YNc(0,T,3,5,"form",0),n.YNc(1,O,1,3,"formly-form",1)),2&j&&(n.Q6J("ngIf",B.form&&B.handleSubmit),n.xp6(1),n.Q6J("ngIf",B.form&&!B.handleSubmit))},directives:[P.O5,x._Y,x.JL,x.sg,e.T7],styles:[""]})},64775:(te,M,t)=>{"use strict";t.d(M,{r:()=>dt});var n=t(54364),e=t(66586),p=t(3353),h=t(36868),c=t(1707),i=t(2316);class l extends e.fS{}l.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(l)))(D||l)}}(),l.\u0275cmp=i.Xpm({type:l,selectors:[["op-text-input"]],features:[i.qOj],decls:1,vars:4,consts:[[1,"op-input",3,"type","formControl","formlyAttributes"]],template:function(oe,D){1&oe&&i._UZ(0,"input",0),2&oe&&(i.Q6J("type",D.to.type)("formControl",D.formControl)("formlyAttributes",D.field),i.uIk("aria-required",D.to.required))},directives:[c.Fj,c.JJ,c.oH,e.VQ],styles:[""]});class r extends e.fS{}function d(de,oe){if(1&de&&(i._UZ(0,"b",3),i._uU(1)),2&de){const D=oe.searchTerm,G=i.oxw();i.Q6J("textContent",G.to.text.add_new_action),i.xp6(1),i.hij(": ",D," ")}}function f(de,oe){if(1&de&&(i.TgZ(0,"div",4),i._uU(1),i.qZA()),2&de){const D=oe.item,G=oe.searchTerm;i.Q6J("ngOptionHighlight",G),i.xp6(1),i.Oqu(D.name)}}r.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(r)))(D||r)}}(),r.\u0275cmp=i.Xpm({type:r,selectors:[["op-integer-input"]],features:[i.qOj],decls:1,vars:5,consts:[[1,"op-input",3,"type","formControl","formlyAttributes"]],template:function(oe,D){1&oe&&i._UZ(0,"input",0),2&oe&&(i.Q6J("type",D.to.type)("formControl",D.formControl)("formlyAttributes",D.field),i.uIk("aria-required",D.to.required)("lang",D.to.locale))},directives:[c.Fj,c.JJ,c.oH,e.VQ],styles:[""]});class a extends e.fS{}a.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(a)))(D||a)}}(),a.\u0275cmp=i.Xpm({type:a,selectors:[["op-select-input"]],features:[i.qOj],decls:4,vars:16,consts:[[3,"items","formControl","formlyAttributes","multiple","bindLabel","searchable","virtualScroll","clearable","typeahead","clearOnBackspace","clearSearchOnAdd","hideSelected"],["ng-tag-tmp",""],["ng-option-tmp",""],[3,"textContent"],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight"]],template:function(oe,D){1&oe&&(i.TgZ(0,"ng-select",0),i.ALo(1,"async"),i.YNc(2,d,2,2,"ng-template",1),i.YNc(3,f,2,2,"ng-template",2),i.qZA()),2&oe&&(i.Q6J("items",i.lcZ(1,14,null==D.to?null:D.to.options))("formControl",D.formControl)("formlyAttributes",D.field)("multiple",D.to.multiple)("bindLabel",D.to.bindLabel)("searchable",D.to.searchable)("virtualScroll",D.to.virtualScroll)("clearable",D.to.clearable)("typeahead",D.to.typeahead)("clearOnBackspace",D.to.clearOnBackspace)("clearSearchOnAdd",D.to.clearSearchOnAdd)("hideSelected",D.to.hideSelected),i.uIk("aria-required",D.to.required)("required",D.to.required))},directives:[h.w9,c.JJ,c.oH,e.VQ,c.Q7,h.N6,h.Z2,p.s],pipes:[n.Ov],styles:[""]});var m=t(5443);class v extends e.fS{}v.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(v)))(D||v)}}(),v.\u0275cmp=i.Xpm({type:v,selectors:[["op-project-input"]],features:[i.qOj],decls:1,vars:5,consts:[[3,"formControl","formlyAttributes","url"]],template:function(oe,D){1&oe&&i._UZ(0,"op-project-autocompleter",0),2&oe&&(i.Q6J("formControl",D.formControl)("formlyAttributes",D.field)("url",D.to.allowedValuesHref),i.uIk("aria-required",D.to.required)("required",D.to.required))},directives:[m.F,c.JJ,c.oH,e.VQ,c.Q7],encapsulation:2,changeDetection:0});var C=t(63419);function u(de,oe){if(1&de&&(i._UZ(0,"span",3),i.TgZ(1,"span",4),i._uU(2),i.qZA()),2&de){const D=oe.item,G=i.oxw();i.Q6J("ngClass",G.cssClass(D)),i.xp6(1),i.Q6J("ngClass",G.cssClass(D)),i.xp6(1),i.Oqu(D.name)}}function k(de,oe){if(1&de&&(i._UZ(0,"span",3),i.TgZ(1,"span",4),i._uU(2),i.qZA()),2&de){const D=oe.item,G=i.oxw();i.Q6J("ngClass",G.cssClass(D)),i.xp6(1),i.Q6J("ngClass",G.cssClass(D)),i.xp6(1),i.Oqu(D.name)}}class x extends e.fS{cssClass(oe){return(0,C.p)(oe.id)}}x.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(x)))(D||x)}}(),x.\u0275cmp=i.Xpm({type:x,selectors:[["op-select-project-status-input"]],features:[i.qOj],decls:4,vars:11,consts:[["bindLabel","name",3,"items","formControl","formlyAttributes","searchable","virtualScroll","clearable","clearOnBackspace","clearSearchOnAdd","hideSelected"],["ng-label-tmp",""],["ng-option-tmp",""],[1,"project-status--bulb","-inline",3,"ngClass"],[1,"project-status--name",3,"ngClass"]],template:function(oe,D){1&oe&&(i.TgZ(0,"ng-select",0),i.ALo(1,"async"),i.YNc(2,u,3,3,"ng-template",1),i.YNc(3,k,3,3,"ng-template",2),i.qZA()),2&oe&&i.Q6J("items",i.lcZ(1,9,null==D.to?null:D.to.options))("formControl",D.formControl)("formlyAttributes",D.field)("searchable",!0)("virtualScroll",!0)("clearable",!1)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("hideSelected",!0)},directives:[h.w9,c.JJ,c.oH,e.VQ,h.bb,h.Z2,n.mk],pipes:[n.Ov],encapsulation:2});var b=t(81496);class y{}y.\u0275fac=function(oe){return new(oe||y)},y.\u0275mod=i.oAB({type:y}),y.\u0275inj=i.cJS({imports:[[n.ez,b.I]]});class P extends e.fS{}P.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(P)))(D||P)}}(),P.\u0275cmp=i.Xpm({type:P,selectors:[["op-boolean-input"]],features:[i.qOj],decls:1,vars:3,consts:[["type","checkbox",3,"formControl","formlyAttributes"]],template:function(oe,D){1&oe&&i._UZ(0,"input",0),2&oe&&(i.Q6J("formControl",D.formControl)("formlyAttributes",D.field),i.uIk("aria-required",D.to.required))},directives:[c.Wl,c.JJ,c.oH,e.VQ],styles:[""]});var E=t(96617),T=t(26611);class O{constructor(oe){this.I18n=oe,this.disabled=!1,this.initializationError=!1,this.onChange=()=>{},this.onTouch=()=>{}}get ckEditorContext(){var oe;return{type:this.templateOptions.editorType,macros:"none",options:{rtl:null===(oe=this.templateOptions)||void 0===oe?void 0:oe.rtl}}}ngOnInit(){var oe,D;this.text={attachmentLabel:this.I18n.t("js.label_formattable_attachment_hint"),save:this.I18n.t("js.inplace.button_save",{attribute:null===(oe=this.templateOptions)||void 0===oe?void 0:oe.name}),cancel:this.I18n.t("js.inplace.button_cancel",{attribute:null===(D=this.templateOptions)||void 0===D?void 0:D.name})}}writeValue(oe){this.value=oe}registerOnChange(oe){this.onChange=oe}registerOnTouched(oe){this.onTouch=oe}setDisabledState(oe){this.disabled=oe,this.editor.ckEditorInstance.isReadOnly=oe}onContentChange(oe){const D={raw:oe};this.onTouch(),this.onChange(D)}onCkeditorSetup(oe){this.editor.ckEditorInstance.ui.focusTracker.on("change:isFocused",(D,G,V)=>{!V&&!this.touched&&(this.touched=!0,this.onTouch())})}}O.\u0275fac=function(oe){return new(oe||O)(i.Y36(E.D))},O.\u0275cmp=i.Xpm({type:O,selectors:[["op-formattable-control"]],viewQuery:function(oe,D){if(1&oe&&i.Gf(T.F,7),2&oe){let G;i.iGM(G=i.CRH())&&(D.editor=G.first)}},inputs:{templateOptions:"templateOptions"},features:[i._Bn([{provide:c.JU,useExisting:(0,i.Gpc)(()=>O),multi:!0}])],decls:2,vars:2,consts:[[1,"op-ckeditor--wrapper","op-ckeditor-element"],[3,"context","content","onContentChange","onInitializationFailed","onInitialized"]],template:function(oe,D){1&oe&&(i.TgZ(0,"div",0),i.TgZ(1,"op-ckeditor",1),i.NdJ("onContentChange",function(V){return D.onContentChange(V)})("onInitializationFailed",function(){return D.initializationError=!0})("onInitialized",function(V){return D.onCkeditorSetup(V)}),i.qZA(),i.qZA()),2&oe&&(i.xp6(1),i.Q6J("context",D.ckEditorContext)("content",null==D.value?null:D.value.raw))},directives:[T.F],styles:[""]});class I extends e.fS{}I.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(I)))(D||I)}}(),I.\u0275cmp=i.Xpm({type:I,selectors:[["op-formattable-textarea-input"]],features:[i.qOj],decls:1,vars:3,consts:[[3,"templateOptions","formControl","formlyAttributes"]],template:function(oe,D){1&oe&&i._UZ(0,"op-formattable-control",0),2&oe&&i.Q6J("templateOptions",D.to)("formControl",D.formControl)("formlyAttributes",D.field)},directives:[O,c.JJ,c.oH,e.VQ],styles:[""]});var Z=t(98377),j=t(92512),B=t(83845),J=t(99100);function R(de,oe){if(1&de&&(i.TgZ(0,"spot-form-field",2),i.GkF(1,3,4),i._UZ(3,"attribute-help-text",5),i._UZ(4,"formly-validation-message",6),i.qZA()),2&de){const D=i.oxw();i.Q6J("control",null==D.field?null:D.field.formControl)("label",null==D.to?null:D.to.label)("hidden",null==D.field?null:D.field.hide)("noWrapLabel",null==D.to?null:D.to.noWrapLabel)("required",null==D.to?null:D.to.required)("helpTextAttribute",null==D.to?null:D.to.property)("helpTextAttributeScope",(null==D.to?null:D.to.helpTextAttributeScope)||(null==D.dynamicFormComponent?null:D.dynamicFormComponent.helpTextAttributeScope))("showValidationErrorOn",(null==D.to?null:D.to.showValidationErrorOn)||(null==D.dynamicFormComponent?null:D.dynamicFormComponent.showValidationErrorsOn)),i.uIk("data-qa-field-name",null==D.to?null:D.to.property),i.xp6(3),i.Q6J("attribute",null==D.to?null:D.to.property)("attributeScope",(null==D.to?null:D.to.helpTextAttributeScope)||(null==D.dynamicFormComponent?null:D.dynamicFormComponent.helpTextAttributeScope)),i.xp6(1),i.Q6J("field",D.field)}}function F(de,oe){if(1&de&&(i.TgZ(0,"spot-selector-field",7),i.GkF(1,3,4),i._UZ(3,"attribute-help-text",5),i._UZ(4,"formly-validation-message",6),i.qZA()),2&de){const D=i.oxw();i.Q6J("control",null==D.field?null:D.field.formControl)("label",null==D.to?null:D.to.label)("hidden",null==D.field?null:D.field.hide)("required",null==D.to?null:D.to.required)("showValidationErrorOn",(null==D.to?null:D.to.showValidationErrorOn)||(null==D.dynamicFormComponent?null:D.dynamicFormComponent.showValidationErrorsOn)),i.uIk("data-qa-field-name",null==D.to?null:D.to.property),i.xp6(3),i.Q6J("attribute",null==D.to?null:D.to.property)("attributeScope",(null==D.to?null:D.to.helpTextAttributeScope)||(null==D.dynamicFormComponent?null:D.dynamicFormComponent.helpTextAttributeScope)),i.xp6(1),i.Q6J("field",D.field)}}class Y extends e.n2{constructor(oe){super(),this.dynamicFormComponent=oe}}Y.\u0275fac=function(oe){return new(oe||Y)(i.Y36(Z.r,8))},Y.\u0275cmp=i.Xpm({type:Y,selectors:[["op-dynamic-field-wrapper"]],features:[i.qOj],decls:2,vars:2,consts:[[3,"control","label","hidden","noWrapLabel","required","helpTextAttribute","helpTextAttributeScope","showValidationErrorOn",4,"ngIf"],[3,"control","label","hidden","required","showValidationErrorOn",4,"ngIf"],[3,"control","label","hidden","noWrapLabel","required","helpTextAttribute","helpTextAttributeScope","showValidationErrorOn"],["slot","input"],["fieldComponent",""],["slot","help-text",1,"spot-form-field--help-text",3,"attribute","attributeScope"],["slot","errors",1,"spot-form-field--error",3,"field"],[3,"control","label","hidden","required","showValidationErrorOn"]],template:function(oe,D){1&oe&&(i.YNc(0,R,5,12,"spot-form-field",0),i.YNc(1,F,5,9,"spot-selector-field",1)),2&oe&&(i.Q6J("ngIf","booleanInput"!==D.field.type),i.xp6(1),i.Q6J("ngIf","booleanInput"===D.field.type))},directives:[n.O5,j.I,B.y,e.u_,J.o],styles:[""],changeDetection:0});var X=t(6894),K=t(2281),ie=t(90547);class H extends ie.S{constructor(){super(...arguments),this.onControlChange=()=>{},this.onControlTouch=()=>{}}writeValue(oe){this.initialDate=this.formatter(oe)}registerOnChange(oe){this.onControlChange=oe}registerOnTouched(oe){this.onControlTouch=oe}setDisabledState(oe){this.disabled=oe}ngAfterViewInit(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.initializeDatepicker(),this.changeDetectorRef.detectChanges()})})}onInputChange(){const oe=this.inputIsValidDate()?this.parser(this.currentValue):"";this.onControlChange(oe),this.onControlTouch()}closeOnOutsideClick(oe){super.closeOnOutsideClick(oe),this.onControlTouch()}parser(oe){return K(oe,"YYYY-MM-DD",!0).isValid()?oe:null}formatter(oe){if(K(oe,"YYYY-MM-DD",!0).isValid()){const D=this.timezoneService.parseDate(oe);return this.timezoneService.formattedISODate(D)}return""}}H.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(H)))(D||H)}}(),H.\u0275cmp=i.Xpm({type:H,selectors:[["op-date-picker-control"]],inputs:{disabled:["disable","disabled"]},features:[i._Bn([{provide:c.JU,useExisting:(0,i.Gpc)(()=>H),multi:!0}]),i.qOj],decls:2,vars:7,consts:[["type","text",3,"id","name","value","ngClass","size","required","disabled","click","keydown.enter","keydown.escape","input","blur"],["dateInput",""]],template:function(oe,D){1&oe&&(i.TgZ(0,"input",0,1),i.NdJ("click",function(){return D.openOnClick()})("keydown.enter",function(){return D.enterPressed.emit(D.dateValue)})("keydown.escape",function(){return D.close()})("input",function(){return D.onInputChange()})("blur",function(V){return D.onBlurred(V)}),i.qZA()),2&oe&&i.Q6J("id",D.id)("name",D.name)("value",D.initialDate||"")("ngClass",D.classes+" op-input")("size",D.size)("required",D.required)("disabled",D.disabled)},directives:[n.mk],encapsulation:2});class ee extends e.fS{}ee.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(ee)))(D||ee)}}(),ee.\u0275cmp=i.Xpm({type:ee,selectors:[["op-date-input"]],features:[i.qOj],decls:1,vars:4,consts:[[3,"required","disable","formControl","formlyAttributes"]],template:function(oe,D){1&oe&&i._UZ(0,"op-date-picker-control",0),2&oe&&i.Q6J("required",D.to.required)("disable",D.to.disabled)("formControl",D.formControl)("formlyAttributes",D.field)},directives:[H,c.Q7,c.JJ,c.oH,e.VQ],styles:[""]});const ce=function(de){return{"op-fieldset_collapsed":de}};function se(de,oe){if(1&de){const D=i.EpF();i.TgZ(0,"fieldset",2),i.TgZ(1,"legend",3),i.TgZ(2,"button",4),i.NdJ("click",function(){i.CHM(D);const V=i.oxw();return V.to.collapsibleFieldGroupsCollapsed=!V.to.collapsibleFieldGroupsCollapsed}),i._uU(3),i.qZA(),i.qZA(),i.TgZ(4,"div",5),i.GkF(5,null,6),i.qZA(),i.qZA()}if(2&de){const D=i.oxw();i.Q6J("ngClass",i.VKq(2,ce,D.to.collapsibleFieldGroupsCollapsed)),i.xp6(3),i.hij(" ",D.to.label," ")}}function re(de,oe){if(1&de&&(i.TgZ(0,"fieldset",7),i.TgZ(1,"legend",3),i._uU(2),i.qZA(),i.TgZ(3,"div",5),i.GkF(4,null,6),i.qZA(),i.qZA()),2&de){const D=i.oxw();i.xp6(2),i.Oqu(D.to.label)}}class Me extends e.n2{}Me.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(Me)))(D||Me)}}(),Me.\u0275cmp=i.Xpm({type:Me,selectors:[["op-dynamic-field-group-wrapper"]],features:[i.qOj],decls:2,vars:2,consts:[["class","op-fieldset op-fieldset_collapsible",3,"ngClass",4,"ngIf"],["class","op-fieldset",4,"ngIf"],[1,"op-fieldset","op-fieldset_collapsible",3,"ngClass"],[1,"op-fieldset--legend"],["title","Show/hide","type","button",1,"op-fieldset--toggle",3,"click"],[1,"op-fieldset--fields"],["fieldComponent",""],[1,"op-fieldset"]],template:function(oe,D){1&oe&&(i.YNc(0,se,7,4,"fieldset",0),i.YNc(1,re,6,1,"fieldset",1)),2&oe&&(i.Q6J("ngIf",null==D.to?null:D.to.collapsibleFieldGroups),i.xp6(1),i.Q6J("ngIf",!(null!=D.to&&D.to.collapsibleFieldGroups)))},directives:[n.O5,n.mk],styles:[""]});var Ae=t(97779),Ye=t(76315);class ze{}ze.\u0275fac=function(oe){return new(oe||ze)},ze.\u0275mod=i.oAB({type:ze}),ze.\u0275inj=i.cJS({imports:[[n.ez,Ae.$,Ye.s]]});var Xe=t(21757),it=t(90127);class at extends e.fS{ngOnInit(){var oe;this.projectId=null===(oe=this.model)||void 0===oe?void 0:oe.id}}at.\u0275fac=function(){let de;return function(D){return(de||(de=i.n5z(at)))(D||at)}}(),at.\u0275cmp=i.Xpm({type:at,selectors:[["op-user-input"]],features:[i.qOj],decls:1,vars:6,consts:[[3,"formControl","formlyAttributes","url","inviteUserToProject"]],template:function(oe,D){1&oe&&i._UZ(0,"op-user-autocompleter",0),2&oe&&(i.Q6J("formControl",D.formControl)("formlyAttributes",D.field)("url",D.to.allowedValuesHref)("inviteUserToProject",D.projectId),i.uIk("aria-required",D.to.required)("required",D.to.required))},directives:[it.U,c.JJ,c.oH,e.VQ,c.Q7],encapsulation:2,changeDetection:0});var lt=t(71858);class dt{}dt.\u0275fac=function(oe){return new(oe||dt)},dt.\u0275mod=i.oAB({type:dt}),dt.\u0275inj=i.cJS({imports:[[n.ez,c.UX,lt.a,e.X0.forRoot({types:[{name:"booleanInput",component:P},{name:"integerInput",component:r},{name:"textInput",component:l},{name:"dateInput",component:ee},{name:"selectInput",component:a},{name:"projectInput",component:v},{name:"selectProjectStatusInput",component:x},{name:"formattableInput",component:I},{name:"userInput",component:at}],wrappers:[{name:"op-dynamic-field-group-wrapper",component:Me},{name:"op-dynamic-field-wrapper",component:Y}]}),Xe.H,h.A0,p._,X.Y,y,ze]]})},77616:(te,M,t)=>{"use strict";t.d(M,{mE:()=>k,U$:()=>x,s5:()=>b});var n=t(3786),e=t(2316),p=t(96617),h=t(49951),c=t(29161),i=t(54364),l=t(1707),r=t(84312),d=t(2775);const f=["editableTitleInput"];function a(y,P){if(1&y){const E=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(O){return e.CHM(E),e.oxw(2).save(O,!0)}),e._UZ(1,"op-icon",8),e.qZA()}if(2&y){const E=e.oxw(2);e.uIk("title",E.text.query_has_changed_click_to_save)}}const m=function(y,P){return{"-error":y,"-changed":P}};function v(y,P){if(1&y){const E=e.EpF();e.TgZ(0,"div",2),e.NdJ("focusout",function(O){return e.CHM(E),e.oxw().saveWhenFocusOutside(O)}),e.YNc(1,a,2,1,"button",3),e.TgZ(2,"input",4,5),e.NdJ("focus",function(O){return e.CHM(E),e.oxw().onFocus(O)})("blur",function(){return e.CHM(E),e.oxw().onBlur()})("keydown.escape",function(O){return e.CHM(E),e.oxw().reset(O)})("keydown.enter",function(O){return e.CHM(E),e.oxw().save(O)})("ngModelChange",function(O){e.CHM(E);return e.oxw().selectedTitle=O}),e.qZA(),e.TgZ(4,"input-shim",6),e._uU(5),e.qZA(),e.qZA()}if(2&y){const E=e.oxw();e.xp6(1),e.Q6J("ngIf",E.showSave),e.xp6(1),e.Q6J("opAutofocus",E.initialFocus||void 0)("ngModel",E.selectedTitle)("disabled",E.inFlight)("ngClass",e.WLB(10,m,E.isEmpty,E.showSave)),e.uIk("name",E.selectableTitleIdentifier)("placeholder",E.text.input_placeholder)("title",E.text.input_title),e.xp6(3),e.AsE("",E.selectedTitle||E.text.input_placeholder,"",E.selectedTitle?"\xa0\xa0":"","")}}const C=function(y,P){return{"-disabled":y,"-small":P}};function u(y,P){if(1&y&&(e.TgZ(0,"h2",9),e._uU(1),e.qZA()),2&y){const E=e.oxw();e.Q6J("ngClass",e.WLB(3,C,E.disabled,E.smallHeader)),e.uIk("title",E.selectedTitle),e.xp6(1),e.hij("",E.selectedTitle,"\n")}}const k="op:selectableTitle:trigger",x="editable-toolbar-title";class b{constructor(P){this.injector=P,this.editable=!0,this.inFlight=!1,this.showSaveCondition=!1,this.initialFocus=!1,this.smallHeader=!1,this.onSave=new e.vpe,this.onEmptySubmit=new e.vpe,this.baseClass=!0,this.selectableTitleIdentifier=x,this.text={click_to_edit:this.I18n.t("js.work_packages.query.click_to_edit_query_name"),press_enter_to_save:this.I18n.t("js.label_press_enter_to_save"),query_has_changed_click_to_save:this.I18n.t("js.label_view_has_changed"),input_title:"",input_placeholder:this.I18n.t("js.work_packages.query.rename_query_placeholder"),confirm_edit_cancel:this.I18n.t("js.work_packages.query.confirm_edit_cancel"),duplicate_query_title:this.I18n.t("js.work_packages.query.errors.duplicate_query_title")}}get editableClass(){return this.editable}ngOnInit(){this.text.input_title=`${this.text.click_to_edit} ${this.text.press_enter_to_save}`,jQuery(this.elementRef.nativeElement).on(k,(P,E="")=>{!this.inputField||(this.selectedTitle=E,setTimeout(()=>{this.inputField.nativeElement.focus()},20),P.stopPropagation())})}ngOnChanges(P){if(P.inputTitle&&(this.selectedTitle=P.inputTitle.currentValue),P.initialFocus&&P.initialFocus.firstChange&&this.inputField){const E=this.inputField.nativeElement;this.selectInputOnInitalFocus(E)}}onFocus(P){this.toggleToolbarButtonVisibility(!0),this.selectInputOnInitalFocus(P.target)}onBlur(){this.toggleToolbarButtonVisibility(!1)}selectInputOnInitalFocus(P){this.initialFocus&&(P.select(),this.initialFocus=!1)}saveWhenFocusOutside(P){(0,h.w)(this.elementRef.nativeElement,()=>this.save(P))}reset(){this.resetInputField(),this.selectedTitle=this.inputTitle}get showSave(){return this.editable&&this.showSaveCondition}save(P,E=!1){P.preventDefault(),this.resetInputField(),this.selectedTitle=this.selectedTitle.trim(),this.isEmpty?this.onEmptyError():!E&&this.inputTitle===this.selectedTitle||(this.inputField&&this.inputField.nativeElement.blur(),!this.inFlight&&(this.inFlight=!0,this.emitSave(this.selectedTitle),setTimeout(()=>this.inFlight=!1,100)))}get isEmpty(){return""===this.selectedTitle}emitSave(P){this.onSave.emit(P)}onEmptyError(){this.onEmptySubmit.emit(),this.focusInputOnError()}focusInputOnError(){if(this.inputField){const P=this.inputField.nativeElement;P.classList.add("-error"),P.focus()}}resetInputField(){this.inputField&&this.inputField.nativeElement.classList.remove("-error")}toggleToolbarButtonVisibility(P){jQuery(".toolbar-items").toggleClass("hidden-for-mobile",P)}}b.\u0275fac=function(P){return new(P||b)(e.Y36(e.zs3))},b.\u0275cmp=e.Xpm({type:b,selectors:[["editable-toolbar-title"]],viewQuery:function(P,E){if(1&P&&e.Gf(f,5),2&P){let T;e.iGM(T=e.CRH())&&(E.inputField=T.first)}},hostVars:4,hostBindings:function(P,E){2&P&&e.ekj("title-container",E.baseClass)("title-container_editable",E.editableClass)},inputs:{inputTitle:["title","inputTitle"],editable:"editable",inFlight:"inFlight",showSaveCondition:"showSaveCondition",initialFocus:"initialFocus",smallHeader:"smallHeader"},outputs:{onSave:"onSave",onEmptySubmit:"onEmptySubmit"},features:[e.TTD],decls:2,vars:2,consts:[["class","editable-toolbar-title--container",3,"focusout",4,"ngIf"],["class","editable-toolbar-title--fixed",3,"ngClass",4,"ngIf"],[1,"editable-toolbar-title--container",3,"focusout"],["type","button","class","spot-link editable-toolbar-title--save",3,"click",4,"ngIf"],["size","1","type","text","aria-required","true",1,"editable-toolbar-title--input","-border-on-hover-only","toolbar--editable-toolbar","ellipsis",3,"opAutofocus","ngModel","disabled","ngClass","focus","blur","keydown.escape","keydown.enter","ngModelChange"],["editableTitleInput",""],[1,"editable-toolbar-title--input","editable-toolbar-title--input-shim","toolbar--editable-toolbar"],["type","button",1,"spot-link","editable-toolbar-title--save",3,"click"],["icon-classes","icon icon-save icon-no-color"],[1,"editable-toolbar-title--fixed",3,"ngClass"]],template:function(P,E){1&P&&(e.YNc(0,v,6,13,"div",0),e.YNc(1,u,2,6,"h2",1)),2&P&&(e.Q6J("ngIf",E.editable),e.xp6(1),e.Q6J("ngIf",!E.editable))},directives:[i.O5,l.Fj,r.U,l.JJ,l.On,i.mk,d.o],styles:['.editable-toolbar-title--container[_ngcontent-%COMP%]{display:grid;align-items:center;grid-template-columns:auto auto 1fr}.editable-toolbar-title--container[_ngcontent-%COMP%]:before, .editable-toolbar-title--container[_ngcontent-%COMP%]:after{display:block;content:""}.editable-toolbar-title--container[_ngcontent-%COMP%]:before{grid-area:1/1}.editable-toolbar-title--container[_ngcontent-%COMP%]:after{grid-area:1/3}.editable-toolbar-title--fixed[_ngcontent-%COMP%]{padding:0;cursor:default}.editable-toolbar-title--save[_ngcontent-%COMP%]{grid-area:1/1}.editable-toolbar-title--save[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{color:#5f5f5f}.editable-toolbar-title--save[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]:before{color:#2c2c2c}.editable-toolbar-title--input[_ngcontent-%COMP%]{color:#5f5f5f}.editable-toolbar-title--input[_ngcontent-%COMP%]:focus{border-color:#999;box-shadow:0 0 0 1px #999}.editable-toolbar-title--input.-changed[_ngcontent-%COMP%]{font-style:italic}.editable-toolbar-title--input[_ngcontent-%COMP%]{display:block;grid-area:1/2;padding-left:5px;width:auto;min-width:1em}.editable-toolbar-title--input-shim[_ngcontent-%COMP%]{visibility:hidden;white-space:pre}input-shim[_ngcontent-%COMP%]{border:1px solid transparent;padding:.375rem;margin:0}']}),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",e.SBq)],b.prototype,"elementRef",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",p.D)],b.prototype,"I18n",void 0)},17076:(te,M,t)=>{"use strict";t.d(M,{K:()=>p});var n=t(80261),e=t(2316);class p{constructor(c,i,l){this.componentFactoryResolver=c,this.appRef=i,this.injector=l}render(c,i){c.innerHTML=i;const l=[];return n.Z.getEmbeddable().forEach(r=>{const d=c.querySelectorAll(r.selector);for(let f=0,a=d.length;f<a;f++){const v=this.componentFactoryResolver.resolveComponentFactory(r.cls).create(this.injector,[],d[f]);l.push(v),this.appRef.attachView(v.hostView),v.changeDetectorRef.detectChanges()}}),()=>{l.forEach(r=>{this.appRef.detachView(r.hostView),r.destroy()}),l.length=0,c.innerHTML=""}}}p.\u0275fac=function(c){return new(c||p)(e.LFG(e._Vd),e.LFG(e.z2F),e.LFG(e.zs3))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac})},37130:(te,M,t)=>{"use strict";t.d(M,{j:()=>h});var n=t(3786),e=t(70233),p=t(2316);class h{constructor(i){this.PathHelper=i,this.loadedLocale="en"}create(i,l,r=null){return(0,n.mG)(this,void 0,void 0,function*(){yield this.load();const{type:d}=l,f="constrained"===d?window.OPConstrainedEditor:window.OPClassicEditor;i.classList.add(`ckeditor-type-${d}`);const a=i.querySelector(".document-editor__toolbar"),m=i.querySelector(".document-editor__editable"),v=this.loadedLocale,C=l.options&&l.options.rtl?"ar":"en",u={openProject:this.createConfig(l),initialData:r,language:{ui:v,content:C}};return this.createWatchdog(f,m,u).then(k=>{const{editor:x}=k;return a.appendChild(x.ui.view.toolbar.element),jQuery(i).on("op:ckeditor:setData",(b,y)=>x.setData(y)).on("op:ckeditor:clear",()=>x.setData(" ")).on("op:ckeditor:getData",(b,y)=>y(x.getData({trim:!1}))),k})})}createWatchdog(i,l,r){const d=new window.OPEditorWatchdog;return d.setCreator(()=>i.createCustomized(l,r)),d.setDestructor(f=>f.destroy()),d.create(l,{}).then(()=>d)}load(){return(0,n.mG)(this,void 0,void 0,function*(){yield t.e("src_vendor_ckeditor_ckeditor_js").then(t.t.bind(t,24626,23));try{yield t(87983)(`./${I18n.locale}.js`),this.loadedLocale=I18n.locale}catch(i){console.warn(`Failed to load translation for CKEditor: ${i}`)}})}createConfig(i){return"none"===i.macros?i.macros=!1:"resource"===i.macros&&(i.macros=["OPMacroToc","OPMacroEmbeddedTable","OPMacroWpButton"]),{context:i,helpURL:this.PathHelper.textFormattingHelp(),pluginContext:window.OpenProject.pluginContext.value}}}h.\u0275fac=function(i){return new(i||h)(p.LFG(e.j))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},26611:(te,M,t)=>{"use strict";t.d(M,{F:()=>C});var n=t(2316),e=t(36293),p=t(96617),h=t(12877),c=t(7493),i=t(37130),l=t(54364),r=t(1707);const d=["opCkeditorReplacementContainer"],f=["codeMirrorPane"];function a(u,k){if(1&u){const x=n.EpF();n.TgZ(0,"div"),n.TgZ(1,"label",7),n.TgZ(2,"input",8),n.NdJ("change",function(y){return n.CHM(x),n.oxw().onChange(y)}),n.qZA(),n._uU(3),n.qZA(),n.qZA()}if(2&u){const x=n.oxw();n.xp6(2),n.Q6J("disabled",x.isDisabled)("ngModel",x.isPrivate),n.xp6(1),n.hij(" ",x.text.privateNote," ")}}function m(u,k){if(1&u&&(n.TgZ(0,"div",9),n.TgZ(1,"div",10),n.TgZ(2,"p"),n._UZ(3,"strong",11),n._UZ(4,"br"),n._UZ(5,"span",11),n.qZA(),n.qZA(),n.qZA()),2&u){const x=n.oxw();n.xp6(3),n.Q6J("textContent",x.text.errorTitle),n.xp6(2),n.Q6J("textContent",x.error)}}class C{constructor(k,x,b,y,P,E){this.elementRef=k,this.authorisation=x,this.Notifications=b,this.I18n=y,this.configurationService=P,this.ckEditorSetup=E,this.onInitialized=new n.vpe,this.onContentChange=new n.vpe,this.onInitializationFailed=new n.vpe,this.error=null,this.allowManualMode=!1,this.isDisabled=!0,this.manualMode=!1,this._content="",this.text={errorTitle:this.I18n.t("js.editor.ckeditor_error"),privateNote:this.I18n.t("js.editor.private_note")},this.debouncedEmitter=_.debounce(()=>{this.getTransformedContent(!1).then(T=>{this.onContentChange.emit(T)})},1e3,{leading:!0})}set content(k){this._content=k||"",this.initialized&&this.ckEditorInstance.setData(this._content)}get showIsPrivate(){return"comment"==this.fieldName||"work_package_journal_notes"==this.fieldName}getRawData(){return this.manualMode?this._content=this.codeMirrorInstance.getValue():this._content=this.ckEditorInstance.getData({trim:!1})}getTransformedContent(k=!0){if(!this.initialized)throw new Error("Tried to access CKEditor instance before initialization.");return new Promise((x,b)=>{try{x(this.getRawData())}catch(y){console.error(`Failed to save CKEditor content: ${y}.`);const P=this.I18n.t("js.editor.error_saving_failed",{error:y||this.I18n.t("js.error.internal")});k&&this.Notifications.addError(P),b(P)}})}get content(){return this._content}get initialized(){return void 0!==this.ckEditorInstance}ngOnInit(){try{this.initializeEditor();const k=this.authorisation.can("work_package","privateComment"),x=this.authorisation.can("work_package","addComment");this.isPrivate=k&&!x,this.isDisabled=!1}catch(k){console.error(`Failed to setup CKEditor instance: ${k}`),this.error=k,this.onInitializationFailed.emit(k)}}onChange(k){this.isPrivate=k.target.checked}ngAfterViewInit(){setTimeout(()=>{const k=this.authorisation.can("work_package","privateComment"),x=this.authorisation.can("work_package","addComment");this.isDisabled=!k&&x||k&&!x})}ngOnDestroy(){var k;try{null===(k=this.watchdog)||void 0===k||k.destroy()}catch(x){console.error("Failed to destroy CKEditor instance:",x)}}initializeEditor(){this.$element=jQuery(this.elementRef.nativeElement);const k=this.ckEditorSetup.create(this.opCkeditorReplacementContainer.nativeElement,this.context,this.content).catch(x=>{throw x}).then(x=>(this.setupWatchdog(x),this.ckEditorInstance=x.editor,x.editor.model.document.on("change",this.debouncedEmitter),x.editor.on("op:source-code-enabled",()=>this.enableManualMode()),x.editor.on("op:source-code-disabled",()=>this.disableManualMode()),this.onInitialized.emit(x.editor),x.editor));this.$element.data("editor",k)}disableManualMode(){const k=this.getRawData();this.ckEditorInstance.setData(k),this.codeMirrorInstance=null,this.manualMode=!1}enableManualMode(){const k=this.getRawData();Promise.all([t.e("default-node_modules_codemirror_lib_codemirror_js").then(t.t.bind(t,21302,23)),t(30341)("./gfm/gfm.js")]).then(b=>{const y=b[0].default;this.codeMirrorInstance=y(this.$element.find(".ck-editor__source")[0],{lineNumbers:!0,smartIndent:!0,value:k,mode:""}),this.codeMirrorInstance.on("change",this.debouncedEmitter),setTimeout(()=>this.codeMirrorInstance.refresh(),100),this.manualMode=!0})}setupWatchdog(k){this.watchdog=k,k.on("error",(x,{error:b})=>{this.error=b.message})}}C.\u0275fac=function(k){return new(k||C)(n.Y36(n.SBq),n.Y36(c.g),n.Y36(e.kl),n.Y36(p.D),n.Y36(h.e),n.Y36(i.j))},C.\u0275cmp=n.Xpm({type:C,selectors:[["op-ckeditor"]],viewQuery:function(k,x){if(1&k&&(n.Gf(d,7),n.Gf(f,5)),2&k){let b;n.iGM(b=n.CRH())&&(x.opCkeditorReplacementContainer=b.first),n.iGM(b=n.CRH())&&(x.codeMirrorPane=b.first)}},inputs:{context:"context",isPrivate:"isPrivate",fieldName:"fieldName",content:"content"},outputs:{onInitialized:"onInitialized",onContentChange:"onContentChange",onInitializationFailed:"onInitializationFailed"},decls:8,vars:2,consts:[[4,"ngIf"],["class","op-toast -error",4,"ngIf"],[1,"op-ckeditor-source-element","document-editor"],["opCkeditorReplacementContainer",""],[1,"document-editor__toolbar"],[1,"document-editor__editable-container"],[1,"document-editor__editable"],[1,"form--label-with-check-box"],["name","work_package[is_private]","slot","input","type","checkbox",3,"disabled","ngModel","change"],[1,"op-toast","-error"],[1,"op-toast--content"],[3,"textContent"]],template:function(k,x){1&k&&(n.ynx(0),n.YNc(1,a,4,3,"div",0),n.YNc(2,m,6,2,"div",1),n.TgZ(3,"div",2,3),n._UZ(5,"div",4),n.TgZ(6,"div",5),n._UZ(7,"div",6),n.qZA(),n.qZA(),n.BQk()),2&k&&(n.xp6(1),n.Q6J("ngIf",x.showIsPrivate),n.xp6(1),n.Q6J("ngIf",x.error))},directives:[l.O5,r.Wl,r.JJ,r.On],styles:[".op-ckeditor--mode-switch[_ngcontent-%COMP%]{text-align:right}.op-ckeditor--mode-switch[_ngcontent-%COMP%]   button.button[_ngcontent-%COMP%]{margin:0 0 5px}"]})},97779:(te,M,t)=>{"use strict";t.d(M,{$:()=>d});var n=t(1707),e=t(54364),p=t(31283),h=t(55811),c=t(37130),i=t(17076),l=t(82170),r=t(2316);class d{}d.\u0275fac=function(a){return new(a||d)},d.\u0275mod=r.oAB({type:d}),d.\u0275inj=r.cJS({providers:[l.f,c.j,i.K],imports:[[n.u5,e.ez,p.Z,h.K]]})},8158:(te,M,t)=>{"use strict";t.d(M,{z:()=>u,P:()=>k});var n=t(73881),e=t(96617),p=t(97656),h=t(77355),c=t(70233),i=t(45410),l=t(27779),r=t(2316),d=t(54364);function f(x,b){if(1&x){const y=r.EpF();r.TgZ(0,"button",11),r.NdJ("click",function(){return r.CHM(y),r.oxw().toggleCollapse()}),r._UZ(1,"span",12),r.qZA()}if(2&x){const y=r.oxw();r.xp6(1),r.Q6J("ngClass",y.collapsed?"spot-icon_arrow-down1":"spot-icon_arrow-up1")}}function a(x,b){if(1&x&&(r.TgZ(0,"span",13),r._UZ(1,"strong",14),r._uU(2),r.qZA()),2&x){const y=r.oxw();r.xp6(1),r.Q6J("textContent",y.text.become_hero),r.xp6(1),r.hij(" ",y.text.you_contribute," ")}}function m(x,b){if(1&x&&(r.TgZ(0,"a",20),r._UZ(1,"span",21),r._uU(2),r.qZA()),2&x){const y=r.oxw(2);r.uIk("href",y.moreInfoLink,r.LSH),r.xp6(2),r.hij(" ",y.text.more_info_text," ")}}function v(x,b){if(1&x&&(r.TgZ(0,"div",15),r.YNc(1,m,3,2,"a",16),r.TgZ(2,"a",17),r._UZ(3,"span",18),r._uU(4),r.qZA(),r.TgZ(5,"a",19),r._uU(6),r.qZA(),r.qZA()),2&x){const y=r.oxw();r.xp6(1),r.Q6J("ngIf",y.moreInfoLink),r.xp6(1),r.Q6J("href",y.pricingUrl,r.LSH),r.xp6(2),r.hij(" ",y.text.upgrade," "),r.xp6(1),r.uIk("href",y.text.more_info_link,r.LSH),r.xp6(1),r.hij(" ",y.text.button_trial," ")}}const C=function(x){return{"-left-margin":x}},u="op-enterprise-banner";class k{constructor(b,y,P,E,T,O){this.elementRef=b,this.I18n=y,this.bannersService=P,this.opModalService=E,this.injector=T,this.pathHelper=O,this.leftMargin=!1,this.collapsed=!1,this.pricingUrl=l.wp,this.text={enterpriseFeature:this.I18n.t("js.upsale.ee_only"),become_hero:this.I18n.t("js.admin.enterprise.upsale.become_hero"),you_contribute:this.I18n.t("js.admin.enterprise.upsale.you_contribute"),button_trial:this.I18n.t("js.admin.enterprise.upsale.button_start_trial"),upgrade:this.I18n.t("js.admin.enterprise.upsale.button_upgrade"),more_info_link:`${this.pathHelper.appBasePath}/admin/enterprise`,more_info_text:this.I18n.t("js.admin.enterprise.upsale.more_info")},this.image={enterprise_edition:(0,p.h)("enterprise-add-on.svg")},(0,i.E)(this)}ngOnInit(){this.link=this.bannersService.getEnterPriseEditionUrl({referrer:this.opReferrer}),this.collapsed=this.collapsible}toggleCollapse(){this.collapsed=!this.collapsed}}k.\u0275fac=function(b){return new(b||k)(r.Y36(r.SBq),r.Y36(e.D),r.Y36(n.j),r.Y36(h.S),r.Y36(r.zs3),r.Y36(c.j))},k.\u0275cmp=r.Xpm({type:k,selectors:[["op-enterprise-banner"]],inputs:{leftMargin:"leftMargin",textMessage:"textMessage",linkMessage:"linkMessage",opReferrer:"opReferrer",moreInfoLink:"moreInfoLink",collapsible:"collapsible"},decls:12,vars:9,consts:[["data-qa-selector","op-enterprise-banner",1,"op-enterprise-banner"],[1,"op-toast","-ee-upsale",3,"ngClass"],[1,"hidden-for-mobile","op-enterprise-banner--image",3,"src"],[1,"op-toast--content"],[1,"op-enterprise-banner--header"],[1,"spot-icon","spot-icon_enterprise-addons"],[1,"op-enterprise-banner--title",3,"textContent"],["class","op-enterprise-banner--collapsible-button","type","button",3,"click",4,"ngIf"],[1,"op-enterprise-banner--description",3,"innerHtml"],["class","op-enterprise-banner--description",4,"ngIf"],["class","op-enterprise-banner--buttons",4,"ngIf"],["type","button",1,"op-enterprise-banner--collapsible-button",3,"click"],["aria-hidden","true",1,"spot-icon",3,"ngClass"],[1,"op-enterprise-banner--description"],[3,"textContent"],[1,"op-enterprise-banner--buttons"],["class","op-enterprise-banner--info-button","target","\u201d_blank\u201d",4,"ngIf"],["target","\u201d_blank\u201d",1,"button","-highlight",3,"href"],[1,"spot-icon","spot-icon_enterprise-addons","enterprise-addons--button-icon"],["target","\u201d_blank\u201d",1,"button","-alt-highlight"],["target","\u201d_blank\u201d",1,"op-enterprise-banner--info-button"],[1,"spot-icon","spot-icon_external-link"]],template:function(b,y){1&b&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r._UZ(2,"img",2),r.TgZ(3,"div",3),r.TgZ(4,"div",4),r._UZ(5,"span",5),r._UZ(6,"span",6),r.YNc(7,f,2,1,"button",7),r.qZA(),r._UZ(8,"br"),r._UZ(9,"span",8),r.YNc(10,a,3,2,"span",9),r.YNc(11,v,7,5,"div",10),r.qZA(),r.qZA(),r.qZA()),2&b&&(r.xp6(1),r.Q6J("ngClass",r.VKq(7,C,y.leftMargin)),r.xp6(1),r.Q6J("src",y.image.enterprise_edition,r.LSH),r.xp6(4),r.Q6J("textContent",y.text.enterpriseFeature),r.xp6(1),r.Q6J("ngIf",y.collapsible),r.xp6(2),r.Q6J("innerHtml",y.textMessage,r.oJD),r.xp6(1),r.Q6J("ngIf",!y.collapsed),r.xp6(1),r.Q6J("ngIf",!y.collapsed))},directives:[d.mk,d.O5],styles:[".op-enterprise-banner--header[_ngcontent-%COMP%]{font-size:20px;line-height:24px;display:grid;grid-template-columns:auto auto 1fr;margin-top:10px;align-items:center}.op-enterprise-banner--title[_ngcontent-%COMP%]{margin-left:.5rem}.op-enterprise-banner--description[_ngcontent-%COMP%]{display:block;font-family:Lato,sans-serif;font-size:.875rem;font-weight:normal;font-style:normal;line-height:1.25rem;margin-bottom:.75rem}.op-enterprise-banner--image[_ngcontent-%COMP%]{width:115px;height:75px;padding-right:20px;margin:auto}.op-enterprise-banner--buttons[_ngcontent-%COMP%]{display:flex;justify-content:end}.op-enterprise-banner--info-button[_ngcontent-%COMP%]{padding-top:1.25rem;padding-right:1.5rem}.op-enterprise-banner--info-button[_ngcontent-%COMP%]   .spot-icon[_ngcontent-%COMP%]:before{padding-right:.875rem}.op-enterprise-banner--collapsible-button[_ngcontent-%COMP%]{background:transparent;color:#1a67a3;border:0;padding:.5rem;cursor:pointer;display:flex;justify-content:end}"],changeDetection:0})},54547:(te,M,t)=>{"use strict";t.d(M,{z:()=>C,_:()=>u});var n=t(96617),e=t(97656),p=t(70233),h=t(27779),c=t(2316),i=t(54364),l=t(12839);function r(k,x){if(1&k&&(c.TgZ(0,"p"),c._uU(1),c.qZA()),2&k){const b=c.oxw();c.xp6(1),c.Oqu(b.feature_description)}}function d(k,x){if(1&k&&(c.TgZ(0,"p",12),c._uU(1),c._UZ(2,"br"),c._uU(3),c._UZ(4,"br"),c._uU(5),c.qZA()),2&k){const b=c.oxw();c.xp6(1),c.hij(" ",b.text.benefits_description," "),c.xp6(2),c.hij(" ",b.text.premium_features_text," "),c.xp6(2),c.hij(" ",b.text.professional_support_text," ")}}function f(k,x){if(1&k&&(c.TgZ(0,"video",13),c._UZ(1,"source",14),c.qZA()),2&k){const b=c.oxw();c.Q6J("autoplay",!0)("loop",!0)("muted",!0),c.xp6(1),c.Q6J("src",b.feature_video,c.LSH)}}function a(k,x){if(1&k&&c._UZ(0,"img",15),2&k){const b=c.oxw();c.Q6J("src",b.feature_image,c.LSH)}}function m(k,x){if(1&k&&c._UZ(0,"img",16),2&k){const b=c.oxw();c.Q6J("src",b.image.enterprise_edition,c.LSH)}}const v=function(k){return{"upsale-notification_hide-breadcrumb":k}},C="op-enterprise-page";class u{constructor(x,b,y){this.elementRef=x,this.I18n=b,this.pathHelper=y,this.hide_breadcrumb=!1,this.text={button_contact_us:this.I18n.t("js.admin.enterprise.upsale.button_contact_us"),upgrade:this.I18n.t("js.admin.enterprise.upsale.button_upgrade"),upgrade_link:h.wp,contact_link:h.vY.en,benefits_description:this.I18n.t("js.admin.enterprise.upsale.benefits.description"),premium_features_text:this.I18n.t("js.admin.enterprise.upsale.benefits.premium_features_text"),professional_support_text:this.I18n.t("js.admin.enterprise.upsale.benefits.professional_support_text"),enterprise_info_html:P=>this.I18n.t("js.admin.enterprise.upsale.enterprise_info_html",{feature_title:P}),upgrade_info:this.I18n.t("js.admin.enterprise.upsale.upgrade_info"),button_contact:this.I18n.t("js.admin.enterprise.upsale.buttons.contact"),button_upgrade:this.I18n.t("js.admin.enterprise.upsale.buttons.upgrade")},this.image={enterprise_edition:(0,e.h)("enterprise-add-on.svg")}}}u.\u0275fac=function(x){return new(x||u)(c.Y36(c.SBq),c.Y36(n.D),c.Y36(p.j))},u.\u0275cmp=c.Xpm({type:u,selectors:[["op-enterprise-page"]],inputs:{feature_more_info:"feature_more_info",feature_video:"feature_video",feature_image:"feature_image",feature_title:"feature_title",feature_description:"feature_description",more_info:"more_info",hide_breadcrumb:"hide_breadcrumb"},decls:17,vars:16,consts:[[1,"upsale-notification",3,"ngClass"],[3,"textContent"],[4,"ngIf"],["class","upsale--feature-reference",4,"ngIf"],[1,"upsale--feature-reference",3,"textContent"],["width","400","playsinline","","class","widget-box--teaser-video",3,"autoplay","loop","muted",4,"ngIf"],["class","widget-box--teaser-image",3,"src",4,"ngIf"],["class","widget-box--teaser-image_default",3,"src",4,"ngIf"],[3,"innerHTML"],["target","\u201d_blank\u201d",1,"button"],["target","_blank",1,"button","-highlight"],[1,"spot-icon","spot-icon_enterprise-addons","enterprise-addons--button-icon"],[1,"upsale--feature-reference"],["width","400","playsinline","",1,"widget-box--teaser-video",3,"autoplay","loop","muted"],["type","video/mp4",3,"src"],[1,"widget-box--teaser-image",3,"src"],[1,"widget-box--teaser-image_default",3,"src"]],template:function(x,b){1&x&&(c.TgZ(0,"div",0),c._UZ(1,"h2",1),c.YNc(2,r,2,1,"p",2),c.YNc(3,d,6,3,"p",3),c._UZ(4,"p",4),c.YNc(5,f,2,4,"video",5),c.YNc(6,a,1,1,"img",6),c.YNc(7,m,1,1,"img",7),c._UZ(8,"p",8),c.TgZ(9,"p"),c._uU(10),c.qZA(),c.TgZ(11,"a",9),c._uU(12),c.qZA(),c.TgZ(13,"a",10),c._UZ(14,"span",11),c._uU(15),c.qZA(),c._UZ(16,"free-trial-button"),c.qZA()),2&x&&(c.Q6J("ngClass",c.VKq(14,v,b.hide_breadcrumb)),c.xp6(1),c.Q6J("textContent",b.feature_title),c.xp6(1),c.Q6J("ngIf",b.feature_description),c.xp6(1),c.Q6J("ngIf",!b.feature_description),c.xp6(1),c.Q6J("textContent",b.more_info),c.xp6(1),c.Q6J("ngIf",b.feature_video),c.xp6(1),c.Q6J("ngIf",b.feature_image),c.xp6(1),c.Q6J("ngIf",!b.feature_image&&!b.feature_video),c.xp6(1),c.Q6J("innerHTML",b.text.enterprise_info_html(b.feature_title),c.oJD),c.xp6(2),c.Oqu(b.text.upgrade_info),c.xp6(1),c.uIk("href",b.text.contact_link,c.LSH),c.xp6(1),c.hij(" ",b.text.button_contact_us," "),c.xp6(1),c.uIk("href",b.text.upgrade_link,c.LSH),c.xp6(2),c.hij(" ",b.text.upgrade," "))},directives:[i.mk,i.O5,l.o],encapsulation:2,changeDetection:0})},94232:(te,M,t)=>{"use strict";t.d(M,{W:()=>d});class n{constructor(){this.changes={}}contains(a){return this.changes.hasOwnProperty(a)}get changed(){return _.keys(this.changes)}get all(){return this.changes}reset(...a){a.forEach(m=>{delete this.changes[m]})}clear(){this.changes={}}set(a,m,v){this.changes[a]={from:v,to:m}}getItem(a){return this.changes[a]}getValue(a){var m;return null===(m=this.getItem(a))||void 0===m?void 0:m.to}getPristine(a){var m;return null===(m=this.changes[a])||void 0===m?void 0:m.from}}var e=t(14808),p=t(3352),h=t(53466),c=t(44022),i=t(81531),l=t(84699);class d{constructor(a,m,v=null){this.state=m,this.changeset=new n,this.form$=(0,e.qH)(),this.cache={},this.inFlight=!1,this.updatePristineResource(a),this.schemaCache=a.injector.get(c.y),v&&this.form$.putValue(v)}push(){this.state&&this.state.putValue(this)}buildRequestPayload(){return this.getForm().then(()=>this.buildPayloadFromChanges())}updatePristineResource(a){if(a.__is_changeset_proxy)throw new Error("You're trying to pass proxy object as a pristine resource. This will cause errors");this._pristineResource=a,this.projectedResource=new Proxy(this._pristineResource,{get:(m,v)=>this.proxyGet(v),set:(m,v,C)=>(this.setValue(v,C),!0)})}get pristineResource(){return this._pristineResource}getForm(a=!1){return!this.form$.isPristine()&&!a||this.form$.hasActivePromiseRequest()?this.form$.values$().pipe((0,h.q)(1)).toPromise():this.updateForm()}updateForm(){const a=this.buildPayloadFromChanges(),m=this.pristineResource.$links.update(a).then(v=>(this.cache={},this.form$.putValue(v),this.setNewDefaults(v),this.push(),v));return this.form$.putFromPromiseIfPristine(()=>m),m}isEmpty(){return 0===this.changeset.changed.length}get id(){return this.pristineResource.id.toString()}get href(){return this.pristineResource.href}get changes(){const a={};return _.each(this.changeset.all,(m,v)=>{a[v]=m.to}),a}get changeMap(){return Object.assign({},this.changeset.all)}get changedAttributes(){return this.changeset.changed}isWritable(a){const m=this.schema.ofProperty(a);return!(!m||!m.writable)}humanName(a){return _.get(this.schema,`${a}.name`,a)}contains(a){return this.changeset.contains(a)}proxyGet(a){return"__is_proxy"===a||this.value(a)}value(a){return this.changeset.contains(a)?this.changeset.getValue(a):this.pristineResource[a]}valueExists(a){return this.changeset.contains(a)||this.pristineResource.hasOwnProperty(a)}setValue(a,m){this.changeset.set(a,m,this.pristineResource[a])}clearValue(...a){this.changeset.reset(...a)}clear(){this.state&&this.state.clear(),this.changeset.clear(),this.cache={},this.form$.clear()}reset(a){this.changeset.reset(a)}isOverridden(a){return this.changes.hasOwnProperty(a)}get schema(){return this.form$.hasValue()?i.V.create(this.form$.value.schema,this.projectedResource):this.schemaCache.of(this.pristineResource)}cacheValue(a,m){return this.cache[a]?this.cache[a]:this.cache[a]=m()}get minimalPayload(){return{lockVersion:this.pristineResource.lockVersion,_links:{}}}applyChanges(a){let m=this.pristineResource.$source;return this.form$.value&&(m=this.form$.value.payload.$source),_.each(this.changeset.all,(v,C)=>{if(!this.schema.isAttributeEditable(C))return void(0,p.qu)(`Trying to write ${C} but is not writable in schema`);const u=this.schema.ofProperty(C);u&&m._links[C]?a._links[C]=this.getLinkedValue(v.to,u):a[C]=v.to}),a}buildPayloadFromChanges(){let a;return(0,l.Z)(this.pristineResource)?(a=this.form$.value?_.cloneDeep(this.form$.value.payload.$source):_.cloneDeep(this.pristineResource.$source),this.pristineResource.attachments&&(a._links.attachments=this.pristineResource.attachments.elements.map(m=>({href:m.href})))):a=this.minimalPayload,this.applyChanges(a)}getLinkedValue(a,m){if(_.isNil(a))return{href:null};const v=(m.type||"").startsWith("[]");let C=!1;if((a.forEach||a.elements)&&(C=!0),C&&v){const u=[];return a&&(a.forEach&&a||a.elements).forEach(x=>{x.href&&u.push({href:x.href})}),u}return{href:_.get(a,"href",null)}}setNewDefaults(a){_.each(a.payload,(m,v)=>{const C=this.schema.ofProperty(v);!(null==C?void 0:C.writable)||this.setNewDefaultFor(v,m)})}setNewDefaultFor(a,m){this.valueExists(a)||((0,p.qu)(`Taking over default value from form for ${a}`),this.setValue(a,m))}}},7812:(te,M,t)=>{"use strict";t.d(M,{uA:()=>E,OZ:()=>y,zZ:()=>P,c0:()=>u,n5:()=>x});var n=t(3786),e=t(96617),p=t(60874),h=t(55741),c=t(79644);class i extends c.L{render(O,I){const Z=this.value;O.setAttribute("title",I),O.textContent=I,O.innerHTML="",0===Z.length?this.renderEmpty(O):this.renderValues(Z,O)}renderValues(O,I){O.forEach(Z=>{const j=document.createElement("div");j.classList.add(h.x,"-multiple-lines"),j.setAttribute("title",Z),j.textContent=Z,I.appendChild(j)})}}var l=t(39469);class r extends l.N{render(O,I){const Z=this.percentLabel;O.setAttribute("title",Z),O.innerHTML="",O.textContent=Z}}var d=t(29161),f=t(32782);class a extends c.L{render(O,I){const Z=this.attribute;O.setAttribute("title",I),O.textContent=I,O.innerHTML="",0===Z.length?this.renderEmpty(O):this.renderValues(Z,O)}renderValues(O,I){this.principalRenderer.renderMultiple(I,O,{hide:!1,link:!1},{hide:!1,size:"medium"},!0)}}(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",f.C)],a.prototype,"principalRenderer",void 0);var m=t(44022),v=t(12703),C=t(63733);const u="-editable",x="-read-only",y="inline-edit--display-field",P="inline-edit--container";class E{constructor(O,I,Z={}){this.injector=O,this.container=I,this.options=Z,this.fieldCache={}}render(O,I,Z){const[j,B]=this.renderFieldValue(O,I,Z);return null===j||this.setSpanAttributes(B,j,I,O,Z),B}renderFieldValue(O,I,Z){const j=document.createElement("span"),B=this.schema(O,Z),J=this.attributeName(I,B),R=B.ofProperty(J);if(!R)return[null,j];const F=this.getField(O,R,J,Z);F.render(j,this.getText(F),R.options);const{title:Y}=F;return Y&&j.setAttribute("title",Y),j.setAttribute("aria-label",this.getAriaLabel(F,B)),[F,j]}getField(O,I,Z,j){let B=this.fieldCache[Z];return B||(B=this.fieldCache[Z]=this.getFieldForCurrentContext(O,Z,I)),B.apply(O,I),B.activeChange=j,B}getFieldForCurrentContext(O,I,Z){const j={container:this.container,injector:this.injector,options:this.options},B=["[]CustomOption"].indexOf(Z.type)>=0;if("single-view"===this.container&&B)return new i(I,j);const J=["[]User"].indexOf(Z.type)>=0;return"single-view"===this.container&&J?new a(I,j):"timeline"===this.container&&"percentageDone"===I?new r(I,j):"table"===this.container&&["startDate","dueDate","date"].includes(I)?new C.C(I,j):this.displayFieldService.getField(O,I,Z,j)}getText(O){return O.isEmpty()?O.placeholder:O.valueString}setSpanAttributes(O,I,Z,j,B){O.classList.add(y,Z),O.dataset.fieldName=Z,O.setAttribute("tabindex","id"===Z?"-1":"0"),I.required&&O.classList.add("-required"),I.isEmpty()&&O.classList.add("-placeholder");const J=this.schema(j,B);this.isAttributeEditable(J,Z)?(O.classList.add(u),O.setAttribute("role","button")):O.classList.add(x)}isAttributeEditable(O,I){return["startDate","dueDate","date"].includes(I)&&(I="combinedDate"),O.isAttributeEditable(I)}getAriaLabel(O,I){let Z;const j=this.getLabelContent(O);if(O.isFormattable&&!O.isEmpty())try{Z=_.escape(jQuery(`<div>${j}</div>`).text())}catch(B){console.error("Failed to parse formattable labelContent"),Z=`Label for ${O.displayName}`}else Z=j;return O.writable&&I.isAttributeEditable(O.name)?this.I18n.t("js.inplace.button_edit",{attribute:`${O.displayName} ${Z}`}):`${O.displayName} ${Z}`}getLabelContent(O){return O.isEmpty()?this.I18n.t("js.inplace.null_value_label"):O.valueString}attributeName(O,I){return I.mappedName?I.mappedName(O):O}schema(O,I){return I?I.schema:this.halEditing.typedState(O).hasValue()?this.halEditing.typedState(O).value.schema:this.schemaCache.of(O)}}(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",p.i)],E.prototype,"displayFieldService",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",m.y)],E.prototype,"schemaCache",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",v.l)],E.prototype,"halEditing",void 0),(0,n.gn)([(0,d.W)(),(0,n.w6)("design:type",e.D)],E.prototype,"I18n",void 0)},55741:(te,M,t)=>{"use strict";t.d(M,{x:()=>c,C:()=>i});var n=t(3786),e=t(82635),p=t(96617),h=t(29161);const c="custom-option";class i extends e.g{constructor(r,d){super(),this.name=r,this.context=d,this.mode=null,this.activeChange=null,this.texts={empty:this.I18n.t("js.label_no_value"),placeholder:this.I18n.t("js.placeholders.default")}}apply(r,d){this.resource=r,this.schema=d}get isFormattable(){return!1}get injector(){return this.context.injector}get value(){return this.schema?this.activeChange?this.activeChange.projectedResource[this.name]:this.attribute:null}get attribute(){return this.resource[this.name]}get type(){return this.constructor.type}get valueString(){return this.value}get placeholder(){return"-"}get label(){return this.schema.name||this.name}get title(){return this.isFormattable?null:this.valueString}render(r,d,f={}){r.textContent=d}renderEmpty(r){const d=document.createElement("div");d.setAttribute("title",this.texts.empty),d.textContent=this.texts.placeholder,d.classList.add(c,"-empty"),r.appendChild(d)}}(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",p.D)],i.prototype,"I18n",void 0)},60874:(te,M,t)=>{"use strict";t.d(M,{i:()=>p});var n=t(39478),e=t(2316);class p extends n.h{getField(c,i,l,r){const f=new(this.getSpecificClassFor(c._type,i,l.type))(i,r);return f.apply(c,l),f}}p.\u0275fac=function(){let h;return function(i){return(h||(h=e.n5z(p)))(i||p)}}(),p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})},74215:(te,M,t)=>{"use strict";t.d(M,{Z:()=>e});var n=t(63733);class e extends n.C{constructor(){super(...arguments),this.text={placeholder:{startDate:this.I18n.t("js.label_no_start_date"),dueDate:this.I18n.t("js.label_no_due_date")}}}render(h,c){h.innerHTML="";const i=this.createDateDisplayField("startDate"),l=this.createDateDisplayField("dueDate"),r=document.createElement("span");r.textContent=" - ",h.appendChild(i),h.appendChild(r),h.appendChild(l)}createDateDisplayField(h){const c=document.createElement("span"),i=new n.C(h,this.context),l=this.resource[h]?this.timezoneService.formattedDate(this.resource[h]):this.text.placeholder[h];return i.apply(this.resource,this.schema),i.render(c,l),c}}},63733:(te,M,t)=>{"use strict";t.d(M,{C:()=>l});var n=t(3786),e=t(50076),p=t(69671),h=t(29161),c=t(33276),i=t(70692);class l extends p.z{render(d,f){if(super.render(d,f),this.showSchedulingMode()){const a=document.createElement("span");a.classList.add("icon-context"),this.resource.scheduleManually&&a.classList.add("icon-pin"),d.prepend(a)}if(this.shouldHighlight&&this.canOverdue){const a=this.timezoneService.daysFromToday(this.value);this.apiV3Service.statuses.id(this.resource.status.id).get().toPromise().then(m=>{m.isClosed||d.classList.add(e.Z.overdueDate(a))})}}get canOverdue(){return-1!==["dueDate","date"].indexOf(this.name)}get valueString(){return this.value?this.timezoneService.formattedDate(this.value):""}showSchedulingMode(){return"startDate"===this.name||"date"===this.name}}(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",i.B)],l.prototype,"timezoneService",void 0),(0,n.gn)([(0,h.W)(),(0,n.w6)("design:type",c.T)],l.prototype,"apiV3Service",void 0)},69671:(te,M,t)=>{"use strict";t.d(M,{z:()=>c});var n=t(3786),e=t(55741),p=t(84897),h=t(29161);class c extends e.C{get highlightName(){return"date"===this.name?"dueDate":this.name}get shouldHighlight(){if(!1===this.context.options.colorize)return!1;const l=!!this.viewHighlighting&&this.viewHighlighting.shouldHighlightInline(this.highlightName);return"table"!==this.context.container||l}}(0,n.gn)([(0,h.W)(p.B,null),(0,n.w6)("design:type",p.B)],c.prototype,"viewHighlighting",void 0)},39469:(te,M,t)=>{"use strict";t.d(M,{N:()=>e});var n=t(55741);class e extends n.C{get value(){return this.schema?this.resource[this.name]||0:null}get percentLabel(){return`${this.roundedProgress}%`}get roundedProgress(){return Math.round(Number(this.value))||0}render(h,c){h.setAttribute("title",c),h.innerHTML=`\n      <span>\n        <span style="width: 80px" class="progress-bar">\n          <span style="width: ${this.roundedProgress}%" class="inner-progress closed"></span>\n          <span style="width: 0%" class="inner-progress done"></span>\n        </span>\n        <span class="progress-bar-legend">${this.percentLabel}</span>\n      </span>\n    `}}},79644:(te,M,t)=>{"use strict";t.d(M,{L:()=>e});var n=t(55741);class e extends n.C{isEmpty(){return _.isEmpty(this.value)}get value(){const h=this.resource[this.name];return this.schema&&h?h.elements?h.elements.map(c=>c.name):h.map?h.map(c=>c.name):h.name?[h.name]:[`error: ${JSON.stringify(h)}`]:[]}render(h,c){const i=this.value;h.innerHTML="",h.setAttribute("title",i.join(", ")),0===i.length?this.renderEmpty(h):this.renderValues(i,h)}renderValues(h,c){const i=document.createDocumentFragment(),l=this.optionDiv(this.valueAbridged(h));if(i.appendChild(l),h.length>2){const r=this.optionDiv(h.length.toString(),"badge","-secondary");i.appendChild(r)}c.appendChild(i)}optionDiv(h,...c){const i=document.createElement("div"),l=document.createElement("span");return i.classList.add(n.x),l.classList.add(...c),l.textContent=h,i.appendChild(l),i}valueAbridged(h){const c=_.take(h,2);return h.length>2&&c.push("... "),c.join(", ")}}},18322:(te,M,t)=>{"use strict";t.d(M,{Dz:()=>i,uS:()=>l,Nm:()=>r,sS:()=>a,su:()=>m});var n=t(2316),p=(t(86029),t(96617)),h=t(82635);t(94232);const i=new n.OlP("editing-portal--schema"),l=new n.OlP("editing-portal--handler"),r=new n.OlP("editing-portal--changeset"),a="-editing";class m extends h.g{constructor(C,u,k,x,b,y,P){super(),this.I18n=C,this.elementRef=u,this.change=k,this.schema=x,this.handler=b,this.cdRef=y,this.injector=P,this.self=this,this.updateFromChangeset(k)}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.initialize(),this.change.state&&this.change.state.values$().pipe(this.untilDestroyed()).subscribe(C=>{if(!C.schema.ofProperty(this.name))return this.handler.deactivate(!1);this.updateFromChangeset(C),this.initialize(),this.cdRef.markForCheck()})}get overflowingSelector(){return this.$element?this.$element.closest(".__overflowing_element_container").data("overflowingIdentifier"):null}get inFlight(){return this.handler.inFlight}get value(){return this.resource[this.name]}set value(C){this.resource[this.name]=this.parseValue(C)}get placeholder(){return"subject"===this.name?this.I18n.t("js.placeholders.subject"):""}initialize(){}updateFromChangeset(C){this.change=C,this.resource=this.change.projectedResource,this.schema=this.change.schema.ofProperty(this.handler.fieldName)||this.schema,this.name=this.change.schema.mappedName(this.handler.fieldName)}parseValue(C){return C}}m.\u0275fac=function(C){return new(C||m)(n.Y36(p.D),n.Y36(n.SBq),n.Y36(r),n.Y36(i),n.Y36(l),n.Y36(n.sBO),n.Y36(n.zs3))},m.\u0275dir=n.lG2({type:m,features:[n.qOj]})},84568:(te,M,t)=>{"use strict";t.d(M,{h:()=>p});var n=t(39478),e=t(2316);class p extends n.h{}p.\u0275fac=function(){let h;return function(i){return(h||(h=e.n5z(p)))(i||p)}}(),p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})},58034:(te,M,t)=>{"use strict";t.d(M,{a:()=>e});var n=t(2316);class e{blockedTransition(h){return!0}}e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac})},61342:(te,M,t)=>{"use strict";t.d(M,{n:()=>k});var n=t(3786),e=t(2316),p=t(47775),h=t(12877),c=t(14808),i=t(9170),l=t(53466),r=t(33927),d=t(96617),f=t(91260),m=(t(80044),t(37048)),v=t(58034);class C{constructor(b){this.i18nService=b,this.activeForms=new Map,window.addEventListener("beforeunload",y=>{this.thereAreFormsWithUnsavedChanges&&(y.preventDefault(),y.returnValue=this.i18nService.t("js.work_packages.confirm_edit_cancel"))})}get thereAreFormsWithUnsavedChanges(){return Array.from(this.activeForms.keys()).some(b=>!b.change.isEmpty())}addToActiveForms(b){this.activeForms.set(b,!0)}removeFromActiveForms(b){this.activeForms.delete(b)}}C.\u0275fac=function(b){return new(b||C)(e.LFG(d.D))},C.\u0275prov=e.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"});class k extends f.Py{constructor(b,y,P,E,T,O,I,Z,j){super(b),this.injector=b,this.elementRef=y,this.$transitions=P,this.ConfigurationService=E,this.editingPortalService=T,this.$state=O,this.I18n=I,this.editFormRouting=Z,this.globalEditFormChangesTrackerService=j,this.initializeEditMode=!1,this.skippedFields=[],this.onSavedEmitter=new e.vpe,this.fields={},this.registeredFields=(0,c.qH)();const B=I.t("js.work_packages.confirm_edit_cancel"),J=E.warnOnLeavingUnsaved();this.unregisterListener=P.onBefore({},R=>{if(this.editing){if(!this.editFormRouting||this.editFormRouting.blockedTransition(R)){if(J&&!window.confirm(B))return!1;this.cancel(!1)}return!0}})}ngOnInit(){this.editMode=this.initializeEditMode,this.globalEditFormChangesTrackerService.addToActiveForms(this),this.initializeEditMode&&this.start()}ngOnDestroy(){this.unregisterListener(),this.globalEditFormChangesTrackerService.removeFromActiveForms(this)}activateField(b,y,P,E){return(0,n.mG)(this,void 0,void 0,function*(){return this.waitForField(P).then(T=>{T.setActive(!0);const O=T.editContainer.nativeElement;return this.editingPortalService.create(O,this.injector,b,y,P,E)})})}reset(b,y=!1){return(0,n.mG)(this,void 0,void 0,function*(){const P=yield this.waitForField(b);P.reset(),P.deactivate(y)})}onSaved(b){this.cancel(!1),this.onSavedEmitter.emit({savedResource:b.resource,isInitial:b.wasNew})}cancel(b=!1){this.editMode=!1,this.closeEditFields("all",b),b&&this.halEditing.reset(this.change)}requireVisible(b){return new Promise((y,P)=>{const E=setInterval(()=>{void 0!==this.fields[b]&&(clearInterval(E),y())},50)})}get editing(){return this.editMode||this.hasActiveFields()}register(b){this.fields[b.fieldName]=b,this.registeredFields.putValue(_.keys(this.fields)),(this.editMode&&!this.skipField(b)||this.activeFields[b.fieldName])&&b.activateOnForm(!0)}waitForField(b){return this.registeredFields.values$().pipe((0,i.h)(y=>y.indexOf(b)>=0),(0,l.q)(1),(0,r.U)(()=>this.fields[b])).toPromise()}start(){_.each(this.fields,b=>this.activate(b.fieldName))}focusOnFirstError(){jQuery(this.elementRef.nativeElement).find(`.${f.fA}.-error .${f.as}`).first().trigger("focus")}skipField(b){const{fieldName:y}=b;if(-1===this.skippedFields.indexOf(y))return!1;const E=this.resource[y],T=this.change.changes[y];return E&&!T}}k.\u0275fac=function(b){return new(b||k)(e.Y36(e.zs3),e.Y36(e.SBq),e.Y36(p.TransitionService),e.Y36(h.e),e.Y36(m.b),e.Y36(p.StateService),e.Y36(d.D),e.Y36(v.a,8),e.Y36(C))},k.\u0275cmp=e.Xpm({type:k,selectors:[["edit-form"],["","edit-form",""]],inputs:{resource:"resource",initializeEditMode:["inEditMode","initializeEditMode"],skippedFields:"skippedFields"},outputs:{onSavedEmitter:"onSaved"},features:[e.qOj],ngContentSelectors:["*"],decls:1,vars:0,template:function(b,y){1&b&&(e.F$t(),e.Hsn(0))},encapsulation:2})},91260:(te,M,t)=>{"use strict";t.d(M,{fA:()=>d,as:()=>f,Py:()=>a});var n=t(3786),e=t(87853),p=t(12703),h=t(1403),c=t(29161),i=t(67727),l=t(84699),r=t(8849);const d="inline-edit--active-field",f="inline-edit--field";class a{constructor(v){this.injector=v,this.activeFields={},this.errorsPerAttribute={},this.editMode=!1}onSaved(v){}hasActiveFields(){return!_.isEmpty(this.activeFields)}get change(){return this.halEditing.changeFor(this.resource)}activate(v,C=!1){return this.loadFieldSchema(v,C).then(u=>u.writable||C?this.renderField(v,u):(this.halNotification.showEditingBlockedError(u.name||v),Promise.reject()))}activateWhenNeeded(v){return this.activeFields[v]?Promise.resolve():this.requireVisible(v).then(()=>this.activate(v,!0))}activateMissingFields(){this.change.getForm().then(v=>{_.each(v.validationErrors,(C,u)=>{"id"!==u&&this.activateWhenNeeded(u)})})}submit(){return(0,n.mG)(this,void 0,void 0,function*(){if(this.change.isEmpty()&&!(0,l.Z)(this.resource))return this.closeEditFields(),Promise.resolve(this.resource);this.change.inFlight=!0,this.errorsPerAttribute={};const v=_.keys(this.activeFields);return yield Promise.all(_.map(this.activeFields,C=>C.onSubmit())),new Promise((C,u)=>{this.halEditing.save(this.change).then(k=>{this.closeEditFields(v),C(k.resource),this.halNotification.showSave(k.resource,k.wasNew),this.editMode=!1,this.onSaved(k),this.change.inFlight=!1}).catch(k=>(this.halNotification.handleRawError(k,this.resource),k instanceof r.o&&k.resource&&(this.handleSubmissionErrors(k.resource),u()),this.change.inFlight=!1,Promise.reject(k)))})})}closeEditFields(v="all",C=!0){"all"===v&&(v=_.keys(this.activeFields)),v.forEach(u=>{const k=this.activeFields[u];k&&k.deactivate(!1),C&&this.change.reset(u)})}handleSubmissionErrors(v){this.handleErroneousAttributes(v)}handleErroneousAttributes(v){const C=v.getInvolvedAttributes();this.errorsPerAttribute=v.getMessagesPerAttribute(),0!==C.length&&this.setErrorsForFields(C)}setErrorsForFields(v){const C=v.map(u=>this.requireVisible(u).then(()=>(this.activeFields[u]&&this.activeFields[u].setErrors(this.errorsPerAttribute[u]||[]),this.activateWhenNeeded(u))));Promise.all(C).then(()=>{setTimeout(()=>this.focusOnFirstError())}).catch(()=>{console.error("Failed to activate all erroneous fields.")})}loadFieldSchema(v,C=!1){return new Promise((u,k)=>{this.loadFormAndCheck(v,C);const x=this.change.schema.ofProperty(v);if(!x)throw new Error;u(x)})}loadFormAndCheck(v,C=!1){this.change.getForm().then(()=>{const u=this.change.schema.ofProperty(v);!u.writable&&!C&&(this.halNotification.showEditingBlockedError(u.name||v),this.closeEditFields([v]))}).catch(u=>{console.error("Failed to build edit field: %o",u),this.halNotification.handleRawError(u,this.resource),this.closeEditFields([v])})}renderField(v,C){return this.activateField(this,C,v,this.errorsPerAttribute[v]||[]).then(k=>(this.activeFields[v]=k,k)).catch(k=>{console.error(`Failed to render edit field:${k}`),this.halNotification.handleRawError(k)})}}(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",e.G)],a.prototype,"states",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",p.l)],a.prototype,"halEditing",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",i.W)],a.prototype,"halNotification",void 0),(0,n.gn)([(0,c.W)(),(0,n.w6)("design:type",h.J)],a.prototype,"halEvents",void 0)},86029:(te,M,t)=>{"use strict";t.d(M,{k:()=>p});var n=t(79441),e=t(26942);class p extends e.N{constructor(){super(...arguments),this.onDestroy=new n.xQ,this._onSubmitHandlers=[],this._onBeforeSubmitHandlers=[]}errorMessageOnLabel(){}onSubmit(){return Promise.all(this._onSubmitHandlers.map(c=>c()))}registerOnSubmit(c){this._onSubmitHandlers.push(c)}onBeforeSubmit(){return this._onBeforeSubmitHandlers.map(c=>c())}registerOnBeforeSubmit(c){this._onBeforeSubmitHandlers.push(c)}previewContext(c){}}},92058:(te,M,t)=>{"use strict";t.d(M,{m:()=>v});var n=t(2316),p=(t(86029),t(18322)),h=t(50945),c=t(84568),l=(t(94232),t(54364)),r=t(1707),d=t(32853);function f(C,u){1&C&&n.GkF(0)}const a=function(C){return{"-error":C}};function m(C,u){if(1&C){const k=n.EpF();n.TgZ(0,"div",1),n.TgZ(1,"form",2),n.NdJ("submit",function(){return n.CHM(k),n.oxw().handler.handleUserSubmit()}),n.TgZ(2,"label",3),n._uU(3),n.qZA(),n.YNc(4,f,1,0,"ng-container",4),n.qZA(),n.qZA()}if(2&C){const k=n.oxw();n.Gre("inline-edit--active-field inplace-edit ",k.handler.fieldName,""),n.Q6J("ngClass",n.VKq(9,a,k.handler.isErrorenous)),n.xp6(2),n.Q6J("for",k.handler.htmlId),n.xp6(1),n.AsE(" ",k.handler.fieldLabel," ",k.handler.errorMessageOnLabel()," "),n.xp6(1),n.Q6J("ngComponentOutlet",k.componentClass)("ngComponentOutletInjector",k.fieldInjector)}}class v{constructor(u,k,x){this.injector=u,this.editField=k,this.elementRef=x,this.onEditFieldReady=new n.vpe}ngOnInit(){this.editFieldHandler&&this.schemaInput?(this.handler=this.editFieldHandler,this.schema=this.schemaInput,this.change=this.changeInput):(this.handler=this.injector.get(p.uS),this.schema=this.injector.get(p.Dz),this.change=this.injector.get(p.Nm)),this.componentClass=this.editField.getSpecificClassFor(this.change.pristineResource._type,this.handler.fieldName,this.schema.type),this.fieldInjector=(0,h.E)(this.injector,this.change,this.handler,this.schema)}ngOnDestroy(){this.onEditFieldReady.complete()}ngAfterViewInit(){setTimeout(()=>{this.onEditFieldReady.emit()})}}v.\u0275fac=function(u){return new(u||v)(n.Y36(n.zs3),n.Y36(c.h),n.Y36(n.SBq))},v.\u0275cmp=n.Xpm({type:v,selectors:[["edit-form-portal"]],inputs:{schemaInput:"schemaInput",changeInput:"changeInput",editFieldHandler:"editFieldHandler"},outputs:{onEditFieldReady:"onEditFieldReady"},decls:1,vars:1,consts:[[3,"class","ngClass",4,"ngIf"],[3,"ngClass"],["role","form","tabindex","-1",3,"submit"],[1,"hidden-for-sighted",3,"for"],[4,"ngComponentOutlet","ngComponentOutletInjector"]],template:function(u,k){1&u&&n.YNc(0,m,5,11,"div",0),2&u&&n.Q6J("ngIf",k.handler)},directives:[l.O5,l.mk,r._Y,r.JL,r.F,l.$G,d.dw],encapsulation:2})},50945:(te,M,t)=>{"use strict";t.d(M,{E:()=>p});var n=t(18322),e=t(40912);function p(h,c,i,l){const r=new WeakMap;return r.set(n.Nm,c),r.set(n.uS,i),r.set(n.Dz,l),new e.nK(h,r)}},37048:(te,M,t)=>{"use strict";t.d(M,{b:()=>b});var n=t(40912),e=t(92058),p=t(50945),h=t(53466),c=t(70233),i=t(3786),l=t(33406),r=t(96617),d=t(12877),f=t(7101),a=t(86029),m=t(88837),v=t(3352),C=t(79441),u=t(29161);class k extends a.k{constructor(P,E,T,O,I,Z,j){super(),this.injector=P,this.form=E,this.fieldName=T,this.schema=O,this.element=I,this.pathHelper=Z,this.withErrors=j,this.$onUserActivate=new C.xQ,void 0!==j&&this.setErrors(j),this.htmlId=`wp-${this.resource.id}-inline-edit--field-${this.fieldName}`,this.fieldLabel=this.schema.name||this.fieldName}stopPropagation(P){return P.stopPropagation(),!1}get inEditMode(){return this.form.editMode}get inFlight(){return this.form.change.inFlight}focus(P){const E=this.element.querySelector(".inline-edit--field");E?(E.focus(),P&&"INPUT"===E.tagName&&(0,m.w)(E,P)):(0,v.qu)(`Tried to focus on ${this.fieldName}, but element does not (yet) exist.`)}onFocusOut(){return(0,i.mG)(this,void 0,void 0,function*(){this.resource.subject&&this.withErrors&&0===this.withErrors.length&&(yield this.handleUserSubmit())})}setErrors(P){this.errors=P,this.element.classList.toggle("-error",this.isErrorenous)}handleUserSubmit(){return this.onBeforeSubmit(),this.inFlight||this.form.editMode?Promise.resolve():this.onSubmit().then(()=>{this.form.submit(),this.blurActiveField()})}handleUserKeydown(P,E=!1){return(0,i.mG)(this,void 0,void 0,function*(){return this.inEditMode&&!E?P.which!==l.m.ENTER||(yield this.form.submit(),!1):P.which!==l.m.ESCAPE||(this.handleUserCancel(),!1)})}handleUserCancel(){this.reset()}reset(){this.form.change.reset(this.fieldName),this.deactivate(!0)}deactivate(P=!1){this.blurActiveField(),delete this.form.activeFields[this.fieldName],this.onDestroy.next(),this.onDestroy.complete(),this.form.reset(this.fieldName,P)}blurActiveField(){document.activeElement instanceof HTMLElement&&document.activeElement.blur()}get isErrorenous(){return this.errors.length>0}isChanged(){return this.form.change.contains(this.fieldName)}get resource(){return this.form.resource}get project(){return this.form.change.projectedResource.project}errorMessageOnLabel(){return this.isErrorenous?this.I18n.t("js.inplace.errors.messages_on_field",{messages:this.errors.join(" ")}):""}previewContext(P){return P.previewPath()}}(0,i.gn)([(0,u.W)(),(0,i.w6)("design:type",f.i)],k.prototype,"FocusHelper",void 0),(0,i.gn)([(0,u.W)(),(0,i.w6)("design:type",d.e)],k.prototype,"ConfigurationService",void 0),(0,i.gn)([(0,u.W)(),(0,i.w6)("design:type",r.D)],k.prototype,"I18n",void 0);var x=t(2316);class b{constructor(P,E,T){this.appRef=P,this.componentFactoryResolver=E,this.pathHelper=T}create(P,E,T,O,I,Z){const j=this.createDomOutlet(P,E),B=new k(E,T,I,O,P,this.pathHelper,Z);B.onDestroy.pipe((0,h.q)(1)).subscribe(()=>j.detach());const J=(0,p.E)(E,T.change,B,O),R=new n.C5(e.m,null,J);return P.innerHTML="",j.attachComponentPortal(R).instance.onEditFieldReady.pipe((0,h.q)(1)).toPromise().then(()=>B)}createDomOutlet(P,E){return new n.u0(P,this.componentFactoryResolver,this.appRef,E)}}b.\u0275fac=function(P){return new(P||b)(x.LFG(x.z2F),x.LFG(x._Vd),x.LFG(c.j))},b.\u0275prov=x.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"})},82140:(te,M,t)=>{"use strict";t.d(M,{e:()=>h});var n=t(2316),p=(t(18322),t(2775));class h{constructor(){this.onSave=new n.vpe,this.onCancel=new n.vpe}save(){this.onSave.emit()}cancel(){this.onCancel.emit()}}h.\u0275fac=function(i){return new(i||h)},h.\u0275cmp=n.Xpm({type:h,selectors:[["edit-field-controls"]],inputs:{cancelTitle:"cancelTitle",saveTitle:"saveTitle",field:["fieldController","field"]},outputs:{onSave:"onSave",onCancel:"onCancel"},decls:6,vars:5,consts:[[1,"inplace-edit--dashboard"],[1,"inplace-edit--controls"],["type","button",1,"inplace-edit--control","inplace-edit--control--save",3,"disabled","title","click"],["icon-classes","icon-checkmark icon-no-color",3,"icon-title"],["type","button",1,"inplace-edit--control","inplace-edit--control--cancel",3,"title","click"],["icon-classes","icon-close icon-no-color",3,"icon-title"]],template:function(i,l){1&i&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.TgZ(2,"button",2),n.NdJ("click",function(){return l.save()}),n._UZ(3,"op-icon",3),n.qZA(),n.TgZ(4,"button",4),n.NdJ("click",function(){return l.cancel()}),n._UZ(5,"op-icon",5),n.qZA(),n.qZA(),n.qZA()),2&i&&(n.xp6(2),n.Q6J("disabled",l.field.required&&l.field.isEmpty()||void 0)("title",l.saveTitle),n.xp6(1),n.Q6J("icon-title",l.saveTitle),n.xp6(1),n.Q6J("title",l.cancelTitle),n.xp6(1),n.Q6J("icon-title",l.cancelTitle))},directives:[p.o],encapsulation:2})},45755:(te,M,t)=>{"use strict";t.d(M,{i:()=>h});var n=t(54364),e=t(21757),p=t(2316);class h{}h.\u0275fac=function(i){return new(i||h)},h.\u0275mod=p.oAB({type:h}),h.\u0275inj=p.cJS({imports:[[n.ez,e.H]]})},76315:(te,M,t)=>{"use strict";t.d(M,{s:()=>c});var n=t(54364),e=t(97779),p=t(45755),h=t(2316);class c{}c.\u0275fac=function(l){return new(l||c)},c.\u0275mod=h.oAB({type:c}),c.\u0275inj=h.cJS({imports:[[n.ez,e.$,p.i]]})},54262:(te,M,t)=>{"use strict";t.d(M,{k:()=>b});var n=t(12703),e=t(20342),p=t(96617),h=t(88837),c=t(61342),l=(t(80044),t(26942)),r=t(44022),d=t(7812),f=t(87853),a=t(3352);var v=t(2316),C=t(54364);const u=["displayContainer"],k=["editContainer"],x=function(y,P,E,T){return[y,P,E,T]};class b extends l.N{constructor(P,E,T,O,I,Z,j,B,J){super(),this.states=P,this.injector=E,this.elementRef=T,this.opContextMenu=O,this.halEditing=I,this.schemaCache=Z,this.editForm=j,this.cdRef=B,this.I18n=J,this.displayFieldOptions={},this.isDropTarget=!1,this.editFieldContainerClass=d.zZ,this.active=!1,this.destroyed=!1}setActive(P=!0){this.active=P,this.componentDestroyed||this.cdRef.detectChanges()}ngOnInit(){var P;this.fieldRenderer=new d.uA(this.injector,"single-view",this.displayFieldOptions),this.$element=jQuery(this.elementRef.nativeElement),null===(P=this.editForm)||void 0===P||P.register(this),this.halEditing.temporaryEditResource(this.resource).values$().pipe(this.untilDestroyed()).subscribe(E=>{this.resource=E,this.render()})}startDragOverActivation(P){return!(this.isDropTarget&&this.isEditable&&!this.active)||(this.handleUserActivate(null),P.preventDefault(),!1)}render(){const P=this.fieldRenderer.render(this.resource,this.fieldName,null);this.displayContainer.nativeElement.innerHTML="",this.displayContainer.nativeElement.appendChild(P)}deactivate(P=!1){this.editContainer.nativeElement.innerHTML="",this.editContainer.nativeElement.hidden=!0,this.setActive(!1),P&&setTimeout(()=>this.$element.find(`.${d.OZ}`).focus(),20)}get isEditable(){return!(!this.editForm||!this.schema.isAttributeEditable(this.fieldName))}activateIfEditable(P){return function(y){try{const P=window.getSelection(),E=P.toString().length>0,T=y.contains(P.anchorNode);return E&&T}catch(P){return console.error("Failed to test whether in selection ",P),!1}}(P.target)?((0,a.qu)(`Not activating ${this.fieldName} because of active selection within`),!0):jQuery(P.target).closest("a,macro",this.displayContainer.nativeElement).length>0||(this.handleUserActivate(P),this.opContextMenu.close(),P.preventDefault(),P.stopImmediatePropagation(),!1)}activateOnForm(P=!1){return this.setActive(!0),this.editForm.activate(this.fieldName,P).catch(()=>this.deactivate(!0))}handleUserActivate(P){if(!this.isEditable)return!1;let E=0;return"click"===(null==P?void 0:P.type)&&(E=(0,h.b)(P)),this.activateOnForm().then(T=>{!T||(T.$onUserActivate.next(),T.focus(E))}),!1}reset(){this.render(),this.deactivate()}get schema(){return this.halEditing.typedState(this.resource).hasValue()?this.halEditing.typedState(this.resource).value.schema:this.schemaCache.of(this.resource)}}b.\u0275fac=function(P){return new(P||b)(v.Y36(f.G),v.Y36(v.zs3),v.Y36(v.SBq),v.Y36(e.$),v.Y36(n.l),v.Y36(r.y),v.Y36(c.n,8),v.Y36(v.sBO),v.Y36(p.D))},b.\u0275cmp=v.Xpm({type:b,selectors:[["op-editable-attribute-field"]],viewQuery:function(P,E){if(1&P&&(v.Gf(u,7),v.Gf(k,7)),2&P){let T;v.iGM(T=v.CRH())&&(E.displayContainer=T.first),v.iGM(T=v.CRH())&&(E.editContainer=T.first)}},inputs:{fieldName:"fieldName",resource:"resource",wrapperClasses:"wrapperClasses",displayFieldOptions:"displayFieldOptions",isDropTarget:"isDropTarget"},features:[v.qOj],decls:5,vars:8,consts:[[3,"ngClass","dragover"],[3,"hidden"],["editContainer",""],["tabindex","-1",3,"hidden","click","keydown.enter"],["displayContainer",""]],template:function(P,E){1&P&&(v.TgZ(0,"div",0),v.NdJ("dragover",function(O){return E.startDragOverActivation(O)}),v._UZ(1,"div",1,2),v.TgZ(3,"div",3,4),v.NdJ("click",function(O){return E.activateIfEditable(O)})("keydown.enter",function(O){return E.activateIfEditable(O)}),v.qZA(),v.qZA()),2&P&&(v.Q6J("ngClass",v.l5B(3,x,E.editFieldContainerClass,E.fieldName,E.active?"-active":"",E.wrapperClasses||"-small")),v.xp6(1),v.Q6J("hidden",!E.active),v.xp6(2),v.Q6J("hidden",E.active))},directives:[C.mk],encapsulation:2,changeDetection:0})},12703:(te,M,t)=>{"use strict";t.d(M,{l:()=>C});var n=t(3786),e=t(14808),p=t(9170),h=t(33927),c=t(79441),i=t(94232),l=t(53448),r=t(1403),d=t(79175),f=t(84699),a=t(2316);class m extends e.Ui{constructor(){super(),this.name="Changesets",this.changesets=(0,e.r9)(),this.initializeMembers()}}class v{constructor(k,x){this.wasNew=!1,this.id=x.id.toString(),this.wasNew=(0,f.Z)(k.pristineResource),this.resource=x,this.changes=k.changeMap}}class C extends d.r{constructor(k,x,b){super((new m).changesets),this.injector=k,this.halEvents=x,this.hook=b,this.committedChanges=new c.xQ}save(k){return(0,n.mG)(this,void 0,void 0,function*(){const x=yield k.buildRequestPayload(),b=yield k.pristineResource.$links.updateImmediately(x);return b.retainFrom(k.pristineResource),yield this.onSaved(b),this.complete(k,b)})}complete(k,x){const b=new v(k,x);this.committedChanges.next(b),this.reset(k);const y=b.wasNew?"created":"updated";return this.halEvents.push(b.resource,{eventType:y,commit:b}),b}reset(k){k.clear(),this.clearSome(k.href)}typedState(k){return this.multiState.get(k.href)}edit(k,x){const b=this.multiState.get(k.href),y=this.newChangeset(k,b,x);return b.putValue(y),y}newChangeset(k,x,b){return new(this.hook.call("halResourceChangesetClass",k).pop()||i.W)(k,x,b)}changeFor(k){const x=this.multiState.get(k.href);let b=k;k.state&&(b=k.state.getValueOr(k));const y=x.value;return y&&!y.isEmpty()?y:y?b.hasOwnProperty("lockVersion")&&y.pristineResource.lockVersion<b.lockVersion?this.edit(b):(y.updatePristineResource(b),y):this.edit(b)}temporaryEditResource(k){const x=(0,e.$e)(k.state,this.typedState(k));return(0,e.eS)(x,b=>b.pipe((0,p.h)(([y,P])=>!!y),(0,h.U)(([y,P])=>P?(P.updatePristineResource(y),P.projectedResource):y)))}stopEditing(k){this.multiState.get(k.href).clear()}onSaved(k){return k.state?k.push(k):Promise.resolve()}}C.\u0275fac=function(k){return new(k||C)(a.LFG(a.zs3),a.LFG(r.J),a.LFG(l.$))},C.\u0275prov=a.Yz7({token:C,factory:C.\u0275fac})},82635:(te,M,t)=>{"use strict";t.d(M,{g:()=>e});var n=t(26942);class e extends n.N{get displayName(){return this.schema.name||this.name}get value(){return this.resource[this.name]}get type(){return this.constructor.type}get required(){return!!this.schema.required}get writable(){return this.schema.writable&&!1!==this.context.options.writable}get hasDefault(){return this.schema.hasDefault}get options(){return this.schema.options}isEmpty(){return void 0===this.value||null===this.value||""===this.value}get unknownAttribute(){return this.isEmpty()&&!this.schema}}},39478:(te,M,t)=>{"use strict";t.d(M,{h:()=>n});class n{constructor(){this.fields={},this.classes={}}fieldType(p){return this.fields[p]}getClassFor(p,h="unknown"){const c=this.fieldType(p)||this.fieldType(h)||this.defaultFieldType;return this.classes[c]}getSpecificClassFor(p,h,c="unknown"){const i=this.fieldType(`${p}-${h}`)||this.fieldType(`${p}-${c}`);return i?this.classes[i]:this.getClassFor(h,c)}addFieldType(p,h,c){return p.fieldType=h,this.register(p,c),this}addSpecificFieldType(p,h,c,i){return h.fieldType=`${p}-${c}`,i=i.map(l=>`${p}-${l}`),this.register(h,i),this}extendFieldType(p,h){const c=this.classes[p]||this.getClassFor(p);return this.addFieldType(c,p,h)}register(p,h=[]){const c=p.fieldType;h.forEach(i=>this.fields[i]=c),this.classes[c]=p}}},63419:(te,M,t)=>{"use strict";function n(h){return`-${(h=p(h)).replace("_","-")}`}function e(h,c){return h=p(h),c.t(`js.grid.widgets.project_status.${h.replace("-","_")}`)}function p(h){return h||"not-set"}t.d(M,{p:()=>n,v:()=>e})},2246:(te,M,t)=>{"use strict";t.d(M,{E:()=>Fi});var n=t(2316),e=t(54364),p=t(55811),h=t(97779),c=t(31283),i=t(21757),l=t(71858),r=t(84568),d=t(60874),f=t(18322),a=t(1707),m=t(84312);class v extends f.su{constructor(){super(...arguments),this.shouldFocus="subject"===this.name}}v.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(v)))(A||v)}}(),v.\u0275cmp=n.Xpm({type:v,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:6,consts:[["type","text",1,"inline-edit--field","op-input",3,"opAutofocus","disabled","ngModel","id","ngModelChange","keydown","focusout"]],template:function(U,A){1&U&&(n.TgZ(0,"input",0),n.NdJ("ngModelChange",function(we){return A.value=we})("keydown",function(we){return A.handler.handleUserKeydown(we)})("focusout",function(){return A.handler.onFocusOut()}),n.qZA()),2&U&&(n.Q6J("opAutofocus",A.shouldFocus)("disabled",A.inFlight)("ngModel",A.value)("id",A.handler.htmlId),n.uIk("aria-required",A.required)("required",A.required))},directives:[a.Fj,m.U,a.Q7,a.JJ,a.On],encapsulation:2});class C extends f.su{constructor(){super(...arguments),this.locale=I18n.locale}}C.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(C)))(A||C)}}(),C.\u0275cmp=n.Xpm({type:C,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:6,consts:[["type","number",1,"inline-edit--field","op-input",3,"disabled","ngModel","id","ngModelChange","keydown","focusout"]],template:function(U,A){1&U&&(n.TgZ(0,"input",0),n.NdJ("ngModelChange",function(we){return A.value=we})("keydown",function(we){return A.handler.handleUserKeydown(we)})("focusout",function(){return A.handler.onFocusOut()}),n.qZA()),2&U&&(n.Q6J("disabled",A.inFlight)("ngModel",A.value)("id",A.handler.htmlId),n.uIk("aria-required",A.required)("required",A.required)("lang",A.locale))},directives:[a.wV,a.Fj,a.Q7,a.JJ,a.On],encapsulation:2});var u=t(3786);class k{constructor(){this._fields=[]}register(U,A){this._fields.push({attribute:A,component:U})}getAutocompleterOfAttribute(U){const A=_.find(this._fields,_e=>_e.attribute===U);return A?A.component:void 0}}k.\u0275fac=function(U){return new(U||k)},k.\u0275prov=n.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"});var x=t(30400),b=t(33927),y=t(98636),P=t(29161),E=t(66220),T=t(61342),O=t(47775),I=t(67727),Z=t(29092),j=t(32853);const B=function(ge,U,A,_e,we,Je,rt,ct){return{availableValues:ge,appendTo:U,model:A,required:_e,disabled:we,id:Je,finishedLoading:!0,classes:rt,resource:ct}};class J extends f.su{constructor(){super(...arguments),this.appendTo=null,this.referenceOutputs={onCreate:U=>this.onCreate(U),onChange:U=>this.onChange(U),onAddNew:U=>this.onNewValueAdded(U),onKeydown:U=>this.handler.handleUserKeydown(U,!0),onOpen:()=>this.onOpen(),onClose:()=>this.onClose(),onAfterViewInit:U=>this._autocompleterComponent=U},this.valuesLoaded=!1,this.hiddenOverflowContainer=".__hidden_overflow_container"}get selectedOption(){const U=this.value?this.value.href:null;return _.find(this.availableOptions,A=>A.href===U)}set selectedOption(U){const A=_.find(this.availableOptions,_e=>_e.href===U.href);A&&""===A.href&&(A.href=null),this.value=A||U}ngOnInit(){var U;super.ngOnInit(),this.appendTo=this.overflowingSelector,this.handler.$onUserActivate.pipe(this.untilDestroyed()).subscribe(()=>{this.valuesLoadingPromise.then(()=>{this._autocompleterComponent.openDirectly=!0})}),this._syncUrlParamsOnChangeIfNeeded(this.handler.fieldName,null===(U=this.editFormComponent)||void 0===U?void 0:U.editMode)}initialize(){this.text={requiredPlaceholder:this.I18n.t("js.placeholders.selection"),placeholder:this.I18n.t("js.placeholders.default")},this.valuesLoadingPromise=this.change.getForm().then(()=>this.initialValueLoading())}initialValueLoading(){return this.valuesLoaded=!1,this.loadValues().toPromise()}autocompleterComponent(){const{type:U}=this.schema;return this.selectAutocompleterRegister.getAutocompleterOfAttribute(U)||E.c}setValues(U){this.availableOptions=this.sortValues(U),this.addEmptyOption()}loadValues(U){const{allowedValues:A}=this.schema;if(Array.isArray(A))this.setValues(A),this.valuesLoaded=!0;else{if(A&&!this.valuesLoaded)return this.loadValuesFromBackend(U);this.setValues([])}return(0,x.D)(Promise.resolve(this.availableOptions))}loadValuesFromBackend(U){return(0,x.D)(this.loadAllowedValues(U)).pipe((0,b.U)(A=>void 0===A.count||void 0===A.total||!U&&A.total===A.count||!this.value?A.elements:A.elements.concat([this.value])),(0,y.b)(A=>this.setValues(A)),(0,b.U)(()=>this.availableOptions))}loadAllowedValues(U){if(!U){const A=this.schema.allowedValues.$link.href;return this.change.cacheValue(A,this.fetchAllowedValueQuery.bind(this))}return this.fetchAllowedValueQuery(U)}fetchAllowedValueQuery(U){return this.schema.allowedValues.$link.$fetch(this.allowedValuesFilter(U))}addValue(U){this.availableOptions.push(U)}get currentValueInvalid(){return!!(this.value&&!_.some(this.availableOptions,U=>U.href===this.value.href)||!this.value&&this.schema.required)}onCreate(U){this.addValue(U),this.selectedOption={name:U.name,href:U.href},this.handler.handleUserSubmit()}onOpen(){jQuery(this.hiddenOverflowContainer).one("scroll",()=>{this._autocompleterComponent.closeSelect()})}onClose(){}onChange(U){if(U)return this.selectedOption=U,void this.handler.handleUserSubmit();const A=this.getEmptyOption();A&&(this.selectedOption=A,this.handler.handleUserSubmit())}onNewValueAdded(U){return(0,u.mG)(this,void 0,void 0,function*(){!U||(yield this.change.getForm(!0),this.onChange(U))})}addEmptyOption(){this.isRequired()||void 0===this.getEmptyOption()&&this.availableOptions.unshift({name:this.text.placeholder,href:""})}isRequired(){return this.schema.required}sortValues(U){return this.halSorting.sort(U)}allowedValuesFilter(U){return{}}getEmptyOption(){return _.find(this.availableOptions,U=>U.name===this.text.placeholder)}_syncUrlParamsOnChangeIfNeeded(U,A){"type"===U&&A&&this.handler.registerOnBeforeSubmit(()=>{var _e,we;const Je=null===(we=null===(_e=this.value)||void 0===_e?void 0:_e.$source)||void 0===we?void 0:we.id;Je&&this.$state.go(".",{type:Je},{notify:!1})})}}J.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(J)))(A||J)}}(),J.\u0275cmp=n.Xpm({type:J,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:12,consts:[[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs"]],template:function(U,A){1&U&&n._UZ(0,"ndc-dynamic",0),2&U&&n.Q6J("ndcDynamicComponent",A.autocompleterComponent())("ndcDynamicInputs",n.qlk(3,B,A.availableOptions,A.appendTo,A.selectedOption?A.selectedOption:"",A.required,A.inFlight,A.handler.htmlId,"inline-edit--field "+A.handler.fieldName,A.resource))("ndcDynamicOutputs",A.referenceOutputs)},directives:[j.B5,j.oc],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",k)],J.prototype,"selectAutocompleterRegister",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",I.W)],J.prototype,"halNotification",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Z.h)],J.prototype,"halSorting",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",O.StateService)],J.prototype,"$state",void 0),(0,u.gn)([(0,P.W)(T.n,null,n.XFs.Optional),(0,u.w6)("design:type",T.n)],J.prototype,"editFormComponent",void 0);var R=t(96617),F=t(36868),Y=t(82140);function X(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"op-invite-user-button",4),n.NdJ("invited",function(we){n.CHM(A);return n.oxw(2).selectedOption=we}),n.qZA()}if(2&ge){const A=n.oxw(2);n.Q6J("projectId",null==A.resource.project?null:A.resource.project.id)}}function K(ge,U){1&ge&&n.YNc(0,X,1,1,"ng-template",3)}function ie(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"edit-field-controls",5),n.NdJ("onSave",function(){return n.CHM(A),n.oxw().handler.handleUserSubmit()})("onCancel",function(){return n.CHM(A),n.oxw().handler.handleUserCancel()}),n.qZA()}if(2&ge){const A=n.oxw();n.Q6J("fieldController",A.self)("saveTitle",A.text.save)("cancelTitle",A.text.cancel)}}class H extends f.su{constructor(){super(...arguments),this.availableOptions=[],this.text={requiredPlaceholder:this.I18n.t("js.placeholders.selection"),placeholder:this.I18n.t("js.placeholders.default"),save:this.I18n.t("js.inplace.button_save",{attribute:this.schema.name}),cancel:this.I18n.t("js.inplace.button_cancel",{attribute:this.schema.name})},this.appendTo=null,this.currentValueInvalid=!1,this.hiddenOverflowContainer=".__hidden_overflow_container",this.requestFocus=!1}ngOnInit(){this.nullOption={name:this.text.placeholder,href:null},this.showAddNewUserButton="User"===this.schema.type,this.handler.$onUserActivate.pipe(this.untilDestroyed()).subscribe(()=>{this.requestFocus=0===this.availableOptions.length,this.requestFocus||this.openAutocompleteSelectField()}),super.ngOnInit(),this.appendTo=this.overflowingSelector}get value(){const U=this.resource[this.name];return U&&U[0]}buildSelectedOption(){const U=this.resource[this.name];return U?_.castArray(U).map(A=>this.findValueOption(A)):[]}get selectedOption(){return this._selectedOption}set selectedOption(U){this._selectedOption=U;const A=_e=>{const we=_.find(this.availableOptions,Je=>Je.href===_e.href)||this.nullOption;return we&&""===we.href&&(we.href=null),we};this.resource[this.name]=_.castArray(U).map(_e=>A(_e))}onOpen(){jQuery(this.hiddenOverflowContainer).one("scroll",()=>{this.ngSelectComponent.close()})}onClose(){}repositionDropdown(){this.ngSelectComponent&&this.ngSelectComponent.dropdownPanel&&setTimeout(()=>this.ngSelectComponent.dropdownPanel.adjustPosition(),0)}openAutocompleteSelectField(){const U=this;window.setTimeout(()=>{U.ngSelectComponent.open()},0)}findValueOption(U){let A;return U&&(A=_.find(this.availableOptions,_e=>_e.href===U.href)),A||this.nullOption}setValues(U,A=!1){A&&U.sort((_e,we)=>{const Je=_e.name.toLowerCase(),rt=we.name.toLowerCase();return Je<rt?-1:Je>rt?1:0}),this.availableOptions=U||[],this._selectedOption=this.buildSelectedOption(),this.checkCurrentValueValidity(),this.availableOptions.length>0&&this.requestFocus&&(this.openAutocompleteSelectField(),this.requestFocus=!1)}initialize(){super.initialize(),this.loadValues()}loadValues(){const{allowedValues:U}=this.schema;if(Array.isArray(U))this.setValues(U);else{if(this.schema.allowedValues)return this.schema.allowedValues.$load().then(A=>{A.count>0&&"Project"===A.elements[0]._type?this.setValues(A.elements,!0):this.setValues(A.elements)});this.setValues([])}return Promise.resolve()}checkCurrentValueValidity(){this.value?this.currentValueInvalid=!_.some(this.value,U=>_.some(this.availableOptions,A=>A.href===U.href)):this.currentValueInvalid=!!this.schema.required}}H.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(H)))(A||H)}}(),H.\u0275cmp=n.Xpm({type:H,selectors:[["ng-component"]],viewQuery:function(U,A){if(1&U&&n.Gf(F.w9,7),2&U){let _e;n.iGM(_e=n.CRH())&&(A.ngSelectComponent=_e.first)}},features:[n.qOj],decls:3,vars:16,consts:[["bindLabel","name",3,"ngModel","ngClass","required","clearable","disabled","id","items","virtualScroll","clearSearchOnAdd","multiple","closeOnSelect","appendTo","dropdownPosition","hideSelected","ngModelChange","keydown","open","close","add","remove"],[4,"ngIf"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel",4,"ngIf"],["ng-footer-tmp",""],[3,"projectId","invited"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel"]],template:function(U,A){1&U&&(n.TgZ(0,"ng-select",0),n.NdJ("ngModelChange",function(we){return A.selectedOption=we})("keydown",function(we){return A.handler.handleUserKeydown(we,!0)})("open",function(){return A.onOpen()})("close",function(){return A.onClose()})("add",function(){return A.repositionDropdown()})("remove",function(){return A.repositionDropdown()}),n.YNc(1,K,1,0,void 0,1),n.qZA(),n.YNc(2,ie,1,3,"edit-field-controls",2)),2&U&&(n.Q6J("ngModel",A.selectedOption)("ngClass","inline-edit--field -multi-select")("required",A.required)("clearable",!A.required)("disabled",A.inFlight)("id",A.handler.htmlId)("items",A.availableOptions)("virtualScroll",!0)("clearSearchOnAdd",!0)("multiple",!0)("closeOnSelect",!1)("appendTo",A.appendTo)("dropdownPosition","top")("hideSelected",!0),n.xp6(1),n.Q6J("ngIf",A.showAddNewUserButton),n.xp6(1),n.Q6J("ngIf",!A.handler.inEditMode))},directives:[F.w9,a.JJ,a.On,e.mk,a.Q7,e.O5,F.x0,Y.e],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",R.D)],H.prototype,"I18n",void 0);class ee extends f.su{constructor(){super(...arguments),this.locale=I18n.locale}}ee.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(ee)))(A||ee)}}(),ee.\u0275cmp=n.Xpm({type:ee,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:6,consts:[["type","number","step","any",1,"inline-edit--field","op-input",3,"disabled","ngModel","id","ngModelChange","keydown","focusout"]],template:function(U,A){1&U&&(n.TgZ(0,"input",0),n.NdJ("ngModelChange",function(we){return A.value=we})("keydown",function(we){return A.handler.handleUserKeydown(we)})("focusout",function(){return A.handler.onFocusOut()}),n.qZA()),2&U&&(n.Q6J("disabled",A.inFlight)("ngModel",A.value)("id",A.handler.htmlId),n.uIk("aria-required",A.required)("required",A.required)("lang",A.locale))},directives:[a.wV,a.Fj,a.Q7,a.JJ,a.On],encapsulation:2});class ce extends f.su{updateValue(U){this.value=U,this.handler.handleUserSubmit()}}ce.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(ce)))(A||ce)}}(),ce.\u0275cmp=n.Xpm({type:ce,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:4,consts:[["type","checkbox",1,"inline-edit--field","inline-edit--boolean-field",3,"checked","disabled","id","change","keydown"]],template:function(U,A){1&U&&(n.TgZ(0,"input",0),n.NdJ("change",function(){return A.updateValue(!A.value)})("keydown",function(we){return A.handler.handleUserKeydown(we)}),n.qZA()),2&U&&(n.Q6J("checked",A.value)("disabled",A.inFlight)("id",A.handler.htmlId),n.uIk("aria-required",A.required))},encapsulation:2});var se=t(79441),re=t(83972),Me=t(81134),Ae=t(9170),Ye=t(83720),ze=t(80639),Xe=t(79902),it=t(18293),at=t(92597),lt=t(22663);class de{constructor(U,A,_e=!1,we=250){this.requestHandler=U,this.errorHandler=A,this.preFilterNull=_e,this.debounceMs=we,this.input$=new se.xQ,this.loading$=new se.xQ,this.lastResult=[],this.output$=(0,re.z)((0,Me.of)([]),this.input$.pipe((0,Ae.h)(Je=>!_e||null!=Je),(0,Ye.x)(),(0,ze.b)(we),(0,y.b)(Je=>{this.lastRequestedValue=Je,this.lastResult=[],this.loading$.next(!0)}),(0,Xe.w)(Je=>this.requestHandler(Je).pipe((0,it.K)(rt=>(this.errorHandler(rt),(0,Me.of)([]))),(0,y.b)(rt=>{this.loading$.next(!1),this.lastResult=rt}))),(0,at.d)(1)))}request(U){this.input$.next(U)}get hasResults(){return this.lastResult.length>0}observe(U){return this.output$.pipe((0,lt.R)(U))}}var oe=t(53466),D=t(26269);const G=function(ge,U,A,_e,we,Je,rt,ct,Et){return{availableValues:ge,appendTo:U,model:A,required:_e,disabled:we,id:Je,finishedLoading:rt,classes:ct,typeahead:Et,hideSelected:!0}};class V extends J{constructor(){var ge;super(...arguments),this.requests=new de(U=>this.loadValues(U),(ge=this.halNotification,U=>ge.handleRawError(U)))}initialValueLoading(){return this.valuesLoaded=!1,new Promise(U=>{this.requests.output$.pipe((0,oe.q)(1)).subscribe(A=>{U(A)}),this.requests.input$.next("")})}get typeahead(){return this.requests.input$}fetchAllowedValueQuery(U){return"parent"===this.name?this.schema.allowedValues.$link.$fetch({query:U}):super.fetchAllowedValueQuery(U)}allowedValuesFilter(U){let A=super.allowedValuesFilter(U);if(U){const _e=new D.qM;_e.add("subjectOrId","**",[U]),A={filters:_e.toJson()}}return A}}V.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(V)))(A||V)}}(),V.\u0275cmp=n.Xpm({type:V,selectors:[["ng-component"]],features:[n.qOj],decls:2,vars:15,consts:[[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs"]],template:function(U,A){1&U&&(n._UZ(0,"ndc-dynamic",0),n.ALo(1,"async")),2&U&&n.Q6J("ndcDynamicComponent",A.autocompleterComponent())("ndcDynamicInputs",n.rFY(5,G,[n.lcZ(1,3,A.requests.output$),A.appendTo,A.selectedOption?A.selectedOption:"",A.required,A.inFlight,A.handler.htmlId,A.requests.loading$,"inline-edit--field "+A.handler.fieldName,A.typeahead]))("ndcDynamicOutputs",A.referenceOutputs)},directives:[j.B5,j.oc],pipes:[e.Ov],encapsulation:2});var me=t(2281),$=t(77355),Se=t(70692),ot=t(90547);class st extends f.su{ngOnInit(){super.ngOnInit()}onValueSelected(U){this.value=this.parser(U)}submit(U){this.onValueSelected(U),this.handler.handleUserSubmit()}onCancel(){this.handler.handleUserCancel()}parser(U){return me(U,"YYYY-MM-DD",!0).isValid()?U:null}formatter(U){if(me(U,"YYYY-MM-DD",!0).isValid()){const A=this.timezoneService.parseDate(U);return this.timezoneService.formattedISODate(A)}return null}}st.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(st)))(A||st)}}(),st.\u0275cmp=n.Xpm({type:st,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:4,consts:[["tabindex","-1","classes","inline-edit--field",3,"initialDate","required","disabled","id","changed","canceled","blurred","enterPressed"]],template:function(U,A){1&U&&(n.TgZ(0,"op-single-date-picker",0),n.NdJ("changed",function(we){return A.onValueSelected(we)})("canceled",function(){return A.onCancel()})("blurred",function(we){return A.submit(we)})("enterPressed",function(we){return A.submit(we)}),n.qZA()),2&U&&n.Q6J("initialDate",A.formatter(A.value))("required",A.required)("disabled",A.inFlight)("id",A.handler.htmlId)},directives:[ot.S],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],st.prototype,"timezoneService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",$.S)],st.prototype,"opModalService",void 0);var he=t(26611),ye=t(84699);function xe(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"edit-field-controls",4),n.NdJ("onSave",function(){return n.CHM(A),n.oxw().handleUserSubmit()})("onCancel",function(){return n.CHM(A),n.oxw().handler.handleUserCancel()}),n.qZA()}if(2&ge){const A=n.oxw();n.Q6J("fieldController",A.field)("saveTitle",A.text.save)("cancelTitle",A.text.cancel)}}class De extends f.su{constructor(){super(...arguments),this.field=this,this.initializationError=!1,this.isPreview=!1,this.previewHtml="",this.text={},this.ckEditorContext=Object.assign({resource:this.change.pristineResource,macros:"none",previewContext:this.previewContext,options:{rtl:this.schema.options&&this.schema.options.rtl},type:"constrained"},this.resource.getEditorContext(this.field.name))}ngOnInit(){super.ngOnInit(),this.handler.registerOnSubmit(()=>this.getCurrentValue()),this.text={attachmentLabel:this.I18n.t("js.label_formattable_attachment_hint"),save:this.I18n.t("js.inplace.button_save",{attribute:this.schema.name}),cancel:this.I18n.t("js.inplace.button_cancel",{attribute:this.schema.name})}}onCkeditorSetup(U){(0,ye.Z)(this.resource)||setTimeout(()=>U.editing.view.focus())}getCurrentValue(){return this.editor.getTransformedContent().then(U=>{this.isPrivate=this.editor.isPrivate,this.rawValue=U})}onContentChange(U){this.rawValue!==U&&(this.rawValue=U)}handleUserSubmit(){return this.getCurrentValue().then(()=>{this.handler.handleUserSubmit()}),!1}get previewContext(){return this.handler.previewContext(this.resource)}reset(){this.editor&&this.editor.initialized&&(this.editor.content=this.rawValue,this.cdRef.markForCheck())}get rawValue(){return this.value&&this.value.raw?this.value.raw:""}get isPrivate(){return!this.value||!Object.keys(this.value).includes("isPrivate")||this.value.isPrivate}set rawValue(U){this.value={raw:U,isPrivate:this.isPrivate}}set isPrivate(U){this.value.isPrivate=U}isEmpty(){return!(this.value&&this.value.raw)}initialize(){this.initialContent=this.rawValue,(0,ye.Z)(this.resource)&&this.editor&&this.reset()}}De.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(De)))(A||De)}}(),De.\u0275cmp=n.Xpm({type:De,selectors:[["ng-component"]],viewQuery:function(U,A){if(1&U&&n.Gf(he.F,7),2&U){let _e;n.iGM(_e=n.CRH())&&(A.editor=_e.first)}},features:[n.qOj],decls:4,vars:5,consts:[[1,"textarea-wrapper"],[1,"op-ckeditor--wrapper","op-ckeditor-element"],[3,"context","content","fieldName","isPrivate","onContentChange","onInitializationFailed","onInitialized"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel",4,"ngIf"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel"]],template:function(U,A){1&U&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.TgZ(2,"op-ckeditor",2),n.NdJ("onContentChange",function(we){return A.onContentChange(we)})("onInitializationFailed",function(){return A.initializationError=!0})("onInitialized",function(we){return A.onCkeditorSetup(we)}),n.qZA(),n.qZA(),n.YNc(3,xe,1,3,"edit-field-controls",3),n.qZA()),2&U&&(n.xp6(2),n.Q6J("context",A.ckEditorContext)("content",A.initialContent)("fieldName",A.field.name)("isPrivate",A.isPrivate),n.xp6(1),n.Q6J("ngIf",!(A.handler.inEditMode||A.initializationError)))},directives:[he.F,e.O5,Y.e],encapsulation:2,changeDetection:0});var Qe=t(63419);function Ve(ge,U){if(1&ge&&(n._UZ(0,"span",3),n.TgZ(1,"span",4),n._uU(2),n.qZA()),2&ge){const A=U.item;n.Q6J("ngClass",A.colorClass),n.xp6(1),n.Q6J("ngClass",A.colorClass),n.xp6(1),n.Oqu(A.name)}}function nt(ge,U){if(1&ge&&(n._UZ(0,"span",3),n.TgZ(1,"span",4),n._uU(2),n.qZA()),2&ge){const A=U.item;n.Q6J("ngClass",A.colorClass),n.xp6(1),n.Q6J("ngClass",A.colorClass),n.xp6(1),n.Oqu(A.name)}}class mt extends f.su{constructor(){super(...arguments),this.availableStatuses=[{href:"not_set",name:(0,Qe.v)("not_set",this.I18n),colorClass:(0,Qe.p)("not_set")}],this.hiddenOverflowContainer="#content-wrapper",this.appendToContainer="body"}ngOnInit(){this.currentStatusCode=null===this.resource.status?this.availableStatuses[0].href:this.resource.status.href,this.change.getForm().then(U=>{U.schema.status.allowedValues.forEach(_e=>{this.availableStatuses=[...this.availableStatuses,{href:_e.href,name:_e.name,colorClass:(0,Qe.p)(_e.id)}]});const A=this;window.setTimeout(()=>{A.ngSelectComponent.open()},0)})}onChange(){this.resource.status=this.currentStatusCode===this.availableStatuses[0].href?null:{href:this.currentStatusCode},this.handler.handleUserSubmit()}onOpen(){setTimeout(()=>{const U=this.ngSelectComponent;U&&U.dropdownPanel&&U.dropdownPanel._updatePosition(),jQuery(this.hiddenOverflowContainer).one("scroll.autocompleteContainer",()=>{this.ngSelectComponent.close()})},25)}onClose(){jQuery(this.hiddenOverflowContainer).off("scroll.autocompleteContainer")}}mt.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(mt)))(A||mt)}}(),mt.\u0275cmp=n.Xpm({type:mt,selectors:[["ng-component"]],viewQuery:function(U,A){if(1&U&&n.Gf(F.w9,7),2&U){let _e;n.iGM(_e=n.CRH())&&(A.ngSelectComponent=_e.first)}},features:[n.qOj],decls:3,vars:5,consts:[["bindLabel","name","bindValue","href",1,"project-status",3,"items","ngModel","appendTo","hideSelected","disabled","ngModelChange","open","close","change"],["ng-label-tmp",""],["ng-option-tmp",""],[1,"project-status--bulb",3,"ngClass"],[1,"project-status--name",3,"ngClass"]],template:function(U,A){1&U&&(n.TgZ(0,"ng-select",0),n.NdJ("ngModelChange",function(we){return A.currentStatusCode=we})("open",function(){return A.onOpen()})("close",function(){return A.onClose()})("change",function(){return A.onChange()}),n.YNc(1,Ve,3,3,"ng-template",1),n.YNc(2,nt,3,3,"ng-template",2),n.qZA()),2&U&&n.Q6J("items",A.availableStatuses)("ngModel",A.currentStatusCode)("appendTo",A.appendToContainer)("hideSelected",!0)("disabled",A.inFlight)},directives:[F.w9,a.JJ,a.On,F.bb,F.Z2,e.mk],styles:[""]}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",R.D)],mt.prototype,"I18n",void 0);class Ue extends f.su{constructor(){super(...arguments),this.shouldFocus=!1}get value(){if(!this.schema)return"";const U=this.resource[this.name];return U&&U.raw||""}set value(U){this.resource[this.name]={raw:U}}}Ue.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(Ue)))(A||Ue)}}(),Ue.\u0275cmp=n.Xpm({type:Ue,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:6,consts:[["type","text",1,"inline-edit--field","op-input",3,"opAutofocus","disabled","ngModel","id","ngModelChange","keydown","focusout"]],template:function(U,A){1&U&&(n.TgZ(0,"input",0),n.NdJ("ngModelChange",function(we){return A.value=we})("keydown",function(we){return A.handler.handleUserKeydown(we)})("focusout",function(){return A.handler.onFocusOut()}),n.qZA()),2&U&&(n.Q6J("opAutofocus",A.shouldFocus)("disabled",A.inFlight)("ngModel",A.value)("id",A.handler.htmlId),n.uIk("aria-required",A.required)("required",A.required))},directives:[a.Fj,m.U,a.Q7,a.JJ,a.On],encapsulation:2});var Fe=t(10190),Te=t(33276),tt=t(50166);const ut=function(ge,U,A,_e,we,Je,rt,ct,Et){return{availableValues:ge,appendTo:U,model:A,required:_e,disabled:we,id:Je,finishedLoading:rt,classes:ct,typeahead:Et,hideSelected:!0}};class It extends V{initialize(){super.initialize(),this.referenceOutputs&&(this.referenceOutputs.modeSwitch=U=>{this.valuesLoaded=!1;const A=this.requests.lastRequestedValue;this.requests.input$.next('_/&"()____'),this.requests.input$.next(A)})}autocompleterComponent(){return tt.R}isRequired(){return!0}loadAllowedValues(U){return this.recentWorkPackageIds?this.fetchAllowedValueQuery(U):this.apiV3Service.time_entries.list({filters:[["user_id","=",["me"]]],sortBy:[["updated_at","desc"]],pageSize:30}).toPromise().then(A=>(this.recentWorkPackageIds=A.elements.filter(_e=>{var we;return null===(we=_e.workPackage)||void 0===we?void 0:we.href}).map(_e=>(0,Fe.Z)(_e.workPackage.href)).filter((_e,we,Je)=>Je.indexOf(_e)===we),this.fetchAllowedValueQuery(U)))}allowedValuesFilter(U){const A=new D.qM;return"recent"===this._autocompleterComponent.mode&&this.recentWorkPackageIds.length>0&&A.add("id","=",this.recentWorkPackageIds),U&&A.add("subjectOrId","**",[U]),{filters:A.toJson()}}sortValues(U){return"recent"===this._autocompleterComponent.mode?this.sortValuesByRecentIds(U):super.sortValues(U)}sortValuesByRecentIds(U){return U.sort((A,_e)=>this.recentWorkPackageIds.indexOf(A.id)-this.recentWorkPackageIds.indexOf(_e.id))}}It.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(It)))(A||It)}}(),It.\u0275cmp=n.Xpm({type:It,selectors:[["ng-component"]],features:[n.qOj],decls:2,vars:15,consts:[[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs"]],template:function(U,A){1&U&&(n._UZ(0,"ndc-dynamic",0),n.ALo(1,"async")),2&U&&n.Q6J("ndcDynamicComponent",A.autocompleterComponent())("ndcDynamicInputs",n.rFY(5,ut,[n.lcZ(1,3,A.requests.output$),A.appendTo,A.selectedOption?A.selectedOption:"",A.required,A.inFlight,A.handler.htmlId,A.requests.loading$,"inline-edit--field "+A.handler.fieldName,A.typeahead]))("ndcDynamicOutputs",A.referenceOutputs)},directives:[j.B5,j.oc],pipes:[e.Ov],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Te.T)],It.prototype,"apiV3Service",void 0);var Nt=t(60312),wt=t(14882),zt=t(12703),Kt=t(12877),ei=t(85105),Rt=t(91260),Mt=t(12702),Ot=t(51253),St=t(61486);function ti(ge){return""===ge?null:ge}function Tt(ge){return ge instanceof Date?new Date(ge.setHours(0,0,0,0)):""===ge?"":new Date(moment(ge).toDate().setHours(0,0,0,0))}function qt(ge){return ge instanceof Date||""===ge||!!/^\d{4}-\d{2}-\d{2}$/.exec(ge)}function Qt(ge,U){const A=Tt(ge),_e=Tt(U);return"string"!=typeof A&&"string"!=typeof _e&&A.getTime()===_e.getTime()}function Gt(ge,U,A){ge.datepickerInstance.currentMonth=U,ge.datepickerInstance.currentYear=A}function ii(ge,U,A){const{currentMonth:_e}=U.datepickerInstance,{currentYear:we}=U.datepickerInstance;if(U.setDates(ge),A){const Je=A.getMonth(),rt=A.getFullYear(),ct=Je-_e+12*(rt-we);Math.abs(ct)>1?(U.datepickerInstance.currentMonth=Je,U.datepickerInstance.currentYear=rt):Gt(U,_e,we)}else Gt(U,_e,we);U.datepickerInstance.redraw()}function Jt(ge,U,A,_e,we){!U&&A&&ge.classList.add("flatpickr-non-working-day"),we&&ge.classList.add("flatpickr-disabled"),ge.setAttribute("data-iso-date",ge.dateObj.toISOString())}class Ce{constructor(U,A){this.locals=U,this.apiV3Service=A,this.changeset=this.locals.changeset,this.precedingWorkPackages$=(0,Me.of)(this.changeset).pipe((0,Ae.h)(_e=>!(0,ye.Z)(_e.pristineResource)),(0,Xe.w)(_e=>this.apiV3Service.work_packages.signalled((0,D.PQ)("precedes","=",[_e.id]),["elements/id","elements/dueDate","elements/date"])),(0,b.U)(_e=>_e._embedded.elements||[]),(0,Ot.d)([]),(0,at.d)(1)),this.followingWorkPackages$=(0,Me.of)(this.changeset).pipe((0,Ae.h)(_e=>!(0,ye.Z)(_e.pristineResource)),(0,Xe.w)(_e=>this.apiV3Service.work_packages.signalled((0,D.PQ)("follows","=",[_e.id]),["elements/id"])),(0,b.U)(_e=>_e._embedded.elements||[]),(0,Ot.d)([]),(0,at.d)(1)),this.hasRelations$=(0,St.aj)([this.precedingWorkPackages$,this.followingWorkPackages$]).pipe((0,b.U)(([_e,we])=>_e.length>0||we.length>0||this.isParent||this.isChild))}getMinimalDateFromPreceeding(){return this.precedingWorkPackages$.pipe((0,oe.q)(1),(0,b.U)(U=>this.minimalDateFromPrecedingRelationship(U)))}minimalDateFromPrecedingRelationship(U){if(0===U.length)return null;let A=null;return U.forEach(_e=>{if(!_e.dueDate&&!_e.date)return;const Je=Tt(_e.dueDate||_e.date);(!A||A<Je)&&(A=""===Je?null:Je)}),A}get isChild(){return this.ancestors.length>0}get ancestors(){return this.changeset.projectedResource.ancestors||[]}get isParent(){return this.children.length>0}get children(){return this.changeset.projectedResource.children||[]}getInvolvedWorkPackageIds(){return(0,St.aj)([this.precedingWorkPackages$,this.followingWorkPackages$]).pipe((0,b.U)(([U,A])=>[this.changeset.pristineResource,...U,...A,...this.children,...this.ancestors].map(_e=>_e.id)))}}Ce.\u0275fac=function(U){return new(U||Ce)(n.LFG($.E),n.LFG(Te.T))},Ce.\u0275prov=n.Yz7({token:Ce,factory:Ce.\u0275fac});class N{constructor(U,A){this.locals=U,this.dateModalRelations=A,this.changeset=this.locals.changeset,this.scheduleManually=!!this.changeset.value("scheduleManually")}get isSchedulable(){return this.scheduleManually||!this.dateModalRelations.isParent}isDayDisabled(U,A){return!this.isSchedulable||!this.scheduleManually&&!!A&&U.dateObj<=A}}N.\u0275fac=function(U){return new(U||N)(n.LFG($.E),n.LFG(Ce))},N.\u0275prov=n.Yz7({token:N,factory:N.\u0275fac});var Q=t(53916),je=t(55901),Ee=t(2775);function ht(ge,U){1&ge&&n._UZ(0,"span",7)}function kt(ge,U){1&ge&&n._UZ(0,"span",8)}function si(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"button",9),n.NdJ("click",function(we){return n.CHM(A),n.oxw().buttonClicked.emit(we)}),n._UZ(1,"op-icon",10),n._UZ(2,"span",11),n.qZA()}if(2&ge){const A=n.oxw();n.xp6(1),n.MGl("icon-classes","button--icon ",A.actionButtonClasses,""),n.xp6(1),n.Q6J("textContent",A.actionButton)}}class Wt{constructor(){this.type="info",this.buttonClicked=new n.vpe}}function ri(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"op-modal-banner",3),n.NdJ("buttonClicked",function(we){return n.CHM(A),n.oxw().openGantt(we)}),n.qZA()}if(2&ge){const A=n.oxw();n.Q6J("title",A.text.manually_scheduled)("subtitle",A.text.click_on_show_relations_to_open_gantt)("actionButton",A.text.show_relations_button)}}function ni(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"op-modal-banner",4),n.NdJ("buttonClicked",function(we){return n.CHM(A),n.oxw().openGantt(we)}),n.qZA()}if(2&ge){const A=n.oxw();n.Q6J("title",A.text.automatically_scheduled_parent)("subtitle",A.text.click_on_show_relations_to_open_gantt)("actionButton",A.text.show_relations_button)}}function Qi(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"op-modal-banner",4),n.NdJ("buttonClicked",function(we){return n.CHM(A),n.oxw(2).openGantt(we)}),n.qZA()}if(2&ge){const A=n.oxw(2);n.Q6J("title",A.text.start_date_limited_by_relations)("subtitle",A.text.click_on_show_relations_to_open_gantt)("actionButton",A.text.show_relations_button)}}function _i(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"op-modal-banner",3),n.NdJ("buttonClicked",function(we){return n.CHM(A),n.oxw(2).openGantt(we)}),n.qZA()}if(2&ge){const A=n.oxw(2);n.Q6J("title",A.text.changing_dates_affects_follow_relations)("subtitle",A.text.click_on_show_relations_to_open_gantt)("actionButton",A.text.show_relations_button)}}function bi(ge,U){if(1&ge&&(n.ynx(0),n.YNc(1,Qi,1,3,"op-modal-banner",1),n.ALo(2,"async"),n.ALo(3,"async"),n.YNc(4,_i,1,3,"op-modal-banner",0),n.ALo(5,"async"),n.BQk()),2&ge){const A=n.oxw();n.xp6(1),n.Q6J("ngIf",!0===n.lcZ(2,2,A.hasPrecedingRelations$)&&!1===n.lcZ(3,4,A.hasFollowingRelations$)&&!A.isChild),n.xp6(3),n.Q6J("ngIf",!0===n.lcZ(5,6,A.hasFollowingRelations$)||A.isChild)}}Wt.\u0275fac=function(U){return new(U||Wt)},Wt.\u0275cmp=n.Xpm({type:Wt,selectors:[["op-modal-banner"]],inputs:{type:"type",title:"title",subtitle:"subtitle",actionButton:"actionButton",actionButtonClasses:"actionButtonClasses"},outputs:{buttonClicked:"buttonClicked"},decls:8,vars:7,consts:[[1,"op-modal-banner",3,"ngClass"],["class","spot-icon spot-icon_info1 hidden-for-mobile",4,"ngIf"],["class","spot-icon spot-icon_warning hidden-for-mobile",4,"ngIf"],[1,"op-modal-banner--text","spot-caption"],[1,"op-modal-banner--title","spot-caption","spot-caption_bold",3,"textContent"],[1,"op-modal-banner--subtitle","hidden-for-mobile",3,"textContent"],["class","op-modal-banner--button button","type","button",3,"click",4,"ngIf"],[1,"spot-icon","spot-icon_info1","hidden-for-mobile"],[1,"spot-icon","spot-icon_warning","hidden-for-mobile"],["type","button",1,"op-modal-banner--button","button",3,"click"],[3,"icon-classes"],[1,"button--text",3,"textContent"]],template:function(U,A){1&U&&(n.TgZ(0,"div",0),n.YNc(1,ht,1,0,"span",1),n.YNc(2,kt,1,0,"span",2),n.TgZ(3,"p",3),n._UZ(4,"span",4),n._UZ(5,"br"),n._UZ(6,"span",5),n.qZA(),n.YNc(7,si,3,2,"button",6),n.qZA()),2&U&&(n.MGl("ngClass","op-modal-banner_",A.type,""),n.Q2q("data-qa-selector","op-modal-banner-",A.type,""),n.xp6(1),n.Q6J("ngIf","info"===A.type),n.xp6(1),n.Q6J("ngIf","warning"===A.type),n.xp6(2),n.Q6J("textContent",A.title),n.xp6(2),n.Q6J("textContent",A.subtitle),n.xp6(1),n.Q6J("ngIf",!!A.actionButton))},directives:[e.mk,e.O5,Ee.o],styles:[".op-modal-banner[_ngcontent-%COMP%]{display:grid;grid-template-columns:20px auto max-content;grid-gap:1rem;align-items:center;padding:.75rem}@media only screen and (max-width: 679px){.op-modal-banner[_ngcontent-%COMP%]{grid-template-columns:auto max-content}}.op-modal-banner_warning[_ngcontent-%COMP%]{background:#ffe6c6}.op-modal-banner_info[_ngcontent-%COMP%]{background:#e3f5ff}.op-modal-banner--button[_ngcontent-%COMP%]{margin:0}"],changeDetection:0});class Ke{constructor(U,A,_e,we){this.dateModalRelations=U,this.injector=A,this.I18n=_e,this.state=we,this.scheduleManually=!1,this.hasRelations$=this.dateModalRelations.hasRelations$,this.hasPrecedingRelations$=this.dateModalRelations.precedingWorkPackages$.pipe((0,b.U)(Je=>(null==Je?void 0:Je.length)>0)),this.hasFollowingRelations$=this.dateModalRelations.followingWorkPackages$.pipe((0,b.U)(Je=>(null==Je?void 0:Je.length)>0)),this.isParent=this.dateModalRelations.isParent,this.isChild=this.dateModalRelations.isChild,this.text={automatically_scheduled_parent:this.I18n.t("js.work_packages.datepicker_modal.automatically_scheduled_parent"),manually_scheduled:this.I18n.t("js.work_packages.datepicker_modal.manually_scheduled"),start_date_limited_by_relations:this.I18n.t("js.work_packages.datepicker_modal.start_date_limited_by_relations"),changing_dates_affects_follow_relations:this.I18n.t("js.work_packages.datepicker_modal.changing_dates_affects_follow_relations"),click_on_show_relations_to_open_gantt:this.I18n.t("js.work_packages.datepicker_modal.click_on_show_relations_to_open_gantt",{button_name:this.I18n.t("js.work_packages.datepicker_modal.show_relations")}),show_relations_button:this.I18n.t("js.work_packages.datepicker_modal.show_relations")}}openGantt(U){U.preventDefault(),this.dateModalRelations.getInvolvedWorkPackageIds().pipe((0,oe.q)(1)).subscribe(A=>{const _e={c:["id","subject","type","status","assignee","project","startDate","dueDate"],t:"id:asc",tv:!0,hi:!0,f:[{n:"id",o:"=",v:A}]},we=this.state.href("work-packages.partitioned.list",{query_id:null,projects:null,projectPath:null,query_props:JSON.stringify(_e)});window.open(we,"_blank")})}}Ke.\u0275fac=function(U){return new(U||Ke)(n.Y36(Ce),n.Y36(n.zs3),n.Y36(R.D),n.Y36(O.StateService))},Ke.\u0275cmp=n.Xpm({type:Ke,selectors:[["op-datepicker-banner"]],inputs:{scheduleManually:"scheduleManually"},decls:4,vars:5,consts:[["type","warning","actionButtonClasses","icon-view-timeline",3,"title","subtitle","actionButton","buttonClicked",4,"ngIf"],["type","info","actionButtonClasses","icon-view-timeline",3,"title","subtitle","actionButton","buttonClicked",4,"ngIf"],[4,"ngIf"],["type","warning","actionButtonClasses","icon-view-timeline",3,"title","subtitle","actionButton","buttonClicked"],["type","info","actionButtonClasses","icon-view-timeline",3,"title","subtitle","actionButton","buttonClicked"]],template:function(U,A){1&U&&(n.YNc(0,ri,1,3,"op-modal-banner",0),n.ALo(1,"async"),n.YNc(2,ni,1,3,"op-modal-banner",1),n.YNc(3,bi,6,8,"ng-container",2)),2&U&&(n.Q6J("ngIf",A.scheduleManually&&n.lcZ(1,3,A.hasRelations$)),n.xp6(2),n.Q6J("ngIf",!A.scheduleManually&&A.isParent),n.xp6(1),n.Q6J("ngIf",!A.scheduleManually&&!A.isParent))},directives:[e.O5,Wt],pipes:[e.Ov],encapsulation:2,changeDetection:0});var Oe=t(99100),Pe=t(96091);class ve{constructor(U,A){this.I18n=U,this.cdRef=A,this.text={scheduling:{title:this.I18n.t("js.scheduling.manual")}},this.onChange=_e=>{},this.onTouched=_e=>{}}registerOnChange(U){this.onChange=U}registerOnTouched(U){this.onTouched=U}writeValue(U){this.scheduleManually=U,this.cdRef.markForCheck()}onToggle(U){this.writeValue(U),this.onChange(U),this.onTouched(U)}}ve.\u0275fac=function(U){return new(U||ve)(n.Y36(R.D),n.Y36(n.sBO))},ve.\u0275cmp=n.Xpm({type:ve,selectors:[["op-datepicker-scheduling-toggle"]],inputs:{scheduleManually:"scheduleManually"},features:[n._Bn([{provide:a.JU,useExisting:(0,n.Gpc)(()=>ve),multi:!0}])],decls:2,vars:3,consts:[[3,"reverseLabel","label"],["slot","input","name","scheduling","data-qa-selector","op-datepicker-modal--scheduling-action",3,"ngModel","ngModelChange"]],template:function(U,A){1&U&&(n.TgZ(0,"spot-selector-field",0),n.TgZ(1,"spot-switch",1),n.NdJ("ngModelChange",function(we){return A.onToggle(we)}),n.qZA(),n.qZA()),2&U&&(n.Q6J("reverseLabel",!0)("label",A.text.scheduling.title),n.xp6(1),n.Q6J("ngModel",A.scheduleManually))},directives:[Oe.o,Pe.G,a.JJ,a.On],encapsulation:2,changeDetection:0});class pe{constructor(U,A){this.I18n=U,this.cdRef=A,this.disabled=!1,this.text={ignoreNonWorkingDays:{title:this.I18n.t("js.work_packages.datepicker_modal.ignore_non_working_days.title")}},this.onChange=_e=>{},this.onTouched=_e=>{}}registerOnChange(U){this.onChange=U}registerOnTouched(U){this.onTouched=U}onToggle(U){const A=!U;this.writeValue(A),this.onChange(A),this.onTouched(A)}writeValue(U){this.ignoreNonWorkingDays=U,this.cdRef.markForCheck()}}pe.\u0275fac=function(U){return new(U||pe)(n.Y36(R.D),n.Y36(n.sBO))},pe.\u0275cmp=n.Xpm({type:pe,selectors:[["op-datepicker-working-days-toggle"]],inputs:{ignoreNonWorkingDays:"ignoreNonWorkingDays",disabled:"disabled"},features:[n._Bn([{provide:a.JU,useExisting:(0,n.Gpc)(()=>pe),multi:!0}])],decls:2,vars:4,consts:[[3,"reverseLabel","label"],["slot","input","name","weekdays_only","data-qa-selector","op-datepicker-modal--include-non-working-days",3,"disabled","ngModel","ngModelChange"]],template:function(U,A){1&U&&(n.TgZ(0,"spot-selector-field",0),n.TgZ(1,"spot-switch",1),n.NdJ("ngModelChange",function(we){return A.onToggle(we)}),n.qZA(),n.qZA()),2&U&&(n.Q6J("reverseLabel",!0)("label",A.text.ignoreNonWorkingDays.title),n.xp6(1),n.Q6J("disabled",A.disabled)("ngModel",!A.ignoreNonWorkingDays))},directives:[Oe.o,Pe.G,a.JJ,a.On],encapsulation:2,changeDetection:0});var ue=t(92512),Ze=t(87912);const Ge=["modalContainer"],ft=function(ge){return{"op-datepicker-modal--date-field_current":ge}},Pt=function(ge){return{"op-datepicker-modal--hidden-link":ge}};class yt extends Nt.T{constructor(U,A,_e,we,Je,rt){super(A,_e,we),this.injector=U,this.locals=A,this.cdRef=_e,this.elementRef=we,this.configurationService=Je,this.apiV3Service=rt,this.text={save:this.I18n.t("js.button_save"),cancel:this.I18n.t("js.button_cancel"),date:this.I18n.t("js.work_packages.properties.date"),placeholder:this.I18n.t("js.placeholders.default"),today:this.I18n.t("js.label_today")},this.onDataUpdated=new n.vpe,this.scheduleManually=!1,this.ignoreNonWorkingDays=!1,this.htmlId="",this.date=null,this.dateChangedManually$=new se.xQ,this.debounceDelay=0,this.dateUpdates$=new se.xQ,this.dateUpdateRequests$=this.dateUpdates$.pipe(this.untilDestroyed(),(0,Xe.w)(ct=>this.apiV3Service.work_packages.id(this.changeset.id).form.forPayload({date:ct,lockVersion:this.changeset.value("lockVersion"),ignoreNonWorkingDays:this.ignoreNonWorkingDays}))).subscribe(ct=>this.updateDatesFromForm(ct)),this.changeset=A.changeset,this.htmlId=`wp-datepicker-${A.fieldName}`,this.ignoreNonWorkingDays=!!this.changeset.value("ignoreNonWorkingDays"),this.date=this.changeset.value("date")}ngAfterViewInit(){this.dateModalRelations.getMinimalDateFromPreceeding().subscribe(U=>{this.initializeDatepicker(U),this.onDataChange()}),this.dateChangedManually$.pipe((0,ei.D)(()=>(0,Mt.H)(this.debounceDelay))).subscribe(()=>{this.debounceDelay=800,this.updateDate(this.date)})}changeSchedulingMode(){this.initializeDatepicker(),this.cdRef.detectChanges()}changeNonWorkingDays(){this.initializeDatepicker(),!this.ignoreNonWorkingDays&&this.date&&this.dateUpdates$.next(this.date),this.cdRef.detectChanges()}save(U){U.preventDefault(),this.changeset.setValue("scheduleManually",this.scheduleManually),this.changeset.setValue("ignoreNonWorkingDays",this.ignoreNonWorkingDays),this.dateModalScheduling.isSchedulable&&this.changeset.setValue("date",ti(this.date)),this.closeMe()}cancel(){this.closeMe()}updateDate(U){if(null!==U&&(U.length>=8||0===U.length)&&qt(U)&&this.datePickerInstance){const A=Tt(U)||void 0;this.enforceManualChangesToDatepicker(A)}}setToday(){const U=Tt(new Date);this.date=this.timezoneService.formattedISODate(U),this.enforceManualChangesToDatepicker(U)}reposition(U,A){this.deviceService.isMobile||U.position({my:"left top",at:"left bottom",of:A,collision:"flipfit"})}initializeDatepicker(U){var A;null===(A=this.datePickerInstance)||void 0===A||A.destroy(),this.datePickerInstance=new wt.M(this.injector,"#flatpickr-input",this.date||"",{mode:"single",showMonths:this.deviceService.isMobile?1:2,inline:!0,onReady:(_e,we,Je)=>{Je.calendarContainer.classList.add("op-datepicker-modal--flatpickr-instance"),this.reposition(jQuery(this.modalContainer.nativeElement),jQuery(`.${Rt.fA}`))},onChange:_e=>{_e.length>0&&(this.date=this.timezoneService.formattedISODate(_e[0]),this.enforceManualChangesToDatepicker(_e[0])),this.onDataChange(),this.cdRef.detectChanges()},onDayCreate:(_e,we,Je,rt)=>{var ct;Jt(rt,this.ignoreNonWorkingDays,null===(ct=this.datePickerInstance)||void 0===ct?void 0:ct.weekdaysService.isNonWorkingDay(rt.dateObj),0,this.dateModalScheduling.isDayDisabled(rt,U))}},null)}enforceManualChangesToDatepicker(U){ii(Tt(this.date||""),this.datePickerInstance,U)}onDataChange(){this.onDataUpdated.emit(this.date||"")}updateDatesFromForm(U){const A=U.payload;this.date=A.date,this.ignoreNonWorkingDays=A.ignoreNonWorkingDays;const _e=Tt(A.date);this.enforceManualChangesToDatepicker(_e)}}yt.\u0275fac=function(U){return new(U||yt)(n.Y36(n.zs3),n.Y36($.E),n.Y36(n.sBO),n.Y36(n.SBq),n.Y36(Kt.e),n.Y36(Te.T))},yt.\u0275cmp=n.Xpm({type:yt,selectors:[["ng-component"]],viewQuery:function(U,A){if(1&U&&n.Gf(Ge,5),2&U){let _e;n.iGM(_e=n.CRH())&&(A.modalContainer=_e.first)}},features:[n._Bn([N,Ce]),n.qOj],decls:16,vars:17,consts:[["data-qa-selector","op-datepicker-modal","data-indicator-name","modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal","op-datepicker-modal","loading-indicator--location",3,"cdkTrapFocusAutoCapture","submit"],["modalContainer",""],[3,"scheduleManually"],[1,"spot-modal--body","spot-container"],[1,"op-datepicker-modal--toggle-actions-container"],["name","scheduleManually",3,"ngModel","ngModelChange"],["name","ignoreNonWorkingDays",3,"ngModel","ngModelChange"],[1,"op-datepicker-modal--dates-container"],[3,"label"],["slot","input","name","date",1,"op-datepicker-modal--date-field",3,"ngClass","ngModel","showClearButton","ngModelChange"],["slot","action","type","button",1,"spot-link",3,"ngClass","textContent","click"],["id","flatpickr-input","hidden",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button","data-qa-selector","op-datepicker-modal--action",1,"op-datepicker-modal--action","spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["type","submit","data-qa-selector","op-datepicker-modal--action",1,"op-datepicker-modal--action","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(U,A){1&U&&(n.TgZ(0,"form",0,1),n.NdJ("submit",function(we){return A.save(we)}),n._UZ(2,"op-datepicker-banner",2),n.TgZ(3,"div",3),n.TgZ(4,"div",4),n.TgZ(5,"op-datepicker-scheduling-toggle",5),n.NdJ("ngModelChange",function(we){return A.scheduleManually=we})("ngModelChange",function(){return A.changeSchedulingMode()}),n.qZA(),n.TgZ(6,"op-datepicker-working-days-toggle",6),n.NdJ("ngModelChange",function(we){return A.ignoreNonWorkingDays=we})("ngModelChange",function(){return A.changeNonWorkingDays()}),n.qZA(),n.qZA(),n.TgZ(7,"div",7),n.TgZ(8,"spot-form-field",8),n.TgZ(9,"spot-text-field",9),n.NdJ("ngModelChange",function(we){return A.date=we})("ngModelChange",function(){return A.dateChangedManually$.next()}),n.qZA(),n.TgZ(10,"button",10),n.NdJ("click",function(){return A.setToday()}),n.qZA(),n.qZA(),n.qZA(),n._UZ(11,"input",11),n.qZA(),n.TgZ(12,"div",12),n.TgZ(13,"div",13),n.TgZ(14,"button",14),n.NdJ("click",function(){return A.cancel()}),n.qZA(),n._UZ(15,"button",15),n.qZA(),n.qZA(),n.qZA()),2&U&&(n.Q6J("cdkTrapFocusAutoCapture",!0),n.uIk("id",A.htmlId),n.xp6(2),n.Q6J("scheduleManually",A.scheduleManually),n.xp6(3),n.Q6J("ngModel",A.scheduleManually),n.xp6(1),n.Q6J("ngModel",A.ignoreNonWorkingDays),n.xp6(2),n.Q6J("label",A.text.date),n.xp6(1),n.Q6J("ngClass",n.VKq(13,ft,A.dateModalScheduling.isSchedulable))("ngModel",A.date)("showClearButton",!0),n.xp6(1),n.Q6J("ngClass",n.VKq(15,Pt,!A.dateModalScheduling.isSchedulable))("textContent",A.text.today),n.xp6(4),n.Q6J("textContent",A.text.cancel),n.xp6(1),n.Q6J("textContent",A.text.save))},directives:[a._Y,a.JL,a.F,je.mK,Ke,ve,a.JJ,a.On,pe,ue.I,Ze.A,e.mk],styles:[".op-datepicker-modal{z-index:500;width:auto;max-width:600px;min-height:200px;box-shadow:4px 4px 10px #00000026;margin-bottom:60px}.op-datepicker-modal--toggle-actions-container{display:grid;grid-template-columns:auto auto 1fr;grid-column-gap:2rem}.op-datepicker-modal--dates-container{display:grid;grid-template-columns:1fr 1fr 150px;grid-gap:1rem}.op-datepicker-modal--date-field_current,.op-datepicker-modal--date-field_current:hover{outline:2px solid var(--primary-color);outline-offset:-2px}.op-datepicker-modal--date-container{display:inline-grid}.op-datepicker-modal--action:last-of-type{margin-right:0}.op-datepicker-modal--hidden-link{visibility:hidden}\n","@media screen and (max-width: 679px){.op-datepicker-modal{width:calc(100vw - 2rem);margin-bottom:0}.op-datepicker-modal--flatpickr-instance{align-self:center}.op-datepicker-modal--dates-container{grid-template-columns:1fr 1fr}.op-datepicker-modal--toggle-actions-container{display:grid;grid-template-columns:1fr;grid-row-gap:1rem}.op-datepicker-modal--date-form:only-child{grid-column:1/3}}\n"],encapsulation:2,changeDetection:0}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",R.D)],yt.prototype,"I18n",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],yt.prototype,"timezoneService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",zt.l)],yt.prototype,"halEditing",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",N)],yt.prototype,"dateModalScheduling",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ce)],yt.prototype,"dateModalRelations",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Q.U)],yt.prototype,"deviceService",void 0);var Lt=t(89919),Xt=t(82516),At=t(52377),vt=t(7101);const mi=["modalContainer"],ai=["durationField"],dn=function(ge){return{"op-datepicker-modal--date-field_current":ge}},Zi=function(ge){return{"op-datepicker-modal--hidden-link":ge}};class Ut extends Nt.T{constructor(U,A,_e,we,Je,rt){super(A,_e,we),this.injector=U,this.locals=A,this.cdRef=_e,this.elementRef=we,this.configurationService=Je,this.apiV3Service=rt,this.text={save:this.I18n.t("js.button_save"),cancel:this.I18n.t("js.button_cancel"),startDate:this.I18n.t("js.work_packages.properties.startDate"),endDate:this.I18n.t("js.work_packages.properties.dueDate"),duration:this.I18n.t("js.work_packages.properties.duration"),placeholder:this.I18n.t("js.placeholders.default"),today:this.I18n.t("js.label_today"),days:ct=>this.I18n.t("js.units.day",{count:ct})},this.onDataUpdated=new n.vpe,this.scheduleManually=!1,this.ignoreNonWorkingDays=!1,this.htmlId="",this.dates={start:null,end:null},this.startDateChanged$=new se.xQ,this.startDateDebounced$=this.debouncedInput(this.startDateChanged$,"start"),this.endDateChanged$=new se.xQ,this.endDateDebounced$=this.debouncedInput(this.endDateChanged$,"end"),this.datepickerChanged$=new se.xQ,this.modalPositioned=!1,this.dateUpdates$=(0,Lt.T)(this.startDateDebounced$,this.endDateDebounced$,this.datepickerChanged$).pipe(this.untilDestroyed(),(0,Ae.h)(()=>!!this.datePickerInstance)).subscribe(([ct,Et])=>{null!==Et&&this.handleSingleDateUpdate(ct,Et),null===Et&&"duration"!==ct&&this.clearWithDuration(ct),this.onDataChange(),this.cdRef.detectChanges()}),this.durationChanges$=new se.xQ,this.durationDebounced$=this.durationChanges$.pipe(this.untilDestroyed(),(0,ze.b)(500),(0,b.U)(ct=>""===ct?null:Math.abs(parseInt(ct,10))),(0,Ae.h)(ct=>null===ct||!Number.isNaN(ct)),(0,Ae.h)(ct=>ct!==this.duration)).subscribe(ct=>this.applyDurationChange(ct)),this.durationFocused=!1,this.ignoreNonWorkingDaysWritable=!0,this.formUpdates$=new se.xQ,this.dateUpdateRequests$=this.formUpdates$.pipe(this.untilDestroyed(),(0,Xe.w)(ct=>this.apiV3Service.work_packages.withOptionalId("new"===this.changeset.id?null:this.changeset.id).form.forPayload(Object.assign(Object.assign({},ct),{lockVersion:this.changeset.value("lockVersion"),ignoreNonWorkingDays:this.ignoreNonWorkingDays,scheduleManually:this.scheduleManually})))).subscribe(ct=>this.updateDatesFromForm(ct)),this.changeset=A.changeset,this.htmlId=`wp-datepicker-${A.fieldName}`,this.scheduleManually=!!this.changeset.value("scheduleManually"),this.ignoreNonWorkingDays=!!this.changeset.value("ignoreNonWorkingDays"),this.changeset.getForm().then(ct=>{this.ignoreNonWorkingDaysWritable=!!ct.schema.ignoreNonWorkingDays.writable,this.cdRef.detectChanges()}),this.setDurationDaysFromUpstream(this.changeset.value("duration")),this.dates.start=this.changeset.value("startDate"),this.dates.end=this.changeset.value("dueDate"),this.setCurrentActivatedField(this.initialActivatedField)}ngAfterViewInit(){this.dateModalRelations.getMinimalDateFromPreceeding().subscribe(U=>{this.initializeDatepicker(U),this.onDataChange()}),"duration"===this.initialActivatedField&&this.focusHelper.focus(this.durationField.nativeElement)}changeSchedulingMode(){this.initializeDatepicker(),!1===this.scheduleManually&&!this.ignoreNonWorkingDaysWritable&&(this.ignoreNonWorkingDays=!!this.changeset.value("ignoreNonWorkingDays")),this.cdRef.detectChanges()}changeNonWorkingDays(){this.initializeDatepicker(),!!this.dates.start&&!!this.duration&&this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}),!!this.dates.start&&!this.dates.end&&this.formUpdates$.next({startDate:this.dates.start}),!!this.dates.end&&!this.dates.start&&this.formUpdates$.next({dueDate:this.dates.end}),this.cdRef.detectChanges()}save(U){U.preventDefault(),this.changeset.setValue("scheduleManually",this.scheduleManually),this.changeset.setValue("ignoreNonWorkingDays",this.ignoreNonWorkingDays),this.isSchedulable&&(this.changeset.setValue("startDate",ti(this.dates.start)),this.changeset.setValue("dueDate",ti(this.dates.end)),this.changeset.setValue("duration",this.durationAsIso8601)),this.closeMe()}cancel(){this.closeMe()}updateDate(U,A){if((null===A||qt(A))&&this.datePickerInstance){this.dates[U]=ti(A);const _e=Tt(A||"")||void 0;this.enforceManualChangesToDatepicker(_e),this.cdRef.detectChanges()}}setCurrentActivatedField(U){this.currentlyActivatedDateField=U}toggleCurrentActivatedField(){this.currentlyActivatedDateField="start"===this.currentlyActivatedDateField?"end":"start"}isStateOfCurrentActivatedField(U){return this.currentlyActivatedDateField===U}setToday(U){this.datepickerChanged$.next([U,new Date]);const A="start"===U?"end":"start";this.setCurrentActivatedField(A)}reposition(U,A){this.deviceService.isMobile||U.position({my:"left top",at:"left bottom",of:A,collision:"flipfit"})}showTodayLink(){return this.isSchedulable}get isSchedulable(){return this.scheduleManually||!this.dateModalRelations.isParent}showFieldAsActive(U){return this.isStateOfCurrentActivatedField(U)&&this.isSchedulable}handleDurationFocusIn(){this.durationFocused=!0,this.setCurrentActivatedField("duration")}handleDurationFocusOut(){setTimeout(()=>{this.durationFocused=!1})}get displayedDuration(){return this.duration?this.text.days(this.duration):""}applyDurationChange(U){this.duration=U,this.cdRef.detectChanges(),null!==U?this.dates.start?this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}):this.dates.end&&this.formUpdates$.next({dueDate:this.dates.end,duration:this.durationAsIso8601}):this.updateDate("end",null)}get durationAsIso8601(){return this.duration?this.timezoneService.toISODuration(this.duration,"days"):null}clearWithDuration(U){this.duration=null,this.dates[U]=null,this.enforceManualChangesToDatepicker()}initializeDatepicker(U){var A;null===(A=this.datePickerInstance)||void 0===A||A.destroy(),this.datePickerInstance=new wt.M(this.injector,"#flatpickr-input",[this.dates.start||"",this.dates.end||""],{mode:"range",showMonths:this.deviceService.isMobile?1:2,inline:!0,onReady:(_e,we,Je)=>{Je.calendarContainer.classList.add("op-datepicker-modal--flatpickr-instance"),this.modalPositioned||(this.reposition(jQuery(this.modalContainer.nativeElement),jQuery(`.${Rt.fA}`)),this.modalPositioned=!0),this.ensureHoveredSelection(Je.calendarContainer)},onChange:(_e,we,Je)=>{const rt=this.currentlyActivatedDateField;if(2===_e.length&&!this.duration)return this.setDatesAndDeriveDuration(_e[0],_e[1]),void this.toggleCurrentActivatedField();const{latestSelectedDateObj:ct}=Je;this.datepickerChanged$.next([rt,ct]),"duration"!==rt&&this.toggleCurrentActivatedField()},onDayCreate:(_e,we,Je,rt)=>{Jt(rt,this.ignoreNonWorkingDays,this.weekdayService.isNonWorkingDay(rt.dateObj),0,this.isDayDisabled(rt,U))}},null)}enforceManualChangesToDatepicker(U){let A=Tt(this.dates.start||""),_e=Tt(this.dates.end||"");A&&_e&&(A>_e&&this.isStateOfCurrentActivatedField("start")?(_e=A,this.dates.end=this.timezoneService.formattedISODate(_e)):_e<A&&this.isStateOfCurrentActivatedField("end")&&(A=_e,this.dates.start=this.timezoneService.formattedISODate(A))),ii([A,_e],this.datePickerInstance,U),this.onDataChange()}setDatesAndDeriveDuration(U,A){this.dates.start=this.timezoneService.formattedISODate(U),this.dates.end=this.timezoneService.formattedISODate(A),this.formUpdates$.next({startDate:this.dates.start,dueDate:this.dates.end})}handleSingleDateUpdate(U,A){"duration"!==U?this.dates.start&&this.dates.end?this.replaceDatesWithNewSelection(U,A):(this.moveActiveDate(U,A),this.duration?this.deriveMissingDateFromDuration(U):this.dates.start&&this.dates.end&&this.formUpdates$.next({startDate:this.dates.start,dueDate:this.dates.end}),this.enforceManualChangesToDatepicker(A)):this.durationActiveDateSelected(A)}durationActiveDateSelected(U){const A=this.timezoneService.formattedISODate(U);!this.duration&&this.dates.start?(this.setDaysInOrder(this.dates.start,A),this.setCurrentActivatedField("start")):(this.setDaysInOrder(A,this.dates.end),this.setCurrentActivatedField("end")),this.dates.start&&this.duration?this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}):this.dates.start&&this.dates.end&&this.formUpdates$.next({startDate:this.dates.start,dueDate:this.dates.end})}setDaysInOrder(U,A){const _e=U?Tt(U):null,we=A?Tt(A):null;_e&&we&&_e>we?(this.dates.start=A,this.dates.end=U):(this.dates.start=U,this.dates.end=A)}deriveMissingDateFromDuration(U){"start"===U&&!!this.dates.start&&this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}),"end"===U&&this.dates.end&&this.formUpdates$.next({dueDate:this.dates.end,duration:this.durationAsIso8601})}moveActiveDate(U,A){const _e=this.dates.start?Tt(this.dates.start):null,we=this.dates.end?Tt(this.dates.end):null;this.dates[U]=this.timezoneService.formattedISODate(A),"end"===U&&_e&&_e>A&&(this.duration=null,this.dates.start=null,this.enforceManualChangesToDatepicker(A)),"start"===U&&we&&we<A&&(this.duration=null,this.dates.end=null,this.enforceManualChangesToDatepicker(A))}replaceDatesWithNewSelection(U,A){const _e=Tt(this.dates.start||""),we=Tt(this.dates.end||"");if(A<_e)"start"===U?this.applyNewDates([A]):(this.duration=null,this.applyNewDates(["",A]));else if(A>we)"end"===U?this.applyNewDates([_e,A]):(this.duration=null,this.applyNewDates([A]));else if(Qt(A,_e)||Qt(A,we))this.applyNewDates([A,A]);else{const Je="start"===U?[A,we]:[_e,A];this.applyNewDates(Je)}}applyNewDates([U,A]){this.dates.start=U?this.timezoneService.formattedISODate(U):null,this.dates.end=A?this.timezoneService.formattedISODate(A):null,ii([U,A],this.datePickerInstance),this.dates.start&&this.dates.end&&this.formUpdates$.next({startDate:this.dates.start,dueDate:this.dates.end}),this.dates.start&&!this.dates.end&&!!this.duration&&this.formUpdates$.next({startDate:this.dates.start,duration:this.durationAsIso8601}),this.dates.end&&!this.dates.start&&this.duration&&this.formUpdates$.next({dueDate:this.dates.end,duration:this.durationAsIso8601})}onDataChange(){const _e=`${this.dates.start||""} - ${this.dates.end||""}`;this.onDataUpdated.emit(_e)}get initialActivatedField(){switch(this.locals.fieldName){case"startDate":return"start";case"dueDate":return"end";case"duration":return"duration";default:return this.dates.start&&!this.dates.end?"end":"start"}}isDayDisabled(U,A){return!this.isSchedulable||!this.scheduleManually&&!!A&&U.dateObj<=A}updateDatesFromForm(U){const A=U.payload;this.dates.start=A.startDate,this.dates.end=A.dueDate,this.ignoreNonWorkingDays=A.ignoreNonWorkingDays,this.setDurationDaysFromUpstream(A.duration);const _e=Tt(this.dates.start);this.enforceManualChangesToDatepicker(_e),this.cdRef.detectChanges()}setDurationDaysFromUpstream(U){const A=U?this.timezoneService.toDays(U):null;this.duration=A&&0!==A?A:null}debouncedInput(U,A){return U.pipe(this.untilDestroyed(),(0,Ae.h)(_e=>_e!==this.dates[A]),(0,ze.b)(500),(0,Ae.h)(_e=>qt(_e)),(0,b.U)(_e=>""===_e?null:Tt(_e)),(0,b.U)(_e=>[A,_e]))}ensureHoveredSelection(U){(0,Xt.R)(U,"mouseenter").pipe(this.untilDestroyed()).subscribe(()=>U.classList.remove("flatpickr-container-suppress-hover")),(0,Xt.R)(U,"mouseleave").pipe(this.untilDestroyed(),(0,Ae.h)(()=>!(this.dates.start&&this.dates.end))).subscribe(()=>U.classList.add("flatpickr-container-suppress-hover"))}}Ut.\u0275fac=function(U){return new(U||Ut)(n.Y36(n.zs3),n.Y36($.E),n.Y36(n.sBO),n.Y36(n.SBq),n.Y36(Kt.e),n.Y36(Te.T))},Ut.\u0275cmp=n.Xpm({type:Ut,selectors:[["ng-component"]],viewQuery:function(U,A){if(1&U&&(n.Gf(mi,5),n.Gf(ai,5,n.SBq)),2&U){let _e;n.iGM(_e=n.CRH())&&(A.modalContainer=_e.first),n.iGM(_e=n.CRH())&&(A.durationField=_e.first)}},features:[n._Bn([N,Ce]),n.qOj],decls:22,vars:40,consts:[["data-qa-selector","op-datepicker-modal","data-indicator-name","modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal","op-datepicker-modal","loading-indicator--location",3,"cdkTrapFocusAutoCapture","submit"],["modalContainer",""],[3,"scheduleManually"],[1,"spot-modal--body","spot-container","form","-vertical"],[1,"op-datepicker-modal--toggle-actions-container"],["name","scheduleManually",3,"ngModel","ngModelChange"],["name","ignoreNonWorkingDays",3,"disabled","ngModel","ngModelChange"],[1,"op-datepicker-modal--dates-container"],["data-qa-selector","datepicker-start-date",3,"label"],["slot","input","name","startDate","data-qa-selector","op-datepicker-modal--start-date-field",1,"op-datepicker-modal--date-field",3,"ngClass","ngModel","disabled","showClearButton","ngModelChange","focusin"],["slot","action","type","button",1,"spot-link",3,"ngClass","textContent","click"],["data-qa-selector","datepicker-end-date",3,"label"],["slot","input","name","endDate","data-qa-selector","op-datepicker-modal--end-date-field",1,"op-datepicker-modal--date-field",3,"ngClass","ngModel","disabled","showClearButton","ngModelChange","focusin"],["data-qa-selector","datepicker-duration",3,"label"],["slot","input","name","duration","data-qa-selector","op-datepicker-modal--duration-field","pattern","\\d*","inputmode","numeric",1,"op-datepicker-modal--date-field",3,"ngClass","ngModel","showClearButton","disabled","ngModelChange","focusin","focusout"],["durationField",""],["id","flatpickr-input","hidden",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button","data-qa-selector","op-datepicker-modal--action",1,"op-datepicker-modal--action","spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["type","submit","data-qa-selector","op-datepicker-modal--action",1,"op-datepicker-modal--action","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(U,A){1&U&&(n.TgZ(0,"form",0,1),n.NdJ("submit",function(we){return A.save(we)}),n._UZ(2,"op-datepicker-banner",2),n.TgZ(3,"div",3),n.TgZ(4,"div",4),n.TgZ(5,"op-datepicker-scheduling-toggle",5),n.NdJ("ngModelChange",function(we){return A.scheduleManually=we})("ngModelChange",function(){return A.changeSchedulingMode()}),n.qZA(),n.TgZ(6,"op-datepicker-working-days-toggle",6),n.NdJ("ngModelChange",function(we){return A.ignoreNonWorkingDays=we})("ngModelChange",function(){return A.changeNonWorkingDays()}),n.qZA(),n.qZA(),n.TgZ(7,"div",7),n.TgZ(8,"spot-form-field",8),n.TgZ(9,"spot-text-field",9),n.NdJ("ngModelChange",function(we){return A.startDateChanged$.next(we)})("focusin",function(){return A.setCurrentActivatedField("start")}),n.qZA(),n.TgZ(10,"button",10),n.NdJ("click",function(){return A.setToday("start")}),n.qZA(),n.qZA(),n.TgZ(11,"spot-form-field",11),n.TgZ(12,"spot-text-field",12),n.NdJ("ngModelChange",function(we){return A.endDateChanged$.next(we)})("focusin",function(){return A.setCurrentActivatedField("end")}),n.qZA(),n.TgZ(13,"button",10),n.NdJ("click",function(){return A.setToday("end")}),n.qZA(),n.qZA(),n.TgZ(14,"spot-form-field",13),n.TgZ(15,"spot-text-field",14,15),n.NdJ("ngModelChange",function(we){return A.durationChanges$.next(we)})("focusin",function(){return A.handleDurationFocusIn()})("focusout",function(){return A.handleDurationFocusOut()}),n.qZA(),n.qZA(),n.qZA(),n._UZ(17,"input",16),n.qZA(),n.TgZ(18,"div",17),n.TgZ(19,"div",18),n.TgZ(20,"button",19),n.NdJ("click",function(){return A.cancel()}),n.qZA(),n._UZ(21,"button",20),n.qZA(),n.qZA(),n.qZA()),2&U&&(n.Q6J("cdkTrapFocusAutoCapture",!0),n.uIk("id",A.htmlId),n.xp6(2),n.Q6J("scheduleManually",A.scheduleManually),n.xp6(3),n.Q6J("ngModel",A.scheduleManually),n.xp6(1),n.Q6J("disabled",!(A.scheduleManually||A.ignoreNonWorkingDaysWritable))("ngModel",A.ignoreNonWorkingDays),n.xp6(2),n.Q6J("label",A.text.startDate),n.xp6(1),n.Q6J("ngClass",n.VKq(30,dn,A.showFieldAsActive("start")))("ngModel",A.dates.start)("disabled",!A.isSchedulable)("showClearButton","start"===A.currentlyActivatedDateField),n.uIk("data-qa-highlighted",A.showFieldAsActive("start")||void 0),n.xp6(1),n.Q6J("ngClass",n.VKq(32,Zi,!A.showTodayLink()))("textContent",A.text.today),n.xp6(1),n.Q6J("label",A.text.endDate),n.xp6(1),n.Q6J("ngClass",n.VKq(34,dn,A.showFieldAsActive("end")))("ngModel",A.dates.end)("disabled",!A.isSchedulable)("showClearButton","end"===A.currentlyActivatedDateField),n.uIk("data-qa-highlighted",A.showFieldAsActive("end")||void 0),n.xp6(1),n.Q6J("ngClass",n.VKq(36,Zi,!A.showTodayLink()))("textContent",A.text.today),n.xp6(1),n.Q6J("label",A.text.duration),n.xp6(1),n.Q6J("ngClass",n.VKq(38,dn,A.showFieldAsActive("duration")))("ngModel",A.durationFocused?A.duration:A.displayedDuration)("showClearButton",A.durationFocused)("disabled",!A.isSchedulable),n.uIk("data-qa-highlighted",A.showFieldAsActive("duration")||void 0),n.xp6(5),n.Q6J("textContent",A.text.cancel),n.xp6(1),n.Q6J("textContent",A.text.save))},directives:[a._Y,a.JL,a.F,je.mK,Ke,ve,a.JJ,a.On,pe,ue.I,Ze.A,e.mk,a.c5],styles:[".op-datepicker-modal{z-index:500;width:auto;max-width:600px;min-height:200px;box-shadow:4px 4px 10px #00000026;margin-bottom:60px}.op-datepicker-modal--toggle-actions-container{display:grid;grid-template-columns:auto auto 1fr;grid-column-gap:2rem}.op-datepicker-modal--dates-container{display:grid;grid-template-columns:1fr 1fr 150px;grid-gap:1rem}.op-datepicker-modal--date-field_current,.op-datepicker-modal--date-field_current:hover{outline:2px solid var(--primary-color);outline-offset:-2px}.op-datepicker-modal--date-container{display:inline-grid}.op-datepicker-modal--action:last-of-type{margin-right:0}.op-datepicker-modal--hidden-link{visibility:hidden}\n","@media screen and (max-width: 679px){.op-datepicker-modal{width:calc(100vw - 2rem);margin-bottom:0}.op-datepicker-modal--flatpickr-instance{align-self:center}.op-datepicker-modal--dates-container{grid-template-columns:1fr 1fr}.op-datepicker-modal--toggle-actions-container{display:grid;grid-template-columns:1fr;grid-row-gap:1rem}.op-datepicker-modal--date-form:only-child{grid-column:1/3}}\n"],encapsulation:2,changeDetection:0}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",R.D)],Ut.prototype,"I18n",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],Ut.prototype,"timezoneService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",zt.l)],Ut.prototype,"halEditing",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",N)],Ut.prototype,"dateModalScheduling",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ce)],Ut.prototype,"dateModalRelations",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Q.U)],Ut.prototype,"deviceService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",At.u)],Ut.prototype,"weekdayService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",vt.i)],Ut.prototype,"focusHelper",void 0);class ci extends f.su{constructor(){super(...arguments),this.modal=null}ngOnInit(){super.ngOnInit(),this.handler.$onUserActivate.pipe(this.untilDestroyed()).subscribe(()=>{this.showDatePickerModal()})}ngOnDestroy(){var U;super.ngOnDestroy(),null===(U=this.modal)||void 0===U||U.closeMe()}showDatePickerModal(){const U=this.change.schema.isMilestone?yt:Ut;this.opModalService.show(U,this.injector,{changeset:this.change,fieldName:this.name},!this.deviceService.isMobile).subscribe(A=>{this.modal=A,setTimeout(()=>{const _e=jQuery(A.elementRef.nativeElement).find(".op-datepicker-modal"),we=jQuery(this.elementRef.nativeElement);A.reposition(_e,we)}),A.closingEvent.pipe((0,oe.q)(1)).subscribe(()=>{this.modal=null,this.onModalClosed()})})}onModalClosed(){this.handler.handleUserSubmit()}}ci.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(ci)))(A||ci)}}(),ci.\u0275dir=n.lG2({type:ci,features:[n.qOj]}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],ci.prototype,"timezoneService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",$.S)],ci.prototype,"opModalService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Q.U)],ci.prototype,"deviceService",void 0);class pi extends ci{constructor(){super(...arguments),this.dates="",this.text={placeholder:{startDate:this.I18n.t("js.label_no_start_date"),dueDate:this.I18n.t("js.label_no_due_date"),date:this.I18n.t("js.label_no_date")}}}showDatePickerModal(){var U;super.showDatePickerModal(),null===(U=this.modal)||void 0===U||U.onDataUpdated.subscribe(A=>{this.dates=A,this.cdRef.detectChanges()})}onModalClosed(){this.resetDates(),super.onModalClosed()}initialize(){super.initialize(),this.resetDates()}resetDates(){switch(this.name){case"combinedDate":this.dates=`${this.current("startDate")} - ${this.current("dueDate")}`;break;case"startDate":this.dates=`${this.current("startDate")}`;break;case"dueDate":this.dates=`${this.current("dueDate")}`;break;case"date":this.dates=`${this.current("date")}`}}current(U){return this.resource&&this.resource[U]||this.text.placeholder[U]}}pi.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(pi)))(A||pi)}}(),pi.\u0275cmp=n.Xpm({type:pi,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:1,consts:[["type","text",1,"op-input",3,"value","click"]],template:function(U,A){1&U&&(n.TgZ(0,"input",0),n.NdJ("click",function(){return A.showDatePickerModal()}),n.qZA()),2&U&&n.Q6J("value",A.dates)},encapsulation:2});var wi=t(54622),gi=t(61598);function Ii(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"edit-field-controls",4),n.NdJ("onSave",function(){return n.CHM(A),n.oxw().handleUserSubmit()})("onCancel",function(){return n.CHM(A),n.oxw().handler.handleUserCancel()}),n.qZA()}if(2&ge){const A=n.oxw();n.Q6J("fieldController",A.field)("saveTitle",A.text.save)("cancelTitle",A.text.cancel)}}class Di extends De{constructor(){super(...arguments),this.isBusy=!1,this.name="comment"}get required(){return!0}ngOnInit(){super.ngOnInit()}}Di.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(Di)))(A||Di)}}(),Di.\u0275cmp=n.Xpm({type:Di,selectors:[["ng-component"]],features:[n.qOj],decls:4,vars:5,consts:[[1,"textarea-wrapper"],[1,"op-ckeditor--wrapper","op-ckeditor-element"],[3,"context","content","fieldName","isPrivate","onContentChange","onInitializationFailed","onInitialized"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel",4,"ngIf"],[3,"fieldController","saveTitle","cancelTitle","onSave","onCancel"]],template:function(U,A){1&U&&(n.TgZ(0,"div",0),n.TgZ(1,"div",1),n.TgZ(2,"op-ckeditor",2),n.NdJ("onContentChange",function(we){return A.onContentChange(we)})("onInitializationFailed",function(){return A.initializationError=!0})("onInitialized",function(we){return A.onCkeditorSetup(we)}),n.qZA(),n.qZA(),n.YNc(3,Ii,1,3,"edit-field-controls",3),n.qZA()),2&U&&(n.xp6(2),n.Q6J("context",A.ckEditorContext)("content",A.initialContent)("fieldName",A.field.name)("isPrivate",A.isPrivate),n.xp6(1),n.Q6J("ngIf",!(A.handler.inEditMode||A.initializationError)))},directives:[he.F,e.O5,Y.e],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Kt.e)],Di.prototype,"ConfigurationService",void 0);t(94232),t(86029);var bn=t(91923),wn=t(53882),Yi=t(5443),Jn=t(70099);function Yn(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"op-project-autocompleter",2),n.NdJ("valueChange",function(we){return n.CHM(A),n.oxw().onModelChange(we)})("cancel",function(){return n.CHM(A),n.oxw().handler.handleUserCancel()}),n.qZA()}if(2&ge){const A=n.oxw();n.Q6J("ngClass","inline-edit--field "+A.handler.fieldName)("value",A.value)("url",A.url)("apiFilters",A.APIFilters)("focusDirectly",!(A.handler.inEditMode||A.isNew))("openDirectly",!A.isNew)("isInlineContext",!0)}}function $n(ge,U){1&ge&&(n.TgZ(0,"op-content-loader",3),n.O4$(),n._UZ(1,"rect",4),n.qZA())}class fi extends f.su{constructor(U,A,_e,we,Je,rt,ct,Et,di,Ei){super(U,A,_e,we,Je,rt,ct),this.I18n=U,this.elementRef=A,this.change=_e,this.schema=we,this.handler=Je,this.cdRef=rt,this.injector=ct,this.apiV3Service=Et,this.http=di,this.halResourceService=Ei,this.isNew=(0,ye.Z)(this.resource)}initialize(){this.schema.allowedValues?this.setUrl():this.loadFormAndSetUrl()}onModelChange(U){if(U){const A=Object.assign({},U),_e=this.halResourceService.createHalResourceOfType("project",A);this.value=_e}else this.value=null;return this.handler.handleUserSubmit()}get APIFilters(){const U=[["active","=",["t"]]];if((0,ye.Z)(this.resource)&&this.change.value("type")){const A=(0,Fe.Z)(this.change.value("type").href);U.push(["type_id","=",[A]])}return U}loadFormAndSetUrl(){(0,x.D)(this.change.getForm()).pipe((0,y.b)(()=>this.setUrl()),(0,oe.q)(1)).subscribe()}setUrl(){this.url=this.schema.allowedValues.$link.href}}fi.\u0275fac=function(U){return new(U||fi)(n.Y36(R.D),n.Y36(n.SBq),n.Y36(f.Nm),n.Y36(f.Dz),n.Y36(f.uS),n.Y36(n.sBO),n.Y36(n.zs3),n.Y36(Te.T),n.Y36(wn.eN),n.Y36(bn.u))},fi.\u0275cmp=n.Xpm({type:fi,selectors:[["ng-component"]],features:[n.qOj],decls:3,vars:2,consts:[["appendTo",".op-wide-autocomplete-wrapper",3,"ngClass","value","url","apiFilters","focusDirectly","openDirectly","isInlineContext","valueChange","cancel",4,"ngIf","ngIfElse"],["loadingTemplate",""],["appendTo",".op-wide-autocomplete-wrapper",3,"ngClass","value","url","apiFilters","focusDirectly","openDirectly","isInlineContext","valueChange","cancel"],["viewBox","0 0 100 24",1,"project-edit-field--loading-indicator"],["x","0","y","0","width","100%","height","100%","rx","1"]],template:function(U,A){if(1&U&&(n.YNc(0,Yn,1,7,"op-project-autocompleter",0),n.YNc(1,$n,2,0,"ng-template",null,1,n.W1O)),2&U){const _e=n.MAs(2);n.Q6J("ngIf",A.url)("ngIfElse",_e)}},directives:[e.O5,Yi.F,e.mk,Jn.V],styles:[".project-edit-field--loading-indicator svg{display:block}\n"],encapsulation:2,changeDetection:0});class li extends f.su{parser(U,A){return null==U&&!A.validity.valid&&(U=this.value||0),me.duration(U,"hours")}formatter(U){return Number(me.duration(U).asHours().toFixed(2))}parseValue(U){if(null===U)return U;let A;return A=U.isValid()?U.toISOString():null,A}}li.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(li)))(A||li)}}(),li.\u0275cmp=n.Xpm({type:li,selectors:[["ng-component"]],features:[n.qOj],decls:2,vars:5,consts:[["type","number","step","0.01",1,"inline-edit--field","op-input",3,"ngModel","disabled","id","ngModelChange","keydown"],["input",""]],template:function(U,A){if(1&U){const _e=n.EpF();n.TgZ(0,"input",0,1),n.NdJ("ngModelChange",function(Je){n.CHM(_e);const rt=n.MAs(1);return A.value=A.parser(Je,rt)})("keydown",function(Je){return A.handler.handleUserKeydown(Je)}),n.qZA()}2&U&&(n.Q6J("ngModel",A.formatter(A.value))("disabled",A.inFlight)("id",A.handler.htmlId),n.uIk("aria-required",A.required)("required",A.required))},directives:[a.wV,a.Fj,a.JJ,a.On,a.Q7],encapsulation:2}),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],li.prototype,"TimezoneService",void 0);var pn=t(90127);function Si(ge,U){if(1&ge){const A=n.EpF();n.TgZ(0,"op-user-autocompleter",1),n.NdJ("valueChange",function(we){return n.CHM(A),n.oxw().onModelChange(we)})("cancel",function(){return n.CHM(A),n.oxw().handler.handleUserCancel()})("userInvited",function(we){return n.CHM(A),n.oxw().onModelChange(we)}),n.qZA()}if(2&ge){const A=n.oxw();n.Gre("inline-edit--field ",A.handler.fieldName,""),n.Q6J("clearAfterSelection",!1)("url",A.url)("inviteUserToProject",null==A.resource.project?null:A.resource.project.id)("focusDirectly",!(A.handler.inEditMode||A.isNew))("openDirectly",!(A.handler.inEditMode||A.isNew))("value",A.value)("id",A.handler.htmlId)}}class vi extends f.su{constructor(U,A,_e,we,Je,rt,ct,Et,di,Ei){super(U,A,_e,we,Je,rt,ct),this.I18n=U,this.elementRef=A,this.change=_e,this.schema=we,this.handler=Je,this.cdRef=rt,this.injector=ct,this.apiV3Service=Et,this.http=di,this.halResourceService=Ei,this.isNew=(0,ye.Z)(this.resource)}initialize(){const U=this.schema.allowedValues;U&&(this.url=U.$link.href)}onModelChange(U){if(U){const A=Object.assign({},U);this.value=this.halResourceService.createHalResourceOfType("user",A)}else this.value=null;return this.handler.handleUserSubmit()}}vi.\u0275fac=function(U){return new(U||vi)(n.Y36(R.D),n.Y36(n.SBq),n.Y36(f.Nm),n.Y36(f.Dz),n.Y36(f.uS),n.Y36(n.sBO),n.Y36(n.zs3),n.Y36(Te.T),n.Y36(wn.eN),n.Y36(bn.u))},vi.\u0275cmp=n.Xpm({type:vi,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:1,consts:[["appendTo","body",3,"class","clearAfterSelection","url","inviteUserToProject","focusDirectly","openDirectly","value","id","valueChange","cancel","userInvited",4,"ngIf"],["appendTo","body",3,"clearAfterSelection","url","inviteUserToProject","focusDirectly","openDirectly","value","id","valueChange","cancel","userInvited"]],template:function(U,A){1&U&&n.YNc(0,Si,1,10,"op-user-autocompleter",0),2&U&&n.Q6J("ngIf",A.url)},directives:[e.O5,pn.U],encapsulation:2,changeDetection:0});class ui extends ci{get formattedValue(){return Number(moment.duration(this.value).asDays().toFixed(0))}}ui.\u0275fac=function(){let ge;return function(A){return(ge||(ge=n.n5z(ui)))(A||ui)}}(),ui.\u0275cmp=n.Xpm({type:ui,selectors:[["ng-component"]],features:[n.qOj],decls:1,vars:2,consts:[["type","number","disabled","disabled",1,"inline-edit--field","op-input",3,"ngModel","id"]],template:function(U,A){1&U&&n._UZ(0,"input",0),2&U&&n.Q6J("ngModel",A.formattedValue)("id",A.handler.htmlId)},directives:[a.wV,a.Fj,a.JJ,a.On],encapsulation:2,changeDetection:0});var $t=t(55741);class Vn extends $t.C{}class Ai extends $t.C{get valueString(){return null==this.value?"":this.value.toLocaleString(this.I18n.locale,{useGrouping:!0,maximumFractionDigits:20})}}class qi extends $t.C{get value(){return parseInt(this.resource[this.name])}isEmpty(){return isNaN(this.value)}}class Hn extends $t.C{get value(){return this.schema?this.attribute&&this.attribute.name:null}}var xi=t(79644),Tn=t(80261);class Pn extends $t.C{render(U,A,_e={}){const we=document.createElement("div");we.classList.add("read-value--html","highlight","op-uc-container","op-uc-container_reduced-headings","-multiline"),_e.rtl&&we.classList.add("-rtl"),we.innerHTML=A,U.innerHTML="",U.appendChild(we),Tn.Z.bootstrapOptionalEmbeddable(this.appRef,we)}get placeholder(){return"description"===this.name?this.I18n.t("js.placeholders.description"):super.placeholder}get isFormattable(){return!0}get value(){if(!this.schema)return null;const U=this.resource[this.name];return U&&U.html?this.unescape(U.html):""}unescape(U){return U?class{static get UNESCAPED_EXPRESSION(){return"{{"}static get ESCAPED_EXPRESSION(){return"{{ \\$root\\.DOUBLE_LEFT_CURLY_BRACE }}"}static escape(U){return U.replace(new RegExp(this.UNESCAPED_EXPRESSION,"g"),this.ESCAPED_EXPRESSION)}static unescape(U){return U.replace(new RegExp(this.ESCAPED_EXPRESSION,"g"),this.UNESCAPED_EXPRESSION)}}.unescape(U):""}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",n.z2F)],Pn.prototype,"appRef",void 0);var zn=t(63733);class ji extends $t.C{get valueString(){return this.value?this.timezoneService.formattedDatetime(this.value):""}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],ji.prototype,"timezoneService",void 0);class Wi extends $t.C{get valueString(){return this.translatedValue()}get placeholder(){return this.translatedValue()}translatedValue(){return this.value?this.I18n.t("js.general_text_yes"):this.I18n.t("js.general_text_no")}isEmpty(){return!1}}var xn=t(39469);class un extends $t.C{constructor(){super(...arguments),this.text={none:this.I18n.t("js.filter.noneElement")}}get value(){return this.resource[this.name]}get title(){return this.isEmpty()?this.text.none:this.value.name}get wpId(){return this.isEmpty()?null:this.value.$loaded?this.value.id:this.value.href.match(/(\d+)$/)[0]}get valueString(){return`#${this.wpId} ${this.title}`}isEmpty(){return!this.value}get unknownAttribute(){return!1}}var Mi=t(70233),hi=t(97973),hn=t(46709);class Li extends $t.C{constructor(){super(...arguments),this.derivedText=this.I18n.t("js.label_value_derived_from_children")}get valueString(){return this.timezoneService.formattedDuration(this.value)}get derivedPropertyName(){return`derived${this.name.charAt(0).toUpperCase()}${this.name.slice(1)}`}get derivedValue(){return this.resource[this.derivedPropertyName]}get derivedValueString(){const U=this.derivedValue;return U?this.timezoneService.formattedDuration(U):this.placeholder}render(U,A){if(this.isEmpty())return void(U.textContent=this.placeholder);U.classList.add("split-time-field"),this.value&&this.renderActual(U,A);const _e=this.derivedValue;_e&&0!==this.timezoneService.toHours(_e)&&this.renderDerived(U,this.derivedValueString,!!this.value)}renderActual(U,A){const _e=document.createElement("span");_e.textContent=A,_e.title=this.valueString,_e.classList.add("-actual-value"),U.appendChild(_e)}renderDerived(U,A,_e){const we=document.createElement("span");we.setAttribute("title",this.texts.empty),we.textContent=`(${_e?"+":""}${A})`,we.title=`${this.derivedValueString} ${this.derivedText}`,we.classList.add("-derived-value"),_e&&we.classList.add("-with-actual-value"),U.appendChild(we)}get title(){return null}isEmpty(){const{value:U}=this,A=this.derivedValue;return!U&&!A}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],Li.prototype,"timezoneService",void 0);class Xi extends Li{constructor(){super(...arguments),this.text={linkTitle:this.I18n.t("js.work_packages.message_view_spent_time"),logTime:this.I18n.t("js.button_log_time")}}render(U,A){if(!this.value)return;const _e=document.createElement("a");if(_e.textContent=A,_e.setAttribute("title",this.text.linkTitle),A===this.placeholder?_e.setAttribute("class","time-logging--value time-logging--value_empty"):_e.setAttribute("class","time-logging--value"),this.resource.project){const we=this.resource.id.toString();this.apiV3Service.projects.id(this.resource.project).get().subscribe(Je=>{const rt=hi(this.PathHelper.projectTimeEntriesPath(Je.identifier)).search(`fields[]=WorkPackageId&operators[WorkPackageId]=%3D&values[WorkPackageId]=${we}&set_filter=1`).toString();_e.href=rt})}U.innerHTML="",U.appendChild(_e),this.appendTimelogLink(U)}appendTimelogLink(U){if(this.timeEntryCreateService&&this.resource.logTime){const A=document.createElement("a");A.setAttribute("class","icon icon-time"),A.setAttribute("href",""),A.setAttribute("title",this.text.logTime),U.appendChild(A),A.addEventListener("click",this.showTimelogWidget.bind(this,this.resource))}}showTimelogWidget(U){this.timeEntryCreateService.create(moment(new Date),U,{showWorkPackageField:!1}).catch(()=>{})}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Mi.j)],Xi.prototype,"PathHelper",void 0),(0,u.gn)([(0,P.W)(hn.f,null),(0,u.w6)("design:type",hn.f)],Xi.prototype,"timeEntryCreateService",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Te.T)],Xi.prototype,"apiV3Service",void 0);class _n extends $t.C{constructor(){super(...arguments),this.text={linkTitle:this.I18n.t("js.work_packages.message_successful_show_in_fullscreen")}}get value(){return(0,ye.Z)(this.resource)?null:this.resource[this.name]}render(U,A){!this.value||(U.textContent=A)}isEmpty(){return!1}}var En=t(50076),Ri=t(69671),Kn=t(80044);class en extends Ri.z{render(U,A){super.render(U,A),this.shouldHighlight&&this.addHighlight(U)}get value(){return this.schema?this.attribute&&this.attribute.name:null}addHighlight(U){if(this.attribute instanceof Kn.X){const A=En.Z.inlineClass(this.name,this.attribute.id);U.classList.add(A)}}}class Vi extends en{get shouldHighlight(){return!0}}var tn=t(32782);class On extends $t.C{get value(){return this.schema?this.attribute&&this.attribute.name:null}render(U,A){this.placeholder===A?this.renderEmpty(U):this.principalRenderer.render(U,this.attribute,{hide:!1,link:!1},{hide:!1,size:"medium"})}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",tn.C)],On.prototype,"principalRenderer",void 0);class Mn extends xi.L{render(U,A){const _e=this.value;U.innerHTML="",U.setAttribute("title",_e.join(", ")),0===_e.length?this.renderEmpty(U):this.renderValues(this.attribute,U)}renderValues(U,A){const _e=document.createDocumentFragment(),we=document.createElement("div");if(we.classList.add($t.x),_e.appendChild(we),this.renderAbridgedValues(we,U),U.length>2){const Je=document.createElement("span");Je.innerHTML="... ",we.appendChild(Je);const rt=this.optionDiv(U.length.toString(),"badge","-secondary");_e.appendChild(rt)}A.appendChild(_e)}renderAbridgedValues(U,A){const _e=_.take(A,2);this.principalRenderer.renderMultiple(U,_e,{hide:!1,link:!1},{hide:!1,size:"medium"},!1)}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",tn.C)],Mn.prototype,"principalRenderer",void 0);var Ti=t(84109),We=t(20506);class W extends _n{constructor(){super(...arguments),this.uiStateBuilder=new We.mE(this.$state,this.keepTab)}render(U,A){if(!this.value)return;const _e=this.uiStateBuilder.linkToShow(this.value,A,this.value);U.appendChild(_e)}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",O.StateService)],W.prototype,"$state",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ti.p)],W.prototype,"keepTab",void 0);class q extends $t.C{render(U,A){const _e=this.value&&this.value.id,we=document.createElement("span");we.classList.add("project-status--bulb",(0,Qe.p)(_e));const Je=document.createElement("span");if(Je.classList.add("project-status--name",(0,Qe.p)(_e)),Je.textContent=(0,Qe.v)(_e,this.I18n),U.innerHTML="",U.appendChild(we),U.appendChild(Je),this.writable){const rt=document.createElement("span");rt.classList.add("project-status--pulldown-icon","icon","icon-pulldown"),U.appendChild(rt)}}}class le extends $t.C{get value(){if(!this.schema)return null;const U=this.resource[this.name];return U&&U.raw||""}}class be extends un{constructor(){super(...arguments),this.text={linkTitle:this.I18n.t("js.work_packages.message_successful_show_in_fullscreen"),none:this.I18n.t("js.filter.noneElement")},this.uiStateBuilder=new We.mE(this.$state,this.keepTab)}render(U,A){if(this.isEmpty())return void(U.innerText=this.placeholder);const _e=this.uiStateBuilder.linkToShow(this.wpId,this.text.linkTitle,this.valueString),we=document.createElement("span");we.textContent=` ${_.truncate(this.title,{length:40})}`,U.innerHTML="",U.appendChild(_e),U.appendChild(we)}get writable(){return!1}get valueString(){return`#${this.wpId}`}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",O.StateService)],be.prototype,"$state",void 0),(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Ti.p)],be.prototype,"keepTab",void 0);var Re=t(74215);class Be extends $t.C{get valueString(){return this.timezoneService.formattedDuration(this.value,"days")}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],Be.prototype,"timezoneService",void 0);class $e extends $t.C{get valueString(){return this.timezoneService.formattedDuration(this.value,"hour")}}(0,u.gn)([(0,P.W)(),(0,u.w6)("design:type",Se.B)],$e.prototype,"timezoneService",void 0);var _t=t(74990);class qe{}qe.\u0275fac=function(U){return new(U||qe)},qe.\u0275mod=n.oAB({type:qe}),qe.\u0275inj=n.cJS({imports:[[e.ez]]});class pt{}pt.\u0275fac=function(U){return new(U||pt)},pt.\u0275mod=n.oAB({type:pt}),pt.\u0275inj=n.cJS({imports:[[e.ez,a.u5]]});var Bt=t(63415);class Ft{}Ft.\u0275fac=function(U){return new(U||Ft)},Ft.\u0275mod=n.oAB({type:Ft}),Ft.\u0275inj=n.cJS({imports:[[e.ez,a.u5,Bt.J]]});var Ct=t(81496);class xt{}xt.\u0275fac=function(U){return new(U||xt)},xt.\u0275mod=n.oAB({type:xt}),xt.\u0275inj=n.cJS({imports:[[e.ez,Ct.I]]});class oi{}oi.\u0275fac=function(U){return new(U||oi)},oi.\u0275mod=n.oAB({type:oi}),oi.\u0275inj=n.cJS({imports:[[e.ez,j.wA]]});var nn=t(76315),Gn=t(45755);class Fi{}Fi.\u0275fac=function(U){return new(U||Fi)},Fi.\u0275mod=n.oAB({type:Fi}),Fi.\u0275inj=n.cJS({providers:[{provide:n.ip1,useFactory:function(ge,U){return()=>{ge.defaultFieldType="text",ge.addFieldType(v,"text",["String"]).addFieldType(C,"integer",["Integer"]).addFieldType(li,"estimatedTime",["estimatedTime"]).addFieldType(fi,"project",["Project"]).addFieldType(vi,"user",["User"]).addFieldType(J,"select",["Priority","Status","Type","Version","TimeEntriesActivity","Category","CustomOption"]).addFieldType(H,"multi-select",["[]CustomOption","[]User"]).addFieldType(ee,"float",["Float"]).addFieldType(V,"workPackage",["WorkPackage"]).addFieldType(ce,"boolean",["Boolean"]).addFieldType(st,"date",["Date"]).addFieldType(De,"wiki-textarea",["Formattable"]).addFieldType(Di,"_comment",["comment"]),ge.addSpecificFieldType("WorkPackage",pi,"date",["combinedDate","startDate","dueDate","date"]).addSpecificFieldType("WorkPackage",ui,"duration",["duration"]).addSpecificFieldType("Project",mt,"status",["status"]).addSpecificFieldType("TimeEntry",Ue,"comment",["comment"]).addSpecificFieldType("TimeEntry",It,"workPackage",["WorkPackage"]).addSpecificFieldType("TimeEntry",li,"hours",["hours"]).addSpecificFieldType("WorkPackage",li,"remainingTime",["remainingTime"]),U.register(wi.y,"Version"),U.register(gi.e,"WorkPackage")}},deps:[r.h,k],multi:!0},{provide:n.ip1,useFactory:function(ge){return()=>{ge.defaultFieldType="text",ge.addFieldType(Vn,"text",["String"]).addFieldType(Ai,"float",["Float"]).addFieldType(qi,"integer",["Integer"]).addFieldType(en,"highlight",["Status","Priority"]).addFieldType(Vi,"type",["Type"]).addFieldType(Hn,"resource",["Project","TimeEntriesActivity","Version","Category","CustomOption"]).addFieldType(xi.L,"resources",["[]CustomOption"]).addFieldType(Mn,"users",["[]User"]).addFieldType(Pn,"formattable",["Formattable"]).addFieldType(Be,"duration",["duration"]).addFieldType($e,"remainingTime",["remainingTime"]).addFieldType(Li,"estimatedTime",["estimatedTime"]).addFieldType(zn.C,"date",["Date"]).addFieldType(ji,"datetime",["DateTime"]).addFieldType(Wi,"boolean",["Boolean"]).addFieldType(xn.N,"progress",["percentageDone"]).addFieldType(be,"work_package",["WorkPackage"]).addFieldType(_n,"id",["id"]).addFieldType(On,"user",["User"]),ge.addSpecificFieldType("WorkPackage",W,"id",["id"]).addSpecificFieldType("WorkPackage",Xi,"spentTime",["spentTime"]).addSpecificFieldType("WorkPackage",Re.Z,"combinedDate",["combinedDate"]).addSpecificFieldType("TimeEntry",le,"comment",["comment"]).addSpecificFieldType("Project",q,"status",["status"]).addSpecificFieldType("TimeEntry",un,"work_package",["workPackage"])}},deps:[d.i],multi:!0}],imports:[[e.ez,i.H,c.Z,h.$,p.K,_t.C,l.a,qe,pt,Ft,xt,oi,nn.s,Gn.i]]})},6536:(te,M,t)=>{"use strict";t.d(M,{g:()=>e});const n={"application/pdf":{icon:"export-pdf-descr",clazz:"pdf"},"image/jpeg":{icon:"image1",clazz:"img"},"image/png":{icon:"image1",clazz:"img"},"image/gif":{icon:"image1",clazz:"img"},"image/svg+xml":{icon:"image1",clazz:"img"},"image/tiff":{icon:"image1",clazz:"img"},"image/bmp":{icon:"image1",clazz:"img"},"image/webp":{icon:"image1",clazz:"img"},"image/heic":{icon:"image1",clazz:"img"},"image/heif":{icon:"image1",clazz:"img"},"image/avif":{icon:"image1",clazz:"img"},"image/cgm":{icon:"image1",clazz:"img"},"text/plain":{icon:"file-text",clazz:"txt"},"text/markdown":{icon:"file-text",clazz:"txt"},"text/html":{icon:"file-text",clazz:"txt"},"application/rtf":{icon:"file-text",clazz:"txt"},"application/xml":{icon:"file-text",clazz:"txt"},"application/xhtml+xml":{icon:"file-text",clazz:"txt"},"application/x-tex":{icon:"file-text",clazz:"txt"},"application/vnd.oasis.opendocument.text":{icon:"file-doc",clazz:"doc"},"application/vnd.oasis.opendocument.text-template":{icon:"file-doc",clazz:"doc"},"application/msword":{icon:"file-doc",clazz:"doc"},"application/vnd.apple.pages":{icon:"file-doc",clazz:"doc"},"application/vnd.stardivision.writer":{icon:"file-doc",clazz:"doc"},"application/x-abiword":{icon:"file-doc",clazz:"doc"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{icon:"file-doc",clazz:"doc"},"font/otf":{icon:"file-doc",clazz:"doc"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{icon:"file-sheet",clazz:"sheet"},"application/vnd.oasis.opendocument.spreadsheet":{icon:"file-sheet",clazz:"sheet"},"application/vnd.oasis.opendocument.spreadsheet-template":{icon:"file-sheet",clazz:"sheet"},"application/vnd.ms-excel":{icon:"file-sheet",clazz:"sheet"},"application/vnd.stardivision.calc":{icon:"file-sheet",clazz:"sheet"},"application/vnd.apple.numbers":{icon:"file-sheet",clazz:"sheet"},"application/x-starcalc":{icon:"file-sheet",clazz:"sheet"},"application/x-quattro-pro":{icon:"file-sheet",clazz:"sheet"},"application/csv":{icon:"file-sheet",clazz:"sheet"},"application/vnd.oasis.opendocument.presentation":{icon:"file-presentation",clazz:"presentation"},"application/vnd.oasis.opendocument.presentation-template":{icon:"file-presentation",clazz:"presentation"},"application/vnd.apple.keynote":{icon:"file-presentation",clazz:"presentation"},"application/vnd.ms-powerpoint":{icon:"file-presentation",clazz:"presentation"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{icon:"file-presentation",clazz:"presentation"},"application/vnd.stardivision.impress":{icon:"file-presentation",clazz:"presentation"},"application/mathematica":{icon:"file-presentation",clazz:"presentation"},"video/mp4":{icon:"movie",clazz:"mov"},"video/x-m4v":{icon:"movie",clazz:"mov"},"video/avi":{icon:"movie",clazz:"mov"},"video/quicktime":{icon:"movie",clazz:"mov"},"video/webm":{icon:"movie",clazz:"mov"},"video/mpg":{icon:"movie",clazz:"mov"},"video/x-matroska":{icon:"movie",clazz:"mov"},"video/mp1s":{icon:"movie",clazz:"mov"},"video/mp2p":{icon:"movie",clazz:"mov"},"video/3gpp":{icon:"movie",clazz:"mov"},"video/3gpp-tt":{icon:"movie",clazz:"mov"},"video/3gpp-2":{icon:"movie",clazz:"mov"},"application/x-op-directory":{icon:"folder",clazz:"dir"},default:{icon:"ticket",clazz:"default"}};function e(p){return p&&n[p]?n[p]:n.default}},49369:(te,M,t)=>{"use strict";t.d(M,{_:()=>l});var n=t(2316),p=(t(75421),t(96617)),h=t(94232);class c extends h.W{}var i=t(26942);class l extends i.N{constructor(d,f){super(),this.i18n=d,this.injector=f,this.resourceChanged=new n.vpe}get widgetName(){var d,f;const a=null===(d=this.resource)||void 0===d?void 0:d.options.name,m=null===(f=this.resource)||void 0===f?void 0:f.identifier;return this.isEditable?a:this.i18n.t(`js.grid.widgets.${m}.title`,{defaultValue:a})}renameWidget(d){const f=this.setChangesetOptions({name:d});this.resourceChanged.emit(f)}get isEditable(){return!0}setChangesetOptions(d){const f=new c(this.resource);return f.setValue("options",Object.assign(Object.assign({},this.resource.options),d)),f}}l.\u0275fac=function(d){return new(d||l)(n.Y36(p.D),n.Y36(n.zs3))},l.\u0275dir=n.lG2({type:l,hostVars:8,hostBindings:function(d,f){2&d&&n.Udp("grid-column-start",f.gridColumnStart)("grid-column-end",f.gridColumnEnd)("grid-row-start",f.gridRowStart)("grid-row-end",f.gridRowEnd)},inputs:{resource:"resource"},outputs:{resourceChanged:"resourceChanged"},features:[n.qOj]})},2775:(te,M,t)=>{"use strict";t.d(M,{o:()=>h});var n=t(2316),e=t(54364);function p(c,i){if(1&c&&n._UZ(0,"span",2),2&c){const l=n.oxw();n.Q6J("textContent",l.iconTitle)}}class h{constructor(){this.iconTitle=""}}h.\u0275fac=function(i){return new(i||h)},h.\u0275cmp=n.Xpm({type:h,selectors:[["op-icon"]],hostAttrs:[1,"op-icon--wrapper"],inputs:{iconClasses:["icon-classes","iconClasses"],iconTitle:["icon-title","iconTitle"]},decls:2,vars:3,consts:[["aria-hidden","true",3,"ngClass"],["class","hidden-for-sighted",3,"textContent",4,"ngIf"],[1,"hidden-for-sighted",3,"textContent"]],template:function(i,l){1&i&&(n._UZ(0,"i",0),n.YNc(1,p,1,1,"span",1)),2&i&&(n.Q6J("ngClass",l.iconClasses),n.uIk("title",l.iconTitle||void 0),n.xp6(1),n.Q6J("ngIf",l.iconTitle))},directives:[e.mk,e.O5],encapsulation:2})},53875:(te,M,t)=>{"use strict";t.d(M,{Q:()=>p});var n=t(54364),e=t(2316);class p{}p.\u0275fac=function(c){return new(c||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({providers:[],imports:[[n.ez]]})},55280:(te,M,t)=>{"use strict";t.d(M,{v:()=>i});var n=t(54364),e=t(77355),p=t(58057),h=t(2316);class i{constructor(r,d,f){this.documentElement=r,this.injector=d,this.opModalService=f}setupListener(){const r=this.documentElement.querySelectorAll("[data-augmented-model-wrapper]");for(let d=0;d<r.length;++d)this.wrapElement(jQuery(r[d]))}wrapElement(r){const d=r.data("activationSelector")||".modal-delivery-element--activation-link",f=jQuery(d);r.data("modalInitializeNow")?this.show(r):f.click(m=>{this.show(r),m.preventDefault()})}show(r){const d=r.data("modalClassName"),f=r.data("modalIframeUrl"),a=r.find(".modal-delivery-element");let m=a.html();f&&(m=this.appendIframe(a,f)),this.opModalService.show(p.T,this.injector,{modalBody:m,modalClassName:d})}appendIframe(r,d){const f=jQuery('<iframe frameborder="0" height="350" allowfullscreen>></iframe>');f.attr("src",d);const a=r.find(".iframe-target-wrapper");return a.find("iframe").length>0||a.append(f),r.html()}}i.\u0275fac=function(r){return new(r||i)(h.LFG(n.K0),h.LFG(h.zs3),h.LFG(e.S))},i.\u0275prov=h.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})},60312:(te,M,t)=>{"use strict";t.d(M,{T:()=>p});var n=t(2316),e=t(26942);class p extends e.N{constructor(c,i,l){super(),this.locals=c,this.cdRef=i,this.elementRef=l,this.service=this.locals.service,this.closingEvent=new n.vpe,this.openingEvent=new n.vpe}ngOnInit(){this.$element=this.elementRef.nativeElement}ngOnDestroy(){this.closingEvent.complete(),this.openingEvent.complete()}onClose(){return this.afterFocusOn&&this.afterFocusOn.focus(),!0}closeMe(c){this.service.close(),c&&(c.stopPropagation(),c.preventDefault())}onOpen(){this.openingEvent.emit(),this.cdRef.detectChanges()}get afterFocusOn(){return this.$element}}p.\u0275fac=function(c){n.$Z()},p.\u0275dir=n.lG2({type:p,features:[n.qOj]})},55811:(te,M,t)=>{"use strict";t.d(M,{K:()=>r});var n=t(54364),e=t(40912),p=t(55901),h=t(63415),c=t(53875),i=t(55280),l=t(2316);class r{}r.\u0275fac=function(f){return new(f||r)},r.\u0275mod=l.oAB({type:r}),r.\u0275inj=l.cJS({providers:[i.v],imports:[[n.ez,h.J,c.Q,e.eL,p.rt]]})},77355:(te,M,t)=>{"use strict";t.d(M,{E:()=>i,S:()=>l});var n=t(2316),e=t(40912),p=t(84224),h=t(9170),c=t(53466);const i=new n.OlP("OP_MODAL_LOCALS");class l{constructor(d){this.injector=d,this.activeModalInstance$=new p.t(1),this.activeModalData$=new p.t(1),window.addEventListener("keydown",f=>{"Escape"!==f.key||f.defaultPrevented||this.close()})}show(d,f,a={},m=!1){return this.close(),"global"===f&&(f=this.injector),this.activeModalData$.next({modal:d,injector:this.injectorFor(f,a),notFullscreen:m}),this.activeModalInstance$.pipe((0,h.h)(v=>null!==v),(0,c.q)(1))}close(){this.activeModalData$.next(null)}injectorFor(d,f){const a=new WeakMap;return f.service=this,a.set(i,f),new e.nK(d,a)}}l.\u0275fac=function(d){return new(d||l)(n.LFG(n.zs3))},l.\u0275prov=n.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})},298:(te,M,t)=>{"use strict";t.d(M,{j:()=>a});var n=t(60312),e=t(77355),p=t(96617),h=t(2316),c=t(55901),i=t(54364);function l(m,v){1&m&&h._UZ(0,"div",11)}function r(m,v){if(1&m&&(h.TgZ(0,"span",12),h._UZ(1,"br"),h.TgZ(2,"strong"),h._uU(3),h.qZA(),h.qZA()),2&m){const C=v.$implicit;h.xp6(3),h.Oqu(C)}}function d(m,v){if(1&m&&h._UZ(0,"span"),2&m){const C=v.ngIf;h.Gre("spot-icon spot-icon_",C,"")}}function f(m,v){if(1&m&&h._UZ(0,"span"),2&m){const C=v.ngIf;h.Gre("spot-icon spot-icon_",C,"")}}class a extends n.T{constructor(v,C,u,k){super(C,u,v),this.elementRef=v,this.locals=C,this.cdRef=u,this.I18n=k,this.confirmed=!1,this.text={title:this.I18n.t("js.modals.form_submit.title"),text:this.I18n.t("js.modals.form_submit.text"),button_continue:this.I18n.t("js.button_continue"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.icon={continue:void 0,cancel:void 0},this.options=C.options||{},this.dangerHighlighting=_.defaultTo(this.options.dangerHighlighting,!1),this.passedData=_.defaultTo(this.options.passedData,[]),this.showClose=_.defaultTo(this.options.showClose,!0),this.divideContent=_.defaultTo(this.options.divideContent,!1),this.text=_.defaults(this.options.text,this.text),this.icon=_.defaults(this.options.icon,this.icon)}confirmAndClose(v){this.confirmed=!0,this.closeMe(v)}}a.\u0275fac=function(v){return new(v||a)(h.Y36(h.SBq),h.Y36(e.E),h.Y36(h.sBO),h.Y36(p.D))},a.\u0275cmp=h.Xpm({type:a,selectors:[["ng-component"]],features:[h.qOj],decls:17,vars:10,consts:[["data-indicator-name","modal","tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal","op-confirm-dialog","loading-indicator--location",3,"cdkTrapFocusAutoCapture"],[1,"spot-modal--header"],["class","spot-divider",4,"ngIf"],[1,"spot-modal--body","spot-container"],[1,"op-confirm-dialog--text","spot-body-small",3,"textContent"],["class","spot-body-small",4,"ngFor","ngForOf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button","data-qa-selector","confirmation-modal--cancel",1,"button","spot-modal--cancel-button","spot-action-bar--action",3,"click"],[3,"class",4,"ngIf"],["type","button","data-qa-selector","confirmation-modal--confirmed",1,"button","spot-action-bar--action",3,"ngClass","click"],[1,"spot-divider"],[1,"spot-body-small"]],template:function(v,C){1&v&&(h.TgZ(0,"div",0),h.TgZ(1,"div",1),h._uU(2),h.qZA(),h.YNc(3,l,1,0,"div",2),h.TgZ(4,"div",3),h._UZ(5,"span",4),h.YNc(6,r,4,1,"span",5),h.qZA(),h.TgZ(7,"div",6),h.TgZ(8,"div",7),h.TgZ(9,"button",8),h.NdJ("click",function(k){return C.closeMe(k)}),h.YNc(10,d,1,3,"span",9),h.TgZ(11,"span"),h._uU(12),h.qZA(),h.qZA(),h.TgZ(13,"button",10),h.NdJ("click",function(k){return C.confirmAndClose(k)}),h.YNc(14,f,1,3,"span",9),h.TgZ(15,"span"),h._uU(16),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&v&&(h.Q6J("cdkTrapFocusAutoCapture",!0),h.xp6(2),h.Oqu(C.text.title),h.xp6(1),h.Q6J("ngIf",C.divideContent),h.xp6(2),h.Q6J("textContent",C.text.text),h.xp6(1),h.Q6J("ngForOf",C.passedData),h.xp6(4),h.Q6J("ngIf",C.icon.cancel),h.xp6(2),h.Oqu(C.text.button_cancel),h.xp6(1),h.Q6J("ngClass",C.dangerHighlighting?"-danger":"-highlight"),h.xp6(1),h.Q6J("ngIf",C.icon.continue),h.xp6(2),h.Oqu(C.text.button_continue))},directives:[c.mK,i.O5,i.sg,i.mk],styles:[".op-confirm-dialog--text[_ngcontent-%COMP%]{white-space:pre-wrap}"],changeDetection:0})},84335:(te,M,t)=>{"use strict";t.d(M,{D:()=>h});var n=t(298),e=t(77355),p=t(2316);class h{constructor(i,l){this.opModalService=i,this.injector=l,document.addEventListener("submit",r=>{const d=r.target,f=d.dataset.augmentedConfirmDialog;return!f||(this.augmentFormSubmit(d,JSON.parse(f)),r.preventDefault(),!1)})}confirm(i){return new Promise((l,r)=>{this.opModalService.show(n.j,this.injector,{options:i}).subscribe(d=>d.closingEvent.subscribe(()=>{d.confirmed?l():r()}))})}augmentFormSubmit(i,l){this.confirm(l).then(()=>{i.removeAttribute("data-augmented-confirm-dialog"),i.submit()}).catch(()=>{})}}h.\u0275fac=function(i){return new(i||h)(p.LFG(e.S),p.LFG(p.zs3))},h.\u0275prov=p.Yz7({token:h,factory:h.\u0275fac})},82170:(te,M,t)=>{"use strict";t.d(M,{f:()=>b});var n=t(77355),e=t(60312),p=t(96617),h=t(65146),c=t(33276),i=t(2316),l=t(1707),r=t(54364);const d=["typeSelect"];function f(y,P){if(1&y&&i._UZ(0,"option",12),2&y){const E=P.$implicit,T=i.oxw();i.Q6J("textContent",E.name)("selected",T.selectedType===E.name)("value",E.name)}}class a extends e.T{constructor(P,E,T,O,I,Z){super(E,I,P),this.elementRef=P,this.locals=E,this.currentProject=T,this.apiV3Service=O,this.cdRef=I,this.I18n=Z,this.changed=!1,this.showClose=!0,this.type="",this.classes="",this.text={title:this.I18n.t("js.editor.macro.work_package_button.button"),none:this.I18n.t("js.label_none"),selected_type:this.I18n.t("js.editor.macro.work_package_button.type"),button_style:this.I18n.t("js.editor.macro.work_package_button.button_style"),button_style_hint:this.I18n.t("js.editor.macro.work_package_button.button_style_hint"),button_save:this.I18n.t("js.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.selectedType=this.type=this.locals.type,this.classes=this.locals.classes,this.buttonStyle="button"===this.classes,this.apiV3Service.withOptionalProject(this.currentProject.identifier).work_packages.form.post({}).subscribe(j=>{this.availableTypes=j.schema.type.allowedValues,this.cdRef.detectChanges()})}applyAndClose(P){this.changed=!0,this.classes=this.buttonStyle?"button":"",this.type=this.selectedType,this.closeMe(P)}ngAfterViewInit(){this.typeSelect.nativeElement.focus()}}a.\u0275fac=function(P){return new(P||a)(i.Y36(i.SBq),i.Y36(n.E),i.Y36(h.R),i.Y36(c.T),i.Y36(i.sBO),i.Y36(p.D))},a.\u0275cmp=i.Xpm({type:a,selectors:[["ng-component"]],viewQuery:function(P,E){if(1&P&&i.Gf(d,7),2&P){let T;i.iGM(T=i.CRH())&&(E.typeSelect=T.first)}},features:[i.qOj],decls:26,vars:11,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_autoheight","loading-indicator--location",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container","form"],[1,"form--fieldset"],[3,"textContent"],[1,"form--field"],["for","selected-type",1,"form--label","hidden-for-sighted",3,"textContent"],[1,"form--field-container"],[1,"form--select-container"],["id","selected-type","tabindex","1","name","selected-type",1,"form--select",3,"change"],["typeSelect",""],[3,"textContent","selected","value"],[3,"textContent","selected","value",4,"ngFor","ngForOf"],[1,"form--field","-wide-label"],[1,"form--field-container","-vertical"],[1,"form--label-with-check-box"],[1,"form--check-box-container"],["type","checkbox","tabindex","2","id","wp_button_macro_style","name","button_style",3,"checked","change"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["tabindex","4","type","button",1,"spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["tabindex","3",1,"spot-modal--submit-button","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(P,E){1&P&&(i.TgZ(0,"form",0),i.NdJ("submit",function(O){return E.applyAndClose(O)}),i.TgZ(1,"div",1),i._uU(2),i.qZA(),i._UZ(3,"div",2),i.TgZ(4,"div",3),i.TgZ(5,"fieldset",4),i._UZ(6,"legend",5),i.TgZ(7,"div",6),i._UZ(8,"label",7),i.TgZ(9,"div",8),i.TgZ(10,"div",9),i.TgZ(11,"select",10,11),i.NdJ("change",function(O){return E.selectedType=O.target.value}),i._UZ(13,"option",12),i.YNc(14,f,1,3,"option",13),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.TgZ(15,"div",14),i.TgZ(16,"div",15),i.TgZ(17,"label",16),i.TgZ(18,"div",17),i.TgZ(19,"input",18),i.NdJ("change",function(O){return E.buttonStyle=O.target.checked}),i.qZA(),i.qZA(),i._uU(20),i.qZA(),i.qZA(),i.qZA(),i._UZ(21,"p",5),i.qZA(),i.TgZ(22,"div",19),i.TgZ(23,"div",20),i.TgZ(24,"button",21),i.NdJ("click",function(O){return E.closeMe(O)}),i.qZA(),i._UZ(25,"button",22),i.qZA(),i.qZA(),i.qZA()),2&P&&(i.xp6(2),i.Oqu(E.text.title),i.xp6(4),i.Q6J("textContent",E.text.selected_type),i.xp6(2),i.Q6J("textContent",E.text.selected_type),i.xp6(5),i.Q6J("textContent",E.text.none)("selected",!E.selectedType),i.xp6(1),i.Q6J("ngForOf",E.availableTypes),i.xp6(5),i.Q6J("checked",E.buttonStyle),i.xp6(1),i.hij(" ",E.text.button_style," "),i.xp6(1),i.Q6J("textContent",E.text.button_style_hint),i.xp6(3),i.Q6J("textContent",E.text.button_cancel),i.xp6(1),i.Q6J("textContent",E.text.button_save))},directives:[l._Y,l.JL,l.F,l.YN,l.Kr,r.sg],encapsulation:2,changeDetection:0});const m=["selectedPageInput"];class v extends e.T{constructor(P,E,T,O){super(E,T,P),this.elementRef=P,this.locals=E,this.cdRef=T,this.I18n=O,this.changed=!1,this.showClose=!0,this.page="",this.text={title:this.I18n.t("js.editor.macro.wiki_page_include.button"),hint:this.I18n.t("js.editor.macro.wiki_page_include.hint"),page:this.I18n.t("js.editor.macro.wiki_page_include.page"),button_save:this.I18n.t("js.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.selectedPage=this.page=this.locals.page}applyAndClose(P){this.changed=!0,this.page=this.selectedPage,this.closeMe(P)}ngAfterViewInit(){this.selectedPageInput.nativeElement.focus()}}v.\u0275fac=function(P){return new(P||v)(i.Y36(i.SBq),i.Y36(n.E),i.Y36(i.sBO),i.Y36(p.D))},v.\u0275cmp=i.Xpm({type:v,selectors:[["ng-component"]],viewQuery:function(P,E){if(1&P&&i.Gf(m,7),2&P){let T;i.iGM(T=i.CRH())&&(E.selectedPageInput=T.first)}},features:[i.qOj],decls:21,vars:9,consts:[[1,"spot-modal",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[1,"form--fieldset"],[3,"textContent"],[1,"form--field"],["for","selected-page",1,"form--label","hidden-for-sighted",3,"textContent"],[1,"form--field-container"],[1,"form--select-container"],["tabindex","2","type","text","id","selected-page","name","selected-page",1,"form--select",3,"value","change"],["selectedPageInput",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["tabindex","4",1,"spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["tabindex","3",1,"spot-modal--submit-button","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"]],template:function(P,E){1&P&&(i.TgZ(0,"form",0),i.NdJ("submit",function(O){return E.applyAndClose(O)}),i.TgZ(1,"div",1),i._uU(2),i.qZA(),i._UZ(3,"div",2),i.TgZ(4,"div",3),i.TgZ(5,"fieldset",4),i._UZ(6,"legend",5),i.TgZ(7,"div",6),i._UZ(8,"label",7),i.TgZ(9,"div",8),i.TgZ(10,"div",9),i.TgZ(11,"input",10,11),i.NdJ("change",function(O){return E.selectedPage=O.target.value}),i.qZA(),i.qZA(),i.qZA(),i._UZ(13,"p",5),i.TgZ(14,"p"),i.TgZ(15,"kbd"),i._uU(16,"project-identifier:my-wiki-page"),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.TgZ(17,"div",12),i.TgZ(18,"div",13),i.TgZ(19,"button",14),i.NdJ("click",function(O){return E.closeMe(O)}),i.qZA(),i.TgZ(20,"button",15),i.NdJ("click",function(O){return E.applyAndClose(O)}),i.qZA(),i.qZA(),i.qZA(),i.qZA()),2&P&&(i.xp6(2),i.Oqu(E.text.title),i.xp6(4),i.Q6J("textContent",E.text.page),i.xp6(2),i.Q6J("textContent",E.text.page),i.xp6(3),i.Q6J("value",E.selectedPage),i.xp6(2),i.Q6J("textContent",E.text.hint),i.xp6(6),i.Q6J("textContent",E.text.button_cancel),i.uIk("title",E.text.button_cancel),i.xp6(1),i.Q6J("textContent",E.text.button_save),i.uIk("title",E.text.button_save))},directives:[l._Y,l.JL,l.F],encapsulation:2});const C=["codeMirrorPane"];class u extends e.T{constructor(P,E,T,O){super(E,T,P),this.elementRef=P,this.locals=E,this.cdRef=T,this.I18n=O,this.changed=!1,this.showClose=!0,this._language="",this.debouncedLanguageLoader=_.debounce(()=>this.loadLanguageAsMode(this.language),300),this.text={title:this.I18n.t("js.editor.macro.code_block.title"),language:this.I18n.t("js.editor.macro.code_block.language"),language_hint:this.I18n.t("js.editor.macro.code_block.language_hint"),button_save:this.I18n.t("js.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.languageClass=E.languageClass||"language-text",this.content=E.content;const I=/language-(\w+)/.exec(this.languageClass);this.language=I?I[1]:"text"}applyAndClose(P){this.content=this.codeMirrorInstance.getValue();const E=this.language||"text";this.languageClass=`language-${E}`,this.changed=!0,this.closeMe(P)}ngAfterViewInit(){t.e("default-node_modules_codemirror_lib_codemirror_js").then(t.t.bind(t,21302,23)).then(P=>{const E=P.default;this.codeMirrorInstance=E.fromTextArea(this.codeMirrorPane.nativeElement,{lineNumbers:!0,smartIndent:!0,autofocus:!0,value:this.content,mode:""})})}get language(){return this._language}set language(P){this._language=P,this.debouncedLanguageLoader()}loadLanguageAsMode(P){if(!P||"text"===P)return this.updateCodeMirrorMode("");t(30341)(`./${P}/${P}.js`).then(()=>{this.updateCodeMirrorMode(P)}).catch(E=>{console.error(`Failed to load language ${P}: ${E}`),this.updateCodeMirrorMode("")})}updateCodeMirrorMode(P){const E=this.codeMirrorInstance;E&&E.setOption("mode",P)}updateLanguage(P){P?/^\w+$/.exec(P)?this.language=P:console.error(`Not updating non-matching language: ${P}`):this.language=""}}u.\u0275fac=function(P){return new(P||u)(i.Y36(i.SBq),i.Y36(n.E),i.Y36(i.sBO),i.Y36(p.D))},u.\u0275cmp=i.Xpm({type:u,selectors:[["ng-component"]],viewQuery:function(P,E){if(1&P&&i.Gf(C,7),2&P){let T;i.iGM(T=i.CRH())&&(E.codeMirrorPane=T.first)}},features:[i.qOj],decls:19,vars:7,consts:[[1,"spot-modal",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["name","codemirror-element","id","codemirror-element",3,"ngModel"],["codeMirrorPane",""],[1,"form--field"],["for","selected-language",1,"form--label","hidden-for-sighted",3,"textContent"],[1,"form--field-container"],[1,"form--select-container"],["tabindex","2","type","text","id","selected-language","name","selected-language",1,"form--select",3,"ngModel","ngModelChange"],["selectedLanguage",""],[3,"textContent"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["tabindex","4","type","button",1,"spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["tabindex","3",1,"spot-modal--submit-button","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(P,E){1&P&&(i.TgZ(0,"form",0),i.NdJ("submit",function(O){return E.applyAndClose(O)}),i.TgZ(1,"div",1),i._uU(2),i.qZA(),i._UZ(3,"div",2),i.TgZ(4,"div",3),i._UZ(5,"textarea",4,5),i._UZ(7,"hr"),i.TgZ(8,"div",6),i._UZ(9,"label",7),i.TgZ(10,"div",8),i.TgZ(11,"div",9),i.TgZ(12,"input",10,11),i.NdJ("ngModelChange",function(O){return E.updateLanguage(O)}),i.qZA(),i.qZA(),i.qZA(),i._UZ(14,"p",12),i.qZA(),i.qZA(),i.TgZ(15,"div",13),i.TgZ(16,"div",14),i.TgZ(17,"button",15),i.NdJ("click",function(O){return E.closeMe(O)}),i.qZA(),i._UZ(18,"button",16),i.qZA(),i.qZA(),i.qZA()),2&P&&(i.xp6(2),i.Oqu(E.text.title),i.xp6(3),i.Q6J("ngModel",E.content),i.xp6(4),i.Q6J("textContent",E.text.language),i.xp6(3),i.Q6J("ngModel",E.language),i.xp6(2),i.Q6J("textContent",E.text.language_hint),i.xp6(3),i.Q6J("textContent",E.text.button_cancel),i.xp6(1),i.Q6J("textContent",E.text.button_save))},directives:[l._Y,l.JL,l.F,l.Fj,l.JJ,l.On],encapsulation:2});const k=["selectedPageInput"];class x extends e.T{constructor(P,E,T,O){super(E,T,P),this.elementRef=P,this.locals=E,this.cdRef=T,this.I18n=O,this.changed=!1,this.showClose=!0,this.page="",this.includeParent=!1,this.text={title:this.I18n.t("js.editor.macro.child_pages.button"),hint:this.I18n.t("js.editor.macro.child_pages.hint"),page:this.I18n.t("js.editor.macro.child_pages.page"),include_parent:this.I18n.t("js.editor.macro.child_pages.include_parent"),button_save:this.I18n.t("js.button_save"),button_cancel:this.I18n.t("js.button_cancel"),close_popup:this.I18n.t("js.close_popup_title")},this.selectedPage=this.page=this.locals.page,this.selectedIncludeParent=this.includeParent=this.locals.includeParent}applyAndClose(P){this.changed=!0,this.page=this.selectedPage,this.includeParent=this.selectedIncludeParent,this.closeMe(P)}ngAfterViewInit(){this.selectedPageInput.nativeElement.focus()}updateIncludeParent(P){this.selectedIncludeParent=P}}x.\u0275fac=function(P){return new(P||x)(i.Y36(i.SBq),i.Y36(n.E),i.Y36(i.sBO),i.Y36(p.D))},x.\u0275cmp=i.Xpm({type:x,selectors:[["ng-component"]],viewQuery:function(P,E){if(1&P&&i.Gf(k,7),2&P){let T;i.iGM(T=i.CRH())&&(E.selectedPageInput=T.first)}},features:[i.qOj],decls:25,vars:9,consts:[[1,"spot-modal",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container","form"],[1,"form--fieldset"],[3,"textContent"],[1,"form--field"],["for","selected-page",1,"form--label","hidden-for-sighted",3,"textContent"],[1,"form--field-container"],[1,"form--select-container"],["tabindex","2","type","text","id","selected-page","name","selected-page","placeholder","my-project:my-page",1,"form--select",3,"value","change"],["selectedPageInput",""],[1,"form--label-with-check-box"],[1,"form--check-box-container"],["tabindex","3","type","checkbox","id","include-parent","name","include-parent",1,"form--check-box",3,"ngModel","ngModelChange"],["parentIncludedInput",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button","tabindex","4",1,"spot-modal--cancel-button","button","button_no-margin","spot-action-bar--action",3,"textContent","click"],["tabindex","3",1,"spot-modal--submit-button","button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent"]],template:function(P,E){1&P&&(i.TgZ(0,"form",0),i.NdJ("submit",function(O){return E.applyAndClose(O)}),i.TgZ(1,"div",1),i._uU(2),i.qZA(),i._UZ(3,"div",2),i.TgZ(4,"div",3),i.TgZ(5,"fieldset",4),i._UZ(6,"legend",5),i.TgZ(7,"div",6),i._UZ(8,"label",7),i.TgZ(9,"div",8),i.TgZ(10,"div",9),i.TgZ(11,"input",10,11),i.NdJ("change",function(O){return E.selectedPage=O.target.value}),i.qZA(),i.qZA(),i.qZA(),i.qZA(),i.TgZ(13,"div",6),i.TgZ(14,"div",8),i.TgZ(15,"label",12),i.TgZ(16,"div",13),i.TgZ(17,"input",14,15),i.NdJ("ngModelChange",function(O){return E.updateIncludeParent(O)}),i.qZA(),i.qZA(),i._uU(19),i.qZA(),i.qZA(),i.qZA(),i._UZ(20,"p",5),i.qZA(),i.qZA(),i.TgZ(21,"div",16),i.TgZ(22,"div",17),i.TgZ(23,"button",18),i.NdJ("click",function(O){return E.closeMe(O)}),i.qZA(),i._UZ(24,"button",19),i.qZA(),i.qZA(),i.qZA()),2&P&&(i.xp6(2),i.Oqu(E.text.title),i.xp6(4),i.Q6J("textContent",E.text.page),i.xp6(2),i.Q6J("textContent",E.text.page),i.xp6(3),i.Q6J("value",E.selectedPage),i.xp6(6),i.Q6J("ngModel",E.selectedIncludeParent),i.xp6(2),i.hij(" ",E.text.include_parent," "),i.xp6(1),i.Q6J("textContent",E.text.hint),i.xp6(3),i.Q6J("textContent",E.text.button_cancel),i.xp6(1),i.Q6J("textContent",E.text.button_save))},directives:[l._Y,l.JL,l.F,l.Wl,l.JJ,l.On],encapsulation:2});class b{constructor(P,E){this.opModalService=P,this.injector=E}configureWorkPackageButton(P,E){return new Promise((T,O)=>{this.opModalService.show(a,this.injector,{type:P,classes:E}).subscribe(I=>I.closingEvent.subscribe(()=>{I.changed&&T({type:I.type,classes:I.classes})}))})}configureWikiPageInclude(P){return new Promise((E,T)=>{const O=P||"";this.opModalService.show(v,this.injector,{page:O}).subscribe(I=>I.closingEvent.subscribe(()=>{I.changed&&E(I.page)}))})}editCodeBlock(P,E){return new Promise((T,O)=>{this.opModalService.show(u,this.injector,{content:P,languageClass:E}).subscribe(I=>I.closingEvent.subscribe(()=>{I.changed&&T({languageClass:I.languageClass,content:I.content})}))})}configureChildPages(P,E){return new Promise((T,O)=>{this.opModalService.show(x,this.injector,{page:P,includeParent:E}).subscribe(I=>I.closingEvent.subscribe(()=>{I.changed&&T({page:I.page,includeParent:I.includeParent})}))})}}b.\u0275fac=function(P){return new(P||b)(i.LFG(n.S),i.LFG(i.zs3))},b.\u0275prov=i.Yz7({token:b,factory:b.\u0275fac})},39656:(te,M,t)=>{"use strict";t.d(M,{x:()=>y});var n=t(60312),e=t(71562),p=t(96617),h=t(97973),i=t(86469),l=t(36293),r=t(18137),d=t(43440),f=t(77355),a=t(2316),m=t(53882),v=t(55901),C=t(54364),u=t(2775);function k(P,E){if(1&P){const T=a.EpF();a.TgZ(0,"li",10),a.TgZ(1,"a",11),a.NdJ("click",function(I){const j=a.CHM(T).$implicit;return a.oxw(2).triggerByLink(j.url,I)}),a._UZ(2,"op-icon",12),a._UZ(3,"span",13),a.qZA(),a.qZA()}if(2&P){const T=E.$implicit;a.xp6(1),a.MGl("id","export-",T.identifier,""),a.uIk("href",T.url,a.LSH),a.xp6(1),a.MGl("icon-classes","icon-export-",T.identifier," icon-big"),a.xp6(1),a.Q6J("textContent",T.label)}}const x=function(P){return{"-hidden":P}};function b(P,E){if(1&P&&(a.TgZ(0,"ul",8),a.YNc(1,k,4,4,"li",9),a.qZA()),2&P){const T=a.oxw();a.Q6J("ngClass",a.VKq(2,x,T.isLoading)),a.xp6(1),a.Q6J("ngForOf",T.exportOptions)}}class y extends n.T{constructor(E,T,O,I,Z,j,B,J,R){super(E,Z,O),this.locals=E,this.I18n=T,this.elementRef=O,this.querySpace=I,this.cdRef=Z,this.httpClient=j,this.wpTableColumns=B,this.loadingIndicator=J,this.toastService=R,this.text={title:this.I18n.t("js.label_export"),closePopup:this.I18n.t("js.close_popup_title"),exportPreparing:this.I18n.t("js.label_export_preparing"),cancelButton:this.I18n.t("js.button_cancel")}}ngOnInit(){super.ngOnInit(),this.locals.link?this.requestExport(this.locals.link):this.querySpace.results.valuesPromise().then(E=>{this.exportOptions=this.buildExportOptions(E),this.cdRef.detectChanges()})}buildExportOptions(E){return E.representations.map(T=>{const O=T.$link;return{identifier:O.identifier,label:O.title,url:this.addColumnsToHref(T.href)}})}triggerByLink(E,T){T.preventDefault(),this.requestExport(E)}requestExport(E){this.httpClient.get(E,{observe:"body",responseType:"json"}).subscribe(T=>this.replaceWithJobModal(T.job_id),T=>this.handleError(T))}replaceWithJobModal(E){this.service.show(r.L,"global",{jobId:E})}handleError(E){200===E.status&&E.url?window.open(E.url):this.showError(E)}showError(E){this.toastService.addError(E.message||this.I18n.t("js.error.internal"))}addColumnsToHref(E){const O=this.wpTableColumns.getColumns().map(Z=>Z.id),I=h(E);return I.removeSearch("columns[]"),I.addSearch("columns[]",O),I.toString()}get afterFocusOn(){return document.getElementById("work-packages-settings-button")}}y.\u0275fac=function(E){return new(E||y)(a.Y36(f.E),a.Y36(p.D),a.Y36(a.SBq),a.Y36(d.q),a.Y36(a.sBO),a.Y36(m.eN),a.Y36(e.i),a.Y36(i.vt),a.Y36(l.kl))},y.\u0275cmp=a.Xpm({type:y,selectors:[["ng-component"]],features:[a.qOj],decls:10,vars:4,consts:[["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal","spot-modal_wide","op-wp-table-export",3,"cdkTrapFocusAutoCapture"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["class","op-export-options",3,"ngClass",4,"ngIf"],[1,"spot-action-bar","hidden-for-mobile"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"click"],[1,"op-export-options",3,"ngClass"],["class","op-export-options--option",4,"ngFor","ngForOf"],[1,"op-export-options--option"],[1,"op-export-options--option-link",3,"id","click"],[3,"icon-classes"],[1,"op-export-options--option-label",3,"textContent"]],template:function(E,T){1&E&&(a.TgZ(0,"div",0),a.TgZ(1,"div",1),a._uU(2),a.qZA(),a._UZ(3,"div",2),a.TgZ(4,"div",3),a.YNc(5,b,2,4,"ul",4),a.qZA(),a.TgZ(6,"div",5),a.TgZ(7,"div",6),a.TgZ(8,"button",7),a.NdJ("click",function(){return T.closeMe()}),a._uU(9),a.qZA(),a.qZA(),a.qZA(),a.qZA()),2&E&&(a.Q6J("cdkTrapFocusAutoCapture",!0),a.xp6(2),a.Oqu(T.text.title),a.xp6(3),a.Q6J("ngIf",T.exportOptions),a.xp6(4),a.hij(" ",T.text.cancelButton," "))},directives:[v.mK,C.O5,C.mk,C.sg,u.o],styles:[".op-wp-table-export[_ngcontent-%COMP%]   #download-link[_ngcontent-%COMP%]{display:none}.op-wp-table-export[_ngcontent-%COMP%]   .loading-indicator--location[_ngcontent-%COMP%]{height:220px}.op-wp-table-export[_ngcontent-%COMP%]   .export-options.-hidden[_ngcontent-%COMP%]{display:none}"],changeDetection:0})},58057:(te,M,t)=>{"use strict";t.d(M,{T:()=>c});var n=t(77355),e=t(60312),p=t(96617),h=t(2316);class c extends e.T{constructor(l,r,d,f){super(r,d,l),this.elementRef=l,this.locals=r,this.cdRef=d,this.I18n=f}ngOnInit(){super.ngOnInit();const l=this.$element.children[0],r=this.locals.modalClassName||"";l.classList.add(...r.split(" ")),l.innerHTML=this.locals.modalBody;const f=document.querySelector(".spot-modal").querySelector("[dynamic-content-modal-close-button]");null==f||f.addEventListener("click",()=>this.closeMe())}ngOnDestroy(){super.ngOnDestroy()}}c.\u0275fac=function(l){return new(l||c)(h.Y36(h.SBq),h.Y36(n.E),h.Y36(h.sBO),h.Y36(p.D))},c.\u0275cmp=h.Xpm({type:c,selectors:[["ng-component"]],features:[h.qOj],decls:1,vars:0,consts:[["data-indicator-name","modal",1,"spot-modal","dynamic-content-modal--wrapper","loading-indicator--location"]],template:function(l,r){1&l&&h._UZ(0,"div",0)},encapsulation:2,changeDetection:0})},74168:(te,M,t)=>{"use strict";t.d(M,{I:()=>T});var n=t(61043),e=t(87853),p=t(60312),h=t(77355),c=t(48451),i=t(47775),l=t(96617),r=t(57014),d=t(62964),f=t(56686);function a(O){return null!==O}var m=t(2316),v=t(54364),C=t(1707);function u(O,I){if(1&O&&(m.TgZ(0,"li"),m._uU(1," #"),m._UZ(2,"span",9),m._UZ(3,"span",9),m.qZA()),2&O){const Z=I.$implicit;m.xp6(2),m.Q6J("textContent",Z.id),m.xp6(1),m.Q6J("textContent",Z.subject||"")}}function k(O,I){if(1&O&&(m.TgZ(0,"div"),m.TgZ(1,"p",10),m._UZ(2,"span",11),m._UZ(3,"strong",9),m._uU(4,": "),m._UZ(5,"span",9),m.qZA(),m.TgZ(6,"ul"),m.YNc(7,u,4,2,"li",12),m.qZA(),m.TgZ(8,"p"),m._UZ(9,"span",9),m.qZA(),m.qZA()),2&O){const Z=m.oxw(2);m.xp6(3),m.Q6J("textContent",Z.text.warning),m.xp6(2),m.Q6J("textContent",Z.text.hasChildren(Z.singleWorkPackage)),m.xp6(2),m.Q6J("ngForOf",Z.singleWorkPackageChildren),m.xp6(2),m.Q6J("textContent",Z.text.deletesChildren)}}function x(O,I){if(1&O&&(m.ynx(0),m.TgZ(1,"p"),m._UZ(2,"span",9),m.TgZ(3,"strong"),m._uU(4),m.qZA(),m.TgZ(5,"span"),m._uU(6,"?"),m.qZA(),m.qZA(),m.YNc(7,k,10,4,"div",3),m.BQk()),2&O){const Z=m.oxw();m.xp6(2),m.Q6J("textContent",Z.text.single_text),m.xp6(2),m.AsE(" ",Z.singleWorkPackage.subject," #",Z.singleWorkPackage.id,""),m.xp6(3),m.Q6J("ngIf",Z.singleWorkPackageChildren&&Z.singleWorkPackageChildren.length>0)}}function b(O,I){if(1&O&&(m.TgZ(0,"strong"),m._uU(1),m.qZA()),2&O){const Z=m.oxw().$implicit,j=m.oxw(2);m.xp6(1),m.hij(" (+ ",j.text.childCount(Z),") ")}}function y(O,I){if(1&O&&(m.TgZ(0,"li"),m._uU(1," #"),m._UZ(2,"span",9),m._uU(3," "),m._UZ(4,"span",9),m.YNc(5,b,2,1,"strong",3),m.qZA()),2&O){const Z=I.$implicit,j=m.oxw(2);m.xp6(2),m.Q6J("textContent",Z.id),m.xp6(2),m.Q6J("textContent",Z.subject),m.xp6(1),m.Q6J("ngIf",j.children(Z).length>0)}}function P(O,I){if(1&O&&(m.ynx(0),m.TgZ(1,"p",10),m._UZ(2,"span",11),m._UZ(3,"strong",9),m.qZA(),m.TgZ(4,"ul"),m.YNc(5,y,6,3,"li",12),m.qZA(),m.BQk()),2&O){const Z=m.oxw();m.xp6(3),m.Q6J("textContent",Z.text.bulk_text),m.xp6(2),m.Q6J("ngForOf",Z.workPackages)}}function E(O,I){if(1&O){const Z=m.EpF();m.TgZ(0,"div"),m.TgZ(1,"label",13),m.TgZ(2,"div",14),m.TgZ(3,"input",15),m.NdJ("ngModelChange",function(B){m.CHM(Z);return m.oxw().childrenDeletionConfirmed=B}),m.qZA(),m.qZA(),m._uU(4),m.qZA(),m.qZA()}if(2&O){const Z=m.oxw();m.xp6(3),m.Q6J("ngModel",Z.childrenDeletionConfirmed),m.xp6(1),m.hij(" ",Z.text.label_confirm_children_deletion," ")}}class T extends p.T{constructor(I,Z,j,B,J,R,F,Y,X,K,ie){super(j,J,I),this.elementRef=I,this.workPackageService=Z,this.locals=j,this.I18n=B,this.cdRef=J,this.$state=R,this.states=F,this.wpTableFocus=Y,this.wpListService=X,this.notificationService=K,this.backRoutingService=ie,this.busy=!1,this.childrenDeletionConfirmed=!1,this.text={label_visibility_settings:this.I18n.t("js.label_visibility_settings"),button_save:this.I18n.t("js.modals.button_save"),confirm:this.I18n.t("js.modals.button_delete"),warning:this.I18n.t("js.label_warning"),cancel:this.I18n.t("js.button_cancel"),close:this.I18n.t("js.close_popup_title"),label_confirm_children_deletion:this.I18n.t("js.modals.destroy_work_package.confirm_deletion_children"),title:"",bulk_text:"",single_text:this.I18n.t("js.modals.destroy_work_package.single_text"),childCount:H=>"",hasChildren:H=>"",deletesChildren:""}}ngOnInit(){super.ngOnInit(),this.workPackages=this.locals.workPackages,this.workPackageLabel=this.I18n.t("js.units.workPackage",{count:this.workPackages.length}),1===this.workPackages.length&&(this.singleWorkPackage=this.workPackages[0],this.singleWorkPackageChildren=this.singleWorkPackage.children),this.text.title=this.I18n.t("js.modals.destroy_work_package.title",{label:this.workPackageLabel}),this.text.bulk_text=this.I18n.t("js.modals.destroy_work_package.bulk_text",{label:this.workPackageLabel,count:this.workPackages.length}),this.text.childCount=I=>{const Z=this.children(I).length;return this.I18n.t("js.units.child_work_packages",{count:Z})},this.text.hasChildren=I=>{const Z=this.text.childCount(I);return this.I18n.t("js.modals.destroy_work_package.has_children",{childUnits:Z})},this.text.deletesChildren=this.I18n.t("js.modals.destroy_work_package.deletes_children")}get blockedDueToUnconfirmedChildren(){return this.mustConfirmChildren&&!this.childrenDeletionConfirmed}get mustConfirmChildren(){let I=!1;return this.singleWorkPackage&&this.singleWorkPackageChildren&&(I=this.singleWorkPackageChildren.length>0),I||!!_.find(this.workPackages,Z=>Z.children&&Z.children.length>0)}confirmDeletion(I){if(this.busy||this.blockedDueToUnconfirmedChildren)return!1;this.busy=!0;const Z=this.workPackages.map(j=>j.id).filter(a);return this.workPackageService.performBulkDelete(Z,!0).then(()=>{this.busy=!1,this.closeMe(I),this.wpTableFocus.clear("Clearing after destroying work packages"),this.$state.current.data.baseRoute&&this.backRoutingService.goBack(!0)}).catch(()=>{this.busy=!1}),!1}children(I){return I.hasOwnProperty("children")?I.children:[]}}T.\u0275fac=function(I){return new(I||T)(m.Y36(m.SBq),m.Y36(f.h),m.Y36(h.E),m.Y36(l.D),m.Y36(m.sBO),m.Y36(i.StateService),m.Y36(e.G),m.Y36(c.o),m.Y36(n.Z),m.Y36(d.q),m.Y36(r.Y))},T.\u0275cmp=m.Xpm({type:T,selectors:[["ng-component"]],features:[m.qOj],decls:13,vars:7,consts:[["data-indicator-name","modal","id","wp_destroy_modal",1,"spot-modal"],[1,"spot-modal--header"],[1,"spot-modal--body","spot-container"],[4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","-danger","spot-action-bar--action",3,"click"],[1,"spot-icon","spot-icon_delete"],[3,"textContent"],[1,"danger-zone--warning"],[1,"icon-context","icon-error"],[4,"ngFor","ngForOf"],[1,"form--label-with-check-box","-no-ellipsis"],[1,"form--check-box-container"],["type","checkbox","name","confirm-children-deletion","id","confirm-children-deletion",1,"form--check-box",3,"ngModel","ngModelChange"]],template:function(I,Z){1&I&&(m.TgZ(0,"div",0),m.TgZ(1,"div",1),m._uU(2),m.qZA(),m.TgZ(3,"div",2),m.YNc(4,x,8,4,"ng-container",3),m.YNc(5,P,6,2,"ng-container",3),m.YNc(6,E,5,2,"div",3),m.qZA(),m.TgZ(7,"div",4),m.TgZ(8,"div",5),m.TgZ(9,"button",6),m.NdJ("click",function(B){return Z.closeMe(B)}),m.qZA(),m.TgZ(10,"button",7),m.NdJ("click",function(B){return Z.confirmDeletion(B)}),m._UZ(11,"span",8),m._uU(12),m.qZA(),m.qZA(),m.qZA(),m.qZA()),2&I&&(m.xp6(2),m.Oqu(Z.text.title),m.xp6(2),m.Q6J("ngIf",Z.singleWorkPackage),m.xp6(1),m.Q6J("ngIf",Z.workPackages.length>1),m.xp6(1),m.Q6J("ngIf",Z.mustConfirmChildren),m.xp6(3),m.Q6J("textContent",Z.text.cancel),m.xp6(1),m.uIk("disabled",Z.busy||Z.blockedDueToUnconfirmedChildren||void 0),m.xp6(2),m.hij(" ",Z.text.confirm," "))},directives:[v.O5,v.sg,C.Wl,C.JJ,C.On],encapsulation:2})},55216:(te,M,t)=>{"use strict";t.d(M,{X:()=>i,S:()=>l});var n=t(45410),e=t(2316),p=t(54364);function h(r,d){1&r&&e._UZ(0,"i",3)}function c(r,d){if(1&r&&e._UZ(0,"div",4),2&r){const f=e.oxw();e.Q6J("innerHTML",f.description,e.oJD)}}const i="op-no-results";class l{constructor(d){this.elementRef=d,this.showIcon=!0,this.setHostClass=!0,(0,n.E)(this)}}l.\u0275fac=function(d){return new(d||l)(e.Y36(e.SBq))},l.\u0275cmp=e.Xpm({type:l,selectors:[["op-no-results"]],hostVars:2,hostBindings:function(d,f){2&d&&e.ekj("generic-table--no-results-container",f.setHostClass)},inputs:{title:"title",description:"description",showIcon:"showIcon"},decls:4,vars:3,consts:[["class","icon-info1","aria-hidden","true",4,"ngIf"],[1,"generic-table--no-results-title"],["class","generic-table--no-results-description",3,"innerHTML",4,"ngIf"],["aria-hidden","true",1,"icon-info1"],[1,"generic-table--no-results-description",3,"innerHTML"]],template:function(d,f){1&d&&(e.YNc(0,h,1,0,"i",0),e.TgZ(1,"span",1),e._uU(2),e.YNc(3,c,1,1,"div",2),e.qZA()),2&d&&(e.Q6J("ngIf",f.showIcon),e.xp6(2),e.hij(" ",f.title," "),e.xp6(1),e.Q6J("ngIf",f.description))},directives:[p.O5],encapsulation:2,changeDetection:0})},70099:(te,M,t)=>{"use strict";t.d(M,{V:()=>h});var n=t(2316),e=t(52332);class h{constructor(){this.viewBox="0 0 400 130"}ngOnInit(){this.baseUrl=window.appBasePath}}h.\u0275fac=function(i){return new(i||h)},h.\u0275cmp=n.Xpm({type:h,selectors:[["op-content-loader"]],inputs:{viewBox:"viewBox"},ngContentSelectors:["*"],decls:2,vars:3,consts:[[3,"baseUrl","speed","viewBox"]],template:function(i,l){1&i&&(n.F$t(),n.TgZ(0,"content-loader",0),n.Hsn(1),n.qZA()),2&i&&n.Q6J("baseUrl",l.baseUrl)("speed",3)("viewBox",l.viewBox)},directives:[e.H1],encapsulation:2,changeDetection:0})},87523:(te,M,t)=>{"use strict";t.d(M,{a:()=>h});var n=t(54364),e=t(52332),p=t(2316);class h{}h.\u0275fac=function(i){return new(i||h)},h.\u0275mod=p.oAB({type:h}),h.\u0275inj=p.cJS({imports:[[n.ez,e.GO]]})},55548:(te,M,t)=>{"use strict";t.d(M,{n:()=>h});var n=t(20342),e=t(53358),p=t(2316);class h extends e.m{constructor(i,l){super(l),this.elementRef=i,this.opContextMenu=l,this.items=[]}ngAfterViewInit(){this.$element=jQuery(this.elementRef.nativeElement),this.$element.on("click",i=>{i.preventDefault(),this.opContextMenu.isActive(this)?this.opContextMenu.close():this.open(i)}),Mousetrap(this.$element[0]).bind("shift+alt+f10",i=>{this.open(i)})}positionArgs(i){return{my:"left top",at:"left bottom",of:this.$element,collision:"flipfit"}}}h.\u0275fac=function(i){return new(i||h)(p.Y36(p.SBq),p.Y36(n.$))},h.\u0275dir=p.lG2({type:h,selectors:[["","opContextMenuTrigger",""]],features:[p.qOj]})},8643:(te,M,t)=>{"use strict";t.d(M,{Y:()=>i});var n=t(20342),e=t(55548),p=t(12703),h=t(87853),c=t(2316);class i extends e.n{constructor(r,d,f,a){super(r,d),this.elementRef=r,this.opContextMenu=d,this.states=f,this.halEditing=a}open(r){const d=this.states.workPackages.get("new").value;d&&this.halEditing.changeFor(d).getForm().then(a=>{this.buildItems(a),this.opContextMenu.show(this,r)})}positionArgs(r){const f=super.positionArgs(r);return _.assign(f,{my:"right top",at:"right bottom"}),f}buildItems(r){this.items=[];const d=r.configureForm,f=r.customFields;f&&this.items.push({href:f.href,icon:"icon-custom-fields",linkText:f.name,onClick:()=>!1}),d&&this.items.push({href:d.href,icon:"icon-settings3",linkText:d.name,onClick:()=>!1})}}i.\u0275fac=function(r){return new(r||i)(c.Y36(c.SBq),c.Y36(n.$),c.Y36(h.G),c.Y36(p.l))},i.\u0275dir=c.lG2({type:i,selectors:[["","wpCreateSettingsMenu",""]],features:[c.qOj]})},11269:(te,M,t)=>{"use strict";t.d(M,{I:()=>r});var n=t(3786),e=t(96617),p=t(55548),h=t(20342),c=t(77355),i=t(2316),l=t(2775);class r extends p.n{constructor(f,a,m,v,C,u){super(f,a),this.elementRef=f,this.opContextMenu=a,this.opModalService=m,this.injector=v,this.cdRef=C,this.I18n=u}open(f){return(0,n.mG)(this,void 0,void 0,function*(){this.items=yield this.buildItems(),this.opContextMenu.show(this,f)})}positionArgs(f){const m=super.positionArgs(f);return _.assign(m,{my:"right top",at:"right bottom"}),m}buildItems(){return(0,n.mG)(this,void 0,void 0,function*(){const f=[];if(this.menuItems){const a=yield this.menuItems();return f.concat(a)}return f})}}r.\u0275fac=function(f){return new(f||r)(i.Y36(i.SBq),i.Y36(h.$),i.Y36(c.S),i.Y36(i.zs3),i.Y36(i.sBO),i.Y36(e.D))},r.\u0275cmp=i.Xpm({type:r,selectors:[["icon-triggered-context-menu"]],inputs:{menuItems:["menu-items","menuItems"]},features:[i.qOj],decls:2,vars:0,consts:[["href","#"],["icon-classes","icon-show-more-horizontal"]],template:function(f,a){1&f&&(i.TgZ(0,"a",0),i._UZ(1,"op-icon",1),i.qZA())},directives:[l.o],styles:["a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:hover{color:var(--light-gray);text-decoration:none}"]})},53358:(te,M,t)=>{"use strict";t.d(M,{m:()=>e});var n=t(26942);class e extends n.N{constructor(h){super(),this.opContextMenu=h,this.items=[]}onClose(){this.afterFocusOn.trigger("focus")}onOpen(h){h.find(".menu-item").first().trigger("focus")}positionArgs(h){return{my:"left top",at:"right bottom",of:h,collision:"flipfit"}}get locals(){return{items:this.items}}open(h){this.opContextMenu.show(this,h)}get afterFocusOn(){return this.$element}}},36322:(te,M,t)=>{"use strict";t.d(M,{n:()=>u});var n=t(30712),e=t(2316),p=t(54364),h=t(2775);function c(k,x){1&k&&e._UZ(0,"li",5)}function i(k,x){if(1&k&&e._UZ(0,"op-icon",11),2&k){const b=e.oxw(3).$implicit;e.MGl("icon-classes","icon-action-menu ",b.icon,"")}}function l(k,x){if(1&k&&e._UZ(0,"op-icon",12),2&k){const b=e.oxw(3).$implicit;e.MGl("icon-classes","icon-action-menu-post ",b.postIcon,""),e.Q6J("icon-title",b.postIconTitle||"")}}function r(k,x){if(1&k){const b=e.EpF();e.TgZ(0,"a",7),e.NdJ("click",function(P){e.CHM(b);const E=e.oxw(2).$implicit;return e.oxw().handleClick(E,P)}),e.YNc(1,i,1,1,"op-icon",8),e._UZ(2,"span",9),e.YNc(3,l,1,2,"op-icon",10),e.qZA()}if(2&k){const b=e.oxw(2).$implicit;e.ekj("inactive",b.disabled),e.Q6J("ngClass",b.class),e.uIk("href",b.href,e.LSH)("aria-disabled",b.disabled)("aria-label",b.ariaLabel||b.linkText)("title",b.title||void 0),e.xp6(1),e.Q6J("ngIf",b.icon),e.xp6(1),e.Q6J("textContent",b.linkText),e.xp6(1),e.Q6J("ngIf",b.postIcon)}}function d(k,x){if(1&k&&e._UZ(0,"op-icon",11),2&k){const b=e.oxw(3).$implicit;e.MGl("icon-classes","icon-action-menu ",b.icon,"")}}function f(k,x){if(1&k&&e._UZ(0,"op-icon",12),2&k){const b=e.oxw(3).$implicit;e.MGl("icon-classes","icon-action-menu-post ",b.postIcon,""),e.Q6J("icon-title",b.postIconTitle||"")}}function a(k,x){if(1&k){const b=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(P){e.CHM(b);const E=e.oxw(2).$implicit;return e.oxw().handleClick(E,P)}),e.YNc(1,d,1,1,"op-icon",8),e._UZ(2,"span",9),e.YNc(3,f,1,2,"op-icon",10),e.qZA()}if(2&k){const b=e.oxw(2).$implicit;e.ekj("inactive",b.disabled),e.Q6J("ngClass",b.class),e.uIk("aria-disabled",b.disabled)("aria-label",b.ariaLabel||b.linkText)("title",b.title||void 0),e.xp6(1),e.Q6J("ngIf",b.icon),e.xp6(1),e.Q6J("textContent",b.linkText),e.xp6(1),e.Q6J("ngIf",b.postIcon)}}function m(k,x){if(1&k&&(e.TgZ(0,"li"),e.YNc(1,r,4,10,"a",6),e.YNc(2,a,4,9,"button",6),e.qZA()),2&k){const b=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",b.href),e.xp6(1),e.Q6J("ngIf",!b.href)}}function v(k,x){if(1&k&&(e.ynx(0),e.YNc(1,c,1,0,"li",3),e.YNc(2,m,3,2,"li",4),e.BQk()),2&k){const b=x.$implicit;e.xp6(1),e.Q6J("ngIf",b.divider),e.xp6(1),e.Q6J("ngIf",!b.divider)}}const C=function(k){return{"-empty":k}};class u{constructor(x){this.locals=x,this.items=this.locals.items.filter(b=>!(null==b?void 0:b.hidden)),this.service=this.locals.service}handleClick(x,b){return!x.disabled&&!x.divider&&(!x.onClick(b)||(this.locals.service.close(),b.preventDefault(),b.stopPropagation(),!1))}}u.\u0275fac=function(x){return new(x||u)(e.Y36(n.Q))},u.\u0275cmp=e.Xpm({type:u,selectors:[["ng-component"]],decls:3,vars:5,consts:[["ng-class","{'dropdown-anchor-right': locals.showAnchorRight}",1,"dropdown-relative","dropdown","-overflow-in-view"],["role","menu",1,"dropdown-menu",3,"ngClass"],[4,"ngFor","ngForOf"],["class","dropdown-divider",4,"ngIf"],[4,"ngIf"],[1,"dropdown-divider"],["class","menu-item",3,"ngClass","inactive","click",4,"ngIf"],[1,"menu-item",3,"ngClass","click"],[3,"icon-classes",4,"ngIf"],[3,"textContent"],[3,"icon-title","icon-classes",4,"ngIf"],[3,"icon-classes"],[3,"icon-title","icon-classes"]],template:function(x,b){1&x&&(e.TgZ(0,"div",0),e.TgZ(1,"ul",1),e.YNc(2,v,3,2,"ng-container",2),e.qZA(),e.qZA()),2&x&&(e.uIk("id",b.locals.contextMenuId),e.xp6(1),e.Q6J("ngClass",e.VKq(3,C,0===b.items.length)),e.xp6(1),e.Q6J("ngForOf",b.items))},directives:[p.mk,p.sg,p.O5,h.o],encapsulation:2})},20342:(te,M,t)=>{"use strict";t.d(M,{$:()=>r});var n=t(40912),e=t(47775),p=t(30712),h=t(36322),c=t(33406),i=t(7101),l=t(2316);class r{constructor(f,a,m,v,C){this.componentFactoryResolver=f,this.FocusHelper=a,this.appRef=m,this.$transitions=v,this.injector=C,this.active=null,this.isOpening=!1;const u=this.portalHostElement=document.createElement("div");u.classList.add("op-context-menu--overlay"),document.body.appendChild(u),this.bodyPortalHost=new n.u0(u,this.componentFactoryResolver,this.appRef,this.injector),v.onStart({},()=>this.close()),jQuery(window).on("keydown",x=>(this.active&&x.which===c.m.ESCAPE&&this.close(),!0));const k=this;document.getElementById("wrapper").addEventListener("click",x=>{k.active&&!k.portalHostElement.contains(x.target)&&k.close()},!0)}show(f,a,m=h.n){this.close(),this.isOpening=!0;const v=new n.C5(m,null,this.injectorFor(f.locals));this.bodyPortalHost.attach(v),this.portalHostElement.style.display="block",this.active=f,setTimeout(()=>{var C;this.reposition(a),null===(C=this.active)||void 0===C||C.onOpen(this.activeMenu),this.isOpening=!1})}isActive(f){return!!this.active&&this.active===f}close(){var f;this.isOpening||(this.bodyPortalHost.detach(),this.portalHostElement.style.display="none",null===(f=this.active)||void 0===f||f.onClose(),this.active=null)}reposition(f){!this.active||this.activeMenu.position(this.active.positionArgs(f)).css("visibility","visible")}get activeMenu(){return jQuery(this.portalHostElement).find(".dropdown")}injectorFor(f){const a=new WeakMap;return f.service=this,a.set(p.Q,f),new n.nK(this.injector,a)}}r.\u0275fac=function(f){return new(f||r)(l.LFG(l._Vd),l.LFG(i.i),l.LFG(l.z2F),l.LFG(e.TransitionService),l.LFG(l.zs3))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})},30712:(te,M,t)=>{"use strict";t.d(M,{Q:()=>e});const e=new(t(2316).OlP)("CONTEXT_MENU_LOCALS")},74565:(te,M,t)=>{"use strict";t.d(M,{B:()=>x});var n=t(3786),e=t(47775),p=t(67325),h=t(7493),c=t(70233),l=(t(24897),t(53448)),r=t(55548),d=t(20342),f=t(60713),a=t(77355),m=t(29161),v=t(46709),C=t(74168);class u{constructor(y,P,E){this.workPackage=y,this.PathHelper=P,this.$state=E,this.project=y.project}linkForAction(y){let P;switch(y.key){case"copy":P=this.copyLink();break;case"copy_to_other_project":P=this.bulkCopyLink();break;default:P=this.workPackage[y.link].href}return Object.assign(Object.assign({},y),{link:P})}isPermitted(y){return void 0!==this.workPackage[y.link]}permittedActionKeys(y){return y.filter(P=>this.isPermitted(P)).map(P=>P.key)}permittedActionsWithLinks(y){return y.filter(P=>this.isPermitted(P)).map(P=>this.linkForAction(P))}copyLink(){return 0===this.$state.current.name.indexOf("work-packages.partitioned.list.details")?this.PathHelper.workPackageDetailsCopyPath(this.project.identifier,this.workPackage.id):this.PathHelper.workPackageCopyPath(this.workPackage.id)}bulkCopyLink(){return`${this.PathHelper.staticBase}/work_packages/move/new?copy=true&ids[]=${this.workPackage.id}`}}var k=t(2316);class x extends r.n{constructor(y,P,E,T,O,I,Z,j){super(O,Z),this.HookService=y,this.$state=P,this.injector=E,this.PathHelper=T,this.elementRef=O,this.opModalService=I,this.opContextMenuService=Z,this.authorisationService=j}open(y){this.workPackage.project.$load().then(()=>{this.authorisationService.initModelAuth("work_package",this.workPackage.$links);const P=new u(this.workPackage,this.PathHelper,this.$state),E=this.getPermittedActions(P);this.buildItems(E),this.opContextMenu.show(this,y)})}triggerContextMenuAction(y,P){const{link:E}=y;switch(P){case"copy_to_other_project":window.location.href=`${this.PathHelper.staticBase}/work_packages/move/new?copy=true&ids[]=${this.workPackage.id}`;break;case"copy":this.$state.go("work-packages.copy",{copiedFromWorkPackageId:this.workPackage.id});break;case"delete":this.opModalService.show(C.I,this.injector,{workPackages:[this.workPackage]});break;case"log_time":this.timeEntryCreateService.create(moment(new Date),this.workPackage,{showWorkPackageField:!1}).catch(()=>{});break;default:window.location.href=E}}positionArgs(y){const E=super.positionArgs(y);return _.assign(E,{my:"right top",at:"right bottom"}),E}getPermittedActions(y){const P=y.permittedActionsWithLinks(f.p);return _.each(this.getPermittedPluginActions(y),E=>{const T=E.indexBy?E.indexBy(P):P.length;P.splice(T,0,E)}),P}getPermittedPluginActions(y){const P=this.HookService.call("workPackageSingleContextMenu");return y.permittedActionsWithLinks(P)}buildItems(y){const P=this.workPackage.configureForm;return this.items=y.map(E=>{const{key:T}=E;return{disabled:!1,linkText:I18n.t(`js.button_${T}`),href:E.link,icon:E.icon||`icon-${T}`,onClick:O=>(!E.link||!(0,p.F)(O))&&(this.triggerContextMenuAction(E,T),!0)}}),P&&this.items.push({href:P.href,icon:"icon-settings3",linkText:I18n.t("js.button_configure-form"),onClick:()=>!1}),this.items}}x.\u0275fac=function(y){return new(y||x)(k.Y36(l.$),k.Y36(e.StateService),k.Y36(k.zs3),k.Y36(c.j),k.Y36(k.SBq),k.Y36(a.S),k.Y36(d.$),k.Y36(h.g))},x.\u0275dir=k.lG2({type:x,selectors:[["","wpSingleContextMenu",""]],inputs:{workPackage:["wpSingleContextMenu-workPackage","workPackage"]},features:[k.qOj]}),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",v.f)],x.prototype,"timeEntryCreateService",void 0)},60713:(te,M,t)=>{"use strict";t.d(M,{p:()=>n});const n=[{key:"log_time",link:"logTime"},{key:"change_project",icon:"icon-move",link:"move"},{key:"copy",link:"copy"},{key:"copy_to_other_project",link:"copy",icon:"icon-project-types"},{key:"delete",link:"delete"},{key:"export-pdf",link:"pdf"},{key:"export-atom",link:"atom"}]},99794:(te,M,t)=>{"use strict";t.d(M,{X:()=>b});var n=t(3786),e=t(77591),p=t(87853),h=t(41945),c=t(60914),i=t(67325),l=t(53358),r=t(20342),d=t(60713),f=t(77355),a=t(47775),m=t(29161),v=t(46709),C=t(70482),u=t(74168),k=t(84699),x=t(70233);class b extends l.m{constructor(P,E,T,O={},I=!0){super(P.get(r.$)),this.injector=P,this.workPackageId=E,this.$element=T,this.additionalPositionArgs=O,this.allowSplitScreenActions=I,this.workPackage=this.states.workPackages.get(this.workPackageId).value,this.selectedWorkPackages=this.getSelectedWorkPackages(),this.permittedActions=this.WorkPackageContextMenuHelper.getPermittedActions(this.selectedWorkPackages,d.p,this.allowSplitScreenActions),this.baseRoute=this.$state.current.data.baseRoute||this.$state.current.name,this.items=this.buildItems()}get locals(){return{contextMenuId:"work-package-context-menu",items:this.items}}positionArgs(P){const E=super.positionArgs(P);return _.assign(E,this.additionalPositionArgs),E}triggerContextMenuAction(P){const{link:E}=P,T=this.workPackage.id;switch(P.key){case"delete":this.deleteSelectedWorkPackages();break;case"edit":this.editSelectedWorkPackages(E);break;case"copy":this.copySelectedWorkPackages(E);break;case"copy_to_other_project":window.location.href=`${this.pathHelper.staticBase}/work_packages/move/new?copy=true&ids[]=${T}`;break;case"relation-new-child":this.wpRelationsHierarchyService.addNewChildWp(this.baseRoute,this.workPackage);break;case"log_time":this.logTimeForSelectedWorkPackage();break;default:window.location.href=E}}deleteSelectedWorkPackages(){const P=this.getSelectedWorkPackages();this.opModalService.show(u.I,this.injector,{workPackages:P})}editSelectedWorkPackages(P){this.getSelectedWorkPackages().length>1&&(window.location.href=P)}copySelectedWorkPackages(P){const E=this.getSelectedWorkPackages();if(E.length>1)return void(window.location.href=P);const T={copiedFromWorkPackageId:E[0].id};this.$state.go(`${this.baseRoute}.copy`,T)}logTimeForSelectedWorkPackage(){this.timeEntryCreateService.create(moment(new Date),this.workPackage).catch(()=>{})}getSelectedWorkPackages(){const P=this.wpTableSelection.getSelectedWorkPackages();return 0===P.length?[this.workPackage]:(-1===P.indexOf(this.workPackage)&&P.push(this.workPackage),P)}buildItems(){const P=this.permittedActions.map(E=>({class:void 0,disabled:!1,linkText:E.text,href:E.href,icon:null!=E.icon?E.icon:`icon-${E.key}`,onClick:T=>(!E.href||!(0,i.F)(T))&&(this.triggerContextMenuAction(E),!0)}));return(0,k.Z)(this.workPackage)||(P.unshift({disabled:!1,icon:"icon-view-fullscreen",class:"openFullScreenView",href:this.$state.href("work-packages.show",{workPackageId:this.workPackageId}),linkText:I18n.t("js.button_open_fullscreen"),onClick:E=>!(0,i.F)(E)&&(this.$state.go("work-packages.show",{workPackageId:this.workPackageId}),!0)}),this.allowSplitScreenActions&&P.unshift({disabled:!1,icon:"icon-view-split",class:"detailsViewMenuItem",href:this.$state.href(`${(0,C.W)(this.$state)}.tabs`,{workPackageId:this.workPackageId,tabIdentifier:"overview"}),linkText:I18n.t("js.button_open_details"),onClick:E=>!(0,i.F)(E)&&(this.$state.go(`${(0,C.W)(this.$state)}.tabs`,{workPackageId:this.workPackageId,tabIdentifier:"overview"}),!0)})),P}}(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",p.G)],b.prototype,"states",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",h.O)],b.prototype,"wpRelationsHierarchyService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",f.S)],b.prototype,"opModalService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",a.StateService)],b.prototype,"$state",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",c.J)],b.prototype,"wpTableSelection",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",e.j)],b.prototype,"WorkPackageContextMenuHelper",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",v.f)],b.prototype,"timeEntryCreateService",void 0),(0,n.gn)([(0,m.W)(),(0,n.w6)("design:type",x.j)],b.prototype,"pathHelper",void 0)},14279:(te,M,t)=>{"use strict";t.d(M,{J:()=>i});var n=t(2316),e=t(26942),p=t(70692),h=t(12877);const c=["dateInput"];class i extends e.N{constructor(r,d,f,a,m){super(),this.injector=r,this.timezoneService=d,this.configurationService=f,this.ngZone=a,this.changeDetectorRef=m,this.canceled=new n.vpe,this.classes="",this.id="",this.name="",this.required=!1,this.size=20,this.disabled=!1,this.id||(this.id=`datepicker-input-${Math.floor(1e3*Math.random()).toString(3)}`)}ngAfterViewInit(){this.initializeDatepicker()}ngOnDestroy(){this.datePickerInstance&&this.datePickerInstance.destroy()}openOnClick(){this.disabled||this.datePickerInstance.show()}closeOnOutsideClick(r){this.isOutsideClick(r)&&this.close()}isOutsideClick(r){return!(r.relatedTarget&&this.datePickerInstance.datepickerInstance.calendarContainer.contains(r.relatedTarget))}close(){this.datePickerInstance.hide()}isEmpty(){return""===this.currentValue.trim()}get currentValue(){var r;return(null===(r=this.inputElement)||void 0===r?void 0:r.value)||""}get inputElement(){return this.dateInput.nativeElement}}i.\u0275fac=function(r){return new(r||i)(n.Y36(n.zs3),n.Y36(p.B),n.Y36(h.e),n.Y36(n.R0b),n.Y36(n.sBO))},i.\u0275dir=n.lG2({type:i,viewQuery:function(r,d){if(1&r&&n.Gf(c,5),2&r){let f;n.iGM(f=n.CRH())&&(d.dateInput=f.first)}},inputs:{appendTo:"appendTo",classes:"classes",id:"id",name:"name",required:"required",size:"size",disabled:"disabled"},outputs:{canceled:"canceled"},features:[n.qOj]})},81496:(te,M,t)=>{"use strict";t.d(M,{I:()=>p});var n=t(54364),e=t(2316);class p{}p.\u0275fac=function(c){return new(c||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({imports:[[n.ez]]})},14882:(te,M,t)=>{"use strict";t.d(M,{M:()=>f});var n=t(3786),e=t(2281),h=t(95926),c=t(12877),i=t(96617),l=t(51590),r=t(29161),d=t(52377);class f{constructor(m,v,C,u,k){this.injector=m,this.datepickerElemIdentifier=v,this.date=C,this.options=u,this.datepickerTarget=k,this.datepickerFormat="Y-m-d",this.datepickerCont=document.querySelector(this.datepickerElemIdentifier),this.hideDuringScroll=x=>{var b,y;const P=x.target;(null===(b=null==P?void 0:P.classList)||void 0===b?void 0:b.contains("flatpickr-monthDropdown-months"))||(null===(y=null==P?void 0:P.classList)||void 0===y?void 0:y.contains("flatpickr-input"))||(this.datepickerInstance.close(),this.reshowTimeout&&clearTimeout(this.reshowTimeout),this.reshowTimeout=setTimeout(()=>{this.visibleAndActive()&&this.datepickerInstance.open()},50))},this.initialize(u)}initialize(m){this.weekdaysPromise=this.weekdaysService.loadWeekdays().toPromise().then(()=>{this.datepickerInstance&&this.datepickerInstance.redraw()});const v=_.extend({},this.defaultOptions,m);let C;C=this.datepickerTarget?(0,h.Z)(this.datepickerTarget,v):(0,h.Z)(this.datepickerElemIdentifier,v),this.datepickerInstance=Array.isArray(C)?C[0]:C,document.addEventListener("scroll",this.hideDuringScroll,!0)}clear(){this.datepickerInstance.clear()}destroy(){this.hide(),this.datepickerInstance.destroy()}hide(){this.isOpen&&this.datepickerInstance.close(),document.removeEventListener("scroll",this.hideDuringScroll,!0)}show(){this.datepickerInstance.open(),document.addEventListener("scroll",this.hideDuringScroll,!0)}setDates(m){this.datepickerInstance.setDate(m)}get isOpen(){return this.datepickerInstance.isOpen}visibleAndActive(){try{return this.isInViewport(this.datepickerCont)&&document.activeElement===this.datepickerCont}catch(m){return console.error(`Failed to test visibleAndActive ${m}`),!1}}isInViewport(m){const v=m.getBoundingClientRect();return v.top>=0&&v.left>=0&&v.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&v.right<=(window.innerWidth||document.documentElement.clientWidth)}get defaultOptions(){const m=this.configurationService.startOfWeek();return{weekNumbers:!0,getWeek:v=>e(v).format("W"),dateFormat:this.datepickerFormat,defaultDate:this.date,locale:{weekdays:{shorthand:this.I18n.t("date.abbr_day_names"),longhand:this.I18n.t("date.day_names")},months:{shorthand:this.I18n.t("date.abbr_month_names").slice(1),longhand:this.I18n.t("date.month_names").slice(1)},firstDayOfWeek:m,weekAbbreviation:this.I18n.t("date.abbr_week"),rangeSeparator:` ${l.e} `}}}}(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",c.e)],f.prototype,"configurationService",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",d.u)],f.prototype,"weekdaysService",void 0),(0,n.gn)([(0,r.W)(),(0,n.w6)("design:type",i.D)],f.prototype,"I18n",void 0)},51590:(te,M,t)=>{"use strict";t.d(M,{e:()=>r,r:()=>d});var n=t(33406),e=t(14882),p=t(14279),h=t(93175),c=t(38519),i=t(2316),l=t(54364);const r="-";class d extends p.J{constructor(){super(...arguments),this.changed=new h.R((0,c.J6)(this)),this.initialDates=[],this.initialValue=""}initializeDatepicker(){this.initialDates=this.initialDates||[],this.initialValue=this.resolveDateArrayToString(this.initialDates);const a={allowInput:!0,appendTo:this.appendTo,mode:"range",onChange:(v,C)=>{this.isEmpty()||(this.inputElement.value=C,2===v.length&&this.changed.emit(this.resolveDateStringToArray(C)))},onKeyDown:(v,C,u,k)=>{k.which===n.m.ESCAPE&&this.canceled.emit()}};let m;m=this.isEmpty()&&this.initialDates.length>0?this.initialDates.map(v=>this.timezoneService.parseISODate(v).toDate()):this.resolveDateStringToArray(this.currentValue),this.datePickerInstance=new e.M(this.injector,`#${this.id}`,m,a,null)}onKeyDown(){return!1}resolveDateStringToArray(a){return a.split(` ${r} `).map(m=>m.trim())}resolveDateArrayToString(a){return a.join(` ${r} `)}}d.\u0275fac=function(){let f;return function(m){return(f||(f=i.n5z(d)))(m||d)}}(),d.\u0275cmp=i.Xpm({type:d,selectors:[["op-range-date-picker"]],inputs:{initialDates:"initialDates"},outputs:{changed:"changed"},features:[i.qOj],decls:2,vars:7,consts:[["type","text",3,"id","name","value","ngClass","size","required","disabled","click","keydown.escape","keydown","blur"],["dateInput",""]],template:function(a,m){1&a&&(i.TgZ(0,"input",0,1),i.NdJ("click",function(){return m.openOnClick()})("keydown.escape",function(){return m.close()})("keydown",function(){return m.onKeyDown()})("blur",function(C){return m.closeOnOutsideClick(C)}),i.qZA()),2&a&&i.Q6J("id",m.id)("name",m.name)("value",m.initialValue)("ngClass",m.classes+" op-input")("size",m.size)("required",m.required)("disabled",m.disabled)},directives:[l.mk],encapsulation:2,changeDetection:0})},90547:(te,M,t)=>{"use strict";t.d(M,{S:()=>r});var n=t(2316),e=t(33406),p=t(14882),h=t(14279),c=t(93175),i=t(38519),l=t(54364);class r extends h.J{constructor(){super(...arguments),this.changed=new c.R((0,i.J6)(this)),this.blurred=new n.vpe,this.enterPressed=new n.vpe,this.initialDate=""}onInputChange(){this.inputIsValidDate()&&this.changed.emit(this.currentValue)}onBlurred(f){this.isOutsideClick(f)&&(this.close(),this.blurred.emit(this.currentValue))}get dateValue(){return this.inputIsValidDate()?this.currentValue:""}inputIsValidDate(){return null!==/\d{4}-\d{2}-\d{2}/.exec(this.currentValue)}initializeDatepicker(){const f={allowInput:!0,appendTo:this.appendTo,onChange:(m,v)=>{const C=v;this.isEmpty()||(this.inputElement.value=C,this.changed.emit(C))},onKeyDown:(m,v,C,u)=>{u.which===e.m.ESCAPE&&this.canceled.emit()}};let a;a=this.isEmpty()&&this.initialDate?this.timezoneService.parseISODate(this.initialDate).toDate():this.currentValue,this.datePickerInstance=new p.M(this.injector,`#${this.id}`,a,f,null)}}r.\u0275fac=function(){let d;return function(a){return(d||(d=n.n5z(r)))(a||r)}}(),r.\u0275cmp=n.Xpm({type:r,selectors:[["op-single-date-picker"]],inputs:{initialDate:"initialDate"},outputs:{changed:"changed",blurred:"blurred",enterPressed:"enterPressed"},features:[n.qOj],decls:2,vars:7,consts:[["type","text",3,"id","name","value","ngClass","size","required","disabled","click","keydown.enter","keydown.escape","input","blur"],["dateInput",""]],template:function(f,a){1&f&&(n.TgZ(0,"input",0,1),n.NdJ("click",function(){return a.openOnClick()})("keydown.enter",function(){return a.enterPressed.emit(a.dateValue)})("keydown.escape",function(){return a.close()})("input",function(){return a.onInputChange()})("blur",function(v){return a.onBlurred(v)}),n.qZA()),2&f&&n.Q6J("id",a.id)("name",a.name)("value",a.initialDate||"")("ngClass",a.classes+" op-input")("size",a.size)("required",a.required)("disabled",a.disabled)},directives:[l.mk],encapsulation:2})},75867:(te,M,t)=>{"use strict";t.d(M,{p:()=>l});var n=t(96617),e=t(70233),p=t(65146),h=t(47775),c=t(96905),i=t(2316);class l{constructor(d,f,a,m,v){this.I18n=d,this.$state=f,this.CurrentProject=a,this.PathHelper=m,this.CurrentUser=v,this.staticQueries=[],this.text={assignee:this.I18n.t("js.work_packages.properties.assignee"),author:this.I18n.t("js.work_packages.properties.author"),created_at:this.I18n.t("js.work_packages.properties.createdAt"),updated_at:this.I18n.t("js.work_packages.properties.updatedAt"),status:this.I18n.t("js.work_packages.properties.status"),work_packages:this.I18n.t("js.label_work_package_plural"),gantt:this.I18n.t("js.timelines.gantt_chart"),latest_activity:this.I18n.t("js.work_packages.default_queries.latest_activity"),created_by_me:this.I18n.t("js.work_packages.default_queries.created_by_me"),assigned_to_me:this.I18n.t("js.work_packages.default_queries.assigned_to_me"),recently_created:this.I18n.t("js.work_packages.default_queries.recently_created"),all_open:this.I18n.t("js.work_packages.default_queries.all_open"),summary:this.I18n.t("js.work_packages.default_queries.summary")},this.staticQueries=this.buildQueries()}getStaticName(d){if(this.$state.params.query_props){const f=JSON.parse(this.$state.params.query_props);delete f.pp,delete f.pa;const a=JSON.stringify(f),m=this.staticQueries.find(v=>{const C=v.uiParams;return C&&C.query_props===a});if(m)return m.title}return 1===d.filters.length&&"status"===d.filters[0].id&&"o"===d.filters[0].operator.id?this.text.all_open:this.text.work_packages}buildQueries(){let d=[{title:this.text.all_open,uiSref:"work-packages",uiParams:{query_id:"",query_props:""},view:"WorkPackagesTable"},{title:this.text.latest_activity,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","subject","type","status","assignee","updatedAt"],"hi":false,"g":"","t":"updatedAt:desc","f":[{"n":"status","o":"o","v":[]}]}'},view:"WorkPackagesTable"},{title:this.text.recently_created,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","subject","type","status","assignee","createdAt"],"hi":false,"g":"","t":"createdAt:desc","f":[{"n":"status","o":"o","v":[]}]}'},view:"WorkPackagesTable"},{title:this.text.gantt,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","type","subject","status","startDate","dueDate","duration"],"tv":true,"tzl":"auto","tll":"{\\"left\\":\\"startDate\\",\\"right\\":\\"dueDate\\",\\"farRight\\":\\"subject\\"}","hi":true,"g":"","t":"startDate:asc","f":[{"n":"status","o":"o","v":[]}]}'},view:"WorkPackagesTable"},{title:this.text.all_open,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","assignee","updatedAt"],"t":"id:desc"}'},view:"Bim"},{title:this.text.latest_activity,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","assignee","updatedAt"],"t":"updatedAt:desc","f":[{"n":"status","o":"o","v":[]}]}'},view:"Bim"},{title:this.text.recently_created,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","assignee","createdAt"],"t":"createdAt:desc","f":[{"n":"status","o":"o","v":[]}]}'},view:"Bim"}];const f=this.CurrentProject.identifier;return f&&(d=[...d,...this.projectDependentQueries(f)]),this.CurrentUser.isLoggedIn&&(d=[...d,...this.userDependentQueries()]),d}getStaticQueriesForView(d){return this.staticQueries.filter(f=>f.view===d)}projectDependentQueries(d){return[{title:this.text.summary,href:`${this.PathHelper.projectWorkPackagesPath(d)}/report`,view:"WorkPackagesTable"}]}userDependentQueries(){return[{title:this.text.created_by_me,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","subject","type","status","assignee","updatedAt"],"hi":false,"g":"","t":"updatedAt:desc,id:asc","f":[{"n":"status","o":"o","v":[]},{"n":"author","o":"=","v":["me"]}]}'},view:"WorkPackagesTable"},{title:this.text.assigned_to_me,uiSref:"work-packages",uiParams:{query_id:"",query_props:'{"c":["id","subject","type","status","author","updatedAt"],"hi":false,"g":"","t":"updatedAt:desc,id:asc","f":[{"n":"status","o":"o","v":[]},{"n":"assigneeOrGroup","o":"=","v":["me"]}]}'},view:"WorkPackagesTable"},{title:this.text.created_by_me,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","assignee","updatedAt"],"t":"id:desc","f":[{"n":"status","o":"o","v":[]},{"n":"author","o":"=","v":["me"]}]}'},view:"Bim"},{title:this.text.assigned_to_me,uiSref:"bim.partitioned.list",uiParams:{query_id:"",query_props:'{"c":["id","subject","bcfThumbnail","type","status","author","updatedAt"],"t":"id:desc","f":[{"n":"status","o":"o","v":[]},{"n":"assigneeOrGroup","o":"=","v":["me"]}]}'},view:"Bim"}]}}l.\u0275fac=function(d){return new(d||l)(i.LFG(n.D),i.LFG(h.StateService),i.LFG(p.R),i.LFG(e.j),i.LFG(c.S))},l.\u0275prov=i.Yz7({token:l,factory:l.\u0275fac})},32782:(te,M,t)=>{"use strict";t.d(M,{C:()=>r});var n=t(70233),e=t(52167),p=t(33276),h=t(10190);function c(d){return d.href?d.href||"":d._links&&d._links.self.href||""}var l=t(2316);class r{constructor(f,a,m){this.pathHelper=f,this.apiV3Service=a,this.colors=m}renderMultiple(f,a,m={hide:!1,link:!1},v={hide:!1,size:"default"},C=!1){f.classList.add("op-principal");const u=document.createElement("span");for(let k=0;k<a.length;k++){const x=document.createElement("span");if(C&&x.classList.add("op-principal--multi-line"),this.render(x,a[k],m,v),u.appendChild(x),!C&&k<a.length-1){const b=document.createElement("span");b.textContent=", ",u.appendChild(b)}}f.appendChild(u)}render(f,a,m={hide:!1,link:!0},v={hide:!1,size:"default"}){f.classList.add("op-principal");const C=function(d){const f=/\/(user|group|placeholder_user|external_user)s\/\d+$/.exec(d);return f?f[1]:null}(c(a));if(!v.hide){const u=this.renderAvatar(a,v,C);f.appendChild(u)}if(!m.hide){const u=this.renderName(a,C,m.link);f.appendChild(u)}}renderAvatar(f,a,m){const v=this.getInitials(f.name),C=this.colors.toHsl(f.name),u=document.createElement("div");return u.classList.add("op-principal--avatar"),u.classList.add("op-avatar"),u.classList.add(`op-avatar_${a.size}`),u.classList.add(`op-avatar_${m.replace("_","-")}`),u.classList.add("op-avatar--fallback"),u.title=f.name,u.textContent=v,"placeholder_user"===m?(u.style.color=C,u.style.borderColor=C):u.style.background=C,"user"===m&&this.renderUserAvatar(f,u,a),u}renderUserAvatar(f,a,m){const v=this.userAvatarUrl(f);if(!v)return;const C=new Image;C.classList.add("op-avatar"),C.classList.add(`op-avatar_${m.size}`),C.src=v,C.title=f.name,C.alt=f.name,C.onload=()=>{a.replaceWith(C),a=void 0}}userAvatarUrl(f){const a=f.id||(0,h.Z)(c(f));return a?this.apiV3Service.users.id(a).avatar.toString():null}renderName(f,a,m=!0){if(m){const C=document.createElement("a");return C.textContent=f.name,C.href=this.principalURL(f,a),C.target="_blank",C.classList.add("op-principal--name"),C}const v=document.createElement("span");return v.textContent=f.name,v.classList.add("op-principal--name"),v}principalURL(f,a){const m=c(f),v=f.id||(m?(0,h.Z)(m):"");switch(a){case"group":return this.pathHelper.groupPath(v);case"placeholder_user":return this.pathHelper.placeholderUserPath(v);case"user":return this.pathHelper.userPath(v);default:throw new Error("Invalid principal type provided")}}getInitials(f){var a,m;const v=[...f],C=f.lastIndexOf(" ");return[null===(a=v[0])||void 0===a?void 0:a.toUpperCase(),null===(m=f[C+1])||void 0===m?void 0:m.toUpperCase()].join("")}}r.\u0275fac=function(f){return new(f||r)(l.LFG(n.j),l.LFG(p.T),l.LFG(e.c))},r.\u0275prov=l.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})},32824:(te,M,t)=>{"use strict";t.d(M,{j:()=>h});var n=t(54364),e=t(32782),p=t(2316);class h{}h.\u0275fac=function(i){return new(i||h)},h.\u0275mod=p.oAB({type:h}),h.\u0275inj=p.cJS({providers:[e.C],imports:[[n.ez]]})},3742:(te,M,t)=>{"use strict";t.d(M,{y:()=>d,N:()=>f});var n=t(96617),e=t(70233),p=t(33276),h=t(70692),c=t(32782),i=t(45410),l=t(96457),r=t(2316);const d="op-principal";class f{constructor(m,v,C,u,k,x,b){this.elementRef=m,this.PathHelper=v,this.principalRenderer=C,this.principalResourceService=u,this.I18n=k,this.apiV3Service=x,this.timezoneService=b,this.hideAvatar=!1,this.hideName=!1,this.link=!0,this.size="default",(0,i.E)(this)}ngOnInit(){!this.principal.name||this.principalRenderer.render(this.elementRef.nativeElement,this.principal,{hide:this.hideName,link:this.link},{hide:this.hideAvatar,size:this.size})}}f.\u0275fac=function(m){return new(m||f)(r.Y36(r.SBq),r.Y36(e.j),r.Y36(c.C),r.Y36(l.P),r.Y36(n.D),r.Y36(p.T),r.Y36(h.B))},f.\u0275cmp=r.Xpm({type:f,selectors:[["op-principal"]],inputs:{principal:"principal",hideAvatar:"hideAvatar",hideName:"hideName",link:"link",size:"size"},decls:0,vars:0,template:function(m,v){},encapsulation:2,changeDetection:0})},19028:(te,M,t)=>{"use strict";t.d(M,{r:()=>e});const e=(p,h,c,i)=>{const l=i.filter(a=>"urn:openproject-org:api:v3:undisclosed"!==a.href);if(!l.length)return[...c,{id:h.id,name:h.name,href:h._links.self.href,disabled:!1,children:[]}];const r=l[0].href,d=c.find(a=>a.href===r);if(d)return d.children=e(p,h,d.children,l.slice(1)),[...c];const f=p.find(a=>a._links.self.href===r);return f?[...c,{id:f.id,name:f.name,href:f._links.self.href,disabled:!0,children:e(p,h,[],l.slice(1))}]:[...c]}},74097:(te,M,t)=>{"use strict";t.d(M,{P:()=>D});var n=t(96617),e=t(76491),p=t(61486),h=t(33927),c=t(83720),i=t(80639),l=t(85816),r=t(53466),d=t(92597),f=t(9170),a=t(74647),m=t(20066),v=t(26942),C=t(91923),u=t(65146),k=t(48193),x=t(19028),b=t(75423),y=t(2316),P=t(21090),E=t(54364),T=t(1707);const O=function(G,V){return{button:!0,"-disabled":G,"form--field-inline-button":!0,"-active":V,"spot-toggle--button":!0}};function I(G,V){if(1&G){const me=y.EpF();y.TgZ(0,"label",1),y.TgZ(1,"input",2),y.NdJ("ngModelChange",function(Se){return y.CHM(me),y.oxw().onToggle(Se)}),y.qZA(),y._uU(2),y.qZA()}if(2&G){const me=V.$implicit,$=y.oxw();y.Q6J("ngClass",y.WLB(8,O,$.disabled,$.value===me.value)),y.uIk("data-qa-disabled",$.disabled||void 0)("data-qa-active-toggle",$.value===me.value),y.xp6(1),y.Q6J("disabled",$.disabled)("name",$.name)("value",me.value)("ngModel",$.value),y.xp6(1),y.hij(" ",me.title,"\n")}}class Z{constructor(V){this.cdRef=V,this.classNameOld=!0,this.className=!0,this.options=[],this.disabled=!1,this.name="spot-toggle-"+ +new Date,this.valueChange=new y.vpe,this.onChange=me=>{},this.onTouched=me=>{}}writeValue(V){this.value=V,this.cdRef.markForCheck()}onToggle(V){this.writeValue(V),this.onChange(V),this.onTouched(V)}registerOnChange(V){this.onChange=V}registerOnTouched(V){this.onTouched=V}}Z.\u0275fac=function(V){return new(V||Z)(y.Y36(y.sBO))},Z.\u0275cmp=y.Xpm({type:Z,selectors:[["spot-toggle"]],hostVars:4,hostBindings:function(V,me){2&V&&y.ekj("form--field-inline-buttons-container",me.classNameOld)("spot-toggle",me.className)},inputs:{options:"options",disabled:"disabled",name:"name",value:"value"},outputs:{valueChange:"valueChange"},features:[y._Bn([{provide:T.JU,useExisting:(0,y.Gpc)(()=>Z),multi:!0}])],decls:1,vars:1,consts:[["data-qa-selector","spot-toggle--option",3,"ngClass",4,"ngFor","ngForOf"],["data-qa-selector","spot-toggle--option",3,"ngClass"],["type","radio",1,"spot-toggle--option-input",3,"disabled","name","value","ngModel","ngModelChange"]],template:function(V,me){1&V&&y.YNc(0,I,3,11,"label",0),2&V&&y.Q6J("ngForOf",me.options)},directives:[E.sg,E.mk,T._,T.Fj,T.JJ,T.On],encapsulation:2,changeDetection:0});var j=t(87912),B=t(1476),J=t(1706),R=t(70233),F=t(48705),Y=t(93713);function K(G,V){if(1&G&&(y.TgZ(0,"span"),y._uU(1),y.qZA()),2&G){const me=y.oxw(2);y.xp6(1),y.Oqu(me.text.current_project)}}function ie(G,V){if(1&G&&(y.TgZ(0,"span"),y._uU(1),y.qZA()),2&G){const me=y.oxw(3);y.xp6(1),y.Oqu(me.text.include_all_selected)}}function H(G,V){if(1&G&&(y.TgZ(0,"span"),y._uU(1),y.qZA()),2&G){const me=y.oxw(4);y.xp6(1),y.Oqu(me.text.does_not_match_search)}}function ee(G,V){if(1&G&&y.YNc(0,H,2,1,"span",12),2&G){const me=y.oxw(2).$implicit;y.Q6J("ngIf",me.disabled)}}function ce(G,V){if(1&G&&(y.YNc(0,ie,2,1,"span",8),y.YNc(1,ee,1,1,"ng-template",null,11,y.W1O)),2&G){const me=y.MAs(2),$=y.oxw(2);y.Q6J("ngIf",$.includeSubprojects&&$.parentChecked)("ngIfElse",me)}}function se(G,V){if(1&G){const me=y.EpF();y.TgZ(0,"ul",13),y.NdJ("update",function(Se){return y.CHM(me),y.oxw(2).updateList(Se)}),y.qZA()}if(2&G){const me=y.oxw().$implicit,$=y.oxw();y.Q6J("projects",me.children)("selected",$.selected)("includeSubprojects",$.includeSubprojects)("parentChecked",$.parentChecked||$.isChecked(me.href))("searchText",$.searchText)}}const re=function(G,V){return{"spot-list--item-action_disabled":G,"spot-list--item-action_active":V}};function Me(G,V){if(1&G){const me=y.EpF();y.TgZ(0,"li",1),y.TgZ(1,"spot-tooltip",2),y.ynx(2,3),y.TgZ(3,"label",4),y.NdJ("keydown.space",function(){const ot=y.CHM(me).$implicit;return y.oxw().changeSelected(ot)}),y.ALo(4,"async"),y.TgZ(5,"spot-checkbox",5),y.NdJ("change",function(){const ot=y.CHM(me).$implicit;return y.oxw().changeSelected(ot)}),y.qZA(),y.TgZ(6,"div",6),y._uU(7),y.qZA(),y.qZA(),y.BQk(),y.TgZ(8,"p",7),y.YNc(9,K,2,1,"span",8),y.YNc(10,ce,3,2,"ng-template",null,9,y.W1O),y.qZA(),y.qZA(),y.YNc(12,se,1,5,"ul",10),y.qZA()}if(2&G){const me=V.$implicit,$=V.first,Se=y.MAs(11),ot=y.oxw();y.uIk("data-list-selector",ot.projectListItemIdentifier),y.xp6(1),y.Q6J("alignment",ot.getTooltipAlignment($))("disabled",!me.disabled)("dark",!0),y.xp6(2),y.Q6J("ngClass",y.WLB(20,re,me.disabled,y.lcZ(4,18,ot.searchableProjectListService.activeItemID$)===me.id)),y.uIk("data-list-selector",ot.projectListActionIdentifier)("data-list-disabled",me.disabled||void 0),y.xp6(2),y.Q6J("tabindex",-1)("checked",ot.isChecked(me.href)||ot.includeSubprojects&&ot.parentChecked)("disabled",me.disabled),y.uIk("data-qa-project-include-id",me.id)("data-qa-project-include-checked",ot.isChecked(me.href)||ot.includeSubprojects&&ot.parentChecked?1:0),y.xp6(1),y.Q6J("opSearchHighlight",ot.searchText)("title",me.name),y.xp6(1),y.Oqu(me.name),y.xp6(2),y.Q6J("ngIf",me.href===ot.currentProjectHref)("ngIfElse",Se),y.xp6(3),y.Q6J("ngIf",me.children.length)}}class Ae{constructor(V,me,$,Se){this.I18n=V,this.currentProjectService=me,this.pathHelper=$,this.searchableProjectListService=Se,this.classNameList=!0,this.className=!0,this.update=new y.vpe,this.root=!1,this.projects=[],this.selected=[],this.searchText="",this.includeSubprojects=!1,this.parentChecked=!1,this.text={does_not_match_search:this.I18n.t("js.include_projects.tooltip.does_not_match_search"),include_all_selected:this.I18n.t("js.include_projects.tooltip.include_all_selected"),current_project:this.I18n.t("js.include_projects.tooltip.current_project")}}get currentProjectHref(){return this.currentProjectService.apiv3Path}updateList(V){this.update.emit(V)}isChecked(V){return this.selected.includes(V)}changeSelected(V){if(V.disabled)return;const{href:me}=V;this.isChecked(me)?this.updateList(this.selected.filter(Se=>Se!==me)):this.updateList([...this.selected,me])}getTooltipAlignment(V){return this.root&&V?J.Z.BottomLeft:J.Z.TopLeft}extendedProjectUrl(V){const me=document.querySelector('meta[name="current_menu_item"]'),$=this.pathHelper.projectPath(V);return me?`${$}?jump=${encodeURIComponent(me.content)}`:$}}Ae.\u0275fac=function(V){return new(V||Ae)(y.Y36(n.D),y.Y36(u.R),y.Y36(R.j),y.Y36(k.O))},Ae.\u0275cmp=y.Xpm({type:Ae,selectors:[["","op-project-include-list",""]],hostVars:6,hostBindings:function(V,me){2&V&&y.ekj("spot-list",me.classNameList)("op-project-include-list",me.className)("op-project-include-list--root",me.root)},inputs:{root:"root",projects:"projects",selected:"selected",searchText:"searchText",includeSubprojects:"includeSubprojects",parentChecked:"parentChecked"},outputs:{update:"update"},attrs:["op-project-include-list",""],decls:1,vars:1,consts:[["class","spot-list--item op-project-include-list--item","data-qa-selector","op-project-include-list--item",4,"ngFor","ngForOf"],["data-qa-selector","op-project-include-list--item",1,"spot-list--item","op-project-include-list--item"],[1,"op-project-include-list--tooltip",3,"alignment","disabled","dark"],["slot","trigger"],["tabindex","-1",1,"spot-list--item-action","op-project-include-list--item-action",3,"ngClass","keydown.space"],[3,"tabindex","checked","disabled","change"],["data-qa-selector","op-project-include-list--item-title",1,"spot-list--item-title","spot-list--item-title_ellipse-text",3,"opSearchHighlight","title"],["slot","body",1,"spot-body-small"],[4,"ngIf","ngIfElse"],["otherMessages",""],["op-project-include-list","",3,"projects","selected","includeSubprojects","parentChecked","searchText","update",4,"ngIf"],["searchMatch",""],[4,"ngIf"],["op-project-include-list","",3,"projects","selected","includeSubprojects","parentChecked","searchText","update"]],template:function(V,me){1&V&&y.YNc(0,Me,13,23,"li",0),2&V&&y.Q6J("ngForOf",me.projects)},directives:[E.sg,F.s,E.mk,B.B,Y.U,E.O5,Ae],pipes:[E.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}[_nghost-%COMP%], .op-project-include-list[_ngcontent-%COMP%]{flex-shrink:1;flex-basis:100%}.op-project-include-list--root[_nghost-%COMP%], .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]{overflow-y:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.op-project-include-list--root[_nghost-%COMP%]::-webkit-scrollbar, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.op-project-include-list--root[_nghost-%COMP%]::-webkit-scrollbar-track, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.op-project-include-list--root[_nghost-%COMP%]::-webkit-scrollbar-thumb, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.op-project-include-list--root[_nghost-%COMP%]:hover, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.op-project-include-list--root[_nghost-%COMP%]:hover::-webkit-scrollbar-thumb, .op-project-include-list.op-project-include-list--root[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}--tooltip[_nghost-%COMP%], .op-project-include-list--tooltip[_ngcontent-%COMP%]{max-width:100%}"],changeDetection:0});var Ye=t(58);function ze(G,V){if(1&G&&y._UZ(0,"span",9),2&G){const me=V.ngIf;y.Q6J("textContent",me)}}const Xe=function(G){return{"spot-list_active":G}};function it(G,V){if(1&G){const me=y.EpF();y.TgZ(0,"ul",24),y.NdJ("update",function(Se){y.CHM(me);return y.oxw(3).selectedProjects=Se}),y.ALo(1,"async"),y.qZA()}if(2&G){const me=y.oxw(2).ngIf,$=y.oxw();y.Q6J("ngClass",y.VKq(8,Xe,$.textFieldFocused))("projects",me)("selected",$.selectedProjects)("includeSubprojects",y.lcZ(1,6,$.includeSubprojects$))("searchText",$.searchableProjectListService.searchText)("root",!0)}}function at(G,V){if(1&G&&(y.TgZ(0,"span",25),y._uU(1),y.qZA()),2&G){const me=y.oxw(3);y.xp6(1),y.hij(" ",me.text.no_results," ")}}function lt(G,V){if(1&G&&(y.ynx(0),y.YNc(1,it,2,10,"ul",22),y.YNc(2,at,2,1,"ng-template",null,23,y.W1O),y.BQk()),2&G){const me=y.MAs(3),$=y.oxw().ngIf;y.xp6(1),y.Q6J("ngIf",$.length>0)("ngIfElse",me)}}const dt=function(){return{standalone:!0}};function de(G,V){if(1&G){const me=y.EpF();y.TgZ(0,"form",10),y.NdJ("submit",function(Se){return y.CHM(me),y.oxw().onSubmit(Se)}),y.TgZ(1,"spot-text-field",11),y.NdJ("ngModelChange",function(Se){y.CHM(me);return y.oxw().searchableProjectListService.searchText=Se})("keydown",function(Se){const st=y.CHM(me).ngIf;return y.oxw().searchableProjectListService.onKeydown(Se,st)})("inputFocus",function(){y.CHM(me);return y.oxw().textFieldFocused=!0})("inputBlur",function(){y.CHM(me);return y.oxw().textFieldFocused=!1}),y._UZ(2,"span",12),y.qZA(),y.YNc(3,lt,4,2,"ng-container",13),y.ALo(4,"async"),y.TgZ(5,"div",14),y.TgZ(6,"div",15),y.TgZ(7,"label",16),y.TgZ(8,"spot-checkbox",17),y.NdJ("ngModelChange",function(Se){y.CHM(me);return y.oxw().includeSubprojects=Se}),y.qZA(),y.TgZ(9,"span",18),y._uU(10),y.qZA(),y.qZA(),y.qZA(),y.TgZ(11,"div",19),y.TgZ(12,"button",20),y.NdJ("click",function(){return y.CHM(me),y.oxw().clearSelection()}),y.ALo(13,"async"),y._uU(14),y.qZA(),y.TgZ(15,"button",21),y.ALo(16,"async"),y._uU(17),y.qZA(),y.qZA(),y.qZA(),y.qZA()}if(2&G){const me=y.oxw(),$=y.MAs(13);y.xp6(1),y.Q6J("placeholder",me.text.search_placeholder)("ngModel",me.searchableProjectListService.searchText)("ngModelOptions",y.DdM(18,dt)),y.xp6(2),y.Q6J("ngIf",!1===y.lcZ(4,12,me.loading$))("ngIfElse",$),y.xp6(5),y.Q6J("ngModel",me.includeSubprojects)("ngModelOptions",y.DdM(19,dt)),y.xp6(2),y.Oqu(me.text.include_subprojects),y.xp6(2),y.Q6J("disabled",y.lcZ(13,14,me.loading$)),y.xp6(2),y.hij(" ",me.text.clear_selection," "),y.xp6(1),y.Q6J("disabled",y.lcZ(16,16,me.loading$)),y.xp6(2),y.hij(" ",me.text.apply," ")}}function oe(G,V){1&G&&y._UZ(0,"op-loading-project-list",26)}class D extends v.N{constructor(V,me,$,Se,ot,st){super(),this.I18n=V,this.wpTableFilters=me,this.wpIncludeSubprojects=$,this.halResourceService=Se,this.currentProjectService=ot,this.searchableProjectListService=st,this.className=!0,this.text={toggle_title:this.I18n.t("js.include_projects.toggle_title"),title:this.I18n.t("js.include_projects.title"),filter_all:this.I18n.t("js.include_projects.selected_filter.all"),filter_selected:this.I18n.t("js.include_projects.selected_filter.selected"),search_placeholder:this.I18n.t("js.include_projects.search_placeholder"),clear_selection:this.I18n.t("js.include_projects.clear_selection"),apply:this.I18n.t("js.include_projects.apply"),include_subprojects:this.I18n.t("js.include_projects.include_subprojects"),no_results:this.I18n.t("js.include_projects.no_results")},this.opened=!1,this.textFieldFocused=!1,this.query$=this.wpTableFilters.querySpace.query.values$(),this.displayModeOptions=[{value:"all",title:this.text.filter_all},{value:"selected",title:this.text.filter_selected}],this._displayMode="all",this.displayMode$=new e.X("all"),this._includeSubprojects=!0,this.includeSubprojects$=new e.X(!0),this._selectedProjects=[],this.selectedProjects$=new e.X([]),this.projectsInFilter$=this.wpTableFilters.live$().pipe(this.untilDestroyed(),(0,h.U)(he=>{const ye=he.find(Ve=>"ProjectQueryFilter"===Ve._type),xe=((null==ye?void 0:ye.values)||[]).map(Ve=>Ve.href),De=this.currentProjectService.apiv3Path;if(xe.includes(De))return xe;const Qe=[...xe];return De&&Qe.push(De),Qe})),this.numberOfProjectsInFilter$=this.projectsInFilter$.pipe((0,h.U)(he=>he.length)),this.projects$=(0,p.aj)([this.searchableProjectListService.allProjects$,this.displayMode$.pipe((0,c.x)()),this.includeSubprojects$.pipe((0,i.b)(20)),this.searchableProjectListService.searchText$.pipe((0,i.b)(200))]).pipe((0,l.zg)(([he,ye,xe,De])=>this.selectedProjects$.pipe((0,r.q)(1),(0,h.U)(Qe=>[he,ye,xe,De,Qe]))),(0,h.U)(([he,ye,xe,De,Qe])=>[he.filter(Ve=>{if(De.length&&!Ve.name.toLowerCase().includes(De.toLowerCase()))return!1;if("selected"!==ye||Qe.includes(Ve._links.self.href))return!0;const nt=Ve._links.ancestors.reduce((mt,Ue)=>mt||Qe.includes(Ue.href),!1);return!(!xe||!nt)}).sort((Ve,nt)=>Ve._links.ancestors.length-nt._links.ancestors.length).reduce((Ve,nt)=>{const{ancestors:mt}=nt._links;return(0,x.r)(he,nt,Ve,mt)},[]),xe]),(0,l.zg)(([he,ye])=>this.selectedProjects$.pipe((0,h.U)(xe=>[he,ye,xe]))),(0,h.U)(([he,ye,xe])=>{const De=(Ve,nt)=>!(!Ve.disabled&&Ve.href!==this.currentProjectService.apiv3Path)||ye&&nt,Qe=(Ve,nt)=>Object.assign(Object.assign({},Ve),{disabled:De(Ve,nt),children:Ve.children.map(mt=>Qe(mt,nt||xe.includes(Ve.href)))});return he.map(Ve=>Qe(Ve,!1))}),(0,h.U)(he=>(0,b.V)(he)),(0,d.d)()),this.loading$=this.searchableProjectListService.fetchingProjects$.pipe((0,f.h)(he=>he),(0,r.q)(1),(0,l.zg)(()=>this.projects$),(0,l.zg)(()=>this.searchableProjectListService.fetchingProjects$)),this.projects$.pipe(this.untilDestroyed(),(0,f.h)(he=>he.length>0),(0,r.q)(1)).subscribe(he=>{this.searchableProjectListService.resetActiveResult(he)})}get displayMode(){return this._displayMode}set displayMode(V){this._displayMode=V,this.displayMode$.next(V)}get includeSubprojects(){return this._includeSubprojects}set includeSubprojects(V){this._includeSubprojects=V,this.includeSubprojects$.next(V)}get selectedProjects(){return this._selectedProjects}set selectedProjects(V){this._selectedProjects=V,this.selectedProjects$.next(V)}ngOnInit(){this.query$.pipe((0,h.U)(V=>V.includeSubprojects),(0,c.x)()).subscribe(V=>{this.includeSubprojects=V})}toggleIncludeSubprojects(){this.wpIncludeSubprojects.setIncludeSubprojects(!this.wpIncludeSubprojects.current)}toggleOpen(){this.opened=!this.opened,this.opened&&(this.searchableProjectListService.loadAllProjects(),this.projectsInFilter$.pipe((0,r.q)(1)).subscribe(V=>{this.displayMode="all",this.searchableProjectListService.searchText="",this.selectedProjects=V}))}clearSelection(){this.selectedProjects=[this.currentProjectService.apiv3Path||""]}onSubmit(V){V.preventDefault(),this.wpTableFilters.replace("project",me=>{const $=this.selectedProjects;me.values=$.map(Se=>this.halResourceService.createHalResource({href:Se},!0))}),this.wpIncludeSubprojects.update(this.includeSubprojects),this.close()}close(){this.opened=!1}}D.\u0275fac=function(V){return new(V||D)(y.Y36(n.D),y.Y36(a.Z),y.Y36(m.F),y.Y36(C.u),y.Y36(u.R),y.Y36(k.O))},D.\u0275cmp=y.Xpm({type:D,selectors:[["op-project-include"]],hostVars:2,hostBindings:function(V,me){2&V&&y.ekj("op-project-include",me.className)},features:[y._Bn([k.O]),y.qOj],decls:14,vars:12,consts:[["alignment","bottom-right","data-searchable-list-parent","true",1,"op-project-list-modal",3,"open","closed"],["slot","trigger","type","button","data-qa-selector","project-include-button",1,"button",3,"title","click"],["class","badge -secondary",3,"textContent",4,"ngIf"],["slot","body"],[1,"op-project-list-modal--header","op-project-include--header"],[1,"op-project-list-modal--title"],[3,"options","ngModel","ngModelChange"],["class","spot-container op-project-list-modal--body",3,"submit",4,"ngIf"],["loadingTemplate",""],[1,"badge","-secondary",3,"textContent"],[1,"spot-container","op-project-list-modal--body",3,"submit"],["name","project-include-search","data-qa-selector","project-include-search","data-list-focus-catcher-container","true","data-modal-focus-catcher-container","true",3,"placeholder","ngModel","ngModelOptions","ngModelChange","keydown","inputFocus","inputBlur"],["slot","before",1,"spot-icon","spot-icon_search"],[4,"ngIf","ngIfElse"],[1,"spot-action-bar"],[1,"spot-action-bar--left"],[1,"op-project-include--include-all","spot-action-bar--action"],["data-qa-project-include-all-subprojects","1",3,"ngModel","ngModelOptions","ngModelChange"],[1,"op-project-include--include-all-text"],[1,"spot-action-bar--right"],["type","button",1,"button","spot-action-bar--action",3,"disabled","click"],[1,"button","-highlight","spot-action-bar--action",3,"disabled"],["class","op-project-include--list","op-project-include-list","","data-qa-selector","project-include-list","data-list-root","true",3,"ngClass","projects","selected","includeSubprojects","searchText","root","update",4,"ngIf","ngIfElse"],["noResultsTemplate",""],["op-project-include-list","","data-qa-selector","project-include-list","data-list-root","true",1,"op-project-include--list",3,"ngClass","projects","selected","includeSubprojects","searchText","root","update"],[1,"op-project-list-modal--no-results"],["data-qa-selector","op-project-include--loading",1,"op-project-list-modal--loading"]],template:function(V,me){1&V&&(y.TgZ(0,"spot-drop-modal",0),y.NdJ("closed",function(){return me.opened=!1}),y.TgZ(1,"button",1),y.NdJ("click",function(){return me.toggleOpen()}),y._uU(2),y.YNc(3,ze,1,1,"span",2),y.ALo(4,"async"),y.qZA(),y.ynx(5,3),y.TgZ(6,"div",4),y.TgZ(7,"h1",5),y._uU(8),y.qZA(),y.TgZ(9,"spot-toggle",6),y.NdJ("ngModelChange",function(Se){return me.displayMode=Se}),y.qZA(),y.qZA(),y.YNc(10,de,18,20,"form",7),y.ALo(11,"async"),y.BQk(),y.YNc(12,oe,1,0,"ng-template",null,8,y.W1O),y.qZA()),2&V&&(y.Q6J("open",me.opened),y.xp6(1),y.Q6J("title",me.text.toggle_title),y.xp6(1),y.hij(" ",me.text.toggle_title," "),y.xp6(1),y.Q6J("ngIf",y.lcZ(4,8,me.numberOfProjectsInFilter$)),y.xp6(5),y.Oqu(me.text.title),y.xp6(1),y.Q6J("options",me.displayModeOptions)("ngModel",me.displayMode),y.xp6(1),y.Q6J("ngIf",y.lcZ(11,10,me.projects$)))},directives:[P.m,E.O5,Z,T.JJ,T.On,T._Y,T.JL,T.F,j.A,B.B,Ae,E.mk,Ye.a],pipes:[E.Ov],styles:[".op-project-include--include-all[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}.op-project-include--include-all-text[_ngcontent-%COMP%]{padding-top:1px;margin-left:.5rem}.op-project-include--list[_ngcontent-%COMP%]{min-height:7rem}"],changeDetection:0})},75423:(te,M,t)=>{"use strict";t.d(M,{V:()=>n});const n=e=>e.map(p=>Object.assign(Object.assign({},p),{children:n(p.children)})).sort((p,h)=>p.name.localeCompare(h.name))},83609:(te,M,t)=>{"use strict";t.d(M,{d:()=>i});var n=t(2316),e=t(87873),p=t(54364);function h(l,r){if(1&l&&n._UZ(0,"div",1),2&l){const d=n.oxw();n.Q6J("ngClass",d.resizerClass)}}class i{constructor(){this.resizing=!1,this.end=new n.vpe,this.start=new n.vpe,this.move=new n.vpe,this.customHandler=!1,this.cursorClass="nwse-resize",this.resizerClass="resizer"}ngOnDestroy(){this.removeEventListener()}startResize(r){r.preventDefault(),r.stopPropagation(),(1===r.buttons||1===r.which||0===r.which)&&(this.oldX=this.startX=r.clientX||r.pageX||r.touches[0].clientX,this.oldY=this.startY=r.clientY||r.pageY||r.touches[0].clientY,this.newX=r.clientX||r.pageX||r.touches[0].clientX,this.newY=r.clientY||r.pageY||r.touches[0].clientY,this.resizing=!0,this.setResizeCursor(),this.bindEventListener(r),this.start.emit(this.buildDelta(r)))}onMouseUp(r){this.setAutoCursor(),this.removeEventListener(),this.end.emit(this.buildDelta(r))}onMouseMove(r){r.preventDefault(),r.stopPropagation(),this.oldX=this.newX,this.oldY=this.newY,this.newX=r.clientX||r.pageX||r.touches[0].clientX,this.newY=r.clientY||r.pageY||r.touches[0].clientX,this.move.emit(this.buildDelta(r))}bindEventListener(r){this.mouseMoveHandler=this.onMouseMove.bind(this),this.mouseUpHandler=this.onMouseUp.bind(this),window.addEventListener("mousemove",this.mouseMoveHandler),window.addEventListener("touchmove",this.mouseMoveHandler),window.addEventListener("mouseup",this.mouseUpHandler),window.addEventListener("touchend",this.mouseUpHandler)}removeEventListener(){window.removeEventListener("touchmove",this.mouseMoveHandler),window.removeEventListener("mousemove",this.mouseMoveHandler),window.removeEventListener("mouseup",this.mouseUpHandler),window.removeEventListener("touchend",this.mouseUpHandler)}setResizeCursor(){(0,e.h)(this.cursorClass,"important")}setAutoCursor(){(0,e.h)("auto")}buildDelta(r){return{origin:r,absolute:{x:this.newX-this.startX,y:this.newY-this.startY},relative:{x:this.newX-this.oldX,y:this.newY-this.oldX}}}}i.\u0275fac=function(r){return new(r||i)},i.\u0275cmp=n.Xpm({type:i,selectors:[["resizer"]],hostBindings:function(r,d){1&r&&n.NdJ("mousedown",function(a){return d.startResize(a)})("touchstart",function(a){return d.startResize(a)})},inputs:{customHandler:"customHandler",cursorClass:"cursorClass",resizerClass:"resizerClass"},outputs:{end:"end",start:"start",move:"move"},ngContentSelectors:["*"],decls:2,vars:1,consts:[[3,"ngClass",4,"ngIf"],[3,"ngClass"]],template:function(r,d){1&r&&(n.F$t(),n.YNc(0,h,1,1,"div",0),n.Hsn(1)),2&r&&n.Q6J("ngIf",!d.customHandler)},directives:[p.O5,p.mk],encapsulation:2})},87947:(te,M,t)=>{"use strict";t.d(M,{H:()=>f});var n=t(83720),e=t(80639),p=t(47775),h=t(1056),c=t(26942),i=t(82516),l=t(83835),r=t(2316),d=t(83609);class f extends c.N{constructor(m,v,C,u){super(),this.toggleService=m,this.elementRef=v,this.$transitions=C,this.browserDetector=u,this.resizeStyle="flexBasis",this.elementMinWidth=530,this.moving=!1,this.resizerClass="work-packages--resizer icon-resizer-vertical-lines"}ngOnInit(){this.resizingElement=document.getElementsByClassName(this.elementClass)[0];const m=this.parseLocalStorageValue();this.elementWidth=m||(this.resizingElement.offsetWidth<this.elementMinWidth?this.elementMinWidth:this.resizingElement.offsetWidth),0===this.elementWidth&&this.resizingElement.parentElement&&(this.elementWidth=this.resizingElement.parentElement.offsetWidth/2),this.resizingElement.style[this.resizeStyle]=`${this.elementWidth}px`,this.element=this.elementRef.nativeElement,this.toggleService.changeData$.pipe((0,n.x)(),this.untilDestroyed(),(0,e.b)(100)).subscribe(()=>{this.applyColumnLayout()}),(0,i.R)(window,"resize",{passive:!0}).pipe(this.untilDestroyed(),(0,e.b)(250)).subscribe(()=>this.applyColumnLayout())}ngAfterViewInit(){this.resizer=this.elementRef.nativeElement.getElementsByClassName(this.resizerClass)[0],this.applyColumnLayout()}ngOnDestroy(){super.ngOnDestroy(),this.resizingElement.style[this.resizeStyle]=""}resizeStart(){const m=this.parseLocalStorageValue(),v=this.resizingElement.offsetWidth;m&&m>v&&(this.elementWidth=v)}resizeEnd(){const m=this.parseLocalStorageValue();m&&(this.elementWidth=m);const v=new Event(this.resizeEvent);window.dispatchEvent(v),this.manageErrorClass(!1)}resizeMove(m){let v;this.elementWidth-=m.relative.x,this.elementWidth<this.elementMinWidth?(v=this.elementMinWidth,this.manageErrorClass(!0)):(v=this.elementWidth,this.manageErrorClass(!1)),window.OpenProject.guardedLocalStorage(this.localStorageKey,`${v}`),this.applyColumnLayout(),this.resizingElement.style[this.resizeStyle]=`${v}px`}parseLocalStorageValue(){const m=window.OpenProject.guardedLocalStorage(this.localStorageKey),v=parseInt(m||"",10);if("number"==typeof v&&NaN!==v)return v}applyColumnLayout(m=750){const v=document.querySelectorAll("[data-selector='wp-single-view']")[0];v&&jQuery(v).toggleClass("work-package--single-view_with-columns",v.offsetWidth>m)}manageErrorClass(m){m&&!this.resizer.classList.contains("-error-font")&&this.resizer.classList.add("-error-font"),!m&&this.resizer.classList.contains("-error-font")&&this.resizer.classList.remove("-error-font")}}f.\u0275fac=function(m){return new(m||f)(r.Y36(l.J),r.Y36(r.SBq),r.Y36(p.TransitionService),r.Y36(h.o))},f.\u0275cmp=r.Xpm({type:f,selectors:[["wp-resizer"]],inputs:{elementClass:"elementClass",resizeEvent:"resizeEvent",localStorageKey:"localStorageKey",resizeStyle:"resizeStyle"},features:[r.qOj],decls:1,vars:2,consts:[["cursorClass","col-resize",3,"customHandler","resizerClass","end","start","move"]],template:function(m,v){1&m&&(r.TgZ(0,"resizer",0),r.NdJ("end",function(){return v.resizeEnd()})("start",function(){return v.resizeStart()})("move",function(u){return v.resizeMove(u)}),r.qZA()),2&m&&r.Q6J("customHandler",!1)("resizerClass",v.resizerClass)},directives:[d.d],encapsulation:2,changeDetection:0})},58:(te,M,t)=>{"use strict";t.d(M,{a:()=>p});var n=t(2316),e=t(70099);class p{}p.\u0275fac=function(c){return new(c||p)},p.\u0275cmp=n.Xpm({type:p,selectors:[["op-loading-project-list"]],decls:10,vars:0,consts:[["viewBox","0 0 200 140"],["x","0","width","100%","height","12","rx","1"],["x","10","y","16","width","100%","height","12","rx","1"],["x","10","y","32","width","100%","height","12","rx","1"],["x","20","y","48","width","100%","height","12","rx","1"],["x","20","y","64","width","100%","height","12","rx","1"],["x","0","y","80","width","100%","height","12","rx","1"],["x","10","y","96","width","100%","height","12","rx","1"],["x","10","y","112","width","100%","height","12","rx","1"],["x","0","y","128","width","100%","height","12","rx","1"]],template:function(c,i){1&c&&(n.TgZ(0,"op-content-loader",0),n.O4$(),n._UZ(1,"rect",1),n._UZ(2,"rect",2),n._UZ(3,"rect",3),n._UZ(4,"rect",4),n._UZ(5,"rect",5),n._UZ(6,"rect",6),n._UZ(7,"rect",7),n._UZ(8,"rect",8),n._UZ(9,"rect",9),n.qZA())},directives:[e.V],encapsulation:2,changeDetection:0})},48193:(te,M,t)=>{"use strict";t.d(M,{O:()=>a});var n=t(73726),e=t(76491),p=t(23237),h=t(71435),c=t(53466),i=t(33276),l=t(33406),r=t(65146),d=t(2316),f=t(53882);class a{constructor(v,C,u){this.http=v,this.apiV3Service=C,this.currentProjectService=u,this._searchText="",this.selectedItemID$=new e.X(null),this.searchText$=new e.X(""),this.allProjects$=new e.X([]),this.fetchingProjects$=new e.X(!1)}get searchText(){return this._searchText}set searchText(v){this._searchText=v,this.searchText$.next(v)}loadAllProjects(){this.fetchingProjects$.next(!0),(0,p.rP)(v=>{const C=(0,n.g)(Object.assign(Object.assign({},this.params),v));return this.http.get(this.apiV3Service.projects.path+C)}).pipe((0,h.x)(()=>this.fetchingProjects$.next(!1))).subscribe(v=>{this.allProjects$.next(v)})}get params(){return{filters:[["active","=",["t"]]],pageSize:-1,select:["elements/id","elements/name","elements/identifier","elements/self","elements/ancestors","total","count","pageSize"]}}onKeydown(v,C){this.selectedItemID$.pipe((0,c.q)(1)).subscribe(u=>{switch(v.keyCode){case l.m.UP_ARROW:v.preventDefault(),this.selectPreviousResult(u,C);break;case l.m.DOWN_ARROW:v.preventDefault(),this.selectNextResult(u,C);break;case l.m.ENTER:v.stopPropagation(),v.preventDefault(),this.activateSelectedResult(v)}})}resetActiveResult(v){const C=u=>{for(let k=0;k<u.length;k++){if(!u[k].disabled)return u[k].id;const x=C(u[k].children);if(null!==x)return x}return null};this.selectedItemID$.next(C(v))}selectPreviousResult(v,C){if(null===v)return;const u=b=>{var y;return(null===(y=null==b?void 0:b.children)||void 0===y?void 0:y.length)?u(b.children[b.children.length-1]):b},k=(b,y,P)=>{for(let E=0;E<y.length;E++){if(y[E].id===b){const O=u(y[E-1])||y[E-1]||P;return O?O.disabled?k(O.id,C):O.id:null}const T=k(b,y[E].children,y[E]);if(null!==T)return T}return null},x=k(v,C);null!==x?this.selectedItemID$.next(x):this.resetActiveResult(C)}selectNextResult(v,C){if(null===v)return;const u=(x,b,y)=>{for(let P=0;P<b.length;P++){if(b[P].id===x){const T=b[P].children[0]||b[P+1]||y;return T?T.disabled?u(T.id,C):T.id:null}const E=u(x,b[P].children,b[P+1]||y);if(null!==E)return E}return null},k=u(v,C);null!==k?this.selectedItemID$.next(k):this.resetActiveResult(C)}activateSelectedResult(v){var C,u;const k=y=>y?"searchableListParent"in y.dataset?y:k(y.parentElement):null,x=k(v.currentTarget),b=document.activeElement;null===(C=null==x?void 0:x.querySelector(".spot-list--item-action_active"))||void 0===C||C.click(),null===(u=b)||void 0===u||u.focus()}}a.\u0275fac=function(v){return new(v||a)(d.LFG(f.eN),d.LFG(i.T),d.LFG(r.R))},a.\u0275prov=d.Yz7({token:a,factory:a.\u0275fac})},14359:(te,M,t)=>{"use strict";t.d(M,{M:()=>n});class n{constructor(p,h,c){this.page=p,this.total=h,this.perPage=c}getLowerPageBound(){return this.perPage*(this.page-1)+1}getUpperPageBound(p){return Math.min(this.perPage*this.page,p)}nextPage(){this.page+=1}previousPage(){this.page-=1}}},68853:(te,M,t)=>{"use strict";t.d(M,{N:()=>h});var n=t(12877),e=t(2316);const p_maxVisiblePageOptions=6,p_optionsTruncationSize=1;class h{constructor(i){this.configuration=i,this.loadPaginationOptions()}getCachedPerPage(i){const l=this.localStoragePerPage,r=(null==i?void 0:i.length)||0;return null!==l&&l>0&&(0===r||-1!==(null==i?void 0:i.indexOf(l)))?l:r>0?i[0]:20}get localStoragePerPage(){const i=window.OpenProject.guardedLocalStorage("pagination.perPage");return void 0!==i?parseInt(i,10):null}getPaginationOptions(){return this.paginationOptions}get isPerPageKnown(){return!(!this.localStoragePerPage&&!this.paginationOptions)}getPerPage(){return this.localStoragePerPage||this.paginationOptions.perPage}getMaxVisiblePageOptions(){return _.get(this.paginationOptions,"maxVisiblePageOptions",p_maxVisiblePageOptions)}getOptionsTruncationSize(){return _.get(this.paginationOptions,"optionsTruncationSize",p_optionsTruncationSize)}setPerPage(i){window.OpenProject.guardedLocalStorage("pagination.perPage",i.toString()),this.paginationOptions.perPage=i}getPerPageOptions(){return this.paginationOptions.perPageOptions}setPerPageOptions(i){this.paginationOptions.perPageOptions=i}loadPaginationOptions(){return this.configuration.initialized.then(()=>(this.paginationOptions={perPage:this.getCachedPerPage(this.configuration.perPageOptions),perPageOptions:this.configuration.perPageOptions,maxVisiblePageOptions:p_maxVisiblePageOptions,optionsTruncationSize:p_optionsTruncationSize},this.paginationOptions))}}h.\u0275fac=function(i){return new(i||h)(e.LFG(n.e))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac})},5282:(te,M,t)=>{"use strict";t.d(M,{l:()=>l});var n=t(54364),e=t(84906),p=t(63415),h=t(71858),c=t(53875),i=t(2316);class l{}l.\u0275fac=function(d){return new(d||l)},l.\u0275mod=i.oAB({type:l}),l.\u0275inj=i.cJS({imports:[[n.ez,p.J,c.Q,h.a,e.UIRouterModule]]})},90590:(te,M,t)=>{"use strict";t.d(M,{P:()=>y});var n=t(2316),e=t(43682),p=t(47775),h=t(54364),c=t(84906),i=t(54471);const l=["scrollContainer"],r=["scrollPane"],d=["scrollRightBtn"],f=["scrollLeftBtn"];function a(P,E){if(1&P){const T=n.EpF();n.TgZ(0,"a",16),n.NdJ("click",function(I){n.CHM(T);const Z=n.oxw().$implicit;return n.oxw().clickTab(Z,I)}),n.qZA()}if(2&P){const T=n.oxw().$implicit,O=n.oxw();n.ekj("op-tab-row--link_selected",T.id===O.currentTabId)("op-tab-row--link_disabled",void 0!==T.disable),n.Q6J("href",T.path,n.LSH)("textContent",T.name),n.uIk("title",O.tabTitle(T))}}function m(P,E){if(1&P&&(n._UZ(0,"op-tab-count",21),n.ALo(1,"async")),2&P){const T=n.oxw(2).$implicit,O=n.oxw();n.Q6J("count",n.lcZ(1,2,T.counter(O.injector))),n.uIk("data-qa-selector","tab-counter-"+T.name)}}function v(P,E){if(1&P&&(n.TgZ(0,"span",23),n._uU(1),n.qZA()),2&P){const T=n.oxw().ngIf;n.xp6(1),n.hij(" (",T,")")}}function C(P,E){if(1&P&&(n.ynx(0),n.YNc(1,v,2,1,"span",22),n.BQk()),2&P){const T=E.ngIf,O=n.oxw(2).$implicit;n.xp6(1),n.Q6J("ngIf",T>0&&!O.showCountAsBubble)}}function u(P,E){if(1&P){const T=n.EpF();n.TgZ(0,"a",17),n.NdJ("click",function(I){n.CHM(T);const Z=n.oxw().$implicit;return n.oxw().clickTab(Z,I)}),n._UZ(1,"span",18),n.YNc(2,m,2,4,"op-tab-count",19),n.YNc(3,C,2,1,"ng-container",20),n.ALo(4,"async"),n.qZA()}if(2&P){const T=n.oxw().$implicit,O=n.oxw();n.ekj("op-tab-row--link_disabled",void 0!==T.disable),n.Q6J("uiSref",T.route)("uiParams",T.routeParams),n.uIk("title",O.tabTitle(T)),n.xp6(1),n.Q6J("textContent",T.name),n.xp6(1),n.Q6J("ngIf",T.counter&&T.showCountAsBubble),n.xp6(1),n.Q6J("ngIf",n.lcZ(4,8,T.counter(O.injector)))}}function k(P,E){if(1&P){const T=n.EpF();n.TgZ(0,"li",13),n.NdJ("dragenter",function(){const Z=n.CHM(T).$implicit;return n.oxw().startDebouncedTabActivation(Z)})("dragleave",function(){return n.CHM(T),n.oxw().cancelDebouncedTabActivation()}),n.YNc(1,a,1,7,"a",14),n.YNc(2,u,5,10,"a",15),n.qZA()}if(2&P){const T=E.$implicit,O=n.oxw();n.uIk("data-tab-id",T.id)("data-qa-tab-id",T.id)("data-qa-tab-selected",T.id===O.currentTabId||void 0)("data-qa-tab-disabled",T.disable||void 0),n.xp6(1),n.Q6J("ngIf",!T.route),n.xp6(1),n.Q6J("ngIf",T.route)}}const x=[[["","slot","actions"]]];class y{constructor(E,T,O){this.$state=E,this.cdRef=T,this.injector=O,this.currentTabId=null,this.tabs=[],this.classes=[],this.hideLeftButton=!0,this.hideRightButton=!0,this.tabSelected=new n.vpe,this.trackById=(0,e.AT)("id"),this.dragTargetStack=0}ngAfterViewInit(){this.container=this.scrollContainer.nativeElement,this.pane=this.scrollPane.nativeElement,this.updateScrollableArea()}ngOnChanges(E){this.pane&&this.updateScrollableArea()}updateScrollableArea(){this.determineScrollButtonVisibility(),null!=this.currentTabId&&this.scrollIntoVisibleArea(this.currentTabId)}clickTab(E,T){this.currentTabId=E.id,this.tabSelected.emit(E),E.path||T.preventDefault()}startDebouncedTabActivation(E){this.dragTargetStack+=1,null!==this.debouncedTabActivationTimeout&&this.clearDebouncedTabActivation(),this.debouncedTabActivationTimeout=setTimeout(()=>{this.currentTabId=E.id,this.tabSelected.emit(E);const T=this.$state.includes("**.details.*")?this.$state.$current.name:E.route;T&&this.$state.go(T,E.routeParams),this.debouncedTabActivationTimeout=null},300)}cancelDebouncedTabActivation(){this.dragTargetStack-=1,0===this.dragTargetStack&&this.clearDebouncedTabActivation()}clearDebouncedTabActivation(){null!==this.debouncedTabActivationTimeout&&(clearTimeout(this.debouncedTabActivationTimeout),this.debouncedTabActivationTimeout=null)}onScroll(){this.determineScrollButtonVisibility()}determineScrollButtonVisibility(){this.hideLeftButton=this.pane.scrollLeft<=0,this.hideRightButton=this.pane.scrollWidth-this.pane.scrollLeft<=this.container.clientWidth,this.cdRef.detectChanges()}scrollRight(){this.pane.scrollLeft+=this.container.clientWidth}scrollLeft(){this.pane.scrollLeft-=this.container.clientWidth}tabTitle(E){return"string"==typeof E.disable?E.disable:E.name}scrollIntoVisibleArea(E){const T=jQuery(this.pane).find(`[data-tab-id=${E}]`),I=T.position().left+Number(T.outerWidth());this.pane.scrollLeft+this.container.clientWidth<I&&(this.pane.scrollLeft=I-this.container.clientWidth+40)}}y.\u0275fac=function(E){return new(E||y)(n.Y36(p.StateService),n.Y36(n.sBO),n.Y36(n.zs3))},y.\u0275cmp=n.Xpm({type:y,selectors:[["op-scrollable-tabs"]],viewQuery:function(E,T){if(1&E&&(n.Gf(l,7),n.Gf(r,7),n.Gf(d,7),n.Gf(f,7)),2&E){let O;n.iGM(O=n.CRH())&&(T.scrollContainer=O.first),n.iGM(O=n.CRH())&&(T.scrollPane=O.first),n.iGM(O=n.CRH())&&(T.scrollRightBtn=O.first),n.iGM(O=n.CRH())&&(T.scrollLeftBtn=O.first)}},inputs:{currentTabId:"currentTabId",tabs:"tabs",classes:"classes",hideLeftButton:"hideLeftButton",hideRightButton:"hideRightButton"},outputs:{tabSelected:"tabSelected"},features:[n.TTD],ngContentSelectors:["[slot=actions]"],decls:14,vars:5,consts:[[1,"op-scrollable-tabs",3,"ngClass"],[1,"op-scrollable-tabs--tab-container"],["scrollContainer",""],[1,"op-tab-row",3,"scroll"],["scrollPane",""],["class","op-tab-row--tab",3,"dragenter","dragleave",4,"ngFor","ngForOf","ngForTrackBy"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_left",3,"hidden","click"],["scrollLeftBtn",""],[1,"icon-arrow-left2"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_right",3,"hidden","click"],["scrollRightBtn",""],[1,"icon-arrow-right2"],[1,"op-scrollable-tabs--actions"],[1,"op-tab-row--tab",3,"dragenter","dragleave"],["class","op-tab-row--link",3,"href","op-tab-row--link_selected","op-tab-row--link_disabled","textContent","click",4,"ngIf"],["class","op-tab-row--link","uiSrefActive","op-tab-row--link_selected","href","","role","button",3,"uiSref","uiParams","op-tab-row--link_disabled","click",4,"ngIf"],[1,"op-tab-row--link",3,"href","textContent","click"],["uiSrefActive","op-tab-row--link_selected","href","","role","button",1,"op-tab-row--link",3,"uiSref","uiParams","click"],[3,"textContent"],[3,"count",4,"ngIf"],[4,"ngIf"],[3,"count"],["data-qa-selector","tab-count",4,"ngIf"],["data-qa-selector","tab-count"]],template:function(E,T){1&E&&(n.F$t(x),n.TgZ(0,"div",0),n.TgZ(1,"div",1,2),n.TgZ(3,"ul",3,4),n.NdJ("scroll",function(){return T.onScroll()}),n.YNc(5,k,3,6,"li",5),n.qZA(),n.TgZ(6,"div",6,7),n.NdJ("click",function(){return T.scrollLeft()}),n._UZ(8,"span",8),n.qZA(),n.TgZ(9,"div",9,10),n.NdJ("click",function(){return T.scrollRight()}),n._UZ(11,"span",11),n.qZA(),n.qZA(),n.TgZ(12,"ul",12),n.Hsn(13),n.qZA(),n.qZA()),2&E&&(n.Q6J("ngClass",T.classes),n.xp6(5),n.Q6J("ngForOf",T.tabs)("ngForTrackBy",T.trackById),n.xp6(1),n.Q6J("hidden",T.hideLeftButton),n.xp6(3),n.Q6J("hidden",T.hideRightButton))},directives:[h.mk,h.sg,h.O5,c.AnchorUISref,c.UISrefActive,c.UISrefStatus,c.UISref,i.x],pipes:[h.Ov],styles:[".op-tab-row--link[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{pointer-events:none}"],changeDetection:0})},54471:(te,M,t)=>{"use strict";t.d(M,{x:()=>c});var n=t(2316),e=t(54364);function p(i,l){if(1&i&&n._UZ(0,"span",2),2&i){const r=n.oxw(2);n.Q6J("textContent",r.count)}}function h(i,l){if(1&i&&(n.ynx(0),n.YNc(1,p,1,1,"span",1),n.BQk()),2&i){const r=n.oxw();n.xp6(1),n.Q6J("ngIf",r.count>0)}}class c{}c.\u0275fac=function(l){return new(l||c)},c.\u0275cmp=n.Xpm({type:c,selectors:[["op-tab-count"]],inputs:{count:"count"},decls:1,vars:1,consts:[[4,"ngIf"],["class","op-tab-count",3,"textContent",4,"ngIf"],[1,"op-tab-count",3,"textContent"]],template:function(l,r){1&l&&n.YNc(0,h,2,1,"ng-container",0),2&l&&n.Q6J("ngIf",r.count)},directives:[e.O5],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-tab-count[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center;box-sizing:content-box;height:16px;line-height:16px;width:16px;border-radius:.5rem;padding:0 .15rem;font-size:.7rem;font-weight:bold;background:#00A3FF;color:#fff;flex-shrink:0;margin-left:5px;vertical-align:text-bottom}"],changeDetection:0})},46709:(te,M,t)=>{"use strict";t.d(M,{f:()=>k});var n=t(77355),e=t(91923),p=t(96617),h=t(53466),c=t(12703),i=t(58021),l=t(2316),r=t(81301),d=t(54364);function f(x,b){if(1&x){const y=l.EpF();l.TgZ(0,"button",14),l.NdJ("click",function(){return l.CHM(y),l.oxw().destroy()}),l.qZA()}if(2&x){const y=l.oxw();l.Q6J("textContent",y.text.delete),l.uIk("title",y.text.delete)}}function a(x,b){if(1&x){const y=l.EpF();l.TgZ(0,"button",15),l.NdJ("click",function(E){return l.CHM(y),l.oxw().closeMe(E)}),l.qZA()}if(2&x){const y=l.oxw();l.Q6J("textContent",y.text.cancel),l.uIk("title",y.text.cancel)}}function m(x,b){if(1&x){const y=l.EpF();l.TgZ(0,"button",16),l.NdJ("click",function(){return l.CHM(y),l.oxw().saveEntry()}),l.qZA()}if(2&x){const y=l.oxw();l.Q6J("textContent",y.text.save)("disabled",y.formInFlight),l.uIk("title",y.text.save)}}class v extends i.G{get deleteAllowed(){return!1}setModifiedEntry(b){this.createdEntry=b.savedResource,this.reloadWorkPackageAndClose()}}v.\u0275fac=function(){let x;return function(y){return(x||(x=l.n5z(v)))(y||v)}}(),v.\u0275cmp=l.Xpm({type:v,selectors:[["ng-component"]],features:[l._Bn([c.l]),l.qOj],decls:14,vars:7,consts:[["data-indicator-name","modal",1,"spot-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-icon","spot-icon_time"],[3,"textContent"],[1,"spot-divider"],[1,"ngdialog-body","spot-modal--body","spot-container"],[3,"changeset","showWorkPackageField","showUserField","modifiedEntry"],["editForm",""],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["class","button button_no-margin -danger spot-action-bar--action",3,"textContent","click",4,"ngIf"],[1,"spot-action-bar--right"],["class","button button_no-margin spot-modal--cancel-button spot-action-bar--action",3,"textContent","click",4,"ngIf"],["class","button -highlight button_no-margin spot-action-bar--action",3,"textContent","disabled","click",4,"ngIf"],[1,"button","button_no-margin","-danger","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],[1,"button","-highlight","button_no-margin","spot-action-bar--action",3,"textContent","disabled","click"]],template:function(b,y){1&b&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l._UZ(2,"span",2),l._UZ(3,"span",3),l.qZA(),l._UZ(4,"div",4),l.TgZ(5,"div",5),l.TgZ(6,"te-form",6,7),l.NdJ("modifiedEntry",function(E){return y.setModifiedEntry(E)}),l.qZA(),l.qZA(),l.TgZ(8,"div",8),l.TgZ(9,"div",9),l.YNc(10,f,1,2,"button",10),l.qZA(),l.TgZ(11,"div",11),l.YNc(12,a,1,2,"button",12),l.YNc(13,m,1,3,"button",13),l.qZA(),l.qZA(),l.qZA()),2&b&&(l.xp6(3),l.Q6J("textContent",y.text.title),l.xp6(3),l.Q6J("changeset",y.changeset)("showWorkPackageField",y.showWorkPackageField)("showUserField",y.showUserField),l.xp6(4),l.Q6J("ngIf",y.deleteAllowed),l.xp6(2),l.Q6J("ngIf",y.saveAllowed),l.xp6(1),l.Q6J("ngIf",y.saveAllowed))},directives:[r.y,d.O5],encapsulation:2,changeDetection:0});var C=t(33276),u=t(44022);class k{constructor(b,y,P,E,T,O,I){this.opModalService=b,this.injector=y,this.halResource=P,this.apiV3Service=E,this.schemaCache=T,this.halEditing=O,this.i18n=I}create(b,y,P={}){return new Promise((E,T)=>{this.createNewTimeEntry(b,y).then(O=>{this.opModalService.show(v,this.injector,Object.assign(Object.assign({},P),{changeset:O})).subscribe(I=>{I.closingEvent.pipe((0,h.q)(1)).subscribe(()=>{I.createdEntry?E({entry:I.createdEntry,action:"create"}):T()})})})})}createNewTimeEntry(b,y){const P={spentOn:b.format("YYYY-MM-DD")};return y&&(P._links={workPackage:{href:y.href}}),this.apiV3Service.time_entries.form.post(P).toPromise().then(E=>this.fromCreateForm(E))}fromCreateForm(b){const y=this.initializeNewResource(b);return this.halEditing.edit(y,b)}initializeNewResource(b){const y=this.halResource.createHalResourceOfType("TimeEntry",b.payload.$plain());return y.$links.schema={href:"new"},y._type="TimeEntry",y.id="new",y.hours="PT1H",y.update=y.$links.update=b.$links.self,y.updateImmediately=y.$links.updateImmediately=P=>this.apiV3Service.time_entries.post(P).toPromise(),y.state.putValue(y),this.schemaCache.update(y,b.schema),y}}k.\u0275fac=function(b){return new(b||k)(l.LFG(n.S),l.LFG(l.zs3),l.LFG(e.u),l.LFG(C.T),l.LFG(u.y),l.LFG(c.l),l.LFG(p.D))},k.\u0275prov=l.Yz7({token:k,factory:k.\u0275fac})},72388:(te,M,t)=>{"use strict";t.d(M,{d:()=>u});var n=t(77355),e=t(91923),p=t(96617),h=t(53466),c=t(12703),i=t(33276),l=t(58021),r=t(2316),d=t(81301),f=t(54364);function a(k,x){if(1&k){const b=r.EpF();r.TgZ(0,"button",14),r.NdJ("click",function(){return r.CHM(b),r.oxw().destroy()}),r.qZA()}if(2&k){const b=r.oxw();r.Q6J("textContent",b.text.delete),r.uIk("title",b.text.delete)}}function m(k,x){if(1&k){const b=r.EpF();r.TgZ(0,"button",15),r.NdJ("click",function(P){return r.CHM(b),r.oxw().closeMe(P)}),r.qZA()}if(2&k){const b=r.oxw();r.Q6J("textContent",b.text.cancel),r.uIk("title",b.text.cancel)}}function v(k,x){if(1&k){const b=r.EpF();r.TgZ(0,"button",16),r.NdJ("click",function(){return r.CHM(b),r.oxw().saveEntry()}),r.qZA()}if(2&k){const b=r.oxw();r.Q6J("textContent",b.text.save)("disabled",b.formInFlight),r.uIk("title",b.text.save)}}class C extends l.G{setModifiedEntry(x){this.modifiedEntry=x.savedResource,this.reloadWorkPackageAndClose()}get saveAllowed(){return!!this.entry.update}get deleteAllowed(){return!!this.entry.delete}destroy(){!window.confirm(this.text.areYouSure)||(this.destroyedEntry=this.entry,this.service.close())}}C.\u0275fac=function(){let k;return function(b){return(k||(k=r.n5z(C)))(b||C)}}(),C.\u0275cmp=r.Xpm({type:C,selectors:[["ng-component"]],features:[r._Bn([c.l]),r.qOj],decls:14,vars:7,consts:[["data-indicator-name","modal",1,"spot-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-icon","spot-icon_time"],[3,"textContent"],[1,"spot-divider"],[1,"ngdialog-body","spot-modal--body","spot-container"],[3,"changeset","showWorkPackageField","showUserField","modifiedEntry"],["editForm",""],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["class","button button_no-margin -danger spot-action-bar--action",3,"textContent","click",4,"ngIf"],[1,"spot-action-bar--right"],["class","button button_no-margin spot-modal--cancel-button spot-action-bar--action",3,"textContent","click",4,"ngIf"],["class","button -highlight button_no-margin spot-action-bar--action",3,"textContent","disabled","click",4,"ngIf"],[1,"button","button_no-margin","-danger","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],[1,"button","-highlight","button_no-margin","spot-action-bar--action",3,"textContent","disabled","click"]],template:function(x,b){1&x&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r._UZ(2,"span",2),r._UZ(3,"span",3),r.qZA(),r._UZ(4,"div",4),r.TgZ(5,"div",5),r.TgZ(6,"te-form",6,7),r.NdJ("modifiedEntry",function(P){return b.setModifiedEntry(P)}),r.qZA(),r.qZA(),r.TgZ(8,"div",8),r.TgZ(9,"div",9),r.YNc(10,a,1,2,"button",10),r.qZA(),r.TgZ(11,"div",11),r.YNc(12,m,1,2,"button",12),r.YNc(13,v,1,3,"button",13),r.qZA(),r.qZA(),r.qZA()),2&x&&(r.xp6(3),r.Q6J("textContent",b.text.title),r.xp6(3),r.Q6J("changeset",b.changeset)("showWorkPackageField",b.showWorkPackageField)("showUserField",b.showUserField),r.xp6(4),r.Q6J("ngIf",b.deleteAllowed),r.xp6(2),r.Q6J("ngIf",b.saveAllowed),r.xp6(1),r.Q6J("ngIf",b.saveAllowed))},directives:[d.y,f.O5],encapsulation:2,changeDetection:0});class u{constructor(x,b,y,P,E,T){this.opModalService=x,this.injector=b,this.apiV3Service=y,this.halResource=P,this.halEditing=E,this.i18n=T}edit(x,b={}){return new Promise((y,P)=>{this.createChangeset(x).then(E=>this.opModalService.show(C,this.injector,Object.assign(Object.assign({},b),{changeset:E})).subscribe(T=>T.closingEvent.pipe((0,h.q)(1)).subscribe(()=>{T.destroyedEntry?T.destroyedEntry.delete().then(()=>{y({entry:T.destroyedEntry,action:"destroy"})}):T.modifiedEntry?y({entry:T.modifiedEntry,action:"update"}):P()})))})}createChangeset(x){return this.apiV3Service.time_entries.id(x).form.post(x).toPromise().then(b=>this.halEditing.edit(x,b))}}u.\u0275fac=function(x){return new(x||u)(r.LFG(n.S),r.LFG(r.zs3),r.LFG(i.T),r.LFG(e.u),r.LFG(c.l),r.LFG(p.D))},u.\u0275prov=r.Yz7({token:u,factory:u.\u0275fac})},81301:(te,M,t)=>{"use strict";t.d(M,{y:()=>k});var n=t(12703),e=t(96617),p=t(2316),h=t(61342),c=t(26942),l=(t(94232),t(54364)),r=t(54262);const d=["editForm"],f=function(x){return{"-required":x}};function a(x,b){if(1&x&&(p.ynx(0),p._UZ(1,"div",4),p.TgZ(2,"div",5),p._UZ(3,"op-editable-attribute-field",6),p.qZA(),p.BQk()),2&x){const y=p.oxw();p.xp6(1),p.Q6J("ngClass",p.VKq(5,f,y.isRequired("user")))("textContent",y.schema.user.name),p.xp6(2),p.Q6J("resource",y.entry)("wrapperClasses","-tiny")("fieldName","user")}}function m(x,b){if(1&x&&(p.ynx(0),p._UZ(1,"div",4),p.TgZ(2,"div",5),p._UZ(3,"op-editable-attribute-field",9),p.qZA(),p.BQk()),2&x){const y=p.oxw();p.xp6(1),p.Q6J("ngClass",p.VKq(4,f,y.isRequired("workPackage")))("textContent",y.schema.workPackage.name),p.xp6(2),p.Q6J("resource",y.entry)("fieldName","workPackage")}}function v(x,b){if(1&x&&p._UZ(0,"op-editable-attribute-field",9),2&x){const y=p.oxw();p.Q6J("resource",y.entry)("fieldName","activity")}}function C(x,b){if(1&x&&p._UZ(0,"i",11),2&x){const y=p.oxw();p.Q6J("textContent",y.text.wpRequired)}}function u(x,b){if(1&x&&(p.ynx(0),p._UZ(1,"div",4),p.TgZ(2,"div",5),p._UZ(3,"op-editable-attribute-field",9),p.qZA(),p.BQk()),2&x){const y=b.$implicit,P=p.oxw();p.xp6(1),p.Q6J("ngClass",p.VKq(4,f,P.isRequired(y.key)))("textContent",y.label),p.xp6(2),p.Q6J("resource",P.entry)("fieldName",y.key)}}class k extends c.N{constructor(b,y,P){super(),this.halEditing=b,this.cdRef=y,this.i18n=P,this.showWorkPackageField=!0,this.showUserField=!0,this.modifiedEntry=new p.vpe,this.text={wpRequired:this.i18n.t("js.time_entry.work_package_required")},this.workPackageSelected=!1,this.customFields=[]}ngOnInit(){this.halEditing.temporaryEditResource(this.changeset.projectedResource).values$().pipe(this.untilDestroyed()).subscribe(b=>{b&&b.workPackage&&(this.workPackageSelected=!0,this.cdRef.markForCheck())}),this.schema=this.changeset.schema,this.setCustomFields(),this.cdRef.detectChanges()}get entry(){return this.changeset.projectedResource}signalModifiedEntry(b){this.modifiedEntry.emit(b)}save(){return this.editForm.submit()}get inEditMode(){return!0}isRequired(b){return"workPackage"===b||this.schema.ofProperty(b).required}setCustomFields(){Object.entries(this.schema).forEach(([b,y])=>{/customField\d+/.exec(b)&&this.customFields.push({key:b,label:y.name})})}}k.\u0275fac=function(b){return new(b||k)(p.Y36(n.l),p.Y36(p.sBO),p.Y36(e.D))},k.\u0275cmp=p.Xpm({type:k,selectors:[["te-form"]],viewQuery:function(b,y){if(1&b&&p.Gf(d,7),2&b){let P;p.iGM(P=p.CRH())&&(y.editForm=P.first)}},inputs:{changeset:"changeset",showWorkPackageField:"showWorkPackageField",showUserField:"showUserField"},outputs:{modifiedEntry:"modifiedEntry"},features:[p.qOj],decls:19,vars:31,consts:[[3,"resource","inEditMode","onSaved"],["editForm",""],[1,"attributes-map"],[4,"ngIf"],[1,"attributes-map--key",3,"ngClass","textContent"],[1,"attributes-map--value"],[3,"resource","wrapperClasses","fieldName"],[3,"resource","fieldName",4,"ngIf"],[3,"textContent",4,"ngIf"],[3,"resource","fieldName"],[4,"ngFor","ngForOf"],[3,"textContent"]],template:function(b,y){1&b&&(p.TgZ(0,"edit-form",0,1),p.NdJ("onSaved",function(E){return y.signalModifiedEntry(E)}),p.TgZ(2,"div",2),p.YNc(3,a,4,7,"ng-container",3),p._UZ(4,"div",4),p.TgZ(5,"div",5),p._UZ(6,"op-editable-attribute-field",6),p.qZA(),p._UZ(7,"div",4),p.TgZ(8,"div",5),p._UZ(9,"op-editable-attribute-field",6),p.qZA(),p.YNc(10,m,4,6,"ng-container",3),p._UZ(11,"div",4),p.TgZ(12,"div",5),p.YNc(13,v,1,2,"op-editable-attribute-field",7),p.YNc(14,C,1,1,"i",8),p.qZA(),p._UZ(15,"div",4),p.TgZ(16,"div",5),p._UZ(17,"op-editable-attribute-field",9),p.qZA(),p.YNc(18,u,4,6,"ng-container",10),p.qZA(),p.qZA()),2&b&&(p.Q6J("resource",y.entry)("inEditMode",y.inEditMode),p.xp6(3),p.Q6J("ngIf",y.showUserField&&y.schema.user.writable),p.xp6(1),p.Q6J("ngClass",p.VKq(23,f,y.isRequired("spentOn")))("textContent",y.schema.spentOn.name),p.xp6(2),p.Q6J("resource",y.entry)("wrapperClasses","-tiny")("fieldName","spentOn"),p.xp6(1),p.Q6J("ngClass",p.VKq(25,f,y.isRequired("hours")))("textContent",y.schema.hours.name),p.xp6(2),p.Q6J("resource",y.entry)("wrapperClasses","-tiny")("fieldName","hours"),p.xp6(1),p.Q6J("ngIf",y.showWorkPackageField),p.xp6(1),p.Q6J("ngClass",p.VKq(27,f,y.isRequired("activity")))("textContent",y.schema.activity.name),p.xp6(2),p.Q6J("ngIf",y.workPackageSelected),p.xp6(1),p.Q6J("ngIf",!y.workPackageSelected),p.xp6(1),p.Q6J("ngClass",p.VKq(29,f,y.isRequired("comment")))("textContent",y.schema.comment.name),p.xp6(2),p.Q6J("resource",y.entry)("fieldName","comment"),p.xp6(1),p.Q6J("ngForOf",y.customFields))},directives:[h.n,l.O5,l.mk,r.k,l.sg],encapsulation:2,changeDetection:0})},54349:(te,M,t)=>{"use strict";t.d(M,{I:()=>i});var n=t(21757),e=t(55811),p=t(2246),h=t(72388),c=t(2316);class i{}i.\u0275fac=function(r){return new(r||i)},i.\u0275mod=c.oAB({type:i}),i.\u0275inj=c.cJS({providers:[h.d],imports:[[n.H,e.K,p.E]]})},58021:(te,M,t)=>{"use strict";t.d(M,{G:()=>f});var n=t(3786),e=t(60312),p=t(77355),h=t(96617),i=(t(81301),t(29161)),l=t(33276),r=t(2316);const d=["editForm"];class f extends e.T{constructor(m,v,C,u,k){super(v,C,m),this.elementRef=m,this.locals=v,this.cdRef=C,this.i18n=u,this.injector=k,this.text={title:this.i18n.t("js.time_entry.title"),cancel:this.i18n.t("js.button_cancel"),close:this.i18n.t("js.button_close"),save:this.i18n.t("js.button_save"),delete:this.i18n.t("js.button_delete"),areYouSure:this.i18n.t("js.text_are_you_sure")}}get changeset(){return this.locals.changeset}get entry(){return this.changeset.projectedResource}get showWorkPackageField(){return!1!==this.locals.showWorkPackageField}get showUserField(){return!1!==this.locals.showUserField}saveEntry(){this.formInFlight=!0,this.editForm.save().then(()=>this.reloadWorkPackageAndClose()).catch(()=>{this.formInFlight=!1,this.cdRef.detectChanges()})}get saveAllowed(){return!0}get deleteAllowed(){return!0}reloadWorkPackageAndClose(){this.entry.workPackage&&this.apiV3Service.work_packages.id(this.entry.workPackage).refresh(),this.service.close(),this.formInFlight=!1,this.cdRef.detectChanges()}}f.\u0275fac=function(m){return new(m||f)(r.Y36(r.SBq),r.Y36(p.E),r.Y36(r.sBO),r.Y36(h.D),r.Y36(r.zs3))},f.\u0275dir=r.lG2({type:f,viewQuery:function(m,v){if(1&m&&r.Gf(d,7),2&m){let C;r.iGM(C=r.CRH())&&(v.editForm=C.first)}},features:[r.qOj]}),(0,n.gn)([(0,i.W)(),(0,n.w6)("design:type",l.T)],f.prototype,"apiV3Service",void 0)},36293:(te,M,t)=>{"use strict";t.d(M,{kl:()=>d});var n=t(12877),e=t(14808),p=t(85758),h=t(53882),c=t(96617),i=t(2316);class d{constructor(a,m){this.configurationService=a,this.I18n=m,this.stack=(0,e.qH)([]),jQuery(window).on("op:toasters:add",(v,C)=>{this.add(C)})}get current(){return this.stack}add(a,m=5e3){return jQuery(".flash.notice").remove(),this.stack.doModify(v=>{const C=[a].concat(v);return _.remove(C,(u,k)=>k>0&&this.removeOnAdd(u)),C}),"success"===a.type&&this.configurationService.autoHidePopups()&&setTimeout(()=>this.remove(a),m),a}removeOnAdd(a){return["success","error","loading"].includes(a.type)}addError(a,m=[]){var v,C;let u,k;k="string"==typeof m?[m]:[...m],a instanceof h.UA?(u=(0,p.G$)(a.error)?a.error.message:a.message,(null===(C=null===(v=a.error)||void 0===v?void 0:v._embedded)||void 0===C?void 0:C.errors)&&(k=[...k,...a.error._embedded.errors.map(b=>b.message)])):u=a;const x=this.createToast(u,"error");return x.data=k,this.add(x)}addWarning(a){return this.add(this.createToast(a,"warning"))}addSuccess(a){return this.add(this.createToast(a,"success"))}addNotice(a){return this.add(this.createToast(a,"info"))}addAttachmentUpload(a,m){return this.add(this.createAttachmentUploadToast(a,m))}addLoading(a){return this.add(this.createLoadingToast(this.I18n.t("js.ajax.updating"),a))}remove(a){this.stack.doModify(m=>(_.remove(m,v=>v===a),m))}clear(){this.stack.putValue([])}createToast(a,m){return"string"==typeof a?{message:a,type:m}:{message:a.message,type:m,link:a.link,data:a.data}}createAttachmentUploadToast(a,m){if(!m.length)throw new Error("Cannot create an upload toast without uploads!");const v=this.createToast(a,"upload");return v.data=m,v}createLoadingToast(a,m){const v=this.createToast(a,"loading");return v.data=m,v}}d.\u0275fac=function(a){return new(a||d)(i.LFG(n.e),i.LFG(c.D))},d.\u0275prov=i.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})},65532:(te,M,t)=>{"use strict";t.d(M,{F:()=>l});t(84481);var e=t(96617),p=t(2316),h=t(54364);function c(r,d){if(1&r&&p._UZ(0,"a",2),2&r){const f=p.oxw();p.Q6J("textContent",f.name),p.uIk("href",f.href,p.LSH)("title",f.label)}}function i(r,d){if(1&r&&(p.ynx(0),p._uU(1),p.GkF(2),p.BQk()),2&r){const f=p.oxw();p.xp6(1),p.hij(" ",f.name," ")}}class l{constructor(d){this.I18n=d}get href(){return this.user&&this.user.showUserPath}get name(){return this.user&&this.user.name}get label(){return this.I18n.t("js.label_author",{user:this.name})}}l.\u0275fac=function(d){return new(d||l)(p.Y36(e.D))},l.\u0275cmp=p.Xpm({type:l,selectors:[["op-user-link"]],inputs:{user:"user"},decls:2,vars:2,consts:[[3,"textContent",4,"ngIf"],[4,"ngIf"],[3,"textContent"]],template:function(d,f){1&d&&(p.YNc(0,c,1,3,"a",0),p.YNc(1,i,3,1,"ng-container",1)),2&d&&(p.Q6J("ngIf",f.href),p.xp6(1),p.Q6J("ngIf",!f.href))},directives:[h.O5],encapsulation:2,changeDetection:0})},84312:(te,M,t)=>{"use strict";t.d(M,{U:()=>p});var n=t(7101),e=t(2316);class p{constructor(c,i){this.FocusHelper=c,this.elementRef=i,this.condition=!0}ngAfterViewInit(){this.updateFocus()}updateFocus(){(this.condition||""===this.condition)&&this.FocusHelper.focus(this.elementRef.nativeElement)}}p.\u0275fac=function(c){return new(c||p)(e.Y36(n.i),e.Y36(e.SBq))},p.\u0275dir=e.lG2({type:p,selectors:[["","opAutofocus",""]],inputs:{condition:["opAutofocus","condition"]}})},49951:(te,M,t)=>{"use strict";function n(p,h){return p===h||p.contains(h)}function e(p,h){setTimeout(()=>{n(p,document.activeElement)||h()},20)}t.d(M,{j:()=>n,w:()=>e})},7101:(te,M,t)=>{"use strict";t.d(M,{i:()=>e});var n=t(2316);class e{getFocusableElement(h){const c=h.querySelector("input.ui-select-focusser");if(c)return c;let i=h;return h.matches(e.FOCUSABLE_SELECTORS)||(i=h.querySelector(e.FOCUSABLE_SELECTORS)||h),i}focus(h){setTimeout(()=>{const c=this.getFocusableElement(h);null==c||c.focus()},10)}}e.FOCUSABLE_SELECTORS="a, button, input, [tabindex], select, textarea",e.\u0275fac=function(h){return new(h||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})},51017:(te,M,t)=>{"use strict";t.d(M,{N:()=>c});var n=t(76491),e=t(77763),p=t(26942),h=t(2316);class c extends p.N{constructor(l){super(),this.elementRef=l}ngOnInit(){const l=jQuery(this.elementRef.nativeElement),r=new n.X(!1);r.pipe(this.untilDestroyed(),(0,e.e)(50)).subscribe(a=>{l.toggleClass("-focus",a)});l[0].addEventListener("focus",function(){r.next(!0)},!0);l[0].addEventListener("blur",function(){r.next(!1)},!0),setTimeout(()=>{l.addClass("op-focus-within"),l.find(this.selector).addClass("op-focus-within")},0)}}c.\u0275fac=function(l){return new(l||c)(h.Y36(h.SBq))},c.\u0275dir=h.lG2({type:c,selectors:[["","opFocusWithin",""]],inputs:{selector:"selector"},features:[h.qOj]})},63415:(te,M,t)=>{"use strict";t.d(M,{J:()=>p});var n=t(54364),e=t(2316);class p{}p.\u0275fac=function(c){return new(c||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({imports:[[n.ez]]})},81979:(te,M,t)=>{"use strict";t.d(M,{o:()=>p,K:()=>h});var n=t(2316);const p="col[opHighlightCol]";class h{constructor(i){this.elementRef=i}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.thead=this.$element.parent("colgroup").siblings("thead"),this.thead.on("mouseenter","th",i=>{this.$element.index()===jQuery(i.currentTarget).index()&&this.$element.addClass("hover")}),this.thead.on("mouseleave","th",i=>{this.$element.index()===jQuery(i.currentTarget).index()&&this.$element.removeClass("hover")})}ngOnDestroy(){this.thead.off("mouseenter mouseleave")}}h.\u0275fac=function(i){return new(i||h)(n.Y36(n.SBq))},h.\u0275cmp=n.Xpm({type:h,selectors:[["col","opHighlightCol",""]],attrs:["opHighlightCol",""],decls:0,vars:0,template:function(i,l){},encapsulation:2})},93713:(te,M,t)=>{"use strict";t.d(M,{U:()=>e});var n=t(2316);class e{constructor(h){this.elementRef=h,this.query=""}ngAfterViewChecked(){let h=this.elementRef.nativeElement;const c=h.querySelector(".op-search-highlight");if(c&&c.innerHTML.toLocaleLowerCase()===this.query.toLocaleLowerCase()||(h=this.cleanUpOldHighlighting(h),!this.query))return;const i=Array.from(h.childNodes).find(C=>C.nodeType===C.TEXT_NODE),l=(null==i?void 0:i.textContent)||"";if(!l)return;const r=this.query.toLowerCase(),d=l.toLowerCase().indexOf(r);if(d<0)return;const f=l.slice(0,d),a=l.slice(d,d+r.length),m=l.slice(d+r.length),v=document.createElement("span");v.innerHTML=`${_.escape(f)}<span class="op-search-highlight">${_.escape(a)}</span>${_.escape(m)}`,h.replaceChild(v,i)}cleanUpOldHighlighting(h){if(h.children.length>0){const c=Array.from(h.children,({textContent:i})=>null==i?void 0:i.trim()).join("");h.innerHTML="",h.innerText=c}return h}}e.\u0275fac=function(h){return new(h||e)(n.Y36(n.SBq))},e.\u0275dir=n.lG2({type:e,selectors:[["","opSearchHighlight",""]],inputs:{query:["opSearchHighlight","query"]}})},29161:(te,M,t)=>{"use strict";t.d(M,{W:()=>h});t(43887);var p=t(3352);function h(c,i=null,l){return(r,d)=>{delete r[d]&&Object.defineProperty(r,d,{get(){if(c)return this.injector.get(c,i,l);const f=Reflect.getMetadata("design:type",r,d);return this.injector.get(f,i,l)},set(){(0,p.qu)(`Trying to set InjectField property ${d}`)}})}}},43682:(te,M,t)=>{"use strict";t.d(M,{tL:()=>e,As:()=>c,u9:()=>i,AT:()=>l,WJ:()=>r,U5:()=>f,q9:()=>a});var n=t(80044);function e(m,v){return v.href}function c(m,v){return _.get(v,"name")}function i(m,v){return _.get(v,"href")}function l(m){return(v,C)=>_.get(C,m)}function r(m){return(v,C)=>{const u=_.get(C,"href")||"",k=_.get(C,m,"none");return`${u}#${m}=${k}`}}function f(m,v){return!m&&!v||!!m&&!!v&&m.href===v.href}function a(m,v){return m instanceof n.X&&v instanceof n.X?f(m,v):!m&&!v||m===v}},26942:(te,M,t)=>{"use strict";t.d(M,{N:()=>p});var n=t(38519),e=t(2316);class p extends n.QQ{constructor(){super(...arguments),this.componentDestroyed=!1}ngOnDestroy(){this.componentDestroyed=!0,super.ngOnDestroy()}untilDestroyed(){return(0,n.WJ)(this)}}p.\u0275fac=function(){let h;return function(i){return(h||(h=e.n5z(p)))(i||p)}}(),p.\u0275dir=e.lG2({type:p,features:[e.qOj]})},26269:(te,M,t)=>{"use strict";t.d(M,{qM:()=>p,PQ:()=>h});const n=["f"],e=["t"];class p{constructor(){this.filterMap={}}add(i,l,r){const d=!0===r?e:!1===r?n:r;return this.filterMap[i]={operator:l,values:d},this}remove(i){delete this.filterMap[i]}static toFilterObject(i){const l={};return i.forEach(r=>{_.each(r,(d,f)=>{l[f]=d})}),l}merge(i,...l){const r=_.pickBy(p.toFilterObject(i),(d,f)=>l.includes(f));this.filterMap=Object.assign(Object.assign({},this.filterMap),r)}get filters(){const i=[];return _.each(this.filterMap,(l,r)=>{i.push({[r]:l})}),i}toJson(){return JSON.stringify(this.filters)}toParams(i={}){const l=Object.assign({filters:this.toJson()},i);return new URLSearchParams(l).toString()}clone(){const i=new p;return this.filters.forEach(l=>{Object.keys(l).forEach(r=>{i.add(r,l[r].operator,l[r].values)})}),i}}function h(c,i,l){return(new p).add(c,i,l)}},3352:(te,M,t)=>{"use strict";t.d(M,{SC:()=>e,qu:()=>p,IN:()=>h});var n=t(92340);function e(i){n.N.production||i()}function p(i,...l){e(()=>console.log(`[DEBUG] ${i}`,...l))}function h(i,l){if(!n.N.production){const r=performance.now(),d=l(),f=performance.now();return console.log(`%c${i} completed in ${f-r} milliseconds.`,"color:#00A093;"),d}return l()}},87873:(te,M,t)=>{"use strict";function n(e,p=""){document.body.style.setProperty("cursor",e,p)}t.d(M,{h:()=>n})},35900:(te,M,t)=>{"use strict";t.d(M,{x:()=>e});var n=t(92242);class e{constructor(h,c){this.down=!1,this.elements=h,this.scrollWhenOutside=c.scrollWhenOutside||!1,this.maxSpeed=c.maxSpeed||5,this.margin=c.margin||10,this.scrollWhenOutside=c.scrollWhenOutside||!1,this.autoScroll=c.autoScroll,this.point={},this.pointCB=(0,n.Fi)(this.point),this.init()}init(){jQuery(window).on("mousemove.domautoscroll touchmove.domautoscroll",h=>{this.down&&(this.pointCB(h),this.onMove(h))}),jQuery(window).on("mousedown.domautoscroll touchstart.domautoscroll",()=>{this.down=!0}),jQuery(window).on("mouseup.domautoscroll touchend.domautoscroll",()=>this.onUp()),jQuery(window).on("scroll.domautoscroll",h=>this.setScroll(h))}destroy(){jQuery(window).off(".domautoscroll"),this.elements=[],this.cleanAnimation()}add(h){Array.isArray(h)?(this.elements=this.elements.concat(h),this.elements=Array.from(new Set(this.elements))):this.elements.push(h)}onUp(){this.down=!1,cancelAnimationFrame(this.animationFrame),cancelAnimationFrame(this.windowAnimationFrame)}setScroll(h){for(let c=0;c<this.elements.length;c++)if(this.elements[c]===h.target){this.scrolling=!0;break}this.scrolling&&requestAnimationFrame(()=>{this.scrolling=!1})}cleanAnimation(){cancelAnimationFrame(this.animationFrame),cancelAnimationFrame(this.windowAnimationFrame)}getTarget(h){if(!h)return[];const c=i=>[...this.elements.includes(i)?[i]:[],...i.parentElement?c(i.parentElement):[]];return c(h)}getElementsUnderPoint(){const h=[];for(let c=0;c<this.elements.length;c++)this.inside(this.point,this.elements[c])&&h.push(this.elements[c]);return h}onMove(h){if(!this.autoScroll()||h.dispatched)return;let c=[];null!==h.target&&c.push(h.target);const{body:i}=document;c.length>0&&c[0].parentNode===i?c=this.getElementsUnderPoint():(c=this.getTarget(c[0]),0===c.length&&(c=this.getElementsUnderPoint())),this.current=c,0===this.current.length&&(this.current=[this.outerScrollContainer]),cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(this.scrollTick.bind(this))}setOuterScrollContainer(h){this.outerScrollContainer=h}scrollTick(){0!==this.current.length&&(this.current.forEach(h=>{h&&this.scrollAutomatically(h)}),cancelAnimationFrame(this.animationFrame),this.animationFrame=requestAnimationFrame(this.scrollTick.bind(this)))}scrollAutomatically(h){const c=(0,n.VK)(h),i=(()=>this.point.x<c.left+this.margin?-this.maxSpeed:this.point.x>c.right-this.margin?this.maxSpeed:0)(),l=(()=>this.point.y<c.top+this.margin?-this.maxSpeed:this.point.y>c.bottom-this.margin?this.maxSpeed:0)();setTimeout(()=>{l&&this.scrollY(h,l),i&&this.scrollX(h,i)})}scrollY(h,c){h===window?window.scrollTo(h.pageXOffset,h.pageYOffset+c):h.scrollTop+=c}scrollX(h,c){h===window?window.scrollTo(h.pageXOffset+c,h.pageYOffset):h.scrollLeft+=c}inside(h,c,i){return i?h.y>i.top&&h.y<i.bottom&&h.x>i.left&&h.x<i.right:(0,n.XI)(h,c)}}},68354:(te,M,t)=>{"use strict";function n(p){return p.parentElement?Array.from(p.parentElement.children).indexOf(p):-1}function e(p,h,c){const i="string"==typeof h?parseInt(h,10):h,l=p.parentNode?Array.from(p.parentNode.children).indexOf(p):null,r=Array.from(c.children),d=null!=l&&l>=0?l>i?r[i]:r[i+1]:r[i];d?c.insertBefore(p,d):c.appendChild(p)}t.d(M,{c:()=>n,d:()=>e})},45237:(te,M,t)=>{"use strict";t.d(M,{j:()=>i});var n=t(3786),e=t(54364),p=t(35900),h=t(68354),c=t(2316);class i{constructor(r,d){this.document=r,this.injector=d,this.drake=null,this.members=[],this.escapeListener=f=>{this.drake&&"Escape"===f.key&&this.drake.cancel(!0)},this.document.documentElement.addEventListener("keydown",this.escapeListener)}ngOnDestroy(){this.document.documentElement.removeEventListener("keydown",this.escapeListener),this.autoscroll&&this.autoscroll.destroy(),this.drake&&this.drake.destroy()}remove(r){this.initialized&&(_.remove(this.drake.containers,d=>d===r),_.remove(this.members,d=>d.dragContainer===r))}member(r){return _.find(this.members,d=>d.dragContainer===r)}get initialized(){return null!==this.drake}register(r){this.members.push(r);const{scrollContainers:d}=r;this.autoscroll?this.autoscroll.add(d):this.setupAutoscroll(d);const{dragContainer:f}=r;null===this.drake?this.initializeDrake([f]):this.drake.containers.push(f)}addScrollContainer(r){this.autoscroll?this.autoscroll.add(r):this.setupAutoscroll([r]),this.autoscroll.setOuterScrollContainer(r)}setupAutoscroll(r){this.autoscroll=new p.x(r,{margin:100,maxSpeed:10,scrollWhenOutside:!0,autoScroll:()=>this.drake&&this.drake.dragging})}getMember(r){return this.members.find(d=>d.dragContainer===r)}initializeDrake(r){this.drake=dragula(r,{moves:(d,f,a,m)=>{const v=this.getMember(f);return!!v&&v.moves(d,f,a,m)},accepts:(d,f)=>{const a=this.getMember(f);return!a||!a.accepts||a.accepts(d,f)},invalid:()=>!1,direction:"vertical",copy:!1,revertOnSpill:!0,removeOnSpill:!1,mirrorContainer:document.body,ignoreInputTextSelection:!0}),this.drake.on("drag",d=>{d.dataset.sourceIndex=(0,h.c)(d).toString()}),this.drake.on("over",(d,f)=>{const a=f.closest(".drop-zone");a&&a.classList.add("-dragged-over")}),this.drake.on("out",(d,f)=>{const a=f.closest(".drop-zone");a&&a.classList.remove("-dragged-over")}),this.drake.on("cloned",(d,f)=>{const a=this.member(f.parentElement);a&&a.onCloned&&a.onCloned(d,f)}),this.drake.on("drop",(d,f,a,m)=>{try{this.handleDrop(d,f,a,m)}catch(v){console.error("Failed to handle drop of %O, %O",d,v)}}),this.drake.on("shadow",(d,f)=>{const a=this.member(f);a&&a.onShadowInserted&&a.onShadowInserted(d)}),this.drake.on("cancel",(d,f)=>{const a=this.member(f);a&&a.onCancel&&a.onCancel(d)})}handleDrop(r,d,f,a){return(0,n.mG)(this,void 0,void 0,function*(){const m=this.member(d),v=this.member(f);m&&v&&(m!==v?(yield m.onAdded(r,d,f,a))?v.onRemoved(r,d,f,a):(0,h.d)(r,r.dataset.sourceIndex||-1,f):m.onMoved(r,d,f,a))})}}i.\u0275fac=function(r){return new(r||i)(c.LFG(e.K0),c.LFG(c.zs3))},i.\u0275prov=c.Yz7({token:i,factory:i.\u0275fac})},87286:(te,M,t)=>{"use strict";t.d(M,{p:()=>e});const n=['a[href]:not([tabindex^="-"])','area[href]:not([tabindex^="-"])','input:not([type="hidden"]):not([type="radio"]):not([disabled]):not([tabindex^="-"])','input[type="radio"]:not([disabled]):not([tabindex^="-"])','select:not([disabled]):not([tabindex^="-"])','textarea:not([disabled]):not([tabindex^="-"])','button:not([disabled]):not([tabindex^="-"])','iframe:not([tabindex^="-"])','audio[controls]:not([tabindex^="-"])','video[controls]:not([tabindex^="-"])','[contenteditable]:not([tabindex^="-"])','[tabindex]:not([tabindex^="-"]):not(.cdk-focus-trap-anchor)'];function e(p){return p.querySelectorAll(n.toString())}},97656:(te,M,t)=>{"use strict";function n(e){return`${t.p}assets/images/${e}`}t.d(M,{h:()=>n})},33406:(te,M,t)=>{"use strict";var n,e;t.d(M,{m:()=>n}),(e=n||(n={}))[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT_ARROW=37]="LEFT_ARROW",e[e.UP_ARROW=38]="UP_ARROW",e[e.RIGHT_ARROW=39]="RIGHT_ARROW",e[e.DOWN_ARROW=40]="DOWN_ARROW",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.KEY_0=48]="KEY_0",e[e.KEY_1=49]="KEY_1",e[e.KEY_2=50]="KEY_2",e[e.KEY_3=51]="KEY_3",e[e.KEY_4=52]="KEY_4",e[e.KEY_5=53]="KEY_5",e[e.KEY_6=54]="KEY_6",e[e.KEY_7=55]="KEY_7",e[e.KEY_8=56]="KEY_8",e[e.KEY_9=57]="KEY_9",e[e.KEY_A=65]="KEY_A",e[e.KEY_B=66]="KEY_B",e[e.KEY_C=67]="KEY_C",e[e.KEY_D=68]="KEY_D",e[e.KEY_E=69]="KEY_E",e[e.KEY_F=70]="KEY_F",e[e.KEY_G=71]="KEY_G",e[e.KEY_H=72]="KEY_H",e[e.KEY_I=73]="KEY_I",e[e.KEY_J=74]="KEY_J",e[e.KEY_K=75]="KEY_K",e[e.KEY_L=76]="KEY_L",e[e.KEY_M=77]="KEY_M",e[e.KEY_N=78]="KEY_N",e[e.KEY_O=79]="KEY_O",e[e.KEY_P=80]="KEY_P",e[e.KEY_Q=81]="KEY_Q",e[e.KEY_R=82]="KEY_R",e[e.KEY_S=83]="KEY_S",e[e.KEY_T=84]="KEY_T",e[e.KEY_U=85]="KEY_U",e[e.KEY_V=86]="KEY_V",e[e.KEY_W=87]="KEY_W",e[e.KEY_X=88]="KEY_X",e[e.KEY_Y=89]="KEY_Y",e[e.KEY_Z=90]="KEY_Z",e[e.LEFT_META=91]="LEFT_META",e[e.RIGHT_META=92]="RIGHT_META",e[e.SELECT=93]="SELECT",e[e.NUMPAD_0=96]="NUMPAD_0",e[e.NUMPAD_1=97]="NUMPAD_1",e[e.NUMPAD_2=98]="NUMPAD_2",e[e.NUMPAD_3=99]="NUMPAD_3",e[e.NUMPAD_4=100]="NUMPAD_4",e[e.NUMPAD_5=101]="NUMPAD_5",e[e.NUMPAD_6=102]="NUMPAD_6",e[e.NUMPAD_7=103]="NUMPAD_7",e[e.NUMPAD_8=104]="NUMPAD_8",e[e.NUMPAD_9=105]="NUMPAD_9",e[e.MULTIPLY=106]="MULTIPLY",e[e.ADD=107]="ADD",e[e.SUBTRACT=109]="SUBTRACT",e[e.DECIMAL=110]="DECIMAL",e[e.DIVIDE=111]="DIVIDE",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUM_LOCK=144]="NUM_LOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.SEMICOLON=186]="SEMICOLON",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.DASH=189]="DASH",e[e.PERIOD=190]="PERIOD",e[e.FORWARD_SLASH=191]="FORWARD_SLASH",e[e.GRAVE_ACCENT=192]="GRAVE_ACCENT",e[e.OPEN_BRACKET=219]="OPEN_BRACKET",e[e.BACK_SLASH=220]="BACK_SLASH",e[e.CLOSE_BRACKET=221]="CLOSE_BRACKET",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE"},67325:(te,M,t)=>{"use strict";function n(e){const p=e.ctrlKey||e.shiftKey||e.metaKey,h=1===e.button;return p||h}t.d(M,{F:()=>n})},65978:(te,M,t)=>{"use strict";function n(...e){const p=document.createElement("i");return p.setAttribute("aria-hidden","true"),p.classList.add(...e),p}t.d(M,{c:()=>n})},68197:(te,M,t)=>{"use strict";t.d(M,{O:()=>e});const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function e(p=16){return new Array(p).fill(null).map(()=>n.charAt(Math.floor(Math.random()*n.length))).join("")}},93175:(te,M,t)=>{"use strict";t.d(M,{R:()=>c});var n=t(2316),e=t(79441),p=t(80639),h=t(22663);class c{constructor(l,r=250){this.emitter=new n.vpe,this.debouncer=new e.xQ,this.debouncer.pipe((0,p.b)(r),(0,h.R)(l)).subscribe(d=>this.emitter.emit(d))}emit(l){this.debouncer.next(l)}subscribe(l,r,d){return this.emitter.subscribe(l,r,d)}}},88837:(te,M,t)=>{"use strict";t.d(M,{w:()=>e,b:()=>p});var n=t(3352);function e(h,c){try{h.setSelectionRange(c,c)}catch(i){(0,n.qu)("Failed to set click position for edit field.",i)}}function p(h){const c=h.originalEvent;try{if(c.rangeParent){const i=document.createRange();return i.setStart(c.rangeParent,c.rangeOffset),i.startOffset}return document.caretRangeFromPoint?document.caretRangeFromPoint(h.clientX,h.clientY).startOffset:0}catch(i){return(0,n.qu)("Failed to get click position for edit field.",i),0}}},21757:(te,M,t)=>{"use strict";t.d(M,{H:()=>R});var n=t(1707),e=t(55901),p=t(47775),h=t(36868),c=t(80395),i=t(40912),l=t(54364),r=t(3353),d=t(82503),f=t(32853),a=t(84906),m=t(5060),v=t(37991),C=t(74990),u=t(53875),k=t(71858),x=t(65146),b=t(32824),y=t(81496),P=t(63415),E=t(53448),T=t(75867),O=t(81979),I=t(2316);class Z{}Z.\u0275fac=function(Y){return new(Y||Z)},Z.\u0275mod=I.oAB({type:Z}),Z.\u0275inj=I.cJS({});var j=t(51705),B=t(87523);class R{constructor(Y){!function(F){const Y=F.get(x.R),X=F.get(p.UIRouterGlobals);window.ErrorReporter.addHook(()=>({project:Y.identifier||"global","router state":X.current.name||"unknown"})),F.get(E.$).register("openProjectAngularBootstrap",()=>[{selector:O.o,cls:O.K}])}(Y)}}R.\u0275fac=function(Y){return new(Y||R)(I.LFG(I.zs3))},R.\u0275mod=I.oAB({type:R}),R.\u0275inj=I.cJS({providers:[T.p,j.s],imports:[[a.UIRouterModule,l.ez,n.u5,m.s,e.rt,i.eL,c._t,d.qE,v.H,h.A0,r._,Z,b.j,B.a,C.C,y.I,P.J,u.Q,k.a],a.UIRouterModule,l.ez,n.u5,i.eL,c._t,e.rt,u.Q,k.a,h.A0,r._,Z,b.j,C.C,B.a,m.s,y.I,P.J,f.wA]})},1476:(te,M,t)=>{"use strict";t.d(M,{B:()=>h});var n=t(2316),e=t(1707);const p=["input"];class h{constructor(i){this.cdRef=i,this.className=!0,this.tabindex=0,this.disabled=!1,this.name="spot-checkbox-"+ +new Date,this.checked=!1,this.checkedChange=new n.vpe,this.onChange=l=>{},this.onTouched=l=>{}}onStateChange(){const i=this.input.nativeElement.checked;this.checkedChange.emit(i),this.onChange(i),this.onTouched(i)}writeValue(i){setTimeout(()=>{this.input.nativeElement.indeterminate=null===i,this.checked=!!i,this.cdRef.detectChanges()})}registerOnChange(i){this.onChange=i}registerOnTouched(i){this.onTouched=i}}h.\u0275fac=function(i){return new(i||h)(n.Y36(n.sBO))},h.\u0275cmp=n.Xpm({type:h,selectors:[["spot-checkbox"]],viewQuery:function(i,l){if(1&i&&n.Gf(p,5),2&i){let r;n.iGM(r=n.CRH())&&(l.input=r.first)}},hostVars:2,hostBindings:function(i,l){2&i&&n.ekj("spot-checkbox",l.className)},inputs:{tabindex:"tabindex",disabled:"disabled",name:"name",checked:"checked"},outputs:{checkedChange:"checkedChange"},features:[n._Bn([{provide:e.JU,useExisting:(0,n.Gpc)(()=>h),multi:!0}])],decls:3,vars:4,consts:[["type","checkbox",1,"spot-checkbox--input",3,"disabled","checked","tabindex","change"],["input",""],[1,"spot-checkbox--fake"]],template:function(i,l){1&i&&(n.TgZ(0,"input",0,1),n.NdJ("change",function(){return l.onStateChange()}),n.qZA(),n._UZ(2,"span",2)),2&i&&(n.Q6J("disabled",l.disabled)("checked",l.checked)("tabindex",l.tabindex),n.uIk("name",l.name))},encapsulation:2,changeDetection:0})},21090:(te,M,t)=>{"use strict";t.d(M,{m:()=>m});var n=t(2316),e=t(33406),p=t(96617),h=t(1706),c=t(87286),i=t(54364),l=t(55901);const r=function(v){return["spot-drop-modal--body","spot-container",v]};function d(v,C){if(1&v){const u=n.EpF();n.TgZ(0,"div",1),n.NdJ("click",function(x){return n.CHM(u),n.oxw().onBodyClick(x)}),n.Hsn(1,1),n.TgZ(2,"button",2),n.NdJ("click",function(){return n.CHM(u),n.oxw().close()}),n._UZ(3,"span",3),n.qZA(),n.qZA()}if(2&v){const u=n.oxw();n.Q6J("ngClass",n.VKq(2,r,u.alignmentClass)),n.xp6(2),n.uIk("aria-label",u.text.close)}}const f=[[["","slot","trigger"]],[["","slot","body"]]];class m{constructor(C,u){this.i18n=C,this.elementRef=u,this.className=!0,this.alignment=h.Z.BottomLeft,this._open=!1,this.closed=new n.vpe,this.text={close:this.i18n.t("js.spot.drop_modal.close")},this.closeEventListener=this.close.bind(this),this.onEscape=k=>{k.keyCode===e.m.ESCAPE&&this.close()},this.escapeListener=this.onEscape.bind(this),this.appHeightListener=()=>{document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)}}get alignmentClass(){return`spot-drop-modal--body_${this.alignment}`}set open(C){this._open=C,this._open?setTimeout(()=>{document.body.addEventListener("click",this.closeEventListener),document.body.addEventListener("keydown",this.escapeListener),window.addEventListener("resize",this.appHeightListener),window.addEventListener("orientationchange",this.appHeightListener),this.appHeightListener();const u=document.querySelectorAll("[data-modal-focus-catcher-container='true']")[0];u?(0,c.p)(u)[0].focus():(0,c.p)(this.elementRef.nativeElement)[1].focus()}):(document.body.removeEventListener("click",this.closeEventListener),document.body.removeEventListener("keydown",this.escapeListener),window.removeEventListener("resize",this.appHeightListener),window.removeEventListener("orientationchange",this.appHeightListener),this.closed.emit())}get open(){return this._open}close(){this.open=!1}onBodyClick(C){C.stopPropagation()}ngOnDestroy(){document.body.removeEventListener("click",this.closeEventListener),document.body.removeEventListener("keydown",this.escapeListener),window.removeEventListener("resize",this.appHeightListener),window.removeEventListener("orientationchange",this.appHeightListener)}}m.\u0275fac=function(C){return new(C||m)(n.Y36(p.D),n.Y36(n.SBq))},m.\u0275cmp=n.Xpm({type:m,selectors:[["spot-drop-modal"]],hostVars:4,hostBindings:function(C,u){2&C&&n.ekj("spot-drop-modal",u.className)("spot-drop-modal_opened",u.open)},inputs:{alignment:"alignment",open:"open"},outputs:{closed:"closed"},ngContentSelectors:["[slot=trigger]","[slot=body]"],decls:2,vars:1,consts:[["cdkTrapFocus","","tabindex","0",3,"ngClass","click",4,"ngIf"],["cdkTrapFocus","","tabindex","0",3,"ngClass","click"],["type","button",1,"spot-drop-modal--close-button","spot-button",3,"click"],[1,"spot-icon","spot-icon_close"]],template:function(C,u){1&C&&(n.F$t(f),n.Hsn(0),n.YNc(1,d,4,4,"div",0)),2&C&&(n.xp6(1),n.Q6J("ngIf",u.open))},directives:[i.O5,l.mK,i.mk],encapsulation:2,changeDetection:0})},92512:(te,M,t)=>{"use strict";t.d(M,{I:()=>k});var n=t(1707),e=t(96617),p=t(2316),h=t(54364);function c(x,b){if(1&x&&(p.TgZ(0,"span",9),p._uU(1),p.qZA()),2&x){const y=p.oxw(2);p.xp6(1),p.hij(" ",y.text.invalid," ")}}function i(x,b){1&x&&(p.TgZ(0,"span",10),p._uU(1,"*"),p.qZA())}function l(x,b){1&x&&p.GkF(0)}function r(x,b){if(1&x&&(p.ynx(0),p.YNc(1,l,1,0,"ng-container",11),p.BQk()),2&x){p.oxw(2);const y=p.MAs(2);p.xp6(1),p.Q6J("ngTemplateOutlet",y)}}function d(x,b){1&x&&p.GkF(0)}function f(x,b){if(1&x&&(p.ynx(0),p.YNc(1,d,1,0,"ng-container",11),p.BQk()),2&x){p.oxw(2);const y=p.MAs(2);p.xp6(1),p.Q6J("ngTemplateOutlet",y)}}function a(x,b){if(1&x&&(p.TgZ(0,"div",12),p.Hsn(1,3),p.qZA()),2&x){const y=p.oxw(2);p.Q6J("id",y.errorsID)}}function m(x,b){if(1&x&&(p.ynx(0),p.TgZ(1,"label",2),p.TgZ(2,"div",3),p.YNc(3,c,2,1,"span",4),p._uU(4),p.YNc(5,i,2,0,"span",5),p.Hsn(6),p.qZA(),p.YNc(7,r,2,1,"ng-container",0),p.qZA(),p.YNc(8,f,2,1,"ng-container",0),p.TgZ(9,"div",6),p.Hsn(10,1),p.qZA(),p.YNc(11,a,2,1,"div",7),p.TgZ(12,"div",8),p.Hsn(13,2),p.qZA(),p.BQk()),2&x){const y=p.oxw();p.xp6(3),p.Q6J("ngIf",y.showErrorMessage),p.xp6(1),p.hij(" ",y.label," "),p.xp6(1),p.Q6J("ngIf",y.required),p.xp6(2),p.Q6J("ngIf",!y.noWrapLabel),p.xp6(1),p.Q6J("ngIf",y.noWrapLabel),p.xp6(1),p.Q6J("id",y.descriptionID),p.xp6(2),p.Q6J("ngIf",y.showErrorMessage)}}function v(x,b){if(1&x&&(p.TgZ(0,"div",13),p.Hsn(1,4),p.qZA()),2&x){const y=p.oxw();p.uIk("aria-describedby",y.describedByID)}}const C=[[["","slot","help-text"]],[["","slot","description"]],[["","slot","action"]],[["","slot","errors"]],[["","slot","input"]]];class k{constructor(b,y){this._formGroupDirective=b,this.I18n=y,this.className=!0,this.label="",this.noWrapLabel=!1,this.required=!1,this.showValidationErrorOn="submit",this.hidden=!1,this.internalID="spot-form-field-"+ +new Date,this.text={invalid:this.I18n.t("js.label_invalid")}}get errorClassName(){return this.showErrorMessage}get errorsID(){return`${this.internalID}-errors`}get descriptionID(){return`${this.internalID}-description`}get describedByID(){return this.showErrorMessage?this.errorsID:this.descriptionID}get formControl(){var b;return(null===(b=this.ngControl)||void 0===b?void 0:b.control)||this.control}get showErrorMessage(){var b;return!!this.formControl&&("submit"===this.showValidationErrorOn?this.formControl.invalid&&(null===(b=this._formGroupDirective)||void 0===b?void 0:b.submitted):"blur"===this.showValidationErrorOn?this.formControl.invalid&&this.formControl.touched:"change"===this.showValidationErrorOn&&(this.formControl.invalid&&this.formControl.dirty))}}k.\u0275fac=function(b){return new(b||k)(p.Y36(n.sg,8),p.Y36(e.D))},k.\u0275cmp=p.Xpm({type:k,selectors:[["spot-form-field"]],contentQueries:function(b,y,P){if(1&b&&p.Suo(P,n.a5,5),2&b){let E;p.iGM(E=p.CRH())&&(y.ngControl=E.first)}},hostVars:4,hostBindings:function(b,y){2&b&&p.ekj("spot-form-field",y.className)("spot-form-field_invalid",y.errorClassName)},inputs:{label:"label",noWrapLabel:"noWrapLabel",required:"required",showValidationErrorOn:"showValidationErrorOn",control:"control",hidden:"hidden"},ngContentSelectors:["[slot=help-text]","[slot=description]","[slot=action]","[slot=errors]","[slot=input]"],decls:3,vars:1,consts:[[4,"ngIf"],["inputTemplate",""],[1,"spot-form-field--label-wrap"],[1,"spot-form-field--label"],["class","hidden-for-sighted",4,"ngIf"],["class","spot-form-field--label-indicator",4,"ngIf"],[1,"spot-form-field--description",3,"id"],["class","spot-form-field--errors",3,"id",4,"ngIf"],[1,"spot-form-field--actions"],[1,"hidden-for-sighted"],[1,"spot-form-field--label-indicator"],[4,"ngTemplateOutlet"],[1,"spot-form-field--errors",3,"id"],[1,"spot-form-field--input"]],template:function(b,y){1&b&&(p.F$t(C),p.YNc(0,m,14,7,"ng-container",0),p.YNc(1,v,2,1,"ng-template",null,1,p.W1O)),2&b&&p.Q6J("ngIf",!y.hidden)},directives:[h.O5,h.tP],encapsulation:2})},99100:(te,M,t)=>{"use strict";t.d(M,{o:()=>v});var n=t(1707),e=t(2316),p=t(54364);function h(C,u){1&C&&(e.TgZ(0,"span",9),e._uU(1,"Invalid"),e.qZA())}function c(C,u){1&C&&(e.TgZ(0,"span",10),e._uU(1,"*"),e.qZA())}function i(C,u){if(1&C&&(e.TgZ(0,"div",6),e.YNc(1,h,2,0,"span",7),e._uU(2),e.YNc(3,c,2,0,"span",8),e.Hsn(4,2),e.qZA()),2&C){const k=e.oxw(2);e.xp6(1),e.Q6J("ngIf",k.showErrorMessage),e.xp6(1),e.hij(" ",k.label," "),e.xp6(1),e.Q6J("ngIf",k.required)}}function l(C,u){if(1&C&&(e.TgZ(0,"div",11),e.Hsn(1,3),e.qZA()),2&C){const k=e.oxw(2);e.Q6J("id",k.errorsID)}}const r=function(C){return{"spot-selector-field--label-wrap_reversed":C}},d=function(C){return{"spot-selector-field--input_reversed":C}};function f(C,u){if(1&C&&(e.ynx(0),e.TgZ(1,"label",1),e.TgZ(2,"div",2),e.Hsn(3),e.qZA(),e.YNc(4,i,5,3,"div",3),e.qZA(),e.TgZ(5,"div",4),e.Hsn(6,1),e.qZA(),e.YNc(7,l,2,1,"div",5),e.BQk()),2&C){const k=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(6,r,k.reverseLabel)),e.xp6(1),e.Q6J("ngClass",e.VKq(8,d,k.reverseLabel)),e.uIk("aria-describedby",k.describedByID),e.xp6(2),e.Q6J("ngIf",k.label),e.xp6(1),e.Q6J("id",k.descriptionID),e.xp6(2),e.Q6J("ngIf",k.showErrorMessage)}}const a=[[["","slot","input"]],[["","slot","description"]],[["","slot","help-text"]],[["","slot","errors"]]];class v{constructor(u){this.formGroupDirective=u,this.className=!0,this.classNameCheckbox=!0,this.label="",this.reverseLabel=!1,this.required=!1,this.showValidationErrorOn="submit",this.hidden=!1,this.internalID="spot-selector-field-"+ +new Date}get errorClassName(){return this.showErrorMessage}get errorsID(){return`${this.internalID}-errors`}get descriptionID(){return`${this.internalID}-description`}get describedByID(){return this.showErrorMessage?this.errorsID:this.descriptionID}get formControl(){var u;return(null===(u=this.ngControl)||void 0===u?void 0:u.control)||this.control}get showErrorMessage(){var u;return!!this.formControl&&("submit"===this.showValidationErrorOn?this.formControl.invalid&&(null===(u=this.formGroupDirective)||void 0===u?void 0:u.submitted):"blur"===this.showValidationErrorOn?this.formControl.invalid&&this.formControl.touched:"change"===this.showValidationErrorOn&&(this.formControl.invalid&&this.formControl.dirty))}}v.\u0275fac=function(u){return new(u||v)(e.Y36(n.sg,8))},v.\u0275cmp=e.Xpm({type:v,selectors:[["spot-selector-field"]],contentQueries:function(u,k,x){if(1&u&&e.Suo(x,n.a5,5),2&u){let b;e.iGM(b=e.CRH())&&(k.ngControl=b.first)}},hostVars:6,hostBindings:function(u,k){2&u&&e.ekj("spot-form-field",k.className)("spot-selector-field",k.classNameCheckbox)("spot-form-field_invalid",k.errorClassName)},inputs:{label:"label",reverseLabel:"reverseLabel",required:"required",showValidationErrorOn:"showValidationErrorOn",control:"control",hidden:"hidden"},ngContentSelectors:["[slot=input]","[slot=description]","[slot=help-text]","[slot=errors]"],decls:1,vars:1,consts:[[4,"ngIf"],[1,"spot-form-field--label-wrap","spot-selector-field--label-wrap",3,"ngClass"],[1,"spot-form-field--input","spot-selector-field--input",3,"ngClass"],["class","spot-form-field--label spot-selector-field--label",4,"ngIf"],[1,"spot-form-field--description",3,"id"],["class","spot-form-field--errors",3,"id",4,"ngIf"],[1,"spot-form-field--label","spot-selector-field--label"],["class","Hidden for sighted",4,"ngIf"],["class","spot-form-field--label-indicator",4,"ngIf"],[1,"Hidden","for","sighted"],[1,"spot-form-field--label-indicator"],[1,"spot-form-field--errors",3,"id"]],template:function(u,k){1&u&&(e.F$t(a),e.YNc(0,f,8,10,"ng-container",0)),2&u&&e.Q6J("ngIf",!k.hidden)},directives:[p.O5,p.mk],encapsulation:2})},96091:(te,M,t)=>{"use strict";t.d(M,{H:()=>c,G:()=>i});var n=t(2316),e=t(1707),p=t(45410);const h=["input"],c="spot-switch";class i{constructor(r,d){this.elementRef=r,this.cdRef=d,this.className=!0,this.tabindex=0,this.disabled=!1,this.name="spot-switch-"+ +new Date,this.checked=!1,this.checkedChange=new n.vpe,this.onChange=f=>{},this.onTouched=f=>{},(0,p.E)(this)}onStateChange(){const r=this.input.nativeElement.checked;this.checkedChange.emit(r),this.onChange(r),this.onTouched(r)}writeValue(r){this.checked=!!r,this.cdRef.markForCheck()}onToggle(r){this.writeValue(r),this.onChange(r),this.onTouched(r)}registerOnChange(r){this.onChange=r}registerOnTouched(r){this.onTouched=r}}i.\u0275fac=function(r){return new(r||i)(n.Y36(n.SBq),n.Y36(n.sBO))},i.\u0275cmp=n.Xpm({type:i,selectors:[["spot-switch"]],viewQuery:function(r,d){if(1&r&&n.Gf(h,5),2&r){let f;n.iGM(f=n.CRH())&&(d.input=f.first)}},hostVars:2,hostBindings:function(r,d){2&r&&n.ekj("spot-switch",d.className)},inputs:{tabindex:"tabindex",disabled:"disabled",name:"name",checked:"checked"},outputs:{checkedChange:"checkedChange"},features:[n._Bn([{provide:e.JU,useExisting:(0,n.Gpc)(()=>i),multi:!0}])],decls:3,vars:5,consts:[["type","checkbox",1,"spot-switch--input",3,"disabled","tabindex","ngModel","ngModelChange"],["input",""],["data-qa-selector","spot-switch-handle",1,"spot-switch--fake"]],template:function(r,d){1&r&&(n.TgZ(0,"input",0,1),n.NdJ("ngModelChange",function(a){return d.onToggle(a)}),n.qZA(),n._UZ(2,"span",2)),2&r&&(n.Q6J("disabled",d.disabled)("tabindex",d.tabindex)("ngModel",d.checked),n.uIk("name",d.name),n.xp6(2),n.uIk("data-qa-active",d.checked||void 0))},directives:[e.Wl,e.JJ,e.On],encapsulation:2,changeDetection:0})},87912:(te,M,t)=>{"use strict";t.d(M,{A:()=>r});var n=t(2316),e=t(1707),p=t(54364);const h=["input"];function c(d,f){if(1&d){const a=n.EpF();n.TgZ(0,"button",3),n.NdJ("click",function(){return n.CHM(a),n.oxw().valueChanged("")}),n._UZ(1,"span",4),n.qZA()}}const i=[[["","slot","before"]],[["","slot","after"]]];class r{constructor(f){this.cdRef=f,this.className=!0,this.focused=!1,this.name="spot-text-field-"+ +new Date,this.disabled=!1,this.showClearButton=!0,this.placeholder="",this.value="",this.inputmode="text",this.inputFocus=new n.vpe,this.inputBlur=new n.vpe,this.onChange=a=>{},this.onTouched=a=>{}}onParentClick(){this.input.nativeElement.focus()}valueChanged(f){this.writeValue(f),this.onChange(f),this.onTouched(f)}onInputFocus(f){this.focused=!0,this.inputFocus.next(f)}onInputBlur(f){this.focused=!1,this.inputBlur.next(f)}writeValue(f){this.value=f||"",this.cdRef.markForCheck()}registerOnChange(f){this.onChange=f}registerOnTouched(f){this.onTouched=f}}r.\u0275fac=function(f){return new(f||r)(n.Y36(n.sBO))},r.\u0275cmp=n.Xpm({type:r,selectors:[["spot-text-field"]],viewQuery:function(f,a){if(1&f&&n.Gf(h,5),2&f){let m;n.iGM(m=n.CRH())&&(a.input=m.first)}},hostVars:6,hostBindings:function(f,a){1&f&&n.NdJ("click",function(){return a.onParentClick()}),2&f&&n.ekj("spot-text-field",a.className)("spot-text-field_focused",a.focused)("spot-text-field_disabled",a.disabled)},inputs:{name:"name",disabled:"disabled",showClearButton:"showClearButton",placeholder:"placeholder",value:"value",pattern:"pattern",inputmode:"inputmode"},outputs:{inputFocus:"inputFocus",inputBlur:"inputBlur"},features:[n._Bn([{provide:e.JU,useExisting:(0,n.Gpc)(()=>r),multi:!0}])],ngContentSelectors:["[slot=before]","[slot=after]"],decls:5,vars:7,consts:[[1,"spot-text-field--input",3,"disabled","placeholder","ngModel","ngModelChange","focus","blur"],["input",""],["type","button","class","spot-text-field--clear-button",3,"click",4,"ngIf"],["type","button",1,"spot-text-field--clear-button",3,"click"],[1,"spot-icon","spot-icon_close"]],template:function(f,a){1&f&&(n.F$t(i),n.Hsn(0),n.TgZ(1,"input",0,1),n.NdJ("ngModelChange",function(v){return a.valueChanged(v)})("focus",function(v){return a.onInputFocus(v)})("blur",function(v){return a.onInputBlur(v)}),n.qZA(),n.YNc(3,c,2,0,"button",2),n.Hsn(4,1)),2&f&&(n.xp6(1),n.Q6J("disabled",a.disabled)("placeholder",a.placeholder)("ngModel",a.value),n.uIk("name",a.name)("pattern",a.pattern)("inputmode",a.inputmode),n.xp6(2),n.Q6J("ngIf",a.showClearButton&&""!==a.value&&!a.disabled))},directives:[e.Fj,e.c5,e.JJ,e.On,p.O5],encapsulation:2})},48705:(te,M,t)=>{"use strict";t.d(M,{s:()=>r});var n=t(1706),e=t(2316),p=t(54364);const h=function(d){return["spot-tooltip--body","spot-container",d]};function c(d,f){if(1&d&&(e.TgZ(0,"div",1),e.Hsn(1,1),e.qZA()),2&d){const a=e.oxw();e.Q6J("ngClass",e.VKq(1,h,a.alignmentClass))}}const i=[[["","slot","trigger"]],[["","slot","body"]]];class r{constructor(){this.className=!0,this.dark=!1,this.disabled=!1,this.alignment=n.Z.BottomCenter}get alignmentClass(){return`spot-tooltip--body_${this.alignment}`}}r.\u0275fac=function(f){return new(f||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["spot-tooltip"]],hostVars:4,hostBindings:function(f,a){2&f&&e.ekj("spot-tooltip",a.className)("spot-tooltip_dark",a.dark)},inputs:{dark:"dark",disabled:"disabled",alignment:"alignment"},ngContentSelectors:["[slot=trigger]","[slot=body]"],decls:2,vars:1,consts:[[3,"ngClass",4,"ngIf"],[3,"ngClass"]],template:function(f,a){1&f&&(e.F$t(i),e.Hsn(0),e.YNc(1,c,2,3,"div",0)),2&f&&(e.xp6(1),e.Q6J("ngIf",!a.disabled))},directives:[p.O5,p.mk],encapsulation:2,changeDetection:0})},1706:(te,M,t)=>{"use strict";var n,p;t.d(M,{Z:()=>e}),(p=n||(n={})).TopLeft="top-left",p.TopCenter="top-center",p.TopRight="top-right",p.RightTop="right-top",p.RightCenter="right-center",p.RightBottom="right-bottom",p.BottomLeft="bottom-left",p.BottomCenter="bottom-center",p.BottomRight="bottom-right",p.LeftTop="left-top",p.LeftCenter="left-center",p.LeftBottom="left-bottom";const e=n},5060:(te,M,t)=>{"use strict";t.d(M,{s:()=>i});var n=t(1707),e=t(54364),p=t(55901),h=t(96617),c=t(2316);class i{}i.\u0275fac=function(r){return new(r||i)},i.\u0275mod=c.oAB({type:i}),i.\u0275inj=c.cJS({providers:[h.D],imports:[[n.u5,n.UX,e.ez,p.rt]]})},92340:(te,M,t)=>{"use strict";t.d(M,{N:()=>n});const n={production:!0}},75492:(te,M,t)=>{"use strict";var n=t(71570),e=t(2316),p=t(53882),h=t(1707),c=t(87853),i=t(2246),l=t(21757),r=t(5060),d=t(80261),f=t(7794),a=t(31283),m=t(97779),v=t(32853),C=t(53448),u=t(55811),k=t(51303),x=t(80395),b=t(49369),y=t(96617),P=t(65146);class E{constructor(o,s,w,S){this.startRow=o,this.endRow=s,this.startColumn=w,this.endColumn=S}get gridStartRow(){return 2*this.startRow}get gridEndRow(){return 2*this.endRow-1}get gridStartColumn(){return 2*this.startColumn}get gridEndColumn(){return 2*this.endColumn-1}get guid(){return this.storedGuid||(this.storedGuid=this.newGuid()),this.storedGuid}newGuid(){function o(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return`${o()+o()}-${o()}-${o()}-${o()}-${o()}${o()}${o()}`}}class T extends E{constructor(o){super(o.startRow,o.endRow,o.startColumn,o.endColumn),this.widget=o}reset(){this.startRow=this.widget.startRow,this.endRow=this.widget.endRow,this.startColumn=this.widget.startColumn,this.endColumn=this.widget.endColumn}moveRight(){this.startColumn++,this.endColumn++}moveLeft(){this.startColumn--,this.endColumn--}growColumn(){this.endColumn++}overlaps(o){return this.rowOverlaps(o)&&this.columnOverlaps(o)}rowOverlaps(o){return this.startRow<o.endRow&&this.endRow>=o.endRow||this.startRow<=o.startRow&&this.endRow>o.startRow||this.startRow>o.startRow&&this.endRow<o.endRow}columnOverlaps(o){return this.startColumn<o.endColumn&&this.endColumn>=o.endColumn||this.startColumn<=o.startColumn&&this.endColumn>o.startColumn||this.startColumn>o.startColumn&&this.endColumn<o.endColumn}startColumnOverlaps(o){return this.startColumn<o.startColumn&&this.endColumn>o.startColumn&&this.rowOverlaps(o)}get unchangedSize(){return this.startColumn===this.widget.startColumn&&this.endColumn===this.widget.endColumn&&this.startRow===this.widget.startRow&&this.endRow===this.widget.endRow}writeAreaChangeToWidget(){this.widget.startRow=this.startRow,this.widget.endRow=this.endRow,this.widget.startColumn=this.startColumn,this.widget.endColumn=this.endColumn}copyDimensionsTo(o){o.startRow=this.startRow,o.startColumn=this.startColumn,o.endRow=this.endRow,o.endColumn=this.endColumn}}class O extends E{constructor(o,s,w,S,ne){super(o,s,w,S),this.type=ne}get gridStartRow(){return this.isRow?2*this.startRow-1:2*this.startRow}get gridEndRow(){return this.isRow?2*this.endRow-2:2*this.endRow-1}get gridStartColumn(){return this.isRow?2*this.startColumn:2*this.startColumn-1}get gridEndColumn(){return this.isRow?2*this.endColumn-1:2*this.endColumn-2}get isRow(){return"row"===this.type}get isColumn(){return"column"===this.type}}var I=t(36293),Z=t(76491),j=t(33276),B=t(71909);class J{constructor(o,s,w){this.apiV3Service=o,this.toastService=s,this.i18n=w,this.numColumns=0,this.numRows=0,this.mousedOverArea=null,this.$mousedOverArea=new Z.X(this.mousedOverArea),this.helpMode=!1}set gridResource(o){this.resource=o,this.fetchSchema(),this.numRows=this.resource.rowCount,this.numColumns=this.resource.columnCount,this.buildAreas(!0)}get gridResource(){return this.resource}setMousedOverArea(o){this.mousedOverArea=o,this.$mousedOverArea.next(o)}cleanupUnusedAreas(){let o=_.range(this.numRows,0,-1);this.widgetAreas.forEach(w=>{o=o.filter(S=>S!==w.startRow)}),o.forEach(w=>{this.numRows>1&&this.removeRow(w)});let s=_.range(this.numColumns,0,-1);this.widgetAreas.forEach(w=>{s=s.filter(S=>S!==w.startColumn)}),s.forEach(w=>{this.numColumns>1&&this.removeColumn(w)})}buildAreas(o=!1){this.gridAreas=this.buildGridAreas(),this.gridGaps=this.buildGridGaps(),this.gridAreaIds=this.buildGridAreaIds(),o&&(this.widgetAreas=this.buildGridWidgetAreas())}rebuildAndPersist(){this.persist(),this.buildAreas(!1)}persist(){this.resource.rowCount=this.numRows=(this.widgetAreas.map(o=>o.endRow).sort((o,s)=>o-s).pop()||2)-1,this.resource.columnCount=this.numColumns,this.writeAreaChangesToWidgets(),this.saveGrid(this.resource,this.schema)}saveWidgetChangeset(o){const s=B.E.extractPayload(this.resource,this.schema),w=s.widgets.find(S=>S.id===o.pristineResource.id);Object.assign(w,o.changes),s.id=this.resource.id,this.saveGrid(s)}isGap(o){return o instanceof O}get isSingleCell(){return 1===this.numRows&&1===this.numColumns&&0===this.widgetResources.length}get inHelpMode(){return this.helpMode||this.isSingleCell}toggleHelpMode(){this.helpMode=!this.helpMode}scrollPlaceholderIntoView(){const o=jQuery(".grid--area.-placeholder");o[0].scrollIntoViewIfNeeded&&setTimeout(()=>o[0].scrollIntoViewIfNeeded())}saveGrid(o,s){this.apiV3Service.grids.id(o).patch(o,s).subscribe(w=>{this.assignAreasWidget(w),this.toastService.addSuccess(this.i18n.t("js.notice_successful_update"))})}assignAreasWidget(o){this.resource.widgets=o.widgets;const s=this.widgetAreas.map(w=>w.widget.id);this.widgetAreas.forEach(w=>{let S;S=w.widget.id?o.widgets.find(ne=>ne.id===w.widget.id):o.widgets.find(ne=>!s.includes(ne.id)&&ne.identifier===w.widget.identifier&&ne.startRow===w.widget.startRow&&ne.startColumn===w.widget.startColumn),w.widget=S})}buildGridAreas(){const o=[];for(let s=1;s<=this.numRows+1;s++)o.push(...this.buildGridAreasRow(s));return o}buildGridGaps(){const o=[];if(this.isSingleCell)return o;for(let s=1;s<=this.numRows+1;s++)o.push(...this.buildGridGapRow(s));return o}buildGridAreasRow(o){const s=[];for(let w=1;w<=this.numColumns;w++){const S=new E(o,o+1,w,w+1);s.push(S)}return s}buildGridGapRow(o){const s=[];for(let w=1;w<=this.numColumns;w++)s.push(new O(o,o+1,w,w+1,"row"));if(o<=this.numRows)for(let w=1;w<=this.numColumns+1;w++)s.push(new O(o,o+1,w,w+1,"column"));return s}buildGridWidgetAreas(){return this.widgetResources.map(o=>new T(o))}writeAreaChangesToWidgets(){this.widgetAreas.forEach(o=>{o.writeAreaChangeToWidget()})}addColumn(o,s){this.numColumns++;const w=[];for(let S=1;S<=this.numRows;S++){if(S===s)continue;const ne=this.rowWidgets(S).sort((fe,Ie)=>fe.startColumn-Ie.startColumn).find(fe=>!(fe.startRow<s&&fe.endRow>s)&&(fe.startColumn===o+1||fe.endColumn===o+1||fe.startColumn<=o&&fe.endColumn>o));ne&&(w.push(ne),ne.endColumn++)}this.moveSubsequentRowWidgets(this.widgetAreas.filter(S=>!w.includes(S)),o)}addRow(o,s){this.numRows++;const w=[];for(let S=1;S<=this.numColumns;S++){if(S===s)continue;const ne=this.columnWidgets(S).sort((fe,Ie)=>fe.startRow-Ie.startRow).find(fe=>!(fe.startColumn<s&&fe.endColumn>s)&&(fe.startRow===o+1||fe.endRow===o+1||fe.startRow<=o&&fe.endRow>o));ne&&(w.push(ne),ne.endRow++)}this.moveSubsequentColumnWidgets(this.widgetAreas.filter(S=>!w.includes(S)),o)}removeColumn(o){this.numColumns--,this.widgetAreas.forEach(s=>{s.startColumn<=o&&s.endColumn>=o+1&&s.endColumn--}),this.widgetAreas.filter(s=>s.startColumn>o).forEach(s=>{s.startColumn--,s.endColumn--})}removeRow(o){this.numRows--,this.widgetAreas.forEach(s=>{s.startRow<=o&&s.endRow>=o+1&&s.endRow--}),this.widgetAreas.filter(s=>s.startRow>o).forEach(s=>{s.startRow--,s.endRow--})}resetAreas(o=null){this.widgetAreas.filter(s=>!o||s.guid!==o.guid).forEach(s=>s.reset()),this.numRows=this.resource.rowCount,this.numColumns=this.resource.columnCount}get isEditable(){return void 0!==this.gridResource.updateImmediately}buildGridAreaIds(){return this.gridAreas.filter(o=>!this.isGap(o)).map(o=>o.guid)}fetchSchema(){this.apiV3Service.grids.id(this.resource).form.post({}).subscribe(o=>this.schema=o.schema)}removeWidget(o){let s=this.resource.widgets.findIndex(w=>w.id===o.id);this.resource.widgets.splice(s,1),s=this.widgetAreas.findIndex(w=>w.widget.id===o.id),this.widgetAreas.splice(s,1),this.cleanupUnusedAreas(),this.rebuildAndPersist()}get widgetResources(){return this.resource&&this.resource.widgets||[]}rowWidgets(o){return this.widgetAreas.filter(s=>s.startRow===o)}moveSubsequentRowWidgets(o,s){o.forEach(w=>{w.startColumn>s&&(w.startColumn++,w.endColumn++)})}columnWidgets(o){return this.widgetAreas.filter(s=>s.startColumn===o)}moveSubsequentColumnWidgets(o,s){o.forEach(w=>{w.startRow>s&&(w.startRow++,w.endRow++)})}}J.\u0275fac=function(o){return new(o||J)(e.LFG(j.T),e.LFG(I.kl),e.LFG(y.D))},J.\u0275prov=e.Yz7({token:J,factory:J.\u0275fac});var R=t(54364),F=t(77616);const Y=[[["","slot","prepend"]],[["","slot","menu"]]],X=function(g){return{"-editable":g}};class ie{constructor(o){this.layout=o,this.editable=!0,this.onRenamed=new e.vpe}renamed(o){this.onRenamed.emit(o)}get isRenameable(){return this.editable&&this.layout.isEditable}}ie.\u0275fac=function(o){return new(o||ie)(e.Y36(J))},ie.\u0275cmp=e.Xpm({type:ie,selectors:[["widget-header"]],inputs:{name:"name",editable:"editable"},outputs:{onRenamed:"onRenamed"},ngContentSelectors:["[slot=prepend]","[slot=menu]"],decls:4,vars:5,consts:[["data-qa-selector","op-widget-box--header",1,"op-widget-box--header",3,"ngClass"],[1,"op-widget-box--header-title",3,"title","editable","onSave"]],template:function(o,s){1&o&&(e.F$t(Y),e.TgZ(0,"h3",0),e.Hsn(1),e.TgZ(2,"editable-toolbar-title",1),e.NdJ("onSave",function(S){return s.renamed(S)}),e.qZA(),e.Hsn(3,1),e.qZA()),2&o&&(e.Q6J("ngClass",e.VKq(3,X,s.isRenameable)),e.xp6(2),e.Q6J("title",s.name)("editable",s.isRenameable))},directives:[R.mk,F.s5],styles:[".op-widget-box--header.-editable[_ngcontent-%COMP%]{margin-top:0}.op-widget-box--header-title[_ngcontent-%COMP%]{padding-right:5px}"],changeDetection:0});var H=t(3786);t(75421);class ce{constructor(o){this.layout=o}area(o){this.widget(o.widget)}widget(o){this.layout.removeWidget(o)}}ce.\u0275fac=function(o){return new(o||ce)(e.LFG(J))},ce.\u0275prov=e.Yz7({token:ce,factory:ce.\u0275fac});class se{constructor(o,s,w){this.i18n=o,this.remove=s,this.layout=w,this.menuItemList=[this.removeItem]}get menuItems(){return()=>(0,H.mG)(this,void 0,void 0,function*(){return this.menuItemList})}get removeItem(){return{linkText:this.i18n.t("js.grid.remove"),onClick:()=>(this.remove.widget(this.resource),!0)}}get hasMenu(){return this.layout.isEditable}}se.\u0275fac=function(o){return new(o||se)(e.Y36(y.D),e.Y36(ce),e.Y36(J))},se.\u0275dir=e.lG2({type:se,inputs:{resource:"resource"}});var re=t(11269);function Me(g,o){if(1&g&&e._UZ(0,"icon-triggered-context-menu",1),2&g){const s=e.oxw();e.Q6J("menu-items",s.menuItems)}}class Ae extends se{}Ae.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Ae)))(s||Ae)}}(),Ae.\u0275cmp=e.Xpm({type:Ae,selectors:[["widget-menu"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"menu-items",4,"ngIf"],[3,"menu-items"]],template:function(o,s){1&o&&e.YNc(0,Me,1,1,"icon-triggered-context-menu",0),2&o&&e.Q6J("ngIf",s.hasMenu)},directives:[R.O5,re.I],styles:["[_nghost-%COMP%]{align-self:center}"]});var Ye=t(97047),ze=t(15334);class Xe extends b._{constructor(o,s,w){super(o,s),this.i18n=o,this.injector=s,this.currentProject=w}get projectIdentifier(){return this.currentProject.identifier}}Xe.\u0275fac=function(o){return new(o||Xe)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(P.R))},Xe.\u0275cmp=e.Xpm({type:Xe,selectors:[["ng-component"]],features:[e.qOj],decls:4,vars:3,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource"],["wp-isolated-query-space",""],[3,"static"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(S){return s.renameWidget(S)}),e._UZ(1,"widget-menu",1),e.qZA(),e.ynx(2,2),e._UZ(3,"op-wp-calendar",3),e.BQk()),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("static",!0))},directives:[ie,Ae,Ye.A,ze.X],encapsulation:2});var it=t(70233),at=t(70692),lt=t(77355),dt=t(60312),de=t(12877),oe=t(86469),D=t(62964);class G{getOrderedDaysData(o,s=moment.weekdays(!0),w=moment.localeData().firstDayOfWeek()){const S=w-1,ne=S>=0?o.splice(0,S):o.splice(S),fe=S>=0?[...o,...ne]:[...ne,...o];return fe.map((Ne,et)=>({weekDay:s[et],checked:Ne,originalIndex:this.getOriginalIndex(S,et,fe.length)}))}getOriginalIndex(o,s,w){let S=s+o;return S<0?S=w-1:S>=w&&(S=0),S}getCheckedValuesInOriginalOrder(o){const s=o.sort((w,S)=>w.originalIndex<S.originalIndex?-1:1).map(w=>w.checked);return this.validDays(s)}validDays(o){return o.every(s=>!s)?Array.apply(null,Array(7)).map(()=>!0):o}}function V(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",9),e._UZ(1,"label",10),e.TgZ(2,"span",11),e.TgZ(3,"span",12),e.TgZ(4,"input",13),e.NdJ("ngModelChange",function(S){return e.CHM(s).$implicit.checked=S}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit,w=o.index;e.xp6(1),e.Q6J("textContent",s.weekDay)("htmlFor","day_"+w),e.xp6(3),e.Q6J("id","day_"+w)("ngModel",s.checked)}}G.\u0275fac=function(o){return new(o||G)},G.\u0275prov=e.Yz7({token:G,factory:G.\u0275fac});class me extends dt.T{constructor(o,s,w,S,ne,fe,Ie,Ne,et,Dt){super(o,Ie,et),this.locals=o,this.I18n=s,this.injector=w,this.appRef=S,this.loadingIndicator=ne,this.notificationService=fe,this.cdRef=Ie,this.configuration=Ne,this.elementRef=et,this.timeEntriesCurrentUserConfigurationModalService=Dt,this.text={displayedDays:this.I18n.t("js.grid.widgets.time_entries_current_user.displayed_days"),closePopup:this.I18n.t("js.close_popup_title"),applyButton:this.I18n.t("js.modals.button_apply"),cancelButton:this.I18n.t("js.modals.button_cancel")}}ngOnInit(){const o=this.locals.options.days;this.daysOriginalCheckedValues=o.length>0?o:Array.from({length:7},()=>!0),this.days=this.timeEntriesCurrentUserConfigurationModalService.getOrderedDaysData(this.daysOriginalCheckedValues)}saveChanges(){const o=this.timeEntriesCurrentUserConfigurationModalService.getCheckedValuesInOriginalOrder(this.days);this.options={days:o},this.service.close()}}function $(g,o){if(1&g&&e._UZ(0,"icon-triggered-context-menu",1),2&g){const s=e.oxw();e.Q6J("menu-items",s.menuItems)}}me.\u0275fac=function(o){return new(o||me)(e.Y36(lt.E),e.Y36(y.D),e.Y36(e.zs3),e.Y36(e.z2F),e.Y36(oe.vt),e.Y36(D.q),e.Y36(e.sBO),e.Y36(de.e),e.Y36(e.SBq),e.Y36(G))},me.\u0275cmp=e.Xpm({type:me,selectors:[["ng-component"]],features:[e._Bn([G]),e.qOj],decls:10,vars:4,consts:[["data-indicator-name","modal","tabindex","0",1,"spot-modal"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["class","form--field -trailing-label",4,"ngFor","ngForOf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],[1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"],[1,"form--field","-trailing-label"],[1,"form--label",3,"textContent","htmlFor"],[1,"form--field-container"],[1,"form--check-box-container"],["type","checkbox","name","days",1,"form--check-box",3,"id","ngModel","ngModelChange"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,V,5,4,"div",4),e.qZA(),e.TgZ(6,"div",5),e.TgZ(7,"div",6),e.TgZ(8,"button",7),e.NdJ("click",function(S){return s.closeMe(S)}),e.qZA(),e.TgZ(9,"button",8),e.NdJ("click",function(){return s.saveChanges()}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.displayedDays),e.xp6(3),e.Q6J("ngForOf",s.days),e.xp6(3),e.Q6J("textContent",s.text.cancelButton),e.xp6(1),e.Q6J("textContent",s.text.applyButton))},directives:[R.sg,h.Wl,h.JJ,h.On],encapsulation:2});class Se extends se{constructor(o,s,w,S,ne){super(w,S,ne),this.injector=o,this.opModalService=s,this.i18n=w,this.remove=S,this.layout=ne,this.onConfigured=new e.vpe,this.menuItemList=[this.removeItem,this.configureItem]}get configureItem(){return{linkText:this.i18n.t("js.grid.configure"),onClick:()=>(this.opModalService.show(me,this.injector,this.locals).subscribe(o=>o.closingEvent.subscribe(()=>{o.options&&this.onConfigured.emit(o.options)})),!0)}}get locals(){return{options:this.resource.options}}}Se.\u0275fac=function(o){return new(o||Se)(e.Y36(e.zs3),e.Y36(lt.S),e.Y36(y.D),e.Y36(ce),e.Y36(J))},Se.\u0275cmp=e.Xpm({type:Se,selectors:[["widget-time-entries-current-user-menu"]],outputs:{onConfigured:"onConfigured"},features:[e.qOj],decls:1,vars:1,consts:[[3,"menu-items",4,"ngIf"],[3,"menu-items"]],template:function(o,s){1&o&&e.YNc(0,$,1,1,"icon-triggered-context-menu",0),2&o&&e.Q6J("ngIf",s.hasMenu)},directives:[R.O5,re.I],encapsulation:2});var ot=t(91594),st=t(2281),he=t(47775),ye=t(19019),xe=t(79474),De=t(12703),Qe=t(72388),Ve=t(46709),nt=t(52167),mt=t(1056),Ue=t(44022),Fe=t(67727),Te=t(10190),tt=t(18640),ut=t(2775);function Yt(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){return e.CHM(s),e.oxw().addEventToday()}),e._UZ(1,"op-icon",5),e._UZ(2,"span",6),e.qZA()}if(2&g){const s=e.oxw();e.uIk("aria-label",s.text.logTime),e.xp6(2),e.Q6J("textContent",s.text.logTime)}}const It="te-calendar--time-entry",wt="te-calendar--add-entry",Kt="-prohibited";class ei{constructor(o,s,w,S,ne,fe,Ie,Ne,et,Dt,Zt,Ci,gr,fr,aa,kr){this.states=o,this.apiV3Service=s,this.$state=w,this.element=S,this.i18n=ne,this.injector=fe,this.notifications=Ie,this.sanitizer=Ne,this.configuration=et,this.timezone=Dt,this.timeEntryEdit=Zt,this.timeEntryCreate=Ci,this.schemaCache=gr,this.colors=fr,this.browserDetector=aa,this.calendar=kr,this.static=!1,this.entries=new e.vpe,this.minHour=1,this.maxHour=12,this.labelIntervalHours=2,this.scaleRatio=1,this.memoizedCreateAllowed=!1,this.text={logTime:this.i18n.t("js.button_log_time"),today:this.i18n.t("js.team_planner.today")},this.calendarOptions={editable:!1,locale:this.i18n.locale,fixedWeekCount:!1,headerToolbar:{right:"",center:"title",left:"prev,next today"},buttonText:{today:this.text.today},initialView:"timeGridWeek",firstDay:this.configuration.startOfWeek(),hiddenDays:[],contentHeight:550,slotEventOverlap:!1,slotLabelInterval:`${this.labelIntervalHours}:00:00`,slotLabelFormat:Pi=>((this.maxHour-Pi.date.hour)/this.scaleRatio).toString(),allDaySlot:!1,displayEventTime:!1,slotMinTime:this.minHour-1+":00:00",slotMaxTime:`${this.maxHour}:00:00`,events:this.calendarEventsFunction.bind(this),eventOverlap:Pi=>!Pi.classNames.includes(It),plugins:[ye.ZP,xe.ZP],eventDidMount:this.alterEventEntry.bind(this),eventWillUnmount:this.beforeEventRemove.bind(this),eventClick:this.dispatchEventClick.bind(this),eventDrop:this.moveEvent.bind(this),dayHeaderClassNames:Pi=>this.calendar.applyNonWorkingDay(Pi),dayCellClassNames:Pi=>this.calendar.applyNonWorkingDay(Pi)}}set displayedDays(o){this.setHiddenDays(o)}calendarEventsFunction(o,s,w){this.fetchTimeEntries(o.start,o.end).then(S=>{this.entries.emit(S),s(this.buildEntries(S.elements,o))}).catch(w)}fetchTimeEntries(o,s){if(!this.memoizedTimeEntries||this.memoizedTimeEntries.start.getTime()!==o.getTime()||this.memoizedTimeEntries.end.getTime()!==s.getTime()){const w=this.apiV3Service.time_entries.list({filters:this.dmFilters(o,s),pageSize:500}).toPromise().then(S=>(this.memoizedCreateAllowed=!!S.createTimeEntry,S));this.memoizedTimeEntries={start:o,end:s,entries:w}}return this.memoizedTimeEntries.entries}buildEntries(o,s){return this.setRatio(o),this.buildTimeEntryEntries(o).concat(this.buildAuxEntries(o,s))}setRatio(o){const s=this.calculateDateSums(o),w=Math.max(...Object.values(s),0),S=this.scaleRatio;w>this.maxHour-this.minHour?this.scaleRatio=this.smallerSuitableRatio((this.maxHour-this.minHour)/w):this.scaleRatio=1,S!==this.scaleRatio&&this.ucCalendar.getApi().setOption("slotLabelFormat",ne=>((this.maxHour-ne.date.hour)/this.scaleRatio).toString())}buildTimeEntryEntries(o){const s={};return o.map(w=>{let S,ne;const fe=this.timezone.toHours(w.hours)*this.scaleRatio,Ie=w.spentOn;return s[Ie]?(S=s[Ie].clone().subtract(fe,"h"),ne=s[Ie].clone()):(S=st(Ie).add(this.maxHour-fe,"h"),ne=st(Ie).add(this.maxHour,"h")),s[Ie]=S,this.timeEntry(w,fe,S,ne)})}buildAuxEntries(o,s){const w=this.calculateDateSums(o),S=[];for(let ne=st(s.start);ne.diff(s.end,"days")<=0;ne.add(1,"days")){const fe=w[ne.format("YYYY-MM-DD")]||0;S.push(this.sumEntry(ne,fe)),this.memoizedCreateAllowed&&S.push(this.addEntry(ne,fe))}return S}calculateDateSums(o){const s={};return o.forEach(w=>{const S=this.timezone.toHours(w.hours),ne=w.spentOn;s[ne]?s[ne]+=S:s[ne]=S}),s}timeEntry(o,s,w,S){const ne=this.colors.toHsl(this.entryName(o)),fe=[It],Ie=S.diff(w,"m");return Ie<40&&fe.push("-no-fadeout"),{title:Ie<20?"":this.entryName(o),startEditable:!!o.update,start:w.format(),end:S.format(),backgroundColor:ne,borderColor:ne,classNames:fe,entry:o}}sumEntry(o,s){return{start:o.clone().add(this.maxHour-Math.min(s*this.scaleRatio,this.maxHour-.5)-.5,"h").format(),end:o.clone().add(this.maxHour-Math.min((s+.05)*this.scaleRatio,this.maxHour-.5),"h").format(),classNames:"te-calendar--day-sum",rendering:"background",startEditable:!1,sum:this.i18n.t("js.units.hour",{count:this.formatNumber(s)})}}addEntry(o,s){const w=[wt];return s>=24&&w.push(Kt),{start:o.clone().format(),end:o.clone().add(this.maxHour-Math.min(s*this.scaleRatio,this.maxHour-1)-.5,"h").format(),rendering:"background",classNames:w}}dmFilters(o,s){return[["spentOn","<>d",[st(o).format("YYYY-MM-DD"),st(s).subtract(1,"d").format("YYYY-MM-DD")]],["user_id","=",["me"]]]}dispatchEventClick(o){o.event.extendedProps.entry?this.editEvent(o.event.extendedProps.entry):o.el.classList.contains(wt)&&!o.el.classList.contains(Kt)&&this.addEvent(st(o.event.start))}editEvent(o){this.timeEntryEdit.edit(o,{showUserField:!1}).then(s=>{this.updateEventSet(s.entry,s.action)}).catch(()=>{})}moveEvent(o){const s=o.event.extendedProps.entry;s.spentOn=st(o.event.end).format("YYYY-MM-DD"),this.schemaCache.ensureLoaded(s).then(w=>{this.apiV3Service.time_entries.id(s).patch(s,w).subscribe(S=>this.updateEventSet(S,"update"),S=>{this.notifications.handleRawError(S),o.revert()})})}addEventToday(){this.addEvent(st(new Date))}addEvent(o){!this.memoizedCreateAllowed||this.timeEntryCreate.create(o,void 0,{showUserField:!1}).then(s=>{this.updateEventSet(s.entry,s.action)}).catch(()=>{})}updateEventSet(o,s){this.memoizedTimeEntries.entries.then(w=>{const S=w.elements.findIndex(ne=>ne.id===o.id);switch(s){case"update":w.elements[S]=o;break;case"destroy":w.elements.splice(S,1);break;case"create":this.apiV3Service.time_entries.cache.updateFor(o),w.elements.push(o);break;default:throw new Error("Invalid action")}this.ucCalendar.getApi().refetchEvents()})}alterEventEntry(o){this.appendAddIcon(o),this.appendSum(o),o.event.extendedProps.entry&&(this.addTooltip(o),this.prependDuration(o),this.appendFadeout(o))}appendAddIcon(o){if(!o.el.classList.contains(wt))return;const s=document.createElement("div");s.classList.add("te-calendar--add-icon"),s.innerText="+",o.el.append(s)}appendSum(o){o.event.extendedProps.sum&&(o.el.innerHTML=o.event.extendedProps.sum)}addTooltip(o){return(0,H.mG)(this,void 0,void 0,function*(){if(this.browserDetector.isMobile)return;const{entry:s}=o.event.extendedProps,w=yield this.schemaCache.ensureLoaded(s);jQuery(o.el).tooltip({content:this.tooltipContentString(o.event.extendedProps.entry,w),items:".fc-event",close(){jQuery(".ui-helper-hidden-accessible").remove()},track:!0})})}removeTooltip(o){jQuery(o.el).tooltip("instance")&&jQuery(o.el).tooltip("disable")}prependDuration(o){const s=o.event.extendedProps.entry;if(this.timezone.toHours(s.hours)<.5)return;const w=this.timezone.formattedDuration(s.hours);jQuery(o.el).find(".fc-event-title").prepend(`<div class="fc-duration">${w}</div>`)}appendFadeout(o){const s=o.event.extendedProps.entry;if(this.timezone.toHours(s.hours)<.5)return;const w=jQuery(o.el),S=jQuery('<div class="fc-fadeout"></div>'),ne=this.colors.toHsla(this.entryName(s),0),fe=this.colors.toHsla(this.entryName(s),100);S.css("background",`-webkit-linear-gradient(${ne} 0%, ${fe} 100%`),["-moz-linear-gradient","-o-linear-gradient","linear-gradient","-ms-linear-gradient"].forEach(Ie=>{S.css("background-image",`${Ie}(${ne} 0%, ${fe} 100%`)}),w.append(S)}beforeEventRemove(o){!o.event.extendedProps.entry||this.removeTooltip(o)}entryName(o){let{name:s}=o.project;return o.workPackage&&(s+=` - ${this.workPackageName(o)}`),s||"-"}workPackageName(o){const s=o.workPackage;return`#${(0,Te.Z)(s.href)}: ${s.name}`}tooltipContentString(o,s){return`\n        <ul class="tooltip--map">\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.project.name}:</span>\n            <span class="tooltip--map--value">${this.sanitizedValue(o.project.name)}</span>\n          </li>\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.workPackage.name}:</span>\n            <span class="tooltip--map--value">${o.workPackage?this.sanitizedValue(this.workPackageName(o)):this.i18n.t("js.placeholders.default")}</span>\n          </li>\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.activity.name}:</span>\n            <span class="tooltip--map--value">${this.sanitizedValue(o.activity.name)}</span>\n          </li>\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.hours.name}:</span>\n            <span class="tooltip--map--value">${this.timezone.formattedDuration(o.hours)}</span>\n          </li>\n          <li class="tooltip--map--item">\n            <span class="tooltip--map--key">${s.comment.name}:</span>\n            <span class="tooltip--map--value">${o.comment.raw||this.i18n.t("js.placeholders.default")}</span>\n          </li>\n        `}sanitizedValue(o){return this.sanitizer.sanitize(e.q3G.HTML,o)||""}formatNumber(o){return this.i18n.toNumber(o,{precision:2})}smallerSuitableRatio(o){for(let s=this.labelIntervalHours+1;s<100;s++){const w=this.labelIntervalHours/s;if(o>=w)return w}return 1}setHiddenDays(o){const s=Array.from(o,(w,S)=>w?null:(S+1)%7).filter(w=>null!==w);this.calendarOptions=Object.assign(Object.assign({},this.calendarOptions),{hiddenDays:s})}}ei.\u0275fac=function(o){return new(o||ei)(e.Y36(c.G),e.Y36(j.T),e.Y36(he.StateService),e.Y36(e.SBq),e.Y36(y.D),e.Y36(e.zs3),e.Y36(Fe.W),e.Y36(n.H7),e.Y36(de.e),e.Y36(at.B),e.Y36(Qe.d),e.Y36(Ve.f),e.Y36(Ue.y),e.Y36(nt.c),e.Y36(mt.o),e.Y36(tt.j))},ei.\u0275cmp=e.Xpm({type:ei,selectors:[["op-time-entries-calendar"]],viewQuery:function(o,s){if(1&o&&e.Gf(ot.woE,5),2&o){let w;e.iGM(w=e.CRH())&&(s.ucCalendar=w.first)}},inputs:{projectIdentifier:"projectIdentifier",static:"static",displayedDays:"displayedDays"},outputs:{entries:"entries"},features:[e._Bn([tt.j,Qe.d,Ve.f,De.l])],decls:4,vars:3,consts:[[1,"te-calendar--container","loading-indicator--location",2,"position","relative"],["class","button te-calendar--create-button",3,"click",4,"ngIf"],[3,"options"],["ucCalendar",""],[1,"button","te-calendar--create-button",3,"click"],["icon-classes","button--icon icon-log_time"],["aria-hidden","true",1,"button--text",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Yt,3,2,"button",1),e._UZ(2,"full-calendar",2,3),e.qZA()),2&o&&(e.uIk("data-indicator-name","table"),e.xp6(1),e.Q6J("ngIf",s.memoizedCreateAllowed),e.xp6(1),e.Q6J("options",s.calendarOptions))},directives:[R.O5,ot.woE,ut.o],styles:["@media screen and (max-width: 679px){op-time-entries-calendar .fc-toolbar-chunk:empty{display:none}}@media screen and (min-width: 680px){op-time-entries-calendar .te-calendar--create-button{position:absolute;right:0;top:0;margin-right:0}op-time-entries-calendar .fc-toolbar-chunk:last-child{flex-basis:165px;flex-shrink:0}}op-time-entries-calendar full-calendar{overflow-x:auto}op-time-entries-calendar full-calendar .fc-view{min-width:800px}op-time-entries-calendar full-calendar thead{display:table-footer-group}op-time-entries-calendar full-calendar th.fc-day,op-time-entries-calendar full-calendar th.fc-timegrid-axis{border-bottom:none}op-time-entries-calendar full-calendar table.fc-scrollgrid.fc-scrollgrid-liquid{border-left:none}.-browser-firefox op-time-entries-calendar full-calendar .fc-col-header-cell-cushion{padding:2px 4px!important}op-time-entries-calendar full-calendar .fc-event,op-time-entries-calendar full-calendar .fc-bgevent{border-radius:0;margin-right:8px;margin-left:8px}op-time-entries-calendar full-calendar .fc-head-container{border-color:#fff}op-time-entries-calendar full-calendar .fc-day-header{padding-top:5px}op-time-entries-calendar full-calendar .fc-widget-content{border-left-color:#fff}op-time-entries-calendar full-calendar .fc-widget-content .fc-day{border-left:0;border-right:0}op-time-entries-calendar full-calendar .fc-timeGrid-view .fc-day-grid .fc-row{min-height:1em}op-time-entries-calendar full-calendar .fc-timeGrid-view .fc-day-grid .fc-row .fc-content-skeleton{padding-bottom:0}op-time-entries-calendar full-calendar .fc-timegrid-event-harness .fc-timegrid-event{box-shadow:none}op-time-entries-calendar full-calendar .fc-timegrid-slot.fc-timegrid-slot-minor{border-top:0}op-time-entries-calendar full-calendar .te-calendar--day-sum{border:none;background-color:initial;color:#000;text-align:center;font-size:.875em;font-weight:bold;line-height:22px;opacity:1;cursor:default}op-time-entries-calendar full-calendar .te-calendar--add-entry{text-align:center;font-weight:bold;opacity:0;background:none;border:none;display:flex;align-items:center}op-time-entries-calendar full-calendar .te-calendar--add-entry:hover{opacity:1;transition:opacity 1s ease;background:#EAEAEA;border:1px solid #878787}op-time-entries-calendar full-calendar .te-calendar--add-entry .te-calendar--add-icon{color:#000;width:100%;font-weight:normal;font-size:1.5rem}op-time-entries-calendar full-calendar .te-calendar--add-entry.-prohibited{cursor:not-allowed}op-time-entries-calendar full-calendar .te-calendar--add-entry.-prohibited .te-calendar--add-icon{display:none}op-time-entries-calendar full-calendar .te-calendar--add-entry .fc-event-title-container{margin:0!important}op-time-entries-calendar full-calendar .te-calendar--time-entry{color:#fff}op-time-entries-calendar full-calendar .te-calendar--time-entry .fc-content{height:100%}op-time-entries-calendar full-calendar .te-calendar--time-entry .fc-fadeout{position:relative;bottom:2em;height:2em;z-index:5}op-time-entries-calendar full-calendar .te-calendar--time-entry.-no-fadeout .fc-fadeout{display:none}op-time-entries-calendar full-calendar .te-calendar--time-entry .fc-event-title-container{margin:0 4px!important;line-height:14px!important}op-time-entries-calendar full-calendar .fc-duration{display:inline-block;margin-right:5px;padding-right:5px;font-weight:bold}\n"],encapsulation:2,changeDetection:0});class Rt extends b._{constructor(o,s,w,S,ne){super(w,o),this.injector=o,this.timezone=s,this.i18n=w,this.pathHelper=S,this.cdr=ne,this.entries=[]}ngOnInit(){this.displayedDays=this.resource.options.days}updateEntries(o){this.entries=o.elements,this.cdr.detectChanges()}get total(){const o=this.entries.reduce((s,w)=>s+this.timezone.toHours(w.hours),0);return o>0?this.i18n.t("js.units.hour",{count:this.formatNumber(o)}):this.i18n.t("js.placeholders.default")}get isEditable(){return!1}updateConfiguration(o){this.resourceChanged.emit(this.setChangesetOptions(o)),this.displayedDays=[...o.days]}formatNumber(o){return this.i18n.toNumber(o,{precision:2})}}Rt.\u0275fac=function(o){return new(o||Rt)(e.Y36(e.zs3),e.Y36(at.B),e.Y36(y.D),e.Y36(it.j),e.Y36(e.sBO))},Rt.\u0275cmp=e.Xpm({type:Rt,selectors:[["ng-component"]],features:[e.qOj],decls:8,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource","onConfigured"],[3,"displayedDays","entries"],[1,"total-hours"],[3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.TgZ(1,"widget-time-entries-current-user-menu",1),e.NdJ("onConfigured",function(S){return s.updateConfiguration(S)}),e.qZA(),e.qZA(),e.TgZ(2,"op-time-entries-calendar",2),e.NdJ("entries",function(S){return s.updateEntries(S)}),e.qZA(),e.ynx(3),e.TgZ(4,"div",3),e.TgZ(5,"p"),e._uU(6,"Total: "),e._UZ(7,"span",4),e.qZA(),e.qZA(),e.BQk()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("displayedDays",s.displayedDays),e.xp6(5),e.Q6J("textContent",s.total))},directives:[ie,Se,ei],encapsulation:2,changeDetection:0});class Mt{constructor(o){this.Hook=o}get registered(){let o=[];return _.each(this.Hook.call("gridWidgets"),s=>{o=o.concat(s)}),o}}Mt.\u0275fac=function(o){return new(o||Mt)(e.LFG(C.$))},Mt.\u0275prov=e.Yz7({token:Mt,factory:Mt.\u0275fac});var Ot=t(91923),St=t(55216);function ti(g,o){if(1&g&&e._UZ(0,"op-no-results",5),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function Tt(g,o){if(1&g&&(e.ynx(0),e.TgZ(1,"h4",6),e._UZ(2,"a",7),e.qZA(),e.TgZ(3,"p",8),e._UZ(4,"em",9),e.qZA(),e._UZ(5,"div",10),e.BQk()),2&g){const s=o.$implicit,w=e.oxw();e.xp6(2),e.Q6J("href",w.documentPath(s),e.LSH)("textContent",s.title),e.xp6(2),e.Q6J("textContent",w.documentCreated(s)),e.xp6(1),e.Q6J("innerHtml",w.documentDescription(s),e.oJD)}}class qt extends b._{constructor(o,s,w,S,ne,fe,Ie,Ne,et){super(S,Ie),this.halResource=o,this.pathHelper=s,this.apiV3Service=w,this.i18n=S,this.timezone=ne,this.domSanitizer=fe,this.injector=Ie,this.currentProject=Ne,this.cdr=et,this.text={noResults:this.i18n.t("js.grid.widgets.documents.no_results")},this.entries=[],this.entriesLoaded=!1}ngOnInit(){this.halResource.get(this.documentsUrl).toPromise().then(o=>{this.entries=o.elements,this.entriesLoaded=!0,this.cdr.detectChanges()})}get isEditable(){return!1}documentPath(o){return`${this.pathHelper.appBasePath}/documents/${o.id}`}documentCreated(o){return this.timezone.formattedDatetime(o.createdAt)}documentDescription(o){return this.domSanitizer.sanitize(e.q3G.HTML,o.description.html)}get noEntries(){return!this.entries.length&&this.entriesLoaded}get documentsUrl(){const o=JSON.stringify([["updated_at","desc"]]);let s=`${this.apiV3Service.documents.toPath()}?sortBy=${o}&pageSize=10`;return this.currentProject.id&&(s+=`&filters=${JSON.stringify([{project_id:{operator:"=",values:[this.currentProject.id.toString()]}}])}`),s}}qt.\u0275fac=function(o){return new(o||qt)(e.Y36(Ot.u),e.Y36(it.j),e.Y36(j.T),e.Y36(y.D),e.Y36(at.B),e.Y36(n.H7),e.Y36(e.zs3),e.Y36(P.R),e.Y36(e.sBO))},qt.\u0275cmp=e.Xpm({type:qt,selectors:[["ng-component"]],features:[e.qOj],decls:5,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"title",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"title"],[1,"document-category-elements--header"],[3,"href","textContent"],[1,"document-category-elements--date"],[3,"textContent"],[1,"wiki","grid--widget-limited-text","op-uc-container",3,"innerHtml"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,ti,1,1,"op-no-results",3),e.YNc(4,Tt,6,4,"ng-container",4),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",s.noEntries),e.xp6(1),e.Q6J("ngForOf",s.entries))},directives:[ie,Ae,R.O5,R.sg,St.S],encapsulation:2,changeDetection:0});var Qt=t(3742);function Gt(g,o){if(1&g&&e._UZ(0,"op-no-results",6),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function ii(g,o){if(1&g&&e._UZ(0,"op-principal",13),2&g){const s=e.oxw().$implicit;e.Q6J("principal",s.author)("hideName",!0)}}function Jt(g,o){if(1&g&&e._UZ(0,"div",14),2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("innerHTML",w.text.addedBy(s),e.oJD)}}function Ce(g,o){if(1&g&&e._UZ(0,"p",15),2&g){const s=e.oxw().$implicit;e.Q6J("textContent",s.summary)}}function N(g,o){if(1&g&&(e.TgZ(0,"li",7),e.YNc(1,ii,1,2,"op-principal",8),e.TgZ(2,"div",9),e._UZ(3,"a",10),e._uU(4,": "),e._UZ(5,"a",10),e.qZA(),e.YNc(6,Jt,1,1,"div",11),e.YNc(7,Ce,1,1,"p",12),e.qZA()),2&g){const s=o.$implicit,w=e.oxw();e.xp6(1),e.Q6J("ngIf",s.author),e.xp6(2),e.Q6J("href",w.newsProjectPath(s),e.LSH)("textContent",w.newsProjectName(s)),e.xp6(2),e.Q6J("href",w.newsPath(s),e.LSH)("textContent",s.title),e.xp6(1),e.Q6J("ngIf",s.author),e.xp6(1),e.Q6J("ngIf",s.summary)}}class Q extends b._{constructor(o,s,w,S,ne,fe,Ie){super(s,w),this.pathHelper=o,this.i18n=s,this.injector=w,this.timezone=S,this.currentProject=ne,this.apiV3Service=fe,this.cdr=Ie,this.text={at:this.i18n.t("js.grid.widgets.news.at"),noResults:this.i18n.t("js.grid.widgets.news.no_results"),addedBy:Ne=>this.i18n.t("js.label_added_time_by",{author:this.newsAuthorName(Ne),age:this.newsCreated(Ne),authorLink:this.newsAuthorPath(Ne)})},this.entries=[],this.entriesLoaded=!1}ngOnInit(){this.apiV3Service.news.list(this.newsDmParams).subscribe(o=>this.setupNews(o.elements))}setupNews(o){this.entries=o,this.entriesLoaded=!0,this.cdr.detectChanges()}get isEditable(){return!1}newsPath(o){return this.pathHelper.newsPath(o.id)}newsProjectPath(o){var s;return this.pathHelper.projectPath((0,Te.Z)(null===(s=o.project)||void 0===s?void 0:s.href))}newsProjectName(o){var s;return null===(s=o.project)||void 0===s?void 0:s.name}newsAuthorName(o){var s;return null===(s=o.author)||void 0===s?void 0:s.name}newsAuthorPath(o){var s;return this.pathHelper.userPath(null===(s=o.author)||void 0===s?void 0:s.id)}newsCreated(o){return this.timezone.formattedDatetime(o.createdAt)}get noEntries(){return!this.entries.length&&this.entriesLoaded}get newsDmParams(){const o={sortBy:[["created_at","desc"]],pageSize:3};return this.currentProject.id&&(o.filters=[["project_id","=",[this.currentProject.id]]]),o}}Q.\u0275fac=function(o){return new(o||Q)(e.Y36(it.j),e.Y36(y.D),e.Y36(e.zs3),e.Y36(at.B),e.Y36(P.R),e.Y36(j.T),e.Y36(e.sBO))},Q.\u0275cmp=e.Xpm({type:Q,selectors:[["ng-component"]],features:[e.qOj],decls:6,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"title",4,"ngIf"],[1,"widget-box--arrow-links"],["class","widget-box--arrow-multiline",4,"ngFor","ngForOf"],[3,"title"],[1,"widget-box--arrow-multiline"],["class","widget-box--avatar news-author-avatar hidden-for-mobile",3,"principal","hideName",4,"ngIf"],[1,"widget-box--project"],[3,"href","textContent"],["class","widget-box--author news-author",3,"innerHTML",4,"ngIf"],["class","widget-box--additional-info",3,"textContent",4,"ngIf"],[1,"widget-box--avatar","news-author-avatar","hidden-for-mobile",3,"principal","hideName"],[1,"widget-box--author","news-author",3,"innerHTML"],[1,"widget-box--additional-info",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,Gt,1,1,"op-no-results",3),e.TgZ(4,"ul",4),e.YNc(5,N,8,7,"li",5),e.qZA(),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",s.noEntries),e.xp6(2),e.Q6J("ngForOf",s.entries))},directives:[ie,Ae,R.O5,R.sg,St.S,Qt.N],encapsulation:2,changeDetection:0});var je=t(79902);class Ee{constructor(o,s){this.apiV3Service=o,this.halResourceService=s}initialize(o){return this.apiV3Service.grids.list({filters:[["scope","=",[o]]]}).toPromise().then(s=>0===s.total?this.myPageForm(o):s.elements[0])}myPageForm(o){const s={_links:{scope:{href:o}}};return this.apiV3Service.grids.form.post(s).pipe((0,je.w)(w=>{const S=w.payload.$source,ne=this.halResourceService.createHalResource(S);return 0===ne.widgets.length&&(ne.rowCount=1,ne.columnCount=1),this.apiV3Service.grids.post(ne,w.schema)})).toPromise()}}Ee.\u0275fac=function(o){return new(o||Ee)(e.LFG(j.T),e.LFG(Ot.u))},Ee.\u0275prov=e.Yz7({token:Ee,factory:Ee.\u0275fac});const ht=["tabInner"];class kt{onSave(){this.tabInner.onSave()}}kt.\u0275fac=function(o){return new(o||kt)},kt.\u0275cmp=e.Xpm({type:kt,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(ht,7),2&o){let w;e.iGM(w=e.CRH())&&(s.tabInner=w.first)}},decls:3,vars:0,consts:[["wp-isolated-query-space",""],["tabInner",""]],template:function(o,s){1&o&&(e.ynx(0,0),e._UZ(1,"op-settings-tab-inner",null,1),e.BQk())},encapsulation:2});const si=["tabInner"];class Wt{onSave(){this.tabInner.onSave()}}Wt.\u0275fac=function(o){return new(o||Wt)},Wt.\u0275cmp=e.Xpm({type:Wt,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(si,7),2&o){let w;e.iGM(w=e.CRH())&&(s.tabInner=w.first)}},decls:3,vars:0,consts:[["wp-isolated-query-space",""],["tabInner",""]],template:function(o,s){1&o&&(e.ynx(0,0),e._UZ(1,"op-filters-tab-inner",null,1),e.BQk())},encapsulation:2});class ri{constructor(o,s,w){this.queryParams=o,this.chartOptions=s,this.chartType=w,this.queries=[],this.chartType=this.chartType||"horizontalBar"}static queryCreationParams(o,s){return{public:s,name:o.t("js.grid.widgets.work_packages_graph.title"),showHierarchies:!1,_links:{groupBy:{href:"/api/v3/queries/group_bys/status"}}}}}class ni{constructor(o,s,w,S){this.I18n=o,this.apiv3Service=s,this.notificationService=w,this.currentProject=S,this._forms={}}persistAndReload(){return this.persistChanges().then(()=>this.reloadQueries())}persistChanges(){const o=this.queries.map(s=>this.saveQuery(s));return Promise.all(o)}get datasets(){return this.queries.map(o=>({groups:o.results.groups,queryProps:"",label:o.name}))}reloadQueries(){return this.configuration.queries.length=0,this.loadQueries()}ensureQueryAndLoad(){return 0===this.queryParams.length?this.createInitial().then(o=>(this.queryParams.push({id:o.id}),this.loadQueries())):this.loadQueries()}createInitial(){return this.apiv3Service.queries.form.loadWithParams({pageSize:0},void 0,this.currentProject.identifier,ri.queryCreationParams(this.I18n,!!this.currentProject.identifier)).toPromise().then(([o,s])=>this.apiv3Service.queries.post(s,o).toPromise())}loadQueries(){const o=this.queryParams.map(s=>this.loadQuery(s));return Promise.all(o)}loadQuery(o){return this.apiv3Service.queries.find(Object.assign({pageSize:0},o.props),o.id,this.currentProject.identifier).toPromise().then(s=>{o.name&&(s.name=o.name),this.configuration.queries.push(s)})}saveQuery(o){return(0,H.mG)(this,void 0,void 0,function*(){return this.formFor(o).then(s=>this.apiv3Service.queries.id(o).patch(o,s).toPromise())})}get configuration(){return this._configuration}set configuration(o){this._configuration=o,this._formsPromise=null}formFor(o){return(0,H.mG)(this,void 0,void 0,function*(){return this.loadForms().then(()=>this._forms[o.id])})}get tabs(){const o=[{id:"graph-settings",name:this.I18n.t("js.chart.tabs.graph_settings"),componentClass:kt}],s=this.configuration.queries.map(w=>({id:w.id,name:this.I18n.t("js.work_packages.query.filters"),componentClass:Wt}));return o.concat(s)}loadForms(){if(!this._formsPromise){const o=this.configuration.queries.map(s=>this.apiv3Service.queries.form.load(s).toPromise().then(([w])=>{this._forms[s.id]=w}).catch(w=>this.notificationService.handleRawError(w)));this._formsPromise=Promise.all(o)}return this._formsPromise}get chartType(){return this._configuration.chartType}set chartType(o){this._configuration.chartType=o}get queries(){return this._configuration.queries}get chartOptions(){return this._configuration.chartOptions}get queryParams(){return this._configuration.queryParams}}ni.\u0275fac=function(o){return new(o||ni)(e.LFG(y.D),e.LFG(j.T),e.LFG(D.q),e.LFG(P.R))},ni.\u0275prov=e.Yz7({token:ni,factory:ni.\u0275fac});var Qi=t(61736),_i=t(90590);const bi=["tabContentOutlet"];function Ke(g,o){1&g&&e.GkF(0)}function Oe(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Ke,1,0,"ng-container",12),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngComponentOutlet",s.prependModalComponent)("ngComponentOutletInjector",s.injector)}}function Pe(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-scrollable-tabs",13),e.NdJ("tabSelected",function(S){return e.CHM(s),e.oxw().switchTo(S)}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("tabs",s.availableTabs)("currentTabId",null==s.tabPortalHost.currentTab?null:s.tabPortalHost.currentTab.id)}}const ve=new e.OlP("WpTableConfigurationModalPrependComponent");class pe extends dt.T{constructor(o,s,w,S,ne,fe,Ie,Ne,et,Dt,Zt,Ci){super(o,et,Zt),this.locals=o,this.prependModalComponent=s,this.I18n=w,this.injector=S,this.appRef=ne,this.componentFactoryResolver=fe,this.loadingIndicator=Ie,this.notificationService=Ne,this.cdRef=et,this.configurationService=Dt,this.elementRef=Zt,this.graphConfiguration=Ci,this.text={title:this.I18n.t("js.chart.modal_title"),closePopup:this.I18n.t("js.close_popup_title"),applyButton:this.I18n.t("js.modals.button_apply"),cancelButton:this.I18n.t("js.modals.button_cancel")}}ngOnInit(){this.$element=this.elementRef.nativeElement,this.loadingIndicator.indicator("modal").promise=this.graphConfiguration.loadForms().then(()=>{this.tabPortalHost=new Qi.M(this.graphConfiguration.tabs,this.tabContentOutlet.nativeElement,this.componentFactoryResolver,this.appRef,this.injector);const o=this.locals.initialTab,s=this.availableTabs.find(w=>w.id===o);this.cdRef.markForCheck(),this.switchTo(s||this.availableTabs[0])})}ngOnDestroy(){this.tabPortalHost.dispose()}get availableTabs(){return this.tabPortalHost.availableTabs}get currentTab(){return this.tabPortalHost.currentTab}switchTo(o){this.tabPortalHost.switchTo(o)}saveChanges(){this.tabPortalHost.activeComponents.forEach(o=>{o.onSave()}),this.configuration=this.graphConfiguration.configuration,this.service.close()}onClose(){return this.afterFocusOn.focus(),!0}get afterFocusOn(){return this.$element}}pe.\u0275fac=function(o){return new(o||pe)(e.Y36(lt.E),e.Y36(ve,8),e.Y36(y.D),e.Y36(e.zs3),e.Y36(e.z2F),e.Y36(e._Vd),e.Y36(oe.vt),e.Y36(D.q),e.Y36(e.sBO),e.Y36(de.e),e.Y36(e.SBq),e.Y36(ni))},pe.\u0275cmp=e.Xpm({type:pe,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(bi,7),2&o){let w;e.iGM(w=e.CRH())&&(s.tabContentOutlet=w.first)}},features:[e.qOj],decls:13,vars:5,consts:[["data-indicator-name","modal",1,"spot-modal","spot-modal_wide","wp-table--configuration-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[4,"ngIf"],[3,"tabs","currentTabId","tabSelected",4,"ngIf"],[1,"tab-content"],["tabContentOutlet",""],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","spot-modal-wp-table-configuration-save-button",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"tabs","currentTabId","tabSelected"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,Oe,2,2,"ng-container",4),e.YNc(6,Pe,1,2,"op-scrollable-tabs",5),e._UZ(7,"div",6,7),e.qZA(),e.TgZ(9,"div",8),e.TgZ(10,"div",9),e.TgZ(11,"button",10),e.NdJ("click",function(S){return s.closeMe(S)}),e.qZA(),e.TgZ(12,"button",11),e.NdJ("click",function(){return s.saveChanges()}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title),e.xp6(3),e.Q6J("ngIf",!!s.prependModalComponent),e.xp6(1),e.Q6J("ngIf",s.tabPortalHost),e.xp6(5),e.Q6J("textContent",s.text.cancelButton),e.xp6(1),e.Q6J("textContent",s.text.applyButton))},directives:[R.O5,R.$G,v.dw,_i.P],encapsulation:2,changeDetection:0});class ue extends se{constructor(o,s,w,S,ne){super(w,S,ne),this.injector=o,this.opModalService=s,this.i18n=w,this.remove=S,this.layout=ne,this.onConfigured=new e.vpe,this.menuItemList=[this.removeItem,this.configureItem]}get configureItem(){return{linkText:this.i18n.t("js.toolbar.settings.configure_view"),onClick:()=>(this.opModalService.show(this.configurationComponent,this.injector,this.locals).subscribe(o=>o.closingEvent.subscribe(()=>{o instanceof pe&&this.onConfigured.emit(o.configuration)})),!0)}}get locals(){return{}}}function Ze(g,o){if(1&g&&e._UZ(0,"icon-triggered-context-menu",1),2&g){const s=e.oxw();e.Q6J("menu-items",s.menuItems)}}ue.\u0275fac=function(o){return new(o||ue)(e.Y36(e.zs3),e.Y36(lt.S),e.Y36(y.D),e.Y36(ce),e.Y36(J))},ue.\u0275dir=e.lG2({type:ue,outputs:{onConfigured:"onConfigured"},features:[e.qOj]});class Ge extends ue{constructor(){super(...arguments),this.configurationComponent=pe}}Ge.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Ge)))(s||Ge)}}(),Ge.\u0275cmp=e.Xpm({type:Ge,selectors:[["widget-wp-graph-menu"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"menu-items",4,"ngIf"],[3,"menu-items"]],template:function(o,s){1&o&&e.YNc(0,Ze,1,1,"icon-triggered-context-menu",0),2&o&&e.Q6J("ngIf",s.hasMenu)},directives:[R.O5,re.I],encapsulation:2});var ft=t(22834);function Pt(g,o){if(1&g&&e._UZ(0,"canvas",4),2&g){const s=e.oxw();e.Q6J("datasets",s.chartData)("labels",s.chartLabels)("chartType",s.chartType)("options",s.internalChartOptions)}}function yt(g,o){if(1&g&&e._UZ(0,"op-no-results",5),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}const Lt=function(g){return{height:g}};class Xt{constructor(o){this.i18n=o,this.chartType="horizontalBar",this.error=null,this.chartHeight="100%",this.chartLabels=[],this.chartData=[],this.initialized=!1,this.text={noResults:this.i18n.t("js.work_packages.no_results.title")}}ngOnChanges(o){o.datasets?(this.setChartOptions(),this.updateChartData(),o.datasets.firstChange||(this.initialized=!0)):o.chartType&&this.setChartOptions()}updateChartData(){let o=_.uniq(this.datasets.reduce((w,S)=>{const ne=(S.groups||[]).map(fe=>fe.value);return w.concat(ne)},[]));const s=this.datasets.map(w=>{const S=(w.groups||[]).reduce((ne,fe)=>Object.assign(Object.assign({},ne),{[fe.value]:fe.count}),{});return{label:w.label,data:o.map(ne=>S[ne]||0)}});o=o.map(w=>w||this.i18n.t("js.placeholders.default")),this.setHeight(),this.chartLabels.length=0,this.chartLabels.push(...o),this.chartData.length=0,this.chartData.push(...s)}setChartOptions(){const o={responsive:!0,maintainAspectRatio:!1,legend:{display:this.datasets.length>1},plugins:{datalabels:{align:"bar"===this.chartType?"top":"center"}}},s=(()=>"horizontalBar"===this.chartType||"bar"===this.chartType?this.setChartAxesValues():{scales:{}})();this.internalChartOptions=Object.assign(Object.assign(Object.assign({},o),s),this.chartOptions)}get hasDataToDisplay(){return this.chartData.length>0&&this.chartData.some(o=>o.data.length>0)}setHeight(){if("horizontalBar"===this.chartType&&this.datasets&&this.datasets[0]){const o=[];this.datasets.forEach(w=>w.groups.forEach(S=>{o.includes(S.value)||o.push(S.value)}));let s=40*o.length;this.datasets.length>1&&(s+=40),s+=40,this.chartHeight=`${s}px`}else this.chartHeight="100%"}setChartAxesValues(){const o={scales:{}},s=[{stacked:!0,ticks:{callback:S=>Math.floor(S)===S?S:null}}],w=[{stacked:!0}];return o.scales&&("bar"===this.chartType?(o.scales.yAxes=s,o.scales.xAxes=w):"horizontalBar"===this.chartType&&(o.scales.xAxes=s,o.scales.yAxes=w)),o}}Xt.\u0275fac=function(o){return new(o||Xt)(e.Y36(y.D))},Xt.\u0275cmp=e.Xpm({type:Xt,selectors:[["op-wp-embedded-graph"]],inputs:{datasets:"datasets",chartOptions:"chartOptions",chartType:"chartType"},features:[e.TTD],decls:4,vars:5,consts:[[1,"op-wp-embeded-graph","work-packages-embedded-view--container","loading-indicator--location",3,"ngStyle"],["graphContainer",""],["baseChart","",3,"datasets","labels","chartType","options",4,"ngIf"],[3,"title",4,"ngIf"],["baseChart","",3,"datasets","labels","chartType","options"],[3,"title"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0,1),e.YNc(2,Pt,1,4,"canvas",2),e.YNc(3,yt,1,1,"op-no-results",3),e.qZA()),2&o&&(e.Q6J("ngStyle",e.VKq(3,Lt,s.chartHeight)),e.xp6(2),e.Q6J("ngIf",s.hasDataToDisplay),e.xp6(1),e.Q6J("ngIf",!s.hasDataToDisplay&&s.initialized))},directives:[R.PC,R.O5,ft.jh,St.S],styles:[".op-wp-embeded-graph.work-packages-embedded-view--container[_ngcontent-%COMP%]{height:100%;max-height:500px;position:relative}"]});class At extends b._{constructor(o,s,w,S){super(o,s),this.i18n=o,this.injector=s,this.cdr=w,this.graphConfiguration=S,this.datasets=[]}ngOnInit(){this.initializeConfiguration(),this.loadQueriesInitially()}set chartType(o){this.resource.options.chartType=o}updateGraph(o){this.graphConfiguration.persistAndReload().then(()=>{if(this.repaint(),this.resource.options.chartType!==this.graphConfiguration.chartType){const s=this.setChangesetOptions({chartType:this.graphConfiguration.chartType});this.resourceChanged.emit(s)}})}repaint(){this.datasets=this.graphConfiguration.datasets,this.cdr.detectChanges()}initializeConfiguration(){const o=[];this.resource.options.queryId&&o.push({id:this.resource.options.queryId}),this.graphConfiguration.configuration=new ri(o,this.resource.options.chartOptions,this.resource.options.chartType)}loadQueriesInitially(){this.graphConfiguration.ensureQueryAndLoad().then(()=>{if(!this.resource.options.queryId){const o=this.setChangesetOptions({queryId:this.graphConfiguration.queryParams[0].id});this.resourceChanged.emit(o)}this.repaint()})}get chartOptions(){return this.graphConfiguration.chartOptions}get chartType(){return this.graphConfiguration.chartType}}At.\u0275fac=function(o){return new(o||At)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(e.sBO),e.Y36(ni))},At.\u0275cmp=e.Xpm({type:At,selectors:[["widget-wp-graph"]],features:[e._Bn([ni]),e.qOj],decls:3,vars:4,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource","onConfigured"],[1,"grid--widget-content","-no-overflow",3,"datasets","chartType"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(S){return s.renameWidget(S)}),e.TgZ(1,"widget-wp-graph-menu",1),e.NdJ("onConfigured",function(S){return s.updateGraph(S)}),e.qZA(),e.qZA(),e._UZ(2,"op-wp-embedded-graph",2)),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("datasets",s.datasets)("chartType",s.chartType))},directives:[ie,Ge,Xt],styles:["wp-embedded-table[_ngcontent-%COMP%]{overflow:auto}"],changeDetection:0});var vt=t(55977),mi=t(43440),ai=t(84515),dn=t(57119);function Zi(g,o){if(1&g&&e._UZ(0,"icon-triggered-context-menu",1),2&g){const s=e.oxw();e.Q6J("menu-items",s.menuItems)}}class Ut extends ue{constructor(){super(...arguments),this.configurationComponent=dn.Q}}Ut.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Ut)))(s||Ut)}}(),Ut.\u0275cmp=e.Xpm({type:Ut,selectors:[["widget-wp-table-menu"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"menu-items",4,"ngIf"],[3,"menu-items"]],template:function(o,s){1&o&&e.YNc(0,Zi,1,1,"icon-triggered-context-menu",0),2&o&&e.Q6J("ngIf",s.hasMenu)},directives:[R.O5,re.I],encapsulation:2});var ci=t(166);function pi(g,o){if(1&g&&e._UZ(0,"wp-embedded-table",3),2&g){const s=e.oxw();e.Q6J("queryId",s.queryId)("configuration",s.configuration)}}class wi extends b._{constructor(o,s,w,S,ne,fe){super(o,s),this.i18n=o,this.injector=s,this.urlParamsHelper=w,this.state=S,this.querySpace=ne,this.apiV3Service=fe,this.inFlight=!1,this.configuration={actionsColumnEnabled:!1,columnMenuEnabled:!1,hierarchyToggleEnabled:!0,contextMenuEnabled:!1}}ngOnInit(){this.resource.options.queryId?this.queryId=this.resource.options.queryId:this.createInitial().then(o=>{const s=this.setChangesetOptions({queryId:o.id});this.resourceChanged.emit(s),this.queryId=o.id}),this.query$=this.querySpace.query.values$(),this.query$.pipe((0,ai.T)(2),this.untilDestroyed()).subscribe(o=>{this.ensureFormAndSaveQuery(o)})}get widgetName(){return this.resource.options.name}static get identifier(){return"work_packages_table"}ensureFormAndSaveQuery(o){this.queryForm?this.saveQuery(o,this.queryForm):this.apiV3Service.queries.form.load(o).subscribe(([s,w])=>{this.queryForm=s,this.saveQuery(o,s)})}saveQuery(o,s){this.inFlight=!0,this.apiV3Service.queries.id(o).patch(o,this.queryForm).subscribe(()=>this.inFlight=!1,()=>this.inFlight=!1)}createInitial(){const o=this.state.params.projectPath,s=this.resource.options.queryProps,w=Object.assign({pageSize:0},s);return this.apiV3Service.queries.form.loadWithParams(w,void 0,o,this.queryCreationParams()).toPromise().then(([S,ne])=>this.apiV3Service.queries.post(ne,S).toPromise().then(fe=>(delete this.resource.options.queryProps,fe)))}queryCreationParams(){return{hidden:!0,public:!!this.state.params.projectPath}}}wi.\u0275fac=function(o){return new(o||wi)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(vt.Z),e.Y36(he.StateService),e.Y36(mi.q),e.Y36(j.T))},wi.\u0275cmp=e.Xpm({type:wi,selectors:[["widget-wp-table"]],features:[e.qOj],decls:3,vars:3,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource"],[3,"queryId","configuration",4,"ngIf"],[3,"queryId","configuration"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(S){return s.renameWidget(S)}),e._UZ(1,"widget-wp-table-menu",1),e.qZA(),e.YNc(2,pi,1,2,"wp-embedded-table",2)),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("ngIf",s.queryId))},directives:[ie,Ut,R.O5,ci.Z],styles:["wp-embedded-table[_ngcontent-%COMP%]{overflow:auto}"],changeDetection:0});class gi extends b._{onResourceChanged(o){this.resourceChanged.emit(o)}}gi.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(gi)))(s||gi)}}(),gi.\u0275cmp=e.Xpm({type:gi,selectors:[["ng-component"]],features:[e.qOj],decls:2,vars:1,consts:[["wp-isolated-query-space","",1,"op-wp-table-qs"],[3,"resource","resourceChanged"]],template:function(o,s){1&o&&(e.ynx(0,0),e.TgZ(1,"widget-wp-table",1),e.NdJ("resourceChanged",function(S){return s.onResourceChanged(S)}),e.qZA(),e.BQk()),2&o&&(e.xp6(1),e.Q6J("resource",s.resource))},directives:[Ye.A,wi],styles:[".op-wp-table-qs[_ngcontent-%COMP%]   widget-wp-table[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}"]});var Ii=t(74647),Di=t(74478);class Qn{constructor(o,s,w){this.I18n=o,this.wpStatesInitialization=s,this.wpGraphConfiguration=w}initializeQuerySpace(){return this.wpGraphConfiguration.formFor(this.query).then(o=>{this.wpStatesInitialization.initialize(this.query,this.query.results),this.wpStatesInitialization.updateStatesFromForm(this.query,o)})}}var Ji=t(78434),bn=t(32557);function wn(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-query-filters",1),e.NdJ("filtersChanged",function(S){e.CHM(s);return e.oxw().filters=S}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("filters",s.filters)}}class Yi extends Qn{constructor(o,s,w,S,ne){super(o,S,ne),this.I18n=o,this.wpTableFilters=s,this.wpFiltersService=w,this.wpStatesInitialization=S,this.wpGraphConfiguration=ne,this.filters=[],this.text={multiSelectLabel:this.I18n.t("js.work_packages.label_column_multiselect")}}ngOnInit(){this.initializeQuerySpace().then(()=>{this.wpTableFilters.onReady().then(()=>{this.filters=this.wpTableFilters.current})})}onSave(){this.filters&&(this.wpTableFilters.replaceIfComplete(this.filters),this.wpTableFilters.applyToQuery(this.wpGraphConfiguration.queries[0]))}get query(){return this.wpGraphConfiguration.queries[0]}}Yi.\u0275fac=function(o){return new(o||Yi)(e.Y36(y.D),e.Y36(Ii.Z),e.Y36(Ji.U),e.Y36(Di.f),e.Y36(ni))},Yi.\u0275cmp=e.Xpm({type:Yi,selectors:[["op-filters-tab-inner"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"filters","filtersChanged",4,"ngIf"],[3,"filters","filtersChanged"]],template:function(o,s){1&o&&e.YNc(0,wn,1,1,"op-query-filters",0),2&o&&e.Q6J("ngIf",!!s.filters)},directives:[R.O5,bn.H],encapsulation:2});var Jn=t(61083);function Yn(g,o){if(1&g&&e._UZ(0,"option",9),2&g){const s=o.$implicit;e.Q6J("ngValue",s)("textContent",s.name)}}function $n(g,o){if(1&g&&e._UZ(0,"option",9),2&g){const s=o.$implicit;e.Q6J("ngValue",s)("textContent",s.label)}}const fi=function(){return{standalone:!0}};class li extends Qn{constructor(o,s,w,S){super(o,w,S),this.I18n=o,this.wpTableGroupBy=s,this.wpStatesInitialization=w,this.wpGraphConfiguration=S,this.availableGroups=[],this.text={group_by:this.I18n.t("js.chart.axis_criteria"),chart_type:this.I18n.t("js.chart.type")}}onSave(){this.wpGraphConfiguration.chartType=this.currentChartType.identifier,this.wpGraphConfiguration.queries.forEach(o=>{this.wpTableGroupBy.applyToQuery(o)})}get currentGroup(){return this.wpTableGroupBy.current}set currentGroup(o){this.wpTableGroupBy.update(o)}ngOnInit(){this.initializeQuerySpace().then(()=>{this.wpTableGroupBy.onReady().then(()=>{this.initializeAvailableGroups(),this.initializeAvailableChartType()})})}initializeAvailableGroups(){let{available:o}=this.wpTableGroupBy;const{current:s}=this.wpTableGroupBy;s&&(o=o.filter(w=>w.id!==s.id),o=o.concat(s)),this.availableGroups=_.sortBy(o,"name")}initializeAvailableChartType(){this.availableChartTypes=_.sortBy([{identifier:"horizontalBar",label:this.I18n.t("js.chart.types.horizontal_bar")},{identifier:"bar",label:this.I18n.t("js.chart.types.bar")},{identifier:"line",label:this.I18n.t("js.chart.types.line")},{identifier:"pie",label:this.I18n.t("js.chart.types.pie")},{identifier:"doughnut",label:this.I18n.t("js.chart.types.doughnut")},{identifier:"radar",label:this.I18n.t("js.chart.types.radar")},{identifier:"polarArea",label:this.I18n.t("js.chart.types.polar_area")}],"label"),this.currentChartType=this.availableChartTypes.find(o=>o.identifier===this.wpGraphConfiguration.configuration.chartType)||this.availableChartTypes[0]}get query(){return this.wpGraphConfiguration.queries[0]}}li.\u0275fac=function(o){return new(o||li)(e.Y36(y.D),e.Y36(Jn.w),e.Y36(Di.f),e.Y36(ni))},li.\u0275cmp=e.Xpm({type:li,selectors:[["op-settings-tab-inner"]],features:[e.qOj],decls:14,vars:10,consts:[[1,"form"],[1,"form--field"],["for","selected_grouping",1,"form--label",3,"textContent"],[1,"form--field-container"],[1,"form--select-container","-middle"],["id","selected_grouping",1,"form--select",3,"ngModel","ngModelOptions","ngModelChange"],[3,"ngValue","textContent",4,"ngFor","ngForOf"],["for","selected_chart_type",1,"form--label",3,"textContent"],["id","selected_chart_type",3,"ngModel","ngModelOptions","ngModelChange"],[3,"ngValue","textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div"),e.TgZ(1,"form",0),e.TgZ(2,"div",1),e._UZ(3,"label",2),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e.TgZ(6,"select",5),e.NdJ("ngModelChange",function(S){return s.currentGroup=S}),e.YNc(7,Yn,1,2,"option",6),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",1),e._UZ(9,"label",7),e.TgZ(10,"div",3),e.TgZ(11,"div",4),e.TgZ(12,"select",8),e.NdJ("ngModelChange",function(S){return s.currentChartType=S}),e.YNc(13,$n,1,2,"option",6),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.group_by),e.xp6(3),e.Q6J("ngModel",s.currentGroup)("ngModelOptions",e.DdM(8,fi)),e.xp6(1),e.Q6J("ngForOf",s.availableGroups),e.xp6(2),e.Q6J("textContent",s.text.chart_type),e.xp6(3),e.Q6J("ngModel",s.currentChartType)("ngModelOptions",e.DdM(9,fi)),e.xp6(1),e.Q6J("ngForOf",s.availableChartTypes))},directives:[h._Y,h.JL,h.F,h.EJ,h.JJ,h.On,R.sg,h.YN,h.Kr],encapsulation:2});t(52386);var Si=t(5282);class vi{constructor(){}}vi.\u0275fac=function(o){return new(o||vi)},vi.\u0275mod=e.oAB({type:vi}),vi.\u0275inj=e.cJS({imports:[[l.H,u.K,f.H,ft.m9,Si.l]]}),e.B6R(Wt,[Ye.A,Yi],[]),e.B6R(kt,[Ye.A,li],[]);var ui=t(83845),$i=t(61342),$t=t(54262);function Vn(g,o){if(1&g&&(e.TgZ(0,"edit-form",5),e._UZ(1,"op-editable-attribute-field",6),e.qZA()),2&g){const s=o.ngIf;e.Q6J("resource",s),e.xp6(1),e.Q6J("resource",s)}}class Ai extends b._{constructor(o,s,w,S,ne){super(o,s),this.i18n=o,this.injector=s,this.apiV3Service=w,this.currentProject=S,this.cdRef=ne}ngOnInit(){this.currentProject.id&&(this.project$=this.apiV3Service.projects.id(this.currentProject.id).get(),this.cdRef.detectChanges())}get isEditable(){return!1}}Ai.\u0275fac=function(o){return new(o||Ai)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(j.T),e.Y36(P.R),e.Y36(e.sBO))},Ai.\u0275cmp=e.Xpm({type:Ai,selectors:[["ng-component"]],features:[e._Bn([De.l]),e.qOj],decls:6,vars:7,consts:[[3,"name","editable"],["slot","prepend","attribute","description",3,"attributeScope"],["slot","menu",3,"resource"],[1,"grid--widget-content","-allow-inner-overflow"],[3,"resource",4,"ngIf"],[3,"resource"],["fieldName","description",3,"resource"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"attribute-help-text",1),e._UZ(2,"widget-menu",2),e.qZA(),e.TgZ(3,"div",3),e.YNc(4,Vn,2,2,"edit-form",4),e.ALo(5,"async"),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("attributeScope","Project"),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",e.lcZ(5,5,s.project$)))},directives:[ie,ui.y,Ae,R.O5,$i.n,$t.k],pipes:[R.Ov],encapsulation:2,changeDetection:0});const qi=["wpEmbeddedGraphMulti"],Hn=["wpEmbeddedGraphSingle"];function xi(g,o){if(1&g&&(e.TgZ(0,"option",4),e._uU(1),e.qZA()),2&g){const s=o.$implicit;e.Q6J("ngValue",s.key),e.xp6(1),e.Oqu(s.label)}}function Tn(g,o){if(1&g&&(e.TgZ(0,"div",5),e._UZ(1,"div",6),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.error)}}function kn(g,o){if(1&g&&e._UZ(0,"op-wp-embedded-graph",7,8),2&g){const s=e.oxw();e.Q6J("datasets",s.datasets)("chartOptions",s.chartOptions)}}function Pn(g,o){if(1&g&&e._UZ(0,"op-wp-embedded-graph",7,9),2&g){const s=e.oxw();e.Q6J("datasets",s.datasets)("chartOptions",s.chartOptions)}}class ji{constructor(o,s,w,S){this.elementRef=o,this.I18n=s,this.graphConfigurationService=w,this.cdr=S,this.groupBy="status",this.chartOptions={maintainAspectRatio:!1},this.datasets=[],this.displayModeSingle=!0,this.error=null,this.availableGroupBy=[{label:s.t("js.work_packages.properties.category"),key:"category"},{label:s.t("js.work_packages.properties.type"),key:"type"},{label:s.t("js.work_packages.properties.status"),key:"status"},{label:s.t("js.work_packages.properties.priority"),key:"priority"},{label:s.t("js.work_packages.properties.author"),key:"author"},{label:s.t("js.work_packages.properties.assignee"),key:"assignee"}]}ngOnInit(){const o=this.elementRef.nativeElement;this.additionalFilter=JSON.parse(o.getAttribute("additional-filter")),this.setQueryProps()}setQueryProps(){this.datasets=[];const o=this.graphParams;this.graphConfigurationService.configuration=new ri(o,{},"horizontalBar"),this.graphConfigurationService.reloadQueries().then(()=>{this.datasets=this.sortedDatasets(this.graphConfigurationService.datasets,o),this.cdr.detectChanges()}).catch(()=>{this.error=this.I18n.t("js.chart.errors.could_not_load"),this.cdr.detectChanges()})}get graphParams(){const o=[];return"status"===this.groupBy?(this.displayModeSingle=!0,o.push({name:this.I18n.t("js.label_all"),props:this.propsBoth})):(this.displayModeSingle=!1,o.push({name:this.I18n.t("js.label_open_work_packages"),props:this.propsOpen}),o.push({name:this.I18n.t("js.label_closed_work_packages"),props:this.propsClosed})),o}sortedDatasets(o,s){const w=s.map(S=>S.name);return o.slice().sort((S,ne)=>w.indexOf(S.label)-w.indexOf(ne.label))}get propsBoth(){return this.baseProps()}get propsOpen(){return this.baseProps({status:{operator:"o",values:[]}})}get propsClosed(){return this.baseProps({status:{operator:"c",values:[]}})}baseProps(o){const s=[{subprojectId:{operator:"*",values:[]}}];return o&&s.push(o),this.additionalFilter&&s.push(this.additionalFilter),{"columns[]":[],filters:JSON.stringify(s),group_by:this.groupBy,pageSize:0}}get displaySingle(){return this.displayModeSingle}get displayMulti(){return!this.displayModeSingle}get currentGraph(){return this.displaySingle?this.embeddedGraphSingle:this.embeddedGraphMulti}}ji.\u0275fac=function(o){return new(o||ji)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(ni),e.Y36(e.sBO))},ji.\u0275cmp=e.Xpm({type:ji,selectors:[["wp-overview-graph"]],viewQuery:function(o,s){if(1&o&&(e.Gf(qi,5),e.Gf(Hn,5)),2&o){let w;e.iGM(w=e.CRH())&&(s.embeddedGraphMulti=w.first),e.iGM(w=e.CRH())&&(s.embeddedGraphSingle=w.first)}},inputs:{additionalFilter:"additionalFilter",groupBy:"groupBy",chartOptions:"chartOptions"},features:[e._Bn([ni])],decls:5,vars:5,consts:[[3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],["class","op-toast -error",4,"ngIf"],[3,"datasets","chartOptions",4,"ngIf"],[3,"ngValue"],[1,"op-toast","-error"],[1,"op-toast--content",3,"textContent"],[3,"datasets","chartOptions"],["wpEmbeddedGraphMulti",""],["wpEmbeddedGraphSingle",""]],template:function(o,s){1&o&&(e.TgZ(0,"select",0),e.NdJ("ngModelChange",function(S){return s.groupBy=S})("ngModelChange",function(){return s.setQueryProps()}),e.YNc(1,xi,2,2,"option",1),e.qZA(),e.YNc(2,Tn,2,1,"div",2),e.YNc(3,kn,2,2,"op-wp-embedded-graph",3),e.YNc(4,Pn,2,2,"op-wp-embedded-graph",3)),2&o&&(e.Q6J("ngModel",s.groupBy),e.xp6(1),e.Q6J("ngForOf",s.availableGroupBy),e.xp6(1),e.Q6J("ngIf",s.error),e.xp6(1),e.Q6J("ngIf",s.displayMulti),e.xp6(1),e.Q6J("ngIf",s.displaySingle))},directives:[h.EJ,h.JJ,h.On,R.sg,R.O5,h.YN,h.Kr,Xt],styles:["wp-embedded-graph[_ngcontent-%COMP%]{margin-top:20px;display:block}"],changeDetection:0});class Wi extends b._{}Wi.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Wi)))(s||Wi)}}(),Wi.\u0275cmp=e.Xpm({type:Wi,selectors:[["ng-component"]],features:[e.qOj],decls:3,vars:3,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource"],[1,"grid--widget-content","-no-overflow",3,"groupBy"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(S){return s.renameWidget(S)}),e._UZ(1,"widget-menu",1),e.qZA(),e._UZ(2,"wp-overview-graph",2)),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("groupBy","type"))},directives:[ie,Ae,ji],encapsulation:2,changeDetection:0});var xn=t(86029),un=t(94232);class Mi extends xn.k{constructor(o,s,w,S){super(),this.elementRef=o,this.injector=s,this.halResource=w,this.schemaCache=S,this.fieldName="text"}onFocusOut(){}initialize(o){this.initializeChangeset(o),this.valueChanged$=new Z.X(o.options.text)}reinitialize(o){this.initializeChangeset(o)}handleUserSubmit(){return this.update()}reset(o=""){let s=o;o.length>0&&(s+="\n"),this.changeset.setValue(this.fieldName,{raw:s})}get schema(){return{name:I18n.t("js.grid.widgets.custom_text.title"),writable:!0,required:!1,type:"Formattable",hasDefault:!1}}update(){return(0,H.mG)(this,void 0,void 0,function*(){return this.onSubmit().then(()=>{this.valueChanged$.next(this.rawText),this.deactivate()})})}get rawText(){return _.get(this.textValue,"raw","")}get htmlText(){return _.get(this.textValue,"html","")}get textValue(){return this.changeset.value(this.fieldName)}handleUserCancel(){this.deactivate()}deactivate(){this.changeset.clear(),this.active=!1}activate(){this.active=!0}get inEditMode(){return!1}get inFlight(){return this.changeset.inFlight}focus(){const o=this.elementRef.nativeElement.querySelector(".inplace-editing--trigger-container");o&&o.focus()}setErrors(){}handleUserKeydown(){}isChanged(){return!this.changeset.isEmpty()}stopPropagation(){return!1}initializeChangeset(o){const s="customtext-schema",w=o.grid,S={text:o.options.text,getEditorContext:()=>({type:"full",macros:"resource"}),canAddAttachments:o.grid.canAddAttachments,_links:{attachments:w.attachments,schema:{href:s}}};w.prepareAttachment&&(S._links.prepareAttachment=w.prepareAttachment);const ne=this.halResource.createHalResource(S,!0),fe={text:this.schema,_links:{self:{href:s}}},Ie=this.halResource.createHalResource(fe,!0);this.schemaCache.update(ne,Ie),this.changeset=new un.W(ne)}}Mi.\u0275fac=function(o){return new(o||Mi)(e.LFG(e.SBq),e.LFG(e.zs3),e.LFG(Ot.u),e.LFG(Ue.y))},Mi.\u0275prov=e.Yz7({token:Mi,factory:Mi.\u0275fac});var hi=t(9170),hn=t(92058),Li=t(41689);const Xi=["displayContainer"];function _n(g,o){if(1&g&&e._UZ(0,"div",12),2&g){const s=e.oxw(2);e.Q6J("innerHTML",s.customText,e.oJD)}}function En(g,o){if(1&g&&e._UZ(0,"div",13),2&g){const s=e.oxw(2);e.Q6J("innerHTML",s.placeholderText,e.oJD)}}function Ri(g,o){if(1&g&&(e.TgZ(0,"span",8,9),e.YNc(2,_n,1,1,"div",10),e.YNc(3,En,1,1,"div",11),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("ngIf",!s.textEmpty),e.xp6(1),e.Q6J("ngIf",s.textEmpty)}}function Kn(g,o){if(1&g&&e._UZ(0,"edit-form-portal",14),2&g){const s=e.oxw();e.Q6J("schemaInput",s.schema)("changeInput",s.changeset)("editFieldHandler",s.handler)}}function en(g,o){if(1&g&&e._UZ(0,"attachments",15),2&g){const s=e.oxw();e.Q6J("resource",s.resource.grid)}}function Vi(g,o){1&g&&e.GkF(0)}function tn(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(S){return e.CHM(s),e.oxw(2).activate(S)}),e.YNc(1,Vi,1,0,"ng-container",20),e.qZA()}if(2&g){const s=e.oxw(2),w=e.MAs(3);e.Q6J("ngClass",s.inplaceEditClasses),e.xp6(1),e.Q6J("ngTemplateOutlet",w)}}function On(g,o){1&g&&e.GkF(0)}function Mn(g,o){if(1&g&&(e.ynx(0),e.YNc(1,On,1,0,"ng-container",20),e.BQk()),2&g){e.oxw(2);const s=e.MAs(3);e.xp6(1),e.Q6J("ngTemplateOutlet",s)}}const Ti=function(g){return{"inline-edit--container":g}};function We(g,o){if(1&g&&(e.TgZ(0,"div",16),e.YNc(1,tn,2,2,"button",17),e.YNc(2,Mn,2,1,"ng-container",18),e.qZA()),2&g){const s=e.oxw();e.Q6J("ngClass",e.VKq(3,Ti,s.isTextEditable)),e.xp6(1),e.Q6J("ngIf",s.isTextEditable),e.xp6(1),e.Q6J("ngIf",!s.isTextEditable)}}class W extends b._{constructor(o,s,w,S,ne,fe,Ie){super(o,s),this.i18n=o,this.injector=s,this.handler=w,this.cdr=S,this.sanitization=ne,this.appRef=fe,this.layout=Ie}ngOnInit(){this.setupVariables(!0),this.handler.valueChanged$.pipe(this.untilDestroyed(),(0,hi.h)(o=>o!==this.resource.options.text)).subscribe(o=>{const s=this.setChangesetOptions({text:{raw:o}});this.resourceChanged.emit(s)})}ngOnChanges(o){o.resource.currentValue.options.text.raw!==this.currentRawText&&(this.setupVariables(),this.cdr.detectChanges())}activate(o){this.clickedElementIsLinkWithinDisplayContainer(o)||this.resource.grid.updateAttachments().then(()=>{this.handler.activate()})}get placeholderText(){return this.i18n.t("js.grid.widgets.work_packages_overview.placeholder")}get inplaceEditClasses(){let o="inplace-editing--container inline-edit--display-field -editable";return this.textEmpty&&(o+=" -placeholder"),o}get schema(){return this.handler.schema}get changeset(){return this.handler.changeset}get active(){return this.handler.active}get textEmpty(){return!this.currentRawText.length}get isTextEditable(){return this.layout.isEditable}setupVariables(o=!1){this.memorizeRawText(),o?this.handler.initialize(this.resource):this.handler.reinitialize(this.resource),this.memorizeCustomText()}memorizeRawText(){this.currentRawText=this.resource.options.text.raw}memorizeCustomText(){this.customText=this.sanitization.bypassSecurityTrustHtml(this.handler.htmlText),setTimeout(()=>{d.Z.bootstrapOptionalEmbeddable(this.appRef,this.displayContainer.nativeElement)},100)}clickedElementIsLinkWithinDisplayContainer(o){return this.displayContainer.nativeElement.contains(o.target.closest("a,macro"))}}W.\u0275fac=function(o){return new(o||W)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(Mi),e.Y36(e.sBO),e.Y36(n.H7),e.Y36(e.z2F),e.Y36(J))},W.\u0275cmp=e.Xpm({type:W,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(Xi,5),2&o){let w;e.iGM(w=e.CRH())&&(s.displayContainer=w.first)}},features:[e._Bn([Mi]),e.qOj,e.TTD],decls:9,vars:5,consts:[[3,"name","onRenamed"],["slot","menu",3,"resource"],["text",""],[1,"grid--widget-content","-custom-text","-allow-inner-overflow"],[1,"inline-edit--container","inplace-edit"],[3,"schemaInput","changeInput","editFieldHandler",4,"ngIf"],["data-allow-uploading","true",3,"resource",4,"ngIf"],["class","inplace-edit--read wiki -no-label",3,"ngClass",4,"ngIf"],[1,"inline-edit--formattable-display-text","-default"],["displayContainer",""],["class","op-uc-container",3,"innerHTML",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[1,"op-uc-container",3,"innerHTML"],[3,"innerHTML"],[3,"schemaInput","changeInput","editFieldHandler"],["data-allow-uploading","true",3,"resource"],[1,"inplace-edit--read","wiki","-no-label",3,"ngClass"],["type","button",3,"ngClass","click",4,"ngIf"],[4,"ngIf"],["type","button",3,"ngClass","click"],[4,"ngTemplateOutlet"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e.NdJ("onRenamed",function(S){return s.renameWidget(S)}),e._UZ(1,"widget-menu",1),e.qZA(),e.YNc(2,Ri,4,2,"ng-template",null,2,e.W1O),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e.YNc(6,Kn,1,3,"edit-form-portal",5),e.YNc(7,en,1,1,"attachments",6),e.YNc(8,We,3,5,"div",7),e.qZA(),e.qZA()),2&o&&(e.Q6J("name",s.widgetName),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(5),e.Q6J("ngIf",s.active),e.xp6(1),e.Q6J("ngIf",s.active),e.xp6(1),e.Q6J("ngIf",!s.active))},directives:[ie,Ae,R.O5,hn.m,Li.t,R.mk,R.tP],encapsulation:2,changeDetection:0});const q=["contentContainer"];function le(g,o){if(1&g&&(e.ynx(0),e.TgZ(1,"div",7),e._uU(2),e._UZ(3,"attribute-help-text",8),e.qZA(),e.TgZ(4,"div",9),e._UZ(5,"op-editable-attribute-field",10),e.qZA(),e.BQk()),2&g){const s=o.$implicit,w=e.oxw().ngIf;e.xp6(1),e.uIk("title",s.label),e.xp6(1),e.hij(" ",s.label," "),e.xp6(1),e.Q6J("attribute",s.key)("attributeScope","Project"),e.xp6(2),e.Q6J("resource",w)("fieldName",s.key)}}function be(g,o){if(1&g&&(e.TgZ(0,"edit-form",4),e.TgZ(1,"div",5),e.YNc(2,le,6,6,"ng-container",6),e.qZA(),e.qZA()),2&g){const s=o.ngIf,w=e.oxw();e.Q6J("resource",s),e.xp6(2),e.Q6J("ngForOf",w.customFields)}}class Re extends b._{constructor(o,s,w,S,ne){super(o,s),this.i18n=o,this.injector=s,this.apiV3Service=w,this.currentProject=S,this.cdRef=ne,this.customFields=[]}ngOnInit(){this.loadAndRender(),this.currentProject.id&&(this.project$=this.apiV3Service.projects.id(this.currentProject.id).requireAndStream())}get isEditable(){return!1}loadAndRender(){Promise.all([this.loadProjectSchema()]).then(([o])=>{this.setCustomFields(o)})}loadProjectSchema(){return this.apiV3Service.projects.schema.get().toPromise()}setCustomFields(o){Object.entries(o).forEach(([s,w])=>{/customField\d+/.exec(s)&&this.customFields.push({key:s,label:w.name})}),this.cdRef.detectChanges()}}Re.\u0275fac=function(o){return new(o||Re)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(j.T),e.Y36(P.R),e.Y36(e.sBO))},Re.\u0275cmp=e.Xpm({type:Re,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(q,7),2&o){let w;e.iGM(w=e.CRH())&&(s.contentContainer=w.first)}},features:[e._Bn([De.l]),e.qOj],decls:5,vars:6,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"resource",4,"ngIf"],[3,"resource"],[1,"attributes-map"],[4,"ngFor","ngForOf"],[1,"attributes-map--key"],[3,"attribute","attributeScope"],[1,"attributes-map--value"],[3,"resource","fieldName"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,be,3,2,"edit-form",3),e.ALo(4,"async"),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,s.project$)))},directives:[ie,Ae,R.O5,$i.n,R.sg,ui.y,$t.k],pipes:[R.Ov],encapsulation:2,changeDetection:0});var Be=t(29161),$e=t(84335);class He extends b._{constructor(o,s,w,S,ne,fe){super(w,o),this.injector=o,this.timezone=s,this.i18n=w,this.pathHelper=S,this.confirmDialog=ne,this.cdr=fe,this.text={edit:this.i18n.t("js.button_edit"),delete:this.i18n.t("js.button_delete"),confirmDelete:{text:this.i18n.t("js.modals.destroy_time_entry.text"),title:this.i18n.t("js.modals.destroy_time_entry.title")},noResults:this.i18n.t("js.grid.widgets.time_entries_list.no_results")},this.entries=[],this.entriesLoaded=!1,this.rows=[]}ngOnInit(){this.apiV3Service.time_entries.list({filters:this.dmFilters(),pageSize:500}).subscribe(o=>(0,H.mG)(this,void 0,void 0,function*(){this.buildEntries(o.elements),o.count>0&&(this.schema=yield this.loadSchema()),this.entriesLoaded=!0,this.cdr.detectChanges()}))}get total(){const o=this.entries.reduce((s,w)=>s+this.timezone.toHours(w.hours),0);return this.i18n.t("js.units.hour",{count:this.formatNumber(o)})}get anyEntries(){return!!this.entries.length}activityName(o){return o.activity.name}projectName(o){return o.project.name}workPackageName(o){return`#${o.workPackage.id}: ${o.workPackage.name}`}workPackageId(o){return o.workPackage.id}comment(o){return o.comment&&o.comment.raw}hours(o){return this.formatNumber(this.timezone.toHours(o.hours))}workPackagePath(o){return this.pathHelper.workPackagePath((0,Te.Z)(o.workPackage.href))}get isEditable(){return!1}editTimeEntry(o){this.apiV3Service.time_entries.id(o.id).get().subscribe(s=>{this.timeEntryEditService.edit(s).then(w=>{const S=this.entries.findIndex(fe=>fe.id===w.entry.id),ne=this.entries;ne[S]=w.entry,this.buildEntries(ne)}).catch(()=>{})})}deleteIfConfirmed(o,s){var w,S,ne;o.preventDefault(),this.confirmDialog.confirm({text:this.text.confirmDelete,closeByEscape:!0,showClose:!0,closeByDocument:!0,passedData:[`#${(0,Te.Z)(null===(w=s.workPackage)||void 0===w?void 0:w.href)} ${null===(S=s.workPackage)||void 0===S?void 0:S.name}`,`${this.i18n.t("js.units.hour",{count:this.timezone.toHours(s.hours)})} (${null===(ne=s.activity)||void 0===ne?void 0:ne.name})`],dangerHighlighting:!0}).then(()=>{s.delete().then(()=>{const fe=this.entries.filter(Ie=>s.id!==Ie.id);this.buildEntries(fe)})}).catch(()=>{})}buildEntries(o){this.entries=o;const s={};o.forEach(ne=>{const fe=ne.spentOn;s[fe]||(s[fe]=0),s[fe]+=this.timezone.toHours(ne.hours)});const w=o.sort((ne,fe)=>fe.spentOn.localeCompare(ne.spentOn));this.rows=[];let S=null;w.forEach(ne=>{ne.spentOn!==S&&(S=ne.spentOn,this.rows.push({date:this.timezone.formattedDate(S),sum:this.formatNumber(s[S])})),this.rows.push({date:S,entry:ne})})}formatNumber(o){return this.i18n.toNumber(o,{precision:2})}get noEntries(){return!this.entries.length&&this.entriesLoaded}loadSchema(){return this.apiV3Service.time_entries.schema.get().toPromise()}}He.\u0275fac=function(o){return new(o||He)(e.Y36(e.zs3),e.Y36(at.B),e.Y36(y.D),e.Y36(it.j),e.Y36($e.D),e.Y36(e.sBO))},He.\u0275dir=e.lG2({type:He,features:[e.qOj]}),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",Qe.d)],He.prototype,"timeEntryEditService",void 0),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",j.T)],He.prototype,"apiV3Service",void 0);var _t=t(81979);function qe(g,o){if(1&g&&e._UZ(0,"op-no-results",4),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function pt(g,o){if(1&g&&e._UZ(0,"td",26),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.Q6J("textContent",w.activityName(s.entry))}}function Bt(g,o){if(1&g&&(e.TgZ(0,"td",27),e._UZ(1,"strong",6),e.qZA()),2&g){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("textContent",s.date)}}function Ft(g,o){if(1&g&&(e.TgZ(0,"td",28),e._uU(1),e._UZ(2,"a",29),e.qZA()),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.xp6(1),e.hij(" ",w.projectName(s.entry)," - "),e.xp6(1),e.Q6J("href",w.workPackagePath(s.entry),e.LSH)("textContent",w.workPackageName(s.entry))}}function Ct(g,o){if(1&g&&e._UZ(0,"td",30),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.Q6J("textContent",w.projectName(s.entry))}}function xt(g,o){if(1&g&&e._UZ(0,"td",31),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.Q6J("textContent",w.comment(s.entry))}}function oi(g,o){if(1&g&&e._UZ(0,"td",32),2&g){const s=e.oxw().$implicit,w=e.oxw(3);e.Q6J("textContent",w.hours(s.entry))}}function nn(g,o){if(1&g&&(e.TgZ(0,"td",33),e._UZ(1,"em",6),e.qZA()),2&g){const s=e.oxw().$implicit;e.xp6(1),e.Q6J("textContent",s.sum)}}function Gn(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",34),e.NdJ("click",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw(3).editTimeEntry(S.entry)}),e._UZ(1,"op-icon",35),e.qZA()}if(2&g){const s=e.oxw(4);e.Q6J("title",s.text.edit)}}function Fi(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",34),e.NdJ("click",function(S){e.CHM(s);const ne=e.oxw().$implicit;return e.oxw(3).deleteIfConfirmed(S,ne.entry)}),e._UZ(1,"op-icon",36),e.qZA()}if(2&g){const s=e.oxw(4);e.Q6J("title",s.text.delete)}}function ge(g,o){if(1&g&&(e.TgZ(0,"tr",16),e.YNc(1,pt,1,1,"td",17),e.YNc(2,Bt,2,1,"td",18),e.YNc(3,Ft,3,3,"td",19),e.YNc(4,Ct,1,1,"td",20),e.YNc(5,xt,1,1,"td",21),e.YNc(6,oi,1,1,"td",22),e.YNc(7,nn,2,1,"td",23),e.TgZ(8,"td",24),e.YNc(9,Gn,2,1,"a",25),e.YNc(10,Fi,2,1,"a",25),e.qZA(),e.qZA()),2&g){const s=o.$implicit;e.xp6(1),e.Q6J("ngIf",s.entry),e.xp6(1),e.Q6J("ngIf",s.sum),e.xp6(1),e.Q6J("ngIf",s.entry&&s.entry.workPackage),e.xp6(1),e.Q6J("ngIf",s.entry&&!s.entry.workPackage),e.xp6(1),e.Q6J("ngIf",s.entry),e.xp6(1),e.Q6J("ngIf",s.entry),e.xp6(1),e.Q6J("ngIf",s.sum),e.xp6(2),e.Q6J("ngIf",s.entry&&s.entry.updateImmediately),e.xp6(1),e.Q6J("ngIf",s.entry&&s.entry.delete)}}function U(g,o){if(1&g&&(e.TgZ(0,"div",8),e.TgZ(1,"table",9),e.TgZ(2,"colgroup"),e._UZ(3,"col",10),e._UZ(4,"col",10),e._UZ(5,"col",10),e._UZ(6,"col",10),e._UZ(7,"col"),e.qZA(),e.TgZ(8,"thead",11),e.TgZ(9,"tr"),e.TgZ(10,"th"),e.TgZ(11,"div",12),e.TgZ(12,"div",13),e._UZ(13,"span",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"th"),e.TgZ(15,"div",12),e.TgZ(16,"div",13),e._UZ(17,"span",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(18,"th"),e.TgZ(19,"div",12),e.TgZ(20,"div",13),e._UZ(21,"span",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(22,"th"),e.TgZ(23,"div",12),e.TgZ(24,"div",13),e._UZ(25,"span",6),e.qZA(),e.qZA(),e.qZA(),e.TgZ(26,"th"),e._UZ(27,"div",14),e.qZA(),e.qZA(),e.qZA(),e.TgZ(28,"tbody"),e.YNc(29,ge,11,9,"tr",15),e.qZA(),e.qZA(),e.qZA()),2&g){const s=e.oxw(2);e.xp6(13),e.Q6J("textContent",s.schema.activity.name),e.xp6(4),e.Q6J("textContent",s.schema.workPackage.name),e.xp6(4),e.Q6J("textContent",s.schema.comment.name),e.xp6(4),e.Q6J("textContent",s.schema.hours.name),e.xp6(4),e.Q6J("ngForOf",s.rows)}}function A(g,o){if(1&g&&(e.ynx(0),e.TgZ(1,"div",5),e.TgZ(2,"p"),e._uU(3,"Total: "),e._UZ(4,"span",6),e.qZA(),e.qZA(),e.YNc(5,U,30,5,"div",7),e.BQk()),2&g){const s=e.oxw();e.xp6(4),e.Q6J("textContent",s.total),e.xp6(1),e.Q6J("ngIf",s.entriesLoaded&&s.anyEntries)}}class _e extends He{constructor(o,s,w,S,ne,fe,Ie){super(o,s,w,S,ne,fe),this.injector=o,this.timezone=s,this.i18n=w,this.pathHelper=S,this.confirmDialog=ne,this.cdr=fe,this.currentProject=Ie}dmFilters(){return[["spentOn",">t-",["7"]],["project_id","=",[this.currentProject.id]]]}}_e.\u0275fac=function(o){return new(o||_e)(e.Y36(e.zs3),e.Y36(at.B),e.Y36(y.D),e.Y36(it.j),e.Y36($e.D),e.Y36(e.sBO),e.Y36(P.R))},_e.\u0275cmp=e.Xpm({type:_e,selectors:[["ng-component"]],features:[e.qOj],decls:4,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[3,"title",4,"ngIf"],[4,"ngIf"],[3,"title"],[1,"total-hours"],[3,"textContent"],["class","generic-table--results-container",4,"ngIf"],[1,"generic-table--results-container"],[1,"generic-table","time-entries"],["opHighlightCol",""],[1,"-sticky"],[1,"generic-table--sort-header-outer"],[1,"generic-table--sort-header"],[1,"generic-table--empty-header"],["class","time-entry",4,"ngFor","ngForOf"],[1,"time-entry"],["class","activity",3,"textContent",4,"ngIf"],["colspan","3",4,"ngIf"],["class","subject",4,"ngIf"],["class","subject",3,"textContent",4,"ngIf"],["class","comments",3,"textContent",4,"ngIf"],["class","hours",3,"textContent",4,"ngIf"],["class","hours",4,"ngIf"],[1,"buttons"],[3,"title","click",4,"ngIf"],[1,"activity",3,"textContent"],["colspan","3"],[1,"subject"],[3,"href","textContent"],[1,"subject",3,"textContent"],[1,"comments",3,"textContent"],[1,"hours",3,"textContent"],[1,"hours"],[3,"title","click"],["icon-classes","icon-context icon-edit"],["icon-classes","icon-context icon-delete"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.YNc(2,qe,1,1,"op-no-results",2),e.YNc(3,A,6,2,"ng-container",3)),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(1),e.Q6J("ngIf",s.noEntries),e.xp6(1),e.Q6J("ngIf",!s.noEntries))},directives:[ie,Ae,R.O5,St.S,_t.K,R.sg,ut.o],encapsulation:2});var we=t(23237);function Je(g,o){if(1&g&&e._UZ(0,"op-no-results",5),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function rt(g,o){1&g&&(e.TgZ(0,"span"),e._uU(1,", "),e.qZA())}function ct(g,o){if(1&g&&(e.TgZ(0,"span"),e._UZ(1,"a",6),e.YNc(2,rt,2,0,"span",7),e.qZA()),2&g){const s=o.$implicit,w=o.last,S=e.oxw();e.xp6(1),e.Q6J("href",S.projectPath(s),e.LSH)("textContent",S.projectName(s)),e.xp6(1),e.Q6J("ngIf",!w)}}class Et extends b._{constructor(o,s,w,S,ne,fe,Ie,Ne){super(w,S),this.halResource=o,this.pathHelper=s,this.i18n=w,this.injector=S,this.timezone=ne,this.apiV3Service=fe,this.currentProject=Ie,this.cdr=Ne,this.text={noResults:this.i18n.t("js.grid.widgets.subprojects.no_results")}}ngOnInit(){this.apiV3Service.projects.list(this.projectListParams).subscribe(o=>{this.projects=o.elements,this.cdr.detectChanges()})}get isEditable(){return!1}projectPath(o){return this.pathHelper.projectPath(o.identifier)}projectName(o){return o.name}get noEntries(){return this.projects&&!this.projects.length}get projectListParams(){return{sortBy:[["name","asc"]],filters:[["parent_id","=",[this.currentProject.id]]],pageSize:we.LZ}}}function di(g,o){if(1&g&&e._UZ(0,"op-no-results",10),2&g){const s=e.oxw();e.Q6J("title",s.text.noResults)}}function Ei(g,o){1&g&&(e.ynx(0),e._uU(1,", "),e.BQk())}function Ui(g,o){if(1&g&&(e.ynx(0),e._UZ(1,"op-principal",13),e.YNc(2,Ei,2,0,"ng-container",14),e.BQk()),2&g){const s=o.$implicit,w=o.last;e.xp6(1),e.Q6J("principal",s),e.xp6(1),e.Q6J("ngIf",!w)}}function Hi(g,o){if(1&g&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.qZA(),e.TgZ(3,"div",12),e.YNc(4,Ui,3,2,"ng-container",5),e.qZA(),e.BQk()),2&g){const s=o.$implicit;e.xp6(2),e.hij(" ",s.role.name," "),e.xp6(2),e.Q6J("ngForOf",s.users)}}function xr(g,o){if(1&g&&(e.TgZ(0,"div",15),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.moreMembersText," ")}}function qn(g,o){if(1&g&&(e.TgZ(0,"a",16),e._UZ(1,"i",17),e._UZ(2,"span",18),e.qZA()),2&g){const s=e.oxw();e.Q6J("href",s.projectMembershipsPath+"?show_add_members=true",e.LSH),e.xp6(2),e.Q6J("textContent",s.text.add)}}function Er(g,o){if(1&g&&(e.TgZ(0,"a",19),e._UZ(1,"i",20),e._UZ(2,"span",18),e.qZA()),2&g){const s=e.oxw();e.Q6J("href",s.projectMembershipsPath,e.LSH),e.xp6(2),e.Q6J("textContent",s.text.viewAll)}}Et.\u0275fac=function(o){return new(o||Et)(e.Y36(Ot.u),e.Y36(it.j),e.Y36(y.D),e.Y36(e.zs3),e.Y36(at.B),e.Y36(j.T),e.Y36(P.R),e.Y36(e.sBO))},Et.\u0275cmp=e.Xpm({type:Et,selectors:[["ng-component"]],features:[e.qOj],decls:5,vars:5,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"title",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"title"],[3,"href","textContent"],[4,"ngIf"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,Je,1,1,"op-no-results",3),e.YNc(4,ct,3,3,"span",4),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",s.noEntries),e.xp6(1),e.Q6J("ngForOf",s.projects))},directives:[ie,Ae,R.O5,R.sg,St.S],encapsulation:2,changeDetection:0});class In extends b._{constructor(o,s,w,S,ne,fe){super(w,S),this.pathHelper=o,this.apiV3Service=s,this.i18n=w,this.injector=S,this.currentProject=ne,this.cdr=fe,this.text={add:this.i18n.t("js.grid.widgets.members.add"),noResults:this.i18n.t("js.grid.widgets.members.no_results"),viewAll:this.i18n.t("js.grid.widgets.members.view_all_members")},this.entriesByRoles={},this.entriesLoaded=!1,this.membersAddable=!1}ngOnInit(){this.apiV3Service.memberships.list(this.listMembersParams).subscribe(o=>{this.partitionEntriesByRole(o.elements),this.sortUsersByName(),this.totalMembers=o.total,this.entriesLoaded=!0,this.cdr.detectChanges()}),this.apiV3Service.memberships.available_projects.list(this.listAvailableProjectsParams).subscribe(o=>{this.membersAddable=o.total>0})}get isEditable(){return!1}get noMembers(){return this.entriesLoaded&&!Object.keys(this.entriesByRoles).length}get moreMembers(){return this.entriesLoaded&&this.totalMembers>100}get moreMembersText(){return I18n.t("js.grid.widgets.members.too_many",{count:100,total:this.totalMembers})}get projectMembershipsPath(){return this.pathHelper.projectMembershipsPath(this.currentProject.identifier)}get usersByRole(){return Object.values(this.entriesByRoles)}partitionEntriesByRole(o){o.forEach(s=>{s.roles.forEach(w=>{this.entriesByRoles[w.id]||(this.entriesByRoles[w.id]={role:w,users:[]}),this.entriesByRoles[w.id].users.push(s.principal)})})}sortUsersByName(){Object.values(this.entriesByRoles).forEach(o=>{o.users.sort((s,w)=>s.name.localeCompare(w.name))})}get listMembersParams(){const o={sortBy:[["created_at","desc"]],pageSize:100};return this.currentProject.id&&(o.filters=[["project_id","=",[this.currentProject.id]]]),o}get listAvailableProjectsParams(){const o={};return this.currentProject.id&&(o.filters=[["id","=",[this.currentProject.id]]]),o}}In.\u0275fac=function(o){return new(o||In)(e.Y36(it.j),e.Y36(j.T),e.Y36(y.D),e.Y36(e.zs3),e.Y36(P.R),e.Y36(e.sBO))},In.\u0275cmp=e.Xpm({type:In,selectors:[["ng-component"]],features:[e.qOj],decls:10,vars:8,consts:[[3,"name","editable"],["slot","menu",3,"resource"],[1,"grid--widget-content"],[3,"title",4,"ngIf"],[1,"op-members-widget--attributes-map","-minimal-keys"],[4,"ngFor","ngForOf"],["class","op-members-widget--notification",4,"ngIf"],[1,"op-members-widget--grid--widget-footer"],["class","button -alt-highlight",3,"href",4,"ngIf"],["class","button -highlight-inverted",3,"href",4,"ngIf"],[3,"title"],[1,"attributes-map--key"],[1,"attributes-map--value"],["size","mini",3,"principal"],[4,"ngIf"],[1,"op-members-widget--notification"],[1,"button","-alt-highlight",3,"href"],["aria-hidden","true",1,"button--icon","icon-add"],[1,"button--text",3,"textContent"],[1,"button","-highlight-inverted",3,"href"],["aria-hidden","true",1,"button--icon","icon-group"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"widget-menu",1),e.qZA(),e.TgZ(2,"div",2),e.YNc(3,di,1,1,"op-no-results",3),e.TgZ(4,"div",4),e.YNc(5,Hi,5,2,"ng-container",5),e.qZA(),e.YNc(6,xr,2,1,"div",6),e.qZA(),e.TgZ(7,"div",7),e.YNc(8,qn,3,2,"a",8),e.YNc(9,Er,3,2,"a",9),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",s.noMembers),e.xp6(2),e.Q6J("ngForOf",s.usersByRole),e.xp6(1),e.Q6J("ngIf",s.moreMembers),e.xp6(2),e.Q6J("ngIf",s.membersAddable),e.xp6(1),e.Q6J("ngIf",!s.noMembers))},directives:[ie,Ae,R.O5,R.sg,St.S,Qt.N],styles:[".op-members-widget--notification[_ngcontent-%COMP%]{font-style:italic;margin-top:.5rem}.op-members-widget--grid--widget-footer[_ngcontent-%COMP%]{margin-top:.5rem}.op-members-widget--grid--widget-footer[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{margin-bottom:0}.op-members-widget--attributes-map[_ngcontent-%COMP%]{padding-bottom:.875rem;line-height:1.5rem}.op-members-widget--attributes-map[_ngcontent-%COMP%]   .attributes-map--value[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:.5rem}"],changeDetection:0});var Or=t(84897);const Mr=["contentContainer"];function mn(g,o){if(1&g&&(e.TgZ(0,"edit-form",5),e.TgZ(1,"div",6),e._UZ(2,"op-editable-attribute-field",7),e.qZA(),e.TgZ(3,"div",8),e._UZ(4,"op-editable-attribute-field",9),e.qZA(),e.qZA()),2&g){const s=o.ngIf;e.Q6J("resource",s),e.xp6(2),e.Q6J("resource",s),e.xp6(2),e.Q6J("resource",s)}}class Dn extends b._{constructor(o,s,w,S,ne){super(o,s),this.i18n=o,this.injector=s,this.apiV3Service=w,this.currentProject=S,this.cdRef=ne,this.currentStatusCode="not set",this.explanation=""}ngOnInit(){this.currentProject.id&&(this.project$=this.apiV3Service.projects.id(this.currentProject.id).get(),this.cdRef.detectChanges())}get isEditable(){return!1}}Dn.\u0275fac=function(o){return new(o||Dn)(e.Y36(y.D),e.Y36(e.zs3),e.Y36(j.T),e.Y36(P.R),e.Y36(e.sBO))},Dn.\u0275cmp=e.Xpm({type:Dn,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(Mr,7),2&o){let w;e.iGM(w=e.CRH())&&(s.contentContainer=w.first)}},features:[e._Bn([Or.B,mi.q,De.l]),e.qOj],decls:6,vars:7,consts:[[3,"name","editable"],["slot","prepend","attribute","status",3,"attributeScope"],["slot","menu",3,"resource"],[1,"grid--widget-content","-allow-inner-overflow"],[3,"resource",4,"ngIf"],[3,"resource"],[1,"project-status--container"],["fieldName","status","wrapperClasses","project-status--display-field",3,"resource"],[1,"project-status-explanation--container"],["fieldName","statusExplanation",3,"resource"]],template:function(o,s){1&o&&(e.TgZ(0,"widget-header",0),e._UZ(1,"attribute-help-text",1),e._UZ(2,"widget-menu",2),e.qZA(),e.TgZ(3,"div",3),e.YNc(4,mn,5,3,"edit-form",4),e.ALo(5,"async"),e.qZA()),2&o&&(e.Q6J("name",s.widgetName)("editable",s.isEditable),e.xp6(1),e.Q6J("attributeScope","Project"),e.xp6(1),e.Q6J("resource",s.resource),e.xp6(2),e.Q6J("ngIf",e.lcZ(5,5,s.project$)))},directives:[ie,ui.y,Ae,R.O5,$i.n,$t.k],pipes:[R.Ov],encapsulation:2,changeDetection:0});var Ir=t(54349),gn=t(26269);class Oi{constructor(o){!function(g){const o=g.get(C.$),s=g.get(y.D);o.register("gridWidgets",()=>{const w=["id","project","type","subject"],S=new gn.qM;S.add("assignee","=",["me"]),S.add("status","o",[]);const ne={"columns[]":w,filters:S.toJson()},fe=new gn.qM;fe.add("responsible","=",["me"]),fe.add("status","o",[]);const Ie={"columns[]":w,filters:fe.toJson()},Ne=new gn.qM;Ne.add("author","=",["me"]),Ne.add("status","o",[]);const et={"columns[]":w,filters:Ne.toJson()},Dt=new gn.qM;Dt.add("watcher","=",["me"]),Dt.add("status","o",[]);const Zt={"columns[]":w,filters:Dt.toJson()};return[{identifier:"work_packages_assigned",component:gi,title:s.t("js.grid.widgets.work_packages_assigned.title"),properties:{queryProps:ne,name:s.t("js.grid.widgets.work_packages_assigned.title")}},{identifier:"work_packages_accountable",component:gi,title:s.t("js.grid.widgets.work_packages_accountable.title"),properties:{queryProps:Ie,name:s.t("js.grid.widgets.work_packages_accountable.title")}},{identifier:"work_packages_created",component:gi,title:s.t("js.grid.widgets.work_packages_created.title"),properties:{queryProps:et,name:s.t("js.grid.widgets.work_packages_created.title")}},{identifier:"work_packages_watched",component:gi,title:s.t("js.grid.widgets.work_packages_watched.title"),properties:{queryProps:Zt,name:s.t("js.grid.widgets.work_packages_watched.title")}},{identifier:"work_packages_table",component:gi,title:s.t("js.grid.widgets.work_packages_table.title"),properties:{name:s.t("js.grid.widgets.work_packages_table.title")}},{identifier:"work_packages_graph",component:At,title:s.t("js.grid.widgets.work_packages_graph.title"),properties:{name:s.t("js.grid.widgets.work_packages_graph.title")}},{identifier:"work_packages_calendar",component:Xe,title:s.t("js.grid.widgets.work_packages_calendar.title"),properties:{name:s.t("js.grid.widgets.work_packages_calendar.title")}},{identifier:"work_packages_overview",component:Wi,title:s.t("js.grid.widgets.work_packages_overview.title"),properties:{name:s.t("js.grid.widgets.work_packages_overview.title")}},{identifier:"time_entries_current_user",component:Rt,title:s.t("js.grid.widgets.time_entries_current_user.title"),properties:{name:s.t("js.grid.widgets.time_entries_current_user.title"),days:[!0,!0,!0,!0,!0,!0,!0]}},{identifier:"time_entries_project",component:_e,title:s.t("js.grid.widgets.time_entries_list.title"),properties:{name:s.t("js.grid.widgets.time_entries_list.title")}},{identifier:"documents",component:qt,title:s.t("js.grid.widgets.documents.title"),properties:{name:s.t("js.grid.widgets.documents.title")}},{identifier:"members",component:In,title:s.t("js.grid.widgets.members.title"),properties:{name:s.t("js.grid.widgets.members.title")}},{identifier:"news",component:Q,title:s.t("js.grid.widgets.news.title"),properties:{name:s.t("js.grid.widgets.news.title")}},{identifier:"project_description",component:Ai,title:s.t("js.grid.widgets.project_description.title"),properties:{name:s.t("js.grid.widgets.project_description.title")}},{identifier:"custom_text",component:W,title:s.t("js.grid.widgets.custom_text.title"),properties:{name:s.t("js.grid.widgets.custom_text.title"),text:{raw:""}}},{identifier:"project_details",component:Re,title:s.t("js.grid.widgets.project_details.title"),properties:{name:s.t("js.grid.widgets.project_details.title")}},{identifier:"project_status",component:Dn,title:s.t("js.grid.widgets.project_status.title"),properties:{name:s.t("js.grid.widgets.project_status.title")}},{identifier:"subprojects",component:Et,title:s.t("js.grid.widgets.subprojects.title"),properties:{name:s.t("js.grid.widgets.subprojects.title")}}]})}(o)}}Oi.\u0275fac=function(o){return new(o||Oi)(e.LFG(e.zs3))},Oi.\u0275mod=e.oAB({type:Oi}),Oi.\u0275inj=e.cJS({providers:[Mt,Ee],imports:[[n.b2,h.u5,x._t,l.H,u.K,f.H,vi,k.OpenprojectCalendarModule,Ir.I,a.Z,v.wA.withComponents([W,qt,In,Q,gi,At,Xe,Wi,Ai,Re,Dn,Et,Rt,_e]),i.E]]});var vr=t(84732),Vt=t(84906);const yr="openproject-base";class fn{}fn.\u0275fac=function(o){return new(o||fn)},fn.\u0275cmp=e.Xpm({type:fn,selectors:[["openproject-base"]],decls:2,vars:0,consts:[[1,"openproject-base--ui-view"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"ui-view"),e.qZA())},directives:[Vt.UIView],encapsulation:2});var Sr=t(57014);const Sn=[{name:"my_notifications.**",url:"/my/notifications",loadChildren:()=>t.e("src_app_features_user-preferences_user-preferences_module_ts").then(t.bind(t,28943)).then(g=>g.OpenProjectMyAccountModule)},{name:"user_notifications.**",url:"/users/:userId/edit/notifications",loadChildren:()=>t.e("src_app_features_user-preferences_user-preferences_module_ts").then(t.bind(t,28943)).then(g=>g.OpenProjectMyAccountModule)},{name:"my_reminders.**",url:"/my/reminders",loadChildren:()=>t.e("src_app_features_user-preferences_user-preferences_module_ts").then(t.bind(t,28943)).then(g=>g.OpenProjectMyAccountModule)},{name:"user_reminders.**",url:"/users/:userId/edit/reminders",loadChildren:()=>t.e("src_app_features_user-preferences_user-preferences_module_ts").then(t.bind(t,28943)).then(g=>g.OpenProjectMyAccountModule)}],ae=[{name:"notifications.**",url:"/notifications",loadChildren:()=>Promise.resolve().then(t.bind(t,44092)).then(g=>g.OpenProjectInAppNotificationsModule)}];var z=t(53916);const jt=[{name:"new_project.**",url:"/projects/new",loadChildren:()=>Promise.resolve().then(t.bind(t,71718)).then(g=>g.OpenprojectProjectsModule)},{name:"root",abstract:!0,url:"",component:fn,params:{flash_message:{dynamic:!0,value:null,inherit:!1}}},{name:"optional_project",parent:"root",url:"/{projects}/{projectPath}",abstract:!0,params:{projectPath:{type:"path",value:null,squash:!0},projects:{type:"path",value:null,squash:!0}},views:{"!$default":{component:fn}}},{name:"api-docs.**",parent:"optional_project",url:"/api/docs",loadChildren:()=>t.e("src_app_features_api-docs_openproject-api-docs_module_ts").then(t.bind(t,84138)).then(g=>g.OpenprojectApiDocsModule)},{name:"boards.**",parent:"optional_project",url:"/boards",loadChildren:()=>t.e("src_app_features_boards_openproject-boards_module_ts").then(t.bind(t,20555)).then(g=>g.OpenprojectBoardsModule)},{name:"bim.**",parent:"optional_project",url:"/bcf",loadChildren:()=>t.e("src_app_features_bim_ifc_models_openproject-ifc-models_module_ts").then(t.bind(t,29526)).then(g=>g.OpenprojectIFCModelsModule)},{name:"backlogs.**",parent:"optional_project",url:"/backlogs",loadChildren:()=>t.e("src_app_features_backlogs_openproject-backlogs_module_ts").then(t.bind(t,89732)).then(g=>g.OpenprojectBacklogsModule)},{name:"backlogs_sprint.**",parent:"optional_project",url:"/sprints",loadChildren:()=>t.e("src_app_features_backlogs_openproject-backlogs_module_ts").then(t.bind(t,89732)).then(g=>g.OpenprojectBacklogsModule)},{name:"reporting.**",parent:"optional_project",url:"/cost_reports",loadChildren:()=>t.e("src_app_features_reporting_openproject-reporting_module_ts").then(t.bind(t,74672)).then(g=>g.OpenprojectReportingModule)},{name:"job-statuses.**",parent:"optional_project",url:"/job_statuses",loadChildren:()=>t.e("src_app_features_job-status_openproject-job-status_module_ts").then(t.bind(t,15732)).then(g=>g.OpenProjectJobStatusModule)},{name:"project_settings.**",parent:"optional_project",url:"/settings/general",loadChildren:()=>Promise.resolve().then(t.bind(t,71718)).then(g=>g.OpenprojectProjectsModule)},{name:"project_copy.**",parent:"optional_project",url:"/copy",loadChildren:()=>Promise.resolve().then(t.bind(t,71718)).then(g=>g.OpenprojectProjectsModule)},...Sn,...ae,...[{name:"team_planner.**",parent:"optional_project",url:"/team_planner",loadChildren:()=>t.e("src_app_features_team-planner_team-planner_team-planner_module_ts").then(t.bind(t,66555)).then(g=>g.TeamPlannerModule)}],...[{name:"calendar.**",parent:"optional_project",url:"/calendars",loadChildren:()=>Promise.resolve().then(t.bind(t,51303)).then(g=>g.OpenprojectCalendarModule)}]];function bt(g,o="add"){g&&(Array.isArray(g)?g.forEach(s=>{document.body.classList[o](s)}):document.body.classList[o](g))}function on(g,o="add"){if(!g)return;const s=jQuery(`#main-menu .${g}`)[0];if(!s)return;s.classList[o]("selected");let w=(s.getAttribute("title")||"").split(":").slice(-1)[0];"add"===o&&(w=I18n.t("js.description_current_position")+w),s.setAttribute("title",w)}function Xn(g){const o=g.get(he.TransitionService),s=g.get(he.StateService),w=g.get(I.kl),S=g.get(P.R),ne=g.get(vr.p),fe=g.get(Sr.Y),Ie=document.querySelector(yr);o.onBefore({to:Ne=>!!Ne&&function(g){return g.data&&g.data.mobileAlternative&&(new z.U).isMobile}(Ne)},Ne=>function(g){const o=g.router.stateService,s=g.to().data.mobileAlternative;return o.target(s,g.params(),{})}(Ne)),o.onEnter({},(Ne,et)=>{bt(_.get(et,"data.bodyClasses"),"add"),Ne.from().data&&_.get(et,"data.menuItem")!==Ne.from().data.menuItem&&on(_.get(et,"data.menuItem"),"add")}),o.onExit({},(Ne,et)=>{bt(_.get(et,"data.bodyClasses"),"remove"),Ne.to().data&&_.get(et,"data.menuItem")!==Ne.to().data.menuItem&&on(_.get(et,"data.menuItem"),"remove")}),o.onStart({},Ne=>{var et;const Dt=Ne.router.stateService,Zt=Ne.params("to"),Ci=Ne.to();if(Zt.start_onboarding_tour&&"work-packages.partitioned.list"!==Ci.name){const Pi=Object.assign({},Ne.params());return Pi.start_onboarding_tour=void 0,Dt.target(Ne.to(),Pi)}fe.sync(Ne);const gr=window.MiniProfiler;null==gr||gr.pageTransition();const fr=Ci.$$state&&Ci.$$state(),aa=null===(et=null==fr?void 0:fr.includes)||void 0===et?void 0:et.root,kr=Zt.projectPath||S.identifier;if(aa&&!Zt.projects&&kr){const Pi=_.clone(Zt);return _.assign(Pi,{projectPath:kr,projects:"projects"}),Dt.target(Ci,Pi,{location:"replace"})}if(null===Ie){const Pi=window.location.pathname,Pm=Pi+window.location.search,Pr=s.href(Ci,Zt);if(Pr&&Pi!==Pr&&Pm!==Pr)return window.location.href=Pr,!1}return bt(_.get(Ci,"data.bodyClasses"),"add"),ne.setIfFirst(Ci.name,Zt),Ne.to().name!==Ne.from().name&&w.clear(),Zt.flash_message&&w.add(Zt.flash_message),!0})}class Bi{constructor(o){Xn(o)}}Bi.\u0275fac=function(o){return new(o||Bi)(e.LFG(e.zs3))},Bi.\u0275mod=e.oAB({type:Bi}),Bi.\u0275inj=e.cJS({providers:[vr.p],imports:[[Vt.UIRouterModule.forRoot({states:jt,useHash:!1,config:function(g,o,s){g.urlService.config.strictMode(!1),g.urlService.config.type("opQueryString",{encode:encodeURIComponent,decode:decodeURIComponent,raw:!0,dynamic:!0,is:w=>"string"==typeof w,equals:(w,S)=>_.isEqual(w,S)}),g.urlService.config.type("opQueryId",{pattern:new RegExp(/(?:new|[0-9]+)/),encode:w=>w||"new",decode:w=>"new"===w?null:w,raw:!0,dynamic:!0,is:w=>"string"==typeof w,equals:(w,S)=>_.isEqual(w,S)})}})]]});var Ar=t(38421),jr=t(19496),mo=t(81134),ac=t(60914),cc=t(1818),lc=t(82123),dc=t(5262),ca=t(81628),pc=t(46669),la=t(25351),jn=t(11266),uc=t(74565),da=t(77180),pa=t(84312),hc=t(70971),_c=t(87947),mc=t(73905),gc=t(31021);function fc(g,o){if(1&g&&(e.TgZ(0,"li",24),e._UZ(1,"wp-watcher-button",25),e.qZA()),2&g){const s=e.oxw(2);e.xp6(1),e.Q6J("workPackage",s.workPackage)("showText",!1)}}function vc(g,o){if(1&g&&(e.TgZ(0,"li",24),e._UZ(1,"op-work-package-mark-notification-button",26),e.qZA()),2&g){const s=e.oxw(2);e.xp6(1),e.Q6J("workPackage",s.workPackage)}}const yc=function(){return["work_package.addChild","work_package.copy"]};function Cc(g,o){if(1&g&&(e.TgZ(0,"div",1),e._UZ(1,"wp-breadcrumb",2),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e.TgZ(4,"div",5),e._UZ(5,"op-back-button",6),e.TgZ(6,"div",7),e._UZ(7,"wp-subject"),e.qZA(),e.qZA(),e.TgZ(8,"ul",8),e.TgZ(9,"li",9),e._UZ(10,"wp-create-button",10),e.qZA(),e.YNc(11,fc,2,2,"li",11),e.YNc(12,vc,2,1,"li",11),e.ALo(13,"async"),e.TgZ(14,"li",9),e._UZ(15,"zen-mode-toggle-button"),e.qZA(),e.TgZ(16,"li",12),e.TgZ(17,"button",13),e._UZ(18,"op-icon",14),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"div",15),e.TgZ(20,"div",16),e.TgZ(21,"div",17),e._UZ(22,"wp-single-view",2),e.qZA(),e.qZA(),e.TgZ(23,"div",18),e.TgZ(24,"div",17),e._UZ(25,"span",19),e._UZ(26,"op-wp-tabs",20),e._UZ(27,"div",21),e.qZA(),e.TgZ(28,"div",22),e._UZ(29,"wp-resizer",23),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.Q6J("resource",s.workPackage),e.xp6(1),e.Q6J("workPackage",s.workPackage),e.xp6(9),e.Q6J("allowed",e.DdM(16,yc))("stateName$",s.stateName$),e.xp6(1),e.Q6J("ngIf",s.displayWatchButton),e.xp6(1),e.Q6J("ngIf",e.lcZ(13,14,s.displayNotificationsButton$)),e.xp6(5),e.Q6J("wpSingleContextMenu-workPackage",s.workPackage),e.uIk("title",s.text.full_view.button_more),e.xp6(5),e.Q6J("workPackage",s.workPackage),e.xp6(3),e.Q6J("textContent",s.focusAnchorLabel),e.xp6(1),e.Q6J("workPackage",s.workPackage)("view","full"),e.xp6(3),e.Q6J("elementClass","work-packages-full-view--split-right")("localStorageKey","openProject-fullViewFlexBasis")}}class cs extends cc.e{constructor(o,s,w){super(o,w.params.workPackageId),this.injector=o,this.wpTableSelection=s,this.$state=w,this.stateName$=(0,mo.of)("work-packages.new")}ngOnInit(){this.observeWorkPackage()}initializeTexts(){super.initializeTexts(),this.text.full_view={button_more:this.I18n.t("js.button_more")}}init(){super.init(),this.wpTableFocus.updateFocus(this.workPackage.id),this.setWorkPackageScopeProperties(this.workPackage)}setWorkPackageScopeProperties(o){this.isWatched=o.hasOwnProperty("unwatch"),this.displayWatchButton=o.hasOwnProperty("unwatch")||o.hasOwnProperty("watch"),o.watchers&&(this.watchers=o.watchers.elements)}}cs.\u0275fac=function(o){return new(o||cs)(e.Y36(e.zs3),e.Y36(ac.J),e.Y36(he.StateService))},cs.\u0275cmp=e.Xpm({type:cs,selectors:[["wp-full-view-entry"]],hostAttrs:[1,"work-packages-page--ui-view"],features:[e._Bn([lc.O,{provide:Fe.W,useExisting:D.q}]),e.qOj],decls:1,vars:1,consts:[["edit-form","","class","work-packages--show-view",3,"resource",4,"ngIf"],["edit-form","",1,"work-packages--show-view",3,"resource"],[3,"workPackage"],[1,"toolbar-container"],["id","toolbar"],[1,"wp-show--header-container"],["linkClass","work-packages-back-button op-back-button_mobile-limited-width"],[1,"subject-header"],["id","toolbar-items",1,"toolbar-items","hide-when-print"],[1,"toolbar-item","hidden-for-mobile"],[3,"allowed","stateName$"],["class","toolbar-item",4,"ngIf"],["id","action-show-more-dropdown-menu",1,"toolbar-item","action_menu_main"],["wpSingleContextMenu","",1,"button","dropdown-relative","toolbar-icon",3,"wpSingleContextMenu-workPackage"],["icon-classes","button--icon icon-show-more"],[1,"work-packages-full-view--split-container"],[1,"work-packages-full-view--split-left"],[1,"work-packages--panel-inner"],[1,"work-packages-full-view--split-right","work-packages-tab-view--overflow"],["tabindex","-1","opAutofocus","",1,"hidden-for-sighted",3,"textContent"],[3,"workPackage","view"],["data-notification-selector","notification-scroll-container","ui-view","",1,"tabcontent"],[1,"work-packages-full-view--resizer","hidden-for-mobile","hide-when-print"],[3,"elementClass","localStorageKey"],[1,"toolbar-item"],[3,"workPackage","showText"],["data-qa-selector","mark-notification-read-button",3,"workPackage"]],template:function(o,s){1&o&&e.YNc(0,Cc,30,17,"div",0),2&o&&e.Q6J("ngIf",s.workPackage)},directives:[R.O5,$i.n,dc.f,ca.W,pc.x,la.z,jn.a,uc.B,ut.o,da.G,pa.U,hc.e,Vt.UIView,_c.H,mc.u,gc.q],pipes:[R.Ov],encapsulation:2});var bc=t(85603),wc=t(1813),Tc=t(73648),Rn=t(53466),kc=t(91654),Pc=t(57973),xc=t(22956),zi=t(2888),Rr=t(73165),Ni=t(61486),yi=t(26942),Fr=t(20342),Zr=t(55548);class ls extends Zr.n{constructor(o,s,w,S,ne){super(o,s),this.elementRef=o,this.opContextMenu=s,this.I18n=w,this.wpDisplayRepresentationService=S,this.wpTableTimeline=ne}open(o){this.buildItems(),this.opContextMenu.show(this,o)}get locals(){return{items:this.items,contextMenuId:"wp-view-context-menu"}}buildItems(){this.items=[],this.wpDisplayRepresentationService.current!==zi.he&&this.items.push({linkText:this.I18n.t("js.views.card"),title:this.I18n.t("js.button_show_cards"),icon:"icon-view-card",onClick:o=>(this.wpDisplayRepresentationService.setDisplayRepresentation(zi.he),this.wpTableTimeline.isVisible&&this.wpTableTimeline.toggle(),!0)}),(this.wpTableTimeline.isVisible||this.wpDisplayRepresentationService.current===zi.he)&&this.items.push({linkText:this.I18n.t("js.views.list"),title:this.I18n.t("js.button_show_table"),icon:"icon-view-list",onClick:o=>(this.wpDisplayRepresentationService.setDisplayRepresentation(zi.M5),this.wpTableTimeline.isVisible&&this.wpTableTimeline.toggle(),!0)}),(!this.wpTableTimeline.isVisible||this.wpDisplayRepresentationService.current===zi.he)&&this.items.push({linkText:this.I18n.t("js.views.timeline"),title:this.I18n.t("js.button_show_gantt"),icon:"icon-view-timeline",onClick:o=>(this.wpTableTimeline.isVisible||this.wpTableTimeline.toggle(),this.wpDisplayRepresentationService.setDisplayRepresentation(zi.M5),!0)})}}ls.\u0275fac=function(o){return new(o||ls)(e.Y36(e.SBq),e.Y36(Fr.$),e.Y36(y.D),e.Y36(zi.ld),e.Y36(Rr.W))},ls.\u0275dir=e.lG2({type:ls,selectors:[["","wpViewDropdown",""]],features:[e.qOj]});class ds extends yi.N{constructor(o,s,w,S){super(),this.I18n=o,this.cdRef=s,this.wpDisplayRepresentationService=w,this.wpTableTimeline=S,this.text={card:this.I18n.t("js.views.card"),list:this.I18n.t("js.views.list"),timeline:this.I18n.t("js.views.timeline")}}ngOnInit(){(0,Ni.aj)([this.wpDisplayRepresentationService.live$(),this.wpTableTimeline.live$()]).pipe(this.untilDestroyed()).subscribe(([s,w])=>{this.detectView(s,w.visible),this.cdRef.detectChanges()})}detectView(o,s){o!==zi.he?this.view=s?"timeline":zi.M5:this.view=zi.he}}ds.\u0275fac=function(o){return new(o||ds)(e.Y36(y.D),e.Y36(e.sBO),e.Y36(zi.ld),e.Y36(Rr.W))},ds.\u0275cmp=e.Xpm({type:ds,selectors:[["wp-view-toggle-button"]],features:[e.qOj],decls:4,vars:2,consts:[["id","wp-view-toggle-button","wpViewDropdown","",1,"button"],[3,"icon-classes"],["aria-hidden","true",1,"button--text",3,"textContent"],["icon-classes","button--icon icon-small icon-pulldown"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e._UZ(1,"op-icon",1),e._UZ(2,"span",2),e._UZ(3,"op-icon",3),e.qZA()),2&o&&(e.xp6(1),e.MGl("icon-classes","button--icon icon-view-",s.view,""),e.xp6(1),e.Q6J("textContent",s.text[s.view]))},directives:[ls,ut.o],encapsulation:2,changeDetection:0});var Ec=t(48451),ua=t(44210),ha=t(84109);class ps extends ua.S{constructor(o,s,w,S,ne,fe,Ie){super(s),this.$state=o,this.I18n=s,this.transitions=w,this.cdRef=S,this.states=ne,this.wpTableFocus=fe,this.keepTab=Ie,this.accessKey=8,this.activeState="work-packages.partitioned.list.details",this.listState="work-packages.partitioned.list",this.buttonId="work-packages-details-view-button",this.buttonClass="toolbar-icon",this.iconClass="icon-info2",this.activateLabel=s.t("js.button_open_details"),this.deactivateLabel=s.t("js.button_close_details"),this.transitionListener=this.transitions.onSuccess({},()=>{this.isActive=this.$state.includes(this.activeState),this.cdRef.detectChanges()})}ngOnDestroy(){super.ngOnDestroy(),this.transitionListener()}get label(){return this.isActive?this.deactivateLabel:this.activateLabel}isToggle(){return!0}performAction(o){this.isActive?this.$state.go(this.listState):this.openDetailsView()}openListView(){}openDetailsView(){const o={workPackageId:this.wpTableFocus.focusedWorkPackage};this.keepTab.goCurrentDetailsState(o)}}function Oc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li"),e.TgZ(1,"button",2),e.NdJ("click",function(){return e.CHM(s),e.oxw().enableAutoZoom()}),e._UZ(2,"op-icon",3),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngClass",s.getAutoZoomToggleClass()),e.uIk("title",s.text.zoomAuto)}}function Mc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li"),e.TgZ(1,"button",4),e.NdJ("click",function(){return e.CHM(s),e.oxw().updateZoomWithDelta(1)}),e._UZ(2,"op-icon",5),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("disabled",s.isMaxLevel),e.uIk("title",s.text.zoomOut)}}function Ic(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li"),e.TgZ(1,"button",6),e.NdJ("click",function(){return e.CHM(s),e.oxw().updateZoomWithDelta(-1)}),e._UZ(2,"op-icon",7),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("disabled",s.isMinLevel),e.uIk("title",s.text.zoomIn)}}ps.\u0275fac=function(o){return new(o||ps)(e.Y36(he.StateService),e.Y36(y.D),e.Y36(he.TransitionService),e.Y36(e.sBO),e.Y36(c.G),e.Y36(Ec.o),e.Y36(ha.p))},ps.\u0275cmp=e.Xpm({type:ps,selectors:[["wp-details-view-button"]],features:[e.qOj],decls:2,vars:10,consts:[["type","button",3,"disabled","click"],[3,"icon-classes"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(S){return s.performAction(S)}),e._UZ(1,"op-icon",1),e.qZA()),2&o&&(e.Gre("button ",s.buttonClass,""),e.ekj("-active",s.isActive),e.Q6J("disabled",s.disabled||!s.isToggle()&&s.isActive),e.uIk("id",s.buttonId)("title",s.label)("accesskey",s.accessKey),e.xp6(1),e.MGl("icon-classes","",s.iconClass," button--icon"))},directives:[ut.o],encapsulation:2,changeDetection:0});class us extends ua.S{constructor(o,s,w){super(o),this.I18n=o,this.cdRef=s,this.wpTableTimeline=w,this.buttonId="work-packages-timeline-toggle-button",this.iconClass="icon-view-timeline",this.minZoomLevel="days",this.maxZoomLevel="years",this.isAutoZoom=!1,this.isMaxLevel=!1,this.isMinLevel=!1,this.activateLabel=o.t("js.timelines.button_activate"),this.deactivateLabel=o.t("js.timelines.button_deactivate"),this.text.zoomIn=o.t("js.timelines.zoom.in"),this.text.zoomOut=o.t("js.timelines.zoom.out"),this.text.zoomAuto=o.t("js.timelines.zoom.auto")}ngOnInit(){this.wpTableTimeline.live$().pipe(this.untilDestroyed()).subscribe(()=>{this.isAutoZoom=this.wpTableTimeline.isAutoZoom(),this.isActive=this.wpTableTimeline.isVisible,this.cdRef.detectChanges()}),this.wpTableTimeline.appliedZoomLevel$.values$().pipe(this.untilDestroyed()).subscribe(o=>{this.isMaxLevel=o===this.maxZoomLevel,this.isMinLevel=o===this.minZoomLevel,this.cdRef.detectChanges()})}get label(){return this.isActive?this.deactivateLabel:this.activateLabel}isToggle(){return!0}updateZoomWithDelta(o){this.wpTableTimeline.updateZoomWithDelta(o)}performAction(o){this.toggleTimeline()}toggleTimeline(){this.wpTableTimeline.toggle()}enableAutoZoom(){this.wpTableTimeline.enableAutozoom()}getAutoZoomToggleClass(){return this.isAutoZoom?"-disabled":""}}us.\u0275fac=function(o){return new(o||us)(e.Y36(y.D),e.Y36(e.sBO),e.Y36(Rr.W))},us.\u0275cmp=e.Xpm({type:us,selectors:[["wp-timeline-toggle-button"]],features:[e.qOj],decls:4,vars:3,consts:[["id","work-packages-timeline-mode-selection",1,"toolbar-button-group","work-packages-timeline-toggle-button"],[4,"ngIf"],["id","work-packages-timeline-zoom-auto-button",1,"button","timeline-toolbar--button","toolbar-icon",3,"ngClass","click"],["icon-classes","icon-zoom-auto button--icon"],["id","work-packages-timeline-zoom-out-button",1,"button","timeline-toolbar--button","toolbar-icon",3,"disabled","click"],["icon-classes","icon-zoom-out button--icon"],["id","work-packages-timeline-zoom-in-button",1,"button","timeline-toolbar--button","toolbar-icon",3,"disabled","click"],["icon-classes","icon-zoom-in button--icon"]],template:function(o,s){1&o&&(e.TgZ(0,"ul",0),e.YNc(1,Oc,3,2,"li",1),e.YNc(2,Mc,3,2,"li",1),e.YNc(3,Ic,3,2,"li",1),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",s.isActive),e.xp6(1),e.Q6J("ngIf",s.isActive),e.xp6(1),e.Q6J("ngIf",s.isActive))},directives:[R.O5,R.mk,ut.o],styles:[".work-packages-timeline-toggle-button[_ngcontent-%COMP%]   .toolbar-button-group[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:last-child{margin-right:10px}"],changeDetection:0});var Dc=t(52025),Sc=t(79174);class hs extends Zr.n{constructor(o,s,w,S){super(o,s),this.elementRef=o,this.opContextMenu=s,this.I18n=w,this.wpViewCollapsedGroups=S}open(o){this.buildItems(),this.opContextMenu.show(this,o)}get locals(){return{items:this.items,contextMenuId:"wp-group-fold-context-menu"}}buildItems(){this.items=[{disabled:this.wpViewCollapsedGroups.allGroupsAreCollapsed,linkText:this.I18n.t("js.button_collapse_all"),icon:"icon-minus2",onClick:o=>(this.wpViewCollapsedGroups.setAllGroupsCollapseStateTo(!0),!0)},{disabled:this.wpViewCollapsedGroups.allGroupsAreExpanded,linkText:this.I18n.t("js.button_expand_all"),icon:"icon-plus",onClick:o=>(this.wpViewCollapsedGroups.setAllGroupsCollapseStateTo(!1),!0)}]}}hs.\u0275fac=function(o){return new(o||hs)(e.Y36(e.SBq),e.Y36(Fr.$),e.Y36(y.D),e.Y36(Sc.q))},hs.\u0275dir=e.lG2({type:hs,selectors:[["","wpGroupToggleDropdown",""]],features:[e.qOj]});class _s{}_s.\u0275fac=function(o){return new(o||_s)},_s.\u0275cmp=e.Xpm({type:_s,selectors:[["wp-fold-toggle-view-button"]],decls:4,vars:0,consts:[["id","wp-fold-toggle-button","wpGroupToggleDropdown","",1,"button"],["icon-classes","button--icon icon-outline"],[1,"button--text"],["icon-classes","button--icon icon-small icon-pulldown"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e._UZ(1,"op-icon",1),e._UZ(2,"span",2),e._UZ(3,"op-icon",3),e.qZA())},directives:[hs,ut.o],encapsulation:2,changeDetection:0});var Ac=t(74097);function jc(g,o){if(1&g&&e._UZ(0,"op-back-button",11),2&g){const s=e.oxw();e.Q6J("customBackMethod",s.backButtonCallback)}}function Rc(g,o){if(1&g&&(e.TgZ(0,"li",15),e._UZ(1,"ndc-dynamic",16),e.qZA()),2&g){const s=e.oxw().$implicit,w=e.oxw(2);e.Q6J("ngClass",s.containerClasses),e.xp6(1),e.Q6J("ndcDynamicComponent",s.component)("ndcDynamicInputs",s.inputs)("ndcDynamicInjector",w.injector)("ndcDynamicOutputs",s.outputs)}}function Fc(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Rc,2,5,"li",14),e.BQk()),2&g){const s=o.$implicit;e.xp6(1),e.Q6J("ngIf",!s.show||s.show())}}function Zc(g,o){if(1&g&&(e.TgZ(0,"ul",12),e.YNc(1,Fc,2,1,"ng-container",13),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.toolbarButtonComponents)}}function Wc(g,o){if(1&g&&e._UZ(0,"ndc-dynamic",17),2&g){const s=e.oxw();e.Q6J("ndcDynamicComponent",s.filterContainerDefinition.component)("ndcDynamicInputs",s.filterContainerDefinition.inputs)("ndcDynamicOutputs",s.filterContainerDefinition.outputs)("ndcDynamicInjector",s.injector)}}class go extends Pc.r{constructor(){super(...arguments),this.toolbarButtonComponents=[{component:la.z,inputs:{stateName$:(0,mo.of)("work-packages.partitioned.list.new"),allowed:["work_packages.createWorkPackage"]}},{component:Ac.P},{component:xc.U},{component:ds,containerClasses:"hidden-for-mobile"},{component:_s,show:()=>!(!this.currentQuery||!this.currentQuery.groupBy)},{component:ps,containerClasses:"hidden-for-mobile"},{component:us,containerClasses:"hidden-for-mobile -no-spacing"},{component:jn.a,containerClasses:"hidden-for-mobile"},{component:Dc.b}]}ngOnInit(){super.ngOnInit(),this.wpTableFilters.hidden.push("project"),this.text.button_settings=this.I18n.t("js.button_settings")}additionalLoadingTime(){return this.wpTableTimeline.isVisible?this.querySpace.timelineRendered.pipe((0,Rn.q)(1)).toPromise():this.querySpace.tableRendered.valuesPromise()}shouldUpdateHtmlTitle(){return"work-packages.partitioned.list"===this.$state.current.name}}go.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(go)))(s||go)}}(),go.\u0275cmp=e.Xpm({type:go,selectors:[["wp-view-page"]],features:[e._Bn([{provide:Fe.W,useClass:D.q},kc.E]),e.qOj],decls:11,vars:8,consts:[[1,"work-packages-partitioned-query-space--container",3,"ngClass"],[1,"toolbar-container","-editable"],[1,"toolbar"],["class","op-back-button","linkClass","op-back-button_mobile-limited-width",3,"customBackMethod",4,"ngIf"],[3,"title","inFlight","showSaveCondition","editable","onSave","onEmptySubmit"],["class","toolbar-items hide-when-print",4,"ngIf"],[1,"work-packages-partitioned-query-space--filter-area"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector",4,"ngIf"],[1,"work-packages-partitioned-page--content-container"],["data-indicator-name","table","ui-view","content-left",1,"work-packages-partitioned-page--content-left","loading-indicator--location"],["ui-view","content-right",1,"work-packages-partitioned-page--content-right"],["linkClass","op-back-button_mobile-limited-width",1,"op-back-button",3,"customBackMethod"],[1,"toolbar-items","hide-when-print"],[4,"ngFor","ngForOf"],["class","toolbar-item",3,"ngClass",4,"ngIf"],[1,"toolbar-item",3,"ngClass"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicInjector","ndcDynamicOutputs"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs","ndcDynamicInjector"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.YNc(3,jc,1,1,"op-back-button",3),e.TgZ(4,"editable-toolbar-title",4),e.NdJ("onSave",function(S){return s.changeChangesFromTitle(S)})("onEmptySubmit",function(){return s.updateTitleName("")}),e.qZA(),e.YNc(5,Zc,2,1,"ul",5),e.qZA(),e.qZA(),e.TgZ(6,"div",6),e.YNc(7,Wc,1,4,"ndc-dynamic",7),e.qZA(),e.TgZ(8,"div",8),e._UZ(9,"div",9),e._UZ(10,"div",10),e.qZA(),e.qZA()),2&o&&(e.Q6J("ngClass",s.currentPartition),e.xp6(3),e.Q6J("ngIf",s.backButtonCallback),e.xp6(1),e.Q6J("title",s.selectedTitle)("inFlight",s.toolbarDisabled)("showSaveCondition",s.showToolbarSaveButton)("editable",s.titleEditingEnabled),e.xp6(1),e.Q6J("ngIf",s.showToolbar),e.xp6(2),e.Q6J("ngIf",s.filterContainerDefinition))},directives:[R.mk,R.O5,F.s5,Vt.UIView,ca.W,R.sg,v.B5,v.oc],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;display:grid;grid-template-columns:1fr;grid-template-rows:auto auto minmax(200px,1fr);margin-left:-10px;padding-left:10px;width:calc(100% + 10px)}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-right-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{flex-grow:1}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{overflow:auto}.work-packages-partitioned-query-space--container.-left-only[_ngcontent-%COMP%]   wp-resizer[_ngcontent-%COMP%]{display:none}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]{display:flex;overflow:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-container[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{position:relative}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%]{flex:1}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .title-container_editable[_ngcontent-%COMP%]{margin-left:-7px}@media only screen and (max-width: 679px){.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-left[_ngcontent-%COMP%], .work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .work-packages-partitioned-page--content-right[_ngcontent-%COMP%]{min-width:initial;max-width:100vw;max-height:100%}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;grid-template-rows:auto auto;justify-items:start}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .op-back-button[_ngcontent-%COMP%]{grid-column:1/3;grid-row:1/2}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/3;overflow:hidden}.work-packages-partitioned-query-space--container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/3}}"],changeDetection:0});var Lc=t(46430),Uc=t(98722),Bc=t(92092),Nc=t(8643),Qc=t(66979);const Jc=function(){return["status","type"]};function Yc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"edit-form",2),e.NdJ("onSaved",function(S){return e.CHM(s),e.oxw().onSaved(S)}),e.TgZ(2,"div",3),e.TgZ(3,"div",4),e._UZ(4,"wp-type-status",5),e.qZA(),e.TgZ(5,"ul",6),e.TgZ(6,"li",7),e._UZ(7,"zen-mode-toggle-button"),e.qZA(),e.TgZ(8,"li",7),e.TgZ(9,"button",8),e._UZ(10,"i",9),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e._UZ(11,"wp-single-view",10),e.TgZ(12,"wp-edit-actions-bar",11),e.NdJ("onCancel",function(){return e.CHM(s),e.oxw().cancelAndBackToList()}),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("resource",s.newWorkPackage)("skippedFields",e.DdM(7,Jc))("inEditMode",!0),e.xp6(3),e.Q6J("workPackage",s.newWorkPackage),e.xp6(5),e.uIk("title",s.text.button_settings),e.xp6(2),e.Q6J("workPackage",s.newWorkPackage)("showProject",s.copying)}}class fo extends Uc.H{constructor(){super(...arguments),this.successState="work-packages.show"}}fo.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(fo)))(s||fo)}}(),fo.\u0275cmp=e.Xpm({type:fo,selectors:[["wp-copy-full-view"]],hostAttrs:[1,"work-packages-page--ui-view"],features:[e.qOj],decls:1,vars:1,consts:[["class","work-package--new-state work-packages--new work-packages--show-view toolbar-container",4,"ngIf"],[1,"work-package--new-state","work-packages--new","work-packages--show-view","toolbar-container"],[3,"resource","skippedFields","inEditMode","onSaved"],[1,"toolbar"],[1,"title-container"],[3,"workPackage"],[1,"toolbar-items","hide-when-print"],[1,"toolbar-item","hidden-for-mobile"],["id","create-wp-menu-button","wpCreateSettingsMenu","",1,"button","last","work-packages-settings-button","toolbar-icon"],[1,"button--icon","icon-show-more"],[3,"workPackage","showProject"],[3,"onCancel"]],template:function(o,s){1&o&&e.YNc(0,Yc,13,8,"div",0),2&o&&e.Q6J("ngIf",s.newWorkPackage)},directives:[R.O5,$i.n,Bc.E,jn.a,Nc.Y,da.G,Qc.Y],encapsulation:2,changeDetection:0});const eo="work-packages-menu-item",$c=[{name:"work-packages",parent:"optional_project",url:"/work_packages?query_id&query_props&start_onboarding_tour",redirectTo:"work-packages.partitioned.list",views:{"!$default":{component:wc.p}},data:{bodyClasses:"router--work-packages-base",menuItem:eo},params:{query_id:{type:"query",dynamic:!0},query_props:{type:"opQueryString"},start_onboarding_tour:{type:"query",squash:!0,value:void 0}}},{name:"work-packages.new",url:"/new?type&parent_id",component:jr.v,reloadOnSearch:!1,params:{defaults:{value:null}},data:{baseRoute:"work-packages",allowMovingInEditMode:!0,bodyClasses:"router--work-packages-full-create",menuItem:eo,successState:"work-packages.show"}},{name:"work-packages.copy",url:"/{copiedFromWorkPackageId:[0-9]+}/copy",component:fo,reloadOnSearch:!1,data:{baseRoute:"work-packages",allowMovingInEditMode:!0,bodyClasses:"router--work-packages-full-create",menuItem:eo}},{name:"work-packages.show",url:"/{workPackageId:[0-9]+}",redirectTo:g=>{const o=g.params("to"),w=g.injector().get(ha.p).currentShowTab;return{state:"work-packages.show.tabs",params:Object.assign(Object.assign({},o),{tabIdentifier:w||"activity"})}},component:cs,data:{baseRoute:"work-packages",bodyClasses:"router--work-packages-full-view",newRoute:"work-packages.new",menuItem:eo}},{name:"work-packages.show.tabs",url:"/:tabIdentifier",component:Ar.t,data:{parent:"work-packages.show",menuItem:eo}},{name:"work-packages.partitioned",component:go,url:"",data:{bodyClasses:""}},{name:"work-packages.partitioned.list",url:"",reloadOnSearch:!1,views:{"content-left":{component:Tc.o}},data:{bodyClasses:"router--work-packages-partitioned-split-view",menuItem:eo,partition:"-left-only"}},...(0,Lc.Z)("work-packages.partitioned.list",eo,bc.o)];class vo{}vo.\u0275fac=function(o){return new(o||vo)},vo.\u0275mod=e.oAB({type:vo}),vo.\u0275inj=e.cJS({imports:[[f.H,Vt.UIRouterModule.forChild({states:$c})]]});class sn{constructor(o,s,w,S){this.I18n=o,this.injector=s,this.PathHelper=w,this.currentProjectService=S,this._searchTerm=new Z.X(""),this.searchTerm$=this._searchTerm.asObservable(),this._currentTab=new Z.X("work_packages"),this.currentTab$=this._currentTab.asObservable(),this._projectScope=new Z.X(""),this.projectScope$=this._projectScope.asObservable(),this._tabs=new Z.X([]),this.tabs$=this._tabs.asObservable(),this._resultsHidden=new Z.X(!1),this.resultsHidden$=this._resultsHidden.asObservable(),this.initialize()}initialize(){const o=this.loadGonData();o&&(o.available_search_types&&this._tabs.next(o.available_search_types),o.search_term&&this._searchTerm.next(o.search_term),o.current_tab&&this._currentTab.next(o.current_tab),o.project_scope?this._projectScope.next(o.project_scope):this.currentProjectService.path||this._projectScope.next("all"))}loadGonData(){try{return window.gon.global_search}catch(o){return null}}submitSearch(){window.location.href=this.searchPath()}searchPath(){let o=this.PathHelper.staticBase;return this.currentProjectService.path&&"all"!==this.projectScope&&(o=this.currentProjectService.path),o+=`/search?${this.searchQueryParams()}`,o}set searchTerm(o){this._searchTerm.next(o)}get searchTerm(){return this._searchTerm.value}get tabs(){return this._tabs.value}get currentTab(){return this._currentTab.value}set currentTab(o){this._currentTab.next(o)}get projectScope(){return this._projectScope.value}set projectScope(o){this._projectScope.next(o)}get resultsHidden(){return this._resultsHidden.value}set resultsHidden(o){this._resultsHidden.next(o)}searchQueryParams(){let o;return o=`q=${encodeURIComponent(this.searchTerm)}`,this.currentTab.length>0&&"all"!==this.currentTab&&(o=`${o}&${this.currentTab}=1`),this.projectScope.length>0&&(o=`${o}&scope=${this.projectScope}`),o}isAfterSearch(){return jQuery("body.controller-search").length>0}}sn.\u0275fac=function(o){return new(o||sn)(e.LFG(y.D),e.LFG(e.zs3),e.LFG(it.j),e.LFG(P.R))},sn.\u0275prov=e.Yz7({token:sn,factory:sn.\u0275fac});var Vc=t(74990);class yo{}yo.\u0275fac=function(o){return new(o||yo)},yo.\u0275mod=e.oAB({type:yo}),yo.\u0275inj=e.cJS({providers:[sn],imports:[[l.H,f.H,Vc.C]]});var Co=t(73881),Hc=t(27779),Wr=t(8158);function zc(g,o){if(1&g&&e._UZ(0,"op-enterprise-banner",10),2&g){const s=e.oxw();e.Q6J("linkMessage",s.text.upsale_link)("textMessage",s.text.upsale_text)("moreInfoLink",s.text.more_info_link)}}function Kc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li",11),e.TgZ(1,"button",12),e.NdJ("click",function(S){const fe=e.CHM(s).$implicit;return e.oxw().select(S,fe)}),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit;e.xp6(1),e.Q6J("id",s.identifier)("textContent",s.title)}}class ms extends dt.T{constructor(o,s,w,S,ne,fe){super(s,w,o),this.elementRef=o,this.locals=s,this.cdRef=w,this.widgetsService=S,this.i18n=ne,this.bannerService=fe,this.text={title:this.i18n.t("js.grid.add_widget"),close_popup:this.i18n.t("js.button_close"),upsale_link:this.i18n.t("js.grid.upsale.link"),upsale_text:this.i18n.t("js.grid.upsale.text"),cancel_button:this.i18n.t("js.button_cancel"),more_info_link:Hc.rj.graphWidgets},this.eeShowBanners=!1}ngOnInit(){super.ngOnInit(),this.eeShowBanners=this.bannerService.eeShowBanners}get selectable(){return this.eligibleWidgets.sort((o,s)=>o.title.localeCompare(s.title))}select(o,s){this.chosenWidget=s,this.closeMe(o)}trackWidgetBy(o){return o.identifier}get eligibleWidgets(){const o=this.locals.schema.widgets.allowedValues.map(s=>s.identifier);return this.widgetsService.registered.filter(s=>o.includes(s.identifier))}}ms.\u0275fac=function(o){return new(o||ms)(e.Y36(e.SBq),e.Y36(lt.E),e.Y36(e.sBO),e.Y36(Mt),e.Y36(y.D),e.Y36(Co.j))},ms.\u0275cmp=e.Xpm({type:ms,selectors:[["ng-component"]],features:[e.qOj],decls:12,vars:5,consts:[["data-indicator-name","modal",1,"spot-modal","loading-indicator--location"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"ngdialog-body","spot-modal--body","spot-container"],["class","grid--add-widget-ee","opReferrer","grids#add-widget",3,"linkMessage","textMessage","moreInfoLink",4,"ngIf"],[1,"spot-list"],["class","spot-list--item","data-qa-selector","op-grid--addable-widget",4,"ngFor","ngForOf","ngForTrackBy"],[1,"spot-action-bar","hidden-for-mobile"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"click"],["opReferrer","grids#add-widget",1,"grid--add-widget-ee",3,"linkMessage","textMessage","moreInfoLink"],["data-qa-selector","op-grid--addable-widget",1,"spot-list--item"],["type","button",1,"spot-list--item-action",3,"id","textContent","click"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.YNc(5,zc,1,3,"op-enterprise-banner",4),e.TgZ(6,"ul",5),e.YNc(7,Kc,2,2,"li",6),e.qZA(),e.qZA(),e.TgZ(8,"div",7),e.TgZ(9,"div",8),e.TgZ(10,"button",9),e.NdJ("click",function(){return s.closeMe()}),e._uU(11),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title),e.xp6(3),e.Q6J("ngIf",s.eeShowBanners),e.xp6(2),e.Q6J("ngForOf",s.selectable)("ngForTrackBy",s.trackWidgetBy),e.xp6(4),e.hij(" ",s.text.cancel_button," "))},directives:[R.O5,R.sg,Wr.P],encapsulation:2});class vn{constructor(o){this.layout=o}down(o,s){const w=[];let S=this.layout.widgetAreas.slice(0);for(s&&(S=S.filter(ne=>ne.guid!==s.guid)),S.sort((ne,fe)=>fe.startRow-ne.startRow);null!==o;)w.push(o),S=S.filter(ne=>ne.guid!==o.guid),o=this.moveOneDown(w,S)}moveOneDown(o,s){const w=this.firstAreaToMove(o,s);if(w){const S=w[0],ne=w[1],fe=S.widget.height;return S.startRow=ne.endRow,S.endRow=S.startRow+fe,this.layout.numRows<S.endRow-1&&(this.layout.numRows=S.endRow-1),S}return null}firstAreaToMove(o,s){let w=null,S=null;if(s.forEach(ne=>{o.forEach(fe=>{fe.overlaps(ne)&&(w=fe,S=ne)})}),null!==S){let ne=w;return o.forEach(fe=>{fe.endRow>ne.endRow&&S.columnOverlaps(fe)&&(ne=fe)}),[S,ne]}return null}}vn.\u0275fac=function(o){return new(o||vn)(e.LFG(J))},vn.\u0275prov=e.Yz7({token:vn,factory:vn.\u0275fac});var _a=t(8095),to=t(83720);class yn{constructor(o,s){this.layout=o,this.move=s,this.setupMousedOverAreaSubscription()}ngOnDestroy(){this.mousedOverAreaObserver.unsubscribe()}setupMousedOverAreaSubscription(){this.mousedOverAreaObserver=this.layout.$mousedOverArea.pipe((0,_a.p)(10),(0,to.x)(),(0,hi.h)(o=>this.currentlyDragging&&!!o&&!this.layout.isGap(o)&&(this.placeholderArea.startRow!==o.startRow||this.placeholderArea.startColumn!==o.startColumn))).subscribe(o=>{this.updateArea(o),this.layout.scrollPlaceholderIntoView()})}updateArea(o){this.layout.resetAreas(this.draggedArea),this.moveAreasOnDragging(o)}moveAreasOnDragging(o){if(!this.placeholderArea)return;const s=this.draggedArea;this.copyPositionButRestrict(o,this.placeholderArea),this.move.down(this.placeholderArea,s)}get currentlyDragging(){return!!this.draggedArea}isDropOnlyArea(o){return!this.currentlyDragging&&o.endRow===this.layout.numRows+2}isDragged(o){return this.currentlyDragging&&this.draggedArea.guid===o.guid}isPassive(o){return this.currentlyDragging&&!this.isDragged(o)}get isDraggable(){return this.layout.isEditable}start(o){this.placeholderArea=new T(o.widget),this.draggedHeight=document.getElementById(o.guid).offsetHeight-2,this.draggedArea=o}abort(){document.dispatchEvent(new Event("mouseup")),this.draggedArea=null,this.placeholderArea=null,this.layout.resetAreas()}drop(){!this.draggedArea||(this.placeholderArea.copyDimensionsTo(this.draggedArea),this.draggedArea.unchangedSize||(this.layout.writeAreaChangesToWidgets(),this.layout.cleanupUnusedAreas(),this.layout.rebuildAndPersist()),this.draggedArea=null,this.placeholderArea=null)}copyPositionButRestrict(o,s){s.startRow=o.startRow,o.startRow===this.layout.numRows+1?s.endRow=this.layout.numRows+2:o.startRow+s.widget.height>this.layout.numRows+1?s.endRow=this.layout.numRows+1:s.endRow=o.startRow+s.widget.height,s.startColumn=o.startColumn,o.startColumn+s.widget.width>this.layout.numColumns+1?s.endColumn=this.layout.numColumns+1:s.endColumn=o.startColumn+s.widget.width}}yn.\u0275fac=function(o){return new(o||yn)(e.LFG(J),e.LFG(vn))},yn.\u0275prov=e.Yz7({token:yn,factory:yn.\u0275fac});class Fn{constructor(o,s,w){this.layout=o,this.move=s,this.drag=w}end(o){!this.resizedArea||(this.resizedArea=null,!o.unchangedSize&&(this.layout.writeAreaChangesToWidgets(),this.layout.cleanupUnusedAreas(),this.layout.rebuildAndPersist()))}abort(){this.resizedArea&&(this.layout.resetAreas(),this.resizedArea=null)}start(o){this.resizedArea=o;const s=this.layout.gridAreas.filter(w=>{const S=w.startRow===this.resizedArea.startRow&&w.startColumn>=this.resizedArea.startColumn,ne=w.startRow>this.resizedArea.startRow&&w.startColumn>=this.resizedArea.startColumn&&this.layout.widgetAreas.some(fe=>fe.startRow===w.startRow&&(fe.endColumn<=this.resizedArea.startColumn||fe.startColumn>=w.endColumn));return S||ne});this.targetIds=s.map(w=>w.guid)}moving(){!this.resizedArea||!this.layout.mousedOverArea||!this.targetIds.includes(this.layout.mousedOverArea.guid)||(this.layout.resetAreas(),this.resizedArea.endRow=this.layout.mousedOverArea.endRow,this.resizedArea.endColumn=this.layout.mousedOverArea.endColumn,this.move.down(this.resizedArea,this.resizedArea))}isTarget(o){const s=o.guid;return this.resizedArea&&this.targetIds.includes(s)}isResized(o){return this.resizedArea&&this.resizedArea.guid===o.guid}isPassive(o){return this.currentlyResizing&&!this.isResized(o)}get currentlyResizing(){return!!this.resizedArea}get isResizable(){return!this.drag.currentlyDragging&&this.isAllowed}get isAllowed(){return this.layout.gridResource.updateImmediately}}Fn.\u0275fac=function(o){return new(o||Fn)(e.LFG(J),e.LFG(vn),e.LFG(yn))},Fn.\u0275prov=e.Yz7({token:Fn,factory:Fn.\u0275fac});class Zn{constructor(o,s,w,S,ne,fe,Ie,Ne){this.opModalService=o,this.injector=s,this.halResource=w,this.layout=S,this.drag=ne,this.move=fe,this.resize=Ie,this.i18n=Ne,this.text={add:this.i18n.t("js.grid.add_widget")}}isAddable(o){return!this.drag.currentlyDragging&&!this.resize.currentlyResizing&&(this.layout.mousedOverArea===o||this.layout.isSingleCell||this.layout.inHelpMode)&&this.isAllowed}widget(o){this.select(o).then(s=>{this.layout.isGap(o)&&this.addLine(o);const w=new T(s);this.setMaxWidth(w),this.persist(w)}).catch(()=>{})}get addText(){return this.text.add}select(o){return new Promise((s,w)=>{this.opModalService.show(ms,this.injector,{schema:this.layout.schema}).subscribe(S=>{S.closingEvent.subscribe(()=>{const ne=S.chosenWidget;if(!ne)return void w();const fe={_type:"GridWidget",identifier:ne.identifier,startRow:o.startRow,endRow:o.endRow,startColumn:o.startColumn,endColumn:o.endColumn,options:ne.properties||{}},Ie=this.halResource.createHalResource(fe);Ie.grid=this.layout.gridResource,s(Ie)})})})}addLine(o){o.isRow?this.layout.addRow(o.startRow-1,o.startColumn):o.isColumn&&this.layout.addColumn(o.startColumn-1,o.startRow)}setMaxWidth(o){o.endColumn=this.layout.numColumns+1,this.layout.widgetAreas.forEach(s=>{o.startColumnOverlaps(s)&&(o.endColumn=s.startColumn)})}persist(o){o.writeAreaChangeToWidget(),this.layout.widgetAreas.push(o),this.layout.widgetResources.push(o.widget),this.layout.rebuildAndPersist()}get isAllowed(){return this.layout.gridResource&&this.layout.gridResource.updateImmediately}}Zn.\u0275fac=function(o){return new(o||Zn)(e.LFG(lt.S),e.LFG(e.zs3),e.LFG(Ot.u),e.LFG(J),e.LFG(yn),e.LFG(vn),e.LFG(Fn),e.LFG(y.D))},Zn.\u0275prov=e.Yz7({token:Zn,factory:Zn.\u0275fac});class io{constructor(o,s,w,S,ne,fe,Ie,Ne,et){this.gridInitialization=o,this.pathHelper=s,this.currentProject=w,this.i18n=S,this.cdRef=ne,this.title=fe,this.addWidget=Ie,this.renderer=Ne,this.areas=et,this.text={title:this.i18n.t(`js.${this.i18nNamespace()}.label`),html_title:this.i18n.t(`js.${this.i18nNamespace()}.label`)}}ngOnInit(){this.renderer.addClass(document.body,"widget-grid-layout"),this.gridInitialization.initialize(this.gridScopePath()).then(o=>{this.grid=o,this.cdRef.detectChanges()}),this.setHtmlTitle()}ngOnDestroy(){this.renderer.removeClass(document.body,"widget-grid-layout")}setHtmlTitle(){this.title.setTitle(this.text.html_title)}}io.\u0275fac=function(o){return new(o||io)(e.Y36(Ee),e.Y36(it.j),e.Y36(P.R),e.Y36(y.D),e.Y36(e.sBO),e.Y36(n.Dx),e.Y36(Zn),e.Y36(e.Qsj),e.Y36(J))},io.\u0275dir=e.lG2({type:io});t(46384);var ma=t(83609);function Gc(g,o){if(1&g&&e._UZ(0,"span",10),2&g){const s=e.oxw(2);e.Q6J("hidden",s.isMobileDevice)}}function qc(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"resizer",11),e.NdJ("end",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw().resize.end(S)})("start",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw().resize.start(S)})("move",function(){return e.CHM(s),e.oxw(2).resize.moving()}),e.TgZ(1,"div",12),e._UZ(2,"i",13),e.qZA(),e.qZA()}2&g&&e.Q6J("customHandler",!0)}const Xc=function(g,o,s){return{"-dragged":g,"-passive":o,"-resizing":s}};function el(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",5),e.TgZ(1,"div",6),e.NdJ("cdkDragStarted",function(){const ne=e.CHM(s).$implicit;return e.oxw().drag.start(ne)})("cdkDragDropped",function(){return e.CHM(s),e.oxw().drag.drop()}),e.YNc(2,Gc,1,1,"span",7),e._UZ(3,"ndc-dynamic",8),e.qZA(),e.YNc(4,qc,3,1,"resizer",9),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.Udp("grid-row-start",s.gridStartRow)("grid-row-end",s.gridEndRow)("grid-column-start",s.gridStartColumn)("grid-column-end",s.gridEndColumn),e.Q6J("ngClass",e.kEZ(18,Xc,w.drag.isDragged(s),w.drag.isPassive(s)||w.resize.isPassive(s),w.resize.isResized(s)))("id",s.guid)("cdkDropListData",s)("cdkDropListConnectedTo",w.layout.gridAreaIds),e.xp6(1),e.Q6J("cdkDragDisabled",w.isMobileDevice||!w.drag.isDraggable),e.xp6(1),e.Q6J("ngIf",w.drag.isDraggable),e.xp6(1),e.Q6J("ndcDynamicComponent",w.widgetComponent(s))("ndcDynamicInputs",w.widgetComponentInput(s))("ndcDynamicOutputs",w.widgetComponentOutput(s)),e.xp6(1),e.Q6J("ngIf",w.resize.isResizable)}}function tl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",16),e.NdJ("click",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw().add.widget(S)}),e.qZA()}if(2&g){const s=e.oxw(2);e.Q6J("title",s.add.addText)}}const il=function(g,o,s,w,S){return{"-drop-target":g,"-drop-only":o,"-resize-target":s,"-addable":w,"-help-mode":S}};function nl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",14),e.NdJ("mouseover",function(){const ne=e.CHM(s).$implicit;return e.oxw().layout.setMousedOverArea(ne)}),e.YNc(1,tl,1,1,"div",15),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.Udp("grid-row-start",s.gridStartRow)("grid-row-end",s.gridEndRow)("grid-column-start",s.gridStartColumn)("grid-column-end",s.gridEndColumn),e.Q6J("ngClass",e.qbA(13,il,w.drag.currentlyDragging,w.drag.isDropOnlyArea(s),w.resize.isTarget(s),w.add.isAddable(s),w.layout.inHelpMode))("id",s.guid)("cdkDropListData",s)("cdkDropListConnectedTo",w.layout.gridAreaIds),e.xp6(1),e.Q6J("ngIf",w.add.isAllowed)}}function ol(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",19),e.NdJ("click",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw().add.widget(S)}),e.qZA()}if(2&g){const s=e.oxw(2);e.Q6J("title",s.add.addText)}}const sl=function(g,o,s,w){return{"-addable":g,"-help-mode":o,"-row":s,"-column":w}};function rl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",17),e.NdJ("mouseover",function(){const ne=e.CHM(s).$implicit;return e.oxw().layout.setMousedOverArea(ne)}),e.YNc(1,ol,1,1,"div",18),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.Udp("grid-row-start",s.gridStartRow)("grid-row-end",s.gridEndRow)("grid-column-start",s.gridStartColumn)("grid-column-end",s.gridEndColumn),e.Q6J("ngClass",e.l5B(11,sl,w.add.isAddable(s),w.layout.inHelpMode,s.isRow,s.isColumn))("id",s.guid),e.xp6(1),e.Q6J("ngIf",w.add.isAllowed)}}function al(g,o){if(1&g&&(e.TgZ(0,"div",20),e._UZ(1,"div",21),e.qZA()),2&g){const s=e.oxw();e.Udp("grid-row-start",s.drag.placeholderArea.gridStartRow)("grid-row-end",s.drag.placeholderArea.gridEndRow)("grid-column-start",s.drag.placeholderArea.gridStartColumn)("grid-column-end",s.drag.placeholderArea.gridEndColumn)("min-height",s.drag.draggedHeight,"px")}}const Lr=[J,vn,yn,Fn,Zn,ce];class no{constructor(o,s,w,S,ne,fe,Ie,Ne){this.sanitization=o,this.widgetsService=s,this.drag=w,this.resize=S,this.layout=ne,this.add=fe,this.remove=Ie,this.browserDetector=Ne,this.uiWidgets=[],this.GRID_AREA_HEIGHT="auto",this.GRID_GAP_DIMENSION="20px",this.component=At}ngOnInit(){this.layout.gridResource=this.grid}ngOnDestroy(){this.uiWidgets.forEach(o=>o.destroy())}handleKeyboardEvent(o){"Escape"!==o.key||(this.drag.currentlyDragging?this.drag.abort():this.resize.currentlyResizing&&this.resize.abort())}widgetComponent(o){const{widget:s}=o;if(!s)return null;const w=this.widgetsService.registered.find(S=>S.identifier===s.identifier);return w?w.component:null}widgetComponentInput(o){return{resource:o.widget}}widgetComponentOutput(o){return{resourceChanged:this.layout.saveWidgetChangeset.bind(this.layout)}}get gridColumnStyle(){return this.gridStyle(this.layout.numColumns,`calc((100% - ${this.GRID_GAP_DIMENSION} * ${this.layout.numColumns+1}) / ${this.layout.numColumns})`)}get gridRowStyle(){return this.gridStyle(this.layout.numRows,this.GRID_AREA_HEIGHT)}identifyGridArea(o,s){return s.guid}get isHeadersDisplayed(){return this.layout.isEditable}get isMobileDevice(){return this.browserDetector.isMobile}gridStyle(o,s){let w="";for(let S=0;S<o;S++)w+=`${this.GRID_GAP_DIMENSION} ${s} `;return w+=`${this.GRID_GAP_DIMENSION}`,this.sanitization.bypassSecurityTrustStyle(w)}}no.\u0275fac=function(o){return new(o||no)(e.Y36(n.H7),e.Y36(Mt),e.Y36(yn),e.Y36(Fn),e.Y36(J),e.Y36(Zn),e.Y36(ce),e.Y36(mt.o))},no.\u0275cmp=e.Xpm({type:no,selectors:[["grid"]],hostBindings:function(o,s){1&o&&e.NdJ("keyup",function(S){return s.handleKeyboardEvent(S)},!1,e.Jf7)},inputs:{grid:"grid"},decls:5,vars:11,consts:[[1,"grid--container"],["class","grid--area -widgeted","cdkDropList","",3,"ngClass","grid-row-start","grid-row-end","grid-column-start","grid-column-end","id","cdkDropListData","cdkDropListConnectedTo",4,"ngFor","ngForOf","ngForTrackBy"],["class","grid--area hidden-for-mobile","cdkDropList","",3,"ngClass","grid-row-start","grid-row-end","grid-column-start","grid-column-end","id","cdkDropListData","cdkDropListConnectedTo","mouseover",4,"ngFor","ngForOf","ngForTrackBy"],["class","grid--area -gap hidden-for-mobile",3,"ngClass","grid-row-start","grid-row-end","grid-column-start","grid-column-end","id","mouseover",4,"ngFor","ngForOf","ngForTrackBy"],["class","grid--area -widgeted -placeholder",3,"grid-row-start","grid-row-end","grid-column-start","grid-column-end","min-height",4,"ngIf"],["cdkDropList","",1,"grid--area","-widgeted",3,"ngClass","id","cdkDropListData","cdkDropListConnectedTo"],["cdkDrag","",1,"grid--area-content","widget-box",3,"cdkDragDisabled","cdkDragStarted","cdkDragDropped"],["class","grid--area-drag-handle\n                   icon\n                   icon-drag-handle\n                   hidden-for-mobile","cdkDragHandle","",3,"hidden",4,"ngIf"],[3,"ndcDynamicComponent","ndcDynamicInputs","ndcDynamicOutputs"],[3,"customHandler","end","start","move",4,"ngIf"],["cdkDragHandle","",1,"grid--area-drag-handle","icon","icon-drag-handle","hidden-for-mobile",3,"hidden"],[3,"customHandler","end","start","move"],[1,"grid--resizer"],["aria-hidden","true",1,"icon-resizer-bottom-right","hidden-for-mobile"],["cdkDropList","",1,"grid--area","hidden-for-mobile",3,"ngClass","id","cdkDropListData","cdkDropListConnectedTo","mouseover"],["class","grid--widget-add",3,"title","click",4,"ngIf"],[1,"grid--widget-add",3,"title","click"],[1,"grid--area","-gap","hidden-for-mobile",3,"ngClass","id","mouseover"],["class","grid--widget-add -gap",3,"title","click",4,"ngIf"],[1,"grid--widget-add","-gap",3,"title","click"],[1,"grid--area","-widgeted","-placeholder"],[1,"widget-box"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,el,5,22,"div",1),e.YNc(2,nl,2,19,"div",2),e.YNc(3,rl,2,16,"div",3),e.YNc(4,al,2,10,"div",4),e.qZA()),2&o&&(e.Udp("grid-template-columns",s.gridColumnStyle)("grid-template-rows",s.gridRowStyle),e.xp6(1),e.Q6J("ngForOf",s.layout.widgetAreas)("ngForTrackBy",s.identifyGridArea),e.xp6(1),e.Q6J("ngForOf",s.layout.gridAreas)("ngForTrackBy",s.identifyGridArea),e.xp6(1),e.Q6J("ngForOf",s.layout.gridGaps)("ngForTrackBy",s.identifyGridArea),e.xp6(1),e.Q6J("ngIf",s.drag.placeholderArea))},directives:[R.sg,R.O5,x.Wj,R.mk,x.Zt,v.B5,v.oc,x.Bh,ma.d],encapsulation:2});const cl=function(g){return{"-active":g}};function ll(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){return e.CHM(s),e.oxw().areas.toggleHelpMode()}),e._UZ(1,"op-icon",10),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.addWidget.addText)("ngClass",e.VKq(2,cl,s.areas.inHelpMode))}}function dl(g,o){if(1&g&&e._UZ(0,"grid",11),2&g){const s=e.oxw();e.Q6J("grid",s.grid)}}class bo extends io{i18nNamespace(){return"dashboards"}gridScopePath(){return this.pathHelper.projectDashboardsPath(this.currentProject.identifier)}}bo.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(bo)))(s||bo)}}(),bo.\u0275cmp=e.Xpm({type:bo,selectors:[["dashboard"]],features:[e._Bn(Lr),e.qOj],decls:10,vars:3,consts:[[1,"op-grid-page"],[1,"toolbar","op-grid-page--toolbar-container"],[1,"op-grid-page--title-container","title-container"],[3,"textContent"],[1,"op-grid-page--toolbar-items","toolbar-items","hidden-for-mobile"],[1,"toolbar-item","hidden-for-mobile"],[1,"toolbar-item"],["class","button",3,"title","ngClass","click",4,"ngIf"],[3,"grid",4,"ngIf"],[1,"button",3,"title","ngClass","click"],["icon-classes","button--icon icon-add"],[3,"grid"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"h2",3),e.qZA(),e.TgZ(4,"ul",4),e.TgZ(5,"li",5),e._UZ(6,"zen-mode-toggle-button"),e.qZA(),e.TgZ(7,"li",6),e.YNc(8,ll,2,4,"button",7),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,dl,1,1,"grid",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.title),e.xp6(5),e.Q6J("ngIf",s.addWidget.isAllowed),e.xp6(1),e.Q6J("ngIf",s.grid))},directives:[jn.a,R.O5,R.mk,ut.o,no],styles:[".op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:20px;margin-bottom:-5px}.op-grid-page--toolbar-container[_ngcontent-%COMP%]{margin-bottom:0}.op-grid-page--toolbar-items[_ngcontent-%COMP%]{padding-right:20px}@media only screen and (max-width: 679px){.op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:0;margin-bottom:0}}"]});const pl=[{name:"dashboards",parent:"optional_project",url:"/dashboards/",data:{bodyClasses:["router--dashboards-view-base","widget-grid-layout"],menuItem:"dashboards-menu-item"},component:bo}];class wo{}wo.\u0275fac=function(o){return new(o||wo)},wo.\u0275mod=e.oAB({type:wo}),wo.\u0275inj=e.cJS({providers:[],imports:[[l.H,Oi,Vt.UIRouterModule.forChild({states:pl,config:function(g){g.urlService.rules.when(new RegExp("^/projects/(.*)/dashboards$"),o=>`/projects/${o[1]}/dashboards/`)}})]]});var hl=t(37409);function _l(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",1),e.TgZ(1,"wp-single-card",2),e.NdJ("stateLinkClicked",function(S){return e.CHM(s),e.oxw().openStateLink(S)}),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("workPackage",s.workPackage)}}class gs extends dt.T{constructor(o,s,w,S,ne,fe,Ie){super(s,w,o),this.elementRef=o,this.locals=s,this.cdRef=w,this.i18n=S,this.apiV3Service=ne,this.opModalService=fe,this.$state=Ie,this.text={created_by:this.i18n.t("js.label_created_by")}}ngOnInit(){super.ngOnInit();const{workPackageLink:o}=this.locals,s=(0,Te.Z)(o);this.apiV3Service.work_packages.id(s).requireAndStream().subscribe(w=>{this.workPackage=w,this.cdRef.detectChanges();const S=jQuery(this.elementRef.nativeElement);this.reposition(S,this.locals.event.target)})}reposition(o,s){o.position({my:"right top",at:"right bottom",of:s,collision:"flipfit"})}openStateLink(o){const s={workPackageId:o.workPackageId};this.$state.go(o.requestedState,s)}}gs.\u0275fac=function(o){return new(o||gs)(e.Y36(e.SBq),e.Y36(lt.E),e.Y36(e.sBO),e.Y36(y.D),e.Y36(j.T),e.Y36(lt.S),e.Y36(he.StateService))},gs.\u0275cmp=e.Xpm({type:gs,selectors:[["ng-component"]],features:[e.qOj],decls:1,vars:1,consts:[["class","op-wp-preview-modal","wp-isolated-query-space","",4,"ngIf"],["wp-isolated-query-space","",1,"op-wp-preview-modal"],["orientation","horizontal",3,"workPackage","stateLinkClicked"]],template:function(o,s){1&o&&e.YNc(0,_l,2,1,"div",0),2&o&&e.Q6J("ngIf",s.workPackage)},directives:[R.O5,Ye.A,hl.P],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-wp-preview-modal[_ngcontent-%COMP%]{position:absolute;z-index:5000;min-width:350px;padding:0;box-shadow:0 0 5px 2px #00000040;pointer-events:all}"],changeDetection:0});class To{constructor(o,s,w){this.opModalService=o,this.ngZone=s,this.injector=w,this.mouseInModal=!1}setupListener(){jQuery(document.body).on("mouseover",".preview-trigger",o=>{o.preventDefault(),o.stopPropagation();const s=jQuery(o.target),w=s.attr("href");!w||this.opModalService.show(gs,this.injector,{workPackageLink:w,event:o},!0).subscribe(S=>{this.modalElement=S.elementRef.nativeElement,S.reposition(jQuery(this.modalElement),s)})}),jQuery(document.body).on("mouseleave",".preview-trigger",()=>{this.closeAfterTimeout()}),jQuery(document.body).on("mouseleave",".op-wp-preview-modal",()=>{this.mouseInModal=!1,this.closeAfterTimeout()}),jQuery(document.body).on("mouseenter",".op-wp-preview-modal",()=>{this.mouseInModal=!0})}closeAfterTimeout(){this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this.mouseInModal||this.opModalService.close()},100)})}isMouseOverPreview(o){if(!this.modalElement)return!1;const s=jQuery(this.modalElement.children[0]);if(s&&s.offset()){const w=o.pageX>=Math.floor(s.offset().left)&&o.pageX<s.offset().left+s.width(),S=o.pageY>=Math.floor(s.offset().top)&&o.pageY<s.offset().top+s.height();return w&&S}return!1}}To.\u0275fac=function(o){return new(o||To)(e.LFG(lt.S),e.LFG(e.R0b),e.LFG(e.zs3))},To.\u0275prov=e.Yz7({token:To,factory:To.\u0275fac,providedIn:"root"});const ml=function(g){return{"-active":g}};function gl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){return e.CHM(s),e.oxw().areas.toggleHelpMode()}),e._UZ(1,"op-icon",10),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.addWidget.addText)("ngClass",e.VKq(2,ml,s.areas.inHelpMode))}}function fl(g,o){if(1&g&&e._UZ(0,"grid",11),2&g){const s=e.oxw();e.Q6J("grid",s.grid)}}class ko extends io{i18nNamespace(){return"overviews"}gridScopePath(){return this.pathHelper.projectPath(this.currentProject.identifier)}}ko.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(ko)))(s||ko)}}(),ko.\u0275cmp=e.Xpm({type:ko,selectors:[["overview"]],features:[e._Bn(Lr),e.qOj],decls:10,vars:3,consts:[[1,"op-grid-page"],[1,"toolbar","op-grid-page--toolbar-container"],[1,"op-grid-page--title-container","title-container"],[3,"textContent"],[1,"op-grid-page--toolbar-items","toolbar-items","hidden-for-mobile"],[1,"toolbar-item","hidden-for-mobile"],[1,"toolbar-item"],["class","button",3,"title","ngClass","click",4,"ngIf"],[3,"grid",4,"ngIf"],[1,"button",3,"title","ngClass","click"],["icon-classes","button--icon icon-add"],[3,"grid"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"h2",3),e.qZA(),e.TgZ(4,"ul",4),e.TgZ(5,"li",5),e._UZ(6,"zen-mode-toggle-button"),e.qZA(),e.TgZ(7,"li",6),e.YNc(8,gl,2,4,"button",7),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,fl,1,1,"grid",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.title),e.xp6(5),e.Q6J("ngIf",s.addWidget.isAllowed),e.xp6(1),e.Q6J("ngIf",s.grid))},directives:[jn.a,R.O5,R.mk,ut.o,no],styles:[".op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:20px;margin-bottom:-5px}.op-grid-page--toolbar-container[_ngcontent-%COMP%]{margin-bottom:0}.op-grid-page--toolbar-items[_ngcontent-%COMP%]{padding-right:20px}@media only screen and (max-width: 679px){.op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:0;margin-bottom:0}}"]});const vl=[{name:"overview",parent:"optional_project",url:"/",data:{menuItem:"overview-menu-item"},component:ko}];class Po{}Po.\u0275fac=function(o){return new(o||Po)},Po.\u0275mod=e.oAB({type:Po}),Po.\u0275inj=e.cJS({providers:[],imports:[[l.H,Oi,Vt.UIRouterModule.forChild({states:vl,config:function(g){g.urlService.rules.when(new RegExp("^/projects(?!/new$)/([^/]+)$"),o=>`/projects/${o[1]}/`)}})]]});const Cl=function(g){return{"-active":g}};function bl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){return e.CHM(s),e.oxw().areas.toggleHelpMode()}),e._UZ(1,"op-icon",10),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.addWidget.addText)("ngClass",e.VKq(2,Cl,s.areas.inHelpMode))}}function wl(g,o){if(1&g&&e._UZ(0,"grid",11),2&g){const s=e.oxw();e.Q6J("grid",s.grid)}}class xo extends io{i18nNamespace(){return"my_page"}gridScopePath(){return this.pathHelper.myPagePath()}}xo.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(xo)))(s||xo)}}(),xo.\u0275cmp=e.Xpm({type:xo,selectors:[["ng-component"]],features:[e._Bn(Lr),e.qOj],decls:10,vars:3,consts:[[1,"op-grid-page"],[1,"toolbar","op-grid-page--toolbar-container"],[1,"op-grid-page--title-container","title-container"],[3,"textContent"],[1,"op-grid-page--toolbar-items","toolbar-items","hidden-for-mobile"],[1,"toolbar-item","hidden-for-mobile"],[1,"toolbar-item"],["class","button",3,"title","ngClass","click",4,"ngIf"],[3,"grid",4,"ngIf"],[1,"button",3,"title","ngClass","click"],["icon-classes","button--icon icon-add"],[3,"grid"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"h2",3),e.qZA(),e.TgZ(4,"ul",4),e.TgZ(5,"li",5),e._UZ(6,"zen-mode-toggle-button"),e.qZA(),e.TgZ(7,"li",6),e.YNc(8,bl,2,4,"button",7),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,wl,1,1,"grid",8),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.title),e.xp6(5),e.Q6J("ngIf",s.addWidget.isAllowed),e.xp6(1),e.Q6J("ngIf",s.grid))},directives:[jn.a,R.O5,R.mk,ut.o,no],styles:[".op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:20px;margin-bottom:-5px}.op-grid-page--toolbar-container[_ngcontent-%COMP%]{margin-bottom:0}.op-grid-page--toolbar-items[_ngcontent-%COMP%]{padding-right:20px}@media only screen and (max-width: 679px){.op-grid-page--title-container[_ngcontent-%COMP%]{margin-left:0;margin-bottom:0}}"]});const Tl=[{name:"my_page",url:"/my/page",component:xo,data:{bodyClasses:["router--work-packages-my-page","widget-grid-layout"],parent:"work-packages"}}];class Eo{}Eo.\u0275fac=function(o){return new(o||Eo)},Eo.\u0275mod=e.oAB({type:Eo}),Eo.\u0275inj=e.cJS({imports:[[l.H,Oi,u.K,Vt.UIRouterModule.forChild({states:Tl})]]});var kl=t(71718),ga=t(7101);const Pl={preview:1,newWorkPackage:2,edit:3,quickSearch:4,projectSearch:5,help:6,moreMenu:7,details:8};class Oo{constructor(o,s,w){this.PathHelper=o,this.FocusHelper=s,this.currentProject=w,this.shortcuts={"?":()=>this.showHelpModal(),"g m":this.globalAction("myPagePath"),"g o":this.projectScoped("projectPath"),"g w p":this.projectScoped("projectWorkPackagesPath"),"g w i":this.projectScoped("projectWikiPath"),"g a":this.projectScoped("projectActivityPath"),"g c":this.projectScoped("projectCalendarPath"),"g n":this.projectScoped("projectNewsPath"),"n w p":this.projectScoped("projectWorkPackageNewPath"),"g e":this.accessKey("edit"),"g p":this.accessKey("preview"),"d w p":this.accessKey("details"),m:this.accessKey("moreMenu"),p:this.accessKey("projectSearch"),s:this.accessKey("quickSearch"),k:()=>this.focusPrevItem(),j:()=>this.focusNextItem()},this.register()}register(){_.each(this.shortcuts,(o,s)=>Mousetrap.bind(s,o))}accessKey(o){const s=Pl[o];return()=>{const w=jQuery(`[accesskey=${s}]:first`);w.is("input")||"global-search-input"===w.attr("id")?setTimeout(()=>this.FocusHelper.focus(w[0]),200):w.is("[href]")?this.clickLink(w[0]):w[0].click()}}globalAction(o){return()=>{window.location.href=this.PathHelper[o]()}}projectScoped(o){return()=>{const s=this.currentProject.identifier;s&&(window.location.href=this.PathHelper[o](s))}}clickLink(o){const s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});!o.dispatchEvent(s)||(window.location.href=o.href)}showHelpModal(){window.open(this.PathHelper.keyboardShortcutsHelpPath())}focusItemOffset(o){const s=document.querySelector("table.keyboard-accessible-list");if(!s)return;const w=Array.from(s.querySelectorAll("tbody > tr"));let S;if(document.activeElement){S=w.indexOf(document.activeElement);const ne=w[S+o];null==ne||ne.focus()}}focusNextItem(){this.focusItemOffset(1)}focusPrevItem(){this.focusItemOffset(-1)}}Oo.\u0275fac=function(o){return new(o||Oo)(e.LFG(it.j),e.LFG(ga.i),e.LFG(P.R))},Oo.\u0275prov=e.Yz7({token:Oo,factory:Oo.\u0275fac,providedIn:"root"});var rn=t(36868);class Mo{}Mo.\u0275fac=function(o){return new(o||Mo)},Mo.\u0275mod=e.oAB({type:Mo}),Mo.\u0275inj=e.cJS({imports:[[l.H,rn.A0]]});var El=t(55280),an=t(3352);class oo{constructor(o){this.documentElement=o}loadRequiredScripts(){const o=this.documentElement.querySelectorAll('meta[name="required_script"]');for(let s=0;s<o.length;++s){const w=o[s].content;(0,an.qu)(`Loading required script ${w}`),t(37294)(`./${w}`)}}}oo.\u0275fac=function(o){return new(o||oo)(e.LFG(R.K0))},oo.\u0275prov=e.Yz7({token:oo,factory:oo.\u0275fac,providedIn:"root"});class Io{constructor(o,s){o.setupListener(),s.loadRequiredScripts()}}Io.\u0275fac=function(o){return new(o||Io)(e.LFG(El.v),e.LFG(oo))},Io.\u0275mod=e.oAB({type:Io}),Io.\u0275inj=e.cJS({providers:[oo],imports:[[u.K]]});var Ol=t(7085),Ml=t(37991),fa=t(6894),Il=t(64775),ki=t(83635);class Do{constructor(o,s,w){this.documentElement=o,this.opModalService=s,this.currentProjectService=w}setupListener(){const o=this.documentElement.querySelectorAll("[invite-user-modal-augment]");for(let s=0;s<o.length;++s)o[s].addEventListener("click",this.spawnModal.bind(this))}spawnModal(o){o.preventDefault(),this.opModalService.show(ki.E,"global",{projectId:this.currentProjectService.id}).subscribe(s=>s.closingEvent.subscribe(w=>{w.data&&window.location.reload()}))}}Do.\u0275fac=function(o){return new(o||Do)(e.LFG(R.K0),e.LFG(lt.S),e.LFG(P.R))},Do.\u0275prov=e.Yz7({token:Do,factory:Do.\u0275fac,providedIn:"root"});var Sl=t(2308),So=t(96905),Al=t(91720),Ht=t(33927),jl=t(18293);var Ur=t(92512),Br=t(5443);function Fl(g,o){if(1&g&&e._UZ(0,"p",4),2&g){const s=e.oxw().$implicit;e.Q6J("innerHTML",s.description,e.oJD)}}function Zl(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"label"),e.TgZ(1,"input",1),e.NdJ("ngModelChange",function(S){e.CHM(s);return e.oxw().selected=S}),e.qZA(),e.TgZ(2,"div"),e.TgZ(3,"p",2),e._uU(4),e.qZA(),e.YNc(5,Fl,1,1,"p",3),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.Tol(w.getClassListForItem(s)),e.xp6(1),e.Q6J("value",s.value)("ngModel",w.selected)("disabled",s.disabled),e.uIk("name",w.name),e.xp6(3),e.Oqu(s.title),e.xp6(1),e.Q6J("ngIf",s.description)}}class Ao{constructor(){this.className=!0,this.options=[],this.name="op-option-list-"+ +new Date,this.selectedChange=new e.vpe,this._selected=null,this.onChange=o=>{},this.onTouched=o=>{}}get selected(){return this._selected}set selected(o){this._selected=o,this.onChange(o)}getClassListForItem(o){return{"op-option-list--item":!0,"op-option-list--item_selected":this.selected===o.value,"op-option-list--item_disabled":!!o.disabled}}writeValue(o){this._selected=o}registerOnChange(o){this.onChange=o}registerOnTouched(o){this.onTouched=o}}function Wl(g,o){if(1&g&&(e.TgZ(0,"div",14),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.project.lackingPermissionInfo," ")}}function Ll(g,o){if(1&g&&(e.TgZ(0,"div",15),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.project.required," ")}}function Ul(g,o){if(1&g&&(e.TgZ(0,"div",15),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.project.lackingPermission," ")}}function Bl(g,o){if(1&g&&(e.TgZ(0,"div",16),e.TgZ(1,"div",17),e._uU(2),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.hij(" ",s.text.type.required," ")}}Ao.\u0275fac=function(o){return new(o||Ao)},Ao.\u0275cmp=e.Xpm({type:Ao,selectors:[["op-option-list"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-option-list",s.className)},inputs:{options:"options",name:"name"},outputs:{selectedChange:"selectedChange"},features:[e._Bn([{provide:h.JU,useExisting:(0,e.Gpc)(()=>Ao),multi:!0}])],decls:1,vars:1,consts:[[3,"class",4,"ngFor","ngForOf"],["type","radio",1,"op-option-list--input",3,"value","ngModel","disabled","ngModelChange"],[1,"op-option-list--item-title"],["class","op-option-list--item-description",3,"innerHTML",4,"ngIf"],[1,"op-option-list--item-description",3,"innerHTML"]],template:function(o,s){1&o&&e.YNc(0,Zl,6,8,"label",0),2&o&&e.Q6J("ngForOf",s.options)},directives:[R.sg,h._,h.Fj,h.JJ,h.On,R.O5],encapsulation:2});class fs{constructor(o,s,w,S,ne,fe){var g;this.I18n=o,this.elementRef=s,this.bannersService=w,this.apiV3Service=S,this.currentUserService=ne,this.cdRef=fe,this.close=new e.vpe,this.save=new e.vpe,this.text={title:this.I18n.t("js.invite_user_modal.title.invite"),project:{label:this.I18n.t("js.invite_user_modal.project.label"),required:this.I18n.t("js.invite_user_modal.project.required"),lackingPermission:this.I18n.t("js.invite_user_modal.project.lacking_permission"),lackingPermissionInfo:this.I18n.t("js.invite_user_modal.project.lacking_permission_info"),noInviteRights:this.I18n.t("js.invite_user_modal.project.no_invite_rights")},type:{required:this.I18n.t("js.invite_user_modal.type.required")},nextButton:this.I18n.t("js.invite_user_modal.project.next_button"),cancelButton:this.I18n.t("js.button_cancel")},this.typeOptions=[{value:ki.e.User,title:this.I18n.t("js.invite_user_modal.type.user.title"),description:this.I18n.t("js.invite_user_modal.type.user.description")},{value:ki.e.Group,title:this.I18n.t("js.invite_user_modal.type.group.title"),description:this.I18n.t("js.invite_user_modal.type.group.description")}],this.projectAndTypeForm=new h.cw({type:new h.NI(ki.e.User,[h.kI.required]),project:new h.NI(null,[h.kI.required],(g=this.currentUserService,o=>{var s,w,S;const ne=(null===(s=o.value)||void 0===s?void 0:s.href)||(null===(S=null===(w=o.value)||void 0===w?void 0:w.$links)||void 0===S?void 0:S.self.href),fe=ne?(0,Te.Z)(ne):o.value;return g.hasCapabilities$("memberships/create",fe).pipe((0,Rn.q)(1),(0,Ht.U)(Ie=>Ie?null:{lackingPermission:!0}),(0,jl.K)(()=>(0,mo.of)(null)))}))}),this.projectInviteCapabilities=[],this.APIFiltersForProjects=[["active","=",!0]]}get typeControl(){return this.projectAndTypeForm.get("type")}get projectControl(){return this.projectAndTypeForm.get("project")}ngOnInit(){this.typeControl.setValue(this.type),this.project&&this.projectControl.setValue((0,Al.fK)(this.project)),this.setPlaceholderOption(),this.currentUserService.capabilities$(["memberships/create"],null).pipe((0,Ht.U)(o=>o.filter(s=>s._links.action.href.endsWith("/memberships/create")))).subscribe(o=>{this.projectInviteCapabilities=o,this.cdRef.detectChanges()})}setPlaceholderOption(){this.bannersService.eeShowBanners?this.typeOptions.push({value:ki.e.Placeholder,title:this.I18n.t("js.invite_user_modal.type.placeholder.title_no_ee"),description:this.I18n.t("js.invite_user_modal.type.placeholder.description_no_ee",{eeHref:this.bannersService.getEnterPriseEditionUrl({referrer:"placeholder-users",hash:"placeholder-users"})}),disabled:!0}):this.typeOptions.push({value:ki.e.Placeholder,title:this.I18n.t("js.invite_user_modal.type.placeholder.title"),description:this.I18n.t("js.invite_user_modal.type.placeholder.description"),disabled:!1})}onSubmit(o){var s,w;return(0,H.mG)(this,void 0,void 0,function*(){if(o.preventDefault(),this.projectAndTypeForm.invalid)return void this.projectAndTypeForm.markAsDirty();const S=(0,Te.Z)(null===(w=null===(s=this.projectControl)||void 0===s?void 0:s.value)||void 0===w?void 0:w.href),ne=yield this.apiV3Service.projects.id(S).get().toPromise();this.save.emit({project:ne,type:this.typeControl.value})})}projectFilterFn(o){const s=o.map(w=>{const S=!this.projectInviteCapabilities.find(ne=>(0,Te.Z)(ne._links.context.href)===w.id.toString());return Object.assign(Object.assign({},w),{disabled:S,disabledReason:S?this.text.project.noInviteRights:""})});return s.sort((w,S)=>(w.disabled?1:0)-(S.disabled?1:0)),s}}fs.\u0275fac=function(o){return new(o||fs)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(Co.j),e.Y36(j.T),e.Y36(So.S),e.Y36(e.sBO))},fs.\u0275cmp=e.Xpm({type:fs,selectors:[["op-ium-project-selection"]],inputs:{type:"type",project:"project"},outputs:{close:"close",save:"save"},decls:19,vars:12,consts:[[3,"formGroup","ngSubmit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["required","",3,"label"],["slot","input","formControlName","project","appendTo",".spot-modal-overlay",3,"apiFilters","mapResultsFn"],["slot","action",4,"ngIf"],["slot","errors","class","spot-form-field--error",4,"ngIf"],["formControlName","type","slot","input",3,"options"],["class","spot-form-field--errors","slot","errors",4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],["type","button",1,"button","spot-action-bar--action","spot-modal--cancel-button",3,"click"],[1,"button","-highlight","spot-action-bar--action"],["slot","action"],["slot","errors",1,"spot-form-field--error"],["slot","errors",1,"spot-form-field--errors"],[1,"spot-form-field--error"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(S){return s.onSubmit(S)}),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"spot-form-field",4),e._UZ(6,"op-project-autocompleter",5),e.YNc(7,Wl,2,1,"div",6),e.YNc(8,Ll,2,1,"div",7),e.YNc(9,Ul,2,1,"div",7),e.qZA(),e.TgZ(10,"spot-form-field"),e._UZ(11,"op-option-list",8),e.YNc(12,Bl,3,1,"div",9),e.qZA(),e.qZA(),e.TgZ(13,"div",10),e.TgZ(14,"div",11),e.TgZ(15,"button",12),e.NdJ("click",function(){return s.close.emit()}),e._uU(16),e.qZA(),e.TgZ(17,"button",13),e._uU(18),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("formGroup",s.projectAndTypeForm),e.xp6(2),e.Oqu(s.text.title),e.xp6(3),e.Q6J("label",s.text.project.label),e.xp6(1),e.Q6J("apiFilters",s.APIFiltersForProjects)("mapResultsFn",s.projectFilterFn.bind(s)),e.xp6(1),e.Q6J("ngIf",null==s.projectControl.errors?null:s.projectControl.errors.lackingPermission),e.xp6(1),e.Q6J("ngIf",null==s.projectControl.errors?null:s.projectControl.errors.required),e.xp6(1),e.Q6J("ngIf",null==s.projectControl.errors?null:s.projectControl.errors.lackingPermission),e.xp6(2),e.Q6J("options",s.typeOptions),e.xp6(1),e.Q6J("ngIf",(null==s.projectAndTypeForm?null:s.projectAndTypeForm.dirty)&&(null==s.typeControl?null:s.typeControl.invalid)),e.xp6(4),e.hij(" ",s.text.cancelButton," "),e.xp6(2),e.Oqu(s.text.nextButton))},directives:[h._Y,h.JL,h.sg,Ur.I,Br.F,h.JJ,h.u,R.O5,Ao],styles:[""],changeDetection:0});var va=t(23896),ya=t(98377),jo=(t(9214),t(80044)),Ca=(t(4816),t(79441)),Cr=t(80639),ba=t(3353);function Nl(g,o){if(1&g&&(e.TgZ(0,"div",4),e._uU(1),e.qZA()),2&g){const s=o.item,w=o.searchTerm;e.Q6J("ngOptionHighlight",w),e.xp6(1),e.Oqu(s.name)}}function Ql(g,o){if(1&g&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.noRolesFound," ")}}class vs extends yi.N{constructor(o,s,w){super(),this.I18n=o,this.elementRef=s,this.apiV3Service=w,this.input$=new Ca.xQ,this.roles$=new Ca.xQ,this.text={noRolesFound:this.I18n.t("js.invite_user_modal.role.no_roles_found")},this.items$=(0,Ni.aj)(this.input$.pipe(this.untilDestroyed(),(0,Cr.b)(200),(0,hi.h)(S=>"string"==typeof S),(0,Ht.U)(S=>S.toLowerCase()),(0,to.x)()),this.roles$).pipe((0,Ht.U)(([S,ne])=>ne.filter(fe=>!S||-1!==fe.name.toLowerCase().indexOf(S))))}ngOnInit(){const o=new gn.qM;o.add("grantable","=",!0),o.add("unit","=",["project"]),this.apiV3Service.roles.filtered(o).get().subscribe(({elements:s})=>this.roles$.next(s)),setTimeout(()=>this.input$.next(""))}}vs.\u0275fac=function(o){return new(o||vs)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(j.T))},vs.\u0275cmp=e.Xpm({type:vs,selectors:[["op-ium-role-search"]],inputs:{spotFormBinding:"spotFormBinding"},features:[e.qOj],decls:5,vars:9,consts:[["appendTo",".spot-modal-overlay","bindLabel","name",3,"formControl","typeahead","items","virtualScroll","clearable","clearOnBackspace","clearSearchOnAdd"],["ngselect",""],["ng-option-tmp",""],["ng-notfound-tmp",""],[1,"ng-option-label","ellipsis",3,"ngOptionHighlight"],[1,"ng-option","disabled"]],template:function(o,s){1&o&&(e.TgZ(0,"ng-select",0,1),e.ALo(2,"async"),e.YNc(3,Nl,2,2,"ng-template",2),e.YNc(4,Ql,2,1,"ng-template",3),e.qZA()),2&o&&e.Q6J("formControl",s.spotFormBinding)("typeahead",s.input$)("items",e.lcZ(2,7,s.items$))("virtualScroll",!0)("clearable",!0)("clearOnBackspace",!1)("clearSearchOnAdd",!1)},directives:[rn.w9,h.JJ,h.oH,rn.Z2,rn.vM,ba.s],pipes:[R.Ov],encapsulation:2});const Jl={provide:h.a5,useExisting:(0,e.Gpc)(()=>so)};class so extends h.a5{get control(){return this.form}viewToModelUpdate(){}}so.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(so)))(s||so)}}(),so.\u0275dir=e.lG2({type:so,selectors:[["","spotFormBinding",""]],inputs:{form:["spotFormBinding","form"]},exportAs:["ngForm"],features:[e._Bn([Jl]),e.qOj]});var Yl=t(42720),$l=t(91992),Nr=t(92597),wa=t(41599);function Vl(g,o){if(1&g&&e._uU(0),2&g){const s=o.item;e.hij(" ",(null==s.principal?null:s.principal.name)||s.name," ")}}function Hl(g,o){if(1&g&&(e.TgZ(0,"div",10),e._uU(1),e.qZA()),2&g){const s=e.oxw(3);e.xp6(1),e.Oqu(s.text.alreadyAMember())}}function zl(g,o){if(1&g&&(e.TgZ(0,"div",7),e.TgZ(1,"div",8),e._uU(2),e.qZA(),e.YNc(3,Hl,2,1,"div",9),e.qZA()),2&g){const s=e.oxw(),w=s.searchTerm,S=s.item;e.xp6(1),e.Q6J("ngOptionHighlight",w),e.xp6(1),e.Oqu(S.principal.name),e.xp6(1),e.Q6J("ngIf",S.disabled)}}function Kl(g,o){if(1&g&&e.YNc(0,zl,4,3,"div",6),2&g){const s=o.item;e.Q6J("ngIf",s)}}function Gl(g,o){if(1&g&&(e.TgZ(0,"div",11),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.noResults[s.type]," ")}}function ql(g,o){if(1&g&&(e.TgZ(0,"div"),e._UZ(1,"op-icon",13),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4),e.qZA()),2&g){const s=e.oxw(2);e.xp6(3),e.Oqu(s.text.inviteNewUser),e.xp6(1),e.hij(" ",s.input," ")}}function Xl(g,o){if(1&g&&(e.TgZ(0,"div"),e._UZ(1,"op-icon",14),e.TgZ(2,"b"),e._uU(3),e.qZA(),e._uU(4),e.qZA()),2&g){const s=e.oxw(2);e.xp6(3),e.Oqu(s.text.createNewPlaceholder),e.xp6(1),e.hij(" ",s.input," ")}}function ed(g,o){if(1&g&&(e.YNc(0,ql,5,2,"div",12),e.ALo(1,"async"),e.YNc(2,Xl,5,2,"div",12),e.ALo(3,"async")),2&g){const s=e.oxw();e.Q6J("ngIf",e.lcZ(1,2,s.canInviteByEmail$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,4,s.canCreateNewPlaceholder$))}}class ys extends yi.N{constructor(o,s,w,S,ne){super(),this.I18n=o,this.elementRef=s,this.apiV3Service=w,this.currentUserService=S,this.capabilitiesService=ne,this.createNew=new e.vpe,this.input$=new Z.X(""),this.input="",this.items$=this.input$.pipe(this.untilDestroyed(),(0,Cr.b)(200),(0,to.x)(),(0,je.w)(this.loadPrincipalData.bind(this)),(0,$l.B)()),this.emailRegExp=/^\S+@\S+\.\S+$/,this.canInviteByEmail$=(0,Ni.aj)(this.items$,this.input$,this.currentUserService.hasCapabilities$("users/create","global")).pipe((0,Ht.U)(([fe,Ie,Ne])=>Ne&&this.type===ki.e.User&&!!Ie&&this.emailRegExp.test(Ie)&&!fe.find(et=>et.principal.email===Ie))),this.canCreateNewPlaceholder$=(0,Ni.aj)([this.items$,this.input$,this.currentUserService.hasCapabilities$("placeholder_users/create","global")]).pipe((0,Ht.U)(([fe,Ie,Ne])=>!(!Ne||this.type!==ki.e.Placeholder)&&(!!Ie&&!fe.find(et=>et.name===Ie)))),this.showAddTag=!1,this.text={alreadyAMember:()=>{var fe;return this.I18n.t("js.invite_user_modal.principal.already_member_message",{project:null===(fe=this.project)||void 0===fe?void 0:fe.name})},inviteNewUser:this.I18n.t("js.invite_user_modal.principal.invite_user"),createNewPlaceholder:this.I18n.t("js.invite_user_modal.principal.create_new_placeholder"),noResults:{User:this.I18n.t("js.invite_user_modal.principal.no_results_user"),PlaceholderUser:this.I18n.t("js.invite_user_modal.principal.no_results_placeholder"),Group:this.I18n.t("js.invite_user_modal.principal.no_results_group")}},this.compareWith=(fe,Ie)=>fe.principal.id===Ie.id,this.input$.subscribe(fe=>{this.input=fe}),(0,Ni.aj)(this.canInviteByEmail$,this.canCreateNewPlaceholder$).pipe((0,Ht.U)(([fe,Ie])=>fe||Ie)).subscribe(fe=>{this.showAddTag=fe})}ngOnInit(){setTimeout(()=>this.input$.next(""))}createNewFromInput(){this.createNew.emit({name:this.input})}loadPrincipalData(o){var s,w;const S=new gn.qM;o&&S.add("any_name_attribute","~",[o]),S.add("status","!",[3]),S.add("type","=",[this.type]),S.add("member","!",[(null===(s=this.project)||void 0===s?void 0:s.id)||""]);const ne=this.apiV3Service.principals.filtered(S).get(),fe=new gn.qM;o&&fe.add("any_name_attribute","~",[o]),fe.add("status","!",[3]),fe.add("type","=",[this.type]),fe.add("member","=",[(null===(w=this.project)||void 0===w?void 0:w.id)||""]);const Ie=this.apiV3Service.principals.filtered(fe).get();return(0,Yl.D)({members:Ie,nonMembers:ne}).pipe((0,Ht.U)(({members:Ne,nonMembers:et})=>[...et.elements.map(Dt=>({principal:Dt,disabled:!1})),...Ne.elements.map(Dt=>({principal:Dt,disabled:!0}))].slice(0,5)),(0,Nr.d)(1))}}function td(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-ium-principal-search",19),e.NdJ("createNew",function(S){return e.CHM(s),e.oxw().createNewFromInput(S)}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("spotFormBinding",s.principalControl)("type",s.type)("project",s.project)}}function id(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"p",20),e.TgZ(1,"b"),e._uU(2),e.qZA(),e._uU(3),e.TgZ(4,"button",21),e.NdJ("click",function(){e.CHM(s);const S=e.oxw();return null==S.principalControl?null:S.principalControl.setValue(null)}),e._uU(5),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(2),e.Oqu(s.text.principal.inviteUser),e.xp6(1),e.hij(" ",s.principal.name," "),e.xp6(2),e.Oqu(s.text.principal.change)}}function nd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"p",20),e.TgZ(1,"b"),e._uU(2),e.qZA(),e._uU(3),e.TgZ(4,"button",21),e.NdJ("click",function(){e.CHM(s);const S=e.oxw();return null==S.principalControl?null:S.principalControl.setValue(null)}),e._uU(5),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(2),e.Oqu(s.text.principal.createNewPlaceholder),e.xp6(1),e.hij(" ",s.principal.name," "),e.xp6(2),e.Oqu(s.text.principal.change)}}function od(g,o){if(1&g&&(e.TgZ(0,"div",22),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.principal.required[s.type]," ")}}function sd(g,o){if(1&g&&e._UZ(0,"op-dynamic-form",23),2&g){const s=e.oxw();e.Q6J("dynamicFormGroup",s.dynamicFieldsControl)("settings",s.userDynamicFieldConfig)("formUrl",s.apiV3Service.users.form.path)("handleSubmit",!1)}}function rd(g,o){if(1&g&&(e.TgZ(0,"div",22),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.text.role.required," ")}}function ad(g,o){if(1&g&&(e.TgZ(0,"spot-form-field",24),e.TgZ(1,"textarea",25,26),e._uU(3,"      "),e.qZA(),e._UZ(4,"p",10),e.qZA()),2&g){const s=e.oxw();e.Q6J("label",s.text.message.label),e.xp6(1),e.Q6J("formControl",s.messageControl),e.xp6(3),e.Q6J("innerHtml",s.text.message.description(),e.oJD)}}ys.\u0275fac=function(o){return new(o||ys)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(j.T),e.Y36(So.S),e.Y36(wa.a))},ys.\u0275cmp=e.Xpm({type:ys,selectors:[["op-ium-principal-search"]],inputs:{spotFormBinding:"spotFormBinding",type:"type",project:"project"},outputs:{createNew:"createNew"},features:[e.qOj],decls:7,vars:10,consts:[["appendTo",".spot-modal-overlay","bindValue","principal",3,"formControl","addTag","typeahead","items","clearable","clearOnBackspace","clearSearchOnAdd","compareWith"],["ngselect",""],["ng-label-tmp",""],["ng-option-tmp",""],["ng-notfound-tmp",""],["ng-tag-tmp",""],["class","ng-option-label",4,"ngIf"],[1,"ng-option-label"],[3,"ngOptionHighlight"],["class","ellipsis",4,"ngIf"],[1,"ellipsis"],[1,"ng-option","disabled"],[4,"ngIf"],["icon-classes","icon-mail1 icon-context"],["icon-classes","icon-add icon-context"]],template:function(o,s){1&o&&(e.TgZ(0,"ng-select",0,1),e.ALo(2,"async"),e.YNc(3,Vl,1,1,"ng-template",2),e.YNc(4,Kl,1,1,"ng-template",3),e.YNc(5,Gl,2,1,"ng-template",4),e.YNc(6,ed,4,6,"ng-template",5),e.qZA()),2&o&&e.Q6J("formControl",s.spotFormBinding)("addTag",!!s.showAddTag&&s.createNewFromInput.bind(s))("typeahead",s.input$)("items",e.lcZ(2,8,s.items$))("clearable",!0)("clearOnBackspace",!1)("clearSearchOnAdd",!1)("compareWith",s.compareWith)},directives:[rn.w9,h.JJ,h.oH,rn.bb,rn.Z2,rn.vM,rn.N6,R.O5,ba.s,ut.o],pipes:[R.Ov],encapsulation:2});class Cs{constructor(o,s,w,S){this.I18n=o,this.httpClient=s,this.apiV3Service=w,this.cdRef=S,this.messageData="",this.close=new e.vpe,this.save=new e.vpe,this.back=new e.vpe,this.PrincipalType=ki.e,this.text={principal:{title:()=>this.I18n.t("js.invite_user_modal.title.invite"),label:{User:this.I18n.t("js.invite_user_modal.principal.label.name_or_email"),PlaceholderUser:this.I18n.t("js.invite_user_modal.principal.label.name"),Group:this.I18n.t("js.invite_user_modal.principal.label.name"),Email:this.I18n.t("js.label_email")},change:this.I18n.t("js.label_change"),inviteUser:this.I18n.t("js.invite_user_modal.principal.invite_user"),createNewPlaceholder:this.I18n.t("js.invite_user_modal.principal.create_new_placeholder"),required:{User:this.I18n.t("js.invite_user_modal.principal.required.user"),PlaceholderUser:this.I18n.t("js.invite_user_modal.principal.required.placeholder"),Group:this.I18n.t("js.invite_user_modal.principal.required.group")},backButton:this.I18n.t("js.invite_user_modal.back"),nextButton:this.I18n.t("js.invite_user_modal.principal.next_button"),cancelButton:this.I18n.t("js.button_cancel")},role:{label:()=>{var ne;return this.I18n.t("js.invite_user_modal.role.label",{project:null===(ne=this.project)||void 0===ne?void 0:ne.name})},description:()=>{var ne;return this.I18n.t("js.invite_user_modal.role.description",{principal:null===(ne=this.principal)||void 0===ne?void 0:ne.name})},required:this.I18n.t("js.invite_user_modal.role.required")},message:{label:this.I18n.t("js.invite_user_modal.message.label"),description:()=>{var ne;return this.I18n.t("js.invite_user_modal.message.description",{principal:null===(ne=this.principal)||void 0===ne?void 0:ne.name})}}},this.principalForm=new h.cw({principal:new h.NI(null,[h.kI.required]),userDynamicFields:new h.cw({}),role:new h.NI(null,[h.kI.required]),message:new h.NI("")}),this.userDynamicFieldConfig={payload:null,schema:null}}get messageControl(){return this.principalForm.get("message")}get roleControl(){return this.principalForm.get("role")}get principalControl(){return this.principalForm.get("principal")}get principal(){var o;return null===(o=this.principalControl)||void 0===o?void 0:o.value}get role(){var o;return null===(o=this.roleControl)||void 0===o?void 0:o.value}get message(){var o;return null===(o=this.messageControl)||void 0===o?void 0:o.value}get dynamicFieldsControl(){return this.principalForm.get("userDynamicFields")}get customFields(){var o;return null===(o=this.dynamicFieldsControl)||void 0===o?void 0:o.value}get hasPrincipalSelected(){return!!this.principal}get textLabel(){return this.type===ki.e.User&&this.isNewPrincipal?this.text.principal.label.Email:this.text.principal.label[this.type]}get isNewPrincipal(){return this.hasPrincipalSelected&&!(this.principal instanceof jo.X)}get isMemberOfCurrentProject(){var o,s,w,S;return!!(null===(S=null===(w=null===(s=null===(o=this.principalControl)||void 0===o?void 0:o.value)||void 0===s?void 0:s.memberships)||void 0===w?void 0:w.elements)||void 0===S?void 0:S.find(ne=>ne.project.id===this.project.id))}ngOnInit(){var o,s,w;if(null===(o=this.principalControl)||void 0===o||o.setValue(this.principalData.principal),null===(s=this.roleControl)||void 0===s||s.setValue(this.roleData),null===(w=this.messageControl)||void 0===w||w.setValue(this.messageData),this.type===ki.e.User){const S=this.isNewPrincipal?this.principalData.customFields:{};this.apiV3Service.users.form.post(S).pipe((0,va.take)(1),(0,Ht.U)(ne=>ne.$source)).subscribe(ne=>{var fe,Ie,g;this.userDynamicFieldConfig.schema=(g=null===(fe=ne._embedded)||void 0===fe?void 0:fe.schema,Object.keys(g).reduce((o,s)=>s.startsWith("customField")&&g[s].required?Object.assign(Object.assign({},o),{[s]:g[s]}):o,{})),this.userDynamicFieldConfig.payload=null===(Ie=ne._embedded)||void 0===Ie?void 0:Ie.payload,this.cdRef.detectChanges()})}}createNewFromInput(o){var s;null===(s=this.principalControl)||void 0===s||s.setValue(o)}onSubmit(o){o.preventDefault(),this.dynamicForm?this.dynamicForm.validateForm().subscribe(()=>{this.onValidatedSubmit()}):this.onValidatedSubmit()}onValidatedSubmit(){if(this.principalForm.invalid)return;const o=this.userDynamicFieldConfig.schema||{},s=Object.keys(o).reduce((w,S)=>{const ne=o[S];let fe=this.customFields[S];return"_links"===ne.location&&(fe=Array.isArray(fe)?fe.map(Ie=>Ie._links?Ie._links.self:Ie):fe._links?fe._links.self:fe),w=Object.assign(Object.assign({},w),{[S]:fe})},{});this.save.emit({principalData:{customFields:s,principal:this.principal},isAlreadyMember:this.isMemberOfCurrentProject,role:this.role,message:this.message})}}Cs.\u0275fac=function(o){return new(o||Cs)(e.Y36(y.D),e.Y36(p.eN),e.Y36(j.T),e.Y36(e.sBO))},Cs.\u0275cmp=e.Xpm({type:Cs,selectors:[["op-ium-principal"]],viewQuery:function(o,s){if(1&o&&e.Gf(ya.r,5),2&o){let w;e.iGM(w=e.CRH())&&(s.dynamicForm=w.first)}},inputs:{principalData:"principalData",project:"project",type:"type",roleData:"roleData",messageData:"messageData"},outputs:{close:"close",save:"save",back:"back"},decls:26,vars:16,consts:[[3,"formGroup","ngSubmit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],["required","",3,"label"],["slot","input",3,"spotFormBinding","type","project","createNew",4,"ngIf"],["slot","input",4,"ngIf"],["slot","errors","class","spot-form-field--error",4,"ngIf"],[3,"dynamicFormGroup","settings","formUrl","handleSubmit",4,"ngIf"],["slot","input",3,"spotFormBinding"],["slot","action",1,"spot-form-field--description",3,"innerHtml"],[3,"label",4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],["icon-classes","button--icon icon-arrow-left1"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action","spot-modal--cancel-button",3,"click"],[1,"button","button_no-margin","-highlight","spot-action-bar--action"],["slot","input",3,"spotFormBinding","type","project","createNew"],["slot","input"],["type","button",1,"spot-link",3,"click"],["slot","errors",1,"spot-form-field--error"],[3,"dynamicFormGroup","settings","formUrl","handleSubmit"],[3,"label"],["slot","input",1,"op-input","op-ium-invite-message-field",3,"formControl"],["input",""]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(S){return s.onSubmit(S)}),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"spot-form-field",4),e.YNc(6,td,1,3,"op-ium-principal-search",5),e.YNc(7,id,6,3,"p",6),e.YNc(8,nd,6,3,"p",6),e.YNc(9,od,2,1,"div",7),e.qZA(),e.YNc(10,sd,1,4,"op-dynamic-form",8),e.TgZ(11,"spot-form-field",4),e._UZ(12,"op-ium-role-search",9),e._UZ(13,"p",10),e.YNc(14,rd,2,1,"div",7),e.qZA(),e.YNc(15,ad,5,3,"spot-form-field",11),e.qZA(),e.TgZ(16,"div",12),e.TgZ(17,"div",13),e.TgZ(18,"button",14),e.NdJ("click",function(){return s.back.emit()}),e._UZ(19,"op-icon",15),e._uU(20),e.qZA(),e.qZA(),e.TgZ(21,"div",16),e.TgZ(22,"button",17),e.NdJ("click",function(){return s.close.emit()}),e._uU(23),e.qZA(),e.TgZ(24,"button",18),e._uU(25),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("formGroup",s.principalForm),e.xp6(2),e.Oqu(s.text.principal.title()),e.xp6(3),e.Q6J("label",s.textLabel),e.xp6(1),e.Q6J("ngIf",!(s.hasPrincipalSelected&&s.isNewPrincipal)),e.xp6(1),e.Q6J("ngIf",s.isNewPrincipal&&s.type===s.PrincipalType.User),e.xp6(1),e.Q6J("ngIf",s.isNewPrincipal&&s.type===s.PrincipalType.Placeholder),e.xp6(1),e.Q6J("ngIf",null==s.principalControl?null:s.principalControl.invalid),e.xp6(1),e.Q6J("ngIf",s.isNewPrincipal&&s.type===s.PrincipalType.User&&s.userDynamicFieldConfig.schema),e.xp6(1),e.Q6J("label",s.text.role.label()),e.xp6(1),e.Q6J("spotFormBinding",s.roleControl),e.xp6(1),e.Q6J("innerHtml",s.text.role.description(),e.oJD),e.xp6(1),e.Q6J("ngIf",null==s.roleControl?null:s.roleControl.invalid),e.xp6(1),e.Q6J("ngIf",s.type!==s.PrincipalType.Placeholder),e.xp6(5),e.hij(" ",s.text.principal.backButton," "),e.xp6(3),e.hij(" ",s.text.principal.cancelButton," "),e.xp6(2),e.Oqu(s.text.principal.nextButton))},directives:[h._Y,h.JL,h.sg,Ur.I,R.O5,vs,so,ut.o,ys,ya.r,h.Fj,h.JJ,h.oH],styles:[".op-ium-invite-message-field[_ngcontent-%COMP%]{height:8em}"],changeDetection:0});var ld=t(67202);function dd(g,o){if(1&g&&(e.TgZ(0,"spot-form-field",4),e.TgZ(1,"p",14),e._uU(2),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.Q6J("label",s.text.messageLabel),e.xp6(2),e.Oqu(s.message)}}class bs{constructor(o,s,w){this.I18n=o,this.elementRef=s,this.api=w,this.message="",this.close=new e.vpe,this.back=new e.vpe,this.save=new e.vpe,this.PrincipalType=ki.e,this.text={title:()=>this.I18n.t("js.invite_user_modal.title.invite"),projectLabel:this.I18n.t("js.invite_user_modal.project.label"),principalLabel:{User:this.I18n.t("js.invite_user_modal.principal.label.name_or_email"),PlaceholderUser:this.I18n.t("js.invite_user_modal.principal.label.name"),Group:this.I18n.t("js.invite_user_modal.principal.label.name")},roleLabel:()=>{var S;return this.I18n.t("js.invite_user_modal.role.label",{project:null===(S=this.project)||void 0===S?void 0:S.name})},messageLabel:this.I18n.t("js.invite_user_modal.message.label"),backButton:this.I18n.t("js.invite_user_modal.back"),cancelButton:this.I18n.t("js.button_cancel"),nextButton:()=>this.I18n.t("js.invite_user_modal.summary.next_button",{type:this.type,principal:this.principal})}}get principal(){return this.principalData.principal}invite(){return(0,mo.of)(this.principalData).pipe((0,je.w)(o=>this.createPrincipal(o)),(0,je.w)(o=>this.api.memberships.post({principal:o,project:this.project,roles:[this.role],notificationMessage:{raw:this.message}}).pipe((0,ld.h)(o))))}createPrincipal(o){const{principal:s,customFields:w}=o;if(s instanceof jo.X)return(0,mo.of)(s);switch(this.type){case ki.e.User:return this.api.users.post(Object.assign({email:s.name,status:"invited"},w));case ki.e.Placeholder:return this.api.placeholder_users.post({name:s.name});default:throw new Error("Unsupported PrincipalType given")}}onSubmit(o){o.preventDefault(),this.invite().subscribe(s=>this.save.emit({principal:s}))}}bs.\u0275fac=function(o){return new(o||bs)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(j.T))},bs.\u0275cmp=e.Xpm({type:bs,selectors:[["op-ium-summary"]],inputs:{type:"type",project:"project",role:"role",principalData:"principalData",message:"message"},outputs:{close:"close",back:"back",save:"save"},decls:25,vars:11,consts:[["name","sendUserInviteForm",1,"op-ium-summary",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container"],[3,"label"],["slot","input",1,"spot-body-small","op-ium-summary--details"],[3,"label",4,"ngIf"],[1,"spot-action-bar"],[1,"spot-action-bar--left"],["type","button",1,"button","button_no-margin","spot-action-bar--action",3,"click"],["icon-classes","button--icon icon-arrow-left1"],[1,"spot-action-bar--right"],["type","button",1,"button","button_no-margin","spot-action-bar--action","spot-modal--cancel-button",3,"click"],[1,"button","button_no-margin","-highlight","spot-action-bar--action"],["slot","input",1,"spot-body-small","op-ium-summary--message"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.NdJ("submit",function(S){return s.onSubmit(S)}),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"spot-form-field",4),e.TgZ(6,"p",5),e._uU(7),e.qZA(),e.qZA(),e.TgZ(8,"spot-form-field",4),e.TgZ(9,"p",5),e._uU(10),e.qZA(),e.qZA(),e.TgZ(11,"spot-form-field",4),e.TgZ(12,"p",5),e._uU(13),e.qZA(),e.qZA(),e.YNc(14,dd,3,2,"spot-form-field",6),e.qZA(),e.TgZ(15,"div",7),e.TgZ(16,"div",8),e.TgZ(17,"button",9),e.NdJ("click",function(){return s.back.emit()}),e._UZ(18,"op-icon",10),e._uU(19),e.qZA(),e.qZA(),e.TgZ(20,"div",11),e.TgZ(21,"button",12),e.NdJ("click",function(){return s.close.emit()}),e._uU(22),e.qZA(),e.TgZ(23,"button",13),e._uU(24),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title()),e.xp6(3),e.Q6J("label",s.text.projectLabel),e.xp6(2),e.Oqu(s.project.name),e.xp6(1),e.Q6J("label",s.text.principalLabel[s.type]),e.xp6(2),e.Oqu(null==s.principal?null:s.principal.name),e.xp6(1),e.Q6J("label",s.text.roleLabel()),e.xp6(2),e.Oqu(s.role.name),e.xp6(1),e.Q6J("ngIf",s.type!==s.PrincipalType.Placeholder&&s.message),e.xp6(5),e.hij(" ",s.text.backButton," "),e.xp6(3),e.Oqu(s.text.cancelButton),e.xp6(2),e.Oqu(s.text.nextButton()))},directives:[h._Y,h.JL,h.F,Ur.I,R.O5,ut.o],styles:[".op-ium-summary--message[_ngcontent-%COMP%]{white-space:pre-wrap}.op-ium-summary--details[_ngcontent-%COMP%]{margin-bottom:0}"],changeDetection:0});var Qr=t(97656);class ws{constructor(o,s){this.I18n=o,this.elementRef=s,this.close=new e.vpe,this.PrincipalType=ki.e,this.user_image=(0,Qr.h)("invite-user-modal/successful-invite.svg"),this.placeholder_image=(0,Qr.h)("invite-user-modal/placeholder-added.svg"),this.text={title:()=>this.I18n.t("js.invite_user_modal.success.title",{principal:this.createdNewPrincipal?this.principal.email:this.principal.name}),description:{User:()=>{var w;return this.I18n.t("js.invite_user_modal.success.description.user",{project:null===(w=this.project)||void 0===w?void 0:w.name})},PlaceholderUser:()=>{var w;return this.I18n.t("js.invite_user_modal.success.description.placeholder",{project:null===(w=this.project)||void 0===w?void 0:w.name})},Group:()=>{var w;return this.I18n.t("js.invite_user_modal.success.description.group",{project:null===(w=this.project)||void 0===w?void 0:w.name})}},nextButton:this.I18n.t("js.invite_user_modal.success.next_button")}}}ws.\u0275fac=function(o){return new(o||ws)(e.Y36(y.D),e.Y36(e.SBq))},ws.\u0275cmp=e.Xpm({type:ws,selectors:[["op-ium-success"]],inputs:{principal:"principal",project:"project",type:"type",createdNewPrincipal:"createdNewPrincipal"},outputs:{close:"close"},decls:8,vars:4,consts:[[1,"op-ium-success"],[1,"spot-modal--body","spot-container","op-ium-success--content"],[3,"src"],[3,"textContent"],["type","button",1,"button","-highlight",3,"click"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"img",2),e._UZ(3,"h1",3),e._UZ(4,"p",3),e.TgZ(5,"p"),e.TgZ(6,"button",4),e.NdJ("click",function(){return s.close.emit()}),e._uU(7),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Q6J("src",s.type===s.PrincipalType.Placeholder?s.placeholder_image:s.user_image,e.LSH),e.xp6(1),e.Q6J("textContent",s.text.title()),e.xp6(1),e.Q6J("textContent",s.text.description[s.type]()),e.xp6(3),e.Oqu(s.text.nextButton))},styles:[".op-ium-success[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.op-ium-success--content[_ngcontent-%COMP%]{justify-content:center;align-items:center;text-align:center}"]});var Jr=t(55901);class Ro{}Ro.\u0275fac=function(o){return new(o||Ro)},Ro.\u0275mod=e.oAB({type:Ro}),Ro.\u0275inj=e.cJS({providers:[Sl.j,{provide:e.ip1,useFactory:function(g){return function(){g.get(Do).setupListener()}},deps:[e.zs3],multi:!0}],imports:[[R.ez,l.H,u.K,rn.A0,h.UX,Ol.Ky,Il.r,fa.Y,Ml.H],fa.Y]}),e.B6R(ki.E,[R.O5,fs,Jr.mK,Cs,bs,ws],[]);class ro{constructor(o,s){this.injector=o,this.i18n=s,window.navigator.userAgent.search("Revit")>-1&&(this.labelText=s.t("js.revit.revit_add_in_settings"),this.groupLabelText=s.t("js.revit.revit_add_in"),this.addUserMenuItem(),this.addLoginMenuItem())}addUserMenuItem(){const o=document.getElementById("user-menu");if(o){const s=document.createElement("li");s.dataset.name=this.labelText,s.innerHTML=`\n        <a class="revit-addin-settings-menu-item ellipsis" title="${this.labelText}" href="#">\n          <span class="menu-item--title ellipsis ">${this.labelText}</span>\n        </a>\n      `,s.addEventListener("click",()=>this.goToSettings()),o.appendChild(s)}}addLoginMenuItem(){const o=document.querySelector("#nav-login-content");if(o){const s=document.createElement("div");s.dataset.name=this.labelText,s.innerHTML=`\n        <div class="login-auth-providers">\n          <h3 class="login-auth-providers-title">\n            <span>\n              ${this.groupLabelText}\n            </span>\n           </h3>\n          <div class="login-auth-provider-list revit-add-in-button">\n            <div class="auth-provider auth-provider-developer button">\n              <span class="auth-provider-name">${this.labelText}</span>\n            </div>\n          </div>\n        </div>\n      `,o.appendChild(s),o.querySelector(".revit-add-in-button").addEventListener("click",()=>this.goToSettings())}}goToSettings(){window.RevitBridge.sendMessageToRevit("GoToSettings","1","")}}ro.\u0275fac=function(o){return new(o||ro)(e.LFG(e.zs3),e.LFG(y.D))},ro.\u0275prov=e.Yz7({token:ro,factory:ro.\u0275fac});var Yr=t(76825),Ta=t(49685);class Fo{}Fo.\u0275fac=function(o){return new(o||Fo)},Fo.\u0275mod=e.oAB({type:Fo}),Fo.\u0275inj=e.cJS({providers:[Ta.V],imports:[[l.H,u.K,h.u5,h.UX]]});class Wn{constructor(){this.navigationEvents$=new Z.X("")}onActivate(...o){return this.navigationEvents$.pipe((0,hi.h)(s=>-1!==o.indexOf(s)),(0,Rn.q)(1))}recreateToggler(){const o=this;jQuery("#main-menu .toggler").remove();const s=jQuery('<a class="toggler" href="#"><i class="icon6 icon-toggler icon-arrow-right3" aria-hidden="true"></i><span class="hidden-for-sighted"></span></a>').on("click",function(){const w=jQuery(this);if(w.hasClass("toggler")){jQuery("#sidebar").toggleClass("-hidden",!0),jQuery(".menu_root li").removeClass("open"),jQuery(".menu_root").removeClass("open").addClass("closed");const S=w.closest("li");S.addClass("open").find("li > a:first, .tree-menu--title:first").first().focus(),o.navigationEvents$.next(S.data("name"))}return!1});return s.attr("title",I18n.t("js.project_menu_details")),s}wrapMainItem(){const o=jQuery("#main-menu li > a").not("ul ul a");o.wrap(s=>{const S=o[s].id,ne=jQuery('<div class="main-item-wrapper"/>');return S&&ne.attr("id",`${S}-wrapper`),ne})}register(){this.wrapMainItem();const o=document.querySelector(".tree-menu--item.-selected")||document.querySelector(".main-item-wrapper a.selected");null==o||o.scrollIntoView();const s=this.recreateToggler(),w=jQuery("#main-menu .menu_root > li.open").data("name"),S=jQuery("#main-menu .menu_root.open > li").data("name");function ne(fe){fe.preventDefault();const Ie=jQuery(this);jQuery(Ie).parents("li").first().removeClass("open"),jQuery(".menu_root").removeClass("closed").addClass("open"),Ie.parents("li").first().find(".toggler").first().focus(),jQuery("#sidebar").toggleClass("-hidden",!1)}(w||S)&&this.navigationEvents$.next(w||S),jQuery("#main-menu li:has(ul) .main-item-wrapper > a").not("ul ul a").unbind("click").wrapInner('<span class="ellipsis"/>').after(s),jQuery("#main-menu ul.main-menu--children").each((fe,Ie)=>{const Ne=jQuery(Ie).parents("li").find(".main-item-wrapper .op-menu--item-title").contents()[0].textContent,et=jQuery(Ie).parents("li").find(".main-item-wrapper > a").attr("href"),Dt=jQuery('<div class="main-menu--children-menu-header"></div>'),Zt=jQuery('<a class="main-menu--arrow-left-to-project" href="#"><i class="icon-arrow-left1" aria-hidden="true"></i></a>'),Ci=jQuery(`<a href="${et}" class="main-menu--parent-node ellipsis">${Ne}</a>`);Zt.attr("title",I18n.t("js.label_up")),Zt.on("click",ne),Dt.append(Zt),Dt.append(Ci),jQuery(Ie).before(Dt)}),jQuery(".menu_root").hasClass("closed")&&jQuery("#sidebar").toggleClass("-hidden",!0)}}Wn.\u0275fac=function(o){return new(o||Wn)},Wn.\u0275prov=e.Yz7({token:Wn,factory:Wn.\u0275fac,providedIn:"root"});var ud=t(68853),hd=t(82267),br=t(82503);class Ln extends Co.j{constructor(o,s,w){super(o),this.documentElement=o,this.confirmDialog=s,this.I18n=w}showEEOnlyHint(){this.confirmDialog.confirm({text:{title:this.I18n.t("js.types.attribute_groups.upgrade_to_ee"),text:this.I18n.t("js.types.attribute_groups.upgrade_to_ee_text"),button_continue:this.I18n.t("js.types.attribute_groups.more_information"),button_cancel:this.I18n.t("js.types.attribute_groups.nevermind")}}).then(()=>{window.location.href="https://www.openproject.org/enterprise-edition/?utm_source=unknown&utm_medium=community-edition&utm_campaign=form-configuration"}).catch(()=>{})}}function _d(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",2),e.NdJ("click",function(){return e.CHM(s),e.oxw().startEditing()}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("textContent",s.name)}}function md(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"input",3,4),e.NdJ("ngModelChange",function(S){e.CHM(s);return e.oxw().editedName=S})("blur",function(S){return e.CHM(s),e.oxw().saveEdition(S)})("keydown.escape",function(){return e.CHM(s),e.oxw().reset()})("keydown.enter",function(S){return e.CHM(s),e.oxw().saveEdition(S)}),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("ngModel",s.editedName),e.uIk("placeholder",s.placeholder)}}Ln.\u0275fac=function(o){return new(o||Ln)(e.LFG(R.K0),e.LFG($e.D),e.LFG(y.D))},Ln.\u0275prov=e.Yz7({token:Ln,factory:Ln.\u0275fac});class Zo{constructor(o,s){this.bannerService=o,this.cdRef=s,this.placeholder="",this.onValueChange=new e.vpe,this.editing=!1}ngOnInit(){this.editedName=this.name,(!this.name||0===this.name.length)&&this.startEditing()}startEditing(){this.bannerService.conditional(()=>this.bannerService.showEEOnlyHint(),()=>{this.editing=!0})}saveEdition(o){return this.leaveEditingMode(),this.name=this.editedName.trim(),this.cdRef.detectChanges(),""!==this.name&&this.onValueChange.emit(this.name),o.preventDefault(),o.stopPropagation(),!1}reset(){this.editing=!1,this.editedName=this.name}leaveEditingMode(){null!=this.editedName&&this.editedName.trim().length>0&&(this.editing=!1)}}function gd(g,o){if(1&g&&e._UZ(0,"span",12),2&g){const s=e.oxw(2);e.Q6J("textContent",s.text.custom_field)}}function fd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",7),e._UZ(1,"span",8),e.TgZ(2,"span",9),e._uU(3),e.YNc(4,gd,1,1,"span",10),e.qZA(),e.TgZ(5,"span",11),e.NdJ("click",function(){const ne=e.CHM(s).$implicit;return e.oxw().removeFromGroup(ne)}),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit;e.uIk("data-key",s.key),e.xp6(3),e.hij(" ",s.translation," "),e.xp6(1),e.Q6J("ngIf",s.is_cf)}}Zo.\u0275fac=function(o){return new(o||Zo)(e.Y36(Ln),e.Y36(e.sBO))},Zo.\u0275cmp=e.Xpm({type:Zo,selectors:[["op-group-edit-in-place"]],inputs:{placeholder:"placeholder",name:"name"},outputs:{onValueChange:"onValueChange"},decls:2,vars:2,consts:[["class","group-edit-handler",3,"textContent","click",4,"ngIf"],["class","group-edit-in-place--input","type","text","opAutofocus","",3,"ngModel","ngModelChange","blur","keydown.escape","keydown.enter",4,"ngIf"],[1,"group-edit-handler",3,"textContent","click"],["type","text","opAutofocus","",1,"group-edit-in-place--input",3,"ngModel","ngModelChange","blur","keydown.escape","keydown.enter"],["nameInput",""]],template:function(o,s){1&o&&(e.YNc(0,_d,1,1,"div",0),e.YNc(1,md,2,2,"input",1)),2&o&&(e.Q6J("ngIf",!s.editing),e.xp6(1),e.Q6J("ngIf",s.editing))},directives:[R.O5,h.Fj,pa.U,h.JJ,h.On],encapsulation:2,changeDetection:0});class Ts{constructor(o,s){this.I18n=o,this.cdRef=s,this.deleteGroup=new e.vpe,this.removeAttribute=new e.vpe,this.text={custom_field:this.I18n.t("js.admin.type_form.custom_field")}}rename(o){this.group.name=o,delete this.group.key,this.cdRef.detectChanges()}removeFromGroup(o){this.group.attributes=this.group.attributes.filter(s=>s!==o),this.removeAttribute.emit(o)}}Ts.\u0275fac=function(o){return new(o||Ts)(e.Y36(y.D),e.Y36(e.sBO))},Ts.\u0275cmp=e.Xpm({type:Ts,selectors:[["op-type-form-attribute-group"]],inputs:{group:"group"},outputs:{deleteGroup:"deleteGroup",removeAttribute:"removeAttribute"},decls:7,vars:3,consts:[[1,"type-form-conf-group"],[1,"group-head"],[1,"group-handle","icon-drag-handle"],[1,"group-name",3,"name","onValueChange"],[1,"delete-group","icon-small","icon-close",3,"click"],["dragula","attributes",1,"attributes",3,"dragulaModel","dragulaModelChange"],["class","type-form-conf-attribute",4,"ngFor","ngForOf"],[1,"type-form-conf-attribute"],[1,"attribute-handle","icon-drag-handle"],[1,"attribute-name"],["class","attribute-cf-label",3,"textContent",4,"ngIf"],[1,"delete-attribute","icon-small","icon-close",3,"click"],[1,"attribute-cf-label",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"span",2),e.TgZ(3,"op-group-edit-in-place",3),e.NdJ("onValueChange",function(S){return s.rename(S)}),e.qZA(),e.TgZ(4,"span",4),e.NdJ("click",function(){return s.deleteGroup.emit()}),e.qZA(),e.qZA(),e.TgZ(5,"div",5),e.NdJ("dragulaModelChange",function(S){return s.group.attributes=S}),e.YNc(6,fd,6,3,"div",6),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("name",s.group.name),e.xp6(2),e.Q6J("dragulaModel",s.group.attributes),e.xp6(1),e.Q6J("ngForOf",s.group.attributes))},directives:[Zo,br.sW,R.sg,R.O5],encapsulation:2,changeDetection:0});var ka=t(74961),Pa=t(35900),$r=t(84032),vd=t(87286);class ao{constructor(o){this.document=o,this.hover=!1,this.menuIsOpen=!1,this.menuContainer=this.document.querySelector(".op-app-header"),this.active$=new Z.X(null)}register(){this.setupDropdownClick(),this.closeOnBodyClick(),this.accessibility(),this.skipContentClickListener()}activeDropdown$(){return this.active$.asObservable()}close(){this.stopHover(),this.closeAllItems(),this.menuIsOpen=!1,this.active$.next(null)}skipContentClickListener(){this.document.querySelector("#skip-navigation--content").addEventListener("click",()=>{const w=jQuery(".first-breadcrumb-element a, .toolbar-container a:first-of-type, #content a:first-of-type").not(":hidden").first();w.length&&w.trigger("focus")})}accessibility(){this.document.querySelectorAll(".op-app-menu--dropdown").forEach(o=>o.setAttribute("aria-expanded","false"))}toggleClick(o){this.menuIsOpen?this.isOpen(o)?this.close():this.openDropdown(o):(this.opening(),this.openDropdown(o))}opening(){this.startHover(),this.menuIsOpen=!0}stopHover(){this.hover=!1,this.menuContainer.classList.remove("hover")}startHover(){this.hover=!0,this.menuContainer.classList.add("hover")}closeAllItems(){this.openDropdowns().forEach(o=>this.closeDropdown(o))}closeOnBodyClick(){const o=document.getElementById("wrapper");!o||o.addEventListener("click",s=>{this.menuIsOpen&&!this.openDropdowns()[0].contains(s.target)&&this.close()},!0)}openDropdowns(){return this.menuContainer.querySelectorAll(".op-app-menu--item_dropdown-open")}dropdowns(){return this.menuContainer.querySelectorAll(".op-app-menu--item_has-dropdown")}setupDropdownClick(){this.dropdowns().forEach(o=>{const s=o.querySelector(".op-app-menu--item-action");null==s||s.addEventListener("click",w=>{this.toggleClick(o),w.preventDefault()})})}isOpen(o){return o.classList.contains(".op-app-menu--item_dropdown-open")}isClosed(o){return!this.isOpen(o)}openDropdown(o){this.closeOtherItems(o),this.slideAndFocus(o,()=>{this.active$.next(o)})}closeDropdown(o,s){this.slideUp(o,!!s),this.active$.next(null)}closeOtherItems(o){this.openDropdowns().forEach(s=>{s!==o&&this.closeDropdown(s,!0)})}slideAndFocus(o,s){this.slideDown(o,s),setTimeout(()=>this.focusFirstInputOrLink(o),100)}slideDown(o,s){const w=this.getDropdownContainer(o);w.setAttribute("aria-expanded","true"),o.classList.add("op-app-menu--item_dropdown-open"),jQuery(w).slideDown(100,s).attr("aria-expanded","true")}slideUp(o,s){const w=this.getDropdownContainer(o);w.removeAttribute("aria-expanded"),o.classList.remove("op-app-menu--item_dropdown-open"),s?w.style.display="none":jQuery(w).slideUp(100)}focusFirstInputOrLink(o){const s=this.getDropdownContainer(o),S=(0,vd.p)(s)[0];!S||(S.blur(),setTimeout(()=>{S.focus()},10))}getDropdownContainer(o){return o.querySelector(".op-app-menu--dropdown")}}function xa(g){const o=jQuery(g.data.menu);g.target!==o.find(" > li.drop-down.open > ul").get(0)&&(o.find(" > li.drop-down.open").removeClass("open").find("> ul").slideUp(100),jQuery("html").off("click",xa))}function Ea(g){g.find(" > li.drop-down").on("click",o=>{!function(g){const o=g.find(" > li.drop-down");o.hasClass("open")||(o.find("> ul").slideDown(100,()=>{o.find("li > a:first").focus(),jQuery("html").on("click",{menu:g.get(0)},xa)}),o.addClass("open"))}(g);const s=jQuery(o.target);(s.is(".drop-down")||s.closest("li, ul").is(".drop-down"))&&o.preventDefault()})}function Cd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li",18),e.TgZ(1,"a",19),e._UZ(2,"op-icon",20),e._UZ(3,"span",6),e._UZ(4,"op-icon",21),e.qZA(),e.TgZ(5,"ul",22),e.TgZ(6,"li"),e.TgZ(7,"button",23),e.NdJ("click",function(){return e.CHM(s),e.oxw().createGroup("attribute","")}),e.qZA(),e.qZA(),e.TgZ(8,"li"),e.TgZ(9,"button",23),e.NdJ("click",function(){return e.CHM(s),e.oxw().addGroupAndOpenQuery()}),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(3),e.Q6J("textContent",s.text.label_group),e.xp6(4),e.Q6J("textContent",s.text.add_group),e.xp6(2),e.Q6J("textContent",s.text.add_table)}}function bd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-type-form-attribute-group",26),e.NdJ("removeAttribute",function(S){return e.CHM(s),e.oxw(2).deactivateAttribute(S)})("deleteGroup",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw().deleteGroup(S)}),e.qZA()}if(2&g){const s=e.oxw().$implicit;e.Q6J("group",s)}}function wd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-type-form-query-group",27),e.NdJ("editQuery",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw().editQuery(S)})("deleteGroup",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw().deleteGroup(S)}),e.qZA()}if(2&g){const s=e.oxw().$implicit;e.Q6J("group",s)}}function Td(g,o){if(1&g&&(e.ynx(0),e.YNc(1,bd,1,1,"op-type-form-attribute-group",24),e.YNc(2,wd,1,1,"op-type-form-query-group",25),e.BQk()),2&g){const s=o.$implicit;e.xp6(1),e.Q6J("ngIf","attribute"===s.type),e.xp6(1),e.Q6J("ngIf","query"===s.type)}}function kd(g,o){if(1&g&&e._UZ(0,"span",32),2&g){const s=e.oxw(2);e.Q6J("textContent",s.text.custom_field)}}function Pd(g,o){if(1&g&&(e.TgZ(0,"div",28),e._UZ(1,"span",29),e.TgZ(2,"span",30),e._uU(3),e.YNc(4,kd,1,1,"span",31),e.qZA(),e.qZA()),2&g){const s=o.$implicit;e.uIk("data-key",s.key),e.xp6(3),e.hij(" ",s.translation," "),e.xp6(1),e.Q6J("ngIf",s.is_cf)}}ao.\u0275fac=function(o){return new(o||ao)(e.LFG(R.K0))},ao.\u0275prov=e.Yz7({token:ao,factory:ao.\u0275fac,providedIn:"root"});const Oa="__empty";class Wo extends yi.N{constructor(o,s,w,S,ne,fe,Ie,Ne){super(),this.elementRef=o,this.I18n=s,this.Gon=w,this.dragula=S,this.confirmDialog=ne,this.toastService=fe,this.externalRelationQuery=Ie,this.typeBanner=Ne,this.text={drag_to_activate:this.I18n.t("js.admin.type_form.drag_to_activate"),reset:this.I18n.t("js.admin.type_form.reset_to_defaults"),label_group:this.I18n.t("js.label_group"),new_group:this.I18n.t("js.admin.type_form.new_group"),label_inactive:this.I18n.t("js.admin.type_form.inactive"),custom_field:this.I18n.t("js.admin.type_form.custom_field"),add_group:this.I18n.t("js.admin.type_form.add_group"),add_table:this.I18n.t("js.admin.type_form.add_table")},this.groups=[],this.inactives=[]}ngOnInit(){this.element=this.elementRef.nativeElement,this.no_filter_query=this.element.dataset.noFilterQuery,this.form=jQuery(this.element).closest("form"),this.submit=this.form.find(".form-configuration--save");let o=!1;this.form.on("submit",()=>{o=!0}),this.submit.on("mousedown",()=>(setTimeout(()=>{o||this.form.trigger("submit")},50),!0)),this.form.on("submit.typeformupdater",()=>(this.updateHiddenFields(),!0)),this.groupsDrake=this.dragula.createGroup("groups",{moves:(w,S,ne)=>ne.classList.contains("group-handle")}).drake,this.attributeDrake=this.dragula.createGroup("attributes",{moves:(w,S,ne)=>ne.classList.contains("attribute-handle")}).drake,this.groups=JSON.parse(this.element.dataset.activeGroups).filter(w=>(null==w?void 0:w.key)!==Oa),this.inactives=JSON.parse(this.element.dataset.inactiveAttributes);const s=this;this.autoscroll=new Pa.x([document.getElementById("content-wrapper")],{margin:25,maxSpeed:10,scrollWhenOutside:!0,autoScroll(){const w=s.groupsDrake&&s.groupsDrake.dragging,S=s.attributeDrake&&s.attributeDrake.dragging;return w||S}})}ngAfterViewInit(){Ea(jQuery(this.elementRef.nativeElement).find(".toolbar-items"))}deactivateAttribute(o){this.updateInactives(this.inactives.concat(o))}addGroupAndOpenQuery(){const o=this.createGroup("query");this.editQuery(o)}editQuery(o){this.typeBanner.conditional(()=>this.typeBanner.showEEOnlyHint(),()=>{const s={"display-settings":I18n.t("js.work_packages.table_configuration.embedded_tab_disabled"),timelines:I18n.t("js.work_packages.table_configuration.embedded_tab_disabled")};this.externalRelationQuery.show({currentQuery:JSON.parse(o.query),callback:w=>o.query=JSON.stringify(w),disabledTabs:s})})}deleteGroup(o){this.typeBanner.conditional(()=>this.typeBanner.showEEOnlyHint(),()=>("attribute"===o.type&&this.updateInactives(this.inactives.concat(o.attributes)),this.groups=this.groups.filter(s=>s!==o),o))}createGroup(o,s=""){const w={type:o,name:s,key:null,query:this.no_filter_query,attributes:[]};return this.groups.unshift(w),w}resetToDefault(o){return this.confirmDialog.confirm({text:{title:this.I18n.t("js.types.attribute_groups.reset_title"),text:this.I18n.t("js.types.attribute_groups.confirm_reset"),button_continue:this.I18n.t("js.label_reset")}}).then(()=>{this.form.find("input#type_attribute_groups").val(JSON.stringify([])),this.form.off("submit.typeformupdater"),this.form.trigger("submit")}).catch(()=>{}),o.preventDefault(),!1}updateInactives(o){this.inactives=[...o].sort((s,w)=>s.translation.localeCompare(w.translation))}get emptyGroup(){return{type:"attribute",key:Oa,name:"empty",attributes:[]}}updateHiddenFields(){const o=this.form.find(".admin-type-form--hidden-field");0===this.groups.length?o.val(JSON.stringify([this.emptyGroup])):o.val(JSON.stringify(this.groups))}}Wo.\u0275fac=function(o){return new(o||Wo)(e.Y36(e.SBq),e.Y36(y.D),e.Y36($r.U),e.Y36(br.pQ),e.Y36($e.D),e.Y36(I.kl),e.Y36(ka.Q),e.Y36(Ln))},Wo.\u0275cmp=e.Xpm({type:Wo,selectors:[["admin-type-form-configuration"]],features:[e._Bn([Ln]),e.qOj],decls:20,vars:8,consts:[[1,"toolbar-container","-with-dropdown"],[1,"toolbar","toolbar_empty-title"],[1,"toolbar-items"],[1,"toolbar-item"],["type","button -alt-highlight",1,"form-configuration--reset","button",3,"click"],["icon-classes","button--icon icon-undo"],[1,"button--text",3,"textContent"],["class","toolbar-item drop-down",4,"ngIf"],[1,"grid-block","wrap"],[1,"grid-content","small-12","medium-6"],["id","draggable-groups","dragula","groups",3,"dragulaModel","dragulaModelChange"],[4,"ngFor","ngForOf"],["id","type-form-conf-inactive-group"],[1,"group-head"],[1,"group-name",3,"textContent"],[1,"advice",3,"textContent"],["dragula","attributes",1,"attributes",3,"dragulaModel","dragulaModelChange"],["class","type-form-conf-attribute",4,"ngFor","ngForOf"],[1,"toolbar-item","drop-down"],["aria-haspopup","true",1,"form-configuration--add-group","button","-alt-highlight"],["icon-classes","button--icon icon-add"],["icon-classes","button--dropdown-indicator"],[1,"menu-drop-down-container"],["type","button",1,"menu-item","form-configuration--add-group",3,"textContent","click"],[3,"group","removeAttribute","deleteGroup",4,"ngIf"],[3,"group","editQuery","deleteGroup",4,"ngIf"],[3,"group","removeAttribute","deleteGroup"],[3,"group","editQuery","deleteGroup"],[1,"type-form-conf-attribute"],[1,"attribute-handle","icon-drag-handle"],[1,"attribute-name"],["class","attribute-cf-label",3,"textContent",4,"ngIf"],[1,"attribute-cf-label",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"ul",2),e.TgZ(3,"li",3),e.TgZ(4,"button",4),e.NdJ("click",function(S){return s.resetToDefault(S)}),e._UZ(5,"op-icon",5),e._UZ(6,"span",6),e.qZA(),e.qZA(),e.YNc(7,Cd,10,3,"li",7),e.qZA(),e.qZA(),e.qZA(),e.TgZ(8,"div",8),e.TgZ(9,"div",9),e.TgZ(10,"div",10),e.NdJ("dragulaModelChange",function(S){return s.groups=S}),e.YNc(11,Td,3,2,"ng-container",11),e.qZA(),e.qZA(),e.TgZ(12,"div",9),e.TgZ(13,"div",12),e.TgZ(14,"div",13),e._UZ(15,"span",14),e._uU(16," "),e._UZ(17,"span",15),e.qZA(),e.TgZ(18,"div",16),e.NdJ("dragulaModelChange",function(S){return s.inactives=S}),e.YNc(19,Pd,5,3,"div",17),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(6),e.Q6J("textContent",s.text.reset),e.xp6(1),e.Q6J("ngIf",!s.typeBanner.eeShowBanners),e.xp6(3),e.Q6J("dragulaModel",s.groups),e.xp6(1),e.Q6J("ngForOf",s.groups),e.xp6(4),e.Q6J("textContent",s.text.label_inactive),e.xp6(2),e.Q6J("textContent",s.text.drag_to_activate),e.xp6(1),e.Q6J("dragulaModel",s.inactives),e.xp6(1),e.Q6J("ngForOf",s.inactives))},encapsulation:2});class Ps{constructor(o,s){this.I18n=o,this.cdRef=s,this.text={edit_query:this.I18n.t("js.admin.type_form.edit_query")},this.editQuery=new e.vpe,this.deleteGroup=new e.vpe}rename(o){this.group.name=o,this.cdRef.detectChanges()}}Ps.\u0275fac=function(o){return new(o||Ps)(e.Y36(y.D),e.Y36(e.sBO))},Ps.\u0275cmp=e.Xpm({type:Ps,selectors:[["op-type-form-query-group"]],inputs:{group:"group"},outputs:{editQuery:"editQuery",deleteGroup:"deleteGroup"},decls:9,vars:2,consts:[[1,"type-form-conf-group","type-form-query-group"],[1,"group-head"],[1,"group-handle","icon-drag-handle"],[1,"group-name",3,"name","onValueChange"],[1,"delete-group","icon-small","icon-close",3,"click"],[1,"type-form-query"],[1,"type-form-query-group--edit-button",3,"click"],["icon-classes","button--icon icon-edit"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"span",2),e.TgZ(3,"op-group-edit-in-place",3),e.NdJ("onValueChange",function(S){return s.rename(S)}),e.qZA(),e.TgZ(4,"span",4),e.NdJ("click",function(){return s.deleteGroup.emit()}),e.qZA(),e.qZA(),e.TgZ(5,"div",5),e.TgZ(6,"span",6),e.NdJ("click",function(){return s.editQuery.emit()}),e._UZ(7,"op-icon",7),e._uU(8),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("name",s.group.name),e.xp6(5),e.hij(" ",s.text.edit_query," "))},directives:[Zo,ut.o],encapsulation:2,changeDetection:0});class Lo{}Lo.\u0275fac=function(o){return new(o||Lo)},Lo.\u0275mod=e.oAB({type:Lo}),Lo.\u0275inj=e.cJS({providers:[],imports:[[br.qE.forRoot(),l.H]]}),e.B6R(Wo,[ut.o,R.O5,br.sW,R.sg,Ts,Ps],[]);var Ed=t(6496),wr=t(45410);class xs{constructor(o){this.elementRef=o,this.initialLoadingIndicator=!0,(0,wr.E)(this)}}xs.\u0275fac=function(o){return new(o||xs)(e.Y36(e.SBq))},xs.\u0275cmp=e.Xpm({type:xs,selectors:[["wp-embedded-table-entry"]],inputs:{queryProps:"queryProps",configuration:"configuration",initialLoadingIndicator:"initialLoadingIndicator"},decls:2,vars:3,consts:[["wp-isolated-query-space",""],[3,"queryProps","initialLoadingIndicator","configuration"]],template:function(o,s){1&o&&(e.ynx(0,0),e._UZ(1,"wp-embedded-table",1),e.BQk()),2&o&&(e.xp6(1),e.Q6J("queryProps",s.queryProps)("initialLoadingIndicator",s.initialLoadingIndicator)("configuration",s.configuration))},directives:[Ye.A,ci.Z],encapsulation:2});class Es{constructor(o){this.elementRef=o,this.configuration={actionsColumnEnabled:!1,columnMenuEnabled:!1,contextMenuEnabled:!1}}ngOnInit(){const o=this.elementRef.nativeElement;this.queryProps=JSON.parse(o.dataset.queryProps)}}Es.\u0275fac=function(o){return new(o||Es)(e.Y36(e.SBq))},Es.\u0275cmp=e.Xpm({type:Es,selectors:[["macro",8,"embedded-table"]],attrs:["class","embedded-table"],decls:1,vars:2,consts:[[3,"queryProps","configuration"]],template:function(o,s){1&o&&e._UZ(0,"wp-embedded-table-entry",0),2&o&&e.Q6J("queryProps",s.queryProps)("configuration",s.configuration)},directives:[xs],encapsulation:2});var Ma=t(87064),Vr=t(90127);function Id(g,o){if(1&g&&e._UZ(0,"wp-embedded-table",1),2&g){const s=e.oxw();e.Q6J("queryProps",s.queryProps)("configuration",s.tableConfiguration)}}class Uo extends yi.N{constructor(o,s,w,S,ne,fe,Ie,Ne,et,Dt,Zt){super(),this.FocusHelper=o,this.elementRef=s,this.renderer=w,this.I18n=S,this.halResourceService=ne,this.globalSearchService=fe,this.wpTableFilters=Ie,this.querySpace=Ne,this.wpFilters=et,this.cdRef=Dt,this.UrlParamsHelper=Zt,this.resultsHidden=!1,this.tableConfiguration={actionsColumnEnabled:!1,columnMenuEnabled:!0,contextMenuEnabled:!1,inlineCreateEnabled:!1,withFilters:!0,showFilterButton:!0,filterButtonText:this.I18n.t("js.button_advanced_filter")}}ngAfterViewInit(){(0,Ni.aj)([this.globalSearchService.searchTerm$,this.globalSearchService.projectScope$]).pipe((0,ai.T)(1),(0,to.x)(),(0,Cr.b)(10),this.untilDestroyed()).subscribe(([])=>{this.wpFilters.visible=!1,this.setQueryProps()}),this.globalSearchService.resultsHidden$.pipe(this.untilDestroyed()).subscribe(o=>this.resultsHidden=o)}ngOnInit(){this.setQueryProps()}setQueryProps(){const o=[];let s=["id","project","subject","type","status","updatedAt"];this.globalSearchService.searchTerm.length>0&&o.push({search:{operator:"**",values:[this.globalSearchService.searchTerm]}}),"current_project"===this.globalSearchService.projectScope&&(o.push({subprojectId:{operator:"!*",values:[]}}),s=["id","subject","type","status","updatedAt"]),""===this.globalSearchService.projectScope&&o.push({subprojectId:{operator:"*",values:[]}}),this.queryProps={"columns[]":s,filters:JSON.stringify(o),sortBy:JSON.stringify([["updatedAt","desc"]]),showHierarchies:!1}}}Uo.\u0275fac=function(o){return new(o||Uo)(e.Y36(ga.i),e.Y36(e.SBq),e.Y36(e.Qsj),e.Y36(y.D),e.Y36(Ot.u),e.Y36(sn),e.Y36(Ii.Z),e.Y36(mi.q),e.Y36(Ji.U),e.Y36(e.sBO),e.Y36(vt.Z))},Uo.\u0275cmp=e.Xpm({type:Uo,selectors:[["global-search-work-packages"]],features:[e.qOj],decls:1,vars:1,consts:[[3,"queryProps","configuration",4,"ngIf"],[3,"queryProps","configuration"]],template:function(o,s){1&o&&e.YNc(0,Id,1,2,"wp-embedded-table",0),2&o&&e.Q6J("ngIf",!s.resultsHidden)},directives:[R.O5,ci.Z],encapsulation:2});var Sd=t(90547);function Ad(g,o){if(1&g&&e._UZ(0,"option",6),2&g){const s=o.$implicit;e.Q6J("textContent",s.label)("ngValue",s)}}function jd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"span",7),e.TgZ(1,"op-single-date-picker",8),e.NdJ("changed",function(S){return e.CHM(s),e.oxw().updateField(S)}),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("id",s.fieldId+"_visible")("name",s.fieldId+"_input")("initialDate",s.fieldValue)}}class Os{constructor(o,s,w,S){this.elementRef=o,this.cdRef=s,this.appRef=w,this.I18n=S,this.valueVisible=!1,this.onKey="on",this.currentKey="current",this.currentFieldValue="%CURRENT_DATE%",this.operators=[{key:this.onKey,label:this.I18n.t("js.custom_actions.date.specific")},{key:this.currentKey,label:this.I18n.t("js.custom_actions.date.current_date")}]}ngOnInit(){const o=this.elementRef.nativeElement;this.fieldName=o.dataset.fieldName,this.fieldValue=o.dataset.fieldValue,this.fieldValue===this.currentFieldValue?this.selectedOperator=this.operators[1]:(this.selectedOperator=this.operators[0],this.visibleValue=this.fieldValue),this.toggleValueVisibility()}toggleValueVisibility(){this.valueVisible=this.selectedOperator.key===this.onKey,this.fieldValue===this.currentFieldValue&&(this.fieldValue=""),this.updateDbValue()}updateDbValue(){this.selectedOperator.key===this.currentKey&&(this.fieldValue=this.currentFieldValue)}get fieldId(){return this.fieldName.replace(/\[|\]/g,"_").replace("__","_").replace(/_$/,"")}updateField(o){this.fieldValue=o,this.cdRef.detectChanges()}}Os.\u0275fac=function(o){return new(o||Os)(e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(e.z2F),e.Y36(y.D))},Os.\u0275cmp=e.Xpm({type:Os,selectors:[["custom-date-action-admin"]],decls:6,vars:6,consts:[[1,"form--field-container"],[1,"form--select-container"],[1,"form--select",3,"ngModel","ngModelChange","change"],[3,"textContent","ngValue",4,"ngFor","ngForOf"],["class","form--text-field-container -slim",4,"ngIf"],["type","hidden",3,"name","value"],[3,"textContent","ngValue"],[1,"form--text-field-container","-slim"],["classes","form--text-field",3,"id","name","initialDate","changed"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"span",1),e.TgZ(2,"select",2),e.NdJ("ngModelChange",function(S){return s.selectedOperator=S})("change",function(){return s.toggleValueVisibility()}),e.YNc(3,Ad,1,2,"option",3),e.qZA(),e.qZA(),e.YNc(4,jd,2,3,"span",4),e._UZ(5,"input",5),e.qZA()),2&o&&(e.xp6(2),e.Q6J("ngModel",s.selectedOperator),e.uIk("id",s.fieldId),e.xp6(1),e.Q6J("ngForOf",s.operators),e.xp6(1),e.Q6J("ngIf",s.valueVisible),e.xp6(1),e.Q6J("name",s.fieldName)("value",s.fieldValue))},directives:[h.EJ,h.JJ,h.On,R.sg,R.O5,h.YN,h.Kr,Sd.S],encapsulation:2});var Fd=t(3216),Zd=t(56945);function Wd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){return e.CHM(s),e.oxw().toggleCollapsed()}),e._UZ(1,"span",6),e._uU(2),e.qZA()}if(2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngClass",s.collapsed?"icon-arrow-down1":"icon-arrow-up1"),e.xp6(1),e.hij(" ",s.title,"\n")}}function Ld(g,o){if(1&g&&(e.TgZ(0,"div",7),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.hij(" ",s.title,"\n")}}function Ud(g,o){if(1&g&&e._UZ(0,"op-sidemenu",12),2&g){const s=e.oxw().$implicit;e.Q6J("title",s.title)("items",s.children)("collapsible",s.collapsible)}}function Bd(g,o){1&g&&e.GkF(0)}const Ia=function(g){return{"op-sidemenu--item-action_with_icon":g}},Da=function(g){return{item:g}};function Nd(g,o){if(1&g&&(e.TgZ(0,"a",13),e.YNc(1,Bd,1,0,"ng-container",14),e.qZA()),2&g){const s=e.oxw().$implicit;e.oxw();const w=e.MAs(5);e.Tol(e.VKq(8,Ia,!!s.icon)),e.Q6J("uiSref",s.uiSref)("uiParams",s.uiParams)("uiOptions",s.uiOptions),e.uIk("data-qa-selector","op-sidemenu--item-action--"+s.title.split(" ").join("")),e.xp6(1),e.Q6J("ngTemplateOutlet",w)("ngTemplateOutletContext",e.VKq(10,Da,s))}}function Qd(g,o){1&g&&e.GkF(0)}function Jd(g,o){if(1&g&&(e.TgZ(0,"a",15),e.YNc(1,Qd,1,0,"ng-container",14),e.qZA()),2&g){const s=e.oxw().$implicit;e.oxw();const w=e.MAs(5);e.Tol(e.VKq(6,Ia,!!s.icon)),e.Q6J("href",s.href,e.LSH),e.uIk("data-qa-selector","op-sidemenu--item-action--"+s.title.split(" ").join("")),e.xp6(1),e.Q6J("ngTemplateOutlet",w)("ngTemplateOutletContext",e.VKq(8,Da,s))}}function Yd(g,o){if(1&g&&(e.TgZ(0,"li",8),e.YNc(1,Ud,1,3,"op-sidemenu",9),e.YNc(2,Nd,2,12,"a",10),e.YNc(3,Jd,2,10,"a",11),e.qZA()),2&g){const s=o.$implicit;e.xp6(1),e.Q6J("ngIf",s.children&&s.children.length),e.xp6(1),e.Q6J("ngIf",!s.children&&s.uiSref),e.xp6(1),e.Q6J("ngIf",!s.children&&s.href)}}function $d(g,o){if(1&g&&e._UZ(0,"span",20),2&g){const s=e.oxw().item;e.Tol("icon-"+s.icon)}}function Vd(g,o){1&g&&e._UZ(0,"span",21)}function Hd(g,o){if(1&g&&(e.TgZ(0,"span",22),e._uU(1),e.qZA()),2&g){const s=e.oxw().item;e.xp6(1),e.Oqu(s.count)}}function zd(g,o){if(1&g&&(e.YNc(0,$d,1,2,"span",16),e.TgZ(1,"span",17),e._uU(2),e.YNc(3,Vd,1,0,"span",18),e.qZA(),e.YNc(4,Hd,2,1,"span",19)),2&g){const s=o.item,w=e.oxw();e.Q6J("ngIf",s.icon),e.xp6(2),e.hij("",s.title," "),e.xp6(1),e.Q6J("ngIf",w.noEEToken&&s.isEnterprise),e.xp6(1),e.Q6J("ngIf",s.count)}}const Kd=function(g,o){return{"op-sidemenu--items_collapsed":g,"searchable-menu--search-ul":o}};class Cn{constructor(o,s,w,S){this.elementRef=o,this.cdRef=s,this.I18n=w,this.Banner=S,this.className=!0,this.items=[],this.collapsible=!1,this.searchable=!1,this.collapsed=!1,this.noEEToken=this.Banner.eeShowBanners}toggleCollapsed(){this.collapsed=!this.collapsed}}function qd(g,o){if(1&g&&e._UZ(0,"op-sidemenu",4),2&g){const s=o.ngIf;e.Q6J("items",s)}}function Xd(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){return e.CHM(s),e.oxw().showNewBoardModal()}),e._UZ(1,"span",6),e._UZ(2,"span",7),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.text.create_new_board),e.xp6(2),e.Q6J("textContent",s.text.board)}}Cn.\u0275fac=function(o){return new(o||Cn)(e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(y.D),e.Y36(Co.j))},Cn.\u0275cmp=e.Xpm({type:Cn,selectors:[["op-sidemenu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-sidemenu",s.className)},inputs:{items:"items",title:"title",collapsible:"collapsible",searchable:"searchable"},decls:6,vars:7,consts:[["class","op-sidemenu--title","type","button",3,"click",4,"ngIf"],["class","op-sidemenu--title",4,"ngIf"],[1,"op-sidemenu--items",3,"ngClass"],["class","op-sidemenu--item","data-qa-selector","op-sidemenu--item",4,"ngFor","ngForOf"],["itemTemplate",""],["type","button",1,"op-sidemenu--title",3,"click"],["aria-hidden","true",1,"icon3","icon-small",3,"ngClass"],[1,"op-sidemenu--title"],["data-qa-selector","op-sidemenu--item",1,"op-sidemenu--item"],[3,"title","items","collapsible",4,"ngIf"],["class","op-sidemenu--item-action","uiSrefActive","op-sidemenu--item-action_active-child","uiSrefActiveEq","op-sidemenu--item-action_active",3,"class","uiSref","uiParams","uiOptions",4,"ngIf"],["class","op-sidemenu--item-action",3,"class","href",4,"ngIf"],[3,"title","items","collapsible"],["uiSrefActive","op-sidemenu--item-action_active-child","uiSrefActiveEq","op-sidemenu--item-action_active",1,"op-sidemenu--item-action",3,"uiSref","uiParams","uiOptions"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"op-sidemenu--item-action",3,"href"],["class","op-sidemenu--item-icon",3,"class",4,"ngIf"],[1,"op-sidemenu--item-title"],["class","op-sidemenu--enterprise-badge spot-icon spot-icon_enterprise-addons",4,"ngIf"],["class","op-bubble op-bubble_alt_highlighting",4,"ngIf"],[1,"op-sidemenu--item-icon"],[1,"op-sidemenu--enterprise-badge","spot-icon","spot-icon_enterprise-addons"],[1,"op-bubble","op-bubble_alt_highlighting"]],template:function(o,s){1&o&&(e.YNc(0,Wd,3,2,"button",0),e.YNc(1,Ld,2,1,"div",1),e.TgZ(2,"ul",2),e.YNc(3,Yd,4,3,"li",3),e.qZA(),e.YNc(4,zd,5,4,"ng-template",null,4,e.W1O)),2&o&&(e.Q6J("ngIf",s.title&&s.collapsible),e.xp6(1),e.Q6J("ngIf",s.title&&!s.collapsible),e.xp6(1),e.Q6J("ngClass",e.WLB(4,Kd,s.collapsed,s.searchable)),e.xp6(1),e.Q6J("ngForOf",s.items))},directives:[R.O5,R.mk,R.sg,Cn,Vt.AnchorUISref,Vt.UISrefActive,Vt.UISrefStatus,Vt.UISref,R.tP],styles:[".op-sidemenu[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:14px}.op-sidemenu--title[_ngcontent-%COMP%]{display:flex;background:transparent;color:var(--main-menu-fieldset-header-color);border:0;text-transform:uppercase;padding:8px 12px;margin-top:12px;font-size:12px;cursor:pointer}.op-sidemenu--title[_ngcontent-%COMP%]:hover{background:var(--main-menu-bg-hover-background);color:var(--main-menu-hover-font-color)}.op-sidemenu--items[_ngcontent-%COMP%]{list-style:none}.op-sidemenu--items_collapsed[_ngcontent-%COMP%]{display:none}.op-sidemenu--item-action[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--main-menu-font-color);padding:8px 12px 8px 32px}.op-sidemenu--item-action[_ngcontent-%COMP%]:hover{background:var(--main-menu-bg-hover-background);color:var(--main-menu-hover-font-color)}.op-sidemenu--item-action_active[_ngcontent-%COMP%]{background:var(--main-menu-bg-selected-background);color:var(--main-menu-selected-font-color)}.op-sidemenu--item-action_active-child[_ngcontent-%COMP%]{background:var(--main-menu-bg-selected-background);color:var(--main-menu-selected-font-color)}.op-sidemenu--item-action_with_icon[_ngcontent-%COMP%]{padding-left:12px}.op-sidemenu--item-title[_ngcontent-%COMP%]{margin-right:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:30px;text-decoration:none;width:100%}.op-sidemenu--item-icon[_ngcontent-%COMP%]{font-size:24px;margin-right:8px}"],changeDetection:0});class Ms extends yi.N{constructor(o,s,w,S,ne,fe,Ie,Ne){super(),this.boardService=o,this.apiV3Service=s,this.currentProject=w,this.mainMenuService=S,this.currentUserService=ne,this.I18n=fe,this.opModalService=Ie,this.injector=Ne,this.className=!0,this.boardOptions$=this.apiV3Service.boards.observeAll().pipe((0,Ht.U)(et=>et.map(Zt=>({title:Zt.name,uiSref:"boards.partitioned.show",uiParams:{board_id:Zt.id,query_props:"",projects:"projects",projectPath:this.currentProject.identifier},uiOptions:{reload:!0}})).sort((Zt,Ci)=>Zt.title.localeCompare(Ci.title)))),this.canCreateBoards$=this.currentUserService.hasCapabilities$("boards/create",this.currentProject.id||null).pipe(this.untilDestroyed()),this.text={board:this.I18n.t("js.label_board"),create_new_board:this.I18n.t("js.boards.create_new")}}ngOnInit(){this.mainMenuService.onActivate("board_view").subscribe(()=>{this.focusBackArrow(),this.boardService.loadAllBoards()})}showNewBoardModal(){this.opModalService.show(Zd.r,this.injector)}focusBackArrow(){jQuery('*[data-name="board_view"] .main-menu--arrow-left-to-project').focus()}}Ms.\u0275fac=function(o){return new(o||Ms)(e.Y36(Fd.$),e.Y36(j.T),e.Y36(P.R),e.Y36(Wn),e.Y36(So.S),e.Y36(y.D),e.Y36(lt.S),e.Y36(e.zs3))},Ms.\u0275cmp=e.Xpm({type:Ms,selectors:[["boards-menu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-sidebar",s.className)},features:[e.qOj],decls:6,vars:6,consts:[[1,"op-sidebar--body"],[3,"items",4,"ngIf"],[1,"op-sidebar--footer"],["class","button -alt-highlight","data-qa-selector","sidebar--create-board-button",3,"title","click",4,"ngIf"],[3,"items"],["data-qa-selector","sidebar--create-board-button",1,"button","-alt-highlight",3,"title","click"],[1,"spot-icon","spot-icon_add"],[3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,qd,1,1,"op-sidemenu",1),e.ALo(2,"async"),e.qZA(),e.TgZ(3,"div",2),e.YNc(4,Xd,3,2,"button",3),e.ALo(5,"async"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,s.boardOptions$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,4,s.canCreateBoards$)))},directives:[R.O5,Cn],pipes:[R.Ov],encapsulation:2});class Is{}Is.\u0275fac=function(o){return new(o||Is)},Is.\u0275cmp=e.Xpm({type:Is,selectors:[["global-search-work-packages-entry"]],decls:2,vars:0,consts:[["wp-isolated-query-space",""]],template:function(o,s){1&o&&(e.ynx(0,0),e._UZ(1,"global-search-work-packages"),e.BQk())},directives:[Ye.A,Uo],encapsulation:2});var ip=t(43358),Sa=t(71435);const np=["progressBar"],op=["progressPercentage"];function sp(g,o){1&g&&e._UZ(0,"op-icon",8)}function rp(g,o){1&g&&e._UZ(0,"op-icon",9)}function ap(g,o){if(1&g&&(e.TgZ(0,"span",5),e.YNc(1,sp,1,0,"op-icon",6),e.YNc(2,rp,1,0,"op-icon",7),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",s.error),e.xp6(1),e.Q6J("ngIf",s.completed)}}class Ds extends yi.N{constructor(o){super(),this.I18n=o,this.onError=new e.vpe,this.onSuccess=new e.vpe,this.error=!1,this.completed=!1}set value(o){this.progressBar.nativeElement.value=o,this.progressPercentage.nativeElement.innerText=`${o}%`,100===o&&(this.progressBar.nativeElement.style.display="none")}ngOnInit(){this.file=this.upload[0],this.upload[1].pipe(this.untilDestroyed()).subscribe(s=>{switch(s.type){case p.dt.Sent:return this.value=5,(0,an.qu)(`Uploading file "${this.file.name}" of size ${this.file.size}.`);case p.dt.UploadProgress:return this.updateProgress(s);case p.dt.Response:return(0,an.qu)(`File ${this.fileName} was fully uploaded.`),this.value=100,this.completed=!0,this.onSuccess.emit()}},s=>this.handleError(s))}get fileName(){return this.file&&this.file.name}updateProgress(o){o.total?this.value=Math.round(o.loaded/o.total*100):this.value=10}handleError(o){this.error=!0,this.onError.emit(o)}}function cp(g,o){1&g&&(e.TgZ(0,"div",8),e._UZ(1,"div",9),e._UZ(2,"div",10),e._UZ(3,"div",11),e._UZ(4,"div",12),e._UZ(5,"div",13),e.qZA())}function lp(g,o){if(1&g&&(e.ynx(0),e.YNc(1,cp,6,0,"div",6),e.ALo(2,"async"),e._UZ(3,"p",7),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,s.loading$)),e.xp6(2),e.Q6J("textContent",s.toast.message)}}function dp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",15),e.NdJ("click",function(S){return e.CHM(s),e.oxw(2).executeTarget(S)}),e.qZA()}if(2&g){const s=e.oxw(2);e.Q6J("textContent",s.toast.link.text)}}function pp(g,o){if(1&g&&(e.TgZ(0,"p"),e._UZ(1,"span",7),e._UZ(2,"span",7),e.YNc(3,dp,1,1,"a",14),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.toast.message),e.xp6(1),e.Q6J("textContent"," "),e.xp6(1),e.Q6J("ngIf",s.toast.link)}}function up(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"a",18),e.NdJ("click",function(){e.CHM(s);return e.oxw(2).show=!0}),e._UZ(2,"op-icon",19),e.qZA(),e.TgZ(3,"a",18),e.NdJ("click",function(){e.CHM(s);return e.oxw(2).show=!1}),e._UZ(4,"op-icon",20),e.qZA(),e._UZ(5,"span",7),e.qZA()}if(2&g){const s=e.oxw(2);e.xp6(1),e.Q6J("hidden",s.show),e.xp6(2),e.Q6J("hidden",!s.show),e.xp6(2),e.Q6J("textContent",s.uploadText)}}function hp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"op-toasters-upload-progress",23),e.NdJ("onSuccess",function(){return e.CHM(s),e.oxw(3).onUploadSuccess()})("onError",function(){return e.CHM(s),e.oxw(3).remove()}),e.qZA()}if(2&g){const s=o.$implicit;e.Q6J("upload",s)}}function _p(g,o){if(1&g&&(e.TgZ(0,"ul",21),e.YNc(1,hp,1,1,"op-toasters-upload-progress",22),e.qZA()),2&g){const s=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",s.data)}}Ds.\u0275fac=function(o){return new(o||Ds)(e.Y36(y.D))},Ds.\u0275cmp=e.Xpm({type:Ds,selectors:[["op-toasters-upload-progress"]],viewQuery:function(o,s){if(1&o&&(e.Gf(np,5),e.Gf(op,5)),2&o){let w;e.iGM(w=e.CRH())&&(s.progressBar=w.first),e.iGM(w=e.CRH())&&(s.progressPercentage=w.first)}},inputs:{upload:"upload"},outputs:{onError:"onError",onSuccess:"onSuccess"},features:[e.qOj],decls:8,vars:2,consts:[[1,"filename",3,"textContent"],["max","100","value","0"],["progressBar",""],["progressPercentage",""],["class","upload-completed",4,"ngIf"],[1,"upload-completed"],["icon-classes","icon-close",4,"ngIf"],["icon-classes","icon-checkmark",4,"ngIf"],["icon-classes","icon-close"],["icon-classes","icon-checkmark"]],template:function(o,s){1&o&&(e.TgZ(0,"li"),e._UZ(1,"span",0),e._UZ(2,"progress",1,2),e.TgZ(4,"p",null,3),e._uU(6,"0%"),e.qZA(),e.YNc(7,ap,3,2,"span",4),e.qZA()),2&o&&(e.xp6(1),e.Q6J("textContent",s.fileName),e.xp6(6),e.Q6J("ngIf",s.completed||s.error))},directives:[R.O5,ut.o],encapsulation:2});const mp=function(g){return{"-hidden":g}};function gp(g,o){if(1&g&&(e.TgZ(0,"div"),e.YNc(1,up,6,3,"div",2),e.TgZ(2,"div",16),e.YNc(3,_p,2,1,"ul",17),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",s.canBeHidden),e.xp6(1),e.Q6J("ngClass",e.VKq(3,mp,!s.show&&s.canBeHidden)),e.xp6(1),e.Q6J("ngIf",s.data&&s.data.length>0)}}function fp(g,o){1&g&&e._UZ(0,"div")}function vp(g,o){if(1&g&&e._UZ(0,"li",7),2&g){const s=o.$implicit;e.Q6J("textContent",s)}}function yp(g,o){if(1&g&&(e.TgZ(0,"div"),e.TgZ(1,"ul",24),e.YNc(2,vp,1,1,"li",25),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("ngForOf",s.data)}}function Cp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){return e.CHM(s),e.oxw().remove()}),e._UZ(1,"op-icon",27),e.qZA()}if(2&g){const s=e.oxw();e.Q6J("title",s.text.close_popup)}}class Ss{constructor(o,s){this.I18n=o,this.toastService=s,this.text={close_popup:this.I18n.t("js.close_popup_title")},this.uploadCount=0,this.show=!1,this.canBeHidden=!1,this.removable=!0,this.loading$=new Z.X(!1)}ngOnInit(){if(this.type=this.toast.type,this.removable=!["upload","loading"].includes(this.type),"upload"===this.type){const o=this.data;this.removable=!1,this.canBeHidden=o&&o.length>5}"loading"===this.type&&(this.removable=!1,this.loading$.next(!0),this.data.pipe((0,va.take)(1),(0,ip.V)(2e4),(0,Sa.x)(()=>{this.loading$.next(!1),this.remove()})).subscribe())}get data(){return this.toast.data}remove(){this.toastService.remove(this.toast)}executeTarget(){this.toast.link&&(this.toast.link.target(),this.remove())}onUploadSuccess(){this.uploadCount+=1}get uploadText(){return this.I18n.t("js.label_upload_counter",{done:this.uploadCount,count:this.data.length})}}function bp(g,o){if(1&g&&e._UZ(0,"op-toast",3),2&g){const s=o.$implicit;e.Q6J("toast",s)}}Ss.\u0275fac=function(o){return new(o||Ss)(e.Y36(y.D),e.Y36(I.kl))},Ss.\u0275cmp=e.Xpm({type:Ss,selectors:[["op-toast"]],inputs:{toast:"toast"},decls:9,vars:10,consts:[["tabindex","0"],["role","alert","aria-atomic","true",1,"op-toast--content"],[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["type","button","class","spot-link op-toast--close",3,"title","click",4,"ngIf"],["class","loading-indicator -small",4,"ngIf"],[3,"textContent"],[1,"loading-indicator","-small"],[1,"block-1"],[1,"block-2"],[1,"block-3"],[1,"block-4"],[1,"block-5"],["class","op-toast--target-link",3,"textContent","click",4,"ngIf"],[1,"op-toast--target-link",3,"textContent","click"],[3,"ngClass"],["class","op-toast--uploads",4,"ngIf"],[3,"hidden","click"],["icon-classes","icon-arrow-right2"],["icon-classes","icon-arrow-down1"],[1,"op-toast--uploads"],[3,"upload","onSuccess","onError",4,"ngFor","ngForOf"],[3,"upload","onSuccess","onError"],[1,"op-toast--errors"],[3,"textContent",4,"ngFor","ngForOf"],["type","button",1,"spot-link","op-toast--close",3,"title","click"],["icon-classes","icon-context icon-close icon-no-color"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.YNc(2,lp,4,4,"ng-container",2),e.YNc(3,pp,4,3,"p",2),e.TgZ(4,"div",3),e.YNc(5,gp,4,5,"div",4),e.YNc(6,fp,1,0,"div",4),e.YNc(7,yp,3,1,"div",4),e.qZA(),e.YNc(8,Cp,2,1,"button",5),e.qZA(),e.qZA()),2&o&&(e.Gre("op-toast -",s.type,""),e.xp6(2),e.Q6J("ngIf","loading"===s.type),e.xp6(1),e.Q6J("ngIf","loading"!==s.type),e.xp6(1),e.Q6J("ngSwitch",s.type),e.xp6(1),e.Q6J("ngSwitchCase","upload"),e.xp6(1),e.Q6J("ngSwitchCase","success"),e.xp6(1),e.Q6J("ngSwitchCase","error"),e.xp6(1),e.Q6J("ngIf",s.removable))},directives:[R.O5,R.RF,R.n9,R.mk,ut.o,R.sg,Ds],pipes:[R.Ov],encapsulation:2,changeDetection:0});class As extends yi.N{constructor(o,s){super(),this.toastService=o,this.cdRef=s,this.stack=[]}ngOnInit(){this.toastService.current.values$("Subscribing to changes in the toaster stack").pipe(this.untilDestroyed()).subscribe(o=>{this.stack=o,this.cdRef.detectChanges()})}}As.\u0275fac=function(o){return new(o||As)(e.Y36(I.kl),e.Y36(e.sBO))},As.\u0275cmp=e.Xpm({type:As,selectors:[["op-toasts-container"]],features:[e.qOj],decls:3,vars:1,consts:[[1,"op-toast--wrapper"],[1,"op-toast--casing"],[3,"toast",4,"ngFor","ngForOf"],[3,"toast"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.YNc(2,bp,1,1,"op-toast",2),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Q6J("ngForOf",s.stack))},directives:[R.sg,Ss],encapsulation:2,changeDetection:0});var Tp=t(22663),Aa=t(26611),kp=t(38519);function Pp(g,o){if(1&g&&(e.ynx(0),e._UZ(1,"attachments",3),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("resource",s.resource)}}class js extends yi.N{constructor(o,s,w,S,ne,fe,Ie){super(),this.elementRef=o,this.pathHelper=s,this.halResourceService=w,this.Notifications=S,this.I18n=ne,this.states=fe,this.ConfigurationService=Ie,this.changed=!1,this.inFlight=!1,this.isEditing=!1}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.textareaSelector=this.$element.attr("textarea-selector"),this.previewContext=this.$element.attr("preview-context"),this.macros="false"!==this.$element.attr("macros");const o=this.$element.attr("editor-type")||"full";this.fieldName=this.textareaSelector.substring(1);const s=this.$element.data("resource");this.resource=s?this.halResourceService.createHalResource(s,!0):void 0,this.formElement=this.$element.closest("form"),this.wrappedTextArea=this.formElement.find(this.textareaSelector),this.wrappedTextArea.removeAttr("required").hide(),this.initialContent=this.wrappedTextArea.val(),this.$attachmentsElement=this.formElement.find("#attachments_fields"),this.context={type:o,resource:this.resource,previewContext:this.previewContext},this.macros||(this.context.macros="none")}ngOnDestroy(){super.ngOnDestroy(),this.formElement.off("submit.ckeditor")}markEdited(){window.OpenProject.pageWasEdited=!0}setup(o){return this.$element.data("editor",o),this.resource&&this.resource.attachments&&(this.setupAttachmentAddedCallback(o),this.setupAttachmentRemovalSignal(o)),this.formElement.on("submit.ckeditor change.ckeditor",()=>{try{this.wrappedTextArea.val(this.ckEditorInstance.getRawData())}catch(s){return console.error(`Failed to save CKEditor body to textarea: ${s}.`),this.Notifications.addError(s||this.I18n.t("js.error.internal")),!1}return this.addUploadedAttachmentsToForm(),!0}),this.setLabel(),o}setupAttachmentAddedCallback(o){o.model.on("op:attachment-added",()=>{this.states.forResource(this.resource).putValue(this.resource)})}setupAttachmentRemovalSignal(o){this.attachments=_.clone(this.resource.attachments.elements),this.states.forResource(this.resource).changes$().pipe((0,Tp.R)((0,kp.J6)(this)),(0,hi.h)(s=>!!s)).subscribe(s=>{const S=_.differenceBy(this.attachments,s.attachments.elements,ne=>ne.id).map(ne=>ne.downloadLocation.href);S.length&&o.model.fire("op:attachment-removed",S),this.attachments=_.clone(s.attachments.elements)})}setLabel(){const o=this.textareaSelector.substring(1),s=jQuery(`label[for=${o}]`),w=this.$element.find(".ck-content");w.attr("aria-label",null),w.attr("aria-labelledby",o),s.click(()=>{w.focus()})}addUploadedAttachmentsToForm(){if(!this.resource||!this.resource.attachments||this.resource.id)return;const s=this.$attachmentsElement.find("input[type='file']").map((S,ne)=>{const fe=/attachments\[(\d+)\]\[(?:file|id)\]/.exec(ne.getAttribute("name")||"");return fe?parseInt(fe[1]):0}).toArray().sort().pop()||0,w=this.resource.attachments.elements||[];jQuery.each(w,(S,ne)=>{this.$attachmentsElement.append(`<input type="hidden" name="attachments[${s+S+1}][id]" value="${ne.id}">`)})}}js.\u0275fac=function(o){return new(o||js)(e.Y36(e.SBq),e.Y36(it.j),e.Y36(Ot.u),e.Y36(I.kl),e.Y36(y.D),e.Y36(c.G),e.Y36(de.e))},js.\u0275cmp=e.Xpm({type:js,selectors:[["ckeditor-augmented-textarea"]],viewQuery:function(o,s){if(1&o&&e.Gf(Aa.F,7),2&o){let w;e.iGM(w=e.CRH())&&(s.ckEditorInstance=w.first)}},features:[e.qOj],decls:4,vars:4,consts:[[1,"op-ckeditor--wrapper"],[3,"context","fieldName","content","onInitialized","onContentChange"],[4,"ngIf"],["data-allow-uploading","true","data-destroy-immediately","false",3,"resource"]],template:function(o,s){1&o&&(e.ynx(0),e.TgZ(1,"div",0),e.TgZ(2,"op-ckeditor",1),e.NdJ("onInitialized",function(S){return s.setup(S)})("onContentChange",function(){return s.markEdited()}),e.qZA(),e.qZA(),e.YNc(3,Pp,2,1,"ng-container",2),e.BQk()),2&o&&(e.xp6(2),e.Q6J("context",s.context)("fieldName",s.fieldName)("content",s.initialContent),e.xp6(1),e.Q6J("ngIf",s.resource&&s.resource.attachments))},directives:[Aa.F,R.O5,Li.t],encapsulation:2});class Rs{constructor(o){this.elementRef=o,this.isHidden=!1}ngOnInit(){this.$element=jQuery(this.elementRef.nativeElement),this.$targetNotification=this.getTargetNotification(),this.identifier=this.$element.data("identifier"),this.isHidden="true"===window.OpenProject.guardedLocalStorage(this.identifier),this.$targetNotification.prop("hidden",!!this.isHidden),this.$element.parent().find(".persistent-toggle--click-handler").on("click",()=>this.toggle(!this.isHidden)),this.$targetNotification.find(".op-toast--close").on("click",()=>this.toggle(!0))}getTargetNotification(){return this.$element.parent().find(".persistent-toggle--toaster")}toggle(o){this.isHidden=o,window.OpenProject.guardedLocalStorage(this.identifier,(!!o).toString()),o?this.$targetNotification.slideUp(400,()=>{this.$targetNotification.prop("hidden",!0)}):(this.$targetNotification.slideDown(400),this.$targetNotification.prop("hidden",!1))}}Rs.\u0275fac=function(o){return new(o||Rs)(e.Y36(e.SBq))},Rs.\u0275cmp=e.Xpm({type:Rs,selectors:[["persistent-toggle"]],decls:0,vars:0,template:function(o,s){},encapsulation:2});var Bo=t(14808);class Un{constructor(o){this.displayed=(0,Bo.qH)(),this.all=[];const s=o.get("hideSections");this.all=s.all,this.displayed.putValue(s.active.map(w=>(this.toggleVisibility(w.key,!0),w.key))),this.removeHiddenOnSubmit()}section(o){return document.querySelector(`section.hide-section[data-section-name="${o}"]`)}hide(o){this.displayed.doModify(s=>s.filter(w=>w!==o)),this.toggleVisibility(o,!1)}show(o){this.displayed.doModify(s=>[...s,o]),this.toggleVisibility(o,!0)}toggleVisibility(o,s){const w=this.section(o);w&&(w.hidden=!s)}removeHiddenOnSubmit(){jQuery(document.body).on("submit","form",function(o){const s=jQuery(this),w=s.find("section.hide-section:hidden");return!(!s.data("hideSectionRemoved")&&0!==w.length)||(s.data("hideSectionRemoved",!0),w.remove(),s.trigger("submit"),o.preventDefault(),!1)})}}Un.\u0275fac=function(o){return new(o||Un)(e.LFG($r.U))},Un.\u0275prov=e.Yz7({token:Un,factory:Un.\u0275fac,providedIn:"root"});class Fs{constructor(o,s,w){this.elementRef=o,this.hideSectionService=s,this.I18n=w,this.displayed=!0,this.text={remove:this.I18n.t("js.label_remove")}}ngOnInit(){this.sectionName=this.elementRef.nativeElement.dataset.sectionName}hideSection(){return this.hideSectionService.hide(this.sectionName),!1}}Fs.\u0275fac=function(o){return new(o||Fs)(e.Y36(e.SBq),e.Y36(Un),e.Y36(y.D))},Fs.\u0275cmp=e.Xpm({type:Fs,selectors:[["hide-section-link"]],decls:2,vars:1,consts:[["type","button",1,"spot-link",3,"title","click"],["icon-classes","icon-close icon-small"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return s.hideSection()}),e._UZ(1,"op-icon",1),e.qZA()),2&o&&e.Q6J("title",s.text.remove)},directives:[ut.o],encapsulation:2});class Zs{constructor(o,s){this.HideSection=o,this.elementRef=s}ngOnInit(){const o=jQuery(this.elementRef.nativeElement);this.optValue=o.data("optValue"),this.hideSecWithName=o.data("hideSecWithName"),jQuery(this.elementRef.nativeElement).prev().on("change",w=>{jQuery("option:selected",w.target).val()!==this.optValue?this.HideSection.hide(this.hideSecWithName):this.HideSection.show(this.hideSecWithName)})}}Zs.\u0275fac=function(o){return new(o||Zs)(e.Y36(Un),e.Y36(e.SBq))},Zs.\u0275cmp=e.Xpm({type:Zs,selectors:[["show-section-dropdown"]],decls:0,vars:0,template:function(o,s){},encapsulation:2});var Ip=t(43682);const Dp=["fallbackOption"];function Sp(g,o){if(1&g&&e._UZ(0,"option",4),2&g){const s=o.$implicit;e.Q6J("value",s.key)("textContent",s.label)}}class Ws extends yi.N{constructor(o,s,w){super(),this.hideSectionService=o,this.elementRef=s,this.I18n=w,this.trackByKey=(0,Ip.AT)("key"),this.selectable=[],this.active=[],this.placeholder=this.I18n.t("js.placeholders.selection")}ngOnInit(){this.htmlId=this.elementRef.nativeElement.dataset.htmlId,this.hideSectionService.displayed.values$().pipe(this.untilDestroyed()).subscribe(o=>{this.selectable=this.hideSectionService.all.filter(s=>-1===o.indexOf(s.key)).sort((s,w)=>s.label.localeCompare(w.label)),this.option.nativeElement.selected=!0})}show(o){this.hideSectionService.show(o)}}Ws.\u0275fac=function(o){return new(o||Ws)(e.Y36(Un),e.Y36(e.SBq),e.Y36(y.D))},Ws.\u0275cmp=e.Xpm({type:Ws,selectors:[["add-section-dropdown"]],viewQuery:function(o,s){if(1&o&&e.Gf(Dp,7),2&o){let w;e.iGM(w=e.CRH())&&(s.option=w.first)}},features:[e.qOj],decls:4,vars:3,consts:[[1,"form--select",3,"id","change"],["value","","selected","","disabled","",3,"textContent"],["fallbackOption",""],[3,"value","textContent",4,"ngFor","ngForTrackByKey","ngForOf"],[3,"value","textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"select",0),e.NdJ("change",function(S){return s.show(S.target.value)}),e._UZ(1,"option",1,2),e.YNc(3,Sp,1,2,"option",3),e.qZA()),2&o&&(e.Q6J("id",s.htmlId),e.xp6(1),e.Q6J("textContent",s.placeholder),e.xp6(2),e.Q6J("ngForOf",s.selectable))},directives:[h.YN,h.Kr,R.sg],encapsulation:2});var ja=t(7301),jp=t(54471);function Rp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",16),e.NdJ("click",function(S){e.CHM(s);const ne=e.oxw().$implicit;return e.oxw().clickTab(ne,S)}),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.ekj("op-tab-row--link_selected",s.id===w.currentTabId)("op-tab-row--link_disabled",void 0!==s.disable),e.Q6J("href",s.path,e.LSH)("textContent",s.name),e.uIk("title",w.tabTitle(s))}}function Fp(g,o){if(1&g&&(e._UZ(0,"op-tab-count",21),e.ALo(1,"async")),2&g){const s=e.oxw(2).$implicit,w=e.oxw();e.Q6J("count",e.lcZ(1,2,s.counter(w.injector))),e.uIk("data-qa-selector","tab-counter-"+s.name)}}function Zp(g,o){if(1&g&&(e.TgZ(0,"span",23),e._uU(1),e.qZA()),2&g){const s=e.oxw().ngIf;e.xp6(1),e.hij(" (",s,")")}}function Wp(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Zp,2,1,"span",22),e.BQk()),2&g){const s=o.ngIf,w=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",s>0&&!w.showCountAsBubble)}}function Lp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",17),e.NdJ("click",function(S){e.CHM(s);const ne=e.oxw().$implicit;return e.oxw().clickTab(ne,S)}),e._UZ(1,"span",18),e.YNc(2,Fp,2,4,"op-tab-count",19),e.YNc(3,Wp,2,1,"ng-container",20),e.ALo(4,"async"),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.ekj("op-tab-row--link_disabled",void 0!==s.disable),e.Q6J("uiSref",s.route)("uiParams",s.routeParams),e.uIk("title",w.tabTitle(s)),e.xp6(1),e.Q6J("textContent",s.name),e.xp6(1),e.Q6J("ngIf",s.counter&&s.showCountAsBubble),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,8,s.counter(w.injector)))}}function Up(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li",13),e.NdJ("dragenter",function(){const ne=e.CHM(s).$implicit;return e.oxw().startDebouncedTabActivation(ne)})("dragleave",function(){return e.CHM(s),e.oxw().cancelDebouncedTabActivation()}),e.YNc(1,Rp,1,7,"a",14),e.YNc(2,Lp,5,10,"a",15),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.uIk("data-tab-id",s.id)("data-qa-tab-id",s.id)("data-qa-tab-selected",s.id===w.currentTabId||void 0)("data-qa-tab-disabled",s.disable||void 0),e.xp6(1),e.Q6J("ngIf",!s.route),e.xp6(1),e.Q6J("ngIf",s.route)}}const Bp=[[["","slot","actions"]]];class Ls extends _i.P{constructor(o,s,w,S,ne,fe){super(s,S,fe),this.elementRef=o,this.$state=s,this.gon=w,this.I18n=ne,this.injector=fe,this.classes=["content--tabs","scrollable-tabs"];const Ie=JSON.parse(this.gon.get("contentTabs").tabs),Ne=JSON.parse(this.gon.get("contentTabs").selected);this.tabs=Ie.map(et=>({id:et.name,name:this.I18n.t(`js.${et.label}`,{defaultValue:et.label}),path:et.path})),this.currentTabId=Ne.name}}Ls.\u0275fac=function(o){return new(o||Ls)(e.Y36(e.SBq),e.Y36(he.StateService),e.Y36($r.U),e.Y36(e.sBO),e.Y36(y.D),e.Y36(e.zs3))},Ls.\u0275cmp=e.Xpm({type:Ls,selectors:[["op-content-tabs"]],features:[e.qOj],ngContentSelectors:["[slot=actions]"],decls:14,vars:5,consts:[[1,"op-scrollable-tabs",3,"ngClass"],[1,"op-scrollable-tabs--tab-container"],["scrollContainer",""],[1,"op-tab-row",3,"scroll"],["scrollPane",""],["class","op-tab-row--tab",3,"dragenter","dragleave",4,"ngFor","ngForOf","ngForTrackBy"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_left",3,"hidden","click"],["scrollLeftBtn",""],[1,"icon-arrow-left2"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_right",3,"hidden","click"],["scrollRightBtn",""],[1,"icon-arrow-right2"],[1,"op-scrollable-tabs--actions"],[1,"op-tab-row--tab",3,"dragenter","dragleave"],["class","op-tab-row--link",3,"href","op-tab-row--link_selected","op-tab-row--link_disabled","textContent","click",4,"ngIf"],["class","op-tab-row--link","uiSrefActive","op-tab-row--link_selected","href","","role","button",3,"uiSref","uiParams","op-tab-row--link_disabled","click",4,"ngIf"],[1,"op-tab-row--link",3,"href","textContent","click"],["uiSrefActive","op-tab-row--link_selected","href","","role","button",1,"op-tab-row--link",3,"uiSref","uiParams","click"],[3,"textContent"],[3,"count",4,"ngIf"],[4,"ngIf"],[3,"count"],["data-qa-selector","tab-count",4,"ngIf"],["data-qa-selector","tab-count"]],template:function(o,s){1&o&&(e.F$t(Bp),e.TgZ(0,"div",0),e.TgZ(1,"div",1,2),e.TgZ(3,"ul",3,4),e.NdJ("scroll",function(){return s.onScroll()}),e.YNc(5,Up,3,6,"li",5),e.qZA(),e.TgZ(6,"div",6,7),e.NdJ("click",function(){return s.scrollLeft()}),e._UZ(8,"span",8),e.qZA(),e.TgZ(9,"div",9,10),e.NdJ("click",function(){return s.scrollRight()}),e._UZ(11,"span",11),e.qZA(),e.qZA(),e.TgZ(12,"ul",12),e.Hsn(13),e.qZA(),e.qZA()),2&o&&(e.Q6J("ngClass",s.classes),e.xp6(5),e.Q6J("ngForOf",s.tabs)("ngForTrackBy",s.trackById),e.xp6(1),e.Q6J("hidden",s.hideLeftButton),e.xp6(3),e.Q6J("hidden",s.hideRightButton))},directives:[R.mk,R.sg,R.O5,Vt.AnchorUISref,Vt.UISrefActive,Vt.UISrefStatus,Vt.UISref,jp.x],pipes:[R.Ov],styles:["content-tabs[_ngcontent-%COMP%]{min-height:73px;display:block}"],changeDetection:0});class Us{constructor(o,s,w,S){this.toastService=o,this.elementRef=s,this.I18n=w,this.ConfigurationService=S}ngOnInit(){const o=this.elementRef.nativeElement;this.clickTarget=o.getAttribute("click-target"),this.clipboardTarget=o.getAttribute("clipboard-target"),jQuery(this.clickTarget).on("click",s=>this.onClick(s)),o.classList.add("copy-to-clipboard"),this.target=jQuery(this.clipboardTarget?this.clipboardTarget:o)}addNotification(o,s){const w=this.toastService[o](s);setTimeout(()=>this.toastService.remove(w),5e3)}onClick(o){const s=document.queryCommandSupported&&document.queryCommandSupported("copy");if(o.preventDefault(),this.target.select().focus(),s)try{if(document.execCommand("copy"))return void this.addNotification("addSuccess",this.I18n.t("js.clipboard.copied_successful"))}catch(w){console.log(`Your browser seems to support the clipboard API, but copying failed: ${w}`)}this.addNotification("addError",this.I18n.t("js.clipboard.browser_error"))}}Us.\u0275fac=function(o){return new(o||Us)(e.Y36(I.kl),e.Y36(e.SBq),e.Y36(y.D),e.Y36(de.e))},Us.\u0275cmp=e.Xpm({type:Us,selectors:[["copy-to-clipboard"]],decls:0,vars:0,template:function(o,s){},encapsulation:2});var Tr=t(98636),Yp=t(67325),Ra=t(50076),$p=t(49951),Hr=t(91593),Fa=t(80104);const Vp=["btn"];function Hp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){return e.CHM(s),e.oxw().toggleMobileSearch()}),e._UZ(1,"i",9),e.qZA()}if(2&g){const s=e.oxw();e.s9C("title",s.text.close_search)}}function zp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",12),e.NdJ("click",function(){e.CHM(s);const S=e.oxw().$implicit;return e.oxw().followItem(S)}),e.TgZ(2,"div",13),e._uU(3),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.xp6(3),e.hij(" ",w.currentValue,""),e.xp6(1),e.s9C("title",s.projectScope),e.xp6(1),e.hij("",s.text," \u21b5")}}function Kp(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",15),e.NdJ("click",function(S){e.CHM(s);const ne=e.oxw().$implicit;return e.oxw().redirectToWp(ne.id,S)}),e._UZ(1,"op-principal",16),e.TgZ(2,"div",17),e.TgZ(3,"span",18),e._UZ(4,"span",19),e._uU(5),e.qZA(),e.TgZ(6,"div",20),e._UZ(7,"span",21),e._uU(8),e._UZ(9,"span",22),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("href",w.wpPath(s.id),e.LSH),e.xp6(1),e.Q6J("hideName",!0)("principal",s.author),e.xp6(3),e.Q6J("ngClass",w.highlighting("type",s.type.id))("textContent",s.type.name),e.xp6(1),e.hij(" ",s.subject," "),e.xp6(2),e.Q6J("textContent",s.project.name),e.xp6(1),e.hij(" #",s.id," "),e.xp6(1),e.Q6J("textContent",s.status.name)("ngClass",w.statusHighlighting(s.status.id))}}function Gp(g,o){if(1&g&&(e.YNc(0,zp,6,3,"div",10),e.YNc(1,Kp,10,10,"ng-template",null,11,e.W1O)),2&g){const s=o.$implicit,w=e.MAs(2);e.Q6J("ngIf",!s.id)("ngIfElse",w)}}const qp=function(g,o){return{"top-menu-search--input":!0,"-markable":g,"-expanded":o}};class Bs{constructor(o,s,w,S,ne,fe,Ie,Ne,et,Dt,Zt){this.elementRef=o,this.I18n=s,this.apiV3Service=w,this.pathHelperService=S,this.halResourceService=ne,this.globalSearchService=fe,this.currentProjectService=Ie,this.deviceService=Ne,this.cdRef=et,this.halNotification=Dt,this.ngZone=Zt,this.expanded=!1,this.markable=!1,this.getAutocompleterData=Ci=>this.autocompleteWorkPackages(Ci),this.autocompleterOptions={filters:[],resource:"work_packages",searchKey:"subjectOrId",getOptionsFn:this.getAutocompleterData},this.currentValue="",this.isFocusedDirectly=this.globalSearchService.searchTerm.length>0,this.text={all_projects:this.I18n.t("js.global_search.all_projects"),current_project:this.I18n.t("js.global_search.current_project"),current_project_and_all_descendants:this.I18n.t("js.global_search.current_project_and_all_descendants"),search:this.I18n.t("js.global_search.search"),search_dots:`${this.I18n.t("js.global_search.search")} ...`,close_search:this.I18n.t("js.global_search.close_search")}}ngAfterViewInit(){this.searchTerm=this.globalSearchService.searchTerm,this.currentValue="",this.toggleTopMenuClass()}ngOnDestroy(){this.unregister()}set searchTerm(o){this.ngSelectComponent.ngSelectInstance.searchTerm=o}get searchTerm(){return this.ngSelectComponent.ngSelectInstance.searchTerm}handleClick(o){var s;o.preventDefault(),(0,$p.j)(this.btn.nativeElement,o.target)&&(this.deviceService.isMobile?(this.toggleMobileSearch(),jQuery(".ng-input input").focus(),o.stopPropagation()):0===(null===(s=this.searchTerm)||void 0===s?void 0:s.length)?this.ngSelectComponent.ngSelectInstance.focus():this.submitNonEmptySearch())}toggleMobileSearch(){this.expanded=!this.expanded,this.toggleTopMenuClass()}redirectToWp(o,s){return s.stopImmediatePropagation(),!!(0,Yp.F)(s)||(window.location.href=this.wpPath(o),s.preventDefault(),!1)}wpPath(o){return this.pathHelperService.workPackagePath(o)}highlighting(o,s){return Ra.Z.inlineClass(o,s)}search(o){this.currentValue=this.searchTerm,this.openCloseMenu(o.term)}openCloseMenu(o){this.ngSelectComponent.ngSelectInstance.isOpen=o.trim().length>0}onFocus(){this.expanded=!0,this.toggleTopMenuClass(),this.openCloseMenu(this.currentValue)}onFocusOut(){this.deviceService.isMobile||(this.expanded=null!==this.searchTerm&&this.searchTerm.length>0,this.ngSelectComponent.ngSelectInstance.isOpen=!1,this.selectedItem=void 0,this.toggleTopMenuClass())}onClose(){this.searchTerm=this.currentValue}clearSearch(){this.currentValue="",this.searchTerm="",this.openCloseMenu(this.currentValue)}onEnterBeforeResultsLoaded(){this.selectedItem?this.followSelectedItem():this.searchInScope(this.currentScope)}statusHighlighting(o){return Ra.Z.inlineClass("status",o)}followItem(o){this.selectedItem=o,o instanceof jo.X?window.location.href=this.wpPath(o.id):o&&(this.globalSearchService.searchTerm=this.currentValue,this.searchInScope(o.projectScope))}followSelectedItem(){this.selectedItem&&this.followItem(this.selectedItem)}customSearchFn(o,s){return void 0===s.id||-1!==s.subject.toLowerCase().indexOf(o.toLowerCase())}autocompleteWorkPackages(o){if(!o)return(0,mo.of)([]);this.selectedItem=void 0,this.markable=!1;const s=this.queryWithoutHash(o);return this.fetchSearchResults(s,s!==o).get().pipe((0,Ht.U)(w=>this.searchResultsToOptions(w.elements,s)),(0,Tr.b)(()=>{this.setMarkedOption()}))}queryWithoutHash(o){return/^#(\d+)/.exec(o)?o.substr(1):o}fetchSearchResults(o,s){return this.apiV3Service.work_packages.filterByTypeaheadOrId(o,s)}searchResultsToOptions(o,s){const w=this.detailedSearchOptions();return this.selectedItem=o.find(S=>{var ne;return(null===(ne=S.id)||void 0===ne?void 0:ne.toString())===s})||w[0],[...w,...o]}detailedSearchOptions(){const o=[];return this.currentProjectService.path&&(o.push("current_project_and_all_descendants"),o.push("current_project")),"current_project"===this.globalSearchService.projectScope&&o.reverse(),o.push("all_projects"),o.map(s=>({projectScope:s,text:this.text[s]}))}setMarkedOption(){this.markable=!0,this.ngSelectComponent.ngSelectInstance.itemsList.markItem(this.ngSelectComponent.ngSelectInstance.itemsList.selectedItems[0]),this.cdRef.detectChanges()}searchInScope(o){switch(o){case"all_projects":{let s=!1;"all"!==this.globalSearchService.projectScope&&(s=!0,this.globalSearchService.resultsHidden=!0),this.globalSearchService.projectScope="all",this.submitNonEmptySearch(s);break}case"current_project":this.globalSearchService.projectScope="current_project",this.submitNonEmptySearch();break;case"current_project_and_all_descendants":this.globalSearchService.projectScope="",this.submitNonEmptySearch()}}submitNonEmptySearch(o=!1){if(this.globalSearchService.searchTerm=this.currentValue,this.currentValue.length>0){if(this.ngSelectComponent.ngSelectInstance.close(),!o&&this.globalSearchService.isAfterSearch()&&"work_packages"===this.globalSearchService.currentTab)return void window.history.replaceState({},`${I18n.t("global_search.search")}: ${this.searchTerm}`,this.globalSearchService.searchPath());this.globalSearchService.submitSearch()}}blur(){this.ngSelectComponent.ngSelectInstance.searchTerm="",document.activeElement.blur()}get currentScope(){const o=this.globalSearchService.projectScope;return""===o?"current_project_and_all_descendants":o}unregister(){this.unregisterGlobalListener&&(this.unregisterGlobalListener(),this.unregisterGlobalListener=void 0)}toggleTopMenuClass(){const o=document.getElementsByClassName("op-app-header")[0];o.classList.toggle("op-app-header_search-open",this.expanded),o.dataset.qaSearchOpen="1"}}Bs.\u0275fac=function(o){return new(o||Bs)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(j.T),e.Y36(it.j),e.Y36(Ot.u),e.Y36(sn),e.Y36(P.R),e.Y36(z.U),e.Y36(e.sBO),e.Y36(Fe.W),e.Y36(e.R0b))},Bs.\u0275cmp=e.Xpm({type:Bs,selectors:[["global-search-input"]],viewQuery:function(o,s){if(1&o&&(e.Gf(Vp,7),e.Gf(Hr.s,7)),2&o){let w;e.iGM(w=e.CRH())&&(s.btn=w.first),e.iGM(w=e.CRH())&&(s.ngSelectComponent=w.first)}},hostBindings:function(o,s){1&o&&e.NdJ("click",function(S){return s.handleClick(S)})},decls:8,vars:22,consts:[[1,"top-menu-search"],["class","top-menu-search--back-button","href","#",3,"title","click",4,"ngIf"],[1,"global-search",3,"defaultData","name","id","accesskey","placeholder","classes","openOnEnter","labelRequired","focusDirectly","model","searchFn","filters","resource","searchKey","getOptionsFn","focus","blur","search","open","close","change","keydown.enter","keydown.escape","clear"],["select",""],["op-autocompleter-option-tmp",""],["role","button","id","top-menu-search-button",1,"top-menu-search--button","search-form-normal",3,"title","click"],["btn",""],["icon-classes","icon5 icon-search ellipsis"],["href","#",1,"top-menu-search--back-button",3,"title","click"],["aria-hidden","true",1,"icon-arrow-left1"],[4,"ngIf","ngIfElse"],["workPackageItemTemplate",""],["tabindex","-1",1,"global-search--option",3,"click"],[1,"global-search--search-term"],[1,"global-search--project-scope",3,"title"],["tabindex","-1",1,"global-search--option",2,"line-height","1",3,"href","click"],[1,"hidden-for-mobile","global-search--principal",3,"hideName","principal"],[1,"global-search--option-meta"],[1,"global-search--wp-subject"],[3,"ngClass","textContent"],[1,"global-search--wp-content"],[1,"global-search--wp-project",3,"textContent"],[1,"global-search--wp-status",3,"textContent","ngClass"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Hp,2,1,"button",1),e.TgZ(2,"op-autocompleter",2,3),e.NdJ("focus",function(){return s.onFocus()})("blur",function(){return s.onFocusOut()})("search",function(S){return s.search(S)})("open",function(){return s.openCloseMenu(s.currentValue)})("close",function(){return s.onClose()})("change",function(S){return s.followItem(S)})("keydown.enter",function(){return s.onEnterBeforeResultsLoaded()})("keydown.escape",function(){return s.blur()})("clear",function(){return s.clearSearch()}),e.YNc(4,Gp,3,2,"ng-template",4),e.qZA(),e.TgZ(5,"button",5,6),e.NdJ("click",function(S){return s.handleClick(S)}),e._UZ(7,"op-icon",7),e.qZA(),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",s.expanded),e.xp6(1),e.Q6J("defaultData",!1)("name","global-search-input")("id","global-search-input")("accesskey",4)("placeholder",s.text.search_dots)("classes",e.WLB(19,qp,s.markable,s.expanded))("openOnEnter",!1)("labelRequired",!1)("focusDirectly",s.isFocusedDirectly)("model",s.selectedItem)("searchFn",s.customSearchFn)("filters",s.autocompleterOptions.filters)("resource",s.autocompleterOptions.resource)("searchKey",s.autocompleterOptions.searchKey)("getOptionsFn",s.autocompleterOptions.getOptionsFn),e.xp6(3),e.ekj("-input-focused",s.expanded),e.s9C("title",s.text.search))},directives:[R.O5,Hr.s,Fa.u,ut.o,Qt.N,R.mk],styles:[".cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.top-menu-search{display:flex;align-items:center;position:relative;height:var(--header-height);line-height:var(--header-height);margin:0 15px}@media screen and (max-width: 679px){.top-menu-search{margin:0}}.top-menu-search--back-button{display:none}.top-menu-search--button{padding:0;margin:0;background:transparent;border:0;font:inherit;text-align:inherit;position:absolute;right:2px;font-size:var(--header-item-font-size);color:var(--header-item-font-color)}.top-menu-search--button:hover{text-decoration:none}@media screen and (max-width: 679px){.top-menu-search--button{position:relative;padding:0 8px}.top-menu-search--button:hover{background:var(--header-item-bg-hover-color);color:var(--header-item-font-hover-color);border-bottom:var(--header-border-bottom-width) solid var(--header-border-bottom-color)}}.top-menu-search--button.-input-focused{color:var(--header-search-field-font-color)}.top-menu-search--loading{top:var(--header-height)-11px;height:46px;z-index:1051}.top-menu-search--input{width:calc(160px + 3vw);font-size:.9rem;transition:width .2s ease-in-out}.top-menu-search--input::-ms-clear{margin-right:5px;width:20px}.top-menu-search--input .ng-select-container{background:transparent;border-color:var(--header-item-font-color)}.top-menu-search--input .ng-arrow-wrapper{display:none}.top-menu-search--input .ng-clear-wrapper{color:var(--header-item-font-color);top:1px;width:30px;right:25px;text-align:center}@media screen and (max-width: 679px){.top-menu-search--input .ng-input{top:0!important}}.top-menu-search--input .ng-input input{color:var(--header-item-font-color);height:30px;cursor:text}.top-menu-search--input .ng-placeholder{color:var(--header-item-font-color)!important}.top-menu-search--input.-expanded{width:calc(160px + 13vw);background:white;border-radius:4px;color:var(--header-search-field-font-color)}.top-menu-search--input.-expanded .ng-placeholder,.top-menu-search--input.-expanded .ng-clear-wrapper,.top-menu-search--input.-expanded input{color:var(--header-search-field-font-color)}.top-menu-search--input .ng-dropdown-panel-items.scroll-host{scrollbar-color:transparent transparent;scrollbar-width:thin;max-height:80vh;height:auto}.top-menu-search--input .ng-dropdown-panel-items.scroll-host::-webkit-scrollbar{height:10px;width:10px}.top-menu-search--input .ng-dropdown-panel-items.scroll-host::-webkit-scrollbar-track{background:transparent}.top-menu-search--input .ng-dropdown-panel-items.scroll-host::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.top-menu-search--input .ng-dropdown-panel-items.scroll-host:hover{scrollbar-color:#DDDDDD transparent}.top-menu-search--input .ng-dropdown-panel-items.scroll-host:hover::-webkit-scrollbar-thumb{visibility:visible}.top-menu-search--input .ng-option{border-bottom:1px solid #EAEAEA;white-space:normal;padding:5px 10px;background-color:unset}.top-menu-search--input .ng-option:last-child{border-bottom:none}.top-menu-search--input .ng-option.ng-option-marked{color:var(--header-drop-down-item-font-hover-color)}.top-menu-search--input .ng-option.ng-option-disabled{display:none}.top-menu-search--input .ng-option.ng-option-selected{color:var(--header-drop-down-item-font-hover-color)}.top-menu-search--input.-markable .ng-option.ng-option-marked{background-color:var(--drop-down-hover-bg-color)}.top-menu-search--input.-markable .ng-option.ng-option-selected{background-color:var(--drop-down-selected-bg-color)}.top-menu-search--input .ng-spinner-loader{position:relative;right:14px}\n",".cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}@media only screen and (max-width: 679px){.top-menu-search--input{display:none}.top-menu-search--input.-expanded{display:block;min-width:unset;flex-basis:100%;position:unset;flex-grow:1}.top-menu-search--input.-expanded .scroll-host{max-height:calc(100vh - var(--header-height))}.top-menu-search--input.-expanded .ng-clear-wrapper{width:40px;right:0}.top-menu-search--input.-expanded .ng-select-bottom{height:calc(100vh - var(--header-height));overflow-y:auto;margin:0}.top-menu-search--input.-expanded .ng-select-container{height:36px!important;border-radius:4px}.top-menu-search--input.-expanded .ng-input input{height:36px}.top-menu-search .top-menu-search--back-button{padding:0;margin:0;background:transparent;border:0;font:inherit;text-align:inherit;display:initial;width:50px;text-align:center;color:var(--header-item-font-color)}.top-menu-search .top-menu-search--back-button:hover,.top-menu-search .top-menu-search--back-button:focus,.top-menu-search .top-menu-search--back-button:active{text-decoration:none}.top-menu-search .top-menu-search--loading{top:var(--header-height)1px}.top-menu-search .top-menu-search--button.-input-focused{color:var(--header-item-font-color)}}\n",'.cdk-drag-preview{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.global-search{flex-grow:1}@media screen and (max-width: 679px){.global-search{display:none}}.global-search--option,.global-search--option:hover{padding:5px;line-height:15px;min-height:25px;word-break:break-word;color:var(--body-font-color);text-decoration:none;display:flex}.global-search--option-meta{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}.global-search--search-term{flex-grow:1}.global-search--project-scope{flex-grow:0;flex-shrink:1;border:1px solid var(--button--border-color);font-size:13px;background:var(--button--background-color);border-radius:2px;padding:0 4px;color:var(--body-font-color)}.global-search--principal{margin-right:5px;margin-left:-5px}.global-search--wp-content{display:grid;grid-template-columns:50% 1fr auto;grid-template-areas:"project idlink status";font-size:.8rem;padding:5px 0}.global-search--wp-project{grid-area:project;overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap}.global-search--wp-id{grid-area:idlink;place-self:right;font-style:italic;color:var(--gray-dark);font-size:13px;white-space:nowrap}.global-search--wp-status{grid-area:status;overflow:hidden;font-style:italic}.global-search--wp-subject{font-weight:bold;display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}\n'],encapsulation:2,changeDetection:0});const eu=["sectionBody"],tu=function(g){return{"-expanded":g}};class Ns{constructor(o){this.elementRef=o,this.expanded=!1}ngOnInit(){const o=this.elementRef.nativeElement;this.sectionTitle=o.getAttribute("section-title"),"true"===o.getAttribute("initially-expanded")&&(this.expanded=!0);const s=o.nextElementSibling;this.sectionBody.nativeElement.appendChild(s),s.removeAttribute("hidden")}toggle(o){this.expanded=!this.expanded,o.preventDefault()}}Ns.\u0275fac=function(o){return new(o||Ns)(e.Y36(e.SBq))},Ns.\u0275cmp=e.Xpm({type:Ns,selectors:[["collapsible-section-augment"]],viewQuery:function(o,s){if(1&o&&e.Gf(eu,7),2&o){let w;e.iGM(w=e.CRH())&&(s.sectionBody=w.first)}},decls:5,vars:5,consts:[[1,"collapsible-section",3,"ngClass"],[1,"collapsible-section--toggle-link",3,"click"],[1,"collapsible-section--legend",3,"textContent"],[1,"collapsible-section--body","toggle-slide-animation",3,"hidden"],["sectionBody",""]],template:function(o,s){1&o&&(e.TgZ(0,"section",0),e.TgZ(1,"button",1),e.NdJ("click",function(S){return s.toggle(S)}),e._UZ(2,"span",2),e.qZA(),e._UZ(3,"div",3,4),e.qZA()),2&o&&(e.Q6J("ngClass",e.VKq(3,tu,s.expanded)),e.xp6(2),e.Q6J("textContent",s.sectionTitle),e.xp6(1),e.Q6J("hidden",!s.expanded))},directives:[R.mk],encapsulation:2});var Za=t(85816),nu=t(19028),ou=t(75423),zr=t(48193),su=t(21090),ru=t(87912),Wa=t(93713);const cu=function(g,o){return{"spot-list--item-action_disabled":g,"spot-list--item-action_active":o}};function lu(g,o){if(1&g&&(e.TgZ(0,"a",5),e.ALo(1,"async"),e.TgZ(2,"span",6),e._uU(3),e.qZA(),e.qZA()),2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("ngClass",e.WLB(9,cu,s.disabled,e.lcZ(1,7,w.searchableProjectListService.selectedItemID$)===s.id))("title",s.name)("href",w.extendedProjectUrl(s.id),e.LSH),e.uIk("data-list-selector",w.projectListActionIdentifier)("data-project-id",s.id),e.xp6(2),e.Q6J("opSearchHighlight",w.searchText),e.xp6(1),e.Oqu(s.name)}}const du=function(g){return{"spot-list--item-action_active":g}};function pu(g,o){if(1&g&&(e.TgZ(0,"span",7),e.ALo(1,"async"),e.TgZ(2,"span",8),e._uU(3),e.qZA(),e.qZA()),2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("title",s.name)("ngClass",e.VKq(5,du,e.lcZ(1,3,w.searchableProjectListService.selectedItemID$)===s.id)),e.xp6(3),e.Oqu(s.name)}}function uu(g,o){if(1&g&&e._UZ(0,"ul",9),2&g){const s=e.oxw().$implicit,w=e.oxw();e.Q6J("projects",s.children)("selected",w.selected)("searchText",w.searchText)}}function hu(g,o){if(1&g&&(e.TgZ(0,"li",1),e.YNc(1,lu,4,12,"a",2),e.YNc(2,pu,4,7,"span",3),e.YNc(3,uu,1,3,"ul",4),e.qZA()),2&g){const s=o.$implicit,w=e.oxw();e.uIk("data-list-selector",w.projectListItemIdentifier),e.xp6(1),e.Q6J("ngIf",!s.disabled),e.xp6(1),e.Q6J("ngIf",s.disabled),e.xp6(1),e.Q6J("ngIf",s.children.length)}}class No{constructor(o,s,w,S){this.I18n=o,this.pathHelper=s,this.searchableProjectListService=w,this.elementRef=S,this.classNameList=!0,this.className=!0,this.update=new e.vpe,this.root=!1,this.projects=[],this.searchText="",this.text={does_not_match_search:this.I18n.t("js.include_projects.tooltip.does_not_match_search"),include_all_selected:this.I18n.t("js.include_projects.tooltip.include_all_selected")}}ngOnInit(){this.root&&this.searchableProjectListService.selectedItemID$.subscribe(o=>{requestAnimationFrame(()=>{var s;null===(s=this.elementRef.nativeElement.querySelectorAll(`.spot-list--item-action[data-project-id="${o||""}"]`)[0])||void 0===s||s.scrollIntoView()})})}extendedProjectUrl(o){const s=document.querySelector('meta[name="current_menu_item"]'),w=this.pathHelper.projectPath(o);return s?`${w}?jump=${encodeURIComponent(s.content)}`:w}}No.\u0275fac=function(o){return new(o||No)(e.Y36(y.D),e.Y36(it.j),e.Y36(zr.O),e.Y36(e.SBq))},No.\u0275cmp=e.Xpm({type:No,selectors:[["","op-header-project-select-list",""]],hostVars:6,hostBindings:function(o,s){2&o&&e.ekj("spot-list",s.classNameList)("op-header-project-select-list",s.className)("op-header-project-select-list--root",s.root)},inputs:{root:"root",projects:"projects",searchText:"searchText"},outputs:{update:"update"},attrs:["op-header-project-select-list",""],decls:1,vars:1,consts:[["class","spot-list--item","data-qa-selector","op-header-project-select--item",4,"ngFor","ngForOf"],["data-qa-selector","op-header-project-select--item",1,"spot-list--item"],["tabindex","-1","class","spot-list--item-action",3,"ngClass","title","href",4,"ngIf"],["class","spot-list--item-action spot-list--item-action_disabled",3,"title","ngClass",4,"ngIf"],["op-header-project-select-list","",3,"projects","selected","searchText",4,"ngIf"],["tabindex","-1",1,"spot-list--item-action",3,"ngClass","title","href"],["data-qa-selector","op-header-project-select--item-title",1,"spot-list--item-title","spot-list--item-title_ellipse-text",3,"opSearchHighlight"],[1,"spot-list--item-action","spot-list--item-action_disabled",3,"title","ngClass"],["data-qa-selector","op-header-project-select--item-disabled-title",1,"spot-list--item-title","spot-list--item-title_ellipse-text"],["op-header-project-select-list","",3,"projects","selected","searchText"]],template:function(o,s){1&o&&e.YNc(0,hu,4,4,"li",0),2&o&&e.Q6J("ngForOf",s.projects)},directives:[R.sg,R.O5,R.mk,Wa.U,No],pipes:[R.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}[_nghost-%COMP%], .op-header-project-select-list[_ngcontent-%COMP%]{flex-shrink:1;flex-basis:100%}.op-header-project-select-list--root[_nghost-%COMP%], .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]{overflow-y:auto;scrollbar-color:transparent transparent;scrollbar-width:thin}.op-header-project-select-list--root[_nghost-%COMP%]::-webkit-scrollbar, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]::-webkit-scrollbar{height:10px;width:10px}.op-header-project-select-list--root[_nghost-%COMP%]::-webkit-scrollbar-track, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.op-header-project-select-list--root[_nghost-%COMP%]::-webkit-scrollbar-thumb, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#DDDDDD;visibility:hidden}.op-header-project-select-list--root[_nghost-%COMP%]:hover, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]:hover{scrollbar-color:#DDDDDD transparent}.op-header-project-select-list--root[_nghost-%COMP%]:hover::-webkit-scrollbar-thumb, .op-header-project-select-list.op-header-project-select-list--root[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{visibility:visible}"],changeDetection:0});var _u=t(58);const mu=function(g){return{"spot-list_active":g}};function gu(g,o){if(1&g&&e._UZ(0,"ul",21),2&g){const s=e.oxw(2).ngIf,w=e.oxw();e.Q6J("ngClass",e.VKq(4,mu,w.textFieldFocused))("projects",s)("searchText",w.searchableProjectListService.searchText)("root",!0)}}function fu(g,o){if(1&g&&(e.TgZ(0,"span",22),e._uU(1),e.qZA()),2&g){const s=e.oxw(3);e.xp6(1),e.hij(" ",s.text.no_results," ")}}function vu(g,o){if(1&g&&(e.ynx(0),e.YNc(1,gu,1,6,"ul",19),e.YNc(2,fu,2,1,"ng-template",null,20,e.W1O),e.BQk()),2&g){const s=e.MAs(3),w=e.oxw().ngIf;e.xp6(1),e.Q6J("ngIf",w.length>0)("ngIfElse",s)}}function yu(g,o){if(1&g&&(e.TgZ(0,"a",23),e._UZ(1,"span",24),e._UZ(2,"span",17),e.qZA()),2&g){const s=e.oxw(2);e.Q6J("href",s.newProjectPath(),e.LSH),e.xp6(2),e.Q6J("textContent",s.text.project.singular)}}const Cu=function(){return{standalone:!0}};function bu(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",9),e.TgZ(1,"spot-text-field",10),e.NdJ("ngModelChange",function(S){e.CHM(s);return e.oxw().searchableProjectListService.searchText=S})("keydown",function(S){const fe=e.CHM(s).ngIf;return e.oxw().searchableProjectListService.onKeydown(S,fe)})("inputFocus",function(){e.CHM(s);return e.oxw().textFieldFocused=!0})("inputBlur",function(){e.CHM(s);return e.oxw().textFieldFocused=!1}),e._UZ(2,"span",11),e.qZA(),e.YNc(3,vu,4,2,"ng-container",12),e.ALo(4,"async"),e.TgZ(5,"div",13),e.TgZ(6,"div",14),e.TgZ(7,"a",15),e._UZ(8,"span",16),e._UZ(9,"span",17),e.qZA(),e.YNc(10,yu,3,2,"a",18),e.ALo(11,"async"),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=e.oxw(),w=e.MAs(10);e.xp6(1),e.Q6J("placeholder",s.text.search_placeholder)("ngModel",s.searchableProjectListService.searchText)("ngModelOptions",e.DdM(12,Cu)),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(4,8,s.loading$))("ngIfElse",w),e.xp6(4),e.Q6J("href",s.allProjectsPath(),e.LSH),e.xp6(2),e.Q6J("textContent",s.text.project.list),e.xp6(1),e.Q6J("ngIf",e.lcZ(11,10,s.canCreateNewProjects$))}}function wu(g,o){1&g&&e._UZ(0,"op-loading-project-list",25)}class Qs extends yi.N{constructor(o,s,w,S,ne){super(),this.pathHelper=o,this.I18n=s,this.currentProject=w,this.searchableProjectListService=S,this.currentUserService=ne,this.className=!0,this.dropModalOpen=!1,this.textFieldFocused=!1,this.canCreateNewProjects$=this.currentUserService.hasCapabilities$("projects/create","global"),this.projects$=(0,Ni.aj)([this.searchableProjectListService.allProjects$,this.searchableProjectListService.searchText$.pipe((0,Cr.b)(200))]).pipe((0,Ht.U)(([fe,Ie])=>fe.filter(Ne=>!(Ie.length&&!Ne.name.toLowerCase().includes(Ie.toLowerCase()))).sort((Ne,et)=>Ne._links.ancestors.length-et._links.ancestors.length).reduce((Ne,et)=>{const{ancestors:Dt}=et._links;return(0,nu.r)(fe,et,Ne,Dt)},[])),(0,Ht.U)(fe=>(0,ou.V)(fe)),(0,Nr.d)()),this.text={project:{singular:this.I18n.t("js.label_project"),plural:this.I18n.t("js.label_project_plural"),list:this.I18n.t("js.label_project_list"),select:this.I18n.t("js.label_select_project")},search_placeholder:this.I18n.t("js.include_projects.search_placeholder"),no_results:this.I18n.t("js.include_projects.no_results")},this.loading$=this.searchableProjectListService.fetchingProjects$.pipe((0,hi.h)(fe=>fe),(0,Rn.q)(1),(0,Za.zg)(()=>this.projects$),(0,Za.zg)(()=>this.searchableProjectListService.fetchingProjects$)),this.scrollToCurrent=!1,this.projects$.pipe(this.untilDestroyed()).subscribe(fe=>{this.currentProject.id&&fe.length&&this.scrollToCurrent?this.searchableProjectListService.selectedItemID$.next(parseInt(this.currentProject.id,10)):this.searchableProjectListService.resetActiveResult(fe),this.scrollToCurrent=!1})}toggleDropModal(){this.dropModalOpen=!this.dropModalOpen,this.dropModalOpen&&(this.scrollToCurrent=!0,this.searchableProjectListService.loadAllProjects())}close(){this.searchableProjectListService.searchText="",this.dropModalOpen=!1}currentProjectName(){return null!==this.currentProject.name?this.currentProject.name:this.text.project.select}allProjectsPath(){return this.pathHelper.projectsPath()}newProjectPath(){const o=this.currentProject.id?`?parent_id=${this.currentProject.id}`:"";return`${this.pathHelper.projectsNewPath()}${o}`}}Qs.\u0275fac=function(o){return new(o||Qs)(e.Y36(it.j),e.Y36(y.D),e.Y36(P.R),e.Y36(zr.O),e.Y36(So.S))},Qs.\u0275cmp=e.Xpm({type:Qs,selectors:[["op-header-project-select"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-header-project-select",s.className)},features:[e._Bn([zr.O]),e.qOj],decls:11,vars:6,consts:[["alignment","bottom-left","data-searchable-list-parent","true",1,"op-project-list-modal",3,"open","closed"],["id","projects-menu","accesskey","5","aria-haspopup","true","type","button","slot","trigger",1,"op-app-menu--item-action",3,"click"],[1,"op-app-menu--item-title","ellipsis",3,"textContent"],[1,"op-app-menu--item-dropdown-indicator","button--dropdown-indicator"],["slot","body"],[1,"op-project-list-modal--header"],[1,"op-project-list-modal--title",3,"textContent"],["class","op-project-list-modal--body spot-container",4,"ngIf"],["loadingTemplate",""],[1,"op-project-list-modal--body","spot-container"],["data-qa-selector","op-header-project-select--search","data-modal-focus-catcher-container","true",3,"placeholder","ngModel","ngModelOptions","ngModelChange","keydown","inputFocus","inputBlur"],["slot","before",1,"spot-icon","spot-icon_search"],[4,"ngIf","ngIfElse"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","spot-action-bar--action",3,"href"],[1,"spot-icon","spot-icon_unordered-list"],[3,"textContent"],["class","button -alt-highlight spot-action-bar--action",3,"href",4,"ngIf"],["op-header-project-select-list","","data-list-root","true","data-qa-selector","op-header-project-select--list",3,"ngClass","projects","searchText","root",4,"ngIf","ngIfElse"],["noResultsTemplate",""],["op-header-project-select-list","","data-list-root","true","data-qa-selector","op-header-project-select--list",3,"ngClass","projects","searchText","root"],[1,"op-project-list-modal--no-results"],[1,"button","-alt-highlight","spot-action-bar--action",3,"href"],[1,"spot-icon","spot-icon_add"],[1,"op-project-list-modal--loading"]],template:function(o,s){1&o&&(e.TgZ(0,"spot-drop-modal",0),e.NdJ("closed",function(){return s.close()}),e.TgZ(1,"button",1),e.NdJ("click",function(){return s.toggleDropModal()}),e._UZ(2,"span",2),e._UZ(3,"i",3),e.qZA(),e.ynx(4,4),e.TgZ(5,"div",5),e._UZ(6,"h1",6),e.qZA(),e.YNc(7,bu,12,13,"div",7),e.ALo(8,"async"),e.BQk(),e.YNc(9,wu,1,0,"ng-template",null,8,e.W1O),e.qZA()),2&o&&(e.Q6J("open",s.dropModalOpen),e.xp6(2),e.Q6J("textContent",s.currentProjectName()),e.xp6(4),e.Q6J("textContent",s.text.project.plural),e.xp6(1),e.Q6J("ngIf",e.lcZ(8,4,s.projects$)))},directives:[su.m,R.O5,ru.A,h.JJ,h.On,No,R.mk,_u.a],pipes:[R.Ov],styles:[".op-header-project-select{max-width:100%}\n"],encapsulation:2,changeDetection:0});var Kr=t(33406);class Js{constructor(o,s){this.elementRef=o,this.http=s}ngOnInit(){const o=jQuery(this.elementRef.nativeElement),s=o.parent();this.inputs=s.find(".remote-field--input"),this.target=s.find(".remote-field--target"),this.url=o.data("url"),this.htmlMode="html"===o.data("mode"),this.inputs.on("keyup change",_.debounce(w=>{const S=[Kr.m.TAB,Kr.m.ENTER,Kr.m.SHIFT];("change"===w.type||w.which&&-1===S.indexOf(w.which))&&this.updater()},500))}request(o){const s={};return this.htmlMode?s.Accept="text/html":s.Accept="application/json",this.http.get(this.url,{params:o,headers:s,responseType:this.htmlMode?"text":"json",withCredentials:!0})}updater(){const o={};this.inputs.each((s,w)=>{o[w.dataset.remoteFieldKey]=w.value}),this.request(o).subscribe(s=>{this.htmlMode?this.target.html(s):_.each(s,(w,S)=>{const ne=document.getElementById(S);ne instanceof HTMLInputElement?ne.value=w:ne&&(ne.textContent=w)})})}}Js.\u0275fac=function(o){return new(o||Js)(e.Y36(e.SBq),e.Y36(p.eN))},Js.\u0275cmp=e.Xpm({type:Js,selectors:[["remote-field-updater"]],decls:0,vars:0,template:function(o,s){},encapsulation:2});var Pu=t(75867),xu=t(51705);class cn extends yi.N{constructor(o,s,w,S,ne,fe,Ie,Ne){super(),this.elementRef=o,this.apiV3Service=s,this.I18n=w,this.states=S,this.opStaticQueries=ne,this.mainMenuService=fe,this.cdRef=Ie,this.viewsService=Ne,this.text={search:this.I18n.t("js.global_search.search"),label:this.I18n.t("js.toolbar.search_query_label"),scope_default:this.I18n.t("js.label_default_queries"),scope_starred:this.I18n.t("js.label_starred_queries"),scope_global:this.I18n.t("js.label_global_queries"),scope_private:this.I18n.t("js.label_custom_queries"),no_results:this.I18n.t("js.autocompleter.notFoundText")},this.menuItems=[],this.viewCategories$=new Z.X([]),this.search$=new Z.X(""),this.initialized=!1,(0,wr.E)(this)}set search(o){this.search$.value!==o&&this.search$.next(o)}ngOnInit(){this.apiViewType=`Views::${this.viewType}`,this.mainMenuService.onActivate(...this.menuItems).subscribe(()=>this.initializeAutocomplete()),this.views$=(0,Ni.aj)([this.search$,this.viewCategories$]).pipe((0,Ht.U)(([o,s])=>s.map(w=>{var S;if(cn.matchesText(w.title,o))return w;const ne=null===(S=w.children)||void 0===S?void 0:S.filter(fe=>cn.matchesText(fe.title,o));return{title:w.title,children:ne,collapsible:!0}}).filter(w=>w.children&&w.children.length>0)))}initializeAutocomplete(){var o,s;if(this.initialized)return;const w=null===(s=null===(o=document.getElementById("main-menu-work-packages-wrapper"))||void 0===o?void 0:o.parentElement)||void 0===s?void 0:s.getElementsByClassName("main-menu--arrow-left-to-project")[0];w&&w.focus(),this.updateMenuOnChanges(),this.initializeViews(),this.initialized=!0}static matchesText(o,s){return o.toLowerCase().includes(s.toLowerCase())}initializeViews(){var o,s;const w={starred:[],default:[],public:[],private:[],createNew:[]},S={filters:[["type","=",[this.apiViewType]]],pageSize:we.LZ};this.projectId?null===(o=S.filters)||void 0===o||o.push(["project","=",[this.projectId]]):null===(s=S.filters)||void 0===s||s.push(["project","!*",[]]),this.viewsService.fetchResults(S).pipe(this.untilDestroyed()).subscribe(ne=>{ne.sort((Ne,et)=>Ne._links.query.title.localeCompare(et._links.query.title)).forEach(Ne=>{let et="private";Ne.public&&(et="public"),Ne.starred&&(et="starred"),w[et].push(this.toOpSideMenuItem(Ne))});const fe=this.opStaticQueries.getStaticQueriesForView(this.viewType),Ie=[{title:this.text.scope_starred,children:w.starred,collapsible:!0},{title:this.text.scope_default,children:fe,collapsible:!0},{title:this.text.scope_global,children:w.public,collapsible:!0},{title:this.text.scope_private,children:w.private,collapsible:!0}];this.viewCategories$.next(Ie)})}toOpSideMenuItem(o){const{query:s}=o._links;return{title:s.title,uiSref:this.baseRoute,uiParams:{query_id:(0,Te.Z)(s.href),query_props:""},uiOptions:{reload:!0}}}updateMenuOnChanges(){this.states.changes.queries.pipe(this.untilDestroyed()).subscribe(()=>this.initializeViews())}}cn.\u0275fac=function(o){return new(o||cn)(e.Y36(e.SBq),e.Y36(j.T),e.Y36(y.D),e.Y36(c.G),e.Y36(Pu.p),e.Y36(Wn),e.Y36(e.sBO),e.Y36(xu.s))},cn.\u0275cmp=e.Xpm({type:cn,selectors:[["op-view-select"]],inputs:{menuItems:"menuItems",projectId:"projectId",baseRoute:"baseRoute",viewType:"viewType"},features:[e.qOj],decls:10,vars:12,consts:[["id","viewSelect",1,"searchable-menu"],[1,"searchable-menu--search-container"],[1,"searchable-menu--search-bar"],["for","query-title-filter",1,"hidden-for-sighted",3,"textContent"],["type","text","name","query-title-filter","id","query-title-filter",1,"searchable-menu--search-input","ellipsis",3,"ngModel","ngModelChange"],[1,"icon-search","searchable-menu--search-icon"],[1,"searchable-menu--no-results-container",3,"hidden","textContent"],[1,"op-view-select--search-results",3,"items","collapsible","searchable"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"label",3),e.TgZ(4,"input",4),e.NdJ("ngModelChange",function(S){return s.search=S}),e.qZA(),e._UZ(5,"i",5),e.qZA(),e._UZ(6,"p",6),e.ALo(7,"async"),e._UZ(8,"op-sidemenu",7),e.ALo(9,"async"),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.label),e.xp6(1),e.Q6J("ngModel",s.search),e.uIk("placeholder",s.text.search),e.xp6(2),e.Q6J("hidden",e.lcZ(7,8,s.views$).length>0)("textContent",s.text.no_results),e.xp6(2),e.Q6J("items",e.lcZ(9,10,s.views$))("collapsible",!0)("searchable",!0))},directives:[h.Fj,h.JJ,h.On,Cn],pipes:[R.Ov],encapsulation:2,changeDetection:0});class Qo extends yi.N{constructor(o,s,w,S,ne){super(),this.elementRef=o,this.cdRef=s,this.globalSearchService=w,this.I18n=S,this.injector=ne,this.text={all_projects:this.I18n.t("js.global_search.title.all_projects"),project_and_subprojects:this.I18n.t("js.global_search.title.project_and_subprojects"),search_for:this.I18n.t("js.global_search.title.search_for"),in:this.I18n.t("js.label_in")}}ngOnInit(){(0,Ni.aj)([this.globalSearchService.searchTerm$,this.globalSearchService.projectScope$]).pipe((0,to.x)(),this.untilDestroyed()).subscribe(([o,s])=>{this.searchTerm=o,this.project=this.projectText(s),this.searchTitle=`${this.text.search_for} ${this.searchTerm} ${""===this.project?"":this.text.in} ${this.project}`,this.cdRef.detectChanges()})}projectText(o){const s=this.currentProjectService.name?this.currentProjectService.name:"";switch(o){case"all":return this.text.all_projects;case"current_project":return s;case"":return`${s} ${this.text.project_and_subprojects}`;default:return""}}}function Mu(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",16),e.NdJ("click",function(S){e.CHM(s);const ne=e.oxw().$implicit;return e.oxw().clickTab(ne,S)}),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.ekj("op-tab-row--link_selected",s.id===w.currentTabId)("op-tab-row--link_disabled",void 0!==s.disable),e.Q6J("href",s.path,e.LSH)("textContent",s.name),e.uIk("title",w.tabTitle(s))}}function Iu(g,o){if(1&g&&(e._UZ(0,"op-tab-count",21),e.ALo(1,"async")),2&g){const s=e.oxw(2).$implicit,w=e.oxw();e.Q6J("count",e.lcZ(1,2,s.counter(w.injector))),e.uIk("data-qa-selector","tab-counter-"+s.name)}}function Du(g,o){if(1&g&&(e.TgZ(0,"span",23),e._uU(1),e.qZA()),2&g){const s=e.oxw().ngIf;e.xp6(1),e.hij(" (",s,")")}}function Su(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Du,2,1,"span",22),e.BQk()),2&g){const s=o.ngIf,w=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf",s>0&&!w.showCountAsBubble)}}function Au(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"a",17),e.NdJ("click",function(S){e.CHM(s);const ne=e.oxw().$implicit;return e.oxw().clickTab(ne,S)}),e._UZ(1,"span",18),e.YNc(2,Iu,2,4,"op-tab-count",19),e.YNc(3,Su,2,1,"ng-container",20),e.ALo(4,"async"),e.qZA()}if(2&g){const s=e.oxw().$implicit,w=e.oxw();e.ekj("op-tab-row--link_disabled",void 0!==s.disable),e.Q6J("uiSref",s.route)("uiParams",s.routeParams),e.uIk("title",w.tabTitle(s)),e.xp6(1),e.Q6J("textContent",s.name),e.xp6(1),e.Q6J("ngIf",s.counter&&s.showCountAsBubble),e.xp6(1),e.Q6J("ngIf",e.lcZ(4,8,s.counter(w.injector)))}}function ju(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"li",13),e.NdJ("dragenter",function(){const ne=e.CHM(s).$implicit;return e.oxw().startDebouncedTabActivation(ne)})("dragleave",function(){return e.CHM(s),e.oxw().cancelDebouncedTabActivation()}),e.YNc(1,Mu,1,7,"a",14),e.YNc(2,Au,5,10,"a",15),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.uIk("data-tab-id",s.id)("data-qa-tab-id",s.id)("data-qa-tab-selected",s.id===w.currentTabId||void 0)("data-qa-tab-disabled",s.disable||void 0),e.xp6(1),e.Q6J("ngIf",!s.route),e.xp6(1),e.Q6J("ngIf",s.route)}}Qo.\u0275fac=function(o){return new(o||Qo)(e.Y36(e.SBq),e.Y36(e.sBO),e.Y36(sn),e.Y36(y.D),e.Y36(e.zs3))},Qo.\u0275cmp=e.Xpm({type:Qo,selectors:[["global-search-title"]],inputs:{searchTerm:"searchTerm",project:"project",projectScope:"projectScope",searchTitle:"searchTitle"},features:[e.qOj],decls:11,vars:5,consts:[[1,"toolbar-container"],[1,"toolbar"],[1,"title-container"],[1,"toolbar-items"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"h2"),e._uU(4),e.TgZ(5,"i"),e._uU(6),e.qZA(),e._uU(7),e.TgZ(8,"i"),e._uU(9),e.qZA(),e.qZA(),e._UZ(10,"ul",3),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.uIk("title",s.searchTitle),e.xp6(1),e.hij(" ",s.text.search_for," "),e.xp6(2),e.hij('"',s.searchTerm,'"'),e.xp6(1),e.hij(" ",""===s.project?"":s.text.in," "),e.xp6(2),e.Oqu(s.project))},encapsulation:2}),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",P.R)],Qo.prototype,"currentProjectService",void 0);const Ru=[[["","slot","actions"]]];class Ys extends _i.P{constructor(o,s,w,S){super(s,S,w),this.globalSearchService=o,this.$state=s,this.injector=w,this.classes=["global-search--tabs","scrollable-tabs"]}ngOnInit(){this.currentTabSub=this.globalSearchService.currentTab$.subscribe(o=>{this.currentTabId=o}),this.tabsSub=this.globalSearchService.tabs$.subscribe(o=>{this.tabs=o,this.tabs.map(s=>s.path="#")})}clickTab(o,s){super.clickTab(o,s),this.globalSearchService.currentTab=o.id,this.globalSearchService.submitSearch()}ngOnDestroy(){this.currentTabSub.unsubscribe(),this.tabsSub.unsubscribe()}}Ys.\u0275fac=function(o){return new(o||Ys)(e.Y36(sn),e.Y36(he.StateService),e.Y36(e.zs3),e.Y36(e.sBO))},Ys.\u0275cmp=e.Xpm({type:Ys,selectors:[["global-search-tabs"]],features:[e.qOj],ngContentSelectors:["[slot=actions]"],decls:14,vars:5,consts:[[1,"op-scrollable-tabs",3,"ngClass"],[1,"op-scrollable-tabs--tab-container"],["scrollContainer",""],[1,"op-tab-row",3,"scroll"],["scrollPane",""],["class","op-tab-row--tab",3,"dragenter","dragleave",4,"ngFor","ngForOf","ngForTrackBy"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_left",3,"hidden","click"],["scrollLeftBtn",""],[1,"icon-arrow-left2"],[1,"op-scrollable-tabs--button","op-scrollable-tabs--button_right",3,"hidden","click"],["scrollRightBtn",""],[1,"icon-arrow-right2"],[1,"op-scrollable-tabs--actions"],[1,"op-tab-row--tab",3,"dragenter","dragleave"],["class","op-tab-row--link",3,"href","op-tab-row--link_selected","op-tab-row--link_disabled","textContent","click",4,"ngIf"],["class","op-tab-row--link","uiSrefActive","op-tab-row--link_selected","href","","role","button",3,"uiSref","uiParams","op-tab-row--link_disabled","click",4,"ngIf"],[1,"op-tab-row--link",3,"href","textContent","click"],["uiSrefActive","op-tab-row--link_selected","href","","role","button",1,"op-tab-row--link",3,"uiSref","uiParams","click"],[3,"textContent"],[3,"count",4,"ngIf"],[4,"ngIf"],[3,"count"],["data-qa-selector","tab-count",4,"ngIf"],["data-qa-selector","tab-count"]],template:function(o,s){1&o&&(e.F$t(Ru),e.TgZ(0,"div",0),e.TgZ(1,"div",1,2),e.TgZ(3,"ul",3,4),e.NdJ("scroll",function(){return s.onScroll()}),e.YNc(5,ju,3,6,"li",5),e.qZA(),e.TgZ(6,"div",6,7),e.NdJ("click",function(){return s.scrollLeft()}),e._UZ(8,"span",8),e.qZA(),e.TgZ(9,"div",9,10),e.NdJ("click",function(){return s.scrollRight()}),e._UZ(11,"span",11),e.qZA(),e.qZA(),e.TgZ(12,"ul",12),e.Hsn(13),e.qZA(),e.qZA()),2&o&&(e.Q6J("ngClass",s.classes),e.xp6(5),e.Q6J("ngForOf",s.tabs)("ngForTrackBy",s.trackById),e.xp6(1),e.Q6J("hidden",s.hideLeftButton),e.xp6(3),e.Q6J("hidden",s.hideRightButton))},directives:[R.mk,R.sg,R.O5,Vt.AnchorUISref,Vt.UISrefActive,Vt.UISrefStatus,Vt.UISref],pipes:[R.Ov],encapsulation:2,changeDetection:0});var Wu=t(51784),Lu=t(44265);function Uu(g,o){if(1&g&&e._UZ(0,"op-principal",7),2&g){const s=e.oxw().$implicit;e.Q6J("principal",s)("hideName",!0)}}function Bu(g,o){if(1&g&&(e.YNc(0,Uu,1,2,"op-principal",5),e.TgZ(1,"span",6),e._uU(2),e.qZA()),2&g){const s=o.$implicit,w=o.search;e.Q6J("ngIf",s&&s.href),e.xp6(1),e.Q6J("opSearchHighlight",w),e.xp6(1),e.hij(" ",s.name," ")}}function Nu(g,o){if(1&g&&e._UZ(0,"op-invite-user-button",9),2&g){const s=e.oxw(2);e.Q6J("projectId",s.inviteUserToProject)}}function Qu(g,o){1&g&&e.YNc(0,Nu,1,1,"ng-template",8)}class Bn extends Vr.U{getAvailableUsers(o){return this.http.get(this.url,{params:new p.LE({encoder:new Wu.c,fromObject:{q:o}}),responseType:"json",headers:{"Content-Type":"application/json; charset=utf-8"}})}}Bn.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Bn)))(s||Bn)}}(),Bn.\u0275cmp=e.Xpm({type:Bn,selectors:[["op-members-autocompleter"]],features:[e.qOj],decls:5,vars:12,consts:[[3,"model","openDirectly","getOptionsFn","trackByFn","multiple","labelForId","appendTo","focusDirectly","change","keydown.escape"],["op-autocompleter-option-tmp",""],[4,"ngIf"],["type","hidden",3,"name","value"],["hiddenInput",""],["size","mini",3,"principal","hideName",4,"ngIf"],[3,"opSearchHighlight"],["size","mini",3,"principal","hideName"],["op-autocompleter-footer-tmp",""],[1,"op-select-footer",3,"projectId"]],template:function(o,s){1&o&&(e.TgZ(0,"op-autocompleter",0),e.NdJ("change",function(S){return s.writeValue(S)})("keydown.escape",function(){return s.cancel.emit()}),e.YNc(1,Bu,3,3,"ng-template",1),e.YNc(2,Qu,1,0,void 0,2),e.qZA(),e._UZ(3,"input",3,4)),2&o&&(e.Q6J("model",s.value)("openDirectly",!0)("getOptionsFn",s.getAvailableUsers.bind(s))("trackByFn",s.userTracker)("multiple",s.multiple)("labelForId",s.labelForId)("appendTo",s.appendTo)("openDirectly",s.openDirectly)("focusDirectly",s.focusDirectly),e.xp6(2),e.Q6J("ngIf",s.inviteUserToProject),e.xp6(1),e.Q6J("name",s.name)("value",s.plainValue))},directives:[Hr.s,Fa.u,R.O5,Wa.U,Qt.N,Lu.q],encapsulation:2}),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",p.eN)],Bn.prototype,"http",void 0),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",it.j)],Bn.prototype,"pathHelper",void 0);class Ki{constructor(o){this.injector=o,this.text={edit:this.i18n.t("js.button_edit"),delete:this.i18n.t("js.button_delete"),error:this.i18n.t("js.error.internal"),areYouSure:this.i18n.t("js.text_are_you_sure")}}editTimeEntry(){this.loadEntry().then(o=>{this.timeEntryEditService.edit(o).then(()=>{window.location.reload()}).catch(()=>{})})}deleteTimeEntry(){!window.confirm(this.text.areYouSure)||this.loadEntry().then(o=>{this.apiv3Service.time_entries.id(o).delete().subscribe(()=>window.location.reload(),s=>this.toastService.addError(s||this.text.error))})}loadEntry(){const o=this.elementRef.nativeElement.dataset.entry;return this.apiv3Service.time_entries.id(o).get().toPromise()}}Ki.\u0275fac=function(o){return new(o||Ki)(e.Y36(e.zs3))},Ki.\u0275cmp=e.Xpm({type:Ki,selectors:[["time-entry--trigger-actions-entry"]],features:[e._Bn([De.l,Qe.d])],decls:4,vars:2,consts:[[1,"no-decoration-on-hover",3,"title","click"],["icon-classes","icon-context icon-edit"],["icon-classes","icon-context icon-delete"]],template:function(o,s){1&o&&(e.TgZ(0,"a",0),e.NdJ("click",function(){return s.editTimeEntry()}),e._UZ(1,"op-icon",1),e.qZA(),e.TgZ(2,"a",0),e.NdJ("click",function(){return s.deleteTimeEntry()}),e._UZ(3,"op-icon",2),e.qZA()),2&o&&(e.Q6J("title",s.text.edit),e.xp6(2),e.Q6J("title",s.text.delete))},directives:[ut.o],encapsulation:2,changeDetection:0}),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",Qe.d)],Ki.prototype,"timeEntryEditService",void 0),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",j.T)],Ki.prototype,"apiv3Service",void 0),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",I.kl)],Ki.prototype,"toastService",void 0),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",e.SBq)],Ki.prototype,"elementRef",void 0),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",y.D)],Ki.prototype,"i18n",void 0),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",e.sBO)],Ki.prototype,"cdRef",void 0);var La=t(67731),$s=t(60874),$u=t(90425),Ua=t(45871);class co{constructor(o,s,w,S){this.apiV3Service=o,this.transitions=s,this.currentProject=w,this.I18n=S,this.text={not_found:this.I18n.t("js.editor.macro.attribute_reference.not_found")},this.cache$=(0,Bo.r9)(),s.onStart({},()=>(this.cache$.clear(),!0))}require(o,s){const w=`${o}-${s}`,S=this.cache$.get(w);if(S.isPristine()){const ne=this.load(o,s).pipe((0,hi.h)(fe=>!!fe)).toPromise();return S.clearAndPutFromPromise(ne),ne}return S.values$().pipe((0,Rn.q)(1),(0,Tr.b)(ne=>console.log(`VAL ${ne}`),ne=>console.error(`ERR ${ne}`))).toPromise()}load(o,s){switch(o){case"workPackage":return this.loadWorkPackage(s);case"project":return this.loadProject(s);default:return $u.C}}loadProject(o){return(o=o||this.currentProject.id)?this.apiV3Service.projects.id(o).get().pipe((0,Rn.q)(1)):(0,Ua._)(this.text.not_found)}loadWorkPackage(o){return o?/^[1-9]\d*$/.test(o)?this.apiV3Service.work_packages.id(o).get().pipe((0,Rn.q)(1)):this.apiV3Service.withOptionalProject(this.currentProject.id).work_packages.filterByTypeaheadOrId(o,!1,{pageSize:"1"}).get().pipe((0,Rn.q)(1),(0,Ht.U)(s=>s.elements[0]||null)):(0,Ua._)(this.text.not_found)}}co.\u0275fac=function(o){return new(o||co)(e.LFG(j.T),e.LFG(he.TransitionService),e.LFG(P.R),e.LFG(y.D))},co.\u0275prov=e.Yz7({token:co,factory:co.\u0275fac,providedIn:"root"});const Vu=["displayFieldContainer"];class Jo{constructor(o,s,w){this.injector=o,this.displayFieldService=s,this.schemaCache=w,this.containerType="table",this.displayFieldOptions={}}ngOnInit(){this.schemaCache.ensureLoaded(this.resource).then(o=>{this.render(o[this.fieldName])})}render(o){const s=this.getDisplayFieldInstance(o),w=this.container.nativeElement;w.hidden=!1,s.isEmpty()?w.textContent="-":s.render(w,s.valueString)}getDisplayFieldInstance(o){if(this.displayClass){const s=new this.displayClass(this.fieldName,this.displayFieldContext);return s.apply(this.resource,o),s}return this.displayFieldService.getField(this.resource,this.fieldName,o,this.displayFieldContext)}get displayFieldContext(){return{injector:this.injector,container:this.containerType,options:this.displayFieldOptions}}}Jo.\u0275fac=function(o){return new(o||Jo)(e.Y36(e.zs3),e.Y36($s.i),e.Y36(Ue.y))},Jo.\u0275cmp=e.Xpm({type:Jo,selectors:[["display-field"]],viewQuery:function(o,s){if(1&o&&e.Gf(Vu,5),2&o){let w;e.iGM(w=e.CRH())&&(s.container=w.first)}},inputs:{resource:"resource",fieldName:"fieldName",displayClass:"displayClass",containerType:"containerType",displayFieldOptions:"displayFieldOptions"},decls:2,vars:0,consts:[["displayFieldContainer",""]],template:function(o,s){1&o&&e._UZ(0,"span",null,0)},encapsulation:2,changeDetection:0});const Hu=["displayContainer"];function Ku(g,o){if(1&g&&(e.TgZ(0,"span"),e._UZ(1,"i",2),e._UZ(2,"em",3),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.error)}}const Gu=function(){return{writable:!1}};function qu(g,o){if(1&g&&e._UZ(0,"display-field",4),2&g){const s=e.oxw();e.Q6J("resource",s.resource)("displayFieldOptions",e.DdM(3,Gu))("fieldName",s.fieldName)}}class Vs{constructor(o,s,w,S,ne,fe,Ie){this.elementRef=o,this.injector=s,this.resourceLoader=w,this.schemaCache=S,this.displayField=ne,this.I18n=fe,this.cdRef=Ie,this.error=null,this.text={help:this.I18n.t("js.editor.macro.attribute_reference.macro_help_tooltip"),placeholder:this.I18n.t("js.placeholders.default"),not_found:this.I18n.t("js.editor.macro.attribute_reference.not_found"),invalid_attribute:Ne=>this.I18n.t("js.editor.macro.attribute_reference.invalid_attribute",{name:Ne})},this.hostTitle=this.text.help}ngOnInit(){const o=this.elementRef.nativeElement,s=o.dataset.model,w=o.dataset.id,S=o.dataset.attribute;this.loadAndRender(s,w,S)}loadAndRender(o,s,w){return(0,H.mG)(this,void 0,void 0,function*(){let S;try{S=yield this.resourceLoader.require(o,s)}catch(Ne){return console.error(`Failed to render macro ${Ne}`),this.markError(this.text.not_found)}if(!S)return void this.markError(this.text.not_found);const ne=yield this.schemaCache.ensureLoaded(S),fe=ne.attributeFromLocalizedName(w)||w;ne[fe]?(this.resource=S,this.fieldName=fe):this.markError(this.text.invalid_attribute(w)),this.cdRef.detectChanges()})}markError(o){this.error=this.I18n.t("js.editor.macro.error",{message:o}),this.cdRef.detectChanges()}}Vs.\u0275fac=function(o){return new(o||Vs)(e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(co),e.Y36(Ue.y),e.Y36($s.i),e.Y36(y.D),e.Y36(e.sBO))},Vs.\u0275cmp=e.Xpm({type:Vs,selectors:[["macro",8,"macro--attribute-value"]],viewQuery:function(o,s){if(1&o&&e.Gf(Hu,5),2&o){let w;e.iGM(w=e.CRH())&&(s.displayContainer=w.first)}},hostVars:1,hostBindings:function(o,s){2&o&&e.Ikx("title",s.hostTitle)},features:[e._Bn([De.l])],attrs:["class","macro--attribute-value"],decls:2,vars:2,consts:[[4,"ngIf"],[3,"resource","displayFieldOptions","fieldName",4,"ngIf"],[1,"icon","icon-error"],[3,"textContent"],[3,"resource","displayFieldOptions","fieldName"]],template:function(o,s){1&o&&(e.YNc(0,Ku,3,1,"span",0),e.YNc(1,qu,1,4,"display-field",1)),2&o&&(e.Q6J("ngIf",s.error),e.xp6(1),e.Q6J("ngIf",!!s.resource))},directives:[R.O5,Jo],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}@media screen{[_nghost-%COMP%]{display:inline-block;background:rgba(218,223,225,.19);border:1px solid transparent;padding:2px}[_nghost-%COMP%]:hover{cursor:default;border-color:#c7c7c7;background:rgba(218,223,225,.75)}}"],changeDetection:0});function ih(g,o){if(1&g&&(e.ynx(0),e._UZ(1,"span",1),e._UZ(2,"attribute-help-text",2),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.label),e.xp6(1),e.Q6J("attribute",s.attribute)("attributeScope",s.attributeScope)}}function nh(g,o){if(1&g&&(e.TgZ(0,"span"),e._UZ(1,"i",3),e._UZ(2,"em",1),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.error)}}class Hs{constructor(o,s,w,S,ne,fe,Ie){this.elementRef=o,this.injector=s,this.resourceLoader=w,this.schemaCache=S,this.displayField=ne,this.I18n=fe,this.cdRef=Ie,this.error=null,this.text={help:this.I18n.t("js.editor.macro.attribute_reference.macro_help_tooltip"),not_found:this.I18n.t("js.editor.macro.attribute_reference.not_found"),invalid_attribute:Ne=>this.I18n.t("js.editor.macro.attribute_reference.invalid_attribute",{name:Ne})},this.hostTitle=this.text.help,this.resource=null}ngOnInit(){const o=this.elementRef.nativeElement,s=o.dataset.model,w=o.dataset.id,S=o.dataset.attribute;var g;this.attributeScope=(g=s).charAt(0).toUpperCase()+g.slice(1),this.loadResourceAttribute(s,w,S)}loadResourceAttribute(o,s,w){var S;return(0,H.mG)(this,void 0,void 0,function*(){let ne;try{this.resource=ne=yield this.resourceLoader.require(o,s)}catch(Ie){return console.error(`Failed to render macro ${Ie}`),this.markError(this.text.not_found)}if(!ne)return void this.markError(this.text.not_found);const fe=yield this.schemaCache.ensureLoaded(ne);this.attribute=fe.attributeFromLocalizedName(w)||w,this.label=null===(S=fe[this.attribute])||void 0===S?void 0:S.name,this.label||this.markError(this.text.invalid_attribute(w)),this.cdRef.detectChanges()})}markError(o){this.error=this.I18n.t("js.editor.macro.error",{message:o}),this.cdRef.detectChanges()}}Hs.\u0275fac=function(o){return new(o||Hs)(e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(co),e.Y36(Ue.y),e.Y36($s.i),e.Y36(y.D),e.Y36(e.sBO))},Hs.\u0275cmp=e.Xpm({type:Hs,selectors:[["macro",8,"macro--attribute-label"]],hostVars:1,hostBindings:function(o,s){2&o&&e.Ikx("title",s.hostTitle)},features:[e._Bn([De.l])],attrs:["class","macro--attribute-label"],decls:2,vars:2,consts:[[4,"ngIf"],[3,"textContent"],[3,"attribute","attributeScope"],[1,"icon","icon-error"]],template:function(o,s){1&o&&(e.YNc(0,ih,3,3,"ng-container",0),e.YNc(1,nh,3,1,"span",0)),2&o&&(e.Q6J("ngIf",s.resource),e.xp6(1),e.Q6J("ngIf",s.error))},directives:[R.O5,ui.y],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}@media screen{[_nghost-%COMP%]{display:inline-block;background:rgba(218,223,225,.19);border:1px solid transparent;padding:2px}[_nghost-%COMP%]:hover{cursor:default;border-color:#c7c7c7;background:rgba(218,223,225,.75)}}"],changeDetection:0});var sh=t(74215);const zs=function(){return{writable:!1}};function ah(g,o){if(1&g&&e._UZ(0,"display-field",5),2&g){const s=e.oxw().ngIf;e.Q6J("resource",s)("displayFieldOptions",e.DdM(2,zs))}}function ch(g,o){if(1&g&&e._UZ(0,"display-field",8),2&g){const s=e.oxw(2).ngIf;e.Q6J("resource",s)("displayFieldOptions",e.DdM(2,zs))}}function lh(g,o){if(1&g&&e._UZ(0,"display-field",9),2&g){const s=e.oxw(2).ngIf,w=e.oxw();e.Q6J("resource",s)("displayFieldOptions",e.DdM(3,zs))("displayClass",w.dateDisplayField)}}function dh(g,o){if(1&g&&(e.ynx(0),e._uU(1," ("),e.YNc(2,ch,1,3,"display-field",6),e.YNc(3,lh,1,4,"display-field",7),e._uU(4,") "),e.BQk()),2&g){const s=e.oxw().ngIf;e.xp6(2),e.Q6J("ngIf",!!s.date),e.xp6(1),e.Q6J("ngIf",!s.date)}}function ph(g,o){if(1&g&&(e.ynx(0),e.YNc(1,ah,1,3,"display-field",1),e._UZ(2,"display-field",2),e.TgZ(3,"a",3),e._uU(4),e.qZA(),e._UZ(5,"display-field",4),e.YNc(6,dh,5,2,"ng-container",0),e.BQk()),2&g){const s=o.ngIf,w=e.oxw();e.xp6(1),e.Q6J("ngIf",w.detailed),e.xp6(1),e.Q6J("resource",s)("displayFieldOptions",e.DdM(9,zs)),e.xp6(1),e.Q6J("href",w.workPackageLink,e.LSH),e.uIk("data-work-package-id",s.id),e.xp6(1),e.hij(" #",s.id,": "),e.xp6(1),e.Q6J("resource",s)("displayFieldOptions",e.DdM(10,zs)),e.xp6(1),e.Q6J("ngIf",w.detailed)}}function uh(g,o){if(1&g&&(e.TgZ(0,"span"),e._UZ(1,"i",10),e._UZ(2,"em",11),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.error)}}class Ks{constructor(o,s,w,S,ne,fe,Ie,Ne){this.elementRef=o,this.injector=s,this.apiV3Service=w,this.schemaCache=S,this.displayField=ne,this.pathHelper=fe,this.I18n=Ie,this.cdRef=Ne,this.error=null,this.text={not_found:this.I18n.t("js.editor.macro.attribute_reference.not_found"),help:this.I18n.t("js.editor.macro.attribute_reference.macro_help_tooltip")},this.hostTitle=this.text.help,this.dateDisplayField=sh.Z,this.detailed=!1}ngOnInit(){const o=this.elementRef.nativeElement,s=o.dataset.id;this.detailed="true"===o.dataset.detailed,this.workPackageLink=this.pathHelper.workPackagePath(s),this.workPackage$=this.apiV3Service.work_packages.id(s).get().pipe((0,Tr.b)({error:w=>this.markError(this.text.not_found)}))}markError(o){console.error(`Failed to render macro ${o}`),this.error=this.I18n.t("js.editor.macro.error",{message:o}),this.cdRef.detectChanges()}}Ks.\u0275fac=function(o){return new(o||Ks)(e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(j.T),e.Y36(Ue.y),e.Y36($s.i),e.Y36(it.j),e.Y36(y.D),e.Y36(e.sBO))},Ks.\u0275cmp=e.Xpm({type:Ks,selectors:[["macro",8,"macro--wp-quickinfo"]],hostVars:1,hostBindings:function(o,s){2&o&&e.Ikx("title",s.hostTitle)},features:[e._Bn([De.l])],attrs:["class","macro--wp-quickinfo"],decls:3,vars:4,consts:[[4,"ngIf"],["fieldName","status",3,"resource","displayFieldOptions",4,"ngIf"],["fieldName","type",3,"resource","displayFieldOptions"],[1,"work-package--quickinfo","preview-trigger",3,"href"],["fieldName","subject",3,"resource","displayFieldOptions"],["fieldName","status",3,"resource","displayFieldOptions"],["fieldName","date",3,"resource","displayFieldOptions",4,"ngIf"],["fieldName","startDate",3,"resource","displayFieldOptions","displayClass",4,"ngIf"],["fieldName","date",3,"resource","displayFieldOptions"],["fieldName","startDate",3,"resource","displayFieldOptions","displayClass"],[1,"icon","icon-error"],[3,"textContent"]],template:function(o,s){1&o&&(e.YNc(0,ph,7,11,"ng-container",0),e.ALo(1,"async"),e.YNc(2,uh,3,1,"span",0)),2&o&&(e.Q6J("ngIf",e.lcZ(1,2,s.workPackage$)),e.xp6(2),e.Q6J("ngIf",s.error))},directives:[R.O5,Jo],pipes:[R.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}@media screen{[_nghost-%COMP%]{display:inline-block;background:rgba(218,223,225,.19);border:1px solid transparent;padding:2px}[_nghost-%COMP%]:hover{cursor:default;border-color:#c7c7c7;background:rgba(218,223,225,.75)}}display-field[_ngcontent-%COMP%]{padding-right:2px}"],changeDetection:0});var Ba=t(96091),_h=t(18137);class lo{constructor(o){this.apiV3Service=o}triggerBackup(o,s=!0){return this.apiV3Service.backups.post(o,s)}}lo.\u0275fac=function(o){return new(o||lo)(e.LFG(j.T))},lo.\u0275prov=e.Yz7({token:lo,factory:lo.\u0275fac,providedIn:"root"});const mh=["backupTokenInput"];class Yo{constructor(o,s,w,S,ne,fe){this.elementRef=o,this.injector=s,this.i18n=w,this.toastService=S,this.opModalService=ne,this.pathHelper=fe,this.text={info:this.i18n.t("js.backup.info"),note:this.i18n.t("js.backup.note"),title:this.i18n.t("js.backup.title"),lastBackup:this.i18n.t("js.backup.last_backup"),lastBackupFrom:this.i18n.t("js.backup.last_backup_from"),includeAttachments:this.i18n.t("js.backup.include_attachments"),options:this.i18n.t("js.backup.options"),downloadBackup:this.i18n.t("js.backup.download_backup"),requestBackup:this.i18n.t("js.backup.request_backup"),attachmentsDisabled:this.i18n.t("js.backup.attachments_disabled")},this.jobStatusId=this.elementRef.nativeElement.dataset.jobStatusId,this.lastBackupDate=this.elementRef.nativeElement.dataset.lastBackupDate,this.lastBackupAttachmentId=this.elementRef.nativeElement.dataset.lastBackupAttachmentId,this.mayIncludeAttachments="false"!=this.elementRef.nativeElement.dataset.mayIncludeAttachments,this.isInProgress=!1,this.includeAttachments=!0,this.backupToken="",this.includeAttachments=this.mayIncludeAttachments}ngAfterViewInit(){this.backupTokenInput.nativeElement.focus()}isDownloadReady(){return void 0!==this.jobStatusId&&""!==this.jobStatusId&&void 0!==this.lastBackupAttachmentId&&""!==this.lastBackupAttachmentId}getDownloadUrl(){return this.pathHelper.attachmentDownloadPath(this.lastBackupAttachmentId,void 0)}includeAttachmentsDefault(){return this.mayIncludeAttachments}includeAttachmentsTitle(){return this.mayIncludeAttachments?"":this.text.attachmentsDisabled}triggerBackup(o){o&&(o.stopPropagation(),o.preventDefault());const{backupToken:s}=this;this.backupToken="",this.opBackup.triggerBackup(s,this.includeAttachments).subscribe(w=>{this.jobStatusId=w.jobStatusId,this.opModalService.show(_h.L,"global",{jobId:w.jobStatusId})},w=>{this.toastService.addError(w.message)})}}Yo.\u0275fac=function(o){return new(o||Yo)(e.Y36(e.SBq),e.Y36(e.zs3),e.Y36(y.D),e.Y36(I.kl),e.Y36(lt.S),e.Y36(it.j))},Yo.\u0275cmp=e.Xpm({type:Yo,selectors:[["backup"]],viewQuery:function(o,s){if(1&o&&e.Gf(mh,5),2&o){let w;e.iGM(w=e.CRH())&&(s.backupTokenInput=w.first)}},decls:41,vars:17,consts:[["method","get",1,"form","-bordered","-compressed",3,"action","hidden"],[1,"form--section"],[1,"form--section-title"],[1,"form--field"],[1,"form--label"],[1,"form--field-container"],[1,"form--text-field-container"],["name","button","type","submit",1,"button"],[1,"button--icon","icon-save"],[1,"button--text"],["action","#",1,"form","danger-zone"],[1,"wiki"],[1,"danger-zone--warning"],[1,"icon","icon-error"],[1,"form--fieldset"],[1,"form--fieldset-legend"],[1,"form--label-with-check-box",3,"title"],[1,"form--check-box-container"],["type","checkbox",1,"form--check-box",3,"checked","disabled","change"],[1,"danger-zone--verification"],["type","password","name","backupToken","placeholder","Backup token","required","required",3,"value","input"],["backupTokenInput",""],["name","button","type","submit",1,"-highlight","button",3,"disabled","click"],[1,"button--icon","icon-export"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.TgZ(1,"section",1),e.TgZ(2,"h3",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.TgZ(5,"label",4),e._uU(6),e.qZA(),e.TgZ(7,"div",5),e.TgZ(8,"div",6),e.TgZ(9,"em"),e._uU(10),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"button",7),e._UZ(12,"i",8),e.TgZ(13,"span",9),e._uU(14),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(15,"form",10),e.TgZ(16,"div",11),e.TgZ(17,"section",1),e.TgZ(18,"h3",2),e._uU(19),e.qZA(),e.TgZ(20,"p"),e._uU(21),e.qZA(),e.TgZ(22,"p",12),e._UZ(23,"span",13),e.TgZ(24,"span"),e._uU(25),e.qZA(),e.qZA(),e.TgZ(26,"div"),e.TgZ(27,"fieldset",14),e.TgZ(28,"legend",15),e._uU(29),e.qZA(),e.TgZ(30,"label",16),e.TgZ(31,"div",17),e.TgZ(32,"input",18),e.NdJ("change",function(){return s.includeAttachments=!s.includeAttachments}),e.qZA(),e.qZA(),e._uU(33),e.qZA(),e.qZA(),e.qZA(),e.TgZ(34,"div",19),e.TgZ(35,"input",20,21),e.NdJ("input",function(S){return s.backupToken=S.target.value}),e.qZA(),e.TgZ(37,"button",22),e.NdJ("click",function(S){return s.triggerBackup(S)}),e._UZ(38,"i",23),e.TgZ(39,"span",9),e._uU(40),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("action",s.getDownloadUrl(),e.LSH)("hidden",!s.isDownloadReady()),e.xp6(3),e.hij(" ",s.text.lastBackup," "),e.xp6(3),e.hij("",s.text.lastBackupFrom,":"),e.xp6(4),e.Oqu(s.lastBackupDate),e.xp6(4),e.Oqu(s.text.downloadBackup),e.xp6(5),e.hij(" ",s.text.title," "),e.xp6(2),e.hij(" ",s.text.info," "),e.xp6(4),e.Oqu(s.text.note),e.xp6(4),e.hij(" ",s.text.options," "),e.xp6(1),e.Q6J("title",s.includeAttachmentsTitle()),e.xp6(2),e.Q6J("checked",s.includeAttachments)("disabled",!s.mayIncludeAttachments),e.xp6(1),e.hij(" ",s.text.includeAttachments," "),e.xp6(2),e.Q6J("value",s.backupToken),e.xp6(2),e.Q6J("disabled",0==s.backupToken.length),e.xp6(3),e.Oqu(s.text.requestBackup))},encapsulation:2}),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",lo)],Yo.prototype,"opBackup",void 0);var fh=t(42320),vh=t(3606);function yh(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"p"),e._uU(2),e.qZA(),e.TgZ(3,"p",3),e._uU(4),e.qZA(),e.TgZ(5,"p"),e.TgZ(6,"span",3),e._uU(7),e.qZA(),e._UZ(8,"br"),e.TgZ(9,"span"),e._uU(10),e.qZA(),e.qZA(),e.TgZ(11,"button",4),e.NdJ("click",function(){return e.CHM(s),e.oxw().openTrialModal()}),e._uU(12),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(2),e.Oqu(s.text.enterprise_edition),e.xp6(2),e.Oqu(s.text.confidence),e.xp6(3),e.Oqu(s.text.become_hero),e.xp6(3),e.Oqu(s.text.you_contribute),e.xp6(2),e.hij(" ",s.text.button_trial," ")}}function Ch(g,o){if(1&g){const s=e.EpF();e._UZ(0,"enterprise-trial-waiting"),e.TgZ(1,"p",5),e._uU(2),e.TgZ(3,"a",6),e.NdJ("click",function(){return e.CHM(s),e.oxw().openTrialModal()}),e._uU(4),e.qZA(),e.qZA()}if(2&g){const s=e.oxw();e.xp6(2),e.hij("",s.text.email_not_received," "),e.xp6(2),e.Oqu(s.text.try_another_email)}}class Gs{constructor(o,s,w,S){this.I18n=o,this.opModalService=s,this.injector=w,this.eeTrialService=S,this.text={button_trial:this.I18n.t("js.admin.enterprise.upsale.button_start_trial"),button_book:this.I18n.t("js.admin.enterprise.upsale.button_book_now"),link_quote:this.I18n.t("js.admin.enterprise.upsale.link_quote"),become_hero:this.I18n.t("js.admin.enterprise.upsale.become_hero"),you_contribute:this.I18n.t("js.admin.enterprise.upsale.you_contribute"),email_not_received:this.I18n.t("js.admin.enterprise.trial.email_not_received"),enterprise_edition:this.I18n.t("js.admin.enterprise.upsale.text"),confidence:this.I18n.t("js.admin.enterprise.upsale.confidence"),try_another_email:this.I18n.t("js.admin.enterprise.trial.try_another_email")}}openTrialModal(){this.eeTrialService.store.update({cancelled:!0,modalOpen:!0}),this.opModalService.show(fh.$,this.injector)}get noTrialRequested(){return void 0===window.gon.ee_trial_key}}Gs.\u0275fac=function(o){return new(o||Gs)(e.Y36(y.D),e.Y36(lt.S),e.Y36(e.zs3),e.Y36(Ta.V))},Gs.\u0275cmp=e.Xpm({type:Gs,selectors:[["enterprise-base"]],decls:4,vars:2,consts:[[1,"op-enterprise-base"],[4,"ngIf","ngIfElse"],["alreadyRequested",""],[1,"-bold"],[1,"button","-alt-highlight",3,"click"],[1,"op-enterprise-base--confirmation-hint"],[3,"click"]],template:function(o,s){if(1&o&&(e.TgZ(0,"div",0),e.YNc(1,yh,13,5,"div",1),e.YNc(2,Ch,5,2,"ng-template",null,2,e.W1O),e.qZA()),2&o){const w=e.MAs(3);e.xp6(1),e.Q6J("ngIf",s.noTrialRequested)("ngIfElse",w)}},directives:[R.O5,vh.c],styles:[".op-enterprise-base[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{float:left}.op-enterprise-base--confirmation-hint[_ngcontent-%COMP%]{font-size:.9em;font-style:italic;margin-bottom:2rem}"]});var Na=t(12839),Qa=t(54547),wh=t(72456);function Th(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_company)}}function kh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.company)}}function Ph(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_domain)}}function xh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.domain)}}function Eh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_maximum_users)}}function Oh(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.userCount)}}function Mh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_starts_at)}}function Ih(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.startsAt)}}function Dh(g,o){if(1&g&&e._UZ(0,"div",3),2&g){const s=e.oxw();e.Q6J("textContent",s.text.label_expires_at)}}function Sh(g,o){if(1&g&&e._UZ(0,"span",10),2&g){const s=e.oxw(2);e.Q6J("textContent",s.expiredWarningText)}}function Ah(g,o){if(1&g&&(e.TgZ(0,"div",4),e.TgZ(1,"div",5),e._UZ(2,"span",6),e.YNc(3,Sh,1,1,"span",9),e.qZA(),e.qZA()),2&g){const s=e.oxw();e.xp6(2),e.Q6J("textContent",s.expiresAt),e.xp6(1),e.Q6J("ngIf",s.isExpired)}}class qs extends wh.${constructor(o,s){super(s),this.elementRef=o,this.I18n=s,this.subscriber=this.elementRef.nativeElement.dataset.subscriber,this.email=this.elementRef.nativeElement.dataset.email,this.company=this.elementRef.nativeElement.dataset.company,this.domain=this.elementRef.nativeElement.dataset.domain,this.userCount=this.elementRef.nativeElement.dataset.userCount,this.startsAt=this.elementRef.nativeElement.dataset.startsAt,this.expiresAt=this.elementRef.nativeElement.dataset.expiresAt,this.isExpired="true"===this.elementRef.nativeElement.dataset.isExpired,this.reprieveDaysLeft=this.elementRef.nativeElement.dataset.reprieveDaysLeft}get expiredWarningText(){let o=this.text.text_expired;return this.reprieveDaysLeft&&this.reprieveDaysLeft>0&&(o=`${o}: ${this.text.text_reprieve_days_left(this.reprieveDaysLeft)}`),o}}qs.\u0275fac=function(o){return new(o||qs)(e.Y36(e.SBq),e.Y36(y.D))},qs.\u0275cmp=e.Xpm({type:qs,selectors:[["enterprise-active-saved-trial"]],features:[e.qOj],decls:21,vars:14,consts:[["data-qa-selector","op-enterprise--active-token",1,"op-enterprise--active-token"],[1,"attributes-group"],[1,"attributes-key-value"],[1,"attributes-key-value--key",3,"textContent"],[1,"attributes-key-value--value-container"],[1,"attributes-key-value--value","-text"],[3,"textContent"],["class","attributes-key-value--key",3,"textContent",4,"ngIf"],["class","attributes-key-value--value-container",4,"ngIf"],["class","expired-warning",3,"textContent",4,"ngIf"],[1,"expired-warning",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"div",3),e.TgZ(4,"div",4),e.TgZ(5,"div",5),e._UZ(6,"span",6),e.qZA(),e.qZA(),e._UZ(7,"div",3),e.TgZ(8,"div",4),e.TgZ(9,"div",5),e._UZ(10,"span",6),e.qZA(),e.qZA(),e.YNc(11,Th,1,1,"div",7),e.YNc(12,kh,3,1,"div",8),e.YNc(13,Ph,1,1,"div",7),e.YNc(14,xh,3,1,"div",8),e.YNc(15,Eh,1,1,"div",7),e.YNc(16,Oh,3,1,"div",8),e.YNc(17,Mh,1,1,"div",7),e.YNc(18,Ih,3,1,"div",8),e.YNc(19,Dh,1,1,"div",7),e.YNc(20,Ah,4,2,"div",8),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.Q6J("textContent",s.text.label_subscriber),e.xp6(3),e.Q6J("textContent",s.subscriber),e.xp6(1),e.Q6J("textContent",s.text.label_email),e.xp6(3),e.Q6J("textContent",s.email),e.xp6(1),e.Q6J("ngIf",s.company),e.xp6(1),e.Q6J("ngIf",s.company),e.xp6(1),e.Q6J("ngIf",s.domain),e.xp6(1),e.Q6J("ngIf",s.domain),e.xp6(1),e.Q6J("ngIf",s.userCount),e.xp6(1),e.Q6J("ngIf",s.userCount),e.xp6(1),e.Q6J("ngIf",s.startsAt),e.xp6(1),e.Q6J("ngIf",s.startsAt),e.xp6(1),e.Q6J("ngIf",s.expiresAt),e.xp6(1),e.Q6J("ngIf",s.expiresAt))},directives:[R.O5],styles:[".op-enterprise--active-token[_ngcontent-%COMP%]   .attributes-group[_ngcontent-%COMP%]{margin-bottom:1.25rem}.op-enterprise--active-token[_ngcontent-%COMP%]   .expired-warning[_ngcontent-%COMP%]{margin-left:.4rem;color:red;font-weight:bold}"],changeDetection:0});class Xs{constructor(o,s){this.i18n=o,this.domSanitizer=s,this.new_features_image=(0,Qr.h)("12_4_features.png"),this.text={newFeatures:this.i18n.t("js.label_new_features"),descriptionNewFeatures:this.i18n.t("js.homescreen.blocks.new_features.text_new_features"),learnAbout:this.i18n.t("js.homescreen.blocks.new_features.learn_about")},this.isStandardEdition=window.OpenProject.isStandardEdition}get teaserWebsiteUrl(){const o=this.translated("learn_about_link");return this.domSanitizer.bypassSecurityTrustResourceUrl(o)}get currentNewFeatureHtml(){return this.translated("new_features_html")}translated(o){return this.i18n.t(`js.homescreen.blocks.new_features.12_4.${this.isStandardEdition?"standard":"bim"}.${o}`,{list_styling_class:"widget-box--arrow-links",bcf_api_link:"https://github.com/opf/openproject/blob/dev/docs/api/bcf/bcf-rest-api.md"})}}Xs.\u0275fac=function(o){return new(o||Xs)(e.Y36(y.D),e.Y36(n.H7))},Xs.\u0275cmp=e.Xpm({type:Xs,selectors:[["homescreen-new-features-block"]],decls:8,vars:5,consts:[[1,"op-new-features"],[1,"widget-box--additional-info"],[1,"widget-box--description"],[3,"innerHtml"],[1,"widget-box--teaser-image","op-new-features--teaser-image",3,"src"],["target","_blank",3,"href"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"p",1),e._uU(2),e.qZA(),e.TgZ(3,"div",2),e._UZ(4,"p",3),e._UZ(5,"img",4),e.qZA(),e.TgZ(6,"a",5),e._uU(7),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.hij(" ",s.text.descriptionNewFeatures," "),e.xp6(2),e.Q6J("innerHtml",s.currentNewFeatureHtml,e.oJD),e.xp6(1),e.Q6J("src",s.new_features_image,e.LSH),e.xp6(1),e.Q6J("href",s.teaserWebsiteUrl,e.LSH),e.xp6(1),e.Oqu(s.text.learnAbout))},styles:[".op-new-features--teaser-image[_ngcontent-%COMP%]{background-image:var(--new-feature-teaser-image);min-width:170px;background-size:contain;background-repeat:no-repeat;background-position-x:right}"],changeDetection:0});var Ja=t(83835);function Wh(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"button",1),e.NdJ("click",function(S){return e.CHM(s),e.oxw().toggle(S)}),e._UZ(1,"op-icon",2),e._UZ(2,"op-icon",3),e.qZA()}if(2&g){const s=e.oxw();e.uIk("title",s.toggleTitle)}}class $o extends yi.N{constructor(o,s,w,S,ne){super(),this.topMenu=o,this.toggleService=s,this.cdRef=w,this.deviceService=S,this.injector=ne,this.toggleTitle=""}ngOnInit(){this.toggleService.initializeMenu(),this.toggleService.titleData$.pipe((0,to.x)(),this.untilDestroyed()).subscribe(o=>{this.toggleTitle=o,this.cdRef.detectChanges()})}toggle(o){this.toggleService.toggleNavigation(o),this.topMenu.close()}}$o.\u0275fac=function(o){return new(o||$o)(e.Y36(ao),e.Y36(Ja.J),e.Y36(e.sBO),e.Y36(z.U),e.Y36(e.zs3))},$o.\u0275cmp=e.Xpm({type:$o,selectors:[["main-menu-toggle"]],hostAttrs:[1,"op-app-menu","op-main-menu-toggle"],features:[e.qOj],decls:1,vars:1,consts:[["class","op-app-menu--item-action","id","main-menu-toggle","aria-haspopup","true","type","button",3,"click",4,"ngIf"],["id","main-menu-toggle","aria-haspopup","true","type","button",1,"op-app-menu--item-action",3,"click"],["aria-hidden","true",1,"icon-hamburger"],["aria-hidden","true",1,"icon-close"]],template:function(o,s){1&o&&e.YNc(0,Wh,3,1,"button",0),2&o&&e.Q6J("ngIf",null!==s.currentProject.id||s.deviceService.isMobile)},directives:[R.O5,ut.o],encapsulation:2,changeDetection:0}),(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",P.R)],$o.prototype,"currentProject",void 0);class er extends yi.N{constructor(o,s,w){super(),this.toggleService=o,this.cdRef=s,this.elementRef=w,this.mainMenu=jQuery("#main-menu")[0],this.moving=!1}ngOnInit(){this.toggleService.titleData$.pipe((0,to.x)(),this.untilDestroyed()).subscribe(o=>{this.toggleTitle=o,this.cdRef.detectChanges()}),this.resizeEvent="main-menu-resize",this.localStorageKey="openProject-mainMenuWidth"}resizeStart(){this.elementWidth=this.mainMenu.clientWidth}resizeMove(o){this.toggleService.saveWidth(this.elementWidth+o.absolute.x)}resizeEnd(){const o=new Event(this.resizeEvent);window.dispatchEvent(o)}}er.\u0275fac=function(o){return new(o||er)(e.Y36(Ja.J),e.Y36(e.sBO),e.Y36(e.SBq))},er.\u0275cmp=e.Xpm({type:er,selectors:[["main-menu-resizer"]],features:[e.qOj],decls:4,vars:5,consts:[[1,"main-menu--resizer",3,"customHandler","cursorClass","end","start","move"],[1,"resizer-toggle-container"],[1,"spot-link","main-menu--navigation-toggler",3,"click"],["icon-classes","icon-resizer-vertical-lines"]],template:function(o,s){1&o&&(e.TgZ(0,"resizer",0),e.NdJ("end",function(){return s.resizeEnd()})("start",function(){return s.resizeStart()})("move",function(S){return s.resizeMove(S)}),e.TgZ(1,"div",1),e.TgZ(2,"button",2),e.NdJ("click",function(S){return s.toggleService.toggleNavigation(S)}),e._UZ(3,"op-icon",3),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.Q6J("customHandler",!0)("cursorClass","col-resize"),e.xp6(2),e.ekj("open",s.toggleService.showNavigation),e.uIk("title",s.toggleTitle))},directives:[ma.d,ut.o],encapsulation:2});var Ya=t(5275);class tr{constructor(o,s,w,S,ne){this.elementRef=o,this.I18n=s,this.cdRef=w,this.urlParamsHelper=S,this.externalQuery=ne,this.urlParams=!1,this.text={edit_query:this.I18n.t("js.admin.type_form.edit_query")}}ngOnInit(){const o=this.elementRef.nativeElement;this.id=o.dataset.id,this.name=o.dataset.name,this.urlParams="true"===o.dataset.urlParams,this.queryProps=o.dataset.query}editQuery(){const o=(()=>{if(this.urlParams)return this.queryProps;try{return JSON.parse(this.queryProps)}catch(s){return console.error(`Failed to parse query props from ${this.queryProps}: ${s}`),{}}})();this.externalQuery.show({currentQuery:o,urlParams:this.urlParams,callback:s=>{this.queryProps=this.urlParams?s:JSON.stringify(s),this.cdRef.detectChanges()}})}}tr.\u0275fac=function(o){return new(o||tr)(e.Y36(e.SBq),e.Y36(y.D),e.Y36(e.sBO),e.Y36(vt.Z),e.Y36(Ya.W))},tr.\u0275cmp=e.Xpm({type:tr,selectors:[["editable-query-props"]],decls:2,vars:4,consts:[["type","hidden",3,"value"],["type","button",1,"spot-link",3,"textContent","click"]],template:function(o,s){1&o&&(e._UZ(0,"input",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return s.editQuery()}),e.qZA()),2&o&&(e.Q6J("value",s.queryProps),e.uIk("name",s.name||void 0)("id",s.id||void 0),e.xp6(1),e.Q6J("textContent",s.text.edit_query))},encapsulation:2,changeDetection:0});var Nh=t(89919),$a=t(12702),Qh=t(86664),Jh=t(13623);function Yh(g,o){if(1&g&&(e._UZ(0,"span",4),e.ALo(1,"async")),2&g){const s=e.oxw(2);e.Q6J("textContent",e.lcZ(1,1,s.unreadCountText$))}}function $h(g,o){if(1&g&&(e.ynx(0),e.YNc(1,Yh,2,3,"span",3),e.BQk()),2&g){const s=o.ngIf;e.xp6(1),e.Q6J("ngIf",0!==s)}}class ir{constructor(o,s,w,S){this.storeService=o,this.apiV3Service=s,this.activeWindow=w,this.pathHelper=S,this.polling$=(0,Nh.T)((0,$a.H)(10,1e4).pipe((0,hi.h)(()=>this.activeWindow.isActive)),(0,$a.H)(10,12e4).pipe((0,hi.h)(()=>!this.activeWindow.isActive))).pipe((0,_a.p)(1e4),(0,je.w)(()=>this.storeService.fetchUnread())),this.unreadCount$=(0,Ni.aj)([this.storeService.unread$,this.polling$]).pipe((0,Ht.U)(([ne])=>ne),(0,Nr.d)(1)),this.unreadCountText$=this.unreadCount$.pipe((0,Ht.U)(ne=>ne>99?"99+":ne<=0?"":ne))}notificationsPath(){return this.pathHelper.notificationsPath()}}ir.\u0275fac=function(o){return new(o||ir)(e.Y36(Jh.L),e.Y36(j.T),e.Y36(Qh.u),e.Y36(it.j))},ir.\u0275cmp=e.Xpm({type:ir,selectors:[["op-in-app-notification-bell"]],decls:4,vars:4,consts:[["data-qa-selector","op-ian-bell",1,"op-ian-bell","op-app-menu--item-action",3,"href"],["icon-classes","icon-bell"],[4,"ngIf"],["class","op-ian-bell--indicator","data-qa-selector","op-ian-notifications-count",3,"textContent",4,"ngIf"],["data-qa-selector","op-ian-notifications-count",1,"op-ian-bell--indicator",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"a",0),e._UZ(1,"op-icon",1),e.YNc(2,$h,2,1,"ng-container",2),e.ALo(3,"async"),e.qZA()),2&o&&(e.Q6J("href",s.notificationsPath(),e.LSH),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,2,s.unreadCount$)))},directives:[ut.o,R.O5],pipes:[R.Ov],styles:[".cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}.op-ian-bell[_ngcontent-%COMP%]{position:relative}.op-ian-bell--indicator[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;align-items:center;box-sizing:content-box;height:16px;line-height:16px;width:16px;border-radius:.5rem;padding:0 .15rem;font-size:.7rem;font-weight:bold;background:#00A3FF;color:#fff;flex-shrink:0;position:absolute;top:10px;right:3px;background:darkred}"],changeDetection:0});var Ha=t(78509),Gr=t(44838),za=t(60419),qr=t(31909),Xr=t(44040),nr=t(19100);const zh={pageSize:100,groupBy:"project",filters:[["read_ian","=",!1]]},Kh={pageSize:100,groupBy:"reason",filters:[["read_ian","=",!1]]};let ea=class extends nr.yh{constructor(){super({notificationsByProject:[],notificationsByReason:[],projectsFilter:{}})}};ea=(0,H.gn)([(0,nr.yC)({name:"ian-menu"}),(0,H.w6)("design:paramtypes",[])],ea);var po=t(96725);let Gi=class{constructor(o,s,w,S,ne){this.injector=o,this.ianResourceService=s,this.projectsResourceService=w,this.actions$=S,this.apiV3Service=ne,this.id="ian-center",this.store=new ea,this.query=new nr.AE(this.store),this.projectsFilter$=this.query.select("projectsFilter"),this.projectsForNotifications$=this.projectsFilter$.pipe((0,je.w)(fe=>{const Ie=(0,po.ZU)(fe);return this.projectsResourceService.collection(Ie)})),this.notificationsByProject$=(0,Ni.aj)([this.query.select("notificationsByProject"),this.projectsForNotifications$]).pipe((0,Ht.U)(([fe,Ie])=>fe.map(Ne=>{const et=Ie.find(Dt=>Dt.id.toString()===(0,Te.Z)(Ne._links.valueLink[0].href));return Object.assign(Object.assign({},Ne),{projectHasParent:!!(null==et?void 0:et._links.parent.href)})}))),this.notificationsByReason$=this.query.select("notificationsByReason")}checkForNewNotifications(){this.reload()}reloadOnNotificationRead(){return this.reload()}reload(){this.ianResourceService.fetchCollection(zh).subscribe(o=>{const s={pageSize:100,filters:[]};o.groups&&(s.filters=[["id","=",o.groups.map(w=>(0,Te.Z)(w._links.valueLink[0].href))]]),this.store.update({notificationsByProject:o.groups,projectsFilter:s}),o.groups&&o.groups.length>0&&this.projectsResourceService.fetchCollection(s).subscribe()}),this.ianResourceService.fetchCollection(Kh).subscribe(o=>this.store.update({notificationsByReason:o.groups}))}};Gi.\u0275fac=function(o){return new(o||Gi)(e.LFG(e.zs3),e.LFG(qr.W),e.LFG(Xr.D),e.LFG(za.b),e.LFG(j.T))},Gi.\u0275prov=e.Yz7({token:Gi,factory:Gi.\u0275fac}),(0,H.gn)([(0,Gr.B)(Ha.vw),(0,H.w6)("design:type",Function),(0,H.w6)("design:paramtypes",[]),(0,H.w6)("design:returntype",void 0)],Gi.prototype,"checkForNewNotifications",null),(0,H.gn)([(0,Gr.B)(Ha.A6),(0,H.w6)("design:type",Function),(0,H.w6)("design:paramtypes",[]),(0,H.w6)("design:returntype",void 0)],Gi.prototype,"reloadOnNotificationRead",null),Gi=(0,H.gn)([Gr.b,(0,H.w6)("design:paramtypes",[e.zs3,qr.W,Xr.D,za.b,j.T])],Gi);const uo=(g={})=>({uiSref:"notifications.center.show",uiParams:g});class or{constructor(o,s,w,S,ne){this.cdRef=o,this.I18n=s,this.ianMenuService=w,this.state=S,this.bannersService=ne,this.className=!0,this.baseMenuItems=[Object.assign({key:"inbox",title:this.I18n.t("js.notifications.menu.inbox"),icon:"inbox"},uo({filter:"",name:""}))],this.reasonMenuItems=[Object.assign({key:"mentioned",title:this.I18n.t("js.notifications.menu.mentioned"),icon:"mention"},uo({filter:"reason",name:"mentioned"})),Object.assign({key:"assigned",title:this.I18n.t("js.label_assignee"),icon:"assigned"},uo({filter:"reason",name:"assigned"})),Object.assign({key:"responsible",title:this.I18n.t("js.notifications.menu.accountable"),icon:"accountable"},uo({filter:"reason",name:"responsible"})),Object.assign({key:"watched",title:this.I18n.t("js.notifications.menu.watched"),icon:"watching"},uo({filter:"reason",name:"watched"})),Object.assign({key:"dateAlert",title:this.I18n.t("js.notifications.menu.date_alert"),icon:"date-alert",isEnterprise:!0},this.eeGuardedDateAlertRoute)],this.notificationsByProject$=this.ianMenuService.notificationsByProject$.pipe((0,Ht.U)(fe=>fe.map(Ie=>Object.assign(Object.assign(Object.assign({},Ie),{title:(Ie.projectHasParent?"... ":"")+Ie.value}),uo({filter:"project",name:(0,Te.Z)(Ie._links.valueLink[0].href)}))).sort((Ie,Ne)=>Ne.projectHasParent&&!Ie.projectHasParent?-1:Ie.value.toLowerCase().localeCompare(Ne.value.toLowerCase())))),this.notificationsByReason$=this.ianMenuService.notificationsByReason$.pipe((0,Ht.U)(fe=>this.reasonMenuItems.map(Ie=>Object.assign(Object.assign({},fe.find(Ne=>Ne.value===Ie.key)),Ie)))),this.menuItems$=(0,Ni.aj)([this.notificationsByProject$,this.notificationsByReason$]).pipe((0,Ht.U)(([fe,Ie])=>[...this.baseMenuItems.map(Ne=>Object.assign(Object.assign({},Ne),{count:fe.reduce((et,Dt)=>et+(Dt.count||0),0)})),{title:this.I18n.t("js.notifications.menu.by_reason"),collapsible:!0,children:Ie},{title:this.I18n.t("js.notifications.menu.by_project"),collapsible:!0,children:fe}])),this.text={title:this.I18n.t("js.notifications.title"),button_close:this.I18n.t("js.button_close"),no_results:{unread:this.I18n.t("js.notifications.no_unread"),all:this.I18n.t("js.notice_no_results_to_display")}}}ngOnInit(){this.ianMenuService.reload()}get eeGuardedDateAlertRoute(){return this.bannersService.eeShowBanners?{uiSref:"notifications.date_alerts_upsale",uiParams:null,uiOptions:{inherit:!1}}:uo({filter:"reason",name:"dateAlert"})}}function Xh(g,o){if(1&g&&(e.TgZ(0,"button",3),e._UZ(1,"span",4),e._UZ(2,"span",5),e.qZA()),2&g){const s=e.oxw();e.Q6J("uiSref",s.createButton.uiSref)("uiParams",s.createButton.uiParams)("title",s.createButton.title),e.xp6(2),e.Q6J("textContent",s.createButton.text)}}or.\u0275fac=function(o){return new(o||or)(e.Y36(e.sBO),e.Y36(y.D),e.Y36(Gi),e.Y36(he.StateService),e.Y36(Co.j))},or.\u0275cmp=e.Xpm({type:or,selectors:[["op-ian-menu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-ian-menu",s.className)},features:[e._Bn([Gi])],decls:2,vars:3,consts:[["data-qa-selector","op-sidemenu",3,"items"]],template:function(o,s){1&o&&(e._UZ(0,"op-sidemenu",0),e.ALo(1,"async")),2&o&&e.Q6J("items",e.lcZ(1,1,s.menuItems$))},directives:[Cn],pipes:[R.Ov],styles:[".op-ian-menu[_ngcontent-%COMP%], [_nghost-%COMP%]{display:block;padding-top:16px}"],changeDetection:0});class sr extends yi.N{constructor(o,s,w,S,ne){super(),this.elementRef=o,this.currentUserService=s,this.currentProjectService=w,this.bannersService=S,this.I18n=ne,this.className=!0,this.menuItems=[],this.canAddTeamPlanner$=this.currentUserService.hasCapabilities$("team_planners/create",this.currentProjectService.id||null).pipe((0,Ht.U)(fe=>fe&&!this.bannersService.eeShowBanners)),this.createButton={text:this.I18n.t("js.team_planner.create_label"),title:this.I18n.t("js.team_planner.create_title"),uiSref:"team_planner.page.show",uiParams:{query_id:null,query_props:""}},(0,wr.E)(this)}}function t_(g,o){if(1&g&&(e.TgZ(0,"button",3),e._UZ(1,"span",4),e._UZ(2,"span",5),e.qZA()),2&g){const s=e.oxw();e.Q6J("uiSref",s.createButton.uiSref)("uiParams",s.createButton.uiParams)("title",s.text.create_new_calendar),e.xp6(2),e.Q6J("textContent",s.createButton.title)}}sr.\u0275fac=function(o){return new(o||sr)(e.Y36(e.SBq),e.Y36(So.S),e.Y36(P.R),e.Y36(Co.j),e.Y36(y.D))},sr.\u0275cmp=e.Xpm({type:sr,selectors:[["op-team-planner-sidemenu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-sidebar",s.className)},inputs:{menuItems:"menuItems",projectId:"projectId"},features:[e.qOj],decls:4,vars:5,consts:[["baseRoute","team_planner.page.show","viewType","TeamPlanner",1,"op-sidebar--body",3,"projectId","menuItems"],[1,"op-sidebar--footer"],["class","button -alt-highlight -expand","data-qa-selector","team-planner--create-button",3,"uiSref","uiParams","title",4,"ngIf"],["data-qa-selector","team-planner--create-button",1,"button","-alt-highlight","-expand",3,"uiSref","uiParams","title"],[1,"spot-icon","spot-icon_add"],[3,"textContent"]],template:function(o,s){1&o&&(e._UZ(0,"op-view-select",0),e.TgZ(1,"div",1),e.YNc(2,Xh,3,4,"button",2),e.ALo(3,"async"),e.qZA()),2&o&&(e.Q6J("projectId",s.projectId)("menuItems",s.menuItems),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,3,s.canAddTeamPlanner$)))},directives:[cn,R.O5,Vt.UISref],pipes:[R.Ov],encapsulation:2,changeDetection:0});class rr extends yi.N{constructor(o,s,w,S){super(),this.elementRef=o,this.currentUserService=s,this.currentProjectService=w,this.I18n=S,this.className=!0,this.menuItems=[],this.canCreateCalendar$=this.currentUserService.hasCapabilities$("calendars/create",this.currentProjectService.id||null).pipe(this.untilDestroyed()),this.text={calendar:this.I18n.t("js.calendar.title"),create_new_calendar:this.I18n.t("js.calendar.create_new")},this.createButton={title:this.text.calendar,uiSref:"calendar.page.show",uiParams:{query_id:null,query_props:""}},(0,wr.E)(this)}}rr.\u0275fac=function(o){return new(o||rr)(e.Y36(e.SBq),e.Y36(So.S),e.Y36(P.R),e.Y36(y.D))},rr.\u0275cmp=e.Xpm({type:rr,selectors:[["op-calendar-sidemenu"]],hostVars:2,hostBindings:function(o,s){2&o&&e.ekj("op-sidebar",s.className)},inputs:{menuItems:"menuItems",projectId:"projectId"},features:[e.qOj],decls:4,vars:5,consts:[["baseRoute","calendar.page.show","viewType","WorkPackagesCalendar",1,"op-sidebar--body",3,"projectId","menuItems"],[1,"op-sidebar--footer"],["class","button -alt-highlight",3,"uiSref","uiParams","title",4,"ngIf"],[1,"button","-alt-highlight",3,"uiSref","uiParams","title"],[1,"spot-icon","spot-icon_add"],[3,"textContent"]],template:function(o,s){1&o&&(e._UZ(0,"op-view-select",0),e.TgZ(1,"div",1),e.YNc(2,t_,3,4,"button",2),e.ALo(3,"async"),e.qZA()),2&o&&(e.Q6J("projectId",s.projectId)("menuItems",s.menuItems),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,3,s.canCreateCalendar$)))},directives:[cn,R.O5,Vt.UISref],pipes:[R.Ov],encapsulation:2,changeDetection:0});var ta=t(40912);const n_=["overlay"];function o_(g,o){}class ar{constructor(o,s,w){this.modalService=o,this.I18n=s,this.cdRef=w,this.notFullscreen=!1,this.activeModalData$=this.modalService.activeModalData$,this.activeModalInstance$=this.modalService.activeModalInstance$.asObservable()}set portalOutletContainer(o){void 0!==o&&(this.portalOutlet=o,this.setupListener())}setupListener(){this.activeModalData$.subscribe(o=>{if(this.notFullscreen=!1,null===o){const Ne=this.portalOutlet.attachedRef;if(!Ne||!Ne.instance.onClose())return;return Ne.instance.closingEvent.emit(Ne.instance),this.modalService.activeModalInstance$.next(null),void this.portalOutlet.detach()}const{modal:s,injector:w,notFullscreen:S}=o;this.notFullscreen=S;const ne=new ta.C5(s,null,w),Ie=this.portalOutlet.attach(ne).instance;this.modalService.activeModalInstance$.next(Ie),this.cdRef.detectChanges(),this.overlay.nativeElement.focus(),Ie&&Ie.onOpen()})}close(o,s=!0){!s&&o.currentTarget!==o.target||this.modalService.close()}}ar.\u0275fac=function(o){return new(o||ar)(e.Y36(lt.S),e.Y36(y.D),e.Y36(e.sBO))},ar.\u0275cmp=e.Xpm({type:ar,selectors:[["op-modal-overlay"]],viewQuery:function(o,s){if(1&o&&(e.Gf(ta.Pl,5),e.Gf(n_,7)),2&o){let w;e.iGM(w=e.CRH())&&(s.portalOutletContainer=w.first),e.iGM(w=e.CRH())&&(s.overlay=w.first)}},decls:6,vars:6,consts:[["tabindex","0","cdkFocusInitial","","cdkTrapFocus","",1,"spot-modal-overlay",3,"click"],["overlay",""],["type","button",1,"spot-button","spot-modal-overlay--close-button",3,"click"],[1,"spot-icon","spot-icon_close"],["cdkPortalOutlet",""]],template:function(o,s){1&o&&(e.TgZ(0,"div",0,1),e.NdJ("click",function(S){return s.close(S,!1)}),e.ALo(2,"async"),e.TgZ(3,"button",2),e.NdJ("click",function(S){return s.close(S)}),e._UZ(4,"span",3),e.qZA(),e.YNc(5,o_,0,0,"ng-template",4),e.qZA()),2&o&&e.ekj("spot-modal-overlay_active",null!==e.lcZ(2,4,s.activeModalInstance$))("spot-modal-overlay_not-full-screen",s.notFullscreen)},directives:[Jr.mK,ta.Pl],pipes:[R.Ov],encapsulation:2,changeDetection:0});const r_=[{selector:yr,cls:fn},{selector:ui.w,cls:ui.y},{selector:"macro.embedded-table",cls:Es,embeddable:!0},{selector:Ma.w,cls:Ma.O},{selector:jn.h,cls:jn.a},{selector:Li.e,cls:Li.t,embeddable:!0},{selector:Vr.X,cls:Vr.U},{selector:"op-members-autocompleter",cls:Bn},{selector:"global-search-tabs",cls:Ys},{selector:"global-search-work-packages",cls:Uo},{selector:"homescreen-new-features-block",cls:Xs},{selector:"custom-date-action-admin",cls:Os},{selector:"boards-menu",cls:Ms},{selector:"global-search-work-packages-entry",cls:Is},{selector:"op-toasts-container",cls:As},{selector:"op-sidemenu",cls:Cn},{selector:"admin-type-form-configuration",cls:Wo},{selector:"ckeditor-augmented-textarea",cls:js,embeddable:!0},{selector:"persistent-toggle",cls:Rs},{selector:Qt.y,cls:Qt.N},{selector:"hide-section-link",cls:Fs},{selector:"show-section-dropdown",cls:Zs},{selector:"add-section-dropdown",cls:Ws},{selector:ja.$,cls:ja.r},{selector:"content-tabs",cls:Ls},{selector:"global-search-title",cls:Qo},{selector:"copy-to-clipboard",cls:Us},{selector:"main-menu-resizer",cls:er},{selector:"main-menu-toggle",cls:$o},{selector:"global-search-input",cls:Bs},{selector:"collapsible-section-augment",cls:Ns},{selector:Wr.z,cls:Wr.P},{selector:Qa.z,cls:Qa._},{selector:St.X,cls:St.S},{selector:"enterprise-base",cls:Gs},{selector:Na.b,cls:Na.o},{selector:"enterprise-active-saved-trial",cls:qs},{selector:"op-header-project-select",cls:Qs},{selector:Br.B,cls:Br.F},{selector:"remote-field-updater",cls:Js},{selector:"wp-overview-graph",cls:ji},{selector:"op-view-select",cls:cn},{selector:"op-team-planner-sidemenu",cls:sr},{selector:"op-calendar-sidemenu",cls:rr},{selector:"time-entry--trigger-actions-entry",cls:Ki,embeddable:!0},{selector:La.m,cls:La.V},{selector:"macro.macro--attribute-value",cls:Vs,embeddable:!0},{selector:"macro.macro--attribute-label",cls:Hs,embeddable:!0},{selector:"macro.macro--wp-quickinfo",cls:Ks,embeddable:!0},{selector:"editable-query-props",cls:tr},{selector:Ba.H,cls:Ba.G},{selector:"backup",cls:Yo},{selector:"op-in-app-notification-bell",cls:ir},{selector:"op-ian-menu",cls:or},{selector:"op-modal-overlay",cls:ar}];var ia=t(55741),a_=t(84568),c_=t(17076),l_=t(82170);class Vo{constructor(o){this.sanitizer=o}sanitize(o){return this.sanitizer.sanitize(e.q3G.HTML,o)||""}}Vo.\u0275fac=function(o){return new(o||Vo)(e.LFG(n.H7))},Vo.\u0275prov=e.Yz7({token:Vo,factory:Vo.\u0275fac,providedIn:"root"});var d_=t(58057),p_=t(298);const u_=["passwordConfirmationField"];class Ho extends p_.j{constructor(){super(...arguments),this.password_confirmation=null,this.additionalText={field_description:I18n.t("js.password_confirmation.field_description"),confirm_button:I18n.t("js.button_confirm"),password:I18n.t("js.label_password"),cancel_button:I18n.t("js.button_cancel")}}ngOnInit(){super.ngOnInit(),this.text.title=I18n.t("js.password_confirmation.title"),this.showClose=!1}confirmAndClose(o){this.passwordValuePresent()&&super.confirmAndClose(o)}onOpen(){super.onOpen(),this.passwordConfirmationField.nativeElement.focus()}passwordValuePresent(){return null!==this.password_confirmation&&this.password_confirmation.length>0}}Ho.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(Ho)))(s||Ho)}}(),Ho.\u0275cmp=e.Xpm({type:Ho,selectors:[["ng-component"]],viewQuery:function(o,s){if(1&o&&e.Gf(u_,7),2&o){let w;e.iGM(w=e.CRH())&&(s.passwordConfirmationField=w.first)}},features:[e.qOj],decls:16,vars:8,consts:[["data-indicator-name","modal",1,"spot-modal","form","-vertical","confirm-form-submit--modal","password-confirm-dialog--modal","loading-indicator--location",3,"submit"],[1,"spot-modal--header"],[1,"spot-divider"],[1,"spot-modal--body","spot-container","form"],[1,"form--field","-required"],["for","request_for_confirmation_password",1,"form--label","-bold",3,"textContent"],[1,"form--field-container"],[1,"form--text-field-container"],["type","password","id","request_for_confirmation_password","name","request_for_confirmation_password",1,"form--text-field",3,"ngModel","ngModelChange"],["passwordConfirmationField",""],[1,"form--field-instructions",3,"textContent"],[1,"spot-action-bar"],[1,"spot-action-bar--right"],[1,"button","button_no-margin","spot-modal--cancel-button","spot-action-bar--action",3,"textContent","click"],["data-qa-selector","confirmation-modal--confirmed",1,"button","button_no-margin","-highlight","spot-action-bar--action",3,"textContent","disabled"]],template:function(o,s){1&o&&(e.TgZ(0,"form",0),e.NdJ("submit",function(S){return s.confirmAndClose(S)}),e.TgZ(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div",2),e.TgZ(4,"div",3),e.TgZ(5,"div",4),e._UZ(6,"label",5),e.TgZ(7,"div",6),e.TgZ(8,"div",7),e.TgZ(9,"input",8,9),e.NdJ("ngModelChange",function(S){return s.password_confirmation=S}),e.qZA(),e.qZA(),e.qZA(),e._UZ(11,"div",10),e.qZA(),e.qZA(),e.TgZ(12,"div",11),e.TgZ(13,"div",12),e.TgZ(14,"button",13),e.NdJ("click",function(){return s.closeMe()}),e.qZA(),e._UZ(15,"button",14),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title),e.xp6(4),e.Q6J("textContent",s.additionalText.password),e.uIk("aria-label",s.additionalText.field_description),e.xp6(3),e.Q6J("ngModel",s.password_confirmation),e.xp6(2),e.Q6J("textContent",s.additionalText.field_description),e.xp6(3),e.Q6J("textContent",s.additionalText.cancel_button),e.xp6(1),e.Q6J("textContent",s.additionalText.confirm_button)("disabled",!s.passwordValuePresent()))},directives:[h._Y,h.JL,h.F,h.Fj,h.JJ,h.On],encapsulation:2,changeDetection:0});var Ka=t(88826);class Ga{constructor(o){this.injector=o,this._knownHookNames=["workPackageBulkContextMenu","workPackageTableContextMenu","workPackageSingleContextMenu","workPackageNewInitialization"],this.services={confirmDialog:this.injector.get($e.D),externalQueryConfiguration:this.injector.get(Ya.W),externalRelationQueryConfiguration:this.injector.get(ka.Q),halResource:this.injector.get(Ot.u),hooks:this.injector.get(C.$),i18n:this.injector.get(y.D),notifications:this.injector.get(I.kl),opModalService:this.injector.get(lt.S),opFileUpload:this.injector.get(Yr.r),displayField:this.injector.get($s.i),editField:this.injector.get(a_.h),macros:this.injector.get(l_.f),htmlSanitizeService:this.injector.get(Vo),ckEditorPreview:this.injector.get(c_.K),pathHelperService:this.injector.get(it.j),states:this.injector.get(c.G),apiV3Service:this.injector.get(j.T),configurationService:this.injector.get(de.e),attachmentsResourceService:this.injector.get(Ka.v)},this.helpers={idFromLink:Te.Z},this.classes={modals:{passwordConfirmation:Ho,dynamicContent:d_.T},HalResource:jo.X,DisplayField:ia.C,DomAutoscrollService:Pa.x},this.hooks={},this._knownHookNames.forEach(s=>{this.hooks[s]=w=>this.services.hooks.register(s,w)})}runInZone(o){this.zone.run(o)}bootstrap(o){d.Z.bootstrapOptionalEmbeddable(this.injector.get(e.z2F),o)}}(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",e.R0b)],Ga.prototype,"zone",void 0);class zo{constructor(o){(0,an.qu)("Registering OpenProject plugin context");const s=new Ga(o);window.OpenProject.pluginContext.putValue(s)}}zo.\u0275fac=function(o){return new(o||zo)(e.LFG(e.zs3))},zo.\u0275mod=e.oAB({type:zo}),zo.\u0275inj=e.cJS({providers:[C.$]});class ho{constructor(o,s){this.halNotification=o,this.http=s}listen(){jQuery("costs-budget-subform").each((o,s)=>{const w=jQuery(s),S=w.find(".budget-item-container"),ne=w.find(".budget-row-template");ne.detach();const fe=ne[0].outerHTML;let Ie=parseInt(w.attr("item-count"),10);w.on("change",".budget-item-value",Ne=>{const et=jQuery(Ne.target).closest(".cost_entry");this.refreshRow(w,et.attr("id"))}),w.on("click",".delete-budget-item",Ne=>(Ne.preventDefault(),jQuery(Ne.target).closest(".cost_entry").remove(),!1)),w.find(".budget-add-row").on("click",Ne=>{Ne.preventDefault();const et=jQuery(fe.replace(/INDEX/g,Ie.toString()));return et.show(),et.removeClass("budget-row-template"),S.append(et),Ie+=1,!1})})}refreshRow(o,s){const w=o.find(`#${s}`),S=this.buildRefreshRequest(w,s);this.http.post(o.attr("update-url"),S,{headers:{Accept:"application/json"},withCredentials:!0}).subscribe(ne=>{_.each(ne,(fe,Ie)=>{const Ne=document.getElementById(Ie);Ne instanceof HTMLInputElement?(Ne.disabled=!1,Ne.value=fe):Ne&&(Ne.textContent=fe)})},ne=>this.halNotification.handleRawError(ne))}buildRefreshRequest(o,s){const w={element_id:s,fixed_date:jQuery("#budget_fixed_date").val()};return o.find(".budget-item-value").each((S,ne)=>{const fe=jQuery(ne);w[fe.data("requestKey")]=fe.val()||"0"}),w}}ho.\u0275fac=function(o){return new(o||ho)(e.LFG(Fe.W),e.LFG(p.eN))},ho.\u0275prov=e.Yz7({token:ho,factory:ho.\u0275fac});class Ko{constructor(){jQuery("costs-subform").each((o,s)=>{const w=jQuery(s),S=w.find(".subform-container"),ne=w.find(".subform-row-template");ne.detach();const fe=ne[0].outerHTML;let Ie=parseInt(w.attr("item-count"));w.on("click",".delete-row-button,.delete-budget-item",Ne=>(jQuery(Ne.target).closest(".subform-row").remove(),!1)),w.find(".add-row-button,.wp-inline-create--add-link").click(Ne=>{Ne.preventDefault();const et=jQuery(fe.replace(/INDEX/g,Ie.toString()));return et.show(),et.removeClass("subform-row-template"),et.find("input.costs-date-picker").prop("required",!0),et.find('input[id^="cost_type_new_rate_attributes"]').prop("required",!0),S.append(et),Ie+=1,S.find(".subform-row:last-child input:first").focus(),!1})})}}Ko.\u0275fac=function(o){return new(o||Ko)},Ko.\u0275prov=e.Yz7({token:Ko,factory:Ko.\u0275fac});var qa=t(67248);class __ extends jo.X{}const m_=(0,qa.n)(__);function g_(g){window.OpenProject.getPluginContext().then(o=>{o.services.editField.extendFieldType("select",["Budget"]),o.services.displayField.extendFieldType("resource",["Budget"]),o.services.halResource.registerResource("Budget",{cls:m_});const{states:S}=o.services;S.add("budgets",(0,Bo.r9)()),new Ko,class{static listen(){jQuery(document).on("click",".costs--edit-planned-costs-btn",o=>{const s=o.target,w=s.nextElementSibling;s.hidden=!0,w.hidden=!1,w.querySelector("input").disabled=!1}),jQuery(document).on("click",".costs--edit-planned-costs-cancel-btn",o=>{const s=o.target.closest(".costs--edit-form");s.previousElementSibling.hidden=!1,s.hidden=!0,s.querySelector("input").disabled=!0})}}.listen(),g.get(ho).listen()})}class Go{constructor(o){g_(o)}}Go.\u0275fac=function(o){return new(o||Go)(e.LFG(e.zs3))},Go.\u0275mod=e.oAB({type:Go}),Go.\u0275inj=e.cJS({providers:[ho]});class Xa extends ia.C{apply(o,s){super.apply(o,s),this.loadIfNecessary()}loadIfNecessary(){this.value&&!1===this.value.$loaded&&this.value.$load().then(()=>{"WorkPackage"===this.resource.$source._type&&this.apiV3Service.work_packages.cache.touch(this.resource.id)})}get title(){return""}render(o,s){this.isEmpty()?o.textContent=this.placeholder:this.value.elements.forEach((w,S)=>{this.resource.showCosts?this.renderCostAsLink(w,o,S):this.renderCostAsText(w,o,S)})}isEmpty(){return!this.value||!this.value.elements||0===this.value.elements.length}renderCostAsLink(o,s,w){const S=this.resource.showCosts,ne=document.createElement("a");ne.href=S.href+"&unit="+o.costType.id,ne.setAttribute("target","_blank"),ne.textContent=o.spentUnits+" "+o.costType.name,s.appendChild(ne),this.addSeparator(s,w)}renderCostAsText(o,s,w){const S=document.createElement("span");S.textContent=o.spentUnits+" "+o.costType.name,s.appendChild(S),this.addSeparator(s,w)}addSeparator(o,s){if(s<this.value.elements.length-1){const w=document.createElement("span");w.textContent=", ",o.appendChild(w)}}}(0,H.gn)([(0,Be.W)(),(0,H.w6)("design:type",j.T)],Xa.prototype,"apiV3Service",void 0);class f_ extends ia.C{isEmpty(){return!this.value||!parseFloat(this.value.match(/\d+/g)[0])}}class qo{constructor(o){window.OpenProject.getPluginContext().then(o=>{const s=o.services.displayField;s.addFieldType(Xa,"costs",["costsByType"]),s.addFieldType(f_,"currency",["laborCosts","materialCosts","overallCosts"]),o.hooks.workPackageSingleContextMenu(w=>({key:"log_costs",icon:"icon-projects",indexBy(S){const ne=_.findIndex(S,{key:"log_time"});return-1!==ne?ne+1:S.length},resource:"workPackage",link:"logCosts"})),o.hooks.workPackageTableContextMenu(w=>({key:"log_costs",icon:"icon-projects",link:"logCosts",indexBy(S){const ne=_.findIndex(S,{link:"logTime"});return-1!==ne?ne+1:S.length},text:I18n.t("js.button_log_costs")}))})}}function y_(g){const o=g.split(",")[0].indexOf("base64")>=0?atob(g.split(",")[1]):unescape(g.split(",")[1]),s=g.split(",")[0].split(":")[1].split(";")[0],w=o.length,S=new Uint8Array(w);for(let ne=0;ne<w;ne+=1)S[ne]=o.charCodeAt(ne);return new Blob([S],{type:s})}function b_(g,o){return new Promise(s=>{const w=new FileReader;w.onload=S=>{const ne=new Image;ne.onload=()=>s(function(g,o){const s=document.createElement("canvas"),w=s.getContext("2d");let{width:S}=o,{height:ne}=o;S>ne?S>g&&(ne*=g/S,S=g):ne>g&&(S*=g/ne,ne=g),s.width=S,s.height=ne,w.drawImage(o,0,0,S,ne);const fe=s.toDataURL("image/jpeg");return[fe,y_(fe)]}(g,ne)),ne.src=S.target.result},w.readAsDataURL(o)})}qo.\u0275fac=function(o){return new(o||qo)(e.LFG(e.zs3))},qo.\u0275mod=e.oAB({type:qo}),qo.\u0275inj=e.cJS({providers:[]});const w_=["avatarFilePicker"];function T_(g,o){if(1&g&&e._UZ(0,"span",6),2&g){const s=e.oxw();e.Q6J("textContent",s.text.wrong_file_format)}}function k_(g,o){if(1&g&&(e.TgZ(0,"fieldset",11),e._UZ(1,"legend",12),e._UZ(2,"img",13),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("textContent",s.text.preview),e.xp6(1),e.Q6J("src",s.avatarPreviewUrl,e.LSH)}}const P_=function(g){return{"-error":g}};class cr{constructor(o,s,w,S){this.I18n=o,this.elementRef=s,this.toastService=w,this.opFileUpload=S,this.busy=!1,this.fileInvalid=!1,this.text={label_choose_avatar:this.I18n.t("js.avatars.label_choose_avatar"),upload_instructions:this.I18n.t("js.avatars.text_upload_instructions"),error_too_large:this.I18n.t("js.avatars.error_image_too_large"),wrong_file_format:this.I18n.t("js.avatars.wrong_file_format"),button_update:this.I18n.t("js.button_update"),uploading:this.I18n.t("js.avatars.uploading_avatar"),preview:this.I18n.t("js.label_preview")}}ngOnInit(){const o=this.elementRef.nativeElement;this.target=o.getAttribute("target"),this.method=o.getAttribute("method")}onFilePickerChanged(o){const s=Array.from(this.avatarFilePicker.nativeElement.files);if(0===s.length)return;const w=s[0];-1!==["image/jpeg","image/png","image/gif"].indexOf(w.type)?b_(128,w).then(([S,ne])=>{ne.name=w.name,this.avatarFile=ne,this.avatarPreviewUrl=S}):this.fileInvalid=!0}uploadAvatar(o){o.preventDefault(),this.busy=!0;const s=this.opFileUpload.uploadSingle(this.target,this.avatarFile,this.method,"text");this.toastService.addAttachmentUpload(this.text.uploading,[s]),s[1].subscribe(w=>{switch(w.type){case 0:return;case 4:return this.avatarFile.progress=100,this.busy=!1,void window.location.reload();default:return}},w=>{this.toastService.addError(w.error),this.busy=!1})}}cr.\u0275fac=function(o){return new(o||cr)(e.Y36(y.D),e.Y36(e.SBq),e.Y36(I.kl),e.Y36(Yr.r))},cr.\u0275cmp=e.Xpm({type:cr,selectors:[["avatar-upload-form"]],viewQuery:function(o,s){if(1&o&&e.Gf(w_,7),2&o){let w;e.iGM(w=e.CRH())&&(s.avatarFilePicker=w.first)}},decls:11,vars:9,consts:[[1,"form--field"],["for","avatar_file_input",1,"form--label",3,"ngClass","textContent"],[1,"form--field-container"],["type","file","accept","image/jpeg,image/png,image/gif","id","avatar_file_input","name","avatar_file_input",3,"change"],["avatarFilePicker",""],[1,"form--field-instructions"],[3,"textContent"],[1,"avatars--error-pane"],[3,"textContent",4,"ngIf"],["class","preview",4,"ngIf"],["type","submit",1,"button","-highlight","-with-icon","icon-checkmark",3,"textContent","click"],[1,"preview"],[1,"preview--legend",3,"textContent"],[1,"avatars--local-avatar-preview",3,"src"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"label",1),e.TgZ(2,"div",2),e.TgZ(3,"input",3,4),e.NdJ("change",function(S){return s.onFilePickerChanged(S)}),e.qZA(),e.qZA(),e.TgZ(5,"div",5),e._UZ(6,"span",6),e.TgZ(7,"div",7),e.YNc(8,T_,1,1,"span",8),e.qZA(),e.qZA(),e.qZA(),e.YNc(9,k_,3,2,"fieldset",9),e.TgZ(10,"button",10),e.NdJ("click",function(S){return s.uploadAvatar(S)}),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngClass",e.VKq(7,P_,s.fileInvalid))("textContent",s.text.label_choose_avatar),e.xp6(5),e.Q6J("textContent",s.text.upload_instructions),e.xp6(2),e.Q6J("ngIf",s.fileInvalid),e.xp6(1),e.Q6J("ngIf",s.avatarPreviewUrl),e.xp6(1),e.Q6J("textContent",s.text.button_update),e.uIk("disabled",!s.avatarFile||s.busy||void 0))},directives:[R.mk,R.O5],encapsulation:2});class Xo{constructor(o){o.get(C.$).register("openProjectAngularBootstrap",()=>[{selector:"avatar-upload-form",cls:cr}])}}Xo.\u0275fac=function(o){return new(o||Xo)(e.LFG(e.zs3))},Xo.\u0275mod=e.oAB({type:Xo}),Xo.\u0275inj=e.cJS({imports:[[R.ez]]});class x_ extends jo.X{constructor(){super(...arguments),this.attachmentsBackend=!1}}const E_=(0,qa.n)(x_);class es{constructor(){window.OpenProject.getPluginContext().then(g=>{g.services.halResource.registerResource("Document",{cls:E_});const{states:s}=g.services;s.add("documents",(0,Bo.r9)())})}}es.\u0275fac=function(o){return new(o||es)},es.\u0275mod=e.oAB({type:es}),es.\u0275inj=e.cJS({});var M_=t(58312),I_=(t(24897),t(79505));class ts{sanitizeBranchString(o){return o.replace(/&/g,"and ").replace(/ +/g,"-").replace(/[\000-\039]/g,"").replace(/\177/g,"").replace(/[#\\\/\?\*\~\^\:\{\}@\.\[\]'"]/g,"").replace(/^[-]+/g,"").replace(/[-]+$/g,"").replace(/-+/g,"-").trim()}formattingInput(o){const s=o.type.name||"",w=o.id||"";return{id:w,type:s,title:o.subject,url:window.location.origin+o.pathHelper.workPackagePath(w),description:""}}sanitizeShellInput(o){return`${o.replace(/'/g,"\\'")}`}branchName(o){const{type:s,id:w,title:S}=this.formattingInput(o);return`${this.sanitizeBranchString(s)}/${w}-${this.sanitizeBranchString(S)}`.toLocaleLowerCase()}commitMessage(o){const{title:s,id:w,description:S,url:ne}=this.formattingInput(o);return`[#${w}] ${s}\n\n${S}\n\n${ne}\n`.replace(/\n\n+/g,"\n\n")}gitCommand(o){const s=this.branchName(o),w=this.commitMessage(o);return`git checkout -b '${this.sanitizeShellInput(s)}' && git commit --allow-empty -m '${this.sanitizeShellInput(w)}'`}}ts.\u0275fac=function(o){return new(o||ts)},ts.\u0275prov=e.Yz7({token:ts,factory:ts.\u0275fac,providedIn:"root"});var D_=t(36322),S_=t(30712);function A_(g,o){if(1&g&&e._UZ(0,"div",11),2&g){const s=e.oxw(2);e.Q6J("textContent",s.lastCopyResult)}}function j_(g,o){if(1&g){const s=e.EpF();e.TgZ(0,"div",3),e.TgZ(1,"label",4),e.TgZ(2,"div",5),e._uU(3),e.qZA(),e.TgZ(4,"div",6),e._UZ(5,"input",7),e.TgZ(6,"button",8),e.NdJ("click",function(){const ne=e.CHM(s).$implicit;return e.oxw().onCopyButtonClick(ne)}),e._UZ(7,"span",9),e.qZA(),e.YNc(8,A_,1,1,"div",10),e.qZA(),e.qZA(),e.qZA()}if(2&g){const s=o.$implicit,w=e.oxw();e.xp6(3),e.Oqu(s.name),e.xp6(2),e.Q6J("value",s.textToCopy()),e.xp6(1),e.uIk("aria-label",w.text.copyButtonHelpText),e.xp6(2),e.Q6J("ngIf",w.showCopyResult&&s.id===w.copiedSnippetId)}}class lr extends D_.n{constructor(o,s,w){super(o),this.locals=o,this.I18n=s,this.gitActions=w,this.text={title:this.I18n.t("js.github_integration.tab_header.git_actions.title"),copyButtonHelpText:this.I18n.t("js.github_integration.tab_header.git_actions.copy_button_help"),copyResult:{success:this.I18n.t("js.github_integration.tab_header.git_actions.copy_success"),error:this.I18n.t("js.github_integration.tab_header.git_actions.copy_error")}},this.lastCopyResult=this.text.copyResult.success,this.showCopyResult=!1,this.copiedSnippetId="",this.snippets=[{id:"branch",name:this.I18n.t("js.github_integration.tab_header.git_actions.branch_name"),textToCopy:()=>this.gitActions.branchName(this.workPackage)},{id:"message",name:this.I18n.t("js.github_integration.tab_header.git_actions.commit_message"),textToCopy:()=>this.gitActions.commitMessage(this.workPackage)},{id:"command",name:this.I18n.t("js.github_integration.tab_header.git_actions.cmd"),textToCopy:()=>this.gitActions.gitCommand(this.workPackage)}],this.workPackage=this.locals.workPackage}onCopyButtonClick(o){(0,I_.Z)(o.textToCopy())?this.lastCopyResult=this.text.copyResult.success:this.lastCopyResult=this.text.copyResult.error,this.copiedSnippetId=o.id,this.showCopyResult=!0,window.setTimeout(()=>{this.showCopyResult=!1},2e3)}}lr.\u0275fac=function(o){return new(o||lr)(e.Y36(S_.Q),e.Y36(y.D),e.Y36(ts))},lr.\u0275cmp=e.Xpm({type:lr,selectors:[["op-git-actions-menu"]],inputs:{workPackage:"workPackage"},features:[e.qOj],decls:4,vars:2,consts:[[1,"git-actions-menu","dropdown-relative","dropdown","-overflow-in-view","dropdown-anchor-right"],[1,"title"],["class","copy-wrapper spot-form-field",4,"ngFor","ngForOf"],[1,"copy-wrapper","spot-form-field"],[1,"spot-form-field--label-wrap"],[1,"spot-form-field--label"],[1,"spot-form-field--input"],["type","text","readonly","true",1,"copy-content","op-input",3,"value"],["type","button",1,"button","copy-button",3,"click"],[1,"spot-icon","spot-icon_copy"],["class","copy-result-message",3,"textContent",4,"ngIf"],[1,"copy-result-message",3,"textContent"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"h3",1),e._uU(2),e.qZA(),e.YNc(3,j_,9,4,"div",2),e.qZA()),2&o&&(e.xp6(2),e.Oqu(s.text.title),e.xp6(1),e.Q6J("ngForOf",s.snippets))},directives:[R.sg,R.O5],styles:['.git-actions-menu[_ngcontent-%COMP%]{background-color:var(--body-background);border:var(--content-default-border-width) solid var(--content-default-border-color);padding:1rem 1rem 2rem;min-width:25rem;box-shadow:.1em .1em .4em #0000001a}.git-actions-menu[_ngcontent-%COMP%]   .copy-wrapper[_ngcontent-%COMP%]{width:100%;position:relative;margin-bottom:1rem}.git-actions-menu[_ngcontent-%COMP%]   .copy-content[_ngcontent-%COMP%]{width:calc(100% - 3em);min-height:calc(2 * .65em + .9em + 1px);border-radius:2px 0 0 2px;padding:.65em;color:var(--gray-dark);white-space:pre;resize:none;font-size:.9rem;display:inline-block}.git-actions-menu[_ngcontent-%COMP%]   .copy-button[_ngcontent-%COMP%]{margin:0;border:1px solid #ccc;border-radius:0 2px 2px 0;vertical-align:top;left:-1px;position:relative;font-size:.9rem}.git-actions-menu[_ngcontent-%COMP%]   .copy-button[_ngcontent-%COMP%]:hover{border-color:#999}.git-actions-menu[_ngcontent-%COMP%]   .copy-result-message[_ngcontent-%COMP%]{background-color:var(--main-menu-bg-color);display:inline-block;padding:.5em;border-radius:5px;color:var(--main-menu-font-color);position:absolute;right:0;top:calc(2 * .65em + .9em + 1px + 9px);box-shadow:1px 1px 4px var(--gray-dark);z-index:1}.git-actions-menu[_ngcontent-%COMP%]   .copy-result-message[_ngcontent-%COMP%]:before{content:"";border-bottom:.6em solid var(--main-menu-bg-color);height:0;width:0;position:absolute;top:-9px;right:10px;border-left:.3em solid transparent;border-right:.3em solid transparent}']});class dr extends Zr.n{constructor(o,s){super(o,s),this.elementRef=o,this.opContextMenu=s}open(o){this.opContextMenu.show(this,o,lr)}get locals(){return{workPackage:this.workPackage,contextMenuId:"github-integration-git-actions-menu",items:[]}}}dr.\u0275fac=function(o){return new(o||dr)(e.Y36(e.SBq),e.Y36(Fr.$))},dr.\u0275dir=e.lG2({type:dr,selectors:[["","gitActionsCopyDropdown",""]],inputs:{workPackage:["gitActionsCopyDropdown-workPackage","workPackage"]},features:[e.qOj]});class pr{constructor(o){this.I18n=o,this.text={title:this.I18n.t("js.github_integration.tab_header.title"),createPrButtonLabel:this.I18n.t("js.github_integration.tab_header.create_pr.label"),createPrButtonDescription:this.I18n.t("js.github_integration.tab_header.create_pr.description"),gitMenuLabel:this.I18n.t("js.github_integration.tab_header.copy_menu.label"),gitMenuDescription:this.I18n.t("js.github_integration.tab_header.copy_menu.description")}}}pr.\u0275fac=function(o){return new(o||pr)(e.Y36(y.D))},pr.\u0275cmp=e.Xpm({type:pr,selectors:[["tab-header"]],inputs:{workPackage:"workPackage"},decls:10,vars:4,consts:[[1,"github-pr-header"],[1,"title"],["icon-classes","button--icon icon-merge-branch"],[1,"toolbar-items","hide-when-print"],[1,"toolbar-item"],["type","button","gitActionsCopyDropdown","",1,"button","github-git-copy",3,"gitActionsCopyDropdown-workPackage"],["icon-classes","button--icon icon-console-light"],["aria-hidden","true",1,"button--text",3,"textContent"],["icon-classes","button--icon icon-small icon-pulldown hidden-for-mobile"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.TgZ(1,"h3",1),e._UZ(2,"op-icon",2),e._uU(3),e.qZA(),e.TgZ(4,"ul",3),e.TgZ(5,"li",4),e.TgZ(6,"button",5),e._UZ(7,"op-icon",6),e._UZ(8,"span",7),e._UZ(9,"op-icon",8),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&o&&(e.xp6(3),e.hij(" ",s.text.title," "),e.xp6(3),e.Q6J("gitActionsCopyDropdown-workPackage",s.workPackage),e.uIk("aria-label",s.text.gitMenuDescription),e.xp6(2),e.Q6J("textContent",s.text.gitMenuLabel))},directives:[ut.o,dr],styles:[".github-pr-header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap-reverse;justify-content:flex-end;border-bottom:1px solid #ddd;margin:0 0 .8rem}.github-pr-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{flex:1 1 auto;border-bottom:0;margin:0;padding:0;font-weight:bold;font-size:1rem;line-height:32px;text-transform:uppercase}"]});var R_=t(21501);function F_(g,o){if(1&g&&e._UZ(0,"img",12),2&g){const s=e.oxw();e.Q6J("src",s.pullRequest.githubUser.avatarUrl,e.LSH)}}function Z_(g,o){if(1&g&&e._UZ(0,"a",13),2&g){const s=e.oxw();e.Q6J("href",s.pullRequest.githubUser.htmlUrl,e.LSH)("textContent",s.pullRequest.githubUser.login)}}function W_(g,o){if(1&g&&(e.TgZ(0,"span",14),e._uU(1),e.qZA()),2&g){const s=e.oxw();e.xp6(1),e.Oqu(s.text.label_actions)}}function L_(g,o){if(1&g&&(e.TgZ(0,"li",17),e.TgZ(1,"span",18),e._UZ(2,"op-icon",19),e.qZA(),e.TgZ(3,"span",20),e._UZ(4,"img",21),e.qZA(),e.TgZ(5,"span",22),e._UZ(6,"span",23),e._UZ(7,"span",24),e.qZA(),e.TgZ(8,"span",25),e.TgZ(9,"a",26),e._uU(10),e.qZA(),e.qZA(),e.qZA()),2&g){const s=o.$implicit,w=e.oxw(2);e.xp6(1),e.Q6J("ngClass","op-pr-check--state-icon_"+w.checkRunState(s)),e.xp6(1),e.MGl("icon-classes","icon-",w.checkRunStateIcon(s),""),e.Q6J("icon-title",w.checkRunStateText(s)),e.xp6(2),e.Q6J("src",s.appOwnerAvatarUrl,e.LSH),e.xp6(2),e.Q6J("textContent",s.name),e.xp6(1),e.Q6J("textContent",w.checkRunStateText(s)),e.xp6(2),e.Q6J("href",s.detailsUrl,e.LSH),e.xp6(1),e.hij(" ",w.text.label_details," ")}}function U_(g,o){if(1&g&&(e.TgZ(0,"ul",15),e.YNc(1,L_,11,8,"li",16),e.qZA()),2&g){const s=e.oxw();e.uIk("aria-label",s.text.label_actions),e.xp6(1),e.Q6J("ngForOf",s.pullRequest.checkRuns)}}class ur{constructor(o,s){this.PathHelper=o,this.I18n=s,this.text={label_created_by:this.I18n.t("js.label_created_by"),label_last_updated_on:this.I18n.t("js.label_last_updated_on"),label_details:this.I18n.t("js.label_details"),label_actions:this.I18n.t("js.github_integration.github_actions")}}get state(){return"open"===this.pullRequest.state?this.pullRequest.draft?"draft":"open":this.pullRequest.merged?"merged":"closed"}checkRunStateText(o){return o.outputTitle||o.conclusion||o.status}checkRunState(o){return o.conclusion||o.status}checkRunStateIcon(o){switch(this.checkRunState(o)){case"success":return"checkmark";case"queued":return"getting-started";case"in_progress":return"loading1";case"failure":return"cancel";case"timed_out":return"reminder";case"action_required":return"warning";case"stale":return"not-supported";case"skipped":return"redo";case"neutral":case"cancelled":return"minus1";default:return"not-supported"}}}function B_(g,o){if(1&g&&(e.ynx(0),e._UZ(1,"p",2),e.BQk()),2&g){const s=e.oxw();e.xp6(1),e.Q6J("innerHTML",s.getEmptyText(),e.oJD)}}function N_(g,o){if(1&g&&e._UZ(0,"github-pull-request",3),2&g){const s=o.$implicit;e.Q6J("pullRequest",s)}}ur.\u0275fac=function(o){return new(o||ur)(e.Y36(it.j),e.Y36(y.D))},ur.\u0275cmp=e.Xpm({type:ur,selectors:[["github-pull-request"]],hostAttrs:[1,"op-pull-request"],inputs:{pullRequest:"pullRequest"},decls:17,vars:12,consts:[["target","blank",1,"op-pull-request--link",3,"href","textContent"],[1,"op-pull-request--title",3,"textContent"],[1,"op-pull-request--info"],["alt","PR author avatar","class","op-pull-request--avatar op-avatar op-avatar_mini",3,"src",4,"ngIf"],[1,"op-pull-request--user"],[3,"href","textContent",4,"ngIf"],[1,"op-pull-request--date"],[3,"dateTimeValue"],[1,"op-pull-request--state",3,"ngClass"],["icon-classes","button--icon icon-merge-branch"],["class","op-pull-request--checks-label",4,"ngIf"],["class","op-pull-request--checks",4,"ngIf"],["alt","PR author avatar",1,"op-pull-request--avatar","op-avatar","op-avatar_mini",3,"src"],[3,"href","textContent"],[1,"op-pull-request--checks-label"],[1,"op-pull-request--checks"],["class","op-pr-check",4,"ngFor","ngForOf"],[1,"op-pr-check"],[1,"op-pr-check--state-icon",3,"ngClass"],[3,"icon-classes","icon-title"],[1,"op-pr-check--avatar"],["alt","app owner avatar",3,"src"],[1,"op-pr-check--info"],[1,"op-pr-check--name",3,"textContent"],[1,"op-pr-check--state",3,"textContent"],[1,"op-pr-check--details"],[3,"href"]],template:function(o,s){1&o&&(e._UZ(0,"a",0),e._UZ(1,"div",1),e.TgZ(2,"div",2),e._uU(3),e.YNc(4,F_,1,1,"img",3),e.TgZ(5,"span",4),e.YNc(6,Z_,1,2,"a",5),e._uU(7,". "),e.qZA(),e.TgZ(8,"span",6),e._uU(9),e._UZ(10,"op-date-time",7),e.qZA(),e._uU(11,".\n"),e.qZA(),e.TgZ(12,"span",8),e._UZ(13,"op-icon",9),e._uU(14),e.qZA(),e.YNc(15,W_,2,1,"span",10),e.YNc(16,U_,2,2,"ul",11)),2&o&&(e.Q6J("href",s.pullRequest.htmlUrl,e.LSH)("textContent",s.pullRequest.repository+"#"+s.pullRequest.number),e.xp6(1),e.Q6J("textContent",s.pullRequest.title),e.xp6(2),e.hij(" ",s.text.label_created_by," "),e.xp6(1),e.Q6J("ngIf",s.pullRequest.githubUser),e.xp6(2),e.Q6J("ngIf",s.pullRequest.githubUser),e.xp6(3),e.hij(" ",s.text.label_last_updated_on," "),e.xp6(1),e.Q6J("dateTimeValue",s.pullRequest.githubUpdatedAt),e.xp6(2),e.Q6J("ngClass","op-pull-request--state_"+s.state),e.xp6(2),e.hij(" ",s.state,"\n"),e.xp6(1),e.Q6J("ngIf",null==s.pullRequest.checkRuns?null:s.pullRequest.checkRuns.length),e.xp6(1),e.Q6J("ngIf",null==s.pullRequest.checkRuns?null:s.pullRequest.checkRuns.length))},directives:[R.O5,R_.F,R.mk,ut.o,R.sg],styles:['.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 0 10px 5px #0000001a;z-index:10000!important}[_nghost-%COMP%], .op-pull-request[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto auto;grid-template-areas:"link link link link" "title title title state" "info info info info" "checks-label checks-label checks-label checks-label" "checks checks checks checks";margin-bottom:11px;padding-bottom:11px;border-bottom:1px solid #dddddd}[_nghost-%COMP%]:last-child, .op-pull-request[_ngcontent-%COMP%]:last-child{border-bottom:none}--title[_nghost-%COMP%], .op-pull-request--title[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;-o-text-overflow:ellipsis;-ms-text-overflow:ellipsis;white-space:nowrap;font-weight:bold;grid-area:title;line-height:32px;margin-right:20px}--avatar[_nghost-%COMP%], .op-pull-request--avatar[_ngcontent-%COMP%]{grid-area:info}--info[_nghost-%COMP%], .op-pull-request--info[_ngcontent-%COMP%]{display:block;margin-bottom:3px;font-size:.9rem;grid-area:info;color:var(--gray-dark);margin-top:-4px}--date[_nghost-%COMP%], .op-pull-request--date[_ngcontent-%COMP%]{grid-area:info}--link[_nghost-%COMP%], .op-pull-request--link[_ngcontent-%COMP%]{grid-area:link;margin-top:6px;font-size:.9rem}--state[_nghost-%COMP%], .op-pull-request--state[_ngcontent-%COMP%]{grid-area:state;display:inline-block;padding:8px 11px;border-radius:16px;border:1px solid #fff;color:#fff;font-size:.9rem;text-transform:capitalize}--state_draft[_nghost-%COMP%], .op-pull-request--state_draft[_ngcontent-%COMP%]{background-color:#6a737d}--state_open[_nghost-%COMP%], .op-pull-request--state_open[_ngcontent-%COMP%]{background-color:#28a745}--state_merged[_nghost-%COMP%], .op-pull-request--state_merged[_ngcontent-%COMP%]{background-color:#6f42c1}--state_closed[_nghost-%COMP%], .op-pull-request--state_closed[_ngcontent-%COMP%]{background-color:#d73a49}--checks-label[_nghost-%COMP%], .op-pull-request--checks-label[_ngcontent-%COMP%]{grid-area:checks-label;margin-top:12px;font-size:.9rem;font-weight:bold}--checks[_nghost-%COMP%], .op-pull-request--checks[_ngcontent-%COMP%]{margin-top:12px;margin-left:0;grid-area:checks}','.op-pr-check[_ngcontent-%COMP%]{display:grid;grid-row:span 4;grid-template-columns:28px 33px 1fr auto;grid-template-areas:"check-state-icon check-avatar check-info check-details";list-style-type:none;border:1px solid #dddddd;padding:.3rem 1rem;background:rgba(0,0,0,.05);font-size:.9rem}.op-pr-check[_ngcontent-%COMP%]:first-child{border-top-right-radius:5px;border-top-left-radius:5px}.op-pr-check[_ngcontent-%COMP%]:last-child{border-bottom-right-radius:5px;border-bottom-left-radius:5px}.op-pr-check--avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{grid-area:check-avatar;display:inline-block;width:22px;height:22px;margin-right:5px;border-radius:var(--user-avatar-border-radius)}.op-pr-check--info[_ngcontent-%COMP%]{grid-area:check-info}.op-pr-check--state[_ngcontent-%COMP%]{color:var(--gray-dark);font-style:italic;margin-left:1em}.op-pr-check--state-icon[_ngcontent-%COMP%]{grid-area:check-state-icon}.op-pr-check--state-icon_queued[_ngcontent-%COMP%]{color:#5f9ea0}.op-pr-check--state-icon_in_progress[_ngcontent-%COMP%]{color:orange}.op-pr-check--state-icon_success[_ngcontent-%COMP%]{color:green}.op-pr-check--state-icon_failure[_ngcontent-%COMP%], .op-pr-check--state-icon_timed_out[_ngcontent-%COMP%], .op-pr-check--state-icon_action_required[_ngcontent-%COMP%], .op-pr-check--state-icon_stale[_ngcontent-%COMP%]{color:red}.op-pr-check--state-icon_skipped[_ngcontent-%COMP%], .op-pr-check--state-icon_neutral[_ngcontent-%COMP%], .op-pr-check--state-icon_cancelled[_ngcontent-%COMP%]{color:gray}.op-pr-check--details[_ngcontent-%COMP%]{grid-area:check-details}']});class hr{constructor(o,s,w,S){this.I18n=o,this.apiV3Service=s,this.halResourceService=w,this.changeDetector=S,this.pullRequests=[]}ngOnInit(){var o;const s=null===(o=this.apiV3Service.work_packages.id({id:this.workPackage.id}))||void 0===o?void 0:o.github_pull_requests.path;this.halResourceService.get(s).subscribe(w=>{this.pullRequests=w.elements,this.changeDetector.detectChanges()})}getEmptyText(){return this.I18n.t("js.github_integration.tab_prs.empty",{wp_id:this.workPackage.id})}}hr.\u0275fac=function(o){return new(o||hr)(e.Y36(y.D),e.Y36(j.T),e.Y36(Ot.u),e.Y36(e.sBO))},hr.\u0275cmp=e.Xpm({type:hr,selectors:[["tab-prs"]],hostAttrs:[1,"op-prs"],inputs:{workPackage:"workPackage"},decls:2,vars:2,consts:[[4,"ngIf"],[3,"pullRequest",4,"ngFor","ngForOf"],[3,"innerHTML"],[3,"pullRequest"]],template:function(o,s){1&o&&(e.YNc(0,B_,2,1,"ng-container",0),e.YNc(1,N_,1,1,"github-pull-request",1)),2&o&&(e.Q6J("ngIf",0===s.pullRequests.length),e.xp6(1),e.Q6J("ngForOf",s.pullRequests))},directives:[R.O5,R.sg,ur],encapsulation:2});class _r{constructor(o,s){this.PathHelper=o,this.I18n=s}}_r.\u0275fac=function(o){return new(o||_r)(e.Y36(it.j),e.Y36(y.D))},_r.\u0275cmp=e.Xpm({type:_r,selectors:[["github-tab"]],inputs:{workPackage:"workPackage"},decls:2,vars:2,consts:[[3,"workPackage"]],template:function(o,s){1&o&&(e._UZ(0,"tab-header",0),e._UZ(1,"tab-prs",0)),2&o&&(e.Q6J("workPackage",s.workPackage),e.xp6(1),e.Q6J("workPackage",s.workPackage))},directives:[pr,hr],encapsulation:2});var Q_=t(61289);class is extends Q_.N{constructor(o){super(),this.ConfigurationService=o}load(o){return o.github_pull_requests.$update().then(s=>this.sortList(s.elements))}sortList(o,s="createdAt"){return _.sortBy(_.flatten(o),s)}}is.\u0275fac=function(o){return new(o||is)(e.LFG(de.e))},is.\u0275prov=e.Yz7({token:is,factory:is.\u0275fac});class ns{constructor(o){o.get(M_.o).register({component:_r,name:I18n.t("js.github_integration.work_packages.tab_name"),id:"github",displayable:s=>!!s.github})}}ns.\u0275fac=function(o){return new(o||ns)(e.LFG(e.zs3))},ns.\u0275mod=e.oAB({type:ns}),ns.\u0275inj=e.cJS({providers:[is],imports:[[l.H,Si.l]]});class os{}os.\u0275fac=function(o){return new(o||os)},os.\u0275mod=e.oAB({type:os}),os.\u0275inj=e.cJS({imports:[[Go,qo,Xo,es,ns]]});var Y_=t(44092),$_=t(48249),V_=t(96457);let na=class extends nr.cf{constructor(){super((0,po.cq)())}};na=(0,H.gn)([(0,nr.yC)({name:"days"}),(0,H.w6)("design:paramtypes",[])],na);var H_=t(69795);class _o extends H_.o{basePath(){return this.apiV3Service.days.path}isNonWorkingDay$(o){const s=moment(o).format("YYYY-MM-DD");return this.requireNonWorkingYear$(o).pipe((0,Ht.U)(w=>-1!==w.findIndex(S=>!S.working&&S.date===s)))}requireNonWorkingYear$(o){const S=[["date","<>d",[moment(o).startOf("year").format("YYYY-MM-DD"),moment(o).endOf("year").format("YYYY-MM-DD")]],["working","=",["f"]]];return this.require({filters:S})}fetchCollection(o){const s=(0,po.ZU)(o);return(0,po.wY)(this.store,s),this.http.get(this.basePath()+s).pipe((0,Ht.U)(w=>(0,po.zv)(w)),(0,Tr.b)(w=>(0,po.V7)(this.store,w,s)),(0,Sa.x)(()=>(0,po.mp)(this.store,s)))}createStore(){return new na}}_o.\u0275fac=function(){let g;return function(s){return(g||(g=e.n5z(_o)))(s||_o)}}(),_o.\u0275prov=e.Yz7({token:_o,factory:_o.\u0275fac});var z_=t(46934);class ss{}ss.\u0275fac=function(o){return new(o||ss)},ss.\u0275mod=e.oAB({type:ss}),ss.\u0275inj=e.cJS({providers:[Ka.v,qr.W,Xr.D,V_.P,wa.a,_o,z_.s]});var K_=t(87523),G_=t(18869);class rs{ngDoBootstrap(o){d.Z.register(...r_),d.Z.bootstrapOptionalDocument(o,document),o._injector.get(C.$).call("openProjectAngularBootstrap").forEach(w=>{d.Z.bootstrapOptionalDocument(o,document,w)})}}rs.\u0275fac=function(o){return new(o||rs)},rs.\u0275mod=e.oAB({type:rs}),rs.\u0275inj=e.cJS({providers:[{provide:c.G,useValue:new c.G},{provide:p.TP,useClass:G_.s,multi:!0},{provide:e.ip1,useFactory:function(g){return()=>{const o=g.get(To),s=g.get(Wn),w=g.get(ao),S=g.get(Oo);g.get(ro),s.register(),w.register(),o.setupListener(),S.register()}},deps:[e.zs3],multi:!0},ud.N,lo,Yr.r,$_.c,hd.O,$e.D,ro],imports:[[n.b2,Jr.rt,l.H,r.s,ss,Bi,Ed.f,m.$,i.E,Oi,a.Z,kl.OpenprojectProjectsModule,f.H,vo,vi,k.OpenprojectCalendarModule,wo,Po,Eo,yo,Lo,Fo,zo,os,Mo,h.UX,p.JF,Io,u.K,Ro,Si.l,Y_.OpenProjectInAppNotificationsModule,K_.a]]});var oa=t(31600);var sa=t(92340),em=t(82561),tm=t(8849);class ra{constructor(){this.contextHooks=[]}addHook(...o){this.contextHooks.push(...o)}hookPromises(){const o=this.contextHooks.map(s=>Promise.resolve(s()));return Promise.all(o)}}class mr extends ra{constructor(){super();const o=document.querySelector("meta[name=openproject_sentry]");this.loadSentry(o)}loadSentry(o){const s=o.dataset.dsn||"",w=o.dataset.version||"unknown",S=parseFloat(o.dataset.tracingFactor||"0.0");t.e("src_app_core_errors_sentry_sentry-dependency_ts").then(t.bind(t,17046)).then(ne=>{const fe=ne.Sentry;fe.init({dsn:s,debug:!sa.N.production,release:w,environment:sa.N.production?"production":"development",integrations:[new ne.Integrations.BrowserTracing],tracesSampler:Ie=>{switch(Ie.transactionContext.op){case"op":case"navigation":return Math.min(.01*S,1);default:return Math.min(.001*S,1)}},ignoreErrors:["The transition has been superseded by a different transition","Uncaught (in promise)","Non-Error exception captured with keys: $embedded, $halType, $links, $loaded"],beforeSend:(Ie,Ne)=>mr.filterEvent(Ie,Ne)}),this.sentryLoaded(fe)})}sentryLoaded(o){this.client=o,o.configureScope(this.setupContext.bind(this))}captureMessage(o,s="info"){this.client?this.client.withScope(w=>{this.setupContext(w).then(()=>this.client.captureMessage(o,em.z.fromString(s)))}):(0,an.qu)("Sentry is not yet loaded, ignoring %O",o)}captureException(o){(!this.client||!o)&&(0,an.qu)("Sentry is not yet loaded, ignoring error %O",o),"string"!=typeof o?this.client.withScope(s=>{this.setupContext(s).then(()=>this.client.captureException(o))}):this.captureMessage(o,"error")}setupContext(o){return(0,H.mG)(this,void 0,void 0,function*(){o.setTag("code_origin","frontend"),o.setTag("locale",window.I18n.locale),o.setTag("domain",window.location.hostname),o.setTag("url_path",window.location.pathname),o.setExtra("url_query",window.location.search),(yield this.hookPromises()).forEach(w=>{Object.keys(w).forEach(S=>{"user"===S?o.setUser({id:w[S]}):o.setTag(S,w[S])})})})}static filterEvent(o,s){const w=null==s?void 0:s.originalException;return w instanceof p.UA?mr.filterHttpError(o,w):w instanceof tm.o?mr.filterHttpError(o,w.httpError):document.body.classList.contains("-unsupported-browser")?(console.warn("Browser is not supported, skipping sentry reporting completely."),null):o}static filterHttpError(o,s){return s.status>=500?o:null}}class im extends ra{constructor(){super();const o=document.querySelector("meta[name=openproject_appsignal]");this.loadAppsignal(o)}captureMessage(o,s="info"){console.warn("Logging message %O with severity %O",o,s)}captureException(o){if(!this.client||!o)return void(0,an.qu)("Appsignal is not yet loaded, ignoring error %O",o);const s="string"==typeof o?new Error(o):o;this.client.sendError(s,w=>this.setupContext(w))}loadAppsignal(o){const s=o.dataset.pushKey||"",w=o.dataset.version||"";t.e("src_app_core_errors_appsignal_appsignal-dependency_ts").then(t.bind(t,30835)).then(S=>{this.client=new S.Appsignal({namespace:"frontend",key:s,revision:w}),this.client.use(S.networkPlugin())})}setupContext(o){return(0,H.mG)(this,void 0,void 0,function*(){const s=yield this.hookPromises();let w={locale:window.I18n.locale,domain:window.location.hostname,url_path:window.location.pathname,url_query:window.location.search};return s.forEach(S=>{w=Object.assign(Object.assign({},w),S)}),o.setTags(w),o})}}class nm extends ra{captureMessage(o,s="info"){this.handleOfflineMessage("captureMessage",[o,s])}captureException(o){throw this.handleOfflineMessage("captureException",[o]),o}handleOfflineMessage(o,s){(0,an.qu)("[ErrorReporter] Would queue message %O %O, but is not configured.",o,s)}}function am(g){window.OpenProject.getPluginContext().then(o=>{const{opModalService:s}=o.services,w=o.classes.modals.passwordConfirmation;g(document).on("submit","form[data-request-for-confirmation]",function(S){const ne=jQuery(this);return!!ne.find('input[name="_password_confirmation"]').length||function(g,o,s,w){return g.find("_password_confirmation").length>0||(o.preventDefault(),s.show(w,"global").subscribe(ne=>ne.closingEvent.subscribe(()=>{!ne.confirmed||(jQuery("<input>").attr({type:"hidden",name:"_password_confirmation",value:ne.password_confirmation}).appendTo(g),g.trigger("submit"))})),!1)}(ne,S,s,w)})}).catch(()=>{})}function ec(g,o){const s="fieldset-toggle-state-label";let w=g.find(`a span.${s}`);const S=g.children("a");0===w.length&&(w=jQuery("<span />").addClass(s).addClass("hidden-for-sighted"),S.append(w)),w.text(` ${o}`)}function tc(g){const o=g.children("legend");g.hasClass("collapsed")?ec(o,I18n.t("js.label_collapsed")):ec(o,I18n.t("js.label_expanded"))}function ic(g){const o=jQuery(g);if(o.is("legend"))return jQuery(g).parent();if(o.is("fieldset"))return o;throw new Error("Cannot derive fieldset from element!")}function dm(){const g=jQuery("fieldset.form--fieldset.-collapsible");g.on("click",".form--fieldset-legend",function(o){return function(g){const o=ic(g);o.attr("data-touched","true");const s=o.find("> div").not(".form--toolbar");o.toggleClass("collapsed"),s.slideToggle("fast"),tc(o)}(this),o.preventDefault(),o.stopPropagation(),!1}),g.each(function(){const o=ic(this),s=o.find("> div");o.hasClass("collapsed")&&s.hide(),tc(o)})}function hm(){(function(){const g=jQuery("#wrapper"),o=jQuery("ul.menu_root.closed li.open a.arrow-left-to-project");1===o.length&&g.hasClass("hidden-navigation")&&o.trigger("click")})(),jQuery("span.errorSpan").first().find("*").filter(":input").trigger("focus"),sc(),rc(),setTimeout(()=>{jQuery(".flash.autohide-toaster").remove()},5e3),jQuery("body").on("click keydown touchend",".close-handler,.op-toast--close",function(g){("click"===g.type||13===g.which)&&jQuery(this).parent(".flash, .errorExplanation, .op-toast").not(".persistent-toggle--notification").remove()}),jQuery(document).ajaxComplete(sc),jQuery(document).ajaxComplete(rc),jQuery(document).ajaxSend((w,S)=>{jQuery(w.target.activeElement).closest("[ajax-indicated]").length&&jQuery("ajax-indicator")&&jQuery("#ajax-indicator").show();const ne=jQuery("meta[name=csrf-token]");if(ne){const fe="X-CSRF-Token",Ie=ne.attr("content");S.setRequestHeader(fe,Ie)}S.setRequestHeader("X-Authentication-Scheme","Session")}),jQuery(document).ajaxStop(()=>{jQuery("#ajax-indicator")&&jQuery("#ajax-indicator").hide(),nc()}),jQuery(".attachments h4").click(function(){jQuery(this).toggleClass("closed").next().slideToggle(100)});let g=null;jQuery(window).on("resize",()=>{g&&clearTimeout(g),g=setTimeout(()=>{jQuery(window).trigger("resizeEnd")},200)}),jQuery("#nav-login-content").click(w=>{w.stopPropagation()});const o=jQuery("a.afocus").first(),s=jQuery(".autofocus").first();void 0!==o?o.focus():void 0!==s&&(s.focus(),"INPUT"===s[0].tagName&&s.select()),nc(),jQuery(document.body).on("click",".formatting-help-link-button",()=>(window.open(`${window.appBasePath}/help/wiki_syntax`,"","resizable=yes, location=no, width=600, height=640, menubar=no, status=no, scrollbars=yes"),!1))}function nc(){jQuery("a.afocus").each(function(){const g=jQuery(this);g.click(o=>{let s=jQuery(`#${g.attr("href").substr(1)}`);return null===s&&(s=jQuery(`#${g.attr("href").substr(1).concat("_id")}`)),g.unbind(o),!1})})}function oc(g){jQuery(g).each((s,w)=>{jQuery(w).show()})}function sc(){oc(".flash")}function rc(){oc('.errorExplanation[role="alert"]')}var ln=t(12630);function Nn(g,o){return(0,H.mG)(this,void 0,void 0,function*(){(0,an.qu)(`Loading and triggering onboarding tour ${g}`),yield t.e("src_app_core_setup_globals_onboarding_onboarding_tour_ts").then(t.bind(t,36243)).then(s=>{s.start(g,o)})})}var Cm=t(14882);function Tm(){jQuery(document.documentElement).on("click",s=>{const w=jQuery(s.target);return(o=w).hasClass("-augmented-datepicker")&&(o.attr("autocomplete","off"),window.OpenProject.getPluginContext().then(s=>{new Cm.M(s.injector,".-augmented-datepicker",o.val(),{weekNumbers:!0,allowInput:!0},o[0]).show()}).catch(()=>{})),function(g,o){document.contains(g.target)||g.preventDefault();const s=o.closest("a");if(0===s.length)return;const w=s.attr("href")||"",S=w.indexOf("#");""!==w&&0!==S||(-1!==S&&"#"!==w&&(window.location.hash=w),g.preventDefault())}(s,w),!0;var o});const{hash:g}=window.location;if(g&&g.startsWith("#"))try{const s=document.querySelector(g);s&&s.scrollIntoView()}catch(s){console.log(`Could not scroll to given location hash: ${g} ( ${s.message})`)}if(jQuery(document).on("submit","form",()=>{window.OpenProject.pageIsSubmitted=!0}),document.querySelector(".warning-bar--item")){const s=document.querySelector("#content");s&&(s.style.marginBottom="100px")}jQuery(window).on("beforeunload",s=>{const w=s.originalEvent;window.OpenProject.pageWasEdited&&!window.OpenProject.pageIsSubmitted&&(w.preventDefault(),w.returnValue=I18n.t("js.work_packages.confirm_edit_cancel"))}),jQuery(document.documentElement).on("dragover drop",s=>(s.preventDefault(),!1)),function(){const g=document.querySelectorAll(".augment--refresh-on-form-changes");for(let o=0;o<g.length;o++){const s=g[o],w=jQuery(s),S=w.data("refreshUrl"),ne=w.data("inputSelector");setTimeout(()=>{w.find(ne).on("change",fe=>{const Ie=fe.currentTarget;"new_project_id"===Ie.name&&""===Ie.value||(window.location.href=`${S}?${w.serialize()}`)})},100)}}(),am(jQuery),(new z.U).isMobile&&function(){let o=window.scrollY;window.addEventListener("scroll",()=>{const s=window.scrollY<0?0:window.scrollY;!jQuery("#main").hasClass("hidden-navigation")||jQuery(".op-app-header").hasClass("op-app-header_search-open")||Math.abs(s-o)<=55||(void 0!==o&&void 0!==s&&o>s?jQuery("#wrapper").removeClass("_header-scrolled"):jQuery("#wrapper").addClass("_header-scrolled"),o=s)})}(),function(){const g=new URL(window.location.href),o=document.body.classList.contains("-browser-mobile"),s="true"===jQuery("meta[name=demo_projects_available]").attr("content");let w=sessionStorage.getItem(ln.PI),S=!1;!o&&s&&(g.searchParams.get("first_time_user")&&2===(0,ln.Lt)().length&&(w="",sessionStorage.setItem(ln.PI,"readyToStart"),(0,ln.br)(".spot-modal-overlay_active","body",()=>{const ne=document.getElementsByClassName("spot-modal-overlay_active");Array.from(ne).forEach(fe=>{fe.addEventListener("click",Ie=>{Ie.target===fe&&(S=!0,Nn("homescreen"))})})}),document.addEventListener("keydown",ne=>{"Escape"===ne.key&&!S&&(S=!0,Nn("homescreen"))},{once:!0})),"readyToStart"===w&&Nn("homescreen"),("startMainTourFromBacklogs"===w||g.searchParams.get("start_onboarding_tour"))&&Nn("main","startMainTourFromBacklogs"===w?ln.vV.scrum:ln.vV.demo),g.searchParams.get("start_scrum_onboarding_tour")&&(jQuery(".backlogs-menu-item").length>0?Nn("prepareBacklogs",ln.vV.scrum):Nn("taskboard",ln.vV.scrum)),"prepareTaskBoardTour"===w&&Nn("backlogs",ln.vV.scrum),"startTaskBoardTour"===w&&Nn("taskboard",ln.vV.scrum))}(),dm(),jQuery(".project-actions, .toolbar-items").each((s,w)=>{Ea(jQuery(w))}),function(){jQuery("#settings_session_ttl_enabled").on("change",function(){jQuery("#settings_session_ttl_container").toggle(jQuery(this).is(":checked"))}).trigger("change"),jQuery('[name="settings[enabled_scm][]"]').change(function(){const o=!this.checked,s=this.value,w=jQuery("#settings_repositories_automatic_managed_vendor"),S=w.find(`option[value="${s}"]`);0!==S.length&&(S.prop("disabled",o),o&&S.prop("selected")&&w.val(""))});const g=function(o){const s=jQuery(o),w=s.attr("id")||"",S=w.replace("lang-for-",""),ne=s.val(),fe=jQuery(`#settings-${S}`),Ie=fe.siblings("ckeditor-augmented-textarea").data("editor");return{id:w,settingName:S,newLang:ne,textArea:fe,editor:Ie}};jQuery(".lang-select-switch").focus(function(){const o=g(this);jQuery(`#${o.id}-${o.newLang}`).val(o.editor.getData())}).change(function(){const o=g(this),s=jQuery(`#${o.id}-${o.newLang}`).val();o.editor.setData(s),o.textArea.attr("name",`settings[${o.settingName}][${o.newLang}]`)}),jQuery(".admin-settings--form").submit(()=>(jQuery("#settings_consent_required").is(":checked")&&jQuery("#toggle_consent_time").is(":checked")&&jQuery("#settings_consent_time").val((new Date).toISOString()).prop("disabled",!1),!0)),jQuery("#email_delivery_method_switch").on("change",function(){const o=jQuery(this).val();jQuery(".email_delivery_method_settings").hide(),jQuery(`#email_delivery_method_${o}`).show()}).trigger("change"),jQuery("#settings_smtp_authentication").on("change",function(){const o="none"===jQuery(this).val();jQuery("#settings_smtp_user_name,#settings_smtp_password").closest(".form--field").toggle(!o)}),jQuery(".settings-repositories--checkout-toggle").change(function(){const o=this.checked;jQuery(this).closest("fieldset").find("input,select").filter(":not([type=checkbox])").filter(":not([type=hidden])").removeAttr("required").prop("required",o)}),jQuery(".settings--highlighting-mode select").change(function(){const o=jQuery(this).val();jQuery(".settings--highlighted-attributes").toggle("inline"===o)}),0===jQuery(".settings--highlighted-attributes input[type='checkbox']:checked").length&&jQuery(".settings--highlighted-attributes input[type='checkbox']").prop("checked",!0),jQuery("#tab-content-work_packages form").submit(()=>{const o=jQuery(".settings--highlighted-attributes input[type='checkbox']");jQuery(".settings--highlighted-attributes input[type='checkbox']:checked").length===o.length&&o.prop("checked",!1)})}(),jQuery(".color--preview").each(function(){const g=jQuery(this);let o;const s=g.data("target");if(o=s?jQuery(s):g.next("input"),0===o.length)return;const w=function(){let S="";o.val()&&o.val().length>0?S=o.val():o.attr("placeholder")&&o.attr("placeholder").length>0&&(S=o.attr("placeholder")),g.css("background-color",S)};o.keyup(w).change(w).focus(w),w()}),function(){const g=jQuery(".danger-zone--verification"),o=jQuery(".danger-zone--expected-value").text();g.find("input").on("input",()=>{const s=g.find("input").val();o.toLowerCase()===s.toLowerCase()?g.find("button").prop("disabled",!1):g.find("button").prop("disabled",!0)})}(),hm()}window.global=window;window.appBasePath=oa("meta[name=app_base_path]").attr("content")||"",t.p=window.appBasePath+"/assets/frontend/",window.ErrorReporter=null!==document.querySelector("meta[name=openproject_sentry]")?new mr:null!==document.querySelector("meta[name=openproject_appsignal]")?new im:new nm,t(50725),t(44500),sa.N.production&&(0,e.G48)(),(0,an.SC)(()=>{window.enableReactiveStatesLogging=()=>(0,Bo.$C)(!0),window.disableReactiveStatesLogging=()=>(0,Bo.$C)(!1)}),function(){const g=document.querySelector("meta[name=openproject_initializer]"),o=g.dataset.locale||"en",s=parseInt(g.dataset.firstdayofweek||"",10),w=parseInt(g.dataset.firstweekofyear||"",10);return I18n.locale=o,!Number.isNaN(s)&&!Number.isNaN(w)&&(I18n.firstDayOfWeek=s,st.updateLocale(o,{week:{dow:s,doy:7+s-w}})),I18n.pluralization.default=function(S){switch(S){case 0:return["zero","other"];case 1:return["one","other"];default:return["other"]}},t(51230)(`./${I18n.locale}.js`)}().then(()=>{oa(()=>{Tm(),n.q6().bootstrapModule(rs).then(()=>{oa("body").addClass("__ng2-bootstrap-has-run")})})})},30341:(te,M,t)=>{var n={"./apl/apl.js":[55818,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_apl_apl_js"],"./asciiarmor/asciiarmor.js":[36050,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_asciiarmor_asciiarmor_js"],"./asn.1/asn.1.js":[5923,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_asn_1_asn_1_js"],"./asterisk/asterisk.js":[37277,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_asterisk_asterisk_js"],"./brainfuck/brainfuck.js":[30942,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_brainfuck_brainfuck_js"],"./clike/clike.js":[70409,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_clike_clike_js"],"./clojure/clojure.js":[99505,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_clojure_clojure_js"],"./cmake/cmake.js":[15022,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_cmake_cmake_js"],"./cobol/cobol.js":[96407,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_cobol_cobol_js"],"./coffeescript/coffeescript.js":[13359,"default-node_modules_codemirror_lib_codemirror_js","common"],"./commonlisp/commonlisp.js":[97677,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_commonlisp_commonlisp_js"],"./crystal/crystal.js":[42081,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_crystal_crystal_js"],"./css/css.js":[1040,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_css_css_js"],"./cypher/cypher.js":[13430,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_cypher_cypher_js"],"./d/d.js":[18346,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_d_d_js"],"./dart/dart.js":[21691,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_clike_clike_js","node_modules_codemirror_mode_dart_dart_js"],"./diff/diff.js":[56948,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_diff_diff_js"],"./django/django.js":[73829,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_django_django_js"],"./dockerfile/dockerfile.js":[2875,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_dockerfile_dockerfile_js"],"./dtd/dtd.js":[32178,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_dtd_dtd_js"],"./dylan/dylan.js":[80105,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_dylan_dylan_js"],"./ebnf/ebnf.js":[21856,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ebnf_ebnf_js"],"./ecl/ecl.js":[57813,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ecl_ecl_js"],"./eiffel/eiffel.js":[18251,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_eiffel_eiffel_js"],"./elm/elm.js":[78923,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_elm_elm_js"],"./erlang/erlang.js":[7247,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_erlang_erlang_js"],"./factor/factor.js":[77281,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_factor_factor_js"],"./fcl/fcl.js":[1877,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_fcl_fcl_js"],"./forth/forth.js":[90045,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_forth_forth_js"],"./fortran/fortran.js":[35866,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_fortran_fortran_js"],"./gas/gas.js":[55653,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_gas_gas_js"],"./gfm/gfm.js":[3900,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_markdown_markdown_js","common","node_modules_codemirror_mode_gfm_gfm_js"],"./gherkin/gherkin.js":[56061,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_gherkin_gherkin_js"],"./go/go.js":[94883,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_go_go_js"],"./groovy/groovy.js":[93716,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_groovy_groovy_js"],"./haml/haml.js":[33498,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_haml_haml_js"],"./handlebars/handlebars.js":[41025,"default-node_modules_codemirror_lib_codemirror_js","common"],"./haskell-literate/haskell-literate.js":[70852,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_haskell-literate_haskell-literate_js"],"./haskell/haskell.js":[6370,"default-node_modules_codemirror_lib_codemirror_js","common"],"./haxe/haxe.js":[73066,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_haxe_haxe_js"],"./htmlembedded/htmlembedded.js":[83837,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_htmlembedded_htmlembedded_js"],"./htmlmixed/htmlmixed.js":[26083,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","node_modules_codemirror_mode_htmlmixed_htmlmixed_js"],"./http/http.js":[91872,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_http_http_js"],"./idl/idl.js":[14195,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_idl_idl_js"],"./javascript/javascript.js":[39837,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js"],"./jinja2/jinja2.js":[6136,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_jinja2_jinja2_js"],"./jsx/jsx.js":[71557,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","node_modules_codemirror_mode_jsx_jsx_js"],"./julia/julia.js":[93958,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_julia_julia_js"],"./livescript/livescript.js":[22961,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_livescript_livescript_js"],"./lua/lua.js":[96704,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_lua_lua_js"],"./markdown/markdown.js":[90191,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_markdown_markdown_js"],"./mathematica/mathematica.js":[56569,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mathematica_mathematica_js"],"./mbox/mbox.js":[47905,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mbox_mbox_js"],"./mirc/mirc.js":[36167,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mirc_mirc_js"],"./mllike/mllike.js":[50772,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mllike_mllike_js"],"./modelica/modelica.js":[22860,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_modelica_modelica_js"],"./mscgen/mscgen.js":[60351,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mscgen_mscgen_js"],"./mumps/mumps.js":[87269,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_mumps_mumps_js"],"./nginx/nginx.js":[73946,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_nginx_nginx_js"],"./nsis/nsis.js":[4866,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_nsis_nsis_js"],"./ntriples/ntriples.js":[90951,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ntriples_ntriples_js"],"./octave/octave.js":[66e3,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_octave_octave_js"],"./oz/oz.js":[24371,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_oz_oz_js"],"./pascal/pascal.js":[36390,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_pascal_pascal_js"],"./pegjs/pegjs.js":[85515,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","node_modules_codemirror_mode_pegjs_pegjs_js"],"./perl/perl.js":[66727,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_perl_perl_js"],"./php/php.js":[13283,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","default-node_modules_codemirror_mode_clike_clike_js","node_modules_codemirror_mode_php_php_js"],"./pig/pig.js":[52488,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_pig_pig_js"],"./powershell/powershell.js":[4757,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_powershell_powershell_js"],"./properties/properties.js":[73226,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_properties_properties_js"],"./protobuf/protobuf.js":[23455,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_protobuf_protobuf_js"],"./pug/pug.js":[60850,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","default-node_modules_codemirror_mode_pug_pug_js"],"./puppet/puppet.js":[16367,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_puppet_puppet_js"],"./python/python.js":[84229,"default-node_modules_codemirror_lib_codemirror_js","common"],"./q/q.js":[92885,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_q_q_js"],"./r/r.js":[26389,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_r_r_js"],"./rpm/rpm.js":[77995,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_rpm_rpm_js"],"./rst/rst.js":[15215,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_rst_rst_js"],"./ruby/ruby.js":[88558,"default-node_modules_codemirror_lib_codemirror_js","common"],"./rust/rust.js":[50871,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_rust_rust_js"],"./sas/sas.js":[17540,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_sas_sas_js"],"./sass/sass.js":[49966,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_css_css_js","common"],"./scheme/scheme.js":[99975,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_scheme_scheme_js"],"./shell/shell.js":[11577,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_shell_shell_js"],"./sieve/sieve.js":[31208,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_sieve_sieve_js"],"./slim/slim.js":[26469,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_slim_slim_js"],"./smalltalk/smalltalk.js":[18009,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_smalltalk_smalltalk_js"],"./smarty/smarty.js":[45002,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_smarty_smarty_js"],"./solr/solr.js":[20899,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_solr_solr_js"],"./soy/soy.js":[5369,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","node_modules_codemirror_mode_soy_soy_js"],"./sparql/sparql.js":[99767,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_sparql_sparql_js"],"./spreadsheet/spreadsheet.js":[31343,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_spreadsheet_spreadsheet_js"],"./sql/sql.js":[85883,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_sql_sql_js"],"./stex/stex.js":[18681,"default-node_modules_codemirror_lib_codemirror_js","common"],"./stylus/stylus.js":[78176,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_stylus_stylus_js"],"./swift/swift.js":[68711,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_swift_swift_js"],"./tcl/tcl.js":[36410,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_tcl_tcl_js"],"./textile/textile.js":[28556,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_textile_textile_js"],"./tiddlywiki/tiddlywiki.js":[55959,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_tiddlywiki_tiddlywiki_js"],"./tiki/tiki.js":[32740,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_tiki_tiki_js"],"./toml/toml.js":[54804,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_toml_toml_js"],"./tornado/tornado.js":[53373,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","common","node_modules_codemirror_mode_tornado_tornado_js"],"./troff/troff.js":[1462,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_troff_troff_js"],"./ttcn-cfg/ttcn-cfg.js":[37942,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ttcn-cfg_ttcn-cfg_js"],"./ttcn/ttcn.js":[88430,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_ttcn_ttcn_js"],"./turtle/turtle.js":[18409,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_turtle_turtle_js"],"./twig/twig.js":[71632,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_twig_twig_js"],"./vb/vb.js":[58781,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_vb_vb_js"],"./vbscript/vbscript.js":[24594,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_vbscript_vbscript_js"],"./velocity/velocity.js":[97145,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_velocity_velocity_js"],"./verilog/verilog.js":[2456,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_verilog_verilog_js"],"./vhdl/vhdl.js":[92865,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_vhdl_vhdl_js"],"./vue/vue.js":[88869,"default-node_modules_codemirror_lib_codemirror_js","default-node_modules_codemirror_mode_javascript_javascript_js","default-node_modules_codemirror_mode_css_css_js","default-node_modules_codemirror_mode_stylus_stylus_js","default-node_modules_codemirror_mode_pug_pug_js","common","node_modules_codemirror_mode_vue_vue_js"],"./wast/wast.js":[38602,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_wast_wast_js"],"./webidl/webidl.js":[79883,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_webidl_webidl_js"],"./xml/xml.js":[79140,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_xml_xml_js"],"./xquery/xquery.js":[34218,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_xquery_xquery_js"],"./yacas/yacas.js":[34785,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_yacas_yacas_js"],"./yaml-frontmatter/yaml-frontmatter.js":[796,"default-node_modules_codemirror_lib_codemirror_js","common","node_modules_codemirror_mode_yaml-frontmatter_yaml-frontmatter_js"],"./yaml/yaml.js":[35098,"default-node_modules_codemirror_lib_codemirror_js","common"],"./z80/z80.js":[59190,"default-node_modules_codemirror_lib_codemirror_js","node_modules_codemirror_mode_z80_z80_js"]};function e(p){if(!t.o(n,p))return Promise.resolve().then(()=>{var i=new Error("Cannot find module '"+p+"'");throw i.code="MODULE_NOT_FOUND",i});var h=n[p],c=h[0];return Promise.all(h.slice(1).map(t.e)).then(()=>t.t(c,23))}e.keys=()=>Object.keys(n),e.id=30341,te.exports=e},32198:(te,M,t)=>{te.exports=global.I18n=t(32091)},46700:(te,M,t)=>{var n={"./af":62275,"./af.js":62275,"./ar":90857,"./ar-dz":11218,"./ar-dz.js":11218,"./ar-kw":14754,"./ar-kw.js":14754,"./ar-ly":66680,"./ar-ly.js":66680,"./ar-ma":92178,"./ar-ma.js":92178,"./ar-sa":56522,"./ar-sa.js":56522,"./ar-tn":95682,"./ar-tn.js":95682,"./ar.js":90857,"./az":70164,"./az.js":70164,"./be":79774,"./be.js":79774,"./bg":60947,"./bg.js":60947,"./bm":21832,"./bm.js":21832,"./bn":89650,"./bn-bd":74477,"./bn-bd.js":74477,"./bn.js":89650,"./bo":66005,"./bo.js":66005,"./br":98492,"./br.js":98492,"./bs":70534,"./bs.js":70534,"./ca":52061,"./ca.js":52061,"./cs":84737,"./cs.js":84737,"./cv":61167,"./cv.js":61167,"./cy":77996,"./cy.js":77996,"./da":9528,"./da.js":9528,"./de":14540,"./de-at":49430,"./de-at.js":49430,"./de-ch":67978,"./de-ch.js":67978,"./de.js":14540,"./dv":83426,"./dv.js":83426,"./el":6616,"./el.js":6616,"./en-au":63816,"./en-au.js":63816,"./en-ca":32162,"./en-ca.js":32162,"./en-gb":83305,"./en-gb.js":83305,"./en-ie":61954,"./en-ie.js":61954,"./en-il":43060,"./en-il.js":43060,"./en-in":59923,"./en-in.js":59923,"./en-nz":13540,"./en-nz.js":13540,"./en-sg":16505,"./en-sg.js":16505,"./eo":41907,"./eo.js":41907,"./es":86640,"./es-do":41246,"./es-do.js":41246,"./es-mx":56131,"./es-mx.js":56131,"./es-us":36430,"./es-us.js":36430,"./es.js":86640,"./et":62551,"./et.js":62551,"./eu":32711,"./eu.js":32711,"./fa":54572,"./fa.js":54572,"./fi":33390,"./fi.js":33390,"./fil":87860,"./fil.js":87860,"./fo":48216,"./fo.js":48216,"./fr":99291,"./fr-ca":98527,"./fr-ca.js":98527,"./fr-ch":58407,"./fr-ch.js":58407,"./fr.js":99291,"./fy":47054,"./fy.js":47054,"./ga":49540,"./ga.js":49540,"./gd":73917,"./gd.js":73917,"./gl":51486,"./gl.js":51486,"./gom-deva":56245,"./gom-deva.js":56245,"./gom-latn":48868,"./gom-latn.js":48868,"./gu":59652,"./gu.js":59652,"./he":89019,"./he.js":89019,"./hi":42040,"./hi.js":42040,"./hr":63402,"./hr.js":63402,"./hu":79322,"./hu.js":79322,"./hy-am":27609,"./hy-am.js":27609,"./id":57942,"./id.js":57942,"./is":98275,"./is.js":98275,"./it":73053,"./it-ch":4378,"./it-ch.js":4378,"./it.js":73053,"./ja":46176,"./ja.js":46176,"./jv":679,"./jv.js":679,"./ka":92726,"./ka.js":92726,"./kk":72953,"./kk.js":72953,"./km":86957,"./km.js":86957,"./kn":59181,"./kn.js":59181,"./ko":47148,"./ko.js":47148,"./ku":27752,"./ku.js":27752,"./ky":65675,"./ky.js":65675,"./lb":41263,"./lb.js":41263,"./lo":65746,"./lo.js":65746,"./lt":11143,"./lt.js":11143,"./lv":38753,"./lv.js":38753,"./me":44054,"./me.js":44054,"./mi":31573,"./mi.js":31573,"./mk":30202,"./mk.js":30202,"./ml":68523,"./ml.js":68523,"./mn":79794,"./mn.js":79794,"./mr":56681,"./mr.js":56681,"./ms":56975,"./ms-my":39859,"./ms-my.js":39859,"./ms.js":56975,"./mt":3691,"./mt.js":3691,"./my":5152,"./my.js":5152,"./nb":7607,"./nb.js":7607,"./ne":21526,"./ne.js":21526,"./nl":86368,"./nl-be":40076,"./nl-be.js":40076,"./nl.js":86368,"./nn":68420,"./nn.js":68420,"./oc-lnc":51906,"./oc-lnc.js":51906,"./pa-in":94504,"./pa-in.js":94504,"./pl":54721,"./pl.js":54721,"./pt":74645,"./pt-br":54548,"./pt-br.js":54548,"./pt.js":74645,"./ro":71977,"./ro.js":71977,"./ru":26042,"./ru.js":26042,"./sd":78849,"./sd.js":78849,"./se":27739,"./se.js":27739,"./si":50084,"./si.js":50084,"./sk":92449,"./sk.js":92449,"./sl":23086,"./sl.js":23086,"./sq":33139,"./sq.js":33139,"./sr":30607,"./sr-cyrl":30063,"./sr-cyrl.js":30063,"./sr.js":30607,"./ss":40131,"./ss.js":40131,"./sv":21665,"./sv.js":21665,"./sw":5642,"./sw.js":5642,"./ta":33622,"./ta.js":33622,"./te":74825,"./te.js":74825,"./tet":48336,"./tet.js":48336,"./tg":39238,"./tg.js":39238,"./th":99463,"./th.js":99463,"./tk":39986,"./tk.js":39986,"./tl-ph":29672,"./tl-ph.js":29672,"./tlh":40043,"./tlh.js":40043,"./tr":51212,"./tr.js":51212,"./tzl":50110,"./tzl.js":50110,"./tzm":80482,"./tzm-latn":38309,"./tzm-latn.js":38309,"./tzm.js":80482,"./ug-cn":42495,"./ug-cn.js":42495,"./uk":54157,"./uk.js":54157,"./ur":80984,"./ur.js":80984,"./uz":64141,"./uz-latn":43662,"./uz-latn.js":43662,"./uz.js":64141,"./vi":12607,"./vi.js":12607,"./x-pseudo":66460,"./x-pseudo.js":66460,"./yo":92948,"./yo.js":92948,"./zh-cn":62658,"./zh-cn.js":62658,"./zh-hk":39352,"./zh-hk.js":39352,"./zh-mo":38274,"./zh-mo.js":38274,"./zh-tw":98451,"./zh-tw.js":98451};function e(h){var c=p(h);return t(c)}function p(h){if(!t.o(n,h)){var c=new Error("Cannot find module '"+h+"'");throw c.code="MODULE_NOT_FOUND",c}return n[h]}e.keys=function(){return Object.keys(n)},e.resolve=p,te.exports=e,e.id=46700},37294:(te,M,t)=>{var n={"./admin_users":[5022,7,"src_app_core_augmenting_dynamic-scripts_admin_users_js"],"./admin_users.js":[5022,7,"src_app_core_augmenting_dynamic-scripts_admin_users_js"],"./administration_settings":[62739,7,"src_app_core_augmenting_dynamic-scripts_administration_settings_js"],"./administration_settings.js":[62739,7,"src_app_core_augmenting_dynamic-scripts_administration_settings_js"],"./backlogs":[32505,7,"common","src_app_core_augmenting_dynamic-scripts_backlogs_js"],"./backlogs.js":[32505,7,"common","src_app_core_augmenting_dynamic-scripts_backlogs_js"],"./backlogs/backlog":[57915,7,"common"],"./backlogs/backlog.js":[57915,7,"common"],"./backlogs/burndown":[12847,7,"common"],"./backlogs/burndown.js":[12847,7,"common"],"./backlogs/common":[61562,7,"common"],"./backlogs/common.js":[61562,7,"common"],"./backlogs/editable_inplace":[68040,7,"common"],"./backlogs/editable_inplace.js":[68040,7,"common"],"./backlogs/impediment":[86733,7,"common"],"./backlogs/impediment.js":[86733,7,"common"],"./backlogs/master_backlog":[6250,7,"common"],"./backlogs/master_backlog.js":[6250,7,"common"],"./backlogs/model":[20527,7,"common"],"./backlogs/model.js":[20527,7,"common"],"./backlogs/show_main":[63074,7,"common"],"./backlogs/show_main.js":[63074,7,"common"],"./backlogs/sprint":[80933,7,"common"],"./backlogs/sprint.js":[80933,7,"common"],"./backlogs/story":[71076,7,"common"],"./backlogs/story.js":[71076,7,"common"],"./backlogs/task":[10926,7,"common"],"./backlogs/task.js":[10926,7,"common"],"./backlogs/taskboard":[59439,7,"common"],"./backlogs/taskboard.js":[59439,7,"common"],"./backlogs/work_package":[39503,7,"common"],"./backlogs/work_package.js":[39503,7,"common"],"./custom_fields":[95691,7,"src_app_core_augmenting_dynamic-scripts_custom_fields_js"],"./custom_fields.js":[95691,7,"src_app_core_augmenting_dynamic-scripts_custom_fields_js"],"./forums":[99068,7,"src_app_core_augmenting_dynamic-scripts_forums_js"],"./forums.js":[99068,7,"src_app_core_augmenting_dynamic-scripts_forums_js"],"./global_roles":[49140,7,"src_app_core_augmenting_dynamic-scripts_global_roles_ts"],"./global_roles.ts":[49140,7,"src_app_core_augmenting_dynamic-scripts_global_roles_ts"],"./meeting":[81522,7,"src_app_core_augmenting_dynamic-scripts_meeting_js"],"./meeting.js":[81522,7,"src_app_core_augmenting_dynamic-scripts_meeting_js"],"./members_form":[48299,7,"src_app_core_augmenting_dynamic-scripts_members_form_js"],"./members_form.js":[48299,7,"src_app_core_augmenting_dynamic-scripts_members_form_js"],"./new_user":[52722,7,"src_app_core_augmenting_dynamic-scripts_new_user_js"],"./new_user.js":[52722,7,"src_app_core_augmenting_dynamic-scripts_new_user_js"],"./project":[98798,7,"src_app_core_augmenting_dynamic-scripts_project_js"],"./project.js":[98798,7,"src_app_core_augmenting_dynamic-scripts_project_js"],"./project_form_listener":[65904,7,"src_app_core_augmenting_dynamic-scripts_project_form_listener_js"],"./project_form_listener.js":[65904,7,"src_app_core_augmenting_dynamic-scripts_project_form_listener_js"],"./repository_navigation":[78076,7,"src_app_core_augmenting_dynamic-scripts_repository_navigation_js"],"./repository_navigation.js":[78076,7,"src_app_core_augmenting_dynamic-scripts_repository_navigation_js"],"./repository_settings":[58562,7,"src_app_core_augmenting_dynamic-scripts_repository_settings_js"],"./repository_settings.js":[58562,7,"src_app_core_augmenting_dynamic-scripts_repository_settings_js"],"./two_factor_authentication":[84078,9,"src_app_core_augmenting_dynamic-scripts_two_factor_authentication_ts"],"./two_factor_authentication.ts":[84078,9,"src_app_core_augmenting_dynamic-scripts_two_factor_authentication_ts"]};function e(p){if(!t.o(n,p))return Promise.resolve().then(()=>{var i=new Error("Cannot find module '"+p+"'");throw i.code="MODULE_NOT_FOUND",i});var h=n[p],c=h[0];return Promise.all(h.slice(2).map(t.e)).then(()=>t.t(c,16|h[1]))}e.keys=()=>Object.keys(n),e.id=37294,te.exports=e},51230:(te,M,t)=>{var n={"./af.js":[63158,"src_locales_af_js"],"./ar.js":[71100,"src_locales_ar_js"],"./az.js":[8135,"src_locales_az_js"],"./be.js":[27095,"src_locales_be_js"],"./bg.js":[2140,"src_locales_bg_js"],"./bn.js":[27e3,"src_locales_bn_js"],"./bs.js":[72886,"src_locales_bs_js"],"./ca-CAT.js":[76700,"src_locales_ca-CAT_js"],"./ca.js":[83103,"src_locales_ca_js"],"./ckb-IR.js":[79637,"src_locales_ckb-IR_js"],"./cs.js":[54042,"src_locales_cs_js"],"./cy.js":[28689,"src_locales_cy_js"],"./da-DK.js":[4399,"src_locales_da-DK_js"],"./da.js":[7331,"src_locales_da_js"],"./de-AT.js":[72475,"src_locales_de-AT_js"],"./de-CH.js":[16864,"src_locales_de-CH_js"],"./de-DE.js":[72082,"src_locales_de-DE_js"],"./de.js":[81972,"src_locales_de_js"],"./dz.js":[10681,"src_locales_dz_js"],"./ee.js":[3682,"src_locales_ee_js"],"./el-CY.js":[64354,"src_locales_el-CY_js"],"./el.js":[97792,"src_locales_el_js"],"./en-AU.js":[45079,"src_locales_en-AU_js"],"./en-BORK.js":[73697,"src_locales_en-BORK_js"],"./en-CA.js":[10653,"src_locales_en-CA_js"],"./en-CY.js":[20608,"src_locales_en-CY_js"],"./en-GB.js":[85186,"src_locales_en-GB_js"],"./en-IE.js":[78114,"src_locales_en-IE_js"],"./en-IN.js":[29656,"src_locales_en-IN_js"],"./en-IND.js":[4861,"src_locales_en-IND_js"],"./en-MS.js":[65442,"src_locales_en-MS_js"],"./en-NEP.js":[56844,"src_locales_en-NEP_js"],"./en-NG.js":[19325,"src_locales_en-NG_js"],"./en-NZ.js":[6086,"src_locales_en-NZ_js"],"./en-PAK.js":[58215,"src_locales_en-PAK_js"],"./en-SG.js":[66590,"src_locales_en-SG_js"],"./en-TH.js":[11443,"src_locales_en-TH_js"],"./en-TT.js":[75109,"src_locales_en-TT_js"],"./en-UG.js":[76819,"src_locales_en-UG_js"],"./en-US.js":[66183,"src_locales_en-US_js"],"./en-ZA.js":[26790,"src_locales_en-ZA_js"],"./en-au-ocker.js":[82676,"src_locales_en-au-ocker_js"],"./en.js":[49058,"src_locales_en_js"],"./eo.js":[13634,"src_locales_eo_js"],"./es-419.js":[14585,"src_locales_es-419_js"],"./es-AR.js":[84730,"src_locales_es-AR_js"],"./es-CL.js":[90497,"src_locales_es-CL_js"],"./es-CO.js":[58668,"src_locales_es-CO_js"],"./es-CR.js":[61158,"src_locales_es-CR_js"],"./es-EC.js":[51495,"src_locales_es-EC_js"],"./es-ES.js":[73295,"src_locales_es-ES_js"],"./es-MX.js":[86920,"src_locales_es-MX_js"],"./es-NI.js":[72142,"src_locales_es-NI_js"],"./es-PA.js":[71093,"src_locales_es-PA_js"],"./es-PE.js":[1470,"src_locales_es-PE_js"],"./es-US.js":[41433,"src_locales_es-US_js"],"./es-VE.js":[68880,"src_locales_es-VE_js"],"./es.js":[48238,"src_locales_es_js"],"./et.js":[97443,"src_locales_et_js"],"./eu.js":[84126,"src_locales_eu_js"],"./fa.js":[81870,"src_locales_fa_js"],"./fi-FI.js":[1552,"src_locales_fi-FI_js"],"./fi.js":[13587,"src_locales_fi_js"],"./fil.js":[7612,"src_locales_fil_js"],"./fr-CA.js":[82236,"src_locales_fr-CA_js"],"./fr-CH.js":[71025,"src_locales_fr-CH_js"],"./fr-FR.js":[81079,"src_locales_fr-FR_js"],"./fr.js":[38703,"src_locales_fr_js"],"./fy.js":[60658,"src_locales_fy_js"],"./gl.js":[61372,"src_locales_gl_js"],"./he.js":[62539,"src_locales_he_js"],"./hi-IN.js":[86299,"src_locales_hi-IN_js"],"./hi.js":[65684,"src_locales_hi_js"],"./hr.js":[69006,"src_locales_hr_js"],"./hu.js":[67207,"src_locales_hu_js"],"./hy.js":[69662,"src_locales_hy_js"],"./id.js":[67629,"src_locales_id_js"],"./is.js":[88879,"src_locales_is_js"],"./it-CH.js":[42753,"src_locales_it-CH_js"],"./it.js":[91281,"src_locales_it_js"],"./ja.js":[25276,"src_locales_ja_js"],"./ka.js":[87716,"src_locales_ka_js"],"./kk.js":[87693,"src_locales_kk_js"],"./km.js":[20202,"src_locales_km_js"],"./kn.js":[71330,"src_locales_kn_js"],"./ko.js":[9312,"src_locales_ko_js"],"./lb.js":[39574,"src_locales_lb_js"],"./lo.js":[46772,"src_locales_lo_js"],"./lol.js":[61908,"src_locales_lol_js"],"./lt.js":[38328,"src_locales_lt_js"],"./lv.js":[82289,"src_locales_lv_js"],"./mg.js":[94740,"src_locales_mg_js"],"./mi-NZ.js":[6740,"src_locales_mi-NZ_js"],"./mk.js":[91210,"src_locales_mk_js"],"./ml.js":[87452,"src_locales_ml_js"],"./mn.js":[79835,"src_locales_mn_js"],"./mr-IN.js":[32737,"src_locales_mr-IN_js"],"./ms.js":[12873,"src_locales_ms_js"],"./nb-NO.js":[52915,"src_locales_nb-NO_js"],"./nb.js":[99343,"src_locales_nb_js"],"./ne.js":[60983,"src_locales_ne_js"],"./nl.js":[63837,"src_locales_nl_js"],"./nn.js":[62144,"src_locales_nn_js"],"./no-NO.js":[40855,"src_locales_no-NO_js"],"./no.js":[42684,"src_locales_no_js"],"./oc.js":[76003,"src_locales_oc_js"],"./or.js":[89030,"src_locales_or_js"],"./pa.js":[42335,"src_locales_pa_js"],"./pap-AW.js":[82268,"src_locales_pap-AW_js"],"./pap-CW.js":[76212,"src_locales_pap-CW_js"],"./pl.js":[52635,"src_locales_pl_js"],"./pt-BR.js":[94145,"src_locales_pt-BR_js"],"./pt-PT.js":[40643,"src_locales_pt-PT_js"],"./pt.js":[38366,"src_locales_pt_js"],"./rm.js":[99603,"src_locales_rm_js"],"./ro.js":[58721,"src_locales_ro_js"],"./ru.js":[85745,"src_locales_ru_js"],"./rw.js":[79666,"src_locales_rw_js"],"./sc.js":[46723,"src_locales_sc_js"],"./si.js":[74743,"src_locales_si_js"],"./sk.js":[88230,"src_locales_sk_js"],"./sl.js":[31928,"src_locales_sl_js"],"./sq.js":[41520,"src_locales_sq_js"],"./sr.js":[84072,"src_locales_sr_js"],"./st.js":[58413,"src_locales_st_js"],"./sv-FI.js":[28374,"src_locales_sv-FI_js"],"./sv-SE.js":[88395,"src_locales_sv-SE_js"],"./sv.js":[80919,"src_locales_sv_js"],"./sw.js":[38397,"src_locales_sw_js"],"./ta.js":[27908,"src_locales_ta_js"],"./te.js":[83950,"src_locales_te_js"],"./th.js":[33683,"src_locales_th_js"],"./tl.js":[43909,"src_locales_tl_js"],"./tr.js":[65320,"src_locales_tr_js"],"./tt.js":[99083,"src_locales_tt_js"],"./ug.js":[34557,"src_locales_ug_js"],"./uk.js":[5034,"src_locales_uk_js"],"./ur.js":[2978,"src_locales_ur_js"],"./uz.js":[38964,"src_locales_uz_js"],"./vi.js":[88695,"src_locales_vi_js"],"./wo.js":[36511,"src_locales_wo_js"],"./zh-CN.js":[42640,"src_locales_zh-CN_js"],"./zh-HK.js":[17264,"src_locales_zh-HK_js"],"./zh-TW.js":[34573,"src_locales_zh-TW_js"],"./zh-YUE.js":[17662,"src_locales_zh-YUE_js"]};function e(p){if(!t.o(n,p))return Promise.resolve().then(()=>{var i=new Error("Cannot find module '"+p+"'");throw i.code="MODULE_NOT_FOUND",i});var h=n[p],c=h[0];return t.e(h[1]).then(()=>t.t(c,23))}e.keys=()=>Object.keys(n),e.id=51230,te.exports=e},87983:(te,M,t)=>{var n={"./af.js":[61225,"src_vendor_ckeditor_translations_af_js"],"./ar.js":[99858,"src_vendor_ckeditor_translations_ar_js"],"./ast.js":[85552,"src_vendor_ckeditor_translations_ast_js"],"./az.js":[73469,"src_vendor_ckeditor_translations_az_js"],"./bg.js":[44512,"src_vendor_ckeditor_translations_bg_js"],"./bs.js":[28453,"src_vendor_ckeditor_translations_bs_js"],"./ca.js":[26287,"src_vendor_ckeditor_translations_ca_js"],"./cs.js":[4543,"src_vendor_ckeditor_translations_cs_js"],"./da.js":[23677,"src_vendor_ckeditor_translations_da_js"],"./de-ch.js":[94783,"src_vendor_ckeditor_translations_de-ch_js"],"./de.js":[21005,"src_vendor_ckeditor_translations_de_js"],"./el.js":[77507,"src_vendor_ckeditor_translations_el_js"],"./en-au.js":[81258,"src_vendor_ckeditor_translations_en-au_js"],"./en-gb.js":[90287,"src_vendor_ckeditor_translations_en-gb_js"],"./eo.js":[90298,"src_vendor_ckeditor_translations_eo_js"],"./es.js":[88151,"src_vendor_ckeditor_translations_es_js"],"./et.js":[47523,"src_vendor_ckeditor_translations_et_js"],"./eu.js":[27170,"src_vendor_ckeditor_translations_eu_js"],"./fa.js":[44090,"src_vendor_ckeditor_translations_fa_js"],"./fi.js":[37469,"src_vendor_ckeditor_translations_fi_js"],"./fr.js":[34457,"src_vendor_ckeditor_translations_fr_js"],"./gl.js":[7652,"src_vendor_ckeditor_translations_gl_js"],"./gu.js":[68407,"src_vendor_ckeditor_translations_gu_js"],"./he.js":[27929,"src_vendor_ckeditor_translations_he_js"],"./hi.js":[35011,"src_vendor_ckeditor_translations_hi_js"],"./hr.js":[49871,"src_vendor_ckeditor_translations_hr_js"],"./hu.js":[44330,"src_vendor_ckeditor_translations_hu_js"],"./id.js":[12297,"src_vendor_ckeditor_translations_id_js"],"./it.js":[94680,"src_vendor_ckeditor_translations_it_js"],"./ja.js":[32041,"src_vendor_ckeditor_translations_ja_js"],"./jv.js":[76835,"src_vendor_ckeditor_translations_jv_js"],"./km.js":[5338,"src_vendor_ckeditor_translations_km_js"],"./kn.js":[42542,"src_vendor_ckeditor_translations_kn_js"],"./ko.js":[55539,"src_vendor_ckeditor_translations_ko_js"],"./ku.js":[50326,"src_vendor_ckeditor_translations_ku_js"],"./lt.js":[99071,"src_vendor_ckeditor_translations_lt_js"],"./lv.js":[10779,"src_vendor_ckeditor_translations_lv_js"],"./ms.js":[20624,"src_vendor_ckeditor_translations_ms_js"],"./nb.js":[38611,"src_vendor_ckeditor_translations_nb_js"],"./ne.js":[12749,"src_vendor_ckeditor_translations_ne_js"],"./nl.js":[48140,"src_vendor_ckeditor_translations_nl_js"],"./no.js":[41831,"src_vendor_ckeditor_translations_no_js"],"./oc.js":[90459,"src_vendor_ckeditor_translations_oc_js"],"./pl.js":[79377,"src_vendor_ckeditor_translations_pl_js"],"./pt-br.js":[97416,"src_vendor_ckeditor_translations_pt-br_js"],"./pt.js":[55567,"src_vendor_ckeditor_translations_pt_js"],"./ro.js":[87462,"src_vendor_ckeditor_translations_ro_js"],"./ru.js":[25675,"src_vendor_ckeditor_translations_ru_js"],"./si.js":[89298,"src_vendor_ckeditor_translations_si_js"],"./sk.js":[78948,"src_vendor_ckeditor_translations_sk_js"],"./sl.js":[6921,"src_vendor_ckeditor_translations_sl_js"],"./sq.js":[92816,"src_vendor_ckeditor_translations_sq_js"],"./sr-latn.js":[67221,"src_vendor_ckeditor_translations_sr-latn_js"],"./sr.js":[91817,"src_vendor_ckeditor_translations_sr_js"],"./sv.js":[53530,"src_vendor_ckeditor_translations_sv_js"],"./th.js":[58264,"src_vendor_ckeditor_translations_th_js"],"./tk.js":[80801,"src_vendor_ckeditor_translations_tk_js"],"./tr.js":[57018,"src_vendor_ckeditor_translations_tr_js"],"./tt.js":[54570,"src_vendor_ckeditor_translations_tt_js"],"./ug.js":[25899,"src_vendor_ckeditor_translations_ug_js"],"./uk.js":[66516,"src_vendor_ckeditor_translations_uk_js"],"./ur.js":[92805,"src_vendor_ckeditor_translations_ur_js"],"./uz.js":[36527,"src_vendor_ckeditor_translations_uz_js"],"./vi.js":[26661,"src_vendor_ckeditor_translations_vi_js"],"./zh-cn.js":[55739,"src_vendor_ckeditor_translations_zh-cn_js"],"./zh.js":[86908,"src_vendor_ckeditor_translations_zh_js"]};function e(p){if(!t.o(n,p))return Promise.resolve().then(()=>{var i=new Error("Cannot find module '"+p+"'");throw i.code="MODULE_NOT_FOUND",i});var h=n[p],c=h[0];return t.e(h[1]).then(()=>t.t(c,23))}e.keys=()=>Object.keys(n),e.id=87983,te.exports=e}},te=>{te.O(0,["vendor"],()=>{return n=75492,te(te.s=n);var n});te.O()}]);
//# sourceMappingURL=main.f93cab4b0446552cce03.js.map