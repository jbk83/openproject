{"version":3,"mappings":"kKA2BA,cAIAA,aAGA,OAFAA,wBAEAC,OAKA,uCACAC,4BACAC,4BACAC,kCACAC,gDACAC,8CACAC,2BACAC,gCACAC,2BACAC,sCAEAC,cACAC,gGAEAC,cACAD,mGAEAE,gBACA,oCACAd,uBACAe,mDAGAC,aAAwBF,qBACxBG,aAAwBH,qBACxBI,aACA,iCACAC,aAAsCP,6BAStC,OANAZ,iCACAW,OAEAE,KACAA,KAEAO,aACA,OACAT,KACAK,SACAC,OACAJ,KACAA,KACA,UACA,OACAA,KACAF,KACAA,KACAK,SACAG,IACA,UACA,OACAR,KACAA,KACAK,SACAG,IACA,UACA,YACA,MACAR,KACAM,OACAE,IACA,UACA,OACAF,KACAJ,SACA,UACAF,KACAA,KACAK,SACAG,IACA,UACA,OACAN,KACAF,KACAM,WACAN,KACAE,KACA,cAEAI,SACAN,OAMAS,mCACAF,OAGAlB,aACAA,sBAEAqB,kBACA,oBACArB,gCACAsB,iBACKC,oBAGL,iBACA,4BAGA,OAFAC,aAEAC,WAEA,GAGAC,aACA,4BAGA,OAFAF,aAEAG,UAEA,GAGAC,aACA,4BAGA,OAFAC,wBAEAJ,WAEA,GAGAK,aACA,4BAGA,OAFAD,+BAEAF,UAEA,GAGAI,aACA,cACA,wDACA,sBAEA,8BACAX,YAGA,EAEA,UAIAY,aACA,6DACAZ,uDACAlB,YAEAC,uCAEAA,uEACAA,kEACAA,UAEA,6CACAE,mCAGA,OAFAD,+BAEAkB,6EACAjB,+EACAA,2EACAA,qBAEAH,qCAEAA,0CACAA,0CACAA,4CACAA,4CACAA,iDAEAA,EACA+B,8BACAX,iBACAY,SAEAd,YAEA,GAGAe,aACA,cAEAX,oBACAxB,+BAEAoC,kBACApC,qDACAA,0BAGAwB,wBAKAa,aACArC,QAEAoC,iBACApC,sEACAA,2BAKAA,6BACAA,iCACAA,oCAEAA,qCACAA,uCAEAA,qCACAA,uCAEAA,4CACAA,yCAGA,kEAEAoB,eACAkB,wBACA,UAEAC,wBACA,wCAEAC,0BACA,UAEAC,sBACA,UAEAC,qBACAC,QACAC,kBACAC,iBACAC,iBACAC,kBACAC,8BAIAC,0CACA,mCACA,CACAC,4CAEA,CACAC,UACAC,YACAC,qBACAC,sBACA,yBArRA,CA0RCC","names":["e","length","o","n","c","i","u","p","x","y","v","r","l","s","S","V","m","d","O","f","a","change","attr","trigger","t","before","h","after","g","jQuery","b","k","F","find","click","w","prop","D","isContainer","moves","accepts","invalid","direction","copy","copySortSource","revertOnSpill","removeOnSpill","mirrorContainer","ignoreInputTextSelection","j","document","margin","maxSpeed","scrollWhenOutside","autoScroll","window"],"sources":["./src/app/core/augmenting/dynamic-scripts/custom_fields.js"],"sourcesContent":["//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2022 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See COPYRIGHT and LICENSE files for more details.\n//++\n(function(window, $) {\n  /*\n   * @see /app/views/custom_fields/_form.html.erb\n   */\n  $(function() {\n    var customFieldForm = $('#custom_field_form');\n\n    if (customFieldForm.length === 0) {\n      return;\n    }\n\n    // collect the nodes involved\n    var format                = $('#custom_field_field_format'),\n        lengthField           = $('#custom_field_length'),\n        regexpField           = $('#custom_field_regexp'),\n        multiSelect           = $('#custom_field_multi_select'),\n        possibleValues        = $('#custom_field_possible_values_attributes'),\n        defaultValueFields    = $('#custom_field_default_value_attributes'),\n        spanDefaultText       = $('#default_value_text'),\n        spanDefaultLongText   = $('#default_value_long_text'),\n        spanDefaultBool       = $('#default_value_bool'),\n        textOrientationField  = $('#custom_field_text_orientation');\n\n    var deactivate = function(element) {\n      element.hide().find('input, textarea').not('.destroy_flag,.-cf-ignore-disabled').attr('disabled', true);\n    },\n    activate = function(element) {\n      element.show().find('input, textarea').not('.destroy_flag,.-cf-ignore-disabled').removeAttr('disabled');\n    },\n    toggleVisibility = function(method, args) {\n      var fields = Array.prototype.slice.call(args);\n      $.each(fields, function(idx, field) {\n        field.closest('.form--field, .form--grouping')[method]();\n      });\n    },\n    hide = function() { toggleVisibility('hide', arguments); },\n    show = function() { toggleVisibility('show', arguments); },\n    toggleFormat = function() {\n      var searchable   = $('#searchable_container'),\n          unsearchable = function() { searchable.attr('checked', false).hide(); };\n\n      // defaults (reset these fields before doing anything else)\n      $.each([spanDefaultBool, spanDefaultLongText, spanDefaultText, multiSelect, textOrientationField], function(idx, element) {\n        deactivate(element);\n      });\n      activate(defaultValueFields);\n      activate(spanDefaultText);\n\n      switch (format.val()) {\n        case 'list':\n          deactivate(defaultValueFields);\n          hide(lengthField, regexpField, defaultValueFields);\n          show(searchable, multiSelect);\n          activate(multiSelect);\n          activate(possibleValues);\n          break;\n        case 'bool':\n          activate(spanDefaultBool);\n          deactivate(spanDefaultText);\n          deactivate(possibleValues);\n          hide(lengthField, regexpField, searchable);\n          unsearchable();\n          break;\n        case 'date':\n          deactivate(defaultValueFields);\n          deactivate(possibleValues);\n          hide(lengthField, regexpField, defaultValueFields);\n          unsearchable();\n          break;\n        case 'float':\n        case 'int':\n          deactivate(possibleValues);\n          show(lengthField, regexpField);\n          unsearchable();\n          break;\n        case 'user':\n          show(multiSelect);\n          activate(multiSelect);\n        case 'version':\n          deactivate(defaultValueFields);\n          deactivate(possibleValues);\n          hide(lengthField, regexpField, defaultValueFields);\n          unsearchable();\n          break;\n        case 'text':\n          activate(spanDefaultLongText);\n          deactivate(spanDefaultText);\n          show(lengthField, regexpField, searchable, textOrientationField);\n          deactivate(possibleValues);\n          activate(textOrientationField);\n          break;\n        default:\n          show(lengthField, regexpField, searchable);\n          deactivate(possibleValues);\n          break;\n      }\n    };\n\n    // assign the switch format function to the select field\n    format.on('change', toggleFormat).trigger('change');\n    toggleFormat();\n  });\n\n  $(function() {\n    var localeSelectors = $('.locale_selector');\n\n    localeSelectors.change(function () {\n      var lang = $(this).val(),\n          span = $(this).closest('.translation');\n      span.attr('lang', lang);\n    }).trigger('change');\n  });\n\n  var moveUpRow = function() {\n    var row = $(this).closest(\"tr\");\n    var above = row.prev(\"tr\");\n\n    above.before(row);\n\n    return false;\n  };\n\n  var moveDownRow = function() {\n    var row = $(this).closest(\"tr\");\n    var after = row.next(\"tr\");\n\n    after.after(row);\n\n    return false;\n  };\n\n  var moveRowToTheTop = function() {\n    var row = $(this).closest(\"tr\");\n    var first = jQuery(row.siblings()[0]);\n\n    first.before(row);\n\n    return false;\n  };\n\n  var moveRowToTheBottom = function() {\n    var row = $(this).closest(\"tr\");\n    var last = jQuery(row.siblings().last()[0]);\n\n    last.after(row);\n\n    return false;\n  };\n\n  var removeOption = function() {\n    var self = $(this);\n    if (self.attr(\"href\") === \"#\" || self.attr(\"href\").endsWith(\"/0\")) {\n      var row = self.closest(\"tr\");\n\n      if (row.siblings().length > 1) {\n        row.remove();\n      }\n\n      return false; // just remove new element\n    } else {\n      return true; // send off deletion\n    }\n  };\n\n  var duplicateRow = function() {\n    var count = $(\"#custom-options-table tr.custom-option-row\").length;\n    var row = $(\"#custom-options-table tr.custom-option-row:last\");\n    var dup = row.clone();\n\n    var value = dup.find(\".custom-option-value input\");\n\n    value.attr(\"name\", \"custom_field[custom_options_attributes][\" + count + \"][value]\");\n    value.attr(\"id\", \"custom_field_custom_options_attributes_\" + count + \"_value\");\n    value.val(\"\");\n\n    var defaultValueContainer = dup.find(\".custom-option-default-value\");\n    var defaultValueCheckbox = defaultValueContainer.find('input[type=\"checkbox\"]');\n    var defaultValueHidden = defaultValueContainer.find('input[type=\"hidden\"]');\n\n    defaultValueHidden.attr(\"name\", \"custom_field[custom_options_attributes][\" + count + \"][default_value]\");\n    defaultValueCheckbox.attr(\"name\", \"custom_field[custom_options_attributes][\" + count + \"][default_value]\");\n    defaultValueCheckbox.attr(\"id\", \"custom_field_custom_options_attributes_\" + count + \"_default_value]\");\n    defaultValueCheckbox.prop(\"checked\", false);\n\n    dup.find(\".custom-option-id\").remove();\n\n    dup.find(\".move-up-custom-option\").click(moveUpRow);\n    dup.find(\".sort-up-custom-option\").click(moveRowToTheTop);\n    dup.find(\".sort-down-custom-option\").click(moveRowToTheBottom);\n    dup.find(\".move-down-custom-option\").click(moveDownRow);\n    dup.find(\".custom-option-default-value\").change(uncheckOtherDefaults);\n\n    dup\n      .find(\".delete-custom-option\")\n      .attr(\"href\", \"#\")\n      .click(removeOption);\n\n    row.after(dup);\n\n    return false;\n  };\n\n  var uncheckOtherDefaults = function() {\n    var cb = $(this);\n\n    if (cb.prop(\"checked\")) {\n      var multi = $('#custom_field_multi_value');\n\n      if (!multi.prop(\"checked\")) {\n        $(\".custom-option-default-value\").each(function(i, other) {\n          $(other).prop(\"checked\", false);\n        });\n\n        cb.prop(\"checked\", true);\n      }\n    }\n  };\n\n  var checkOnlyOne = function() {\n    var cb = $(this);\n\n    if (!cb.prop(\"checked\")) {\n      $(\".custom-option-default-value:checked\").slice(1).each(function(i, other) {\n        $(other).prop(\"checked\", false);\n      });\n    }\n  };\n\n  $(document).ready(function() {\n    $(\"#add-custom-option\").click(duplicateRow);\n    $(\".delete-custom-option\").click(removeOption);\n\n    $(\".move-up-custom-option\").click(moveUpRow);\n    $(\".move-down-custom-option\").click(moveDownRow);\n\n    $(\".sort-up-custom-option\").click(moveRowToTheTop);\n    $(\".sort-down-custom-option\").click(moveRowToTheBottom);\n\n    $(\".custom-option-default-value\").change(uncheckOtherDefaults);\n    $('#custom_field_multi_value').change(checkOnlyOne);\n\n    // Make custom fields draggable\n    const container = document.getElementById('custom-field-dragula-container');\n    // eslint-disable-next-line no-undef\n    const drake = dragula([container], {\n      isContainer: function (el) {\n        return false;\n      },\n      moves: function (el, source, handle, sibling) {\n        return $(handle).hasClass('dragula-handle');\n      },\n      accepts: function (el, target, source, sibling) {\n        return true;\n      },\n      invalid: function (el, handle) {\n        return false;\n      },\n      direction: 'vertical',\n      copy: false,\n      copySortSource: false,\n      revertOnSpill: true,\n      removeOnSpill: false,\n      mirrorContainer: container,\n      ignoreInputTextSelection: true\n    });\n\n    // Setup autoscroll\n    window.OpenProject.getPluginContext().then((pluginContext) => {\n      new pluginContext.classes.DomAutoscrollService(\n        [\n          document.getElementById('content-wrapper'),\n        ],\n        {\n          margin: 25,\n          maxSpeed: 10,\n          scrollWhenOutside: true,\n          autoScroll: function () {\n            return drake.dragging;\n          }\n        });\n    });\n  });\n}(window, jQuery));\n"],"sourceRoot":"webpack:///","file":"src_app_core_augmenting_dynamic-scripts_custom_fields_js.e2c97f414fc31e213011.js"}